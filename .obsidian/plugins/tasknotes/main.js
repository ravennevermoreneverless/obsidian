/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var nU=Object.create;var yl=Object.defineProperty;var pD=Object.getOwnPropertyDescriptor;var iU=Object.getOwnPropertyNames;var aU=Object.getPrototypeOf,oU=Object.prototype.hasOwnProperty;var mD=n=>{throw TypeError(n)};var lU=(n,e,t)=>e in n?yl(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var v=(n,e)=>()=>(n&&(e=n(n=0)),e);var _p=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),st=(n,e)=>{for(var t in e)yl(n,t,{get:e[t],enumerable:!0})},gD=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of iU(e))!oU.call(n,s)&&s!==t&&yl(n,s,{get:()=>e[s],enumerable:!(r=pD(e,s))||r.enumerable});return n};var Ee=(n,e,t)=>(t=n!=null?nU(aU(n)):{},gD(e||!n||!n.__esModule?yl(t,"default",{value:n,enumerable:!0}):t,n)),Td=n=>gD(yl({},"__esModule",{value:!0}),n),Pe=(n,e,t,r)=>{for(var s=r>1?void 0:r?pD(e,t):e,i=n.length-1,a;i>=0;i--)(a=n[i])&&(s=(r?a(e,t,s):a(s))||s);return r&&s&&yl(e,t,s),s};var R=(n,e,t)=>lU(n,typeof e!="symbol"?e+"":e,t),yD=(n,e,t)=>e.has(n)||mD("Cannot "+t);var Ja=(n,e,t)=>(yD(n,e,"read from private field"),t?t.call(n):e.get(n)),Ap=(n,e,t)=>e.has(n)?mD("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Ip=(n,e,t,r)=>(yD(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);var cU,X4,Rp,vD,Cv,Mv,dU,TD,J4,uU,hU,e5,Pv,vl=v(()=>{cU=Math.pow(10,8)*24*60*60*1e3,X4=-cU,Rp=6048e5,vD=864e5,Cv=6e4,Mv=36e5,dU=3600,TD=dU*24,J4=TD*7,uU=TD*365.2425,hU=uU/12,e5=hU*3,Pv=Symbol.for("constructDateFrom")});function St(n,e){return typeof n=="function"?n(e):n&&typeof n=="object"&&Pv in n?n[Pv](e):n instanceof Date?new n.constructor(e):new Date(e)}var Ws=v(()=>{vl()});function Ce(n,e){return St(e||n,n)}var _t=v(()=>{Ws()});function Br(n,e,t){let r=Ce(n,t==null?void 0:t.in);return isNaN(e)?St((t==null?void 0:t.in)||n,NaN):(e&&r.setDate(r.getDate()+e),r)}var wd=v(()=>{Ws();_t()});function _v(n,e,t){let r=Ce(n,t==null?void 0:t.in);if(isNaN(e))return St((t==null?void 0:t.in)||n,NaN);if(!e)return r;let s=r.getDate(),i=St((t==null?void 0:t.in)||n,r.getTime());i.setMonth(r.getMonth()+e+1,0);let a=i.getDate();return s>=a?i:(r.setFullYear(i.getFullYear(),i.getMonth(),s),r)}var Av=v(()=>{Ws();_t()});function Tl(n,e,t){let{years:r=0,months:s=0,weeks:i=0,days:a=0,hours:o=0,minutes:l=0,seconds:c=0}=e,d=Ce(n,t==null?void 0:t.in),u=s||r?_v(d,s+r*12):d,f=a||i?Br(u,a+i*7):u,h=l+o*60,m=(c+h*60)*1e3;return St((t==null?void 0:t.in)||n,+f+m)}var wD=v(()=>{wd();Av();Ws();_t()});var bD=v(()=>{});var kD=v(()=>{});var ED=v(()=>{});var SD=v(()=>{});var DD=v(()=>{});var xD=v(()=>{});function On(){return fU}var fU,wl=v(()=>{fU={}});function Er(n,e){var o,l,c,d,u,f,h,p;let t=On(),r=(p=(h=(d=(c=e==null?void 0:e.weekStartsOn)!=null?c:(l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)!=null?d:t.weekStartsOn)!=null?h:(f=(u=t.locale)==null?void 0:u.options)==null?void 0:f.weekStartsOn)!=null?p:0,s=Ce(n,e==null?void 0:e.in),i=s.getDay(),a=(i<r?7:0)+i-r;return s.setDate(s.getDate()-a),s.setHours(0,0,0,0),s}var bl=v(()=>{wl();_t()});function eo(n,e){return Er(n,{...e,weekStartsOn:1})}var bd=v(()=>{bl()});function Np(n,e){let t=Ce(n,e==null?void 0:e.in),r=t.getFullYear(),s=St(t,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);let i=eo(s),a=St(t,0);a.setFullYear(r,0,4),a.setHours(0,0,0,0);let o=eo(a);return t.getTime()>=i.getTime()?r+1:t.getTime()>=o.getTime()?r:r-1}var Op=v(()=>{Ws();bd();_t()});function Iv(n){let e=Ce(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}var CD=v(()=>{_t()});function Lp(n,...e){let t=St.bind(null,n||e.find(r=>typeof r=="object"));return e.map(t)}var Rv=v(()=>{Ws()});function Sr(n,e){let t=Ce(n,e==null?void 0:e.in);return t.setHours(0,0,0,0),t}var Fp=v(()=>{_t()});function MD(n,e,t){let[r,s]=Lp(t==null?void 0:t.in,n,e),i=Sr(r),a=Sr(s),o=+i-Iv(i),l=+a-Iv(a);return Math.round((o-l)/vD)}var Nv=v(()=>{CD();Rv();vl();Fp()});function PD(n,e){let t=Np(n,e),r=St((e==null?void 0:e.in)||n,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),eo(r)}var Ov=v(()=>{Ws();Op();bd()});var _D=v(()=>{});var AD=v(()=>{});var ID=v(()=>{});var RD=v(()=>{});var ND=v(()=>{});function OD(n,e,t){return Br(n,e*7,t)}var LD=v(()=>{wd()});var FD=v(()=>{});var HD=v(()=>{});var BD=v(()=>{});var UD=v(()=>{});var jD=v(()=>{});var WD=v(()=>{});var VD=v(()=>{});var $D=v(()=>{});var YD=v(()=>{});var zD=v(()=>{});var qD=v(()=>{});function kd(n,e,t){let[r,s]=Lp(t==null?void 0:t.in,n,e);return+Sr(r)==+Sr(s)}var GD=v(()=>{Rv();Fp()});function QD(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}var Lv=v(()=>{});function Dr(n){return!(!QD(n)&&typeof n!="number"||isNaN(+Ce(n)))}var Fv=v(()=>{Lv();_t()});var KD=v(()=>{});var ZD=v(()=>{});var XD=v(()=>{});var JD=v(()=>{});var ex=v(()=>{});var tx=v(()=>{});var rx=v(()=>{});var sx=v(()=>{});var nx=v(()=>{});var ix=v(()=>{});var ax=v(()=>{});var ox=v(()=>{});var lx=v(()=>{});var cx=v(()=>{});function Hv(n,e){let t=Ce(n,e==null?void 0:e.in);return t.setHours(23,59,59,999),t}var dx=v(()=>{_t()});function Bv(n,e){let t=Ce(n,e==null?void 0:e.in),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}var ux=v(()=>{_t()});var hx=v(()=>{});var fx=v(()=>{});var px=v(()=>{});var mx=v(()=>{});var gx=v(()=>{});var yx=v(()=>{});var vx=v(()=>{});var Tx=v(()=>{});var wx=v(()=>{});var bx=v(()=>{});var kx=v(()=>{});var Ex=v(()=>{});var Sx=v(()=>{});var Dx=v(()=>{});function Uv(n,e){let t=Ce(n,e==null?void 0:e.in);return t.setDate(1),t.setHours(0,0,0,0),t}var xx=v(()=>{_t()});var Cx=v(()=>{});var Mx=v(()=>{});function jv(n,e){let t=Ce(n,e==null?void 0:e.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}var Wv=v(()=>{_t()});var Px=v(()=>{});var _x=v(()=>{});var Ax=v(()=>{});var Ix=v(()=>{});function to(n,e){var o,l,c,d,u,f,h,p;let t=On(),r=(p=(h=(d=(c=e==null?void 0:e.weekStartsOn)!=null?c:(l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)!=null?d:t.weekStartsOn)!=null?h:(f=(u=t.locale)==null?void 0:u.options)==null?void 0:f.weekStartsOn)!=null?p:0,s=Ce(n,e==null?void 0:e.in),i=s.getDay(),a=(i<r?-7:0)+6-(i-r);return s.setDate(s.getDate()+a),s.setHours(23,59,59,999),s}var Rx=v(()=>{wl();_t()});var Nx=v(()=>{});var Ox=v(()=>{});var Lx=v(()=>{});var Fx=v(()=>{});var Hx=v(()=>{});var Bx=v(()=>{});var Ux=v(()=>{});var jx=v(()=>{});var pU,Wx,Vx=v(()=>{pU={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Wx=(n,e,t)=>{let r,s=pU[n];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r}});function Hp(n){return(e={})=>{let t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}var $x=v(()=>{});var mU,gU,yU,Yx,zx=v(()=>{$x();mU={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},gU={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},yU={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Yx={date:Hp({formats:mU,defaultWidth:"full"}),time:Hp({formats:gU,defaultWidth:"full"}),dateTime:Hp({formats:yU,defaultWidth:"full"})}});var vU,qx,Gx=v(()=>{vU={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},qx=(n,e,t,r)=>vU[n]});function kl(n){return(e,t)=>{let r=t!=null&&t.context?String(t.context):"standalone",s;if(r==="formatting"&&n.formattingValues){let a=n.defaultFormattingWidth||n.defaultWidth,o=t!=null&&t.width?String(t.width):a;s=n.formattingValues[o]||n.formattingValues[a]}else{let a=n.defaultWidth,o=t!=null&&t.width?String(t.width):n.defaultWidth;s=n.values[o]||n.values[a]}let i=n.argumentCallback?n.argumentCallback(e):e;return s[i]}}var Qx=v(()=>{});var TU,wU,bU,kU,EU,SU,DU,Kx,Zx=v(()=>{Qx();TU={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},wU={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},bU={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},kU={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},EU={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},SU={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},DU=(n,e)=>{let t=Number(n),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Kx={ordinalNumber:DU,era:kl({values:TU,defaultWidth:"wide"}),quarter:kl({values:wU,defaultWidth:"wide",argumentCallback:n=>n-1}),month:kl({values:bU,defaultWidth:"wide"}),day:kl({values:kU,defaultWidth:"wide"}),dayPeriod:kl({values:EU,defaultWidth:"wide",formattingValues:SU,defaultFormattingWidth:"wide"})}});function El(n){return(e,t={})=>{let r=t.width,s=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],i=e.match(s);if(!i)return null;let a=i[0],o=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],l=Array.isArray(o)?CU(o,u=>u.test(a)):xU(o,u=>u.test(a)),c;c=n.valueCallback?n.valueCallback(l):l,c=t.valueCallback?t.valueCallback(c):c;let d=e.slice(a.length);return{value:c,rest:d}}}function xU(n,e){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function CU(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}var Xx=v(()=>{});function Jx(n){return(e,t={})=>{let r=e.match(n.matchPattern);if(!r)return null;let s=r[0],i=e.match(n.parsePattern);if(!i)return null;let a=n.valueCallback?n.valueCallback(i[0]):i[0];a=t.valueCallback?t.valueCallback(a):a;let o=e.slice(s.length);return{value:a,rest:o}}}var eC=v(()=>{});var MU,PU,_U,AU,IU,RU,NU,OU,LU,FU,HU,BU,tC,rC=v(()=>{Xx();eC();MU=/^(\d+)(th|st|nd|rd)?/i,PU=/\d+/i,_U={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},AU={any:[/^b/i,/^(a|c)/i]},IU={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},RU={any:[/1/i,/2/i,/3/i,/4/i]},NU={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},OU={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},LU={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},FU={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},HU={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},BU={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},tC={ordinalNumber:Jx({matchPattern:MU,parsePattern:PU,valueCallback:n=>parseInt(n,10)}),era:El({matchPatterns:_U,defaultMatchWidth:"wide",parsePatterns:AU,defaultParseWidth:"any"}),quarter:El({matchPatterns:IU,defaultMatchWidth:"wide",parsePatterns:RU,defaultParseWidth:"any",valueCallback:n=>n+1}),month:El({matchPatterns:NU,defaultMatchWidth:"wide",parsePatterns:OU,defaultParseWidth:"any"}),day:El({matchPatterns:LU,defaultMatchWidth:"wide",parsePatterns:FU,defaultParseWidth:"any"}),dayPeriod:El({matchPatterns:HU,defaultMatchWidth:"any",parsePatterns:BU,defaultParseWidth:"any"})}});var Vv,sC=v(()=>{Vx();zx();Gx();Zx();rC();Vv={code:"en-US",formatDistance:Wx,formatLong:Yx,formatRelative:qx,localize:Kx,match:tC,options:{weekStartsOn:0,firstWeekContainsDate:1}}});var nC=v(()=>{sC()});function iC(n,e){let t=Ce(n,e==null?void 0:e.in);return MD(t,jv(t))+1}var $v=v(()=>{Nv();Wv();_t()});function aC(n,e){let t=Ce(n,e==null?void 0:e.in),r=+eo(t)-+PD(t);return Math.round(r/Rp)+1}var Yv=v(()=>{vl();bd();Ov();_t()});function Bp(n,e){var d,u,f,h,p,m,g,y;let t=Ce(n,e==null?void 0:e.in),r=t.getFullYear(),s=On(),i=(y=(g=(h=(f=e==null?void 0:e.firstWeekContainsDate)!=null?f:(u=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)!=null?h:s.firstWeekContainsDate)!=null?g:(m=(p=s.locale)==null?void 0:p.options)==null?void 0:m.firstWeekContainsDate)!=null?y:1,a=St((e==null?void 0:e.in)||n,0);a.setFullYear(r+1,0,i),a.setHours(0,0,0,0);let o=Er(a,e),l=St((e==null?void 0:e.in)||n,0);l.setFullYear(r,0,i),l.setHours(0,0,0,0);let c=Er(l,e);return+t>=+o?r+1:+t>=+c?r:r-1}var Up=v(()=>{wl();Ws();bl();_t()});function oC(n,e){var o,l,c,d,u,f,h,p;let t=On(),r=(p=(h=(d=(c=e==null?void 0:e.firstWeekContainsDate)!=null?c:(l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.firstWeekContainsDate)!=null?d:t.firstWeekContainsDate)!=null?h:(f=(u=t.locale)==null?void 0:u.options)==null?void 0:f.firstWeekContainsDate)!=null?p:1,s=Bp(n,e),i=St((e==null?void 0:e.in)||n,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),Er(i,e)}var zv=v(()=>{wl();Ws();Up();bl()});function lC(n,e){let t=Ce(n,e==null?void 0:e.in),r=+Er(t,e)-+oC(t,e);return Math.round(r/Rp)+1}var qv=v(()=>{vl();bl();zv();_t()});function nt(n,e){let t=n<0?"-":"",r=Math.abs(n).toString().padStart(e,"0");return t+r}var Gv=v(()=>{});var mi,cC=v(()=>{Gv();mi={y(n,e){let t=n.getFullYear(),r=t>0?t:1-t;return nt(e==="yy"?r%100:r,e.length)},M(n,e){let t=n.getMonth();return e==="M"?String(t+1):nt(t+1,2)},d(n,e){return nt(n.getDate(),e.length)},a(n,e){let t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return nt(n.getHours()%12||12,e.length)},H(n,e){return nt(n.getHours(),e.length)},m(n,e){return nt(n.getMinutes(),e.length)},s(n,e){return nt(n.getSeconds(),e.length)},S(n,e){let t=e.length,r=n.getMilliseconds(),s=Math.trunc(r*Math.pow(10,t-3));return nt(s,e.length)}}});function dC(n,e=""){let t=n>0?"-":"+",r=Math.abs(n),s=Math.trunc(r/60),i=r%60;return i===0?t+String(s):t+String(s)+e+nt(i,2)}function uC(n,e){return n%60===0?(n>0?"-":"+")+nt(Math.abs(n)/60,2):ro(n,e)}function ro(n,e=""){let t=n>0?"-":"+",r=Math.abs(n),s=nt(Math.trunc(r/60),2),i=nt(r%60,2);return t+s+e+i}var Sl,Qv,hC=v(()=>{$v();Yv();Op();qv();Up();Gv();cC();Sl={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Qv={G:function(n,e,t){let r=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});case"GGGG":default:return t.era(r,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){let r=n.getFullYear(),s=r>0?r:1-r;return t.ordinalNumber(s,{unit:"year"})}return mi.y(n,e)},Y:function(n,e,t,r){let s=Bp(n,r),i=s>0?s:1-s;if(e==="YY"){let a=i%100;return nt(a,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):nt(i,e.length)},R:function(n,e){let t=Np(n);return nt(t,e.length)},u:function(n,e){let t=n.getFullYear();return nt(t,e.length)},Q:function(n,e,t){let r=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return nt(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(n,e,t){let r=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return nt(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(n,e,t){let r=n.getMonth();switch(e){case"M":case"MM":return mi.M(n,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(n,e,t){let r=n.getMonth();switch(e){case"L":return String(r+1);case"LL":return nt(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(n,e,t,r){let s=lC(n,r);return e==="wo"?t.ordinalNumber(s,{unit:"week"}):nt(s,e.length)},I:function(n,e,t){let r=aC(n);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):nt(r,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):mi.d(n,e)},D:function(n,e,t){let r=iC(n);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):nt(r,e.length)},E:function(n,e,t){let r=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});case"EEEE":default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(n,e,t,r){let s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return nt(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(n,e,t,r){let s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return nt(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(n,e,t){let r=n.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return nt(s,e.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});case"iiii":default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(n,e,t){let s=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(n,e,t){let r=n.getHours(),s;switch(r===12?s=Sl.noon:r===0?s=Sl.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(n,e,t){let r=n.getHours(),s;switch(r>=17?s=Sl.evening:r>=12?s=Sl.afternoon:r>=4?s=Sl.morning:s=Sl.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let r=n.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return mi.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):mi.H(n,e)},K:function(n,e,t){let r=n.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):nt(r,e.length)},k:function(n,e,t){let r=n.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):nt(r,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):mi.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):mi.s(n,e)},S:function(n,e){return mi.S(n,e)},X:function(n,e,t){let r=n.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return uC(r);case"XXXX":case"XX":return ro(r);case"XXXXX":case"XXX":default:return ro(r,":")}},x:function(n,e,t){let r=n.getTimezoneOffset();switch(e){case"x":return uC(r);case"xxxx":case"xx":return ro(r);case"xxxxx":case"xxx":default:return ro(r,":")}},O:function(n,e,t){let r=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+dC(r,":");case"OOOO":default:return"GMT"+ro(r,":")}},z:function(n,e,t){let r=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+dC(r,":");case"zzzz":default:return"GMT"+ro(r,":")}},t:function(n,e,t){let r=Math.trunc(+n/1e3);return nt(r,e.length)},T:function(n,e,t){return nt(+n,e.length)}}});var fC,pC,UU,mC,gC=v(()=>{fC=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},pC=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},UU=(n,e)=>{let t=n.match(/(P+)(p+)?/)||[],r=t[1],s=t[2];if(!s)return fC(n,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",fC(r,e)).replace("{{time}}",pC(s,e))},mC={p:pC,P:UU}});function yC(n){return jU.test(n)}function vC(n){return WU.test(n)}function TC(n,e,t){let r=$U(n,e,t);if(console.warn(r),VU.includes(n))throw new RangeError(r)}function $U(n,e,t){let r=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}var jU,WU,VU,wC=v(()=>{jU=/^D+$/,WU=/^Y+$/,VU=["D","DD","YY","YYYY"]});function C(n,e,t){var d,u,f,h,p,m,g,y,T,w,b,E,S,D,x,M,B,Q;let r=On(),s=(u=(d=t==null?void 0:t.locale)!=null?d:r.locale)!=null?u:Vv,i=(w=(T=(m=(p=t==null?void 0:t.firstWeekContainsDate)!=null?p:(h=(f=t==null?void 0:t.locale)==null?void 0:f.options)==null?void 0:h.firstWeekContainsDate)!=null?m:r.firstWeekContainsDate)!=null?T:(y=(g=r.locale)==null?void 0:g.options)==null?void 0:y.firstWeekContainsDate)!=null?w:1,a=(Q=(B=(D=(S=t==null?void 0:t.weekStartsOn)!=null?S:(E=(b=t==null?void 0:t.locale)==null?void 0:b.options)==null?void 0:E.weekStartsOn)!=null?D:r.weekStartsOn)!=null?B:(M=(x=r.locale)==null?void 0:x.options)==null?void 0:M.weekStartsOn)!=null?Q:0,o=Ce(n,t==null?void 0:t.in);if(!Dr(o))throw new RangeError("Invalid time value");let l=e.match(zU).map(P=>{let I=P[0];if(I==="p"||I==="P"){let A=mC[I];return A(P,s.formatLong)}return P}).join("").match(YU).map(P=>{if(P==="''")return{isToken:!1,value:"'"};let I=P[0];if(I==="'")return{isToken:!1,value:KU(P)};if(Qv[I])return{isToken:!0,value:P};if(I.match(QU))throw new RangeError("Format string contains an unescaped latin alphabet character `"+I+"`");return{isToken:!1,value:P}});s.localize.preprocessor&&(l=s.localize.preprocessor(o,l));let c={firstWeekContainsDate:i,weekStartsOn:a,locale:s};return l.map(P=>{if(!P.isToken)return P.value;let I=P.value;(!(t!=null&&t.useAdditionalWeekYearTokens)&&vC(I)||!(t!=null&&t.useAdditionalDayOfYearTokens)&&yC(I))&&TC(I,e,String(n));let A=Qv[I[0]];return A(o,I,s.localize,c)}).join("")}function KU(n){let e=n.match(qU);return e?e[1].replace(GU,"'"):n}var YU,zU,qU,GU,QU,bC=v(()=>{nC();wl();hC();gC();wC();Fv();_t();YU=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,zU=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,qU=/^'([^]*?)'?$/,GU=/''/g,QU=/[a-zA-Z]/});var kC=v(()=>{});var EC=v(()=>{});var SC=v(()=>{});var DC=v(()=>{});var xC=v(()=>{});var CC=v(()=>{});var MC=v(()=>{});var PC=v(()=>{});var _C=v(()=>{});var AC=v(()=>{});var IC=v(()=>{});var RC=v(()=>{});var NC=v(()=>{});var OC=v(()=>{});var LC=v(()=>{});var FC=v(()=>{});var HC=v(()=>{});var BC=v(()=>{});var UC=v(()=>{});var jC=v(()=>{});var WC=v(()=>{});var VC=v(()=>{});var $C=v(()=>{});var YC=v(()=>{});var zC=v(()=>{});var qC=v(()=>{});var GC=v(()=>{});var QC=v(()=>{});var KC=v(()=>{});var ZC=v(()=>{});var XC=v(()=>{});var JC=v(()=>{});var e0=v(()=>{});var t0=v(()=>{});var r0=v(()=>{});var s0=v(()=>{});var n0=v(()=>{});var i0=v(()=>{});var a0=v(()=>{});var o0=v(()=>{});var l0=v(()=>{});function jp(n,e){return+Ce(n)<+Ce(e)}var c0=v(()=>{_t()});var d0=v(()=>{});var u0=v(()=>{});var h0=v(()=>{});var f0=v(()=>{});var p0=v(()=>{});var m0=v(()=>{});var g0=v(()=>{});var y0=v(()=>{});var v0=v(()=>{});var T0=v(()=>{});var w0=v(()=>{});var b0=v(()=>{});var k0=v(()=>{});var E0=v(()=>{});var S0=v(()=>{});var D0=v(()=>{});var x0=v(()=>{});var C0=v(()=>{});var M0=v(()=>{});var P0=v(()=>{});var _0=v(()=>{});var A0=v(()=>{});var I0=v(()=>{});var R0=v(()=>{});var N0=v(()=>{});var O0=v(()=>{});var L0=v(()=>{});var F0=v(()=>{});var H0=v(()=>{});var B0=v(()=>{});var U0=v(()=>{});var j0=v(()=>{});var W0=v(()=>{});var V0=v(()=>{});var $0=v(()=>{});var Y0=v(()=>{});var z0=v(()=>{});var q0=v(()=>{});var G0=v(()=>{});var Q0=v(()=>{});function Dl(n,e,t){return Br(n,-e,t)}var K0=v(()=>{wd()});var Z0=v(()=>{});var X0=v(()=>{});var J0=v(()=>{});var eM=v(()=>{});var tM=v(()=>{});var rM=v(()=>{});var sM=v(()=>{});var nM=v(()=>{});var iM=v(()=>{});var aM=v(()=>{});var oM=v(()=>{});var lM=v(()=>{});var cM=v(()=>{});var dM=v(()=>{});var uM=v(()=>{});var hM=v(()=>{});var fM=v(()=>{});var pM=v(()=>{});var mM=v(()=>{});var gM=v(()=>{});var yM=v(()=>{});var vM=v(()=>{});var TM=v(()=>{});var wM=v(()=>{});var bM=v(()=>{});function so(n,e){var c;let t=()=>St(e==null?void 0:e.in,NaN),r=(c=e==null?void 0:e.additionalDigits)!=null?c:2,s=ej(n),i;if(s.date){let d=tj(s.date,r);i=rj(d.restDateString,d.year)}if(!i||isNaN(+i))return t();let a=+i,o=0,l;if(s.time&&(o=sj(s.time),isNaN(o)))return t();if(s.timezone){if(l=nj(s.timezone),isNaN(l))return t()}else{let d=new Date(a+o),u=Ce(0,e==null?void 0:e.in);return u.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),u}return Ce(a+o+l,e==null?void 0:e.in)}function ej(n){let e={},t=n.split(Wp.dateTimeDelimiter),r;if(t.length>2)return e;if(/:/.test(t[0])?r=t[0]:(e.date=t[0],r=t[1],Wp.timeZoneDelimiter.test(e.date)&&(e.date=n.split(Wp.timeZoneDelimiter)[0],r=n.substr(e.date.length,n.length))),r){let s=Wp.timezone.exec(r);s?(e.time=r.replace(s[1],""),e.timezone=s[1]):e.time=r}return e}function tj(n,e){let t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=n.match(t);if(!r)return{year:NaN,restDateString:""};let s=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?s:i*100,restDateString:n.slice((r[1]||r[2]).length)}}function rj(n,e){if(e===null)return new Date(NaN);let t=n.match(ZU);if(!t)return new Date(NaN);let r=!!t[4],s=Ed(t[1]),i=Ed(t[2])-1,a=Ed(t[3]),o=Ed(t[4]),l=Ed(t[5])-1;if(r)return cj(e,o,l)?ij(e,o,l):new Date(NaN);{let c=new Date(0);return!oj(e,i,a)||!lj(e,s)?new Date(NaN):(c.setUTCFullYear(e,i,Math.max(s,a)),c)}}function Ed(n){return n?parseInt(n):1}function sj(n){let e=n.match(XU);if(!e)return NaN;let t=Kv(e[1]),r=Kv(e[2]),s=Kv(e[3]);return dj(t,r,s)?t*Mv+r*Cv+s*1e3:NaN}function Kv(n){return n&&parseFloat(n.replace(",","."))||0}function nj(n){if(n==="Z")return 0;let e=n.match(JU);if(!e)return 0;let t=e[1]==="+"?-1:1,r=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return uj(r,s)?t*(r*Mv+s*Cv):NaN}function ij(n,e,t){let r=new Date(0);r.setUTCFullYear(n,0,4);let s=r.getUTCDay()||7,i=(e-1)*7+t+1-s;return r.setUTCDate(r.getUTCDate()+i),r}function kM(n){return n%400===0||n%4===0&&n%100!==0}function oj(n,e,t){return e>=0&&e<=11&&t>=1&&t<=(aj[e]||(kM(n)?29:28))}function lj(n,e){return e>=1&&e<=(kM(n)?366:365)}function cj(n,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function dj(n,e,t){return n===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&n>=0&&n<25}function uj(n,e){return e>=0&&e<=59}var Wp,ZU,XU,JU,aj,EM=v(()=>{vl();Ws();_t();Wp={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ZU=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,XU=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,JU=/^([+-])(\d{2})(?::?(\d{2}))?$/;aj=[31,null,31,30,31,30,31,31,30,31,30,31]});var SM=v(()=>{});var DM=v(()=>{});var xM=v(()=>{});var CM=v(()=>{});var MM=v(()=>{});var PM=v(()=>{});var _M=v(()=>{});var AM=v(()=>{});var IM=v(()=>{});var RM=v(()=>{});var NM=v(()=>{});var OM=v(()=>{});var LM=v(()=>{});var FM=v(()=>{});var HM=v(()=>{});var BM=v(()=>{});var UM=v(()=>{});var jM=v(()=>{});var WM=v(()=>{});var VM=v(()=>{});var $M=v(()=>{});var YM=v(()=>{});var zM=v(()=>{});var qM=v(()=>{});var GM=v(()=>{});var QM=v(()=>{});var KM=v(()=>{});var ZM=v(()=>{});var XM=v(()=>{});var JM=v(()=>{});var eP=v(()=>{});var tP=v(()=>{});var rP=v(()=>{});var sP=v(()=>{});var nP=v(()=>{});var iP=v(()=>{});var aP=v(()=>{});var oP=v(()=>{});var lP=v(()=>{});var cP=v(()=>{});var dP=v(()=>{});var uP=v(()=>{});var hP=v(()=>{});var fP=v(()=>{});var pP=v(()=>{});var mP=v(()=>{});var Ft=v(()=>{wD();SD();wd();xD();AD();DD();ID();Av();RD();ND();LD();FD();HD();jD();WD();VD();$D();YD();Ws();zD();qD();KD();Nv();ZD();XD();JD();tx();rx();sx();nx();ix();ox();lx();cx();fx();px();mx();gx();yx();vx();Tx();wx();bx();Ex();Sx();Dx();Cx();Px();_x();dx();Ax();Ix();Nx();Ox();Lx();ux();Fx();Hx();Bx();Ux();Rx();Mx();jx();bC();kC();EC();SC();DC();xC();CC();MC();PC();_C();AC();IC();RC();NC();OC();$v();LC();HC();BC();UC();jC();WC();Yv();Op();VC();$C();YC();zC();qC();ex();GC();QC();KC();qv();ZC();Up();JC();e0();t0();r0();s0();n0();i0();a0();o0();l0();c0();Lv();d0();u0();h0();f0();p0();hx();FC();b0();k0();E0();GD();D0();C0();M0();_0();A0();I0();N0();x0();O0();bD();kD();L0();F0();H0();B0();U0();j0();W0();V0();$0();Y0();z0();q0();Fv();G0();ED();Q0();Z0();X0();eM();tM();XC();rM();J0();sM();nM();BD();iM();aM();oM();lM();UD();cM();dM();uM();hM();fM();pM();mM();gM();yM();vM();TM();wM();bM();w0();EM();SM();DM();xM();CM();MM();PM();_M();AM();IM();RM();NM();OM();LM();FM();HM();BM();jM();WM();v0();VM();$M();YM();T0();y0();_D();zM();qM();UM();GM();QM();g0();KM();ZM();Fp();XM();S0();bd();Ov();P0();xx();kx();R0();JM();eP();bl();zv();Wv();tP();sP();nP();K0();iP();ax();aP();oP();rP();lP();cP();dP();uP();_t();m0();hP();fP();pP();mP()});var wn=_p(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});var Dt=require("obsidian"),Zv="YYYY-MM-DD",Xv="gggg-[W]ww",gP="YYYY-MM",yP="YYYY-[Q]Q",vP="YYYY";function Sd(n){var t,r;let e=window.app.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t[n])==null?void 0:r.enabled)}function Dd(){var n,e,t,r;try{let{internalPlugins:s,plugins:i}=window.app;if(Sd("daily")){let{format:c,folder:d,template:u}=((e=(n=i.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:e.daily)||{};return{format:c||Zv,folder:(d==null?void 0:d.trim())||"",template:(u==null?void 0:u.trim())||""}}let{folder:a,format:o,template:l}=((r=(t=s.getPluginById("daily-notes"))==null?void 0:t.instance)==null?void 0:r.options)||{};return{format:o||Zv,folder:(a==null?void 0:a.trim())||"",template:(l==null?void 0:l.trim())||""}}catch(s){console.info("No custom daily note settings found!",s)}}function xd(){var n,e,t,r,s,i,a;try{let o=window.app.plugins,l=(n=o.getPlugin("calendar"))==null?void 0:n.options,c=(t=(e=o.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.weekly;if(Sd("weekly"))return{format:c.format||Xv,folder:((r=c.folder)==null?void 0:r.trim())||"",template:((s=c.template)==null?void 0:s.trim())||""};let d=l||{};return{format:d.weeklyNoteFormat||Xv,folder:((i=d.weeklyNoteFolder)==null?void 0:i.trim())||"",template:((a=d.weeklyNoteTemplate)==null?void 0:a.trim())||""}}catch(o){console.info("No custom weekly note settings found!",o)}}function Cd(){var e,t,r,s;let n=window.app.plugins;try{let i=Sd("monthly")&&((t=(e=n.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.monthly)||{};return{format:i.format||gP,folder:((r=i.folder)==null?void 0:r.trim())||"",template:((s=i.template)==null?void 0:s.trim())||""}}catch(i){console.info("No custom monthly note settings found!",i)}}function Md(){var e,t,r,s;let n=window.app.plugins;try{let i=Sd("quarterly")&&((t=(e=n.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.quarterly)||{};return{format:i.format||yP,folder:((r=i.folder)==null?void 0:r.trim())||"",template:((s=i.template)==null?void 0:s.trim())||""}}catch(i){console.info("No custom quarterly note settings found!",i)}}function Pd(){var e,t,r,s;let n=window.app.plugins;try{let i=Sd("yearly")&&((t=(e=n.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.yearly)||{};return{format:i.format||vP,folder:((r=i.folder)==null?void 0:r.trim())||"",template:((s=i.template)==null?void 0:s.trim())||""}}catch(i){console.info("No custom yearly note settings found!",i)}}function TP(...n){let e=[];for(let r=0,s=n.length;r<s;r++)e=e.concat(n[r].split("/"));let t=[];for(let r=0,s=e.length;r<s;r++){let i=e[r];!i||i==="."||t.push(i)}return e[0]===""&&t.unshift(""),t.join("/")}function hj(n){let e=n.substring(n.lastIndexOf("/")+1);return e.lastIndexOf(".")!=-1&&(e=e.substring(0,e.lastIndexOf("."))),e}async function fj(n){let e=n.replace(/\\/g,"/").split("/");if(e.pop(),e.length){let t=TP(...e);window.app.vault.getAbstractFileByPath(t)||await window.app.vault.createFolder(t)}}async function _d(n,e){e.endsWith(".md")||(e+=".md");let t=Dt.normalizePath(TP(n,e));return await fj(t),t}async function xl(n){let{metadataCache:e,vault:t}=window.app,r=Dt.normalizePath(n);if(r==="/")return Promise.resolve(["",null]);try{let s=e.getFirstLinkpathDest(r,""),i=await t.cachedRead(s),a=window.app.foldManager.load(s);return[i,a]}catch(s){return console.error(`Failed to read the daily note template '${r}'`,s),new Dt.Notice("Failed to read the daily note template"),["",null]}}function Tn(n,e="day"){let t=n.clone().startOf(e).format();return`${e}-${t}`}function wP(n){return n.replace(/\[[^\]]*\]/g,"")}function pj(n,e){if(e==="week"){let t=wP(n);return/w{1,2}/i.test(t)&&(/M{1,4}/.test(t)||/D{1,4}/.test(t))}return!1}function Cl(n,e){return bP(n.basename,e)}function mj(n,e){return bP(hj(n),e)}function bP(n,e){let r={day:Dd,week:xd,month:Cd,quarter:Md,year:Pd}[e]().format.split("/").pop(),s=window.moment(n,r,!0);if(!s.isValid())return null;if(pj(r,e)&&e==="week"){let i=wP(r);if(/w{1,2}/i.test(i))return window.moment(n,r.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return s}var Jv=class extends Error{};async function kP(n){let e=window.app,{vault:t}=e,r=window.moment,{template:s,format:i,folder:a}=Dd(),[o,l]=await xl(s),c=n.format(i),d=await _d(a,c);try{let u=await t.create(d,o.replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,r().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(f,h,p,m,g,y)=>{let T=r(),w=n.clone().set({hour:T.get("hour"),minute:T.get("minute"),second:T.get("second")});return p&&w.add(parseInt(m,10),g),y?w.format(y.substring(1).trim()):w.format(i)}).replace(/{{\s*yesterday\s*}}/gi,n.clone().subtract(1,"day").format(i)).replace(/{{\s*tomorrow\s*}}/gi,n.clone().add(1,"d").format(i)));return e.foldManager.save(u,l),u}catch(u){console.error(`Failed to create file: '${d}'`,u),new Dt.Notice("Unable to create new file.")}}function gj(n,e){var t;return(t=e[Tn(n,"day")])!=null?t:null}function yj(){let{vault:n}=window.app,{folder:e}=Dd(),t=n.getAbstractFileByPath(Dt.normalizePath(e));if(!t)throw new Jv("Failed to find daily notes folder");let r={};return Dt.Vault.recurseChildren(t,s=>{if(s instanceof Dt.TFile){let i=Cl(s,"day");if(i){let a=Tn(i,"day");r[a]=s}}}),r}var eT=class extends Error{};function vj(){let{moment:n}=window,e=n.localeData()._week.dow,t=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;e;)t.push(t.shift()),e--;return t}function Tj(n){return vj().indexOf(n.toLowerCase())}async function EP(n){let{vault:e}=window.app,{template:t,format:r,folder:s}=xd(),[i,a]=await xl(t),o=n.format(r),l=await _d(s,o);try{let c=await e.create(l,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,f,h,p,m)=>{let g=window.moment(),y=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return f&&y.add(parseInt(h,10),p),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*title\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(d,u,f)=>{let h=Tj(u);return n.weekday(h).format(f.trim())}));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new Dt.Notice("Unable to create new file.")}}function wj(n,e){var t;return(t=e[Tn(n,"week")])!=null?t:null}function bj(){let n={};if(!DP())return n;let{vault:e}=window.app,{folder:t}=xd(),r=e.getAbstractFileByPath(Dt.normalizePath(t));if(!r)throw new eT("Failed to find weekly notes folder");return Dt.Vault.recurseChildren(r,s=>{if(s instanceof Dt.TFile){let i=Cl(s,"week");if(i){let a=Tn(i,"week");n[a]=s}}}),n}var tT=class extends Error{};async function SP(n){let{vault:e}=window.app,{template:t,format:r,folder:s}=Cd(),[i,a]=await xl(t),o=n.format(r),l=await _d(s,o);try{let c=await e.create(l,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,f,h,p,m)=>{let g=window.moment(),y=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return f&&y.add(parseInt(h,10),p),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new Dt.Notice("Unable to create new file.")}}function kj(n,e){var t;return(t=e[Tn(n,"month")])!=null?t:null}function Ej(){let n={};if(!xP())return n;let{vault:e}=window.app,{folder:t}=Cd(),r=e.getAbstractFileByPath(Dt.normalizePath(t));if(!r)throw new tT("Failed to find monthly notes folder");return Dt.Vault.recurseChildren(r,s=>{if(s instanceof Dt.TFile){let i=Cl(s,"month");if(i){let a=Tn(i,"month");n[a]=s}}}),n}var rT=class extends Error{};async function Sj(n){let{vault:e}=window.app,{template:t,format:r,folder:s}=Md(),[i,a]=await xl(t),o=n.format(r),l=await _d(s,o);try{let c=await e.create(l,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,f,h,p,m)=>{let g=window.moment(),y=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return f&&y.add(parseInt(h,10),p),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new Dt.Notice("Unable to create new file.")}}function Dj(n,e){var t;return(t=e[Tn(n,"quarter")])!=null?t:null}function xj(){let n={};if(!CP())return n;let{vault:e}=window.app,{folder:t}=Md(),r=e.getAbstractFileByPath(Dt.normalizePath(t));if(!r)throw new rT("Failed to find quarterly notes folder");return Dt.Vault.recurseChildren(r,s=>{if(s instanceof Dt.TFile){let i=Cl(s,"quarter");if(i){let a=Tn(i,"quarter");n[a]=s}}}),n}var sT=class extends Error{};async function Cj(n){let{vault:e}=window.app,{template:t,format:r,folder:s}=Pd(),[i,a]=await xl(t),o=n.format(r),l=await _d(s,o);try{let c=await e.create(l,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,f,h,p,m)=>{let g=window.moment(),y=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return f&&y.add(parseInt(h,10),p),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new Dt.Notice("Unable to create new file.")}}function Mj(n,e){var t;return(t=e[Tn(n,"year")])!=null?t:null}function Pj(){let n={};if(!MP())return n;let{vault:e}=window.app,{folder:t}=Pd(),r=e.getAbstractFileByPath(Dt.normalizePath(t));if(!r)throw new sT("Failed to find yearly notes folder");return Dt.Vault.recurseChildren(r,s=>{if(s instanceof Dt.TFile){let i=Cl(s,"year");if(i){let a=Tn(i,"year");n[a]=s}}}),n}function _j(){var r,s;let{app:n}=window,e=n.internalPlugins.plugins["daily-notes"];if(e&&e.enabled)return!0;let t=n.plugins.getPlugin("periodic-notes");return t&&((s=(r=t.settings)==null?void 0:r.daily)==null?void 0:s.enabled)}function DP(){var t,r;let{app:n}=window;if(n.plugins.getPlugin("calendar"))return!0;let e=n.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t.weekly)==null?void 0:r.enabled)}function xP(){var t,r;let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t.monthly)==null?void 0:r.enabled)}function CP(){var t,r;let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t.quarterly)==null?void 0:r.enabled)}function MP(){var t,r;let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t.yearly)==null?void 0:r.enabled)}function Aj(n){let e={day:Dd,week:xd,month:Cd,quarter:Md,year:Pd}[n];return e()}function Ij(n,e){return{day:kP,month:SP,week:EP}[n](e)}Re.DEFAULT_DAILY_NOTE_FORMAT=Zv;Re.DEFAULT_MONTHLY_NOTE_FORMAT=gP;Re.DEFAULT_QUARTERLY_NOTE_FORMAT=yP;Re.DEFAULT_WEEKLY_NOTE_FORMAT=Xv;Re.DEFAULT_YEARLY_NOTE_FORMAT=vP;Re.appHasDailyNotesPluginLoaded=_j;Re.appHasMonthlyNotesPluginLoaded=xP;Re.appHasQuarterlyNotesPluginLoaded=CP;Re.appHasWeeklyNotesPluginLoaded=DP;Re.appHasYearlyNotesPluginLoaded=MP;Re.createDailyNote=kP;Re.createMonthlyNote=SP;Re.createPeriodicNote=Ij;Re.createQuarterlyNote=Sj;Re.createWeeklyNote=EP;Re.createYearlyNote=Cj;Re.getAllDailyNotes=yj;Re.getAllMonthlyNotes=Ej;Re.getAllQuarterlyNotes=xj;Re.getAllWeeklyNotes=bj;Re.getAllYearlyNotes=Pj;Re.getDailyNote=gj;Re.getDailyNoteSettings=Dd;Re.getDateFromFile=Cl;Re.getDateFromPath=mj;Re.getDateUID=Tn;Re.getMonthlyNote=kj;Re.getMonthlyNoteSettings=Cd;Re.getPeriodicNoteSettings=Aj;Re.getQuarterlyNote=Dj;Re.getQuarterlyNoteSettings=Md;Re.getTemplateInfo=xl;Re.getWeeklyNote=wj;Re.getWeeklyNoteSettings=xd;Re.getYearlyNote=Mj;Re.getYearlyNoteSettings=Pd});var OP={};st(OP,{DEFAULT_CALENDAR_VIEW_SETTINGS:()=>IP,DEFAULT_FIELD_MAPPING:()=>Vp,DEFAULT_ICS_INTEGRATION_SETTINGS:()=>RP,DEFAULT_PRIORITIES:()=>_P,DEFAULT_PROJECT_AUTOSUGGEST:()=>NP,DEFAULT_SETTINGS:()=>Qr,DEFAULT_STATUSES:()=>PP,DEFAULT_TASK_CREATION_DEFAULTS:()=>AP});var Vp,PP,_P,AP,IP,RP,NP,Qr,$p=v(()=>{Vp={title:"title",status:"status",priority:"priority",due:"due",scheduled:"scheduled",contexts:"contexts",projects:"projects",timeEstimate:"timeEstimate",completedDate:"completedDate",dateCreated:"dateCreated",dateModified:"dateModified",recurrence:"recurrence",archiveTag:"archived",timeEntries:"timeEntries",completeInstances:"complete_instances",pomodoros:"pomodoros",icsEventId:"icsEventId",icsEventTag:"ics_event",reminders:"reminders"},PP=[{id:"none",value:"none",label:"None",color:"#cccccc",isCompleted:!1,order:0,autoArchive:!1,autoArchiveDelay:5},{id:"open",value:"open",label:"Open",color:"#808080",isCompleted:!1,order:1,autoArchive:!1,autoArchiveDelay:5},{id:"in-progress",value:"in-progress",label:"In progress",color:"#0066cc",isCompleted:!1,order:2,autoArchive:!1,autoArchiveDelay:5},{id:"done",value:"done",label:"Done",color:"#00aa00",isCompleted:!0,order:3,autoArchive:!1,autoArchiveDelay:5}],_P=[{id:"none",value:"none",label:"None",color:"#cccccc",weight:0},{id:"low",value:"low",label:"Low",color:"#00aa00",weight:1},{id:"normal",value:"normal",label:"Normal",color:"#ffaa00",weight:2},{id:"high",value:"high",label:"High",color:"#ff0000",weight:3}],AP={defaultContexts:"",defaultTags:"",defaultProjects:"",useParentNoteAsProject:!1,defaultTimeEstimate:0,defaultRecurrence:"none",defaultDueDate:"none",defaultScheduledDate:"today",bodyTemplate:"",useBodyTemplate:!1,defaultReminders:[]},IP={defaultView:"dayGridMonth",customDayCount:3,slotDuration:"00:30:00",slotMinTime:"00:00:00",slotMaxTime:"24:00:00",scrollTime:"08:00:00",firstDay:1,timeFormat:"24",showWeekends:!0,locale:"",defaultShowScheduled:!0,defaultShowDue:!0,defaultShowDueWhenScheduled:!0,defaultShowTimeEntries:!1,defaultShowRecurring:!0,defaultShowICSEvents:!0,enableTimeblocking:!1,defaultShowTimeblocks:!0,nowIndicator:!0,selectMirror:!0,weekNumbers:!1,showTodayHighlight:!0},RP={defaultNoteTemplate:"",defaultNoteFolder:"",icsNoteFilenameFormat:"title",customICSNoteFilenameTemplate:"{title}",enableAutoExport:!1,autoExportPath:"tasknotes-calendar.ics",autoExportInterval:60},NP={enableFuzzy:!1,rows:["{title|n(Title)}","{aliases|n(Aliases)}","{file.path|n(Path)}"],showAdvanced:!1,requiredTags:[],includeFolders:[],propertyKey:"",propertyValue:""},Qr={tasksFolder:"TaskNotes/Tasks",moveArchivedTasks:!1,archiveFolder:"TaskNotes/Archive",taskTag:"task",taskIdentificationMethod:"tag",taskPropertyName:"",taskPropertyValue:"",excludedFolders:"",defaultTaskPriority:"normal",defaultTaskStatus:"open",taskOrgFiltersCollapsed:!1,taskFilenameFormat:"zettel",storeTitleInFilename:!0,customFilenameTemplate:"{title}",taskCreationDefaults:AP,calendarViewSettings:IP,pomodoroWorkDuration:25,pomodoroShortBreakDuration:5,pomodoroLongBreakDuration:15,pomodoroLongBreakInterval:4,pomodoroAutoStartBreaks:!0,pomodoroAutoStartWork:!1,pomodoroNotifications:!0,pomodoroSoundEnabled:!0,pomodoroSoundVolume:50,pomodoroStorageLocation:"plugin",enableTaskLinkOverlay:!0,enableInstantTaskConvert:!0,useDefaultsOnInstantConvert:!0,enableNaturalLanguageInput:!0,nlpDefaultToScheduled:!0,nlpLanguage:"en",statusSuggestionTrigger:"*",singleClickAction:"edit",doubleClickAction:"openNote",projectAutosuggest:NP,inlineTaskConvertFolder:"{{currentNotePath}}",disableNoteIndexing:!1,suggestionDebounceMs:0,fieldMapping:Vp,customStatuses:PP,customPriorities:_P,recurrenceMigrated:!1,showTrackedTasksInStatusBar:!1,autoStopTimeTrackingOnComplete:!0,autoStopTimeTrackingNotification:!1,showProjectSubtasks:!0,showExpandableSubtasks:!0,projectSubtasksPosition:"bottom",subtaskChevronPosition:"right",viewsButtonAlignment:"right",hideCompletedFromOverdue:!0,icsIntegration:RP,savedViews:[],enableNotifications:!0,notificationType:"system",enableAPI:!1,apiPort:8080,apiAuthToken:"",webhooks:[],userFields:[],defaultVisibleProperties:["status","priority","due","scheduled","projects","contexts","tags"],enableBases:!0,maintainDueDateOffsetInRecurring:!1}});function Nj(n){let e=[],t="",r=0;for(;r<n.length;){let s=n[r];if(s==="\\"&&r+1<n.length){t+=n[r+1],r+=2;continue}if(s==="|"){e.push(t.trim()),t="",r++;continue}t+=s,r++}return e.push(t.trim()),e.filter(s=>s.length>0)}function Oj(n){return n.replace(/\\\|/g,"|").replace(/\\\)/g,")")}function ia(n){let e=[];if(!n)return e;let t=/\{([^}]*)\}/g,r,s=0;for(;(r=t.exec(n))!==null;){let a=n.slice(s,r.index);a.length>0&&e.push({property:`literal:${a}`,showName:!1}),s=t.lastIndex;let o=r[1].trim();if(!o)continue;let l=Nj(o);if(l.length===0)continue;let c=l[0];if(!c)throw new Error("Missing property name in token");let d={property:c,showName:!1};for(let u=1;u<l.length;u++){let f=l[u];f==="n"?d.showName=!0:f.startsWith("n(")&&f.endsWith(")")?(d.showName=!0,d.displayName=Oj(f.slice(2,-1))):f==="s"&&(d.searchable=!0)}e.push(d)}let i=n.slice(s);return i.length>0&&e.push({property:`literal:${i}`,showName:!1}),e}var Gp=v(()=>{});function HP(n){return n!=null?n.trim():""}function Lj(n){return n?n.trim():""}function Qp(n){let e=Lj(n==null?void 0:n.propertyKey),t=HP(n==null?void 0:n.propertyValue);return{key:e,value:t,enabled:e.length>0}}function Kp(n,e){if(!e.enabled)return!0;if(!n||typeof n!="object"||!(e.key in n))return!1;let t=n[e.key],r=HP(e.value);if(r.length===0)return t!=null;let s=r.toLowerCase(),i=a=>{if(a==null)return!1;if(Array.isArray(a))return a.some(o=>i(o));if(typeof a=="string")return a.trim().toLowerCase()===s;if(typeof a=="number"||typeof a=="boolean")return String(a).toLowerCase()===s;if(typeof a=="object")try{return JSON.stringify(a).toLowerCase()===s}catch(o){return!1}return String(a).toLowerCase()===s};return i(t)}var oT=v(()=>{});function bn(n){if(n==null)return[];let e=[],t="",r=0,s=null;for(let a=0;a<n.length;a++){let o=n[a],l=n[a+1];if(!s&&o==="["&&l==="["){r++,t+="[[",a++;continue}if(!s&&o==="]"&&l==="]"&&r>0){r--,t+="]]",a++;continue}if(!r&&(o==='"'||o==="'")){s===null?s=o:s===o&&(s=null),t+=o;continue}if(o===","&&r===0&&s===null){let c=t.trim();c&&e.push(c),t="";continue}t+=o}let i=t.trim();return i&&e.push(i),e}var Al=v(()=>{});var $P,YP=v(()=>{$P={code:"en",name:"English",chronoLocale:"en",dateTriggers:{due:["due","deadline","must be done by","by"],scheduled:["scheduled for","start on","begin on","work on","on"]},recurrence:{frequencies:{daily:["daily","every day"],weekly:["weekly","every week"],monthly:["monthly","every month"],yearly:["yearly","annually","every year"]},every:["every"],other:["other"],weekdays:{monday:["monday"],tuesday:["tuesday"],wednesday:["wednesday"],thursday:["thursday"],friday:["friday"],saturday:["saturday"],sunday:["sunday"]},pluralWeekdays:{monday:["mondays"],tuesday:["tuesdays"],wednesday:["wednesdays"],thursday:["thursdays"],friday:["fridays"],saturday:["saturdays"],sunday:["sundays"]},ordinals:{first:["first"],second:["second"],third:["third"],fourth:["fourth"],last:["last"]},periods:{day:["day","days"],week:["week","weeks"],month:["month","months"],year:["year","years"]}},timeEstimate:{hours:["h","hr","hrs","hour","hours"],minutes:["m","min","mins","minute","minutes"]},fallbackStatus:{open:["todo","to do","open"],inProgress:["in progress","in-progress","doing"],done:["done","completed","finished"],cancelled:["cancelled","canceled"],waiting:["waiting","blocked","on hold"]},fallbackPriority:{urgent:["urgent","critical","highest"],high:["high","important"],normal:["medium","normal"],low:["low","minor"]}}});var zP,qP=v(()=>{zP={code:"es",name:"Espa\xF1ol",chronoLocale:"es",dateTriggers:{due:["vence","fecha l\xEDmite","debe terminarse","para el","antes del"],scheduled:["programado para","programado el","comenzar el","empezar el","trabajar en","el"]},recurrence:{frequencies:{daily:["diario","diaria","diariamente","cada d\xEDa","todos los d\xEDas","a diario"],weekly:["semanal","semanalmente","cada semana","todas las semanas","por semana"],monthly:["mensual","mensualmente","cada mes","todos los meses","por mes"],yearly:["anual","anualmente","cada a\xF1o","todos los a\xF1os","por a\xF1o"]},every:["cada","todos los","todas las"],other:["otro","otra"],weekdays:{monday:["lunes"],tuesday:["martes"],wednesday:["mi\xE9rcoles"],thursday:["jueves"],friday:["viernes"],saturday:["s\xE1bado"],sunday:["domingo"]},pluralWeekdays:{monday:["lunes"],tuesday:["martes"],wednesday:["mi\xE9rcoles"],thursday:["jueves"],friday:["viernes"],saturday:["s\xE1bado"],sunday:["domingo"]},ordinals:{first:["primer","primera","primero"],second:["segundo","segunda"],third:["tercer","tercera","tercero"],fourth:["cuarto","cuarta"],last:["\xFAltimo","\xFAltima"]},periods:{day:["d\xEDa","d\xEDas"],week:["semana","semanas"],month:["mes","meses"],year:["a\xF1o","a\xF1os"]}},timeEstimate:{hours:["h","hr","hrs","hora","horas"],minutes:["m","min","mins","minuto","minutos"]},fallbackStatus:{open:["pendiente","por hacer","abierto","todo"],inProgress:["en progreso","en curso","haciendo","trabajando"],done:["hecho","terminado","completado","finalizado"],cancelled:["cancelado","anulado"],waiting:["esperando","bloqueado","en espera"]},fallbackPriority:{urgent:["urgente","cr\xEDtico","cr\xEDtica","m\xE1ximo","m\xE1xima","prioritario","prioritaria"],high:["alto","alta","importante","elevado","elevada"],normal:["medio","media","normal","regular","est\xE1ndar"],low:["bajo","baja","menor","m\xEDnimo","m\xEDnima"]}}});var GP,QP=v(()=>{GP={code:"fr",name:"Fran\xE7ais",chronoLocale:"fr",dateTriggers:{due:["\xE9ch\xE9ance","date limite","doit \xEAtre termin\xE9","pour le","avant le"],scheduled:["programm\xE9 pour","programm\xE9 le","commencer le","d\xE9buter le","travailler sur","le"]},recurrence:{frequencies:{daily:["quotidien","quotidienne","quotidiennement","chaque jour","tous les jours","journalier","journali\xE8re"],weekly:["hebdomadaire","chaque semaine","toutes les semaines","par semaine"],monthly:["mensuel","mensuelle","mensuellement","chaque mois","tous les mois","par mois"],yearly:["annuel","annuelle","annuellement","chaque ann\xE9e","tous les ans","par an","par ann\xE9e"]},every:["chaque","tous les","toutes les"],other:["autre"],weekdays:{monday:["lundi"],tuesday:["mardi"],wednesday:["mercredi"],thursday:["jeudi"],friday:["vendredi"],saturday:["samedi"],sunday:["dimanche"]},pluralWeekdays:{monday:["lundi"],tuesday:["mardi"],wednesday:["mercredi"],thursday:["jeudi"],friday:["vendredi"],saturday:["samedi"],sunday:["dimanche"]},ordinals:{first:["premier","premi\xE8re"],second:["deuxi\xE8me","second","seconde"],third:["troisi\xE8me"],fourth:["quatri\xE8me"],last:["dernier","derni\xE8re"]},periods:{day:["jour","jours"],week:["semaine","semaines"],month:["mois"],year:["an","ans","ann\xE9e","ann\xE9es"]}},timeEstimate:{hours:["h","hr","hrs","heure","heures"],minutes:["m","min","mins","minute","minutes"]},fallbackStatus:{open:["\xE0 faire","ouvert","en attente","todo"],inProgress:["en cours","en progression","en train de faire"],done:["termin\xE9","fini","accompli","fait"],cancelled:["annul\xE9","abandonn\xE9"],waiting:["en attente","bloqu\xE9","suspendu"]},fallbackPriority:{urgent:["urgent","urgente","critique","maximum","prioritaire"],high:["\xE9lev\xE9","\xE9lev\xE9e","haut","haute","important","importante","sup\xE9rieur","sup\xE9rieure"],normal:["moyen","moyenne","normal","normale","standard","r\xE9gulier","r\xE9guli\xE8re"],low:["faible","bas","basse","mineur","mineure","minimum"]}}});var KP,ZP=v(()=>{KP={code:"de",name:"Deutsch",chronoLocale:"de",dateTriggers:{due:["f\xE4llig","termin","abgabe","deadline","bis zum","bis"],scheduled:["geplant f\xFCr","geplant am","beginnen am","anfangen am","arbeiten an","am"]},recurrence:{frequencies:{daily:["t\xE4glich","jeden Tag","alle Tage","tagaus tagein"],weekly:["w\xF6chentlich","jede Woche","alle Wochen"],monthly:["monatlich","jeden Monat","alle Monate"],yearly:["j\xE4hrlich","jedes Jahr","alle Jahre"]},every:["jede","jeden","jedes","alle"],other:["andere","anderen","anderes"],weekdays:{monday:["montag"],tuesday:["dienstag"],wednesday:["mittwoch"],thursday:["donnerstag"],friday:["freitag"],saturday:["samstag"],sunday:["sonntag"]},pluralWeekdays:{monday:["montags"],tuesday:["dienstags"],wednesday:["mittwochs"],thursday:["donnerstags"],friday:["freitags"],saturday:["samstags"],sunday:["sonntags"]},ordinals:{first:["erste","ersten","erster"],second:["zweite","zweiten","zweiter"],third:["dritte","dritten","dritter"],fourth:["vierte","vierten","vierter"],last:["letzte","letzten","letzter"]},periods:{day:["tag","tage"],week:["woche","wochen"],month:["monat","monate"],year:["jahr","jahre"]}},timeEstimate:{hours:["h","std","stunde","stunden"],minutes:["m","min","minute","minuten"]},fallbackStatus:{open:["offen","zu erledigen","ausstehend","todo"],inProgress:["in bearbeitung","wird bearbeitet","l\xE4uft","in arbeit"],done:["erledigt","fertig","abgeschlossen","gemacht"],cancelled:["abgebrochen","storniert","abgesagt"],waiting:["wartend","warten","blockiert","pausiert"]},fallbackPriority:{urgent:["dringend","eilig","kritisch","sofort","h\xF6chste"],high:["hoch","hohe","wichtig","priorit\xE4r"],normal:["normal","mittel","mittlere","standard"],low:["niedrig","niedrige","gering","geringe"]}}});var XP,JP=v(()=>{XP={code:"ru",name:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",chronoLocale:"ru",dateTriggers:{due:["\u0441\u0440\u043E\u043A","\u0434\u0435\u0434\u043B\u0430\u0439\u043D","\u0434\u043E","\u043A","\u0441\u0434\u0430\u0442\u044C \u0434\u043E"],scheduled:["\u0437\u0430\u043F\u043B\u0430\u043D\u0438\u0440\u043E\u0432\u0430\u043D\u043E \u043D\u0430","\u043D\u0430\u0447\u0430\u0442\u044C","\u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u043D\u0430\u0434","\u043D\u0430"]},recurrence:{frequencies:{daily:["\u0435\u0436\u0435\u0434\u043D\u0435\u0432\u043D\u043E","\u043A\u0430\u0436\u0434\u044B\u0439 \u0434\u0435\u043D\u044C","\u0435\u0436\u0435\u0434\u043D\u0435\u0432\u043D\u044B\u0439","\u043A\u0430\u0436\u0434\u043E\u0434\u043D\u0435\u0432\u043D\u044B\u0439"],weekly:["\u0435\u0436\u0435\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u043E","\u043A\u0430\u0436\u0434\u0443\u044E \u043D\u0435\u0434\u0435\u043B\u044E","\u0435\u0436\u0435\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u044B\u0439"],monthly:["\u0435\u0436\u0435\u043C\u0435\u0441\u044F\u0447\u043D\u043E","\u043A\u0430\u0436\u0434\u044B\u0439 \u043C\u0435\u0441\u044F\u0446","\u0435\u0436\u0435\u043C\u0435\u0441\u044F\u0447\u043D\u044B\u0439"],yearly:["\u0435\u0436\u0435\u0433\u043E\u0434\u043D\u043E","\u043A\u0430\u0436\u0434\u044B\u0439 \u0433\u043E\u0434","\u0435\u0436\u0435\u0433\u043E\u0434\u043D\u044B\u0439"]},every:["\u043A\u0430\u0436\u0434\u044B\u0439","\u043A\u0430\u0436\u0434\u0443\u044E","\u043A\u0430\u0436\u0434\u043E\u0435","\u0432\u0441\u0435"],other:["\u0434\u0440\u0443\u0433\u043E\u0439","\u0434\u0440\u0443\u0433\u0443\u044E","\u0434\u0440\u0443\u0433\u043E\u0435"],weekdays:{monday:["\u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A"],tuesday:["\u0432\u0442\u043E\u0440\u043D\u0438\u043A"],wednesday:["\u0441\u0440\u0435\u0434\u0430"],thursday:["\u0447\u0435\u0442\u0432\u0435\u0440\u0433"],friday:["\u043F\u044F\u0442\u043D\u0438\u0446\u0430"],saturday:["\u0441\u0443\u0431\u0431\u043E\u0442\u0430"],sunday:["\u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435"]},pluralWeekdays:{monday:["\u043F\u043E \u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A\u0430\u043C"],tuesday:["\u043F\u043E \u0432\u0442\u043E\u0440\u043D\u0438\u043A\u0430\u043C"],wednesday:["\u043F\u043E \u0441\u0440\u0435\u0434\u0430\u043C"],thursday:["\u043F\u043E \u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0430\u043C"],friday:["\u043F\u043E \u043F\u044F\u0442\u043D\u0438\u0446\u0430\u043C"],saturday:["\u043F\u043E \u0441\u0443\u0431\u0431\u043E\u0442\u0430\u043C"],sunday:["\u043F\u043E \u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u044F\u043C"]},ordinals:{first:["\u043F\u0435\u0440\u0432\u044B\u0439","\u043F\u0435\u0440\u0432\u0430\u044F","\u043F\u0435\u0440\u0432\u043E\u0435"],second:["\u0432\u0442\u043E\u0440\u043E\u0439","\u0432\u0442\u043E\u0440\u0430\u044F","\u0432\u0442\u043E\u0440\u043E\u0435"],third:["\u0442\u0440\u0435\u0442\u0438\u0439","\u0442\u0440\u0435\u0442\u044C\u044F","\u0442\u0440\u0435\u0442\u044C\u0435"],fourth:["\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u044B\u0439","\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0430\u044F","\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0435"],last:["\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0439","\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u044F\u044F","\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u0435"]},periods:{day:["\u0434\u0435\u043D\u044C","\u0434\u043D\u0438"],week:["\u043D\u0435\u0434\u0435\u043B\u044F","\u043D\u0435\u0434\u0435\u043B\u0438"],month:["\u043C\u0435\u0441\u044F\u0446","\u043C\u0435\u0441\u044F\u0446\u044B"],year:["\u0433\u043E\u0434","\u0433\u043E\u0434\u044B"]}},timeEstimate:{hours:["\u0447","\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043E\u0432"],minutes:["\u043C","\u043C\u0438\u043D","\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u044B","\u043C\u0438\u043D\u0443\u0442"]},fallbackStatus:{open:["\u043E\u0442\u043A\u0440\u044B\u0442\u043E","\u043A \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044E","\u043D\u043E\u0432\u043E\u0435","todo"],inProgress:["\u0432 \u0440\u0430\u0431\u043E\u0442\u0435","\u0432\u044B\u043F\u043E\u043B\u043D\u044F\u0435\u0442\u0441\u044F","\u0432 \u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0435"],done:["\u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u043E","\u0433\u043E\u0442\u043E\u0432\u043E","\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043E","\u0441\u0434\u0435\u043B\u0430\u043D\u043E"],cancelled:["\u043E\u0442\u043C\u0435\u043D\u0435\u043D\u043E","\u043E\u0442\u043C\u0435\u043D\u0451\u043D","\u043E\u0442\u043C\u0435\u043D\u0435\u043D\u0430"],waiting:["\u043E\u0436\u0438\u0434\u0430\u043D\u0438\u0435","\u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u043E","\u043D\u0430 \u043F\u0430\u0443\u0437\u0435"]},fallbackPriority:{urgent:["\u0441\u0440\u043E\u0447\u043D\u043E","\u043A\u0440\u0438\u0442\u0438\u0447\u043D\u043E","\u044D\u043A\u0441\u0442\u0440\u0435\u043D\u043D\u043E","\u043D\u0435\u043C\u0435\u0434\u043B\u0435\u043D\u043D\u043E"],high:["\u0432\u044B\u0441\u043E\u043A\u0438\u0439","\u0432\u044B\u0441\u043E\u043A\u0430\u044F","\u0432\u0430\u0436\u043D\u043E","\u043F\u0440\u0438\u043E\u0440\u0438\u0442\u0435\u0442\u043D\u043E"],normal:["\u043D\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u044B\u0439","\u043D\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u0430\u044F","\u0441\u0440\u0435\u0434\u043D\u0438\u0439","\u0441\u0440\u0435\u0434\u043D\u044F\u044F"],low:["\u043D\u0438\u0437\u043A\u0438\u0439","\u043D\u0438\u0437\u043A\u0430\u044F","\u043D\u0435\u0432\u0430\u0436\u043D\u043E","\u043C\u043E\u0436\u043D\u043E \u043F\u043E\u0437\u0436\u0435"]}}});var e_,t_=v(()=>{e_={code:"zh",name:"\u4E2D\u6587",chronoLocale:"zh",dateTriggers:{due:["\u622A\u6B62","\u5230\u671F","\u671F\u9650","\u5728","\u4E4B\u524D"],scheduled:["\u5B89\u6392\u5728","\u8BA1\u5212\u5728","\u5F00\u59CB\u5728","\u5728"]},recurrence:{frequencies:{daily:["\u6BCF\u5929","\u6BCF\u65E5","\u5929\u5929","\u65E5\u5E38"],weekly:["\u6BCF\u5468","\u6BCF\u661F\u671F","\u5468\u5468"],monthly:["\u6BCF\u6708","\u6BCF\u4E2A\u6708","\u6708\u6708"],yearly:["\u6BCF\u5E74","\u5E74\u5E74","\u6BCF\u4E00\u5E74"]},every:["\u6BCF","\u6BCF\u4E2A","\u6BCF\u4E00\u4E2A"],other:["\u5176\u4ED6","\u53E6\u4E00\u4E2A"],weekdays:{monday:["\u5468\u4E00","\u661F\u671F\u4E00","\u793C\u62DC\u4E00"],tuesday:["\u5468\u4E8C","\u661F\u671F\u4E8C","\u793C\u62DC\u4E8C"],wednesday:["\u5468\u4E09","\u661F\u671F\u4E09","\u793C\u62DC\u4E09"],thursday:["\u5468\u56DB","\u661F\u671F\u56DB","\u793C\u62DC\u56DB"],friday:["\u5468\u4E94","\u661F\u671F\u4E94","\u793C\u62DC\u4E94"],saturday:["\u5468\u516D","\u661F\u671F\u516D","\u793C\u62DC\u516D"],sunday:["\u5468\u65E5","\u661F\u671F\u65E5","\u793C\u62DC\u65E5"]},pluralWeekdays:{monday:["\u5468\u4E00","\u661F\u671F\u4E00","\u793C\u62DC\u4E00"],tuesday:["\u5468\u4E8C","\u661F\u671F\u4E8C","\u793C\u62DC\u4E8C"],wednesday:["\u5468\u4E09","\u661F\u671F\u4E09","\u793C\u62DC\u4E09"],thursday:["\u5468\u56DB","\u661F\u671F\u56DB","\u793C\u62DC\u56DB"],friday:["\u5468\u4E94","\u661F\u671F\u4E94","\u793C\u62DC\u4E94"],saturday:["\u5468\u516D","\u661F\u671F\u516D","\u793C\u62DC\u516D"],sunday:["\u5468\u65E5","\u661F\u671F\u65E5","\u793C\u62DC\u65E5"]},ordinals:{first:["\u7B2C\u4E00\u4E2A","\u7B2C\u4E00","\u9996\u4E2A"],second:["\u7B2C\u4E8C\u4E2A","\u7B2C\u4E8C"],third:["\u7B2C\u4E09\u4E2A","\u7B2C\u4E09"],fourth:["\u7B2C\u56DB\u4E2A","\u7B2C\u56DB"],last:["\u6700\u540E\u4E00\u4E2A","\u6700\u540E","\u672B\u5C3E"]},periods:{day:["\u5929","\u65E5"],week:["\u5468","\u661F\u671F","\u793C\u62DC"],month:["\u6708","\u4E2A\u6708"],year:["\u5E74"]}},timeEstimate:{hours:["\u5C0F\u65F6","\u65F6","\u4E2A\u5C0F\u65F6"],minutes:["\u5206\u949F","\u5206","\u4E2A\u5206\u949F"]},fallbackStatus:{open:["\u5F85\u529E","\u672A\u5B8C\u6210","\u5F00\u653E","\u65B0\u5EFA"],inProgress:["\u8FDB\u884C\u4E2D","\u6B63\u5728\u5904\u7406","\u5904\u7406\u4E2D","\u5DE5\u4F5C\u4E2D"],done:["\u5B8C\u6210","\u5DF2\u5B8C\u6210","\u7ED3\u675F","\u641E\u5B9A"],cancelled:["\u53D6\u6D88","\u5DF2\u53D6\u6D88","\u5E9F\u5F03"],waiting:["\u7B49\u5F85","\u6682\u505C","\u963B\u585E","\u5F85\u5B9A"]},fallbackPriority:{urgent:["\u7D27\u6025","\u6025\u8FEB","\u7ACB\u5373","\u9A6C\u4E0A"],high:["\u9AD8","\u91CD\u8981","\u4F18\u5148","\u9AD8\u4F18\u5148\u7EA7"],normal:["\u6B63\u5E38","\u666E\u901A","\u4E2D\u7B49","\u6807\u51C6"],low:["\u4F4E","\u4E0D\u91CD\u8981","\u4F4E\u4F18\u5148\u7EA7","\u6B21\u8981"]}}});var r_,s_=v(()=>{r_={code:"ja",name:"\u65E5\u672C\u8A9E",chronoLocale:"ja",dateTriggers:{due:["\u671F\u9650","\u7DE0\u5207","\u3006\u5207","\u307E\u3067","\u307E\u3067\u306B","\u306B"],scheduled:["\u4E88\u5B9A","\u8A08\u753B","\u958B\u59CB","\u304B\u3089","\u306B\u958B\u59CB","\u3092\u958B\u59CB"]},recurrence:{frequencies:{daily:["\u6BCE\u65E5","\u65E5\u3005","\u6BCE\u65E5\u6BCE\u65E5","\u9023\u65E5"],weekly:["\u6BCE\u9031","\u9031\u6BCE","\u9031\u4E00","\u6BCE\u9031\u6BCE\u9031"],monthly:["\u6BCE\u6708","\u6708\u6BCE","\u6708\u4E00","\u6BCE\u6708\u6BCE\u6708"],yearly:["\u6BCE\u5E74","\u5E74\u6BCE","\u5E74\u4E00","\u6BCE\u5E74\u6BCE\u5E74","\u5E74\u6B21"]},every:["\u6BCE","\u5404","\u5168\u3066"],other:["\u4ED6\u306E","\u5225\u306E","\u7570\u306A\u308B"],weekdays:{monday:["\u6708\u66DC\u65E5","\u6708\u66DC","\u6708","\u3052\u3064\u3088\u3046\u3073"],tuesday:["\u706B\u66DC\u65E5","\u706B\u66DC","\u706B","\u304B\u3088\u3046\u3073"],wednesday:["\u6C34\u66DC\u65E5","\u6C34\u66DC","\u6C34","\u3059\u3044\u3088\u3046\u3073"],thursday:["\u6728\u66DC\u65E5","\u6728\u66DC","\u6728","\u3082\u304F\u3088\u3046\u3073"],friday:["\u91D1\u66DC\u65E5","\u91D1\u66DC","\u91D1","\u304D\u3093\u3088\u3046\u3073"],saturday:["\u571F\u66DC\u65E5","\u571F\u66DC","\u571F","\u3069\u3088\u3046\u3073"],sunday:["\u65E5\u66DC\u65E5","\u65E5\u66DC","\u65E5","\u306B\u3061\u3088\u3046\u3073"]},pluralWeekdays:{monday:["\u6708\u66DC\u65E5","\u6708\u66DC","\u6708","\u3052\u3064\u3088\u3046\u3073"],tuesday:["\u706B\u66DC\u65E5","\u706B\u66DC","\u706B","\u304B\u3088\u3046\u3073"],wednesday:["\u6C34\u66DC\u65E5","\u6C34\u66DC","\u6C34","\u3059\u3044\u3088\u3046\u3073"],thursday:["\u6728\u66DC\u65E5","\u6728\u66DC","\u6728","\u3082\u304F\u3088\u3046\u3073"],friday:["\u91D1\u66DC\u65E5","\u91D1\u66DC","\u91D1","\u304D\u3093\u3088\u3046\u3073"],saturday:["\u571F\u66DC\u65E5","\u571F\u66DC","\u571F","\u3069\u3088\u3046\u3073"],sunday:["\u65E5\u66DC\u65E5","\u65E5\u66DC","\u65E5","\u306B\u3061\u3088\u3046\u3073"]},ordinals:{first:["\u6700\u521D\u306E","\u7B2C\u4E00\u306E","\u4E00\u756A\u76EE\u306E","\u521D\u56DE"],second:["\u4E8C\u756A\u76EE\u306E","\u7B2C\u4E8C\u306E","\u6B21\u306E"],third:["\u4E09\u756A\u76EE\u306E","\u7B2C\u4E09\u306E"],fourth:["\u56DB\u756A\u76EE\u306E","\u7B2C\u56DB\u306E"],last:["\u6700\u5F8C\u306E","\u6700\u7D42\u306E","\u7D42\u308F\u308A\u306E"]},periods:{day:["\u65E5","\u65E5\u9593"],week:["\u9031","\u9031\u9593"],month:["\u6708","\u6708\u9593","\u30F6\u6708"],year:["\u5E74","\u5E74\u9593"]}},timeEstimate:{hours:["\u6642\u9593","\u6642","\u3058\u304B\u3093"],minutes:["\u5206","\u5206\u9593","\u3075\u3093","\u3077\u3093"]},fallbackStatus:{open:["\u672A\u7740\u624B","\u65B0\u898F","\u30AA\u30FC\u30D7\u30F3","\u958B\u59CB\u524D","\u5F85\u6A5F"],inProgress:["\u9032\u884C\u4E2D","\u4F5C\u696D\u4E2D","\u5B9F\u884C\u4E2D","\u51E6\u7406\u4E2D","\u9032\u884C"],done:["\u5B8C\u4E86","\u7D42\u4E86","\u6E08\u307F","\u7D42\u308F\u308A","\u9054\u6210"],cancelled:["\u30AD\u30E3\u30F3\u30BB\u30EB","\u4E2D\u6B62","\u53D6\u6D88","\u5EC3\u6B62","\u505C\u6B62"],waiting:["\u5F85\u6A5F","\u4FDD\u7559","\u30D6\u30ED\u30C3\u30AF","\u4E00\u6642\u505C\u6B62","\u5F85\u3061"]},fallbackPriority:{urgent:["\u7DCA\u6025","\u81F3\u6025","\u6025\u52D9","\u6700\u512A\u5148","\u3059\u3050\u306B"],high:["\u9AD8","\u91CD\u8981","\u512A\u5148","\u9AD8\u512A\u5148\u5EA6","\u91CD\u70B9"],normal:["\u666E\u901A","\u901A\u5E38","\u6A19\u6E96","\u4E00\u822C","\u30CE\u30FC\u30DE\u30EB"],low:["\u4F4E","\u8EFD\u5FAE","\u5F8C\u56DE\u3057","\u4F4E\u512A\u5148\u5EA6","\u4F59\u88D5"]}}});var n_,i_=v(()=>{n_={code:"it",name:"Italiano",chronoLocale:"it",dateTriggers:{due:["scadenza","entro","entro il","deve essere fatto entro","per il","termine"],scheduled:["programmato per","programmato il","iniziare il","lavorare su","il","per"]},recurrence:{frequencies:{daily:["giornaliero","giornaliera","quotidiano","quotidiana","ogni giorno","tutti i giorni","giornalmente"],weekly:["settimanale","ogni settimana","tutte le settimane","settimanalmente","alla settimana"],monthly:["mensile","ogni mese","tutti i mesi","mensilmente","al mese"],yearly:["annuale","ogni anno","tutti gli anni","annualmente","all'anno"]},every:["ogni","tutti i","tutte le"],other:["altro","altra","altri","altre"],weekdays:{monday:["luned\xEC"],tuesday:["marted\xEC"],wednesday:["mercoled\xEC"],thursday:["gioved\xEC"],friday:["venerd\xEC"],saturday:["sabato"],sunday:["domenica"]},pluralWeekdays:{monday:["luned\xEC"],tuesday:["marted\xEC"],wednesday:["mercoled\xEC"],thursday:["gioved\xEC"],friday:["venerd\xEC"],saturday:["sabati"],sunday:["domeniche"]},ordinals:{first:["primo","prima"],second:["secondo","seconda"],third:["terzo","terza"],fourth:["quarto","quarta"],last:["ultimo","ultima"]},periods:{day:["giorno","giorni"],week:["settimana","settimane"],month:["mese","mesi"],year:["anno","anni"]}},timeEstimate:{hours:["h","hr","ore","ora","o"],minutes:["m","min","minuto","minuti"]},fallbackStatus:{open:["da fare","aperto","pendente","todo","in sospeso"],inProgress:["in corso","in progresso","facendo","lavorando"],done:["fatto","completato","finito","terminato","chiuso"],cancelled:["cancellato","annullato","rimosso"],waiting:["in attesa","aspettando","bloccato","fermo"]},fallbackPriority:{urgent:["urgente","critico","critica","massimo","massima","prioritario","prioritaria"],high:["alto","alta","importante","elevato","elevata"],normal:["medio","media","normale","regolare","standard"],low:["basso","bassa","minore","minimo","minima"]}}});var a_,o_=v(()=>{a_={code:"nl",name:"Nederlands",chronoLocale:"nl",dateTriggers:{due:["vervalt op","deadline","moet klaar zijn op","tegen","uiterlijk","voor"],scheduled:["gepland voor","gepland op","beginnen op","werken aan","op","voor"]},recurrence:{frequencies:{daily:["dagelijks","elke dag","alle dagen","per dag"],weekly:["wekelijks","elke week","alle weken","per week"],monthly:["maandelijks","elke maand","alle maanden","per maand"],yearly:["jaarlijks","elk jaar","alle jaren","per jaar"]},every:["elke","alle","iedere"],other:["andere","ander"],weekdays:{monday:["maandag"],tuesday:["dinsdag"],wednesday:["woensdag"],thursday:["donderdag"],friday:["vrijdag"],saturday:["zaterdag"],sunday:["zondag"]},pluralWeekdays:{monday:["maandagen"],tuesday:["dinsdagen"],wednesday:["woensdagen"],thursday:["donderdagen"],friday:["vrijdagen"],saturday:["zaterdagen"],sunday:["zondagen"]},ordinals:{first:["eerste"],second:["tweede"],third:["derde"],fourth:["vierde"],last:["laatste"]},periods:{day:["dag","dagen"],week:["week","weken"],month:["maand","maanden"],year:["jaar","jaren"]}},timeEstimate:{hours:["u","uur","uren","h"],minutes:["m","min","minuut","minuten"]},fallbackStatus:{open:["te doen","open","nog te doen","todo","openstaand"],inProgress:["bezig","in behandeling","aan het werk","lopend","in uitvoering"],done:["klaar","voltooid","gedaan","afgerond","gesloten"],cancelled:["geannuleerd","afgezegd","ingetrokken"],waiting:["wachtend","in de wacht","geblokkeerd","uitgesteld"]},fallbackPriority:{urgent:["urgent","kritiek","hoogste","spoed","direct"],high:["hoog","hoge","belangrijk","belangrijke"],normal:["normaal","normale","gemiddeld","standaard"],low:["laag","lage","klein","kleine","onbelangrijk"]}}});var l_,c_=v(()=>{l_={code:"pt",name:"Portugu\xEAs",chronoLocale:"pt",dateTriggers:{due:["vencimento","prazo","deve estar pronto at\xE9","at\xE9","para","limite"],scheduled:["programado para","agendado para","come\xE7ar em","trabalhar em","em","no"]},recurrence:{frequencies:{daily:["di\xE1rio","di\xE1ria","diariamente","todos os dias","cada dia","por dia"],weekly:["semanal","semanalmente","toda semana","todas as semanas","por semana"],monthly:["mensal","mensalmente","todo m\xEAs","todos os meses","por m\xEAs"],yearly:["anual","anualmente","todo ano","todos os anos","por ano"]},every:["todo","toda","todos","todas","cada"],other:["outro","outra","outros","outras"],weekdays:{monday:["segunda","segunda-feira"],tuesday:["ter\xE7a","ter\xE7a-feira"],wednesday:["quarta","quarta-feira"],thursday:["quinta","quinta-feira"],friday:["sexta","sexta-feira"],saturday:["s\xE1bado"],sunday:["domingo"]},pluralWeekdays:{monday:["segundas","segundas-feiras"],tuesday:["ter\xE7as","ter\xE7as-feiras"],wednesday:["quartas","quartas-feiras"],thursday:["quintas","quintas-feiras"],friday:["sextas","sextas-feiras"],saturday:["s\xE1bados"],sunday:["domingos"]},ordinals:{first:["primeiro","primeira"],second:["segundo","segunda"],third:["terceiro","terceira"],fourth:["quarto","quarta"],last:["\xFAltimo","\xFAltima"]},periods:{day:["dia","dias"],week:["semana","semanas"],month:["m\xEAs","meses"],year:["ano","anos"]}},timeEstimate:{hours:["h","hr","hora","horas"],minutes:["m","min","minuto","minutos"]},fallbackStatus:{open:["a fazer","pendente","aberto","todo","por fazer"],inProgress:["em andamento","em progresso","fazendo","trabalhando","executando"],done:["feito","conclu\xEDdo","terminado","finalizado","completo"],cancelled:["cancelado","anulado","suspenso"],waiting:["aguardando","esperando","bloqueado","em espera"]},fallbackPriority:{urgent:["urgente","cr\xEDtico","cr\xEDtica","m\xE1ximo","m\xE1xima","priorit\xE1rio","priorit\xE1ria"],high:["alto","alta","importante","elevado","elevada"],normal:["m\xE9dio","m\xE9dia","normal","regular","padr\xE3o"],low:["baixo","baixa","menor","m\xEDnimo","m\xEDnima"]}}});var d_,u_=v(()=>{d_={code:"sv",name:"Svenska",chronoLocale:"sv",dateTriggers:{due:["f\xF6rfaller","deadline","m\xE5ste vara klar","senast","till","innan"],scheduled:["schemalagd","planerad f\xF6r","b\xF6rja","arbeta med","den","p\xE5"]},recurrence:{frequencies:{daily:["dagligen","varje dag","alla dagar","per dag"],weekly:["veckovis","varje vecka","alla veckor","per vecka"],monthly:["m\xE5nadsvis","varje m\xE5nad","alla m\xE5nader","per m\xE5nad"],yearly:["\xE5rligen","varje \xE5r","alla \xE5r","per \xE5r"]},every:["varje","alla","var"],other:["annan","annat","andra"],weekdays:{monday:["m\xE5ndag"],tuesday:["tisdag"],wednesday:["onsdag"],thursday:["torsdag"],friday:["fredag"],saturday:["l\xF6rdag"],sunday:["s\xF6ndag"]},pluralWeekdays:{monday:["m\xE5ndagar"],tuesday:["tisdagar"],wednesday:["onsdagar"],thursday:["torsdagar"],friday:["fredagar"],saturday:["l\xF6rdagar"],sunday:["s\xF6ndagar"]},ordinals:{first:["f\xF6rsta"],second:["andra"],third:["tredje"],fourth:["fj\xE4rde"],last:["sista"]},periods:{day:["dag","dagar"],week:["vecka","veckor"],month:["m\xE5nad","m\xE5nader"],year:["\xE5r"]}},timeEstimate:{hours:["t","tim","timme","timmar","h"],minutes:["m","min","minut","minuter"]},fallbackStatus:{open:["att g\xF6ra","\xF6ppen","kvar","todo","v\xE4ntande"],inProgress:["p\xE5g\xE5ende","arbetar","g\xF6r","i process","under arbete"],done:["klar","f\xE4rdig","slutf\xF6rd","avslutad","gjord"],cancelled:["avbruten","inst\xE4lld","avbokad"],waiting:["v\xE4ntar","blockerad","pausad","vilande"]},fallbackPriority:{urgent:["br\xE5dskande","kritisk","h\xF6gsta","akut","omedelbar"],high:["h\xF6g","viktig","f\xF6rh\xF6jd","prioriterad"],normal:["normal","medel","standard","vanlig"],low:["l\xE5g","mindre","minimal","obetydlig"]}}});var h_,f_=v(()=>{h_={code:"uk",name:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",chronoLocale:"uk",dateTriggers:{due:["\u0442\u0435\u0440\u043C\u0456\u043D","\u0434\u0435\u0434\u043B\u0430\u0439\u043D","\u043C\u0430\u0454 \u0431\u0443\u0442\u0438 \u0433\u043E\u0442\u043E\u0432\u043E \u0434\u043E","\u0434\u043E","\u043D\u0435 \u043F\u0456\u0437\u043D\u0456\u0448\u0435","\u043A\u0440\u0430\u0439\u043D\u0456\u0439 \u0442\u0435\u0440\u043C\u0456\u043D"],scheduled:["\u0437\u0430\u043F\u043B\u0430\u043D\u043E\u0432\u0430\u043D\u043E \u043D\u0430","\u0437\u0430\u043F\u043B\u0430\u043D\u043E\u0432\u0430\u043D\u0438\u0439","\u043F\u043E\u0447\u0430\u0442\u0438","\u043F\u0440\u0430\u0446\u044E\u0432\u0430\u0442\u0438 \u043D\u0430\u0434","\u043D\u0430","\u0432"]},recurrence:{frequencies:{daily:["\u0449\u043E\u0434\u043D\u044F","\u0449\u043E\u0434\u0435\u043D\u043D\u043E","\u043A\u043E\u0436\u0435\u043D \u0434\u0435\u043D\u044C","\u0432\u0441\u0456 \u0434\u043D\u0456","\u043D\u0430 \u0434\u0435\u043D\u044C"],weekly:["\u0449\u043E\u0442\u0438\u0436\u043D\u044F","\u0449\u043E\u0442\u0438\u0436\u043D\u0435\u0432\u043E","\u043A\u043E\u0436\u0435\u043D \u0442\u0438\u0436\u0434\u0435\u043D\u044C","\u0432\u0441\u0456 \u0442\u0438\u0436\u043D\u0456","\u043D\u0430 \u0442\u0438\u0436\u0434\u0435\u043D\u044C"],monthly:["\u0449\u043E\u043C\u0456\u0441\u044F\u0446\u044F","\u0449\u043E\u043C\u0456\u0441\u044F\u0447\u043D\u043E","\u043A\u043E\u0436\u0435\u043D \u043C\u0456\u0441\u044F\u0446\u044C","\u0432\u0441\u0456 \u043C\u0456\u0441\u044F\u0446\u0456","\u043D\u0430 \u043C\u0456\u0441\u044F\u0446\u044C"],yearly:["\u0449\u043E\u0440\u043E\u043A\u0443","\u0449\u043E\u0440\u0456\u0447\u043D\u043E","\u043A\u043E\u0436\u0435\u043D \u0440\u0456\u043A","\u0432\u0441\u0456 \u0440\u043E\u043A\u0438","\u043D\u0430 \u0440\u0456\u043A"]},every:["\u043A\u043E\u0436\u0435\u043D","\u043A\u043E\u0436\u043D\u0430","\u043A\u043E\u0436\u043D\u0435","\u0432\u0441\u0456"],other:["\u0456\u043D\u0448\u0438\u0439","\u0456\u043D\u0448\u0430","\u0456\u043D\u0448\u0435","\u0456\u043D\u0448\u0456"],weekdays:{monday:["\u043F\u043E\u043D\u0435\u0434\u0456\u043B\u043E\u043A"],tuesday:["\u0432\u0456\u0432\u0442\u043E\u0440\u043E\u043A"],wednesday:["\u0441\u0435\u0440\u0435\u0434\u0430"],thursday:["\u0447\u0435\u0442\u0432\u0435\u0440"],friday:["\u043F'\u044F\u0442\u043D\u0438\u0446\u044F"],saturday:["\u0441\u0443\u0431\u043E\u0442\u0430"],sunday:["\u043D\u0435\u0434\u0456\u043B\u044F"]},pluralWeekdays:{monday:["\u043F\u043E\u043D\u0435\u0434\u0456\u043B\u043A\u0438"],tuesday:["\u0432\u0456\u0432\u0442\u043E\u0440\u043A\u0438"],wednesday:["\u0441\u0435\u0440\u0435\u0434\u0438"],thursday:["\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0438"],friday:["\u043F'\u044F\u0442\u043D\u0438\u0446\u0456"],saturday:["\u0441\u0443\u0431\u043E\u0442\u0438"],sunday:["\u043D\u0435\u0434\u0456\u043B\u0456"]},ordinals:{first:["\u043F\u0435\u0440\u0448\u0438\u0439","\u043F\u0435\u0440\u0448\u0430","\u043F\u0435\u0440\u0448\u0435"],second:["\u0434\u0440\u0443\u0433\u0438\u0439","\u0434\u0440\u0443\u0433\u0430","\u0434\u0440\u0443\u0433\u0435"],third:["\u0442\u0440\u0435\u0442\u0456\u0439","\u0442\u0440\u0435\u0442\u044F","\u0442\u0440\u0435\u0442\u0454"],fourth:["\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0438\u0439","\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0430","\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0435"],last:["\u043E\u0441\u0442\u0430\u043D\u043D\u0456\u0439","\u043E\u0441\u0442\u0430\u043D\u043D\u044F","\u043E\u0441\u0442\u0430\u043D\u043D\u0454"]},periods:{day:["\u0434\u0435\u043D\u044C","\u0434\u043D\u0456","\u0434\u043D\u0456\u0432"],week:["\u0442\u0438\u0436\u0434\u0435\u043D\u044C","\u0442\u0438\u0436\u043D\u0456","\u0442\u0438\u0436\u043D\u0456\u0432"],month:["\u043C\u0456\u0441\u044F\u0446\u044C","\u043C\u0456\u0441\u044F\u0446\u0456","\u043C\u0456\u0441\u044F\u0446\u0456\u0432"],year:["\u0440\u0456\u043A","\u0440\u043E\u043A\u0438","\u0440\u043E\u043A\u0456\u0432"]}},timeEstimate:{hours:["\u0433","\u0433\u043E\u0434","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0438","\u0433\u043E\u0434\u0438\u043D"],minutes:["\u0445\u0432","\u043C\u0456\u043D","\u0445\u0432\u0438\u043B\u0438\u043D\u0430","\u0445\u0432\u0438\u043B\u0438\u043D\u0438","\u0445\u0432\u0438\u043B\u0438\u043D"]},fallbackStatus:{open:["\u0437\u0440\u043E\u0431\u0438\u0442\u0438","\u0432\u0456\u0434\u043A\u0440\u0438\u0442\u0438\u0439","\u043E\u0447\u0456\u043A\u0443\u0454","todo","\u0432 \u043E\u0447\u0456\u043A\u0443\u0432\u0430\u043D\u043D\u0456"],inProgress:["\u0432 \u0440\u043E\u0431\u043E\u0442\u0456","\u0432\u0438\u043A\u043E\u043D\u0443\u0454\u0442\u044C\u0441\u044F","\u0440\u043E\u0431\u043B\u044E","\u043F\u0440\u0430\u0446\u044E\u044E","\u0432 \u043F\u0440\u043E\u0446\u0435\u0441\u0456"],done:["\u0433\u043E\u0442\u043E\u0432\u043E","\u0432\u0438\u043A\u043E\u043D\u0430\u043D\u043E","\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043E","\u0437\u0430\u043A\u0456\u043D\u0447\u0435\u043D\u043E","\u0437\u0440\u043E\u0431\u043B\u0435\u043D\u043E"],cancelled:["\u0441\u043A\u0430\u0441\u043E\u0432\u0430\u043D\u043E","\u0432\u0456\u0434\u043C\u0456\u043D\u0435\u043D\u043E","\u043F\u0440\u0438\u043F\u0438\u043D\u0435\u043D\u043E"],waiting:["\u0447\u0435\u043A\u0430\u044E","\u043E\u0447\u0456\u043A\u0443\u044E","\u0437\u0430\u0431\u043B\u043E\u043A\u043E\u0432\u0430\u043D\u043E","\u043F\u0440\u0438\u0437\u0443\u043F\u0438\u043D\u0435\u043D\u043E"]},fallbackPriority:{urgent:["\u0442\u0435\u0440\u043C\u0456\u043D\u043E\u0432\u043E","\u043A\u0440\u0438\u0442\u0438\u0447\u043D\u043E","\u043D\u0430\u0439\u0432\u0438\u0449\u0438\u0439","\u043D\u0435\u0432\u0456\u0434\u043A\u043B\u0430\u0434\u043D\u043E","\u043F\u0440\u0456\u043E\u0440\u0438\u0442\u0435\u0442\u043D\u043E"],high:["\u0432\u0438\u0441\u043E\u043A\u0438\u0439","\u0432\u0438\u0441\u043E\u043A\u0430","\u0432\u0430\u0436\u043B\u0438\u0432\u043E","\u043F\u0456\u0434\u0432\u0438\u0449\u0435\u043D\u0438\u0439"],normal:["\u0441\u0435\u0440\u0435\u0434\u043D\u0456\u0439","\u0441\u0435\u0440\u0435\u0434\u043D\u044F","\u043D\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u043E","\u0437\u0432\u0438\u0447\u0430\u0439\u043D\u043E","\u0441\u0442\u0430\u043D\u0434\u0430\u0440\u0442\u043D\u043E"],low:["\u043D\u0438\u0437\u044C\u043A\u0438\u0439","\u043D\u0438\u0437\u044C\u043A\u0430","\u043C\u0435\u043D\u0448\u0438\u0439","\u043C\u0456\u043D\u0456\u043C\u0430\u043B\u044C\u043D\u0438\u0439","\u043D\u0435\u0437\u043D\u0430\u0447\u043D\u0438\u0439"]}}});var p_=v(()=>{});function m_(){return Object.values(hT).map(n=>({value:n.code,label:n.name}))}function g_(n){return hT[n]||hT.en}var hT,fT=v(()=>{YP();qP();QP();ZP();JP();t_();s_();i_();o_();c_();u_();f_();p_();hT={en:$P,es:zP,fr:GP,de:KP,ru:XP,zh:e_,ja:r_,it:n_,nl:a_,pt:l_,sv:d_,uk:h_}});async function aa(n,e){return new pT(n,e).show()}var Jp,pT,em=v(()=>{Jp=require("obsidian"),pT=class extends Jp.Modal{constructor(e,t){super(e),this.options={confirmText:"Confirm",cancelText:"Cancel",isDestructive:!1,...t}}show(){return new Promise(e=>{this.resolve=e,this.open()})}onOpen(){let{contentEl:e}=this;e.empty(),new Jp.Setting(e).setName(this.options.title).setHeading(),e.createEl("p",{text:this.options.message});let t=e.createEl("div",{cls:"modal-button-container"});t.style.display="flex",t.style.gap="10px",t.style.justifyContent="flex-end",t.style.marginTop="20px";let r=t.createEl("button",{text:this.options.cancelText});r.addEventListener("click",()=>{this.resolve(!1),this.close()});let s=t.createEl("button",{text:this.options.confirmText,cls:this.options.isDestructive?"mod-warning":"mod-cta"});this.options.isDestructive&&(s.style.backgroundColor="var(--color-red)",s.style.color="white"),s.addEventListener("click",()=>{this.resolve(!0),this.close()}),r.focus()}onClose(){let{contentEl:e}=this;e.empty(),this.resolve&&this.resolve(!1)}}});var w_={};st(w_,{ADVANCED_CALENDAR_VIEW_TYPE:()=>kn,AGENDA_VIEW_TYPE:()=>Bt,EVENT_DATA_CHANGED:()=>ar,EVENT_DATE_CHANGED:()=>$s,EVENT_DATE_SELECTED:()=>Ti,EVENT_POMODORO_COMPLETE:()=>Od,EVENT_POMODORO_INTERRUPT:()=>Ld,EVENT_POMODORO_START:()=>Nd,EVENT_POMODORO_TICK:()=>Vs,EVENT_TAB_CHANGED:()=>Hj,EVENT_TASK_DELETED:()=>Rd,EVENT_TASK_UPDATED:()=>dt,EVENT_TIMEBLOCKING_TOGGLED:()=>TT,EVENT_TIMEBLOCK_DELETED:()=>Uj,EVENT_TIMEBLOCK_UPDATED:()=>Bj,FILTER_OPERATORS:()=>Fd,FILTER_PROPERTIES:()=>Fl,KANBAN_VIEW_TYPE:()=>ys,MINI_CALENDAR_VIEW_TYPE:()=>uo,NOTES_VIEW_TYPE:()=>Rl,POMODORO_STATS_VIEW_TYPE:()=>Ol,POMODORO_VIEW_TYPE:()=>Nl,STATS_VIEW_TYPE:()=>Ll,SUBTASK_WIDGET_VIEW_TYPE:()=>vT,TASK_LIST_VIEW_TYPE:()=>Zr});var uo,kn,Zr,Rl,Bt,Nl,Ol,Ll,ys,vT,Ti,Hj,ar,dt,Rd,Nd,Od,Ld,Vs,TT,Bj,Uj,$s,Fl,Fd,or=v(()=>{uo="tasknotes-mini-calendar-view",kn="tasknotes-advanced-calendar-view",Zr="tasknotes-task-list-view",Rl="tasknotes-notes-view",Bt="tasknotes-agenda-view",Nl="tasknotes-pomodoro-view",Ol="tasknotes-pomodoro-stats-view",Ll="tasknotes-stats-view",ys="tasknotes-kanban-view",vT="tasknotes-subtask-widget-view",Ti="date-selected",Hj="tab-changed",ar="data-changed",dt="task-updated",Rd="task-deleted",Nd="pomodoro-start",Od="pomodoro-complete",Ld="pomodoro-interrupt",Vs="pomodoro-tick",TT="timeblocking-toggled",Bj="timeblock-updated",Uj="timeblock-deleted",$s="date-changed",Fl=[{id:"title",label:"Title",category:"text",supportedOperators:["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"text"},{id:"path",label:"Path",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"status",label:"Status",category:"select",supportedOperators:["is","is-not","is-empty","is-not-empty"],valueInputType:"select"},{id:"priority",label:"Priority",category:"select",supportedOperators:["is","is-not","is-empty","is-not-empty"],valueInputType:"select"},{id:"tags",label:"Tags",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"contexts",label:"Contexts",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"projects",label:"Projects",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"due",label:"Due Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"scheduled",label:"Scheduled Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"completedDate",label:"Completed Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"file.ctime",label:"Created Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"file.mtime",label:"Modified Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"archived",label:"Archived",category:"boolean",supportedOperators:["is-checked","is-not-checked"],valueInputType:"none"},{id:"timeEstimate",label:"Time Estimate",category:"numeric",supportedOperators:["is","is-not","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal"],valueInputType:"number"},{id:"recurrence",label:"Recurrence",category:"special",supportedOperators:["is-empty","is-not-empty"],valueInputType:"none"},{id:"status.isCompleted",label:"Completed",category:"boolean",supportedOperators:["is-checked","is-not-checked"],valueInputType:"none"}],Fd=[{id:"is",label:"is",requiresValue:!0},{id:"is-not",label:"is not",requiresValue:!0},{id:"contains",label:"contains",requiresValue:!0},{id:"does-not-contain",label:"does not contain",requiresValue:!0},{id:"is-before",label:"is before",requiresValue:!0},{id:"is-after",label:"is after",requiresValue:!0},{id:"is-on-or-before",label:"is on or before",requiresValue:!0},{id:"is-on-or-after",label:"is on or after",requiresValue:!0},{id:"is-empty",label:"is empty",requiresValue:!1},{id:"is-not-empty",label:"is not empty",requiresValue:!1},{id:"is-checked",label:"is checked",requiresValue:!1},{id:"is-not-checked",label:"is not checked",requiresValue:!1},{id:"is-greater-than",label:"is greater than",requiresValue:!0},{id:"is-less-than",label:"is less than",requiresValue:!0},{id:"is-greater-than-or-equal",label:"is equal or greater than",requiresValue:!0},{id:"is-less-than-or-equal",label:"is equal or less than",requiresValue:!0}]});function Ys(n){if(!n){let t=new Error("Date string cannot be empty");throw console.error("Date parsing error:",{dateString:n,error:t.message}),t}let e=n.trim();try{let t=e.match(/^(\d{4}-\d{2}-\d{2})\s+(Mon|Tue|Wed|Thu|Fri|Sat|Sun|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)$/i);if(t){let r=t[1];return Ys(r)}if(e.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(e)){let r=new Error(`Invalid date format - time without date: ${n}`);throw console.warn("Date parsing error - incomplete time format:",{original:n,trimmed:e,error:r.message}),r}if(/^\d{4}-W\d{2}$/.test(e)){let[r,s]=e.split("-W"),i=parseInt(r,10),a=parseInt(s,10);if(isNaN(i)||isNaN(a)){let u=new Error(`Invalid numeric values in ISO week format: ${n}`);throw console.warn("Date parsing error - invalid ISO week numbers:",{original:n,year:r,week:s,yearNum:i,weekNum:a}),u}if(a<1||a>53){let u=new Error(`Invalid week number in ISO week format: ${n} (week must be 1-53)`);throw console.warn("Date parsing error - week number out of range:",{original:n,weekNum:a,error:u.message}),u}let o=new Date(i,0,4),l=o.getDay(),c=new Date(o);c.setDate(o.getDate()-(l===0?6:l-1));let d=new Date(c);if(d.setDate(c.getDate()+(a-1)*7),!Dr(d)){let u=new Error(`Failed to calculate date from ISO week format: ${n}`);throw console.error("Date parsing error - ISO week calculation failed:",{original:n,yearNum:i,weekNum:a,jan4:o.toISOString(),targetWeekMonday:d.toString()}),u}return d}if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}(:\d{2})?/.test(e)){let r=e.replace(" ","T"),s=so(r);if(!Dr(s)){let i=new Error(`Invalid space-separated datetime: ${n}`);throw console.warn("Date parsing error - space-separated datetime invalid:",{original:n,converted:r,error:i.message}),i}return s}if(e.includes("T")||e.includes("Z")||e.match(/[+-]\d{2}:\d{2}$/)){let r=so(e);if(!Dr(r)){let s=new Error(`Invalid timezone-aware date: ${n}`);throw console.warn("Date parsing error - timezone-aware format invalid:",{original:n,trimmed:e,error:s.message}),s}return r}else{let r=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!r){let l=new Error(`Invalid date-only string: ${n} (expected format: yyyy-MM-dd)`);throw console.warn("Date parsing error - date-only format invalid:",{original:n,trimmed:e,expectedFormat:"yyyy-MM-dd",error:l.message}),l}let[,s,i,a]=r,o=new Date(parseInt(s,10),parseInt(i,10)-1,parseInt(a,10));if(!Dr(o)||o.getFullYear()!==parseInt(s,10)||o.getMonth()!==parseInt(i,10)-1||o.getDate()!==parseInt(a,10)){let l=new Error(`Invalid date values: ${n}`);throw console.warn("Date parsing error - invalid date values:",{original:n,year:s,month:i,day:a,error:l.message}),l}return o}}catch(t){if(t instanceof Error&&t.message.includes("Invalid date"))throw t;let r=new Error(`Unexpected error parsing date "${n}": ${t instanceof Error?t.message:String(t)}`);throw console.error("Unexpected date parsing error:",{original:n,trimmed:e,error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),r}}function qe(n){if(!n){let t=new Error("Date string cannot be empty");throw console.error("Date parsing error:",{dateString:n,error:t.message}),t}let e=n.trim();try{let t=e.match(/^(\d{4}-\d{2}-\d{2})\s+(Mon|Tue|Wed|Thu|Fri|Sat|Sun|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)$/i);if(t){let s=t[1];return qe(s)}let r=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r){let[,s,i,a]=r,o=parseInt(s,10),l=parseInt(i,10),c=parseInt(a,10);if(l<1||l>12)throw new Error(`Invalid month in date: ${n}`);if(c<1||c>31)throw new Error(`Invalid day in date: ${n}`);let d=new Date(Date.UTC(o,l-1,c));if(d.getUTCFullYear()!==o||d.getUTCMonth()!==l-1||d.getUTCDate()!==c)throw new Error(`Invalid date values: ${n}`);return d}return Ut(e)}catch(t){let r=new Error(`Failed to parse date to UTC: ${e}`);throw console.error("Date parsing error:",{dateString:n,trimmed:e,error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),r}}function lr(n,e){try{let t=we(n),r=we(e),s=qe(t),i=qe(r);return s.getTime()===i.getTime()}catch(t){return console.error("Error comparing dates:",{date1:n,date2:e,error:t}),!1}}function Bn(n,e){try{let t=we(n),r=we(e),s=qe(t),i=qe(r);return s.getTime()<i.getTime()}catch(t){return console.error("Error comparing dates for before:",{date1:n,date2:e,error:t}),!1}}function qt(){return C(new Date,"yyyy-MM-dd")}function Ge(){let n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate())}function Bl(n){if(!n)throw new Error("Date string cannot be empty");let t=n.trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){let[,r,s,i]=t,a=new Date(parseInt(r,10),parseInt(s,10)-1,parseInt(i,10));if(!Dr(a)||a.getFullYear()!==parseInt(r,10)||a.getMonth()!==parseInt(s,10)-1||a.getDate()!==parseInt(i,10))throw new Error(`Invalid date values: ${n}`);return a}return Ys(n)}function bT(n,e,t){return new Date(n,e,t)}function Hd(n,e,t){return new Date(Date.UTC(n,e,t))}function ho(n){let e=n.getUTCFullYear(),t=n.getUTCMonth(),r=n.getUTCDate();return new Date(e,t,r)}function b_(n){if(!n||n.trim()==="")return!0;try{return Ys(n),!0}catch(e){return!1}}function Hl(n,e){try{let t=Ys(n),r=Br(t,e);return C(r,"yyyy-MM-dd")}catch(t){throw console.error("Error adding days to date string:",{dateString:n,days:e,error:t}),t}}function k_(n,e){try{let t=Ys(n),r=OD(t,e);return C(r,"yyyy-MM-dd")}catch(t){throw console.error("Error adding weeks to date string:",{dateString:n,weeks:e,error:t}),t}}function sm(n){try{return qe(n)}catch(e){throw console.error("Error getting start of day for date string:",{dateString:n,error:e}),e}}function oa(n){if(!n)return!1;try{let e=Bl(n),t=Ge();return kd(e,t)}catch(e){return console.error("Error checking if date is today:",{dateString:n,error:e}),!1}}function Ul(n){return Bn(n,qt())}function Ts(n,e="MMM d, yyyy"){try{let t=Ys(n);return C(t,e)}catch(t){return console.error("Error formatting date for display:",{dateString:n,error:t}),n}}function Ue(){let n=new Date,e=-n.getTimezoneOffset(),t=e>=0?"+":"-",r=h=>String(Math.abs(h)).padStart(2,"0"),s=r(Math.floor(Math.abs(e)/60)),i=r(Math.abs(e)%60),a=n.getFullYear(),o=r(n.getMonth()+1),l=r(n.getDate()),c=r(n.getHours()),d=r(n.getMinutes()),u=r(n.getSeconds()),f=String(n.getMilliseconds()).padStart(3,"0");return`${a}-${o}-${l}T${c}:${d}:${u}.${f}${t}${s}:${i}`}function nm(){let n=new Date,e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${r}`}function kT(n){try{if(!n)throw new Error("Timestamp string cannot be empty");let e=so(n);if(!Dr(e))throw new Error(`Invalid timestamp: ${n}`);return e}catch(e){throw console.error("Error parsing timestamp:",{timestampString:n,error:e}),e}}function ET(n,e,t="24"){if(!n)return n;try{let r=kT(n);return Dr(r)?C(r,e||(t==="12"?"MMM d, yyyy h:mm a":"MMM d, yyyy HH:mm")):n}catch(r){return console.error("Error formatting timestamp for display:",{timestampString:n,error:r}),n}}function zt(n){return n?/T\d{2}:\d{2}/.test(n):!1}function we(n){if(!n)return"";try{if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;let e=n.indexOf("T");if(e>-1)return n.substring(0,e);let t=qe(n);return ue(t)}catch(e){return console.error("Error extracting date part:",{dateString:n,error:e}),n}}function xr(n){if(!n||!zt(n))return null;try{let e=Ys(n);return C(e,"HH:mm")}catch(e){return console.error("Error extracting time part:",{dateString:n,error:e}),null}}function ST(n,e="24"){return Dr(n)?C(n,e==="12"?"h:mm a":"HH:mm"):(console.warn("Invalid date provided to formatTime:",n),"")}function Ur(n,e){if(!n)return"";if(!e)return n;try{let t=n.match(/^(\d{4}-\d{2}-\d{2})$/);if(t)return/^\d{2}:\d{2}$/.test(e)?`${t[1]}T${e}`:(console.warn("Invalid time format, expected HH:mm:",e),n);let r=we(n);return!r||!/^\d{4}-\d{2}-\d{2}$/.test(r)?(console.warn("Invalid date part from dateString:",{dateString:n,datePart:r}),n):/^\d{2}:\d{2}$/.test(e)?`${r}T${e}`:(console.warn("Invalid time format, expected HH:mm:",e),n)}catch(t){return console.error("Error combining date and time:",{dateString:n,timeString:e,error:t}),n}}function jt(n,e={}){if(!n)return"";let{dateFormat:t="MMM d, yyyy",timeFormat:r,showTime:s=!0,userTimeFormat:i="24"}=e,a=r||(i==="12"?"h:mm a":"HH:mm");try{let o=Ys(n);return zt(n)&&s?!t||t.trim()===""?C(o,a):C(o,`${t} ${a}`):!t||t.trim()===""?"":C(o,t)}catch(o){return console.error("Error formatting datetime for display:",{dateString:n,error:o}),n}}function la(n,e){try{let t=qe(n),r=qe(e),s=t,i=r;if(zt(n)){let a=xr(n);if(a){let[o,l]=a.split(":").map(Number);s=new Date(t),s.setUTCHours(o,l,0,0)}}if(zt(e)){let a=xr(e);if(a){let[o,l]=a.split(":").map(Number);i=new Date(r),i.setUTCHours(o,l,0,0)}}return zt(n)&&!zt(e)?(i=new Date(r),i.setUTCHours(23,59,59,999)):!zt(n)&&zt(e)&&(s=new Date(t),s.setUTCHours(23,59,59,999)),s.getTime()<i.getTime()}catch(t){return console.error("Error comparing dates time-aware:",{date1:n,date2:e,error:t}),!1}}function Un(n,e,t){if(!n||t&&e)return!1;try{let r=new Date,s=qe(n);if(zt(n))return jp(s,r);{let i=qe(qt());return jp(s,i)}}catch(r){return console.error("Error checking overdue status:",{dateString:n,error:r}),!1}}function DT(n){if(!n)return!1;try{let e=zt(n)?Ys(n):Bl(n);return kd(e,new Date)}catch(e){return console.error("Error checking if today:",{dateString:n,error:e}),!1}}function im(n,e){if(!n||n.trim()==="")return!0;try{if(!b_(n))return!1;if(e&&e.trim()!==""){if(!/^\d{2}:\d{2}$/.test(e))return!1;let t=Ur(n,e);return b_(t)}return!0}catch(t){return!1}}function E_(n){return Array.isArray(n)?n.filter(e=>{if(typeof e!="string"||!e.trim())return!1;let t=e.trim();if(t.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(t)||!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;try{return Ys(t),!0}catch(r){return console.warn("Invalid complete_instances entry (date parsing failed):",e,r),!1}}).map(e=>e.trim()):[]}function vs(n){try{let e=n.match(/^(\d{4})-(\d{2})-(\d{2})/);if(!e)throw new Error(`Invalid date format for RRULE: ${n}`);let[,t,r,s]=e,i=parseInt(t,10),a=parseInt(r,10),o=parseInt(s,10);if(a<1||a>12)throw new Error(`Invalid month in date: ${n}`);if(o<1||o>31)throw new Error(`Invalid day in date: ${n}`);let l=new Date(Date.UTC(i,a-1,o));if(l.getUTCFullYear()!==i||l.getUTCMonth()!==a-1||l.getUTCDate()!==o)throw new Error(`Invalid date values: ${n}`);return l}catch(e){throw console.error("Error creating UTC date for RRULE:",{dateString:n,error:e}),e}}function wt(n){let e=n.getFullYear(),t=n.getMonth(),r=n.getDate();return new Date(Date.UTC(e,t,r,0,0,0,0))}function Bd(n){try{let e=Ge(),t=wt(e);return n.getUTCFullYear()===t.getUTCFullYear()&&n.getUTCMonth()===t.getUTCMonth()&&n.getUTCDate()===t.getUTCDate()}catch(e){return console.error("Error in isTodayUTC:",e),!1}}function xT(n,e){try{let t=C(n,"yyyy-MM-dd"),r=C(e,"yyyy-MM-dd"),s=vs(t),i=vs(r);return{utcStart:s,utcEnd:i}}catch(t){throw console.error("Error normalizing calendar boundaries to UTC:",{startDate:n,endDate:e,error:t}),t}}function S_(n){try{let e=n.getUTCFullYear(),t=String(n.getUTCMonth()+1).padStart(2,"0"),r=String(n.getUTCDate()).padStart(2,"0");return`${e}-${t}-${r}`}catch(e){return console.error("Error formatting date as UTC string:",{date:n,error:e}),n.toISOString().split("T")[0]}}function ue(n){try{if(!n||!(n instanceof Date)||isNaN(n.getTime()))return console.warn("formatDateForStorage received invalid date:",n),"";let e=n.getUTCFullYear(),t=String(n.getUTCMonth()+1).padStart(2,"0"),r=String(n.getUTCDate()).padStart(2,"0");return`${e}-${t}-${r}`}catch(e){return console.error("Error formatting date for storage:",{date:n,error:e}),""}}function D_(n,e){let t=[],r=ue(n),s=ue(e),i=vs(r),a=vs(s);for(;i<=a;)t.push(new Date(i)),i.setUTCDate(i.getUTCDate()+1);return t}function CT(n,e=1){let t=vs(ue(n)),s=(t.getUTCDay()-e+7)%7,i=new Date(t);return i.setUTCDate(i.getUTCDate()-s),i}function x_(n,e=1){let t=CT(n,e),r=new Date(t);return r.setUTCDate(r.getUTCDate()+6),r}function MT(n){let e=vs(ue(n));return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),1))}function PT(n){let e=vs(ue(n));return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+1,0))}function _T(n){if(!n||typeof n!="string")return!1;let e=n.toLowerCase().trim().replace(/\s+/g," ");return e in wT?!0:[/^in\s+(\d+)\s+(days?)$/,/^(\d+)\s+(days?)\s+ago$/,/^in\s+(\d+)\s+(weeks?)$/,/^(\d+)\s+(weeks?)\s+ago$/].some(r=>r.test(e))}function AT(n){if(typeof n!="string")return!1;let e=n.trim();if(e===""||_T(e))return!0;try{let t=Ys(e);return Dr(t)}catch(t){return!1}}function jl(n){if(!n||typeof n!="string")return n;let e=n.toLowerCase().trim().replace(/\s+/g," ");if(e in wT)try{return wT[e]()}catch(t){return console.error("Error resolving natural language date:",{value:n,error:t}),n}try{let t=e.match(/^in\s+(\d+)\s+(days?)$/);if(t){let r=parseInt(t[1],10);return Hl(qt(),r)}if(t=e.match(/^(\d+)\s+(days?)\s+ago$/),t){let r=parseInt(t[1],10);return Hl(qt(),-r)}if(t=e.match(/^in\s+(\d+)\s+(weeks?)$/),t){let r=parseInt(t[1],10);return k_(qt(),r)}if(t=e.match(/^(\d+)\s+(weeks?)\s+ago$/),t){let r=parseInt(t[1],10);return k_(qt(),-r)}}catch(t){console.error("Error parsing relative natural language date:",{value:n,error:t})}return n}var Ut,wT,Ne=v(()=>{Ft();Ut=Ys;wT={today:()=>qt(),tomorrow:()=>Hl(qt(),1),yesterday:()=>Hl(qt(),-1),"next week":()=>Hl(qt(),7),"last week":()=>Hl(qt(),-7)}});var Ud,Gt,fo=v(()=>{Ud=["MO","TU","WE","TH","FR","SA","SU"],Gt=(function(){function n(e,t){if(t===0)throw new Error("Can't create weekday with n == 0");this.weekday=e,this.n=t}return n.fromStr=function(e){return new n(Ud.indexOf(e))},n.prototype.nth=function(e){return this.n===e?this:new n(this.weekday,e)},n.prototype.equals=function(e){return this.weekday===e.weekday&&this.n===e.n},n.prototype.toString=function(){var e=Ud[this.weekday];return this.n&&(e=(this.n>0?"+":"")+String(this.n)+e),e},n.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},n})()});function po(n,e,t){t===void 0&&(t=" ");var r=String(n);return e=e>>0,r.length>e?String(r):(e=e-r.length,e>t.length&&(t+=je(t,e/t.length)),t.slice(0,e)+String(r))}var ut,ws,IT,gr,zs,je,C_,M_,Cr,am,bs,Wt,Ve,jr=v(()=>{fo();ut=function(n){return n!=null},ws=function(n){return typeof n=="number"},IT=function(n){return typeof n=="string"&&Ud.includes(n)},gr=Array.isArray,zs=function(n,e){e===void 0&&(e=n),arguments.length===1&&(e=n,n=0);for(var t=[],r=n;r<e;r++)t.push(r);return t},je=function(n,e){var t=0,r=[];if(gr(n))for(;t<e;t++)r[t]=[].concat(n);else for(;t<e;t++)r[t]=n;return r},C_=function(n){return gr(n)?n:[n]};M_=function(n,e,t){var r=n.split(e);return t?r.slice(0,t).concat([r.slice(t).join(e)]):r},Cr=function(n,e){var t=n%e;return t*e<0?t+e:t},am=function(n,e){return{div:Math.floor(n/e),mod:Cr(n,e)}},bs=function(n){return!ut(n)||n.length===0},Wt=function(n){return!bs(n)},Ve=function(n,e){return Wt(n)&&n.indexOf(e)!==-1}});var jn,jj,__,om,A_,Wj,Wl,RT,mo,Vj,jd,lm,$j,wi,NT,cm,dm,OT,bi,Vl,Wd,P_,I_,Mr=v(()=>{jr();jn=function(n,e,t,r,s,i){return r===void 0&&(r=0),s===void 0&&(s=0),i===void 0&&(i=0),new Date(Date.UTC(n,e-1,t,r,s,i))},jj=[31,28,31,30,31,30,31,31,30,31,30,31],__=1e3*60*60*24,om=9999,A_=jn(1970,1,1),Wj=[6,0,1,2,3,4,5],Wl=function(n){return n%4===0&&n%100!==0||n%400===0},RT=function(n){return n instanceof Date},mo=function(n){return RT(n)&&!isNaN(n.getTime())},Vj=function(n,e){var t=n.getTime(),r=e.getTime(),s=t-r;return Math.round(s/__)},jd=function(n){return Vj(n,A_)},lm=function(n){return new Date(A_.getTime()+n*__)},$j=function(n){var e=n.getUTCMonth();return e===1&&Wl(n.getUTCFullYear())?29:jj[e]},wi=function(n){return Wj[n.getUTCDay()]},NT=function(n,e){var t=jn(n,e+1,1);return[wi(t),$j(t)]},cm=function(n,e){return e=e||n,new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()))},dm=function(n){var e=new Date(n.getTime());return e},OT=function(n){for(var e=[],t=0;t<n.length;t++)e.push(dm(n[t]));return e},bi=function(n){n.sort(function(e,t){return e.getTime()-t.getTime()})},Vl=function(n,e){e===void 0&&(e=!0);var t=new Date(n);return[po(t.getUTCFullYear().toString(),4,"0"),po(t.getUTCMonth()+1,2,"0"),po(t.getUTCDate(),2,"0"),"T",po(t.getUTCHours(),2,"0"),po(t.getUTCMinutes(),2,"0"),po(t.getUTCSeconds(),2,"0"),e?"Z":""].join("")},Wd=function(n){var e=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,t=e.exec(n);if(!t)throw new Error("Invalid UNTIL value: ".concat(n));return new Date(Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[5],10)||0,parseInt(t[6],10)||0,parseInt(t[7],10)||0))},P_=function(n,e){var t=n.toLocaleString("sv-SE",{timeZone:e});return t.replace(" ","T")+"Z"},I_=function(n,e){var t=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(P_(n,t)),s=new Date(P_(n,e!=null?e:"UTC")),i=s.getTime()-r.getTime();return new Date(n.getTime()-i)}});var Yj,ki,um=v(()=>{Yj=(function(){function n(e,t){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=e,this.args=t,e==="between"?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):e==="before"?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):e==="after"&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))}return n.prototype.accept=function(e){++this.total;var t=this.minDate&&e<this.minDate,r=this.maxDate&&e>this.maxDate;if(this.method==="between"){if(t)return!0;if(r)return!1}else if(this.method==="before"){if(r)return!1}else if(this.method==="after")return t?!0:(this.add(e),!1);return this.add(e)},n.prototype.add=function(e){return this._result.push(e),!0},n.prototype.getValue=function(){var e=this._result;switch(this.method){case"all":case"between":return e;case"before":case"after":default:return e.length?e[e.length-1]:null}},n.prototype.clone=function(){return new n(this.method,this.args)},n})(),ki=Yj});function $l(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");LT(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function K(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var LT,yr,Ei=v(()=>{LT=function(n,e){return LT=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])},LT(n,e)};yr=function(){return yr=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},yr.apply(this,arguments)}});var zj,FT,R_=v(()=>{Ei();um();zj=(function(n){$l(e,n);function e(t,r,s){var i=n.call(this,t,r)||this;return i.iterator=s,i}return e.prototype.add=function(t){return this.iterator(t,this._result.length)?(this._result.push(t),!0):!1},e})(ki),FT=zj});var qj,go,hm=v(()=>{qj={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},go=qj});var N_,Gj,Qj,Kj,Wn,O_=v(()=>{hm();qs();jr();N_=function(n,e){return n.indexOf(e)!==-1},Gj=function(n){return n.toString()},Qj=function(n,e,t){return"".concat(e," ").concat(t,", ").concat(n)},Kj=(function(){function n(e,t,r,s){if(t===void 0&&(t=Gj),r===void 0&&(r=go),s===void 0&&(s=Qj),this.text=[],this.language=r||go,this.gettext=t,this.dateFormatter=s,this.rrule=e,this.options=e.options,this.origOptions=e.origOptions,this.origOptions.bymonthday){var i=[].concat(this.options.bymonthday),a=[].concat(this.options.bynmonthday);i.sort(function(d,u){return d-u}),a.sort(function(d,u){return u-d}),this.bymonthday=i.concat(a),this.bymonthday.length||(this.bymonthday=null)}if(ut(this.origOptions.byweekday)){var o=gr(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],l=String(o);this.byweekday={allWeeks:o.filter(function(d){return!d.n}),someWeeks:o.filter(function(d){return!!d.n}),isWeekdays:l.indexOf("MO")!==-1&&l.indexOf("TU")!==-1&&l.indexOf("WE")!==-1&&l.indexOf("TH")!==-1&&l.indexOf("FR")!==-1&&l.indexOf("SA")===-1&&l.indexOf("SU")===-1,isEveryDay:l.indexOf("MO")!==-1&&l.indexOf("TU")!==-1&&l.indexOf("WE")!==-1&&l.indexOf("TH")!==-1&&l.indexOf("FR")!==-1&&l.indexOf("SA")!==-1&&l.indexOf("SU")!==-1};var c=function(d,u){return d.weekday-u.weekday};this.byweekday.allWeeks.sort(c),this.byweekday.someWeeks.sort(c),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return n.isFullyConvertible=function(e){var t=!0;if(!(e.options.freq in n.IMPLEMENTED)||e.origOptions.until&&e.origOptions.count)return!1;for(var r in e.origOptions){if(N_(["dtstart","tzid","wkst","freq"],r))return!0;if(!N_(n.IMPLEMENTED[e.options.freq],r))return!1}return t},n.prototype.isFullyConvertible=function(){return n.isFullyConvertible(this.rrule)},n.prototype.toString=function(){var e=this.gettext;if(!(this.options.freq in n.IMPLEMENTED))return e("RRule error: Unable to fully convert this rrule to text");if(this.text=[e("every")],this[X.FREQUENCIES[this.options.freq]](),this.options.until){this.add(e("until"));var t=this.options.until;this.add(this.dateFormatter(t.getUTCFullYear(),this.language.monthNames[t.getUTCMonth()],t.getUTCDate()))}else this.options.count&&this.add(e("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?e("times"):e("time"));return this.isFullyConvertible()||this.add(e("(~ approximate)")),this.text.join("")},n.prototype.HOURLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("hours"):e("hour"))},n.prototype.MINUTELY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("minutes"):e("minute"))},n.prototype.DAILY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(this.plural(this.options.interval)?e("days"):e("day")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},n.prototype.WEEKLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?e("weeks"):e("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(e("on")).add(e("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?e("days"):e("day")):(this.options.interval===1&&this.add(e("week")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},n.prototype.MONTHLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(e("months")),this.plural(this.options.interval)&&this.add(e("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("months"):e("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(e("on")).add(e("weekdays")):this.byweekday&&this._byweekday()},n.prototype.YEARLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(e("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("years"):e("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(e("on the")).add(this.list(this.options.byyearday,this.nth,e("and"))).add(e("day")),this.options.byweekno&&this.add(e("in")).add(this.plural(this.options.byweekno.length)?e("weeks"):e("week")).add(this.list(this.options.byweekno,void 0,e("and")))},n.prototype._bymonthday=function(){var e=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,e("or"))).add(e("the")).add(this.list(this.bymonthday,this.nth,e("or"))):this.add(e("on the")).add(this.list(this.bymonthday,this.nth,e("and")))},n.prototype._byweekday=function(){var e=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(e("and")),this.add(e("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,e("and"))))},n.prototype._byhour=function(){var e=this.gettext;this.add(e("at")).add(this.list(this.origOptions.byhour,void 0,e("and")))},n.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},n.prototype.nth=function(e){e=parseInt(e.toString(),10);var t,r=this.gettext;if(e===-1)return r("last");var s=Math.abs(e);switch(s){case 1:case 21:case 31:t=s+r("st");break;case 2:case 22:t=s+r("nd");break;case 3:case 23:t=s+r("rd");break;default:t=s+r("th")}return e<0?t+" "+r("last"):t},n.prototype.monthtext=function(e){return this.language.monthNames[e-1]},n.prototype.weekdaytext=function(e){var t=ws(e)?(e+1)%7:e.getJsWeekday();return(e.n?this.nth(e.n)+" ":"")+this.language.dayNames[t]},n.prototype.plural=function(e){return e%100!==1},n.prototype.add=function(e){return this.text.push(" "),this.text.push(e),this},n.prototype.list=function(e,t,r,s){var i=this;s===void 0&&(s=","),gr(e)||(e=[e]);var a=function(l,c,d){for(var u="",f=0;f<l.length;f++)f!==0&&(f===l.length-1?u+=" "+d+" ":u+=c+" "),u+=l[f];return u};t=t||function(l){return l.toString()};var o=function(l){return t&&t.call(i,l)};return r?a(e.map(o),s,r):e.map(o).join(s+" ")},n})(),Wn=Kj});function Vd(n,e){e===void 0&&(e=go);var t={},r=new Zj(e.tokens);if(!r.start(n))return null;return s(),t;function s(){r.expect("every");var f=r.acceptNumber();if(f&&(t.interval=parseInt(f[0],10)),r.isDone())throw new Error("Unexpected end");switch(r.symbol){case"day(s)":t.freq=X.DAILY,r.nextSymbol()&&(a(),u());break;case"weekday(s)":t.freq=X.WEEKLY,t.byweekday=[X.MO,X.TU,X.WE,X.TH,X.FR],r.nextSymbol(),a(),u();break;case"week(s)":t.freq=X.WEEKLY,r.nextSymbol()&&(i(),a(),u());break;case"hour(s)":t.freq=X.HOURLY,r.nextSymbol()&&(i(),u());break;case"minute(s)":t.freq=X.MINUTELY,r.nextSymbol()&&(i(),u());break;case"month(s)":t.freq=X.MONTHLY,r.nextSymbol()&&(i(),u());break;case"year(s)":t.freq=X.YEARLY,r.nextSymbol()&&(i(),u());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":t.freq=X.WEEKLY;var h=r.symbol.substr(0,2).toUpperCase();if(t.byweekday=[X[h]],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var p=l();if(!p)throw new Error("Unexpected symbol "+r.symbol+", expected weekday");t.byweekday.push(X[p]),r.nextSymbol()}a(),d(),u();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(t.freq=X.YEARLY,t.bymonth=[o()],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var m=o();if(!m)throw new Error("Unexpected symbol "+r.symbol+", expected month");t.bymonth.push(m),r.nextSymbol()}i(),u();break;default:throw new Error("Unknown symbol")}}function i(){var f=r.accept("on"),h=r.accept("the");if(f||h)do{var p=c(),m=l(),g=o();if(p)m?(r.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(X[m].nth(p))):(t.bymonthday||(t.bymonthday=[]),t.bymonthday.push(p),r.accept("day(s)"));else if(m)r.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(X[m]);else if(r.symbol==="weekday(s)")r.nextSymbol(),t.byweekday||(t.byweekday=[X.MO,X.TU,X.WE,X.TH,X.FR]);else if(r.symbol==="week(s)"){r.nextSymbol();var y=r.acceptNumber();if(!y)throw new Error("Unexpected symbol "+r.symbol+", expected week number");for(t.byweekno=[parseInt(y[0],10)];r.accept("comma");){if(y=r.acceptNumber(),!y)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");t.byweekno.push(parseInt(y[0],10))}}else if(g)r.nextSymbol(),t.bymonth||(t.bymonth=[]),t.bymonth.push(g);else return}while(r.accept("comma")||r.accept("the")||r.accept("on"))}function a(){var f=r.accept("at");if(f)do{var h=r.acceptNumber();if(!h)throw new Error("Unexpected symbol "+r.symbol+", expected hour");for(t.byhour=[parseInt(h[0],10)];r.accept("comma");){if(h=r.acceptNumber(),!h)throw new Error("Unexpected symbol "+r.symbol+"; expected hour");t.byhour.push(parseInt(h[0],10))}}while(r.accept("comma")||r.accept("at"))}function o(){switch(r.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function l(){switch(r.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return r.symbol.substr(0,2).toUpperCase();default:return!1}}function c(){switch(r.symbol){case"last":return r.nextSymbol(),-1;case"first":return r.nextSymbol(),1;case"second":return r.nextSymbol(),r.accept("last")?-2:2;case"third":return r.nextSymbol(),r.accept("last")?-3:3;case"nth":var f=parseInt(r.value[1],10);if(f<-366||f>366)throw new Error("Nth out of range: "+f);return r.nextSymbol(),r.accept("last")?-f:f;default:return!1}}function d(){r.accept("on"),r.accept("the");var f=c();if(f)for(t.bymonthday=[f],r.nextSymbol();r.accept("comma");){if(f=c(),!f)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");t.bymonthday.push(f),r.nextSymbol()}}function u(){if(r.symbol==="until"){var f=Date.parse(r.text);if(!f)throw new Error("Cannot parse until date:"+r.text);t.until=new Date(f)}else r.accept("for")&&(t.count=parseInt(r.value[0],10),r.expect("number"))}}var Zj,L_=v(()=>{hm();qs();Zj=(function(){function n(e){this.done=!0,this.rules=e}return n.prototype.start=function(e){return this.text=e,this.done=!1,this.nextSymbol()},n.prototype.isDone=function(){return this.done&&this.symbol===null},n.prototype.nextSymbol=function(){var e,t;this.symbol=null,this.value=null;do{if(this.done)return!1;var r=void 0;e=null;for(var s in this.rules){r=this.rules[s];var i=r.exec(this.text);i&&(e===null||i[0].length>e[0].length)&&(e=i,t=s)}if(e!=null&&(this.text=this.text.substr(e[0].length),this.text===""&&(this.done=!0)),e==null){this.done=!0,this.symbol=null,this.value=null;return}}while(t==="SKIP");return this.symbol=t,this.value=e,!0},n.prototype.accept=function(e){if(this.symbol===e){if(this.value){var t=this.value;return this.nextSymbol(),t}return this.nextSymbol(),!0}return!1},n.prototype.acceptNumber=function(){return this.accept("number")},n.prototype.expect=function(e){if(this.accept(e))return!0;throw new Error("expected "+e+" but found "+this.symbol)},n})()});function $d(n){return n<Oe.HOURLY}var Oe,Si=v(()=>{(function(n){n[n.YEARLY=0]="YEARLY",n[n.MONTHLY=1]="MONTHLY",n[n.WEEKLY=2]="WEEKLY",n[n.DAILY=3]="DAILY",n[n.HOURLY=4]="HOURLY",n[n.MINUTELY=5]="MINUTELY",n[n.SECONDLY=6]="SECONDLY"})(Oe||(Oe={}))});var F_,Yl,H_,B_,U_=v(()=>{O_();L_();qs();Si();hm();F_=function(n,e){return e===void 0&&(e=go),new X(Vd(n,e)||void 0)},Yl=["count","until","interval","byweekday","bymonthday","bymonth"];Wn.IMPLEMENTED=[];Wn.IMPLEMENTED[Oe.HOURLY]=Yl;Wn.IMPLEMENTED[Oe.MINUTELY]=Yl;Wn.IMPLEMENTED[Oe.DAILY]=["byhour"].concat(Yl);Wn.IMPLEMENTED[Oe.WEEKLY]=Yl;Wn.IMPLEMENTED[Oe.MONTHLY]=Yl;Wn.IMPLEMENTED[Oe.YEARLY]=["byweekno","byyearday"].concat(Yl);H_=function(n,e,t,r){return new Wn(n,e,t,r).toString()},B_=Wn.isFullyConvertible});var zl,j_,fm=v(()=>{Ei();Si();jr();Mr();zl=(function(){function n(e,t,r,s){this.hour=e,this.minute=t,this.second=r,this.millisecond=s||0}return n.prototype.getHours=function(){return this.hour},n.prototype.getMinutes=function(){return this.minute},n.prototype.getSeconds=function(){return this.second},n.prototype.getMilliseconds=function(){return this.millisecond},n.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},n})(),j_=(function(n){$l(e,n);function e(t,r,s,i,a,o,l){var c=n.call(this,i,a,o,l)||this;return c.year=t,c.month=r,c.day=s,c}return e.fromDate=function(t){return new this(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.valueOf()%1e3)},e.prototype.getWeekday=function(){return wi(new Date(this.getTime()))},e.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},e.prototype.getDay=function(){return this.day},e.prototype.getMonth=function(){return this.month},e.prototype.getYear=function(){return this.year},e.prototype.addYears=function(t){this.year+=t},e.prototype.addMonths=function(t){if(this.month+=t,this.month>12){var r=Math.floor(this.month/12),s=Cr(this.month,12);this.month=s,this.year+=r,this.month===0&&(this.month=12,--this.year)}},e.prototype.addWeekly=function(t,r){r>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-r))+t*7:this.day+=-(this.getWeekday()-r)+t*7,this.fixDay()},e.prototype.addDaily=function(t){this.day+=t,this.fixDay()},e.prototype.addHours=function(t,r,s){for(r&&(this.hour+=Math.floor((23-this.hour)/t)*t);;){this.hour+=t;var i=am(this.hour,24),a=i.div,o=i.mod;if(a&&(this.hour=o,this.addDaily(a)),bs(s)||Ve(s,this.hour))break}},e.prototype.addMinutes=function(t,r,s,i){for(r&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/t)*t);;){this.minute+=t;var a=am(this.minute,60),o=a.div,l=a.mod;if(o&&(this.minute=l,this.addHours(o,!1,s)),(bs(s)||Ve(s,this.hour))&&(bs(i)||Ve(i,this.minute)))break}},e.prototype.addSeconds=function(t,r,s,i,a){for(r&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/t)*t);;){this.second+=t;var o=am(this.second,60),l=o.div,c=o.mod;if(l&&(this.second=c,this.addMinutes(l,!1,s,i)),(bs(s)||Ve(s,this.hour))&&(bs(i)||Ve(i,this.minute))&&(bs(a)||Ve(a,this.second)))break}},e.prototype.fixDay=function(){if(!(this.day<=28)){var t=NT(this.year,this.month-1)[1];if(!(this.day<=t))for(;this.day>t;){if(this.day-=t,++this.month,this.month===13&&(this.month=1,++this.year,this.year>om))return;t=NT(this.year,this.month-1)[1]}}},e.prototype.add=function(t,r){var s=t.freq,i=t.interval,a=t.wkst,o=t.byhour,l=t.byminute,c=t.bysecond;switch(s){case Oe.YEARLY:return this.addYears(i);case Oe.MONTHLY:return this.addMonths(i);case Oe.WEEKLY:return this.addWeekly(i,a);case Oe.DAILY:return this.addDaily(i);case Oe.HOURLY:return this.addHours(i,r,o);case Oe.MINUTELY:return this.addMinutes(i,r,o,l);case Oe.SECONDLY:return this.addSeconds(i,r,o,l,c)}},e})(zl)});function HT(n){for(var e=[],t=Object.keys(n),r=0,s=t;r<s.length;r++){var i=s[r];Ve($_,i)||e.push(i),RT(n[i])&&!mo(n[i])&&e.push(i)}if(e.length)throw new Error("Invalid options: "+e.join(", "));return yr({},n)}function W_(n){var e=yr(yr({},Yd),HT(n));if(ut(e.byeaster)&&(e.freq=X.YEARLY),!(ut(e.freq)&&X.FREQUENCIES[e.freq]))throw new Error("Invalid frequency: ".concat(e.freq," ").concat(n.freq));if(e.dtstart||(e.dtstart=new Date(new Date().setMilliseconds(0))),ut(e.wkst)?ws(e.wkst)||(e.wkst=e.wkst.weekday):e.wkst=X.MO.weekday,ut(e.bysetpos)){ws(e.bysetpos)&&(e.bysetpos=[e.bysetpos]);for(var t=0;t<e.bysetpos.length;t++){var r=e.bysetpos[t];if(r===0||!(r>=-366&&r<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(e.byweekno||Wt(e.byweekno)||Wt(e.byyearday)||e.bymonthday||Wt(e.bymonthday)||ut(e.byweekday)||ut(e.byeaster)))switch(e.freq){case X.YEARLY:e.bymonth||(e.bymonth=e.dtstart.getUTCMonth()+1),e.bymonthday=e.dtstart.getUTCDate();break;case X.MONTHLY:e.bymonthday=e.dtstart.getUTCDate();break;case X.WEEKLY:e.byweekday=[wi(e.dtstart)];break}if(ut(e.bymonth)&&!gr(e.bymonth)&&(e.bymonth=[e.bymonth]),ut(e.byyearday)&&!gr(e.byyearday)&&ws(e.byyearday)&&(e.byyearday=[e.byyearday]),!ut(e.bymonthday))e.bymonthday=[],e.bynmonthday=[];else if(gr(e.bymonthday)){for(var s=[],i=[],t=0;t<e.bymonthday.length;t++){var r=e.bymonthday[t];r>0?s.push(r):r<0&&i.push(r)}e.bymonthday=s,e.bynmonthday=i}else e.bymonthday<0?(e.bynmonthday=[e.bymonthday],e.bymonthday=[]):(e.bynmonthday=[],e.bymonthday=[e.bymonthday]);if(ut(e.byweekno)&&!gr(e.byweekno)&&(e.byweekno=[e.byweekno]),!ut(e.byweekday))e.bynweekday=null;else if(ws(e.byweekday))e.byweekday=[e.byweekday],e.bynweekday=null;else if(IT(e.byweekday))e.byweekday=[Gt.fromStr(e.byweekday).weekday],e.bynweekday=null;else if(e.byweekday instanceof Gt)!e.byweekday.n||e.freq>X.MONTHLY?(e.byweekday=[e.byweekday.weekday],e.bynweekday=null):(e.bynweekday=[[e.byweekday.weekday,e.byweekday.n]],e.byweekday=null);else{for(var a=[],o=[],t=0;t<e.byweekday.length;t++){var l=e.byweekday[t];if(ws(l)){a.push(l);continue}else if(IT(l)){a.push(Gt.fromStr(l).weekday);continue}!l.n||e.freq>X.MONTHLY?a.push(l.weekday):o.push([l.weekday,l.n])}e.byweekday=Wt(a)?a:null,e.bynweekday=Wt(o)?o:null}return ut(e.byhour)?ws(e.byhour)&&(e.byhour=[e.byhour]):e.byhour=e.freq<X.HOURLY?[e.dtstart.getUTCHours()]:null,ut(e.byminute)?ws(e.byminute)&&(e.byminute=[e.byminute]):e.byminute=e.freq<X.MINUTELY?[e.dtstart.getUTCMinutes()]:null,ut(e.bysecond)?ws(e.bysecond)&&(e.bysecond=[e.bysecond]):e.bysecond=e.freq<X.SECONDLY?[e.dtstart.getUTCSeconds()]:null,{parsedOptions:e}}function V_(n){var e=n.dtstart.getTime()%1e3;if(!$d(n.freq))return[];var t=[];return n.byhour.forEach(function(r){n.byminute.forEach(function(s){n.bysecond.forEach(function(i){t.push(new zl(r,s,i,e))})})}),t}var BT=v(()=>{Ei();Si();jr();qs();Mr();fo();fm()});function qd(n){var e=n.split(`
`).map(Xj).filter(function(t){return t!==null});return yr(yr({},e[0]),e[1])}function zd(n){var e={},t=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(n);if(!t)return e;var r=t[1],s=t[2];return r&&(e.tzid=r),e.dtstart=Wd(s),e}function Xj(n){if(n=n.replace(/^\s+|\s+$/,""),!n.length)return null;var e=/^([A-Z]+?)[:;]/.exec(n.toUpperCase());if(!e)return Y_(n);var t=e[1];switch(t.toUpperCase()){case"RRULE":case"EXRULE":return Y_(n);case"DTSTART":return zd(n);default:throw new Error("Unsupported RFC prop ".concat(t," in ").concat(n))}}function Y_(n){var e=n.replace(/^RRULE:/i,""),t=zd(e),r=n.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return r.forEach(function(s){var i=s.split("="),a=i[0],o=i[1];switch(a.toUpperCase()){case"FREQ":t.freq=Oe[o.toUpperCase()];break;case"WKST":t.wkst=Gs[o.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var l=Jj(o),c=a.toLowerCase();t[c]=l;break;case"BYWEEKDAY":case"BYDAY":t.byweekday=eW(o);break;case"DTSTART":case"TZID":var d=zd(n);t.tzid=d.tzid,t.dtstart=d.dtstart;break;case"UNTIL":t.until=Wd(o);break;case"BYEASTER":t.byeaster=Number(o);break;default:throw new Error("Unknown RRULE property '"+a+"'")}}),t}function Jj(n){if(n.indexOf(",")!==-1){var e=n.split(",");return e.map(z_)}return z_(n)}function z_(n){return/^[+-]?\d+$/.test(n)?Number(n):n}function eW(n){var e=n.split(",");return e.map(function(t){if(t.length===2)return Gs[t];var r=t.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!r||r.length<3)throw new SyntaxError("Invalid weekday string: ".concat(t));var s=Number(r[1]),i=r[2],a=Gs[i].weekday;return new Gt(a,s)})}var UT=v(()=>{Ei();Si();fo();Mr();qs()});var yo,pm=v(()=>{Mr();yo=(function(){function n(e,t){if(isNaN(e.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=e,this.tzid=t}return Object.defineProperty(n.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),n.prototype.toString=function(){var e=Vl(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(e):";TZID=".concat(this.tzid,":").concat(e)},n.prototype.getTime=function(){return this.date.getTime()},n.prototype.rezonedDate=function(){return this.isUTC?this.date:I_(this.date,this.tzid)},n})()});function Gd(n){for(var e=[],t="",r=Object.keys(n),s=Object.keys(Yd),i=0;i<r.length;i++)if(r[i]!=="tzid"&&Ve(s,r[i])){var a=r[i].toUpperCase(),o=n[r[i]],l="";if(!(!ut(o)||gr(o)&&!o.length)){switch(a){case"FREQ":l=X.FREQUENCIES[n.freq];break;case"WKST":ws(o)?l=new Gt(o).toString():l=o.toString();break;case"BYWEEKDAY":a="BYDAY",l=C_(o).map(function(h){return h instanceof Gt?h:gr(h)?new Gt(h[0],h[1]):new Gt(h)}).toString();break;case"DTSTART":t=tW(o,n.tzid);break;case"UNTIL":l=Vl(o,!n.tzid);break;default:if(gr(o)){for(var c=[],d=0;d<o.length;d++)c[d]=String(o[d]);l=c.toString()}else l=String(o)}l&&e.push([a,l])}}var u=e.map(function(h){var p=h[0],m=h[1];return"".concat(p,"=").concat(m.toString())}).join(";"),f="";return u!==""&&(f="RRULE:".concat(u)),[t,f].filter(function(h){return!!h}).join(`
`)}function tW(n,e){return n?"DTSTART"+new yo(new Date(n),e).toString():""}var jT=v(()=>{qs();jr();fo();Mr();pm()});function rW(n,e){return Array.isArray(n)?!Array.isArray(e)||n.length!==e.length?!1:n.every(function(t,r){return t.getTime()===e[r].getTime()}):n instanceof Date?e instanceof Date&&n.getTime()===e.getTime():n===e}var q_,G_=v(()=>{um();Mr();jr();q_=(function(){function n(){this.all=!1,this.before=[],this.after=[],this.between=[]}return n.prototype._cacheAdd=function(e,t,r){t&&(t=t instanceof Date?dm(t):OT(t)),e==="all"?this.all=t:(r._value=t,this[e].push(r))},n.prototype._cacheGet=function(e,t){var r=!1,s=t?Object.keys(t):[],i=function(d){for(var u=0;u<s.length;u++){var f=s[u];if(!rW(t[f],d[f]))return!0}return!1},a=this[e];if(e==="all")r=this.all;else if(gr(a))for(var o=0;o<a.length;o++){var l=a[o];if(!(s.length&&i(l))){r=l._value;break}}if(!r&&this.all){for(var c=new ki(e,t),o=0;o<this.all.length&&c.accept(this.all[o]);o++);r=c.getValue(),this._cacheAdd(e,r,t)}return gr(r)?OT(r):r instanceof Date?dm(r):r},n})()});var Q_,K_,sW,nW,ca,Pr,Z_,X_,iW,aW,da,_r,J_,eA,tA,rA,WT,sA=v(()=>{Ei();jr();Q_=K(K(K(K(K(K(K(K(K(K(K(K(K([],je(1,31),!0),je(2,28),!0),je(3,31),!0),je(4,30),!0),je(5,31),!0),je(6,30),!0),je(7,31),!0),je(8,31),!0),je(9,30),!0),je(10,31),!0),je(11,30),!0),je(12,31),!0),je(1,7),!0),K_=K(K(K(K(K(K(K(K(K(K(K(K(K([],je(1,31),!0),je(2,29),!0),je(3,31),!0),je(4,30),!0),je(5,31),!0),je(6,30),!0),je(7,31),!0),je(8,31),!0),je(9,30),!0),je(10,31),!0),je(11,30),!0),je(12,31),!0),je(1,7),!0),sW=zs(1,29),nW=zs(1,30),ca=zs(1,31),Pr=zs(1,32),Z_=K(K(K(K(K(K(K(K(K(K(K(K(K([],Pr,!0),nW,!0),Pr,!0),ca,!0),Pr,!0),ca,!0),Pr,!0),Pr,!0),ca,!0),Pr,!0),ca,!0),Pr,!0),Pr.slice(0,7),!0),X_=K(K(K(K(K(K(K(K(K(K(K(K(K([],Pr,!0),sW,!0),Pr,!0),ca,!0),Pr,!0),ca,!0),Pr,!0),Pr,!0),ca,!0),Pr,!0),ca,!0),Pr,!0),Pr.slice(0,7),!0),iW=zs(-28,0),aW=zs(-29,0),da=zs(-30,0),_r=zs(-31,0),J_=K(K(K(K(K(K(K(K(K(K(K(K(K([],_r,!0),aW,!0),_r,!0),da,!0),_r,!0),da,!0),_r,!0),_r,!0),da,!0),_r,!0),da,!0),_r,!0),_r.slice(0,7),!0),eA=K(K(K(K(K(K(K(K(K(K(K(K(K([],_r,!0),iW,!0),_r,!0),da,!0),_r,!0),da,!0),_r,!0),_r,!0),da,!0),_r,!0),da,!0),_r,!0),_r.slice(0,7),!0),tA=[0,31,60,91,121,152,182,213,244,274,305,335,366],rA=[0,31,59,90,120,151,181,212,243,273,304,334,365],WT=(function(){for(var n=[],e=0;e<55;e++)n=n.concat(zs(7));return n})()});function nA(n,e){var t=jn(n,1,1),r=Wl(n)?366:365,s=Wl(n+1)?366:365,i=jd(t),a=wi(t),o=yr(yr({yearlen:r,nextyearlen:s,yearordinal:i,yearweekday:a},oW(n)),{wnomask:null});if(bs(e.byweekno))return o;o.wnomask=je(0,r+7);var l,c,d=l=Cr(7-a+e.wkst,7);d>=4?(d=0,c=o.yearlen+Cr(a-e.wkst,7)):c=r-d;for(var u=Math.floor(c/7),f=Cr(c,7),h=Math.floor(u+f/4),p=0;p<e.byweekno.length;p++){var m=e.byweekno[p];if(m<0&&(m+=h+1),m>0&&m<=h){var g=void 0;m>1?(g=d+(m-1)*7,d!==l&&(g-=7-l)):g=d;for(var y=0;y<7&&(o.wnomask[g]=1,g++,o.wdaymask[g]!==e.wkst);y++);}}if(Ve(e.byweekno,1)){var g=d+h*7;if(d!==l&&(g-=7-l),g<r)for(var p=0;p<7&&(o.wnomask[g]=1,g+=1,o.wdaymask[g]!==e.wkst);p++);}if(d){var T=void 0;if(Ve(e.byweekno,-1))T=-1;else{var w=wi(jn(n-1,1,1)),b=Cr(7-w.valueOf()+e.wkst,7),E=Wl(n-1)?366:365,S=void 0;b>=4?(b=0,S=E+Cr(w-e.wkst,7)):S=r-d,T=Math.floor(52+Cr(S,7)/4)}if(Ve(e.byweekno,T))for(var g=0;g<d;g++)o.wnomask[g]=1}return o}function oW(n){var e=Wl(n)?366:365,t=jn(n,1,1),r=wi(t);return e===365?{mmask:Q_,mdaymask:X_,nmdaymask:eA,wdaymask:WT.slice(r),mrange:rA}:{mmask:K_,mdaymask:Z_,nmdaymask:J_,wdaymask:WT.slice(r),mrange:tA}}var iA=v(()=>{Ei();Mr();jr();sA()});function aA(n,e,t,r,s,i){var a={lastyear:n,lastmonth:e,nwdaymask:[]},o=[];if(i.freq===X.YEARLY)if(bs(i.bymonth))o=[[0,t]];else for(var l=0;l<i.bymonth.length;l++)e=i.bymonth[l],o.push(r.slice(e-1,e+1));else i.freq===X.MONTHLY&&(o=[r.slice(e-1,e+1)]);if(bs(o))return a;a.nwdaymask=je(0,t);for(var l=0;l<o.length;l++)for(var c=o[l],d=c[0],u=c[1]-1,f=0;f<i.bynweekday.length;f++){var h=void 0,p=i.bynweekday[f],m=p[0],g=p[1];g<0?(h=u+(g+1)*7,h-=Cr(s[h]-m,7)):(h=d+(g-1)*7,h+=Cr(7-s[h]+m,7)),d<=h&&h<=u&&(a.nwdaymask[h]=1)}return a}var oA=v(()=>{qs();jr()});function lA(n,e){e===void 0&&(e=0);var t=n%19,r=Math.floor(n/100),s=n%100,i=Math.floor(r/4),a=r%4,o=Math.floor((r+8)/25),l=Math.floor((r-o+1)/3),c=Math.floor(19*t+r-i-l+15)%30,d=Math.floor(s/4),u=s%4,f=Math.floor(32+2*a+2*d-c-u)%7,h=Math.floor((t+11*c+22*f)/451),p=Math.floor((c+f-7*h+114)/31),m=(c+f-7*h+114)%31+1,g=Date.UTC(n,p-1,m+e),y=Date.UTC(n,0,1);return[Math.ceil((g-y)/(1e3*60*60*24))]}var cA=v(()=>{});var lW,dA,uA=v(()=>{jr();Si();iA();oA();cA();fm();Mr();lW=(function(){function n(e){this.options=e}return n.prototype.rebuild=function(e,t){var r=this.options;if(e!==this.lastyear&&(this.yearinfo=nA(e,r)),Wt(r.bynweekday)&&(t!==this.lastmonth||e!==this.lastyear)){var s=this.yearinfo,i=s.yearlen,a=s.mrange,o=s.wdaymask;this.monthinfo=aA(e,t,i,a,o,r)}ut(r.byeaster)&&(this.eastermask=lA(e,r.byeaster))},Object.defineProperty(n.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),n.prototype.ydayset=function(){return[zs(this.yearlen),0,this.yearlen]},n.prototype.mdayset=function(e,t){for(var r=this.mrange[t-1],s=this.mrange[t],i=je(null,this.yearlen),a=r;a<s;a++)i[a]=a;return[i,r,s]},n.prototype.wdayset=function(e,t,r){for(var s=je(null,this.yearlen+7),i=jd(jn(e,t,r))-this.yearordinal,a=i,o=0;o<7&&(s[i]=i,++i,this.wdaymask[i]!==this.options.wkst);o++);return[s,a,i]},n.prototype.ddayset=function(e,t,r){var s=je(null,this.yearlen),i=jd(jn(e,t,r))-this.yearordinal;return s[i]=i,[s,i,i+1]},n.prototype.htimeset=function(e,t,r,s){var i=this,a=[];return this.options.byminute.forEach(function(o){a=a.concat(i.mtimeset(e,o,r,s))}),bi(a),a},n.prototype.mtimeset=function(e,t,r,s){var i=this.options.bysecond.map(function(a){return new zl(e,t,a,s)});return bi(i),i},n.prototype.stimeset=function(e,t,r,s){return[new zl(e,t,r,s)]},n.prototype.getdayset=function(e){switch(e){case Oe.YEARLY:return this.ydayset.bind(this);case Oe.MONTHLY:return this.mdayset.bind(this);case Oe.WEEKLY:return this.wdayset.bind(this);case Oe.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},n.prototype.gettimeset=function(e){switch(e){case Oe.HOURLY:return this.htimeset.bind(this);case Oe.MINUTELY:return this.mtimeset.bind(this);case Oe.SECONDLY:return this.stimeset.bind(this)}},n})(),dA=lW});function hA(n,e,t,r,s,i){for(var a=[],o=0;o<n.length;o++){var l=void 0,c=void 0,d=n[o];d<0?(l=Math.floor(d/e.length),c=Cr(d,e.length)):(l=Math.floor((d-1)/e.length),c=Cr(d-1,e.length));for(var u=[],f=t;f<r;f++){var h=i[f];ut(h)&&u.push(h)}var p=void 0;l<0?p=u.slice(l)[0]:p=u[l];var m=e[c],g=lm(s.yearordinal+p),y=cm(g,m);Ve(a,y)||a.push(y)}return bi(a),a}var fA=v(()=>{Mr();jr()});function mm(n,e){var t=e.dtstart,r=e.freq,s=e.interval,i=e.until,a=e.bysetpos,o=e.count;if(o===0||s===0)return Di(n);var l=j_.fromDate(t),c=new dA(e);c.rebuild(l.year,l.month);for(var d=uW(c,l,e);;){var u=c.getdayset(r)(l.year,l.month,l.day),f=u[0],h=u[1],p=u[2],m=dW(f,h,p,c,e);if(Wt(a))for(var g=hA(a,d,h,p,c,f),y=0;y<g.length;y++){var T=g[y];if(i&&T>i)return Di(n);if(T>=t){var w=pA(T,e);if(!n.accept(w)||o&&(--o,!o))return Di(n)}}else for(var y=h;y<p;y++){var b=f[y];if(ut(b))for(var E=lm(c.yearordinal+b),S=0;S<d.length;S++){var D=d[S],T=cm(E,D);if(i&&T>i)return Di(n);if(T>=t){var w=pA(T,e);if(!n.accept(w)||o&&(--o,!o))return Di(n)}}}if(e.interval===0||(l.add(e,m),l.year>om))return Di(n);$d(r)||(d=c.gettimeset(r)(l.hour,l.minute,l.second,0)),c.rebuild(l.year,l.month)}}function cW(n,e,t){var r=t.bymonth,s=t.byweekno,i=t.byweekday,a=t.byeaster,o=t.bymonthday,l=t.bynmonthday,c=t.byyearday;return Wt(r)&&!Ve(r,n.mmask[e])||Wt(s)&&!n.wnomask[e]||Wt(i)&&!Ve(i,n.wdaymask[e])||Wt(n.nwdaymask)&&!n.nwdaymask[e]||a!==null&&!Ve(n.eastermask,e)||(Wt(o)||Wt(l))&&!Ve(o,n.mdaymask[e])&&!Ve(l,n.nmdaymask[e])||Wt(c)&&(e<n.yearlen&&!Ve(c,e+1)&&!Ve(c,-n.yearlen+e)||e>=n.yearlen&&!Ve(c,e+1-n.yearlen)&&!Ve(c,-n.nextyearlen+e-n.yearlen))}function pA(n,e){return new yo(n,e.tzid).rezonedDate()}function Di(n){return n.getValue()}function dW(n,e,t,r,s){for(var i=!1,a=e;a<t;a++){var o=n[a];i=cW(r,o,s),i&&(n[o]=null)}return i}function uW(n,e,t){var r=t.freq,s=t.byhour,i=t.byminute,a=t.bysecond;return $d(r)?V_(t):r>=X.HOURLY&&Wt(s)&&!Ve(s,e.hour)||r>=X.MINUTELY&&Wt(i)&&!Ve(i,e.minute)||r>=X.SECONDLY&&Wt(a)&&!Ve(a,e.second)?[]:n.gettimeset(r)(e.hour,e.minute,e.second,e.millisecond)}var VT=v(()=>{Si();Mr();uA();qs();BT();jr();pm();fA();fm()});var Gs,Yd,$_,X,qs=v(()=>{Mr();um();R_();U_();Si();BT();UT();jT();G_();fo();VT();Gs={MO:new Gt(0),TU:new Gt(1),WE:new Gt(2),TH:new Gt(3),FR:new Gt(4),SA:new Gt(5),SU:new Gt(6)},Yd={freq:Oe.YEARLY,dtstart:null,interval:1,wkst:Gs.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},$_=Object.keys(Yd),X=(function(){function n(e,t){e===void 0&&(e={}),t===void 0&&(t=!1),this._cache=t?null:new q_,this.origOptions=HT(e);var r=W_(e).parsedOptions;this.options=r}return n.parseText=function(e,t){return Vd(e,t)},n.fromText=function(e,t){return F_(e,t)},n.fromString=function(e){return new n(n.parseString(e)||void 0)},n.prototype._iter=function(e){return mm(e,this.options)},n.prototype._cacheGet=function(e,t){return this._cache?this._cache._cacheGet(e,t):!1},n.prototype._cacheAdd=function(e,t,r){if(this._cache)return this._cache._cacheAdd(e,t,r)},n.prototype.all=function(e){if(e)return this._iter(new FT("all",{},e));var t=this._cacheGet("all");return t===!1&&(t=this._iter(new ki("all",{})),this._cacheAdd("all",t)),t},n.prototype.between=function(e,t,r,s){if(r===void 0&&(r=!1),!mo(e)||!mo(t))throw new Error("Invalid date passed in to RRule.between");var i={before:t,after:e,inc:r};if(s)return this._iter(new FT("between",i,s));var a=this._cacheGet("between",i);return a===!1&&(a=this._iter(new ki("between",i)),this._cacheAdd("between",a,i)),a},n.prototype.before=function(e,t){if(t===void 0&&(t=!1),!mo(e))throw new Error("Invalid date passed in to RRule.before");var r={dt:e,inc:t},s=this._cacheGet("before",r);return s===!1&&(s=this._iter(new ki("before",r)),this._cacheAdd("before",s,r)),s},n.prototype.after=function(e,t){if(t===void 0&&(t=!1),!mo(e))throw new Error("Invalid date passed in to RRule.after");var r={dt:e,inc:t},s=this._cacheGet("after",r);return s===!1&&(s=this._iter(new ki("after",r)),this._cacheAdd("after",s,r)),s},n.prototype.count=function(){return this.all().length},n.prototype.toString=function(){return Gd(this.origOptions)},n.prototype.toText=function(e,t,r){return H_(this,e,t,r)},n.prototype.isFullyConvertibleToText=function(){return B_(this)},n.prototype.clone=function(){return new n(this.origOptions)},n.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],n.YEARLY=Oe.YEARLY,n.MONTHLY=Oe.MONTHLY,n.WEEKLY=Oe.WEEKLY,n.DAILY=Oe.DAILY,n.HOURLY=Oe.HOURLY,n.MINUTELY=Oe.MINUTELY,n.SECONDLY=Oe.SECONDLY,n.MO=Gs.MO,n.TU=Gs.TU,n.WE=Gs.WE,n.TH=Gs.TH,n.FR=Gs.FR,n.SA=Gs.SA,n.SU=Gs.SU,n.parseString=qd,n.optionsToString=Gd,n})()});function mA(n,e,t,r,s,i){var a={},o=n.accept;function l(f,h){t.forEach(function(p){p.between(f,h,!0).forEach(function(m){a[Number(m)]=!0})})}s.forEach(function(f){var h=new yo(f,i).rezonedDate();a[Number(h)]=!0}),n.accept=function(f){var h=Number(f);return isNaN(h)?o.call(this,f):!a[h]&&(l(new Date(h-1),new Date(h+1)),!a[h])?(a[h]=!0,o.call(this,f)):!0},n.method==="between"&&(l(n.args.after,n.args.before),n.accept=function(f){var h=Number(f);return a[h]?!0:(a[h]=!0,o.call(this,f))});for(var c=0;c<r.length;c++){var d=new yo(r[c],i).rezonedDate();if(!n.accept(new Date(d.getTime())))break}e.forEach(function(f){mm(n,f.options)});var u=n._result;switch(bi(u),n.method){case"all":case"between":return u;case"before":return u.length&&u[u.length-1]||null;case"after":default:return u.length&&u[0]||null}}var gA=v(()=>{pm();VT();Mr()});function hW(n,e){var t=[],r=[],s=[],i=[],a=zd(n),o=a.dtstart,l=a.tzid,c=yW(n,e.unfold);return c.forEach(function(d){var u;if(d){var f=gW(d),h=f.name,p=f.parms,m=f.value;switch(h.toUpperCase()){case"RRULE":if(p.length)throw new Error("unsupported RRULE parm: ".concat(p.join(",")));t.push(qd(d));break;case"RDATE":var g=(u=/RDATE(?:;TZID=([^:=]+))?/i.exec(d))!==null&&u!==void 0?u:[],y=g[1];y&&!l&&(l=y),r=r.concat(vA(m,p));break;case"EXRULE":if(p.length)throw new Error("unsupported EXRULE parm: ".concat(p.join(",")));s.push(qd(m));break;case"EXDATE":i=i.concat(vA(m,p));break;case"DTSTART":break;default:throw new Error("unsupported property: "+h)}}}),{dtstart:o,tzid:l,rrulevals:t,rdatevals:r,exrulevals:s,exdatevals:i}}function fW(n,e){var t=hW(n,e),r=t.rrulevals,s=t.rdatevals,i=t.exrulevals,a=t.exdatevals,o=t.dtstart,l=t.tzid,c=e.cache===!1;if(e.compatible&&(e.forceset=!0,e.unfold=!0),e.forceset||r.length>1||s.length||i.length||a.length){var d=new zT(c);return d.dtstart(o),d.tzid(l||void 0),r.forEach(function(f){d.rrule(new X($T(f,o,l),c))}),s.forEach(function(f){d.rdate(f)}),i.forEach(function(f){d.exrule(new X($T(f,o,l),c))}),a.forEach(function(f){d.exdate(f)}),e.compatible&&e.dtstart&&d.rdate(o),d}var u=r[0]||{};return new X($T(u,u.dtstart||e.dtstart||o,u.tzid||e.tzid||l),c)}function gm(n,e){return e===void 0&&(e={}),fW(n,pW(e))}function $T(n,e,t){return yr(yr({},n),{dtstart:e,tzid:t})}function pW(n){var e=[],t=Object.keys(n),r=Object.keys(yA);if(t.forEach(function(s){Ve(r,s)||e.push(s)}),e.length)throw new Error("Invalid options: "+e.join(", "));return yr(yr({},yA),n)}function mW(n){if(n.indexOf(":")===-1)return{name:"RRULE",value:n};var e=M_(n,":",1),t=e[0],r=e[1];return{name:t,value:r}}function gW(n){var e=mW(n),t=e.name,r=e.value,s=t.split(";");if(!s)throw new Error("empty property name");return{name:s[0].toUpperCase(),parms:s.slice(1),value:r}}function yW(n,e){if(e===void 0&&(e=!1),n=n&&n.trim(),!n)throw new Error("Invalid empty string");if(!e)return n.split(/\s/);for(var t=n.split(`
`),r=0;r<t.length;){var s=t[r]=t[r].replace(/\s+$/g,"");s?r>0&&s[0]===" "?(t[r-1]+=s.slice(1),t.splice(r,1)):r+=1:t.splice(r,1)}return t}function vW(n){n.forEach(function(e){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(e))throw new Error("unsupported RDATE/EXDATE parm: "+e)})}function vA(n,e){return vW(e),n.split(",").map(function(t){return Wd(t)})}var yA,YT=v(()=>{Ei();qs();qT();Mr();jr();UT();yA={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null}});function TA(n){var e=this;return function(t){if(t!==void 0&&(e["_".concat(n)]=t),e["_".concat(n)]!==void 0)return e["_".concat(n)];for(var r=0;r<e._rrule.length;r++){var s=e._rrule[r].origOptions[n];if(s)return s}}}function wA(n,e){if(!(n instanceof X))throw new TypeError(String(n)+" is not RRule instance");Ve(e.map(String),String(n))||e.push(n)}function bA(n,e){if(!(n instanceof Date))throw new TypeError(String(n)+" is not Date instance");Ve(e.map(Number),Number(n))||(e.push(n),bi(e))}function kA(n,e,t){var r=!t||t.toUpperCase()==="UTC",s=r?"".concat(n,":"):"".concat(n,";TZID=").concat(t,":"),i=e.map(function(a){return Vl(a.valueOf(),r)}).join(",");return"".concat(s).concat(i)}var zT,qT=v(()=>{Ei();qs();Mr();jr();gA();YT();jT();zT=(function(n){$l(e,n);function e(t){t===void 0&&(t=!1);var r=n.call(this,{},t)||this;return r.dtstart=TA.apply(r,["dtstart"]),r.tzid=TA.apply(r,["tzid"]),r._rrule=[],r._rdate=[],r._exrule=[],r._exdate=[],r}return e.prototype._iter=function(t){return mA(t,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},e.prototype.rrule=function(t){wA(t,this._rrule)},e.prototype.exrule=function(t){wA(t,this._exrule)},e.prototype.rdate=function(t){bA(t,this._rdate)},e.prototype.exdate=function(t){bA(t,this._exdate)},e.prototype.rrules=function(){return this._rrule.map(function(t){return gm(t.toString())})},e.prototype.exrules=function(){return this._exrule.map(function(t){return gm(t.toString())})},e.prototype.rdates=function(){return this._rdate.map(function(t){return new Date(t.getTime())})},e.prototype.exdates=function(){return this._exdate.map(function(t){return new Date(t.getTime())})},e.prototype.valueOf=function(){var t=[];return!this._rrule.length&&this._dtstart&&(t=t.concat(Gd({dtstart:this._dtstart}))),this._rrule.forEach(function(r){t=t.concat(r.toString().split(`
`))}),this._exrule.forEach(function(r){t=t.concat(r.toString().split(`
`).map(function(s){return s.replace(/^RRULE:/,"EXRULE:")}).filter(function(s){return!/^DTSTART/.test(s)}))}),this._rdate.length&&t.push(kA("RDATE",this._rdate,this.tzid())),this._exdate.length&&t.push(kA("EXDATE",this._exdate,this.tzid())),t},e.prototype.toString=function(){return this.valueOf().join(`
`)},e.prototype.clone=function(){var t=new e(!!this._cache);return this._rrule.forEach(function(r){return t.rrule(r.clone())}),this._exrule.forEach(function(r){return t.exrule(r.clone())}),this._rdate.forEach(function(r){return t.rdate(new Date(r.getTime()))}),this._exdate.forEach(function(r){return t.exdate(new Date(r.getTime()))}),t},e})(X)});var GT=v(()=>{qs();qT();YT();Si();fo();Mr()});var ql,QT=v(()=>{Ne();ql=class{constructor(e){this.mapping=e}toUserField(e){return this.mapping[e]}normalizeTitle(e){if(typeof e=="string")return e;if(Array.isArray(e))return e.map(t=>String(t)).join(", ");if(e!=null)return typeof e=="object"?"":String(e)}mapFromFrontmatter(e,t,r){var i;if(!e)return{};let s={path:t};if(e[this.mapping.title]!==void 0){let a=e[this.mapping.title],o=this.normalizeTitle(a);o!==void 0&&(s.title=o)}else if(r){let a=(i=t.split("/").pop())==null?void 0:i.replace(".md","");a&&(s.title=a)}if(e[this.mapping.status]!==void 0){let a=e[this.mapping.status];typeof a=="boolean"?s.status=a?"true":"false":s.status=a}if(e[this.mapping.priority]!==void 0&&(s.priority=e[this.mapping.priority]),e[this.mapping.due]!==void 0&&(s.due=e[this.mapping.due]),e[this.mapping.scheduled]!==void 0&&(s.scheduled=e[this.mapping.scheduled]),e[this.mapping.contexts]!==void 0){let a=e[this.mapping.contexts];s.contexts=Array.isArray(a)?a:[a]}if(e[this.mapping.projects]!==void 0){let a=e[this.mapping.projects];s.projects=Array.isArray(a)?a:[a]}if(e[this.mapping.timeEstimate]!==void 0&&(s.timeEstimate=e[this.mapping.timeEstimate]),e[this.mapping.completedDate]!==void 0&&(s.completedDate=e[this.mapping.completedDate]),e[this.mapping.recurrence]!==void 0&&(s.recurrence=e[this.mapping.recurrence]),e[this.mapping.dateCreated]!==void 0&&(s.dateCreated=e[this.mapping.dateCreated]),e[this.mapping.dateModified]!==void 0&&(s.dateModified=e[this.mapping.dateModified]),e[this.mapping.timeEntries]!==void 0){let a=e[this.mapping.timeEntries];s.timeEntries=Array.isArray(a)?a:[]}if(e[this.mapping.completeInstances]!==void 0&&(s.complete_instances=E_(e[this.mapping.completeInstances])),e[this.mapping.icsEventId]!==void 0){let a=e[this.mapping.icsEventId];s.icsEventId=Array.isArray(a)?a:[a]}if(e[this.mapping.reminders]!==void 0){let a=e[this.mapping.reminders];if(Array.isArray(a)){let o=a.filter(l=>l!=null);o.length>0&&(s.reminders=o)}else a!=null&&(s.reminders=[a])}return e.tags&&Array.isArray(e.tags)&&(s.tags=e.tags,s.archived=e.tags.includes(this.mapping.archiveTag)),e.timeEntries!==void 0&&(s.timeEntries=Array.isArray(e.timeEntries)?e.timeEntries:[]),s}mapToFrontmatter(e,t,r){let s={};if(e.title!==void 0&&(s[this.mapping.title]=e.title),r&&delete s[this.mapping.title],e.status!==void 0){let a=e.status.toLowerCase(),o=a==="true"||a==="false"?a==="true":e.status;s[this.mapping.status]=o}e.priority!==void 0&&(s[this.mapping.priority]=e.priority),e.due!==void 0&&(s[this.mapping.due]=e.due),e.scheduled!==void 0&&(s[this.mapping.scheduled]=e.scheduled),e.contexts!==void 0&&(s[this.mapping.contexts]=e.contexts),e.projects!==void 0&&(s[this.mapping.projects]=e.projects),e.timeEstimate!==void 0&&(s[this.mapping.timeEstimate]=e.timeEstimate),e.completedDate!==void 0&&(s[this.mapping.completedDate]=e.completedDate),e.recurrence!==void 0&&(s[this.mapping.recurrence]=e.recurrence),e.dateCreated!==void 0&&(s[this.mapping.dateCreated]=e.dateCreated),e.dateModified!==void 0&&(s[this.mapping.dateModified]=e.dateModified),e.timeEntries!==void 0&&(s[this.mapping.timeEntries]=e.timeEntries),e.complete_instances!==void 0&&(s[this.mapping.completeInstances]=e.complete_instances),e.icsEventId!==void 0&&e.icsEventId.length>0&&(s[this.mapping.icsEventId]=e.icsEventId),e.reminders!==void 0&&e.reminders.length>0&&(s[this.mapping.reminders]=e.reminders);let i=e.tags?[...e.tags]:[];return t&&!i.includes(t)&&i.push(t),e.archived===!0&&!i.includes(this.mapping.archiveTag)?i.push(this.mapping.archiveTag):e.archived===!1&&(i=i.filter(a=>a!==this.mapping.archiveTag)),i.length>0&&(s.tags=i),e.timeEntries!==void 0&&(s.timeEntries=e.timeEntries),s}updateMapping(e){this.mapping=e}getMapping(){return{...this.mapping}}fromUserField(e){for(let[t,r]of Object.entries(this.mapping))if(r===e)return t;return null}static validateMapping(e){let t=[],r=Object.keys(e);for(let a of r)(!e[a]||e[a].trim()==="")&&t.push(`Field "${a}" cannot be empty`);let s=Object.values(e),i=new Set(s);return s.length!==i.size&&t.push("Field mappings must have unique property names"),{valid:t.length===0,errors:t}}}});function ym(n){if(!n.startsWith("---"))return{};let e=n.indexOf("---",3);if(e===-1)return{};let t=n.substring(3,e);try{return(0,vo.parseYaml)(t)||{}}catch(r){return console.error("Error parsing frontmatter:",r),{}}}async function Gl(n,e){try{let r=(0,vo.normalizePath)(e).split("/").filter(i=>i.length>0),s="";for(let i of r)s=s?`${s}/${i}`:i,n.getAbstractFileByPath(s)||await n.createFolder(s)}catch(t){let r=t instanceof Error?t.message:String(t),s=t instanceof Error?t.stack:void 0;console.error("Error creating folder structure:",{error:r,stack:s,folderPath:e,normalizedPath:(0,vo.normalizePath)(e)});let i=new Error(`Failed to create folder "${e}": ${r}`);throw s&&(i.stack=s),i}}function TW(n,e){try{let t=new Date(n),r=new Date(e);if(isNaN(t.getTime())||isNaN(r.getTime()))return console.error("Invalid timestamps for duration calculation:",{startTime:n,endTime:e}),0;if(r<=t)return console.error("End time is not after start time:",{startTime:n,endTime:e}),0;let s=r.getTime()-t.getTime(),i=Math.round(s/(1e3*60));return Math.max(0,i)}catch(t){return console.error("Error calculating duration:",t,{startTime:n,endTime:e}),0}}function En(n){return!n||!Array.isArray(n)?0:n.reduce((e,t)=>{if(!t.startTime||!t.endTime)return e;let r=TW(t.startTime,t.endTime);return e+r},0)}function EA(n){return!n||!Array.isArray(n)?null:n.find(e=>e.startTime&&!e.endTime)||null}function vm(n){if(!n||n===0||isNaN(n))return"0m";let e=Math.floor(n/60),t=n%60;return e===0?`${t}m`:t===0?`${e}h`:`${e}h ${t}m`}function Qs(n){if(n==="none")return"";let e=new Date,t;switch(n){case"today":t=e;break;case"tomorrow":t=new Date(e),t.setDate(e.getDate()+1);break;case"next-week":t=new Date(e),t.setDate(e.getDate()+7);break;default:return""}return C(t,"yyyy-MM-dd")}function Qd(n,e){return n.getUTCFullYear()===e.getUTCFullYear()&&n.getUTCMonth()===e.getUTCMonth()&&n.getUTCDate()===e.getUTCDate()}function SA(n,e,t,r,s,i){var c;let a=n.metadataCache.getFileCache(r),o=a==null?void 0:a.frontmatter;if(o)if(s){let d=s.mapFromFrontmatter(o,t,i);return{title:d.title||"Untitled task",status:d.status||"open",priority:d.priority||"normal",due:d.due,scheduled:d.scheduled,path:t,archived:d.archived||!1,tags:d.tags||[],contexts:d.contexts||[],projects:d.projects||[],recurrence:d.recurrence,complete_instances:d.complete_instances,completedDate:d.completedDate,timeEstimate:d.timeEstimate,timeEntries:d.timeEntries,dateCreated:d.dateCreated,dateModified:d.dateModified,reminders:d.reminders}}else{let u=new ql(Vp).mapFromFrontmatter(o,t,i);return{title:u.title||"Untitled task",status:u.status||"open",priority:u.priority||"normal",due:u.due,scheduled:u.scheduled,path:t,archived:u.archived||!1,tags:u.tags||[],contexts:u.contexts||[],projects:u.projects||[],recurrence:u.recurrence,complete_instances:u.complete_instances,completedDate:u.completedDate,timeEstimate:u.timeEstimate,timeEntries:u.timeEntries,dateCreated:u.dateCreated,dateModified:u.dateModified,reminders:u.reminders}}return{title:((c=t.split("/").pop())==null?void 0:c.replace(".md",""))||"Untitled",status:"open",priority:"normal",path:t,archived:!1,reminders:[]}}function Kd(n,e){if(!n.recurrence)return!0;if(typeof n.recurrence=="string")try{let l,c=n.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(c){let m=c[1];if(m.length===8){let g=parseInt(m.slice(0,4)),y=parseInt(m.slice(4,6))-1,T=parseInt(m.slice(6,8));l=new Date(Date.UTC(g,y,T,0,0,0,0))}else{let g=parseInt(m.slice(0,4)),y=parseInt(m.slice(4,6))-1,T=parseInt(m.slice(6,8)),w=parseInt(m.slice(9,11))||0,b=parseInt(m.slice(11,13))||0,E=parseInt(m.slice(13,15))||0;l=new Date(Date.UTC(g,y,T,w,b,E,0))}}else if(n.scheduled)l=vs(n.scheduled);else if(n.dateCreated)l=vs(n.dateCreated);else return!1;let d=n.recurrence.replace(/DTSTART:[^;]+;?/,""),u=X.parseString(d);u.dtstart=l;let f=new X(u),h=vs(S_(e));return f.between(h,new Date(h.getTime()+1440*60*1e3-1),!0).length>0}catch(l){return console.error("Error evaluating rrule:",l,{task:n.title,recurrence:n.recurrence}),!0}let t=n.recurrence.frequency,r=qe(ue(e)),s=r.getUTCDay(),i=r.getUTCDate(),a=r.getUTCMonth()+1,o=["sun","mon","tue","wed","thu","fri","sat"];switch(t){case"daily":return!0;case"weekly":return(n.recurrence.days_of_week||[]).includes(o[s]);case"monthly":return i===n.recurrence.day_of_month;case"yearly":{if(n.recurrence.month_of_year&&n.recurrence.day_of_month)return i===n.recurrence.day_of_month&&a===n.recurrence.month_of_year;if(n.due)try{let l=qe(n.due);return l.getUTCDate()===i&&l.getUTCMonth()===r.getUTCMonth()}catch(l){return console.error(`Error parsing due date ${n.due}:`,l),!1}return!1}default:return!1}}function Vn(n,e){if(!n.recurrence)return n.status||"open";let t=ue(e);return(Array.isArray(n.complete_instances)?n.complete_instances:[]).includes(t)?"done":"open"}function Zd(n,e,t){if(!n.recurrence)return[];if(typeof n.recurrence=="string")try{let i,a=n.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(a){let f=a[1];if(f.length===8){let h=parseInt(f.slice(0,4)),p=parseInt(f.slice(4,6))-1,m=parseInt(f.slice(6,8));i=new Date(Date.UTC(h,p,m,0,0,0,0))}else{let h=parseInt(f.slice(0,4)),p=parseInt(f.slice(4,6))-1,m=parseInt(f.slice(6,8)),g=parseInt(f.slice(9,11))||0,y=parseInt(f.slice(11,13))||0,T=parseInt(f.slice(13,15))||0;i=new Date(Date.UTC(h,p,m,g,y,T,0))}}else if(n.scheduled)i=vs(n.scheduled);else if(n.dateCreated)i=vs(n.dateCreated);else return[];let o=n.recurrence.replace(/DTSTART:[^;]+;?/,""),l=X.parseString(o);l.dtstart=i;let c=new X(l),d=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)),u=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999));return c.between(d,u,!0)}catch(i){console.error("Error generating recurring instances:",i,{task:n.title,recurrence:n.recurrence})}let r=[],s=new Date(e);for(;s<=t;)Kd(n,s)&&r.push(new Date(s)),s.setUTCDate(s.getUTCDate()+1);return r}function wW(n){if(!n.recurrence)return null;try{let e=qt(),t=qe(e),r=new Date(t.getTime()+365*24*60*60*1e3),s=Zd(n,t,r),i=new Set(n.complete_instances||[]);for(let a of s){let o=ue(a);if(!i.has(o))return a}return null}catch(e){return console.error("Error calculating next uncompleted occurrence:",e,{task:n.title}),null}}function Xd(n,e=!0){let t=wW(n),r=null,s=null,i=null;if(t){if(e)try{let a=n.scheduled?qe(n.scheduled):null,o=n.due?qe(n.due):null;if(a&&o){let l=o.getTime()-a.getTime();t&&(i=new Date(t.getTime()+l))}}catch(a){console.error("Error calculating next due date with offset:",a)}if(n.scheduled&&n.scheduled.includes("T")){let a=n.scheduled.split("T")[1];r=`${ue(t)}T${a}`}else r=ue(t);if(i&&n.due&&n.due.includes("T")){let a=n.due.split("T")[1];s=`${ue(i)}T${a}`}else i&&(s=ue(i))}return{scheduled:r,due:s}}function KT(n){if(!n||!n.frequency)throw new Error("Invalid recurrence object");try{let e={};switch(n.frequency){case"daily":e.freq=X.DAILY;break;case"weekly":if(e.freq=X.WEEKLY,n.days_of_week&&Array.isArray(n.days_of_week)){let r={sun:X.SU,mon:X.MO,tue:X.TU,wed:X.WE,thu:X.TH,fri:X.FR,sat:X.SA};e.byweekday=n.days_of_week.map(s=>r[s.toLowerCase()]).filter(Boolean)}break;case"monthly":e.freq=X.MONTHLY,n.day_of_month&&(e.bymonthday=[n.day_of_month]);break;case"yearly":e.freq=X.YEARLY,n.month_of_year&&(e.bymonth=[n.month_of_year]),n.day_of_month&&(e.bymonthday=[n.day_of_month]);break;default:throw new Error(`Unsupported frequency: ${n.frequency}`)}return new X(e).toString()}catch(e){throw console.error("Error converting legacy recurrence to rrule:",e,{recurrence:n}),e}}function ua(n){if(!n)return"";try{if(typeof n=="string"&&n.includes("FREQ=")){let e=n.replace(/DTSTART:[^;]+;?/,"");return X.fromString(e).toText()}if(typeof n=="object"&&n.frequency){let e=KT(n);return X.fromString(e).toText()}return"rrule"}catch(e){return console.error("Error converting recurrence to display text:",e,{recurrence:n}),"rrule"}}function bW(n){if(!n||typeof n!="object"||!n.id||typeof n.id!="string"||!n.title||typeof n.title!="string"||!n.startTime||typeof n.startTime!="string"||!n.endTime||typeof n.endTime!="string")return!1;let e=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;if(!e.test(n.startTime)||!e.test(n.endTime))return!1;let[t,r]=n.startTime.split(":").map(Number),[s,i]=n.endTime.split(":").map(Number),a=t*60+r;if(s*60+i<=a||n.attachments&&!Array.isArray(n.attachments))return!1;if(n.attachments){for(let l of n.attachments)if(typeof l!="string"||!l.trim())return!1}return!(n.color&&typeof n.color!="string"||n.description&&typeof n.description!="string")}function ZT(n,e){try{let t=ym(n);if(!t||!t.timeblocks||!Array.isArray(t.timeblocks))return[];let r=[];for(let s of t.timeblocks)bW(s)?r.push(s):console.warn(`Invalid timeblock in ${e}:`,s);return r}catch(t){return console.error(`Error extracting timeblocks from ${e}:`,t),[]}}function DA(n,e){let t=`${e}T${n.startTime}:00`,r=`${e}T${n.endTime}:00`;return{id:`timeblock-${n.id}`,title:n.title,start:t,end:r,allDay:!1,backgroundColor:n.color||"#6366f1",borderColor:n.color||"#4f46e5",editable:!0,eventType:"timeblock",extendedProps:{type:"timeblock",eventType:"timeblock",timeblock:n,originalDate:e,description:n.description,attachments:n.attachments||[]}}}function xA(){return`tb-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}async function XT(n,e,t,r,s,i){let{getDailyNote:a,getAllDailyNotes:o,appHasDailyNotesPluginLoaded:l}=await Promise.resolve().then(()=>Ee(wn()));if(!l())throw new Error("Daily Notes plugin is not enabled");let c=o(),d=window.moment(t),u=a(d,c);if(!u)throw new Error(`Daily note for ${t} not found`);let f=await n.vault.read(u),h=ZT(f,u.path),p=h.findIndex(y=>y.id===e);if(p===-1)throw new Error(`Timeblock ${e} not found`);let m=h[p];if(t===r){await kW(n,u,e,s,i);return}await EW(n,u,e);let g={...m,startTime:s,endTime:i};await SW(n,r,g)}async function kW(n,e,t,r,s){let i=await n.vault.read(e),a=ym(i)||{};if(!a.timeblocks||!Array.isArray(a.timeblocks))throw new Error("No timeblocks found in frontmatter");let o=a.timeblocks.findIndex(l=>l.id===t);if(o===-1)throw new Error(`Timeblock ${t} not found`);a.timeblocks[o].startTime=r,a.timeblocks[o].endTime=s,await JT(n,e,a,i)}async function EW(n,e,t){let r=await n.vault.read(e),s=ym(r)||{};!s.timeblocks||!Array.isArray(s.timeblocks)||(s.timeblocks=s.timeblocks.filter(i=>i.id!==t),await JT(n,e,s,r))}async function SW(n,e,t){let{createDailyNote:r,getDailyNote:s,getAllDailyNotes:i}=await Promise.resolve().then(()=>Ee(wn())),a=window.moment(e),o=i(),l=s(a,o);if(!l&&(l=await r(a),!l))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let c=await n.vault.read(l),d=ym(c)||{};d.timeblocks||(d.timeblocks=[]),d.timeblocks.push(t),await JT(n,l,d,c)}async function JT(n,e,t,r){let s=r;if(r.startsWith("---")){let o=r.indexOf("---",3);o!==-1&&(s=r.substring(o+3))}let a=`---
${(0,vo.stringifyYaml)(t)}---${s}`;await n.vault.modify(e,a)}function Xr(n){return!n||!Array.isArray(n)?[]:n.filter(e=>{if(typeof e!="string")return!1;let t=e.trim();return!(t.length===0||t==='""'||t==="''")})}function Jd(n){if(!n.recurrence||typeof n.recurrence!="string")return null;if(n.recurrence.includes("DTSTART:"))return n.recurrence;let e;if(n.scheduled)e=n.scheduled;else if(n.dateCreated)e=n.dateCreated;else return null;try{let t;if(zt(e)){let r=Ut(e),s=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0"),o=String(r.getHours()).padStart(2,"0"),l=String(r.getMinutes()).padStart(2,"0"),c=String(r.getSeconds()).padStart(2,"0");t=`${s}${i}${a}T${o}${l}${c}Z`}else{let r=qe(e),s=r.getUTCFullYear(),i=String(r.getUTCMonth()+1).padStart(2,"0"),a=String(r.getUTCDate()).padStart(2,"0");t=`${s}${i}${a}`}return`DTSTART:${t};${n.recurrence}`}catch(t){return console.error("Error parsing date for DTSTART:",t,{sourceDateString:e}),null}}function CA(n,e,t){if(!n.recurrence||typeof n.recurrence!="string")return null;if(n.recurrence.includes("DTSTART:"))return n.recurrence;let r;if(n.scheduled)r=n.scheduled;else if(n.dateCreated)r=n.dateCreated;else return null;try{let s;if(t){let i=qe(r),a=i.getUTCFullYear(),o=String(i.getUTCMonth()+1).padStart(2,"0"),l=String(i.getUTCDate()).padStart(2,"0");s=`${a}${o}${l}`}else{let i=qe(r),a=i.getUTCFullYear(),o=String(i.getUTCMonth()+1).padStart(2,"0"),l=String(i.getUTCDate()).padStart(2,"0"),c=String(e.getHours()).padStart(2,"0"),d=String(e.getMinutes()).padStart(2,"0");s=`${a}${o}${l}T${c}${d}00Z`}return`DTSTART:${s};${n.recurrence}`}catch(s){return console.error("Error parsing date for DTSTART with dragged time:",s,{sourceDateString:r,draggedStart:e,allDay:t}),null}}function ha(n){return!n||typeof n!="string"?"":n.split(",").map(e=>{let t=e.trim();return t.startsWith("#")?t.slice(1):t}).filter(e=>e.length>0).join(", ")}var vo,At=v(()=>{vo=require("obsidian");Ft();GT();QT();$p();Ne()});var bm,es,km=v(()=>{bm=require("obsidian"),es=class{static async execute(e,t={}){let{fallback:r,errorMessage:s="An error occurred",showNotice:i=!0,logError:a=!0}=t;try{return await e()}catch(o){if(a&&console.error(s,o),i){let l=o instanceof Error?o.message:String(o);new bm.Notice(`${s}: ${l}`)}return r}}static async executeWithRetry(e,t={}){let{maxRetries:r=3,retryDelay:s=1e3,errorMessage:i="Operation failed",showNotice:a=!0}=t,o;for(let l=0;l<=r;l++)try{return await e()}catch(c){if(o=c instanceof Error?c:new Error(String(c)),l<r){await new Promise(d=>setTimeout(d,s));continue}console.error(`${i} after ${r+1} attempts:`,o),a&&new bm.Notice(`${i}: ${o.message}`);return}}static async executeWithValidation(e,t,r={}){let{showNotice:s=!0}=r;for(let i of t)if(!i.condition){s&&new bm.Notice(i.message);return}return this.execute(e,r)}}});var Ci,Zl,tw=v(()=>{Ci=require("obsidian");Ft();km();Zl=class extends Ci.Modal{constructor(t,r,s){super(t);this.title="";this.folder="";this.template="";this.useTemplate=!1;this.plugin=r,this.options=s,this.title=this.generateDefaultTitle(),this.folder=this.getDefaultFolder(),this.template=this.getDefaultTemplate()}onOpen(){this.containerEl.addClass("tasknotes-plugin","ics-note-creation-modal"),this.createModalContent()}onClose(){this.contentEl.empty()}createModalContent(){let{contentEl:t}=this;t.empty(),t.createDiv("modal-header").createEl("h2",{text:"Create from ICS Event"});let s=t.createDiv("ics-event-preview");this.createEventPreview(s),new Ci.Setting(t).setName("Title").setDesc("Title for the new content").addText(l=>{this.titleInput=l.inputEl,l.setValue(this.title).onChange(c=>{this.title=c,this.updatePreview()})}),new Ci.Setting(t).setName("Folder").setDesc("Destination folder (leave empty for vault root)").addText(l=>{this.folderInput=l.inputEl,l.setValue(this.folder).setPlaceholder("folder/subfolder").onChange(c=>{this.folder=c,this.updatePreview()})}),this.templateContainer=t.createDiv("template-settings"),this.createTemplateSettings(),this.previewContainer=t.createDiv("content-preview"),this.updatePreview();let i=t.createDiv("modal-button-container"),a=i.createEl("button",{text:"Create",cls:"mod-cta"});a.onclick=l=>{l.preventDefault(),l.stopPropagation(),console.log("Create button clicked"),this.handleCreate()};let o=i.createEl("button",{text:"Cancel"});o.onclick=l=>{l.preventDefault(),l.stopPropagation(),console.log("Cancel button clicked"),this.close()},setTimeout(()=>{var l;return(l=this.titleInput)==null?void 0:l.focus()},100)}createEventPreview(t){let{icsEvent:r,subscriptionName:s}=this.options;t.createEl("h3",{text:r.title});let i=t.createDiv("event-details");if(r.start){let o=new Date(r.start),l=i.createDiv();l.createEl("strong",{text:"Start: "}),l.appendText(C(o,"PPPp"))}if(r.end&&!r.allDay){let o=new Date(r.end),l=i.createDiv();l.createEl("strong",{text:"End: "}),l.appendText(C(o,"PPPp"))}if(r.location){let o=i.createDiv();o.createEl("strong",{text:"Location: "}),o.appendText(r.location)}let a=i.createDiv();a.createEl("strong",{text:"Calendar: "}),a.appendText(s)}createTemplateSettings(){this.templateContainer.empty(),new Ci.Setting(this.templateContainer).setName("Use Template").setDesc("Apply a template when creating the content").addToggle(t=>{t.setValue(this.useTemplate).onChange(r=>{this.useTemplate=r,this.updateTemplateInput(),this.updatePreview()})}),this.useTemplate&&new Ci.Setting(this.templateContainer).setName("Template Path").setDesc("Path to the template file").addText(t=>{this.templateInput=t.inputEl,t.setValue(this.template).setPlaceholder("templates/ics-note-template.md").onChange(r=>{this.template=r,this.updatePreview()})})}updateDefaultsForContentType(){var t,r;this.folder=((t=this.plugin.settings.icsIntegration)==null?void 0:t.defaultNoteFolder)||"",this.template=((r=this.plugin.settings.icsIntegration)==null?void 0:r.defaultNoteTemplate)||"",this.folderInput&&(this.folderInput.value=this.folder),this.templateInput&&(this.templateInput.value=this.template)}updateTemplateInput(){this.createTemplateSettings()}updatePreview(){if(!this.previewContainer)return;this.previewContainer.empty(),this.previewContainer.createEl("h4",{text:"Summary"});let t=this.previewContainer.createDiv("preview-details"),r=t.createDiv();r.createEl("strong",{text:"Type: "}),r.appendText("Note");let s=t.createDiv();s.createEl("strong",{text:"Title: "}),s.appendText(this.title||"Untitled");let i=t.createDiv();if(i.createEl("strong",{text:"Folder: "}),i.appendText(this.folder||"Vault root"),this.useTemplate&&this.template){let c=t.createDiv();c.createEl("strong",{text:"Template: "}),c.appendText(this.template)}else{let c=t.createDiv();c.createEl("strong",{text:"Template: "}),c.appendText("Default format")}let a=this.previewContainer.createDiv("template-variables");a.createEl("h5",{text:"Available Template Variables"});let o=["{{title}}","{{icsEventTitle}}","{{icsEventStart}}","{{icsEventEnd}}","{{icsEventLocation}}","{{icsEventDescription}}","{{icsEventUrl}}","{{icsEventSubscription}}","{{icsEventId}}","{{date}}","{{time}}"],l=a.createDiv("variables-list");o.forEach(c=>{l.createSpan({text:c,cls:"template-variable"})})}generateDefaultTitle(){let{icsEvent:t}=this.options,r=new Date(t.start);return`${t.title} - ${C(r,"PPP")}`}getDefaultFolder(){var t;return((t=this.plugin.settings.icsIntegration)==null?void 0:t.defaultNoteFolder)||""}getDefaultTemplate(){var t;return((t=this.plugin.settings.icsIntegration)==null?void 0:t.defaultNoteTemplate)||""}async handleCreate(){await es.executeWithValidation(async()=>{var s,i;let{icsEvent:t}=this.options,r=await this.plugin.icsNoteService.createNoteFromICS(t,{title:this.title,folder:this.folder||void 0,template:this.useTemplate&&this.template?this.template:void 0});new Ci.Notice(`Note created: ${this.title}`),(i=(s=this.options).onContentCreated)==null||i.call(s,r.file,r.noteInfo),this.close()},[{condition:!!this.title.trim(),message:"Title is required"}],{errorMessage:"Failed to create note from ICS event"})}}});var Mi,Xl,rw=v(()=>{Mi=require("obsidian"),Xl=class extends Mi.FuzzySuggestModal{constructor(e,t,r){super(e),this.plugin=t,this.onChoose=r,this.setPlaceholder("Type to search for notes to link..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles().filter(e=>e instanceof Mi.TFile&&e.extension==="md"&&!e.path.includes(".trash"))}getItemText(e){let t=`${e.name} ${e.path}`;if(e instanceof Mi.TFile){let r=this.app.metadataCache.getFileCache(e);if(r!=null&&r.frontmatter){let s=(0,Mi.parseFrontMatterAliases)(r.frontmatter);s&&s.length>0&&(t+=` ${s.join(" ")}`)}}return t}renderSuggestion(e,t){let r=e.item;t.empty();let s=t.createDiv({cls:"ics-note-link-suggestion"}),i=s.createSpan({cls:"note-link-name"});if(i.textContent=r.name,r instanceof Mi.TFile){let a=this.app.metadataCache.getFileCache(r);if(a!=null&&a.frontmatter){let o=this.plugin.fieldMapper.toUserField("title"),l=a.frontmatter[o];if(l){let c=s.createDiv({cls:"note-link-title"});c.textContent=l}else{let c=(0,Mi.parseFrontMatterAliases)(a.frontmatter);if(c&&c.length>0){let d=s.createDiv({cls:"note-link-aliases"});d.textContent=c.join(", ")}}}}if(r.path!==r.name){let a=s.createDiv({cls:"note-link-path"});a.textContent=r.path}}onChooseItem(e,t){this.onChoose(e)}}});var MA={};st(MA,{ICSEventInfoModal:()=>To});var ht,To,Em=v(()=>{ht=require("obsidian");tw();rw();km();To=class extends ht.Modal{constructor(t,r,s,i){super(t);this.relatedNotes=[];this.plugin=r,this.icsEvent=s,this.subscriptionName=i}async onOpen(){await this.renderContent()}async renderContent(){let{contentEl:t}=this;t.empty(),await this.loadRelatedNotes(),new ht.Setting(t).setName("Calendar Event").setHeading(),new ht.Setting(t).setName("Title").setDesc(this.icsEvent.title||"Untitled Event"),this.subscriptionName&&new ht.Setting(t).setName("Calendar").setDesc(this.subscriptionName);let r=new Date(this.icsEvent.start),s=r.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(!this.icsEvent.allDay&&(s+=` at ${r.toLocaleTimeString()}`,this.icsEvent.end)){let i=new Date(this.icsEvent.end);s+=` - ${i.toLocaleTimeString()}`}new ht.Setting(t).setName("Date & Time").setDesc(s),this.icsEvent.location&&new ht.Setting(t).setName("Location").setDesc(this.icsEvent.location),this.icsEvent.description&&new ht.Setting(t).setName("Description").setDesc(this.icsEvent.description),this.icsEvent.url&&new ht.Setting(t).setName("URL").setDesc(this.icsEvent.url),new ht.Setting(t).setName("Related Notes & Tasks").setHeading(),this.relatedNotes.length===0?new ht.Setting(t).setDesc("No related notes or tasks found for this event."):this.relatedNotes.forEach(i=>{let a=this.isTaskNote(i);new ht.Setting(t).setName(i.title).setDesc(`Type: ${a?"Task":"Note"}`).addButton(o=>{o.setButtonText("Open").onClick(async()=>{await this.safeOpenFile(i.path),this.close()})})}),new ht.Setting(t).setName("Actions").setHeading(),new ht.Setting(t).setName("Create from Event").setDesc("Create a new note or task from this calendar event").addButton(i=>{i.setButtonText("Create Note").onClick(()=>{console.log("Create Note clicked"),this.openCreationModal()})}).addButton(i=>{i.setButtonText("Create Task").onClick(async()=>{console.log("Create Task clicked"),await this.createTaskDirectly()})}),new ht.Setting(t).setName("Link Existing").setDesc("Link an existing note to this calendar event").addButton(i=>{i.setButtonText("Link Note").onClick(()=>{console.log("Link Note clicked"),this.linkExistingNote()})}).addButton(i=>{i.setButtonText("Refresh").onClick(()=>{console.log("Refresh clicked"),this.refreshRelatedNotes()})})}async loadRelatedNotes(){let t=await es.execute(()=>this.plugin.icsNoteService.findRelatedNotes(this.icsEvent),{fallback:[],errorMessage:"Failed to load related notes",showNotice:!1});this.relatedNotes=t||[]}openCreationModal(){console.log("Opening note creation modal");try{new Zl(this.app,this.plugin,{icsEvent:this.icsEvent,subscriptionName:this.subscriptionName||"Unknown Calendar",onContentCreated:async(r,s)=>{new ht.Notice("Note created successfully"),this.refreshRelatedNotes(),await this.safeOpenFile(r.path)}}).open()}catch(t){console.error("Error opening creation modal:",t),new ht.Notice("Failed to open creation modal")}}async linkExistingNote(){console.log("Link existing note button clicked"),await es.execute(async()=>{new Xl(this.app,this.plugin,async r=>{await es.execute(async()=>{await this.plugin.icsNoteService.linkNoteToICS(r.path,this.icsEvent),new ht.Notice(`Linked note "${r.name}" to ICS event`),this.refreshRelatedNotes()},{errorMessage:"Failed to link note"})}).open()},{errorMessage:"Failed to open note selection"})}async createTaskDirectly(){await es.execute(async()=>{let t=await this.plugin.icsNoteService.createTaskFromICS(this.icsEvent);new ht.Notice(`Task created: ${t.taskInfo.title}`),await this.safeOpenFile(t.file.path),this.refreshRelatedNotes()},{errorMessage:"Failed to create task from ICS event"})}async refreshRelatedNotes(){await es.execute(async()=>{await this.loadRelatedNotes(),await this.renderContent(),new ht.Notice("Related notes refreshed")},{errorMessage:"Failed to refresh related notes"})}isTaskNote(t){var s;let r=this.plugin.settings.taskTag;return((s=t.tags)==null?void 0:s.includes(r))||!1}async safeOpenFile(t){try{let r=this.app.vault.getAbstractFileByPath(t);r instanceof ht.TFile?await this.app.workspace.getLeaf().openFile(r):(new ht.Notice("File not found or invalid"),console.error("Invalid file path or file not found:",t))}catch(r){console.error("Error opening file:",r),new ht.Notice("Failed to open file")}}onClose(){let{contentEl:t}=this;t.empty()}}});var bt,Pi,Sm=v(()=>{bt=require("obsidian");Ne();Pi=class extends bt.Modal{constructor(t,r,s,i){super(t);this.selectedType="relative";this.relativeAnchor="due";this.relativeOffset=15;this.relativeUnit="minutes";this.relativeDirection="before";this.absoluteDate="";this.absoluteTime="";this.description="";this.plugin=r,this.task=s,this.reminders=s.reminders?[...s.reminders]:[],this.originalReminders=s.reminders?[...s.reminders]:[],this.onSave=i}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("tasknotes-plugin"),t.addClass("tasknotes-reminder-modal"),t.createDiv({cls:"reminder-modal__loading"}).createEl("div",{text:"Loading reminders..."}),this.initializeWithFreshData().catch(s=>{console.error("Failed to initialize reminder modal:",s),t.empty(),t.addClass("tasknotes-plugin"),t.addClass("tasknotes-reminder-modal"),t.createDiv({cls:"reminder-modal__error",text:"Failed to load task data. Please try again."})})}async initializeWithFreshData(){let{contentEl:t}=this;if(this.task.path&&this.task.path.trim()!==""){let a=await this.plugin.cacheManager.getTaskInfo(this.task.path);a?(this.task=a,this.reminders=a.reminders?[...a.reminders]:[],this.originalReminders=a.reminders?[...a.reminders]:[]):(this.reminders=this.task.reminders?[...this.task.reminders]:[],this.originalReminders=this.task.reminders?[...this.task.reminders]:[])}else this.reminders=this.task.reminders?[...this.task.reminders]:[],this.originalReminders=this.task.reminders?[...this.task.reminders]:[];t.empty(),t.addClass("tasknotes-plugin"),t.addClass("tasknotes-reminder-modal");let r=t.createDiv({cls:"reminder-modal__header"});r.createEl("h2",{text:"Task Reminders"}),r.createDiv({cls:"reminder-modal__task-title",text:this.task.title});let s=this.getTaskContextInfo();if(s){let a=r.createDiv({cls:"reminder-modal__task-dates"});a.textContent=s}let i=t.createDiv({cls:"reminder-modal__content"});this.renderExistingReminders(i),this.renderAddReminderForm(i),this.renderActionButtons(t),this.setupKeyboardHandlers(),this.updateSaveButtonState()}renderActionButtons(t){let r=t.createDiv({cls:"reminder-modal__actions"});this.saveBtn=r.createEl("button",{text:"Save Changes",cls:"mod-cta reminder-modal__save-btn"}),this.saveBtn.disabled=!0,this.saveBtn.onclick=async()=>{await this.save()};let s=r.createEl("button",{text:"Cancel",cls:"reminder-modal__cancel-btn"});s.onclick=()=>{this.cancel()}}getTaskContextInfo(){let t=[];return this.task.due&&t.push(`Due: ${Ts(this.task.due)}`),this.task.scheduled&&t.push(`Scheduled: ${Ts(this.task.scheduled)}`),t.length>0?t.join(" \u2022 "):null}setupKeyboardHandlers(){let t=async r=>{r.key==="Enter"&&(r.ctrlKey||r.metaKey)&&!this.saveBtn.disabled?(r.preventDefault(),await this.save()):r.key==="Escape"&&(r.preventDefault(),this.cancel())};this.contentEl.addEventListener("keydown",t),this.onClose=()=>{this.contentEl.removeEventListener("keydown",t);let{contentEl:r}=this;r.empty()}}updateSaveButtonState(){if(!this.saveBtn)return;let t=this.remindersHaveChanged();this.saveBtn.disabled=!t,this.saveBtn.textContent=t?"Save Changes":"No Changes"}renderExistingReminders(t){let r=t.createDiv({cls:"reminder-modal__section"}),s=r.createDiv({cls:"reminder-modal__section-header"});if(s.createEl("h3",{text:"Current Reminders"}),this.reminders.length>0&&s.createSpan({cls:"reminder-modal__reminder-count",text:`(${this.reminders.length})`}),this.reminders.length===0){let a=r.createDiv({cls:"reminder-modal__empty-state"});(0,bt.setIcon)(a.createDiv({cls:"reminder-modal__empty-icon"}),"bell-off"),a.createEl("div",{cls:"reminder-modal__empty-text",text:"No reminders set"});return}let i=r.createDiv({cls:"reminder-modal__reminder-list"});this.reminders.forEach((a,o)=>{let l=i.createDiv({cls:"reminder-modal__reminder-card"}),c=l.createDiv({cls:"reminder-modal__reminder-icon"}),d=a.type==="absolute"?"calendar-clock":"timer";(0,bt.setIcon)(c,d);let u=l.createDiv({cls:"reminder-modal__reminder-content"}),f=u.createDiv({cls:"reminder-modal__reminder-primary"});if(f.textContent=this.formatReminderDisplayText(a),a.description){let m=u.createDiv({cls:"reminder-modal__reminder-description"});m.textContent=`"${a.description}"`}let p=l.createDiv({cls:"reminder-modal__reminder-actions"}).createEl("button",{cls:"reminder-modal__action-btn reminder-modal__remove-btn"});(0,bt.setIcon)(p,"trash-2"),(0,bt.setTooltip)(p,"Delete this reminder"),p.onclick=async m=>{m.stopPropagation(),await this.removeReminder(o)}})}formatReminderDisplayText(t){if(t.type==="absolute"){if(t.absoluteTime)try{let r=new Date(t.absoluteTime);return`${r.toLocaleDateString()} at ${r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch(r){return`At ${t.absoluteTime}`}return"Absolute reminder"}else{let r=t.relatedTo==="due"?"due date":"scheduled date";return`${this.formatOffset(t.offset||"")} ${r}`}}renderQuickActions(t){if(!(this.task.due||this.task.scheduled))return;let i=t.createDiv({cls:"reminder-modal__quick-actions"}).createDiv({cls:"reminder-modal__quick-buttons"});[{label:"5m",fullLabel:"5 minutes before",offset:"-PT5M",icon:"clock"},{label:"15m",fullLabel:"15 minutes before",offset:"-PT15M",icon:"clock"},{label:"1h",fullLabel:"1 hour before",offset:"-PT1H",icon:"clock"},{label:"1d",fullLabel:"1 day before",offset:"-P1D",icon:"calendar"}].forEach(({label:o,fullLabel:l,offset:c,icon:d})=>{let u=this.task.due?"due":"scheduled",f=i.createEl("button",{cls:"reminder-modal__quick-btn"}),h=f.createSpan({cls:"reminder-modal__quick-btn-icon"});(0,bt.setIcon)(h,d),f.createSpan({cls:"reminder-modal__quick-btn-label",text:o}),(0,bt.setTooltip)(f,`Add reminder ${l} ${u} date`),f.onclick=async()=>{await this.addQuickReminder(u,c,l)}})}async addQuickReminder(t,r,s){let i={id:`rem_${Date.now()}`,type:"relative",relatedTo:t,offset:r,description:s};await this.addReminder(i),new bt.Notice(`Added reminder: ${s}`)}renderAddReminderForm(t){let r=t.createDiv({cls:"reminder-modal__section"});r.createDiv({cls:"reminder-modal__section-header"}).createEl("h3",{text:"Add New Reminder"}),this.renderQuickActions(r);let i=r.createDiv({cls:"reminder-modal__form"}),a=i.createDiv({cls:"reminder-modal__type-selector"}),o=a.createEl("button",{cls:"reminder-modal__type-tab reminder-modal__type-tab--active",text:"Relative",attr:{"data-type":"relative"}}),l=a.createEl("button",{cls:"reminder-modal__type-tab",text:"Absolute",attr:{"data-type":"absolute"}});o.classList.toggle("reminder-modal__type-tab--active",this.selectedType==="relative"),l.classList.toggle("reminder-modal__type-tab--active",this.selectedType==="absolute");let c=p=>{this.selectedType=p,o.classList.toggle("reminder-modal__type-tab--active",p==="relative"),l.classList.toggle("reminder-modal__type-tab--active",p==="absolute"),this.updateFormVisibility(i,this.selectedType)};o.onclick=()=>c("relative"),l.onclick=()=>c("absolute");let d=i.createDiv({cls:"relative-fields"});new bt.Setting(d).setName("Time").addText(p=>{p.setPlaceholder("15").setValue(String(this.relativeOffset)).onChange(m=>{this.relativeOffset=parseInt(m)||0})}).addDropdown(p=>{p.addOption("minutes","minutes").addOption("hours","hours").addOption("days","days").setValue(this.relativeUnit).onChange(m=>{this.relativeUnit=m})}),new bt.Setting(d).setName("Direction").addDropdown(p=>{p.addOption("before","Before").addOption("after","After").setValue(this.relativeDirection).onChange(m=>{this.relativeDirection=m})}),new bt.Setting(d).setName("Relative to").addDropdown(p=>{let m={};this.task.due&&(m.due=`Due date (${Ts(this.task.due)})`),this.task.scheduled&&(m.scheduled=`Scheduled date (${Ts(this.task.scheduled)})`),Object.keys(m).length===0?(m.none="No dates available",p.setDisabled(!0)):(Object.entries(m).forEach(([g,y])=>{p.addOption(g,y)}),p.setValue(this.relativeAnchor)),p.onChange(g=>{this.relativeAnchor=g})});let u=i.createDiv({cls:"absolute-fields"});new bt.Setting(u).setName("Date").addText(p=>{p.setPlaceholder("YYYY-MM-DD").setValue(this.absoluteDate).onChange(m=>{this.absoluteDate=m}),p.inputEl.type="date"}),new bt.Setting(u).setName("Time").addText(p=>{p.setPlaceholder("HH:MM").setValue(this.absoluteTime).onChange(m=>{this.absoluteTime=m}),p.inputEl.type="time"}),new bt.Setting(i).setName("Description (optional)").addText(p=>{p.setPlaceholder("Custom reminder message").setValue(this.description).onChange(m=>{this.description=m})});let f=i.createEl("button",{cls:"reminder-add-btn"}),h=f.createSpan({cls:"reminder-add-btn-icon"});(0,bt.setIcon)(h,"plus"),f.createSpan({cls:"reminder-add-btn-text",text:"Add Reminder"}),f.onclick=async()=>{f.disabled=!0,f.classList.add("reminder-add-btn--loading");try{let p=this.createReminder(this.selectedType,this.relativeAnchor,this.relativeOffset,this.relativeUnit,this.relativeDirection,this.absoluteDate,this.absoluteTime,this.description);p&&(await this.addReminder(p),this.selectedType==="relative"?(this.relativeOffset=15,this.relativeUnit="minutes",this.description=""):(this.absoluteDate="",this.absoluteTime="",this.description=""),this.resetFormInputs(i))}catch(p){console.error("Error adding reminder:",p),new bt.Notice("Failed to add reminder. Please check your inputs.")}finally{f.disabled=!1,f.classList.remove("reminder-add-btn--loading")}},this.updateFormVisibility(i,this.selectedType)}updateFormVisibility(t,r){let s=t.querySelector(".relative-fields"),i=t.querySelector(".absolute-fields");r==="relative"?(s.style.display="block",i.style.display="none"):(s.style.display="none",i.style.display="block")}createReminder(t,r,s,i,a,o,l,c){let d=`rem_${Date.now()}`;if(t==="relative"){if(!(r==="due"?this.task.due:this.task.scheduled))return new bt.Notice(`Cannot create reminder: Task has no ${r} date`),null;let f="PT";return i==="days"?f=`P${s}D`:i==="hours"?f=`PT${s}H`:f=`PT${s}M`,a==="before"&&(f="-"+f),{id:d,type:"relative",relatedTo:r,offset:f,description:c||void 0}}else{if(!o||!l)return new bt.Notice("Please specify both date and time for absolute reminder"),null;let u=`${o}T${l}:00`;return{id:d,type:"absolute",absoluteTime:u,description:c||void 0}}}formatReminderTiming(t){if(t.type==="absolute")return"Absolute reminder";{let r=t.relatedTo==="due"?"due date":"scheduled date";return`${this.formatOffset(t.offset||"")} ${r}`}}formatReminderDetails(t){if(t.type==="absolute")return`At ${Ts(t.absoluteTime||"")}`;{let r=t.relatedTo==="due"?this.task.due:this.task.scheduled;return r?`When ${t.relatedTo} date is ${Ts(r)}`:`Relative to ${t.relatedTo} date (not set)`}}formatReminderDescription(t){if(t.description)return t.description;if(t.type==="absolute")return`At ${Ts(t.absoluteTime||"")}`;{let r=t.relatedTo==="due"?"due date":"scheduled date";return`${this.formatOffset(t.offset||"")} ${r}`}}formatOffset(t){let r=t.startsWith("-"),i=(r?t.substring(1):t).match(/P(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?)?/);if(!i)return t;let[,a,o,l]=i,c=[];if(a&&c.push(`${a} day${a!=="1"?"s":""}`),o&&c.push(`${o} hour${o!=="1"?"s":""}`),l&&c.push(`${l} minute${l!=="1"?"s":""}`),c.length===0)return"At time of";let d=c.join(" ");return r?`${d} before`:`${d} after`}async addReminder(t){this.reminders.push(t),this.refreshRemindersListOnly(),this.task.path&&this.plugin.emitter.trigger("reminder-preview-changed",{taskPath:this.task.path,currentReminders:[...this.reminders],action:"added",reminder:t})}async removeReminder(t){let r=this.reminders[t];this.reminders.splice(t,1),this.refreshRemindersListOnly(),this.task.path&&r&&this.plugin.emitter.trigger("reminder-preview-changed",{taskPath:this.task.path,currentReminders:[...this.reminders],action:"removed",reminder:r})}async refresh(){await this.initializeWithFreshData()}refreshRemindersListOnly(){let t=this.contentEl.querySelector(".reminder-modal__content");if(t){let r=t.querySelector(".reminder-modal__section");r&&r.remove();let s=document.createElement("div");this.renderExistingReminders(s);let i=s.firstChild;i&&t.insertBefore(i,t.firstChild)}this.updateSaveButtonState()}resetFormInputs(t){let r=t.querySelector('input[placeholder="15"]');r&&(r.value=String(this.relativeOffset));let s=t.querySelector('input[placeholder="Custom reminder message"]');s&&(s.value=this.description);let i=t.querySelector('input[type="date"]');i&&(i.value=this.absoluteDate);let a=t.querySelector('input[type="time"]');a&&(a.value=this.absoluteTime);let o=t.querySelector('.setting-item:has(input[placeholder="15"]) select');o&&(o.value=this.relativeUnit);let l=t.querySelector(".setting-item:nth-child(2) select");l&&(l.value=this.relativeDirection);let c=t.querySelector(".setting-item:nth-child(3) select");c&&(c.value=this.relativeAnchor)}async save(){var t;this.saveBtn.disabled=!0,this.saveBtn.textContent="Saving...";try{this.task.path&&this.task.path.trim()!==""&&((t=this.plugin.notificationService)==null||t.clearProcessedRemindersForTask(this.task.path));let r=this.remindersHaveChanged();this.onSave(this.reminders),r&&this.task.path&&this.plugin.emitter.trigger("reminder-changed",{taskPath:this.task.path,oldReminders:this.originalReminders,newReminders:[...this.reminders]}),this.close()}catch(r){console.error("Failed to save reminders:",r),new bt.Notice("Failed to save reminders. Please try again."),this.saveBtn.disabled=!1,this.saveBtn.textContent="Save Changes"}}cancel(){this.remindersHaveChanged()&&this.task.path&&this.plugin.emitter.trigger("reminder-preview-changed",{taskPath:this.task.path,currentReminders:[...this.originalReminders],action:"cancelled"}),this.close()}remindersHaveChanged(){return this.reminders.length!==this.originalReminders.length?!0:!this.reminders.every((t,r)=>{let s=this.originalReminders[r];return s?t.id===s.id&&t.type===s.type&&t.relatedTo===s.relatedTo&&t.offset===s.offset&&t.absoluteTime===s.absoluteTime&&t.description===s.description:!1})}onClose(){let{contentEl:t}=this;t.empty()}}});var PA={};st(PA,{CalendarExportService:()=>$n});var wo,$n,Dm=v(()=>{Ft();wo=require("obsidian"),$n=class{static generateCalendarURL(e){let{type:t,task:r,useScheduledAsDue:s=!0}=e;switch(t){case"google":return this.generateGoogleCalendarURL(r,s);case"outlook":return this.generateOutlookCalendarURL(r,s);case"yahoo":return this.generateYahooCalendarURL(r,s);case"ics":return this.generateICSDownloadURL(r);default:throw new Error(`Unsupported calendar type: ${t}`)}}static openCalendarURL(e){try{let t=this.generateCalendarURL(e);window.open(t,"_blank")}catch(t){console.error("Failed to generate calendar URL:",t),new wo.Notice("Failed to generate calendar link")}}static generateGoogleCalendarURL(e,t){let r="https://calendar.google.com/calendar/render",s=new URLSearchParams;s.append("action","TEMPLATE"),s.append("text",e.title);let i=this.formatGoogleDates(e,t);i&&s.append("dates",i);let a=this.buildDescription(e);return a&&s.append("details",a),e.contexts&&e.contexts.length>0&&s.append("location",e.contexts.join(", ")),`${r}?${s.toString()}`}static generateOutlookCalendarURL(e,t){let r="https://outlook.live.com/calendar/0/deeplink/compose",s=new URLSearchParams;s.append("subject",e.title);let{startISO:i,endISO:a}=this.getTaskDateRange(e,t);i&&s.append("startdt",i),a&&s.append("enddt",a);let o=this.buildDescription(e);return o&&s.append("body",o),e.contexts&&e.contexts.length>0&&s.append("location",e.contexts.join(", ")),s.append("path","/calendar/action/compose"),s.append("rru","addevent"),`${r}?${s.toString()}`}static generateYahooCalendarURL(e,t){let r="https://calendar.yahoo.com/",s=new URLSearchParams;s.append("v","60"),s.append("title",e.title);let{startYahoo:i,endYahoo:a}=this.getYahooDateFormat(e,t);i&&s.append("st",i),a&&s.append("et",a);let o=this.buildDescription(e);return o&&s.append("desc",o),e.contexts&&e.contexts.length>0&&s.append("in_loc",e.contexts.join(", ")),`${r}?${s.toString()}`}static generateICSDownloadURL(e){let t=this.generateICSContent(e);return`data:text/calendar;charset=utf8,${encodeURIComponent(t)}`}static generateICSContent(e){let t=`${e.path.replace(/[^a-zA-Z0-9]/g,"-")}-${Date.now()}@tasknotes`,r=new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),s=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//TaskNotes//Task Export//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${t}`,`DTSTAMP:${r}`];s.push(`SUMMARY:${this.escapeICSText(e.title)}`);let{startICS:i,endICS:a}=this.getICSDateFormat(e);i&&s.push(`DTSTART:${i}`),a&&s.push(`DTEND:${a}`);let o=this.buildDescription(e);if(o&&s.push(`DESCRIPTION:${this.escapeICSText(o)}`),e.contexts&&e.contexts.length>0&&s.push(`LOCATION:${this.escapeICSText(e.contexts.join(", "))}`),e.tags&&e.tags.length>0&&s.push(`CATEGORIES:${e.tags.map(l=>this.escapeICSText(l)).join(",")}`),e.priority){let c={highest:"1",high:"3",medium:"5",low:"7",lowest:"9"}[e.priority]||"5";s.push(`PRIORITY:${c}`)}if(e.status){let c={done:"COMPLETED","in-progress":"IN-PROCESS",todo:"NEEDS-ACTION",cancelled:"CANCELLED"}[e.status]||"NEEDS-ACTION";s.push(`STATUS:${c}`)}return s.push("END:VEVENT"),s.push("END:VCALENDAR"),s.join(`\r
`)}static buildDescription(e){let t=[],r=[];return e.priority&&r.push(`Priority: ${e.priority}`),e.status&&r.push(`Status: ${e.status}`),e.projects&&e.projects.length>0&&r.push(`Projects: ${e.projects.join(", ")}`),e.tags&&e.tags.length>0&&r.push(`Tags: ${e.tags.join(", ")}`),e.contexts&&e.contexts.length>0&&r.push(`Contexts: ${e.contexts.join(", ")}`),e.timeEstimate&&r.push(`Estimated time: ${e.timeEstimate} minutes`),r.length>0&&t.push(...r),t.length>0&&t.push(""),t.push(`Exported from TaskNotes: ${e.path}`),t.join(`
`)}static formatGoogleDates(e,t){let{startICS:r,endICS:s}=this.getICSDateFormat(e,t);if(!r)return null;if(s)return`${r}/${s}`;let i=this.parseICSDate(r),a=new Date(i.getTime()+3600*1e3),o=this.formatDateToICS(a);return`${r}/${o}`}static getTaskDateRange(e,t){let r=null,s=null;if(e.scheduled)try{r=this.parseTaskDate(e.scheduled).toISOString()}catch(i){console.warn("Invalid scheduled date:",e.scheduled)}if(e.due)try{s=this.parseTaskDate(e.due).toISOString()}catch(i){console.warn("Invalid due date:",e.due)}else if(t&&r){let i=new Date(r);s=new Date(i.getTime()+3600*1e3).toISOString()}return{startISO:r,endISO:s}}static getYahooDateFormat(e,t){let{startISO:r,endISO:s}=this.getTaskDateRange(e,t),i=a=>{let o=new Date(a);return C(o,"yyyyMMdd'T'HHmmss")};return{startYahoo:r?i(r):null,endYahoo:s?i(s):null}}static getICSDateFormat(e,t=!0){let{startISO:r,endISO:s}=this.getTaskDateRange(e,t),i=a=>{let o=new Date(a);return this.formatDateToICS(o)};return{startICS:r?i(r):null,endICS:s?i(s):null}}static formatDateToICS(e){return e.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")}static parseICSDate(e){let t=e.substr(0,4),r=e.substr(4,2),s=e.substr(6,2),i=e.substr(9,2),a=e.substr(11,2),o=e.substr(13,2);return new Date(`${t}-${r}-${s}T${i}:${a}:${o}Z`)}static parseTaskDate(e){return e.includes("T")?so(e):so(`${e}T00:00:00`)}static escapeICSText(e){return e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n").replace(/\r/g,"")}static foldICSLines(e){let t=e.split(`\r
`),r=[];return t.forEach(s=>{if(s.length<=75)r.push(s);else{let i=s;for(;i.length>75;)r.push(i.substring(0,75)),i=" "+i.substring(75);i.length>0&&r.push(i)}}),r.join(`\r
`)}static generateMultipleTasksICSContent(e){let t=new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),r=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//TaskNotes//EN","CALSCALE:GREGORIAN"];return e.forEach((s,i)=>{let a=`${s.path.replace(/[^a-zA-Z0-9]/g,"-")}-${i}-${Date.now()}@tasknotes`;r.push("BEGIN:VEVENT"),r.push(`UID:${a}`),r.push(`DTSTAMP:${t}`),r.push(`SUMMARY:${this.escapeICSText(s.title)}`);let{startICS:o,endICS:l}=this.getICSDateFormat(s);if(o){if(!l){let d=this.parseICSDate(o),u=new Date(d.getTime()+3600*1e3);l=this.formatDateToICS(u)}}else{let d;if(s.dateCreated?d=new Date(s.dateCreated):d=new Date,o=this.formatDateToICS(d),!l){let u=new Date(d.getTime()+36e5);l=this.formatDateToICS(u)}}r.push(`DTSTART:${o}`),r.push(`DTEND:${l}`);let c=this.buildDescription(s);if(c&&r.push(`DESCRIPTION:${this.escapeICSText(c)}`),s.contexts&&s.contexts.length>0&&r.push(`LOCATION:${this.escapeICSText(s.contexts.join(", "))}`),s.tags&&s.tags.length>0&&r.push(`CATEGORIES:${s.tags.map(d=>this.escapeICSText(d)).join(",")}`),s.priority){let u={highest:"1",high:"3",medium:"5",low:"7",lowest:"9"}[s.priority]||"5";r.push(`PRIORITY:${u}`)}if(s.status){let u={done:"COMPLETED","in-progress":"IN-PROCESS",todo:"NEEDS-ACTION",cancelled:"CANCELLED"}[s.status]||"NEEDS-ACTION";r.push(`STATUS:${u}`)}r.push("END:VEVENT")}),r.push("END:VCALENDAR"),this.foldICSLines(r.join(`\r
`))}static downloadAllTasksICSFile(e){try{if(!e||e.length===0){new wo.Notice("No tasks found to export");return}let t=this.generateMultipleTasksICSContent(e),r=new Blob([t],{type:"text/calendar"}),s=URL.createObjectURL(r),a=`tasknotes-all-tasks-${new Date().toISOString().split("T")[0]}.ics`,o=document.createElement("a");o.href=s,o.download=a,o.click(),URL.revokeObjectURL(s),new wo.Notice(`Downloaded ${a} with ${e.length} task${e.length===1?"":"s"}`)}catch(t){console.error("Failed to download all tasks ICS file:",t),new wo.Notice("Failed to download calendar file")}}static downloadICSFile(e){try{let t=this.generateICSContent(e),r=new Blob([t],{type:"text/calendar"}),s=URL.createObjectURL(r),i=`${e.title.replace(/[^a-zA-Z0-9]/g,"-")}.ics`,a=document.createElement("a");a.href=s,a.download=i,a.click(),URL.revokeObjectURL(s),new wo.Notice(`Downloaded ${i}`)}catch(t){console.error("Failed to download ICS file:",t),new wo.Notice("Failed to download calendar file")}}}});async function _A(n,e){return new sw(n,e).show()}var eu,sw,AA=v(()=>{eu=require("obsidian"),sw=class extends eu.Modal{constructor(e,t){super(e),this.options={confirmText:"Confirm",cancelText:"Cancel",...t}}show(){return new Promise(e=>{this.resolve=e,this.open()})}onOpen(){let{contentEl:e}=this;e.empty(),new eu.Setting(e).setName(this.options.title).setHeading(),new eu.Setting(e).addText(i=>{this.inputEl=i.inputEl,i.setPlaceholder(this.options.placeholder||"").setValue(this.options.initialValue||"").onChange(()=>{}),setTimeout(()=>{this.inputEl.focus(),this.inputEl.select()},100)});let t=e.createEl("div",{cls:"modal-button-container"});t.style.display="flex",t.style.gap="10px",t.style.justifyContent="flex-end",t.style.marginTop="20px";let r=t.createEl("button",{text:this.options.cancelText});r.addEventListener("click",()=>{this.resolve(null),this.close()});let s=t.createEl("button",{text:this.options.confirmText,cls:"mod-cta"});s.addEventListener("click",()=>{let i=this.inputEl.value.trim();this.resolve(i||null),this.close()}),this.inputEl.addEventListener("keydown",i=>{i.key==="Enter"?(i.preventDefault(),s.click()):i.key==="Escape"&&(i.preventDefault(),r.click())})}onClose(){let{contentEl:e}=this;e.empty(),this.resolve&&this.resolve(null)}}});var tu,ts,ec=v(()=>{tu=require("obsidian"),ts=class{constructor(e){this.menu=new tu.Menu,this.options=e,this.buildMenu()}buildMenu(){this.options.title&&(this.menu.addItem(i=>{i.setTitle(this.options.title),i.setIcon("calendar"),i.setDisabled(!0)}),this.menu.addSeparator());let e=this.getDateOptions(),t=e.filter(i=>i.label.startsWith("+")||i.label.startsWith("-"));t.length>0&&(t.forEach(i=>{this.menu.addItem(a=>{let o=i.label;i.icon&&a.setIcon(i.icon),a.setTitle(o),a.onClick(async()=>{this.options.onSelect(i.value,null)})})}),this.menu.addSeparator()),e.filter(i=>!i.label.startsWith("+")&&!i.label.startsWith("-")&&!["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(i.label)).forEach(i=>{this.menu.addItem(a=>{let o=i.label;i.icon&&a.setIcon(i.icon),i.value&&i.value===this.options.currentValue&&(o=`\u2713 ${i.label}`),a.setTitle(o),a.onClick(async()=>{this.options.onSelect(i.value,null)})})});let s=e.filter(i=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(i.label));s.length>0&&(this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Weekdays"),i.setIcon("calendar");let a=i.setSubmenu();s.forEach(o=>{a.addItem(l=>{let c=o.label;o.value&&o.value===this.options.currentValue&&(c=`\u2713 ${o.label}`),l.setTitle(c),l.setIcon("calendar"),l.onClick(async()=>{this.options.onSelect(o.value,null)})})})})),this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Pick date & time..."),i.setIcon("calendar"),i.onClick(async()=>{this.showDateTimePicker()})}),this.options.currentValue&&this.menu.addItem(i=>{i.setTitle("Clear date"),i.setIcon("x"),i.onClick(async()=>{this.options.onSelect(null,null)})})}getDateOptions(){let e=window.moment(),t=[];if(this.options.currentValue){let o=window.moment(this.options.currentValue);t.push({label:"+1 day",value:o.clone().add(1,"day").format("YYYY-MM-DD"),icon:"plus"}),t.push({label:"-1 day",value:o.clone().subtract(1,"day").format("YYYY-MM-DD"),icon:"minus"}),t.push({label:"+1 week",value:o.clone().add(1,"week").format("YYYY-MM-DD"),icon:"plus-circle"}),t.push({label:"-1 week",value:o.clone().subtract(1,"week").format("YYYY-MM-DD"),icon:"minus-circle"})}t.push({label:"Today",value:e.format("YYYY-MM-DD"),icon:"calendar-check",isToday:!0}),t.push({label:"Tomorrow",value:e.clone().add(1,"day").format("YYYY-MM-DD"),icon:"calendar-plus"}),[{name:"Monday",day:1},{name:"Tuesday",day:2},{name:"Wednesday",day:3},{name:"Thursday",day:4},{name:"Friday",day:5},{name:"Saturday",day:6},{name:"Sunday",day:0}].forEach(o=>{let l=e.clone().day(o.day);l.isSameOrBefore(e,"day")&&(l=l.add(1,"week")),t.push({label:o.name,value:l.format("YYYY-MM-DD"),icon:"calendar"})});let s=e.clone().day(6);(s.isBefore(e)||s.isSame(e,"day"))&&s.add(1,"week"),t.push({label:"This weekend",value:s.format("YYYY-MM-DD"),icon:"calendar-days"});let i=e.clone().day(1).add(1,"week");t.push({label:"Next week",value:i.format("YYYY-MM-DD"),icon:"calendar-plus"});let a=e.clone().add(1,"month").startOf("month");return t.push({label:"Next month",value:a.format("YYYY-MM-DD"),icon:"calendar-range"}),t}show(e){this.menu.showAtMouseEvent(e)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4})}showDateTimePicker(){let e=this.createModal(),t=this.createHeader(),r=this.createDateSection(),s=this.createTimeSection(),i=this.createButtonSection();e.appendChild(t),e.appendChild(r.container),e.appendChild(s.container),e.appendChild(i.container),document.body.appendChild(e),this.setupModalEventHandlers(e,r.input,s.input,i.selectButton),setTimeout(()=>{r.input.focus()},100)}createModal(){let e=document.createElement("div");return e.className="date-picker-modal",e}createHeader(){let e=document.createElement("div");e.className="date-picker-modal__header";let t=document.createElement("div");t.className="date-picker-modal__header-icon",(0,tu.setIcon)(t,"calendar");let r=document.createElement("h3");return r.className="date-picker-modal__header-title",r.textContent="Set date & time",e.appendChild(t),e.appendChild(r),e}createDateSection(){var i;let e=document.createElement("div");e.className="date-picker-modal__section";let t=this.createInputLabel("calendar","Date"),r=this.createInputContainer(),s=this.createDateInput();return(i=this.options.currentValue)!=null&&i.trim()&&(s.value=this.options.currentValue),r.appendChild(s),e.appendChild(t),e.appendChild(r),{container:e,input:s}}createTimeSection(){var i;let e=document.createElement("div");e.className="date-picker-modal__section date-picker-modal__section--buttons";let t=this.createInputLabel("clock","Time (optional)"),r=this.createInputContainer(),s=this.createTimeInput();return(i=this.options.currentTime)!=null&&i.trim()&&(s.value=this.options.currentTime),r.appendChild(s),e.appendChild(t),e.appendChild(r),{container:e,input:s}}createInputLabel(e,t){let r=document.createElement("label");r.className="date-picker-modal__label";let s=document.createElement("div");s.className="date-picker-modal__label-icon",(0,tu.setIcon)(s,e==="calendar"?"calendar":"clock");let i=document.createElement("span");return i.textContent=t,r.appendChild(s),r.appendChild(i),r}createInputContainer(){let e=document.createElement("div");return e.className="date-picker-modal__input-container",e}createDateInput(){let e=document.createElement("input");return e.type="date",e.className="date-picker-modal__input",this.addPickerClickHandler(e),e}createTimeInput(){let e=document.createElement("input");return e.type="time",e.className="date-picker-modal__input",this.addPickerClickHandler(e),e}addPickerClickHandler(e){e.addEventListener("click",()=>{if("showPicker"in e&&typeof e.showPicker=="function")try{e.showPicker()}catch(t){e.focus()}else e.focus()})}createButtonSection(){let e=document.createElement("div");e.className="date-picker-modal__buttons";let t=this.createButton("Cancel",!1),r=this.createButton("Select",!0);return e.appendChild(t),e.appendChild(r),{container:e,selectButton:r}}createButton(e,t){let r=document.createElement("button");return r.textContent=e,r.className=t?"date-picker-modal__button date-picker-modal__button--primary":"date-picker-modal__button date-picker-modal__button--secondary",r}setupModalEventHandlers(e,t,r,s){s.addEventListener("click",()=>{t.value&&this.options.onSelect(t.value,r.value||null),document.body.removeChild(e)}),e.querySelector(".date-picker-modal__button--secondary").addEventListener("click",()=>{document.body.removeChild(e)});let a=c=>{c.key==="Escape"&&(document.body.removeChild(e),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a);let o=c=>{c.key==="Enter"&&(c.preventDefault(),s.click())};t.addEventListener("keydown",o),r.addEventListener("keydown",o);let l=c=>{e.contains(c.target)||(document.body.removeChild(e),document.removeEventListener("click",l),document.removeEventListener("keydown",a))};setTimeout(()=>{document.addEventListener("click",l)},100)}}});var ks,Ks,nw,tc=v(()=>{ks=require("obsidian"),Ks=class{constructor(e){this.menu=new ks.Menu,this.options=e,this.buildMenu()}buildMenu(){this.getRecurrenceOptions().forEach(t=>{this.menu.addItem(r=>{let s=t.label;t.icon&&r.setIcon(t.icon),t.value===this.options.currentValue&&(s=`\u2713 ${t.label}`),r.setTitle(s),r.onClick(async()=>{this.options.onSelect(t.value)})})}),this.menu.addSeparator(),this.menu.addItem(t=>{t.setTitle("Custom recurrence..."),t.setIcon("settings"),t.onClick(async()=>{this.showCustomRecurrenceModal()})}),this.options.currentValue&&this.menu.addItem(t=>{t.setTitle("Clear recurrence"),t.setIcon("x"),t.onClick(async()=>{this.options.onSelect(null)})})}getRecurrenceOptions(){let e=[],t=new Date,r=["SU","MO","TU","WE","TH","FR","SA"],s=["January","February","March","April","May","June","July","August","September","October","November","December"],i=r[t.getDay()],a=t.getDate(),o=t.getMonth()+1,l=s[t.getMonth()],c=t.toLocaleDateString("en-US",{weekday:"long"}),d=this.formatDateForDTSTART(t);if(this.options.currentValue){let u=this.options.currentValue.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(u&&u[1].includes("T")){let f=u[1].split("T")[1];d=`${d}T${f}`}}return e.push({label:"Daily",value:`DTSTART:${d};FREQ=DAILY;INTERVAL=1`,icon:"calendar-days"}),e.push({label:`Weekly on ${c}`,value:`DTSTART:${d};FREQ=WEEKLY;INTERVAL=1;BYDAY=${i}`,icon:"calendar"}),e.push({label:`Every 2 weeks on ${c}`,value:`DTSTART:${d};FREQ=WEEKLY;INTERVAL=2;BYDAY=${i}`,icon:"calendar"}),e.push({label:`Monthly on the ${this.getOrdinal(a)}`,value:`DTSTART:${d};FREQ=MONTHLY;INTERVAL=1;BYMONTHDAY=${a}`,icon:"calendar-range"}),e.push({label:`Every 3 months on the ${this.getOrdinal(a)}`,value:`DTSTART:${d};FREQ=MONTHLY;INTERVAL=3;BYMONTHDAY=${a}`,icon:"calendar-range"}),e.push({label:`Yearly on ${l} ${this.getOrdinal(a)}`,value:`DTSTART:${d};FREQ=YEARLY;INTERVAL=1;BYMONTH=${o};BYMONTHDAY=${a}`,icon:"calendar-clock"}),e.push({label:"Weekdays only",value:`DTSTART:${d};FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR`,icon:"briefcase"}),e}formatDateForDTSTART(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}${r}${s}`}getOrdinal(e){let t=["th","st","nd","rd"],r=e%100;return e+(t[(r-20)%10]||t[r]||t[0])}showCustomRecurrenceModal(){new nw(this.options.app,this.options.currentValue||"",e=>{e&&this.options.onSelect(e)}).open()}show(e){this.menu.showAtMouseEvent(e)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4})}},nw=class extends ks.Modal{constructor(t,r,s){super(t);this.frequency="DAILY";this.interval=1;this.byDay=[];this.byMonthDay=[];this.byMonth=[];this.until="";this.endType="never";this.dtstart="";this.dtstartTime="";this.currentValue=r,this.onSubmit=s,this.parseCurrentValue()}parseCurrentValue(){if(!this.currentValue){this.dtstart=this.formatTodayForInput();return}let t=this.currentValue.split(";");for(let r of t){let[s,i]=r.split("=");switch(s){case"DTSTART":if(i.length>=8){if(this.dtstart=`${i.slice(0,4)}-${i.slice(4,6)}-${i.slice(6,8)}`,i.length>8&&i.includes("T")){let a=i.slice(9);a.length>=4&&(this.dtstartTime=`${a.slice(0,2)}:${a.slice(2,4)}`)}}else{let a=new Date(i);isNaN(a.getTime())?this.dtstart=this.formatTodayForInput():this.dtstart=i}break;case"FREQ":this.frequency=i;break;case"INTERVAL":this.interval=parseInt(i)||1;break;case"BYDAY":{let a=i.split(","),o=[];for(let l of a){let c=l.match(/^(-?\d+)([A-Z]{2})$/);c?(this.bySetPos=parseInt(c[1]),o.push(c[2])):o.push(l)}this.byDay=o;break}case"BYMONTHDAY":this.byMonthDay=i.split(",").map(a=>parseInt(a));break;case"BYMONTH":this.byMonth=i.split(",").map(a=>parseInt(a));break;case"BYSETPOS":this.bySetPos=parseInt(i);break;case"COUNT":this.count=parseInt(i),this.endType="count";break;case"UNTIL":i.length===8?this.until=`${i.slice(0,4)}-${i.slice(4,6)}-${i.slice(6,8)}`:this.until=i,this.endType="until";break}}}formatTodayForInput(){let t=new Date,r=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${r}-${s}-${i}`}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Custom Recurrence"}),new ks.Setting(t).setName("Start date").setDesc("The date when the recurrence pattern begins").addText(ee=>{ee.inputEl.type="date",ee.setValue(this.dtstart).onChange(oe=>{this.dtstart=oe})}),new ks.Setting(t).setName("Start time").setDesc("The time when recurring instances should appear (optional)").addText(ee=>{ee.inputEl.type="time",ee.setValue(this.dtstartTime).onChange(oe=>{this.dtstartTime=oe})}),new ks.Setting(t).setName("Frequency").addDropdown(ee=>{ee.addOption("DAILY","Daily").addOption("WEEKLY","Weekly").addOption("MONTHLY","Monthly").addOption("YEARLY","Yearly").setValue(this.frequency).onChange(oe=>{this.frequency=oe,this.updateFrequencySpecificVisibility()})}),new ks.Setting(t).setName("Interval").setDesc("Every X days/weeks/months/years").addText(ee=>{ee.setValue(this.interval.toString()).onChange(oe=>{this.interval=parseInt(oe)||1})});let r=new ks.Setting(t).setName("Days of week").setDesc("Select specific days (for weekly recurrence)"),s=r.controlEl.createDiv("days-container");[{key:"MO",label:"Mon"},{key:"TU",label:"Tue"},{key:"WE",label:"Wed"},{key:"TH",label:"Thu"},{key:"FR",label:"Fri"},{key:"SA",label:"Sat"},{key:"SU",label:"Sun"}].forEach(ee=>{let oe=s.createEl("label",{cls:"day-checkbox"});oe.style.display="inline-block",oe.style.marginRight="8px";let pt=oe.createEl("input",{type:"checkbox"});pt.checked=this.byDay.includes(ee.key),pt.addEventListener("change",()=>{pt.checked?this.byDay.includes(ee.key)||this.byDay.push(ee.key):this.byDay=this.byDay.filter(Yt=>Yt!==ee.key)}),oe.createSpan({text:` ${ee.label}`})});let a=new ks.Setting(t).setName("Monthly recurrence").setDesc("Choose how to repeat monthly"),o=a.controlEl.createDiv("monthly-options"),l=o.createEl("label",{cls:"radio-option"});l.style.display="block",l.style.marginBottom="8px";let c=l.createEl("input",{type:"radio",value:"bydate"});c.name="monthly-type",c.checked=this.byMonthDay.length>0||this.byDay.length===0&&this.bySetPos===void 0,l.createSpan({text:" On day "});let d=l.createEl("select");d.style.marginLeft="4px",d.style.marginRight="4px";for(let ee=1;ee<=31;ee++){let oe=d.createEl("option",{value:ee.toString(),text:ee.toString()});(this.byMonthDay.length>0&&this.byMonthDay[0]===ee||this.byMonthDay.length===0&&ee===new Date().getDate())&&(oe.selected=!0)}l.createSpan({text:" of each month"});let u=o.createEl("label",{cls:"radio-option"});u.style.display="block",u.style.marginBottom="8px";let f=u.createEl("input",{type:"radio",value:"byday"});f.name="monthly-type",f.checked=this.byDay.length>0&&this.bySetPos!==void 0,u.createSpan({text:" On the "});let h=u.createEl("select");h.style.marginLeft="4px",h.style.marginRight="4px";let p=[{value:"1",text:"first"},{value:"2",text:"second"},{value:"3",text:"third"},{value:"4",text:"fourth"},{value:"-1",text:"last"}];p.forEach(ee=>{let oe=h.createEl("option",{value:ee.value,text:ee.text});(this.bySetPos===parseInt(ee.value)||!this.bySetPos&&ee.value==="1")&&(oe.selected=!0)});let m=u.createEl("select");m.style.marginLeft="4px",m.style.marginRight="4px";let g=[{value:"MO",text:"Monday"},{value:"TU",text:"Tuesday"},{value:"WE",text:"Wednesday"},{value:"TH",text:"Thursday"},{value:"FR",text:"Friday"},{value:"SA",text:"Saturday"},{value:"SU",text:"Sunday"}],T=["SU","MO","TU","WE","TH","FR","SA"][new Date().getDay()];g.forEach(ee=>{let oe=m.createEl("option",{value:ee.value,text:ee.text});(this.byDay.length>0&&this.byDay[0]===ee.value||this.byDay.length===0&&ee.value===T)&&(oe.selected=!0)}),u.createSpan({text:" of each month"});let w=new ks.Setting(t).setName("Yearly recurrence").setDesc("Choose how to repeat yearly"),b=w.controlEl.createDiv("yearly-options"),E=b.createEl("label",{cls:"radio-option"});E.style.display="block",E.style.marginBottom="8px";let S=E.createEl("input",{type:"radio",value:"bydate"});S.name="yearly-type",S.checked=this.byMonthDay.length>0||this.byDay.length===0&&this.bySetPos===void 0,E.createSpan({text:" On "});let D=E.createEl("select");D.style.marginLeft="4px",D.style.marginRight="4px";let x=["January","February","March","April","May","June","July","August","September","October","November","December"];x.forEach((ee,oe)=>{let pt=D.createEl("option",{value:(oe+1).toString(),text:ee});(this.byMonth.length>0&&this.byMonth[0]===oe+1||this.byMonth.length===0&&oe+1===new Date().getMonth()+1)&&(pt.selected=!0)});let M=E.createEl("select");M.style.marginLeft="4px",M.style.marginRight="4px";for(let ee=1;ee<=31;ee++){let oe=M.createEl("option",{value:ee.toString(),text:ee.toString()});(this.byMonthDay.length>0&&this.byMonthDay[0]===ee||this.byMonthDay.length===0&&ee===new Date().getDate())&&(oe.selected=!0)}E.createSpan({text:" each year"});let B=b.createEl("label",{cls:"radio-option"});B.style.display="block",B.style.marginBottom="8px";let Q=B.createEl("input",{type:"radio",value:"byday"});Q.name="yearly-type",Q.checked=this.byDay.length>0&&this.bySetPos!==void 0,B.createSpan({text:" On the "});let P=B.createEl("select");P.style.marginLeft="4px",P.style.marginRight="4px",p.forEach(ee=>{let oe=P.createEl("option",{value:ee.value,text:ee.text});(this.bySetPos===parseInt(ee.value)||!this.bySetPos&&ee.value==="1")&&(oe.selected=!0)});let I=B.createEl("select");I.style.marginLeft="4px",I.style.marginRight="4px",g.forEach(ee=>{let oe=I.createEl("option",{value:ee.value,text:ee.text});(this.byDay.length>0&&this.byDay[0]===ee.value||this.byDay.length===0&&ee.value===T)&&(oe.selected=!0)});let A=B.createEl("select");A.style.marginLeft="4px",A.style.marginRight="4px",x.forEach((ee,oe)=>{let pt=A.createEl("option",{value:(oe+1).toString(),text:ee});(this.byMonth.length>0&&this.byMonth[0]===oe+1||this.byMonth.length===0&&oe+1===new Date().getMonth()+1)&&(pt.selected=!0)}),B.createSpan({text:" each year"}),new ks.Setting(t).setName("End condition").setDesc("Choose when the recurrence should end");let j=t.createDiv("end-condition-container"),U=j.createEl("label",{cls:"radio-option"});U.style.display="block",U.style.marginBottom="8px";let V=U.createEl("input",{type:"radio",value:"never"});V.name="end-type",V.checked=this.endType==="never",U.createSpan({text:" Never ends"});let F=j.createEl("label",{cls:"radio-option"});F.style.display="block",F.style.marginBottom="8px";let $=F.createEl("input",{type:"radio",value:"count"});$.name="end-type",$.checked=this.endType==="count",F.createSpan({text:" End after "});let Z=F.createEl("input",{type:"number",placeholder:"10"});Z.style.width="60px",Z.style.marginLeft="4px",Z.style.marginRight="4px",Z.value=this.count?this.count.toString():"",F.createSpan({text:" occurrences"});let re=j.createEl("label",{cls:"radio-option"});re.style.display="block",re.style.marginBottom="8px";let z=re.createEl("input",{type:"radio",value:"until"});z.name="end-type",z.checked=this.endType==="until",re.createSpan({text:" End on "});let he=re.createEl("input",{type:"date"});he.style.marginLeft="4px",he.value=this.until?this.until.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"):"",V.addEventListener("change",()=>{V.checked&&(this.endType="never")}),$.addEventListener("change",()=>{$.checked&&(this.endType="count")}),z.addEventListener("change",()=>{z.checked&&(this.endType="until")}),Z.addEventListener("input",()=>{this.count=parseInt(Z.value)||void 0,Z.value&&($.checked=!0,this.endType="count")}),he.addEventListener("input",()=>{this.until=he.value?he.value.replace(/-/g,""):"",he.value&&(z.checked=!0,this.endType="until")}),this.updateFrequencySpecificVisibility=()=>{r.settingEl.style.display=this.frequency==="WEEKLY"?"flex":"none",a.settingEl.style.display=this.frequency==="MONTHLY"?"flex":"none",w.settingEl.style.display=this.frequency==="YEARLY"?"flex":"none"},this.updateFrequencySpecificVisibility();let Ae=t.createDiv("button-container");Ae.style.display="flex",Ae.style.justifyContent="flex-end",Ae.style.gap="8px",Ae.style.marginTop="16px",Ae.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),Ae.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",()=>{let ee=c.checked?"bydate":"byday",oe=S.checked?"bydate":"byday";this.frequency==="MONTHLY"?ee==="bydate"?(this.byMonthDay=[parseInt(d.value)],this.byDay=[],this.bySetPos=void 0):(this.byMonthDay=[],this.byDay=[m.value],this.bySetPos=parseInt(h.value)):this.frequency==="YEARLY"&&(oe==="bydate"?(this.byMonth=[parseInt(D.value)],this.byMonthDay=[parseInt(M.value)],this.byDay=[],this.bySetPos=void 0):(this.byMonth=[parseInt(A.value)],this.byMonthDay=[],this.byDay=[I.value],this.bySetPos=parseInt(P.value)));let pt=this.buildRRule(ee,oe);this.onSubmit(pt),this.close()})}updateFrequencySpecificVisibility(){}buildRRule(t,r){let s=[];if(this.dtstart){let i=this.dtstart.replace(/-/g,"");if(this.dtstartTime){let a=this.dtstartTime.replace(":","")+"00Z";i=`${i}T${a}`}s.push(`DTSTART:${i}`)}switch(s.push(`FREQ=${this.frequency}`),this.interval>1&&s.push(`INTERVAL=${this.interval}`),this.frequency){case"WEEKLY":this.byDay.length>0&&s.push(`BYDAY=${this.byDay.join(",")}`);break;case"MONTHLY":if(t==="bydate"){let i=this.byMonthDay.length>0?this.byMonthDay[0]:new Date().getDate();s.push(`BYMONTHDAY=${i}`)}else if(t==="byday"&&this.byDay.length>0){let i=this.bySetPos||1;s.push(`BYDAY=${i}${this.byDay[0]}`)}break;case"YEARLY":if(r==="bydate"){let i=this.byMonth.length>0?this.byMonth[0]:new Date().getMonth()+1,a=this.byMonthDay.length>0?this.byMonthDay[0]:new Date().getDate();s.push(`BYMONTH=${i}`),s.push(`BYMONTHDAY=${a}`)}else if(r==="byday"){let i=this.byMonth.length>0?this.byMonth[0]:new Date().getMonth()+1;if(s.push(`BYMONTH=${i}`),this.byDay.length>0){let a=this.bySetPos||1;s.push(`BYDAY=${a}${this.byDay[0]}`)}}break}switch(this.endType){case"count":this.count&&this.count>0&&s.push(`COUNT=${this.count}`);break;case"until":if(this.until){let i=this.until.replace(/-/g,"");s.push(`UNTIL=${i}`)}break}return s.join(";")}onClose(){let{contentEl:t}=this;t.empty()}}});var yt,rc,iw=v(()=>{yt=require("obsidian");Ne();Sm();Dm();em();AA();ec();tc();rc=class{constructor(e){this.menu=new yt.Menu,this.options=e,this.buildMenu()}buildMenu(){var r;let{task:e,plugin:t}=this.options;if(this.menu.addItem(s=>{s.setTitle("Status"),s.setIcon("circle");let i=s.setSubmenu();this.addStatusOptions(i,e,t)}),e.recurrence){this.menu.addSeparator();let s=ue(this.options.targetDate),i=((r=e.complete_instances)==null?void 0:r.includes(s))||!1;this.menu.addItem(a=>{a.setTitle(i?"Mark incomplete for this date":"Mark complete for this date"),a.setIcon(i?"x":"check"),a.onClick(async()=>{var o,l;try{await t.toggleRecurringTaskComplete(e,this.options.targetDate),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error toggling recurring task completion:",{error:d,taskPath:e.path}),new yt.Notice(`Failed to toggle recurring task completion: ${d}`)}})})}this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Priority"),s.setIcon("star");let i=s.setSubmenu();this.addPriorityOptions(i,e,t)}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Due date"),s.setIcon("calendar");let i=s.setSubmenu();this.addDateOptions(i,e.due,async a=>{var o,l;try{await t.updateTaskProperty(e,"due",a||void 0),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error updating task due date:",{error:d,taskPath:e.path}),new yt.Notice(`Failed to update task due date: ${d}`)}},()=>{t.openDueDateModal(e)})}),this.menu.addItem(s=>{s.setTitle("Scheduled date"),s.setIcon("calendar-clock");let i=s.setSubmenu();this.addDateOptions(i,e.scheduled,async a=>{var o,l;try{await t.updateTaskProperty(e,"scheduled",a||void 0),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error updating task scheduled date:",{error:d,taskPath:e.path}),new yt.Notice(`Failed to update task scheduled date: ${d}`)}},()=>{t.openScheduledDateModal(e)})}),this.menu.addItem(s=>{s.setTitle("Reminders"),s.setIcon("bell");let i=s.setSubmenu();this.addQuickRemindersSection(i,e,t,"due","Remind before due..."),this.addQuickRemindersSection(i,e,t,"scheduled","Remind before scheduled..."),i.addSeparator(),i.addItem(a=>{a.setTitle("Manage All Reminders..."),a.setIcon("settings"),a.onClick(()=>{new Pi(t.app,t,e,async l=>{var c,d;try{await t.updateTaskProperty(e,"reminders",l.length>0?l:void 0),(d=(c=this.options).onUpdate)==null||d.call(c)}catch(u){console.error("Error updating reminders:",u),new yt.Notice("Failed to update reminders")}}).open()})}),e.reminders&&e.reminders.length>0&&i.addItem(a=>{a.setTitle("Clear All Reminders"),a.setIcon("trash"),a.onClick(async()=>{var o,l;try{await t.updateTaskProperty(e,"reminders",void 0),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){console.error("Error clearing reminders:",c),new yt.Notice("Failed to clear reminders")}})})}),this.menu.addSeparator(),this.menu.addItem(s=>{let i=t.getActiveTimeSession(e);s.setTitle(i?"Stop time tracking":"Start time tracking"),s.setIcon(i?"pause":"play"),s.onClick(async()=>{var o,l;t.getActiveTimeSession(e)?await t.stopTimeTracking(e):await t.startTimeTracking(e),(l=(o=this.options).onUpdate)==null||l.call(o)})}),this.menu.addItem(s=>{s.setTitle(e.archived?"Unarchive":"Archive"),s.setIcon(e.archived?"archive-restore":"archive"),s.onClick(async()=>{var i,a;try{await t.toggleTaskArchive(e),(a=(i=this.options).onUpdate)==null||a.call(i)}catch(o){let l=o instanceof Error?o.message:String(o);console.error("Error toggling task archive:",{error:l,taskPath:e.path}),new yt.Notice(`Failed to toggle task archive: ${l}`)}})}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Open note"),s.setIcon("file-text"),s.onClick(()=>{let i=t.app.vault.getAbstractFileByPath(e.path);i instanceof yt.TFile&&t.app.workspace.getLeaf(!1).openFile(i)})}),this.menu.addItem(s=>{s.setTitle("Copy task title"),s.setIcon("copy"),s.onClick(async()=>{try{await navigator.clipboard.writeText(e.title),new yt.Notice("Task title copied to clipboard")}catch(i){new yt.Notice("Failed to copy to clipboard")}})}),this.menu.addItem(s=>{s.setTitle("Note actions"),s.setIcon("file-text");let i=s.setSubmenu(),a=t.app.vault.getAbstractFileByPath(e.path);if(a instanceof yt.TFile){try{t.app.workspace.trigger("file-menu",i,a,"file-explorer")}catch(o){console.debug("Native file menu not available, using fallback")}i.addItem(o=>{o.setTitle("Rename"),o.setIcon("pencil"),o.onClick(async()=>{try{let l=a.basename,c=await _A(t.app,{title:"Rename File",placeholder:"Enter new name",initialValue:l});if(c&&c.trim()!==""&&c!==l){let d=a.extension,u=c.endsWith(`.${d}`)?c:`${c}.${d}`,f=a.parent?`${a.parent.path}/${u}`:u;await t.app.vault.rename(a,f),new yt.Notice(`Renamed to "${u}"`),this.options.onUpdate&&this.options.onUpdate()}}catch(l){console.error("Error renaming file:",l),new yt.Notice("Failed to rename file")}})}),i.addItem(o=>{o.setTitle("Delete"),o.setIcon("trash"),o.onClick(async()=>{await aa(t.app,{title:"Delete File",message:`Are you sure you want to delete "${a.name}"?`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})&&t.app.vault.trash(a,!0)})}),i.addSeparator(),i.addItem(o=>{o.setTitle("Copy path"),o.setIcon("copy"),o.onClick(async()=>{try{await navigator.clipboard.writeText(a.path),new yt.Notice("File path copied to clipboard")}catch(l){new yt.Notice("Failed to copy file path")}})}),i.addItem(o=>{o.setTitle("Copy Obsidian URL"),o.setIcon("link"),o.onClick(async()=>{try{let l=`obsidian://open?vault=${encodeURIComponent(t.app.vault.getName())}&file=${encodeURIComponent(a.path)}`;await navigator.clipboard.writeText(l),new yt.Notice("Obsidian URL copied to clipboard")}catch(l){new yt.Notice("Failed to copy Obsidian URL")}})}),i.addSeparator(),i.addItem(o=>{o.setTitle("Show in file explorer"),o.setIcon("folder-open"),o.onClick(()=>{t.app.workspace.getLeaf().setViewState({type:"file-explorer",state:{}}).then(()=>{let l=t.app.workspace.getLeavesOfType("file-explorer")[0];l!=null&&l.view&&"revealInFolder"in l.view&&l.view.revealInFolder(a)})})})}}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Add to calendar"),s.setIcon("calendar-plus");let i=s.setSubmenu();i.addItem(a=>{a.setTitle("Google Calendar"),a.setIcon("external-link"),a.onClick(()=>{$n.openCalendarURL({type:"google",task:e,useScheduledAsDue:!0})})}),i.addItem(a=>{a.setTitle("Outlook Calendar"),a.setIcon("external-link"),a.onClick(()=>{$n.openCalendarURL({type:"outlook",task:e,useScheduledAsDue:!0})})}),i.addItem(a=>{a.setTitle("Yahoo Calendar"),a.setIcon("external-link"),a.onClick(()=>{$n.openCalendarURL({type:"yahoo",task:e,useScheduledAsDue:!0})})}),i.addSeparator(),i.addItem(a=>{a.setTitle("Download .ics file"),a.setIcon("download"),a.onClick(()=>{$n.downloadICSFile(e)})})}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Recurrence"),s.setIcon("refresh-ccw");let i=s.setSubmenu(),a=typeof e.recurrence=="string"?e.recurrence:void 0;this.addRecurrenceOptions(i,a,async o=>{var l,c;try{await t.updateTaskProperty(e,"recurrence",o||void 0),(c=(l=this.options).onUpdate)==null||c.call(l)}catch(d){let u=d instanceof Error?d.message:String(d);console.error("Error updating task recurrence:",{error:u,taskPath:e.path}),new yt.Notice(`Failed to update task recurrence: ${u}`)}},t)}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Create subtask"),s.setIcon("plus"),s.onClick(()=>{let i=t.app.vault.getAbstractFileByPath(e.path);if(i instanceof yt.TFile){let a=`[[${i.basename}]]`;t.openTaskCreationModal({projects:[a]})}})}),setTimeout(()=>{this.updateMainMenuIconColors(e,t)},10)}updateMainMenuIconColors(e,t){let r=document.querySelector(".menu");if(!r)return;r.querySelectorAll(".menu-item").forEach(i=>{let a=i.querySelector(".menu-item-title"),o=i.querySelector(".menu-item-icon");if(a&&o){let l=a.textContent;if(l==="Status"){let c=t.settings.customStatuses.find(d=>d.value===e.status);c&&c.color&&(o.style.color=c.color)}else if(l==="Priority"){let c=t.settings.customPriorities.find(d=>d.value===e.priority);c&&c.color&&(o.style.color=c.color)}}})}addStatusOptions(e,t,r){this.getStatusOptions(t,r).forEach((i,a)=>{e.addItem(o=>{let l=i.label;o.setIcon("circle"),i.value===t.status&&(l=`\u2713 ${i.label}`),o.setTitle(l),o.onClick(async()=>{var c,d;try{await r.updateTaskProperty(t,"status",i.value),(d=(c=this.options).onUpdate)==null||d.call(c)}catch(u){let f=u instanceof Error?u.message:String(u);console.error("Error updating task status:",{error:f,taskPath:t.path}),new yt.Notice(`Failed to update task status: ${f}`)}}),i.color&&setTimeout(()=>{let c=o.dom||o.domEl;if(c){let d=c.querySelector(".menu-item-icon");d&&(d.style.color=i.color)}},10)})})}addPriorityOptions(e,t,r){r.priorityManager.getPrioritiesByWeight().forEach(i=>{e.addItem(a=>{let o=i.label;a.setIcon("star"),i.value===t.priority&&(o=`\u2713 ${i.label}`),a.setTitle(o),a.onClick(async()=>{var l,c;try{await r.updateTaskProperty(t,"priority",i.value),(c=(l=this.options).onUpdate)==null||c.call(l)}catch(d){let u=d instanceof Error?d.message:String(d);console.error("Error updating task priority:",{error:u,taskPath:t.path}),new yt.Notice(`Failed to update task priority: ${u}`)}}),i.color&&setTimeout(()=>{let l=a.dom||a.domEl;if(l){let c=l.querySelector(".menu-item-icon");c&&(c.style.color=i.color)}},10)})})}addDateOptions(e,t,r,s){let a=new ts({currentValue:t,onSelect:d=>{r(d)},onCustomDate:s}).getDateOptions(),o=a.filter(d=>d.label.startsWith("+")||d.label.startsWith("-"));o.length>0&&(o.forEach(d=>{e.addItem(u=>{u.setTitle(d.label),d.icon&&u.setIcon(d.icon),u.onClick(()=>{r(d.value)})})}),e.addSeparator()),a.filter(d=>!d.label.startsWith("+")&&!d.label.startsWith("-")&&!["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(d.label)).forEach(d=>{e.addItem(u=>{let f=d.value===t;u.setTitle(f?`\u2713 ${d.label}`:d.label),d.icon&&u.setIcon(d.icon),u.onClick(()=>{r(d.value)})})});let c=a.filter(d=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(d.label));c.length>0&&(e.addSeparator(),e.addItem(d=>{d.setTitle("Weekdays"),d.setIcon("calendar");let u=d.setSubmenu();c.forEach(f=>{u.addItem(h=>{let p=f.value===t;h.setTitle(p?`\u2713 ${f.label}`:f.label),h.setIcon("calendar"),h.onClick(()=>{r(f.value)})})})})),e.addSeparator(),e.addItem(d=>{d.setTitle("Pick date & time..."),d.setIcon("calendar"),d.onClick(()=>{s()})}),t&&e.addItem(d=>{d.setTitle("Clear date"),d.setIcon("x"),d.onClick(()=>{r(null)})})}addRecurrenceOptions(e,t,r,s){let i=new Date,a=["SU","MO","TU","WE","TH","FR","SA"],o=["January","February","March","April","May","June","July","August","September","October","November","December"],l=a[i.getDay()],c=i.getDate(),d=i.getMonth()+1,u=o[i.getMonth()],f=i.toLocaleDateString("en-US",{weekday:"long"}),h=y=>{let T=y.getFullYear(),w=String(y.getMonth()+1).padStart(2,"0"),b=String(y.getDate()).padStart(2,"0");return`${T}${w}${b}`},p=y=>{let T=["th","st","nd","rd"],w=y%100;return y+(T[(w-20)%10]||T[w]||T[0])},m=h(i);[{label:"Daily",value:`DTSTART:${m};FREQ=DAILY;INTERVAL=1`,icon:"calendar-days"},{label:`Weekly on ${f}`,value:`DTSTART:${m};FREQ=WEEKLY;INTERVAL=1;BYDAY=${l}`,icon:"calendar"},{label:`Every 2 weeks on ${f}`,value:`DTSTART:${m};FREQ=WEEKLY;INTERVAL=2;BYDAY=${l}`,icon:"calendar"},{label:`Monthly on the ${p(c)}`,value:`DTSTART:${m};FREQ=MONTHLY;INTERVAL=1;BYMONTHDAY=${c}`,icon:"calendar-range"},{label:`Every 3 months on the ${p(c)}`,value:`DTSTART:${m};FREQ=MONTHLY;INTERVAL=3;BYMONTHDAY=${c}`,icon:"calendar-range"},{label:`Yearly on ${u} ${p(c)}`,value:`DTSTART:${m};FREQ=YEARLY;INTERVAL=1;BYMONTH=${d};BYMONTHDAY=${c}`,icon:"calendar-clock"},{label:"Weekdays only",value:`DTSTART:${m};FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR`,icon:"briefcase"}].forEach(y=>{e.addItem(T=>{let w=y.value===t;T.setTitle(w?`\u2713 ${y.label}`:y.label),T.setIcon(y.icon),T.onClick(()=>{r(y.value)})})}),e.addSeparator(),e.addItem(y=>{y.setTitle("Custom recurrence..."),y.setIcon("settings"),y.onClick(()=>{new Ks({currentValue:typeof t=="string"?t:void 0,onSelect:r,app:s.app}).showCustomRecurrenceModal()})}),t&&e.addItem(y=>{y.setTitle("Clear recurrence"),y.setIcon("x"),y.onClick(()=>{r(null)})})}getStatusOptions(e,t){let r=t.settings.customStatuses,s=[];if(r&&r.length>0){let i=[...r].sort((o,l)=>o.order-l.order);(e.recurrence?i.filter(o=>o.value!=="completed"):i).forEach(o=>{s.push({label:o.label,value:o.value,color:o.color})})}return s}addQuickRemindersSection(e,t,r,s,i){if(!(s==="due"?t.due:t.scheduled)){e.addItem(o=>{o.setTitle(i),o.setIcon("bell"),o.setDisabled(!0)});return}e.addItem(o=>{o.setTitle(i),o.setIcon("bell");let l=o.setSubmenu();[{label:"At time of event",offset:"PT0M"},{label:"5 minutes before",offset:"-PT5M"},{label:"15 minutes before",offset:"-PT15M"},{label:"1 hour before",offset:"-PT1H"},{label:"1 day before",offset:"-P1D"}].forEach(d=>{l.addItem(u=>{u.setTitle(d.label),u.onClick(async()=>{await this.addQuickReminder(t,r,s,d.offset,d.label)})})})})}async addQuickReminder(e,t,r,s,i){var l,c;let a={id:`rem_${Date.now()}`,type:"relative",relatedTo:r,offset:s,description:i},o=[...e.reminders||[],a];try{await t.updateTaskProperty(e,"reminders",o),(c=(l=this.options).onUpdate)==null||c.call(l)}catch(d){console.error("Error adding reminder:",d),new yt.Notice("Failed to add reminder")}}show(e){this.menu.showAtMouseEvent(e)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4})}}});var IA,Zs,ru=v(()=>{IA=require("obsidian"),Zs=class{constructor(e){this.menu=new IA.Menu,this.options=e,this.buildMenu()}buildMenu(){let e=this.options.plugin.settings.customPriorities;this.sortedPriorities=[...e].sort((t,r)=>r.weight-t.weight),this.sortedPriorities.forEach(t=>{this.menu.addItem(r=>{let s=t.label;r.setIcon("star"),t.value===this.options.currentValue&&(s=`\u2713 ${t.label}`),r.setTitle(s),r.onClick(async()=>{this.options.onSelect(t.value)})})})}show(e){this.menu.showAtMouseEvent(e),setTimeout(()=>{this.applyColorStyling()},10)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4}),setTimeout(()=>{this.applyColorStyling()},10)}applyColorStyling(){let e=document.querySelector(".menu");if(!e)return;let t=e.querySelectorAll(".menu-item");this.sortedPriorities.forEach((r,s)=>{let i=t[s];if(i&&r.color){let a=i.querySelector(".menu-item-icon");a&&(a.style.color=r.color)}})}}});function sc(n){let{task:e,plugin:t,excludeSelector:r,onSingleClick:s,onDoubleClick:i,contextMenuHandler:a}=n,o=null,l=()=>{let m=t.app.vault.getAbstractFileByPath(e.path);m instanceof RA.TFile&&t.app.workspace.getLeaf(!1).openFile(m)},c=async()=>{await t.openTaskEditModal(e)},d=async m=>{if(s){await s(m);return}if(m.ctrlKey||m.metaKey){l();return}let g=t.settings.singleClickAction;g==="edit"?await c():g==="openNote"&&l()},u=async m=>{if(i){await i(m);return}let g=t.settings.doubleClickAction;g==="edit"?await c():g==="openNote"&&l()};return{clickHandler:async m=>{if(!(r&&m.target.closest(r))){if(t.settings.doubleClickAction==="none"){await d(m);return}o?(clearTimeout(o),o=null,await u(m)):o=setTimeout(()=>{o=null,d(m)},250)}},dblclickHandler:async m=>{},contextmenuHandler:async m=>{m.preventDefault(),a&&await a(m)},cleanup:()=>{o&&(clearTimeout(o),o=null)}}}function nc(n,e){return t=>{e.app.vault.getAbstractFileByPath(n.path)&&e.app.workspace.trigger("hover-link",{event:t,source:"tasknotes-task-card",hoverParent:t.currentTarget,targetEl:t.currentTarget,linktext:n.path,sourcePath:n.path})}}var RA,xm=v(()=>{RA=require("obsidian")});function $u(n,e){if(!n||!e)return 0;let t=n.toLowerCase().split(" ").filter(Boolean),r=e.toLowerCase(),s=0,i=0;for(let a=0;a<t.length;a++){let o=t[a],l=r.indexOf(o,s);if(l===-1)return 0;i+=Math.max(0,100-l),r.startsWith(o,l)&&(i+=10),a>0&&l===s&&(i+=5),s=l+o.length}return i}var lN=v(()=>{});var gk={};st(gk,{FileSuggestHelper:()=>Tz});var cN,Tz,yk=v(()=>{cN=require("obsidian");lN();Gp();oT();Tz={async suggest(n,e,t=20){var i,a;let r=async()=>{var y,T,w,b,E,S,D,x,M,B,Q,P,I,A,j;let o=(T=(y=n==null?void 0:n.app)==null?void 0:y.vault)!=null&&T.getMarkdownFiles?n.app.vault.getMarkdownFiles():[],l=[],c=((E=(b=(w=n.settings)==null?void 0:w.projectAutosuggest)==null?void 0:b.rows)!=null?E:[]).slice(0,3),d=new Set;for(let U of c)try{let V=ia(U);for(let F of V)F.searchable&&!F.property.startsWith("literal:")&&d.add(F.property)}catch(V){}let u=(e||"").toLowerCase(),f=(x=(D=(S=n.settings)==null?void 0:S.projectAutosuggest)==null?void 0:D.requiredTags)!=null?x:[],h=(Q=(B=(M=n.settings)==null?void 0:M.projectAutosuggest)==null?void 0:B.includeFolders)!=null?Q:[],p=Qp((P=n.settings)==null?void 0:P.projectAutosuggest);for(let U of o){let V=n.app.metadataCache.getFileCache(U);if(f.length>0){let z=((I=V==null?void 0:V.tags)==null?void 0:I.map(Nt=>Nt.tag.replace("#","")))||[],he=((A=V==null?void 0:V.frontmatter)==null?void 0:A.tags)||[],Ae=[...z,...Array.isArray(he)?he:[he].filter(Boolean)];if(!f.some(Nt=>Ae.includes(Nt)))continue}if(h.length>0&&!h.some(he=>U.path.startsWith(he)||U.path.startsWith(he+"/")))continue;if(p.enabled){let z=V==null?void 0:V.frontmatter;if(!Kp(z,p))continue}let F=U.basename,$="";if(V!=null&&V.frontmatter){let z=n.fieldMapper.mapFromFrontmatter(V.frontmatter,U.path,n.settings.storeTitleInFilename);$=typeof z.title=="string"?z.title:""}let Z=V!=null&&V.frontmatter?(0,cN.parseFrontMatterAliases)(V.frontmatter)||[]:[],re=0;if(re=Math.max(re,$u(e,F)+15),$&&(re=Math.max(re,$u(e,$)+5)),Array.isArray(Z))for(let z of Z)typeof z=="string"&&(re=Math.max(re,$u(e,z)));if(d.size>0){let z=(V==null?void 0:V.frontmatter)||{};for(let he of d){let Ae="";if(he==="file.path")Ae=U.path;else if(he==="file.parent")Ae=((j=U.parent)==null?void 0:j.path)||"";else if(he==="file.basename")Ae=F;else if(he==="title")Ae=$;else if(he==="aliases")Ae=(Array.isArray(Z)?Z.filter(Nt=>typeof Nt=="string"):[]).join(" ");else{let ve=z[he];ve!=null&&(Array.isArray(ve)?Ae=ve.filter(Nt=>typeof Nt=="string").join(" "):typeof ve=="object"?Ae=JSON.stringify(ve):(typeof ve=="string"||typeof ve=="number"||typeof ve=="boolean")&&(Ae=String(ve)))}if(Ae){let ve=$u(e,Ae),Nt=ve>0?ve:Ae.toLowerCase().includes(u)?30:0;Nt>0&&(re=Math.max(re,Nt))}}}if(re>0){let z=[];$&&$!==F&&z.push(`title: ${$}`);let he=Array.isArray(Z)?Z.filter(ve=>typeof ve=="string"):[];he.length&&z.push(`aliases: ${he.join(", ")}`);let Ae=z.length?`${F} [${z.join(" | ")}]`:F;l.push({insertText:F,displayText:Ae,score:re})}}l.sort((U,V)=>V.score-U.score);let m=[],g=new Set;for(let U of l)if(!g.has(U.insertText)&&(m.push(U),g.add(U.insertText),m.length>=t))break;return m},s=(a=(i=n.settings)==null?void 0:i.suggestionDebounceMs)!=null?a:0;return s?new Promise(o=>{let l=n;l.__fileSuggestTimer&&clearTimeout(l.__fileSuggestTimer),l.__fileSuggestTimer=setTimeout(async()=>{let c=await r();o(c)},s)}):r()}}});var fN=_p((bk,kk)=>{(function(n,e){typeof bk=="object"&&typeof kk!="undefined"?kk.exports=e():typeof define=="function"&&define.amd?define(e):(n=typeof globalThis!="undefined"?globalThis:n||self).dayjs_plugin_quarterOfYear=e()})(bk,(function(){"use strict";var n="month",e="quarter";return function(t,r){var s=r.prototype;s.quarter=function(o){return this.$utils().u(o)?Math.ceil((this.month()+1)/3):this.month(this.month()%3+3*(o-1))};var i=s.add;s.add=function(o,l){return o=Number(o),this.$utils().p(l)===e?this.add(3*o,n):i.bind(this)(o,l)};var a=s.startOf;s.startOf=function(o,l){var c=this.$utils(),d=!!c.u(l)||l;if(c.p(o)===e){var u=this.quarter()-1;return d?this.month(3*u).startOf(n).startOf("day"):this.month(3*u+2).endOf(n).endOf("day")}return a.bind(this)(o,l)}}}))});var Ke=_p((Ek,Sk)=>{(function(n,e){typeof Ek=="object"&&typeof Sk!="undefined"?Sk.exports=e():typeof define=="function"&&define.amd?define(e):(n=typeof globalThis!="undefined"?globalThis:n||self).dayjs=e()})(Ek,(function(){"use strict";var n=1e3,e=6e4,t=36e5,r="millisecond",s="second",i="minute",a="hour",o="day",l="week",c="month",d="quarter",u="year",f="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(P){var I=["th","st","nd","rd"],A=P%100;return"["+P+(I[(A-20)%10]||I[A]||I[0])+"]"}},y=function(P,I,A){var j=String(P);return!j||j.length>=I?P:""+Array(I+1-j.length).join(A)+P},T={s:y,z:function(P){var I=-P.utcOffset(),A=Math.abs(I),j=Math.floor(A/60),U=A%60;return(I<=0?"+":"-")+y(j,2,"0")+":"+y(U,2,"0")},m:function P(I,A){if(I.date()<A.date())return-P(A,I);var j=12*(A.year()-I.year())+(A.month()-I.month()),U=I.clone().add(j,c),V=A-U<0,F=I.clone().add(j+(V?-1:1),c);return+(-(j+(A-U)/(V?U-F:F-U))||0)},a:function(P){return P<0?Math.ceil(P)||0:Math.floor(P)},p:function(P){return{M:c,y:u,w:l,d:o,D:f,h:a,m:i,s,ms:r,Q:d}[P]||String(P||"").toLowerCase().replace(/s$/,"")},u:function(P){return P===void 0}},w="en",b={};b[w]=g;var E="$isDayjsObject",S=function(P){return P instanceof B||!(!P||!P[E])},D=function P(I,A,j){var U;if(!I)return w;if(typeof I=="string"){var V=I.toLowerCase();b[V]&&(U=V),A&&(b[V]=A,U=V);var F=I.split("-");if(!U&&F.length>1)return P(F[0])}else{var $=I.name;b[$]=I,U=$}return!j&&U&&(w=U),U||!j&&w},x=function(P,I){if(S(P))return P.clone();var A=typeof I=="object"?I:{};return A.date=P,A.args=arguments,new B(A)},M=T;M.l=D,M.i=S,M.w=function(P,I){return x(P,{locale:I.$L,utc:I.$u,x:I.$x,$offset:I.$offset})};var B=(function(){function P(A){this.$L=D(A.locale,null,!0),this.parse(A),this.$x=this.$x||A.x||{},this[E]=!0}var I=P.prototype;return I.parse=function(A){this.$d=(function(j){var U=j.date,V=j.utc;if(U===null)return new Date(NaN);if(M.u(U))return new Date;if(U instanceof Date)return new Date(U);if(typeof U=="string"&&!/Z$/i.test(U)){var F=U.match(p);if(F){var $=F[2]-1||0,Z=(F[7]||"0").substring(0,3);return V?new Date(Date.UTC(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,Z)):new Date(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,Z)}}return new Date(U)})(A),this.init()},I.init=function(){var A=this.$d;this.$y=A.getFullYear(),this.$M=A.getMonth(),this.$D=A.getDate(),this.$W=A.getDay(),this.$H=A.getHours(),this.$m=A.getMinutes(),this.$s=A.getSeconds(),this.$ms=A.getMilliseconds()},I.$utils=function(){return M},I.isValid=function(){return this.$d.toString()!==h},I.isSame=function(A,j){var U=x(A);return this.startOf(j)<=U&&U<=this.endOf(j)},I.isAfter=function(A,j){return x(A)<this.startOf(j)},I.isBefore=function(A,j){return this.endOf(j)<x(A)},I.$g=function(A,j,U){return M.u(A)?this[j]:this.set(U,A)},I.unix=function(){return Math.floor(this.valueOf()/1e3)},I.valueOf=function(){return this.$d.getTime()},I.startOf=function(A,j){var U=this,V=!!M.u(j)||j,F=M.p(A),$=function(ee,oe){var pt=M.w(U.$u?Date.UTC(U.$y,oe,ee):new Date(U.$y,oe,ee),U);return V?pt:pt.endOf(o)},Z=function(ee,oe){return M.w(U.toDate()[ee].apply(U.toDate("s"),(V?[0,0,0,0]:[23,59,59,999]).slice(oe)),U)},re=this.$W,z=this.$M,he=this.$D,Ae="set"+(this.$u?"UTC":"");switch(F){case u:return V?$(1,0):$(31,11);case c:return V?$(1,z):$(0,z+1);case l:var ve=this.$locale().weekStart||0,Nt=(re<ve?re+7:re)-ve;return $(V?he-Nt:he+(6-Nt),z);case o:case f:return Z(Ae+"Hours",0);case a:return Z(Ae+"Minutes",1);case i:return Z(Ae+"Seconds",2);case s:return Z(Ae+"Milliseconds",3);default:return this.clone()}},I.endOf=function(A){return this.startOf(A,!1)},I.$set=function(A,j){var U,V=M.p(A),F="set"+(this.$u?"UTC":""),$=(U={},U[o]=F+"Date",U[f]=F+"Date",U[c]=F+"Month",U[u]=F+"FullYear",U[a]=F+"Hours",U[i]=F+"Minutes",U[s]=F+"Seconds",U[r]=F+"Milliseconds",U)[V],Z=V===o?this.$D+(j-this.$W):j;if(V===c||V===u){var re=this.clone().set(f,1);re.$d[$](Z),re.init(),this.$d=re.set(f,Math.min(this.$D,re.daysInMonth())).$d}else $&&this.$d[$](Z);return this.init(),this},I.set=function(A,j){return this.clone().$set(A,j)},I.get=function(A){return this[M.p(A)]()},I.add=function(A,j){var U,V=this;A=Number(A);var F=M.p(j),$=function(z){var he=x(V);return M.w(he.date(he.date()+Math.round(z*A)),V)};if(F===c)return this.set(c,this.$M+A);if(F===u)return this.set(u,this.$y+A);if(F===o)return $(1);if(F===l)return $(7);var Z=(U={},U[i]=e,U[a]=t,U[s]=n,U)[F]||1,re=this.$d.getTime()+A*Z;return M.w(re,this)},I.subtract=function(A,j){return this.add(-1*A,j)},I.format=function(A){var j=this,U=this.$locale();if(!this.isValid())return U.invalidDate||h;var V=A||"YYYY-MM-DDTHH:mm:ssZ",F=M.z(this),$=this.$H,Z=this.$m,re=this.$M,z=U.weekdays,he=U.months,Ae=U.meridiem,ve=function(oe,pt,Yt,Nn){return oe&&(oe[pt]||oe(j,V))||Yt[pt].slice(0,Nn)},Nt=function(oe){return M.s($%12||12,oe,"0")},ee=Ae||function(oe,pt,Yt){var Nn=oe<12?"AM":"PM";return Yt?Nn.toLowerCase():Nn};return V.replace(m,(function(oe,pt){return pt||(function(Yt){switch(Yt){case"YY":return String(j.$y).slice(-2);case"YYYY":return M.s(j.$y,4,"0");case"M":return re+1;case"MM":return M.s(re+1,2,"0");case"MMM":return ve(U.monthsShort,re,he,3);case"MMMM":return ve(he,re);case"D":return j.$D;case"DD":return M.s(j.$D,2,"0");case"d":return String(j.$W);case"dd":return ve(U.weekdaysMin,j.$W,z,2);case"ddd":return ve(U.weekdaysShort,j.$W,z,3);case"dddd":return z[j.$W];case"H":return String($);case"HH":return M.s($,2,"0");case"h":return Nt(1);case"hh":return Nt(2);case"a":return ee($,Z,!0);case"A":return ee($,Z,!1);case"m":return String(Z);case"mm":return M.s(Z,2,"0");case"s":return String(j.$s);case"ss":return M.s(j.$s,2,"0");case"SSS":return M.s(j.$ms,3,"0");case"Z":return F}return null})(oe)||F.replace(":","")}))},I.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},I.diff=function(A,j,U){var V,F=this,$=M.p(j),Z=x(A),re=(Z.utcOffset()-this.utcOffset())*e,z=this-Z,he=function(){return M.m(F,Z)};switch($){case u:V=he()/12;break;case c:V=he();break;case d:V=he()/3;break;case l:V=(z-re)/6048e5;break;case o:V=(z-re)/864e5;break;case a:V=z/t;break;case i:V=z/e;break;case s:V=z/n;break;default:V=z}return U?V:M.a(V)},I.daysInMonth=function(){return this.endOf(c).$D},I.$locale=function(){return b[this.$L]},I.locale=function(A,j){if(!A)return this.$L;var U=this.clone(),V=D(A,j,!0);return V&&(U.$L=V),U},I.clone=function(){return M.w(this.$d,this)},I.toDate=function(){return new Date(this.valueOf())},I.toJSON=function(){return this.isValid()?this.toISOString():null},I.toISOString=function(){return this.$d.toISOString()},I.toString=function(){return this.$d.toUTCString()},P})(),Q=B.prototype;return x.prototype=Q,[["$ms",r],["$s",s],["$m",i],["$H",a],["$W",o],["$M",c],["$y",u],["$D",f]].forEach((function(P){Q[P[1]]=function(I){return this.$g(I,P[0],P[1])}})),x.extend=function(P,I){return P.$i||(P(I,B,x),P.$i=!0),x},x.locale=D,x.isDayjs=S,x.unix=function(P){return x(1e3*P)},x.en=b[w],x.Ls=b,x.p={},x}))});var O,Te,Cs,We=v(()=>{(function(n){n[n.AM=0]="AM",n[n.PM=1]="PM"})(O||(O={}));(function(n){n[n.SUNDAY=0]="SUNDAY",n[n.MONDAY=1]="MONDAY",n[n.TUESDAY=2]="TUESDAY",n[n.WEDNESDAY=3]="WEDNESDAY",n[n.THURSDAY=4]="THURSDAY",n[n.FRIDAY=5]="FRIDAY",n[n.SATURDAY=6]="SATURDAY"})(Te||(Te={}));(function(n){n[n.JANUARY=1]="JANUARY",n[n.FEBRUARY=2]="FEBRUARY",n[n.MARCH=3]="MARCH",n[n.APRIL=4]="APRIL",n[n.MAY=5]="MAY",n[n.JUNE=6]="JUNE",n[n.JULY=7]="JULY",n[n.AUGUST=8]="AUGUST",n[n.SEPTEMBER=9]="SEPTEMBER",n[n.OCTOBER=10]="OCTOBER",n[n.NOVEMBER=11]="NOVEMBER",n[n.DECEMBER=12]="DECEMBER"})(Cs||(Cs={}))});function pN(n,e){n.assign("day",e.getDate()),n.assign("month",e.getMonth()+1),n.assign("year",e.getFullYear())}function mN(n,e){n.assign("hour",e.getHours()),n.assign("minute",e.getMinutes()),n.assign("second",e.getSeconds()),n.assign("millisecond",e.getMilliseconds()),n.assign("meridiem",e.getHours()<12?O.AM:O.PM)}function Ng(n,e){n.imply("day",e.getDate()),n.imply("month",e.getMonth()+1),n.imply("year",e.getFullYear())}function gN(n,e){n.imply("hour",e.getHours()),n.imply("minute",e.getMinutes()),n.imply("second",e.getSeconds()),n.imply("millisecond",e.getMilliseconds()),n.imply("meridiem",e.getHours()<12?O.AM:O.PM)}var Dk=v(()=>{We()});function Ma(n,e,t,r,s=0){let i=0,a=0;for(;a<r;)i++,new Date(n,e-1,i).getDay()===t&&a++;return new Date(n,e-1,i,s)}function yN(n,e,t,r=0){let s=t===0?7:t,i=new Date(n,e-1+1,1,12),a=i.getDay()===0?7:i.getDay(),o;return a===s?o=7:a<s?o=7+a-s:o=a-s,i.setDate(i.getDate()-o),new Date(n,e-1,i.getDate(),r)}function Og(n,e,t={}){var s;if(n==null)return null;if(typeof n=="number")return n;let r=(s=t[n])!=null?s:bz[n];return r==null?null:typeof r=="number"?r:e==null?null:(0,xk.default)(e).isAfter(r.dstStart(e.getFullYear()))&&!(0,xk.default)(e).isAfter(r.dstEnd(e.getFullYear()))?r.timezoneOffsetDuringDst:r.timezoneOffsetNonDst}var xk,bz,Ck=v(()=>{xk=Ee(Ke(),1);We();bz={ACDT:630,ACST:570,ADT:-180,AEDT:660,AEST:600,AFT:270,AKDT:-480,AKST:-540,ALMT:360,AMST:-180,AMT:-240,ANAST:720,ANAT:720,AQTT:300,ART:-180,AST:-240,AWDT:540,AWST:480,AZOST:0,AZOT:-60,AZST:300,AZT:240,BNT:480,BOT:-240,BRST:-120,BRT:-180,BST:60,BTT:360,CAST:480,CAT:120,CCT:390,CDT:-300,CEST:120,CET:{timezoneOffsetDuringDst:120,timezoneOffsetNonDst:60,dstStart:n=>yN(n,Cs.MARCH,Te.SUNDAY,2),dstEnd:n=>yN(n,Cs.OCTOBER,Te.SUNDAY,3)},CHADT:825,CHAST:765,CKT:-600,CLST:-180,CLT:-240,COT:-300,CST:-360,CT:{timezoneOffsetDuringDst:-300,timezoneOffsetNonDst:-360,dstStart:n=>Ma(n,Cs.MARCH,Te.SUNDAY,2,2),dstEnd:n=>Ma(n,Cs.NOVEMBER,Te.SUNDAY,1,2)},CVT:-60,CXT:420,ChST:600,DAVT:420,EASST:-300,EAST:-360,EAT:180,ECT:-300,EDT:-240,EEST:180,EET:120,EGST:0,EGT:-60,EST:-300,ET:{timezoneOffsetDuringDst:-240,timezoneOffsetNonDst:-300,dstStart:n=>Ma(n,Cs.MARCH,Te.SUNDAY,2,2),dstEnd:n=>Ma(n,Cs.NOVEMBER,Te.SUNDAY,1,2)},FJST:780,FJT:720,FKST:-180,FKT:-240,FNT:-120,GALT:-360,GAMT:-540,GET:240,GFT:-180,GILT:720,GMT:0,GST:240,GYT:-240,HAA:-180,HAC:-300,HADT:-540,HAE:-240,HAP:-420,HAR:-360,HAST:-600,HAT:-90,HAY:-480,HKT:480,HLV:-210,HNA:-240,HNC:-360,HNE:-300,HNP:-480,HNR:-420,HNT:-150,HNY:-540,HOVT:420,ICT:420,IDT:180,IOT:360,IRDT:270,IRKST:540,IRKT:540,IRST:210,IST:330,JST:540,KGT:360,KRAST:480,KRAT:480,KST:540,KUYT:240,LHDT:660,LHST:630,LINT:840,MAGST:720,MAGT:720,MART:-510,MAWT:300,MDT:-360,MESZ:120,MEZ:60,MHT:720,MMT:390,MSD:240,MSK:180,MST:-420,MT:{timezoneOffsetDuringDst:-360,timezoneOffsetNonDst:-420,dstStart:n=>Ma(n,Cs.MARCH,Te.SUNDAY,2,2),dstEnd:n=>Ma(n,Cs.NOVEMBER,Te.SUNDAY,1,2)},MUT:240,MVT:300,MYT:480,NCT:660,NDT:-90,NFT:690,NOVST:420,NOVT:360,NPT:345,NST:-150,NUT:-660,NZDT:780,NZST:720,OMSST:420,OMST:420,PDT:-420,PET:-300,PETST:720,PETT:720,PGT:600,PHOT:780,PHT:480,PKT:300,PMDT:-120,PMST:-180,PONT:660,PST:-480,PT:{timezoneOffsetDuringDst:-420,timezoneOffsetNonDst:-480,dstStart:n=>Ma(n,Cs.MARCH,Te.SUNDAY,2,2),dstEnd:n=>Ma(n,Cs.NOVEMBER,Te.SUNDAY,1,2)},PWT:540,PYST:-180,PYT:-240,RET:240,SAMT:240,SAST:120,SBT:660,SCT:240,SGT:480,SRT:-180,SST:-660,TAHT:-600,TFT:300,TJT:300,TKT:780,TLT:540,TMT:300,TVT:720,ULAT:480,UTC:0,UYST:-120,UYT:-180,UZT:300,VET:-210,VLAST:660,VLAT:660,VUT:660,WAST:120,WAT:60,WEST:60,WESZ:60,WET:0,WEZ:0,WFT:720,WGST:-120,WGT:-180,WIB:420,WIT:540,WITA:480,WST:780,WT:0,YAKST:600,YAKT:600,YAPT:600,YEKST:360,YEKT:360}});function vN(n,e){var r,s,i,a,o,l,c;let t=new Date(n);if(e.y&&(e.year=e.y,delete e.y),e.mo&&(e.month=e.mo,delete e.mo),e.M&&(e.month=e.M,delete e.M),e.w&&(e.week=e.w,delete e.w),e.d&&(e.day=e.d,delete e.d),e.h&&(e.hour=e.h,delete e.h),e.m&&(e.minute=e.m,delete e.m),e.s&&(e.second=e.s,delete e.s),e.ms&&(e.millisecond=e.ms,delete e.ms),"year"in e){let d=Math.floor(e.year);t.setFullYear(t.getFullYear()+d);let u=e.year-d;u>0&&(e.month=(r=e==null?void 0:e.month)!=null?r:0,e.month+=u*12)}if("quarter"in e){let d=Math.floor(e.quarter);t.setMonth(t.getMonth()+d*3)}if("month"in e){let d=Math.floor(e.month);t.setMonth(t.getMonth()+d);let u=e.month-d;u>0&&(e.week=(s=e==null?void 0:e.week)!=null?s:0,e.week+=u*4)}if("week"in e){let d=Math.floor(e.week);t.setDate(t.getDate()+d*7);let u=e.week-d;u>0&&(e.day=(i=e==null?void 0:e.day)!=null?i:0,e.day+=Math.round(u*7))}if("day"in e){let d=Math.floor(e.day);t.setDate(t.getDate()+d);let u=e.day-d;u>0&&(e.hour=(a=e==null?void 0:e.hour)!=null?a:0,e.hour+=Math.round(u*24))}if("hour"in e){let d=Math.floor(e.hour);t.setHours(t.getHours()+d);let u=e.hour-d;u>0&&(e.minute=(o=e==null?void 0:e.minute)!=null?o:0,e.minute+=Math.round(u*60))}if("minute"in e){let d=Math.floor(e.minute);t.setMinutes(t.getMinutes()+d);let u=e.minute-d;u>0&&(e.second=(l=e==null?void 0:e.second)!=null?l:0,e.second+=Math.round(u*60))}if("second"in e){let d=Math.floor(e.second);t.setSeconds(t.getSeconds()+d);let u=e.second-d;u>0&&(e.millisecond=(c=e==null?void 0:e.millisecond)!=null?c:0,e.millisecond+=Math.round(u*1e3))}if("millisecond"in e){let d=Math.floor(e.millisecond);t.setMilliseconds(t.getMilliseconds()+d)}return t}function Pc(n){let e={};for(let t in n)e[t]=-n[t];return e}var zu=v(()=>{});var TN,Mk,Ze,Y,ze,xe=v(()=>{TN=Ee(fN(),1),Mk=Ee(Ke(),1);Dk();Ck();zu();Mk.default.extend(TN.default);Ze=class n{constructor(e,t){R(this,"instant");R(this,"timezoneOffset");this.instant=e!=null?e:new Date,this.timezoneOffset=t!=null?t:null}static fromDate(e){return new n(e)}static fromInput(e,t){var i;if(e instanceof Date)return n.fromDate(e);let r=(i=e==null?void 0:e.instant)!=null?i:new Date,s=Og(e==null?void 0:e.timezone,r,t);return new n(r,s)}getDateWithAdjustedTimezone(){let e=new Date(this.instant);return this.timezoneOffset!==null&&e.setMinutes(e.getMinutes()-this.getSystemTimezoneAdjustmentMinute(this.instant)),e}getSystemTimezoneAdjustmentMinute(e,t){var i;(!e||e.getTime()<0)&&(e=new Date);let r=-e.getTimezoneOffset(),s=(i=t!=null?t:this.timezoneOffset)!=null?i:r;return r-s}getTimezoneOffset(){var e;return(e=this.timezoneOffset)!=null?e:-this.instant.getTimezoneOffset()}},Y=class n{constructor(e,t){R(this,"knownValues");R(this,"impliedValues");R(this,"reference");R(this,"_tags",new Set);if(this.reference=e,this.knownValues={},this.impliedValues={},t)for(let s in t)this.knownValues[s]=t[s];let r=e.getDateWithAdjustedTimezone();this.imply("day",r.getDate()),this.imply("month",r.getMonth()+1),this.imply("year",r.getFullYear()),this.imply("hour",12),this.imply("minute",0),this.imply("second",0),this.imply("millisecond",0)}get(e){return e in this.knownValues?this.knownValues[e]:e in this.impliedValues?this.impliedValues[e]:null}isCertain(e){return e in this.knownValues}getCertainComponents(){return Object.keys(this.knownValues)}imply(e,t){return e in this.knownValues?this:(this.impliedValues[e]=t,this)}assign(e,t){return this.knownValues[e]=t,delete this.impliedValues[e],this}delete(e){delete this.knownValues[e],delete this.impliedValues[e]}clone(){let e=new n(this.reference);e.knownValues={},e.impliedValues={};for(let t in this.knownValues)e.knownValues[t]=this.knownValues[t];for(let t in this.impliedValues)e.impliedValues[t]=this.impliedValues[t];return e}isOnlyDate(){return!this.isCertain("hour")&&!this.isCertain("minute")&&!this.isCertain("second")}isOnlyTime(){return!this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")&&!this.isCertain("year")}isOnlyWeekdayComponent(){return this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")}isDateWithUnknownYear(){return this.isCertain("month")&&!this.isCertain("year")}isValidDate(){let e=this.dateWithoutTimezoneAdjustment();return!(e.getFullYear()!==this.get("year")||e.getMonth()!==this.get("month")-1||e.getDate()!==this.get("day")||this.get("hour")!=null&&e.getHours()!=this.get("hour")||this.get("minute")!=null&&e.getMinutes()!=this.get("minute"))}toString(){return`[ParsingComponents {
            tags: ${JSON.stringify(Array.from(this._tags).sort())}, 
            knownValues: ${JSON.stringify(this.knownValues)}, 
            impliedValues: ${JSON.stringify(this.impliedValues)}}, 
            reference: ${JSON.stringify(this.reference)}]`}dayjs(){return(0,Mk.default)(this.dateWithoutTimezoneAdjustment())}date(){let e=this.dateWithoutTimezoneAdjustment(),t=this.reference.getSystemTimezoneAdjustmentMinute(e,this.get("timezoneOffset"));return new Date(e.getTime()+t*6e4)}addTag(e){return this._tags.add(e),this}addTags(e){for(let t of e)this._tags.add(t);return this}tags(){return new Set(this._tags)}dateWithoutTimezoneAdjustment(){let e=new Date(this.get("year"),this.get("month")-1,this.get("day"),this.get("hour"),this.get("minute"),this.get("second"),this.get("millisecond"));return e.setFullYear(this.get("year")),e}static createRelativeFromReference(e,t){let r=vN(e.getDateWithAdjustedTimezone(),t),s=new n(e);return s.addTag("result/relativeDate"),t.hour||t.minute||t.second?(s.addTag("result/relativeDateAndTime"),mN(s,r),pN(s,r),s.assign("timezoneOffset",e.getTimezoneOffset())):(gN(s,r),s.imply("timezoneOffset",e.getTimezoneOffset()),t.day?(s.assign("day",r.getDate()),s.assign("month",r.getMonth()+1),s.assign("year",r.getFullYear()),s.assign("weekday",r.getDay())):t.week?(s.assign("day",r.getDate()),s.assign("month",r.getMonth()+1),s.assign("year",r.getFullYear()),s.imply("weekday",r.getDay())):(s.imply("day",r.getDate()),t.month?(s.assign("month",r.getMonth()+1),s.assign("year",r.getFullYear())):(s.imply("month",r.getMonth()+1),t.year?s.assign("year",r.getFullYear()):s.imply("year",r.getFullYear())))),s}},ze=class n{constructor(e,t,r,s,i){R(this,"refDate");R(this,"index");R(this,"text");R(this,"reference");R(this,"start");R(this,"end");this.reference=e,this.refDate=e.instant,this.index=t,this.text=r,this.start=s||new Y(e),this.end=i}clone(){let e=new n(this.reference,this.index,this.text);return e.start=this.start?this.start.clone():null,e.end=this.end?this.end.clone():null,e}date(){return this.start.date()}addTag(e){return this.start.addTag(e),this.end&&this.end.addTag(e),this}addTags(e){return this.start.addTags(e),this.end&&this.end.addTags(e),this}tags(){let e=new Set(this.start.tags());if(this.end)for(let t of this.end.tags())e.add(t);return e}toString(){let e=Array.from(this.tags()).sort();return`[ParsingResult {index: ${this.index}, text: '${this.text}', tags: ${JSON.stringify(e)} ...}]`}}});function Vr(n,e,t="\\s{0,5},?\\s{0,5}"){let r=e.replace(/\((?!\?)/g,"(?:");return`${n}${r}(?:${t}${r}){0,10}`}function kz(n){let e;return n instanceof Array?e=[...n]:n instanceof Map?e=Array.from(n.keys()):e=Object.keys(n),e}function q(n){return`(?:${kz(n).sort((t,r)=>r.length-t.length).join("|").replace(/\./g,"\\.")})`}var He=v(()=>{});function as(n){return n<100&&(n>50?n=n+1900:n=n+2e3),n}function rt(n,e,t){let r=(0,wN.default)(n),s=r;s=s.month(t-1),s=s.date(e),s=s.year(r.year());let i=s.add(1,"y"),a=s.add(-1,"y");return Math.abs(i.diff(r))<Math.abs(s.diff(r))?s=i:Math.abs(a.diff(r))<Math.abs(s.diff(r))&&(s=a),s.year()}var wN,Rt=v(()=>{wN=Ee(Ke(),1)});function Ez(n){let e=n.toLowerCase();return Pk[e]!==void 0?Pk[e]:e==="a"||e==="an"||e=="the"?1:e.match(/few/)?3:e.match(/half/)?.5:e.match(/couple/)?2:e.match(/several/)?7:parseFloat(e)}function Ac(n){let e=n.toLowerCase();return _k[e]!==void 0?_k[e]:(e=e.replace(/(?:st|nd|rd|th)$/i,""),parseInt(e))}function _a(n){if(/BE/i.test(n))return n=n.replace(/BE/i,""),parseInt(n)-543;if(/BCE?/i.test(n))return n=n.replace(/BCE?/i,""),-parseInt(n);if(/(AD|CE)/i.test(n))return n=n.replace(/(AD|CE)/i,""),parseInt(n);let e=parseInt(n);return as(e)}function rn(n){let e={},t=n,r=bN.exec(t);for(;r;)Dz(e,r),t=t.substring(r[0].length).trim(),r=bN.exec(t);return Object.keys(e).length==0?null:e}function Dz(n,e){if(e[0].match(/^[a-zA-Z]+$/))return;let t=Ez(e[1]),r=qu[e[2].toLowerCase()];n[r]=t}var Lg,Ak,tn,Pk,_k,kN,qu,EN,_c,Pa,SN,bN,Sz,DN,Hi,Aa,sr=v(()=>{He();Rt();Lg={sunday:0,sun:0,"sun.":0,monday:1,mon:1,"mon.":1,tuesday:2,tue:2,"tue.":2,wednesday:3,wed:3,"wed.":3,thursday:4,thurs:4,"thurs.":4,thur:4,"thur.":4,thu:4,"thu.":4,friday:5,fri:5,"fri.":5,saturday:6,sat:6,"sat.":6},Ak={january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12},tn={...Ak,jan:1,"jan.":1,feb:2,"feb.":2,mar:3,"mar.":3,apr:4,"apr.":4,jun:6,"jun.":6,jul:7,"jul.":7,aug:8,"aug.":8,sep:9,"sep.":9,sept:9,"sept.":9,oct:10,"oct.":10,nov:11,"nov.":11,dec:12,"dec.":12},Pk={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12},_k={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,twentieth:20,"twenty first":21,"twenty-first":21,"twenty second":22,"twenty-second":22,"twenty third":23,"twenty-third":23,"twenty fourth":24,"twenty-fourth":24,"twenty fifth":25,"twenty-fifth":25,"twenty sixth":26,"twenty-sixth":26,"twenty seventh":27,"twenty-seventh":27,"twenty eighth":28,"twenty-eighth":28,"twenty ninth":29,"twenty-ninth":29,thirtieth:30,"thirty first":31,"thirty-first":31},kN={second:"second",seconds:"second",minute:"minute",minutes:"minute",hour:"hour",hours:"hour",day:"d",days:"d",week:"week",weeks:"week",month:"month",months:"month",quarter:"quarter",quarters:"quarter",year:"year",years:"year"},qu={s:"second",sec:"second",second:"second",seconds:"second",m:"minute",min:"minute",mins:"minute",minute:"minute",minutes:"minute",h:"hour",hr:"hour",hrs:"hour",hour:"hour",hours:"hour",d:"d",day:"d",days:"d",w:"w",week:"week",weeks:"week",mo:"month",mon:"month",mos:"month",month:"month",months:"month",qtr:"quarter",quarter:"quarter",quarters:"quarter",y:"year",yr:"year",year:"year",years:"year",...kN},EN=`(?:${q(Pk)}|[0-9]+|[0-9]+\\.[0-9]+|half(?:\\s{0,2}an?)?|an?\\b(?:\\s{0,2}few)?|few|several|the|a?\\s{0,2}couple\\s{0,2}(?:of)?)`;_c=`(?:${q(_k)}|[0-9]{1,2}(?:st|nd|rd|th)?)`;Pa="(?:[1-9][0-9]{0,3}\\s{0,2}(?:BE|AD|BC|BCE|CE)|[1-2][0-9]{3}|[5-9][0-9]|2[0-5])";SN=`(${EN})\\s{0,3}(${q(qu)})`,bN=new RegExp(SN,"i"),Sz=`(${EN})\\s{0,3}(${q(kN)})`,DN="\\s{0,5},?(?:\\s*and)?\\s{0,5}",Hi=Vr("(?:(?:about|around)\\s{0,3})?",SN,DN),Aa=Vr("(?:(?:about|around)\\s{0,3})?",Sz,DN)});var H,se=v(()=>{H=class{constructor(){R(this,"cachedInnerPattern",null);R(this,"cachedPattern",null)}innerPatternHasChange(e,t){return this.innerPattern(e)!==t}patternLeftBoundary(){return"(\\W|^)"}pattern(e){return this.cachedInnerPattern&&!this.innerPatternHasChange(e,this.cachedInnerPattern)?this.cachedPattern:(this.cachedInnerPattern=this.innerPattern(e),this.cachedPattern=new RegExp(`${this.patternLeftBoundary()}${this.cachedInnerPattern.source}`,this.cachedInnerPattern.flags),this.cachedPattern)}extract(e,t){var s;let r=(s=t[1])!=null?s:"";t.index=t.index+r.length,t[0]=t[0].substring(r.length);for(let i=2;i<t.length;i++)t[i-1]=t[i];return this.innerExtract(e,t)}}});var xz,Cz,Mz,Gu,xN=v(()=>{sr();xe();se();xz=new RegExp(`(?:(?:within|in|for)\\s*)?(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${Hi})(?=\\W|$)`,"i"),Cz=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${Hi})(?=\\W|$)`,"i"),Mz=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${Aa})(?=\\W|$)`,"i"),Gu=class extends H{constructor(t){super();R(this,"strictMode");this.strictMode=t}innerPattern(t){return this.strictMode?Mz:t.option.forwardDate?xz:Cz}innerExtract(t,r){if(r[0].match(/^for\s*the\s*\w+/))return null;let s=rn(r[1]);return s?(t.debug(()=>{console.log(s),console.log(Y.createRelativeFromReference(t.reference,s))}),Y.createRelativeFromReference(t.reference,s)):null}}});var Pz,CN,MN,_z,PN,Qu,_N=v(()=>{Rt();sr();sr();sr();He();se();Pz=new RegExp(`(?:on\\s{0,3})?(${_c})(?:\\s{0,3}(?:to|\\-|\\\u2013|until|through|till)?\\s{0,3}(${_c}))?(?:-|/|\\s{0,3}(?:of)?\\s{0,3})(${q(tn)})(?:(?:-|/|,?\\s{0,3})(${Pa}(?!\\w)))?(?=\\W|$)`,"i"),CN=1,MN=2,_z=3,PN=4,Qu=class extends H{innerPattern(){return Pz}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=tn[t[_z].toLowerCase()],i=Ac(t[CN]);if(i>31)return t.index=t.index+t[CN].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[PN]){let a=_a(t[PN]);r.start.assign("year",a)}else{let a=rt(e.refDate,i,s);r.start.imply("year",a)}if(t[MN]){let a=Ac(t[MN]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var Az,Iz,AN,Ik,Rk,Ku,IN=v(()=>{Rt();sr();sr();sr();He();se();Az=new RegExp(`(${q(tn)})(?:-|/|\\s*,?\\s*)(${_c})(?!\\s*(?:am|pm))\\s*(?:(?:to|\\-)\\s*(${_c})\\s*)?(?:(?:-|/|\\s*,\\s*|\\s+)(${Pa}))?(?=\\W|$)(?!\\:\\d)`,"i"),Iz=1,AN=2,Ik=3,Rk=4,Ku=class extends H{constructor(t){super();R(this,"shouldSkipYearLikeDate");this.shouldSkipYearLikeDate=t}innerPattern(){return Az}innerExtract(t,r){let s=tn[r[Iz].toLowerCase()],i=Ac(r[AN]);if(i>31||this.shouldSkipYearLikeDate&&!r[Ik]&&!r[Rk]&&r[AN].match(/^2[0-5]$/))return null;let a=t.createParsingComponents({day:i,month:s}).addTag("parser/ENMonthNameMiddleEndianParser");if(r[Rk]){let c=_a(r[Rk]);a.assign("year",c)}else{let c=rt(t.refDate,i,s);a.imply("year",c)}if(!r[Ik])return a;let o=Ac(r[Ik]),l=t.createParsingResult(r.index,r[0]);return l.start=a,l.end=a.clone(),l.end.assign("day",o),l}}});var Rz,Nz,Oz,RN,Zu,NN=v(()=>{sr();Rt();He();sr();se();Rz=new RegExp(`((?:in)\\s*)?(${q(tn)})\\s*(?:(?:,|-|of)?\\s*(${Pa})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`,"i"),Nz=1,Oz=2,RN=3,Zu=class extends H{innerPattern(){return Rz}innerExtract(e,t){let r=t[Oz].toLowerCase();if(t[0].length<=3&&!Ak[r])return null;let s=e.createParsingResult(t.index+(t[Nz]||"").length,t.index+t[0].length);s.start.imply("day",1),s.start.addTag("parser/ENMonthNameParser");let i=tn[r];if(s.start.assign("month",i),t[RN]){let a=_a(t[RN]);s.start.assign("year",a)}else{let a=rt(e.refDate,1,i);s.start.imply("year",a)}return s}}});var Lz,Fz,Hz,ON,Bz,Xu,LN=v(()=>{sr();He();se();Lz=new RegExp(`([0-9]{4})[-\\.\\/\\s](?:(${q(tn)})|([0-9]{1,2}))[-\\.\\/\\s]([0-9]{1,2})(?=\\W|$)`,"i"),Fz=1,Hz=2,ON=3,Bz=4,Xu=class extends H{constructor(t){super();R(this,"strictMonthDateOrder");this.strictMonthDateOrder=t}innerPattern(){return Lz}innerExtract(t,r){let s=parseInt(r[Fz]),i=parseInt(r[Bz]),a=r[ON]?parseInt(r[ON]):tn[r[Hz].toLowerCase()];if(a<1||a>12){if(this.strictMonthDateOrder)return null;i>=1&&i<=12&&([a,i]=[i,a])}return i<1||i>31?null:{day:i,month:a,year:s}}}});var Uz,jz,Wz,Ju,FN=v(()=>{se();Uz=new RegExp("([0-9]|0[1-9]|1[012])/([0-9]{4})","i"),jz=1,Wz=2,Ju=class extends H{innerPattern(){return Uz}innerExtract(e,t){let r=parseInt(t[Wz]),s=parseInt(t[jz]);return e.createParsingComponents().imply("day",1).assign("month",s).assign("year",r)}}});function Vz(n,e,t,r){return new RegExp(`${n}${e}(\\d{1,4})(?:(?:\\.|:|\uFF1A)(\\d{1,2})(?:(?::|\uFF1A)(\\d{2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${t}`,r)}function $z(n,e){return new RegExp(`^(${n})(\\d{1,4})(?:(?:\\.|\\:|\\\uFF1A)(\\d{1,2})(?:(?:\\.|\\:|\\\uFF1A)(\\d{1,2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${e}`,"i")}var HN,Ic,Fg,Hg,eh,cr,Bi=v(()=>{We();HN=2,Ic=3,Fg=4,Hg=5,eh=6,cr=class{constructor(e=!1){R(this,"strictMode");R(this,"cachedPrimaryPrefix",null);R(this,"cachedPrimarySuffix",null);R(this,"cachedPrimaryTimePattern",null);R(this,"cachedFollowingPhase",null);R(this,"cachedFollowingSuffix",null);R(this,"cachedFollowingTimePatten",null);this.strictMode=e}patternFlags(){return"i"}primaryPatternLeftBoundary(){return"(^|\\s|T|\\b)"}primarySuffix(){return"(?!/)(?=\\W|$)"}followingSuffix(){return"(?!/)(?=\\W|$)"}pattern(e){return this.getPrimaryTimePatternThroughCache()}extract(e,t){let r=this.extractPrimaryTimeComponents(e,t);if(!r)return t[0].match(/^\d{4}/)?(t.index+=4,null):(t.index+=t[0].length,null);let s=t.index+t[1].length,i=t[0].substring(t[1].length),a=e.createParsingResult(s,i,r);t.index+=t[0].length;let o=e.text.substring(t.index),c=this.getFollowingTimePatternThroughCache().exec(o);return i.match(/^\d{3,4}/)&&c&&(c[0].match(/^\s*([+-])\s*\d{2,4}$/)||c[0].match(/^\s*([+-])\s*\d{2}\W\d{2}/))?null:!c||c[0].match(/^\s*([+-])\s*\d{3,4}$/)?this.checkAndReturnWithoutFollowingPattern(a):(a.end=this.extractFollowingTimeComponents(e,c,a),a.end&&(a.text+=c[0]),this.checkAndReturnWithFollowingPattern(a))}extractPrimaryTimeComponents(e,t,r=!1){let s=e.createParsingComponents(),i=0,a=null,o=parseInt(t[HN]);if(o>100){if(this.strictMode||t[Ic]!=null)return null;i=o%100,o=Math.floor(o/100)}if(o>24)return null;if(t[Ic]!=null){if(t[Ic].length==1&&!t[eh])return null;i=parseInt(t[Ic])}if(i>=60)return null;if(o>12&&(a=O.PM),t[eh]!=null){if(o>12)return null;let l=t[eh][0].toLowerCase();l=="a"&&(a=O.AM,o==12&&(o=0)),l=="p"&&(a=O.PM,o!=12&&(o+=12))}if(s.assign("hour",o),s.assign("minute",i),a!==null?s.assign("meridiem",a):o<12?s.imply("meridiem",O.AM):s.imply("meridiem",O.PM),t[Hg]!=null){let l=parseInt(t[Hg].substring(0,3));if(l>=1e3)return null;s.assign("millisecond",l)}if(t[Fg]!=null){let l=parseInt(t[Fg]);if(l>=60)return null;s.assign("second",l)}return s}extractFollowingTimeComponents(e,t,r){let s=e.createParsingComponents();if(t[Hg]!=null){let l=parseInt(t[Hg].substring(0,3));if(l>=1e3)return null;s.assign("millisecond",l)}if(t[Fg]!=null){let l=parseInt(t[Fg]);if(l>=60)return null;s.assign("second",l)}let i=parseInt(t[HN]),a=0,o=-1;if(t[Ic]!=null?a=parseInt(t[Ic]):i>100&&(a=i%100,i=Math.floor(i/100)),a>=60||i>24)return null;if(i>=12&&(o=O.PM),t[eh]!=null){if(i>12)return null;let l=t[eh][0].toLowerCase();l=="a"&&(o=O.AM,i==12&&(i=0,s.isCertain("day")||s.imply("day",s.get("day")+1))),l=="p"&&(o=O.PM,i!=12&&(i+=12)),r.start.isCertain("meridiem")||(o==O.AM?(r.start.imply("meridiem",O.AM),r.start.get("hour")==12&&r.start.assign("hour",0)):(r.start.imply("meridiem",O.PM),r.start.get("hour")!=12&&r.start.assign("hour",r.start.get("hour")+12)))}return s.assign("hour",i),s.assign("minute",a),o>=0?s.assign("meridiem",o):r.start.isCertain("meridiem")&&r.start.get("hour")>12?r.start.get("hour")-12>i?s.imply("meridiem",O.AM):i<=12&&(s.assign("hour",i+12),s.assign("meridiem",O.PM)):i>12?s.imply("meridiem",O.PM):i<=12&&s.imply("meridiem",O.AM),s.date().getTime()<r.start.date().getTime()&&s.imply("day",s.get("day")+1),s}checkAndReturnWithoutFollowingPattern(e){if(e.text.match(/^\d$/)||e.text.match(/^\d\d\d+$/)||e.text.match(/\d[apAP]$/))return null;let t=e.text.match(/[^\d:.](\d[\d.]+)$/);if(t){let r=t[1];if(this.strictMode||r.includes(".")&&!r.match(/\d(\.\d{2})+$/)||parseInt(r)>24)return null}return e}checkAndReturnWithFollowingPattern(e){if(e.text.match(/^\d+-\d+$/))return null;let t=e.text.match(/[^\d:.](\d[\d.]+)\s*-\s*(\d[\d.]+)$/);if(t){if(this.strictMode)return null;let r=t[1],s=t[2];if(s.includes(".")&&!s.match(/\d(\.\d{2})+$/))return null;let i=parseInt(s),a=parseInt(r);if(i>24||a>24)return null}return e}getPrimaryTimePatternThroughCache(){let e=this.primaryPrefix(),t=this.primarySuffix();return this.cachedPrimaryPrefix===e&&this.cachedPrimarySuffix===t?this.cachedPrimaryTimePattern:(this.cachedPrimaryTimePattern=Vz(this.primaryPatternLeftBoundary(),e,t,this.patternFlags()),this.cachedPrimaryPrefix=e,this.cachedPrimarySuffix=t,this.cachedPrimaryTimePattern)}getFollowingTimePatternThroughCache(){let e=this.followingPhase(),t=this.followingSuffix();return this.cachedFollowingPhase===e&&this.cachedFollowingSuffix===t?this.cachedFollowingTimePatten:(this.cachedFollowingTimePatten=$z(e,t),this.cachedFollowingPhase=e,this.cachedFollowingSuffix=t,this.cachedFollowingTimePatten)}}});var th,BN=v(()=>{We();Bi();th=class extends cr{constructor(e){super(e)}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|to|until|through|till|\\?)\\s*"}primaryPrefix(){return"(?:(?:at|from)\\s*)??"}primarySuffix(){return"(?:\\s*(?:o\\W*clock|at\\s*night|in\\s*the\\s*(?:morning|afternoon)))?(?!/)(?=\\W|$)"}extractPrimaryTimeComponents(e,t){let r=super.extractPrimaryTimeComponents(e,t);if(!r)return r;if(t[0].endsWith("night")){let s=r.get("hour");s>=6&&s<12?(r.assign("hour",r.get("hour")+12),r.assign("meridiem",O.PM)):s<6&&r.assign("meridiem",O.AM)}if(t[0].endsWith("afternoon")){r.assign("meridiem",O.PM);let s=r.get("hour");s>=0&&s<=6&&r.assign("hour",r.get("hour")+12)}return t[0].endsWith("morning")&&(r.assign("meridiem",O.AM),r.get("hour")<12&&r.assign("hour",r.get("hour"))),r.addTag("parser/ENTimeExpressionParser")}extractFollowingTimeComponents(e,t,r){let s=super.extractFollowingTimeComponents(e,t,r);return s&&s.addTag("parser/ENTimeExpressionParser"),s}}});var Yz,zz,rh,UN=v(()=>{sr();xe();se();zu();Yz=new RegExp(`(${Hi})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),zz=new RegExp(`(${Aa})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),rh=class extends H{constructor(t){super();R(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?zz:Yz}innerExtract(t,r){let s=rn(r[1]);return s?Y.createRelativeFromReference(t.reference,Pc(s)):null}}});var qz,Gz,Qz,sh,jN=v(()=>{sr();xe();se();qz=new RegExp(`(${Hi})\\s{0,5}(?:later|after|from now|henceforth|forward|out)(?=(?:\\W|$))`,"i"),Gz=new RegExp(`(${Aa})\\s{0,5}(later|after|from now)(?=\\W|$)`,"i"),Qz=1,sh=class extends H{constructor(t){super();R(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?Gz:qz}innerExtract(t,r){let s=rn(r[Qz]);return s?Y.createRelativeFromReference(t.reference,s):null}}});var Rc,os,Ui=v(()=>{Rc=class{refine(e,t){return t.filter(r=>this.isValid(e,r))}},os=class{refine(e,t){if(t.length<2)return t;let r=[],s=t[0],i=null;for(let a=1;a<t.length;a++){i=t[a];let o=e.text.substring(s.index+s.text.length,i.index);if(!this.shouldMergeResults(o,s,i,e))r.push(s),s=i;else{let l=s,c=i,d=this.mergeResults(o,l,c,e);e.debug(()=>{console.log(`${this.constructor.name} merged ${l} and ${c} into ${d}`)}),s=d}}return s!=null&&r.push(s),r}}});var vt,sn=v(()=>{Ui();vt=class extends os{shouldMergeResults(e,t,r){return!t.end&&!r.end&&e.match(this.patternBetween())!=null}mergeResults(e,t,r){if(!t.start.isOnlyWeekdayComponent()&&!r.start.isOnlyWeekdayComponent()&&(r.start.getCertainComponents().forEach(i=>{t.start.isCertain(i)||t.start.imply(i,r.start.get(i))}),t.start.getCertainComponents().forEach(i=>{r.start.isCertain(i)||r.start.imply(i,t.start.get(i))})),t.start.date().getTime()>r.start.date().getTime()){let i=t.start.dayjs(),a=r.start.dayjs();r.start.isOnlyWeekdayComponent()&&a.add(7,"days").isAfter(i)?(a=a.add(7,"days"),r.start.imply("day",a.date()),r.start.imply("month",a.month()+1),r.start.imply("year",a.year())):t.start.isOnlyWeekdayComponent()&&i.add(-7,"days").isBefore(a)?(i=i.add(-7,"days"),t.start.imply("day",i.date()),t.start.imply("month",i.month()+1),t.start.imply("year",i.year())):r.start.isDateWithUnknownYear()&&a.add(1,"years").isAfter(i)?(a=a.add(1,"years"),r.start.imply("year",a.year())):t.start.isDateWithUnknownYear()&&i.add(-1,"years").isBefore(a)?(i=i.add(-1,"years"),t.start.imply("year",i.year())):[r,t]=[t,r]}let s=t.clone();return s.start=t.start,s.end=r.start,s.index=Math.min(t.index,r.index),t.index<r.index?s.text=t.text+e+r.text:s.text=r.text+e+t.text,s}}});var nh,WN=v(()=>{sn();nh=class extends vt{patternBetween(){return/^\s*(to|-|–|until|through|till)\s*$/i}}});function xn(n,e){e=e.add(1,"day"),ft(n,e),ri(n,e)}function VN(n,e){e=e.add(1,"day"),Nk(n,e),ri(n,e)}function ft(n,e){n.assign("day",e.date()),n.assign("month",e.month()+1),n.assign("year",e.year())}function $N(n,e){n.assign("hour",e.hour()),n.assign("minute",e.minute()),n.assign("second",e.second()),n.assign("millisecond",e.millisecond()),n.get("hour")<12?n.assign("meridiem",O.AM):n.assign("meridiem",O.PM)}function Nk(n,e){n.imply("day",e.date()),n.imply("month",e.month()+1),n.imply("year",e.year())}function ri(n,e){n.imply("hour",e.hour()),n.imply("minute",e.minute()),n.imply("second",e.second()),n.imply("millisecond",e.millisecond())}var Ms=v(()=>{We()});function Ok(n,e){let t=n.clone(),r=n.start,s=e.start;if(t.start=YN(r,s),n.end!=null||e.end!=null){let i=n.end==null?n.start:n.end,a=e.end==null?e.start:e.end,o=YN(i,a);if(n.end==null&&o.date().getTime()<t.start.date().getTime()){let l=o.dayjs().add(1,"day");o.isCertain("day")?ft(o,l):Nk(o,l)}t.end=o}return t}function YN(n,e){let t=n.clone();return e.isCertain("hour")?(t.assign("hour",e.get("hour")),t.assign("minute",e.get("minute")),e.isCertain("second")?(t.assign("second",e.get("second")),e.isCertain("millisecond")?t.assign("millisecond",e.get("millisecond")):t.imply("millisecond",e.get("millisecond"))):(t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond")))):(t.imply("hour",e.get("hour")),t.imply("minute",e.get("minute")),t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond"))),e.isCertain("timezoneOffset")&&t.assign("timezoneOffset",e.get("timezoneOffset")),e.isCertain("meridiem")?t.assign("meridiem",e.get("meridiem")):e.get("meridiem")!=null&&t.get("meridiem")==null&&t.imply("meridiem",e.get("meridiem")),t.get("meridiem")==O.PM&&t.get("hour")<12&&(e.isCertain("hour")?t.assign("hour",t.get("hour")+12):t.imply("hour",t.get("hour")+12)),t.addTags(n.tags()),t.addTags(e.tags()),t}var zN=v(()=>{We();Ms()});var Tt,nn=v(()=>{Ui();zN();Tt=class extends os{shouldMergeResults(e,t,r){return(t.start.isOnlyDate()&&r.start.isOnlyTime()||r.start.isOnlyDate()&&t.start.isOnlyTime())&&e.match(this.patternBetween())!=null}mergeResults(e,t,r){let s=t.start.isOnlyDate()?Ok(t,r):Ok(r,t);return s.index=t.index,s.text=t.text+e+r.text,s}}});var Nc,qN=v(()=>{nn();Nc=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|at|after|before|on|of|,|-|\\.|\u2219|:)?\\s*$")}}});var Kz,ih,GN=v(()=>{Ck();Kz=new RegExp("^\\s*,?\\s*\\(?([A-Z]{2,4})\\)?(?=\\W|$)","i"),ih=class{constructor(e){R(this,"timezoneOverrides");this.timezoneOverrides=e}refine(e,t){var s;let r=(s=e.option.timezones)!=null?s:{};return t.forEach(i=>{var h,p;let a=e.text.substring(i.index+i.text.length),o=Kz.exec(a);if(!o)return;let l=o[1].toUpperCase(),c=(p=(h=i.start.date())!=null?h:i.refDate)!=null?p:new Date,d={...this.timezoneOverrides,...r},u=Og(l,c,d);if(u==null)return;e.debug(()=>{console.log(`Extracting timezone: '${l}' into: ${u} for: ${i.start}`)});let f=i.start.get("timezoneOffset");f!==null&&u!=f&&(i.start.isCertain("timezoneOffset")||l!=o[1])||i.start.isOnlyDate()&&l!=o[1]||(i.text+=o[0],i.start.isCertain("timezoneOffset")||i.start.assign("timezoneOffset",u),i.end!=null&&!i.end.isCertain("timezoneOffset")&&i.end.assign("timezoneOffset",u))}),t}}});var Zz,Xz,Jz,eq,Cn,ah=v(()=>{Zz=new RegExp("^\\s*(?:\\(?(?:GMT|UTC)\\s?)?([+-])(\\d{1,2})(?::?(\\d{2}))?\\)?","i"),Xz=1,Jz=2,eq=3,Cn=class{refine(e,t){return t.forEach(function(r){if(r.start.isCertain("timezoneOffset"))return;let s=e.text.substring(r.index+r.text.length),i=Zz.exec(s);if(!i)return;e.debug(()=>{console.log(`Extracting timezone: '${i[0]}' into : ${r}`)});let a=parseInt(i[Jz]),o=parseInt(i[eq]||"0"),l=a*60+o;l>840||(i[Xz]==="-"&&(l=-l),r.end!=null&&r.end.assign("timezoneOffset",l),r.start.assign("timezoneOffset",l),r.text+=i[0])}),t}}});var Ia,Lk=v(()=>{Ia=class{refine(e,t){if(t.length<2)return t;let r=[],s=t[0];for(let i=1;i<t.length;i++){let a=t[i];if(a.index>=s.index+s.text.length){r.push(s),s=a;continue}let o=null,l=null;a.text.length>s.text.length?(o=a,l=s):(o=s,l=a),e.debug(()=>{console.log(`${this.constructor.name} remove ${l} by ${o}`)}),s=o}return s!=null&&r.push(s),r}}});var QN,oh,KN=v(()=>{QN=Ee(Ke(),1);Dk();oh=class{refine(e,t){return e.option.forwardDate&&t.forEach(r=>{let s=(0,QN.default)(e.reference.getDateWithAdjustedTimezone());if(r.start.isOnlyTime()&&e.reference.instant>r.start.date()){let i=e.reference.getDateWithAdjustedTimezone(),a=new Date(i);a.setDate(a.getDate()+1),Ng(r.start,a),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} time from the ref date (${i}) to the following day (${a})`)}),r.end&&r.end.isOnlyTime()&&(Ng(r.end,a),r.start.date()>r.end.date()&&(a.setDate(a.getDate()+1),Ng(r.end,a)))}if(r.start.isOnlyWeekdayComponent()&&s.isAfter(r.start.dayjs())&&(s.day()>=r.start.get("weekday")?s=s.day(r.start.get("weekday")+7):s=s.day(r.start.get("weekday")),r.start.imply("day",s.date()),r.start.imply("month",s.month()+1),r.start.imply("year",s.year()),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} weekday (${r.start})`)}),r.end&&r.end.isOnlyWeekdayComponent()&&(s.day()>r.end.get("weekday")?s=s.day(r.end.get("weekday")+7):s=s.day(r.end.get("weekday")),r.end.imply("day",s.date()),r.end.imply("month",s.month()+1),r.end.imply("year",s.year()),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} weekday (${r.end})`)}))),r.start.isDateWithUnknownYear()&&s.isAfter(r.start.dayjs()))for(let i=0;i<3&&s.isAfter(r.start.dayjs());i++)r.start.imply("year",r.start.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} year (${r.start})`)}),r.end&&!r.end.isCertain("year")&&(r.end.imply("year",r.end.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} month (${r.start})`)}))}),t}}});var lh,ZN=v(()=>{Ui();lh=class extends Rc{constructor(t){super();R(this,"strictMode");this.strictMode=t}isValid(t,r){return r.text.replace(" ","").match(/^\d*(\.\d*)?$/)?(t.debug(()=>{console.log(`Removing unlikely result '${r.text}'`)}),!1):r.start.isValidDate()?r.end&&!r.end.isValidDate()?(t.debug(()=>{console.log(`Removing invalid result: ${r} (${r.end})`)}),!1):this.strictMode?this.isStrictModeValid(t,r):!0:(t.debug(()=>{console.log(`Removing invalid result: ${r} (${r.start})`)}),!1)}isStrictModeValid(t,r){return r.start.isOnlyWeekdayComponent()?(t.debug(()=>{console.log(`(Strict) Removing weekday only component: ${r} (${r.end})`)}),!1):!0}}});var tq,rq,sq,nq,XN,iq,JN,eO,aq,tO,rO,ji,Bg=v(()=>{se();tq=new RegExp("([0-9]{4})\\-([0-9]{1,2})\\-([0-9]{1,2})(?:T([0-9]{1,2}):([0-9]{1,2})(?::([0-9]{1,2})(?:\\.(\\d{1,4}))?)?(Z|([+-]\\d{2}):?(\\d{2})?)?)?(?=\\W|$)","i"),rq=1,sq=2,nq=3,XN=4,iq=5,JN=6,eO=7,aq=8,tO=9,rO=10,ji=class extends H{innerPattern(){return tq}innerExtract(e,t){let r=e.createParsingComponents({year:parseInt(t[rq]),month:parseInt(t[sq]),day:parseInt(t[nq])});if(t[XN]!=null&&(r.assign("hour",parseInt(t[XN])),r.assign("minute",parseInt(t[iq])),t[JN]!=null&&r.assign("second",parseInt(t[JN])),t[eO]!=null&&r.assign("millisecond",parseInt(t[eO])),t[aq]!=null)){let s=0;if(t[tO]){let i=parseInt(t[tO]),a=0;t[rO]!=null&&(a=parseInt(t[rO])),s=i*60,s<0?s-=a:s+=a}r.assign("timezoneOffset",s)}return r.addTag("parser/ISOFormatParser")}}});var jo,Fk=v(()=>{Ui();jo=class extends os{mergeResults(e,t,r){let s=r.clone();return s.index=t.index,s.text=t.text+e+s.text,s.start.assign("weekday",t.start.get("weekday")),s.end&&s.end.assign("weekday",t.start.get("weekday")),s}shouldMergeResults(e,t,r){return t.start.isOnlyWeekdayComponent()&&!t.start.isCertain("hour")&&r.start.isCertain("day")&&e.match(/^,?\s*$/)!=null}}});function Et(n,e=!1){return n.parsers.unshift(new ji),n.refiners.unshift(new jo),n.refiners.unshift(new Cn),n.refiners.unshift(new Ia),n.refiners.push(new ih),n.refiners.push(new Ia),n.refiners.push(new oh),n.refiners.push(new lh(e)),n}var Ps=v(()=>{GN();ah();Lk();KN();ZN();Bg();Fk()});function Nr(n){let e=(0,Ra.default)(n.getDateWithAdjustedTimezone()),t=new Y(n,{});return ft(t,e),$N(t,e),t.assign("timezoneOffset",n.getTimezoneOffset()),t.addTag("casualReference/now"),t}function dr(n){let e=(0,Ra.default)(n.getDateWithAdjustedTimezone()),t=new Y(n,{});return ft(t,e),ri(t,e),t.addTag("casualReference/today"),t}function Or(n){return Wo(n,1).addTag("casualReference/yesterday")}function Wo(n,e){return si(n,-e)}function Lr(n){return si(n,1).addTag("casualReference/tomorrow")}function si(n,e){let t=(0,Ra.default)(n.getDateWithAdjustedTimezone()),r=new Y(n,{});return t=t.add(e,"day"),ft(r,t),ri(r,t),r}function sO(n,e=22){let t=(0,Ra.default)(n.getDateWithAdjustedTimezone()),r=new Y(n,{});return ft(r,t),r.imply("hour",e),r.imply("meridiem",O.PM),r.addTag("casualReference/tonight"),r}function Ug(n,e=0){let t=(0,Ra.default)(n.getDateWithAdjustedTimezone()),r=new Y(n,{});return t.hour()<6&&(t=t.add(-1,"day")),ft(r,t),r.imply("hour",e),r}function Oc(n,e=20){let t=new Y(n,{});return t.imply("meridiem",O.PM),t.imply("hour",e),t.addTag("casualReference/evening"),t}function jg(n,e=20){let t=(0,Ra.default)(n.getDateWithAdjustedTimezone()),r=new Y(n,{});return t=t.add(-1,"day"),ft(r,t),r.imply("hour",e),r.imply("meridiem",O.PM),r.addTag("casualReference/yesterday"),r.addTag("casualReference/evening"),r}function Vo(n){let e=new Y(n,{}),t=(0,Ra.default)(n.getDateWithAdjustedTimezone());return t.hour()>2&&VN(e,t),e.assign("hour",0),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/midnight"),e}function Lc(n,e=6){let t=new Y(n,{});return t.imply("meridiem",O.AM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/morning"),t}function nO(n,e=15){let t=new Y(n,{});return t.imply("meridiem",O.PM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/afternoon"),t}function Fc(n){let e=new Y(n,{});return e.imply("meridiem",O.AM),e.assign("hour",12),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/noon"),e}var Ra,_s=v(()=>{xe();Ra=Ee(Ke(),1);Ms();We()});var iO,oq,ch,aO=v(()=>{iO=Ee(Ke(),1);se();Ms();_s();oq=/(now|today|tonight|tomorrow|overmorrow|tmr|tmrw|yesterday|last\s*night)(?=\W|$)/i,ch=class extends H{innerPattern(e){return oq}innerExtract(e,t){let r=(0,iO.default)(e.refDate),s=t[0].toLowerCase(),i=e.createParsingComponents();switch(s){case"now":i=Nr(e.reference);break;case"today":i=dr(e.reference);break;case"yesterday":i=Or(e.reference);break;case"tomorrow":case"tmr":case"tmrw":i=Lr(e.reference);break;case"tonight":i=sO(e.reference);break;case"overmorrow":i=si(e.reference,2);break;default:s.match(/last\s*night/)&&(r.hour()>6&&(r=r.add(-1,"day")),ft(i,r),i.imply("hour",0));break}return i.addTag("parser/ENCasualDateParser"),i}}});var lq,dh,oO=v(()=>{se();_s();lq=/(?:this)?\s{0,3}(morning|afternoon|evening|night|midnight|midday|noon)(?=\W|$)/i,dh=class extends H{innerPattern(){return lq}innerExtract(e,t){let r=null;switch(t[1].toLowerCase()){case"afternoon":r=nO(e.reference);break;case"evening":case"night":r=Oc(e.reference);break;case"midnight":r=Vo(e.reference);break;case"morning":r=Lc(e.reference);break;case"noon":case"midday":r=Fc(e.reference);break}return r&&r.addTag("parser/ENCasualTimeParser"),r}}});function Kt(n){let e={};for(let t in n)e[t]=-n[t];return e}function Wg(n,e){let t=n.clone(),r=n.dayjs();for(let s in e)r=r.add(e[s],s);return("day"in e||"d"in e||"week"in e||"month"in e||"year"in e)&&(t.imply("day",r.date()),t.imply("month",r.month()+1),t.imply("year",r.year())),("second"in e||"minute"in e||"hour"in e)&&(t.imply("second",r.second()),t.imply("minute",r.minute()),t.imply("hour",r.hour())),t}var As=v(()=>{});function Zt(n,e,t){let r=n.getDateWithAdjustedTimezone(),s=cq(r,e,t),i=new Y(n);return i=Wg(i,{day:s}),i.assign("weekday",e),i}function cq(n,e,t){let r=n.getDay();switch(t){case"this":return Vg(n,e);case"last":return lO(n,e);case"next":return r==Te.SUNDAY?e==Te.SUNDAY?7:e:r==Te.SATURDAY?e==Te.SATURDAY?7:e==Te.SUNDAY?8:1+e:e<r&&e!=Te.SUNDAY?Vg(n,e):Vg(n,e)+7}return dq(n,e)}function dq(n,e){let t=lO(n,e),r=Vg(n,e);return r<-t?r:t}function Vg(n,e){let t=n.getDay(),r=e-t;return r<0&&(r+=7),r}function lO(n,e){let t=n.getDay(),r=e-t;return r>=0&&(r-=7),r}var Mn=v(()=>{We();xe();As()});var uq,hq,fq,pq,uh,cO=v(()=>{sr();He();se();Mn();We();uq=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:on\\s*?)?(?:(this|last|past|next)\\s*)?(${q(Lg)}|weekend|weekday)(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(this|last|past|next)\\s*week)?(?=\\W|$)`,"i"),hq=1,fq=2,pq=3,uh=class extends H{innerPattern(){return uq}innerExtract(e,t){let r=t[hq],s=t[pq],i=r||s;i=i||"",i=i.toLowerCase();let a=null;i=="last"||i=="past"?a="last":i=="next"?a="next":i=="this"&&(a="this");let o=t[fq].toLowerCase(),l;if(Lg[o]!==void 0)l=Lg[o];else if(o=="weekend")l=a=="last"?Te.SUNDAY:Te.SATURDAY;else if(o=="weekday"){let c=e.reference.getDateWithAdjustedTimezone().getDay();c==Te.SUNDAY||c==Te.SATURDAY?l=a=="last"?Te.FRIDAY:Te.MONDAY:(l=c-1,l=a=="last"?l-1:l+1,l=l%5+1)}else return null;return Zt(e.reference,l,a)}}});var dO,mq,gq,yq,hh,uO=v(()=>{sr();xe();dO=Ee(Ke(),1);se();He();mq=new RegExp(`(this|last|past|next|after\\s*this)\\s*(${q(qu)})(?=\\s*)(?=\\W|$)`,"i"),gq=1,yq=2,hh=class extends H{innerPattern(){return mq}innerExtract(e,t){let r=t[gq].toLowerCase(),s=t[yq].toLowerCase(),i=qu[s];if(r=="next"||r.startsWith("after")){let l={};return l[i]=1,Y.createRelativeFromReference(e.reference,l)}if(r=="last"||r=="past"){let l={};return l[i]=-1,Y.createRelativeFromReference(e.reference,l)}let a=e.createParsingComponents(),o=(0,dO.default)(e.reference.instant);return s.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):s.match(/month/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):s.match(/year/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var vq,Tq,wq,hO,fO,Hk,nr,Wi=v(()=>{Rt();vq=new RegExp("([^\\d]|^)([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}|[0-9]{2}))?(\\W|$)","i"),Tq=1,wq=5,hO=2,fO=3,Hk=4,nr=class{constructor(e){R(this,"groupNumberMonth");R(this,"groupNumberDay");this.groupNumberMonth=e?fO:hO,this.groupNumberDay=e?hO:fO}pattern(){return vq}extract(e,t){let r=t.index+t[Tq].length,s=t.index+t[0].length-t[wq].length;if(r>0&&e.text.substring(0,r).match("\\d/?$")||s<e.text.length&&e.text.substring(s).match("^/?\\d"))return;let i=e.text.substring(r,s);if(i.match(/^\d\.\d$/)||i.match(/^\d\.\d{1,2}\.\d{1,2}\s*$/)||!t[Hk]&&i.indexOf("/")<0)return;let a=e.createParsingResult(r,i),o=parseInt(t[this.groupNumberMonth]),l=parseInt(t[this.groupNumberDay]);if((o<1||o>12)&&o>12)if(l>=1&&l<=12&&o<=31)[l,o]=[o,l];else return null;if(l<1||l>31)return null;if(a.start.assign("day",l),a.start.assign("month",o),t[Hk]){let c=parseInt(t[Hk]),d=as(c);a.start.assign("year",d)}else{let c=rt(e.refDate,l,o);a.start.imply("year",c)}return a.addTag("parser/SlashDateFormatParser")}}});var bq,kq,fh,pO=v(()=>{sr();xe();se();zu();bq=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${Hi})(?=\\W|$)`,"i"),kq=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${Aa})(?=\\W|$)`,"i"),fh=class extends H{constructor(t=!0){super();R(this,"allowAbbreviations");this.allowAbbreviations=t}innerPattern(){return this.allowAbbreviations?bq:kq}innerExtract(t,r){let s=r[1].toLowerCase(),i=rn(r[2]);if(!i)return null;switch(s){case"last":case"past":case"-":i=Pc(i);break}return Y.createRelativeFromReference(t.reference,i)}}});function Eq(n){return n.text.match(/^[+-]/i)!=null}function mO(n){return n.text.match(/^-/i)!=null}var ph,gO=v(()=>{Ui();xe();sr();As();ph=class extends os{shouldMergeResults(e,t,r){return e.match(/^\s*$/i)?Eq(r)||mO(r):!1}mergeResults(e,t,r,s){let i=rn(r.text);mO(r)&&(i=Kt(i));let a=Y.createRelativeFromReference(Ze.fromDate(t.start.date()),i);return new ze(t.reference,t.index,`${t.text}${e}${r.text}`,a)}}});function yO(n){return n.text.match(/\s+(before|from)$/i)!=null}function Sq(n){return n.text.match(/\s+(after|since)$/i)!=null}var mh,vO=v(()=>{Ui();xe();sr();zu();mh=class extends os{patternBetween(){return/^\s*$/i}shouldMergeResults(e,t,r){return!e.match(this.patternBetween())||!yO(t)&&!Sq(t)?!1:!!r.start.get("day")&&!!r.start.get("month")&&!!r.start.get("year")}mergeResults(e,t,r){let s=rn(t.text);yO(t)&&(s=Pc(s));let i=Y.createRelativeFromReference(Ze.fromDate(r.start.date()),s);return new ze(r.reference,t.index,`${t.text}${e}${r.text}`,i)}}});var Dq,xq,gh,TO=v(()=>{sr();Dq=new RegExp(`^\\s*(${Pa})`,"i"),xq=1,gh=class{refine(e,t){return t.forEach(function(r){if(!r.start.isDateWithUnknownYear())return;let s=e.text.substring(r.index+r.text.length),i=Dq.exec(s);if(!i||i[0].trim().length<=3)return;e.debug(()=>{console.log(`Extracting year: '${i[0]}' into : ${r}`)});let a=_a(i[xq]);r.end!=null&&r.end.assign("year",a),r.start.assign("year",a),r.text+=i[0]}),t}}});var yh,wO=v(()=>{Ui();yh=class extends Rc{constructor(){super()}isValid(e,t){let r=t.text.trim();return r===e.text.trim()?!0:r.toLowerCase()==="may"&&!e.text.substring(0,t.index).trim().match(/\b(in)$/i)?(e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):r.toLowerCase().endsWith("the second")?(e.text.substring(t.index+t.text.length).trim().length>0&&e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):!0}}});var $o,Bk=v(()=>{xN();_N();IN();NN();LN();FN();BN();UN();jN();WN();qN();Ps();aO();oO();cO();uO();Wi();pO();gO();vO();Lk();TO();wO();$o=class{createCasualConfiguration(e=!1){let t=this.createConfiguration(!1,e);return t.parsers.push(new ch),t.parsers.push(new dh),t.parsers.push(new Zu),t.parsers.push(new hh),t.parsers.push(new fh),t.refiners.push(new yh),t}createConfiguration(e=!0,t=!1){let r=Et({parsers:[new nr(t),new Gu(e),new Qu,new Ku(t),new uh,new Ju,new th(e),new rh(e),new sh(e)],refiners:[new Nc]},e);return r.parsers.unshift(new Xu(e)),r.refiners.unshift(new mh),r.refiners.unshift(new ph),r.refiners.unshift(new Ia),r.refiners.push(new Nc),r.refiners.push(new gh),r.refiners.push(new nh),r}}});var me,vh,ls=v(()=>{xe();Bk();me=class n{constructor(e){R(this,"parsers");R(this,"refiners");R(this,"defaultConfig",new $o);e=e||this.defaultConfig.createCasualConfiguration(),this.parsers=[...e.parsers],this.refiners=[...e.refiners]}clone(){return new n({parsers:[...this.parsers],refiners:[...this.refiners]})}parseDate(e,t,r){let s=this.parse(e,t,r);return s.length>0?s[0].start.date():null}parse(e,t,r){let s=new vh(e,t,r),i=[];return this.parsers.forEach(a=>{let o=n.executeParser(s,a);i=i.concat(o)}),i.sort((a,o)=>a.index-o.index),this.refiners.forEach(function(a){i=a.refine(s,i)}),i}static executeParser(e,t){let r=[],s=t.pattern(e),i=e.text,a=e.text,o=s.exec(a);for(;o;){let l=o.index+i.length-a.length;o.index=l;let c=t.extract(e,o);if(!c){a=i.substring(o.index+1),o=s.exec(a);continue}let d=null;c instanceof ze?d=c:c instanceof Y?(d=e.createParsingResult(o.index,o[0]),d.start=c):d=e.createParsingResult(o.index,o[0],c);let u=d.index,f=d.text;e.debug(()=>console.log(`${t.constructor.name} extracted (at index=${u}) '${f}'`)),r.push(d),a=i.substring(u+f.length),o=s.exec(a)}return r}},vh=class{constructor(e,t,r){R(this,"text");R(this,"option");R(this,"reference");R(this,"refDate");this.text=e,this.option=r!=null?r:{},this.reference=Ze.fromInput(t,this.option.timezones),this.refDate=this.reference.instant}createParsingComponents(e){return e instanceof Y?e:new Y(this.reference,e)}createParsingResult(e,t,r,s){let i=typeof t=="string"?t:this.text.substring(e,t),a=r?this.createParsingComponents(r):null,o=s?this.createParsingComponents(s):null;return new ze(this.reference,e,i,a,o)}debug(e){this.option.debug&&(this.option.debug instanceof Function?this.option.debug(e):this.option.debug.debug(e))}}});var jk={};st(jk,{Chrono:()=>me,GB:()=>Cq,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>Th,configuration:()=>$g,parse:()=>Mq,parseDate:()=>Pq,strict:()=>Uk});function Mq(n,e,t){return Th.parse(n,e,t)}function Pq(n,e,t){return Th.parseDate(n,e,t)}var $g,Th,Uk,Cq,bO=v(()=>{ls();xe();We();Bk();$g=new $o,Th=new me($g.createCasualConfiguration(!1)),Uk=new me($g.createConfiguration(!0,!1)),Cq=new me($g.createCasualConfiguration(!0))});var wh,kO=v(()=>{Bi();wh=class extends cr{primaryPrefix(){return"(?:(?:um|von)\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|bis)\\s*"}extractPrimaryTimeComponents(e,t){return t[0].match(/^\s*\d{4}\s*$/)?null:super.extractPrimaryTimeComponents(e,t)}}});function zk(n){let e=n.toLowerCase();return Wk[e]!==void 0?Wk[e]:e==="ein"||e==="einer"||e==="einem"||e==="einen"||e==="eine"?1:e.match(/wenigen/)?2:e.match(/halb/)||e.match(/halben/)?.5:e.match(/einigen/)?3:e.match(/mehreren/)?7:parseFloat(e)}function DO(n){if(/v/i.test(n))return-parseInt(n.replace(/[^0-9]+/gi,""));if(/n/i.test(n))return parseInt(n.replace(/[^0-9]+/gi,""));if(/z/i.test(n))return parseInt(n.replace(/[^0-9]+/gi,""));let e=parseInt(n);return as(e)}function MO(n){let e={},t=n,r=EO.exec(t);for(;r;)_q(e,r),t=t.substring(r[0].length),r=EO.exec(t);return e}function _q(n,e){let t=zk(e[1]),r=bh[e[2].toLowerCase()];n[r]=t}var Vk,$k,Wk,bh,Yk,SO,xO,EO,CO,Hc=v(()=>{He();Rt();Vk={sonntag:0,so:0,montag:1,mo:1,dienstag:2,di:2,mittwoch:3,mi:3,donnerstag:4,do:4,freitag:5,fr:5,samstag:6,sa:6},$k={januar:1,j\u00E4nner:1,janner:1,jan:1,"jan.":1,februar:2,feber:2,feb:2,"feb.":2,m\u00E4rz:3,maerz:3,m\u00E4r:3,"m\xE4r.":3,mrz:3,"mrz.":3,april:4,apr:4,"apr.":4,mai:5,juni:6,jun:6,"jun.":6,juli:7,jul:7,"jul.":7,august:8,aug:8,"aug.":8,september:9,sep:9,"sep.":9,sept:9,"sept.":9,oktober:10,okt:10,"okt.":10,november:11,nov:11,"nov.":11,dezember:12,dez:12,"dez.":12},Wk={eins:1,eine:1,einem:1,einen:1,einer:1,zwei:2,drei:3,vier:4,f\u00FCnf:5,fuenf:5,sechs:6,sieben:7,acht:8,neun:9,zehn:10,elf:11,zw\u00F6lf:12,zwoelf:12},bh={sek:"second",sekunde:"second",sekunden:"second",min:"minute",minute:"minute",minuten:"minute",h:"hour",std:"hour",stunde:"hour",stunden:"hour",tag:"d",tage:"d",tagen:"d",woche:"week",wochen:"week",monat:"month",monate:"month",monaten:"month",monats:"month",quartal:"quarter",quartals:"quarter",quartale:"quarter",quartalen:"quarter",a:"year",j:"year",jr:"year",jahr:"year",jahre:"year",jahren:"year",jahres:"year"},Yk=`(?:${q(Wk)}|[0-9]+|[0-9]+\\.[0-9]+|halb?|halbe?|einigen?|wenigen?|mehreren?)`;SO="(?:[0-9]{1,4}(?:\\s*[vn]\\.?\\s*(?:C(?:hr)?|(?:u\\.?|d\\.?(?:\\s*g\\.?)?)?\\s*Z)\\.?|\\s*(?:u\\.?|d\\.?(?:\\s*g\\.)?)\\s*Z\\.?)?)";xO=`(${Yk})\\s{0,5}(${q(bh)})\\s{0,5}`,EO=new RegExp(xO,"i"),CO=Vr("",xO)});var Aq,Iq,Rq,Nq,kh,PO=v(()=>{Hc();He();se();Mn();Aq=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:a[mn]\\s*?)?(?:(diese[mn]|letzte[mn]|n(?:\xE4|ae)chste[mn])\\s*)?(${q(Vk)})(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(diese|letzte|n(?:\xE4|ae)chste)\\s*woche)?(?=\\W|$)`,"i"),Iq=1,Rq=3,Nq=2,kh=class extends H{innerPattern(){return Aq}innerExtract(e,t){let r=t[Nq].toLowerCase(),s=Vk[r],i=t[Iq],a=t[Rq],o=i||a;o=o||"",o=o.toLowerCase();let l=null;return o.match(/letzte/)?l="last":o.match(/chste/)?l="next":o.match(/diese/)&&(l="this"),Zt(e.reference,s,l)}}});var Oq,Lq,Fq,_O,AO,IO,Eh,RO=v(()=>{We();Oq=new RegExp("(^|\\s|T)(?:(?:um|von)\\s*)?(\\d{1,2})(?:h|:)?(?:(\\d{1,2})(?:m|:)?)?(?:(\\d{1,2})(?:s)?)?(?:\\s*Uhr)?(?:\\s*(morgens|vormittags|nachmittags|abends|nachts|am\\s+(?:Morgen|Vormittag|Nachmittag|Abend)|in\\s+der\\s+Nacht))?(?=\\W|$)","i"),Lq=new RegExp("^\\s*(\\-|\\\u2013|\\~|\\\u301C|bis(?:\\s+um)?|\\?)\\s*(\\d{1,2})(?:h|:)?(?:(\\d{1,2})(?:m|:)?)?(?:(\\d{1,2})(?:s)?)?(?:\\s*Uhr)?(?:\\s*(morgens|vormittags|nachmittags|abends|nachts|am\\s+(?:Morgen|Vormittag|Nachmittag|Abend)|in\\s+der\\s+Nacht))?(?=\\W|$)","i"),Fq=2,_O=3,AO=4,IO=5,Eh=class n{pattern(e){return Oq}extract(e,t){let r=e.createParsingResult(t.index+t[1].length,t[0].substring(t[1].length));if(r.text.match(/^\d{4}$/)||(r.start=n.extractTimeComponent(r.start.clone(),t),!r.start))return t.index+=t[0].length,null;let s=e.text.substring(t.index+t[0].length),i=Lq.exec(s);return i&&(r.end=n.extractTimeComponent(r.start.clone(),i),r.end&&(r.text+=i[0])),r}static extractTimeComponent(e,t){let r=0,s=0,i=null;if(r=parseInt(t[Fq]),t[_O]!=null&&(s=parseInt(t[_O])),s>=60||r>24)return null;if(r>=12&&(i=O.PM),t[IO]!=null){if(r>12)return null;let a=t[IO].toLowerCase();a.match(/morgen|vormittag/)&&(i=O.AM,r==12&&(r=0)),a.match(/nachmittag|abend/)&&(i=O.PM,r!=12&&(r+=12)),a.match(/nacht/)&&(r==12?(i=O.AM,r=0):r<6?i=O.AM:(i=O.PM,r+=12))}if(e.assign("hour",r),e.assign("minute",s),i!==null?e.assign("meridiem",i):r<12?e.imply("meridiem",O.AM):e.imply("meridiem",O.PM),t[AO]!=null){let a=parseInt(t[AO]);if(a>=60)return null;e.assign("second",a)}return e}}});var Sh,NO=v(()=>{sn();Sh=class extends vt{patternBetween(){return/^\s*(bis(?:\s*(?:am|zum))?|-)\s*$/i}}});var Dh,OO=v(()=>{nn();Dh=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|um|am|,|-)?\\s*$")}}});var LO,Yo,qk=v(()=>{LO=Ee(Ke(),1);We();se();Ms();As();Yo=class n extends H{innerPattern(e){return/(diesen)?\s*(morgen|vormittag|mittags?|nachmittag|abend|nacht|mitternacht)(?=\W|$)/i}innerExtract(e,t){let r=(0,LO.default)(e.refDate),s=t[2].toLowerCase(),i=e.createParsingComponents();return ri(i,r),n.extractTimeComponents(i,s)}static extractTimeComponents(e,t){switch(t){case"morgen":e.imply("hour",6),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",O.AM);break;case"vormittag":e.imply("hour",9),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",O.AM);break;case"mittag":case"mittags":e.imply("hour",12),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",O.AM);break;case"nachmittag":e.imply("hour",15),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",O.PM);break;case"abend":e.imply("hour",18),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",O.PM);break;case"nacht":e.imply("hour",22),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",O.PM);break;case"mitternacht":e.get("hour")>1&&(e=Wg(e,{day:1})),e.imply("hour",0),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",O.AM);break}return e}}});var FO,Hq,Bq,Uq,xh,HO=v(()=>{FO=Ee(Ke(),1);se();Ms();qk();_s();Hq=new RegExp("(jetzt|heute|morgen|\xFCbermorgen|uebermorgen|gestern|vorgestern|letzte\\s*nacht)(?:\\s*(morgen|vormittag|mittags?|nachmittag|abend|nacht|mitternacht))?(?=\\W|$)","i"),Bq=1,Uq=2,xh=class extends H{innerPattern(e){return Hq}innerExtract(e,t){let r=(0,FO.default)(e.refDate),s=(t[Bq]||"").toLowerCase(),i=(t[Uq]||"").toLowerCase(),a=e.createParsingComponents();switch(s){case"jetzt":a=Nr(e.reference);break;case"heute":a=dr(e.reference);break;case"morgen":xn(a,r);break;case"\xFCbermorgen":case"uebermorgen":r=r.add(1,"day"),xn(a,r);break;case"gestern":r=r.add(-1,"day"),ft(a,r),ri(a,r);break;case"vorgestern":r=r.add(-2,"day"),ft(a,r),ri(a,r);break;default:s.match(/letzte\s*nacht/)&&(r.hour()>6&&(r=r.add(-1,"day")),ft(a,r),a.imply("hour",0));break}return i&&(a=Yo.extractTimeComponents(a,i)),a}}});var jq,BO,UO,Wq,jO,Ch,WO=v(()=>{Rt();Hc();Hc();He();se();jq=new RegExp(`(?:am\\s*?)?(?:den\\s*?)?([0-9]{1,2})\\.(?:\\s*(?:bis(?:\\s*(?:am|zum))?|\\-|\\\u2013|\\s)\\s*([0-9]{1,2})\\.?)?\\s*(${q($k)})(?:(?:-|/|,?\\s*)(${SO}(?![^\\s]\\d)))?(?=\\W|$)`,"i"),BO=1,UO=2,Wq=3,jO=4,Ch=class extends H{innerPattern(){return jq}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=$k[t[Wq].toLowerCase()],i=parseInt(t[BO]);if(i>31)return t.index=t.index+t[BO].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[jO]){let a=DO(t[jO]);r.start.assign("year",a)}else{let a=rt(e.refDate,i,s);r.start.imply("year",a)}if(t[UO]){let a=parseInt(t[UO]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var Mh,VO=v(()=>{Hc();xe();se();As();He();Mh=class extends H{constructor(){super()}innerPattern(){return new RegExp(`(?:\\s*((?:n\xE4chste|kommende|folgende|letzte|vergangene|vorige|vor(?:her|an)gegangene)(?:s|n|m|r)?|vor|in)\\s*)?(${Yk})?(?:\\s*(n\xE4chste|kommende|folgende|letzte|vergangene|vorige|vor(?:her|an)gegangene)(?:s|n|m|r)?)?\\s*(${q(bh)})`,"i")}innerExtract(e,t){let r=t[2]?zk(t[2]):1,s=bh[t[4].toLowerCase()],i={};i[s]=r;let a=t[1]||t[3]||"";if(a=a.toLowerCase(),!!a)return(/vor/.test(a)||/letzte/.test(a)||/vergangen/.test(a))&&(i=Kt(i)),Y.createRelativeFromReference(e.reference,i)}}});var Ph,$O=v(()=>{Hc();xe();se();Ph=class extends H{innerPattern(){return new RegExp(`(?:in|f\xFCr|w\xE4hrend)\\s*(${CO})(?=\\W|$)`,"i")}innerExtract(e,t){let r=MO(t[1]);return Y.createRelativeFromReference(e.reference,r)}}});var Kk={};st(Kk,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>Gk,createCasualConfiguration:()=>YO,createConfiguration:()=>Qk,parse:()=>$q,parseDate:()=>Yq,strict:()=>Vq});function $q(n,e,t){return Gk.parse(n,e,t)}function Yq(n,e,t){return Gk.parseDate(n,e,t)}function YO(n=!0){let e=Qk(!1,n);return e.parsers.unshift(new Yo),e.parsers.unshift(new xh),e.parsers.unshift(new Mh),e}function Qk(n=!0,e=!0){return Et({parsers:[new ji,new nr(e),new wh,new Eh,new Ch,new kh,new Ph],refiners:[new Sh,new Dh]},n)}var Gk,Vq,zO=v(()=>{Ps();ls();xe();We();Wi();Bg();kO();PO();RO();NO();OO();HO();qk();WO();VO();$O();Gk=new me(YO()),Vq=new me(Qk(!0))});var qO,_h,GO=v(()=>{qO=Ee(Ke(),1);We();se();Ms();_s();_h=class extends H{innerPattern(e){return/(maintenant|aujourd'hui|demain|hier|cette\s*nuit|la\s*veille)(?=\W|$)/i}innerExtract(e,t){let r=(0,qO.default)(e.refDate),s=t[0].toLowerCase(),i=e.createParsingComponents();switch(s){case"maintenant":return Nr(e.reference);case"aujourd'hui":return dr(e.reference);case"hier":return Or(e.reference);case"demain":return Lr(e.reference);default:s.match(/cette\s*nuit/)?(ft(i,r),i.imply("hour",22),i.imply("meridiem",O.PM)):s.match(/la\s*veille/)&&(r=r.add(-1,"day"),ft(i,r),i.imply("hour",0))}return i}}});var Ah,QO=v(()=>{We();se();Ah=class extends H{innerPattern(e){return/(cet?)?\s*(matin|soir|après-midi|aprem|a midi|à minuit)(?=\W|$)/i}innerExtract(e,t){let r=t[2].toLowerCase(),s=e.createParsingComponents();switch(r){case"apr\xE8s-midi":case"aprem":s.imply("hour",14),s.imply("minute",0),s.imply("meridiem",O.PM);break;case"soir":s.imply("hour",18),s.imply("minute",0),s.imply("meridiem",O.PM);break;case"matin":s.imply("hour",8),s.imply("minute",0),s.imply("meridiem",O.AM);break;case"a midi":s.imply("hour",12),s.imply("minute",0),s.imply("meridiem",O.AM);break;case"\xE0 minuit":s.imply("hour",0),s.imply("meridiem",O.AM);break}return s}}});var Ih,KO=v(()=>{Bi();Ih=class extends cr{primaryPrefix(){return"(?:(?:[\xE0a])\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|[\xE0a]|\\?)\\s*"}extractPrimaryTimeComponents(e,t){return t[0].match(/^\s*\d{4}\s*$/)?null:super.extractPrimaryTimeComponents(e,t)}}});var Rh,ZO=v(()=>{nn();Rh=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|\xE0|a|au|vers|de|,|-)?\\s*$")}}});var Nh,XO=v(()=>{sn();Nh=class extends vt{patternBetween(){return/^\s*(à|a|au|-)\s*$/i}}});function tE(n){let e=n.toLowerCase();return Zk[e]!==void 0?Zk[e]:e==="une"||e==="un"?1:e.match(/quelques?/)?3:e.match(/demi-?/)?.5:parseFloat(e)}function sE(n){let e=n.toLowerCase();return e=e.replace(/(?:er)$/i,""),parseInt(e)}function t1(n){if(/AC/i.test(n))return n=n.replace(/BC/i,""),-parseInt(n);if(/AD/i.test(n)||/C/i.test(n))return n=n.replace(/[^\d]+/i,""),parseInt(n);let e=parseInt(n);return e<100&&(e>50?e=e+1900:e=e+2e3),e}function zg(n){let e={},t=n,r=JO.exec(t);for(;r;)zq(e,r),t=t.substring(r[0].length),r=JO.exec(t);return e}function zq(n,e){let t=tE(e[1]),r=Oh[e[2].toLowerCase()];n[r]=t}var Xk,Jk,Zk,Oh,eE,rE,e1,r1,JO,Yg,Na=v(()=>{He();Xk={dimanche:0,dim:0,lundi:1,lun:1,mardi:2,mar:2,mercredi:3,mer:3,jeudi:4,jeu:4,vendredi:5,ven:5,samedi:6,sam:6},Jk={janvier:1,jan:1,"jan.":1,f\u00E9vrier:2,f\u00E9v:2,"f\xE9v.":2,fevrier:2,fev:2,"fev.":2,mars:3,mar:3,"mar.":3,avril:4,avr:4,"avr.":4,mai:5,juin:6,jun:6,juillet:7,juil:7,jul:7,"jul.":7,ao\u00FBt:8,aout:8,septembre:9,sep:9,"sep.":9,sept:9,"sept.":9,octobre:10,oct:10,"oct.":10,novembre:11,nov:11,"nov.":11,d\u00E9cembre:12,decembre:12,dec:12,"dec.":12},Zk={un:1,deux:2,trois:3,quatre:4,cinq:5,six:6,sept:7,huit:8,neuf:9,dix:10,onze:11,douze:12,treize:13},Oh={sec:"second",seconde:"second",secondes:"second",min:"minute",mins:"minute",minute:"minute",minutes:"minute",h:"hour",hr:"hour",hrs:"hour",heure:"hour",heures:"hour",jour:"d",jours:"d",semaine:"week",semaines:"week",mois:"month",trimestre:"quarter",trimestres:"quarter",ans:"year",ann\u00E9e:"year",ann\u00E9es:"year"},eE=`(?:${q(Zk)}|[0-9]+|[0-9]+\\.[0-9]+|une?\\b|quelques?|demi-?)`;rE="(?:[0-9]{1,2}(?:er)?)";e1="(?:[1-9][0-9]{0,3}\\s*(?:AC|AD|p\\.\\s*C(?:hr?)?\\.\\s*n\\.)|[1-2][0-9]{3}|[5-9][0-9])";r1=`(${eE})\\s{0,5}(${q(Oh)})\\s{0,5}`,JO=new RegExp(r1,"i"),Yg=Vr("",r1)});var qq,Gq,Qq,Lh,s1=v(()=>{Na();He();se();Mn();qq=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:(?:ce)\\s*)?(${q(Xk)})(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(dernier|prochain)\\s*)?(?=\\W|\\d|$)`,"i"),Gq=1,Qq=2,Lh=class extends H{innerPattern(){return qq}innerExtract(e,t){let r=t[Gq].toLowerCase(),s=Xk[r];if(s===void 0)return null;let i=t[Qq];i=i||"",i=i.toLowerCase();let a=null;return i=="dernier"?a="last":i=="prochain"&&(a="next"),Zt(e.reference,s,a)}}});var Kq,Zq,Xq,n1,i1,a1,Fh,o1=v(()=>{We();Kq=new RegExp("(^|\\s|T)(?:(?:[\xE0a])\\s*)?(\\d{1,2})(?:h|:)?(?:(\\d{1,2})(?:m|:)?)?(?:(\\d{1,2})(?:s|:)?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i"),Zq=new RegExp("^\\s*(\\-|\\\u2013|\\~|\\\u301C|[\xE0a]|\\?)\\s*(\\d{1,2})(?:h|:)?(?:(\\d{1,2})(?:m|:)?)?(?:(\\d{1,2})(?:s|:)?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i"),Xq=2,n1=3,i1=4,a1=5,Fh=class n{pattern(e){return Kq}extract(e,t){let r=e.createParsingResult(t.index+t[1].length,t[0].substring(t[1].length));if(r.text.match(/^\d{4}$/)||(r.start=n.extractTimeComponent(r.start.clone(),t),!r.start))return t.index+=t[0].length,null;let s=e.text.substring(t.index+t[0].length),i=Zq.exec(s);return i&&(r.end=n.extractTimeComponent(r.start.clone(),i),r.end&&(r.text+=i[0])),r}static extractTimeComponent(e,t){let r=0,s=0,i=null;if(r=parseInt(t[Xq]),t[n1]!=null&&(s=parseInt(t[n1])),s>=60||r>24)return null;if(r>=12&&(i=O.PM),t[a1]!=null){if(r>12)return null;let a=t[a1][0].toLowerCase();a=="a"&&(i=O.AM,r==12&&(r=0)),a=="p"&&(i=O.PM,r!=12&&(r+=12))}if(e.assign("hour",r),e.assign("minute",s),i!==null?e.assign("meridiem",i):r<12?e.imply("meridiem",O.AM):e.imply("meridiem",O.PM),t[i1]!=null){let a=parseInt(t[i1]);if(a>=60)return null;e.assign("second",a)}return e}}});var Jq,l1,c1,e3,d1,Hh,u1=v(()=>{Rt();Na();Na();Na();He();se();Jq=new RegExp(`(?:on\\s*?)?(${rE})(?:\\s*(?:au|\\-|\\\u2013|jusqu'au?|\\s)\\s*(${rE}))?(?:-|/|\\s*(?:de)?\\s*)(${q(Jk)})(?:(?:-|/|,?\\s*)(${e1}(?![^\\s]\\d)))?(?=\\W|$)`,"i"),l1=1,c1=2,e3=3,d1=4,Hh=class extends H{innerPattern(){return Jq}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=Jk[t[e3].toLowerCase()],i=sE(t[l1]);if(i>31)return t.index=t.index+t[l1].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[d1]){let a=t1(t[d1]);r.start.assign("year",a)}else{let a=rt(e.refDate,i,s);r.start.imply("year",a)}if(t[c1]){let a=sE(t[c1]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var Bh,h1=v(()=>{Na();xe();se();As();Bh=class extends H{constructor(){super()}innerPattern(){return new RegExp(`il y a\\s*(${Yg})(?=(?:\\W|$))`,"i")}innerExtract(e,t){let r=zg(t[1]),s=Kt(r);return Y.createRelativeFromReference(e.reference,s)}}});var Uh,f1=v(()=>{Na();xe();se();Uh=class extends H{innerPattern(){return new RegExp(`(?:dans|en|pour|pendant|de)\\s*(${Yg})(?=\\W|$)`,"i")}innerExtract(e,t){let r=zg(t[1]);return Y.createRelativeFromReference(e.reference,r)}}});var jh,p1=v(()=>{Na();xe();se();As();He();jh=class extends H{constructor(){super()}innerPattern(){return new RegExp(`(?:les?|la|l'|du|des?)\\s*(${eE})?(?:\\s*(prochaine?s?|derni[e\xE8]re?s?|pass[\xE9e]e?s?|pr[\xE9e]c[\xE9e]dents?|suivante?s?))?\\s*(${q(Oh)})(?:\\s*(prochaine?s?|derni[e\xE8]re?s?|pass[\xE9e]e?s?|pr[\xE9e]c[\xE9e]dents?|suivante?s?))?`,"i")}innerExtract(e,t){let r=t[1]?tE(t[1]):1,s=Oh[t[3].toLowerCase()],i={};i[s]=r;let a=t[2]||t[4]||"";if(a=a.toLowerCase(),!!a)return(/derni[eè]re?s?/.test(a)||/pass[ée]e?s?/.test(a)||/pr[ée]c[ée]dents?/.test(a))&&(i=Kt(i)),Y.createRelativeFromReference(e.reference,i)}}});var aE={};st(aE,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>nE,createCasualConfiguration:()=>m1,createConfiguration:()=>iE,parse:()=>r3,parseDate:()=>s3,strict:()=>t3});function r3(n,e,t){return nE.parse(n,e,t)}function s3(n,e,t){return nE.parseDate(n,e,t)}function m1(n=!0){let e=iE(!1,n);return e.parsers.unshift(new _h),e.parsers.unshift(new Ah),e.parsers.unshift(new jh),e}function iE(n=!0,e=!0){return Et({parsers:[new nr(e),new Hh,new Ih,new Fh,new Bh,new Uh,new Lh],refiners:[new Rh,new Nh]},n)}var nE,t3,g1=v(()=>{Ps();ls();xe();We();GO();QO();Wi();KO();ZO();XO();s1();o1();u1();h1();f1();p1();nE=new me(m1()),t3=new me(iE(!0))});function $r(n){return String(n).replace(/\u2019/g,"'").replace(/\u201D/g,'"').replace(/\u3000/g," ").replace(/\uFFE5/g,"\xA5").replace(/[\uFF01\uFF03-\uFF06\uFF08\uFF09\uFF0C-\uFF19\uFF1C-\uFF1F\uFF21-\uFF3B\uFF3D\uFF3F\uFF41-\uFF5B\uFF5D\uFF5E]/g,n3)}function n3(n){return String.fromCharCode(n.charCodeAt(0)-65248)}function zo(n){let e=0;for(let t=0;t<n.length;t++){let r=n[t];r==="\u5341"?e=e===0?ni[r]:e*ni[r]:e+=ni[r]}return e}var ni,Bc,Uc=v(()=>{ni={\u96F6:0,"\u3007":0,\u4E00:1,\u4E8C:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6,\u4E03:7,\u516B:8,\u4E5D:9,\u5341:10},Bc={\u65E5:0,\u6708:1,\u706B:2,\u6C34:3,\u6728:4,\u91D1:5,\u571F:6}});var v1,i3,y1,a3,oE,o3,l3,c3,Wh,T1=v(()=>{Uc();Rt();v1=Ee(Ke(),1),i3=/(?:(?:([同今本])|((昭和|平成|令和)?([0-9０-９]{1,4}|元)))年\s*)?([0-9０-９]{1,2})月\s*([0-9０-９]{1,2})日/i,y1=1,a3=2,oE=3,o3=4,l3=5,c3=6,Wh=class{pattern(){return i3}extract(e,t){let r=parseInt($r(t[l3])),s=parseInt($r(t[c3])),i=e.createParsingComponents({day:s,month:r});if(t[y1]&&t[y1].match("\u540C|\u4ECA|\u672C")){let a=(0,v1.default)(e.refDate);i.assign("year",a.year())}if(t[a3]){let a=t[o3],o=a=="\u5143"?1:parseInt($r(a));t[oE]=="\u4EE4\u548C"?o+=2018:t[oE]=="\u5E73\u6210"?o+=1988:t[oE]=="\u662D\u548C"&&(o+=1925),i.assign("year",o)}else{let a=rt(e.refDate,s,r);i.imply("year",a)}return i}}});var Vh,w1=v(()=>{sn();Vh=class extends vt{patternBetween(){return/^\s*(から|－|ー|-|～|~)\s*$/i}}});function u3(n){switch(n){case"\u304D\u3087\u3046":return"\u4ECA\u65E5";case"\u307B\u3093\u3058\u3064":return"\u672C\u65E5";case"\u304D\u306E\u3046":return"\u6628\u65E5";case"\u3042\u3057\u305F":return"\u660E\u65E5";case"\u3053\u3093\u3084":return"\u4ECA\u591C";case"\u3053\u3093\u3086\u3046":return"\u4ECA\u5915";case"\u3053\u3093\u3070\u3093":return"\u4ECA\u6669";case"\u3051\u3055":return"\u4ECA\u671D";default:return n}}var b1,d3,$h,k1=v(()=>{b1=Ee(Ke(),1);We();_s();d3=/今日|きょう|本日|ほんじつ|昨日|きのう|明日|あした|今夜|こんや|今夕|こんゆう|今晩|こんばん|今朝|けさ/i;$h=class{pattern(){return d3}extract(e,t){let r=u3(t[0]),s=(0,b1.default)(e.refDate),i=e.createParsingComponents();switch(r){case"\u6628\u65E5":return Or(e.reference);case"\u660E\u65E5":return Lr(e.reference);case"\u672C\u65E5":case"\u4ECA\u65E5":return dr(e.reference)}return r=="\u4ECA\u591C"||r=="\u4ECA\u5915"||r=="\u4ECA\u6669"?(i.imply("hour",22),i.assign("meridiem",O.PM)):r.match("\u4ECA\u671D")&&(i.imply("hour",6),i.assign("meridiem",O.AM)),i.assign("day",s.date()),i.assign("month",s.month()+1),i.assign("year",s.year()),i}}});var h3,Yh,E1=v(()=>{Uc();Mn();h3=new RegExp("((?<prefix>\u524D\u306E|\u6B21\u306E|\u4ECA\u9031))?(?<weekday>"+Object.keys(Bc).join("|")+")(?:\u66DC\u65E5|\u66DC)","i"),Yh=class{pattern(){return h3}extract(e,t){let r=t.groups.weekday,s=Bc[r];if(s===void 0)return null;let i=t.groups.prefix||"",a=null;return i.match(/前の/)?a="last":i.match(/次の/)?a="next":i.match(/今週/)&&(a="this"),Zt(e.reference,s,a)}}});var f3,S1,p3,m3,zh,D1=v(()=>{Rt();Uc();f3=new RegExp("([0-9\uFF10-\uFF19]{4}[\\/|\\\uFF0F])?([0-1\uFF10-\uFF11]{0,1}[0-9\uFF10-\uFF19]{1})(?:[\\/|\\\uFF0F]([0-3\uFF10-\uFF13]{0,1}[0-9\uFF10-\uFF19]{1}))","i"),S1=1,p3=2,m3=3,zh=class{pattern(){return f3}extract(e,t){let r=e.createParsingComponents(),s=parseInt($r(t[p3])),i=parseInt($r(t[m3]));if(s<1||s>12||i<1||i>31)return null;if(r.assign("day",i),r.assign("month",s),t[S1]){let a=parseInt($r(t[S1])),o=as(a);r.assign("year",o)}else{let a=rt(e.reference.instant,i,s);r.imply("year",a)}return r}}});var g3,y3,qg,Gg,Oa,jc,Qg,qh,x1=v(()=>{se();We();Uc();g3=new RegExp("(?:(\u5348\u524D|\u5348\u5F8C|A.M.|P.M.|AM|PM))?(?:[\\s,\uFF0C\u3001]*)(?:([0-9\uFF10-\uFF19]+|["+Object.keys(ni).join("")+"]+)(?:\\s*)(?:\u6642|:|\uFF1A)(?:\\s*)([0-9\uFF10-\uFF19]+|\u534A|["+Object.keys(ni).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)([0-9\uFF10-\uFF19]+|["+Object.keys(ni).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),y3=new RegExp("(?:^\\s*(?:\u304B\u3089|\\-|\\\u2013|\\\uFF0D|\\~|\\\u301C)\\s*)(?:(\u5348\u524D|\u5348\u5F8C|A.M.|P.M.|AM|PM))?(?:[\\s,\uFF0C\u3001]*)(?:([0-9\uFF10-\uFF19]+|["+Object.keys(ni).join("")+"]+)(?:\\s*)(?:\u6642|:|\uFF1A)(?:\\s*)([0-9\uFF10-\uFF19]+|\u534A|["+Object.keys(ni).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)([0-9\uFF10-\uFF19]+|["+Object.keys(ni).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),qg=1,Gg=2,Oa=3,jc=4,Qg=5,qh=class extends H{innerPattern(){return g3}innerExtract(e,t){if(t.index>0&&e.text[t.index-1].match(/\w/))return null;let r=e.createParsingResult(t.index,t[0]),s=0,i=0,a=-1;if(t[jc]){let o=parseInt($r(t[jc]));if(isNaN(o)&&(o=zo(t[jc])),o>=60)return null;r.start.assign("second",o)}if(s=parseInt($r(t[Gg])),isNaN(s)&&(s=zo(t[Gg])),t[Oa]?t[Oa]==="\u534A"?i=30:(i=parseInt($r(t[Oa])),isNaN(i)&&(i=zo(t[Oa]))):s>100&&(i=s%100,s=Math.floor(s/100)),i>=60||s>24)return null;if(s>=12&&(a=O.PM),t[qg]){if(s>12)return null;let o=t[qg],l=o[0].toLowerCase();o==="\u5348\u524D"||l==="a"?(a=O.AM,s===12&&(s=0)):(o==="\u5348\u5F8C"||l==="p")&&(a=O.PM,s!=12&&(s+=12))}else if(t[Qg]){if(s>12)return null;let o=t[Qg][0].toLowerCase();o==="a"&&(a=O.AM,s===12&&(s=0)),o==="p"&&(a=O.PM,s!=12&&(s+=12))}if(r.start.assign("hour",s),r.start.assign("minute",i),a>=0?r.start.assign("meridiem",a):s<12?r.start.imply("meridiem",0):r.start.imply("meridiem",1),t=y3.exec(e.text.substring(r.index+r.text.length)),!t)return r.text.match(/^\d+$/)?null:r;if(r.end=e.createParsingComponents(),s=0,i=0,a=-1,t[jc]){let o=parseInt($r(t[jc]));if(isNaN(o)&&(o=zo(t[jc])),o>=60)return null;r.end.assign("second",o)}if(s=parseInt($r(t[Gg])),isNaN(s)&&(s=zo(t[Gg])),t[Oa]?t[Oa]==="\u534A"?i=30:(i=parseInt($r(t[Oa])),isNaN(i)&&(i=zo(t[Oa]))):s>100&&(i=s%100,s=Math.floor(s/100)),i>=60||s>24)return null;if(s>=12&&(a=O.PM),t[qg]){if(s>12)return null;let o=t[qg],l=o[0].toLowerCase();o==="\u5348\u524D"||l==="a"?(a=O.AM,s===12&&(s=0)):(o==="\u5348\u5F8C"||l==="p")&&(a=O.PM,s!=12&&(s+=12)),r.start.isCertain("meridiem")||(a===O.AM?(r.start.imply("meridiem",O.AM),r.start.get("hour")===12&&r.start.assign("hour",0)):(r.start.imply("meridiem",1),r.start.get("hour")!=12&&r.start.assign("hour",r.start.get("hour")+12)))}else if(t[Qg]){if(s>12)return null;let o=t[Qg][0].toLowerCase();o==="a"&&(a=O.AM,s===12&&(s=0)),o==="p"&&(a=O.PM,s!=12&&(s+=12))}return r.text=r.text+t[0],r.end.assign("hour",s),r.end.assign("minute",i),a>=0?r.end.assign("meridiem",a):r.start.isCertain("meridiem")&&r.start.get("hour")>12?r.start.get("hour")-12>s?r.end.imply("meridiem",O.AM):s<=12&&(r.end.assign("hour",s+12),r.end.assign("meridiem",O.PM)):s>12?r.end.imply("meridiem",O.PM):s<=12&&r.end.imply("meridiem",O.AM),r.end.date().getTime()<r.start.date().getTime()&&r.end.imply("day",r.end.get("day")+1),r}}});var Gh,C1=v(()=>{nn();Gh=class extends Tt{patternBetween(){return/^\s*(の)?\s*$/i}}});var Qh,M1=v(()=>{Ui();Qh=class extends os{mergeResults(e,t,r){let s=t.clone();return s.text=t.text+e+r.text,s.start.assign("weekday",r.start.get("weekday")),s.end&&s.end.assign("weekday",r.start.get("weekday")),s}shouldMergeResults(e,t,r){return t.start.isCertain("day")&&r.start.isOnlyWeekdayComponent()&&!r.start.isCertain("hour")&&e.match(/^[,、の]?\s*$/)!==null}}});var v3,Kh,P1=v(()=>{Uc();Mn();v3=new RegExp("(?:\\(|\\\uFF08)(?<weekday>"+Object.keys(Bc).join("|")+")(?:\\)|\\\uFF09)","i"),Kh=class{pattern(){return v3}extract(e,t){let r=t.groups.weekday,s=Bc[r];return s===void 0?null:Zt(e.reference,s)}}});var dE={};st(dE,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>lE,createCasualConfiguration:()=>_1,createConfiguration:()=>cE,parse:()=>w3,parseDate:()=>b3,strict:()=>T3});function w3(n,e,t){return lE.parse(n,e,t)}function b3(n,e,t){return lE.parseDate(n,e,t)}function _1(){let n=cE(!1);return n.parsers.unshift(new $h),n}function cE(n=!0){let e=Et({parsers:[new Wh,new Yh,new Kh,new zh,new qh],refiners:[new Qh,new Gh,new Vh]},n);return e.refiners=e.refiners.filter(t=>!(t instanceof jo)),e}var lE,T3,A1=v(()=>{T1();w1();k1();E1();D1();x1();C1();ls();xe();We();M1();P1();Ps();Fk();lE=new me(_1()),T3=new me(cE(!0))});function R1(n){if(n.match(/^[0-9]{1,4}$/)){let e=parseInt(n);return e<100&&(e>50?e=e+1900:e=e+2e3),e}return n.match(/a\.?\s*c\.?/i)?(n=n.replace(/a\.?\s*c\.?/i,""),-parseInt(n)):parseInt(n)}var uE,hE,I1,Kg=v(()=>{uE={domingo:0,dom:0,segunda:1,"segunda-feira":1,seg:1,ter\u00E7a:2,"ter\xE7a-feira":2,ter:2,quarta:3,"quarta-feira":3,qua:3,quinta:4,"quinta-feira":4,qui:4,sexta:5,"sexta-feira":5,sex:5,s\u00E1bado:6,sabado:6,sab:6},hE={janeiro:1,jan:1,"jan.":1,fevereiro:2,fev:2,"fev.":2,mar\u00E7o:3,mar:3,"mar.":3,abril:4,abr:4,"abr.":4,maio:5,mai:5,"mai.":5,junho:6,jun:6,"jun.":6,julho:7,jul:7,"jul.":7,agosto:8,ago:8,"ago.":8,setembro:9,set:9,"set.":9,outubro:10,out:10,"out.":10,novembro:11,nov:11,"nov.":11,dezembro:12,dez:12,"dez.":12},I1="[0-9]{1,4}(?![^\\s]\\d)(?:\\s*[a|d]\\.?\\s*c\\.?|\\s*a\\.?\\s*d\\.?)?"});var k3,E3,S3,D3,Zh,N1=v(()=>{Kg();He();se();Mn();k3=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:(este|esta|passado|pr[o\xF3]ximo)\\s*)?(${q(uE)})(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(este|esta|passado|pr[\xF3o]ximo)\\s*semana)?(?=\\W|\\d|$)`,"i"),E3=1,S3=2,D3=3,Zh=class extends H{innerPattern(){return k3}innerExtract(e,t){let r=t[S3].toLowerCase(),s=uE[r];if(s===void 0)return null;let i=t[E3],a=t[D3],o=i||a||"";o=o.toLowerCase();let l=null;return o=="passado"?l="this":o=="pr\xF3ximo"||o=="proximo"?l="next":o=="este"&&(l="this"),Zt(e.reference,s,l)}}});var Xh,O1=v(()=>{Bi();Xh=class extends cr{primaryPrefix(){return"(?:(?:ao?|\xE0s?|das|da|de|do)\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|a(?:o)?|\\?)\\s*"}}});var Jh,L1=v(()=>{nn();Jh=class extends Tt{patternBetween(){return new RegExp("^\\s*(?:,|\xE0)?\\s*$")}}});var ef,F1=v(()=>{sn();ef=class extends vt{patternBetween(){return/^\s*(?:-)\s*$/i}}});var x3,H1,B1,C3,U1,tf,j1=v(()=>{Rt();Kg();Kg();He();se();x3=new RegExp(`([0-9]{1,2})(?:\xBA|\xAA|\xB0)?(?:\\s*(?:desde|de|\\-|\\\u2013|ao?|\\s)\\s*([0-9]{1,2})(?:\xBA|\xAA|\xB0)?)?\\s*(?:de)?\\s*(?:-|/|\\s*(?:de|,)?\\s*)(${q(hE)})(?:\\s*(?:de|,)?\\s*(${I1}))?(?=\\W|$)`,"i"),H1=1,B1=2,C3=3,U1=4,tf=class extends H{innerPattern(){return x3}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=hE[t[C3].toLowerCase()],i=parseInt(t[H1]);if(i>31)return t.index=t.index+t[H1].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[U1]){let a=R1(t[U1]);r.start.assign("year",a)}else{let a=rt(e.refDate,i,s);r.start.imply("year",a)}if(t[B1]){let a=parseInt(t[B1]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var rf,W1=v(()=>{se();_s();rf=class extends H{innerPattern(e){return/(agora|hoje|amanha|amanhã|ontem)(?=\W|$)/i}innerExtract(e,t){let r=t[0].toLowerCase(),s=e.createParsingComponents();switch(r){case"agora":return Nr(e.reference);case"hoje":return dr(e.reference);case"amanha":case"amanh\xE3":return Lr(e.reference);case"ontem":return Or(e.reference)}return s}}});var V1,sf,$1=v(()=>{We();se();Ms();V1=Ee(Ke(),1),sf=class extends H{innerPattern(){return/(?:esta\s*)?(manha|manhã|tarde|meia-noite|meio-dia|noite)(?=\W|$)/i}innerExtract(e,t){let r=(0,V1.default)(e.refDate),s=e.createParsingComponents();switch(t[1].toLowerCase()){case"tarde":s.imply("meridiem",O.PM),s.imply("hour",15);break;case"noite":s.imply("meridiem",O.PM),s.imply("hour",22);break;case"manha":case"manh\xE3":s.imply("meridiem",O.AM),s.imply("hour",6);break;case"meia-noite":xn(s,r),s.imply("hour",0),s.imply("minute",0),s.imply("second",0);break;case"meio-dia":s.imply("meridiem",O.AM),s.imply("hour",12);break}return s}}});var mE={};st(mE,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>fE,createCasualConfiguration:()=>Y1,createConfiguration:()=>pE,parse:()=>P3,parseDate:()=>_3,strict:()=>M3});function P3(n,e,t){return fE.parse(n,e,t)}function _3(n,e,t){return fE.parseDate(n,e,t)}function Y1(n=!0){let e=pE(!1,n);return e.parsers.push(new rf),e.parsers.push(new sf),e}function pE(n=!0,e=!0){return Et({parsers:[new nr(e),new Zh,new Xh,new tf],refiners:[new Jh,new ef]},n)}var fE,M3,z1=v(()=>{Ps();ls();xe();We();Wi();N1();O1();L1();F1();j1();W1();$1();fE=new me(Y1()),M3=new me(pE(!0))});var nf,q1=v(()=>{sn();nf=class extends vt{patternBetween(){return/^\s*(tot|-)\s*$/i}}});var af,G1=v(()=>{nn();af=class extends Tt{patternBetween(){return new RegExp("^\\s*(om|na|voor|in de|,|-)?\\s*$")}}});var of,Q1=v(()=>{se();_s();of=class extends H{innerPattern(e){return/(nu|vandaag|morgen|morgend|gisteren)(?=\W|$)/i}innerExtract(e,t){let r=t[0].toLowerCase(),s=e.createParsingComponents();switch(r){case"nu":return Nr(e.reference);case"vandaag":return dr(e.reference);case"morgen":case"morgend":return Lr(e.reference);case"gisteren":return Or(e.reference)}return s}}});var K1,A3,I3,lf,Z1=v(()=>{We();se();K1=Ee(Ke(),1);Ms();A3=1,I3=2,lf=class extends H{innerPattern(){return/(deze)?\s*(namiddag|avond|middernacht|ochtend|middag|'s middags|'s avonds|'s ochtends)(?=\W|$)/i}innerExtract(e,t){let r=(0,K1.default)(e.refDate),s=e.createParsingComponents();switch(t[A3]==="deze"&&(s.assign("day",e.refDate.getDate()),s.assign("month",e.refDate.getMonth()+1),s.assign("year",e.refDate.getFullYear())),t[I3].toLowerCase()){case"namiddag":case"'s namiddags":s.imply("meridiem",O.PM),s.imply("hour",15);break;case"avond":case"'s avonds'":s.imply("meridiem",O.PM),s.imply("hour",20);break;case"middernacht":xn(s,r),s.imply("hour",0),s.imply("minute",0),s.imply("second",0);break;case"ochtend":case"'s ochtends":s.imply("meridiem",O.AM),s.imply("hour",6);break;case"middag":case"'s middags":s.imply("meridiem",O.AM),s.imply("hour",12);break}return s}}});function N3(n){let e=n.toLowerCase();return gE[e]!==void 0?gE[e]:e==="paar"?2:e==="half"||e.match(/halve?/)?.5:parseFloat(e.replace(",","."))}function wE(n){let e=n.toLowerCase();return yE[e]!==void 0?yE[e]:(e=e.replace(/(?:ste|de)$/i,""),parseInt(e))}function Xg(n){if(/voor Christus/i.test(n))return n=n.replace(/voor Christus/i,""),-parseInt(n);if(/na Christus/i.test(n))return n=n.replace(/na Christus/i,""),parseInt(n);let e=parseInt(n);return as(e)}function La(n){let e={},t=n,r=X1.exec(t);for(;r;)O3(e,r),t=t.substring(r[0].length),r=X1.exec(t);return e}function O3(n,e){let t=N3(e[1]),r=cf[e[2].toLowerCase()];n[r]=t}var vE,Vi,gE,yE,cf,R3,TE,Zg,J1,X1,ii,Is=v(()=>{He();Rt();vE={zondag:0,zon:0,"zon.":0,zo:0,"zo.":0,maandag:1,ma:1,"ma.":1,dinsdag:2,din:2,"din.":2,di:2,"di.":2,woensdag:3,woe:3,"woe.":3,wo:3,"wo.":3,donderdag:4,dond:4,"dond.":4,do:4,"do.":4,vrijdag:5,vrij:5,"vrij.":5,vr:5,"vr.":5,zaterdag:6,zat:6,"zat.":6,za:6,"za.":6},Vi={januari:1,jan:1,"jan.":1,februari:2,feb:2,"feb.":2,maart:3,mar:3,"mar.":3,mrt:3,"mrt.":3,april:4,apr:4,"apr.":4,mei:5,juni:6,jun:6,"jun.":6,juli:7,jul:7,"jul.":7,augustus:8,aug:8,"aug.":8,september:9,sep:9,"sep.":9,sept:9,"sept.":9,oktober:10,okt:10,"okt.":10,november:11,nov:11,"nov.":11,december:12,dec:12,"dec.":12},gE={een:1,twee:2,drie:3,vier:4,vijf:5,zes:6,zeven:7,acht:8,negen:9,tien:10,elf:11,twaalf:12},yE={eerste:1,tweede:2,derde:3,vierde:4,vijfde:5,zesde:6,zevende:7,achtste:8,negende:9,tiende:10,elfde:11,twaalfde:12,dertiende:13,veertiende:14,vijftiende:15,zestiende:16,zeventiende:17,achttiende:18,negentiende:19,twintigste:20,eenentwintigste:21,twee\u00EBntwintigste:22,drieentwintigste:23,vierentwintigste:24,vijfentwintigste:25,zesentwintigste:26,zevenentwintigste:27,achtentwintig:28,negenentwintig:29,dertigste:30,eenendertigste:31},cf={sec:"second",second:"second",seconden:"second",min:"minute",mins:"minute",minute:"minute",minuut:"minute",minuten:"minute",minuutje:"minute",h:"hour",hr:"hour",hrs:"hour",uur:"hour",u:"hour",uren:"hour",dag:"d",dagen:"d",week:"week",weken:"week",maand:"month",maanden:"month",jaar:"year",jr:"year",jaren:"year"},R3=`(?:${q(gE)}|[0-9]+|[0-9]+[\\.,][0-9]+|halve?|half|paar)`;TE=`(?:${q(yE)}|[0-9]{1,2}(?:ste|de)?)`;Zg="(?:[1-9][0-9]{0,3}\\s*(?:voor Christus|na Christus)|[1-2][0-9]{3}|[5-9][0-9])";J1=`(${R3})\\s{0,5}(${q(cf)})\\s{0,5}`,X1=new RegExp(J1,"i"),ii=Vr("(?:(?:binnen|in)\\s*)?",J1)});var df,eL=v(()=>{Is();xe();se();df=class extends H{innerPattern(){return new RegExp("(?:binnen|in|binnen de|voor)\\s*("+ii+")(?=\\W|$)","i")}innerExtract(e,t){let r=La(t[1]);return Y.createRelativeFromReference(e.reference,r)}}});var L3,F3,H3,B3,uf,tL=v(()=>{Is();He();se();Mn();L3=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:op\\s*?)?(?:(deze|vorige|volgende)\\s*(?:week\\s*)?)?(${q(vE)})(?=\\W|$)`,"i"),F3=1,H3=2,B3=3,uf=class extends H{innerPattern(){return L3}innerExtract(e,t){let r=t[H3].toLowerCase(),s=vE[r],i=t[F3],a=t[B3],o=i||a;o=o||"",o=o.toLowerCase();let l=null;return o=="vorige"?l="last":o=="volgende"?l="next":o=="deze"&&(l="this"),Zt(e.reference,s,l)}}});var U3,j3,rL,sL,nL,hf,iL=v(()=>{Rt();Is();Is();Is();He();se();U3=new RegExp(`(?:on\\s*?)?(${TE})(?:\\s*(?:tot|\\-|\\\u2013|until|through|till|\\s)\\s*(${TE}))?(?:-|/|\\s*(?:of)?\\s*)(`+q(Vi)+`)(?:(?:-|/|,?\\s*)(${Zg}(?![^\\s]\\d)))?(?=\\W|$)`,"i"),j3=3,rL=1,sL=2,nL=4,hf=class extends H{innerPattern(){return U3}innerExtract(e,t){let r=Vi[t[j3].toLowerCase()],s=wE(t[rL]);if(s>31)return t.index=t.index+t[rL].length,null;let i=e.createParsingComponents({day:s,month:r});if(t[nL]){let l=Xg(t[nL]);i.assign("year",l)}else{let l=rt(e.refDate,s,r);i.imply("year",l)}if(!t[sL])return i;let a=wE(t[sL]),o=e.createParsingResult(t.index,t[0]);return o.start=i,o.end=i.clone(),o.end.assign("day",a),o}}});var W3,V3,aL,Wc,oL=v(()=>{Is();Rt();He();Is();se();W3=new RegExp(`(${q(Vi)})\\s*(?:[,-]?\\s*(${Zg})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`,"i"),V3=1,aL=2,Wc=class extends H{innerPattern(){return W3}innerExtract(e,t){let r=e.createParsingComponents();r.imply("day",1);let s=t[V3],i=Vi[s.toLowerCase()];if(r.assign("month",i),t[aL]){let a=Xg(t[aL]);r.assign("year",a)}else{let a=rt(e.refDate,1,i);r.imply("year",a)}return r}}});var $3,Y3,z3,ff,lL=v(()=>{se();$3=new RegExp("([0-9]|0[1-9]|1[012])/([0-9]{4})","i"),Y3=1,z3=2,ff=class extends H{innerPattern(){return $3}innerExtract(e,t){let r=parseInt(t[z3]),s=parseInt(t[Y3]);return e.createParsingComponents().imply("day",1).assign("month",s).assign("year",r)}}});var pf,cL=v(()=>{Bi();pf=class extends cr{primaryPrefix(){return"(?:(?:om)\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|om|\\?)\\s*"}primarySuffix(){return"(?:\\s*(?:uur))?(?!/)(?=\\W|$)"}extractPrimaryTimeComponents(e,t){return t[0].match(/^\s*\d{4}\s*$/)?null:super.extractPrimaryTimeComponents(e,t)}}});var q3,G3,Q3,dL,K3,mf,uL=v(()=>{Is();He();se();q3=new RegExp(`([0-9]{4})[\\.\\/\\s](?:(${q(Vi)})|([0-9]{1,2}))[\\.\\/\\s]([0-9]{1,2})(?=\\W|$)`,"i"),G3=1,Q3=2,dL=3,K3=4,mf=class extends H{innerPattern(){return q3}innerExtract(e,t){let r=t[dL]?parseInt(t[dL]):Vi[t[Q3].toLowerCase()];if(r<1||r>12)return null;let s=parseInt(t[G3]);return{day:parseInt(t[K3]),month:r,year:s}}}});var hL,Z3,X3,gf,fL=v(()=>{se();We();Ms();hL=Ee(Ke(),1),Z3=1,X3=2,gf=class extends H{innerPattern(e){return/(gisteren|morgen|van)(ochtend|middag|namiddag|avond|nacht)(?=\W|$)/i}innerExtract(e,t){let r=t[Z3].toLowerCase(),s=t[X3].toLowerCase(),i=e.createParsingComponents(),a=(0,hL.default)(e.refDate);switch(r){case"gisteren":ft(i,a.add(-1,"day"));break;case"van":ft(i,a);break;case"morgen":xn(i,a);break}switch(s){case"ochtend":i.imply("meridiem",O.AM),i.imply("hour",6);break;case"middag":i.imply("meridiem",O.AM),i.imply("hour",12);break;case"namiddag":i.imply("meridiem",O.PM),i.imply("hour",15);break;case"avond":i.imply("meridiem",O.PM),i.imply("hour",20);break}return i}}});var J3,eG,tG,yf,pL=v(()=>{Is();xe();se();As();J3=new RegExp(`(dit|deze|vorig|afgelopen|(?:aan)?komend|over|\\+|-)e?\\s*(${ii})(?=\\W|$)`,"i"),eG=1,tG=2,yf=class extends H{innerPattern(){return J3}innerExtract(e,t){let r=t[eG].toLowerCase(),s=La(t[tG]);switch(r){case"vorig":case"afgelopen":case"-":s=Kt(s);break}return Y.createRelativeFromReference(e.reference,s)}}});var mL,rG,sG,nG,vf,gL=v(()=>{Is();xe();mL=Ee(Ke(),1);se();He();rG=new RegExp(`(dit|deze|(?:aan)?komend|volgend|afgelopen|vorig)e?\\s*(${q(cf)})(?=\\s*)(?=\\W|$)`,"i"),sG=1,nG=2,vf=class extends H{innerPattern(){return rG}innerExtract(e,t){let r=t[sG].toLowerCase(),s=t[nG].toLowerCase(),i=cf[s];if(r=="volgend"||r=="komend"||r=="aankomend"){let l={};return l[i]=1,Y.createRelativeFromReference(e.reference,l)}if(r=="afgelopen"||r=="vorig"){let l={};return l[i]=-1,Y.createRelativeFromReference(e.reference,l)}let a=e.createParsingComponents(),o=(0,mL.default)(e.reference.instant);return s.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):s.match(/maand/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):s.match(/jaar/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var iG,aG,Tf,yL=v(()=>{Is();xe();se();As();iG=new RegExp("("+ii+")(?:geleden|voor|eerder)(?=(?:\\W|$))","i"),aG=new RegExp("("+ii+")geleden(?=(?:\\W|$))","i"),Tf=class extends H{constructor(t){super();R(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?aG:iG}innerExtract(t,r){let s=La(r[1]),i=Kt(s);return Y.createRelativeFromReference(t.reference,i)}}});var oG,lG,cG,wf,vL=v(()=>{Is();xe();se();oG=new RegExp("("+ii+")(later|na|vanaf nu|voortaan|vooruit|uit)(?=(?:\\W|$))","i"),lG=new RegExp("("+ii+")(later|vanaf nu)(?=(?:\\W|$))","i"),cG=1,wf=class extends H{constructor(t){super();R(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?lG:oG}innerExtract(t,r){let s=La(r[cG]);return Y.createRelativeFromReference(t.reference,s)}}});var EE={};st(EE,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>bE,createCasualConfiguration:()=>TL,createConfiguration:()=>kE,parse:()=>uG,parseDate:()=>hG,strict:()=>dG});function uG(n,e,t){return bE.parse(n,e,t)}function hG(n,e,t){return bE.parseDate(n,e,t)}function TL(n=!0){let e=kE(!1,n);return e.parsers.unshift(new of),e.parsers.unshift(new lf),e.parsers.unshift(new gf),e.parsers.unshift(new Wc),e.parsers.unshift(new vf),e.parsers.unshift(new yf),e}function kE(n=!0,e=!0){return Et({parsers:[new nr(e),new df,new hf,new Wc,new uf,new mf,new ff,new pf(n),new Tf(n),new wf(n)],refiners:[new af,new nf]},n)}var bE,dG,wL=v(()=>{Ps();ls();xe();We();q1();G1();Q1();Z1();Wi();eL();tL();iL();oL();lL();cL();uL();fL();pL();gL();yL();vL();bE=new me(TL()),dG=new me(kE(!0))});function on(n){let e=0;for(let t=0;t<n.length;t++){let r=n[t];r==="\u5341"?e=e===0?ur[r]:e*ur[r]:e+=ur[r]}return e}function bL(n){let e="";for(let t=0;t<n.length;t++){let r=n[t];e=e+ur[r]}return parseInt(e)}var ur,Vc,$c=v(()=>{ur={\u96F6:0,"\u3007":0,\u4E00:1,\u4E8C:2,\u4E24:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6,\u4E03:7,\u516B:8,\u4E5D:9,\u5341:10},Vc={\u5929:0,\u65E5:0,\u4E00:1,\u4E8C:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6}});var EL,SE,kL,DE,qo,xE=v(()=>{EL=Ee(Ke(),1);se();$c();SE=1,kL=2,DE=3,qo=class extends H{innerPattern(){return new RegExp("(\\d{2,4}|["+Object.keys(ur).join("")+"]{4}|["+Object.keys(ur).join("")+"]{2})?(?:\\s*)(?:\u5E74)?(?:[\\s|,|\uFF0C]*)(\\d{1,2}|["+Object.keys(ur).join("")+"]{1,3})(?:\\s*)(?:\u6708)(?:\\s*)(\\d{1,2}|["+Object.keys(ur).join("")+"]{1,3})?(?:\\s*)(?:\u65E5|\u53F7)?")}innerExtract(e,t){let r=(0,EL.default)(e.refDate),s=e.createParsingResult(t.index,t[0]),i=parseInt(t[kL]);if(isNaN(i)&&(i=on(t[kL])),s.start.assign("month",i),t[DE]){let a=parseInt(t[DE]);isNaN(a)&&(a=on(t[DE])),s.start.assign("day",a)}else s.start.imply("day",r.date());if(t[SE]){let a=parseInt(t[SE]);isNaN(a)&&(a=bL(t[SE])),s.start.assign("year",a)}else s.start.imply("year",r.year());return s}}});var SL,fG,CE,pG,Go,ME=v(()=>{SL=Ee(Ke(),1);se();$c();fG=new RegExp("(\\d+|["+Object.keys(ur).join("")+"]+|\u534A|\u51E0)(?:\\s*)(?:\u4E2A)?(\u79D2(?:\u949F)?|\u5206\u949F|\u5C0F\u65F6|\u949F|\u65E5|\u5929|\u661F\u671F|\u793C\u62DC|\u6708|\u5E74)(?:(?:\u4E4B|\u8FC7)?\u540E|(?:\u4E4B)?\u5185)","i"),CE=1,pG=2,Go=class extends H{innerPattern(){return fG}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=parseInt(t[CE]);if(isNaN(s)&&(s=on(t[CE])),isNaN(s)){let l=t[CE];if(l==="\u51E0")s=3;else if(l==="\u534A")s=.5;else return null}let i=(0,SL.default)(e.refDate),o=t[pG][0];return o.match(/[日天星礼月年]/)?(o=="\u65E5"||o=="\u5929"?i=i.add(s,"d"):o=="\u661F"||o=="\u793C"?i=i.add(s*7,"d"):o=="\u6708"?i=i.add(s,"month"):o=="\u5E74"&&(i=i.add(s,"year")),r.start.assign("year",i.year()),r.start.assign("month",i.month()+1),r.start.assign("day",i.date()),r):(o=="\u79D2"?i=i.add(s,"second"):o=="\u5206"?i=i.add(s,"minute"):(o=="\u5C0F"||o=="\u949F")&&(i=i.add(s,"hour")),r.start.imply("year",i.year()),r.start.imply("month",i.month()+1),r.start.imply("day",i.date()),r.start.assign("hour",i.hour()),r.start.assign("minute",i.minute()),r.start.assign("second",i.second()),r)}}});var DL,mG,Qo,PE=v(()=>{DL=Ee(Ke(),1);se();$c();mG=new RegExp("(?<prefix>\u4E0A|\u4E0B|\u8FD9)(?:\u4E2A)?(?:\u661F\u671F|\u793C\u62DC|\u5468)(?<weekday>"+Object.keys(Vc).join("|")+")"),Qo=class extends H{innerPattern(){return mG}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=t.groups.weekday,i=Vc[s];if(i===void 0)return null;let a=null,o=t.groups.prefix;o=="\u4E0A"?a="last":o=="\u4E0B"?a="next":o=="\u8FD9"&&(a="this");let l=(0,DL.default)(e.refDate),c=!1,d=l.day();return a=="last"||a=="past"?(l=l.day(i-7),c=!0):a=="next"?(l=l.day(i+7),c=!0):a=="this"?l=l.day(i):Math.abs(i-7-d)<Math.abs(i-d)?l=l.day(i-7):Math.abs(i+7-d)<Math.abs(i-d)?l=l.day(i+7):l=l.day(i),r.start.assign("weekday",i),c?(r.start.assign("day",l.date()),r.start.assign("month",l.month()+1),r.start.assign("year",l.year())):(r.start.imply("day",l.date()),r.start.imply("month",l.month()+1),r.start.imply("year",l.year())),r}}});var xL,gG,yG,Jg,ey,ty,ry,sy,ny,ln,Yc,iy,Ko,_E=v(()=>{xL=Ee(Ke(),1);se();$c();gG=new RegExp("(?:\u4ECE|\u81EA)?(?:(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(?:\u65E5|\u5929)(?:[\\s,\uFF0C]*)(?:(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?)?(?:[\\s,\uFF0C]*)(?:(\\d+|["+Object.keys(ur).join("")+"]+)(?:\\s*)(?:\u70B9|\u65F6|:|\uFF1A)(?:\\s*)(\\d+|\u534A|\u6B63|\u6574|["+Object.keys(ur).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)(\\d+|["+Object.keys(ur).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),yG=new RegExp("(?:^\\s*(?:\u5230|\u81F3|\\-|\\\u2013|\\~|\\\u301C)\\s*)(?:(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(?:\u65E5|\u5929)(?:[\\s,\uFF0C]*)(?:(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?)?(?:[\\s,\uFF0C]*)(?:(\\d+|["+Object.keys(ur).join("")+"]+)(?:\\s*)(?:\u70B9|\u65F6|:|\uFF1A)(?:\\s*)(\\d+|\u534A|\u6B63|\u6574|["+Object.keys(ur).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)(\\d+|["+Object.keys(ur).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),Jg=1,ey=2,ty=3,ry=4,sy=5,ny=6,ln=7,Yc=8,iy=9,Ko=class extends H{innerPattern(){return gG}innerExtract(e,t){if(t.index>0&&e.text[t.index-1].match(/\w/))return null;let r=(0,xL.default)(e.refDate),s=e.createParsingResult(t.index,t[0]),i=r.clone();if(t[Jg]){let d=t[Jg];d=="\u660E"?r.hour()>1&&(i=i.add(1,"day")):d=="\u6628"?i=i.add(-1,"day"):d=="\u524D"?i=i.add(-2,"day"):d=="\u5927\u524D"?i=i.add(-3,"day"):d=="\u540E"?i=i.add(2,"day"):d=="\u5927\u540E"&&(i=i.add(3,"day")),s.start.assign("day",i.date()),s.start.assign("month",i.month()+1),s.start.assign("year",i.year())}else if(t[ry]){let d=t[ry];d=="\u660E"?i=i.add(1,"day"):d=="\u6628"?i=i.add(-1,"day"):d=="\u524D"?i=i.add(-2,"day"):d=="\u5927\u524D"?i=i.add(-3,"day"):d=="\u540E"?i=i.add(2,"day"):d=="\u5927\u540E"&&(i=i.add(3,"day")),s.start.assign("day",i.date()),s.start.assign("month",i.month()+1),s.start.assign("year",i.year())}else s.start.imply("day",i.date()),s.start.imply("month",i.month()+1),s.start.imply("year",i.year());let a=0,o=0,l=-1;if(t[Yc]){let d=parseInt(t[Yc]);if(isNaN(d)&&(d=on(t[Yc])),d>=60)return null;s.start.assign("second",d)}if(a=parseInt(t[ny]),isNaN(a)&&(a=on(t[ny])),t[ln]?t[ln]=="\u534A"?o=30:t[ln]=="\u6B63"||t[ln]=="\u6574"?o=0:(o=parseInt(t[ln]),isNaN(o)&&(o=on(t[ln]))):a>100&&(o=a%100,a=Math.floor(a/100)),o>=60||a>24)return null;if(a>=12&&(l=1),t[iy]){if(a>12)return null;let d=t[iy][0].toLowerCase();d=="a"&&(l=0,a==12&&(a=0)),d=="p"&&(l=1,a!=12&&(a+=12))}else if(t[ey]){let u=t[ey][0];u=="\u65E9"?(l=0,a==12&&(a=0)):u=="\u665A"&&(l=1,a!=12&&(a+=12))}else if(t[ty]){let u=t[ty][0];u=="\u4E0A"||u=="\u65E9"||u=="\u51CC"?(l=0,a==12&&(a=0)):(u=="\u4E0B"||u=="\u665A")&&(l=1,a!=12&&(a+=12))}else if(t[sy]){let u=t[sy][0];u=="\u4E0A"||u=="\u65E9"||u=="\u51CC"?(l=0,a==12&&(a=0)):(u=="\u4E0B"||u=="\u665A")&&(l=1,a!=12&&(a+=12))}if(s.start.assign("hour",a),s.start.assign("minute",o),l>=0?s.start.assign("meridiem",l):a<12?s.start.imply("meridiem",0):s.start.imply("meridiem",1),t=yG.exec(e.text.substring(s.index+s.text.length)),!t)return s.text.match(/^\d+$/)?null:s;let c=i.clone();if(s.end=e.createParsingComponents(),t[Jg]){let d=t[Jg];d=="\u660E"?r.hour()>1&&(c=c.add(1,"day")):d=="\u6628"?c=c.add(-1,"day"):d=="\u524D"?c=c.add(-2,"day"):d=="\u5927\u524D"?c=c.add(-3,"day"):d=="\u540E"?c=c.add(2,"day"):d=="\u5927\u540E"&&(c=c.add(3,"day")),s.end.assign("day",c.date()),s.end.assign("month",c.month()+1),s.end.assign("year",c.year())}else if(t[ry]){let d=t[ry];d=="\u660E"?c=c.add(1,"day"):d=="\u6628"?c=c.add(-1,"day"):d=="\u524D"?c=c.add(-2,"day"):d=="\u5927\u524D"?c=c.add(-3,"day"):d=="\u540E"?c=c.add(2,"day"):d=="\u5927\u540E"&&(c=c.add(3,"day")),s.end.assign("day",c.date()),s.end.assign("month",c.month()+1),s.end.assign("year",c.year())}else s.end.imply("day",c.date()),s.end.imply("month",c.month()+1),s.end.imply("year",c.year());if(a=0,o=0,l=-1,t[Yc]){let d=parseInt(t[Yc]);if(isNaN(d)&&(d=on(t[Yc])),d>=60)return null;s.end.assign("second",d)}if(a=parseInt(t[ny]),isNaN(a)&&(a=on(t[ny])),t[ln]?t[ln]=="\u534A"?o=30:t[ln]=="\u6B63"||t[ln]=="\u6574"?o=0:(o=parseInt(t[ln]),isNaN(o)&&(o=on(t[ln]))):a>100&&(o=a%100,a=Math.floor(a/100)),o>=60||a>24)return null;if(a>=12&&(l=1),t[iy]){if(a>12)return null;let d=t[iy][0].toLowerCase();d=="a"&&(l=0,a==12&&(a=0)),d=="p"&&(l=1,a!=12&&(a+=12)),s.start.isCertain("meridiem")||(l==0?(s.start.imply("meridiem",0),s.start.get("hour")==12&&s.start.assign("hour",0)):(s.start.imply("meridiem",1),s.start.get("hour")!=12&&s.start.assign("hour",s.start.get("hour")+12)))}else if(t[ey]){let u=t[ey][0];u=="\u65E9"?(l=0,a==12&&(a=0)):u=="\u665A"&&(l=1,a!=12&&(a+=12))}else if(t[ty]){let u=t[ty][0];u=="\u4E0A"||u=="\u65E9"||u=="\u51CC"?(l=0,a==12&&(a=0)):(u=="\u4E0B"||u=="\u665A")&&(l=1,a!=12&&(a+=12))}else if(t[sy]){let u=t[sy][0];u=="\u4E0A"||u=="\u65E9"||u=="\u51CC"?(l=0,a==12&&(a=0)):(u=="\u4E0B"||u=="\u665A")&&(l=1,a!=12&&(a+=12))}return s.text=s.text+t[0],s.end.assign("hour",a),s.end.assign("minute",o),l>=0?s.end.assign("meridiem",l):s.start.isCertain("meridiem")&&s.start.get("meridiem")==1&&s.start.get("hour")>a?s.end.imply("meridiem",0):a>12&&s.end.imply("meridiem",1),s.end.date().getTime()<s.start.date().getTime()&&s.end.imply("day",s.end.get("day")+1),s}}});var CL,vG,Zo,AE=v(()=>{CL=Ee(Ke(),1);se();$c();vG=new RegExp("(?:\u661F\u671F|\u793C\u62DC|\u5468)(?<weekday>"+Object.keys(Vc).join("|")+")"),Zo=class extends H{innerPattern(){return vG}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=t.groups.weekday,i=Vc[s];if(i===void 0)return null;let a=(0,CL.default)(e.refDate),o=!1,l=a.day();return Math.abs(i-7-l)<Math.abs(i-l)?a=a.day(i-7):Math.abs(i+7-l)<Math.abs(i-l)?a=a.day(i+7):a=a.day(i),r.start.assign("weekday",i),o?(r.start.assign("day",a.date()),r.start.assign("month",a.month()+1),r.start.assign("year",a.year())):(r.start.imply("day",a.date()),r.start.imply("month",a.month()+1),r.start.imply("year",a.year())),r}}});var AL,TG,ML,wG,PL,_L,bG,Xo,IE=v(()=>{AL=Ee(Ke(),1);se();TG=1,ML=2,wG=3,PL=4,_L=5,bG=6,Xo=class extends H{innerPattern(e){return new RegExp("(\u800C\u5BB6|\u7ACB(?:\u523B|\u5373)|\u5373\u523B)|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(?:\u65E5|\u5929)(?:[\\s|,|\uFF0C]*)(?:(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?","i")}innerExtract(e,t){let r=t.index,s=e.createParsingResult(r,t[0]),i=(0,AL.default)(e.refDate),a=i;if(t[TG])s.start.imply("hour",i.hour()),s.start.imply("minute",i.minute()),s.start.imply("second",i.second()),s.start.imply("millisecond",i.millisecond());else if(t[ML]){let o=t[ML],l=t[wG];o=="\u660E"||o=="\u807D"?i.hour()>1&&(a=a.add(1,"day")):o=="\u6628"||o=="\u5C0B"||o=="\u7434"?a=a.add(-1,"day"):o=="\u524D"?a=a.add(-2,"day"):o=="\u5927\u524D"?a=a.add(-3,"day"):o=="\u5F8C"?a=a.add(2,"day"):o=="\u5927\u5F8C"&&(a=a.add(3,"day")),l=="\u65E9"||l=="\u671D"?s.start.imply("hour",6):l=="\u665A"&&(s.start.imply("hour",22),s.start.imply("meridiem",1))}else if(t[PL]){let l=t[PL][0];l=="\u65E9"||l=="\u671D"||l=="\u4E0A"?s.start.imply("hour",6):l=="\u4E0B"||l=="\u664F"?(s.start.imply("hour",15),s.start.imply("meridiem",1)):l=="\u4E2D"?(s.start.imply("hour",12),s.start.imply("meridiem",1)):l=="\u591C"||l=="\u665A"?(s.start.imply("hour",22),s.start.imply("meridiem",1)):l=="\u51CC"&&s.start.imply("hour",0)}else if(t[_L]){let o=t[_L];o=="\u660E"||o=="\u807D"?i.hour()>1&&(a=a.add(1,"day")):o=="\u6628"||o=="\u5C0B"||o=="\u7434"?a=a.add(-1,"day"):o=="\u524D"?a=a.add(-2,"day"):o=="\u5927\u524D"?a=a.add(-3,"day"):o=="\u5F8C"?a=a.add(2,"day"):o=="\u5927\u5F8C"&&(a=a.add(3,"day"));let l=t[bG];if(l){let c=l[0];c=="\u65E9"||c=="\u671D"||c=="\u4E0A"?s.start.imply("hour",6):c=="\u4E0B"||c=="\u664F"?(s.start.imply("hour",15),s.start.imply("meridiem",1)):c=="\u4E2D"?(s.start.imply("hour",12),s.start.imply("meridiem",1)):c=="\u591C"||c=="\u665A"?(s.start.imply("hour",22),s.start.imply("meridiem",1)):c=="\u51CC"&&s.start.imply("hour",0)}}return s.start.assign("day",a.date()),s.start.assign("month",a.month()+1),s.start.assign("year",a.year()),s}}});function cn(n){let e=0;for(let t=0;t<n.length;t++){let r=n[t];r==="\u5341"?e=e===0?hr[r]:e*hr[r]:e+=hr[r]}return e}function IL(n){let e="";for(let t=0;t<n.length;t++){let r=n[t];e=e+hr[r]}return parseInt(e)}var hr,zc,qc=v(()=>{hr={\u96F6:0,\u4E00:1,\u4E8C:2,\u5169:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6,\u4E03:7,\u516B:8,\u4E5D:9,\u5341:10,\u5EFF:20,\u5345:30},zc={\u5929:0,\u65E5:0,\u4E00:1,\u4E8C:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6}});var NL,RE,RL,NE,Jo,OE=v(()=>{NL=Ee(Ke(),1);se();qc();RE=1,RL=2,NE=3,Jo=class extends H{innerPattern(){return new RegExp("(\\d{2,4}|["+Object.keys(hr).join("")+"]{4}|["+Object.keys(hr).join("")+"]{2})?(?:\\s*)(?:\u5E74)?(?:[\\s|,|\uFF0C]*)(\\d{1,2}|["+Object.keys(hr).join("")+"]{1,2})(?:\\s*)(?:\u6708)(?:\\s*)(\\d{1,2}|["+Object.keys(hr).join("")+"]{1,2})?(?:\\s*)(?:\u65E5|\u865F)?")}innerExtract(e,t){let r=(0,NL.default)(e.refDate),s=e.createParsingResult(t.index,t[0]),i=parseInt(t[RL]);if(isNaN(i)&&(i=cn(t[RL])),s.start.assign("month",i),t[NE]){let a=parseInt(t[NE]);isNaN(a)&&(a=cn(t[NE])),s.start.assign("day",a)}else s.start.imply("day",r.date());if(t[RE]){let a=parseInt(t[RE]);isNaN(a)&&(a=IL(t[RE])),s.start.assign("year",a)}else s.start.imply("year",r.year());return s}}});var OL,kG,LE,EG,el,FE=v(()=>{OL=Ee(Ke(),1);se();qc();kG=new RegExp("(\\d+|["+Object.keys(hr).join("")+"]+|\u534A|\u5E7E)(?:\\s*)(?:\u500B)?(\u79D2(?:\u9418)?|\u5206\u9418|\u5C0F\u6642|\u9418|\u65E5|\u5929|\u661F\u671F|\u79AE\u62DC|\u6708|\u5E74)(?:(?:\u4E4B|\u904E)?\u5F8C|(?:\u4E4B)?\u5167)","i"),LE=1,EG=2,el=class extends H{innerPattern(){return kG}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=parseInt(t[LE]);if(isNaN(s)&&(s=cn(t[LE])),isNaN(s)){let l=t[LE];if(l==="\u5E7E")s=3;else if(l==="\u534A")s=.5;else return null}let i=(0,OL.default)(e.refDate),o=t[EG][0];return o.match(/[日天星禮月年]/)?(o=="\u65E5"||o=="\u5929"?i=i.add(s,"d"):o=="\u661F"||o=="\u79AE"?i=i.add(s*7,"d"):o=="\u6708"?i=i.add(s,"month"):o=="\u5E74"&&(i=i.add(s,"year")),r.start.assign("year",i.year()),r.start.assign("month",i.month()+1),r.start.assign("day",i.date()),r):(o=="\u79D2"?i=i.add(s,"second"):o=="\u5206"?i=i.add(s,"minute"):(o=="\u5C0F"||o=="\u9418")&&(i=i.add(s,"hour")),r.start.imply("year",i.year()),r.start.imply("month",i.month()+1),r.start.imply("day",i.date()),r.start.assign("hour",i.hour()),r.start.assign("minute",i.minute()),r.start.assign("second",i.second()),r)}}});var LL,SG,tl,HE=v(()=>{LL=Ee(Ke(),1);se();qc();SG=new RegExp("(?<prefix>\u4E0A|\u4ECA|\u4E0B|\u9019|\u5462)(?:\u500B)?(?:\u661F\u671F|\u79AE\u62DC|\u9031)(?<weekday>"+Object.keys(zc).join("|")+")"),tl=class extends H{innerPattern(){return SG}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=t.groups.weekday,i=zc[s];if(i===void 0)return null;let a=null,o=t.groups.prefix;o=="\u4E0A"?a="last":o=="\u4E0B"?a="next":(o=="\u4ECA"||o=="\u9019"||o=="\u5462")&&(a="this");let l=(0,LL.default)(e.refDate),c=!1,d=l.day();return a=="last"||a=="past"?(l=l.day(i-7),c=!0):a=="next"?(l=l.day(i+7),c=!0):a=="this"?l=l.day(i):Math.abs(i-7-d)<Math.abs(i-d)?l=l.day(i-7):Math.abs(i+7-d)<Math.abs(i-d)?l=l.day(i+7):l=l.day(i),r.start.assign("weekday",i),c?(r.start.assign("day",l.date()),r.start.assign("month",l.month()+1),r.start.assign("year",l.year())):(r.start.imply("day",l.date()),r.start.imply("month",l.month()+1),r.start.imply("year",l.year())),r}}});var FL,DG,xG,ay,oy,ly,cy,dy,uy,dn,Gc,hy,rl,BE=v(()=>{FL=Ee(Ke(),1);se();qc();DG=new RegExp("(?:\u7531|\u5F9E|\u81EA)?(?:(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(?:\u65E5|\u5929)(?:[\\s,\uFF0C]*)(?:(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?)?(?:[\\s,\uFF0C]*)(?:(\\d+|["+Object.keys(hr).join("")+"]+)(?:\\s*)(?:\u9EDE|\u6642|:|\uFF1A)(?:\\s*)(\\d+|\u534A|\u6B63|\u6574|["+Object.keys(hr).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)(\\d+|["+Object.keys(hr).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),xG=new RegExp("(?:^\\s*(?:\u5230|\u81F3|\\-|\\\u2013|\\~|\\\u301C)\\s*)(?:(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(?:\u65E5|\u5929)(?:[\\s,\uFF0C]*)(?:(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?)?(?:[\\s,\uFF0C]*)(?:(\\d+|["+Object.keys(hr).join("")+"]+)(?:\\s*)(?:\u9EDE|\u6642|:|\uFF1A)(?:\\s*)(\\d+|\u534A|\u6B63|\u6574|["+Object.keys(hr).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)(\\d+|["+Object.keys(hr).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),ay=1,oy=2,ly=3,cy=4,dy=5,uy=6,dn=7,Gc=8,hy=9,rl=class extends H{innerPattern(){return DG}innerExtract(e,t){if(t.index>0&&e.text[t.index-1].match(/\w/))return null;let r=(0,FL.default)(e.refDate),s=e.createParsingResult(t.index,t[0]),i=r.clone();if(t[ay]){var a=t[ay];a=="\u660E"||a=="\u807D"?r.hour()>1&&(i=i.add(1,"day")):a=="\u6628"||a=="\u5C0B"||a=="\u7434"?i=i.add(-1,"day"):a=="\u524D"?i=i.add(-2,"day"):a=="\u5927\u524D"?i=i.add(-3,"day"):a=="\u5F8C"?i=i.add(2,"day"):a=="\u5927\u5F8C"&&(i=i.add(3,"day")),s.start.assign("day",i.date()),s.start.assign("month",i.month()+1),s.start.assign("year",i.year())}else if(t[cy]){var o=t[cy];o=="\u660E"||o=="\u807D"?i=i.add(1,"day"):o=="\u6628"||o=="\u5C0B"||o=="\u7434"?i=i.add(-1,"day"):o=="\u524D"?i=i.add(-2,"day"):o=="\u5927\u524D"?i=i.add(-3,"day"):o=="\u5F8C"?i=i.add(2,"day"):o=="\u5927\u5F8C"&&(i=i.add(3,"day")),s.start.assign("day",i.date()),s.start.assign("month",i.month()+1),s.start.assign("year",i.year())}else s.start.imply("day",i.date()),s.start.imply("month",i.month()+1),s.start.imply("year",i.year());let l=0,c=0,d=-1;if(t[Gc]){var u=parseInt(t[Gc]);if(isNaN(u)&&(u=cn(t[Gc])),u>=60)return null;s.start.assign("second",u)}if(l=parseInt(t[uy]),isNaN(l)&&(l=cn(t[uy])),t[dn]?t[dn]=="\u534A"?c=30:t[dn]=="\u6B63"||t[dn]=="\u6574"?c=0:(c=parseInt(t[dn]),isNaN(c)&&(c=cn(t[dn]))):l>100&&(c=l%100,l=Math.floor(l/100)),c>=60||l>24)return null;if(l>=12&&(d=1),t[hy]){if(l>12)return null;var f=t[hy][0].toLowerCase();f=="a"&&(d=0,l==12&&(l=0)),f=="p"&&(d=1,l!=12&&(l+=12))}else if(t[oy]){var h=t[oy],p=h[0];p=="\u671D"||p=="\u65E9"?(d=0,l==12&&(l=0)):p=="\u665A"&&(d=1,l!=12&&(l+=12))}else if(t[ly]){var m=t[ly],g=m[0];g=="\u4E0A"||g=="\u671D"||g=="\u65E9"||g=="\u51CC"?(d=0,l==12&&(l=0)):(g=="\u4E0B"||g=="\u664F"||g=="\u665A")&&(d=1,l!=12&&(l+=12))}else if(t[dy]){var y=t[dy],T=y[0];T=="\u4E0A"||T=="\u671D"||T=="\u65E9"||T=="\u51CC"?(d=0,l==12&&(l=0)):(T=="\u4E0B"||T=="\u664F"||T=="\u665A")&&(d=1,l!=12&&(l+=12))}if(s.start.assign("hour",l),s.start.assign("minute",c),d>=0?s.start.assign("meridiem",d):l<12?s.start.imply("meridiem",0):s.start.imply("meridiem",1),t=xG.exec(e.text.substring(s.index+s.text.length)),!t)return s.text.match(/^\d+$/)?null:s;let w=i.clone();if(s.end=e.createParsingComponents(),t[ay]){var a=t[ay];a=="\u660E"||a=="\u807D"?r.hour()>1&&(w=w.add(1,"day")):a=="\u6628"||a=="\u5C0B"||a=="\u7434"?w=w.add(-1,"day"):a=="\u524D"?w=w.add(-2,"day"):a=="\u5927\u524D"?w=w.add(-3,"day"):a=="\u5F8C"?w=w.add(2,"day"):a=="\u5927\u5F8C"&&(w=w.add(3,"day")),s.end.assign("day",w.date()),s.end.assign("month",w.month()+1),s.end.assign("year",w.year())}else if(t[cy]){var o=t[cy];o=="\u660E"||o=="\u807D"?w=w.add(1,"day"):o=="\u6628"||o=="\u5C0B"||o=="\u7434"?w=w.add(-1,"day"):o=="\u524D"?w=w.add(-2,"day"):o=="\u5927\u524D"?w=w.add(-3,"day"):o=="\u5F8C"?w=w.add(2,"day"):o=="\u5927\u5F8C"&&(w=w.add(3,"day")),s.end.assign("day",w.date()),s.end.assign("month",w.month()+1),s.end.assign("year",w.year())}else s.end.imply("day",w.date()),s.end.imply("month",w.month()+1),s.end.imply("year",w.year());if(l=0,c=0,d=-1,t[Gc]){var u=parseInt(t[Gc]);if(isNaN(u)&&(u=cn(t[Gc])),u>=60)return null;s.end.assign("second",u)}if(l=parseInt(t[uy]),isNaN(l)&&(l=cn(t[uy])),t[dn]?t[dn]=="\u534A"?c=30:t[dn]=="\u6B63"||t[dn]=="\u6574"?c=0:(c=parseInt(t[dn]),isNaN(c)&&(c=cn(t[dn]))):l>100&&(c=l%100,l=Math.floor(l/100)),c>=60||l>24)return null;if(l>=12&&(d=1),t[hy]){if(l>12)return null;var f=t[hy][0].toLowerCase();f=="a"&&(d=0,l==12&&(l=0)),f=="p"&&(d=1,l!=12&&(l+=12)),s.start.isCertain("meridiem")||(d==0?(s.start.imply("meridiem",0),s.start.get("hour")==12&&s.start.assign("hour",0)):(s.start.imply("meridiem",1),s.start.get("hour")!=12&&s.start.assign("hour",s.start.get("hour")+12)))}else if(t[oy]){var h=t[oy],p=h[0];p=="\u671D"||p=="\u65E9"?(d=0,l==12&&(l=0)):p=="\u665A"&&(d=1,l!=12&&(l+=12))}else if(t[ly]){var m=t[ly],g=m[0];g=="\u4E0A"||g=="\u671D"||g=="\u65E9"||g=="\u51CC"?(d=0,l==12&&(l=0)):(g=="\u4E0B"||g=="\u664F"||g=="\u665A")&&(d=1,l!=12&&(l+=12))}else if(t[dy]){var y=t[dy],T=y[0];T=="\u4E0A"||T=="\u671D"||T=="\u65E9"||T=="\u51CC"?(d=0,l==12&&(l=0)):(T=="\u4E0B"||T=="\u664F"||T=="\u665A")&&(d=1,l!=12&&(l+=12))}return s.text=s.text+t[0],s.end.assign("hour",l),s.end.assign("minute",c),d>=0?s.end.assign("meridiem",d):s.start.isCertain("meridiem")&&s.start.get("meridiem")==1&&s.start.get("hour")>l?s.end.imply("meridiem",0):l>12&&s.end.imply("meridiem",1),s.end.date().getTime()<s.start.date().getTime()&&s.end.imply("day",s.end.get("day")+1),s}}});var HL,CG,sl,UE=v(()=>{HL=Ee(Ke(),1);se();qc();CG=new RegExp("(?:\u661F\u671F|\u79AE\u62DC|\u9031)(?<weekday>"+Object.keys(zc).join("|")+")"),sl=class extends H{innerPattern(){return CG}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=t.groups.weekday,i=zc[s];if(i===void 0)return null;let a=(0,HL.default)(e.refDate),o=!1,l=a.day();return Math.abs(i-7-l)<Math.abs(i-l)?a=a.day(i-7):Math.abs(i+7-l)<Math.abs(i-l)?a=a.day(i+7):a=a.day(i),r.start.assign("weekday",i),o?(r.start.assign("day",a.date()),r.start.assign("month",a.month()+1),r.start.assign("year",a.year())):(r.start.imply("day",a.date()),r.start.imply("month",a.month()+1),r.start.imply("year",a.year())),r}}});var nl,jE=v(()=>{sn();nl=class extends vt{patternBetween(){return/^\s*(至|到|\-|\~|～|－|ー)\s*$/i}}});var il,WE=v(()=>{nn();il=class extends Tt{patternBetween(){return/^\s*$/i}}});var fy={};st(fy,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>VE,createCasualConfiguration:()=>$E,createConfiguration:()=>YE,hant:()=>MG,parse:()=>_G,parseDate:()=>AG,strict:()=>PG});function _G(n,e,t){return VE.parse(n,e,t)}function AG(n,e,t){return VE.parseDate(n,e,t)}function $E(){let n=YE();return n.parsers.unshift(new Xo),n}function YE(){let n=Et({parsers:[new Jo,new tl,new sl,new rl,new el],refiners:[new nl,new il]});return n.refiners=n.refiners.filter(e=>!(e instanceof Cn)),n}var MG,VE,PG,BL=v(()=>{ah();Ps();ls();xe();We();IE();OE();FE();HE();BE();UE();jE();WE();MG=new me($E()),VE=new me($E()),PG=new me(YE())});var VL,IG,UL,RG,jL,WL,NG,bf,$L=v(()=>{VL=Ee(Ke(),1);se();IG=1,UL=2,RG=3,jL=4,WL=5,NG=6,bf=class extends H{innerPattern(e){return new RegExp("(\u73B0\u5728|\u7ACB(?:\u523B|\u5373)|\u5373\u523B)|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(\u65E9|\u665A)|(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(?:\u65E5|\u5929)(?:[\\s|,|\uFF0C]*)(?:(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?","i")}innerExtract(e,t){let r=t.index,s=e.createParsingResult(r,t[0]),i=(0,VL.default)(e.refDate),a=i;if(t[IG])s.start.imply("hour",i.hour()),s.start.imply("minute",i.minute()),s.start.imply("second",i.second()),s.start.imply("millisecond",i.millisecond());else if(t[UL]){let o=t[UL],l=t[RG];o=="\u660E"?i.hour()>1&&(a=a.add(1,"day")):o=="\u6628"?a=a.add(-1,"day"):o=="\u524D"?a=a.add(-2,"day"):o=="\u5927\u524D"?a=a.add(-3,"day"):o=="\u540E"?a=a.add(2,"day"):o=="\u5927\u540E"&&(a=a.add(3,"day")),l=="\u65E9"?s.start.imply("hour",6):l=="\u665A"&&(s.start.imply("hour",22),s.start.imply("meridiem",1))}else if(t[jL]){let l=t[jL][0];l=="\u65E9"||l=="\u4E0A"?s.start.imply("hour",6):l=="\u4E0B"?(s.start.imply("hour",15),s.start.imply("meridiem",1)):l=="\u4E2D"?(s.start.imply("hour",12),s.start.imply("meridiem",1)):l=="\u591C"||l=="\u665A"?(s.start.imply("hour",22),s.start.imply("meridiem",1)):l=="\u51CC"&&s.start.imply("hour",0)}else if(t[WL]){let o=t[WL];o=="\u660E"?i.hour()>1&&(a=a.add(1,"day")):o=="\u6628"?a=a.add(-1,"day"):o=="\u524D"?a=a.add(-2,"day"):o=="\u5927\u524D"?a=a.add(-3,"day"):o=="\u540E"?a=a.add(2,"day"):o=="\u5927\u540E"&&(a=a.add(3,"day"));let l=t[NG];if(l){let c=l[0];c=="\u65E9"||c=="\u4E0A"?s.start.imply("hour",6):c=="\u4E0B"?(s.start.imply("hour",15),s.start.imply("meridiem",1)):c=="\u4E2D"?(s.start.imply("hour",12),s.start.imply("meridiem",1)):c=="\u591C"||c=="\u665A"?(s.start.imply("hour",22),s.start.imply("meridiem",1)):c=="\u51CC"&&s.start.imply("hour",0)}}return s.start.assign("day",a.date()),s.start.assign("month",a.month()+1),s.start.assign("year",a.year()),s}}});var kf,YL=v(()=>{sn();kf=class extends vt{patternBetween(){return/^\s*(至|到|-|~|～|－|ー)\s*$/i}}});var Ef,zL=v(()=>{nn();Ef=class extends Tt{patternBetween(){return/^\s*$/i}}});var py={};st(py,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>zE,createCasualConfiguration:()=>qE,createConfiguration:()=>GE,hans:()=>OG,parse:()=>FG,parseDate:()=>HG,strict:()=>LG});function FG(n,e,t){return zE.parse(n,e,t)}function HG(n,e,t){return zE.parseDate(n,e,t)}function qE(){let n=GE();return n.parsers.unshift(new bf),n}function GE(){let n=Et({parsers:[new qo,new Qo,new Zo,new Ko,new Go],refiners:[new kf,new Ef]});return n.refiners=n.refiners.filter(e=>!(e instanceof Cn)),n}var OG,zE,LG,qL=v(()=>{ah();Ps();ls();xe();We();$L();xE();ME();PE();_E();AE();YL();zL();OG=new me(qE()),zE=new me(qE()),LG=new me(GE())});var ZE={};st(ZE,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>QE,createCasualConfiguration:()=>GL,createConfiguration:()=>KE,hans:()=>py,hant:()=>fy,parse:()=>UG,parseDate:()=>jG,strict:()=>BG});function UG(n,e,t){return QE.parse(n,e,t)}function jG(n,e,t){return QE.parseDate(n,e,t)}function GL(){let n=KE();return n.parsers.unshift(new Xo),n}function KE(){let n=Et({parsers:[new Jo,new qo,new tl,new Qo,new sl,new Zo,new rl,new Ko,new el,new Go],refiners:[new nl,new il]});return n.refiners=n.refiners.filter(e=>!(e instanceof Cn)),n}var QE,BG,QL=v(()=>{Ps();ls();xe();We();ah();xE();ME();PE();_E();AE();IE();OE();FE();HE();BE();UE();jE();WE();BL();qL();QE=new me(GL()),BG=new me(KE())});function VG(n){let e=n.toLowerCase();return JE[e]!==void 0?JE[e]:e.match(/несколько/)?3:e.match(/пол/)?.5:e.match(/пар/)?2:e===""?1:parseFloat(e)}function nS(n){let e=n.toLowerCase();return eS[e]!==void 0?eS[e]:parseInt(e)}function gy(n){if(/(год|года|г|г.)/i.test(n)&&(n=n.replace(/(год|года|г|г.)/i,"")),/(до н.э.|до н. э.)/i.test(n))return n=n.replace(/(до н.э.|до н. э.)/i,""),-parseInt(n);if(/(н. э.|н.э.)/i.test(n))return n=n.replace(/(н. э.|н.э.)/i,""),parseInt(n);let e=parseInt(n);return as(e)}function Zc(n){let e={},t=n,r=KL.exec(t);for(;r;)$G(e,r),t=t.substring(r[0].length).trim(),r=KL.exec(t);return e}function $G(n,e){let t=VG(e[1]),r=Sf[e[2].toLowerCase()];n[r]=t}var Rs,tS,rS,Qc,JE,eS,Sf,WG,sS,XE,my,ZL,KL,Kc,Ns=v(()=>{He();Rt();Rs={leftBoundary:"([^\\p{L}\\p{N}_]|^)",rightBoundary:"(?=[^\\p{L}\\p{N}_]|$)",flags:"iu"},tS={\u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435:0,\u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u044F:0,\u0432\u0441\u043A:0,"\u0432\u0441\u043A.":0,\u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A:1,\u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A\u0430:1,\u043F\u043D:1,"\u043F\u043D.":1,\u0432\u0442\u043E\u0440\u043D\u0438\u043A:2,\u0432\u0442\u043E\u0440\u043D\u0438\u043A\u0430:2,\u0432\u0442:2,"\u0432\u0442.":2,\u0441\u0440\u0435\u0434\u0430:3,\u0441\u0440\u0435\u0434\u044B:3,\u0441\u0440\u0435\u0434\u0443:3,\u0441\u0440:3,"\u0441\u0440.":3,\u0447\u0435\u0442\u0432\u0435\u0440\u0433:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0430:4,\u0447\u0442:4,"\u0447\u0442.":4,\u043F\u044F\u0442\u043D\u0438\u0446\u0430:5,\u043F\u044F\u0442\u043D\u0438\u0446\u0443:5,\u043F\u044F\u0442\u043D\u0438\u0446\u044B:5,\u043F\u0442:5,"\u043F\u0442.":5,\u0441\u0443\u0431\u0431\u043E\u0442\u0430:6,\u0441\u0443\u0431\u0431\u043E\u0442\u0443:6,\u0441\u0443\u0431\u0431\u043E\u0442\u044B:6,\u0441\u0431:6,"\u0441\u0431.":6},rS={\u044F\u043D\u0432\u0430\u0440\u044C:1,\u044F\u043D\u0432\u0430\u0440\u044F:1,\u044F\u043D\u0432\u0430\u0440\u0435:1,\u0444\u0435\u0432\u0440\u0430\u043B\u044C:2,\u0444\u0435\u0432\u0440\u0430\u043B\u044F:2,\u0444\u0435\u0432\u0440\u0430\u043B\u0435:2,\u043C\u0430\u0440\u0442:3,\u043C\u0430\u0440\u0442\u0430:3,\u043C\u0430\u0440\u0442\u0435:3,\u0430\u043F\u0440\u0435\u043B\u044C:4,\u0430\u043F\u0440\u0435\u043B\u044F:4,\u0430\u043F\u0440\u0435\u043B\u0435:4,\u043C\u0430\u0439:5,\u043C\u0430\u044F:5,\u043C\u0430\u0435:5,\u0438\u044E\u043D\u044C:6,\u0438\u044E\u043D\u044F:6,\u0438\u044E\u043D\u0435:6,\u0438\u044E\u043B\u044C:7,\u0438\u044E\u043B\u044F:7,\u0438\u044E\u043B\u0435:7,\u0430\u0432\u0433\u0443\u0441\u0442:8,\u0430\u0432\u0433\u0443\u0441\u0442\u0430:8,\u0430\u0432\u0433\u0443\u0441\u0442\u0435:8,\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044C:9,\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F:9,\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u0435:9,\u043E\u043A\u0442\u044F\u0431\u0440\u044C:10,\u043E\u043A\u0442\u044F\u0431\u0440\u044F:10,\u043E\u043A\u0442\u044F\u0431\u0440\u0435:10,\u043D\u043E\u044F\u0431\u0440\u044C:11,\u043D\u043E\u044F\u0431\u0440\u044F:11,\u043D\u043E\u044F\u0431\u0440\u0435:11,\u0434\u0435\u043A\u0430\u0431\u0440\u044C:12,\u0434\u0435\u043A\u0430\u0431\u0440\u044F:12,\u0434\u0435\u043A\u0430\u0431\u0440\u0435:12},Qc={...rS,\u044F\u043D\u0432:1,"\u044F\u043D\u0432.":1,\u0444\u0435\u0432:2,"\u0444\u0435\u0432.":2,\u043C\u0430\u0440:3,"\u043C\u0430\u0440.":3,\u0430\u043F\u0440:4,"\u0430\u043F\u0440.":4,\u0430\u0432\u0433:8,"\u0430\u0432\u0433.":8,\u0441\u0435\u043D:9,"\u0441\u0435\u043D.":9,\u043E\u043A\u0442:10,"\u043E\u043A\u0442.":10,\u043D\u043E\u044F:11,"\u043D\u043E\u044F.":11,\u0434\u0435\u043A:12,"\u0434\u0435\u043A.":12},JE={\u043E\u0434\u0438\u043D:1,\u043E\u0434\u043D\u0430:1,\u043E\u0434\u043D\u043E\u0439:1,\u043E\u0434\u043D\u0443:1,\u0434\u0432\u0435:2,\u0434\u0432\u0430:2,\u0434\u0432\u0443\u0445:2,\u0442\u0440\u0438:3,\u0442\u0440\u0435\u0445:3,\u0442\u0440\u0451\u0445:3,\u0447\u0435\u0442\u044B\u0440\u0435:4,\u0447\u0435\u0442\u044B\u0440\u0435\u0445:4,\u0447\u0435\u0442\u044B\u0440\u0451\u0445:4,\u043F\u044F\u0442\u044C:5,\u043F\u044F\u0442\u0438:5,\u0448\u0435\u0441\u0442\u044C:6,\u0448\u0435\u0441\u0442\u0438:6,\u0441\u0435\u043C\u044C:7,\u0441\u0435\u043C\u0438:7,\u0432\u043E\u0441\u0435\u043C\u044C:8,\u0432\u043E\u0441\u044C\u043C\u0438:8,\u0434\u0435\u0432\u044F\u0442\u044C:9,\u0434\u0435\u0432\u044F\u0442\u0438:9,\u0434\u0435\u0441\u044F\u0442\u044C:10,\u0434\u0435\u0441\u044F\u0442\u0438:10,\u043E\u0434\u0438\u043D\u043D\u0430\u0434\u0446\u0430\u0442\u044C:11,\u043E\u0434\u0438\u043D\u043D\u0430\u0434\u0446\u0430\u0442\u0438:11,\u0434\u0432\u0435\u043D\u0430\u0434\u0446\u0430\u0442\u044C:12,\u0434\u0432\u0435\u043D\u0430\u0434\u0446\u0430\u0442\u0438:12},eS={\u043F\u0435\u0440\u0432\u043E\u0435:1,\u043F\u0435\u0440\u0432\u043E\u0433\u043E:1,\u0432\u0442\u043E\u0440\u043E\u0435:2,\u0432\u0442\u043E\u0440\u043E\u0433\u043E:2,\u0442\u0440\u0435\u0442\u044C\u0435:3,\u0442\u0440\u0435\u0442\u044C\u0435\u0433\u043E:3,\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0435:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0433\u043E:4,\u043F\u044F\u0442\u043E\u0435:5,\u043F\u044F\u0442\u043E\u0433\u043E:5,\u0448\u0435\u0441\u0442\u043E\u0435:6,\u0448\u0435\u0441\u0442\u043E\u0433\u043E:6,\u0441\u0435\u0434\u044C\u043C\u043E\u0435:7,\u0441\u0435\u0434\u044C\u043C\u043E\u0433\u043E:7,\u0432\u043E\u0441\u044C\u043C\u043E\u0435:8,\u0432\u043E\u0441\u044C\u043C\u043E\u0433\u043E:8,\u0434\u0435\u0432\u044F\u0442\u043E\u0435:9,\u0434\u0435\u0432\u044F\u0442\u043E\u0433\u043E:9,\u0434\u0435\u0441\u044F\u0442\u043E\u0435:10,\u0434\u0435\u0441\u044F\u0442\u043E\u0433\u043E:10,\u043E\u0434\u0438\u043D\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:11,\u043E\u0434\u0438\u043D\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:11,\u0434\u0432\u0435\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:12,\u0434\u0432\u0435\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:12,\u0442\u0440\u0438\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:13,\u0442\u0440\u0438\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:13,\u0447\u0435\u0442\u044B\u0440\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:14,\u0447\u0435\u0442\u044B\u0440\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:14,\u043F\u044F\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:15,\u043F\u044F\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:15,\u0448\u0435\u0441\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:16,\u0448\u0435\u0441\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:16,\u0441\u0435\u043C\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:17,\u0441\u0435\u043C\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:17,\u0432\u043E\u0441\u0435\u043C\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:18,\u0432\u043E\u0441\u0435\u043C\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:18,\u0434\u0435\u0432\u044F\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:19,\u0434\u0435\u0432\u044F\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:19,\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u043E\u0435:20,\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:20,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u043E\u0435":21,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u043E\u0433\u043E":21,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0432\u0442\u043E\u0440\u043E\u0435":22,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0432\u0442\u043E\u0440\u043E\u0433\u043E":22,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0442\u0440\u0435\u0442\u044C\u0435":23,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0442\u0440\u0435\u0442\u044C\u0435\u0433\u043E":23,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0435":24,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0433\u043E":24,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u043F\u044F\u0442\u043E\u0435":25,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u043F\u044F\u0442\u043E\u0433\u043E":25,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0448\u0435\u0441\u0442\u043E\u0435":26,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0448\u0435\u0441\u0442\u043E\u0433\u043E":26,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0441\u0435\u0434\u044C\u043C\u043E\u0435":27,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0441\u0435\u0434\u044C\u043C\u043E\u0433\u043E":27,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0432\u043E\u0441\u044C\u043C\u043E\u0435":28,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0432\u043E\u0441\u044C\u043C\u043E\u0433\u043E":28,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0434\u0435\u0432\u044F\u0442\u043E\u0435":29,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0434\u0435\u0432\u044F\u0442\u043E\u0433\u043E":29,\u0442\u0440\u0438\u0434\u0446\u0430\u0442\u043E\u0435:30,\u0442\u0440\u0438\u0434\u0446\u0430\u0442\u043E\u0433\u043E:30,"\u0442\u0440\u0438\u0434\u0446\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u043E\u0435":31,"\u0442\u0440\u0438\u0434\u0446\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u043E\u0433\u043E":31},Sf={\u0441\u0435\u043A:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0430:"second",\u0441\u0435\u043A\u0443\u043D\u0434:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u044B:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0443:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0430:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0438:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u0435\u043A:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0443:"second",\u043C\u0438\u043D:"minute",\u043C\u0438\u043D\u0443\u0442\u0430:"minute",\u043C\u0438\u043D\u0443\u0442:"minute",\u043C\u0438\u043D\u0443\u0442\u044B:"minute",\u043C\u0438\u043D\u0443\u0442\u0443:"minute",\u043C\u0438\u043D\u0443\u0442\u043E\u043A:"minute",\u043C\u0438\u043D\u0443\u0442\u043A\u0438:"minute",\u043C\u0438\u043D\u0443\u0442\u043A\u0443:"minute",\u043C\u0438\u043D\u0443\u0442\u043E\u0447\u0435\u043A:"minute",\u043C\u0438\u043D\u0443\u0442\u043E\u0447\u043A\u0438:"minute",\u043C\u0438\u043D\u0443\u0442\u043E\u0447\u043A\u0443:"minute",\u0447\u0430\u0441:"hour",\u0447\u0430\u0441\u043E\u0432:"hour",\u0447\u0430\u0441\u0430:"hour",\u0447\u0430\u0441\u0443:"hour",\u0447\u0430\u0441\u0438\u043A\u043E\u0432:"hour",\u0447\u0430\u0441\u0438\u043A\u0430:"hour",\u0447\u0430\u0441\u0438\u043A\u0435:"hour",\u0447\u0430\u0441\u0438\u043A:"hour",\u0434\u0435\u043D\u044C:"d",\u0434\u043D\u044F:"d",\u0434\u043D\u0435\u0439:"d",\u0441\u0443\u0442\u043E\u043A:"d",\u0441\u0443\u0442\u043A\u0438:"d",\u043D\u0435\u0434\u0435\u043B\u044F:"week",\u043D\u0435\u0434\u0435\u043B\u0435:"week",\u043D\u0435\u0434\u0435\u043B\u0438:"week",\u043D\u0435\u0434\u0435\u043B\u044E:"week",\u043D\u0435\u0434\u0435\u043B\u044C:"week",\u043D\u0435\u0434\u0435\u043B\u044C\u043A\u0435:"week",\u043D\u0435\u0434\u0435\u043B\u044C\u043A\u0438:"week",\u043D\u0435\u0434\u0435\u043B\u0435\u043A:"week",\u043C\u0435\u0441\u044F\u0446:"month",\u043C\u0435\u0441\u044F\u0446\u0435:"month",\u043C\u0435\u0441\u044F\u0446\u0435\u0432:"month",\u043C\u0435\u0441\u044F\u0446\u0430:"month",\u043A\u0432\u0430\u0440\u0442\u0430\u043B:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0435:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u043E\u0432:"quarter",\u0433\u043E\u0434:"year",\u0433\u043E\u0434\u0430:"year",\u0433\u043E\u0434\u0443:"year",\u0433\u043E\u0434\u043E\u0432:"year",\u043B\u0435\u0442:"year",\u0433\u043E\u0434\u0438\u043A:"year",\u0433\u043E\u0434\u0438\u043A\u0430:"year",\u0433\u043E\u0434\u0438\u043A\u043E\u0432:"year"},WG=`(?:${q(JE)}|[0-9]+|[0-9]+\\.[0-9]+|\u043F\u043E\u043B|\u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E|\u043F\u0430\u0440(?:\u044B|\u0443)|\\s{0,3})`;sS=`(?:${q(eS)}|[0-9]{1,2}(?:\u0433\u043E|\u043E\u0433\u043E|\u0435|\u043E\u0435)?)`;XE="(?:\\s+(?:\u0433\u043E\u0434\u0443|\u0433\u043E\u0434\u0430|\u0433\u043E\u0434|\u0433|\u0433.))?",my=`(?:[1-9][0-9]{0,3}${XE}\\s*(?:\u043D.\u044D.|\u0434\u043E \u043D.\u044D.|\u043D. \u044D.|\u0434\u043E \u043D. \u044D.)|[1-2][0-9]{3}${XE}|[5-9][0-9]${XE})`;ZL=`(${WG})\\s{0,3}(${q(Sf)})`,KL=new RegExp(ZL,"i"),Kc=Vr("(?:(?:\u043E\u043A\u043E\u043B\u043E|\u043F\u0440\u0438\u043C\u0435\u0440\u043D\u043E)\\s{0,3})?",ZL)});var XL,Df,JL=v(()=>{Ns();xe();se();XL=`(?:(?:\u043E\u043A\u043E\u043B\u043E|\u043F\u0440\u0438\u043C\u0435\u0440\u043D\u043E)\\s*(?:~\\s*)?)?(${Kc})${Rs.rightBoundary}`,Df=class extends H{patternLeftBoundary(){return Rs.leftBoundary}innerPattern(e){return e.option.forwardDate?new RegExp(XL,Rs.flags):new RegExp(`(?:\u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0435|\u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0438)\\s*${XL}`,Rs.flags)}innerExtract(e,t){let r=Zc(t[1]);return Y.createRelativeFromReference(e.reference,r)}}});var al,cs,$i=v(()=>{se();Ns();al=class extends H{patternLeftBoundary(){return Rs.leftBoundary}innerPattern(e){return new RegExp(this.innerPatternString(e),Rs.flags)}innerPatternHasChange(e,t){return!1}},cs=class extends al{innerPattern(e){return new RegExp(`${this.innerPatternString(e)}${Rs.rightBoundary}`,Rs.flags)}}});var eF,tF,YG,rF,xf,sF=v(()=>{Rt();Ns();Ns();Ns();He();$i();eF=1,tF=2,YG=3,rF=4,xf=class extends cs{innerPatternString(e){return`(?:\u0441)?\\s*(${sS})(?:\\s{0,3}(?:\u043F\u043E|-|\u2013|\u0434\u043E)?\\s{0,3}(${sS}))?(?:-|\\/|\\s{0,3}(?:of)?\\s{0,3})(${q(Qc)})(?:(?:-|\\/|,?\\s{0,3})(${my}(?![^\\s]\\d)))?`}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=Qc[t[YG].toLowerCase()],i=nS(t[eF]);if(i>31)return t.index=t.index+t[eF].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[rF]){let a=gy(t[rF]);r.start.assign("year",a)}else{let a=rt(e.refDate,i,s);r.start.imply("year",a)}if(t[tF]){let a=nS(t[tF]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var zG,nF,Cf,iF=v(()=>{Ns();Rt();He();Ns();$i();zG=2,nF=3,Cf=class extends al{innerPatternString(e){return`((?:\u0432)\\s*)?(${q(Qc)})\\s*(?:[,-]?\\s*(${my})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`}innerExtract(e,t){let r=t[zG].toLowerCase();if(t[0].length<=3&&!rS[r])return null;let s=e.createParsingResult(t.index,t.index+t[0].length);s.start.imply("day",1);let i=Qc[r];if(s.start.assign("month",i),t[nF]){let a=gy(t[nF]);s.start.assign("year",a)}else{let a=rt(e.refDate,1,i);s.start.imply("year",a)}return s}}});var Mf,aF=v(()=>{We();Bi();Ns();Mf=class extends cr{constructor(e){super(e)}patternFlags(){return Rs.flags}primaryPatternLeftBoundary(){return"(^|\\s|T|(?:[^\\p{L}\\p{N}_]))"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|\u0434\u043E|\u0438|\u043F\u043E|\\?)\\s*"}primaryPrefix(){return"(?:(?:\u0432|\u0441)\\s*)??"}primarySuffix(){return`(?:\\s*(?:\u0443\u0442\u0440\u0430|\u0432\u0435\u0447\u0435\u0440\u0430|\u043F\u043E\u0441\u043B\u0435 \u043F\u043E\u043B\u0443\u0434\u043D\u044F))?(?!\\/)${Rs.rightBoundary}`}extractPrimaryTimeComponents(e,t){let r=super.extractPrimaryTimeComponents(e,t);if(r){if(t[0].endsWith("\u0432\u0435\u0447\u0435\u0440\u0430")){let s=r.get("hour");s>=6&&s<12?(r.assign("hour",r.get("hour")+12),r.assign("meridiem",O.PM)):s<6&&r.assign("meridiem",O.AM)}if(t[0].endsWith("\u043F\u043E\u0441\u043B\u0435 \u043F\u043E\u043B\u0443\u0434\u043D\u044F")){r.assign("meridiem",O.PM);let s=r.get("hour");s>=0&&s<=6&&r.assign("hour",r.get("hour")+12)}t[0].endsWith("\u0443\u0442\u0440\u0430")&&(r.assign("meridiem",O.AM),r.get("hour")<12&&r.assign("hour",r.get("hour")))}return r}}});var Pf,oF=v(()=>{Ns();xe();As();$i();Pf=class extends al{innerPatternString(e){return`(${Kc})\\s{0,5}\u043D\u0430\u0437\u0430\u0434(?=(?:\\W|$))`}innerExtract(e,t){let r=Zc(t[1]),s=Kt(r);return Y.createRelativeFromReference(e.reference,s)}}});var _f,lF=v(()=>{sn();_f=class extends vt{patternBetween(){return/^\s*(и до|и по|до|по|-)\s*$/i}}});var Af,cF=v(()=>{nn();Af=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|\u0432|,|-)?\\s*$")}}});var If,dF=v(()=>{_s();$i();If=class extends cs{innerPatternString(e){return"(?:\u0441|\u0441\u043E)?\\s*(\u0441\u0435\u0433\u043E\u0434\u043D\u044F|\u0432\u0447\u0435\u0440\u0430|\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u043E\u0441\u043B\u0435\u043F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u043E\u0437\u0430\u043F\u043E\u0437\u0430\u0432\u0447\u0435\u0440\u0430|\u043F\u043E\u0437\u0430\u0432\u0447\u0435\u0440\u0430)"}innerExtract(e,t){let r=t[1].toLowerCase(),s=e.createParsingComponents();switch(r){case"\u0441\u0435\u0433\u043E\u0434\u043D\u044F":return dr(e.reference);case"\u0432\u0447\u0435\u0440\u0430":return Or(e.reference);case"\u0437\u0430\u0432\u0442\u0440\u0430":return Lr(e.reference);case"\u043F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430":return si(e.reference,2);case"\u043F\u043E\u0441\u043B\u0435\u043F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430":return si(e.reference,3);case"\u043F\u043E\u0437\u0430\u0432\u0447\u0435\u0440\u0430":return Wo(e.reference,2);case"\u043F\u043E\u0437\u0430\u043F\u043E\u0437\u0430\u0432\u0447\u0435\u0440\u0430":return Wo(e.reference,3)}return s}}});var uF,Rf,hF=v(()=>{_s();Ms();uF=Ee(Ke(),1);$i();Rf=class extends cs{innerPatternString(e){return"(\u0441\u0435\u0439\u0447\u0430\u0441|\u043F\u0440\u043E\u0448\u043B\u044B\u043C\\s*\u0432\u0435\u0447\u0435\u0440\u043E\u043C|\u043F\u0440\u043E\u0448\u043B\u043E\u0439\\s*\u043D\u043E\u0447\u044C\u044E|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439\\s*\u043D\u043E\u0447\u044C\u044E|\u0441\u0435\u0433\u043E\u0434\u043D\u044F\\s*\u043D\u043E\u0447\u044C\u044E|\u044D\u0442\u043E\u0439\\s*\u043D\u043E\u0447\u044C\u044E|\u043D\u043E\u0447\u044C\u044E|\u044D\u0442\u0438\u043C \u0443\u0442\u0440\u043E\u043C|\u0443\u0442\u0440\u043E\u043C|\u0443\u0442\u0440\u0430|\u0432\\s*\u043F\u043E\u043B\u0434\u0435\u043D\u044C|\u0432\u0435\u0447\u0435\u0440\u043E\u043C|\u0432\u0435\u0447\u0435\u0440\u0430|\u0432\\s*\u043F\u043E\u043B\u043D\u043E\u0447\u044C)"}innerExtract(e,t){let r=(0,uF.default)(e.refDate),s=t[0].toLowerCase(),i=e.createParsingComponents();if(s==="\u0441\u0435\u0439\u0447\u0430\u0441")return Nr(e.reference);if(s==="\u0432\u0435\u0447\u0435\u0440\u043E\u043C"||s==="\u0432\u0435\u0447\u0435\u0440\u0430")return Oc(e.reference);if(s.endsWith("\u0443\u0442\u0440\u043E\u043C")||s.endsWith("\u0443\u0442\u0440\u0430"))return Lc(e.reference);if(s.match(/в\s*полдень/))return Fc(e.reference);if(s.match(/прошлой\s*ночью/))return Ug(e.reference);if(s.match(/прошлым\s*вечером/))return jg(e.reference);if(s.match(/следующей\s*ночью/)){let a=r.hour()<22?1:2;r=r.add(a,"day"),ft(i,r),i.imply("hour",0)}return s.match(/в\s*полночь/)||s.endsWith("\u043D\u043E\u0447\u044C\u044E")?Vo(e.reference):i}}});var qG,GG,QG,Nf,fF=v(()=>{Ns();He();Mn();$i();qG=1,GG=2,QG=3,Nf=class extends cs{innerPatternString(e){return`(?:(?:,|\\(|\uFF08)\\s*)?(?:\u0432\\s*?)?(?:(\u044D\u0442\u0443|\u044D\u0442\u043E\u0442|\u043F\u0440\u043E\u0448\u043B\u044B\u0439|\u043F\u0440\u043E\u0448\u043B\u0443\u044E|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0433\u043E)\\s*)?(${q(tS)})(?:\\s*(?:,|\\)|\uFF09))?(?:\\s*\u043D\u0430\\s*(\u044D\u0442\u043E\u0439|\u043F\u0440\u043E\u0448\u043B\u043E\u0439|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439)\\s*\u043D\u0435\u0434\u0435\u043B\u0435)?`}innerExtract(e,t){let r=t[GG].toLowerCase(),s=tS[r],i=t[qG],a=t[QG],o=i||a;o=o||"",o=o.toLowerCase();let l=null;return o=="\u043F\u0440\u043E\u0448\u043B\u044B\u0439"||o=="\u043F\u0440\u043E\u0448\u043B\u0443\u044E"||o=="\u043F\u0440\u043E\u0448\u043B\u043E\u0439"?l="last":o=="\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439"||o=="\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E"||o=="\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439"||o=="\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0433\u043E"?l="next":(o=="\u044D\u0442\u043E\u0442"||o=="\u044D\u0442\u0443"||o=="\u044D\u0442\u043E\u0439")&&(l="this"),Zt(e.reference,s,l)}}});var pF,KG,ZG,Of,mF=v(()=>{Ns();xe();pF=Ee(Ke(),1);He();$i();KG=1,ZG=2,Of=class extends cs{innerPatternString(e){return`(\u0432 \u043F\u0440\u043E\u0448\u043B\u043E\u043C|\u043D\u0430 \u043F\u0440\u043E\u0448\u043B\u043E\u0439|\u043D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439|\u0432 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u043C|\u043D\u0430 \u044D\u0442\u043E\u0439|\u0432 \u044D\u0442\u043E\u043C)\\s*(${q(Sf)})`}innerExtract(e,t){let r=t[KG].toLowerCase(),s=t[ZG].toLowerCase(),i=Sf[s];if(r=="\u043D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439"||r=="\u0432 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u043C"){let l={};return l[i]=1,Y.createRelativeFromReference(e.reference,l)}if(r=="\u0432 \u043F\u0440\u043E\u0448\u043B\u043E\u043C"||r=="\u043D\u0430 \u043F\u0440\u043E\u0448\u043B\u043E\u0439"){let l={};return l[i]=-1,Y.createRelativeFromReference(e.reference,l)}let a=e.createParsingComponents(),o=(0,pF.default)(e.reference.instant);return i.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):i.match(/month/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):i.match(/year/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var Lf,gF=v(()=>{Ns();xe();As();$i();Lf=class extends cs{innerPatternString(e){return`(\u044D\u0442\u0438|\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435|\u043F\u0440\u043E\u0448\u043B\u044B\u0435|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0435|\u043F\u043E\u0441\u043B\u0435|\u0441\u043F\u0443\u0441\u0442\u044F|\u0447\u0435\u0440\u0435\u0437|\\+|-)\\s*(${Kc})`}innerExtract(e,t){let r=t[1].toLowerCase(),s=Zc(t[2]);switch(r){case"\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435":case"\u043F\u0440\u043E\u0448\u043B\u044B\u0435":case"-":s=Kt(s);break}return Y.createRelativeFromReference(e.reference,s)}}});var oS={};st(oS,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>iS,createCasualConfiguration:()=>yF,createConfiguration:()=>aS,parse:()=>JG,parseDate:()=>e6,strict:()=>XG});function JG(n,e,t){return iS.parse(n,e,t)}function e6(n,e,t){return iS.parseDate(n,e,t)}function yF(){let n=aS(!1);return n.parsers.unshift(new If),n.parsers.unshift(new Rf),n.parsers.unshift(new Cf),n.parsers.unshift(new Of),n.parsers.unshift(new Lf),n}function aS(n=!0){return Et({parsers:[new nr(!0),new Df,new xf,new Nf,new Mf(n),new Pf],refiners:[new Af,new _f]},n)}var iS,XG,vF=v(()=>{JL();sF();iF();aF();oF();lF();cF();Ps();dF();hF();fF();mF();ls();xe();We();Wi();gF();iS=new me(yF()),XG=new me(aS(!0))});function r6(n){let e=n.toLowerCase();return lS[e]!==void 0?lS[e]:e==="un"||e==="una"||e==="uno"?1:e.match(/algunos?/)||e.match(/unos?/)?3:e.match(/media?/)?.5:parseFloat(e)}function kF(n){if(n.match(/^[0-9]{1,4}$/)){let e=parseInt(n);return e<100&&(e>50?e=e+1900:e=e+2e3),e}return n.match(/a\.?\s*c\.?/i)?(n=n.replace(/a\.?\s*c\.?/i,""),-parseInt(n)):parseInt(n)}function DF(n){let e={},t=n,r=TF.exec(t);for(;r;)s6(e,r),t=t.substring(r[0].length),r=TF.exec(t);return e}function s6(n,e){let t=r6(e[1]),r=wF[e[2].toLowerCase()];n[r]=t}var cS,dS,lS,wF,t6,bF,EF,TF,SF,Ff=v(()=>{He();cS={domingo:0,dom:0,lunes:1,lun:1,martes:2,mar:2,mi\u00E9rcoles:3,miercoles:3,mi\u00E9:3,mie:3,jueves:4,jue:4,viernes:5,vie:5,s\u00E1bado:6,sabado:6,s\u00E1b:6,sab:6},dS={enero:1,ene:1,"ene.":1,febrero:2,feb:2,"feb.":2,marzo:3,mar:3,"mar.":3,abril:4,abr:4,"abr.":4,mayo:5,may:5,"may.":5,junio:6,jun:6,"jun.":6,julio:7,jul:7,"jul.":7,agosto:8,ago:8,"ago.":8,septiembre:9,setiembre:9,sep:9,"sep.":9,octubre:10,oct:10,"oct.":10,noviembre:11,nov:11,"nov.":11,diciembre:12,dic:12,"dic.":12},lS={uno:1,dos:2,tres:3,cuatro:4,cinco:5,seis:6,siete:7,ocho:8,nueve:9,diez:10,once:11,doce:12,trece:13},wF={sec:"second",segundo:"second",segundos:"second",min:"minute",mins:"minute",minuto:"minute",minutos:"minute",h:"hour",hr:"hour",hrs:"hour",hora:"hour",horas:"hour",d\u00EDa:"d",d\u00EDas:"d",semana:"week",semanas:"week",mes:"month",meses:"month",cuarto:"quarter",cuartos:"quarter",a\u00F1o:"year",a\u00F1os:"year"},t6=`(?:${q(lS)}|[0-9]+|[0-9]+\\.[0-9]+|un?|uno?|una?|algunos?|unos?|demi-?)`;bF="[0-9]{1,4}(?![^\\s]\\d)(?:\\s*[a|d]\\.?\\s*c\\.?|\\s*a\\.?\\s*d\\.?)?";EF=`(${t6})\\s{0,5}(${q(wF)})\\s{0,5}`,TF=new RegExp(EF,"i"),SF=Vr("",EF)});var n6,i6,a6,o6,Hf,xF=v(()=>{Ff();He();se();Mn();n6=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:(este|esta|pasado|pr[o\xF3]ximo)\\s*)?(${q(cS)})(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(este|esta|pasado|pr[\xF3o]ximo)\\s*semana)?(?=\\W|\\d|$)`,"i"),i6=1,a6=2,o6=3,Hf=class extends H{innerPattern(){return n6}innerExtract(e,t){let r=t[a6].toLowerCase(),s=cS[r];if(s===void 0)return null;let i=t[i6],a=t[o6],o=i||a||"";o=o.toLowerCase();let l=null;return o=="pasado"?l="this":o=="pr\xF3ximo"||o=="proximo"?l="next":o=="este"&&(l="this"),Zt(e.reference,s,l)}}});var Bf,CF=v(()=>{Bi();Bf=class extends cr{primaryPrefix(){return"(?:(?:aslas|deslas|las?|al?|de|del)\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|a(?:l)?|\\?)\\s*"}}});var Uf,MF=v(()=>{nn();Uf=class extends Tt{patternBetween(){return new RegExp("^\\s*(?:,|de|aslas|a)?\\s*$")}}});var jf,PF=v(()=>{sn();jf=class extends vt{patternBetween(){return/^\s*(?:-)\s*$/i}}});var l6,_F,AF,c6,IF,Wf,RF=v(()=>{Rt();Ff();Ff();He();se();l6=new RegExp(`([0-9]{1,2})(?:\xBA|\xAA|\xB0)?(?:\\s*(?:desde|de|\\-|\\\u2013|ao?|\\s)\\s*([0-9]{1,2})(?:\xBA|\xAA|\xB0)?)?\\s*(?:de)?\\s*(?:-|/|\\s*(?:de|,)?\\s*)(${q(dS)})(?:\\s*(?:de|,)?\\s*(${bF}))?(?=\\W|$)`,"i"),_F=1,AF=2,c6=3,IF=4,Wf=class extends H{innerPattern(){return l6}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=dS[t[c6].toLowerCase()],i=parseInt(t[_F]);if(i>31)return t.index=t.index+t[_F].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[IF]){let a=kF(t[IF]);r.start.assign("year",a)}else{let a=rt(e.refDate,i,s);r.start.imply("year",a)}if(t[AF]){let a=parseInt(t[AF]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var Vf,NF=v(()=>{se();_s();Vf=class extends H{innerPattern(e){return/(ahora|hoy|mañana|ayer)(?=\W|$)/i}innerExtract(e,t){let r=t[0].toLowerCase(),s=e.createParsingComponents();switch(r){case"ahora":return Nr(e.reference);case"hoy":return dr(e.reference);case"ma\xF1ana":return Lr(e.reference);case"ayer":return Or(e.reference)}return s}}});var OF,$f,LF=v(()=>{We();se();Ms();OF=Ee(Ke(),1),$f=class extends H{innerPattern(){return/(?:esta\s*)?(mañana|tarde|medianoche|mediodia|mediodía|noche)(?=\W|$)/i}innerExtract(e,t){let r=(0,OF.default)(e.refDate),s=e.createParsingComponents();switch(t[1].toLowerCase()){case"tarde":s.imply("meridiem",O.PM),s.imply("hour",15);break;case"noche":s.imply("meridiem",O.PM),s.imply("hour",22);break;case"ma\xF1ana":s.imply("meridiem",O.AM),s.imply("hour",6);break;case"medianoche":xn(s,r),s.imply("hour",0),s.imply("minute",0),s.imply("second",0);break;case"mediodia":case"mediod\xEDa":s.imply("meridiem",O.AM),s.imply("hour",12);break}return s}}});var Yf,FF=v(()=>{Ff();xe();se();Yf=class extends H{innerPattern(){return new RegExp(`(?:en|por|durante|de|dentro de)\\s*(${SF})(?=\\W|$)`,"i")}innerExtract(e,t){let r=DF(t[1]);return Y.createRelativeFromReference(e.reference,r)}}});var fS={};st(fS,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>uS,createCasualConfiguration:()=>HF,createConfiguration:()=>hS,parse:()=>u6,parseDate:()=>h6,strict:()=>d6});function u6(n,e,t){return uS.parse(n,e,t)}function h6(n,e,t){return uS.parseDate(n,e,t)}function HF(n=!0){let e=hS(!1,n);return e.parsers.push(new Vf),e.parsers.push(new $f),e}function hS(n=!0,e=!0){return Et({parsers:[new nr(e),new Hf,new Bf,new Wf,new Yf],refiners:[new Uf,new jf]},n)}var uS,d6,BF=v(()=>{Ps();ls();xe();We();Wi();xF();CF();MF();PF();RF();NF();LF();FF();uS=new me(HF()),d6=new me(hS(!0))});function p6(n){let e=n.toLowerCase();return mS[e]!==void 0?mS[e]:e.match(/декілька/)?2:e.match(/пів/)?.5:e.match(/пар/)?2:e===""?1:parseFloat(e)}function wS(n){let e=n.toLowerCase();return gS[e]!==void 0?gS[e]:parseInt(e)}function vy(n){if(/(рік|року|р|р.)/i.test(n)&&(n=n.replace(/(рік|року|р|р.)/i,"")),/(до н.е.|до н. е.)/i.test(n))return n=n.replace(/(до н.е.|до н. е.)/i,""),-parseInt(n);if(/(н. е.|н.е.)/i.test(n))return n=n.replace(/(н. е.|н.е.)/i,""),parseInt(n);let e=parseInt(n);return as(e)}function ed(n){let e={},t=n,r=UF.exec(t);for(;r;)m6(e,r),t=t.substring(r[0].length).trim(),r=UF.exec(t);return e}function m6(n,e){let t=p6(e[1]),r=zf[e[2].toLowerCase()];n[r]=t}var un,yS,vS,Xc,mS,gS,zf,f6,TS,pS,yy,jF,UF,Jc,Os=v(()=>{He();Rt();un={leftBoundary:"([^\\p{L}\\p{N}_]|^)",rightBoundary:"(?=[^\\p{L}\\p{N}_]|$)",flags:"iu"},yS={\u043D\u0435\u0434\u0456\u043B\u044F:0,\u043D\u0435\u0434\u0456\u043B\u0456:0,\u043D\u0435\u0434\u0456\u043B\u044E:0,\u043D\u0434:0,"\u043D\u0434.":0,\u043F\u043E\u043D\u0435\u0434\u0456\u043B\u043E\u043A:1,\u043F\u043E\u043D\u0435\u0434\u0456\u043B\u043A\u0430:1,\u043F\u043D:1,"\u043F\u043D.":1,\u0432\u0456\u0432\u0442\u043E\u0440\u043E\u043A:2,\u0432\u0456\u0432\u0442\u043E\u0440\u043A\u0430:2,\u0432\u0442:2,"\u0432\u0442.":2,\u0441\u0435\u0440\u0435\u0434\u0430:3,\u0441\u0435\u0440\u0435\u0434\u0438:3,\u0441\u0435\u0440\u0435\u0434\u0443:3,\u0441\u0440:3,"\u0441\u0440.":3,\u0447\u0435\u0442\u0432\u0435\u0440:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0430:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0443:4,\u0447\u0442:4,"\u0447\u0442.":4,"\u043F'\u044F\u0442\u043D\u0438\u0446\u044F":5,"\u043F'\u044F\u0442\u043D\u0438\u0446\u0456":5,"\u043F'\u044F\u0442\u043D\u0438\u0446\u044E":5,\u043F\u0442:5,"\u043F\u0442.":5,\u0441\u0443\u0431\u043E\u0442\u0430:6,\u0441\u0443\u0431\u043E\u0442\u0438:6,\u0441\u0443\u0431\u043E\u0442\u0443:6,\u0441\u0431:6,"\u0441\u0431.":6},vS={\u0441\u0456\u0447\u0435\u043D\u044C:1,\u0441\u0456\u0447\u043D\u044F:1,\u0441\u0456\u0447\u043D\u0456:1,\u043B\u044E\u0442\u0438\u0439:2,\u043B\u044E\u0442\u043E\u0433\u043E:2,\u043B\u044E\u0442\u043E\u043C\u0443:2,\u0431\u0435\u0440\u0435\u0437\u0435\u043D\u044C:3,\u0431\u0435\u0440\u0435\u0437\u043D\u044F:3,\u0431\u0435\u0440\u0435\u0437\u043D\u0456:3,\u043A\u0432\u0456\u0442\u0435\u043D\u044C:4,\u043A\u0432\u0456\u0442\u043D\u044F:4,\u043A\u0432\u0456\u0442\u043D\u0456:4,\u0442\u0440\u0430\u0432\u0435\u043D\u044C:5,\u0442\u0440\u0430\u0432\u043D\u044F:5,\u0442\u0440\u0430\u0432\u043D\u0456:5,\u0447\u0435\u0440\u0432\u0435\u043D\u044C:6,\u0447\u0435\u0440\u0432\u043D\u044F:6,\u0447\u0435\u0440\u0432\u043D\u0456:6,\u043B\u0438\u043F\u0435\u043D\u044C:7,\u043B\u0438\u043F\u043D\u044F:7,\u043B\u0438\u043F\u043D\u0456:7,\u0441\u0435\u0440\u043F\u0435\u043D\u044C:8,\u0441\u0435\u0440\u043F\u043D\u044F:8,\u0441\u0435\u0440\u043F\u043D\u0456:8,\u0432\u0435\u0440\u0435\u0441\u0435\u043D\u044C:9,\u0432\u0435\u0440\u0435\u0441\u043D\u044F:9,\u0432\u0435\u0440\u0435\u0441\u043D\u0456:9,\u0436\u043E\u0432\u0442\u0435\u043D\u044C:10,\u0436\u043E\u0432\u0442\u043D\u044F:10,\u0436\u043E\u0432\u0442\u043D\u0456:10,\u043B\u0438\u0441\u0442\u043E\u043F\u0430\u0434:11,\u043B\u0438\u0441\u0442\u043E\u043F\u0430\u0434\u0430:11,\u043B\u0438\u0441\u0442\u043E\u043F\u0430\u0434\u0443:11,\u0433\u0440\u0443\u0434\u0435\u043D\u044C:12,\u0433\u0440\u0443\u0434\u043D\u044F:12,\u0433\u0440\u0443\u0434\u043D\u0456:12},Xc={...vS,\u0441\u0456\u0447:1,"\u0441\u0456\u0447.":1,\u043B\u044E\u0442:2,"\u043B\u044E\u0442.":2,\u0431\u0435\u0440:3,"\u0431\u0435\u0440.":3,\u043A\u0432\u0456\u0442:4,"\u043A\u0432\u0456\u0442.":4,\u0442\u0440\u0430\u0432:5,"\u0442\u0440\u0430\u0432.":5,\u0447\u0435\u0440\u0432:6,"\u0447\u0435\u0440\u0432.":6,\u043B\u0438\u043F:7,"\u043B\u0438\u043F.":7,\u0441\u0435\u0440\u043F:8,"\u0441\u0435\u0440\u043F.":8,\u0441\u0435\u0440:8,"c\u0435\u0440.":8,\u0432\u0435\u0440:9,"\u0432\u0435\u0440.":9,\u0432\u0435\u0440\u0435\u0441:9,"\u0432\u0435\u0440\u0435\u0441.":9,\u0436\u043E\u0432\u0442:10,"\u0436\u043E\u0432\u0442.":10,\u043B\u0438\u0441\u0442\u043E\u043F:11,"\u043B\u0438\u0441\u0442\u043E\u043F.":11,\u0433\u0440\u0443\u0434:12,"\u0433\u0440\u0443\u0434.":12},mS={\u043E\u0434\u0438\u043D:1,\u043E\u0434\u043D\u0430:1,\u043E\u0434\u043D\u043E\u0457:1,\u043E\u0434\u043D\u0443:1,\u0434\u0432\u0456:2,\u0434\u0432\u0430:2,\u0434\u0432\u043E\u0445:2,\u0442\u0440\u0438:3,\u0442\u0440\u044C\u043E\u0445:3,\u0447\u043E\u0442\u0438\u0440\u0438:4,\u0447\u043E\u0442\u0438\u0440\u044C\u043E\u0445:4,"\u043F'\u044F\u0442\u044C":5,"\u043F'\u044F\u0442\u0438":5,\u0448\u0456\u0441\u0442\u044C:6,\u0448\u0435\u0441\u0442\u0438:6,\u0441\u0456\u043C:7,\u0441\u0435\u043C\u0438:7,\u0432\u0456\u0441\u0456\u043C:8,\u0432\u043E\u0441\u044C\u043C\u0438:8,"\u0434\u0435\u0432'\u044F\u0442\u044C":9,"\u0434\u0435\u0432'\u044F\u0442\u0438":9,\u0434\u0435\u0441\u044F\u0442\u044C:10,\u0434\u0435\u0441\u044F\u0442\u0438:10,\u043E\u0434\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u044C:11,\u043E\u0434\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u0438:11,\u0434\u0432\u0430\u043D\u0430\u0434\u0446\u044F\u0442\u044C:12,\u0434\u0432\u0430\u043D\u0430\u0434\u0446\u044F\u0442\u0438:12},gS={\u043F\u0435\u0440\u0448\u0435:1,\u043F\u0435\u0440\u0448\u043E\u0433\u043E:1,\u0434\u0440\u0443\u0433\u0435:2,\u0434\u0440\u0443\u0433\u043E\u0433\u043E:2,\u0442\u0440\u0435\u0442\u0454:3,\u0442\u0440\u0435\u0442\u044C\u043E\u0433\u043E:3,\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0435:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0433\u043E:4,"\u043F'\u044F\u0442\u0435":5,"\u043F'\u044F\u0442\u043E\u0433\u043E":5,\u0448\u043E\u0441\u0442\u0435:6,\u0448\u043E\u0441\u0442\u043E\u0433\u043E:6,\u0441\u044C\u043E\u043C\u0435:7,\u0441\u044C\u043E\u043C\u043E\u0433\u043E:7,\u0432\u043E\u0441\u044C\u043C\u0435:8,\u0432\u043E\u0441\u044C\u043C\u043E\u0433\u043E:8,"\u0434\u0435\u0432'\u044F\u0442\u0435":9,"\u0434\u0435\u0432'\u044F\u0442\u043E\u0433\u043E":9,\u0434\u0435\u0441\u044F\u0442\u0435:10,\u0434\u0435\u0441\u044F\u0442\u043E\u0433\u043E:10,\u043E\u0434\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u0435:11,\u043E\u0434\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:11,\u0434\u0432\u0430\u043D\u0430\u0434\u0446\u044F\u0442\u0435:12,\u0434\u0432\u0430\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:12,\u0442\u0440\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u0435:13,\u0442\u0440\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:13,\u0447\u043E\u0442\u0438\u0440\u043D\u0430\u0434\u0446\u044F\u0442\u0435:14,\u0447\u043E\u0442\u0438\u043D\u0440\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:14,"\u043F'\u044F\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u0435":15,"\u043F'\u044F\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E":15,\u0448\u0456\u0441\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u0435:16,\u0448\u0456\u0441\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:16,\u0441\u0456\u043C\u043D\u0430\u0434\u0446\u044F\u0442\u0435:17,\u0441\u0456\u043C\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:17,\u0432\u0456\u0441\u0456\u043C\u043D\u0430\u0434\u0446\u044F\u0442\u0435:18,\u0432\u0456\u0441\u0456\u043C\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:18,"\u0434\u0435\u0432'\u044F\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u0435":19,"\u0434\u0435\u0432'\u044F\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E":19,\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u0435:20,\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:20,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u043F\u0435\u0440\u0448\u0435":21,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u043F\u0435\u0440\u0448\u043E\u0433\u043E":21,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0434\u0440\u0443\u0433\u0435":22,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0434\u0440\u0443\u0433\u043E\u0433\u043E":22,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0442\u0440\u0435\u0442\u0454":23,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0442\u0440\u0435\u0442\u044C\u043E\u0433\u043E":23,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0435":24,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0433\u043E":24,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u043F'\u044F\u0442\u0435":25,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u043F'\u044F\u0442\u043E\u0433\u043E":25,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0448\u043E\u0441\u0442\u0435":26,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0448\u043E\u0441\u0442\u043E\u0433\u043E":26,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0441\u044C\u043E\u043C\u0435":27,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0441\u044C\u043E\u043C\u043E\u0433\u043E":27,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0432\u043E\u0441\u044C\u043C\u0435":28,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0432\u043E\u0441\u044C\u043C\u043E\u0433\u043E":28,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0434\u0435\u0432'\u044F\u0442\u0435":29,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0434\u0435\u0432'\u044F\u0442\u043E\u0433\u043E":29,\u0442\u0440\u0438\u0434\u0446\u044F\u0442\u0435:30,\u0442\u0440\u0438\u0434\u0446\u044F\u0442\u043E\u0433\u043E:30,"\u0442\u0440\u0438\u0434\u0446\u044F\u0442\u044C \u043F\u0435\u0440\u0448\u0435":31,"\u0442\u0440\u0438\u0434\u0446\u044F\u0442\u044C \u043F\u0435\u0440\u0448\u043E\u0433\u043E":31},zf={\u0441\u0435\u043A:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0430:"second",\u0441\u0435\u043A\u0443\u043D\u0434:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0438:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0443:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043E\u043A:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0438:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0443:"second",\u0445\u0432:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u0430:"minute",\u0445\u0432\u0438\u043B\u0438\u043D:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u0438:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u0443:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043E\u043A:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043A\u0438:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043A\u0443:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043E\u0447\u043E\u043A:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043E\u0447\u043A\u0438:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043E\u0447\u043A\u0443:"minute",\u0433\u043E\u0434:"hour",\u0433\u043E\u0434\u0438\u043D\u0430:"hour",\u0433\u043E\u0434\u0438\u043D:"hour",\u0433\u043E\u0434\u0438\u043D\u0438:"hour",\u0433\u043E\u0434\u0438\u043D\u0443:"hour",\u0433\u043E\u0434\u0438\u043D\u043A\u0430:"hour",\u0433\u043E\u0434\u0438\u043D\u043E\u043A:"hour",\u0433\u043E\u0434\u0438\u043D\u043A\u0438:"hour",\u0433\u043E\u0434\u0438\u043D\u043A\u0443:"hour",\u0434\u0435\u043D\u044C:"d",\u0434\u043D\u044F:"d",\u0434\u043D\u0456\u0432:"d",\u0434\u043D\u0456:"d",\u0434\u043E\u0431\u0430:"d",\u0434\u043E\u0431\u0443:"d",\u0442\u0438\u0436\u0434\u0435\u043D\u044C:"week",\u0442\u0438\u0436\u043D\u044E:"week",\u0442\u0438\u0436\u043D\u044F:"week",\u0442\u0438\u0436\u043D\u0456:"week",\u0442\u0438\u0436\u043D\u0456\u0432:"week",\u043C\u0456\u0441\u044F\u0446\u044C:"month",\u043C\u0456\u0441\u044F\u0446\u0456\u0432:"month",\u043C\u0456\u0441\u044F\u0446\u0456:"month",\u043C\u0456\u0441\u044F\u0446\u044F:"month",\u043A\u0432\u0430\u0440\u0442\u0430\u043B:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0443:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0430:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0456\u0432:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0456:"quarter",\u0440\u0456\u043A:"year",\u0440\u043E\u043A\u0443:"year",\u0440\u043E\u0446\u0456:"year",\u0440\u043E\u043A\u0456\u0432:"year",\u0440\u043E\u043A\u0438:"year"},f6=`(?:${q(mS)}|[0-9]+|[0-9]+\\.[0-9]+|\u043F\u0456\u0432|\u0434\u0435\u043A\u0456\u043B\u044C\u043A\u0430|\u043F\u0430\u0440(?:\u0443)|\\s{0,3})`;TS=`(?:${q(gS)}|[0-9]{1,2}(?:\u0433\u043E|\u043E\u0433\u043E|\u0435)?)`;pS="(?:\\s+(?:\u0440\u043E\u043A\u0443|\u0440\u0456\u043A|\u0440|\u0440.))?",yy=`(?:[1-9][0-9]{0,3}${pS}\\s*(?:\u043D.\u0435.|\u0434\u043E \u043D.\u0435.|\u043D. \u0435.|\u0434\u043E \u043D. \u0435.)|[1-2][0-9]{3}${pS}|[5-9][0-9]${pS})`;jF=`(${f6})\\s{0,3}(${q(zf)})`,UF=new RegExp(jF,"i"),Jc=Vr("(?:(?:\u0431\u043B\u0438\u0437\u044C\u043A\u043E|\u043F\u0440\u0438\u0431\u043B\u0438\u0437\u043D\u043E)\\s{0,3})?",jF)});var WF,qf,VF=v(()=>{Os();xe();se();WF=`(?:(?:\u043F\u0440\u0438\u0431\u043B\u0438\u0437\u043D\u043E|\u043E\u0440\u0456\u0454\u043D\u0442\u043E\u0432\u043D\u043E)\\s*(?:~\\s*)?)?(${Jc})${un.rightBoundary}`,qf=class extends H{patternLeftBoundary(){return un.leftBoundary}innerPattern(e){return e.option.forwardDate?new RegExp(WF,"i"):new RegExp(`(?:\u043F\u0440\u043E\u0442\u044F\u0433\u043E\u043C|\u043D\u0430 \u043F\u0440\u043E\u0442\u044F\u0437\u0456|\u043F\u0440\u043E\u0442\u044F\u0433\u043E\u043C|\u0443\u043F\u0440\u043E\u0434\u043E\u0432\u0436|\u0432\u043F\u0440\u043E\u0434\u043E\u0432\u0436)\\s*${WF}`,un.flags)}innerExtract(e,t){let r=ed(t[1]);return Y.createRelativeFromReference(e.reference,r)}}});var ol,ds,Yi=v(()=>{se();Os();ol=class extends H{patternLeftBoundary(){return un.leftBoundary}innerPattern(e){return new RegExp(this.innerPatternString(e),un.flags)}innerPatternHasChange(e,t){return!1}},ds=class extends ol{innerPattern(e){return new RegExp(`${this.innerPatternString(e)}${un.rightBoundary}`,un.flags)}}});var $F,YF,g6,zF,Gf,qF=v(()=>{Rt();Os();Os();Os();He();Yi();$F=1,YF=2,g6=3,zF=4,Gf=class extends ds{innerPatternString(e){return`(?:\u0437|\u0456\u0437)?\\s*(${TS})(?:\\s{0,3}(?:\u043F\u043E|-|\u2013|\u0434\u043E)?\\s{0,3}(${TS}))?(?:-|\\/|\\s{0,3}(?:of)?\\s{0,3})(${q(Xc)})(?:(?:-|\\/|,?\\s{0,3})(${yy}(?![^\\s]\\d)))?`}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=Xc[t[g6].toLowerCase()],i=wS(t[$F]);if(i>31)return t.index=t.index+t[$F].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[zF]){let a=vy(t[zF]);r.start.assign("year",a)}else{let a=rt(e.reference.instant,i,s);r.start.imply("year",a)}if(t[YF]){let a=wS(t[YF]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var y6,GF,Qf,QF=v(()=>{Os();Rt();He();Os();Yi();y6=2,GF=3,Qf=class extends ol{innerPatternString(e){return`((?:\u0432|\u0443)\\s*)?(${q(Xc)})\\s*(?:[,-]?\\s*(${yy})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`}innerExtract(e,t){let r=t[y6].toLowerCase();if(t[0].length<=3&&!vS[r])return null;let s=e.createParsingResult(t.index,t.index+t[0].length);s.start.imply("day",1);let i=Xc[r];if(s.start.assign("month",i),t[GF]){let a=vy(t[GF]);s.start.assign("year",a)}else{let a=rt(e.reference.instant,1,i);s.start.imply("year",a)}return s}}});var Kf,KF=v(()=>{We();Bi();Os();Kf=class extends cr{constructor(e){super(e)}patternFlags(){return un.flags}primaryPatternLeftBoundary(){return"(^|\\s|T|(?:[^\\p{L}\\p{N}_]))"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|\u0434\u043E|\u0456|\u043F\u043E|\\?)\\s*"}primaryPrefix(){return"(?:(?:\u0432|\u0443|\u043E|\u043E\u0431|\u0437|\u0456\u0437|\u0432\u0456\u0434)\\s*)??"}primarySuffix(){return`(?:\\s*(?:\u0440\u0430\u043D\u043A\u0443|\u0432\u0435\u0447\u043E\u0440\u0430|\u043F\u043E \u043E\u0431\u0456\u0434\u0456|\u043F\u0456\u0441\u043B\u044F \u043E\u0431\u0456\u0434\u0443))?(?!\\/)${un.rightBoundary}`}extractPrimaryTimeComponents(e,t){let r=super.extractPrimaryTimeComponents(e,t);if(r){if(t[0].endsWith("\u0432\u0435\u0447\u043E\u0440\u0430")){let s=r.get("hour");s>=6&&s<12?(r.assign("hour",r.get("hour")+12),r.assign("meridiem",O.PM)):s<6&&r.assign("meridiem",O.AM)}if(t[0].endsWith("\u043F\u043E \u043E\u0431\u0456\u0434\u0456")||t[0].endsWith("\u043F\u0456\u0441\u043B\u044F \u043E\u0431\u0456\u0434\u0443")){r.assign("meridiem",O.PM);let s=r.get("hour");s>=0&&s<=6&&r.assign("hour",r.get("hour")+12)}t[0].endsWith("\u0440\u0430\u043D\u043A\u0443")&&(r.assign("meridiem",O.AM),r.get("hour")<12&&r.assign("hour",r.get("hour")))}return r}}});var Zf,ZF=v(()=>{Os();xe();As();Yi();Zf=class extends ol{innerPatternString(e){return`(${Jc})\\s{0,5}\u0442\u043E\u043C\u0443(?=(?:\\W|$))`}innerExtract(e,t){let r=ed(t[1]),s=Kt(r);return Y.createRelativeFromReference(e.reference,s)}}});var Xf,XF=v(()=>{sn();Xf=class extends vt{patternBetween(){return/^\s*(і до|і по|до|по|-)\s*$/i}}});var Jf,JF=v(()=>{nn();Jf=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|\u0432|\u0443|\u043E|,|-)?\\s*$")}}});var ep,eH=v(()=>{_s();Yi();ep=class extends ds{innerPatternString(e){return"(?:\u0437|\u0456\u0437|\u0432\u0456\u0434)?\\s*(\u0441\u044C\u043E\u0433\u043E\u0434\u043D\u0456|\u0432\u0447\u043E\u0440\u0430|\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u0456\u0441\u043B\u044F\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u0456\u0441\u043B\u044F\u043F\u0456\u0441\u043B\u044F\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u043E\u0437\u0430\u043F\u043E\u0437\u0430\u0432\u0447\u043E\u0440\u0430|\u043F\u043E\u0437\u0430\u0432\u0447\u043E\u0440\u0430)"}innerExtract(e,t){let r=t[1].toLowerCase(),s=e.createParsingComponents();switch(r){case"\u0441\u044C\u043E\u0433\u043E\u0434\u043D\u0456":return dr(e.reference);case"\u0432\u0447\u043E\u0440\u0430":return Or(e.reference);case"\u0437\u0430\u0432\u0442\u0440\u0430":return Lr(e.reference);case"\u043F\u0456\u0441\u043B\u044F\u0437\u0430\u0432\u0442\u0440\u0430":return si(e.reference,2);case"\u043F\u0456\u0441\u043B\u044F\u043F\u0456\u0441\u043B\u044F\u0437\u0430\u0432\u0442\u0440\u0430":return si(e.reference,3);case"\u043F\u043E\u0437\u0430\u0432\u0447\u043E\u0440\u0430":return Wo(e.reference,2);case"\u043F\u043E\u0437\u0430\u043F\u043E\u0437\u0430\u0432\u0447\u043E\u0440\u0430":return Wo(e.reference,3)}return s}}});var tH,tp,rH=v(()=>{_s();Ms();tH=Ee(Ke(),1);Yi();tp=class extends ds{innerPatternString(e){return"(\u0437\u0430\u0440\u0430\u0437|\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E\\s*\u0432\u0435\u0447\u043E\u0440\u0430|\u043C\u0438\u043D\u0443\u043B\u043E\u0457\\s*\u043D\u043E\u0447\u0456|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0457\\s*\u043D\u043E\u0447\u0456|\u0441\u044C\u043E\u0433\u043E\u0434\u043D\u0456\\s*\u0432\u043D\u043E\u0447\u0456|\u0446\u0456\u0454\u0457\\s*\u043D\u043E\u0447\u0456|\u0446\u044C\u043E\u0433\u043E \u0440\u0430\u043D\u043A\u0443|\u0432\u0440\u0430\u043D\u0446\u0456|\u0440\u0430\u043D\u043A\u0443|\u0437\u0440\u0430\u043D\u043A\u0443|\u043E\u043F\u0456\u0432\u0434\u043D\u0456|\u0432\u0432\u0435\u0447\u0435\u0440\u0456|\u0432\u0435\u0447\u043E\u0440\u0430|\u043E\u043F\u0456\u0432\u043D\u043E\u0447\u0456|\u0432\u043D\u043E\u0447\u0456)"}innerExtract(e,t){let r=(0,tH.default)(e.reference.instant),s=t[0].toLowerCase(),i=e.createParsingComponents();if(s==="\u0437\u0430\u0440\u0430\u0437")return Nr(e.reference);if(s==="\u0432\u0432\u0435\u0447\u0435\u0440\u0456"||s==="\u0432\u0435\u0447\u043E\u0440\u0430")return Oc(e.reference);if(s.endsWith("\u0432\u0440\u0430\u043D\u0446\u0456")||s.endsWith("\u0440\u0430\u043D\u043A\u0443")||s.endsWith("\u0437\u0440\u0430\u043D\u043A\u0443"))return Lc(e.reference);if(s.endsWith("\u043E\u043F\u0456\u0432\u0434\u043D\u0456"))return Fc(e.reference);if(s.match(/минулої\s*ночі/))return Ug(e.reference);if(s.match(/минулого\s*вечора/))return jg(e.reference);if(s.match(/наступної\s*ночі/)){let a=r.hour()<22?1:2;r=r.add(a,"day"),ft(i,r),i.imply("hour",1)}return s.match(/цієї\s*ночі/)?Vo(e.reference):s.endsWith("\u043E\u043F\u0456\u0432\u043D\u043E\u0447\u0456")||s.endsWith("\u0432\u043D\u043E\u0447\u0456")?Vo(e.reference):i}}});var v6,T6,w6,rp,sH=v(()=>{Os();He();Mn();Yi();v6=1,T6=2,w6=3,rp=class extends ds{innerPatternString(e){return`(?:(?:,|\\(|\uFF08)\\s*)?(?:\u0432\\s*?)?(?:\u0443\\s*?)?(?:(\u0446\u0435\u0439|\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E|\u043C\u0438\u043D\u0443\u043B\u0438\u0439|\u043F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u0456\u0439|\u043F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u044C\u043E\u0433\u043E|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0433\u043E|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u0438\u0439|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443)\\s*)?(${q(yS)})(?:\\s*(?:,|\\)|\uFF09))?(?:\\s*(\u043D\u0430|\u0443|\u0432)\\s*(\u0446\u044C\u043E\u043C\u0443|\u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443)\\s*\u0442\u0438\u0436\u043D\u0456)?`}innerExtract(e,t){let r=t[T6].toLocaleLowerCase(),s=yS[r],i=t[v6],a=t[w6],o=i||a;o=o||"",o=o.toLocaleLowerCase();let l=null;return o=="\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E"||o=="\u043C\u0438\u043D\u0443\u043B\u0438\u0439"||o=="\u043F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u0456\u0439"||o=="\u043F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u044C\u043E\u0433\u043E"?l="last":o=="\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0433\u043E"||o=="\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u0438\u0439"?l="next":(o=="\u0446\u0435\u0439"||o=="\u0446\u044C\u043E\u0433\u043E"||o=="\u0446\u044C\u043E\u043C\u0443")&&(l="this"),Zt(e.reference,s,l)}}});var nH,b6,k6,sp,iH=v(()=>{Os();xe();nH=Ee(Ke(),1);He();Yi();b6=1,k6=2,sp=class extends ds{innerPatternString(e){return`(\u0432 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443|\u0443 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443|\u043D\u0430 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443|\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E|\u043D\u0430 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443|\u0432 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443|\u0443 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0433\u043E|\u043D\u0430 \u0446\u044C\u043E\u043C\u0443|\u0432 \u0446\u044C\u043E\u043C\u0443|\u0443 \u0446\u044C\u043E\u043C\u0443|\u0446\u044C\u043E\u0433\u043E)\\s*(${q(zf)})(?=\\s*)`}innerExtract(e,t){let r=t[b6].toLowerCase(),s=t[k6].toLowerCase(),i=zf[s];if(r=="\u043D\u0430 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443"||r=="\u0432 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443"||r=="\u0443 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443"||r=="\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0433\u043E"){let l={};return l[i]=1,Y.createRelativeFromReference(e.reference,l)}if(r=="\u043D\u0430 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443"||r=="\u0432 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443"||r=="\u0443 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443"||r=="\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E"){let l={};return l[i]=-1,Y.createRelativeFromReference(e.reference,l)}let a=e.createParsingComponents(),o=(0,nH.default)(e.reference.instant);return i.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):i.match(/month/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):i.match(/year/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var np,aH=v(()=>{Os();xe();As();Yi();np=class extends ds{innerPatternString(e){return`(\u0446\u0456|\u043E\u0441\u0442\u0430\u043D\u043D\u0456|\u043C\u0438\u043D\u0443\u043B\u0456|\u043C\u0430\u0439\u0431\u0443\u0442\u043D\u0456|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u0456|\u043F\u0456\u0441\u043B\u044F|\u0447\u0435\u0440\u0435\u0437|\\+|-)\\s*(${Jc})`}innerExtract(e,t){let r=t[1].toLowerCase(),s=ed(t[3]);switch(r){case"\u043E\u0441\u0442\u0430\u043D\u043D\u0456":case"\u043C\u0438\u043D\u0443\u043B\u0456":case"-":s=Kt(s);break}return Y.createRelativeFromReference(e.reference,s)}}});var ES={};st(ES,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>bS,createCasualConfiguration:()=>oH,createConfiguration:()=>kS,parse:()=>S6,parseDate:()=>D6,strict:()=>E6});function oH(){let n=kS(!1);return n.parsers.unshift(new ep),n.parsers.unshift(new tp),n.parsers.unshift(new Qf),n.parsers.unshift(new sp),n.parsers.unshift(new np),n}function kS(n){return Et({parsers:[new ji,new nr(!0),new qf,new Gf,new rp,new Kf(n),new Zf],refiners:[new Jf,new Xf]},n)}function S6(n,e,t){return bS.parse(n,e,t)}function D6(n,e,t){return bS.parseDate(n,e,t)}var bS,E6,lH=v(()=>{VF();qF();QF();KF();ZF();XF();JF();Ps();eH();rH();sH();iH();ls();xe();We();Wi();aH();Bg();bS=new me(oH()),E6=new me(kS(!0))});var Ty={};st(Ty,{Chrono:()=>me,Meridiem:()=>O,ParsingComponents:()=>Y,ParsingContext:()=>vh,ParsingResult:()=>ze,ReferenceWithTimezone:()=>Ze,Weekday:()=>Te,casual:()=>SS,de:()=>Kk,en:()=>jk,es:()=>fS,fr:()=>aE,ja:()=>dE,nl:()=>EE,parse:()=>C6,parseDate:()=>M6,pt:()=>mE,ru:()=>oS,strict:()=>x6,uk:()=>ES,zh:()=>ZE});function C6(n,e,t){return SS.parse(n,e,t)}function M6(n,e,t){return SS.parseDate(n,e,t)}var x6,SS,cH=v(()=>{bO();ls();xe();We();zO();g1();A1();z1();wL();QL();vF();BF();lH();x6=Uk,SS=Th});var ai,ip=v(()=>{Ft();cH();GT();fT();ai=class{constructor(e=[],t=[],r=!0,s="en"){this.isValidDateString=e=>/^\d{4}-\d{2}-\d{2}$/.test(e);this.isValidTimeString=e=>/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e);this.escapeRegex=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.cleanupWhitespace=e=>e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").trim();this.defaultToScheduled=r,this.languageConfig=g_(s),this.statusConfigs=e,this.boundaries=this.createBoundaryConfig(),this.priorityPatterns=this.buildPriorityPatterns(t),this.statusPatterns=this.buildFallbackStatusPatterns(),this.recurrencePatterns=this.buildRecurrencePatterns(),this.processingPipeline=this.buildProcessingPipeline()}createBoundaryConfig(){let e=["ru","zh","ja","uk","fr"].includes(this.languageConfig.code);return{boundary:e?"(?:^|\\s)":"\\b",endBoundary:e?"(?=\\s|$)":"\\b",isNonAscii:e}}getChronoParser(){let e=this.languageConfig.chronoLocale;return Ty[e]||Ty}buildProcessingPipeline(){return[{name:"extractTags",process:(e,t)=>this.extractTags(e,t)},{name:"extractContexts",process:(e,t)=>this.extractContexts(e,t)},{name:"extractProjects",process:(e,t)=>this.extractProjects(e,t)},{name:"extractPriority",process:(e,t)=>this.extractPriority(e,t)},{name:"extractStatus",process:(e,t)=>this.extractStatus(e,t)},{name:"extractRecurrence",process:(e,t)=>this.extractRecurrence(e,t)},{name:"extractTimeEstimate",process:(e,t)=>this.extractTimeEstimate(e,t)},{name:"parseUnifiedDatesAndTimes",process:(e,t)=>this.parseUnifiedDatesAndTimes(e,t)}]}parseInput(e){let t={title:"",tags:[],contexts:[],projects:[]},[r,s]=this.extractTitleAndDetails(e);s&&(t.details=s);let i=r;for(let a of this.processingPipeline)try{i=a.process(i,t)}catch(o){console.debug(`Error in processor ${a.name}:`,o)}return t.title=i.trim(),this.validateAndCleanupResult(t)}extractTitleAndDetails(e){let t=e.trim(),r=t.indexOf(`
`);if(r!==-1){let s=t.substring(0,r).trim(),i=t.substring(r+1).trim();return[s,i]}return[t,void 0]}extractTags(e,t){let r=e.match(/#[\w/]+/g);return r?(t.tags.push(...r.map(s=>s.substring(1))),this.cleanupWhitespace(e.replace(/#[\w/]+/g,""))):e}extractContexts(e,t){let r=e.match(/@\w+/g);return r?(t.contexts.push(...r.map(s=>s.substring(1))),this.cleanupWhitespace(e.replace(/@\w+/g,""))):e}extractProjects(e,t){let r=e,s=r.match(/\+\[\[.*?\]\]/g);s&&(t.projects.push(...s.map(a=>a.slice(1))),r=this.cleanupWhitespace(r.replace(/\+\[\[.*?\]\]/g,"")));let i=r.match(/\+[\w/-]+/g);return i&&(t.projects.push(...i.map(a=>a.substring(1))),r=this.cleanupWhitespace(r.replace(/\+[\w/-]+/g,""))),r}buildPriorityPatterns(e){if(e.length>0)return e.flatMap(a=>[{regex:new RegExp(`\\b${this.escapeRegex(a.value)}\\b`,"i"),value:a.value},{regex:new RegExp(`\\b${this.escapeRegex(a.label)}\\b`,"i"),value:a.value}]);let t=[],r=this.languageConfig.fallbackPriority,{boundary:s,endBoundary:i}=this.boundaries;return t.push({regex:new RegExp(`${s}(${r.urgent.map(a=>this.escapeRegex(a)).join("|")})${i}`,"i"),value:"urgent"}),t.push({regex:new RegExp(`${s}(${r.high.map(a=>this.escapeRegex(a)).join("|")})${i}`,"i"),value:"high"}),t.push({regex:new RegExp(`${s}(${r.normal.map(a=>this.escapeRegex(a)).join("|")})${i}`,"i"),value:"normal"}),t.push({regex:new RegExp(`${s}(${r.low.map(a=>this.escapeRegex(a)).join("|")})${i}`,"i"),value:"low"}),t}extractPriority(e,t){let r=null;for(let s of this.priorityPatterns){let i=e.match(s.regex);i&&i.index!==void 0&&(!r||i.index<r.index)&&(r={pattern:s,index:i.index})}return r?(t.priority=r.pattern.value,this.cleanupWhitespace(e.replace(r.pattern.regex,""))):e}buildFallbackStatusPatterns(){let e=this.languageConfig.fallbackStatus,{boundary:t,endBoundary:r}=this.boundaries;return[{regex:new RegExp(`${t}(${e.open.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"open"},{regex:new RegExp(`${t}(${e.inProgress.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"in-progress"},{regex:new RegExp(`${t}(${e.done.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"done"},{regex:new RegExp(`${t}(${e.cancelled.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"cancelled"},{regex:new RegExp(`${t}(${e.waiting.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"waiting"}]}extractStatus(e,t){if(this.statusConfigs.length>0){let r=[...this.statusConfigs].sort((s,i)=>i.label.length-s.label.length);for(let s of r){let i=[s.label,s.value];for(let a of i){if(!a||a.trim()==="")continue;let o=this.findStatusMatch(e,a);if(o)return t.status=s.value,this.cleanupWhitespace(e.replace(o.fullMatch,""))}}}for(let r of this.statusPatterns)if(r.regex.test(e))return t.status=r.value,this.cleanupWhitespace(e.replace(r.regex,""));return e}findStatusMatch(e,t){if(!t||t.trim()==="")return null;let r=e.toLowerCase(),s=t.toLowerCase(),i=0;for(;;){let a=r.indexOf(s,i);if(a===-1)break;let o=a>0?e[a-1]:" ",l=a+t.length,c=l<e.length?e[l]:" ",d=/\s/.test(o)||a===0,u=/\s/.test(c)||l===e.length;if(d&&u)return{fullMatch:e.substring(a,l),startIndex:a};i=a+1}return null}parseUnifiedDatesAndTimes(e,t){var s,i;let r=e;try{let a=this.getChronoParser(),o=this.languageConfig.dateTriggers,l=[{type:"due",regex:new RegExp(`\\b(${o.due.map(T=>this.escapeRegex(T)).join("|")})`,"i")},{type:"scheduled",regex:new RegExp(`\\b(${o.scheduled.map(T=>this.escapeRegex(T)).join("|")})`,"i")}];for(let T of l){let w=r.match(T.regex);if(w){let b=w.index+w[0].length,E=r.substring(b),S=this.parseChronoFromPosition(E);if(S.success)return T.type==="due"?(t.dueDate=S.date,S.time&&(t.dueTime=S.time)):(t.scheduledDate=S.date,S.time&&(t.scheduledTime=S.time)),r=r.replace(T.regex,""),S.matchedText&&(r=r.replace(S.matchedText,"")),r=this.cleanupWhitespace(r),r}}let c=a.parse(e,new Date,{forwardDate:!0});if(c.length===0)return e;let d=c[0],u=d.text,f=d.start.date(),h=(s=d.end)==null?void 0:s.date(),p=new RegExp(`\\b(${o.due.map(T=>this.escapeRegex(T)).join("|")})\\b`,"i"),m=new RegExp(`\\b(${o.scheduled.map(T=>this.escapeRegex(T)).join("|")})\\b`,"i"),g=p.test(d.text),y=m.test(d.text);if(h&&Dr(h)&&h.getTime()!==f.getTime())t.scheduledDate=C(f,"yyyy-MM-dd"),d.start.isCertain("hour")&&(t.scheduledTime=C(f,"HH:mm")),t.dueDate=C(h,"yyyy-MM-dd"),(i=d.end)!=null&&i.isCertain("hour")&&(t.dueTime=C(h,"HH:mm"));else if(Dr(f)){let T=C(f,"yyyy-MM-dd"),w=d.start.isCertain("hour")?C(f,"HH:mm"):void 0;g&&!y?(t.dueDate=T,t.dueTime=w):y&&!g||this.defaultToScheduled?(t.scheduledDate=T,t.scheduledTime=w):(t.dueDate=T,t.dueTime=w)}r=r.replace(u,"").trim(),r=this.cleanupWhitespace(r)}catch(a){console.debug("Error in unified date parsing:",a)}return r}parseChronoFromPosition(e){try{let r=this.getChronoParser().parse(e,new Date,{forwardDate:!0});if(r.length>0){let s=r[0];if(s.index<=3){let i=s.start.date();if(Dr(i)){let a={success:!0,date:C(i,"yyyy-MM-dd"),matchedText:s.text};return s.start.isCertain("hour")&&(a.time=C(i,"HH:mm")),a}}}}catch(t){console.debug("Error parsing date with chrono:",t)}return{success:!1}}buildRecurrencePatterns(){let e=this.languageConfig.recurrence,t=[],{boundary:r,endBoundary:s}=this.boundaries,i=a=>a.map(o=>this.escapeRegex(o)).join("|");return t.push(...this.buildOrdinalWeekdayPatterns(e,r,s,i)),t.push(...this.buildIntervalPatterns(e,r,s,i)),t.push(...this.buildEveryOtherPatterns(e,r,s,i)),t.push(...this.buildWeekdayPatterns(e,r,s,i)),t.push(...this.buildFrequencyPatterns(e,r,s,i)),t}buildOrdinalWeekdayPatterns(e,t,r,s){let i=s(e.every),a=s([...e.ordinals.first,...e.ordinals.second,...e.ordinals.third,...e.ordinals.fourth,...e.ordinals.last]),o=s([...e.weekdays.monday,...e.weekdays.tuesday,...e.weekdays.wednesday,...e.weekdays.thursday,...e.weekdays.friday,...e.weekdays.saturday,...e.weekdays.sunday]);return[{regex:new RegExp(`${t}(${i})\\s+(${a})\\s+(${o})${r}`,"i"),handler:l=>{let c=l[2].toLowerCase(),d=l[3].toLowerCase(),u=1;return e.ordinals.second.some(h=>h.toLowerCase()===c)?u=2:e.ordinals.third.some(h=>h.toLowerCase()===c)?u=3:e.ordinals.fourth.some(h=>h.toLowerCase()===c)?u=4:e.ordinals.last.some(h=>h.toLowerCase()===c)&&(u=-1),`FREQ=MONTHLY;BYDAY=${this.getWeekdayRRuleCode(d,e)};BYSETPOS=${u}`}}]}buildIntervalPatterns(e,t,r,s){let i=s(e.every),a=s([...e.periods.day,...e.periods.week,...e.periods.month,...e.periods.year]);return[{regex:new RegExp(`${t}(${i})\\s+(\\d+)\\s+(${a})${r}`,"i"),handler:o=>{let l=parseInt(o[2]),c=o[3].toLowerCase();return`FREQ=${this.getPeriodFrequency(c,e)};INTERVAL=${l}`}}]}buildEveryOtherPatterns(e,t,r,s){let i=s(e.every),a=s(e.other),o=s([...e.periods.day,...e.periods.week,...e.periods.month,...e.periods.year]);return[{regex:new RegExp(`${t}(${i})\\s+(${a})\\s+(${o})${r}`,"i"),handler:l=>{let c=l[3].toLowerCase();return`FREQ=${this.getPeriodFrequency(c,e)};INTERVAL=2`}}]}buildWeekdayPatterns(e,t,r,s){let i=s(e.every),a=s([...e.weekdays.monday,...e.weekdays.tuesday,...e.weekdays.wednesday,...e.weekdays.thursday,...e.weekdays.friday,...e.weekdays.saturday,...e.weekdays.sunday]),o=s([...e.pluralWeekdays.monday,...e.pluralWeekdays.tuesday,...e.pluralWeekdays.wednesday,...e.pluralWeekdays.thursday,...e.pluralWeekdays.friday,...e.pluralWeekdays.saturday,...e.pluralWeekdays.sunday]);return[{regex:new RegExp(`${t}(${i})\\s+(${a})${r}`,"i"),handler:l=>{let c=l[2].toLowerCase();return`FREQ=WEEKLY;BYDAY=${this.getWeekdayRRuleCode(c,e)}`}},{regex:new RegExp(`${t}(${o})${r}`,"i"),handler:l=>{let c=l[1].toLowerCase();return`FREQ=WEEKLY;BYDAY=${this.getPluralWeekdayRRuleCode(c,e)}`}}]}buildFrequencyPatterns(e,t,r,s){return[{regex:new RegExp(`${t}(${s(e.frequencies.daily)})${r}`,"i"),handler:()=>"FREQ=DAILY"},{regex:new RegExp(`${t}(${s(e.frequencies.weekly)})${r}`,"i"),handler:()=>"FREQ=WEEKLY"},{regex:new RegExp(`${t}(${s(e.frequencies.monthly)})${r}`,"i"),handler:()=>"FREQ=MONTHLY"},{regex:new RegExp(`${t}(${s(e.frequencies.yearly)})${r}`,"i"),handler:()=>"FREQ=YEARLY"}]}getPeriodFrequency(e,t){return t.periods.week.some(r=>r.toLowerCase()===e)?"WEEKLY":t.periods.month.some(r=>r.toLowerCase()===e)?"MONTHLY":t.periods.year.some(r=>r.toLowerCase()===e)?"YEARLY":"DAILY"}getWeekdayRRuleCode(e,t){return t.weekdays.tuesday.some(r=>r.toLowerCase()===e)?"TU":t.weekdays.wednesday.some(r=>r.toLowerCase()===e)?"WE":t.weekdays.thursday.some(r=>r.toLowerCase()===e)?"TH":t.weekdays.friday.some(r=>r.toLowerCase()===e)?"FR":t.weekdays.saturday.some(r=>r.toLowerCase()===e)?"SA":t.weekdays.sunday.some(r=>r.toLowerCase()===e)?"SU":"MO"}getPluralWeekdayRRuleCode(e,t){return t.pluralWeekdays.tuesday.some(r=>r.toLowerCase()===e)?"TU":t.pluralWeekdays.wednesday.some(r=>r.toLowerCase()===e)?"WE":t.pluralWeekdays.thursday.some(r=>r.toLowerCase()===e)?"TH":t.pluralWeekdays.friday.some(r=>r.toLowerCase()===e)?"FR":t.pluralWeekdays.saturday.some(r=>r.toLowerCase()===e)?"SA":t.pluralWeekdays.sunday.some(r=>r.toLowerCase()===e)?"SU":"MO"}extractRecurrence(e,t){for(let r of this.recurrencePatterns){let s=e.match(r.regex);if(s){let i=r.handler(s);if(this.isValidRRuleString(i))return t.recurrence=i,this.cleanupWhitespace(e.replace(r.regex,""))}}return e}isValidRRuleString(e){if(e.includes("BYDAY=undefined")||e.includes("BYDAY=;")||e.includes("BYDAY=")){let t=e.match(/BYDAY=([^;]*)/);if(t&&(!t[1]||t[1]==="undefined"||t[1].trim()===""))return!1}return!!e.includes("FREQ=")}extractTimeEstimate(e,t){let r=this.languageConfig.timeEstimate,{boundary:s,endBoundary:i}=this.boundaries,a=[{regex:new RegExp(`${s}(\\d+)(${r.hours.map(c=>this.escapeRegex(c)).join("|")})\\s*(\\d+)(${r.minutes.map(c=>this.escapeRegex(c)).join("|")})${i}`,"i"),handler:c=>parseInt(c[1])*60+parseInt(c[3])},{regex:new RegExp(`${s}(\\d+)\\s*(${r.hours.map(c=>this.escapeRegex(c)).join("|")})${i}`,"i"),handler:c=>parseInt(c[1])*60},{regex:new RegExp(`${s}(\\d+)\\s*(${r.minutes.map(c=>this.escapeRegex(c)).join("|")})${i}`,"i"),handler:c=>parseInt(c[1])}],o=e,l=0;for(let c of a){let d=o.match(c.regex);d&&(l+=c.handler(d),o=this.cleanupWhitespace(o.replace(c.regex,"")))}return l>0&&(t.estimate=l),o}validateAndCleanupResult(e){return e.title.trim()||(e.title="Untitled Task"),e.tags=[...new Set(e.tags.filter(Boolean))],e.contexts=[...new Set(e.contexts.filter(Boolean))],e.projects=[...new Set(e.projects.filter(Boolean))],e.dueDate&&!this.isValidDateString(e.dueDate)&&delete e.dueDate,e.scheduledDate&&!this.isValidDateString(e.scheduledDate)&&delete e.scheduledDate,e.dueTime&&!this.isValidTimeString(e.dueTime)&&delete e.dueTime,e.scheduledTime&&!this.isValidTimeString(e.scheduledTime)&&delete e.scheduledTime,e}getPreviewData(e){let t=[];if(e.title&&t.push({icon:"edit-3",text:`"${e.title}"`}),e.details&&t.push({icon:"file-text",text:`Details: "${e.details.substring(0,50)}${e.details.length>50?"...":""}"`}),e.dueDate){let r=e.dueTime?`${e.dueDate} at ${e.dueTime}`:e.dueDate;t.push({icon:"calendar",text:`Due: ${r}`})}if(e.scheduledDate){let r=e.scheduledTime?`${e.scheduledDate} at ${e.scheduledTime}`:e.scheduledDate;t.push({icon:"calendar-clock",text:`Scheduled: ${r}`})}if(e.priority&&t.push({icon:"alert-triangle",text:`Priority: ${e.priority}`}),e.status&&t.push({icon:"activity",text:`Status: ${e.status}`}),e.contexts&&e.contexts.length>0&&t.push({icon:"map-pin",text:`Contexts: ${e.contexts.map(r=>"@"+r).join(", ")}`}),e.projects&&e.projects.length>0){let r=e.projects.map(s=>s.includes(" ")||s.includes("-")||s.match(/[A-Z]/)?`+[[${s}]]`:`+${s}`).join(", ");t.push({icon:"folder",text:`Projects: ${r}`})}if(e.tags&&e.tags.length>0&&t.push({icon:"tag",text:`Tags: ${e.tags.map(r=>"#"+r).join(", ")}`}),e.recurrence){let r="Invalid recurrence";try{e.recurrence.includes("FREQ=")&&this.isValidRRuleString(e.recurrence)&&(r=X.fromString(e.recurrence).toText())}catch(s){console.debug("Error parsing rrule for preview:",s)}t.push({icon:"repeat",text:`Recurrence: ${r}`})}return e.estimate&&t.push({icon:"clock",text:`Estimate: ${e.estimate} min`}),t}getPreviewText(e){return this.getPreviewData(e).map(t=>t.text).join(" \u2022 ")}}});var op={};st(op,{convertDefaultRemindersToReminders:()=>P6,hasAnyUserFieldsEnabled:()=>dH,isUserFieldConfigComplete:()=>uH,isUserFieldEnabled:()=>_6});function P6(n,e){return n.map(t=>{let r={id:`rem_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:t.type,description:t.description};if(t.type==="relative"){if(t.relatedTo&&t.offset&&t.unit&&t.direction){let s="PT";t.unit==="days"?s=`P${t.offset}D`:t.unit==="hours"?s=`PT${t.offset}H`:s=`PT${t.offset}M`,t.direction==="before"&&(s="-"+s),r.relatedTo=t.relatedTo,r.offset=s}}else t.type==="absolute"&&t.absoluteDate&&t.absoluteTime&&(r.absoluteTime=`${t.absoluteDate}T${t.absoluteTime}:00`);return r}).filter(t=>t.type==="relative"?t.relatedTo&&t.offset:!!t.absoluteTime)}function dH(n){let e=n.userFields;return!e||e.length===0?!1:e.some(t=>!!(t&&t.displayName&&t.key&&t.type))}function uH(n){return!n||!n.enabled?!1:!!(n.displayName&&n.key&&n.type)}function _6(n){return n.userFields&&n.userFields.length>0?dH(n):uH(n.userField)}var lp=v(()=>{});function xS(n,e,t,r,s={}){let{cssClass:i="internal-link",hoverSource:a="tasknotes-property-link",showErrorNotices:o=!1}=s,l=n.createEl("a",{cls:i,text:t,attr:{"data-href":e,role:"link",tabindex:"0"}});l.addEventListener("click",async c=>{c.preventDefault(),c.stopPropagation();try{let d=r.metadataCache.getFirstLinkpathDest(e,"");d instanceof td.TFile?await r.workspace.getLeaf(!1).openFile(d):o&&new td.Notice(`Note "${t}" not found`)}catch(d){console.error("[TaskNotes] Error opening internal link:",{filePath:e,error:d}),o&&new td.Notice(`Failed to open note "${t}"`)}}),l.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),l.click())}),l.addEventListener("mouseover",c=>{let d=r.metadataCache.getFirstLinkpathDest(e,"");if(d instanceof td.TFile){let u={event:c,source:a,hoverParent:n,targetEl:l,linktext:e,sourcePath:d.path};r.workspace.trigger("hover-link",u)}})}function wy(n,e,t,r){let s=0,i;for(;(i=A6.exec(e))!==null;){let[o,l,c,d]=i,u=i.index;if(u>s&&n.appendChild(document.createTextNode(e.slice(s,u))),l){let f=l,h=f,p=f;if(f.includes("|")){let[m,g]=f.split("|");h=m,p=g}xS(n,h,p,t)}else if(c&&d){let f=String(d).trim(),h=String(c).trim();/^[a-z]+:\/\//i.test(f)?n.createEl("a",{text:h,attr:{href:f,target:"_blank",rel:"noopener"}}).classList.add("external-link"):xS(n,f,h,t)}s=u+o.length}let a=e.slice(s);if(a&&(r!=null&&r.onTagClick)){let o=/(^|\s)(#\w+)/g,l=0,c;for(;(c=o.exec(a))!==null;){let[,d,u]=c,f=c.index;f>l&&n.appendChild(document.createTextNode(a.slice(l,f))),d&&n.appendChild(document.createTextNode(d));let h=n.createEl("a",{cls:"tag",text:u,attr:{href:u,role:"button",tabindex:"0"}});h.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),r.onTagClick(u,p)}),h.addEventListener("keydown",p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),r.onTagClick(u,p))}),l=f+d.length+u.length}l<a.length&&n.appendChild(document.createTextNode(a.slice(l)))}else a&&n.appendChild(document.createTextNode(a))}function I6(n){return!n||typeof n!="string"||!n.startsWith("[[")||!n.endsWith("]]")||n.startsWith("\\[[")||n.endsWith("\\]]")?!1:n.slice(2,-2).trim().length>0}function by(n,e,t){n.innerHTML="",e.flat(2).filter(s=>s!=null&&typeof s=="string").forEach((s,i)=>{if(i>0&&n.appendChild(document.createTextNode(", ")),n.appendChild(document.createTextNode("+")),I6(s)){let a=s.slice(2,-2),o=a,l=a;if(a.includes("|")){let c=a.split("|");o=c[0],l=c[1]}xS(n,o,l,t,{cssClass:"task-card__project-link internal-link",hoverSource:"tasknotes-project-link",showErrorNotices:!0})}else n.appendChild(document.createTextNode(s))})}var td,A6,CS=v(()=>{td=require("obsidian"),A6=/\[\[([^\[\]]+)\]\]|\[([^\]]+)\]\(([^)]+)\)|<(https?:\/\/[^\s>]+)>|\[([^\]]+)\]\s*\[([^\]]*)\]/g});function pH(n,e,t){if(!e||typeof e!="string")return;let r=O6(e);if(!r)return;let s=n.createEl("a",{cls:"tag",text:r,attr:{href:r,role:"button",tabindex:"0"}});t!=null&&t.onTagClick&&(s.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),t.onTagClick(r,i)}),s.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),t.onTagClick(r,i))}))}function gH(n,e,t){if(typeof e=="string"){pH(n,e,t);return}if(Array.isArray(e)){e.flat(2).filter(s=>s!=null&&typeof s=="string").forEach((s,i)=>{i>0&&n.appendChild(document.createTextNode(" ")),pH(n,String(s),t)});return}e!=null&&n.appendChild(document.createTextNode(String(e)))}function yH(n,e,t){if(typeof e=="string"){let r=mH(e);if(r){let s=n.createEl("span",{cls:"context-tag",text:r,attr:{role:"button",tabindex:"0"}});t!=null&&t.onTagClick&&(s.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),t.onTagClick(r,i)}),s.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),t.onTagClick(r,i))}))}return}if(Array.isArray(e)){e.flat(2).filter(s=>s!=null&&typeof s=="string").forEach((s,i)=>{i>0&&n.appendChild(document.createTextNode(", "));let a=mH(s);if(a){let o=n.createEl("span",{cls:"context-tag",text:a,attr:{role:"button",tabindex:"0"}});t!=null&&t.onTagClick&&(o.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),t.onTagClick(a,l)}),o.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),t.onTagClick(a,l))}))}else n.appendChild(document.createTextNode(String(s)))});return}e!=null&&n.appendChild(document.createTextNode(String(e)))}function O6(n){if(!n||typeof n!="string")return null;let e=n.trim();if(!e)return null;if(e.startsWith("#")){let r=e.replace(/[^\w#-]/g,"");return r.length>1?r:null}let t=e.replace(/[^\w-]/g,"");return t?`#${t}`:null}function mH(n){if(!n||typeof n!="string")return null;let e=n.trim();if(!e)return null;if(e.startsWith("@")){let r=e.replace(/[^\w@-]/g,"");return r.length>1?r:null}let t=e.replace(/[^\w-]/g,"");return t?`@${t}`:null}var vH=v(()=>{});var rd={};st(rd,{DEFAULT_TASK_CARD_OPTIONS:()=>_S,cleanupTaskCard:()=>$6,createTaskCard:()=>fr,refreshParentTaskSubtasks:()=>Y6,showDeleteConfirmationModal:()=>V6,showTaskContextMenu:()=>Cy,updateTaskCard:()=>Pn});function EH(n,e,t,r){n.addEventListener("click",s=>{s.stopPropagation();let i=r==="due"?e.due:e.scheduled;new ts({currentValue:we(i||""),currentTime:xr(i||""),onSelect:async(o,l)=>{try{let c;o?l?c=`${o}T${l}`:c=o:c=void 0,await t.updateTaskProperty(e,r,c)}catch(c){console.error(`Error updating ${r} date:`,c),new be.Notice(`Failed to update ${r} date`)}}}).show(s)})}function SH(){return["due","scheduled","projects","contexts","tags"]}function L6(n,e,t){try{if(e in TH)return TH[e](n);if(e.startsWith("user:"))return F6(n,e,t);if(n.customProperties&&e in n.customProperties)return n.customProperties[e];if(e.startsWith("formula."))try{let r=e.substring(8),s=n.basesData;if(!(s!=null&&s.formulaResults))return"";let i=s.formulaResults;if(i!=null&&i.cachedFormulaOutputs&&i.cachedFormulaOutputs[r]!==void 0){let a=i.cachedFormulaOutputs[r];return a&&typeof a=="object"&&"icon"in a?"data"in a&&a.data!==null&&a.data!==void 0?a.data:a.icon==="lucide-calendar"&&"date"in a?a.date:a.icon==="lucide-file-question"||a.icon==="lucide-help-circle"?"":a.icon?a.icon.replace("lucide-",""):"":a!=null&&a!==""?a:""}return""}catch(r){return console.debug(`[TaskNotes] Error computing formula ${e}:`,r),"[Formula Error]"}if(n.path){let r=DH(n.path,e,t);if(r!==void 0)return r}return null}catch(r){return console.warn(`TaskCard: Error getting property ${e}:`,r),null}}function F6(n,e,t){var a;let r=e.slice(5),s=(a=t.settings.userFields)==null?void 0:a.find(o=>o.id===r);if(!(s!=null&&s.key))return null;let i=n[s.key];return i===void 0&&(i=DH(n.path,s.key,t)),i}function DH(n,e,t){try{let r=t.app.metadataCache.getCache(n);return r!=null&&r.frontmatter?r.frontmatter[e]:void 0}catch(r){console.warn(`TaskCard: Error accessing frontmatter for ${n}:`,r);return}}function xH(n,e,t,r){let s=L6(t,e,r);if(!H6(s))return null;let i=n.createEl("span",{cls:`task-card__metadata-property task-card__metadata-property--${e.replace(":","-")}`});try{return e in wH?wH[e](i,s,t,r):e.startsWith("user:")?B6(i,e,s,r):U6(i,e,s,r),i}catch(a){return console.warn(`TaskCard: Error rendering property ${e}:`,a),i.textContent=`${e}: (error)`,i}}function H6(n){return n!=null&&!(Array.isArray(n)&&n.length===0)&&!(typeof n=="string"&&n.trim()==="")}function B6(n,e,t,r){var c;let s=e.slice(5),i=(c=r.settings.userFields)==null?void 0:c.find(d=>d.id===s);if(!i){n.textContent=`${s}: (not found)`;return}let a=i.displayName||s;n.createEl("span",{text:`${a}: `});let o=n.createEl("span"),l={metadataCache:r.app.metadataCache,workspace:r.app.workspace};if(typeof t=="string"&&t.trim()!==""){let d=t.trim();if(d.includes("[[")||d.includes("](")||d.includes("#")&&/\s#\w+|\#\w+/.test(d))wy(o,d,l);else{let u=kH(t,i);o.textContent=u}}else if(i.type==="list"&&Array.isArray(t))t.filter(u=>u!=null).forEach((u,f)=>{if(f>0&&o.appendChild(document.createTextNode(", ")),typeof u=="string"&&u.trim()!==""){let h=u.trim();if(h.includes("[[")||h.includes("](")||h.includes("#")&&/\s#\w+|\#\w+/.test(h)){let p=o.createEl("span");wy(p,h,l)}else o.appendChild(document.createTextNode(String(u)))}else o.appendChild(document.createTextNode(String(u)))});else{let d=kH(t,i);d.trim()!==""?o.textContent=d:o.textContent="(empty)"}}function U6(n,e,t,r){let s;e.startsWith("formula.")?s=e.substring(8):s=e.charAt(0).toUpperCase()+e.slice(1),n.createEl("span",{text:`${s}: `});let i=n.createEl("span");Array.isArray(t)?t.filter(o=>o!=null&&o!=="").forEach((o,l)=>{l>0&&i.appendChild(document.createTextNode(", ")),bH(i,o,r)}):bH(i,t,r)}function bH(n,e,t){if(typeof e=="string"&&t){let s={metadataCache:t.app.metadataCache,workspace:t.app.workspace};if(e.includes("[[")||e.includes("[")&&e.includes("](")||e.includes("#")&&/\s#\w+|\#\w+/.test(e)){wy(n,e,s,{onTagClick:async(i,a)=>{let o=i.startsWith("#")?i.slice(1):i;await t.openTagsPane(`#${o}`)||console.log("Could not open search pane, generic property tag clicked:",i)}});return}n.appendChild(document.createTextNode(e));return}let r;if(typeof e=="object"&&e!==null)if(e instanceof Date)r=jt(e.toISOString(),{dateFormat:"MMM d, yyyy",timeFormat:"",showTime:!1});else if(typeof e.toString=="function"&&e.toString()!=="[object Object]")r=e.toString();else{let s=Object.entries(e);s.length<=3?r=s.map(([i,a])=>`${i}: ${a}`).join(", "):r=JSON.stringify(e)}else typeof e=="boolean"?r=e?"\u2713":"\u2717":typeof e=="number"?r=Number.isInteger(e)?String(e):e.toFixed(2):r=String(e);r.length>100&&(r=r.substring(0,97)+"..."),n.appendChild(document.createTextNode(r))}function kH(n,e){if(n==null)return"";try{switch(e.type){case"text":case"number":return String(n);case"date":return jt(String(n),{dateFormat:"MMM d, yyyy",timeFormat:"",showTime:!1});case"boolean":return n?"\u2713":"\u2717";case"list":return Array.isArray(n)?n.flat(2).join(", "):String(n);default:return String(n)}}catch(t){return console.warn("TaskCard: Error formatting user property value:",t),String(n)}}function j6(n,e,t,r){let s=DT(e),i=Un(e),a=r.settings.calendarViewSettings.timeFormat,o="";if(s){let l=jt(e,{dateFormat:"",showTime:!0,userTimeFormat:a});o=l.trim()===""?"Due: Today":`Due: Today at ${l}`}else i?o=`Due: ${jt(e,{dateFormat:"MMM d",showTime:!0,userTimeFormat:a})} (overdue)`:o=`Due: ${jt(e,{dateFormat:"MMM d",showTime:!0,userTimeFormat:a})}`;n.textContent=o,n.classList.add("task-card__metadata-date","task-card__metadata-date--due"),EH(n,t,r,"due")}function W6(n,e,t,r){let s=DT(e),i=Un(e),a=r.settings.calendarViewSettings.timeFormat,o="";if(s){let l=jt(e,{dateFormat:"",showTime:!0,userTimeFormat:a});o=l.trim()===""?"Scheduled: Today":`Scheduled: Today at ${l}`}else i?o=`Scheduled: ${jt(e,{dateFormat:"MMM d",showTime:!0,userTimeFormat:a})} (past)`:o=`Scheduled: ${jt(e,{dateFormat:"MMM d",showTime:!0,userTimeFormat:a})}`;n.textContent=o,n.classList.add("task-card__metadata-date","task-card__metadata-date--scheduled"),EH(n,t,r,"scheduled")}function CH(n,e){if(e.length>0){for(let t=1;t<e.length;t++){let r=n.createEl("span",{cls:"task-card__metadata-separator",text:" \u2022 "});e[t].insertAdjacentElement("beforebegin",r)}n.style.display=""}else n.style.display="none"}function fr(n,e,t,r={}){var A,j,U,V;let s={..._S,...r},i=s.targetDate||e.selectedDate||new Date,a=n.recurrence?Vn(n,i):n.status,o=document.createElement("div");o._taskPath=n.path;let l=e.getActiveTimeSession(n)!==null,c=n.recurrence?((A=n.complete_instances)==null?void 0:A.includes(ue(i)))||!1:e.statusManager.isCompletedStatus(a),d=!!n.recurrence,u=["task-card"];c&&u.push("task-card--completed"),n.archived&&u.push("task-card--archived"),l&&u.push("task-card--actively-tracked"),d&&u.push("task-card--recurring"),s.showCheckbox&&u.push("task-card--checkbox-enabled"),n.priority&&u.push(`task-card--priority-${n.priority}`),a&&u.push(`task-card--status-${a}`),((j=e.settings)==null?void 0:j.subtaskChevronPosition)==="left"&&u.push("task-card--chevron-left"),Xr(n.projects||[]).length>0&&u.push("task-card--has-projects"),o.className=u.join(" "),o.dataset.taskPath=n.path,o.dataset.key=n.path,o.dataset.status=a;let h=o.createEl("div",{cls:"task-card__main-row"}),p=e.priorityManager.getPriorityConfig(n.priority);p&&o.style.setProperty("--priority-color",p.color);let m=e.statusManager.getStatusConfig(a);if(m&&o.style.setProperty("--current-status-color",m.color),s.showCheckbox){let F=h.createEl("input",{type:"checkbox",cls:"task-card__checkbox"});F.checked=e.statusManager.isCompletedStatus(a),F.addEventListener("click",async $=>{$.stopPropagation();try{n.recurrence?await e.toggleRecurringTaskComplete(n,i):await e.toggleTaskStatus(n)}catch(Z){let re=Z instanceof Error?Z.message:String(Z);console.error("Error in task checkbox handler:",{error:re,taskPath:n.path}),new be.Notice(`Failed to toggle task status: ${re}`)}})}let g=null;(!t||t.includes("status"))&&(g=h.createEl("span",{cls:"task-card__status-dot"}),m&&(g.style.borderColor=m.color)),g&&g.addEventListener("click",async F=>{F.stopPropagation();try{if(n.recurrence){let $=await e.toggleRecurringTaskComplete(n,i),Z=Vn($,i),re=e.statusManager.getStatusConfig(Z),z=e.statusManager.isCompletedStatus(Z);re&&(g.style.borderColor=re.color);let he=["task-card"];z&&he.push("task-card--completed"),n.archived&&he.push("task-card--archived"),e.getActiveTimeSession(n)&&he.push("task-card--actively-tracked"),n.recurrence&&he.push("task-card--recurring"),n.priority&&he.push(`task-card--priority-${n.priority}`),Z&&he.push(`task-card--status-${Z}`),o.className=he.join(" "),o.dataset.status=Z;let Ae=o.querySelector(".task-card__title");Ae&&Ae.classList.toggle("completed",z)}else{let $=await e.cacheManager.getTaskInfo(n.path);if(!$){new be.Notice("Task not found");return}let Z=$.status||"open",re=e.statusManager.getNextStatus(Z);await e.updateTaskProperty($,"status",re)}}catch($){let Z=$ instanceof Error?$.message:String($);console.error("Error cycling task status:",{error:Z,taskPath:n.path}),new be.Notice(`Failed to update task status: ${Z}`)}});let T=!t||t.includes("priority");if(n.priority&&p&&T){let F=h.createEl("span",{cls:"task-card__priority-dot",attr:{"aria-label":`Priority: ${p.label}`}});F.style.borderColor=p.color,F.addEventListener("click",$=>{$.stopPropagation(),new Zs({currentValue:n.priority,onSelect:async re=>{try{await e.updateTaskProperty(n,"priority",re)}catch(z){console.error("Error updating priority:",z),new be.Notice("Failed to update priority")}},plugin:e}).show($)})}if(n.recurrence){let F=h.createEl("div",{cls:"task-card__recurring-indicator",attr:{"aria-label":`Recurring: ${ua(n.recurrence)} (click to change)`}});(0,be.setTooltip)(F,`Recurring: ${ua(n.recurrence)} (click to change)`,{placement:"top"}),(0,be.setIcon)(F,"rotate-ccw"),F.addEventListener("click",$=>{$.stopPropagation(),new Ks({currentValue:typeof n.recurrence=="string"?n.recurrence:void 0,onSelect:async re=>{try{await e.updateTaskProperty(n,"recurrence",re||void 0)}catch(z){console.error("Error updating recurrence:",z),new be.Notice("Failed to update recurrence")}},app:e.app}).show($)})}if(n.reminders&&n.reminders.length>0){let F=h.createEl("div",{cls:"task-card__reminder-indicator",attr:{"aria-label":`${n.reminders.length} reminder${n.reminders.length>1?"s":""} set (click to manage)`}}),$=n.reminders.length,Z=$===1?"1 reminder set (click to manage)":`${$} reminders set (click to manage)`;(0,be.setTooltip)(F,Z,{placement:"top"}),(0,be.setIcon)(F,"bell"),F.addEventListener("click",re=>{re.stopPropagation(),new Pi(e.app,e,n,async he=>{try{await e.updateTaskProperty(n,"reminders",he.length>0?he:void 0)}catch(Ae){console.error("Error updating reminders:",Ae),new be.Notice("Failed to update reminders")}}).open()})}let w=h.createEl("div",{cls:"task-card__project-indicator-placeholder",attr:{style:"display: none;"}}),b=h.createEl("div",{cls:"task-card__chevron-placeholder",attr:{style:"display: none;"}});if(e.projectSubtasksService.isTaskUsedAsProjectSync(n.path)){if(w.className="task-card__project-indicator",w.removeAttribute("style"),w.setAttribute("aria-label","This task is used as a project (click to filter subtasks)"),(0,be.setTooltip)(w,"This task is used as a project (click to filter subtasks)",{placement:"top"}),(0,be.setIcon)(w,"folder"),w.addEventListener("click",async F=>{F.stopPropagation();try{await e.applyProjectSubtaskFilter(n)}catch($){console.error("Error filtering project subtasks:",$),new be.Notice("Failed to filter project subtasks")}}),(U=e.settings)!=null&&U.showExpandableSubtasks){b.className="task-card__chevron",b.removeAttribute("style");let F=((V=e.expandedProjectsService)==null?void 0:V.isExpanded(n.path))||!1;F&&b.classList.add("task-card__chevron--expanded"),b.setAttribute("aria-label",F?"Collapse subtasks":"Expand subtasks"),(0,be.setTooltip)(b,F?"Collapse subtasks":"Expand subtasks",{placement:"top"}),(0,be.setIcon)(b,"chevron-right"),b.addEventListener("click",async $=>{$.stopPropagation();try{if(!e.expandedProjectsService){console.error("ExpandedProjectsService not initialized"),new be.Notice("Service not available. Please try reloading the plugin.");return}let Z=e.expandedProjectsService.toggle(n.path);b.classList.toggle("task-card__chevron--expanded",Z),b.setAttribute("aria-label",Z?"Collapse subtasks":"Expand subtasks"),(0,be.setTooltip)(b,Z?"Collapse subtasks":"Expand subtasks",{placement:"top"}),await cp(o,n,e,Z)}catch(Z){console.error("Error toggling subtasks:",Z),new be.Notice("Failed to toggle subtasks")}}),F&&cp(o,n,e,!0).catch($=>{console.error("Error showing initial subtasks:",$)})}}else w.remove(),b.remove();let S=h.createEl("div",{cls:"task-card__content"}),D=h.createEl("div",{cls:"task-card__context-menu",attr:{"aria-label":"Task options"}});(0,be.setIcon)(D,"ellipsis-vertical"),(0,be.setTooltip)(D,"Task options",{placement:"top"}),D.addEventListener("click",async F=>{F.stopPropagation(),F.preventDefault(),await Cy(F,n.path,e,i)});let x=S.createEl("div",{cls:"task-card__title",text:n.title});e.statusManager.isCompletedStatus(a)&&x.classList.add("completed");let M=S.createEl("div",{cls:"task-card__metadata"}),B=[],Q=t||e.settings.defaultVisibleProperties||SH();for(let F of Q){if(F==="status"||F==="priority")continue;let $=xH(M,F,n,e);$&&B.push($)}CH(M,B);let{clickHandler:P,dblclickHandler:I}=sc({task:n,plugin:e,excludeSelector:".task-card__checkbox",contextMenuHandler:async F=>{let $=o.dataset.taskPath;$&&await Cy(F,$,e,i)}});return o.addEventListener("click",P),o.addEventListener("dblclick",I),o.addEventListener("contextmenu",async F=>{F.preventDefault(),F.stopPropagation();let $=o.dataset.taskPath;$&&await Cy(F,$,e,i)}),o.addEventListener("mouseover",nc(n,e)),o}async function Cy(n,e,t,r){try{let s=await t.cacheManager.getTaskInfo(e);if(!s){console.error(`No task found for path: ${e}`);return}new rc({task:s,plugin:t,targetDate:r,onUpdate:()=>{t.app.workspace.trigger("tasknotes:refresh-views")}}).show(n)}catch(s){let i=s instanceof Error?s.message:String(s);console.error("Error creating context menu:",{error:i,taskPath:e}),new be.Notice(`Failed to create context menu: ${i}`)}}function Pn(n,e,t,r,s={}){var B,Q;let a={..._S,...s}.targetDate||t.selectedDate||new Date,o=e.recurrence?Vn(e,a):e.status,l=t.getActiveTimeSession(e)!==null,c=e.recurrence?((B=e.complete_instances)==null?void 0:B.includes(ue(a)))||!1:t.statusManager.isCompletedStatus(o),d=!!e.recurrence,u=["task-card"];c&&u.push("task-card--completed"),e.archived&&u.push("task-card--archived"),l&&u.push("task-card--actively-tracked"),d&&u.push("task-card--recurring"),e.priority&&u.push(`task-card--priority-${e.priority}`),o&&u.push(`task-card--status-${o}`),((Q=t.settings)==null?void 0:Q.subtaskChevronPosition)==="left"&&u.push("task-card--chevron-left"),n.className=u.join(" "),n.dataset.status=o;let f=n.querySelector(".task-card__main-row"),h=t.priorityManager.getPriorityConfig(e.priority);h&&n.style.setProperty("--priority-color",h.color);let p=t.statusManager.getStatusConfig(o);p&&n.style.setProperty("--current-status-color",p.color);let m=n.querySelector(".task-card__checkbox");m&&(m.checked=t.statusManager.isCompletedStatus(o));let g=!r||r.includes("status"),y=n.querySelector(".task-card__status-dot");if(g){if(y)p&&(y.style.borderColor=p.color);else if(f){let P=f.createEl("span",{cls:"task-card__status-dot"});p&&(P.style.borderColor=p.color),P.addEventListener("click",async A=>{A.stopPropagation();try{if(e.recurrence){let j=await t.toggleRecurringTaskComplete(e,a),U=Vn(j,a),V=t.statusManager.getStatusConfig(U),F=t.statusManager.isCompletedStatus(U);V&&(P.style.borderColor=V.color);let $=["task-card"];F&&$.push("task-card--completed"),e.archived&&$.push("task-card--archived"),t.getActiveTimeSession(e)&&$.push("task-card--actively-tracked"),e.recurrence&&$.push("task-card--recurring"),e.priority&&$.push(`task-card--priority-${e.priority}`),U&&$.push(`task-card--status-${U}`),n.className=$.join(" "),n.dataset.status=U;let Z=n.querySelector(".task-card__title");Z&&Z.classList.toggle("completed",F)}else{let j=await t.cacheManager.getTaskInfo(e.path);if(!j){new be.Notice("Task not found");return}let U=j.status||"open",V=t.statusManager.getNextStatus(U);await t.updateTaskProperty(j,"status",V)}}catch(j){let U=j instanceof Error?j.message:String(j);console.error("Error cycling task status:",{error:U,taskPath:e.path}),new be.Notice(`Failed to update task status: ${U}`)}});let I=n.querySelector(".task-card__checkbox");I?I.insertAdjacentElement("afterend",P):f.insertBefore(P,f.firstChild)}}else y&&y.remove();let T=!r||r.includes("priority"),w=n.querySelector(".task-card__priority-dot");if(T&&e.priority&&h){if(!w&&f){let P=f.createEl("span",{cls:"task-card__priority-dot",attr:{"aria-label":`Priority: ${h.label}`}});P.style.borderColor=h.color,P.addEventListener("click",j=>{j.stopPropagation(),new Zs({currentValue:e.priority,onSelect:async V=>{try{await t.updateTaskProperty(e,"priority",V)}catch(F){console.error("Error updating priority:",F),new be.Notice("Failed to update priority")}},plugin:t}).show(j)});let I=n.querySelector(".task-card__status-dot"),A=n.querySelector(".task-card__checkbox");I?I.insertAdjacentElement("afterend",P):A?A.insertAdjacentElement("afterend",P):f.insertBefore(P,f.firstChild)}else if(w){w.style.borderColor=h.color,w.setAttribute("aria-label",`Priority: ${h.label}`);let P=w.cloneNode(!0);P.addEventListener("click",I=>{I.stopPropagation(),new Zs({currentValue:e.priority,onSelect:async j=>{try{await t.updateTaskProperty(e,"priority",j)}catch(U){console.error("Error updating priority:",U),new be.Notice("Failed to update priority")}},plugin:t}).show(I)}),w.replaceWith(P)}}else w&&w.remove();let b=n.querySelector(".task-card__recurring-indicator");if(e.recurrence&&!b){let P=f.createEl("span",{cls:"task-card__recurring-indicator",attr:{"aria-label":`Recurring: ${ua(e.recurrence)}`}});(0,be.setIcon)(P,"rotate-ccw"),y==null||y.insertAdjacentElement("afterend",P)}else if(!e.recurrence&&b)b.remove();else if(e.recurrence&&b){let P=ua(e.recurrence);b.setAttribute("aria-label",`Recurring: ${P}`)}let E=n.querySelector(".task-card__reminder-indicator");if(e.reminders&&e.reminders.length>0&&!E){let P=f.createEl("div",{cls:"task-card__reminder-indicator",attr:{"aria-label":`${e.reminders.length} reminder${e.reminders.length>1?"s":""} set (click to manage)`}}),I=e.reminders.length,A=I===1?"1 reminder set (click to manage)":`${I} reminders set (click to manage)`;(0,be.setTooltip)(P,A,{placement:"top"}),(0,be.setIcon)(P,"bell"),P.addEventListener("click",U=>{U.stopPropagation(),new Pi(t.app,t,e,async F=>{try{await t.updateTaskProperty(e,"reminders",F.length>0?F:void 0)}catch($){console.error("Error updating reminders:",$),new be.Notice("Failed to update reminders")}}).open()});let j=b||y;j==null||j.insertAdjacentElement("afterend",P)}else if((!e.reminders||e.reminders.length===0)&&E)E.remove();else if(e.reminders&&e.reminders.length>0&&E){let P=e.reminders.length,I=P===1?"1 reminder set (click to manage)":`${P} reminders set (click to manage)`;E.setAttribute("aria-label",`${P} reminder${P>1?"s":""} set (click to manage)`),(0,be.setTooltip)(E,I,{placement:"top"})}let S=n.querySelector(".task-card__project-indicator"),D=n.querySelector(".task-card__project-indicator-placeholder");t.projectSubtasksService.isTaskUsedAsProject(e.path).then(P=>{var j,U,V;if(P&&!S&&!D){let F=f.createEl("div",{cls:"task-card__project-indicator",attr:{"aria-label":"This task is used as a project (click to filter subtasks)",title:"This task is used as a project (click to filter subtasks)"}});(0,be.setIcon)(F,"folder"),F.addEventListener("click",async Z=>{Z.stopPropagation();try{await t.applyProjectSubtaskFilter(e)}catch(re){console.error("Error filtering project subtasks:",re),new be.Notice("Failed to filter project subtasks")}});let $=n.querySelector(".task-card__recurring-indicator")||n.querySelector(".task-card__priority-dot")||n.querySelector(".task-card__status-dot");$==null||$.insertAdjacentElement("afterend",F)}else!P&&(S||D)&&(S==null||S.remove(),D==null||D.remove());let I=n.querySelector(".task-card__chevron"),A=n.querySelector(".task-card__chevron-placeholder");if(P&&((j=t.settings)!=null&&j.showExpandableSubtasks)&&!I&&!A){let F=f.createEl("div",{cls:"task-card__chevron",attr:{"aria-label":"Expand subtasks",title:"Expand subtasks"}}),$=((U=t.expandedProjectsService)==null?void 0:U.isExpanded(e.path))||!1;$?(F.classList.add("task-card__chevron--expanded"),F.setAttribute("aria-label","Collapse subtasks"),(0,be.setTooltip)(F,"Collapse subtasks",{placement:"top"})):(0,be.setTooltip)(F,"Expand subtasks",{placement:"top"}),(0,be.setIcon)(F,"chevron-right"),F.addEventListener("click",async re=>{re.stopPropagation();try{if(!t.expandedProjectsService){console.error("ExpandedProjectsService not initialized in update"),new be.Notice("Service not available. Please try reloading the plugin.");return}let z=t.expandedProjectsService.toggle(e.path);F.classList.toggle("task-card__chevron--expanded",z),F.setAttribute("aria-label",z?"Collapse subtasks":"Expand subtasks"),(0,be.setTooltip)(F,z?"Collapse subtasks":"Expand subtasks",{placement:"top"}),await cp(n,e,t,z)}catch(z){console.error("Error toggling subtasks:",z),new be.Notice("Failed to toggle subtasks")}});let Z=n.querySelector(".task-card__project-indicator");Z==null||Z.insertAdjacentElement("afterend",F),$&&(F.classList.add("task-card__chevron--expanded"),F.setAttribute("aria-label","Collapse subtasks"),(0,be.setTooltip)(F,"Collapse subtasks",{placement:"top"}),cp(n,e,t,!0).catch(re=>{console.error("Error showing initial subtasks in update:",re)}))}else if((!P||!((V=t.settings)!=null&&V.showExpandableSubtasks))&&(I||A)){I==null||I.remove(),A==null||A.remove();let F=n.querySelector(".task-card__subtasks");if(F){let $=F._clickHandler;$&&(F.removeEventListener("click",$),delete F._clickHandler),F.remove()}}}).catch(P=>{console.error("Error checking if task is used as project in update:",P)});let x=n.querySelector(".task-card__title");x&&(x.textContent=e.title,x.classList.toggle("completed",t.statusManager.isCompletedStatus(o)));let M=n.querySelector(".task-card__metadata");if(M){M.innerHTML="";let P=[],I=r||t.settings.defaultVisibleProperties||SH();for(let A of I){if(A==="status"||A==="priority")continue;let j=xH(M,A,e,t);j&&P.push(j)}CH(M,P)}}async function V6(n,e){return new Promise((t,r)=>{new PS(e.app,n,async()=>{try{await e.taskService.deleteTask(n),t()}catch(i){r(i)}}).open()})}function $6(n){let e=n.querySelector(".task-card__subtasks");if(e){let t=e._clickHandler;t&&(e.removeEventListener("click",t),delete e._clickHandler)}}async function cp(n,e,t,r){try{let s=n.querySelector(".task-card__subtasks");if(r){if(!s){s=document.createElement("div"),s.className="task-card__subtasks";let a=o=>{o.stopPropagation()};s.addEventListener("click",a),s._clickHandler=a,n.appendChild(s)}for(;s.firstChild;)s.removeChild(s.firstChild);let i=s.createEl("div",{cls:"task-card__subtasks-loading",text:"Loading subtasks..."});try{let a=t.app.vault.getAbstractFileByPath(e.path);if(!(a instanceof be.TFile))throw new Error("Task file not found");if(!t.projectSubtasksService)throw new Error("projectSubtasksService not initialized");let o=await t.projectSubtasksService.getTasksLinkedToProject(a);if(i.remove(),o.length===0){s.createEl("div",{cls:"task-card__subtasks-loading",text:"No subtasks found"});return}let l=t.projectSubtasksService.sortTasks(o),d=(u=>{var p;let f=[],h=u.closest(".task-card");for(;h;){let m=h._taskPath;m&&f.unshift(m),h=(p=h.parentElement)==null?void 0:p.closest(".task-card")}return f})(n);for(let u of l){if(d.includes(u.path)){console.warn("Circular reference detected in task chain:",{subtask:u.path,parentChain:d,cycle:[...d,u.path]});continue}let f=fr(u,t,void 0,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});f.classList.add("task-card--subtask"),s.appendChild(f)}}catch(a){console.error("Error loading subtasks:",a),i.textContent="Failed to load subtasks"}}else if(s){let i=s._clickHandler;i&&(s.removeEventListener("click",i),delete s._clickHandler),s.remove()}}catch(s){throw console.error("Error in toggleSubtasks:",s),s}}async function Y6(n,e,t){if(!n||!n.projects||n.projects.length===0)return;let r=0,s=10;for(;r<s;){try{let a=await e.cacheManager.getTaskInfo(n.path);if(a&&a.dateModified===n.dateModified)break}catch(a){}await new Promise(a=>setTimeout(a,10)),r++}let i=t.querySelectorAll(".task-card__chevron--expanded");for(let a of i){let o=a.closest(".task-card");if(!o)continue;let l=o.dataset.taskPath;if(!l)continue;let c=e.app.vault.getAbstractFileByPath(l);if(!(c instanceof be.TFile))continue;let d=c.basename;if(n.projects.flat(2).some(f=>{if(f&&typeof f=="string"&&f.startsWith("[[")&&f.endsWith("]]")){let h=f.slice(2,-2).trim(),p=e.app.metadataCache.getFirstLinkpathDest(h,"");return h===d||p&&p.path===l}return f===d||f===l})&&o.querySelector(".task-card__subtasks"))try{let h=await e.cacheManager.getTaskInfo(l);h&&await cp(o,h,e,!0)}catch(h){console.error("Error refreshing parent task subtasks:",h)}}}var be,_S,TH,wH,PS,Fs=v(()=>{be=require("obsidian");iw();At();Ne();ec();ru();tc();xm();Sm();CS();vH();_S={showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1};TH={due:n=>n.due,scheduled:n=>n.scheduled,projects:n=>n.projects,contexts:n=>n.contexts,tags:n=>n.tags,timeEstimate:n=>n.timeEstimate,totalTrackedTime:n=>n.totalTrackedTime,recurrence:n=>n.recurrence,completedDate:n=>n.completedDate,"file.ctime":n=>n.dateCreated,"file.mtime":n=>n.dateModified};wH={due:(n,e,t,r)=>{typeof e=="string"&&j6(n,e,t,r)},scheduled:(n,e,t,r)=>{typeof e=="string"&&W6(n,e,t,r)},projects:(n,e,t,r)=>{if(Array.isArray(e)){let s={metadataCache:r.app.metadataCache,workspace:r.app.workspace};by(n,e,s)}},contexts:(n,e,t,r)=>{Array.isArray(e)&&yH(n,e,{onTagClick:async(i,a)=>{let o=i.startsWith("@")?i.slice(1):i;await r.openTagsPane(`#${o}`)||console.log("Could not open search pane, context clicked:",i)}})},tags:(n,e,t,r)=>{Array.isArray(e)&&gH(n,e,{onTagClick:async(i,a)=>{let o=i.startsWith("#")?i.slice(1):i;await r.openTagsPane(`#${o}`)||console.log("Could not open search pane, tag clicked:",i)}})},timeEstimate:(n,e,t,r)=>{typeof e=="number"&&(n.textContent=`${r.formatTime(e)} estimated`)},totalTrackedTime:(n,e,t,r)=>{typeof e=="number"&&e>0&&(n.textContent=`${r.formatTime(e)} tracked`)},recurrence:(n,e)=>{typeof e=="string"&&(n.textContent=`Recurring: ${ua(e)}`)},completedDate:(n,e,t,r)=>{typeof e=="string"&&(n.textContent=`Completed: ${jt(e,{dateFormat:"MMM d",showTime:!1,userTimeFormat:r.settings.calendarViewSettings.timeFormat})}`)},"file.ctime":(n,e,t,r)=>{typeof e=="string"&&(n.textContent=`Created: ${jt(e,{dateFormat:"MMM d",showTime:!1,userTimeFormat:r.settings.calendarViewSettings.timeFormat})}`)},"file.mtime":(n,e,t,r)=>{typeof e=="string"&&(n.textContent=`Modified: ${jt(e,{dateFormat:"MMM d",showTime:!1,userTimeFormat:r.settings.calendarViewSettings.timeFormat})}`)}};PS=class extends be.Modal{constructor(e,t,r){super(e),this.task=t,this.onConfirm=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Delete Task"});let t=e.createEl("p");t.appendText('Are you sure you want to delete the task "'),t.createEl("strong",{text:this.task.title}),t.appendText('"?'),e.createEl("p",{cls:"mod-warning",text:"This action cannot be undone. The task file will be permanently deleted."});let r=e.createEl("div",{cls:"modal-button-container"});r.style.display="flex",r.style.gap="10px",r.style.justifyContent="flex-end",r.style.marginTop="20px";let s=r.createEl("button",{text:"Cancel"});s.addEventListener("click",()=>{this.close()});let i=r.createEl("button",{text:"Delete",cls:"mod-warning"});i.style.backgroundColor="var(--color-red)",i.style.color="white",i.addEventListener("click",async()=>{try{await this.onConfirm(),this.close(),new be.Notice("Task deleted successfully")}catch(a){let o=a instanceof Error?a.message:String(a);new be.Notice(`Failed to delete task: ${o}`),console.error("Error in delete confirmation:",a)}}),s.focus()}onClose(){let{contentEl:e}=this;e.empty()}}});var od,IS=v(()=>{od=class n{constructor(e){this.statuses=e}getNextStatus(e){var i;let t=this.getStatusesByOrder(),r=t.findIndex(a=>a.value===e);if(r===-1)return((i=t[0])==null?void 0:i.value)||"open";let s=(r+1)%t.length;return t[s].value}getStatusConfig(e){return this.statuses.find(t=>t.value===e)}getCompletedStatuses(){return this.statuses.filter(e=>e.isCompleted).map(e=>e.value)}getOpenStatuses(){return this.statuses.filter(e=>!e.isCompleted).map(e=>e.value)}getStatusesByOrder(){return[...this.statuses].sort((e,t)=>e.order-t.order)}isCompletedStatus(e){let t=this.getStatusConfig(e);return(t==null?void 0:t.isCompleted)||!1}getStatusOrder(e){let t=this.getStatusConfig(e);return(t==null?void 0:t.order)||0}getStatusStyles(){let e=[];for(let t of this.statuses){let r=`--status-${t.value.replace(/[^a-zA-Z0-9-]/g,"-")}-color`;e.push(`${r}: ${t.color};`)}return`:root { ${e.join(" ")} }`}getAllStatuses(){return[...this.statuses]}getNonCompletionStatuses(){return this.statuses.filter(e=>!e.isCompleted)}updateStatuses(e){this.statuses=e}static validateStatuses(e){let t=[];e.length<2&&t.push("At least 2 statuses are required"),e.some(l=>l.isCompleted)||t.push("At least one status must be marked as completed");let s=e.map(l=>l.value),i=new Set(s);s.length!==i.size&&t.push("Status values must be unique");let a=e.map(l=>l.id),o=new Set(a);a.length!==o.size&&t.push("Status IDs must be unique");for(let l of e){if(!l.value||l.value.trim()===""){t.push("Status values cannot be empty");break}if(!l.label||l.label.trim()===""){t.push("Status labels cannot be empty");break}if(!l.color||!l.color.match(/^#[0-9a-fA-F]{6}$/)){t.push("Status colors must be valid hex colors (#rrggbb)");break}}return{valid:t.length===0,errors:t}}static generateStatusId(e){let t=new Set(e.map(i=>i.id)),r=1,s=`status-${r}`;for(;t.has(s);)r++,s=`status-${r}`;return s}static createDefaultStatus(e){let t=n.generateStatusId(e),r=Math.max(...e.map(s=>s.order),0)+1;return{id:t,value:"new-status",label:"New status",color:"#808080",isCompleted:!1,order:r,autoArchive:!1,autoArchiveDelay:5}}}});var FH={};st(FH,{TaskLinkDetectionService:()=>gp});var dl,gp,RS=v(()=>{dl=require("obsidian"),gp=class{constructor(e){this.linkCache=new Map;this.plugin=e}async detectTaskLink(e,t,r="wikilink"){let s=r==="wikilink"?this.parseWikilink(e):this.parseMarkdownLink(e);if(!s)return{isValidTaskLink:!1};let{linkPath:i,displayText:a}=s,o=`${t}:${i}`,l=this.linkCache.get(o);if(l){let f=this.plugin.app.vault.getAbstractFileByPath(i);if(f instanceof dl.TFile&&f.stat.mtime===l.lastModified)return l.result}let c=this.resolveLinkPath(i,t);if(!c){let f={isValidTaskLink:!1};return this.cacheResult(o,f,0),f}let d=this.plugin.app.vault.getAbstractFileByPath(c);if(!(d instanceof dl.TFile)){let f={isValidTaskLink:!1};return this.cacheResult(o,f,0),f}try{let f=await this.plugin.cacheManager.getTaskInfo(c);if(f){let h={isValidTaskLink:!0,taskPath:c,taskInfo:f,displayText:a};return this.cacheResult(o,h,d.stat.mtime),h}}catch(f){console.debug("TaskLinkDetectionService: Error checking task info for link:",c,f)}let u={isValidTaskLink:!1};return this.cacheResult(o,u,d.stat.mtime),u}parseWikilink(e){let t=e.slice(2,-2).trim();if(!t)return null;let r=t.indexOf("|");if(r!==-1){let i=t.slice(0,r).trim(),a=t.slice(r+1).trim();return!i||!a?null:{linkPath:(0,dl.parseLinktext)(i).path,displayText:a}}let s=(0,dl.parseLinktext)(t);return{linkPath:s.path,displayText:s.subpath||void 0}}parseMarkdownLink(e){let t=e.match(/^\[([^\]]*)\]\(([^)]+)\)$/);if(!t)return null;let r=t[1].trim(),s=t[2].trim();if(!s)return null;try{s=decodeURIComponent(s)}catch(a){console.debug("TaskLinkDetectionService: Failed to decode URI component:",s,a)}let i=(0,dl.parseLinktext)(s);return{linkPath:i.path,displayText:r||i.subpath||void 0}}resolveLinkPath(e,t){try{let r=this.plugin.app.metadataCache.getFirstLinkpathDest(e,t);return(r==null?void 0:r.path)||null}catch(r){return console.debug("Error resolving link path:",e,r),null}}cacheResult(e,t,r){if(this.linkCache.set(e,{result:t,lastModified:r}),this.linkCache.size>1e3){let s=this.linkCache.keys().next().value;this.linkCache.delete(s)}}clearCacheForFile(e){for(let[t]of this.linkCache)t.includes(e)&&this.linkCache.delete(t)}clearCache(){this.linkCache.clear()}findWikilinks(e){let t=[],r=/\[\[([^\]]+)\]\]/g,s;for(;(s=r.exec(e))!==null;)t.push({match:s[0],start:s.index,end:s.index+s[0].length,type:"wikilink"});let i=/\[([^\]]*)\]\(([^)]+)\)/g;for(r.lastIndex=0;(s=i.exec(e))!==null;)t.push({match:s[0],start:s.index,end:s.index+s[0].length,type:"markdown"});return t.sort((a,o)=>a.start-o.start)}cleanup(){this.linkCache.clear()}}});var HH,pr,ld,NS=v(()=>{HH=require("@codemirror/view"),pr=require("obsidian");Ne();At();qy();ec();ru();tc();xm();ld=class n extends HH.WidgetType{constructor(e,t,r,s){super(),this.taskInfo=e,this.plugin=t,this.originalText=r,this.displayText=s}toDOM(e){let t=document.createElement("span"),r=this.plugin.selectedDate||(()=>{let f=new Date;return new Date(Date.UTC(f.getFullYear(),f.getMonth(),f.getDate()))})(),s=this.taskInfo.recurrence?Vn(this.taskInfo,r):this.taskInfo.status,i=["tasknotes-plugin","task-inline-preview"];this.taskInfo.priority&&i.push(`task-inline-preview--priority-${this.taskInfo.priority}`),this.plugin.statusManager.isCompletedStatus(s)&&i.push("task-inline-preview--completed"),t.className=i.join(" ");let a=this.plugin.statusManager.getStatusConfig(s),o=t.createEl("span",{cls:"task-inline-preview__status-dot"});if((0,pr.setTooltip)(o,`Status: ${a?a.label:s}`,{placement:"top"}),a&&(o.style.borderColor=a.color,this.plugin.statusManager.isCompletedStatus(s)?o.style.backgroundColor=a.color:o.style.backgroundColor="transparent"),o.addEventListener("click",async f=>{f.stopPropagation(),f.preventDefault();try{if(this.taskInfo.recurrence){let h=await this.plugin.toggleRecurringTaskComplete(this.taskInfo,r),p=Vn(h,r),m=this.plugin.statusManager.getStatusConfig(p),g=this.plugin.statusManager.isCompletedStatus(p);m&&(o.style.borderColor=m.color,g?o.style.backgroundColor=m.color:o.style.backgroundColor="transparent"),g?t.classList.add("task-inline-preview--completed"):t.classList.remove("task-inline-preview--completed"),this.taskInfo=h}else{let h=await this.plugin.cacheManager.getTaskInfo(this.taskInfo.path);if(!h)return;let p=h.status||"open",m=this.plugin.statusManager.getNextStatus(p);await this.plugin.updateTaskProperty(h,"status",m),this.taskInfo.status=m;let g=this.plugin.statusManager.getStatusConfig(m);g&&(o.style.borderColor=g.color),this.plugin.statusManager.isCompletedStatus(m)?(t.classList.add("task-inline-preview--completed"),g&&(o.style.backgroundColor=g.color)):(t.classList.remove("task-inline-preview--completed"),o.style.backgroundColor="transparent")}setTimeout(()=>{e&&typeof e.dispatch=="function"&&Ya(e,this.taskInfo.path)},50)}catch(h){console.error("Error cycling task status in inline widget:",h)}}),this.taskInfo.priority){let f=this.plugin.priorityManager.getPriorityConfig(this.taskInfo.priority);if(f){let h=t.createEl("span",{cls:"task-inline-preview__priority-dot task-card__priority-dot"});(0,pr.setTooltip)(h,`Priority: ${f.label} (click to change)`,{placement:"top"}),h.style.backgroundColor=f.color,h.addEventListener("click",p=>{p.stopPropagation(),p.preventDefault(),new Zs({currentValue:this.taskInfo.priority,onSelect:async g=>{try{await this.plugin.updateTaskProperty(this.taskInfo,"priority",g),this.taskInfo.priority=g;let y=this.plugin.priorityManager.getPriorityConfig(g);y&&(h.style.backgroundColor=y.color,(0,pr.setTooltip)(h,`Priority: ${y.label} (click to change)`,{placement:"top"}))}catch(y){console.error("Error updating priority:",y),new pr.Notice("Failed to update priority")}},plugin:this.plugin}).show(p)})}}let l=this.taskInfo.title.length>80?this.taskInfo.title.slice(0,77)+"...":this.taskInfo.title;if(t.createEl("span",{cls:"task-inline-preview__title",text:l}),this.taskInfo.due){let f=this.plugin.settings.calendarViewSettings.timeFormat,h=jt(this.taskInfo.due,{dateFormat:"MMM d",showTime:!0,userTimeFormat:f}),p=jt(this.taskInfo.due,{dateFormat:"MMM d, yyyy",showTime:!0,userTimeFormat:f}),m=t.createEl("span",{cls:"task-inline-preview__date task-inline-preview__date--due task-card__metadata-date task-card__metadata-date--due"});(0,pr.setTooltip)(m,`Due: ${p} (click to change)`,{placement:"top"});let g=m.createEl("span",{cls:"task-inline-preview__date-icon"});(0,pr.setIcon)(g,"calendar"),m.appendText(h),m.addEventListener("click",y=>{y.stopPropagation(),y.preventDefault(),new ts({currentValue:we(this.taskInfo.due||""),currentTime:xr(this.taskInfo.due||""),onSelect:async(w,b)=>{try{let E;w?b?E=`${w}T${b}`:E=w:E=void 0,await this.plugin.updateTaskProperty(this.taskInfo,"due",E),this.taskInfo.due=E}catch(E){console.error("Error updating due date:",E),new pr.Notice("Failed to update due date")}}}).show(y)})}if(this.taskInfo.scheduled&&(!this.taskInfo.due||this.taskInfo.scheduled!==this.taskInfo.due)){let f=this.plugin.settings.calendarViewSettings.timeFormat,h=jt(this.taskInfo.scheduled,{dateFormat:"MMM d",showTime:!0,userTimeFormat:f}),p=jt(this.taskInfo.scheduled,{dateFormat:"MMM d, yyyy",showTime:!0,userTimeFormat:f}),m=t.createEl("span",{cls:"task-inline-preview__date task-inline-preview__date--scheduled task-card__metadata-date task-card__metadata-date--scheduled"});(0,pr.setTooltip)(m,`Scheduled: ${p} (click to change)`,{placement:"top"});let g=m.createEl("span",{cls:"task-inline-preview__date-icon"});(0,pr.setIcon)(g,"clock"),m.appendText(h),m.addEventListener("click",y=>{y.stopPropagation(),y.preventDefault(),new ts({currentValue:we(this.taskInfo.scheduled||""),currentTime:xr(this.taskInfo.scheduled||""),onSelect:async(w,b)=>{try{let E;w?b?E=`${w}T${b}`:E=w:E=void 0,await this.plugin.updateTaskProperty(this.taskInfo,"scheduled",E),this.taskInfo.scheduled=E}catch(E){console.error("Error updating scheduled date:",E),new pr.Notice("Failed to update scheduled date")}}}).show(y)})}if(this.taskInfo.recurrence){let f=t.createEl("span",{cls:"task-inline-preview__recurring-indicator",attr:{"aria-label":"Recurring task (click to change)"}});(0,pr.setTooltip)(f,"Recurring task (click to change)",{placement:"top"}),(0,pr.setIcon)(f,"rotate-ccw"),f.addEventListener("click",h=>{h.stopPropagation(),h.preventDefault(),new Ks({currentValue:typeof this.taskInfo.recurrence=="string"?this.taskInfo.recurrence:void 0,onSelect:async m=>{try{await this.plugin.updateTaskProperty(this.taskInfo,"recurrence",m||void 0),this.taskInfo.recurrence=m||void 0}catch(g){console.error("Error updating recurrence:",g),new pr.Notice("Failed to update recurrence")}},app:this.plugin.app}).show(h)})}let c=t.createEl("span",{cls:"task-inline-preview__pencil",text:""});(0,pr.setTooltip)(c,"Task options",{placement:"top"}),(0,pr.setIcon)(c,"ellipsis-vertical"),t.dataset.taskPath=this.taskInfo.path,t.dataset.originalText=this.originalText,this.addDragHandlers(t),c.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),this.showTaskContextMenu(f,t)});let{clickHandler:d,dblclickHandler:u}=sc({task:this.taskInfo,plugin:this.plugin,excludeSelector:".task-inline-preview__pencil"});return t.addEventListener("click",async f=>{f.preventDefault(),f.stopPropagation(),await d(f)}),t.addEventListener("dblclick",async f=>{f.preventDefault(),f.stopPropagation(),await u(f)}),t.addEventListener("contextmenu",async f=>{f.preventDefault(),f.stopPropagation(),await this.showTaskContextMenu(f,t)}),t.addEventListener("mouseover",nc(this.taskInfo,this.plugin)),t}addDragHandlers(e){this.plugin.dragDropManager.makeTaskCardDraggable(e,this.taskInfo.path)}async showTaskContextMenu(e,t){try{let{showTaskContextMenu:r}=await Promise.resolve().then(()=>(Fs(),rd)),s=this.plugin.selectedDate||(()=>{let i=new Date;return new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate()))})();await r(e,this.taskInfo.path,this.plugin,s)}catch(r){console.error(`Error showing context menu for task ${this.taskInfo.path}:`,r),await this.plugin.openTaskEditModal(this.taskInfo)}}eq(e){return e instanceof n?this.taskInfo.path===e.taskInfo.path&&this.taskInfo.status===e.taskInfo.status&&this.taskInfo.title===e.taskInfo.title&&this.taskInfo.priority===e.taskInfo.priority&&this.taskInfo.archived===e.taskInfo.archived&&this.taskInfo.due===e.taskInfo.due&&this.taskInfo.scheduled===e.taskInfo.scheduled&&this.taskInfo.recurrence===e.taskInfo.recurrence&&JSON.stringify(this.taskInfo.complete_instances)===JSON.stringify(e.taskInfo.complete_instances)&&this.taskInfo.dateModified===e.taskInfo.dateModified:!1}ignoreEvent(){return!1}get estimatedHeight(){return-1}get block(){return!1}}});function e4(n){let e=new Map;return ui.ViewPlugin.fromClass(class{constructor(t){this.decorations=this.buildDecorations(t)}update(t){var s,i;if(!((s=n==null?void 0:n.settings)!=null&&s.enableTaskLinkOverlay)){this.decorations=ui.Decoration.none;return}try{if(!t.state.field(qi.editorLivePreviewField)){this.decorations=ui.Decoration.none;return}}catch(a){this.decorations=ui.Decoration.none;return}let r=t.transactions.some(a=>a.effects.some(o=>o.is(OS)));if(t.docChanged||t.selectionSet||r){if(r){let a=(i=t.transactions.flatMap(o=>o.effects).find(o=>o.is(OS)))==null?void 0:i.value;if(a!=null&&a.taskPath)for(let[o]of e.entries())o.includes(a.taskPath)&&e.delete(o);else e.clear()}this.decorations=this.buildDecorations(t.view)}}buildDecorations(t){var r;try{return(r=n==null?void 0:n.settings)!=null&&r.enableTaskLinkOverlay?t.state.field(qi.editorLivePreviewField)?t4(t.state,n,e):ui.Decoration.none:ui.Decoration.none}catch(s){return console.error("Error building task link decorations:",s),ui.Decoration.none}}},{decorations:t=>t.decorations})}function t4(n,e,t){var l,c;let r=new Gy.RangeSetBuilder;if(!n||!e||!t)return r.finish();let s=n.doc;if(!s||!e.app||!e.app.workspace)return r.finish();let i=e.taskLinkDetectionService||new gp(e),a=e.app.workspace.getActiveViewOfType(qi.MarkdownView);if(!a)return r.finish();let o=(l=a.file)==null?void 0:l.path;if(!o||typeof o!="string"||o.length===0)return r.finish();try{let d=s.toString();if(typeof d!="string"||d.length>1e5)return r.finish();let u=(c=n.selection)==null?void 0:c.main.head,f=i.findWikilinks(d);if(!Array.isArray(f))return r.finish();for(let h of f)try{if(!h||typeof h.match!="string"||typeof h.start!="number"||typeof h.end!="number"||h.start<0||h.end<=h.start||h.start>=d.length||h.end>d.length)continue;let p=h.type==="wikilink"?r4(h.match):s4(h.match);if(!p)continue;let{linkPath:m}=p;if(!m||typeof m!="string"||m.trim().length===0)continue;let g=n4(m,o,e);if(!g)continue;let y=i4(g,e);if(y){if(!y.title||typeof y.title!="string"||u!==void 0&&u>=h.start&&u<h.end)continue;let T=`${g}-${h.start}-${h.end}`,w=new ld(y,e,h.match,p.displayText),b=t.get(T);(!b||!b.eq(w))&&t.set(T,w);let E=ui.Decoration.replace({widget:t.get(T),inclusive:!0});r.add(h.start,h.end,E)}}catch(p){continue}}catch(d){console.error("Error in buildTaskLinkDecorations:",d)}return r.finish()}function r4(n){if(!n||typeof n!="string"||n.length<4||!n.startsWith("[[")||!n.endsWith("]]"))return null;let e=n.slice(2,-2).trim();if(!e||e.length===0||e.length>500)return null;let t=e.indexOf("|");if(t!==-1){let s=e.slice(0,t).trim(),i=e.slice(t+1).trim();if(!s||!i)return null;let a=(0,qi.parseLinktext)(s);return a.path?{linkPath:a.path,displayText:i}:null}let r=(0,qi.parseLinktext)(e);return r.path?{linkPath:r.path,displayText:r.subpath||void 0}:null}function s4(n){if(!n||typeof n!="string")return null;let e=n.match(/^\[([^\]]*)\]\(([^)]+)\)$/);if(!e)return null;let t=e[1].trim(),r=e[2].trim();if(!r||r.length===0||r.length>500)return null;try{r=decodeURIComponent(r)}catch(i){}let s=(0,qi.parseLinktext)(r);return s.path?{linkPath:s.path,displayText:t||s.subpath||void 0}:null}function n4(n,e,t){if(!n||typeof n!="string"||n.trim().length===0||!e||typeof e!="string"||!t||!t.app||!t.app.metadataCache)return null;try{let r=n.replace(/\.\./g,"").trim();if(!r)return null;let s=t.app.metadataCache.getFirstLinkpathDest(r,e);return!s||!s.path||typeof s.path!="string"?null:s.path}catch(r){return null}}function i4(n,e){if(!n||typeof n!="string"||n.trim().length===0||!e)return null;try{let t=/[<>:"|?*]/,r=n.split("").some(a=>{let o=a.charCodeAt(0);return o<=31||o===127});if(t.test(n)||r)return null;let s=e.cacheManager;if(!s||!s.getCachedTaskInfoSync)return null;let i=s.getCachedTaskInfoSync(n);return i&&typeof i=="object"&&i.title?i:null}catch(t){return null}}function BH(n){return e4(n)}function Ya(n,e){if(!n||typeof n.dispatch!="function"){console.warn("Invalid EditorView passed to dispatchTaskUpdate:",n);return}try{n.dispatch({effects:[OS.of({taskPath:e})]})}catch(t){console.error("Error dispatching task update:",t)}}var Gy,ui,qi,OS,qy=v(()=>{Gy=require("@codemirror/state"),ui=require("@codemirror/view"),qi=require("obsidian");RS();NS();OS=Gy.StateEffect.define()});function aB(n,e){var s;let t=new Set(["title","status","priority","archived","due","scheduled","contexts","projects","tags","timeEstimate","completedDate","recurrence","dateCreated","dateModified","timeEntries","reminders","icsEventId"]),r={};return Object.keys(n).forEach(i=>{t.has(i)||(r[i]=n[i])}),{title:n.title||e.name||((s=e.path.split("/").pop())==null?void 0:s.replace(".md",""))||"Untitled",status:n.status||"open",priority:n.priority||"normal",path:e.path,archived:n.archived||!1,due:n.due,scheduled:n.scheduled,contexts:Array.isArray(n.contexts)?n.contexts:n.contexts?[n.contexts]:void 0,projects:Array.isArray(n.projects)?n.projects:n.projects?[n.projects]:void 0,tags:Array.isArray(n.tags)?n.tags:n.tags?[n.tags]:void 0,timeEstimate:n.timeEstimate,completedDate:n.completedDate,recurrence:n.recurrence,dateCreated:n.dateCreated,dateModified:n.dateModified,timeEntries:n.timeEntries,reminders:n.reminders,icsEventId:n.icsEventId,customProperties:Object.keys(r).length>0?r:void 0,basesData:e.basesData}}function O4(n,e){if(!(n!=null&&n.path))return null;let t=n.properties||n.frontmatter||{};if(e!=null&&e.fieldMapper){let r=e.fieldMapper.mapFromFrontmatter(t,n.path,e.settings.storeTitleInFilename);return{...aB(r,n),customProperties:r.customProperties}}else return aB(t,n)}async function yv(n,e,t){let r=t||O4,s=[];for(let i of n)if(i!=null&&i.path)try{let a=r(i,e);a&&s.push(a)}catch(a){console.warn("[TaskNotes][BasesPOC] Error converting Bases item to TaskInfo:",a)}return s}function L4(n){var e,t,r,s,i,a,o,l,c,d,u,f;try{let h=(e=n==null?void 0:n.controller)!=null?e:n,p=(t=n==null?void 0:n.query)!=null?t:h==null?void 0:h.query;if(!h)return[];let m=p==null?void 0:p.properties,g=new Map;if(m&&typeof m=="object")for(let E of Object.keys(m)){g.set(E,E);let S=E.includes(".")?E.split(".").pop():E;g.set(S,E);let D=(s=(r=m[E])==null?void 0:r.getDisplayName)==null?void 0:s.call(r);typeof D=="string"&&D.trim()&&g.set(D.toLowerCase(),E)}let y=E=>{if(E)return g.get(E)||g.get(E.toLowerCase())||E},T=(a=(i=h==null?void 0:h.getViewConfig)==null?void 0:i.call(h))!=null?a:{},w;try{w=(d=(l=(o=p==null?void 0:p.getViewConfig)==null?void 0:o.call(p,"order"))!=null?l:T==null?void 0:T.order)!=null?d:(c=T==null?void 0:T.columns)==null?void 0:c.order}catch(E){w=(f=T==null?void 0:T.order)!=null?f:(u=T==null?void 0:T.columns)==null?void 0:u.order}return!w||!Array.isArray(w)||w.length===0?[]:w.map(y).filter(E=>!!E).map(E=>{var S,D,x;return{id:E,displayName:(x=(D=(S=m==null?void 0:m[E])==null?void 0:S.getDisplayName)==null?void 0:D.call(S))!=null?x:E,visible:!0}})}catch(h){return console.debug("[TaskNotes][Bases] getBasesVisibleProperties failed:",h),[]}}async function oB(n,e,t,r,s){let{createTaskCard:i}=await Promise.resolve().then(()=>(Fs(),rd)),a=document.createElement("div");a.className="tn-bases-tasknotes-list",a.style.cssText="display: flex; flex-direction: column; gap: 1px;",n.appendChild(a);let o,l={showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1};if(r){let c=L4(r);c.length>0&&(o=c.map(d=>d.id),o=o.map(d=>{var h,p;let u=d,f=(h=t.fieldMapper)==null?void 0:h.fromUserField(d);if(f)u=f;else if(d.startsWith("task."))u=d.substring(5);else if(d.startsWith("note.")){let m=d.substring(5),g=(p=t.fieldMapper)==null?void 0:p.fromUserField(m);g?u=g:m==="dateCreated"?u="dateCreated":m==="dateModified"?u="dateModified":m==="completedDate"?u="completedDate":u=m}else d==="file.ctime"?u="dateCreated":d==="file.mtime"?u="dateModified":d==="file.name"?u="title":d.startsWith("formula.")&&(u=d);return u}))}(!o||o.length===0)&&(o=t.settings.defaultVisibleProperties||["due","scheduled","projects","contexts","tags"]);for(let c of e)try{let d=i(c,t,o,l);a.appendChild(d),s&&c.path&&s.set(c.path,d)}catch(d){console.warn("[TaskNotes][BasesPOC] Error creating task card:",d)}}var QS=v(()=>{});var lB={};st(lB,{coerceForCompare:()=>gl,getBasesSortComparator:()=>KS});function F4(n){return String(n||"ASC").toUpperCase()==="DESC"?"DESC":"ASC"}function gl(n){if(n==null)return"";if(Array.isArray(n))return gl(n[0]);if(typeof n=="number")return n;if(typeof n=="boolean")return n?1:0;let e=String(n).trim(),t=Number(e);if(!Number.isNaN(t)&&e!=="")return t;let r=Date.parse(e);return Number.isNaN(r)?e.toLowerCase():r}function H4(n){var t,r;let e=new Map;if(!n)return e;for(let s of Object.keys(n)){e.set(s,s);let i=s.includes(".")?s.split(".").pop():s;e.set(i,s);let a=(r=(t=n[s])==null?void 0:t.getDisplayName)==null?void 0:r.call(t);typeof a=="string"&&a.trim()&&e.set(a.toLowerCase(),s)}return e}function KS(n,e){var t,r,s,i,a;try{let o=(t=n==null?void 0:n.controller)!=null?t:n,l=(r=n==null?void 0:n.query)!=null?r:o==null?void 0:o.query;if(!o)return null;let c=(i=(s=o==null?void 0:o.getViewConfig)==null?void 0:s.call(o))!=null?i:{},d;try{d=(a=l==null?void 0:l.getViewConfig)==null?void 0:a.call(l,"sort")}catch(y){}if(d==null&&(d=c==null?void 0:c.sort),!Array.isArray(d)||d.length===0)return null;let u=l==null?void 0:l.properties,f=H4(u),h=y=>{if(y)return f.get(y)||f.get(y.toLowerCase())||y},p=[];for(let y of d){if(!y)continue;let T=typeof y=="string"?y:y.property||y.id||y.key;if(!T)continue;let w=h(String(T));if(!w)continue;let b=F4(y==null?void 0:y.direction);p.push({id:w,direction:b})}if(p.length===0)return null;let m=(y,T)=>{if(T==="file.basename")return(y.split("/").pop()||"").replace(/\.md$/i,"");if(T==="file.path")return y;let w=e.get(y)||{};if(Object.prototype.hasOwnProperty.call(w,T))return w[T];let b=T.includes(".")?T.split(".").pop():T;if(Object.prototype.hasOwnProperty.call(w,b))return w[b]},g=(y,T)=>{for(let{id:w,direction:b}of p){let E,S;switch(w){case"title":E=y.title,S=T.title;break;case"due":E=y.due,S=T.due;break;case"scheduled":E=y.scheduled,S=T.scheduled;break;case"priority":E=y.priority,S=T.priority;break;case"file.basename":case"file.path":E=m(y.path,w),S=m(T.path,w);break;default:E=m(y.path,w),S=m(T.path,w)}let D=gl(E),x=gl(S),M=0;if(typeof D=="number"&&typeof x=="number"?M=D-x:typeof D=="string"&&typeof x=="string"?M=D.localeCompare(x):M=String(D).localeCompare(String(x)),M!==0)return b==="DESC"?-M:M}return 0};return g.__basesSortEntries=p,g}catch(o){return console.debug("[TaskNotes][Bases] getBasesSortComparator failed:",o),null}}var vv=v(()=>{});function cB(n,e){return function(r){let s=null,i=null,a=null,o=new Map,l=r==null?void 0:r.viewContainerEl;if(!l)return console.error("[TaskNotes][BasesPOC] No viewContainerEl found"),{destroy:()=>{}};l.innerHTML="";let c=document.createElement("div");c.className="tn-bases-integration tasknotes-plugin tasknotes-container",l.appendChild(c),s=c;let d=document.createElement("div");d.className="tn-bases-items-container",d.style.cssText="margin-top: 12px;",c.appendChild(d);let u=()=>{var b;let T=[],w=r==null?void 0:r.results;if(w&&w instanceof Map)for(let[E,S]of w.entries()){let D={key:E,data:S,file:S==null?void 0:S.file,path:((b=S==null?void 0:S.file)==null?void 0:b.path)||(S==null?void 0:S.path),properties:(S==null?void 0:S.properties)||(S==null?void 0:S.frontmatter),basesData:S};T.push(D)}return T},f=async()=>{var T,w;if(s)try{let b=u(),E=(T=r==null?void 0:r.ctx)==null?void 0:T.formulas;if(E&&b.length>0)for(let D=0;D<b.length;D++){let x=b[D],M=(w=x.basesData)==null?void 0:w.formulaResults;if(M!=null&&M.cachedFormulaOutputs)for(let B of Object.keys(E)){let Q=E[B];if(Q&&typeof Q.getValue=="function")try{let P=x.basesData,I=x.properties||{},A;if(P.frontmatter&&Object.keys(I).length>0){let j=P.frontmatter;P.frontmatter={...j,...I},A=Q.getValue(P),P.frontmatter=j}else A=Q.getValue(P);A!==void 0&&(M.cachedFormulaOutputs[B]=A)}catch(P){}}}let S=await yv(b,n);if(d.innerHTML="",S.length===0){let D=document.createElement("div");D.className="tn-bases-empty",D.style.cssText="padding: 20px; text-align: center; color: #666;",D.textContent="No TaskNotes tasks found for this Base.",d.appendChild(D)}else{let D=new Map(b.filter(B=>!!B.path).map(B=>[B.path||"",B.properties||B.frontmatter||{}])),{getBasesSortComparator:x}=await Promise.resolve().then(()=>(vv(),lB)),M=x(r,D);M&&S.sort(M),o.clear(),await oB(d,S,n,r,o)}}catch(b){console.error(`[TaskNotes][BasesPOC] Error rendering Bases ${e.errorPrefix}:`,b);let E=document.createElement("div");E.className="tn-bases-error",E.style.cssText="padding: 20px; color: #d73a49; background: #ffeaea; border-radius: 4px; margin: 10px 0;",E.textContent=`Error loading ${e.errorPrefix} tasks: ${b.message||"Unknown error"}`,d.appendChild(E)}},h=()=>{if(!i){let{EVENT_TASK_UPDATED:T}=(or(),Td(w_));i=n.emitter.on(T,async w=>{try{let b=(w==null?void 0:w.task)||(w==null?void 0:w.taskInfo);if(!b||!b.path)return;u().find(D=>D.path===b.path)&&await p(b)}catch(b){console.error("[TaskNotes][Bases] Error in selective task update:",b),m()}})}},p=async T=>{var w;if(s)try{let b=o.get(T.path);if(b){let{updateTaskCard:E}=await Promise.resolve().then(()=>(Fs(),rd)),S=(w=r==null?void 0:r.ctx)!=null&&w.formulas?Object.keys(r.ctx.formulas):[];E(b,T,n,S,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0}),b.classList.add("task-card--updated"),window.setTimeout(()=>{b.classList.remove("task-card--updated")},1e3),console.log(`[TaskNotes][Bases] Selectively updated task: ${T.path}`)}else m()}catch(b){console.error("[TaskNotes][Bases] Error in selective task update:",b),m()}},m=()=>{a&&clearTimeout(a),a=window.setTimeout(async()=>{console.log("[TaskNotes][Bases] Performing debounced full refresh"),await f(),a=null},150)};f(),h();let g=null;return{refresh:f,onResize:()=>{},onDataUpdated:()=>{f()},getEphemeralState:()=>({scrollTop:(s==null?void 0:s.scrollTop)||0}),setEphemeralState:T=>{T!=null&&T.scrollTop&&s&&(s.scrollTop=T.scrollTop)},destroy:()=>{var T;if(i&&(n.emitter.offref(i),i=null),a&&(clearTimeout(a),a=null),g&&((T=r==null?void 0:r.query)!=null&&T.off))try{r.query.off("change",g)}catch(w){}s&&(s.remove(),s=null),o.clear(),g=null,console.log("[TaskNotes][Bases] Cleaned up view with real-time updates")},load:()=>{var w;if((w=r==null?void 0:r.query)!=null&&w.on&&!g){g=()=>void f();try{r.query.on("change",g)}catch(b){}}let T=r==null?void 0:r.controller;T!=null&&T.runQuery&&T.runQuery().then(()=>{f()}).catch(b=>{console.warn("[TaskNotes][Bases] Initial formula computation failed:",b)})},unload:()=>{var T;if(g&&((T=r==null?void 0:r.query)!=null&&T.off))try{r.query.off("change",g)}catch(w){}s&&(s.remove(),s=null),g=null}}}}var dB=v(()=>{QS()});function uB(n){return cB(n,{errorPrefix:"Task List"})}var hB=v(()=>{dB()});function ZS(n){return n==null?!1:typeof n=="string"?n.trim().length>0:Array.isArray(n)?n.length>0:!0}function fB(n){if(!ZS(n))return["none"];if(Array.isArray(n)){let e=[];for(let t of n)ZS(t)&&e.push(String(t));return e.length?e:["none"]}return[String(n)]}function pB(n,e){var t,r,s,i,a,o,l,c,d,u;try{let f=(t=n==null?void 0:n.controller)!=null?t:n,h=(r=n==null?void 0:n.query)!=null?r:f==null?void 0:f.query;if(!f)return null;let p=(i=(s=f==null?void 0:f.getViewConfig)==null?void 0:s.call(f))!=null?i:{},m;try{m=(a=h==null?void 0:h.getViewConfig)==null?void 0:a.call(h,"groupBy")}catch(D){}if(m==null&&(m=p==null?void 0:p.groupBy),!m)return null;let g=Array.isArray(m)?m[0]:m;if(!g||typeof g!="string")return null;let y=h==null?void 0:h.properties,T=new Map;if(y&&typeof y=="object")for(let D of Object.keys(y)){T.set(D,D);let x=D.includes(".")?D.split(".").pop():D;T.set(x,D);let M=(l=(o=y[D])==null?void 0:o.getDisplayName)==null?void 0:l.call(o);typeof M=="string"&&M.trim()&&T.set(M.toLowerCase(),D)}let b=(D=>{if(D)return T.get(D)||T.get(D.toLowerCase())||D})(g);if(!b)return null;let E=(u=(d=(c=y==null?void 0:y[b])==null?void 0:c.getDisplayName)==null?void 0:d.call(c))!=null?u:b;return{normalizedId:b,displayName:E,getGroupValues:D=>{let x=e.get(D)||{},M=x[b];if(ZS(M))return fB(M);let B=b.includes(".")?b.split(".").pop():b;return fB(x[B])}}}catch(f){return console.debug("[TaskNotes][Bases] getBasesGroupByConfig failed:",f),null}}var mB=v(()=>{});function gB(n){if(!n)return(t,r)=>String(t).localeCompare(String(r));let e=n.direction;return(t,r)=>{let s=gl(t),i=gl(r),a=0;return typeof s=="number"&&typeof i=="number"?a=s-i:typeof s=="string"&&typeof i=="string"?a=s.localeCompare(i):a=String(s).localeCompare(String(i)),e==="DESC"?-a:a}}var yB=v(()=>{vv()});function vB(n){return function(t){let r=null;if(!t||!t.viewContainerEl)return console.error("[TaskNotes][Bases] Invalid Bases container provided"),{destroy:()=>{},load:()=>{},unload:()=>{},refresh:()=>{},onDataUpdated:()=>{},onResize:()=>{},getEphemeralState:()=>({scrollTop:0}),setEphemeralState:()=>{}};let s=t.viewContainerEl;if(!s)return console.error("[TaskNotes][Bases] No viewContainerEl found"),{destroy:()=>{},load:()=>{},unload:()=>{},refresh:()=>{},onDataUpdated:()=>{},onResize:()=>{},getEphemeralState:()=>({scrollTop:0}),setEphemeralState:()=>{}};s.innerHTML="";let i=document.createElement("div");i.className="tn-bases-integration tasknotes-plugin kanban-view",s.appendChild(i),r=i;let a=document.createElement("div");a.className="kanban-view__board",i.appendChild(a);let o=()=>{var m,g;let h=[],p=t.results;if(p&&p instanceof Map)for(let[,y]of p.entries())h.push({key:((m=y==null?void 0:y.file)==null?void 0:m.path)||(y==null?void 0:y.path),data:y,file:y==null?void 0:y.file,path:((g=y==null?void 0:y.file)==null?void 0:g.path)||(y==null?void 0:y.path),properties:(y==null?void 0:y.properties)||(y==null?void 0:y.frontmatter)});return h},l=async()=>{if(r)try{let h=o(),p=await yv(h,n);if(a.innerHTML="",p.length===0){let S=document.createElement("div");S.className="tn-bases-empty",S.style.cssText="padding: 20px; text-align: center; color: var(--text-muted);",S.textContent="No TaskNotes tasks found for this Base.",a.appendChild(S);return}let m=new Map(h.filter(S=>!!S.path).map(S=>[S.path||"",S.properties||{}])),g=pB(t,m),y=new Map;if(g)for(let S of p){let D=g.getGroupValues(S.path);for(let x of D)y.has(x)||y.set(x,[]),y.get(x).push(S)}else{for(let S of p){let D=S.status||"open";y.has(D)||y.set(D,[]),y.get(D).push(S)}n.statusManager.getAllStatuses().forEach(S=>{y.has(S.value)||y.set(S.value,[])})}let w=KS(t,m)?{id:(g==null?void 0:g.normalizedId)||"status",direction:"ASC"}:null,b=gB(w),E=Array.from(y.keys()).sort(b);for(let S of E){let D=y.get(S)||[],x=c(S,D,g);a.appendChild(x)}}catch(h){console.error("[TaskNotes][Bases] Error rendering Kanban:",h)}},c=(h,p,m)=>{let g=document.createElement("div");g.className="kanban-view__column",g.dataset.columnId=h;let y=g.createDiv({cls:"kanban-view__column-header"}),T;if(m){let E=m.normalizedId.toLowerCase();if(E==="status"||E==="note.status"){let S=n.statusManager.getStatusConfig(h);T=(S==null?void 0:S.label)||h}else if(E==="priority"||E==="note.priority"){let S=n.priorityManager.getPriorityConfig(h);T=(S==null?void 0:S.label)||h}else E==="projects"||E==="project"||E==="note.projects"||E==="note.project"?T=h==="none"?"No Project":h:E==="contexts"||E==="context"||E==="note.contexts"||E==="note.context"?T=h==="none"?"Uncategorized":`@${h}`:E.includes("tag")?T=h==="none"?"Untagged":`#${h}`:T=h==="none"?"None":h}else{let E=n.statusManager.getStatusConfig(h);T=(E==null?void 0:E.label)||h}y.createEl("div",{cls:"kanban-view__column-title",text:T}),y.createEl("div",{text:`${p.length} tasks`,cls:"kanban-view__column-count"});let b=g.createDiv({cls:"kanban-view__column-body"}).createDiv({cls:"kanban-view__tasks-container"});return p.forEach(E=>{let S=n.settings.defaultVisibleProperties,D=fr(E,n,S,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});D.draggable=!0,D.addEventListener("dragstart",x=>{x.dataTransfer&&(x.dataTransfer.setData("text/plain",E.path),x.dataTransfer.effectAllowed="move")}),b.appendChild(D)}),d(g,async(E,S)=>{try{let D=await n.cacheManager.getCachedTaskInfo(E);if(D&&m){let x=m.normalizedId,M=x.toLowerCase(),B;if(S==="none"||S==="uncategorized"?B=null:B=S,M==="status"||M==="note.status")await n.updateTaskProperty(D,"status",B,{silent:!0});else if(M==="priority"||M==="note.priority")await n.updateTaskProperty(D,"priority",B,{silent:!0});else if(M==="projects"||M==="project"||M==="note.projects"||M==="note.project"){let Q=B?Array.isArray(B)?B:[B]:[];await n.updateTaskProperty(D,"projects",Q,{silent:!0})}else if(M==="contexts"||M==="context"||M==="note.contexts"||M==="note.context"){let Q=B?Array.isArray(B)?B:[B]:[];await n.updateTaskProperty(D,"contexts",Q,{silent:!0})}else try{let Q=n.app.vault.getAbstractFileByPath(D.path);Q&&"stat"in Q&&await n.app.fileManager.processFrontMatter(Q,P=>{let I=x.includes(".")?x.split(".").pop():x;P[I]=B})}catch(Q){console.warn("[TaskNotes][Bases] Frontmatter update failed for custom property:",Q)}await l()}else D&&!m&&(await n.updateTaskProperty(D,"status",S,{silent:!0}),await l())}catch(D){console.error("[TaskNotes][Bases] Move failed:",D)}}),g},d=(h,p)=>{h.addEventListener("dragover",m=>{m.preventDefault(),m.dataTransfer&&(m.dataTransfer.dropEffect="move"),h.classList.add("kanban-view__column--dragover")}),h.addEventListener("dragleave",m=>{h.contains(m.relatedTarget)||h.classList.remove("kanban-view__column--dragover")}),h.addEventListener("drop",async m=>{var w;m.preventDefault(),m.stopPropagation(),h.classList.remove("kanban-view__column--dragover");let y=(w=m.dataTransfer)==null?void 0:w.getData("text/plain"),T=h.getAttribute("data-column-id")||"";y&&T&&await p(y,T)})};l();let u=null;return{load:()=>{var p;if((p=t.query)!=null&&p.on&&!u){u=()=>void l();try{t.query.on("change",u)}catch(m){console.debug("[TaskNotes][Bases] Query listener registration failed:",m)}}let h=t.controller;h!=null&&h.runQuery?h.runQuery().then(()=>{l()}).catch(m=>{console.warn("[TaskNotes][Bases] Initial kanban formula computation failed:",m),l()}):l()},unload:()=>{var h;if(u&&((h=t.query)!=null&&h.off))try{t.query.off("change",u)}catch(p){console.debug("[TaskNotes][Bases] Query listener cleanup failed:",p)}u=null},refresh:l,onDataUpdated:()=>{l()},onResize:()=>{},getEphemeralState:()=>({scrollTop:(r==null?void 0:r.scrollTop)||0}),setEphemeralState:h=>{h!=null&&h.scrollTop&&r&&(r.scrollTop=h.scrollTop)},destroy:()=>{var h;if(u&&((h=t.query)!=null&&h.off))try{t.query.off("change",u)}catch(p){}r&&(r.remove(),r=null),u=null}}}}var TB=v(()=>{QS();mB();yB();vv();Fs()});var Tv={};st(Tv,{registerBasesTaskList:()=>B4,unregisterBasesViews:()=>U4});async function B4(n){if(!n.settings.enableBases||!(0,wB.requireApiVersion)("1.9.12"))return;let e=async()=>{var t,r;try{let s=(r=(t=n.app.internalPlugins).getEnabledPluginById)==null?void 0:r.call(t,"bases");return s!=null&&s.registrations?(s.registrations.tasknotesTaskList||(s.registrations.tasknotesTaskList={name:"TaskNotes Task List",icon:"tasknotes-simple",factory:uB(n)},console.log("[TaskNotes][Bases] Successfully registered tasknotesTaskList view")),s.registrations.tasknotesKanban||(s.registrations.tasknotesKanban={name:"TaskNotes Kanban",icon:"tasknotes-simple",factory:vB(n)},console.log("[TaskNotes][Bases] Successfully registered tasknotesKanban view")),n.app.workspace.iterateAllLeaves(i=>{var a,o;if(((o=(a=i.view)==null?void 0:a.getViewType)==null?void 0:o.call(a))==="bases"){let l=i.view;if(typeof l.refresh=="function")try{l.refresh()}catch(c){console.debug("[TaskNotes][Bases] Error refreshing view:",c)}}}),!0):(console.debug("[TaskNotes][Bases] Bases plugin not available for registration"),!1)}catch(s){return console.warn("[TaskNotes][Bases] Registration attempt failed:",s),!1}};if(await e()){console.log("[TaskNotes][Bases] Successfully registered views");return}for(let t=0;t<5;t++)if(await new Promise(r=>setTimeout(r,200)),await e()){console.log("[TaskNotes][Bases] Successfully registered views on retry");return}console.warn("[TaskNotes][Bases] Failed to register views after multiple attempts")}function U4(n){var e,t;try{let r=(t=(e=n.app.internalPlugins).getEnabledPluginById)==null?void 0:t.call(e,"bases");if(!(r!=null&&r.registrations)){console.log("[TaskNotes][Bases] Bases plugin not available for unregistration");return}r.registrations.tasknotesTaskList&&(delete r.registrations.tasknotesTaskList,console.log("[TaskNotes][Bases] Successfully unregistered tasknotesTaskList view")),r.registrations.tasknotesKanban&&(delete r.registrations.tasknotesKanban,console.log("[TaskNotes][Bases] Successfully unregistered tasknotesKanban view"))}catch(r){console.error("[TaskNotes][Bases] Error during view unregistration:",r)}}var wB,wv=v(()=>{wB=require("obsidian");hB();TB()});var kB=_p(()=>{var bB;(function(n){(function(e){var t=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:o(),r=s(n);typeof t.Reflect!="undefined"&&(r=s(t.Reflect,r)),e(r,t),typeof t.Reflect=="undefined"&&(t.Reflect=n);function s(l,c){return function(d,u){Object.defineProperty(l,d,{configurable:!0,writable:!0,value:u}),c&&c(d,u)}}function i(){try{return Function("return this;")()}catch(l){}}function a(){try{return(0,eval)("(function() { return this; })()")}catch(l){}}function o(){return i()||a()}})(function(e,t){var r=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",i=s&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",a=s&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",l={__proto__:[]}instanceof Array,c=!o&&!l,d={create:o?function(){return xv(Object.create(null))}:l?function(){return xv({__proto__:null})}:function(){return xv({})},has:c?function(_,L){return r.call(_,L)}:function(_,L){return L in _},get:c?function(_,L){return r.call(_,L)?_[L]:void 0}:function(_,L){return _[L]}},u=Object.getPrototypeOf(Function),f=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:JB(),h=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:eU(),p=typeof WeakMap=="function"?WeakMap:tU(),m=s?Symbol.for("@reflect-metadata:registry"):void 0,g=KB(),y=ZB(g);function T(_,L,W,G){if(z(W)){if(!Nn(_))throw new TypeError;if(!yd(L))throw new TypeError;return P(_,L)}else{if(!Nn(_))throw new TypeError;if(!ve(L))throw new TypeError;if(!ve(G)&&!z(G)&&!he(G))throw new TypeError;return he(G)&&(G=void 0),W=Yt(W),I(_,L,W,G)}}e("decorate",T);function w(_,L){function W(G,ge){if(!ve(G))throw new TypeError;if(!z(ge)&&!ra(ge))throw new TypeError;F(_,L,G,ge)}return W}e("metadata",w);function b(_,L,W,G){if(!ve(W))throw new TypeError;return z(G)||(G=Yt(G)),F(_,L,W,G)}e("defineMetadata",b);function E(_,L,W){if(!ve(L))throw new TypeError;return z(W)||(W=Yt(W)),A(_,L,W)}e("hasMetadata",E);function S(_,L,W){if(!ve(L))throw new TypeError;return z(W)||(W=Yt(W)),j(_,L,W)}e("hasOwnMetadata",S);function D(_,L,W){if(!ve(L))throw new TypeError;return z(W)||(W=Yt(W)),U(_,L,W)}e("getMetadata",D);function x(_,L,W){if(!ve(L))throw new TypeError;return z(W)||(W=Yt(W)),V(_,L,W)}e("getOwnMetadata",x);function M(_,L){if(!ve(_))throw new TypeError;return z(L)||(L=Yt(L)),$(_,L)}e("getMetadataKeys",M);function B(_,L){if(!ve(_))throw new TypeError;return z(L)||(L=Yt(L)),Z(_,L)}e("getOwnMetadataKeys",B);function Q(_,L,W){if(!ve(L))throw new TypeError;if(z(W)||(W=Yt(W)),!ve(L))throw new TypeError;z(W)||(W=Yt(W));var G=vd(L,W,!1);return z(G)?!1:G.OrdinaryDeleteMetadata(_,L,W)}e("deleteMetadata",Q);function P(_,L){for(var W=_.length-1;W>=0;--W){var G=_[W],ge=G(L);if(!z(ge)&&!he(ge)){if(!yd(ge))throw new TypeError;L=ge}}return L}function I(_,L,W,G){for(var ge=_.length-1;ge>=0;--ge){var Ot=_[ge],er=Ot(L,W,G);if(!z(er)&&!he(er)){if(!ve(er))throw new TypeError;G=er}}return G}function A(_,L,W){var G=j(_,L,W);if(G)return!0;var ge=Dv(L);return he(ge)?!1:A(_,ge,W)}function j(_,L,W){var G=vd(L,W,!1);return z(G)?!1:oe(G.OrdinaryHasOwnMetadata(_,L,W))}function U(_,L,W){var G=j(_,L,W);if(G)return V(_,L,W);var ge=Dv(L);if(!he(ge))return U(_,ge,W)}function V(_,L,W){var G=vd(L,W,!1);if(!z(G))return G.OrdinaryGetOwnMetadata(_,L,W)}function F(_,L,W,G){var ge=vd(W,G,!0);ge.OrdinaryDefineOwnMetadata(_,L,W,G)}function $(_,L){var W=Z(_,L),G=Dv(_);if(G===null)return W;var ge=$(G,L);if(ge.length<=0)return W;if(W.length<=0)return ge;for(var Ot=new h,er=[],Fe=0,J=W;Fe<J.length;Fe++){var ne=J[Fe],ae=Ot.has(ne);ae||(Ot.add(ne),er.push(ne))}for(var de=0,Be=ge;de<Be.length;de++){var ne=Be[de],ae=Ot.has(ne);ae||(Ot.add(ne),er.push(ne))}return er}function Z(_,L){var W=vd(_,L,!1);return W?W.OrdinaryOwnMetadataKeys(_,L):[]}function re(_){if(_===null)return 1;switch(typeof _){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return _===null?1:6;default:return 6}}function z(_){return _===void 0}function he(_){return _===null}function Ae(_){return typeof _=="symbol"}function ve(_){return typeof _=="object"?_!==null:typeof _=="function"}function Nt(_,L){switch(re(_)){case 0:return _;case 1:return _;case 2:return _;case 3:return _;case 4:return _;case 5:return _}var W=L===3?"string":L===5?"number":"default",G=Pp(_,i);if(G!==void 0){var ge=G.call(_,W);if(ve(ge))throw new TypeError;return ge}return ee(_,W==="default"?"number":W)}function ee(_,L){if(L==="string"){var W=_.toString;if(yn(W)){var G=W.call(_);if(!ve(G))return G}var ge=_.valueOf;if(yn(ge)){var G=ge.call(_);if(!ve(G))return G}}else{var ge=_.valueOf;if(yn(ge)){var G=ge.call(_);if(!ve(G))return G}var Ot=_.toString;if(yn(Ot)){var G=Ot.call(_);if(!ve(G))return G}}throw new TypeError}function oe(_){return!!_}function pt(_){return""+_}function Yt(_){var L=Nt(_,3);return Ae(L)?L:pt(L)}function Nn(_){return Array.isArray?Array.isArray(_):_ instanceof Object?_ instanceof Array:Object.prototype.toString.call(_)==="[object Array]"}function yn(_){return typeof _=="function"}function yd(_){return typeof _=="function"}function ra(_){switch(re(_)){case 3:return!0;case 4:return!0;default:return!1}}function Xa(_,L){return _===L||_!==_&&L!==L}function Pp(_,L){var W=_[L];if(W!=null){if(!yn(W))throw new TypeError;return W}}function cD(_){var L=Pp(_,a);if(!yn(L))throw new TypeError;var W=L.call(_);if(!ve(W))throw new TypeError;return W}function dD(_){return _.value}function uD(_){var L=_.next();return L.done?!1:L}function hD(_){var L=_.return;L&&L.call(_)}function Dv(_){var L=Object.getPrototypeOf(_);if(typeof _!="function"||_===u||L!==u)return L;var W=_.prototype,G=W&&Object.getPrototypeOf(W);if(G==null||G===Object.prototype)return L;var ge=G.constructor;return typeof ge!="function"||ge===_?L:ge}function QB(){var _;!z(m)&&typeof t.Reflect!="undefined"&&!(m in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(_=XB(t.Reflect));var L,W,G,ge=new p,Ot={registerProvider:er,getProvider:J,setProvider:ae};return Ot;function er(de){if(!Object.isExtensible(Ot))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case _===de:break;case z(L):L=de;break;case L===de:break;case z(W):W=de;break;case W===de:break;default:G===void 0&&(G=new h),G.add(de);break}}function Fe(de,Be){if(!z(L)){if(L.isProviderFor(de,Be))return L;if(!z(W)){if(W.isProviderFor(de,Be))return L;if(!z(G))for(var mt=cD(G);;){var Lt=uD(mt);if(!Lt)return;var vn=dD(Lt);if(vn.isProviderFor(de,Be))return hD(mt),vn}}}if(!z(_)&&_.isProviderFor(de,Be))return _}function J(de,Be){var mt=ge.get(de),Lt;return z(mt)||(Lt=mt.get(Be)),z(Lt)&&(Lt=Fe(de,Be),z(Lt)||(z(mt)&&(mt=new f,ge.set(de,mt)),mt.set(Be,Lt))),Lt}function ne(de){if(z(de))throw new TypeError;return L===de||W===de||!z(G)&&G.has(de)}function ae(de,Be,mt){if(!ne(mt))throw new Error("Metadata provider not registered.");var Lt=J(de,Be);if(Lt!==mt){if(!z(Lt))return!1;var vn=ge.get(de);z(vn)&&(vn=new f,ge.set(de,vn)),vn.set(Be,mt)}return!0}}function KB(){var _;return!z(m)&&ve(t.Reflect)&&Object.isExtensible(t.Reflect)&&(_=t.Reflect[m]),z(_)&&(_=QB()),!z(m)&&ve(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,m,{enumerable:!1,configurable:!1,writable:!1,value:_}),_}function ZB(_){var L=new p,W={isProviderFor:function(ne,ae){var de=L.get(ne);return z(de)?!1:de.has(ae)},OrdinaryDefineOwnMetadata:er,OrdinaryHasOwnMetadata:ge,OrdinaryGetOwnMetadata:Ot,OrdinaryOwnMetadataKeys:Fe,OrdinaryDeleteMetadata:J};return g.registerProvider(W),W;function G(ne,ae,de){var Be=L.get(ne),mt=!1;if(z(Be)){if(!de)return;Be=new f,L.set(ne,Be),mt=!0}var Lt=Be.get(ae);if(z(Lt)){if(!de)return;if(Lt=new f,Be.set(ae,Lt),!_.setProvider(ne,ae,W))throw Be.delete(ae),mt&&L.delete(ne),new Error("Wrong provider for target.")}return Lt}function ge(ne,ae,de){var Be=G(ae,de,!1);return z(Be)?!1:oe(Be.has(ne))}function Ot(ne,ae,de){var Be=G(ae,de,!1);if(!z(Be))return Be.get(ne)}function er(ne,ae,de,Be){var mt=G(de,Be,!0);mt.set(ne,ae)}function Fe(ne,ae){var de=[],Be=G(ne,ae,!1);if(z(Be))return de;for(var mt=Be.keys(),Lt=cD(mt),vn=0;;){var fD=uD(Lt);if(!fD)return de.length=vn,de;var rU=dD(fD);try{de[vn]=rU}catch(sU){try{hD(Lt)}finally{throw sU}}vn++}}function J(ne,ae,de){var Be=G(ae,de,!1);if(z(Be)||!Be.delete(ne))return!1;if(Be.size===0){var mt=L.get(ae);z(mt)||(mt.delete(de),mt.size===0&&L.delete(mt))}return!0}}function XB(_){var L=_.defineMetadata,W=_.hasOwnMetadata,G=_.getOwnMetadata,ge=_.getOwnMetadataKeys,Ot=_.deleteMetadata,er=new p,Fe={isProviderFor:function(J,ne){var ae=er.get(J);return!z(ae)&&ae.has(ne)?!0:ge(J,ne).length?(z(ae)&&(ae=new h,er.set(J,ae)),ae.add(ne),!0):!1},OrdinaryDefineOwnMetadata:L,OrdinaryHasOwnMetadata:W,OrdinaryGetOwnMetadata:G,OrdinaryOwnMetadataKeys:ge,OrdinaryDeleteMetadata:Ot};return Fe}function vd(_,L,W){var G=g.getProvider(_,L);if(!z(G))return G;if(W){if(g.setProvider(_,L,y))return y;throw new Error("Illegal state.")}}function JB(){var _={},L=[],W=(function(){function Fe(J,ne,ae){this._index=0,this._keys=J,this._values=ne,this._selector=ae}return Fe.prototype["@@iterator"]=function(){return this},Fe.prototype[a]=function(){return this},Fe.prototype.next=function(){var J=this._index;if(J>=0&&J<this._keys.length){var ne=this._selector(this._keys[J],this._values[J]);return J+1>=this._keys.length?(this._index=-1,this._keys=L,this._values=L):this._index++,{value:ne,done:!1}}return{value:void 0,done:!0}},Fe.prototype.throw=function(J){throw this._index>=0&&(this._index=-1,this._keys=L,this._values=L),J},Fe.prototype.return=function(J){return this._index>=0&&(this._index=-1,this._keys=L,this._values=L),{value:J,done:!0}},Fe})(),G=(function(){function Fe(){this._keys=[],this._values=[],this._cacheKey=_,this._cacheIndex=-2}return Object.defineProperty(Fe.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Fe.prototype.has=function(J){return this._find(J,!1)>=0},Fe.prototype.get=function(J){var ne=this._find(J,!1);return ne>=0?this._values[ne]:void 0},Fe.prototype.set=function(J,ne){var ae=this._find(J,!0);return this._values[ae]=ne,this},Fe.prototype.delete=function(J){var ne=this._find(J,!1);if(ne>=0){for(var ae=this._keys.length,de=ne+1;de<ae;de++)this._keys[de-1]=this._keys[de],this._values[de-1]=this._values[de];return this._keys.length--,this._values.length--,Xa(J,this._cacheKey)&&(this._cacheKey=_,this._cacheIndex=-2),!0}return!1},Fe.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=_,this._cacheIndex=-2},Fe.prototype.keys=function(){return new W(this._keys,this._values,ge)},Fe.prototype.values=function(){return new W(this._keys,this._values,Ot)},Fe.prototype.entries=function(){return new W(this._keys,this._values,er)},Fe.prototype["@@iterator"]=function(){return this.entries()},Fe.prototype[a]=function(){return this.entries()},Fe.prototype._find=function(J,ne){if(!Xa(this._cacheKey,J)){this._cacheIndex=-1;for(var ae=0;ae<this._keys.length;ae++)if(Xa(this._keys[ae],J)){this._cacheIndex=ae;break}}return this._cacheIndex<0&&ne&&(this._cacheIndex=this._keys.length,this._keys.push(J),this._values.push(void 0)),this._cacheIndex},Fe})();return G;function ge(Fe,J){return Fe}function Ot(Fe,J){return J}function er(Fe,J){return[Fe,J]}}function eU(){var _=(function(){function L(){this._map=new f}return Object.defineProperty(L.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),L.prototype.has=function(W){return this._map.has(W)},L.prototype.add=function(W){return this._map.set(W,W),this},L.prototype.delete=function(W){return this._map.delete(W)},L.prototype.clear=function(){this._map.clear()},L.prototype.keys=function(){return this._map.keys()},L.prototype.values=function(){return this._map.keys()},L.prototype.entries=function(){return this._map.entries()},L.prototype["@@iterator"]=function(){return this.keys()},L.prototype[a]=function(){return this.keys()},L})();return _}function tU(){var _=16,L=d.create(),W=G();return(function(){function J(){this._key=G()}return J.prototype.has=function(ne){var ae=ge(ne,!1);return ae!==void 0?d.has(ae,this._key):!1},J.prototype.get=function(ne){var ae=ge(ne,!1);return ae!==void 0?d.get(ae,this._key):void 0},J.prototype.set=function(ne,ae){var de=ge(ne,!0);return de[this._key]=ae,this},J.prototype.delete=function(ne){var ae=ge(ne,!1);return ae!==void 0?delete ae[this._key]:!1},J.prototype.clear=function(){this._key=G()},J})();function G(){var J;do J="@@WeakMap@@"+Fe();while(d.has(L,J));return L[J]=!0,J}function ge(J,ne){if(!r.call(J,W)){if(!ne)return;Object.defineProperty(J,W,{value:d.create()})}return J[W]}function Ot(J,ne){for(var ae=0;ae<ne;++ae)J[ae]=Math.random()*255|0;return J}function er(J){if(typeof Uint8Array=="function"){var ne=new Uint8Array(J);return typeof crypto!="undefined"?crypto.getRandomValues(ne):typeof msCrypto!="undefined"?msCrypto.getRandomValues(ne):Ot(ne,J),ne}return Ot(new Array(J),J)}function Fe(){var J=er(_);J[6]=J[6]&79|64,J[8]=J[8]&191|128;for(var ne="",ae=0;ae<_;++ae){var de=J[ae];(ae===4||ae===6||ae===8)&&(ne+="-"),de<16&&(ne+="0"),ne+=de.toString(16).toLowerCase()}return ne}}function xv(_){return _.__=void 0,delete _.__,_}})})(bB||(bB={}))});var SB={};st(SB,{Delete:()=>Sp,Get:()=>Vt,OpenAPI:()=>j4,OpenAPIController:()=>JS,Post:()=>$t,Put:()=>eD,Route:()=>Ep,generateOpenAPISpec:()=>tD,getOpenAPIOperation:()=>Y4,getRouteInfo:()=>$4,getRoutes:()=>bv,hasOpenAPIEndpoints:()=>z4});function JS(n){return Reflect.hasMetadata(pd,n)||Reflect.defineMetadata(pd,[],n),n}function Ep(n,e){return function(t,r,s){Reflect.defineMetadata(XS,{method:n.toLowerCase(),path:e,handler:r},t,r);let i=Reflect.getMetadata("routes",t.constructor)||[];i.push({method:n.toLowerCase(),path:e,handler:r}),Reflect.defineMetadata("routes",i,t.constructor)}}function Vt(n){return Ep("GET",n)}function $t(n){return Ep("POST",n)}function eD(n){return Ep("PUT",n)}function Sp(n){return Ep("DELETE",n)}function j4(n){return function(e,t,r){Reflect.defineMetadata(EB,n,e,t);let s=Reflect.getMetadata(pd,e.constructor)||[],i=Reflect.getMetadata(XS,e,t),{path:a,method:o}=i||W4(t);s.push({path:a,method:o,operation:n}),Reflect.defineMetadata(pd,s,e.constructor)}}function W4(n){return console.warn(`extractPathAndMethod is deprecated. Use @Route decorators on method: ${n}`),{path:"/api/unknown",method:"get"}}function tD(n){let e=Reflect.getMetadata(pd,n.constructor)||[],t=bv(n.constructor)||[],r={openapi:"3.0.0",info:{title:"TaskNotes API",version:"1.0.0",description:"RESTful API for managing tasks, time tracking, and automation in TaskNotes",contact:{name:"TaskNotes",url:"https://github.com/your-repo/tasknotes"}},servers:[{url:"http://localhost:8080",description:"Local development server"}],security:[{bearerAuth:[]}],paths:{},components:{securitySchemes:{bearerAuth:{type:"http",scheme:"bearer",bearerFormat:"JWT",description:"Optional bearer token for API authentication"}},schemas:V4()}};for(let s of e)r.paths[s.path]||(r.paths[s.path]={}),r.paths[s.path][s.method.toLowerCase()]=s.operation;for(let s of t)r.paths[s.path]||(r.paths[s.path]={}),r.paths[s.path][s.method.toLowerCase()]||(r.paths[s.path][s.method.toLowerCase()]={summary:`${s.method.toUpperCase()} ${s.path}`,description:`${s.method.toUpperCase()} endpoint for ${s.path}`,responses:{200:{description:"Success",content:{"application/json":{schema:{$ref:"#/components/schemas/APIResponse"}}}},400:{description:"Bad Request",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},500:{description:"Internal Server Error",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}}}});return r}function V4(){return{APIResponse:{type:"object",properties:{success:{type:"boolean",description:"Whether the request was successful"},data:{description:"Response data (varies by endpoint)"},error:{type:"string",description:"Error message (present when success is false)"},message:{type:"string",description:"Optional success message"}},required:["success"]},Task:{type:"object",properties:{id:{type:"string",description:"Unique task identifier (file path)"},title:{type:"string",description:"Task title",maxLength:200},status:{type:"string",description:"Current task status",enum:["todo","open","completed","in-progress","cancelled"]},priority:{type:"string",description:"Task priority level",enum:["low","normal","medium","high","urgent"]},due:{type:"string",format:"date-time",description:"Due date and time (ISO 8601 format)",nullable:!0},scheduled:{type:"string",format:"date-time",description:"Scheduled date and time (ISO 8601 format)",nullable:!0},path:{type:"string",description:"File path of the task"},archived:{type:"boolean",description:"Whether the task is archived"},tags:{type:"array",items:{type:"string"},description:"Task tags"},contexts:{type:"array",items:{type:"string"},description:"Task contexts (GTD-style)"},projects:{type:"array",items:{type:"string"},description:"Associated projects"},timeEstimate:{type:"integer",minimum:0,description:"Estimated time in minutes",nullable:!0},details:{type:"string",description:"Additional task details/description",nullable:!0},dateCreated:{type:"string",format:"date-time",description:"Task creation timestamp"},dateModified:{type:"string",format:"date-time",description:"Last modification timestamp"}},required:["id","title","status","path"]},TaskCreationData:{type:"object",properties:{title:{type:"string",description:"Task title",maxLength:200},status:{type:"string",description:"Initial task status",enum:["todo","open","in-progress"]},priority:{type:"string",description:"Task priority level",enum:["low","normal","medium","high","urgent"]},due:{type:"string",format:"date-time",description:"Due date and time (ISO 8601 format)"},scheduled:{type:"string",format:"date-time",description:"Scheduled date and time (ISO 8601 format)"},tags:{type:"array",items:{type:"string"},description:"Task tags"},contexts:{type:"array",items:{type:"string"},description:"Task contexts"},projects:{type:"array",items:{type:"string"},description:"Associated projects"},details:{type:"string",description:"Task details/description"},timeEstimate:{type:"integer",minimum:0,description:"Estimated time in minutes"}},required:["title"]},TaskStats:{type:"object",properties:{total:{type:"integer",description:"Total number of tasks"},completed:{type:"integer",description:"Number of completed tasks"},active:{type:"integer",description:"Number of active (non-completed, non-archived) tasks"},overdue:{type:"integer",description:"Number of overdue tasks"},archived:{type:"integer",description:"Number of archived tasks"},withTimeTracking:{type:"integer",description:"Number of tasks with time tracking entries"}},required:["total","completed","active","overdue","archived","withTimeTracking"]},WebhookConfig:{type:"object",properties:{id:{type:"string",description:"Unique webhook identifier"},url:{type:"string",format:"uri",description:"Webhook endpoint URL"},events:{type:"array",items:{type:"string",enum:["task.created","task.updated","task.deleted","task.completed","task.archived","task.unarchived","time.started","time.stopped","pomodoro.started","pomodoro.completed","pomodoro.interrupted","recurring.instance.completed","reminder.triggered"]},description:"Events to subscribe to",minItems:1},active:{type:"boolean",description:"Whether the webhook is active"},transformFile:{type:"string",description:"Optional transform file path for payload customization"},corsHeaders:{type:"boolean",description:"Whether to include custom headers (disable for strict CORS services)"}},required:["url","events"]},PomodoroSession:{type:"object",properties:{id:{type:"string",description:"Unique session identifier"},type:{type:"string",enum:["work","short-break","long-break"],description:"Type of pomodoro session"},duration:{type:"integer",description:"Session duration in seconds"},startTime:{type:"string",format:"date-time",description:"Session start timestamp"},endTime:{type:"string",format:"date-time",description:"Session end timestamp",nullable:!0},task:{$ref:"#/components/schemas/Task",nullable:!0,description:"Associated task (if any)"}},required:["id","type","duration","startTime"]},PomodoroState:{type:"object",properties:{isRunning:{type:"boolean",description:"Whether a pomodoro session is currently running"},timeRemaining:{type:"integer",description:"Time remaining in current session (seconds)"},currentSession:{$ref:"#/components/schemas/PomodoroSession",nullable:!0,description:"Current active session (if any)"},nextSessionType:{type:"string",enum:["work","short-break","long-break"],nullable:!0,description:"Suggested next session type"},totalPomodoros:{type:"integer",description:"Total completed pomodoros (all time)"},currentStreak:{type:"integer",description:"Current consecutive pomodoro streak"},totalMinutesToday:{type:"integer",description:"Total focused minutes today"}},required:["isRunning","timeRemaining"]},PomodoroSessionHistory:{type:"object",properties:{id:{type:"string",description:"Session identifier"},type:{type:"string",enum:["work","short-break","long-break"]},startTime:{type:"string",format:"date-time"},endTime:{type:"string",format:"date-time"},duration:{type:"integer",description:"Actual session duration in seconds"},completed:{type:"boolean",description:"Whether the session was completed (not interrupted)"},taskPath:{type:"string",nullable:!0,description:"Associated task file path"},taskTitle:{type:"string",nullable:!0,description:"Associated task title"}},required:["id","type","startTime","endTime","duration","completed"]},PomodoroStats:{type:"object",properties:{totalSessions:{type:"integer",description:"Total number of sessions"},completedSessions:{type:"integer",description:"Number of completed sessions"},interruptedSessions:{type:"integer",description:"Number of interrupted sessions"},totalFocusTime:{type:"integer",description:"Total focused time in minutes"},workSessions:{type:"integer",description:"Number of work sessions"},breakSessions:{type:"integer",description:"Number of break sessions"},longestStreak:{type:"integer",description:"Longest consecutive completed sessions"},averageSessionLength:{type:"number",description:"Average session length in minutes"}},required:["totalSessions","completedSessions","interruptedSessions","totalFocusTime"]},TimeEntry:{type:"object",properties:{startTime:{type:"string",format:"date-time",description:"ISO timestamp when time tracking started"},endTime:{type:"string",format:"date-time",nullable:!0,description:"ISO timestamp when time tracking ended (null if still running)"},description:{type:"string",nullable:!0,description:"Optional description of work being tracked"},duration:{type:"integer",minimum:0,description:"Duration in minutes (calculated or manually set)"},isActive:{type:"boolean",description:"Whether this time entry is currently active"}},required:["startTime","duration","isActive"]},ActiveTimeSession:{type:"object",properties:{task:{type:"object",properties:{id:{type:"string",description:"Task identifier (file path)"},title:{type:"string",description:"Task title"},status:{type:"string",description:"Task status"},priority:{type:"string",description:"Task priority"},tags:{type:"array",items:{type:"string"},description:"Task tags"},projects:{type:"array",items:{type:"string"},description:"Associated projects"}},required:["id","title","status"]},session:{type:"object",properties:{startTime:{type:"string",format:"date-time",description:"When the session started"},description:{type:"string",nullable:!0,description:"Session description"},elapsedMinutes:{type:"integer",minimum:0,description:"Minutes elapsed since session started"}},required:["startTime","elapsedMinutes"]},elapsedMinutes:{type:"integer",minimum:0,description:"Total elapsed minutes for this session"}},required:["task","session","elapsedMinutes"]},TimeSummary:{type:"object",properties:{period:{type:"string",enum:["today","week","month","all","custom"],description:"Time period for the summary"},dateRange:{type:"object",properties:{from:{type:"string",format:"date-time",description:"Start date of the summary period"},to:{type:"string",format:"date-time",description:"End date of the summary period"}},required:["from","to"]},summary:{type:"object",properties:{totalMinutes:{type:"integer",minimum:0,description:"Total tracked time in minutes"},totalHours:{type:"number",minimum:0,description:"Total tracked time in hours (rounded to 2 decimals)"},tasksWithTime:{type:"integer",minimum:0,description:"Number of tasks with time tracking data"},activeTasks:{type:"integer",minimum:0,description:"Number of tasks with active time tracking"},completedTasks:{type:"integer",minimum:0,description:"Number of completed tasks with time tracking"}},required:["totalMinutes","totalHours","tasksWithTime","activeTasks","completedTasks"]},topTasks:{type:"array",items:{type:"object",properties:{task:{type:"string",description:"Task identifier"},title:{type:"string",description:"Task title"},minutes:{type:"integer",minimum:0,description:"Total minutes tracked for this task"}},required:["task","title","minutes"]},description:"Top 10 tasks by time tracked"},topProjects:{type:"array",items:{type:"object",properties:{project:{type:"string",description:"Project name"},minutes:{type:"integer",minimum:0,description:"Total minutes tracked for this project"}},required:["project","minutes"]},description:"Top 10 projects by time tracked"},topTags:{type:"array",items:{type:"object",properties:{tag:{type:"string",description:"Tag name"},minutes:{type:"integer",minimum:0,description:"Total minutes tracked for this tag"}},required:["tag","minutes"]},description:"Top 10 tags by time tracked"}},required:["period","dateRange","summary","topTasks","topProjects","topTags"]},TaskTimeData:{type:"object",properties:{task:{type:"object",properties:{id:{type:"string",description:"Task identifier (file path)"},title:{type:"string",description:"Task title"},status:{type:"string",description:"Task status"},priority:{type:"string",description:"Task priority"}},required:["id","title","status"]},summary:{type:"object",properties:{totalMinutes:{type:"integer",minimum:0,description:"Total time tracked for this task in minutes"},totalHours:{type:"number",minimum:0,description:"Total time tracked for this task in hours"},totalSessions:{type:"integer",minimum:0,description:"Total number of time tracking sessions"},completedSessions:{type:"integer",minimum:0,description:"Number of completed sessions"},activeSessions:{type:"integer",minimum:0,maximum:1,description:"Number of active sessions (0 or 1)"},averageSessionMinutes:{type:"number",minimum:0,description:"Average session length in minutes"}},required:["totalMinutes","totalHours","totalSessions","completedSessions","activeSessions","averageSessionMinutes"]},activeSession:{type:"object",nullable:!0,properties:{startTime:{type:"string",format:"date-time",description:"When the active session started"},description:{type:"string",nullable:!0,description:"Description of the active session"},elapsedMinutes:{type:"integer",minimum:0,description:"Minutes elapsed since session started"}},required:["startTime","elapsedMinutes"]},timeEntries:{type:"array",items:{$ref:"#/components/schemas/TimeEntry"},description:"All time entries for this task"}},required:["task","summary","timeEntries"]},Error:{type:"object",properties:{success:{type:"boolean",enum:[!1]},error:{type:"string",description:"Error message describing what went wrong"}},required:["success","error"]}}}function $4(n,e){return Reflect.getMetadata(XS,n,e)}function bv(n){return Reflect.getMetadata("routes",n)||[]}function Y4(n,e){return Reflect.getMetadata(EB,n,e)}function z4(n){return(Reflect.getMetadata(pd,n)||[]).length>0}var IMe,EB,pd,XS,ea=v(()=>{IMe=Ee(kB()),EB=Symbol("openapi:operation"),pd=Symbol("openapi:endpoints"),XS=Symbol("route")});var DB,kv,xB=v(()=>{DB=require("url");ea();kv=class{constructor(){this.routes=[]}compilePattern(e){let t=[],r=e.replace(/:([a-zA-Z_][a-zA-Z0-9_]*)/g,(i,a)=>(t.push(a),"([^/]+)"));return{regex:new RegExp(`^${r}$`),paramNames:t}}register(e,t,r){let{regex:s,paramNames:i}=this.compilePattern(t);this.routes.push({method:e,pattern:t,handler:r,regex:s,paramNames:i})}get(e,t){this.register("GET",e,t)}post(e,t){this.register("POST",e,t)}put(e,t){this.register("PUT",e,t)}delete(e,t){this.register("DELETE",e,t)}options(e,t){this.register("OPTIONS",e,t)}async route(e,t){let s=(0,DB.parse)(e.url||"",!0).pathname||"",i=e.method;for(let a of this.routes)if(a.method===i){let o=s.match(a.regex);if(o){let l={};for(let c=0;c<a.paramNames.length;c++){let d=a.paramNames[c],u=o[c+1];u&&(l[d]=decodeURIComponent(u))}return await a.handler(e,t,l),!0}}return!1}registerController(e){let t=bv(e.constructor);for(let r of t){let s=e[r.handler];typeof s=="function"&&this.register(r.method.toUpperCase(),r.path,s.bind(e))}}getRoutes(){return this.routes}}});var mn,md=v(()=>{mn=class{sendResponse(e,t,r){e.statusCode=t,e.setHeader("Content-Type","application/json"),e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),e.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),e.end(JSON.stringify(r))}successResponse(e,t){return{success:!0,data:e,message:t}}errorResponse(e){return{success:!1,error:e}}async parseRequestBody(e){return new Promise((t,r)=>{let s="";e.on("data",i=>{s+=i.toString()}),e.on("end",()=>{try{t(s?JSON.parse(s):{})}catch(i){r(new Error("Invalid JSON"))}}),e.on("error",r)})}}});var CB,zr,MB=v(()=>{CB=require("url");md();ea();At();zr=class extends mn{constructor(t,r,s,i,a,o){super();this.plugin=t;this.taskService=r;this.filterService=s;this.cacheManager=i;this.statusManager=a;this.webhookNotifier=o}async getTasks(t,r){try{let i=(0,CB.parse)(t.url||"",!0).query;if(["status","priority","project","tag","overdue","completed","archived","due_before","due_after","sort"].some(p=>i[p])){this.sendResponse(r,400,this.errorResponse("For filtering tasks, please use POST /api/tasks/query which supports advanced filtering capabilities. GET /api/tasks is for basic listing only. See API documentation for details."));return}let l=await this.cacheManager.getAllTasks(),c=0,d=50;i.offset&&(c=parseInt(i.offset,10),(isNaN(c)||c<0)&&(c=0)),i.limit&&(d=parseInt(i.limit,10),(isNaN(d)||d<1)&&(d=50),d>200&&(d=200));let u=l.slice(c,c+d),f=this.plugin.app.vault.adapter,h=null;try{"basePath"in f&&typeof f.basePath=="string"?h=f.basePath:"path"in f&&typeof f.path=="string"&&(h=f.path)}catch(p){}this.sendResponse(r,200,this.successResponse({tasks:u,pagination:{total:l.length,offset:c,limit:d,hasMore:c+d<l.length},vault:{name:this.plugin.app.vault.getName(),path:h},note:"For filtering and advanced queries, use POST /api/tasks/query"}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async createTask(t,r){try{let s=await this.parseRequestBody(t);if(!s.title||!s.title.trim()){this.sendResponse(r,400,this.errorResponse("Title is required"));return}await this.applyTaskCreationDefaults(s);let i=await this.taskService.createTask(s);await this.webhookNotifier.triggerWebhook("task.created",{task:i.taskInfo}),this.sendResponse(r,201,this.successResponse(i.taskInfo))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async getTask(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}this.sendResponse(r,200,this.successResponse(a))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async updateTask(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.parseRequestBody(t),o=await this.cacheManager.getTaskInfo(i);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=await this.taskService.updateTask(o,a);await this.webhookNotifier.triggerWebhook("task.updated",{task:l,previous:o}),this.sendResponse(r,200,this.successResponse(l))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async deleteTask(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}await this.taskService.deleteTask(a),await this.webhookNotifier.triggerWebhook("task.deleted",{task:a}),this.sendResponse(r,200,this.successResponse({message:"Task deleted successfully"}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async toggleStatus(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let o=await this.taskService.toggleStatus(a),l=this.statusManager.isCompletedStatus(a.status),c=this.statusManager.isCompletedStatus(o.status);!l&&c?await this.webhookNotifier.triggerWebhook("task.completed",{task:o}):await this.webhookNotifier.triggerWebhook("task.updated",{task:o,previous:a}),this.sendResponse(r,200,this.successResponse(o))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async toggleArchive(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let o=await this.taskService.toggleArchive(a);o.archived?await this.webhookNotifier.triggerWebhook("task.archived",{task:o}):await this.webhookNotifier.triggerWebhook("task.unarchived",{task:o}),this.sendResponse(r,200,this.successResponse(o))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async completeRecurringInstance(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let{date:a}=await this.parseRequestBody(t),o=await this.cacheManager.getTaskInfo(i);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=a?new Date(a):void 0,c=await this.taskService.toggleRecurringTaskComplete(o,l);this.sendResponse(r,200,this.successResponse(c))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async queryTasks(t,r){try{let s=await this.parseRequestBody(t),i=await this.filterService.getGroupedTasks(s),a=[];for(let d of i.values())a.push(...d);let o=await this.cacheManager.getAllTasks(),l=this.plugin.app.vault.adapter,c=null;try{"basePath"in l&&typeof l.basePath=="string"?c=l.basePath:"path"in l&&typeof l.path=="string"&&(c=l.path)}catch(d){}this.sendResponse(r,200,this.successResponse({tasks:a,total:o.length,filtered:a.length,vault:{name:this.plugin.app.vault.getName(),path:c}}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async getFilterOptions(t,r){try{let s=await this.filterService.getFilterOptions();this.sendResponse(r,200,this.successResponse(s))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getStats(t,r){try{let s=await this.cacheManager.getAllTasks(),i={total:s.length,completed:s.filter(a=>this.statusManager.isCompletedStatus(a.status)).length,active:s.filter(a=>!this.statusManager.isCompletedStatus(a.status)&&!a.archived).length,overdue:s.filter(a=>this.statusManager.isCompletedStatus(a.status)||a.archived?!1:a.due&&new Date(a.due)<new Date).length,archived:s.filter(a=>a.archived).length,withTimeTracking:s.filter(a=>a.timeEntries&&a.timeEntries.length>0).length};this.sendResponse(r,200,this.successResponse(i))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async applyTaskCreationDefaults(t){let r=this.plugin.settings.taskCreationDefaults;if(!t.scheduled&&r.defaultScheduledDate!=="none"&&(t.scheduled=Qs(r.defaultScheduledDate)),!t.due&&r.defaultDueDate!=="none"&&(t.due=Qs(r.defaultDueDate)),!t.contexts&&r.defaultContexts&&(t.contexts=r.defaultContexts.split(",").map(s=>s.trim()).filter(s=>s)),!t.projects&&r.defaultProjects&&(t.projects=r.defaultProjects.split(",").map(s=>s.trim()).filter(s=>s)),!t.timeEstimate&&r.defaultTimeEstimate>0&&(t.timeEstimate=r.defaultTimeEstimate),!t.tags&&r.defaultTags&&(t.tags=r.defaultTags.split(",").map(s=>s.trim()).filter(s=>s)),!t.recurrence&&r.defaultRecurrence&&r.defaultRecurrence!=="none"&&(t.recurrence={frequency:r.defaultRecurrence}),!t.reminders&&r.defaultReminders&&r.defaultReminders.length>0){let{convertDefaultRemindersToReminders:s}=await Promise.resolve().then(()=>(lp(),op));t.reminders=s(r.defaultReminders)}}};Pe([Vt("/api/tasks")],zr.prototype,"getTasks",1),Pe([$t("/api/tasks")],zr.prototype,"createTask",1),Pe([Vt("/api/tasks/:id")],zr.prototype,"getTask",1),Pe([eD("/api/tasks/:id")],zr.prototype,"updateTask",1),Pe([Sp("/api/tasks/:id")],zr.prototype,"deleteTask",1),Pe([$t("/api/tasks/:id/toggle-status")],zr.prototype,"toggleStatus",1),Pe([$t("/api/tasks/:id/archive")],zr.prototype,"toggleArchive",1),Pe([$t("/api/tasks/:id/complete-instance")],zr.prototype,"completeRecurringInstance",1),Pe([$t("/api/tasks/query")],zr.prototype,"queryTasks",1),Pe([Vt("/api/filter-options")],zr.prototype,"getFilterOptions",1),Pe([Vt("/api/stats")],zr.prototype,"getStats",1)});var PB,pi,_B=v(()=>{PB=require("url");md();ea();pi=class extends mn{constructor(t,r,s,i,a){super();this.plugin=t;this.taskService=r;this.cacheManager=s;this.statusManager=i;this.webhookNotifier=a}async startTimeTracking(t,r,s){var i;try{let a=s==null?void 0:s.id;if(!a){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let o=await this.cacheManager.getTaskInfo(a);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=await this.taskService.startTimeTracking(o);await this.webhookNotifier.triggerWebhook("time.started",{task:l,session:(i=l.timeEntries)==null?void 0:i[l.timeEntries.length-1]}),this.sendResponse(r,200,this.successResponse(l))}catch(a){this.sendResponse(r,400,this.errorResponse(a.message))}}async stopTimeTracking(t,r,s){var i;try{let a=s==null?void 0:s.id;if(!a){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let o=await this.cacheManager.getTaskInfo(a);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=await this.taskService.stopTimeTracking(o);await this.webhookNotifier.triggerWebhook("time.stopped",{task:l,session:(i=l.timeEntries)==null?void 0:i[l.timeEntries.length-1]}),this.sendResponse(r,200,this.successResponse(l))}catch(a){this.sendResponse(r,400,this.errorResponse(a.message))}}async startTimeTrackingWithDescription(t,r,s){var i;try{let a=s==null?void 0:s.id;if(!a){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let o=await this.cacheManager.getTaskInfo(a);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let c=(await this.parseRequestBody(t)).description||"",d=await this.taskService.startTimeTracking(o);if(c&&d.timeEntries&&d.timeEntries.length>0){let u=d.timeEntries[d.timeEntries.length-1];u&&!u.endTime&&(u.description=c,await this.taskService.updateTask(d,{timeEntries:d.timeEntries}))}await this.webhookNotifier.triggerWebhook("time.started",{task:d,session:(i=d.timeEntries)==null?void 0:i[d.timeEntries.length-1]}),this.sendResponse(r,200,this.successResponse({task:d,message:c?`Time tracking started with description: ${c}`:"Time tracking started"}))}catch(a){this.sendResponse(r,400,this.errorResponse(a.message))}}async getActiveTimeSessions(t,r){try{let s=await this.cacheManager.getAllTasks(),i=[];for(let a of s){let o=this.plugin.getActiveTimeSession(a);if(o){let l=new Date(o.startTime),c=Math.floor((Date.now()-l.getTime())/(1e3*60));i.push({task:{id:a.path,title:a.title,status:a.status,priority:a.priority,tags:a.tags||[],projects:a.projects||[]},session:{startTime:o.startTime,description:o.description,elapsedMinutes:c},elapsedMinutes:c})}}this.sendResponse(r,200,this.successResponse({activeSessions:i,totalActiveSessions:i.length,totalElapsedMinutes:i.reduce((a,o)=>a+o.elapsedMinutes,0)}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getTimeSummary(t,r){try{let i=(0,PB.parse)(t.url||"",!0).query,a=await this.cacheManager.getAllTasks(),o=i.period||"today",l=i.from?new Date(i.from):null,c=i.to?new Date(i.to):null,d,u=new Date;switch(o){case"today":d=new Date,d.setHours(0,0,0,0);break;case"week":d=new Date,d.setDate(d.getDate()-d.getDay()),d.setHours(0,0,0,0);break;case"month":d=new Date,d.setDate(1),d.setHours(0,0,0,0);break;case"all":d=new Date(0);break;default:l?(d=l,c&&(u=c)):(d=new Date,d.setHours(0,0,0,0))}let f=0,h=0,p=0,m=[],g=new Map,y=new Map;for(let E of a){if(!E.timeEntries||E.timeEntries.length===0)continue;let S=0,D=!1;for(let x of E.timeEntries){let M=new Date(x.startTime),B=x.endTime?new Date(x.endTime):new Date;if(M>=d&&M<=u)if(x.duration)S+=x.duration;else if(x.endTime){let Q=B.getTime()-M.getTime();S+=Math.floor(Q/(1e3*60))}else{let Q=Math.floor((Date.now()-M.getTime())/6e4);S+=Q,D=!0}}if(S>0){if(f+=S,m.push({task:E.path,title:E.title,minutes:S}),D?p++:this.statusManager.isCompletedStatus(E.status)&&h++,E.projects)for(let x of E.projects){let M=g.get(x)||0;g.set(x,M+S)}if(E.tags)for(let x of E.tags){let M=y.get(x)||0;y.set(x,M+S)}}}m.sort((E,S)=>S.minutes-E.minutes);let T=m.slice(0,10),w=Array.from(g.entries()).sort((E,S)=>S[1]-E[1]).slice(0,10).map(([E,S])=>({project:E,minutes:S})),b=Array.from(y.entries()).sort((E,S)=>S[1]-E[1]).slice(0,10).map(([E,S])=>({tag:E,minutes:S}));this.sendResponse(r,200,this.successResponse({period:o,dateRange:{from:d.toISOString(),to:u.toISOString()},summary:{totalMinutes:f,totalHours:Math.round(f/60*100)/100,tasksWithTime:m.length,activeTasks:p,completedTasks:h},topTasks:T,topProjects:w,topTags:b}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getTaskTimeData(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let o=a.timeEntries||[],l=this.plugin.getActiveTimeSession(a),c=this.calculateTotalTimeSpent(o),d=o.filter(p=>p.endTime).length,u=l?1:0,f=o.filter(p=>p.endTime&&p.duration),h=f.length>0?Math.round(f.reduce((p,m)=>p+(m.duration||0),0)/f.length*100)/100:0;this.sendResponse(r,200,this.successResponse({task:{id:a.path,title:a.title,status:a.status,priority:a.priority},summary:{totalMinutes:c,totalHours:Math.round(c/60*100)/100,totalSessions:o.length,completedSessions:d,activeSessions:u,averageSessionMinutes:h},activeSession:l?{startTime:l.startTime,description:l.description,elapsedMinutes:Math.floor((Date.now()-new Date(l.startTime).getTime())/(1e3*60))}:null,timeEntries:o.map(p=>({startTime:p.startTime,endTime:p.endTime||null,description:p.description||null,duration:p.duration||(p.endTime?Math.floor((new Date(p.endTime).getTime()-new Date(p.startTime).getTime())/(1e3*60)):Math.floor((Date.now()-new Date(p.startTime).getTime())/(1e3*60))),isActive:!p.endTime}))}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}calculateTotalTimeSpent(t){return!t||t.length===0?0:t.reduce((r,s)=>{if(s.duration)return r+s.duration;if(s.endTime){let i=new Date(s.endTime).getTime()-new Date(s.startTime).getTime();return r+Math.floor(i/(1e3*60))}else{let i=Date.now()-new Date(s.startTime).getTime();return r+Math.floor(i/(1e3*60))}},0)}};Pe([$t("/api/tasks/:id/time/start")],pi.prototype,"startTimeTracking",1),Pe([$t("/api/tasks/:id/time/stop")],pi.prototype,"stopTimeTracking",1),Pe([$t("/api/tasks/:id/time/start-with-description")],pi.prototype,"startTimeTrackingWithDescription",1),Pe([Vt("/api/time/active")],pi.prototype,"getActiveTimeSessions",1),Pe([Vt("/api/time/summary")],pi.prototype,"getTimeSummary",1),Pe([Vt("/api/tasks/:id/time")],pi.prototype,"getTaskTimeData",1)});var rD,Rn,AB=v(()=>{rD=require("url");md();ea();Rn=class extends mn{constructor(t,r){super();this.plugin=t;this.cacheManager=r}async startPomodoro(t,r){try{let s=await this.parseRequestBody(t),i;if(s.taskId){let c=await this.cacheManager.getTaskInfo(s.taskId);if(!c){this.sendResponse(r,404,this.errorResponse("Task not found"));return}i=c}if(this.plugin.pomodoroService.getState().isRunning){this.sendResponse(r,400,this.errorResponse("Pomodoro session is already running. Stop or pause the current session first."));return}let o=s.duration?parseInt(s.duration):void 0;await this.plugin.pomodoroService.startPomodoro(i,o);let l=this.plugin.pomodoroService.getState();this.sendResponse(r,200,this.successResponse({session:l.currentSession,task:i||null,message:"Pomodoro session started"}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async stopPomodoro(t,r){try{if(!this.plugin.pomodoroService.getState().currentSession){this.sendResponse(r,400,this.errorResponse("No active pomodoro session to stop"));return}await this.plugin.pomodoroService.stopPomodoro(),this.sendResponse(r,200,this.successResponse({message:"Pomodoro session stopped and reset"}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async pausePomodoro(t,r){try{let s=this.plugin.pomodoroService.getState();if(!s.isRunning||!s.currentSession){this.sendResponse(r,400,this.errorResponse("No running pomodoro session to pause"));return}await this.plugin.pomodoroService.pausePomodoro();let i=this.plugin.pomodoroService.getState();this.sendResponse(r,200,this.successResponse({timeRemaining:i.timeRemaining,message:"Pomodoro session paused"}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async resumePomodoro(t,r){try{let s=this.plugin.pomodoroService.getState();if(s.isRunning){this.sendResponse(r,400,this.errorResponse("Pomodoro session is already running"));return}if(!s.currentSession){this.sendResponse(r,400,this.errorResponse("No paused session to resume"));return}await this.plugin.pomodoroService.resumePomodoro();let i=this.plugin.pomodoroService.getState();this.sendResponse(r,200,this.successResponse({timeRemaining:i.timeRemaining,message:"Pomodoro session resumed"}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async getPomodoroStatus(t,r){try{let i={...this.plugin.pomodoroService.getState(),totalPomodoros:await this.plugin.pomodoroService.getPomodorosCompleted(),currentStreak:await this.plugin.pomodoroService.getCurrentStreak(),totalMinutesToday:await this.plugin.pomodoroService.getTotalMinutesToday()};this.sendResponse(r,200,this.successResponse(i))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getPomodoroSessions(t,r){try{let i=(0,rD.parse)(t.url||"",!0).query,a=await this.plugin.pomodoroService.getSessionHistory();if(i.date&&typeof i.date=="string"){let l=i.date;a=a.filter(c=>new Date(c.startTime).toISOString().split("T")[0]===l)}let o=a.length;if(i.limit&&typeof i.limit=="string"){let l=parseInt(i.limit);l>0&&(a=a.slice(-l))}this.sendResponse(r,200,this.successResponse({sessions:a,total:o}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getPomodoroStats(t,r){try{let i=(0,rD.parse)(t.url||"",!0).query,a;if(i.date&&typeof i.date=="string"){let o=new Date(i.date);a=await this.plugin.pomodoroService.getStatsForDate(o)}else a=await this.plugin.pomodoroService.getTodayStats();this.sendResponse(r,200,this.successResponse(a))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}};Pe([$t("/api/pomodoro/start")],Rn.prototype,"startPomodoro",1),Pe([$t("/api/pomodoro/stop")],Rn.prototype,"stopPomodoro",1),Pe([$t("/api/pomodoro/pause")],Rn.prototype,"pausePomodoro",1),Pe([$t("/api/pomodoro/resume")],Rn.prototype,"resumePomodoro",1),Pe([Vt("/api/pomodoro/status")],Rn.prototype,"getPomodoroStatus",1),Pe([Vt("/api/pomodoro/sessions")],Rn.prototype,"getPomodoroSessions",1),Pe([Vt("/api/pomodoro/stats")],Rn.prototype,"getPomodoroStats",1)});var ta,IB=v(()=>{md();At();ea();ta=class extends mn{constructor(t,r,s,i,a){super();this.plugin=t;this.taskService=r;this.nlParser=s;this.webhookNotifier=i;this.httpAPIService=a}async healthCheck(t,r){let s=this.plugin.app.vault.getName(),i=this.plugin.app.vault.adapter,a=null;try{"basePath"in i&&typeof i.basePath=="string"?a=i.basePath:"path"in i&&typeof i.path=="string"&&(a=i.path)}catch(o){}this.sendResponse(r,200,this.successResponse({status:"ok",timestamp:new Date().toISOString(),vault:{name:s,path:a}}))}async handleNLPParse(t,r){try{let s=await this.parseRequestBody(t);if(!s.text||typeof s.text!="string"){this.sendResponse(r,400,this.errorResponse("Text field is required and must be a string"));return}let i=this.nlParser.parseInput(s.text),a={title:i.title,details:i.details,priority:i.priority,status:i.status||this.getDefaultStatus(),tags:i.tags,contexts:i.contexts,projects:i.projects,recurrence:i.recurrence,timeEstimate:i.estimate};i.dueDate&&(a.due=i.dueDate,i.dueTime&&(a.due=`${i.dueDate} ${i.dueTime}`)),i.scheduledDate&&(a.scheduled=i.scheduledDate,i.scheduledTime&&(a.scheduled=`${i.scheduledDate} ${i.scheduledTime}`)),this.sendResponse(r,200,this.successResponse({parsed:i,taskData:a}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async handleNLPCreate(t,r){try{let s=await this.parseRequestBody(t);if(!s.text||typeof s.text!="string"){this.sendResponse(r,400,this.errorResponse("Text field is required and must be a string"));return}let i=this.nlParser.parseInput(s.text),a={title:i.title,details:i.details,priority:i.priority,status:i.status||this.getDefaultStatus(),tags:i.tags,contexts:i.contexts,projects:i.projects,recurrence:i.recurrence,timeEstimate:i.estimate,creationContext:"api"};i.dueDate&&(a.due=i.dueDate,i.dueTime&&(a.due=`${i.dueDate} ${i.dueTime}`)),i.scheduledDate&&(a.scheduled=i.scheduledDate,i.scheduledTime&&(a.scheduled=`${i.scheduledDate} ${i.scheduledTime}`)),await this.applyTaskCreationDefaults(a);let o=await this.taskService.createTask(a);await this.webhookNotifier.triggerWebhook("task.created",{task:o.taskInfo,source:"nlp",originalText:s.text}),this.sendResponse(r,201,this.successResponse({task:o.taskInfo,parsed:i}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async handleOpenAPISpec(t,r){try{let s=this.httpAPIService&&this.httpAPIService.generateOpenAPISpec?this.httpAPIService.generateOpenAPISpec():tD(this);r.statusCode=200,r.setHeader("Content-Type","application/json"),r.setHeader("Access-Control-Allow-Origin","*"),r.end(JSON.stringify(s,null,2))}catch(s){console.error("OpenAPI spec generation error:",s),this.sendResponse(r,500,this.errorResponse("Failed to generate API specification"))}}async handleSwaggerUI(t,r){try{let s=this.generateSwaggerUIHTML();r.statusCode=200,r.setHeader("Content-Type","text/html"),r.setHeader("Access-Control-Allow-Origin","*"),r.end(s)}catch(s){console.error("Swagger UI generation error:",s),this.sendResponse(r,500,this.errorResponse("Failed to generate API documentation"))}}async applyTaskCreationDefaults(t){let r=this.plugin.settings.taskCreationDefaults;if(!t.scheduled&&r.defaultScheduledDate!=="none"&&(t.scheduled=Qs(r.defaultScheduledDate)),!t.due&&r.defaultDueDate!=="none"&&(t.due=Qs(r.defaultDueDate)),!t.contexts&&r.defaultContexts&&(t.contexts=r.defaultContexts.split(",").map(s=>s.trim()).filter(s=>s)),!t.projects&&r.defaultProjects&&(t.projects=r.defaultProjects.split(",").map(s=>s.trim()).filter(s=>s)),!t.timeEstimate&&r.defaultTimeEstimate>0&&(t.timeEstimate=r.defaultTimeEstimate),!t.tags&&r.defaultTags&&(t.tags=r.defaultTags.split(",").map(s=>s.trim()).filter(s=>s)),!t.recurrence&&r.defaultRecurrence&&r.defaultRecurrence!=="none"&&(t.recurrence={frequency:r.defaultRecurrence}),!t.reminders&&r.defaultReminders&&r.defaultReminders.length>0){let{convertDefaultRemindersToReminders:s}=await Promise.resolve().then(()=>(lp(),op));t.reminders=s(r.defaultReminders)}}getDefaultStatus(){let t=this.plugin.settings.customStatuses;return t&&t.length>0?[...t].sort((s,i)=>s.order-i.order)[0].value:"open"}generateSwaggerUIHTML(){return`<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TaskNotes API Documentation</title>
	<link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui.css" />
	<style>
		body { margin: 0; }
		.swagger-ui .topbar { display: none; }
		.swagger-ui .info .title { color: #663399; }
	</style>
</head>
<body>
	<div id="swagger-ui"></div>
	<script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"><\/script>
	<script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-standalone-preset.js"><\/script>
	<script>
		SwaggerUIBundle({
			url: 'http://localhost:${this.plugin.settings.apiPort}/api/docs',
			dom_id: '#swagger-ui',
			deepLinking: true,
			presets: [
				SwaggerUIBundle.presets.apis,
				SwaggerUIStandalonePreset
			],
			plugins: [
				SwaggerUIBundle.plugins.DownloadUrl
			],
			layout: "StandaloneLayout",
			tryItOutEnabled: true,
			displayRequestDuration: true,
			docExpansion: 'list',
			filter: true,
			validatorUrl: null
		});
	<\/script>
</body>
</html>`}};Pe([Vt("/api/health")],ta.prototype,"healthCheck",1),Pe([$t("/api/nlp/parse")],ta.prototype,"handleNLPParse",1),Pe([$t("/api/nlp/create")],ta.prototype,"handleNLPCreate",1),Pe([Vt("/api/docs")],ta.prototype,"handleOpenAPISpec",1),Pe([Vt("/api/docs/ui")],ta.prototype,"handleSwaggerUI",1)});var Ev,Ka,RB=v(()=>{md();Ev=require("crypto");ea();Ka=class extends mn{constructor(t){super();this.plugin=t;this.webhooks=new Map;this.webhookDeliveryQueue=[];this.loadWebhooks()}async registerWebhook(t,r){try{let s=await this.parseRequestBody(t);if(!s.url||typeof s.url!="string"){this.sendResponse(r,400,this.errorResponse("URL is required and must be a string"));return}if(!s.events||!Array.isArray(s.events)||s.events.length===0){this.sendResponse(r,400,this.errorResponse("Events array is required and must not be empty"));return}let i=s.id||this.generateWebhookId(),a=s.secret||this.generateWebhookSecret(),o={id:i,url:s.url,events:s.events,secret:a,active:s.active!==!1,createdAt:new Date().toISOString(),failureCount:0,successCount:0,transformFile:s.transformFile||void 0,corsHeaders:s.corsHeaders!==!1};this.webhooks.set(i,o),await this.saveWebhooks(),this.sendResponse(r,201,this.successResponse({webhook:o,message:"Webhook registered successfully. Save the secret for signature validation."}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async listWebhooks(t,r){try{let s=Array.from(this.webhooks.values()).map(i=>({...i,secret:void 0}));this.sendResponse(r,200,this.successResponse({webhooks:s,total:s.length}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async deleteWebhook(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Webhook ID is required"));return}if(!this.webhooks.has(i)){this.sendResponse(r,404,this.errorResponse("Webhook not found"));return}this.webhooks.delete(i),await this.saveWebhooks(),this.sendResponse(r,200,this.successResponse({message:"Webhook deleted successfully"}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async getWebhookDeliveries(t,r){try{let s=this.webhookDeliveryQueue.slice(-100);this.sendResponse(r,200,this.successResponse({deliveries:s,total:s.length}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async triggerWebhook(t,r){setImmediate(()=>{this.processWebhookTrigger(t,r).catch(s=>{console.error("Webhook processing error:",s)})})}async processWebhookTrigger(t,r){let s=Array.from(this.webhooks.values()).filter(l=>l.active&&l.events.includes(t));if(s.length===0)return;let i=this.plugin.app.vault.adapter,a=null;try{"basePath"in i&&typeof i.basePath=="string"?a=i.basePath:"path"in i&&typeof i.path=="string"&&(a=i.path)}catch(l){}let o={event:t,timestamp:new Date().toISOString(),vault:{name:this.plugin.app.vault.getName(),path:a},data:r};for(let l of s){let c=o;if(l.transformFile)try{c=await this.applyTransformation(l.transformFile,o)}catch(u){console.error(`Transform error for ${l.transformFile}:`,u)}let d={id:this.generateDeliveryId(),webhookId:l.id,event:t,payload:c,status:"pending",attempts:0};this.webhookDeliveryQueue.push(d),this.deliverWebhook(l,d)}this.webhookDeliveryQueue.length>100&&(this.webhookDeliveryQueue=this.webhookDeliveryQueue.slice(-100))}async deliverWebhook(t,r,s=0){try{r.attempts++,r.lastAttempt=new Date().toISOString();let a=this.generateSignature(r.payload,t.secret),o={"Content-Type":"application/json"};t.corsHeaders!==!1&&(o["X-TaskNotes-Event"]=r.event,o["X-TaskNotes-Signature"]=a,o["X-TaskNotes-Delivery-ID"]=r.id);let l=await fetch(t.url,{method:"POST",headers:o,body:JSON.stringify(r.payload)});if(r.responseStatus=l.status,l.ok)r.status="success",t.successCount++,t.lastTriggered=new Date().toISOString();else throw new Error(`HTTP ${l.status}: ${l.statusText}`)}catch(a){if(r.error=a.message,t.failureCount++,s<3){let o=Math.pow(2,s)*1e3;setTimeout(()=>{this.deliverWebhook(t,r,s+1)},o)}else r.status="failed",t.failureCount>10&&(t.active=!1,console.warn(`Webhook ${t.id} disabled after ${t.failureCount} failures`))}await this.saveWebhooks()}generateSignature(t,r){let s=(0,Ev.createHmac)("sha256",r);return s.update(JSON.stringify(t)),s.digest("hex")}generateWebhookId(){return`wh_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}generateWebhookSecret(){return(0,Ev.createHash)("sha256").update(Date.now().toString()+Math.random().toString()).digest("hex")}generateDeliveryId(){return`del_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}async saveWebhooks(){let t=Array.from(this.webhooks.values());this.plugin.settings.webhooks=t,await this.plugin.saveSettings()}loadWebhooks(){if(this.plugin.settings.webhooks){this.webhooks.clear();for(let t of this.plugin.settings.webhooks)this.webhooks.set(t.id,t)}}async applyTransformation(t,r){try{return t.endsWith(".js")?await this.applyJSTransformation(t,r):t.endsWith(".json")?await this.applyJSONTransformation(t,r):r}catch(s){throw console.error(`Transformation failed for ${t}:`,s),s}}async applyJSTransformation(t,r){try{let s=await this.plugin.app.vault.adapter.read(t);return new Function("payload",`
				${s}
				if (typeof transform === 'function') {
					return transform(payload);
				} else {
					throw new Error('Transform file must export a transform function');
				}
			`)(r)}catch(s){throw console.error("JS transformation error:",s),s}}async applyJSONTransformation(t,r){try{let s=await this.plugin.app.vault.adapter.read(t),i=JSON.parse(s),a=i[r.event]||i.default;if(!a)throw new Error(`No template found for event ${r.event} and no default template`);return this.interpolateTemplate(a,r)}catch(s){throw console.error("JSON transformation error:",s),s}}interpolateTemplate(t,r){if(typeof t=="string")return t.replace(/\$\{([^}]+)\}/g,(s,i)=>this.getNestedValue(r,i)||s);if(Array.isArray(t))return t.map(s=>this.interpolateTemplate(s,r));if(t&&typeof t=="object"){let s={};for(let[i,a]of Object.entries(t))s[i]=this.interpolateTemplate(a,r);return s}else return t}getNestedValue(t,r){return r.split(".").reduce((s,i)=>s&&s[i]!==void 0?s[i]:void 0,t)}};Pe([$t("/api/webhooks")],Ka.prototype,"registerWebhook",1),Pe([Vt("/api/webhooks")],Ka.prototype,"listWebhooks",1),Pe([Sp("/api/webhooks/:id")],Ka.prototype,"deleteWebhook",1),Pe([Vt("/api/webhooks/deliveries")],Ka.prototype,"getWebhookDeliveries",1)});var LB={};st(LB,{HTTPAPIService:()=>Dp});var NB,OB,Dp,FB=v(()=>{NB=require("http"),OB=require("url");ip();IS();ea();xB();MB();_B();AB();IB();RB();Dp=class{constructor(e,t,r,s){this.plugin=e;let i=new ai(e.settings.customStatuses,e.settings.customPriorities,e.settings.nlpDefaultToScheduled,e.settings.nlpLanguage),a=new od(e.settings.customStatuses);this.webhookController=new Ka(e),this.tasksController=new zr(e,t,r,s,a,this.webhookController),this.timeTrackingController=new pi(e,t,s,a,this.webhookController),this.pomodoroController=new Rn(e,s),this.systemController=new ta(e,t,i,this.webhookController,this),this.router=new kv,this.setupRoutes()}setupRoutes(){this.router.registerController(this.tasksController),this.router.registerController(this.timeTrackingController),this.router.registerController(this.pomodoroController),this.router.registerController(this.systemController),this.router.registerController(this.webhookController)}generateOpenAPISpec(){let{generateOpenAPISpec:e}=(ea(),Td(SB)),t=e(this.systemController),r=[this.tasksController,this.timeTrackingController,this.pomodoroController,this.systemController,this.webhookController];t.paths={};for(let s of r){let i=e(s);i.paths&&(t.paths={...t.paths,...i.paths})}return t.servers=[{url:`http://localhost:${this.plugin.settings.apiPort}`,description:"TaskNotes API Server"}],t}async handleCORSPreflight(e,t){t.statusCode=200,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),t.end()}authenticate(e){let t=this.plugin.settings.apiAuthToken;if(!t)return!0;let r=e.headers.authorization;return!r||!r.startsWith("Bearer ")?!1:r.substring(7)===t}sendResponse(e,t,r){e.statusCode=t,e.setHeader("Content-Type","application/json"),e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),e.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),e.end(JSON.stringify(r))}successResponse(e,t){return{success:!0,data:e,message:t}}errorResponse(e){return{success:!1,error:e}}async handleRequest(e,t){try{if(e.method==="OPTIONS"){await this.handleCORSPreflight(e,t);return}if(((0,OB.parse)(e.url||"",!0).pathname||"").startsWith("/api/")&&!this.authenticate(e)){this.sendResponse(t,401,this.errorResponse("Authentication required"));return}await this.router.route(e,t)||this.sendResponse(t,404,this.errorResponse("Not found"))}catch(r){console.error("API Error:",r),this.sendResponse(t,500,this.errorResponse("Internal server error"))}}async triggerWebhook(e,t){await this.webhookController.triggerWebhook(e,t)}async start(){return new Promise((e,t)=>{try{this.server=(0,NB.createServer)((r,s)=>{this.handleRequest(r,s).catch(i=>{console.error("Request handling error:",i),this.sendResponse(s,500,this.errorResponse("Internal server error"))})}),this.server.listen(this.plugin.settings.apiPort,()=>{console.log(`TaskNotes API server started on port ${this.plugin.settings.apiPort}`),e()}),this.server.on("error",r=>{console.error("API server error:",r),t(r)})}catch(r){t(r)}})}async stop(){return new Promise(e=>{this.server?this.server.close(()=>{console.log("TaskNotes API server stopped"),e()}):e()})}isRunning(){return!!this.server&&this.server.listening}getPort(){return this.plugin.settings.apiPort}};Dp=Pe([JS],Dp)});var qr,sD=v(()=>{Ne();qr=class{static parseTaskLine(e){if(typeof e!="string")return{isTaskLine:!1,originalText:"",error:"Invalid input: line must be a string"};if(e.length>2e3)return{isTaskLine:!1,originalText:e,error:"Line too long to process safely"};let r=e.trim().match(this.CHECKBOX_PATTERN);if(!r)return{isTaskLine:!1,originalText:e};try{let[,,s,,i]=r;if(typeof s!="string"||typeof i!="string")return{isTaskLine:!0,originalText:e,error:"Invalid checkbox format"};let a=s.toLowerCase()==="x",o=this.parseTaskContent(i,a);return!o||!o.title||o.title.trim().length===0?{isTaskLine:!0,originalText:e,error:"Task must have a title"}:{isTaskLine:!0,originalText:e,parsedData:o}}catch(s){return{isTaskLine:!0,originalText:e,error:`Failed to parse task: ${s instanceof Error?s.message:"Unknown error"}`}}}static parseTaskContent(e,t){if(typeof e!="string")throw new Error("Content must be a string");if(e.length>1e3)throw new Error("Content too long to process safely");let r=e;try{let s=this.extractDate(r,this.EMOJI_PATTERNS.DUE_DATE),i=this.extractDate(r,this.EMOJI_PATTERNS.SCHEDULED_DATE),a=this.extractDate(r,this.EMOJI_PATTERNS.START_DATE),o=this.extractDate(r,this.EMOJI_PATTERNS.CREATED_DATE),l=this.extractDate(r,this.EMOJI_PATTERNS.DONE_DATE),c=this.extractPriority(r),{recurrence:d,recurrenceData:u}=this.extractRecurrence(r),f=this.extractTags(r),h=this.extractCleanTitle(r);if(!h||h.trim().length===0)throw new Error("Title cannot be empty after parsing");let p;if(t||l)p="done";else if(a)try{!Ul(a)&&!oa(a)?p="scheduled":p="open"}catch(m){}return{title:h.trim(),status:p,priority:c,dueDate:s,scheduledDate:i,startDate:a,createdDate:o,doneDate:l,recurrence:d,recurrenceData:u,tags:f.length>0?f:void 0,projects:void 0,isCompleted:t}}catch(s){throw new Error(`Failed to parse task content: ${s instanceof Error?s.message:"Unknown error"}`)}}static extractDate(e,t){if(!(typeof e!="string"||!t))try{let s=new RegExp(t.source,"g").exec(e);if(s&&s[1]){let i=s[1].trim();if(!/^\d{4}-\d{2}-\d{2}$/.test(i))return;try{let a=qe(i);if(isNaN(a.getTime()))return;let o=a.getUTCFullYear();return o<1900||o>2100?void 0:ue(a)}catch(a){return}}}catch(r){console.debug("Error extracting date:",r)}}static extractPriority(e){if(new RegExp(this.EMOJI_PATTERNS.HIGH_PRIORITY.source).test(e))return"high";if(new RegExp(this.EMOJI_PATTERNS.MEDIUM_PRIORITY.source).test(e))return"medium";if(new RegExp(this.EMOJI_PATTERNS.LOW_PRIORITY.source).test(e))return"low"}static extractRecurrence(e){let r=new RegExp(this.EMOJI_PATTERNS.RECURRENCE.source,"g").exec(e);if(!r||!r[1])return{};let s=r[1].trim();if(s.includes("every day"))return{recurrence:"daily",recurrenceData:{frequency:"daily"}};if(s.includes("every week"))return{recurrence:"weekly",recurrenceData:{frequency:"weekly"}};if(s.includes("every month"))return{recurrence:"monthly",recurrenceData:{frequency:"monthly"}};if(s.includes("every year"))return{recurrence:"yearly",recurrenceData:{frequency:"yearly"}};let i=s.match(/every\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)/i);return i?{recurrence:"weekly",recurrenceData:{frequency:"weekly",days_of_week:[i[1].toLowerCase().substring(0,3)]}}:{recurrence:"custom",recurrenceData:{frequency:"custom",raw:s}}}static extractTags(e){if(typeof e!="string")return[];try{let t=new RegExp(this.TAG_PATTERN.source,"g"),r=[],s;for(;(s=t.exec(e))!==null;)if(s[0]){let i=s[0].substring(1);i&&!r.includes(i)&&r.push(i)}return r}catch(t){return console.debug("Error extracting tags:",t),[]}}static extractCleanTitle(e){if(typeof e!="string")return"";try{let t=e;Object.values(this.EMOJI_PATTERNS).forEach(s=>{try{let i=new RegExp(s.source,"g");t=t.replace(i,"")}catch(i){console.debug("Error applying emoji pattern:",i)}});try{let s=new RegExp(this.TAG_PATTERN.source,"g");t=t.replace(s,"")}catch(s){console.debug("Error removing tags from title:",s)}let r=t.replace(/\s+/g," ").trim();return r.length===0?"Untitled Task":r}catch(t){return console.debug("Error extracting clean title:",t),"Untitled Task"}}static isTasksPluginFormat(e){if(typeof e!="string"||e.length>1e3)return!1;try{let t=e.trim();return this.CHECKBOX_PATTERN.test(t)?Object.values(this.EMOJI_PATTERNS).some(i=>{try{return new RegExp(i.source).test(t)}catch(a){return!1}}):!1}catch(t){return console.debug("Error validating Tasks plugin format:",t),!1}}static getSummary(e){let t=[];return t.push(`Title: "${e.title}"`),t.push(`Status: ${e.status}`),t.push(`Priority: ${e.priority}`),e.dueDate&&t.push(`Due: ${e.dueDate}`),e.startDate&&t.push(`Start: ${e.startDate}`),e.scheduledDate&&t.push(`Scheduled: ${e.scheduledDate}`),e.createdDate&&t.push(`Created: ${e.createdDate}`),e.doneDate&&t.push(`Done: ${e.doneDate}`),e.recurrence&&t.push(`Recurrence: ${e.recurrence}`),e.tags&&e.tags.length>0&&t.push(`Tags: ${e.tags.map(r=>"#"+r).join(", ")}`),e.projects&&e.projects.length>0&&t.push(`Projects: ${e.projects.map(r=>r.includes(" ")?`+[[${r}]]`:`+${r}`).join(", ")}`),t.join(" | ")}};qr.EMOJI_PATTERNS={DUE_DATE:/📅\s*(\d{4}-\d{2}-\d{2})/g,SCHEDULED_DATE:/⏳\s*(\d{4}-\d{2}-\d{2})/g,START_DATE:/🛫\s*(\d{4}-\d{2}-\d{2})/g,CREATED_DATE:/➕\s*(\d{4}-\d{2}-\d{2})/g,DONE_DATE:/✅\s*(\d{4}-\d{2}-\d{2})/g,HIGH_PRIORITY:/⏫/g,MEDIUM_PRIORITY:/🔼/g,LOW_PRIORITY:/⏬/g,RECURRENCE:/🔁\s*([^📅⏳🛫➕✅⏫🔼⏬🔁#]+?)(?=\s*[📅⏳🛫➕✅⏫🔼⏬🔁#]|$)/gu},qr.TAG_PATTERN=/#[\w/]+/g,qr.CHECKBOX_PATTERN=/^(\s*(?:[-*+]|\d+\.)\s+\[)([ xX])(\]\s+)(.*)/});var HB={};st(HB,{InstantTaskConvertService:()=>nD});var Gr,nD,BB=v(()=>{Gr=require("obsidian");sD();ip();Ne();At();qy();Al();nD=class{constructor(e,t,r){this.plugin=e,this.statusManager=t,this.priorityManager=r,this.nlParser=new ai(e.settings.customStatuses,e.settings.customPriorities,e.settings.nlpDefaultToScheduled,e.settings.nlpLanguage)}async batchConvertAllTasks(e){try{let t=this.findAllCheckboxTasks(e);if(t.length===0){new Gr.Notice("No checkbox tasks found in the current note.");return}new Gr.Notice(`Converting ${t.length} task${t.length===1?"":"s"}...`);let r=await this.batchConvertTasksOptimized(e,t);if(r.failures.length===0)new Gr.Notice(`\u2705 Successfully converted ${r.successCount} task${r.successCount===1?"":"s"} to TaskNotes!`);else{let s=`Converted ${r.successCount} task${r.successCount===1?"":"s"}.`;r.failures.length>0&&(s+=` ${r.failures.length} failed.`),new Gr.Notice(s),console.warn("Batch conversion failures:",r.failures)}}catch(t){console.error("Error during batch task conversion:",t),new Gr.Notice("Failed to perform batch conversion. Please try again.")}}async batchConvertTasksOptimized(e,t){let r=[],s=[],i=t.map(async o=>{try{let l=await this.parseTaskForBatch(o.line);if(!l)throw new Error("Failed to parse task");let c=await this.createTaskFile(l),d=this.generateLinkText(o.line,c);return{lineNumber:o.lineNumber,line:o.line,file:c,linkText:d}}catch(l){return r.push({lineNumber:o.lineNumber+1,error:l instanceof Error?l.message:String(l)}),null}}),a=await Promise.all(i);for(let o of a)o&&s.push(o);return s.length>0&&this.replaceAllTaskLines(e,s),{successCount:s.length,failures:r}}async instantConvertTask(e,t){try{let r=this.validateInputParameters(e,t);if(!r.isValid){new Gr.Notice(r.error||"Invalid input parameters.");return}let s=this.extractSelectionInfo(e,t),i=s.taskLine,a=s.details,o,l=qr.parseTaskLine(i);if(l.isTaskLine){if(l.error||!l.parsedData){new Gr.Notice(`Error parsing task: ${l.error||"No data extracted"}`);return}if(!this.hasUsefulMetadata(l.parsedData)&&this.plugin.settings.enableNaturalLanguageInput){let m=this.tryNLPFallback(i,a||"");m?o=m:o=l.parsedData}else o=l.parsedData}else{let p=this.extractLineContentAsTitle(i);if(!p.trim()){new Gr.Notice("Current line is empty or contains no valid content.");return}if(this.plugin.settings.enableNaturalLanguageInput){let m=this.tryNLPFallback(p,a||"");m?o=m:o={title:p,isCompleted:!1}}else o={title:p,isCompleted:!1}}let c=this.validateTaskData(o);if(!c.isValid){new Gr.Notice(c.error||"Invalid task data.");return}let d=await this.createTaskFile(o,a),u=await this.replaceOriginalTaskLines(e,s,d,o.title);if(!u.success){new Gr.Notice(u.error||"Failed to replace task line.");try{await this.plugin.app.vault.delete(d)}catch(p){console.warn("Failed to clean up created file after replacement failure:",p)}return}let f=this.sanitizeTitle(o.title),h=d.basename;h.startsWith("task-")&&h!==f?new Gr.Notice(`Task converted: "${o.title}" (filename shortened due to length)`):new Gr.Notice(`Task converted: ${o.title}`),await this.refreshTaskLinkOverlays(e,d)}catch(r){console.error("Error during instant task conversion:",r),r.message.includes("file already exists")?new Gr.Notice("A file with this name already exists. Please try again or rename the task."):new Gr.Notice("Failed to convert task. Please try again.")}}extractSelectionInfo(e,t){let r=e.getSelection();if(r&&r.trim()){let i=e.listSelections()[0],a=Math.min(i.anchor.line,i.head.line),o=Math.max(i.anchor.line,i.head.line);if(t>=a&&t<=o){let l=[];for(let f=a;f<=o;f++)l.push(e.getLine(f));let c=l[0],u=l.slice(1).join(`
`).trimEnd();return{taskLine:c,details:u,startLine:a,endLine:o,originalContent:l}}}let s=e.getLine(t);return{taskLine:s,details:"",startLine:t,endLine:t,originalContent:[s]}}validateInputParameters(e,t){if(!e)return{isValid:!1,error:"Editor is not available."};let r=e.lineCount();if(t<0||t>=r)return{isValid:!1,error:`Line number ${t} is out of bounds (0-${r-1}).`};let s=e.getLine(t);return s==null?{isValid:!1,error:`Cannot read line ${t}.`}:{isValid:!0}}validateTaskData(e){if(!e.title||e.title.trim().length===0)return{isValid:!1,error:"Task title cannot be empty."};let t=["dueDate","scheduledDate","startDate","createdDate","doneDate"];for(let r of t){let s=e[r];if(s&&!this.isValidDateFormat(s))return{isValid:!1,error:`Invalid date format in ${r}: ${s}`}}return{isValid:!0}}isValidDateFormat(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;try{let r=qe(e);return ue(r)===e}catch(r){return!1}}async createTaskFile(e,t=""){var B,Q;let r=this.sanitizeTitle(e.title)||"Untitled Task",s=this.plugin.app.workspace.getActiveFile(),i=s?this.plugin.app.fileManager.generateMarkdownLink(s,s.path):"",a=this.sanitizeDate(e.dueDate),o=this.sanitizeDate(e.scheduledDate),l=((B=e.dueTime)==null?void 0:B.trim())||void 0,c=((Q=e.scheduledTime)==null?void 0:Q.trim())||void 0,d,u,f,h,p=[],m=[this.plugin.settings.taskTag],g,y,T=e.tags||[],w=e.contexts||[],b=e.projects||[];if(this.plugin.settings.useDefaultsOnInstantConvert){let P=this.plugin.settings.taskCreationDefaults;if(d=(e.priority?this.sanitizePriority(e.priority):"")||this.plugin.settings.defaultTaskPriority,u=(e.status?this.sanitizeStatus(e.status):"")||this.plugin.settings.defaultTaskStatus,a?f=l?Ur(a,l):a:P.defaultDueDate!=="none"&&(f=Qs(P.defaultDueDate)),o?h=c?Ur(o,c):o:P.defaultScheduledDate!=="none"&&(h=Qs(P.defaultScheduledDate)),p=[],w.length>0&&p.push(...w),P.defaultContexts){let I=P.defaultContexts.split(",").map(A=>A.trim()).filter(A=>A);p.push(...I)}if(p=[...new Set(p)],m=[this.plugin.settings.taskTag],T.length>0&&m.push(...T),P.defaultTags){let I=P.defaultTags.split(",").map(A=>A.trim()).filter(A=>A);m.push(...I)}m=[...new Set(m)],P.defaultTimeEstimate&&P.defaultTimeEstimate>0&&(g=P.defaultTimeEstimate),P.defaultRecurrence&&P.defaultRecurrence!=="none"&&(y={frequency:P.defaultRecurrence})}else d=(e.priority?this.sanitizePriority(e.priority):"")||"none",u=(e.status?this.sanitizeStatus(e.status):"")||"none",f=a?l?Ur(a,l):a:void 0,h=o?c?Ur(o,c):o:void 0,p=[],w.length>0&&p.push(...w),m=[this.plugin.settings.taskTag],T.length>0&&m.push(...T),m=[...new Set(m)];let E=[];if(this.plugin.settings.useDefaultsOnInstantConvert){let P=this.plugin.settings.taskCreationDefaults;if(P.defaultProjects){let I=bn(P.defaultProjects);E.push(...I)}P.useParentNoteAsProject&&s&&E.push(i)}b.length>0&&E.push(...b);let S=[...new Set(E)],D;if(this.plugin.settings.useDefaultsOnInstantConvert){let P=this.plugin.settings.taskCreationDefaults;if(P.defaultReminders&&P.defaultReminders.length>0){let{convertDefaultRemindersToReminders:I}=await Promise.resolve().then(()=>(lp(),op));D=I(P.defaultReminders)}}let x={title:r,status:u,priority:d,due:f,scheduled:h,contexts:p.length>0?p:void 0,projects:S.length>0?S:void 0,tags:m,timeEstimate:g,recurrence:y,reminders:D,details:t,parentNote:i,creationContext:"inline-conversion",dateCreated:Ue(),dateModified:Ue()},{file:M}=await this.plugin.taskService.createTask(x);return M}sanitizeTitle(e){return e?e.trim().substring(0,200):""}sanitizePriority(e){return this.priorityManager.getAllPriorities().map(r=>r&&typeof r=="object"?r.value:r).filter(r=>r!=null).includes(e)?e:""}sanitizeStatus(e){return this.statusManager.getAllStatuses().map(r=>r&&typeof r=="object"?r.value:r).filter(r=>r!=null).includes(e)?e:""}sanitizeDate(e){return!e||!this.isValidDateFormat(e)?"":e}async replaceOriginalTaskLines(e,t,r,s){var i;try{if(!e||!r)return{success:!1,error:"Invalid editor or file reference."};let{startLine:a,endLine:o,originalContent:l}=t,c=e.lineCount();if(a<0||o>=c)return{success:!1,error:`Line range ${a}-${o} is no longer valid (current line count: ${c}).`};for(let b=0;b<l.length;b++)if(e.getLine(a+b)!==l[b])return{success:!1,error:"Content has changed since parsing. Please try again."};let d=qr.parseTaskLine(l[0]),u=d.isTaskLine;if(u&&!d.isTaskLine)return{success:!1,error:"First line is no longer a valid task."};if(!u&&!this.extractLineContentAsTitle(l[0]).trim())return{success:!1,error:"First line no longer contains valid content."};let f=((i=l[0].match(/^(\s*)/))==null?void 0:i[1])||"",h="";if(u){let b=l[0].match(/^\s*((?:[-*+]|\d+\.)\s+)\[/);h=(b==null?void 0:b[1])||"- "}else{let b=l[0].match(/^\s*([-*+]\s+)/),E=l[0].match(/^\s*(\d+\.\s+)/),S=l[0].match(/^\s*(>\s*)/);b?h=b[1]:E?h=E[1]:S?h=S[1]:h="- "}let p=this.plugin.app.workspace.getActiveFile(),m=(p==null?void 0:p.path)||"",g=this.plugin.app.fileManager.generateMarkdownLink(r,m),y=`${f}${h}${g}`;if(y.length>500)return{success:!1,error:"Generated link text is too long."};let T={line:a,ch:0},w={line:o,ch:e.getLine(o).length};return e.replaceRange(y,T,w),{success:!0}}catch(a){return console.error("Error replacing task lines:",a),{success:!1,error:`Failed to replace lines: ${a.message}`}}}async refreshTaskLinkOverlays(e,t){try{await this.forceMetadataCacheUpdate(t),setTimeout(()=>{try{let r=e.cm;if(r){let s=e.getCursor();Ya(r,t.path),setTimeout(()=>{try{e.setCursor(s)}catch(i){console.debug("Error restoring cursor position:",i)}},10)}}catch(r){console.debug("Error dispatching task update for overlays:",r)}},100)}catch(r){console.debug("Error refreshing task link overlays:",r)}}async forceMetadataCacheUpdate(e){try{await this.plugin.app.vault.cachedRead(e),this.plugin.app.metadataCache.getFileCache(e)===null&&setTimeout(async()=>{try{await this.plugin.app.vault.cachedRead(e)}catch(t){console.debug("Error in delayed cache update:",t)}},10)}catch(t){console.debug("Error forcing metadata cache update:",t)}}hasUsefulMetadata(e){return!!(e.dueDate||e.scheduledDate||e.startDate||e.priority||e.status||e.recurrence||e.createdDate||e.doneDate||e.tags&&e.tags.length>0||e.projects&&e.projects.length>0)}tryNLPFallback(e,t){var r;try{let s=this.extractTaskContent(e);if(!s.trim())return null;let i=t.trim().length>0?`${s}
${t}`:s,a=this.nlParser.parseInput(i);return(r=a.title)!=null&&r.trim()?{title:a.title.trim(),isCompleted:a.isCompleted||!1,status:a.status,priority:a.priority,dueDate:a.dueDate,scheduledDate:a.scheduledDate,dueTime:a.dueTime,scheduledTime:a.scheduledTime,recurrence:a.recurrence,tags:a.tags&&a.tags.length>0?a.tags:void 0,projects:a.projects&&a.projects.length>0?this.resolveProjectLinks(a.projects):void 0,contexts:a.contexts&&a.contexts.length>0?a.contexts:void 0,startDate:void 0,createdDate:void 0,doneDate:void 0,recurrenceData:void 0}:null}catch(s){return console.debug("NLP fallback parsing failed:",s),null}}resolveProjectLinks(e){var t,r,s;try{if(!((r=(t=this.plugin.app)==null?void 0:t.workspace)!=null&&r.getActiveFile)||!((s=this.plugin.app)!=null&&s.metadataCache))return e;let i=this.plugin.app.workspace.getActiveFile(),a=(i==null?void 0:i.path)||"";return e.map(o=>{let l=o.match(/^\[\[([^\]]+)\]\]$/);if(l){let c=l[1],d=c;c.includes("|")&&(d=c.split("|")[0]);try{let u=this.plugin.app.metadataCache.getFirstLinkpathDest(d,a);if(u)return`[[${this.plugin.app.metadataCache.fileToLinktext(u,a,!0)}]]`}catch(u){console.debug("Error resolving project link:",u)}return o}return o})}catch(i){return console.debug("Error in resolveProjectLinks:",i),e}}extractTaskContent(e){return e.replace(/^\s*(?:[-*+]|\d+\.)\s*\[[ xX]\]\s*/,"").trim()}extractLineContentAsTitle(e){let t=e.trim();for(t=t.replace(/^\s*[-*+]\s+/,""),t=t.replace(/^\s*\d+\.\s+/,"");t.match(/^\s*>\s*/);)t=t.replace(/^\s*>\s*/,"");return t=t.replace(/^\s*#+\s+/,""),t.match(/^\s*(-{3,}|={3,})\s*$/)?"":t.trim()}findAllCheckboxTasks(e){let t=[],r=e.lineCount();for(let s=0;s<r;s++){let i=e.getLine(s);if(qr.parseTaskLine(i).isTaskLine){t.push({lineNumber:s,line:i});continue}if(i.trim().includes("[ ]")||i.trim().includes("[x]")||i.trim().includes("[X]")){let o=i.trim();for(;o.match(/^\s*>\s*/);)o=o.replace(/^\s*>\s*/,"");qr.parseTaskLine(o).isTaskLine&&t.push({lineNumber:s,line:i})}}return t}async parseTaskForBatch(e){try{let t=qr.parseTaskLine(e);if(t.isTaskLine){if(t.error||!t.parsedData)return null;if(!this.hasUsefulMetadata(t.parsedData)&&this.plugin.settings.enableNaturalLanguageInput){let s=this.tryNLPFallback(e,"");if(s)return s}return t.parsedData}else{let r=this.extractLineContentAsTitle(e);if(!r.trim())return null;if(this.plugin.settings.enableNaturalLanguageInput){let s=this.tryNLPFallback(r,"");if(s)return s}return{title:r,isCompleted:!1}}}catch(t){return console.warn("Error parsing task for batch:",t),null}}generateLinkText(e,t){var d;let r=((d=e.match(/^(\s*)/))==null?void 0:d[1])||"",i=qr.parseTaskLine(e).isTaskLine,a="";if(i){let u=e.match(/^\s*((?:[-*+]|\d+\.)\s+)\[/);a=(u==null?void 0:u[1])||"- "}else{let u=e.match(/^\s*([-*+]\s+)/),f=e.match(/^\s*(\d+\.\s+)/),h=e.match(/^\s*(>\s*)/);u?a=u[1]:f?a=f[1]:h?a=h[1]:a="- "}let o=this.plugin.app.workspace.getActiveFile(),l=(o==null?void 0:o.path)||"",c=this.plugin.app.fileManager.generateMarkdownLink(t,l);return`${r}${a}${c}`}replaceAllTaskLines(e,t){let r=t.sort((s,i)=>i.lineNumber-s.lineNumber);for(let s of r){let i=e.getLine(s.lineNumber).length;e.replaceRange(s.linkText,{line:s.lineNumber,ch:0},{line:s.lineNumber,ch:i})}}}});var jB={};st(jB,{createInstantConvertButtons:()=>G4,createInstantConvertField:()=>UB});function UB(n){return Sv.StateField.define({create(){return gn.Decoration.none},update(e,t){if(!n||!t)return gn.Decoration.none;if(!n.settings||!n.settings.enableInstantTaskConvert)return gn.Decoration.none;if(!t.state)return console.warn("Invalid transaction state in instant convert field update"),gn.Decoration.none;try{return!t.docChanged&&e!==gn.Decoration.none?e.map(t.changes):q4(t.state,n)}catch(r){return console.error("Error updating instant convert decorations:",r),gn.Decoration.none}},provide(e){return gn.EditorView.decorations.from(e)}})}function q4(n,e){let t=new Sv.RangeSetBuilder,r=n.doc;if(!r||!e)return console.warn("Invalid state or plugin for building convert button decorations"),t.finish();if(typeof r.lines!="number"||r.lines<0)return console.warn("Invalid document lines count:",r.lines),t.finish();for(let s=0;s<r.lines;s++)try{let i=r.line(s+1);if(!i||typeof i.text!="string")continue;let a=i.text;if(a.length>1e3)continue;let o=qr.parseTaskLine(a);if(o.isTaskLine&&o.parsedData){if(!o.parsedData.title||o.parsedData.title.trim().length===0||typeof i.to!="number"||i.to<0)continue;let l=new iD(e,s),c=gn.Decoration.widget({widget:l,side:1});t.add(i.to,i.to,c)}}catch(i){console.debug("Error processing line",s,":",i);continue}return t.finish()}function G4(n){return UB(n)}var Sv,gn,gd,iD,WB=v(()=>{Sv=require("@codemirror/state"),gn=require("@codemirror/view"),gd=require("obsidian");sD();iD=class n extends gn.WidgetType{constructor(e,t){super(),this.plugin=e,this.lineNumber=t}toDOM(e){let t=document.createElement("span");t.className="tasknotes-plugin";let r=t.createEl("button",{cls:"instant-convert-button",attr:{"aria-label":"Convert to TaskNote"}});(0,gd.setTooltip)(r,"Convert to TaskNote",{placement:"top"});let s=r.createEl("span",{cls:"instant-convert-button__icon"});return(0,gd.setIcon)(s,"file-plus"),r.addEventListener("mousedown",async i=>{i.preventDefault(),i.stopPropagation();try{if(!this.validateButtonClick())return;let a=this.plugin.app.workspace.getActiveViewOfType(gd.MarkdownView);if(!a){console.warn("No active markdown view available for task conversion");return}let o=a.editor;if(!this.validateEditorState(o))return;this.plugin.instantTaskConvertService&&o&&await this.plugin.instantTaskConvertService.instantConvertTask(o,this.lineNumber)}catch(a){console.error("Error in convert button click handler:",a)}}),t}eq(e){return e instanceof n&&e.plugin===this.plugin&&e.lineNumber===this.lineNumber}get estimatedHeight(){return-1}ignoreEvent(){return!1}validateButtonClick(){return this.plugin?this.plugin.settings.enableInstantTaskConvert?typeof this.lineNumber!="number"||this.lineNumber<0?(console.warn("Invalid line number for task conversion:",this.lineNumber),!1):!0:(console.warn("Instant task conversion is disabled"),!1):(console.warn("Plugin not available for task conversion"),!1)}validateEditorState(e){if(!e)return console.warn("Editor not available for task conversion"),!1;let t=e.lineCount();if(this.lineNumber>=t)return console.warn(`Line number ${this.lineNumber} is out of bounds (total lines: ${t})`),!1;try{let r=e.getLine(this.lineNumber);return r?qr.parseTaskLine(r).isTaskLine?!0:(console.warn(`Line ${this.lineNumber} is no longer a task`),!1):(console.warn(`Cannot read line ${this.lineNumber}`),!1)}catch(r){return console.warn("Error validating line content:",r),!1}}}});var VB={};st(VB,{DueDateModal:()=>aD});var xp,aD,$B=v(()=>{xp=require("obsidian");Ft();Ne();aD=class extends xp.Modal{constructor(e,t,r){super(e),this.task=t,this.plugin=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-plugin"),this.titleEl.setText("Set due date"),this.titleEl.setAttribute("id","due-date-modal-title"),this.containerEl.setAttribute("aria-labelledby","due-date-modal-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),e.createEl("p",{text:`Task: ${this.task.title}`,cls:"due-date-modal__task-title"});let r=new xp.Setting(e).setName("Due date & time").setDesc("Enter due date and optional time (leave time empty for date-only)").controlEl.createDiv({cls:"modal-form__datetime-container"});this.dueDateInput=r.createEl("input",{type:"date",cls:"modal-form__input modal-form__input--date",attr:{"aria-label":"Due date for task",placeholder:"YYYY-MM-DD"}}),this.dueDateInput.value=we(this.task.due||""),this.dueTimeInput=r.createEl("input",{type:"time",cls:"modal-form__input modal-form__input--time",attr:{"aria-label":"Due time for task (optional)",placeholder:"HH:MM"}}),this.dueTimeInput.value=xr(this.task.due||"")||"",this.dueDateInput.addEventListener("keydown",p=>{p.key==="Enter"?this.save():p.key==="Escape"&&this.close()}),this.dueTimeInput.addEventListener("keydown",p=>{p.key==="Enter"?this.save():p.key==="Escape"&&this.close()}),setTimeout(()=>this.dueDateInput.focus(),100);let s=e.createDiv({cls:"modal-form__group"});new xp.Setting(s).setName("Quick options").setHeading();let i=s.createDiv({cls:"modal-form__quick-actions"});i.createEl("button",{text:"Today",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to today"}}).addEventListener("click",()=>{this.dueDateInput.value=C(new Date,"yyyy-MM-dd")}),i.createEl("button",{text:"Tomorrow",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to tomorrow"}}).addEventListener("click",()=>{this.dueDateInput.value=C(Tl(new Date,{days:1}),"yyyy-MM-dd")}),i.createEl("button",{text:"Next week",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to next week"}}).addEventListener("click",()=>{this.dueDateInput.value=C(Tl(new Date,{weeks:1}),"yyyy-MM-dd")}),i.createEl("button",{text:"Now",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date and time to now"}}).addEventListener("click",()=>{let p=new Date;this.dueDateInput.value=C(p,"yyyy-MM-dd"),this.dueTimeInput.value=C(p,"HH:mm")}),i.createEl("button",{text:"Clear",cls:"modal-form__button modal-form__button--quick-date modal-form__button--quick-date--clear",attr:{"aria-label":"Clear due date"}}).addEventListener("click",()=>{this.dueDateInput.value="",this.dueTimeInput.value=""});let u=e.createDiv({cls:"modal-form__buttons"});u.createEl("button",{text:"Save",cls:"modal-form__button modal-form__button--primary"}).addEventListener("click",()=>this.save()),u.createEl("button",{text:"Cancel",cls:"modal-form__button modal-form__button--secondary"}).addEventListener("click",()=>this.close())}async save(){let e=this.dueDateInput.value.trim(),t=this.dueTimeInput.value.trim(),r;if(e?t?r=Ur(e,t):r=e:r=void 0,!im(e,t)){let s=this.contentEl.createEl("div",{text:"Please enter a valid date and time format",cls:"modal-form__error",attr:{role:"alert","aria-live":"assertive"}});this.dueDateInput.setAttribute("aria-invalid","true"),this.dueDateInput.setAttribute("aria-describedby","due-date-error"),s.setAttribute("id","due-date-error"),setTimeout(()=>{s.remove(),this.dueDateInput.removeAttribute("aria-invalid"),this.dueDateInput.removeAttribute("aria-describedby")},3e3);return}try{await this.plugin.taskService.updateProperty(this.task,"due",r),this.close()}catch(s){console.error("Failed to update due date:",s);let i=this.contentEl.createEl("div",{text:"Failed to update due date. Please try again.",cls:"modal-form__error"});setTimeout(()=>i.remove(),3e3)}}onClose(){let{contentEl:e}=this;e.empty()}}});var YB={};st(YB,{ScheduledDateModal:()=>oD});var Cp,oD,zB=v(()=>{Cp=require("obsidian");Ft();Ne();oD=class extends Cp.Modal{constructor(e,t,r){super(e),this.task=t,this.plugin=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-plugin"),this.titleEl.setText("Set scheduled date"),this.titleEl.setAttribute("id","scheduled-date-modal-title"),this.containerEl.setAttribute("aria-labelledby","scheduled-date-modal-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),e.createEl("p",{text:`Task: ${this.task.title}`,cls:"scheduled-date-modal__task-title"});let r=new Cp.Setting(e).setName("Scheduled Date & Time").setDesc("Enter scheduled date and optional time (leave time empty for date-only)").controlEl.createDiv({cls:"modal-form__datetime-container"});this.scheduledDateInput=r.createEl("input",{type:"date",cls:"modal-form__input modal-form__input--date",attr:{"aria-label":"Scheduled date for task",placeholder:"YYYY-MM-DD"}}),this.scheduledDateInput.value=we(this.task.scheduled||""),this.scheduledTimeInput=r.createEl("input",{type:"time",cls:"modal-form__input modal-form__input--time",attr:{"aria-label":"Scheduled time for task (optional)",placeholder:"HH:MM"}}),this.scheduledTimeInput.value=xr(this.task.scheduled||"")||"",this.scheduledDateInput.addEventListener("keydown",p=>{p.key==="Enter"?this.save():p.key==="Escape"&&this.close()}),this.scheduledTimeInput.addEventListener("keydown",p=>{p.key==="Enter"?this.save():p.key==="Escape"&&this.close()}),window.setTimeout(()=>this.scheduledDateInput.focus(),100);let s=e.createDiv({cls:"modal-form__group"});new Cp.Setting(s).setName("Quick options").setHeading();let i=s.createDiv({cls:"modal-form__quick-actions"});i.createEl("button",{text:"Today",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to today"}}).addEventListener("click",()=>{this.scheduledDateInput.value=C(new Date,"yyyy-MM-dd")}),i.createEl("button",{text:"Tomorrow",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to tomorrow"}}).addEventListener("click",()=>{this.scheduledDateInput.value=C(Tl(new Date,{days:1}),"yyyy-MM-dd")}),i.createEl("button",{text:"Next week",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to next week"}}).addEventListener("click",()=>{this.scheduledDateInput.value=C(Tl(new Date,{weeks:1}),"yyyy-MM-dd")}),i.createEl("button",{text:"Now",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date and time to now"}}).addEventListener("click",()=>{let p=new Date;this.scheduledDateInput.value=C(p,"yyyy-MM-dd"),this.scheduledTimeInput.value=C(p,"HH:mm")}),i.createEl("button",{text:"Clear",cls:"modal-form__button modal-form__button--quick-date modal-form__button--quick-date--clear",attr:{"aria-label":"Clear scheduled date"}}).addEventListener("click",()=>{this.scheduledDateInput.value="",this.scheduledTimeInput.value=""});let u=e.createDiv({cls:"modal-form__buttons"});u.createEl("button",{text:"Save",cls:"modal-form__button modal-form__button--primary"}).addEventListener("click",()=>this.save()),u.createEl("button",{text:"Cancel",cls:"modal-form__button modal-form__button--secondary"}).addEventListener("click",()=>this.close())}async save(){let e=this.scheduledDateInput.value.trim(),t=this.scheduledTimeInput.value.trim(),r;if(e?t?r=Ur(e,t):r=e:r=void 0,!im(e,t)){let s=this.contentEl.createEl("div",{text:"Please enter a valid date and time format",cls:"modal-form__error",attr:{role:"alert","aria-live":"assertive"}});this.scheduledDateInput.setAttribute("aria-invalid","true"),this.scheduledDateInput.setAttribute("aria-describedby","scheduled-date-error"),s.setAttribute("id","scheduled-date-error"),window.setTimeout(()=>{s.remove(),this.scheduledDateInput.removeAttribute("aria-invalid"),this.scheduledDateInput.removeAttribute("aria-describedby")},3e3);return}try{await this.plugin.taskService.updateProperty(this.task,"scheduled",r),this.close()}catch(s){console.error("Failed to update scheduled date:",s);let i=this.contentEl.createEl("div",{text:"Failed to update scheduled date. Please try again.",cls:"modal-form__error"});window.setTimeout(()=>i.remove(),3e3)}}onClose(){let{contentEl:e}=this;e.empty()}}});var qB={};st(qB,{TaskActionPaletteModal:()=>lD});var ir,lD,GB=v(()=>{ir=require("obsidian"),lD=class extends ir.FuzzySuggestModal{constructor(e,t,r,s){super(e),this.task=t,this.plugin=r,this.targetDate=s,this.actions=this.buildActionsList(),this.setPlaceholder("Type to search for an action..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to execute"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText(`Quick actions: ${t.title}`),this.titleEl.setAttribute("id","task-action-palette-title"),this.containerEl.setAttribute("aria-labelledby","task-action-palette-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),this.containerEl.addClass("task-action-palette-modal")}buildActionsList(){let e=[];(this.task.recurrence?this.plugin.statusManager.getNonCompletionStatuses():this.plugin.statusManager.getAllStatuses()).forEach(s=>{let i=this.task.status===s.value;e.push({id:`status-${s.value}`,title:`Change status to "${s.label}"`,description:`Set task status to ${s.label}`,icon:i?"check":"circle",category:"status",keywords:["status",s.value,s.label,"change","set"],isApplicable:()=>!i,execute:async a=>{await this.plugin.updateTaskProperty(a,"status",s.value),new ir.Notice(`Status changed to ${s.label}`)}})}),this.plugin.priorityManager.getAllPriorities().forEach(s=>{let i=this.task.priority===s.value;e.push({id:`priority-${s.value}`,title:`Set priority to "${s.label}"`,description:`Change task priority to ${s.label}`,icon:i?"check":"flag",category:"priority",keywords:["priority",s.value,s.label,"change","set"],isApplicable:()=>!i,execute:async a=>{await this.plugin.updateTaskProperty(a,"priority",s.value),new ir.Notice(`Priority changed to ${s.label}`)}})}),e.push({id:"set-due-date",title:"Set due date",description:"Set or change the task due date",icon:"calendar",category:"dates",keywords:["due","date","deadline","set","change"],isApplicable:()=>!0,execute:async s=>{this.plugin.openDueDateModal(s)}},{id:"set-scheduled-date",title:"Set scheduled date",description:"Set or change when the task is scheduled",icon:"calendar-clock",category:"dates",keywords:["scheduled","date","schedule","set","change"],isApplicable:()=>!0,execute:async s=>{this.plugin.openScheduledDateModal(s)}},{id:"clear-due-date",title:"Clear due date",description:"Remove the due date from this task",icon:"calendar-x",category:"dates",keywords:["clear","remove","due","date"],isApplicable:s=>!!s.due,execute:async s=>{await this.plugin.updateTaskProperty(s,"due",void 0),new ir.Notice("Due date cleared")}},{id:"clear-scheduled-date",title:"Clear scheduled date",description:"Remove the scheduled date from this task",icon:"calendar-x",category:"dates",keywords:["clear","remove","scheduled","date"],isApplicable:s=>!!s.scheduled,execute:async s=>{await this.plugin.updateTaskProperty(s,"scheduled",void 0),new ir.Notice("Scheduled date cleared")}});let r=this.plugin.getActiveTimeSession(this.task);return e.push({id:"toggle-time-tracking",title:r?"Stop time tracking":"Start time tracking",description:r?"Stop tracking time for this task":"Start tracking time for this task",icon:r?"pause":"play",category:"tracking",keywords:["time","tracking","timer",r?"stop":"start"],isApplicable:()=>!0,execute:async s=>{this.plugin.getActiveTimeSession(s)?(await this.plugin.stopTimeTracking(s),new ir.Notice("Time tracking stopped")):(await this.plugin.startTimeTracking(s),new ir.Notice("Time tracking started"))}}),e.push({id:"toggle-archive",title:this.task.archived?"Unarchive task":"Archive task",description:this.task.archived?"Move task back to active tasks":"Archive this task",icon:this.task.archived?"archive-restore":"archive",category:"organization",keywords:["archive",this.task.archived?"unarchive":"archive","organize"],isApplicable:()=>!0,execute:async s=>{await this.plugin.toggleTaskArchive(s),new ir.Notice(s.archived?"Task unarchived":"Task archived")}}),this.task.recurrence&&e.push({id:"complete-recurring-instance",title:"Complete this occurrence",description:"Mark this specific instance of the recurring task as complete",icon:"check-circle",category:"status",keywords:["complete","done","finish","recurring","instance","occurrence"],isApplicable:(s,i,a)=>!i.statusManager.isCompletedStatus(s.status),execute:async(s,i,a)=>{await i.toggleRecurringTaskComplete(s,a),new ir.Notice("Recurring task instance completed")}}),e.push({id:"edit-task",title:"Edit task details",description:"Open the full task editor",icon:"edit",category:"other",keywords:["edit","modify","details","properties"],isApplicable:()=>!0,execute:async s=>{await this.plugin.openTaskEditModal(s)}},{id:"open-task-file",title:"Open task file",description:"Open the task file in the editor",icon:"file-text",category:"other",keywords:["open","file","editor","edit"],isApplicable:()=>!0,execute:async s=>{let i=this.plugin.app.vault.getAbstractFileByPath(s.path);i&&await this.plugin.app.workspace.getLeaf(!0).openFile(i)}},{id:"copy-task-title",title:"Copy task title",description:"Copy the task title to clipboard",icon:"copy",category:"other",keywords:["copy","clipboard","title"],isApplicable:()=>!0,execute:async s=>{try{await navigator.clipboard.writeText(s.title),new ir.Notice("Task title copied to clipboard")}catch(i){new ir.Notice("Failed to copy to clipboard")}}},{id:"copy-task-link",title:"Copy task link",description:"Copy a wikilink to this task",icon:"link",category:"other",keywords:["copy","link","wikilink","reference"],isApplicable:()=>!0,execute:async s=>{try{let i=this.plugin.app.vault.getAbstractFileByPath(s.path);if(i){let a=this.plugin.app.metadataCache.fileToLinktext(i,"");await navigator.clipboard.writeText(`[[${a}]]`),new ir.Notice("Task link copied to clipboard")}}catch(i){new ir.Notice("Failed to copy to clipboard")}}},{id:"delete-task",title:"Delete task",description:"Permanently delete this task",icon:"trash",category:"other",keywords:["delete","remove","trash"],isApplicable:()=>!0,execute:async s=>{this.close();let{showDeleteConfirmationModal:i}=await Promise.resolve().then(()=>(Fs(),rd));await i(s,this.plugin)}}),e}getItems(){return this.actions.filter(e=>e.isApplicable(this.task,this.plugin,this.targetDate)).sort((e,t)=>{var a,o;let r={status:0,priority:1,dates:2,tracking:3,organization:4,other:5},s=(a=r[e.category])!=null?a:999,i=(o=r[t.category])!=null?o:999;return s!==i?s-i:e.title.localeCompare(t.title)})}getItemText(e){return[e.title,e.description,e.category,...e.keywords].join(" ")}renderSuggestion(e,t){let r=e.item,s=t.createDiv({cls:"task-action-palette__suggestion"}),i=s.createDiv({cls:"task-action-palette__icon"});(0,ir.setIcon)(i,r.icon);let a=s.createDiv({cls:"task-action-palette__content"});a.createDiv({cls:"task-action-palette__title",text:r.title}),a.createDiv({cls:"task-action-palette__description",text:r.description}),s.createDiv({cls:"task-action-palette__badge"}).createSpan({cls:`task-action-palette__category task-action-palette__category--${r.category}`,text:r.category})}async onChooseItem(e,t){try{let r=await this.plugin.cacheManager.getTaskInfo(this.task.path);if(!r){new ir.Notice("Task not found");return}await e.execute(r,this.plugin,this.targetDate)}catch(r){let s=r instanceof Error?r.message:String(r);console.error("Error executing action:",{error:s,actionId:e.id,taskPath:this.task.path}),new ir.Notice(`Failed to execute action: ${s}`)}}}});var K4={};st(K4,{default:()=>Q4});module.exports=Td(K4);var ye=require("obsidian");Ft();var Za=Ee(wn());$p();var Id=require("obsidian");var no=require("obsidian");function ke(n,e){return new no.Setting(n).setName(e.name).setDesc(e.desc).addToggle(t=>{t.setValue(e.getValue()).onChange(e.setValue)})}function Xe(n,e){return new no.Setting(n).setName(e.name).setDesc(e.desc).addText(t=>(t.setValue(e.getValue()).onChange(e.setValue),e.placeholder&&t.setPlaceholder(e.placeholder),e.ariaLabel&&t.inputEl.setAttribute("aria-label",e.ariaLabel),t.inputEl.addClass("settings-view__input"),t))}function gt(n,e){return new no.Setting(n).setName(e.name).setDesc(e.desc).addDropdown(t=>(e.options.forEach(r=>{t.addOption(r.value,r.label)}),t.setValue(e.getValue()).onChange(e.setValue),e.ariaLabel&&t.selectEl.setAttribute("aria-label",e.ariaLabel),t))}function Kr(n,e){return new no.Setting(n).setName(e.name).setDesc(e.desc).addText(t=>(t.setValue(e.getValue().toString()).onChange(r=>{let s=parseInt(r);if(!isNaN(s)){if(e.min!==void 0&&s<e.min||e.max!==void 0&&s>e.max)return;e.setValue(s)}}),t.inputEl.type="number",e.placeholder&&t.setPlaceholder(e.placeholder),e.min!==void 0&&t.inputEl.setAttribute("min",e.min.toString()),e.max!==void 0&&t.inputEl.setAttribute("max",e.max.toString()),e.ariaLabel&&t.inputEl.setAttribute("aria-label",e.ariaLabel),t.inputEl.addClass("settings-view__input"),t))}function io(n,e){return new no.Setting(n).setName(e.name).setDesc(e.desc).addButton(t=>(t.setButtonText(e.buttonText).onClick(e.onClick),e.buttonClass?t.buttonEl.addClass(e.buttonClass):t.buttonEl.addClasses(["tn-btn","tn-btn--ghost"]),t))}function Me(n,e){return new no.Setting(n).setName(e).setHeading()}function Se(n,e){return n.createEl("p",{text:e,cls:"settings-view__help-note"})}function nT(n,e){return n.createEl("p",{text:e,cls:"settings-validation-note"})}function LP(n,e,t=!1){let r;return function(...s){let i=()=>{r=void 0,t||n.apply(this,s)},a=t&&!r;clearTimeout(r),r=setTimeout(i,e),a&&n.apply(this,s)}}function Ad(n,e,t){n.empty(),Me(n,"Task Storage"),Se(n,"Configure where tasks are stored and how they are identified."),Xe(n,{name:"Default tasks folder",desc:"Default location for new tasks",placeholder:"TaskNotes",getValue:()=>e.settings.tasksFolder,setValue:async r=>{e.settings.tasksFolder=r,t()},ariaLabel:"Default folder path for new tasks"}),ke(n,{name:"Move archived tasks to folder",desc:"Automatically move archived tasks to an archive folder",getValue:()=>e.settings.moveArchivedTasks,setValue:async r=>{e.settings.moveArchivedTasks=r,t(),Ad(n,e,t)}}),e.settings.moveArchivedTasks&&Xe(n,{name:"Archive folder",desc:"Folder to move tasks to when archived",placeholder:"TaskNotes/Archive",getValue:()=>e.settings.archiveFolder,setValue:async r=>{e.settings.archiveFolder=r,t()},ariaLabel:"Archive folder path"}),Me(n,"Task Identification"),Se(n,"Choose how TaskNotes identifies notes as tasks."),gt(n,{name:"Identify tasks by",desc:"Choose whether to identify tasks by tag or by a frontmatter property",options:[{value:"tag",label:"Tag"},{value:"property",label:"Property"}],getValue:()=>e.settings.taskIdentificationMethod,setValue:async r=>{e.settings.taskIdentificationMethod=r,t(),Ad(n,e,t)},ariaLabel:"Task identification method"}),e.settings.taskIdentificationMethod==="tag"?Xe(n,{name:"Task tag",desc:"Tag that identifies notes as tasks (without #)",placeholder:"task",getValue:()=>e.settings.taskTag,setValue:async r=>{e.settings.taskTag=r,t()},ariaLabel:"Task identification tag"}):(Xe(n,{name:"Task property name",desc:'The frontmatter property name (e.g., "category")',placeholder:"category",getValue:()=>e.settings.taskPropertyName,setValue:async r=>{e.settings.taskPropertyName=r,t()}}),Xe(n,{name:"Task property value",desc:'The value that identifies a note as a task (e.g., "task")',placeholder:"task",getValue:()=>e.settings.taskPropertyValue,setValue:async r=>{e.settings.taskPropertyValue=r,t()}})),Me(n,"Folder Management"),Xe(n,{name:"Excluded folders",desc:"Comma-separated list of folders to exclude from Notes tab",placeholder:"Templates, Archive",getValue:()=>e.settings.excludedFolders,setValue:async r=>{e.settings.excludedFolders=r,t()},ariaLabel:"Excluded folder paths"}),Me(n,"Task Interaction"),Se(n,"Configure how clicking on tasks behaves."),gt(n,{name:"Single-click action",desc:"Action performed when single-clicking a task card",options:[{value:"edit",label:"Edit task"},{value:"openNote",label:"Open note"}],getValue:()=>e.settings.singleClickAction,setValue:async r=>{e.settings.singleClickAction=r,t()}}),gt(n,{name:"Double-click action",desc:"Action performed when double-clicking a task card",options:[{value:"edit",label:"Edit task"},{value:"openNote",label:"Open note"},{value:"none",label:"No action"}],getValue:()=>e.settings.doubleClickAction,setValue:async r=>{e.settings.doubleClickAction=r,t()}})}var gi=require("obsidian");var iT=require("obsidian");function Ln(n,e){let t=n.createDiv("tasknotes-settings__card");e.id&&t.setAttribute("data-card-id",e.id),e.draggable&&t.addClass("tasknotes-settings__card--draggable"),e.collapsible&&(t.addClass("tasknotes-settings__card--collapsible"),e.defaultCollapsed&&t.addClass("tasknotes-settings__card--collapsed"));let r=t.createDiv("tasknotes-settings__card-header"),s=null;e.draggable&&(r.addClass("tasknotes-settings__card-header--with-drag-handle"),s=r.createDiv("tasknotes-settings__card-drag-handle"),s.textContent="\u22EE\u22EE",s.draggable=!0,s.title="Drag to reorder");let i=r.createDiv();if(i.style.display="flex",i.style.alignItems="center",i.style.flex="1",i.style.minWidth="0",e.colorIndicator){let c=i.createDiv("tasknotes-settings__card-color-indicator");c.style.backgroundColor=e.colorIndicator.color,e.colorIndicator.cssVar&&c.style.setProperty("--card-color",e.colorIndicator.color)}let a=i.createDiv("tasknotes-settings__card-info"),o=a.createSpan("tasknotes-settings__card-primary-text");if(o.textContent=e.header.primaryText,e.header.secondaryText){let c=a.createSpan("tasknotes-settings__card-secondary-text");c.textContent=e.header.secondaryText}let l=r.createDiv();if(l.style.display="flex",l.style.alignItems="center",l.style.gap="0.5rem",e.header.meta&&e.header.meta.length>0){let c=l.createDiv("tasknotes-settings__card-meta");e.header.meta.forEach(d=>{c.appendChild(d)})}if(e.header.actions&&e.header.actions.length>0){let c=l.querySelector(".tasknotes-settings__card-header-actions")||l.createDiv("tasknotes-settings__card-header-actions");e.header.actions.forEach(d=>{let u=c.createEl("button",{cls:"tasknotes-settings__card-header-btn"});d.variant==="delete"&&u.addClass("tasknotes-settings__card-header-btn--delete");let f=u.createSpan();(0,iT.setIcon)(f,d.icon),d.tooltip&&(u.title=d.tooltip),u.onclick=h=>{h.stopPropagation(),d.onClick()}})}if(e.collapsible){let c=()=>{t.hasClass("tasknotes-settings__card--collapsed")?(t.removeClass("tasknotes-settings__card--collapsed"),r.title="Collapse card"):(t.addClass("tasknotes-settings__card--collapsed"),r.title="Expand card")};r.addClass("tasknotes-settings__card-header--clickable"),r.title=e.defaultCollapsed?"Expand card":"Collapse card",r.onclick=d=>{d.target.closest(".tasknotes-settings__card-header-actions")||c()}}if(e.content&&e.content.sections.length>0){let c=t.createDiv("tasknotes-settings__card-content");e.draggable&&c.addClass("tasknotes-settings__card-content--with-drag-handle"),e.content.sections.forEach(d=>{d.rows.forEach(u=>{let f=c.createDiv("tasknotes-settings__card-config-row");u.fullWidth&&(f.style.flexDirection="column",f.style.alignItems="flex-start",f.style.gap="0.5rem");let h=f.createSpan("tasknotes-settings__card-config-label");h.textContent=u.label,f.appendChild(u.input)})})}if(e.actions&&e.actions.buttons.length>0){let c=t.createDiv("tasknotes-settings__card-actions");e.draggable&&c.addClass("tasknotes-settings__card-actions--with-drag-handle"),e.actions.buttons.forEach(d=>{let u=c.createEl("button",{text:d.text,cls:"tasknotes-settings__card-action-btn"});if(d.variant&&u.addClass(`tasknotes-settings__card-action-btn--${d.variant}`),d.icon){let f=u.createSpan();(0,iT.setIcon)(f,d.icon),u.insertBefore(f,u.firstChild)}d.disabled&&(u.disabled=!0),u.onclick=d.onClick})}return t}function sa(n,e="default"){let t=document.createElement("span");return t.addClass("tasknotes-settings__card-status-badge"),t.addClass(`tasknotes-settings__card-status-badge--${e}`),t.textContent=n,t}function Fn(n,e){return{icon:"trash-2",variant:"delete",tooltip:e||"Delete",onClick:n}}function Ht(n="text",e,t){let r=document.createElement("input");return r.type=n,r.addClass("tasknotes-settings__card-input"),e&&(r.placeholder=e),t&&(r.value=t),r}function ao(n,e){let t=document.createElement("select");return t.addClass("tasknotes-settings__card-input"),n.forEach(r=>{let s=t.createEl("option",{value:r.value,text:r.label});e===r.value&&(s.selected=!0)}),t}function FP(n,e,t){let r=n.querySelector(".tasknotes-settings__card-drag-handle");if(!r)return;let s=n.getAttribute("data-card-id");s&&(r.addEventListener("dragstart",i=>{i.dataTransfer&&(i.dataTransfer.setData("text/plain",s),n.addClass("tasknotes-settings__card--dragging"))}),r.addEventListener("dragend",()=>{n.removeClass("tasknotes-settings__card--dragging")}),n.addEventListener("dragover",i=>{i.preventDefault();let a=e.querySelector(".tasknotes-settings__card--dragging");if(a&&a!==n){let o=n.getBoundingClientRect(),l=o.top+o.height/2;n.removeClass("tasknotes-settings__card--drag-over-top","tasknotes-settings__card--drag-over-bottom"),i.clientY<l?n.addClass("tasknotes-settings__card--drag-over-top"):n.addClass("tasknotes-settings__card--drag-over-bottom")}}),n.addEventListener("dragleave",()=>{n.removeClass("tasknotes-settings__card--drag-over-top","tasknotes-settings__card--drag-over-bottom")}),n.addEventListener("drop",i=>{i.preventDefault(),n.removeClass("tasknotes-settings__card--drag-over-top","tasknotes-settings__card--drag-over-bottom");let a=i.dataTransfer.getData("text/plain"),o=s;if(a!==o){let l=n.getBoundingClientRect(),c=l.top+l.height/2,d=i.clientY<c;t(a,o,d)}}))}function oo(n,e,t,r){let s=Ht("number");return n!==void 0&&(s.min=n.toString()),e!==void 0&&(s.max=e.toString()),t!==void 0&&(s.step=t.toString()),r!==void 0&&(s.value=r.toString()),s}function Yp(n,e){let t=document.createElement("input");return t.type="url",t.addClass("tasknotes-settings__card-input"),n&&(t.placeholder=n),e&&(t.value=e),t}function Ml(n){let e=document.createElement("span");return e.addClass("tasknotes-settings__card-info-badge"),e.textContent=n,e}function na(n,e,t,r){n.empty();let s=n.createDiv("tasknotes-settings__empty-state");s.createSpan("tasknotes-settings__empty-icon");let i=s.createSpan({text:e,cls:"tasknotes-settings__empty-text"});if(t&&r){let a=s.createEl("button",{text:t,cls:"tn-btn tn-btn--primary"});a.style.marginTop="1rem",a.onclick=r}}function qp(n,e,t){n.empty(),Array.isArray(e.settings.userFields)||(e.settings.userFields=[]),Me(n,"Task Statuses"),Se(n,"Customize the status options available for your tasks. These statuses control the task lifecycle and determine when tasks are considered complete.");let r=n.createDiv("tasknotes-settings__help-section");r.createEl("h4",{text:"How statuses work:"});let s=r.createEl("ul");s.createEl("li",{text:'Value: The internal identifier stored in your task files (e.g., "in-progress")'}),s.createEl("li",{text:'Label: The display name shown in the interface (e.g., "In Progress")'}),s.createEl("li",{text:"Color: Visual indicator color for the status dot and badges"}),s.createEl("li",{text:"Completed: When checked, tasks with this status are considered finished and may be filtered differently"}),s.createEl("li",{text:"Auto-archive: When enabled, tasks will be automatically archived after the specified delay (1-1440 minutes)"}),r.createEl("p",{text:"The order below determines the sequence when cycling through statuses by clicking on task status badges.",cls:"settings-help-note"});let i=n.createDiv("tasknotes-statuses-container");zp(i,e,t),new gi.Setting(n).setName("Add new status").setDesc("Create a new status option for your tasks").addButton(u=>u.setButtonText("Add status").onClick(async()=>{let h={id:`status_${Date.now()}`,value:"",label:"",color:"#6366f1",completed:!1,isCompleted:!1,order:e.settings.customStatuses.length,autoArchive:!1,autoArchiveDelay:5};e.settings.customStatuses.push(h),t(),zp(i,e,t)})),nT(n,'Note: You must have at least 2 statuses, and at least one status must be marked as "Completed".'),Me(n,"Task Priorities"),Se(n,"Customize the priority levels available for your tasks. Priority weights determine sorting order and visual hierarchy in your task views.");let a=n.createDiv("tasknotes-settings__help-section");a.createEl("h4",{text:"How priorities work:"});let o=a.createEl("ul");o.createEl("li",{text:'Value: The internal identifier stored in your task files (e.g., "high")'}),o.createEl("li",{text:'Display Label: The display name shown in the interface (e.g., "High Priority")'}),o.createEl("li",{text:"Color: Visual indicator color for the priority dot and badges"}),o.createEl("li",{text:"Weight: Numeric value for sorting (higher weights appear first in lists)"}),a.createEl("p",{text:"Tasks are automatically sorted by priority weight in descending order (highest weight first). Weights can be any positive number.",cls:"settings-help-note"});let l=n.createDiv("tasknotes-priorities-container");aT(l,e,t),new gi.Setting(n).setName("Add new priority").setDesc("Create a new priority level for your tasks").addButton(u=>u.setButtonText("Add priority").onClick(async()=>{let h={id:`priority_${Date.now()}`,value:"",label:"",color:"#6366f1",weight:1};e.settings.customPriorities.push(h),t(),aT(l,e,t)})),nT(n,"Note: You must have at least 1 priority. Higher weights take precedence in sorting and visual hierarchy."),Me(n,"Field Mapping");let c=n.createDiv("tasknotes-settings__warning");if(c.createEl("strong",{text:"\u26A0\uFE0F Warning: "}),c.appendText("TaskNotes will read AND write using these property names. Changing these after creating tasks may cause inconsistencies."),Se(n,"Configure which frontmatter properties TaskNotes should use for each field."),Rj(n,e,t),io(n,{name:"Reset field mappings",desc:"Reset all field mappings to default values",buttonText:"Reset to Defaults",onClick:async()=>{try{let{DEFAULT_FIELD_MAPPING:u}=await Promise.resolve().then(()=>($p(),OP));e.settings.fieldMapping={...u},t(),qp(n.parentElement,e,t),new gi.Notice("Field mappings reset to defaults")}catch(u){console.error("Error resetting field mappings:",u),new gi.Notice("Failed to reset field mappings")}}}),Me(n,"Custom User Fields"),Se(n,"Define custom frontmatter properties to appear as type-aware filter options across views. Each row: Display Name, Property Name, Type."),e.settings.userField&&e.settings.userField.enabled){let u=e.settings.userField,f=(u.displayName||u.key||"field").toLowerCase().replace(/[^a-z0-9_-]/g,"-");e.settings.userFields.find(h=>h.id===f||h.key===u.key)||(e.settings.userFields.push({id:f,displayName:u.displayName||"",key:u.key||"",type:u.type||"text"}),t())}let d=n.createDiv("tasknotes-user-fields-container");Pl(d,e,t),new gi.Setting(n).setName("Add new user field").setDesc("Create a new custom field that will appear in filters and views").addButton(u=>u.setButtonText("Add user field").onClick(async()=>{e.settings.userFields||(e.settings.userFields=[]);let h={id:`field_${Date.now()}`,displayName:"",key:"",type:"text"};e.settings.userFields.push(h),t(),Pl(d,e,t)}))}function zp(n,e,t){if(n.empty(),!e.settings.customStatuses||e.settings.customStatuses.length===0){na(n,"No custom statuses configured. Add a status to get started.","Add Status",()=>{let s=document.querySelector('[data-setting-name="Add new status"] button');s&&s.click()});return}[...e.settings.customStatuses].sort((s,i)=>s.order-i.order).forEach(s=>{let i=Ht("text","in-progress",s.value),a=Ht("text","In Progress",s.label),o=Ht("color","",s.color),l=document.createElement("input");l.type="checkbox",l.checked=s.isCompleted||!1,l.addClass("tasknotes-card-input");let c=document.createElement("input");c.type="checkbox",c.checked=s.autoArchive||!1,c.addClass("tasknotes-card-input");let d=oo(1,1440,1,s.autoArchiveDelay||5),u=s.isCompleted?[sa("Completed","completed")]:[],f=()=>{if(confirm(`Are you sure you want to delete the status "${s.label||s.value}"?`)){let y=e.settings.customStatuses.findIndex(T=>T.id===s.id);y!==-1&&(e.settings.customStatuses.splice(y,1),e.settings.customStatuses.forEach((T,w)=>{T.order=w}),t(),zp(n,e,t))}},h={id:s.id,draggable:!0,collapsible:!0,defaultCollapsed:!0,colorIndicator:{color:s.color,cssVar:"--status-color"},header:{primaryText:s.value||"untitled",secondaryText:s.label||"No label",meta:u,actions:[Fn(f)]},content:{sections:[{rows:[{label:"Value:",input:i},{label:"Label:",input:a},{label:"Color:",input:o},{label:"Completed:",input:l},{label:"Auto-archive:",input:c},{label:"Delay (minutes):",input:d}]}]}},p=Ln(n,h),m=()=>{let g=d.closest(".tasknotes-settings__card-config-row");g&&(g.style.display=s.autoArchive?"flex":"none")};m(),i.addEventListener("change",()=>{s.value=i.value,p.querySelector(".tasknotes-settings__card-primary-text").textContent=s.value||"untitled",t()}),a.addEventListener("change",()=>{s.label=a.value,p.querySelector(".tasknotes-settings__card-secondary-text").textContent=s.label||"No label",t()}),o.addEventListener("change",()=>{s.color=o.value;let g=p.querySelector(".tasknotes-settings__card-color-indicator");g&&(g.style.backgroundColor=s.color),t()}),l.addEventListener("change",()=>{s.isCompleted=l.checked;let g=p.querySelector(".tasknotes-settings__card-meta");g&&(g.empty(),s.isCompleted&&g.appendChild(sa("Completed","completed"))),t()}),c.addEventListener("change",()=>{s.autoArchive=c.checked,t(),m()}),d.addEventListener("change",()=>{let g=parseInt(d.value);!isNaN(g)&&g>=1&&g<=1440&&(s.autoArchiveDelay=g,t())}),FP(p,n,(g,y,T)=>{let w=e.settings.customStatuses.findIndex(x=>x.id===g),b=e.settings.customStatuses.findIndex(x=>x.id===y);if(w===-1||b===-1)return;let E=[...e.settings.customStatuses],[S]=E.splice(w,1),D=b;w<b&&(D=b-1),T||D++,E.splice(D,0,S),E.forEach((x,M)=>{x.order=M}),e.settings.customStatuses=E,t(),zp(n,e,t)})})}function aT(n,e,t){if(n.empty(),!e.settings.customPriorities||e.settings.customPriorities.length===0){na(n,"No custom priorities configured. Add a priority to get started.","Add Priority",()=>{let s=document.querySelector('[data-setting-name="Add new priority"] button');s&&s.click()});return}[...e.settings.customPriorities].sort((s,i)=>i.weight-s.weight).forEach((s,i)=>{let a=Ht("text","high",s.value),o=Ht("text","High Priority",s.label),l=Ht("color","",s.color),c=oo(0,void 0,1,s.weight),d=Ln(n,{id:s.id,collapsible:!0,defaultCollapsed:!0,colorIndicator:{color:s.color},header:{primaryText:s.label||s.value||"untitled",secondaryText:`Weight: ${s.weight}`,actions:[Fn(()=>{if(e.settings.customPriorities.length<=1){new gi.Notice("You must have at least one priority");return}e.settings.customPriorities.splice(i,1),t(),aT(n,e,t)},"Delete priority")]},content:{sections:[{rows:[{label:"Value:",input:a},{label:"Label:",input:o},{label:"Color:",input:l},{label:"Weight:",input:c}]}]}});a.addEventListener("change",()=>{s.value=a.value,t()}),o.addEventListener("change",()=>{s.label=o.value,d.querySelector(".tasknotes-settings__card-primary-text").textContent=s.label||s.value||"untitled",t()}),l.addEventListener("change",()=>{s.color=l.value;let u=d.querySelector(".tasknotes-settings__card-color-indicator");u&&(u.style.backgroundColor=s.color),t()}),c.addEventListener("input",()=>{let u=parseInt(c.value);!isNaN(u)&&u>=0&&(s.weight=u,d.querySelector(".tasknotes-settings__card-secondary-text").textContent=`Weight: ${s.weight}`,t())})})}function Rj(n,e,t){let r=n.createEl("table",{cls:"tasknotes-settings__table"}),s=r.createEl("tr");s.createEl("th",{cls:"tasknotes-settings__table-header",text:"TaskNotes field"}),s.createEl("th",{cls:"tasknotes-settings__table-header",text:"Your property name"}),[["title","Title"],["status","Status"],["priority","Priority"],["due","Due date"],["scheduled","Scheduled date"],["contexts","Contexts"],["projects","Projects"],["timeEstimate","Time estimate"],["recurrence","Recurrence"],["dateCreated","Created date"],["completedDate","Completed date"],["dateModified","Modified date"],["archiveTag","Archive tag"],["timeEntries","Time entries"],["completeInstances","Complete instances"],["pomodoros","Pomodoros"],["icsEventId","ICS Event ID"],["icsEventTag","ICS Event Tag"],["reminders","Reminders"]].forEach(([a,o])=>{let l=r.createEl("tr",{cls:"tasknotes-settings__table-row"}),c=l.createEl("td",{cls:"tasknotes-settings__table-cell"});c.textContent=o;let u=l.createEl("td",{cls:"tasknotes-settings__table-cell"}).createEl("input",{type:"text",cls:"settings-input field-mapping-input",value:e.settings.fieldMapping[a]||"",attr:{placeholder:a,"aria-label":`Property name for ${o}`}});u.addEventListener("change",async()=>{try{e.settings.fieldMapping[a]=u.value,t()}catch(f){console.error(`Error updating field mapping for ${a}:`,f),new gi.Notice(`Failed to update field mapping for ${o}. Please try again.`)}})})}function Pl(n,e,t){if(n.empty(),e.settings.userFields||(e.settings.userFields=[]),e.settings.userFields.length===0){na(n,"No custom user fields configured. Add a field to create custom properties for your tasks.","Add User Field",()=>{let r=document.querySelector('[data-setting-name="Add new user field"] button');r&&r.click()});return}e.settings.userFields.forEach((r,s)=>{let i=Ht("text","Display Name",r.displayName),a=Ht("text","property-name",r.key),o=ao([{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"},{value:"list",label:"List"}],r.type);i.addEventListener("change",()=>{r.displayName=i.value,t(),Pl(n,e,t)}),a.addEventListener("change",()=>{r.key=a.value,t(),Pl(n,e,t)}),o.addEventListener("change",()=>{r.type=o.value,t(),Pl(n,e,t)}),Ln(n,{id:r.id,collapsible:!0,defaultCollapsed:!0,header:{primaryText:r.displayName||"Unnamed Field",secondaryText:r.key||"no-key",meta:[sa(r.type.charAt(0).toUpperCase()+r.type.slice(1),"default")],actions:[Fn(()=>{e.settings.userFields&&(e.settings.userFields.splice(s,1),t(),Pl(n,e,t))},"Delete field")]},content:{sections:[{rows:[{label:"Display Name:",input:i},{label:"Property Key:",input:a},{label:"Type:",input:o}]}]}})})}var lT=require("obsidian");var Hn=require("obsidian");var lo=class{constructor(e){this.deps=e}stringifyFmValue(e){if(e==null)return"";if(Array.isArray(e))return e.map(s=>this.stringifyFmValue(s)).filter(Boolean).join(", ");let t=typeof e;if(t==="string"){let s=e.trim(),i=s.match(/^\[\[([^\]]+)\]\]$/);if(i){let l=i[1].split("|");if(l.length>1&&l[1].trim())return l[1].trim();let c=l[0].split("#")[0].trim();return(c.split("/").pop()||c).replace(/\.md$/i,"")}let a=s.match(/^\[([^\]]+)\]\(([^)]+)\)$/);return a?a[1].trim():s}if(t==="number"||t==="boolean")return String(e);if(t==="object"){let r=e;if(typeof r.path=="string"){let s=r.path;return(s.split("/").pop()||s).replace(/\.md$/i,"")}return""}return""}resolve(e,t){if(!e)return"";if(e.startsWith("file."))switch(e){case"file.basename":return t.basename||"";case"file.name":return t.name||"";case"file.path":return t.path||"";case"file.parent":return t.parent||"";default:return""}if(e==="title")return t.title||"";if(e==="aliases"){let i=t.aliases||[];return i.length?i.join(", "):""}let r=e;e.startsWith("frontmatter:")&&(r=e.slice(12));let s=this.deps.getFrontmatter(t)||{};return this.stringifyFmValue(s[r])}};Gp();oT();var _l=class extends Hn.FuzzySuggestModal{constructor(e,t,r){super(e),this.plugin=t,this.onChoose=r,this.setPlaceholder("Type to search for project notes..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){var i,a,o,l,c,d,u;let e=this.app.vault.getAllLoadedFiles().filter(f=>f instanceof Hn.TFile&&f.extension==="md"&&!f.path.includes(".trash")),t=(o=(a=(i=this.plugin.settings)==null?void 0:i.projectAutosuggest)==null?void 0:a.requiredTags)!=null?o:[],r=(d=(c=(l=this.plugin.settings)==null?void 0:l.projectAutosuggest)==null?void 0:c.includeFolders)!=null?d:[],s=Qp((u=this.plugin.settings)==null?void 0:u.projectAutosuggest);return t.length===0&&r.length===0&&!s.enabled?e:e.filter(f=>{var p,m;if(!(f instanceof Hn.TFile))return!1;let h=this.app.metadataCache.getFileCache(f);if(t.length>0){let g=((p=h==null?void 0:h.tags)==null?void 0:p.map(b=>b.tag.replace("#","")))||[],y=((m=h==null?void 0:h.frontmatter)==null?void 0:m.tags)||[],T=[...g,...Array.isArray(y)?y:[y].filter(Boolean)];if(!t.some(b=>T.includes(b)))return!1}if(r.length>0&&!r.some(y=>f.path.startsWith(y)||f.path.startsWith(y+"/")))return!1;if(s.enabled){let g=h==null?void 0:h.frontmatter;if(!Kp(g,s))return!1}return!0})}getItemText(e){var a,o,l,c;if(!(e instanceof Hn.TFile))return e.name;let t=`${e.name} ${e.path}`,r=(l=(o=(a=this.plugin.settings)==null?void 0:a.projectAutosuggest)==null?void 0:o.rows)!=null?l:[],s=new Set;for(let d of r)try{let u=ia(d);for(let f of u)f.searchable&&!f.property.startsWith("literal:")&&s.add(f.property)}catch(u){}let i=this.app.metadataCache.getFileCache(e);if(i!=null&&i.frontmatter){let d=this.plugin.fieldMapper.mapFromFrontmatter(i.frontmatter,e.path,this.plugin.settings.storeTitleInFilename),u=typeof d.title=="string"?d.title:"";u&&(t+=` ${u}`);let f=(0,Hn.parseFrontMatterAliases)(i.frontmatter)||[];Array.isArray(f)&&f.length>0&&(t+=` ${f.join(" ")}`);for(let h of s){let p="";switch(h){case"file.path":p=e.path;break;case"file.parent":p=((c=e.parent)==null?void 0:c.name)||"";break;case"file.basename":p=e.basename;break;case"title":case"aliases":break;default:let m=i.frontmatter[h];m!=null&&(p=Array.isArray(m)?m.join(" "):String(m));break}p&&(t+=` ${p}`)}}return t}renderSuggestion(e,t){var a,o,l,c,d;let r=e.item;if(t.empty(),!(r instanceof Hn.TFile)){t.textContent=r.name;return}let s=t.createDiv({cls:"project-suggestion"}),i=((l=(o=(a=this.plugin.settings)==null?void 0:a.projectAutosuggest)==null?void 0:o.rows)!=null?l:[]).slice(0,3);if(i.length===0){s.createSpan({cls:"project-name",text:r.basename});return}try{let u=this.app.metadataCache.getFileCache(r),f=(u==null?void 0:u.frontmatter)||{},h=this.plugin.fieldMapper.mapFromFrontmatter(f,r.path,this.plugin.settings.storeTitleInFilename),p=typeof h.title=="string"?h.title:"",m=(0,Hn.parseFrontMatterAliases)(f)||[],g=Array.isArray(m)?m.filter(b=>typeof b=="string"):[],y={basename:r.basename,name:r.name,path:r.path,parent:((c=r.parent)==null?void 0:c.path)||"",title:p,aliases:g,frontmatter:f},T=new lo({getFrontmatter:()=>f}),w=s.createDiv({cls:"project-name",text:r.basename});for(let b=0;b<Math.min(i.length,3);b++){let E=i[b];if(E)try{let S=ia(E),D=[];for(let M of S){if(M.property.startsWith("literal:")){D.push(M.property.slice(8));continue}let B=T.resolve(M.property,y)||"";if(B)if(M.showName){let Q=(d=M.displayName)!=null?d:M.property;D.push(`${Q}: ${B}`)}else D.push(B)}let x=D.join(" ");if(x.trim()){let M=s.createDiv({cls:"project-meta"});M.textContent=x}}catch(S){}}}catch(u){console.error("Error rendering project suggestion:",u),s.createSpan({cls:"project-name",text:r.basename})}}onChooseItem(e,t){this.onChoose(e)}};Al();function Zp(n,e,t){n.empty(),Me(n,"Basic Defaults"),Se(n,"Set default values for new tasks to speed up task creation."),gt(n,{name:"Default status",desc:"Default status for new tasks",options:e.settings.customStatuses.map(o=>({value:o.value,label:o.label||o.value})),getValue:()=>e.settings.defaultTaskStatus,setValue:async o=>{e.settings.defaultTaskStatus=o,t()}}),gt(n,{name:"Default priority",desc:"Default priority for new tasks",options:[{value:"",label:"No default"},...e.settings.customPriorities.map(o=>({value:o.value,label:o.label||o.value}))],getValue:()=>e.settings.defaultTaskPriority,setValue:async o=>{e.settings.defaultTaskPriority=o,t()}}),Xe(n,{name:"Default contexts",desc:"Comma-separated list of default contexts (e.g., @home, @work)",placeholder:"@home, @work",getValue:()=>e.settings.taskCreationDefaults.defaultContexts,setValue:async o=>{e.settings.taskCreationDefaults.defaultContexts=o,t()}}),Xe(n,{name:"Default tags",desc:"Comma-separated list of default tags (without #)",placeholder:"important, urgent",getValue:()=>e.settings.taskCreationDefaults.defaultTags,setValue:async o=>{e.settings.taskCreationDefaults.defaultTags=o,t()}});let r=[],s=n.createDiv("default-projects-container"),i=s.createDiv();new lT.Setting(i).setName("Default projects").setDesc("Default project links for new tasks").addButton(o=>{o.setButtonText("Select Projects").setTooltip("Choose project notes to link by default").onClick(()=>{new _l(e.app,e,c=>{if(!r.includes(c)){r.push(c);let d=r.map(u=>`[[${u.path.replace(/\.md$/,"")}]]`).join(", ");e.settings.taskCreationDefaults.defaultProjects=d,t(),cT(s,e,t,r)}}).open()}),o.buttonEl.addClass("tn-btn"),o.buttonEl.addClass("tn-btn--ghost")}),e.settings.taskCreationDefaults.defaultProjects&&bn(e.settings.taskCreationDefaults.defaultProjects).map(l=>l.replace(/\[\[|\]\]/g,"").trim()).filter(l=>l).forEach(l=>{let c=e.app.vault.getAbstractFileByPath(l+".md")||e.app.vault.getAbstractFileByPath(l);c&&r.push(c)}),cT(s,e,t,r),ke(n,{name:"Use parent note as project during instant conversion",desc:"Automatically link the parent note as a project when using instant task conversion",getValue:()=>e.settings.taskCreationDefaults.useParentNoteAsProject,setValue:async o=>{e.settings.taskCreationDefaults.useParentNoteAsProject=o,t()}}),Kr(n,{name:"Default time estimate",desc:"Default time estimate in minutes (0 = no default)",placeholder:"60",min:0,getValue:()=>e.settings.taskCreationDefaults.defaultTimeEstimate,setValue:async o=>{e.settings.taskCreationDefaults.defaultTimeEstimate=o,t()}}),gt(n,{name:"Default recurrence",desc:"Default recurrence pattern for new tasks",options:[{value:"none",label:"None"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}],getValue:()=>e.settings.taskCreationDefaults.defaultRecurrence,setValue:async o=>{e.settings.taskCreationDefaults.defaultRecurrence=o,t()}}),Me(n,"Date Defaults"),Se(n,"Set default due and scheduled dates for new tasks."),gt(n,{name:"Default due date",desc:"Default due date for new tasks",options:[{value:"none",label:"None"},{value:"today",label:"Today"},{value:"tomorrow",label:"Tomorrow"},{value:"next-week",label:"Next week"}],getValue:()=>e.settings.taskCreationDefaults.defaultDueDate,setValue:async o=>{e.settings.taskCreationDefaults.defaultDueDate=o,t()}}),gt(n,{name:"Default scheduled date",desc:"Default scheduled date for new tasks",options:[{value:"none",label:"None"},{value:"today",label:"Today"},{value:"tomorrow",label:"Tomorrow"},{value:"next-week",label:"Next week"}],getValue:()=>e.settings.taskCreationDefaults.defaultScheduledDate,setValue:async o=>{e.settings.taskCreationDefaults.defaultScheduledDate=o,t()}}),Me(n,"Default reminders"),Se(n,"Configure default reminders that will be added to new tasks.");let a=n.createDiv("tasknotes-reminders-container");if(dT(a,e,t),new lT.Setting(n).setName("Add default reminder").setDesc("Create a new default reminder that will be added to all new tasks").addButton(o=>o.setButtonText("Add reminder").onClick(async()=>{let c={id:`reminder_${Date.now()}`,type:"relative",relatedTo:"due",offset:1,unit:"hours",direction:"before",description:"Reminder"};e.settings.taskCreationDefaults.defaultReminders=e.settings.taskCreationDefaults.defaultReminders||[],e.settings.taskCreationDefaults.defaultReminders.push(c),t(),dT(a,e,t)})),Me(n,"Body Template"),Se(n,"Configure a template file to use for new task content."),ke(n,{name:"Use body template",desc:"Use a template file for task body content",getValue:()=>e.settings.taskCreationDefaults.useBodyTemplate,setValue:async o=>{e.settings.taskCreationDefaults.useBodyTemplate=o,t(),Zp(n,e,t)}}),e.settings.taskCreationDefaults.useBodyTemplate&&Xe(n,{name:"Body template file",desc:"Path to template file for task body content. Supports template variables like {{title}}, {{date}}, {{time}}, {{priority}}, {{status}}, etc.",placeholder:"Templates/Task Template.md",getValue:()=>e.settings.taskCreationDefaults.bodyTemplate,setValue:async o=>{e.settings.taskCreationDefaults.bodyTemplate=o,t()},ariaLabel:"Path to body template file"}),e.settings.taskCreationDefaults.useBodyTemplate){let o=n.createDiv("tasknotes-settings__help-section");o.createEl("h4",{text:"Template variables:"});let l=o.createEl("ul");l.createEl("li",{text:"{{title}} - Task title"}),l.createEl("li",{text:"{{details}} - User-provided details from modal"}),l.createEl("li",{text:"{{date}} - Current date (YYYY-MM-DD)"}),l.createEl("li",{text:"{{time}} - Current time (HH:MM)"}),l.createEl("li",{text:"{{priority}} - Task priority"}),l.createEl("li",{text:"{{status}} - Task status"}),l.createEl("li",{text:"{{contexts}} - Task contexts"}),l.createEl("li",{text:"{{tags}} - Task tags"}),l.createEl("li",{text:"{{projects}} - Task projects"})}Me(n,"Instant Task Conversion"),Se(n,"Configure behavior when converting text to tasks instantly."),ke(n,{name:"Use task defaults on instant convert",desc:"Apply default task settings when converting text to tasks instantly",getValue:()=>e.settings.useDefaultsOnInstantConvert,setValue:async o=>{e.settings.useDefaultsOnInstantConvert=o,t()}})}function cT(n,e,t,r){let s=n.querySelector(".default-projects-list");if(s&&s.remove(),r.length===0)return;let i=n.createDiv("default-projects-list");r.forEach(a=>{Ln(i,{id:a.path,collapsible:!0,defaultCollapsed:!0,header:{primaryText:a.name.replace(/\.md$/,""),actions:[Fn(()=>{let o=r.indexOf(a);if(o>-1){r.splice(o,1);let l=r.map(c=>`[[${c.path.replace(/\.md$/,"")}]]`).join(", ");e.settings.taskCreationDefaults.defaultProjects=l,t(),cT(n,e,t,r)}},`Remove ${a.name} from default projects`)]}})})}function BP(n,e){let t=oo(1,void 0,1,n.offset);t.addEventListener("input",()=>{let a=parseInt(t.value);!isNaN(a)&&a>0&&e({offset:a})});let r=ao([{value:"minutes",label:"minutes"},{value:"hours",label:"hours"},{value:"days",label:"days"}],n.unit);r.addEventListener("change",()=>{e({unit:r.value})});let s=ao([{value:"before",label:"before"},{value:"after",label:"after"}],n.direction);s.addEventListener("change",()=>{e({direction:s.value})});let i=ao([{value:"due",label:"due date"},{value:"scheduled",label:"scheduled date"}],n.relatedTo);return i.addEventListener("change",()=>{e({relatedTo:i.value})}),[{label:"Offset:",input:t},{label:"Unit:",input:r},{label:"Direction:",input:s},{label:"Related to:",input:i}]}function UP(n,e){let t=Ht("date",n.absoluteDate||new Date().toISOString().split("T")[0]);t.addEventListener("input",()=>{e({absoluteDate:t.value})});let r=Ht("time",n.absoluteTime||"09:00");return r.addEventListener("input",()=>{e({absoluteTime:r.value})}),[{label:"Date:",input:t},{label:"Time:",input:r}]}function dT(n,e,t){if(n.empty(),!e.settings.taskCreationDefaults.defaultReminders||e.settings.taskCreationDefaults.defaultReminders.length===0){na(n,"No default reminders configured. Add a reminder to automatically notify you about new tasks.","Add Reminder",()=>{let r=document.querySelector('[data-setting-name="Add default reminder"] button');r&&r.click()});return}e.settings.taskCreationDefaults.defaultReminders.forEach((r,s)=>{let i=jP(r),a=Ht("text","Reminder description",r.description),o=ao([{value:"relative",label:"Relative (before/after task dates)"},{value:"absolute",label:"Absolute (specific date/time)"}],r.type),l=u=>{Object.assign(r,u),t();let f=n.querySelector(`[data-card-id="${r.id}"]`);if(f){let h=f.querySelector(".tasknotes-settings__card-secondary-text");h&&(h.textContent=jP(r))}},c=r.type==="relative"?BP(r,l):UP(r,l),d=Ln(n,{id:r.id,collapsible:!0,defaultCollapsed:!0,header:{primaryText:r.description||"Unnamed Reminder",secondaryText:i,actions:[Fn(()=>{e.settings.taskCreationDefaults.defaultReminders.splice(s,1),t(),dT(n,e,t)},"Delete reminder")]},content:{sections:[{rows:[{label:"Description:",input:a},{label:"Type:",input:o}]},{rows:c}]}});a.addEventListener("input",()=>{r.description=a.value,t();let u=d.querySelector(".tasknotes-settings__card-primary-text");u&&(u.textContent=r.description||"Unnamed Reminder")}),o.addEventListener("change",()=>{r.type=o.value,t();let u=r.type==="relative"?BP(r,l):UP(r,l),f=d.querySelector(".tasknotes-settings__card-content");if(f&&f.children[1]){let h=document.createElement("div");u.forEach(p=>{let m=h.createDiv("tasknotes-settings__card-config-row");p.fullWidth&&(m.style.flexDirection="column",m.style.alignItems="flex-start",m.style.gap="0.5rem");let g=m.createSpan("tasknotes-settings__card-config-label");g.textContent=p.label,m.appendChild(p.input)}),f.replaceChild(h,f.children[1])}})})}function jP(n){if(n.type==="relative"){let e=n.direction==="before"?"before":"after",t=n.unit||"hours",r=n.offset||1,s=n.relatedTo==="due"?"due date":"scheduled date";return`${r} ${t} ${e} ${s}`}else{let e=n.absoluteDate||"No date",t=n.absoluteTime||"No time";return`${e} at ${t}`}}var WP=require("obsidian");function yi(n,e,t){var c;n.empty(),Me(n,"Task Cards"),Se(n,"Configure how task cards are displayed across all views.");let r=n.createDiv("visible-properties-container"),s=r.createDiv();new WP.Setting(s).setName("Default visible properties").setDesc("Choose which properties appear on task cards by default.");let i={core:[{key:"status",label:"Status Dot"},{key:"priority",label:"Priority Dot"},{key:"due",label:"Due Date"},{key:"scheduled",label:"Scheduled Date"},{key:"timeEstimate",label:"Time Estimate"},{key:"totalTrackedTime",label:"Total Tracked Time"},{key:"recurrence",label:"Recurrence"},{key:"completedDate",label:"Completed Date"},{key:"file.ctime",label:"Created Date"},{key:"file.mtime",label:"Modified Date"}],organization:[{key:"projects",label:"Projects"},{key:"contexts",label:"Contexts"},{key:"tags",label:"Tags"}],user:[]};e.settings.userFields&&e.settings.userFields.forEach(d=>{d.displayName&&d.key&&i.user.push({key:`user:${d.id}`,label:d.displayName})});let a=e.settings.defaultVisibleProperties||[],o=r.createDiv("tasknotes-settings__properties-container"),l=(d,u)=>{if(u.length===0)return;let f=o.createDiv("tasknotes-settings__property-group"),h=f.createDiv("tasknotes-settings__property-group-header");h.textContent=d;let p=f.createDiv("tasknotes-settings__property-toggles");u.forEach(m=>{let g=p.createDiv("tasknotes-settings__property-toggle"),y=g.createEl("input",{type:"checkbox",cls:"tasknotes-settings__property-checkbox",attr:{id:`visible-prop-${m.key}`,"aria-label":`Show ${m.label} on task cards`}});y.checked=a.includes(m.key);let T=g.createEl("label",{text:m.label,cls:"tasknotes-settings__property-label",attr:{for:`visible-prop-${m.key}`}});y.addEventListener("change",()=>{let w=[...a];y.checked?w.includes(m.key)||w.push(m.key):w=w.filter(b=>b!==m.key),e.settings.defaultVisibleProperties=w,t()})})};if(l("CORE PROPERTIES",i.core),l("ORGANIZATION",i.organization),i.user.length>0&&l("CUSTOM PROPERTIES",i.user),Me(n,"Task Filenames"),Se(n,"Configure how task files are named when created."),ke(n,{name:"Store title in filename",desc:"Use the task title as the filename. Filename will update when the task title is changed (Recommended).",getValue:()=>e.settings.storeTitleInFilename,setValue:async d=>{e.settings.storeTitleInFilename=d,t(),yi(n,e,t)}}),e.settings.storeTitleInFilename||(gt(n,{name:"Filename format",desc:"How task filenames should be generated",options:[{value:"title",label:"Task title (Non-updating)"},{value:"zettel",label:"Zettelkasten format (YYMMDD + base36 seconds since midnight)"},{value:"timestamp",label:"Full timestamp (YYYY-MM-DD-HHMMSS)"},{value:"custom",label:"Custom template"}],getValue:()=>e.settings.taskFilenameFormat,setValue:async d=>{e.settings.taskFilenameFormat=d,t(),yi(n,e,t)},ariaLabel:"Task filename generation format"}),e.settings.taskFilenameFormat==="custom"&&(Xe(n,{name:"Custom filename template",desc:"Template for custom filenames. Available variables: {title}, {titleLower}, {titleUpper}, {titleSnake}, {titleKebab}, {titleCamel}, {titlePascal}, {date}, {shortDate}, {time}, {time12}, {time24}, {timestamp}, {dateTime}, {year}, {month}, {monthName}, {monthNameShort}, {day}, {dayName}, {dayNameShort}, {hour}, {hour12}, {minute}, {second}, {milliseconds}, {ms}, {ampm}, {week}, {quarter}, {unix}, {unixMs}, {timezone}, {timezoneShort}, {utcOffset}, {utcOffsetShort}, {utcZ}, {zettel}, {nano}, {priority}, {priorityShort}, {status}, {statusShort}, {dueDate}, {scheduledDate}",placeholder:"{date}-{title}-{dueDate}",getValue:()=>e.settings.customFilenameTemplate,setValue:async d=>{e.settings.customFilenameTemplate=d,t()},ariaLabel:"Custom filename template with variables"}),Se(n,"Note: {dueDate} and {scheduledDate} are in YYYY-MM-DD format and will be empty if not set."))),Me(n,"Display Formatting"),Se(n,"Configure how dates, times, and other data are displayed across the plugin."),gt(n,{name:"Time format",desc:"Display time in 12-hour or 24-hour format throughout the plugin",options:[{value:"12",label:"12-hour (AM/PM)"},{value:"24",label:"24-hour"}],getValue:()=>e.settings.calendarViewSettings.timeFormat,setValue:async d=>{e.settings.calendarViewSettings.timeFormat=d,t()}}),Me(n,"Calendar View"),Se(n,"Customize the appearance and behavior of the calendar view."),gt(n,{name:"Default view",desc:"The calendar view shown when opening the calendar tab",options:[{value:"dayGridMonth",label:"Month Grid"},{value:"timeGridWeek",label:"Week Timeline"},{value:"timeGridDay",label:"Day Timeline"},{value:"multiMonthYear",label:"Year View"},{value:"timeGridCustom",label:"Custom Multi-Day"}],getValue:()=>e.settings.calendarViewSettings.defaultView,setValue:async d=>{e.settings.calendarViewSettings.defaultView=d,t(),yi(n,e,t)}}),e.settings.calendarViewSettings.defaultView==="timeGridCustom"&&Kr(n,{name:"Custom view day count",desc:"Number of days to show in custom multi-day view",placeholder:"3",min:2,max:10,getValue:()=>e.settings.calendarViewSettings.customDayCount,setValue:async d=>{e.settings.calendarViewSettings.customDayCount=d,t()}}),gt(n,{name:"First day of week",desc:"Which day should be the first column in week views",options:[{value:"0",label:"Sunday"},{value:"1",label:"Monday"},{value:"2",label:"Tuesday"},{value:"3",label:"Wednesday"},{value:"4",label:"Thursday"},{value:"5",label:"Friday"},{value:"6",label:"Saturday"}],getValue:()=>e.settings.calendarViewSettings.firstDay.toString(),setValue:async d=>{e.settings.calendarViewSettings.firstDay=parseInt(d),t()}}),ke(n,{name:"Show weekends",desc:"Display weekends in calendar views",getValue:()=>e.settings.calendarViewSettings.showWeekends,setValue:async d=>{e.settings.calendarViewSettings.showWeekends=d,t()}}),ke(n,{name:"Show week numbers",desc:"Display week numbers in calendar views",getValue:()=>e.settings.calendarViewSettings.weekNumbers,setValue:async d=>{e.settings.calendarViewSettings.weekNumbers=d,t()}}),ke(n,{name:"Show today highlight",desc:"Highlight the current day in calendar views",getValue:()=>e.settings.calendarViewSettings.showTodayHighlight,setValue:async d=>{e.settings.calendarViewSettings.showTodayHighlight=d,t()}}),ke(n,{name:"Show current time indicator",desc:"Display a line showing the current time in timeline views",getValue:()=>e.settings.calendarViewSettings.nowIndicator,setValue:async d=>{e.settings.calendarViewSettings.nowIndicator=d,t()}}),ke(n,{name:"Selection mirror",desc:"Show a visual preview while dragging to select time ranges",getValue:()=>e.settings.calendarViewSettings.selectMirror,setValue:async d=>{e.settings.calendarViewSettings.selectMirror=d,t()}}),Xe(n,{name:"Calendar locale",desc:'Calendar locale for date formatting and calendar system (e.g., "en", "fa" for Farsi/Persian, "de" for German). Leave empty to auto-detect from browser.',placeholder:"Auto-detect",getValue:()=>e.settings.calendarViewSettings.locale||"",setValue:async d=>{e.settings.calendarViewSettings.locale=d,t()}}),Me(n,"Default Event Visibility"),Se(n,"Configure which event types are visible by default when opening the Advanced Calendar. Users can still toggle these on/off in the calendar view."),ke(n,{name:"Show scheduled tasks",desc:"Display tasks with scheduled dates by default",getValue:()=>e.settings.calendarViewSettings.defaultShowScheduled,setValue:async d=>{e.settings.calendarViewSettings.defaultShowScheduled=d,t()}}),ke(n,{name:"Show due dates",desc:"Display task due dates by default",getValue:()=>e.settings.calendarViewSettings.defaultShowDue,setValue:async d=>{e.settings.calendarViewSettings.defaultShowDue=d,t()}}),ke(n,{name:"Show due dates when scheduled",desc:"Display due dates even for tasks that already have scheduled dates",getValue:()=>e.settings.calendarViewSettings.defaultShowDueWhenScheduled,setValue:async d=>{e.settings.calendarViewSettings.defaultShowDueWhenScheduled=d,t()}}),ke(n,{name:"Show time entries",desc:"Display completed time tracking entries by default",getValue:()=>e.settings.calendarViewSettings.defaultShowTimeEntries,setValue:async d=>{e.settings.calendarViewSettings.defaultShowTimeEntries=d,t()}}),ke(n,{name:"Show recurring tasks",desc:"Display recurring task instances by default",getValue:()=>e.settings.calendarViewSettings.defaultShowRecurring,setValue:async d=>{e.settings.calendarViewSettings.defaultShowRecurring=d,t()}}),ke(n,{name:"Show ICS events",desc:"Display events from ICS subscriptions by default",getValue:()=>e.settings.calendarViewSettings.defaultShowICSEvents,setValue:async d=>{e.settings.calendarViewSettings.defaultShowICSEvents=d,t()}}),Me(n,"Time Settings"),Se(n,"Configure time-related display settings for timeline views."),gt(n,{name:"Time slot duration",desc:"Duration of each time slot in timeline views",options:[{value:"00:15:00",label:"15 minutes"},{value:"00:30:00",label:"30 minutes"},{value:"01:00:00",label:"60 minutes"}],getValue:()=>e.settings.calendarViewSettings.slotDuration,setValue:async d=>{e.settings.calendarViewSettings.slotDuration=d,t()}}),Xe(n,{name:"Start time",desc:"Earliest time shown in timeline views (HH:MM format)",placeholder:"06:00",getValue:()=>e.settings.calendarViewSettings.slotMinTime.slice(0,5),setValue:async d=>{e.settings.calendarViewSettings.slotMinTime=d+":00",t()}}),Xe(n,{name:"End time",desc:"Latest time shown in timeline views (HH:MM format)",placeholder:"22:00",getValue:()=>e.settings.calendarViewSettings.slotMaxTime.slice(0,5),setValue:async d=>{e.settings.calendarViewSettings.slotMaxTime=d+":00",t()}}),Xe(n,{name:"Initial scroll time",desc:"Time to scroll to when opening timeline views (HH:MM format)",placeholder:"09:00",getValue:()=>e.settings.calendarViewSettings.scrollTime.slice(0,5),setValue:async d=>{e.settings.calendarViewSettings.scrollTime=d+":00",t()}}),Me(n,"UI Elements"),Se(n,"Configure the display of various UI elements."),ke(n,{name:"Show tracked tasks in status bar",desc:"Display currently tracked tasks in Obsidian's status bar",getValue:()=>e.settings.showTrackedTasksInStatusBar,setValue:async d=>{e.settings.showTrackedTasksInStatusBar=d,t()}}),ke(n,{name:"Show project subtasks widget",desc:"Display a widget showing subtasks for the current project note",getValue:()=>e.settings.showProjectSubtasks,setValue:async d=>{e.settings.showProjectSubtasks=d,t(),yi(n,e,t)}}),e.settings.showProjectSubtasks&&gt(n,{name:"Project subtasks position",desc:"Where to position the project subtasks widget",options:[{value:"top",label:"Top of note"},{value:"bottom",label:"Bottom of note"}],getValue:()=>e.settings.projectSubtasksPosition,setValue:async d=>{e.settings.projectSubtasksPosition=d,t()}}),ke(n,{name:"Show expandable subtasks",desc:"Allow expanding/collapsing subtask sections in task cards",getValue:()=>e.settings.showExpandableSubtasks,setValue:async d=>{e.settings.showExpandableSubtasks=d,t(),yi(n,e,t)}}),e.settings.showExpandableSubtasks&&gt(n,{name:"Subtask chevron position",desc:"Position of expand/collapse chevrons in task cards",options:[{value:"left",label:"Left side"},{value:"right",label:"Right side"}],getValue:()=>e.settings.subtaskChevronPosition,setValue:async d=>{e.settings.subtaskChevronPosition=d,t()}}),gt(n,{name:"Views button alignment",desc:"Alignment of the views/filters button in the task interface",options:[{value:"left",label:"Left side"},{value:"right",label:"Right side"}],getValue:()=>e.settings.viewsButtonAlignment,setValue:async d=>{e.settings.viewsButtonAlignment=d,t()}}),Me(n,"Project Autosuggest"),Se(n,"Customize how project suggestions display during task creation."),Xe(n,{name:"Required tags",desc:"Show only notes with any of these tags (comma-separated). Leave empty to show all notes.",placeholder:"project, active, important",getValue:()=>{var d,u,f;return(f=(u=(d=e.settings.projectAutosuggest)==null?void 0:d.requiredTags)==null?void 0:u.join(", "))!=null?f:""},setValue:async d=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1,requiredTags:[],includeFolders:[],propertyKey:"",propertyValue:""}),e.settings.projectAutosuggest.requiredTags=d.split(",").map(u=>u.trim()).filter(u=>u.length>0),t()},ariaLabel:"Required tags for project suggestions"}),Xe(n,{name:"Include folders",desc:"Show only notes in these folders (comma-separated paths). Leave empty to show all folders.",placeholder:"Projects/, Work/Active, Personal",getValue:()=>{var d,u,f;return(f=(u=(d=e.settings.projectAutosuggest)==null?void 0:d.includeFolders)==null?void 0:u.join(", "))!=null?f:""},setValue:async d=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1,requiredTags:[],includeFolders:[],propertyKey:"",propertyValue:""}),e.settings.projectAutosuggest.includeFolders=d.split(",").map(u=>u.trim()).filter(u=>u.length>0),t()},ariaLabel:"Include folders for project suggestions"}),Xe(n,{name:"Required property key",desc:"Show only notes where this frontmatter property matches the value below. Leave empty to ignore.",placeholder:"type",getValue:()=>{var d,u;return(u=(d=e.settings.projectAutosuggest)==null?void 0:d.propertyKey)!=null?u:""},setValue:async d=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1,requiredTags:[],includeFolders:[],propertyKey:"",propertyValue:""}),e.settings.projectAutosuggest.propertyKey=d.trim(),t()},ariaLabel:"Required frontmatter property key for project suggestions"}),Xe(n,{name:"Required property value",desc:"Only notes where the property equals this value are suggested. Leave empty to require the property to exist.",placeholder:"project",getValue:()=>{var d,u;return(u=(d=e.settings.projectAutosuggest)==null?void 0:d.propertyValue)!=null?u:""},setValue:async d=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1,requiredTags:[],includeFolders:[],propertyKey:"",propertyValue:""}),e.settings.projectAutosuggest.propertyValue=d.trim(),t()},ariaLabel:"Required frontmatter property value for project suggestions"}),ke(n,{name:"Customize suggestion display",desc:"Show advanced options to configure how project suggestions appear and what information they display.",getValue:()=>{var d,u;return(u=(d=e.settings.projectAutosuggest)==null?void 0:d.showAdvanced)!=null?u:!1},setValue:async d=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1,requiredTags:[],includeFolders:[],propertyKey:"",propertyValue:""}),e.settings.projectAutosuggest.showAdvanced=d,t(),yi(n,e,t)}}),(c=e.settings.projectAutosuggest)!=null&&c.showAdvanced){ke(n,{name:"Enable fuzzy matching",desc:"Allow typos and partial matches in project search. May be slower in large vaults.",getValue:()=>{var p,m;return(m=(p=e.settings.projectAutosuggest)==null?void 0:p.enableFuzzy)!=null?m:!1},setValue:async p=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1,requiredTags:[],includeFolders:[],propertyKey:"",propertyValue:""}),e.settings.projectAutosuggest.enableFuzzy=p,t()}}),Se(n,"Configure up to 3 lines of information to show for each project suggestion.");let d=()=>{var p,m;return((m=(p=e.settings.projectAutosuggest)==null?void 0:p.rows)!=null?m:[]).slice(0,3)},u=async(p,m)=>{var T;e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1,requiredTags:[],includeFolders:[],propertyKey:"",propertyValue:""});let y=[...(T=e.settings.projectAutosuggest.rows)!=null?T:[]];y[p]=m,e.settings.projectAutosuggest.rows=y.slice(0,3),t()};Xe(n,{name:"Row 1",desc:"Format: {property|flags}. Properties: title, aliases, file.path, file.parent. Flags: n(Label) shows label, s makes searchable. Example: {title|n(Title)|s}",placeholder:"{title|n(Title)}",getValue:()=>d()[0]||"",setValue:async p=>u(0,p),ariaLabel:"Project autosuggest display row 1"}),Xe(n,{name:"Row 2 (optional)",desc:"Common patterns: {aliases|n(Aliases)}, {file.parent|n(Folder)}, literal:Custom Text",placeholder:"{aliases|n(Aliases)}",getValue:()=>d()[1]||"",setValue:async p=>u(1,p),ariaLabel:"Project autosuggest display row 2"}),Xe(n,{name:"Row 3 (optional)",desc:"Additional info like {file.path|n(Path)} or custom frontmatter fields",placeholder:"{file.path|n(Path)}",getValue:()=>d()[2]||"",setValue:async p=>u(2,p),ariaLabel:"Project autosuggest display row 3"});let f=n.createDiv("tasknotes-settings__help-section");f.createEl("h4",{text:"Quick Reference"});let h=f.createEl("ul");h.createEl("li",{text:"Available properties: title, aliases, file.path, file.parent, or any frontmatter field"}),h.createEl("li",{text:'Add labels: {title|n(Title)} \u2192 "Title: My Project"'}),h.createEl("li",{text:"Make searchable: {description|s} includes description in + search"}),h.createEl("li",{text:"Static text: literal:My Custom Label"}),f.createEl("p",{text:"Filename, title, and aliases are always searchable by default.",cls:"settings-help-note"})}}var y_=require("obsidian");var Xp=require("obsidian"),uT=class extends Xp.Modal{constructor(e,t){super(e),this.hasExistingData=t}show(){return new Promise(e=>{this.resolve=e,this.open()})}onOpen(){let{contentEl:e}=this;e.empty();let t=this.hasExistingData?"Migrate pomodoro data?":"Switch to daily notes storage?";new Xp.Setting(e).setName(t).setHeading();let r=this.hasExistingData?"This will migrate your existing pomodoro session data to daily notes frontmatter. The data will be grouped by date and stored in each daily note.":"Pomodoro session data will be stored in daily notes frontmatter instead of the plugin data file.",i=e.createEl("p").createEl("strong");i.textContent=r,e.createEl("br"),e.createEl("p",{text:"What this means:"});let a=e.createEl("ul");["Daily Notes core plugin must remain enabled","Data will be stored in your daily notes frontmatter",this.hasExistingData?"Existing plugin data will be migrated and then cleared":"Future sessions will be saved to daily notes","This provides better data longevity with your notes"].forEach(f=>{let h=a.createEl("li");h.textContent=`\u2022 ${f}`}),e.createEl("br");let l=e.createEl("p");if(this.hasExistingData){let f=l.createEl("strong");f.textContent="\u26A0\uFE0F Make sure you have backups if needed. This change cannot be automatically undone."}else l.textContent="You can switch back to plugin storage at any time in the future.";let c=e.createEl("div",{cls:"modal-button-container"});c.style.display="flex",c.style.gap="10px",c.style.justifyContent="flex-end",c.style.marginTop="20px",c.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.resolve(!1),this.close()});let u=c.createEl("button",{text:this.hasExistingData?"Migrate data":"Switch storage",cls:"mod-cta"});u.addEventListener("click",()=>{this.resolve(!0),this.close()}),window.setTimeout(()=>{u.focus()},50)}onClose(){let{contentEl:e}=this;e.empty(),this.resolve&&this.resolve(!1)}};async function VP(n,e){return new uT(n,e).show()}fT();function vi(n,e,t){n.empty(),Me(n,"Inline Tasks"),Se(n,"Configure inline task features for seamless task management within any note."),ke(n,{name:"Task link overlay",desc:"Show interactive overlays when hovering over task links",getValue:()=>e.settings.enableTaskLinkOverlay,setValue:async r=>{e.settings.enableTaskLinkOverlay=r,t()}}),ke(n,{name:"Instant task convert",desc:"Enable instant conversion of text to tasks using keyboard shortcuts",getValue:()=>e.settings.enableInstantTaskConvert,setValue:async r=>{e.settings.enableInstantTaskConvert=r,t(),vi(n,e,t)}}),e.settings.enableInstantTaskConvert&&Xe(n,{name:"Inline task convert folder",desc:"Folder for inline task conversion. Use {{currentNotePath}} for relative to current note",placeholder:"TaskNotes",getValue:()=>e.settings.inlineTaskConvertFolder,setValue:async r=>{e.settings.inlineTaskConvertFolder=r,t()}}),Me(n,"Natural Language Processing"),Se(n,"Enable smart parsing of task details from natural language input."),ke(n,{name:"Enable natural language task input",desc:"Parse due dates, priorities, and contexts from natural language when creating tasks",getValue:()=>e.settings.enableNaturalLanguageInput,setValue:async r=>{e.settings.enableNaturalLanguageInput=r,t(),vi(n,e,t)}}),e.settings.enableNaturalLanguageInput&&(ke(n,{name:"Default to scheduled",desc:"When NLP detects a date without context, treat it as scheduled rather than due",getValue:()=>e.settings.nlpDefaultToScheduled,setValue:async r=>{e.settings.nlpDefaultToScheduled=r,t()}}),gt(n,{name:"NLP language",desc:"Language for natural language processing patterns and date parsing",options:m_(),getValue:()=>e.settings.nlpLanguage,setValue:async r=>{e.settings.nlpLanguage=r,t()}}),Xe(n,{name:"Status suggestion trigger",desc:"Text to trigger status suggestions (leave empty to disable)",placeholder:"@",getValue:()=>e.settings.statusSuggestionTrigger,setValue:async r=>{e.settings.statusSuggestionTrigger=r,t()}})),Me(n,"Pomodoro Timer"),Se(n,"Built-in Pomodoro timer for time management and productivity tracking."),Kr(n,{name:"Work duration",desc:"Duration of work intervals in minutes",placeholder:"25",min:1,max:120,getValue:()=>e.settings.pomodoroWorkDuration,setValue:async r=>{e.settings.pomodoroWorkDuration=r,t()}}),Kr(n,{name:"Short break duration",desc:"Duration of short breaks in minutes",placeholder:"5",min:1,max:60,getValue:()=>e.settings.pomodoroShortBreakDuration,setValue:async r=>{e.settings.pomodoroShortBreakDuration=r,t()}}),Kr(n,{name:"Long break duration",desc:"Duration of long breaks in minutes",placeholder:"15",min:1,max:120,getValue:()=>e.settings.pomodoroLongBreakDuration,setValue:async r=>{e.settings.pomodoroLongBreakDuration=r,t()}}),Kr(n,{name:"Long break interval",desc:"Number of work sessions before a long break",placeholder:"4",min:1,max:10,getValue:()=>e.settings.pomodoroLongBreakInterval,setValue:async r=>{e.settings.pomodoroLongBreakInterval=r,t()}}),ke(n,{name:"Auto-start breaks",desc:"Automatically start break timers after work sessions",getValue:()=>e.settings.pomodoroAutoStartBreaks,setValue:async r=>{e.settings.pomodoroAutoStartBreaks=r,t()}}),ke(n,{name:"Auto-start work",desc:"Automatically start work sessions after breaks",getValue:()=>e.settings.pomodoroAutoStartWork,setValue:async r=>{e.settings.pomodoroAutoStartWork=r,t()}}),ke(n,{name:"Pomodoro notifications",desc:"Show notifications when Pomodoro sessions end",getValue:()=>e.settings.pomodoroNotifications,setValue:async r=>{e.settings.pomodoroNotifications=r,t()}}),ke(n,{name:"Sound enabled",desc:"Play sound when Pomodoro sessions end",getValue:()=>e.settings.pomodoroSoundEnabled,setValue:async r=>{e.settings.pomodoroSoundEnabled=r,t(),vi(n,e,t)}}),e.settings.pomodoroSoundEnabled&&Kr(n,{name:"Sound volume",desc:"Volume for Pomodoro sounds (0-100)",placeholder:"50",min:0,max:100,getValue:()=>e.settings.pomodoroSoundVolume,setValue:async r=>{e.settings.pomodoroSoundVolume=r,t()}}),gt(n,{name:"Pomodoro data storage",desc:"Where to store Pomodoro session history",options:[{value:"plugin",label:"Plugin data (recommended)"},{value:"daily-notes",label:"Daily notes"}],getValue:()=>e.settings.pomodoroStorageLocation,setValue:async r=>{let s=r;if(s!==e.settings.pomodoroStorageLocation){let i=await e.loadData(),a=(i==null?void 0:i.pomodoroHistory)&&Array.isArray(i.pomodoroHistory)&&i.pomodoroHistory.length>0;await VP(e.app,a)?(e.settings.pomodoroStorageLocation=s,t(),new y_.Notice(`Pomodoro storage location changed to ${s==="plugin"?"plugin data":"daily notes"}`)):vi(n,e,t)}}}),Me(n,"Notifications"),Se(n,"Configure task reminder notifications and alerts."),ke(n,{name:"Enable notifications",desc:"Enable task reminder notifications",getValue:()=>e.settings.enableNotifications,setValue:async r=>{e.settings.enableNotifications=r,t(),vi(n,e,t)}}),e.settings.enableNotifications&&gt(n,{name:"Notification type",desc:"Type of notifications to show",options:[{value:"in-app",label:"In-app notifications"},{value:"system",label:"System notifications"}],getValue:()=>e.settings.notificationType,setValue:async r=>{e.settings.notificationType=r,t()}}),Me(n,"Performance & Behavior"),Se(n,"Configure plugin performance and behavioral options."),ke(n,{name:"Hide completed tasks from overdue",desc:"Exclude completed tasks from overdue task calculations",getValue:()=>e.settings.hideCompletedFromOverdue,setValue:async r=>{e.settings.hideCompletedFromOverdue=r,t()}}),ke(n,{name:"Disable note indexing",desc:"Disable automatic indexing of notes for better performance (may reduce some features)",getValue:()=>e.settings.disableNoteIndexing,setValue:async r=>{e.settings.disableNoteIndexing=r,t()}}),e.settings.suggestionDebounceMs!==void 0&&Kr(n,{name:"Suggestion debounce",desc:"Debounce delay for file suggestions in milliseconds (0 = disabled)",placeholder:"300",min:0,max:2e3,getValue:()=>e.settings.suggestionDebounceMs||0,setValue:async r=>{e.settings.suggestionDebounceMs=r>0?r:void 0,t()}}),Me(n,"Time Tracking"),Se(n,"Configure automatic time tracking behaviors."),ke(n,{name:"Auto-stop tracking on complete",desc:"Automatically stop time tracking when a task is marked complete",getValue:()=>e.settings.autoStopTimeTrackingOnComplete,setValue:async r=>{e.settings.autoStopTimeTrackingOnComplete=r,t()}}),ke(n,{name:"Time tracking stop notification",desc:"Show notification when time tracking is automatically stopped",getValue:()=>e.settings.autoStopTimeTrackingNotification,setValue:async r=>{e.settings.autoStopTimeTrackingNotification=r,t()}}),Me(n,"Recurring Tasks"),Se(n,"Configure behavior for recurring task management."),ke(n,{name:"Maintain due date offset in recurring tasks",desc:"When completing recurring tasks, maintain the offset between due and scheduled dates",getValue:()=>e.settings.maintainDueDateOffsetInRecurring,setValue:async r=>{e.settings.maintainDueDateOffsetInRecurring=r,t()}}),Me(n,"Timeblocking"),Se(n,"Configure timeblock functionality for lightweight scheduling in daily notes."),ke(n,{name:"Enable timeblocking",desc:"Enable timeblock functionality for lightweight scheduling in daily notes",getValue:()=>e.settings.calendarViewSettings.enableTimeblocking,setValue:async r=>{e.settings.calendarViewSettings.enableTimeblocking=r,t(),vi(n,e,t)}}),e.settings.calendarViewSettings.enableTimeblocking&&(ke(n,{name:"Show timeblocks",desc:"Display timeblocks from daily notes by default",getValue:()=>e.settings.calendarViewSettings.defaultShowTimeblocks,setValue:async r=>{e.settings.calendarViewSettings.defaultShowTimeblocks=r,t()}}),Se(n,"Usage: In the advanced calendar view, hold Shift + drag to create timeblocks. Drag to move existing timeblocks. Resize edges to adjust duration."))}var fe=require("obsidian");async function v_(n,e=8080){let t=n.createEl("p",{text:"Loading API endpoints...",attr:{style:"color: var(--text-muted); font-style: italic; margin: 16px 0;"}});try{console.log(`Fetching API documentation from http://localhost:${e}/api/docs`);let r=await fetch(`http://localhost:${e}/api/docs`);if(console.log("API docs response:",r.status,r.statusText),!r.ok)throw new Error(`API unavailable (${r.status}: ${r.statusText})`);let s=await r.json();console.log("OpenAPI spec loaded:",s),t.remove();let i={};if(s.paths)for(let[a,o]of Object.entries(s.paths))for(let[l,c]of Object.entries(o)){let u=(c.tags||["General"])[0];i[u]||(i[u]=[]),i[u].push({method:l.toUpperCase(),path:a,summary:c.summary||c.description||"No description"})}Object.keys(i).length>0?Object.entries(i).forEach(([a,o])=>{n.createEl("h5",{text:a,attr:{style:"margin: 16px 0 8px 0; font-weight: 600; color: var(--text-normal);"}});let l=n.createEl("ul");o.forEach(c=>{l.createEl("li",{text:`${c.method} ${c.path} - ${c.summary}`})})}):n.createEl("p",{text:"No API endpoints found in specification.",attr:{style:"color: var(--text-muted); margin: 16px 0;"}})}catch(r){console.error("Error loading API endpoints:",r),t.remove(),n.createEl("p",{text:`API server not accessible (${r.message}). Ensure the TaskNotes API server is running on port ${e}.`,attr:{style:"color: var(--text-muted); font-style: italic; margin: 16px 0;"}})}}em();function T_(n){let t=new Date().getTime()-n.getTime(),r=Math.floor(t/1e3),s=Math.floor(r/60),i=Math.floor(s/60),a=Math.floor(i/24);return a>0?`${a} day${a>1?"s":""} ago`:i>0?`${i} hour${i>1?"s":""} ago`:s>0?`${s} minute${s>1?"s":""} ago`:"Just now"}function co(n,e,t){n.empty(),Me(n,"Bases integration"),Se(n,"Configure integration with the Obsidian Bases plugin. This is an experimental feature, and currently relies on undocumented Obsidian APIs. Behaviour may change or break. "),ke(n,{name:"Enable Bases integration",desc:"Enable TaskNotes views to be used within Obsidian Bases plugin. Bases plugin must be enabled for this to work.",getValue:()=>e.settings.enableBases,setValue:async s=>{e.settings.enableBases=s,t(),s?new fe.Notice("Bases integration enabled. Please restart Obsidian to complete the setup."):new fe.Notice("Bases integration disabled. Please restart Obsidian to complete the removal.")}}),Me(n,"Calendar subscriptions"),Se(n,"Subscribe to external calendars via ICS/iCal URLs to view events alongside your tasks."),Xe(n,{name:"Default note template",desc:"Path to template file for notes created from ICS events",placeholder:"Templates/Event Template.md",getValue:()=>e.settings.icsIntegration.defaultNoteTemplate,setValue:async s=>{e.settings.icsIntegration.defaultNoteTemplate=s,t()}}),Xe(n,{name:"Default note folder",desc:"Folder for notes created from ICS events",placeholder:"Calendar/Events",getValue:()=>e.settings.icsIntegration.defaultNoteFolder,setValue:async s=>{e.settings.icsIntegration.defaultNoteFolder=s,t()}}),gt(n,{name:"ICS note filename format",desc:"How filenames are generated for notes created from ICS events",options:[{value:"title",label:"Event title"},{value:"zettel",label:"Zettelkasten format"},{value:"timestamp",label:"Timestamp"},{value:"custom",label:"Custom template"}],getValue:()=>e.settings.icsIntegration.icsNoteFilenameFormat,setValue:async s=>{e.settings.icsIntegration.icsNoteFilenameFormat=s,t(),co(n,e,t)}}),e.settings.icsIntegration.icsNoteFilenameFormat==="custom"&&Xe(n,{name:"Custom ICS filename template",desc:"Template for custom ICS event filenames",placeholder:"{date}-{title}",getValue:()=>e.settings.icsIntegration.customICSNoteFilenameTemplate,setValue:async s=>{e.settings.icsIntegration.customICSNoteFilenameTemplate=s,t()}}),Me(n,"Calendar subscriptions list");let r=n.createDiv("ics-subscriptions-container");if(Il(r,e,t),io(n,{name:"Add Calendar Subscription",desc:"Add a new calendar subscription from ICS/iCal URL or local file",buttonText:"Add Subscription",onClick:async()=>{let s={name:"New Calendar",url:"",color:"#6366f1",enabled:!1,type:"remote",refreshInterval:60};if(!e.icsSubscriptionService){new fe.Notice("ICS subscription service not available");return}try{await e.icsSubscriptionService.addSubscription(s),new fe.Notice("New calendar subscription added - please configure the details"),Il(r,e,t)}catch(i){console.error("Error adding subscription:",i),new fe.Notice("Failed to add subscription")}}}),io(n,{name:"Refresh all subscriptions",desc:"Manually refresh all enabled calendar subscriptions",buttonText:"Refresh All",onClick:async()=>{if(e.icsSubscriptionService)try{await e.icsSubscriptionService.refreshAllSubscriptions(),new fe.Notice("All calendar subscriptions refreshed successfully")}catch(s){console.error("Error refreshing subscriptions:",s),new fe.Notice("Failed to refresh some calendar subscriptions")}}}),Me(n,"Automatic ICS export"),Se(n,"Automatically export all your tasks to an ICS file."),ke(n,{name:"Enable automatic export",desc:"Automatically keep an ICS file updated with all your tasks",getValue:()=>e.settings.icsIntegration.enableAutoExport,setValue:async s=>{e.settings.icsIntegration.enableAutoExport=s,t(),new fe.Notice("Please reload Obsidian for the automatic export changes to take effect."),co(n,e,t)}}),e.settings.icsIntegration.enableAutoExport){Xe(n,{name:"Export file path",desc:"Path where the ICS file will be saved (relative to vault root)",placeholder:"tasknotes-calendar.ics",getValue:()=>e.settings.icsIntegration.autoExportPath,setValue:async i=>{e.settings.icsIntegration.autoExportPath=i||"tasknotes-calendar.ics",t()}}),Kr(n,{name:"Update interval (between 5 and 1440 minutes)",desc:"How often to update the export file",placeholder:"60",min:5,max:1440,getValue:()=>e.settings.icsIntegration.autoExportInterval,setValue:async i=>{e.settings.icsIntegration.autoExportInterval=Math.max(5,i||60),t(),e.autoExportService&&e.autoExportService.updateInterval(e.settings.icsIntegration.autoExportInterval)}});let s=n.createDiv("auto-export-status");if(s.style.marginTop="10px",s.style.padding="10px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="4px",e.autoExportService){let i=e.autoExportService.getLastExportTime(),a=e.autoExportService.getNextExportTime();s.innerHTML=`
                <div style="font-weight: 500; margin-bottom: 5px;">Export Status:</div>
                <div style="font-size: 0.9em; opacity: 0.8;">
                    ${i?`Last export: ${i.toLocaleString()}`:"No exports yet"}<br>
                    ${a?`Next export: ${a.toLocaleString()}`:"Not scheduled"}
                </div>
            `}else s.innerHTML=`
                <div style="font-weight: 500; color: var(--text-warning);">
                    Auto export service not initialized - please restart Obsidian
                </div>
            `;io(n,{name:"Export now",desc:"Manually trigger an immediate export",buttonText:"Export Now",onClick:async()=>{if(e.autoExportService)try{await e.autoExportService.exportNow(),new fe.Notice("Tasks exported successfully"),co(n,e,t)}catch(i){console.error("Manual export failed:",i),new fe.Notice("Export failed - check console for details")}else new fe.Notice("Auto export service not available")}})}if(!fe.Platform.isMobile){if(Me(n,"HTTP API"),Se(n,"Enable HTTP API for external integrations and automations."),ke(n,{name:"Enable HTTP API",desc:"Start local HTTP server for API access",getValue:()=>e.settings.enableAPI,setValue:async i=>{e.settings.enableAPI=i,t(),co(n,e,t)}}),e.settings.enableAPI){Kr(n,{name:"API port",desc:"Port number for the HTTP API server",placeholder:"3000",min:1024,max:65535,getValue:()=>e.settings.apiPort,setValue:async d=>{e.settings.apiPort=d,t()}}),Xe(n,{name:"API authentication token",desc:"Token required for API authentication (leave empty for no auth)",placeholder:"your-secret-token",getValue:()=>e.settings.apiAuthToken,setValue:async d=>{e.settings.apiAuthToken=d,t()}});let i=n.createDiv("tasknotes-settings__help-section"),a=i.createDiv("tasknotes-settings__collapsible-header"),o=a.createDiv("tasknotes-settings__collapsible-header-content"),l=o.createSpan("tasknotes-settings__collapsible-icon");l.textContent="\u25B6",o.createSpan({text:"Available API Endpoints",cls:"tasknotes-settings__collapsible-title"});let c=i.createDiv("tasknotes-settings__collapsible-content");c.style.display="none",a.addEventListener("click",()=>{let d=c.style.display!=="none";c.style.display=d?"none":"block",l.textContent=d?"\u25B6":"\u25BC"}),v_(c,e.settings.apiPort)}Me(n,"Webhooks");let s=n.createDiv("setting-item-description");s.createEl("p",{text:"Webhooks send real-time notifications to external services when TaskNotes events occur."}),s.createEl("p",{text:"Configure webhooks to integrate with automation tools, sync services, or custom applications."}),tm(n,e,t),io(n,{name:"Add Webhook",desc:"Register a new webhook endpoint",buttonText:"Add Webhook",onClick:async()=>{new yT(e.app,async a=>{var l;let o={id:`wh_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,url:a.url||"",events:a.events||[],secret:Fj(),active:!0,createdAt:new Date().toISOString(),failureCount:0,successCount:0,transformFile:a.transformFile,corsHeaders:a.corsHeaders};e.settings.webhooks||(e.settings.webhooks=[]),e.settings.webhooks.push(o),t(),tm(((l=n.querySelector(".tasknotes-webhooks-container"))==null?void 0:l.parentElement)||n,e,t),new mT(e.app,o.secret).open(),new fe.Notice("Webhook created successfully")}).open()}})}Me(n,"Other plugin integrations"),Se(n,"Configure integrations with other Obsidian plugins.")}function Il(n,e,t){if(n.empty(),!e.icsSubscriptionService){Se(n,"ICS subscription service not available.");return}let r=e.icsSubscriptionService.getSubscriptions();if(r.length===0){let s=n.createDiv("tasknotes-webhooks-empty-state");s.createSpan("tasknotes-webhooks-empty-icon"),s.createSpan({text:"No calendar subscriptions configured. Add a subscription to sync external calendars.",cls:"tasknotes-webhooks-empty-text"});return}r.forEach(s=>{let i=Ht("checkbox");i.checked=s.enabled;let a=Ht("text","Calendar name",s.name),o=document.createElement("select");o.className="tasknotes-settings__card-input",o.innerHTML=`
            <option value="remote" ${s.type==="remote"?"selected":""}>Remote URL</option>
            <option value="local" ${s.type==="local"?"selected":""}>Local File</option>
        `;let l;if(s.type==="remote")l=Yp("ICS/iCal URL",s.url);else{let y=Ht("text","Local file path (e.g., Calendar.ics)",s.filePath||"");y.setAttribute("placeholder","Calendar.ics"),l=y}let c=Ht("color","",s.color),d=oo(5,1440,5,s.refreshInterval||60),u=async y=>{try{await e.icsSubscriptionService.updateSubscription(s.id,y),t(),Il(n,e,t)}catch(T){console.error("Error updating subscription:",T),new fe.Notice("Failed to update subscription"),Il(n,e,t)}};i.addEventListener("change",()=>u({enabled:i.checked})),a.addEventListener("blur",()=>u({name:a.value.trim()})),c.addEventListener("change",()=>u({color:c.value})),d.addEventListener("blur",()=>{let y=parseInt(d.value)||60;u({refreshInterval:y})}),o.addEventListener("change",async()=>{let y=o.value,T=s.type;s.type=y,y==="remote"?(s.url=s.filePath||"",s.filePath=void 0):(s.filePath=s.url||"",s.url=void 0),t();let w=o.closest(".tasknotes-settings__card");if(w){let b=w.querySelector(".tasknotes-settings__card-config-row:nth-child(4)");if(b){let E=b.querySelector("input");E&&E.remove();let S;if(y==="remote")S=Yp("ICS/iCal URL",s.url);else{let B=Ht("text","Local file path (e.g., Calendar.ics)",s.filePath||"");B.setAttribute("placeholder","Calendar.ics"),S=B}S.addEventListener("blur",()=>{let B=S.value.trim();s.type==="remote"?u({url:B}):u({filePath:B})}),b.appendChild(S);let D=b.querySelector(".tasknotes-settings__card-config-label");D&&(D.textContent=y==="remote"?"URL:":"File Path:");let x=w.querySelector(".tasknotes-settings__card-secondary-text");x&&(x.textContent=y==="remote"?"Remote Calendar":"Local File");let M=w.querySelector(".tasknotes-settings__card-meta .info-badge");M&&(M.textContent=y==="remote"?"Remote":"Local File")}}}),l.addEventListener("blur",()=>{let y=l.value.trim();s.type==="remote"?u({url:y}):u({filePath:y})});let f=sa(s.enabled?"Enabled":"Disabled",s.enabled?"active":"inactive"),h=Ml(s.type==="remote"?"Remote":"Local File"),p=[f,h];if(s.lastFetched){let y=new Date(s.lastFetched),T=T_(y),w=Ml(`Synced ${T}`);p.push(w)}if(s.lastError){let y=sa("Error","inactive");y.title=s.lastError,p.push(y)}let m=[{label:"Enabled:",input:i},{label:"Name:",input:a},{label:"Type:",input:o},{label:s.type==="remote"?"URL:":"File Path:",input:l},{label:"Color:",input:c},{label:"Refresh (min):",input:d}],g=Ln(n,{id:s.id,collapsible:!0,defaultCollapsed:!0,colorIndicator:{color:s.color},header:{primaryText:s.name,secondaryText:s.type==="remote"?"Remote Calendar":"Local File",meta:p,actions:[Fn(async()=>{if(await aa(e.app,{title:"Delete Subscription",message:`Are you sure you want to delete the subscription "${s.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0}))try{await e.icsSubscriptionService.removeSubscription(s.id),new fe.Notice(`Deleted subscription "${s.name}"`),t(),Il(n,e,t)}catch(T){console.error("Error deleting subscription:",T),new fe.Notice("Failed to delete subscription")}},"Delete subscription")]},content:{sections:[{rows:m}]},actions:{buttons:[{text:"Refresh Now",icon:"refresh-cw",variant:s.enabled?"primary":"secondary",disabled:!s.enabled,onClick:async()=>{if(!s.enabled){new fe.Notice("Enable the subscription first");return}try{await e.icsSubscriptionService.refreshSubscription(s.id),new fe.Notice(`Refreshed "${s.name}"`),Il(n,e,t)}catch(y){console.error("Error refreshing subscription:",y),new fe.Notice("Failed to refresh subscription")}}}]}})})}function tm(n,e,t){let r=n.querySelector(".tasknotes-webhooks-container");r&&r.remove();let s=n.createDiv("tasknotes-webhooks-container");if(!e.settings.webhooks||e.settings.webhooks.length===0){na(s,"No webhooks configured. Add a webhook to receive real-time notifications.","Add Webhook",()=>{var a;let i=(a=n.closest(".settings-tab-content"))==null?void 0:a.querySelector("button.tn-btn--primary");i&&i.click()});return}e.settings.webhooks.forEach((i,a)=>{let o=sa(i.active?"Active":"Inactive",i.active?"active":"inactive"),l=Ml(`\u2713 ${i.successCount||0}`),c=Ml(`\u2717 ${i.failureCount||0}`),d=Yp("Webhook URL",i.url),u=Ht("checkbox");u.checked=i.active,d.addEventListener("blur",()=>{d.value.trim()!==i.url&&(i.url=d.value.trim(),t(),new fe.Notice("Webhook URL updated"))}),u.addEventListener("change",()=>{i.active=u.checked,t();let g=u.closest(".tasknotes-settings__card");if(g){let y=g.querySelector(".tasknotes-settings__card-status-badge--active, .tasknotes-settings__card-status-badge--inactive");y&&(y.textContent=i.active?"Active":"Inactive",y.className=i.active?"tasknotes-settings__card-status-badge tasknotes-settings__card-status-badge--active":"tasknotes-settings__card-status-badge tasknotes-settings__card-status-badge--inactive");let T=g.querySelector('[aria-label*="Test"]');T&&(T.disabled=!i.active||!i.url)}new fe.Notice(`Webhook ${i.active?"enabled":"disabled"}`)});let f=i.createdAt?new Date(i.createdAt):null,h=f?`Created ${T_(f)}`:"Creation date unknown",p=document.createElement("div");if(p.style.display="flex",p.style.flexWrap="wrap",p.style.gap="0.5rem",p.style.alignItems="center",p.style.minHeight="1.5rem",p.style.lineHeight="1.5rem",i.events.length===0){let g=document.createElement("span");g.textContent="No events selected",g.style.color="var(--text-muted)",g.style.fontStyle="italic",g.style.lineHeight="1.5rem",p.appendChild(g)}else i.events.forEach((g,y)=>{let T=Ml(g);T.style.marginBottom="0",T.style.flexShrink="0",p.appendChild(T)});let m=i.transformFile?(()=>{let g=document.createElement("span");return g.textContent=i.transformFile,g.style.fontFamily="monospace",g.style.fontSize="0.85rem",g.style.color="var(--text-muted)",g.style.lineHeight="1.5rem",g.style.padding="0.25rem 0.5rem",g.style.background="var(--background-modifier-form-field)",g.style.borderRadius="4px",g.style.border="1px solid var(--background-modifier-border)",g})():(()=>{let g=document.createElement("span");return g.textContent="Raw payload (no transform)",g.style.color="var(--text-muted)",g.style.fontStyle="italic",g.style.lineHeight="1.5rem",g})();Ln(s,{id:i.id,collapsible:!0,defaultCollapsed:!0,header:{primaryText:"Webhook",secondaryText:h,meta:[o,l,c],actions:[Fn(async()=>{await aa(e.app,{title:"Delete Webhook",message:`Are you sure you want to delete this webhook?

URL: ${i.url}

This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})&&(e.settings.webhooks.splice(a,1),t(),tm(n,e,t),new fe.Notice("Webhook deleted"))})]},content:{sections:[{rows:[{label:"Active:",input:u},{label:"URL:",input:d},{label:"Events:",input:p},{label:"Transform:",input:m}]}]},actions:{buttons:[{text:"Edit Events",icon:"settings",variant:"secondary",onClick:async()=>{new gT(e.app,i,async y=>{Object.assign(i,y),t(),tm(n,e,t),new fe.Notice("Webhook updated")}).open()}}]}})})}function Fj(){return Array.from(crypto.getRandomValues(new Uint8Array(32))).map(n=>n.toString(16).padStart(2,"0")).join("")}var mT=class extends fe.Modal{constructor(e,t){super(e),this.secret=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-webhook-modal");let t=e.createDiv({cls:"tasknotes-webhook-secret-notice"}),r=t.createDiv({cls:"tasknotes-webhook-secret-title"}),s=r.createSpan();(0,fe.setIcon)(s,"shield-check"),r.createSpan({text:"Webhook Secret Generated"});let i=t.createDiv({cls:"tasknotes-webhook-secret-content"});i.createEl("p",{text:"Your webhook secret has been generated. Save this secret as you won't be able to view it again:"}),i.createEl("code",{text:this.secret,cls:"tasknotes-webhook-secret-code"}),i.createEl("p",{text:"Use this secret to verify webhook payloads in your receiving application."});let o=e.createDiv({cls:"tasknotes-webhook-modal-buttons"}).createEl("button",{text:"Got it",cls:"tasknotes-webhook-modal-btn save"});o.onclick=()=>this.close()}onClose(){let{contentEl:e}=this;e.empty()}},gT=class extends fe.Modal{constructor(e,t,r){var s;super(e),this.webhook=t,this.selectedEvents=[...t.events],this.transformFile=t.transformFile||"",this.corsHeaders=(s=t.corsHeaders)!=null?s:!0,this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-webhook-modal");let t=e.createDiv({cls:"tasknotes-webhook-modal-header"}),r=t.createSpan({cls:"tasknotes-webhook-modal-icon"});(0,fe.setIcon)(r,"webhook"),t.createEl("h2",{text:"Edit Webhook",cls:"tasknotes-webhook-modal-title"});let s=e.createDiv({cls:"tasknotes-webhook-modal-section"}),i=s.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),a=i.createSpan();(0,fe.setIcon)(a,"zap"),i.createEl("h3",{text:"Events to subscribe to"});let o=s.createDiv({cls:"tasknotes-webhook-events-list"});[{id:"task.created",label:"Task Created",desc:"When new tasks are created"},{id:"task.updated",label:"Task Updated",desc:"When tasks are modified"},{id:"task.completed",label:"Task Completed",desc:"When tasks are marked complete"},{id:"task.deleted",label:"Task Deleted",desc:"When tasks are deleted"},{id:"task.archived",label:"Task Archived",desc:"When tasks are archived"},{id:"task.unarchived",label:"Task Unarchived",desc:"When tasks are unarchived"},{id:"time.started",label:"Time Started",desc:"When time tracking starts"},{id:"time.stopped",label:"Time Stopped",desc:"When time tracking stops"},{id:"pomodoro.started",label:"Pomodoro Started",desc:"When pomodoro sessions begin"},{id:"pomodoro.completed",label:"Pomodoro Completed",desc:"When pomodoro sessions finish"},{id:"pomodoro.interrupted",label:"Pomodoro Interrupted",desc:"When pomodoro sessions are stopped"},{id:"recurring.instance.completed",label:"Recurring Instance Completed",desc:"When recurring task instances complete"},{id:"reminder.triggered",label:"Reminder Triggered",desc:"When task reminders activate"}].forEach(b=>{new fe.Setting(o).setName(b.label).setDesc(b.desc).addToggle(E=>(E.toggleEl.setAttribute("aria-label",`Subscribe to ${b.label} events`),E.setValue(this.selectedEvents.includes(b.id)).onChange(S=>{if(S)this.selectedEvents.push(b.id);else{let D=this.selectedEvents.indexOf(b.id);D>-1&&this.selectedEvents.splice(D,1)}})))});let c=e.createDiv({cls:"tasknotes-webhook-modal-section"}),d=c.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),u=d.createSpan();(0,fe.setIcon)(u,"file-code"),d.createEl("h3",{text:"Transform Configuration (Optional)"}),new fe.Setting(c).setName("Transform File").setDesc("Path to a .js or .json file in your vault that transforms webhook payloads").addText(b=>(b.inputEl.setAttribute("aria-label","Transform file path"),b.setPlaceholder("discord-transform.js").setValue(this.transformFile).onChange(E=>{this.transformFile=E})));let f=e.createDiv({cls:"tasknotes-webhook-modal-section"}),h=f.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),p=h.createSpan();(0,fe.setIcon)(p,"settings"),h.createEl("h3",{text:"Headers Configuration"}),new fe.Setting(f).setName("Include custom headers").setDesc("Include TaskNotes headers (event type, signature, delivery ID). Turn off for Discord, Slack, and other services with strict CORS policies.").addToggle(b=>(b.toggleEl.setAttribute("aria-label","Include custom headers"),b.setValue(this.corsHeaders).onChange(E=>{this.corsHeaders=E})));let m=e.createDiv({cls:"tasknotes-webhook-modal-buttons"}),g=m.createEl("button",{text:"Cancel",cls:"tasknotes-webhook-modal-btn cancel",attr:{"aria-label":"Cancel webhook editing"}}),y=g.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,fe.setIcon)(y,"x"),g.onclick=()=>this.close();let T=m.createEl("button",{text:"Save Changes",cls:"tasknotes-webhook-modal-btn save mod-cta",attr:{"aria-label":"Save webhook changes"}}),w=T.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,fe.setIcon)(w,"save"),T.onclick=()=>{if(this.selectedEvents.length===0){new fe.Notice("Please select at least one event");return}this.onSubmit({events:this.selectedEvents,transformFile:this.transformFile.trim()||void 0,corsHeaders:this.corsHeaders}),this.close()}}onClose(){let{contentEl:e}=this;e.empty()}},yT=class extends fe.Modal{constructor(t,r){super(t);this.url="";this.selectedEvents=[];this.transformFile="";this.corsHeaders=!0;this.onSubmit=r}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("tasknotes-webhook-modal");let r=t.createDiv({cls:"tasknotes-webhook-modal-header"}),s=r.createSpan({cls:"tasknotes-webhook-modal-icon"});(0,fe.setIcon)(s,"webhook"),r.createEl("h2",{text:"Add Webhook",cls:"tasknotes-webhook-modal-title"});let i=t.createDiv({cls:"tasknotes-webhook-modal-section"});new fe.Setting(i).setName("Webhook URL").setDesc("The endpoint where webhook payloads will be sent").addText(A=>(A.inputEl.setAttribute("aria-label","Webhook URL"),A.setPlaceholder("https://your-service.com/webhook").setValue(this.url).onChange(j=>{this.url=j})));let a=t.createDiv({cls:"tasknotes-webhook-modal-section"}),o=a.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),l=o.createSpan();(0,fe.setIcon)(l,"zap"),o.createEl("h3",{text:"Events to subscribe to"});let c=a.createDiv({cls:"tasknotes-webhook-events-list"});[{id:"task.created",label:"Task Created",desc:"When new tasks are created"},{id:"task.updated",label:"Task Updated",desc:"When tasks are modified"},{id:"task.completed",label:"Task Completed",desc:"When tasks are marked complete"},{id:"task.deleted",label:"Task Deleted",desc:"When tasks are deleted"},{id:"task.archived",label:"Task Archived",desc:"When tasks are archived"},{id:"task.unarchived",label:"Task Unarchived",desc:"When tasks are unarchived"},{id:"time.started",label:"Time Started",desc:"When time tracking starts"},{id:"time.stopped",label:"Time Stopped",desc:"When time tracking stops"},{id:"pomodoro.started",label:"Pomodoro Started",desc:"When pomodoro sessions begin"},{id:"pomodoro.completed",label:"Pomodoro Completed",desc:"When pomodoro sessions finish"},{id:"pomodoro.interrupted",label:"Pomodoro Interrupted",desc:"When pomodoro sessions are stopped"},{id:"recurring.instance.completed",label:"Recurring Instance Completed",desc:"When recurring task instances complete"},{id:"reminder.triggered",label:"Reminder Triggered",desc:"When task reminders activate"}].forEach(A=>{new fe.Setting(c).setName(A.label).setDesc(A.desc).addToggle(j=>(j.toggleEl.setAttribute("aria-label",`Subscribe to ${A.label} events`),j.setValue(this.selectedEvents.includes(A.id)).onChange(U=>{if(U)this.selectedEvents.push(A.id);else{let V=this.selectedEvents.indexOf(A.id);V>-1&&this.selectedEvents.splice(V,1)}})))});let u=t.createDiv({cls:"tasknotes-webhook-modal-section"}),f=u.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),h=f.createSpan();(0,fe.setIcon)(h,"file-code"),f.createEl("h3",{text:"Transform Configuration (Optional)"}),new fe.Setting(u).setName("Transform File").setDesc("Path to a .js or .json file in your vault that transforms webhook payloads").addText(A=>(A.inputEl.setAttribute("aria-label","Transform file path"),A.setPlaceholder("discord-transform.js").setValue(this.transformFile).onChange(j=>{this.transformFile=j})));let p=u.createDiv({cls:"tasknotes-webhook-transform-help"}),m=p.createDiv({cls:"tasknotes-webhook-help-header"}),g=m.createSpan();(0,fe.setIcon)(g,"info"),m.createSpan({text:"Transform files allow you to customize webhook payloads:"});let y=p.createEl("ul",{cls:"tasknotes-webhook-help-list"}),T=y.createEl("li");T.createEl("strong",{text:".js files:"}),T.appendText(" Custom JavaScript transforms");let w=y.createEl("li");w.createEl("strong",{text:".json files:"}),w.appendText(" Templates with "),w.createEl("code",{text:"${data.task.title}"});let b=y.createEl("li");b.createEl("strong",{text:"Leave empty:"}),b.appendText(" Send raw data");let E=p.createDiv({cls:"tasknotes-webhook-help-example"});E.createEl("strong",{text:"Example:"}),E.appendText(" "),E.createEl("code",{text:"discord-transform.js"});let S=t.createDiv({cls:"tasknotes-webhook-modal-section"}),D=S.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),x=D.createSpan();(0,fe.setIcon)(x,"settings"),D.createEl("h3",{text:"Headers Configuration"}),new fe.Setting(S).setName("Include custom headers").setDesc("Include TaskNotes headers (event type, signature, delivery ID). Turn off for Discord, Slack, and other services with strict CORS policies.").addToggle(A=>(A.toggleEl.setAttribute("aria-label","Include custom headers"),A.setValue(this.corsHeaders).onChange(j=>{this.corsHeaders=j})));let M=t.createDiv({cls:"tasknotes-webhook-modal-buttons"}),B=M.createEl("button",{text:"Cancel",cls:"tasknotes-webhook-modal-btn cancel",attr:{"aria-label":"Cancel webhook creation"}}),Q=B.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,fe.setIcon)(Q,"x"),B.onclick=()=>this.close();let P=M.createEl("button",{text:"Add Webhook",cls:"tasknotes-webhook-modal-btn save mod-cta",attr:{"aria-label":"Create webhook"}}),I=P.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,fe.setIcon)(I,"plus"),P.onclick=()=>{if(!this.url.trim()){new fe.Notice("Webhook URL is required");return}if(this.selectedEvents.length===0){new fe.Notice("Please select at least one event");return}this.onSubmit({url:this.url.trim(),events:this.selectedEvents,transformFile:this.transformFile.trim()||void 0,corsHeaders:this.corsHeaders}),this.close()}}onClose(){let{contentEl:t}=this;t.empty()}};var rm=class extends Id.PluginSettingTab{constructor(t,r){super(t,r);this.activeTab="general";this.tabContents={};this.debouncedSave=LP(()=>this.plugin.saveSettings(),500,!0);this.plugin=r}display(){let{containerEl:t}=this;t.empty(),t.addClass("tasknotes-settings"),t.addClass("tasknotes-plugin"),t.addClass("settings-view");let r=t.createDiv("settings-tab-nav settings-view__tab-nav"),s=[{id:"general",name:"General",renderFn:Ad},{id:"task-properties",name:"Task Properties",renderFn:qp},{id:"defaults",name:"Defaults & Templates",renderFn:Zp},{id:"appearance",name:"Appearance & UI",renderFn:yi},{id:"features",name:"Features",renderFn:vi},{id:"integrations",name:"Integrations",renderFn:co}],i=Id.Platform.isMobile?s.filter(o=>o.id!=="integrations"||this.hasNonAPIIntegrations()):s;Id.Platform.isMobile&&this.activeTab==="integrations"&&!this.hasNonAPIIntegrations()&&(this.activeTab="general"),i.forEach(o=>{let l=this.activeTab===o.id,c=r.createEl("button",{text:o.name,cls:l?"settings-tab-button settings-view__tab-button active settings-view__tab-button--active":"settings-tab-button settings-view__tab-button",attr:{role:"tab","aria-selected":l.toString(),"aria-controls":`settings-tab-${o.id}`,id:`tab-button-${o.id}`,tabindex:l?"0":"-1"}});c.addEventListener("click",()=>{this.switchTab(o.id)}),c.addEventListener("keydown",d=>{if(d.key==="ArrowLeft"||d.key==="ArrowRight"){d.preventDefault();let u=i.findIndex(p=>p.id===o.id),f=d.key==="ArrowRight"?(u+1)%i.length:(u-1+i.length)%i.length,h=i[f].id;this.switchTab(h)}})});let a=t.createDiv("settings-tab-contents settings-view__tab-contents");i.forEach(o=>{let l=a.createDiv("settings-tab-content settings-view__tab-content");l.setAttribute("role","tabpanel"),l.setAttribute("id",`settings-tab-${o.id}`),l.setAttribute("aria-labelledby",`tab-button-${o.id}`),this.activeTab===o.id&&(l.addClass("active"),l.addClass("settings-view__tab-content--active"),o.renderFn(l,this.plugin,this.debouncedSave)),this.tabContents[o.id]=l})}switchTab(t){this.activeTab=t,this.containerEl.querySelectorAll(".settings-tab-button").forEach(s=>{let i=s.id===`tab-button-${t}`;s.classList.toggle("active",i),s.classList.toggle("settings-view__tab-button--active",i),s.setAttribute("aria-selected",i.toString()),s.setAttribute("tabindex",i?"0":"-1")}),this.containerEl.querySelectorAll(".settings-tab-content").forEach(s=>{let i=s.id===`settings-tab-${t}`;s.classList.toggle("active",i),s.classList.toggle("settings-view__tab-content--active",i)});let r=this.tabContents[t];if(r&&r.children.length===0){let s=this.getTabConfigurations().find(i=>i.id===t);s&&s.renderFn(r,this.plugin,this.debouncedSave)}setTimeout(()=>{let s=this.containerEl.querySelector(`#tab-button-${t}`);s&&s.focus()},50)}getTabConfigurations(){return[{id:"general",name:"General",renderFn:Ad},{id:"task-properties",name:"Task Properties",renderFn:qp},{id:"defaults",name:"Defaults & Templates",renderFn:Zp},{id:"appearance",name:"Appearance & UI",renderFn:yi},{id:"features",name:"Features",renderFn:vi},{id:"integrations",name:"Integrations",renderFn:co}]}hasNonAPIIntegrations(){return!0}};or();var Jr=require("obsidian");Ft();Ne();var wm=Ee(wn());or();At();var Ql=require("obsidian"),fa=class fa{constructor(){this.metrics=new Map;this.markers=new Map;this.enabled=!0;this.mutationObservers=new Set;this.performanceObservers=new Set}static getInstance(){return fa.instance||(fa.instance=new fa),fa.instance}startTimer(e){this.enabled&&this.markers.set(e,performance.now())}endTimer(e){if(!this.enabled)return 0;let t=this.markers.get(e);if(t===void 0)return e.includes("-measure-")||console.warn(`No start marker found for operation: ${e}`),0;let r=performance.now()-t;return this.recordMetric(e,r),this.markers.delete(e),r}async measure(e,t){if(!this.enabled)return t();let r=performance.now();try{return await t()}finally{let s=performance.now()-r;this.recordMetric(e,s)}}measureSync(e,t){if(!this.enabled)return t();let r=performance.now();try{return t()}finally{let s=performance.now()-r;this.recordMetric(e,s)}}recordMetric(e,t){if(!this.enabled)return;this.metrics.has(e)||this.metrics.set(e,[]);let r=this.metrics.get(e);r.push(t),r.length>50&&r.splice(0,r.length-50)}getStats(e){let t=this.metrics.get(e);if(!t||t.length===0)return null;let r=[...t].sort((a,o)=>a-o),s=r.length,i=r.reduce((a,o)=>a+o,0);return{count:s,average:i/s,min:r[0],max:r[s-1],median:r[Math.floor(s/2)],p95:r[Math.floor(s*.95)]}}getAllStats(){let e={};for(let[t]of this.metrics)e[t]=this.getStats(t);return e}logSummary(){if(!this.enabled)return;console.group("[Performance Summary]");let e=this.getAllStats();["cache-file-read","task-list-render","calendar-render","task-update","file-index","dom-update"].forEach(r=>{let s=e[r];s&&console.log(`${r}:`,{average:`${s.average.toFixed(2)}ms`,p95:`${s.p95.toFixed(2)}ms`,count:s.count})}),console.groupEnd()}monitorDOMMutations(e){if(!this.enabled)return()=>{};let t=0,r=performance.now(),s=new MutationObserver(i=>{t+=i.length;let a=performance.now()-r;t>100&&a<1e3&&console.warn(`High DOM mutation rate: ${t} mutations in ${a.toFixed(2)}ms`)});return s.observe(e,{childList:!0,subtree:!0,attributes:!0}),this.mutationObservers.add(s),()=>{s.disconnect(),this.mutationObservers.delete(s),this.recordMetric("dom-mutations",t)}}recordMemoryUsage(e){if(!this.enabled||!("memory"in performance))return;let t=performance.memory,r={used:t.usedJSHeapSize/1024/1024,total:t.totalJSHeapSize/1024/1024,limit:t.jsHeapSizeLimit/1024/1024},s=e?`memory-${e}`:"memory-usage";this.recordMetric(s,r.used),r.used>100&&console.warn(`High memory usage: ${r.used.toFixed(2)}MB`)}trackLongTasks(){if(!this.enabled||!("PerformanceObserver"in window))return()=>{};let e=new PerformanceObserver(t=>{for(let r of t.getEntries())r.duration>50&&(console.warn(`Long task detected: ${r.duration.toFixed(2)}ms`),this.recordMetric("long-task",r.duration))});try{e.observe({entryTypes:["longtask"]}),this.performanceObservers.add(e)}catch(t){console.warn("Long task monitoring not supported")}return()=>{e.disconnect(),this.performanceObservers.delete(e)}}mark(e){if(this.enabled)try{performance.mark(`tasknotes-${e}`)}catch(t){}}measureBetweenMarks(e,t,r){if(this.enabled)try{performance.measure(`tasknotes-${r}`,`tasknotes-${e}`,`tasknotes-${t}`)}catch(s){}}clear(){this.metrics.clear(),this.markers.clear()}destroy(){for(let e of this.mutationObservers)e.disconnect();this.mutationObservers.clear();for(let e of this.performanceObservers)e.disconnect();this.performanceObservers.clear(),this.clear(),fa.instance=null}setEnabled(e){this.enabled=e,e||this.clear()}exportData(){let e={timestamp:new Date().toISOString(),stats:this.getAllStats(),platform:{isDesktop:Ql.Platform.isDesktop,isMobile:Ql.Platform.isMobile,isWin:Ql.Platform.isWin,isMacOS:Ql.Platform.isMacOS,isLinux:Ql.Platform.isLinux},memoryInfo:"memory"in performance?performance.memory:null};return JSON.stringify(e,null,2)}};fa.instance=null;var ew=fa;var xi=ew.getInstance();Ne();var Kl=class Kl extends Jr.ItemView{constructor(t,r){super(t);this.colorizeMode="tasks";this.listeners=[];this.monthCalculationCache=new Map;this.debouncedRefresh=null;this.currentCacheKey="";this.calendarDayElements=null;this.elementToDateMap=new Map;this.plugin=r;let s=this.plugin.selectedDate;this.displayedMonth=s.getUTCMonth(),this.displayedYear=s.getUTCFullYear(),this.registerEvents()}registerEvents(){this.listeners.forEach(a=>this.plugin.emitter.offref(a)),this.listeners=[];let t=this.plugin.emitter.on(ar,()=>{this.refresh()});this.listeners.push(t);let r=this.plugin.emitter.on(Ti,a=>{this.displayedMonth!==a.getUTCMonth()||this.displayedYear!==a.getUTCFullYear()?(this.displayedMonth=a.getUTCMonth(),this.displayedYear=a.getUTCFullYear(),this.clearMonthCalculationCache(),this.colorizeMode==="daily"&&this.plugin.cacheManager.rebuildDailyNotesCache(a.getUTCFullYear(),a.getUTCMonth()),this.refresh()):(this.updateSelectedDate(a),this.updateMonthDisplay())});this.listeners.push(r);let s=this.plugin.emitter.on(dt,({path:a,originalTask:o,updatedTask:l})=>{if(!a||!l){console.error("EVENT_TASK_UPDATED received invalid data:",{path:a,originalTask:o,updatedTask:l});return}this.handleTaskUpdate(o,l)});this.listeners.push(s);let i=this.plugin.emitter.on("indexes-built",()=>{this.refresh()});this.listeners.push(i)}getViewType(){return uo}getDisplayText(){return"Mini Calendar"}getIcon(){return"calendar-days"}async onOpen(){await this.plugin.onReady();let t=this.contentEl;t.empty();let r=t.createDiv({cls:"tasknotes-plugin mini-calendar-view"});this.showLoadingIndicator(),this.renderView(r),await this.refresh(),this.registerKeyboardNavigation()}renderView(t){t.empty(),this.createCalendarControls(t),this.createCalendarGrid(t),this.createLegend(t),this.colorizeCalendar()}colorizeCalendar(){switch(this.colorizeMode){case"tasks":this.colorizeCalendarForTasks();break;case"notes":this.colorizeCalendarForNotes();break;case"daily":this.colorizeCalendarForDailyNotes();break}}async navigateToPreviousPeriod(){let t=new Date(this.plugin.selectedDate),r=new Date(t.getTime());r.setUTCMonth(t.getUTCMonth()-1),this.plugin.setSelectedDate(r)}async navigateToNextPeriod(){let t=new Date(this.plugin.selectedDate),r=new Date(t.getTime());r.setUTCMonth(t.getUTCMonth()+1),this.plugin.setSelectedDate(r)}async navigateToToday(){let t=Ge(),r=wt(t);this.plugin.setSelectedDate(r)}async onClose(){this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.monthCalculationCache.clear(),this.elementToDateMap.clear(),this.calendarDayElements=null,this.currentCacheKey="",this.contentEl.empty()}registerKeyboardNavigation(){this.registerDomEvent(document,"keydown",async t=>{if(!this.isThisViewActive())return;let r=new Date(this.plugin.selectedDate),s;switch(t.key){case"ArrowLeft":s=new Date(r),s.setUTCDate(r.getUTCDate()-1);break;case"ArrowRight":s=new Date(r),s.setUTCDate(r.getUTCDate()+1);break;case"ArrowUp":s=new Date(r),s.setUTCDate(r.getUTCDate()-7);break;case"ArrowDown":s=new Date(r),s.setUTCDate(r.getUTCDate()+7);break;case"Enter":t.preventDefault(),this.plugin.navigateToDailyNote(r);return;default:return}s&&(t.preventDefault(),this.plugin.setSelectedDate(s))})}isThisViewActive(){return this.app.workspace.getActiveViewOfType(Kl)===this}navigateDate(t,r){let s=new Date(this.plugin.selectedDate),i=new Date(s);i.setUTCDate(s.getUTCDate()+r*7+t),this.plugin.setSelectedDate(i)}async refresh(){this.showLoadingIndicator();try{let t=this.contentEl.querySelector(".mini-calendar-view");t||(t=this.contentEl.createDiv({cls:"tasknotes-plugin mini-calendar-view"})),this.renderView(t)}finally{this.hideLoadingIndicator()}}updateSelectedDate(t){let r=this.contentEl.querySelectorAll(".mini-calendar-view__day");r.forEach(s=>{s.classList.remove("mini-calendar-view__day--selected"),s.setAttribute("aria-selected","false"),s.setAttribute("tabindex","-1")}),r.forEach(s=>{let i=s;(i.getAttribute("aria-label")||"").includes(C(t,"EEEE, MMMM d, yyyy"))&&(i.classList.add("mini-calendar-view__day--selected"),i.setAttribute("aria-selected","true"),i.setAttribute("tabindex","0"),i.focus())}),this.plugin.selectedDate=t}updateMonthDisplay(){let t=this.contentEl.querySelector(".mini-calendar-view__month-display");t&&(t.textContent=C(this.plugin.selectedDate,"MMMM yyyy"))}showLoadingIndicator(){let t=this.contentEl.querySelector(".mini-calendar-view")||this.contentEl;if(t.querySelector(".cache-loading-indicator"))return;let r=document.createElement("div");r.className="cache-loading-indicator",r.textContent="Loading calendar data...",t.prepend(r)}hideLoadingIndicator(){let t=this.contentEl.querySelector(".cache-loading-indicator");t&&t.remove()}createCalendarControls(t){let s=t.createDiv({cls:"mini-calendar-view__controls"}).createDiv({cls:"mini-calendar-view__header"}),i=s.createEl("select",{cls:"mini-calendar-view__view-selector",attr:{title:"Change view","aria-label":"Change calendar view"}});[{value:"tasks",text:"Tasks"},{value:"notes",text:"Notes"},{value:"daily",text:"Daily notes"}].forEach(u=>{let f=i.createEl("option",{value:u.value,text:u.text});u.value===this.colorizeMode&&(f.selected=!0)}),i.addEventListener("change",async()=>{let u=i.value;this.showLoadingIndicator();try{await this.setColorizeMode(u)}finally{this.hideLoadingIndicator()}});let o=s.createDiv({cls:"mini-calendar-view__navigation"});o.createEl("button",{text:"\u2039",cls:"mini-calendar-view__nav-button mini-calendar-view__nav-button--prev tn-btn tn-btn--icon tn-btn--ghost",attr:{"aria-label":"Previous month",title:"Previous month"}}).addEventListener("click",()=>{this.navigateToPreviousPeriod()}),o.createDiv({cls:"mini-calendar-view__month-display",text:C(this.plugin.selectedDate,"MMMM yyyy")}),o.createEl("button",{text:"\u203A",cls:"mini-calendar-view__nav-button mini-calendar-view__nav-button--next tn-btn tn-btn--icon tn-btn--ghost",attr:{"aria-label":"Next month",title:"Next month"}}).addEventListener("click",()=>{this.navigateToNextPeriod()}),s.createEl("button",{text:"Today",cls:"mini-calendar-view__today-button tn-btn tn-btn--ghost tn-btn--sm",attr:{"aria-label":"Go to today",title:"Go to today"}}).addEventListener("click",()=>{this.navigateToToday()})}async setColorizeMode(t){if(this.colorizeMode!==t){if(this.colorizeMode=t,t==="daily"){let r=this.plugin.selectedDate.getUTCFullYear(),s=this.plugin.selectedDate.getUTCMonth();await this.plugin.cacheManager.rebuildDailyNotesCache(r,s)}this.colorizeCalendar()}}createCalendarGrid(t){let r=t.createDiv({cls:"mini-calendar-view__grid-container"}),s=this.plugin.selectedDate,i=s.getUTCMonth(),a=s.getUTCFullYear(),o=new Date(Date.UTC(a,i,1)),l=new Date(Date.UTC(a,i+1,0)),c=this.plugin.settings.calendarViewSettings.firstDay||0,d=(o.getUTCDay()-c+7)%7,u=r.createDiv({cls:"mini-calendar-view__grid",attr:{role:"grid","aria-label":`Calendar for ${C(this.plugin.selectedDate,"MMMM yyyy")}`,id:"calendar-grid"}}),f=u.createDiv({cls:"mini-calendar-view__grid-header",attr:{role:"row"}}),h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];[...h.slice(c),...h.slice(0,c)].forEach((D,x)=>{f.createDiv({text:D,cls:"mini-calendar-view__day-header",attr:{role:"columnheader","aria-label":D}})});let m=d,g=42,y=l.getUTCDate(),T=g-y-m,w=new Date(Date.UTC(a,i,0)).getUTCDate(),b=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}});for(let D=0;D<m;D++){let x=w-m+D+1,M=new Date(Date.UTC(a,i-1,x)),B=Qd(M,s),Q=b.createDiv({cls:`mini-calendar-view__day mini-calendar-view__day--outside-month${B?" mini-calendar-view__day--selected":""}`,text:x.toString(),attr:{role:"gridcell",tabindex:B?"0":"-1","aria-label":C(M,"EEEE, MMMM d, yyyy"),"aria-selected":B?"true":"false"}});this.setupDayInteractionEvents(Q,M),Q.addEventListener("mouseover",P=>{this.showDayPreview(P,M,Q)}),Q.addEventListener("keydown",P=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),this.plugin.setSelectedDate(M))}),this.addDropHandlers(Q,M)}let E=Ge(),S=wt(E);for(let D=1;D<=y;D++){(D+m-1)%7===0&&D>1&&(b=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}}));let x=new Date(Date.UTC(a,i,D)),M=Qd(x,S),B=Qd(x,s),Q="mini-calendar-view__day";M&&(Q+=" mini-calendar-view__day--today"),B&&(Q+=" mini-calendar-view__day--selected");let P=b.createDiv({cls:Q,text:D.toString(),attr:{role:"gridcell",tabindex:B?"0":"-1","aria-label":C(x,"EEEE, MMMM d, yyyy")+(M?" (Today)":""),"aria-selected":B?"true":"false","aria-current":M?"date":null}});this.setupDayInteractionEvents(P,x),P.addEventListener("mouseover",I=>{this.showDayPreview(I,x,P)}),P.addEventListener("keydown",I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),this.plugin.setSelectedDate(x))}),this.addDropHandlers(P,x)}for(let D=1;D<=T;D++){(D+m+y-1)%7===0&&D>1&&(b=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}}));let x=new Date(Date.UTC(a,i+1,D)),M=Qd(x,s),B=b.createDiv({cls:`mini-calendar-view__day mini-calendar-view__day--outside-month${M?" mini-calendar-view__day--selected":""}`,text:D.toString(),attr:{role:"gridcell",tabindex:M?"0":"-1","aria-label":C(x,"EEEE, MMMM d, yyyy"),"aria-selected":M?"true":"false"}});this.setupDayInteractionEvents(B,x),B.addEventListener("mouseover",Q=>{this.showDayPreview(Q,x,B)}),B.addEventListener("keydown",Q=>{(Q.key==="Enter"||Q.key===" ")&&(Q.preventDefault(),this.plugin.setSelectedDate(x))}),this.addDropHandlers(B,x)}}clearCalendarColorization(){this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(r=>{r.querySelectorAll(".note-indicator, .task-indicator, .daily-note-indicator").forEach(s=>s.remove()),r.classList.remove("mini-calendar-view__day--has-notes-few","mini-calendar-view__day--has-notes-some","mini-calendar-view__day--has-notes-many","mini-calendar-view__day--has-tasks","mini-calendar-view__day--has-completed-tasks","mini-calendar-view__day--has-archived-tasks","mini-calendar-view__day--has-scheduled-tasks","mini-calendar-view__day--has-daily-note")})}async colorizeCalendarForNotes(){return xi.measure("calendar-colorize-notes",async()=>{this.clearCalendarColorization();let t=this.plugin.selectedDate.getFullYear(),r=this.plugin.selectedDate.getMonth(),s;try{s=await this.plugin.cacheManager.getCalendarData(t,r)}catch(o){console.warn("Failed to get calendar data from unified cache manager:",o),s=await this.plugin.cacheManager.getCalendarData(t,r)}let i=s.notes;this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(o=>{let l=o.innerText.trim();if(l){let c=this.plugin.selectedDate.getUTCFullYear(),d=this.plugin.selectedDate.getUTCMonth(),u=parseInt(l);if(isNaN(u))return;let f=d;o.classList.contains("mini-calendar-view__day--outside-month")&&(u>15?f=d===0?11:d-1:f=d===11?0:d+1);let h=Hd(c,f,u),p=ue(h),m=i.get(p)||0;if(m>0){let g=document.createElement("div");g.className="note-indicator";let y="";m>=5?(y="many-notes",o.classList.add("mini-calendar-view__day--has-notes-many")):m>=2?(y="some-notes",o.classList.add("mini-calendar-view__day--has-notes-some")):(y="few-notes",o.classList.add("mini-calendar-view__day--has-notes-few")),g.classList.add(y),g.setAttribute("aria-label",`${m} note${m>1?"s":""}`),(0,Jr.setTooltip)(g,`${m} note${m>1?"s":""}`,{placement:"top"}),o.appendChild(g)}}})})}getTaskIndicatorInfo(t,r){var o;if(!t||t.length===0)return null;let s=0,i=0,a=0;for(let l of t){if(!l||l.archived)continue;let c=(o=l.status)!=null?o:"",d=this.plugin.statusManager.isCompletedStatus(c),u=l.due?we(l.due):null,f=l.scheduled?we(l.scheduled):null,h=u===r,p=f===r;if(!(!h&&!p)){if(d){a++;continue}if(h){s++;continue}p&&i++}}return s>0?{type:"due",count:s}:i>0?{type:"scheduled",count:i}:a>0?{type:"completed",count:a}:null}async colorizeCalendarForTasks(){this.clearCalendarColorization();let t=this.plugin.selectedDate.getUTCFullYear(),r=this.plugin.selectedDate.getUTCMonth(),i=(await this.plugin.cacheManager.getCalendarData(t,r)).tasks;this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(o=>{let l=o.innerText.trim();if(l){let c=this.plugin.selectedDate.getUTCFullYear(),d=this.plugin.selectedDate.getUTCMonth(),u=parseInt(l);if(isNaN(u))return;let f=`${c}-${d}-${u}-${o.classList.contains("mini-calendar-view__day--outside-month")}`,h=this.monthCalculationCache.get(f);if(!h){let y=d;o.classList.contains("mini-calendar-view__day--outside-month")&&(u>15?y=d===0?11:d-1:y=d===11?0:d+1);let T=Hd(c,y,u),w=ue(T);h={actualMonth:y,dateObj:T,dateKey:w},this.monthCalculationCache.set(f,h)}let{dateKey:p}=h,m=i.get(p),g=this.getTaskIndicatorInfo(m==null?void 0:m.tasks,p);if(g){let y=document.createElement("div");y.className="task-indicator";let T="";g.type==="due"?(o.classList.add("mini-calendar-view__day--has-tasks"),y.classList.add("due-tasks"),T="Due"):g.type==="scheduled"?(o.classList.add("mini-calendar-view__day--has-scheduled-tasks"),y.classList.add("scheduled-tasks"),T="Scheduled"):g.type==="completed"&&(o.classList.add("mini-calendar-view__day--has-completed-tasks"),y.classList.add("completed-tasks"),T="Completed"),y.setAttribute("aria-label",`${T} tasks (${g.count})`),(0,Jr.setTooltip)(y,`${T} tasks (${g.count})`,{placement:"top"}),o.appendChild(y)}}})}async colorizeCalendarForDailyNotes(){this.clearCalendarColorization();let t=this.plugin.selectedDate.getUTCFullYear(),r=this.plugin.selectedDate.getUTCMonth(),s;Kl.dailyNotesInitialized?s=(await this.plugin.cacheManager.getCalendarData(t,r)).dailyNotes:(await this.plugin.cacheManager.rebuildDailyNotesCache(t,r),Kl.dailyNotesInitialized=!0,s=(await this.plugin.cacheManager.getCalendarData(t,r)).dailyNotes),this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(a=>{let o=a.innerText.trim();if(o){let l=this.plugin.selectedDate.getUTCFullYear(),c=this.plugin.selectedDate.getUTCMonth(),d=parseInt(o);if(isNaN(d))return;let u=`${l}-${c}-${d}-${a.classList.contains("mini-calendar-view__day--outside-month")}`,f=this.monthCalculationCache.get(u);if(!f){let p=c;a.classList.contains("mini-calendar-view__day--outside-month")&&(d>15?p=c===0?11:c-1:p=c===11?0:c+1);let m=Hd(l,p,d),g=ue(m);f={actualMonth:p,dateObj:m,dateKey:g},this.monthCalculationCache.set(u,f)}let h=f.dateKey;if(s.has(h)){let p=document.createElement("div");p.className="daily-note-indicator",a.classList.add("mini-calendar-view__day--has-daily-note"),p.setAttribute("aria-label","Daily note exists"),(0,Jr.setTooltip)(p,"Daily note exists",{placement:"top"}),a.appendChild(p)}}})}handleTaskUpdate(t,r){if(this.colorizeMode!=="tasks")return;let s=new Set;t!=null&&t.due&&s.add(we(t.due)),r.due&&s.add(we(r.due)),t!=null&&t.scheduled&&s.add(we(t.scheduled)),r.scheduled&&s.add(we(r.scheduled)),s.size!==0&&this.updateCalendarCellsForDates(Array.from(s))}async updateCalendarCellsForDates(t){if(t.length===0)return;let r=this.plugin.selectedDate.getUTCFullYear(),s=this.plugin.selectedDate.getUTCMonth(),a=(await this.plugin.cacheManager.getCalendarData(r,s)).tasks,o=`${r}-${s}`;(this.currentCacheKey!==o||!this.calendarDayElements)&&(this.calendarDayElements=this.contentEl.querySelectorAll(".mini-calendar-view__day"),this.currentCacheKey=o,this.buildElementToDateMap(r,s));let l=new Set(t),c=[];for(let[d,u]of this.elementToDateMap)l.has(u.dateKey)&&c.push({element:d,dateKey:u.dateKey});requestAnimationFrame(()=>{c.forEach(({element:d,dateKey:u})=>{this.updateSingleCalendarCell(d,u,a)})})}updateSingleCalendarCell(t,r,s){t.querySelectorAll(".task-indicator").forEach(o=>o.remove()),t.classList.remove("mini-calendar-view__day--has-tasks","mini-calendar-view__day--has-scheduled-tasks","mini-calendar-view__day--has-completed-tasks");let i=s.get(r),a=this.getTaskIndicatorInfo(i==null?void 0:i.tasks,r);if(a){let o=document.createElement("div");o.className="task-indicator";let l="";a.type==="due"?(t.classList.add("mini-calendar-view__day--has-tasks"),o.classList.add("due-tasks"),l="Due"):a.type==="scheduled"?(t.classList.add("mini-calendar-view__day--has-scheduled-tasks"),o.classList.add("scheduled-tasks"),l="Scheduled"):a.type==="completed"&&(t.classList.add("mini-calendar-view__day--has-completed-tasks"),o.classList.add("completed-tasks"),l="Completed"),o.setAttribute("aria-label",`${l} tasks (${a.count})`),(0,Jr.setTooltip)(o,`${l} tasks (${a.count})`,{placement:"top"}),t.appendChild(o)}}getCellDate(t,r,s,i){let a=i;t.classList.contains("outside-month")&&(r>15?a=i===0?11:i-1:a=i===11?0:i+1);try{return Hd(s,a,r)}catch(o){return console.error("Error creating date:",o),null}}buildElementToDateMap(t,r){this.elementToDateMap.clear(),this.calendarDayElements&&this.calendarDayElements.forEach(s=>{let i=s,a=i.innerText.trim();if(!a||isNaN(parseInt(a)))return;let o=parseInt(a),l=this.getCellDate(i,o,t,r);if(l){let c=ue(l);this.elementToDateMap.set(s,{date:o,dateKey:c})}})}clearMonthCalculationCache(){let t=`${this.plugin.selectedDate.getUTCFullYear()}-${this.plugin.selectedDate.getUTCMonth()}`;for(let[r]of this.monthCalculationCache)r.startsWith(t)||this.monthCalculationCache.delete(r)}initializeDebouncedRefresh(){this.debouncedRefresh||(this.debouncedRefresh=(0,Jr.debounce)(()=>{this.refresh()},150))}getViewStartDate(){return bT(this.plugin.selectedDate.getUTCFullYear(),this.plugin.selectedDate.getUTCMonth(),1)}getViewEndDate(){return bT(this.plugin.selectedDate.getUTCFullYear(),this.plugin.selectedDate.getUTCMonth()+1,0)}showDayPreview(t,r,s){let i=this.getDailyNotePath(r);if(!i)return;let a=this.app.vault.getAbstractFileByPath(i);a&&a instanceof Jr.TFile&&this.app.workspace.trigger("hover-link",{event:t,source:"tasknotes-calendar",hoverParent:this,targetEl:s,linktext:i,sourcePath:i})}getDailyNotePath(t){try{let r=window.moment(t),s=(0,wm.getAllDailyNotes)(),i=(0,wm.getDailyNote)(r,s);return i?i.path:null}catch(r){return null}}createLegend(t){let r=t.createEl("details",{cls:"mini-calendar-view__legend"});r.createEl("summary",{cls:"mini-calendar-view__legend-summary",text:"Legend"});let s=r.createDiv({cls:"mini-calendar-view__legend-section"});s.createSpan({cls:"mini-calendar-view__legend-section-title",text:"Indicators"}),[{dotClass:"mini-calendar-view__legend-dot--due",label:"Due task"},{dotClass:"mini-calendar-view__legend-dot--scheduled",label:"Scheduled task"},{dotClass:"mini-calendar-view__legend-dot--completed",label:"Completed task"},{dotClass:"mini-calendar-view__legend-dot--notes",label:"Notes present"},{dotClass:"mini-calendar-view__legend-dot--daily",label:"Daily note exists"}].forEach(l=>{let c=s.createDiv({cls:"mini-calendar-view__legend-item"});c.createSpan({cls:`mini-calendar-view__legend-dot ${l.dotClass}`}),c.createSpan({cls:"mini-calendar-view__legend-label",text:l.label})});let a=r.createDiv({cls:"mini-calendar-view__legend-section"});a.createSpan({cls:"mini-calendar-view__legend-section-title",text:"Interactions"}),[{action:"Ctrl/Cmd + Hover",description:"Preview the daily note for that date"},{action:"Click",description:"Select the date and update the Agenda view"},{action:"Ctrl/Cmd + Click",description:"Open the daily note"},{action:"Double-click",description:"Open the daily note"}].forEach(l=>{let c=a.createDiv({cls:"mini-calendar-view__legend-interaction"});c.createSpan({cls:"mini-calendar-view__legend-action",text:l.action}),c.createSpan({cls:"mini-calendar-view__legend-description",text:l.description})})}setupDayInteractionEvents(t,r){t.addEventListener("click",s=>{this.plugin.setSelectedDate(r),(s.ctrlKey||s.metaKey)&&(s.preventDefault(),s.stopPropagation(),this.plugin.navigateToDailyNote(r))}),t.addEventListener("dblclick",s=>{s.preventDefault(),s.stopPropagation(),this.plugin.setSelectedDate(r),this.plugin.navigateToDailyNote(r)})}addDropHandlers(t,r){t.addEventListener("dragover",s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",t.classList.add("mini-calendar-view__day--dragover")}),t.addEventListener("dragleave",s=>{t.contains(s.relatedTarget)||t.classList.remove("mini-calendar-view__day--dragover")}),t.addEventListener("drop",async s=>{var i,a;s.preventDefault(),s.stopPropagation(),t.classList.remove("mini-calendar-view__day--dragover");try{let o=((i=s.dataTransfer)==null?void 0:i.getData("text/plain"))||((a=s.dataTransfer)==null?void 0:a.getData("application/x-task-path"));if(!o){console.warn("No task path found in drop data");return}let l=await this.plugin.cacheManager.getTaskInfo(o);if(!l){console.warn("Task not found:",o);return}let c=ue(r);await this.plugin.taskService.updateProperty(l,"due",c),new Jr.Notice(`Task "${l.title}" due date set to ${C(r,"MMM d, yyyy")}`),this.refresh()}catch(o){console.error("Error handling task drop on mini calendar:",o),new Jr.Notice("Failed to update task due date")}})}};Kl.dailyNotesInitialized=!1;var Tm=Kl;var _e=require("obsidian");Em();var vr=require("obsidian");Em();tw();rw();km();var Jl=class{constructor(e){this.menu=new vr.Menu,this.options=e,this.buildMenu()}buildMenu(){let{icsEvent:e,plugin:t,subscriptionName:r}=this.options;this.menu.addItem(s=>s.setTitle("Show details").setIcon("info").onClick(()=>{new To(t.app,t,e,r).open()})),this.menu.addSeparator(),this.menu.addItem(s=>s.setTitle("Create task from event").setIcon("check-circle").onClick(async()=>{await this.createTaskFromEvent()})),this.menu.addItem(s=>s.setTitle("Create note from event").setIcon("file-plus").onClick(()=>{this.createNoteFromEvent()})),this.menu.addItem(s=>s.setTitle("Link existing note").setIcon("link").onClick(()=>{this.linkExistingNote()})),this.menu.addSeparator(),this.menu.addItem(s=>s.setTitle("Copy title").setIcon("copy").onClick(async()=>{try{await navigator.clipboard.writeText(e.title),new vr.Notice("Event title copied to clipboard")}catch(i){new vr.Notice("Failed to copy to clipboard")}})),e.location&&this.menu.addItem(s=>s.setTitle("Copy location").setIcon("map-pin").onClick(async()=>{try{await navigator.clipboard.writeText(e.location),new vr.Notice("Location copied to clipboard")}catch(i){new vr.Notice("Failed to copy to clipboard")}})),e.url&&this.menu.addItem(s=>s.setTitle("Copy URL").setIcon("external-link").onClick(async()=>{try{await navigator.clipboard.writeText(e.url),new vr.Notice("Event URL copied to clipboard")}catch(i){new vr.Notice("Failed to copy to clipboard")}})),this.menu.addItem(s=>s.setTitle("Copy as markdown").setIcon("file-text").onClick(async()=>{let i=this.formatEventAsMarkdown();try{await navigator.clipboard.writeText(i),new vr.Notice("Event details copied as markdown")}catch(a){new vr.Notice("Failed to copy to clipboard")}}))}async createTaskFromEvent(){await es.execute(async()=>{let e=await this.options.plugin.icsNoteService.createTaskFromICS(this.options.icsEvent);new vr.Notice(`Task created: ${e.taskInfo.title}`);let t=this.options.plugin.app.vault.getAbstractFileByPath(e.file.path);t instanceof vr.TFile&&await this.options.plugin.app.workspace.getLeaf().openFile(t),this.options.onUpdate&&this.options.onUpdate()},{errorMessage:"Failed to create task from event"})}createNoteFromEvent(){try{new Zl(this.options.plugin.app,this.options.plugin,{icsEvent:this.options.icsEvent,subscriptionName:this.options.subscriptionName||"Unknown Calendar",onContentCreated:async t=>{new vr.Notice("Note created successfully"),await this.options.plugin.app.workspace.getLeaf().openFile(t),this.options.onUpdate&&this.options.onUpdate()}}).open()}catch(e){console.error("Error opening creation modal:",e),new vr.Notice("Failed to open creation modal")}}async linkExistingNote(){await es.execute(async()=>{new Xl(this.options.plugin.app,this.options.plugin,async t=>{await es.execute(async()=>{await this.options.plugin.icsNoteService.linkNoteToICS(t.path,this.options.icsEvent),new vr.Notice(`Linked note "${t.name}" to event`),this.options.onUpdate&&this.options.onUpdate()},{errorMessage:"Failed to link note"})}).open()},{errorMessage:"Failed to open note selection"})}formatEventAsMarkdown(){let{icsEvent:e,subscriptionName:t}=this.options,r=[];r.push(`## ${e.title||"Untitled Event"}`),r.push(""),t&&r.push(`**Calendar:** ${t}`);let s=new Date(e.start),i=s.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(!e.allDay&&(i+=` at ${s.toLocaleTimeString()}`,e.end)){let a=new Date(e.end);i+=` - ${a.toLocaleTimeString()}`}return r.push(`**Date & Time:** ${i}`),e.location&&r.push(`**Location:** ${e.location}`),e.description&&(r.push(""),r.push("### Description"),r.push(e.description)),e.url&&(r.push(""),r.push(`**URL:** ${e.url}`)),r.join(`
`)}show(e){this.menu.showAtMouseEvent(e)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4})}};iw();ru();tc();xm();var at=require("obsidian");var pa=require("obsidian"),ic=class extends pa.FuzzySuggestModal{constructor(e,t,r){super(e),this.plugin=t,this.onChoose=r,this.setPlaceholder("Type to search for files and notes..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles()}getItemText(e){let t=`${e.name} ${e.path}`;if(e instanceof pa.TFile){let r=this.app.metadataCache.getFileCache(e);if(r!=null&&r.frontmatter){let s=(0,pa.parseFrontMatterAliases)(r.frontmatter);s&&s.length>0&&(t+=` ${s.join(" ")}`)}}return t}renderSuggestion(e,t){let r=e.item;t.empty();let s=t.createDiv({cls:"attachment-suggestion"}),i=s.createSpan({cls:"attachment-name"});if(i.textContent=r.name,r instanceof pa.TFile){let a=this.app.metadataCache.getFileCache(r);if(a!=null&&a.frontmatter){let o=this.plugin.fieldMapper.toUserField("title"),l=a.frontmatter[o];if(l){let c=s.createDiv({cls:"attachment-title"});c.textContent=l}else{let c=(0,pa.parseFrontMatterAliases)(a.frontmatter);if(c&&c.length>0){let d=s.createDiv({cls:"attachment-aliases"});d.textContent=c.join(", ")}}}}if(r.path!==r.name){let a=s.createDiv({cls:"attachment-path"});a.textContent=r.path}}onChooseItem(e,t){this.onChoose(e)}};var _i=Ee(wn());Ne();var Cm=class extends at.Modal{constructor(t,r,s,i,a){super(t);this.selectedAttachments=[];this.plugin=r,this.timeblock={...s},this.originalTimeblock=s,this.eventDate=i,this.timeblockDate=a||ue(i)}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("timeblock-info-modal"),new at.Setting(t).setName("Edit Timeblock").setHeading();let r=t.createDiv({cls:"timeblock-date-display"});r.createEl("strong",{text:"Date & Time: "});let s=`${this.eventDate.toLocaleDateString()} from ${this.timeblock.startTime} to ${this.timeblock.endTime}`;r.createSpan({text:s}),new at.Setting(t).setName("Title").setDesc("Title for your timeblock").addText(d=>{this.titleInput=d.inputEl,d.setPlaceholder("e.g., Deep work session").setValue(this.timeblock.title||"").onChange(()=>this.validateForm())}),new at.Setting(t).setName("Description").setDesc("Optional description for the timeblock").addTextArea(d=>{this.descriptionInput=d.inputEl,d.setPlaceholder("Focus on new features, no interruptions").setValue(this.timeblock.description||""),this.descriptionInput.rows=3}),new at.Setting(t).setName("Color").setDesc("Optional color for the timeblock").addText(d=>{this.colorInput=d.inputEl,d.setPlaceholder("#3b82f6").setValue(this.timeblock.color||"#6366f1"),this.colorInput.type="color"}),new at.Setting(t).setName("Attachments").setDesc("Files or notes linked to this timeblock").addButton(d=>{d.setButtonText("Add Attachment").setTooltip("Select a file or note using fuzzy search").onClick(()=>{new ic(this.app,this.plugin,f=>{this.addAttachment(f)}).open()})}),this.attachmentsList=t.createDiv({cls:"timeblock-attachments-list"}),await this.initializeAttachments(),this.renderAttachmentsList();let i=t.createDiv({cls:"timeblock-modal-buttons"});i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center",i.style.marginTop="20px",i.createEl("button",{text:"Delete Timeblock",cls:"mod-warning timeblock-delete-button"}).addEventListener("click",()=>this.handleDelete());let o=i.createDiv({cls:"timeblock-modal-buttons-right"});o.style.display="flex",o.style.gap="8px",o.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),o.createEl("button",{text:"Save Changes",cls:"mod-cta timeblock-save-button"}).addEventListener("click",()=>this.handleSave()),this.validateForm(),window.setTimeout(()=>this.titleInput.focus(),50)}validateForm(){var i;let t=this.contentEl.querySelector(".timeblock-save-button");if(!t)return;let s=!!((i=this.titleInput)==null?void 0:i.value.trim());t.disabled=!s,t.style.opacity=s?"1":"0.5"}async initializeAttachments(){if(this.timeblock.attachments)for(let t of this.timeblock.attachments){let r=t.replace(/^\[\[|\]\]$/g,""),s=this.app.vault.getAbstractFileByPath(r);s&&this.selectedAttachments.push(s)}}addAttachment(t){if(this.selectedAttachments.some(r=>r.path===t.path)){new at.Notice(`"${t.name}" is already attached`);return}this.selectedAttachments.push(t),this.renderAttachmentsList(),new at.Notice(`Added "${t.name}" as attachment`)}removeAttachment(t){this.selectedAttachments=this.selectedAttachments.filter(r=>r.path!==t.path),this.renderAttachmentsList(),new at.Notice(`Removed "${t.name}" from attachments`)}openAttachment(t){t instanceof at.TFile?this.app.workspace.getLeaf(!1).openFile(t):new at.Notice(`Cannot open "${t.name}" - file type not supported`)}renderAttachmentsList(){if(this.attachmentsList.empty(),this.selectedAttachments.length===0){let t=this.attachmentsList.createDiv({cls:"timeblock-attachments-empty"});t.textContent="No attachments";return}this.selectedAttachments.forEach(t=>{let r=this.attachmentsList.createDiv({cls:"timeblock-attachment-item"}),s=r.createDiv({cls:"timeblock-attachment-info"});s.style.cursor="pointer",(0,at.setTooltip)(s,"Click to open",{placement:"top"}),s.addEventListener("click",()=>this.openAttachment(t));let i=s.createSpan({cls:"timeblock-attachment-name"});if(i.textContent=t.name,t.path!==t.name){let o=s.createDiv({cls:"timeblock-attachment-path"});o.textContent=t.path}let a=r.createEl("button",{cls:"timeblock-attachment-remove",text:"\xD7"});(0,at.setTooltip)(a,"Remove attachment",{placement:"top"}),a.addEventListener("click",o=>{o.stopPropagation(),this.removeAttachment(t)})})}async handleSave(){try{let t=this.titleInput.value.trim();if(!t){new at.Notice("Please enter a title for the timeblock");return}this.timeblock.title=t,this.timeblock.description=this.descriptionInput.value.trim()||void 0,this.timeblock.color=this.colorInput.value||void 0;let r=this.selectedAttachments.map(s=>`[[${s.path}]]`);this.timeblock.attachments=r.length>0?r:void 0,await this.updateTimeblockInDailyNote(),this.plugin.emitter.trigger("data-changed"),new at.Notice(`Timeblock "${t}" updated successfully`),this.close()}catch(t){console.error("Error updating timeblock:",t),new at.Notice("Failed to update timeblock. Check console for details.")}}async updateTimeblockInDailyNote(){if(!(0,_i.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let t=this.timeblockDate,r=window.moment(t,"YYYY-MM-DD"),s=(0,_i.getAllDailyNotes)(),i=(0,_i.getDailyNote)(r,s);if(!i)throw new Error("Daily note not found");let a=await this.app.vault.read(i),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let f=a.substring(3,u);l=a.substring(u+3);try{o=(0,at.parseYaml)(f)||{}}catch(h){console.error("Error parsing existing frontmatter:",h),o={}}}}if(o.timeblocks&&Array.isArray(o.timeblocks)){let u=o.timeblocks.findIndex(f=>f.id===this.originalTimeblock.id||f.title===this.originalTimeblock.title&&f.startTime===this.originalTimeblock.startTime&&f.endTime===this.originalTimeblock.endTime);if(u>=0)o.timeblocks[u]=this.timeblock;else throw new Error("Timeblock not found in daily note")}else throw new Error("No timeblocks found in daily note");let d=`---
${(0,at.stringifyYaml)(o)}---${l}`;await this.app.vault.modify(i,d)}async handleDelete(){if(await this.showDeleteConfirmation())try{await this.deleteTimeblockFromDailyNote(),this.plugin.emitter.trigger("data-changed"),new at.Notice(`Timeblock "${this.timeblock.title}" deleted successfully`),this.close()}catch(r){console.error("Error deleting timeblock:",r),new at.Notice("Failed to delete timeblock. Check console for details.")}}async showDeleteConfirmation(){return new Promise(t=>{let r=new at.Modal(this.app);r.titleEl.setText("Delete Timeblock");let s=r.contentEl;s.createEl("p",{text:`Are you sure you want to delete the timeblock "${this.timeblock.title}"?`}),s.createEl("p",{text:"This action cannot be undone.",cls:"mod-warning"});let i=s.createDiv({cls:"modal-button-container"});i.style.display="flex",i.style.justifyContent="flex-end",i.style.gap="8px",i.style.marginTop="20px";let a=i.createEl("button",{text:"Cancel"});a.addEventListener("click",()=>{r.close(),t(!1)}),i.createEl("button",{text:"Delete",cls:"mod-warning"}).addEventListener("click",()=>{r.close(),t(!0)}),r.open(),setTimeout(()=>a.focus(),50)})}async deleteTimeblockFromDailyNote(){if(!(0,_i.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let t=this.timeblockDate,r=window.moment(t,"YYYY-MM-DD"),s=(0,_i.getAllDailyNotes)(),i=(0,_i.getDailyNote)(r,s);if(!i)throw new Error("Daily note not found");let a=await this.app.vault.read(i),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let f=a.substring(3,u);l=a.substring(u+3);try{o=(0,at.parseYaml)(f)||{}}catch(h){console.error("Error parsing existing frontmatter:",h),o={}}}}if(o.timeblocks&&Array.isArray(o.timeblocks)){let u=o.timeblocks.findIndex(f=>f.id===this.originalTimeblock.id||f.title===this.originalTimeblock.title&&f.startTime===this.originalTimeblock.startTime&&f.endTime===this.originalTimeblock.endTime);if(u>=0)o.timeblocks.splice(u,1),o.timeblocks.length===0&&delete o.timeblocks;else throw new Error("Timeblock not found in daily note")}else throw new Error("No timeblocks found in daily note");let c=Object.keys(o).length>0?(0,at.stringifyYaml)(o):"",d=c?`---
${c}---${l}`:l.trim();await this.app.vault.modify(i,d)}onClose(){let{contentEl:t}=this;t.empty()}};Ft();var Im,pe,HA,ow,ac,bo,NA,BA,UA,Pm={},jA=[],DW=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function ma(n,e){for(var t in e)n[t]=e[t];return n}function WA(n){var e=n.parentNode;e&&e.removeChild(n)}function k(n,e,t){var r,s,i,a={};for(i in e)i=="key"?r=e[i]:i=="ref"?s=e[i]:a[i]=e[i];if(arguments.length>2&&(a.children=arguments.length>3?Im.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(i in n.defaultProps)a[i]===void 0&&(a[i]=n.defaultProps[i]);return Mm(n,a,r,s,null)}function Mm(n,e,t,r,s){var i={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s==null?++HA:s};return s==null&&pe.vnode!=null&&pe.vnode(i),i}function xt(){return{current:null}}function $e(n){return n.children}function xW(n,e,t,r,s){var i;for(i in t)i==="children"||i==="key"||i in e||_m(n,i,null,t[i],r);for(i in e)s&&typeof e[i]!="function"||i==="children"||i==="key"||i==="value"||i==="checked"||t[i]===e[i]||_m(n,i,e[i],t[i],r)}function OA(n,e,t){e[0]==="-"?n.setProperty(e,t==null?"":t):n[e]=t==null?"":typeof t!="number"||DW.test(e)?t:t+"px"}function _m(n,e,t,r,s){var i;e:if(e==="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||OA(n.style,e,"");if(t)for(e in t)r&&t[e]===r[e]||OA(n.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in n?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+i]=t,t?r||n.addEventListener(e,i?FA:LA,i):n.removeEventListener(e,i?FA:LA,i);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in n)try{n[e]=t==null?"":t;break e}catch(a){}typeof t=="function"||(t==null||t===!1&&e.indexOf("-")==-1?n.removeAttribute(e):n.setAttribute(e,t))}}function LA(n){ac=!0;try{return this.l[n.type+!1](pe.event?pe.event(n):n)}finally{ac=!1}}function FA(n){ac=!0;try{return this.l[n.type+!0](pe.event?pe.event(n):n)}finally{ac=!1}}function Tr(n,e){this.props=n,this.context=e}function su(n,e){if(e==null)return n.__?su(n.__,n.__.__k.indexOf(n)+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?su(n):null}function VA(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return VA(n)}}function CW(n){ac?setTimeout(n):BA(n)}function aw(n){(!n.__d&&(n.__d=!0)&&bo.push(n)&&!Am.__r++||NA!==pe.debounceRendering)&&((NA=pe.debounceRendering)||CW)(Am)}function Am(){var n,e,t,r,s,i,a,o;for(bo.sort(function(l,c){return l.__v.__b-c.__v.__b});n=bo.shift();)n.__d&&(e=bo.length,r=void 0,s=void 0,a=(i=(t=n).__v).__e,(o=t.__P)&&(r=[],(s=ma({},i)).__v=i.__v+1,lw(o,i,s,t.__n,o.ownerSVGElement!==void 0,i.__h!=null?[a]:null,r,a==null?su(i):a,i.__h),GA(r,i),i.__e!=a&&VA(i)),bo.length>e&&bo.sort(function(l,c){return l.__v.__b-c.__v.__b}));Am.__r=0}function $A(n,e,t,r,s,i,a,o,l,c){var d,u,f,h,p,m,g,y=r&&r.__k||jA,T=y.length;for(t.__k=[],d=0;d<e.length;d++)if((h=t.__k[d]=(h=e[d])==null||typeof h=="boolean"?null:typeof h=="string"||typeof h=="number"||typeof h=="bigint"?Mm(null,h,null,null,h):Array.isArray(h)?Mm($e,{children:h},null,null,null):h.__b>0?Mm(h.type,h.props,h.key,h.ref?h.ref:null,h.__v):h)!=null){if(h.__=t,h.__b=t.__b+1,(f=y[d])===null||f&&h.key==f.key&&h.type===f.type)y[d]=void 0;else for(u=0;u<T;u++){if((f=y[u])&&h.key==f.key&&h.type===f.type){y[u]=void 0;break}f=null}lw(n,h,f=f||Pm,s,i,a,o,l,c),p=h.__e,(u=h.ref)&&f.ref!=u&&(g||(g=[]),f.ref&&g.push(f.ref,null,h),g.push(u,h.__c||p,h)),p!=null?(m==null&&(m=p),typeof h.type=="function"&&h.__k===f.__k?h.__d=l=YA(h,l,n):l=zA(n,h,f,y,p,l),typeof t.type=="function"&&(t.__d=l)):l&&f.__e==l&&l.parentNode!=n&&(l=su(f))}for(t.__e=m,d=T;d--;)y[d]!=null&&(typeof t.type=="function"&&y[d].__e!=null&&y[d].__e==t.__d&&(t.__d=qA(r).nextSibling),KA(y[d],y[d]));if(g)for(d=0;d<g.length;d++)QA(g[d],g[++d],g[++d])}function YA(n,e,t){for(var r,s=n.__k,i=0;s&&i<s.length;i++)(r=s[i])&&(r.__=n,e=typeof r.type=="function"?YA(r,e,t):zA(t,r,r,s,r.__e,e));return e}function nu(n,e){return e=e||[],n==null||typeof n=="boolean"||(Array.isArray(n)?n.some(function(t){nu(t,e)}):e.push(n)),e}function zA(n,e,t,r,s,i){var a,o,l;if(e.__d!==void 0)a=e.__d,e.__d=void 0;else if(t==null||s!=i||s.parentNode==null)e:if(i==null||i.parentNode!==n)n.appendChild(s),a=null;else{for(o=i,l=0;(o=o.nextSibling)&&l<r.length;l+=1)if(o==s)break e;n.insertBefore(s,i),a=i}return a!==void 0?a:s.nextSibling}function qA(n){var e,t,r;if(n.type==null||typeof n.type=="string")return n.__e;if(n.__k){for(e=n.__k.length-1;e>=0;e--)if((t=n.__k[e])&&(r=qA(t)))return r}return null}function lw(n,e,t,r,s,i,a,o,l){var c,d,u,f,h,p,m,g,y,T,w,b,E,S,D,x=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(l=t.__h,o=e.__e=t.__e,e.__h=null,i=[o]),(c=pe.__b)&&c(e);try{e:if(typeof x=="function"){if(g=e.props,y=(c=x.contextType)&&r[c.__c],T=c?y?y.props.value:c.__:r,t.__c?m=(d=e.__c=t.__c).__=d.__E:("prototype"in x&&x.prototype.render?e.__c=d=new x(g,T):(e.__c=d=new Tr(g,T),d.constructor=x,d.render=PW),y&&y.sub(d),d.props=g,d.state||(d.state={}),d.context=T,d.__n=r,u=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),x.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=ma({},d.__s)),ma(d.__s,x.getDerivedStateFromProps(g,d.__s))),f=d.props,h=d.state,d.__v=e,u)x.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(x.getDerivedStateFromProps==null&&g!==f&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(g,T),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(g,d.__s,T)===!1||e.__v===t.__v){for(e.__v!==t.__v&&(d.props=g,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(M){M&&(M.__=e)}),w=0;w<d._sb.length;w++)d.__h.push(d._sb[w]);d._sb=[],d.__h.length&&a.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(g,d.__s,T),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(f,h,p)})}if(d.context=T,d.props=g,d.__P=n,b=pe.__r,E=0,"prototype"in x&&x.prototype.render){for(d.state=d.__s,d.__d=!1,b&&b(e),c=d.render(d.props,d.state,d.context),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[]}else do d.__d=!1,b&&b(e),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++E<25);d.state=d.__s,d.getChildContext!=null&&(r=ma(ma({},r),d.getChildContext())),u||d.getSnapshotBeforeUpdate==null||(p=d.getSnapshotBeforeUpdate(f,h)),D=c!=null&&c.type===$e&&c.key==null?c.props.children:c,$A(n,Array.isArray(D)?D:[D],e,t,r,s,i,a,o,l),d.base=e.__e,e.__h=null,d.__h.length&&a.push(d),m&&(d.__E=d.__=null),d.__e=!1}else i==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=MW(t.__e,e,t,r,s,i,a,l);(c=pe.diffed)&&c(e)}catch(M){e.__v=null,(l||i!=null)&&(e.__e=o,e.__h=!!l,i[i.indexOf(o)]=null),pe.__e(M,e,t)}}function GA(n,e){pe.__c&&pe.__c(e,n),n.some(function(t){try{n=t.__h,t.__h=[],n.some(function(r){r.call(t)})}catch(r){pe.__e(r,t.__v)}})}function MW(n,e,t,r,s,i,a,o){var l,c,d,u=t.props,f=e.props,h=e.type,p=0;if(h==="svg"&&(s=!0),i!=null){for(;p<i.length;p++)if((l=i[p])&&"setAttribute"in l==!!h&&(h?l.localName===h:l.nodeType===3)){n=l,i[p]=null;break}}if(n==null){if(h===null)return document.createTextNode(f);n=s?document.createElementNS("http://www.w3.org/2000/svg",h):document.createElement(h,f.is&&f),i=null,o=!1}if(h===null)u===f||o&&n.data===f||(n.data=f);else{if(i=i&&Im.call(n.childNodes),c=(u=t.props||Pm).dangerouslySetInnerHTML,d=f.dangerouslySetInnerHTML,!o){if(i!=null)for(u={},p=0;p<n.attributes.length;p++)u[n.attributes[p].name]=n.attributes[p].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===n.innerHTML)||(n.innerHTML=d&&d.__html||""))}if(xW(n,f,u,s,o),d)e.__k=[];else if(p=e.props.children,$A(n,Array.isArray(p)?p:[p],e,t,r,s&&h!=="foreignObject",i,a,i?i[0]:t.__k&&su(t,0),o),i!=null)for(p=i.length;p--;)i[p]!=null&&WA(i[p]);o||("value"in f&&(p=f.value)!==void 0&&(p!==n.value||h==="progress"&&!p||h==="option"&&p!==u.value)&&_m(n,"value",p,u.value,!1),"checked"in f&&(p=f.checked)!==void 0&&p!==n.checked&&_m(n,"checked",p,u.checked,!1))}return n}function QA(n,e,t){try{typeof n=="function"?n(e):n.current=e}catch(r){pe.__e(r,t)}}function KA(n,e,t){var r,s;if(pe.unmount&&pe.unmount(n),(r=n.ref)&&(r.current&&r.current!==n.__e||QA(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){pe.__e(i,e)}r.base=r.__P=null,n.__c=void 0}if(r=n.__k)for(s=0;s<r.length;s++)r[s]&&KA(r[s],e,t||typeof n.type!="function");t||n.__e==null||WA(n.__e),n.__=n.__e=n.__d=void 0}function PW(n,e,t){return this.constructor(n,t)}function ga(n,e,t){var r,s,i;pe.__&&pe.__(n,e),s=(r=typeof t=="function")?null:t&&t.__k||e.__k,i=[],lw(e,n=(!r&&t||e).__k=k($e,null,[n]),s||Pm,Pm,e.ownerSVGElement!==void 0,!r&&t?[t]:s?null:e.firstChild?Im.call(e.childNodes):null,i,!r&&t?t:s?s.__e:e.firstChild,r),GA(i,n)}function Rm(n,e){var t={__c:e="__cC"+UA++,__:n,Consumer:function(r,s){return r.children(s)},Provider:function(r){var s,i;return this.getChildContext||(s=[],(i={})[e]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(a){this.props.value!==a.value&&s.some(function(o){o.__e=!0,aw(o)})},this.sub=function(a){s.push(a);var o=a.componentWillUnmount;a.componentWillUnmount=function(){s.splice(s.indexOf(a),1),o&&o.call(a)}}),r.children}};return t.Provider.__=t.Consumer.contextType=t}Im=jA.slice,pe={__e:function(n,e,t,r){for(var s,i,a;e=e.__;)if((s=e.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(n)),a=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,r||{}),a=s.__d),a)return s.__E=s}catch(o){n=o}throw n}},HA=0,ow=function(n){return n!=null&&n.constructor===void 0},ac=!1,Tr.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=ma({},this.state),typeof n=="function"&&(n=n(ma({},t),this.props)),n&&ma(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),aw(this))},Tr.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),aw(this))},Tr.prototype.render=$e,bo=[],BA=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Am.__r=0,UA=0;var AW,Yn,cw,ZA;var nI=[],dw=[],XA=pe.__b,JA=pe.__r,eI=pe.diffed,tI=pe.__c,rI=pe.unmount;function IW(){for(var n;n=nI.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(Nm),n.__H.__h.forEach(uw),n.__H.__h=[]}catch(e){n.__H.__h=[],pe.__e(e,n.__v)}}pe.__b=function(n){Yn=null,XA&&XA(n)},pe.__r=function(n){JA&&JA(n),AW=0;var e=(Yn=n.__c).__H;e&&(cw===Yn?(e.__h=[],Yn.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.__V=dw,t.__N=t.i=void 0})):(e.__h.forEach(Nm),e.__h.forEach(uw),e.__h=[])),cw=Yn},pe.diffed=function(n){eI&&eI(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(nI.push(e)!==1&&ZA===pe.requestAnimationFrame||((ZA=pe.requestAnimationFrame)||RW)(IW)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.__V!==dw&&(t.__=t.__V),t.i=void 0,t.__V=dw})),cw=Yn=null},pe.__c=function(n,e){e.some(function(t){try{t.__h.forEach(Nm),t.__h=t.__h.filter(function(r){return!r.__||uw(r)})}catch(r){e.some(function(s){s.__h&&(s.__h=[])}),e=[],pe.__e(r,t.__v)}}),tI&&tI(n,e)},pe.unmount=function(n){rI&&rI(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(r){try{Nm(r)}catch(s){e=s}}),t.__H=void 0,e&&pe.__e(e,t.__v))};var sI=typeof requestAnimationFrame=="function";function RW(n){var e,t=function(){clearTimeout(r),sI&&cancelAnimationFrame(e),setTimeout(n)},r=setTimeout(t,100);sI&&(e=requestAnimationFrame(t))}function Nm(n){var e=Yn,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),Yn=e}function uw(n){var e=Yn;n.__c=n.__(),Yn=e}function NW(n,e){for(var t in e)n[t]=e[t];return n}function iI(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var r in e)if(r!=="__source"&&n[r]!==e[r])return!0;return!1}function aI(n){this.props=n}(aI.prototype=new Tr).isPureReactComponent=!0,aI.prototype.shouldComponentUpdate=function(n,e){return iI(this.props,n)||iI(this.state,e)};var oI=pe.__b;pe.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),oI&&oI(n)};var Noe=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var OW=pe.__e;pe.__e=function(n,e,t,r){if(n.then){for(var s,i=e;i=i.__;)if((s=i.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(n,e)}OW(n,e,t,r)};var lI=pe.unmount;function pI(n,e,t){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),n.__c.__H=null),(n=NW({},n)).__c!=null&&(n.__c.__P===t&&(n.__c.__P=e),n.__c=null),n.__k=n.__k&&n.__k.map(function(r){return pI(r,e,t)})),n}function mI(n,e,t){return n&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(r){return mI(r,e,t)}),n.__c&&n.__c.__P===e&&(n.__e&&t.insertBefore(n.__e,n.__d),n.__c.__e=!0,n.__c.__P=t)),n}function hw(){this.__u=0,this.t=null,this.__b=null}function gI(n){var e=n.__.__c;return e&&e.__a&&e.__a(n)}function Om(){this.u=null,this.o=null}pe.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&n.__h===!0&&(n.type=null),lI&&lI(n)},(hw.prototype=new Tr).__c=function(n,e){var t=e.__c,r=this;r.t==null&&(r.t=[]),r.t.push(t);var s=gI(r.__v),i=!1,a=function(){i||(i=!0,t.__R=null,s?s(o):o())};t.__R=a;var o=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=mI(c,c.__c.__P,c.__c.__O)}var d;for(r.setState({__a:r.__b=null});d=r.t.pop();)d.forceUpdate()}},l=e.__h===!0;r.__u++||l||r.setState({__a:r.__b=r.__v.__k[0]}),n.then(a,a)},hw.prototype.componentWillUnmount=function(){this.t=[]},hw.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=pI(this.__b,t,r.__O=r.__P)}this.__b=null}var s=e.__a&&k($e,null,n.fallback);return s&&(s.__h=null),[k($e,null,e.__a?null:n.children),s]};var cI=function(n,e,t){if(++t[1]===t[0]&&n.o.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.o.size))for(t=n.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.u=t=t[2]}};function LW(n){return this.getChildContext=function(){return n.context},n.children}function FW(n){var e=this,t=n.i;e.componentWillUnmount=function(){ga(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),n.__v?(e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],appendChild:function(r){this.childNodes.push(r),e.i.appendChild(r)},insertBefore:function(r,s){this.childNodes.push(r),e.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.i.removeChild(r)}}),ga(k(LW,{context:e.context},n.__v),e.l)):e.l&&e.componentWillUnmount()}function yI(n,e){var t=k(FW,{__v:n,i:e});return t.containerInfo=e,t}(Om.prototype=new Tr).__a=function(n){var e=this,t=gI(e.__v),r=e.o.get(n);return r[0]++,function(s){var i=function(){e.props.revealOrder?(r.push(s),cI(e,n,r)):s()};t?t(i):i()}},Om.prototype.render=function(n){this.u=null,this.o=new Map;var e=nu(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return n.children},Om.prototype.componentDidUpdate=Om.prototype.componentDidMount=function(){var n=this;this.o.forEach(function(e,t){cI(n,t,e)})};var HW=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,BW=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,UW=typeof document!="undefined",jW=function(n){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(n)};Tr.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(Tr.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var dI=pe.event;function WW(){}function VW(){return this.cancelBubble}function $W(){return this.defaultPrevented}pe.event=function(n){return dI&&(n=dI(n)),n.persist=WW,n.isPropagationStopped=VW,n.isDefaultPrevented=$W,n.nativeEvent=n};var YW,uI={configurable:!0,get:function(){return this.class}},hI=pe.vnode;pe.vnode=function(n){var e=n.type,t=n.props,r=t;if(typeof e=="string"){var s=e.indexOf("-")===-1;for(var i in r={},t){var a=t[i];UW&&i==="children"&&e==="noscript"||i==="value"&&"defaultValue"in t&&a==null||(i==="defaultValue"&&"value"in t&&t.value==null?i="value":i==="download"&&a===!0?a="":/ondoubleclick/i.test(i)?i="ondblclick":/^onchange(textarea|input)/i.test(i+e)&&!jW(t.type)?i="oninput":/^onfocus$/i.test(i)?i="onfocusin":/^onblur$/i.test(i)?i="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(i)?i=i.toLowerCase():s&&BW.test(i)?i=i.replace(/[A-Z0-9]/g,"-$&").toLowerCase():a===null&&(a=void 0),/^oninput$/i.test(i)&&(i=i.toLowerCase(),r[i]&&(i="oninputCapture")),r[i]=a)}e=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=nu(t.children).forEach(function(o){o.props.selected=r.value.indexOf(o.props.value)!=-1})),e=="select"&&r.defaultValue!=null&&(r.value=nu(t.children).forEach(function(o){o.props.selected=r.multiple?r.defaultValue.indexOf(o.props.value)!=-1:r.defaultValue==o.props.value})),n.props=r,t.class!=t.className&&(uI.enumerable="className"in t,t.className!=null&&(r.class=t.className),Object.defineProperty(r,"className",uI))}n.$$typeof=HW,hI&&hI(n)};var fI=pe.__r;pe.__r=function(n){fI&&fI(n),YW=n.__c};var AI=[],Ew=new Map;function Qn(n){AI.push(n),Ew.forEach(e=>{NI(e,n)})}function II(n){n.isConnected&&n.getRootNode&&RI(n.getRootNode())}function RI(n){let e=Ew.get(n);if(!e||!e.isConnected){if(e=n.querySelector("style[data-fullcalendar]"),!e){e=document.createElement("style"),e.setAttribute("data-fullcalendar","");let t=qW();t&&(e.nonce=t);let r=n===document?document.head:n,s=n===document?r.querySelector("script,link[rel=stylesheet],link[as=style],style"):r.firstChild;r.insertBefore(e,s)}Ew.set(n,e),zW(e)}}function zW(n){for(let e of AI)NI(n,e)}function NI(n,e){let{sheet:t}=n,r=t.cssRules.length;e.split("}").forEach((s,i)=>{s=s.trim(),s&&t.insertRule(s+"}",r+i)})}var fw;function qW(){return fw===void 0&&(fw=GW()),fw}function GW(){let n=document.querySelector('meta[name="csp-nonce"]');if(n&&n.hasAttribute("content"))return n.getAttribute("content");let e=document.querySelector("script[nonce]");return e&&e.nonce||""}typeof document!="undefined"&&RI(document);var QW=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';Qn(QW);var So=class{constructor(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),e==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))}pause(e=""){let{pauseDepths:t}=this;t[e]=(t[e]||0)+1,this.clearTimeout()}resume(e="",t){let{pauseDepths:r}=this;e in r&&(t?delete r[e]:(r[e]-=1,r[e]<=0&&delete r[e]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}};function wu(n){n.parentNode&&n.parentNode.removeChild(n)}function tr(n,e){if(n.closest)return n.closest(e);if(!document.documentElement.contains(n))return null;do{if(Xm(n,e))return n;n=n.parentElement||n.parentNode}while(n!==null&&n.nodeType===1);return null}function Xm(n,e){return(n.matches||n.matchesSelector||n.msMatchesSelector).call(n,e)}function OI(n,e){let t=n instanceof HTMLElement?[n]:n,r=[];for(let s=0;s<t.length;s+=1){let i=t[s].querySelectorAll(e);for(let a=0;a<i.length;a+=1)r.push(i[a])}return r}var KW=/(top|left|right|bottom|width|height)$/i;function Oo(n,e){for(let t in e)Rw(n,t,e[t])}function Rw(n,e,t){t==null?n.style[e]="":typeof t=="number"&&KW.test(e)?n.style[e]=`${t}px`:n.style[e]=t}function Jm(n){var e,t;return(t=(e=n.composedPath)===null||e===void 0?void 0:e.call(n)[0])!==null&&t!==void 0?t:n.target}var vI=0;function is(){return vI+=1,"fc-dom-"+vI}function bu(n){n.preventDefault()}function ZW(n,e){return t=>{let r=tr(t.target,n);r&&e.call(r,t,r)}}function Nw(n,e,t,r){let s=ZW(t,r);return n.addEventListener(e,s),()=>{n.removeEventListener(e,s)}}function LI(n,e,t,r){let s;return Nw(n,"mouseover",e,(i,a)=>{if(a!==s){s=a,t(i,a);let o=l=>{s=null,r(l,a),a.removeEventListener("mouseleave",o)};a.addEventListener("mouseleave",o)}})}var TI=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function Ow(n,e){let t=r=>{e(r),TI.forEach(s=>{n.removeEventListener(s,t)})};TI.forEach(r=>{n.addEventListener(r,t)})}function FI(n){return Object.assign({onClick:n},HI(n))}function HI(n){return{tabIndex:0,onKeyDown(e){(e.key==="Enter"||e.key===" ")&&(n(e),e.preventDefault())}}}var wI=0;function Li(){return wI+=1,String(wI)}function hc(){document.body.classList.add("fc-not-allowed")}function fc(){document.body.classList.remove("fc-not-allowed")}function Lw(n){n.style.userSelect="none",n.style.webkitUserSelect="none",n.addEventListener("selectstart",bu)}function Fw(n){n.style.userSelect="",n.style.webkitUserSelect="",n.removeEventListener("selectstart",bu)}function Hw(n){n.addEventListener("contextmenu",bu)}function Bw(n){n.removeEventListener("contextmenu",bu)}function BI(n){let e=[],t=[],r,s;for(typeof n=="string"?t=n.split(/\s*,\s*/):typeof n=="function"?t=[n]:Array.isArray(n)&&(t=n),r=0;r<t.length;r+=1)s=t[r],typeof s=="string"?e.push(s.charAt(0)==="-"?{field:s.substring(1),order:-1}:{field:s,order:1}):typeof s=="function"&&e.push({func:s});return e}function UI(n,e,t){let r,s;for(r=0;r<t.length;r+=1)if(s=XW(n,e,t[r]),s)return s;return 0}function XW(n,e,t){return t.func?t.func(n,e):jI(n[t.field],e[t.field])*(t.order||1)}function jI(n,e){return!n&&!e?0:e==null?-1:n==null?1:typeof n=="string"||typeof e=="string"?String(n).localeCompare(String(e)):n-e}function Eo(n,e){let t=String(n);return"000".substr(0,e-t.length)+t}function pc(n,e,t){return typeof n=="function"?n(...e):typeof n=="string"?e.reduce((r,s,i)=>r.replace("$"+i,s||""),n):t}function Uw(n,e){return n-e}function iu(n){return n%1===0}function JW(n){let e=n.querySelector(".fc-scrollgrid-shrink-frame"),t=n.querySelector(".fc-scrollgrid-shrink-cushion");if(!e)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!t)throw new Error("needs fc-scrollgrid-shrink-cushion className");return n.getBoundingClientRect().width-e.getBoundingClientRect().width+t.getBoundingClientRect().width}var bI=["years","months","days","milliseconds"],eV=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function De(n,e){return typeof n=="string"?tV(n):typeof n=="object"&&n?kI(n):typeof n=="number"?kI({[e||"milliseconds"]:n}):null}function tV(n){let e=eV.exec(n);if(e){let t=e[1]?-1:1;return{years:0,months:0,days:t*(e[2]?parseInt(e[2],10):0),milliseconds:t*((e[3]?parseInt(e[3],10):0)*60*60*1e3+(e[4]?parseInt(e[4],10):0)*60*1e3+(e[5]?parseInt(e[5],10):0)*1e3+(e[6]?parseInt(e[6],10):0))}}return null}function kI(n){let e={years:n.years||n.year||0,months:n.months||n.month||0,days:n.days||n.day||0,milliseconds:(n.hours||n.hour||0)*60*60*1e3+(n.minutes||n.minute||0)*60*1e3+(n.seconds||n.second||0)*1e3+(n.milliseconds||n.millisecond||n.ms||0)},t=n.weeks||n.week;return t&&(e.days+=t*7,e.specifiedWeeks=!0),e}function rV(n,e){return n.years===e.years&&n.months===e.months&&n.days===e.days&&n.milliseconds===e.milliseconds}function ku(n,e){return{years:n.years+e.years,months:n.months+e.months,days:n.days+e.days,milliseconds:n.milliseconds+e.milliseconds}}function WI(n,e){return{years:n.years-e.years,months:n.months-e.months,days:n.days-e.days,milliseconds:n.milliseconds-e.milliseconds}}function jw(n,e){return{years:n.years*e,months:n.months*e,days:n.days*e,milliseconds:n.milliseconds*e}}function sV(n){return oc(n)/365}function nV(n){return oc(n)/30}function oc(n){return Es(n)/864e5}function Es(n){return n.years*(365*864e5)+n.months*(30*864e5)+n.days*864e5+n.milliseconds}function Eu(n,e){let t=null;for(let r=0;r<bI.length;r+=1){let s=bI[r];if(e[s]){let i=n[s]/e[s];if(!iu(i)||t!==null&&t!==i)return null;t=i}else if(n[s])return null}return t}function au(n){let e=n.milliseconds;if(e){if(e%1e3!==0)return{unit:"millisecond",value:e};if(e%(1e3*60)!==0)return{unit:"second",value:e/1e3};if(e%(1e3*60*60)!==0)return{unit:"minute",value:e/(1e3*60)};if(e)return{unit:"hour",value:e/(1e3*60*60)}}return n.days?n.specifiedWeeks&&n.days%7===0?{unit:"week",value:n.days/7}:{unit:"day",value:n.days}:n.months?{unit:"month",value:n.months}:n.years?{unit:"year",value:n.years}:{unit:"millisecond",value:0}}function Kn(n,e,t){if(n===e)return!0;let r=n.length,s;if(r!==e.length)return!1;for(s=0;s<r;s+=1)if(!(t?t(n[s],e[s]):n[s]===e[s]))return!1;return!0}var iV=["sun","mon","tue","wed","thu","fri","sat"];function eg(n,e){let t=va(n);return t[2]+=e*7,rs(t)}function kt(n,e){let t=va(n);return t[2]+=e,rs(t)}function zn(n,e){let t=va(n);return t[6]+=e,rs(t)}function Ww(n,e){return Zn(n,e)/7}function Zn(n,e){return(e.valueOf()-n.valueOf())/(1e3*60*60*24)}function aV(n,e){return(e.valueOf()-n.valueOf())/(1e3*60*60)}function oV(n,e){return(e.valueOf()-n.valueOf())/(1e3*60)}function lV(n,e){return(e.valueOf()-n.valueOf())/1e3}function VI(n,e){let t=tt(n),r=tt(e);return{years:0,months:0,days:Math.round(Zn(t,r)),milliseconds:e.valueOf()-r.valueOf()-(n.valueOf()-t.valueOf())}}function $I(n,e){let t=lc(n,e);return t!==null&&t%7===0?t/7:null}function lc(n,e){return Ta(n)===Ta(e)?Math.round(Zn(n,e)):null}function tt(n){return rs([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()])}function cV(n){return rs([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours()])}function dV(n){return rs([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes()])}function uV(n){return rs([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds()])}function hV(n,e,t){let r=n.getUTCFullYear(),s=pw(n,r,e,t);if(s<1)return pw(n,r-1,e,t);let i=pw(n,r+1,e,t);return i>=1?Math.min(s,i):s}function pw(n,e,t,r){let s=rs([e,0,1+fV(e,t,r)]),i=tt(n),a=Math.round(Zn(s,i));return Math.floor(a/7)+1}function fV(n,e,t){let r=7+e-t;return-((7+rs([n,0,r]).getUTCDay()-e)%7)+r-1}function EI(n){return[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()]}function SI(n){return new Date(n[0],n[1]||0,n[2]==null?1:n[2],n[3]||0,n[4]||0,n[5]||0)}function va(n){return[n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()]}function rs(n){return n.length===1&&(n=n.concat([0])),new Date(Date.UTC(...n))}function Vw(n){return!isNaN(n.valueOf())}function Ta(n){return n.getUTCHours()*1e3*60*60+n.getUTCMinutes()*1e3*60+n.getUTCSeconds()*1e3+n.getUTCMilliseconds()}function tg(n,e,t=!1){let r=n.toISOString();return r=r.replace(".000",""),t&&(r=r.replace("T00:00:00Z","")),r.length>10&&(e==null?r=r.replace("Z",""):e!==0&&(r=r.replace("Z",Yw(e,!0)))),r}function Sa(n){return n.toISOString().replace(/T.*$/,"")}function mc(n){return n.toISOString().match(/^\d{4}-\d{2}/)[0]}function $w(n){return Eo(n.getUTCHours(),2)+":"+Eo(n.getUTCMinutes(),2)+":"+Eo(n.getUTCSeconds(),2)}function Yw(n,e=!1){let t=n<0?"-":"+",r=Math.abs(n),s=Math.floor(r/60),i=Math.round(r%60);return e?`${t+Eo(s,2)}:${Eo(i,2)}`:`GMT${t}${s}${i?`:${Eo(i,2)}`:""}`}function le(n,e,t){let r,s;return function(...i){if(!r)s=n.apply(this,i);else if(!Kn(r,i)){t&&t(s);let a=n.apply(this,i);(!e||!e(a,s))&&(s=a)}return r=i,s}}function gc(n,e,t){let r,s;return i=>{if(!r)s=n.call(this,i);else if(!Ar(r,i)){t&&t(s);let a=n.call(this,i);(!e||!e(a,s))&&(s=a)}return r=i,s}}var mw={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},Vm={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},Lm=/\s*([ap])\.?m\.?/i,pV=/,/g,mV=/\s+/g,gV=/\u200e/g,yV=/UTC|GMT/,Sw=class{constructor(e){let t={},r={},s=9;for(let i in e)i in mw?(r[i]=e[i],mw[i]<9&&(s=Math.min(mw[i],s))):(t[i]=e[i],i in Vm&&(s=Math.min(Vm[i],s)));this.standardDateProps=t,this.extendedSettings=r,this.smallestUnitNum=s,this.buildFormattingFunc=le(DI)}format(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)}formatRange(e,t,r,s){let{standardDateProps:i,extendedSettings:a}=this,o=EV(e.marker,t.marker,r.calendarSystem);if(!o)return this.format(e,r);let l=o;l>1&&(i.year==="numeric"||i.year==="2-digit")&&(i.month==="numeric"||i.month==="2-digit")&&(i.day==="numeric"||i.day==="2-digit")&&(l=1);let c=this.format(e,r),d=this.format(t,r);if(c===d)return c;let u=SV(i,l),f=DI(u,a,r),h=f(e),p=f(t),m=DV(c,h,d,p),g=a.separator||s||r.defaultSeparator||"";return m?m.before+h+g+p+m.after:c+g+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}};function DI(n,e,t){let r=Object.keys(n).length;return r===1&&n.timeZoneName==="short"?s=>Yw(s.timeZoneOffset):r===0&&e.week?s=>kV(t.computeWeekNumber(s.marker),t.weekText,t.weekTextLong,t.locale,e.week):vV(n,e,t)}function vV(n,e,t){n=Object.assign({},n),e=Object.assign({},e),TV(n,e),n.timeZone="UTC";let r=new Intl.DateTimeFormat(t.locale.codes,n),s;if(e.omitZeroMinute){let i=Object.assign({},n);delete i.minute,s=new Intl.DateTimeFormat(t.locale.codes,i)}return i=>{let{marker:a}=i,o;s&&!a.getUTCMinutes()?o=s:o=r;let l=o.format(a);return wV(l,i,n,e,t)}}function TV(n,e){n.timeZoneName&&(n.hour||(n.hour="2-digit"),n.minute||(n.minute="2-digit")),n.timeZoneName==="long"&&(n.timeZoneName="short"),e.omitZeroMinute&&(n.second||n.millisecond)&&delete e.omitZeroMinute}function wV(n,e,t,r,s){return n=n.replace(gV,""),t.timeZoneName==="short"&&(n=bV(n,s.timeZone==="UTC"||e.timeZoneOffset==null?"UTC":Yw(e.timeZoneOffset))),r.omitCommas&&(n=n.replace(pV,"").trim()),r.omitZeroMinute&&(n=n.replace(":00","")),r.meridiem===!1?n=n.replace(Lm,"").trim():r.meridiem==="narrow"?n=n.replace(Lm,(i,a)=>a.toLocaleLowerCase()):r.meridiem==="short"?n=n.replace(Lm,(i,a)=>`${a.toLocaleLowerCase()}m`):r.meridiem==="lowercase"&&(n=n.replace(Lm,i=>i.toLocaleLowerCase())),n=n.replace(mV," "),n=n.trim(),n}function bV(n,e){let t=!1;return n=n.replace(yV,()=>(t=!0,e)),t||(n+=` ${e}`),n}function kV(n,e,t,r,s){let i=[];return s==="long"?i.push(t):(s==="short"||s==="narrow")&&i.push(e),(s==="long"||s==="short")&&i.push(" "),i.push(r.simpleNumberFormat.format(n)),r.options.direction==="rtl"&&i.reverse(),i.join("")}function EV(n,e,t){return t.getMarkerYear(n)!==t.getMarkerYear(e)?5:t.getMarkerMonth(n)!==t.getMarkerMonth(e)?4:t.getMarkerDay(n)!==t.getMarkerDay(e)?2:Ta(n)!==Ta(e)?1:0}function SV(n,e){let t={};for(let r in n)(!(r in Vm)||Vm[r]<=e)&&(t[r]=n[r]);return t}function DV(n,e,t,r){let s=0;for(;s<n.length;){let i=n.indexOf(e,s);if(i===-1)break;let a=n.substr(0,i);s=i+e.length;let o=n.substr(s),l=0;for(;l<t.length;){let c=t.indexOf(r,l);if(c===-1)break;let d=t.substr(0,c);l=c+r.length;let u=t.substr(l);if(a===d&&o===u)return{before:a,after:o}}}return null}function xI(n,e){let t=e.markerToArray(n.marker);return{marker:n.marker,timeZoneOffset:n.timeZoneOffset,array:t,year:t[0],month:t[1],day:t[2],hour:t[3],minute:t[4],second:t[5],millisecond:t[6]}}function $m(n,e,t,r){let s=xI(n,t.calendarSystem),i=e?xI(e,t.calendarSystem):null;return{date:s,start:s,end:i,timeZone:t.timeZone,localeCodes:t.locale.codes,defaultSeparator:r||t.defaultSeparator}}var Dw=class{constructor(e){this.cmdStr=e}format(e,t,r){return t.cmdFormatter(this.cmdStr,$m(e,null,t,r))}formatRange(e,t,r,s){return r.cmdFormatter(this.cmdStr,$m(e,t,r,s))}},xw=class{constructor(e){this.func=e}format(e,t,r){return this.func($m(e,null,t,r))}formatRange(e,t,r,s){return this.func($m(e,t,r,s))}};function Ye(n){return typeof n=="object"&&n?new Sw(n):typeof n=="string"?new Dw(n):typeof n=="function"?new xw(n):null}var zw={navLinkDayClick:N,navLinkWeekClick:N,duration:De,bootstrapFontAwesome:N,buttonIcons:N,customButtons:N,defaultAllDayEventDuration:De,defaultTimedEventDuration:De,nextDayThreshold:De,scrollTime:De,scrollTimeReset:Boolean,slotMinTime:De,slotMaxTime:De,dayPopoverFormat:Ye,slotDuration:De,snapDuration:De,headerToolbar:N,footerToolbar:N,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:Ye,dayHeaderClassNames:N,dayHeaderContent:N,dayHeaderDidMount:N,dayHeaderWillUnmount:N,dayCellClassNames:N,dayCellContent:N,dayCellDidMount:N,dayCellWillUnmount:N,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:N,weekNumbers:Boolean,weekNumberClassNames:N,weekNumberContent:N,weekNumberDidMount:N,weekNumberWillUnmount:N,editable:Boolean,viewClassNames:N,viewDidMount:N,viewWillUnmount:N,nowIndicator:Boolean,nowIndicatorSnap:N,nowIndicatorClassNames:N,nowIndicatorContent:N,nowIndicatorDidMount:N,nowIndicatorWillUnmount:N,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:N,locale:N,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:N,eventOrder:BI,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:N,contentHeight:N,direction:String,weekNumberFormat:Ye,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:N,initialDate:N,now:N,eventDataTransform:N,stickyHeaderDates:N,stickyFooterScrollbar:N,viewHeight:N,defaultAllDay:Boolean,eventSourceFailure:N,eventSourceSuccess:N,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:N,eventConstraint:N,eventAllow:N,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:N,eventContent:N,eventDidMount:N,eventWillUnmount:N,selectConstraint:N,selectOverlap:N,selectAllow:N,droppable:Boolean,unselectCancel:String,slotLabelFormat:N,slotLaneClassNames:N,slotLaneContent:N,slotLaneDidMount:N,slotLaneWillUnmount:N,slotLabelClassNames:N,slotLabelContent:N,slotLabelDidMount:N,slotLabelWillUnmount:N,dayMaxEvents:N,dayMaxEventRows:N,dayMinWidth:Number,slotLabelInterval:De,allDayText:String,allDayClassNames:N,allDayContent:N,allDayDidMount:N,allDayWillUnmount:N,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:Ye,rerenderDelay:Number,moreLinkText:N,moreLinkHint:N,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:N,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:De,hiddenDays:N,fixedWeekCount:Boolean,validRange:N,visibleRange:N,titleFormat:N,eventInteractive:Boolean,noEventsText:String,viewHint:N,navLinkHint:N,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:N,moreLinkClassNames:N,moreLinkContent:N,moreLinkDidMount:N,moreLinkWillUnmount:N,monthStartFormat:Ye,handleCustomRendering:N,customRenderingMetaMap:N,customRenderingReplaces:Boolean},Xn={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},qw={datesSet:N,eventsSet:N,eventAdd:N,eventChange:N,eventRemove:N,windowResize:N,eventClick:N,eventMouseEnter:N,eventMouseLeave:N,select:N,unselect:N,loading:N,_unmount:N,_beforeprint:N,_afterprint:N,_noEventDrop:N,_noEventResize:N,_resize:N,_scrollRequest:N},Gw={buttonText:N,buttonHints:N,views:N,plugins:N,initialEvents:N,events:N,eventSources:N},Da={headerToolbar:ko,footerToolbar:ko,buttonText:ko,buttonHints:ko,buttonIcons:ko,dateIncrement:ko,plugins:Fm,events:Fm,eventSources:Fm,resources:Fm};function ko(n,e){return typeof n=="object"&&typeof e=="object"&&n&&e?Ar(n,e):n===e}function Fm(n,e){return Array.isArray(n)&&Array.isArray(e)?Kn(n,e):n===e}var YI={type:String,component:N,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:N,usesMinMaxTime:Boolean,classNames:N,content:N,didMount:N,willUnmount:N};function rg(n){return sg(n,Da)}function Su(n,e){let t={},r={};for(let s in e)s in n&&(t[s]=e[s](n[s]));for(let s in n)s in e||(r[s]=n[s]);return{refined:t,extra:r}}function N(n){return n}var{hasOwnProperty:Ym}=Object.prototype;function sg(n,e){let t={};if(e){for(let r in e)if(e[r]===ko){let s=[];for(let i=n.length-1;i>=0;i-=1){let a=n[i][r];if(typeof a=="object"&&a)s.unshift(a);else if(a!==void 0){t[r]=a;break}}s.length&&(t[r]=sg(s))}}for(let r=n.length-1;r>=0;r-=1){let s=n[r];for(let i in s)i in t||(t[i]=s[i])}return t}function Ai(n,e){let t={};for(let r in n)e(n[r],r)&&(t[r]=n[r]);return t}function Js(n,e){let t={};for(let r in n)t[r]=e(n[r],r);return t}function Qw(n){let e={};for(let t of n)e[t]=!0;return e}function ng(n){let e=[];for(let t in n)e.push(n[t]);return e}function Ar(n,e){if(n===e)return!0;for(let t in n)if(Ym.call(n,t)&&!(t in e))return!1;for(let t in e)if(Ym.call(e,t)&&n[t]!==e[t])return!1;return!0}var xV=/^on[A-Z]/;function CV(n,e){let t=MV(n,e);for(let r of t)if(!xV.test(r))return!1;return!0}function MV(n,e){let t=[];for(let r in n)Ym.call(n,r)&&(r in e||t.push(r));for(let r in e)Ym.call(e,r)&&n[r]!==e[r]&&t.push(r);return t}function jm(n,e,t={}){if(n===e)return!0;for(let r in e)if(!(r in n&&PV(n[r],e[r],t[r])))return!1;for(let r in n)if(!(r in e))return!1;return!0}function PV(n,e,t){return n===e||t===!0?!0:t?t(n,e):!1}function zI(n,e=0,t,r=1){let s=[];t==null&&(t=Object.keys(n).length);for(let i=e;i<t;i+=r){let a=n[i];a!==void 0&&s.push(a)}return s}var qI={};function _V(n,e){qI[n]=e}function AV(n){return new qI[n]}var Cw=class{getMarkerYear(e){return e.getUTCFullYear()}getMarkerMonth(e){return e.getUTCMonth()}getMarkerDay(e){return e.getUTCDate()}arrayToMarker(e){return rs(e)}markerToArray(e){return va(e)}};_V("gregory",Cw);var IV=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function GI(n){let e=IV.exec(n);if(e){let t=new Date(Date.UTC(Number(e[1]),e[3]?Number(e[3])-1:0,Number(e[5]||1),Number(e[7]||0),Number(e[8]||0),Number(e[10]||0),e[12]?+`0.${e[12]}`*1e3:0));if(Vw(t)){let r=null;return e[13]&&(r=(e[15]==="-"?-1:1)*(Number(e[16]||0)*60+Number(e[18]||0))),{marker:t,isTimeUnspecified:!e[6],timeZoneOffset:r}}}return null}var ou=class{constructor(e){let t=this.timeZone=e.timeZone,r=t!=="local"&&t!=="UTC";e.namedTimeZoneImpl&&r&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=!!(!r||this.namedTimeZoneImpl),this.calendarSystem=AV(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,e.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof e.firstDay=="number"&&(this.weekDow=e.firstDay),typeof e.weekNumberCalculation=="function"&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=e.weekText!=null?e.weekText:e.locale.options.weekText,this.weekTextLong=(e.weekTextLong!=null?e.weekTextLong:e.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}createMarker(e){let t=this.createMarkerMeta(e);return t===null?null:t.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):rs(EI(new Date))}createMarkerMeta(e){if(typeof e=="string")return this.parse(e);let t=null;return typeof e=="number"?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=rs(e)),t===null||!Vw(t)?null:{marker:t,isTimeUnspecified:!1,forcedTzo:null}}parse(e){let t=GI(e);if(t===null)return null;let{marker:r}=t,s=null;return t.timeZoneOffset!==null&&(this.canComputeOffset?r=this.timestampToMarker(r.valueOf()-t.timeZoneOffset*60*1e3):s=t.timeZoneOffset),{marker:r,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:s}}getYear(e){return this.calendarSystem.getMarkerYear(e)}getMonth(e){return this.calendarSystem.getMarkerMonth(e)}getDay(e){return this.calendarSystem.getMarkerDay(e)}add(e,t){let r=this.calendarSystem.markerToArray(e);return r[0]+=t.years,r[1]+=t.months,r[2]+=t.days,r[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(r)}subtract(e,t){let r=this.calendarSystem.markerToArray(e);return r[0]-=t.years,r[1]-=t.months,r[2]-=t.days,r[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(r)}addYears(e,t){let r=this.calendarSystem.markerToArray(e);return r[0]+=t,this.calendarSystem.arrayToMarker(r)}addMonths(e,t){let r=this.calendarSystem.markerToArray(e);return r[1]+=t,this.calendarSystem.arrayToMarker(r)}diffWholeYears(e,t){let{calendarSystem:r}=this;return Ta(e)===Ta(t)&&r.getMarkerDay(e)===r.getMarkerDay(t)&&r.getMarkerMonth(e)===r.getMarkerMonth(t)?r.getMarkerYear(t)-r.getMarkerYear(e):null}diffWholeMonths(e,t){let{calendarSystem:r}=this;return Ta(e)===Ta(t)&&r.getMarkerDay(e)===r.getMarkerDay(t)?r.getMarkerMonth(t)-r.getMarkerMonth(e)+(r.getMarkerYear(t)-r.getMarkerYear(e))*12:null}greatestWholeUnit(e,t){let r=this.diffWholeYears(e,t);return r!==null?{unit:"year",value:r}:(r=this.diffWholeMonths(e,t),r!==null?{unit:"month",value:r}:(r=$I(e,t),r!==null?{unit:"week",value:r}:(r=lc(e,t),r!==null?{unit:"day",value:r}:(r=aV(e,t),iu(r)?{unit:"hour",value:r}:(r=oV(e,t),iu(r)?{unit:"minute",value:r}:(r=lV(e,t),iu(r)?{unit:"second",value:r}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}))))))}countDurationsBetween(e,t,r){let s;return r.years&&(s=this.diffWholeYears(e,t),s!==null)?s/sV(r):r.months&&(s=this.diffWholeMonths(e,t),s!==null)?s/nV(r):r.days&&(s=lc(e,t),s!==null)?s/oc(r):(t.valueOf()-e.valueOf())/Es(r)}startOf(e,t){return t==="year"?this.startOfYear(e):t==="month"?this.startOfMonth(e):t==="week"?this.startOfWeek(e):t==="day"?tt(e):t==="hour"?cV(e):t==="minute"?dV(e):t==="second"?uV(e):null}startOfYear(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])}startOfMonth(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])}startOfWeek(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):hV(e,this.weekDow,this.weekDoy)}format(e,t,r={}){return t.format({marker:e,timeZoneOffset:r.forcedTzo!=null?r.forcedTzo:this.offsetForMarker(e)},this)}formatRange(e,t,r,s={}){return s.isEndExclusive&&(t=zn(t,-1)),r.formatRange({marker:e,timeZoneOffset:s.forcedStartTzo!=null?s.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:s.forcedEndTzo!=null?s.forcedEndTzo:this.offsetForMarker(t)},this,s.defaultSeparator)}formatIso(e,t={}){let r=null;return t.omitTimeZoneOffset||(t.forcedTzo!=null?r=t.forcedTzo:r=this.offsetForMarker(e)),tg(e,r,t.omitTime)}timestampToMarker(e){return this.timeZone==="local"?rs(EI(new Date(e))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(e):rs(this.namedTimeZoneImpl.timestampToArray(e))}offsetForMarker(e){return this.timeZone==="local"?-SI(va(e)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(va(e)):null}toDate(e,t){return this.timeZone==="local"?SI(va(e)):this.timeZone==="UTC"?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-this.namedTimeZoneImpl.offsetForArray(va(e))*1e3*60):new Date(e.valueOf()-(t||0))}},Ii=class{constructor(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}setIconOverride(e){let t,r;if(typeof e=="object"&&e){t=Object.assign({},this.iconClasses);for(r in e)t[r]=this.applyIconOverridePrefix(e[r]);this.iconClasses=t}else e===!1&&(this.iconClasses={})}applyIconOverridePrefix(e){let t=this.iconOverridePrefix;return t&&e.indexOf(t)!==0&&(e=t+e),e}getClass(e){return this.classes[e]||""}getIconClass(e,t){let r;return t&&this.rtlIconClasses?r=this.rtlIconClasses[e]||this.iconClasses[e]:r=this.iconClasses[e],r?`${this.baseIconClass} ${r}`:""}getCustomButtonIconClass(e){let t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption],t)?`${this.baseIconClass} ${this.applyIconOverridePrefix(t)}`:""}};Ii.prototype.classes={};Ii.prototype.iconClasses={};Ii.prototype.baseIconClass="";Ii.prototype.iconOverridePrefix="";function lu(n){n();let e=pe.debounceRendering,t=[];function r(s){t.push(s)}for(pe.debounceRendering=r,ga(k(Mw,{}),document.createElement("div"));t.length;)t.shift()();pe.debounceRendering=e}var Mw=class extends Tr{render(){return k("div",{})}componentDidMount(){this.setState({})}};function QI(n){let e=Rm(n),t=e.Provider;return e.Provider=function(){let r=!this.getChildContext,s=t.apply(this,arguments);if(r){let i=[];this.shouldComponentUpdate=a=>{this.props.value!==a.value&&i.forEach(o=>{o.context=a.value,o.forceUpdate()})},this.sub=a=>{i.push(a);let o=a.componentWillUnmount;a.componentWillUnmount=()=>{i.splice(i.indexOf(a),1),o&&o.call(a)}}}return s},e}var zm=class{constructor(e,t,r,s){this.execFunc=e,this.emitter=t,this.scrollTime=r,this.scrollTimeReset=s,this.handleScrollRequest=i=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},i),this.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(e){e&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}},en=QI({});function KI(n,e,t,r,s,i,a,o,l,c,d,u,f,h){return{dateEnv:s,nowManager:i,options:t,pluginHooks:o,emitter:d,dispatch:l,getCurrentData:c,calendarApi:u,viewSpec:n,viewApi:e,dateProfileGenerator:r,theme:a,isRtl:t.direction==="rtl",addResizeHandler(p){d.on("_resize",p)},removeResizeHandler(p){d.off("_resize",p)},createScrollResponder(p){return new zm(p,d,De(t.scrollTime),t.scrollTimeReset)},registerInteractiveComponent:f,unregisterInteractiveComponent:h}}var qn=class extends Tr{shouldComponentUpdate(e,t){return!jm(this.props,e,this.propEquality)||!jm(this.state,t,this.stateEquality)}safeSetState(e){jm(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}};qn.addPropsEquality=RV;qn.addStateEquality=NV;qn.contextType=en;qn.prototype.propEquality={};qn.prototype.stateEquality={};var Ie=class extends qn{};Ie.contextType=en;function RV(n){let e=Object.create(this.prototype.propEquality);Object.assign(e,n),this.prototype.propEquality=e}function NV(n){let e=Object.create(this.prototype.stateEquality);Object.assign(e,n),this.prototype.stateEquality=e}function Ds(n,e){typeof n=="function"?n(e):n&&(n.current=e)}var cu=class extends Ie{constructor(){super(...arguments),this.id=Li(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=e=>{let{options:t}=this.context,{generatorName:r}=this.props;(!t.customRenderingReplaces||!Pw(r,t))&&this.updateElRef(e)},this.updateElRef=e=>{this.props.elRef&&Ds(this.props.elRef,e)}}render(){let{props:e,context:t}=this,{options:r}=t,{customGenerator:s,defaultGenerator:i,renderProps:a}=e,o=Kw(e,[],this.handleEl),l=!1,c,d=[],u;if(s!=null){let f=typeof s=="function"?s(a,k):s;if(f===!0)l=!0;else{let h=f&&typeof f=="object";h&&"html"in f?o.dangerouslySetInnerHTML={__html:f.html}:h&&"domNodes"in f?d=Array.prototype.slice.call(f.domNodes):(h?ow(f):typeof f!="function")?c=f:u=f}}else l=!Pw(e.generatorName,r);return l&&i&&(c=i(a)),this.queuedDomNodes=d,this.currentGeneratorMeta=u,k(e.elTag,o,c)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(e){var t;let{props:r,context:s}=this,{handleCustomRendering:i,customRenderingMetaMap:a}=s.options;if(i){let o=(t=this.currentGeneratorMeta)!==null&&t!==void 0?t:a==null?void 0:a[r.generatorName];o&&i(Object.assign(Object.assign({id:this.id,isActive:e,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:o},r),{elClasses:(r.elClasses||[]).filter(OV)}))}}applyQueueudDomNodes(){let{queuedDomNodes:e,currentDomNodes:t}=this,r=this.base;if(!Kn(e,t)){t.forEach(wu);for(let s of e)r.appendChild(s);this.currentDomNodes=e}}};cu.addPropsEquality({elClasses:Kn,elStyle:Ar,elAttrs:CV,renderProps:Ar});function Pw(n,e){var t;return!!(e.handleCustomRendering&&n&&(!((t=e.customRenderingMetaMap)===null||t===void 0)&&t[n]))}function Kw(n,e,t){let r=Object.assign(Object.assign({},n.elAttrs),{ref:t});return(n.elClasses||e)&&(r.className=(n.elClasses||[]).concat(e||[]).concat(r.className||[]).filter(Boolean).join(" ")),n.elStyle&&(r.style=n.elStyle),r}function OV(n){return!!n}var Zw=QI(0),It=class extends Tr{constructor(){super(...arguments),this.InnerContent=LV.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(Ds(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){let{props:e}=this,t=FV(e.classNameGenerator,e.renderProps);if(e.children){let r=Kw(e,t,this.handleEl),s=e.children(this.InnerContent,e.renderProps,r);return e.elTag?k(e.elTag,r,s):s}else return k(cu,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(t),renderId:this.context}))}componentDidMount(){var e,t;this.el?(t=(e=this.props).didMount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,t;(t=(e=this.props).willUnmount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}};It.contextType=Zw;function LV(n,e){let t=n.props;return k(cu,Object.assign({renderProps:t.renderProps,generatorName:t.generatorName,customGenerator:t.customGenerator,defaultGenerator:t.defaultGenerator,renderId:n.context},e))}function FV(n,e){let t=typeof n=="function"?n(e):n||[];return typeof t=="string"?[t]:t}var Ss=class extends Ie{render(){let{props:e,context:t}=this,{options:r}=t,s={view:t.viewApi};return k(It,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:[...Xw(e.viewSpec),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,classNameGenerator:r.viewClassNames,generatorName:void 0,didMount:r.viewDidMount,willUnmount:r.viewWillUnmount},()=>e.children)}};function Xw(n){return[`fc-${n.type}-view`,"fc-view"]}function HV(n,e){let t=null,r=null;return n.start&&(t=e.createMarker(n.start)),n.end&&(r=e.createMarker(n.end)),!t&&!r||t&&r&&r<t?null:{start:t,end:r}}function CI(n,e){let t=[],{start:r}=e,s,i;for(n.sort(BV),s=0;s<n.length;s+=1)i=n[s],i.start>r&&t.push({start:r,end:i.start}),i.end>r&&(r=i.end);return r<e.end&&t.push({start:r,end:e.end}),t}function BV(n,e){return n.start.valueOf()-e.start.valueOf()}function Wr(n,e){let{start:t,end:r}=n,s=null;return e.start!==null&&(t===null?t=e.start:t=new Date(Math.max(t.valueOf(),e.start.valueOf()))),e.end!=null&&(r===null?r=e.end:r=new Date(Math.min(r.valueOf(),e.end.valueOf()))),(t===null||r===null||t<r)&&(s={start:t,end:r}),s}function ZI(n,e){return(n.start===null?null:n.start.valueOf())===(e.start===null?null:e.start.valueOf())&&(n.end===null?null:n.end.valueOf())===(e.end===null?null:e.end.valueOf())}function ig(n,e){return(n.end===null||e.start===null||n.end>e.start)&&(n.start===null||e.end===null||n.start<e.end)}function yc(n,e){return(n.start===null||e.start!==null&&e.start>=n.start)&&(n.end===null||e.end!==null&&e.end<=n.end)}function Xs(n,e){return(n.start===null||e>=n.start)&&(n.end===null||e<n.end)}function UV(n,e){return e.start!=null&&n<e.start?e.start:e.end!=null&&n>=e.end?new Date(e.end.valueOf()-1):n}function XI(n){let e=Math.floor(Zn(n.start,n.end))||1,t=tt(n.start),r=kt(t,e);return{start:t,end:r}}function ag(n,e=De(0)){let t=null,r=null;if(n.end){r=tt(n.end);let s=n.end.valueOf()-r.valueOf();s&&s>=Es(e)&&(r=kt(r,1))}return n.start&&(t=tt(n.start),r&&r<=t&&(r=kt(t,1))),{start:t,end:r}}function Jw(n){let e=ag(n);return Zn(e.start,e.end)>1}function wa(n,e,t,r){return r==="year"?De(t.diffWholeYears(n,e),"year"):r==="month"?De(t.diffWholeMonths(n,e),"month"):VI(n,e)}var Do=class{constructor(e){this.props=e,this.initHiddenDays()}buildPrev(e,t,r){let{dateEnv:s}=this.props,i=s.subtract(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(i,-1,r)}buildNext(e,t,r){let{dateEnv:s}=this.props,i=s.add(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(i,1,r)}build(e,t,r=!0){let{props:s}=this,i,a,o,l,c,d;return i=this.buildValidRange(),i=this.trimHiddenDays(i),r&&(e=UV(e,i)),a=this.buildCurrentRangeInfo(e,t),o=/^(year|month|week|day)$/.test(a.unit),l=this.buildRenderRange(this.trimHiddenDays(a.range),a.unit,o),l=this.trimHiddenDays(l),c=l,s.showNonCurrentDates||(c=Wr(c,a.range)),c=this.adjustActiveRange(c),c=Wr(c,i),d=ig(a.range,i),Xs(l,e)||(e=l.start),{currentDate:e,validRange:i,currentRange:a.range,currentRangeUnit:a.unit,isRangeAllDay:o,activeRange:c,renderRange:l,slotMinTime:s.slotMinTime,slotMaxTime:s.slotMaxTime,isValid:d,dateIncrement:this.buildDateIncrement(a.duration)}}buildValidRange(){let e=this.props.validRangeInput,t=typeof e=="function"?e.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):e;return this.refineRange(t)||{start:null,end:null}}buildCurrentRangeInfo(e,t){let{props:r}=this,s=null,i=null,a=null,o;return r.duration?(s=r.duration,i=r.durationUnit,a=this.buildRangeFromDuration(e,t,s,i)):(o=this.props.dayCount)?(i="day",a=this.buildRangeFromDayCount(e,t,o)):(a=this.buildCustomVisibleRange(e))?i=r.dateEnv.greatestWholeUnit(a.start,a.end).unit:(s=this.getFallbackDuration(),i=au(s).unit,a=this.buildRangeFromDuration(e,t,s,i)),{duration:s,unit:i,range:a}}getFallbackDuration(){return De({day:1})}adjustActiveRange(e){let{dateEnv:t,usesMinMaxTime:r,slotMinTime:s,slotMaxTime:i}=this.props,{start:a,end:o}=e;return r&&(oc(s)<0&&(a=tt(a),a=t.add(a,s)),oc(i)>1&&(o=tt(o),o=kt(o,-1),o=t.add(o,i))),{start:a,end:o}}buildRangeFromDuration(e,t,r,s){let{dateEnv:i,dateAlignment:a}=this.props,o,l,c;if(!a){let{dateIncrement:u}=this.props;u&&Es(u)<Es(r)?a=au(u).unit:a=s}oc(r)<=1&&this.isHiddenDay(o)&&(o=this.skipHiddenDays(o,t),o=tt(o));function d(){o=i.startOf(e,a),l=i.add(o,r),c={start:o,end:l}}return d(),this.trimHiddenDays(c)||(e=this.skipHiddenDays(e,t),d()),c}buildRangeFromDayCount(e,t,r){let{dateEnv:s,dateAlignment:i}=this.props,a=0,o=e,l;i&&(o=s.startOf(o,i)),o=tt(o),o=this.skipHiddenDays(o,t),l=o;do l=kt(l,1),this.isHiddenDay(l)||(a+=1);while(a<r);return{start:o,end:l}}buildCustomVisibleRange(e){let{props:t}=this,r=t.visibleRangeInput,s=typeof r=="function"?r.call(t.calendarApi,t.dateEnv.toDate(e)):r,i=this.refineRange(s);return i&&(i.start==null||i.end==null)?null:i}buildRenderRange(e,t,r){return e}buildDateIncrement(e){let{dateIncrement:t}=this.props,r;return t||((r=this.props.dateAlignment)?De(1,r):e||De({days:1}))}refineRange(e){if(e){let t=HV(e,this.props.dateEnv);return t&&(t=ag(t)),t}return null}initHiddenDays(){let e=this.props.hiddenDays||[],t=[],r=0,s;for(this.props.weekends===!1&&e.push(0,6),s=0;s<7;s+=1)(t[s]=e.indexOf(s)!==-1)||(r+=1);if(!r)throw new Error("invalid hiddenDays");this.isHiddenDayHash=t}trimHiddenDays(e){let{start:t,end:r}=e;return t&&(t=this.skipHiddenDays(t)),r&&(r=this.skipHiddenDays(r,-1,!0)),t==null||r==null||t<r?{start:t,end:r}:null}isHiddenDay(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]}skipHiddenDays(e,t=1,r=!1){for(;this.isHiddenDayHash[(e.getUTCDay()+(r?t:0)+7)%7];)e=kt(e,t);return e}};function vc(n,e,t,r){return{instanceId:Li(),defId:n,range:e,forcedStartTzo:t==null?null:t,forcedEndTzo:r==null?null:r}}function jV(n,e,t,r){for(let s=0;s<r.length;s+=1){let i=r[s].parse(n,t);if(i){let{allDay:a}=n;return a==null&&(a=e,a==null&&(a=i.allDayGuess,a==null&&(a=!1))),{allDay:a,duration:i.duration,typeData:i.typeData,typeId:s}}}return null}function xo(n,e,t){let{dateEnv:r,pluginHooks:s,options:i}=t,{defs:a,instances:o}=n;o=Ai(o,l=>!a[l.defId].recurringDef);for(let l in a){let c=a[l];if(c.recurringDef){let{duration:d}=c.recurringDef;d||(d=c.allDay?i.defaultAllDayEventDuration:i.defaultTimedEventDuration);let u=WV(c,d,e,r,s.recurringTypes);for(let f of u){let h=vc(l,{start:f,end:r.add(f,d)});o[h.instanceId]=h}}}return{defs:a,instances:o}}function WV(n,e,t,r,s){let a=s[n.recurringDef.typeId].expand(n.recurringDef.typeData,{start:r.subtract(t.start,e),end:t.end},r);return n.allDay&&(a=a.map(tt)),a}var Wm={id:String,groupId:String,title:String,url:String,interactive:Boolean},JI={start:N,end:N,date:N,allDay:Boolean},VV=Object.assign(Object.assign(Object.assign({},Wm),JI),{extendedProps:N});function eR(n,e,t,r,s=eb(t),i,a){let{refined:o,extra:l}=Du(n,t,s),c=YV(e,t),d=jV(o,c,t.dateEnv,t.pluginHooks.recurringTypes);if(d){let f=cc(o,l,e?e.sourceId:"",d.allDay,!!d.duration,t,i);return f.recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:f,instance:null}}let u=$V(o,c,t,r);if(u){let f=cc(o,l,e?e.sourceId:"",u.allDay,u.hasEnd,t,i),h=vc(f.defId,u.range,u.forcedStartTzo,u.forcedEndTzo);return a&&f.publicId&&a[f.publicId]&&(h.instanceId=a[f.publicId]),{def:f,instance:h}}return null}function Du(n,e,t=eb(e)){return Su(n,t)}function eb(n){return Object.assign(Object.assign(Object.assign({},qm),VV),n.pluginHooks.eventRefiners)}function cc(n,e,t,r,s,i,a){let o={title:n.title||"",groupId:n.groupId||"",publicId:n.id||"",url:n.url||"",recurringDef:null,defId:(a&&n.id?a[n.id]:"")||Li(),sourceId:t,allDay:r,hasEnd:s,interactive:n.interactive,ui:Tc(n,i),extendedProps:Object.assign(Object.assign({},n.extendedProps||{}),e)};for(let l of i.pluginHooks.eventDefMemberAdders)Object.assign(o,l(n));return Object.freeze(o.ui.classNames),Object.freeze(o.extendedProps),o}function $V(n,e,t,r){let{allDay:s}=n,i,a=null,o=!1,l,c=null,d=n.start!=null?n.start:n.date;if(i=t.dateEnv.createMarkerMeta(d),i)a=i.marker;else if(!r)return null;return n.end!=null&&(l=t.dateEnv.createMarkerMeta(n.end)),s==null&&(e!=null?s=e:s=(!i||i.isTimeUnspecified)&&(!l||l.isTimeUnspecified)),s&&a&&(a=tt(a)),l&&(c=l.marker,s&&(c=tt(c)),a&&c<=a&&(c=null)),c?o=!0:r||(o=t.options.forceEventDuration||!1,c=t.dateEnv.add(a,s?t.options.defaultAllDayEventDuration:t.options.defaultTimedEventDuration)),{allDay:s,hasEnd:o,range:{start:a,end:c},forcedStartTzo:i?i.forcedTzo:null,forcedEndTzo:l?l.forcedTzo:null}}function YV(n,e){let t=null;return n&&(t=n.defaultAllDay),t==null&&(t=e.options.defaultAllDay),t}function du(n,e,t,r,s,i){let a=rr(),o=eb(t);for(let l of n){let c=eR(l,e,t,r,o,s,i);c&&Co(c,a)}return a}function Co(n,e=rr()){return e.defs[n.def.defId]=n.def,n.instance&&(e.instances[n.instance.instanceId]=n.instance),e}function xu(n,e){let t=n.instances[e];if(t){let r=n.defs[t.defId],s=lg(n,i=>zV(r,i));return s.defs[r.defId]=r,s.instances[t.instanceId]=t,s}return rr()}function zV(n,e){return!!(n.groupId&&n.groupId===e.groupId)}function rr(){return{defs:{},instances:{}}}function og(n,e){return{defs:Object.assign(Object.assign({},n.defs),e.defs),instances:Object.assign(Object.assign({},n.instances),e.instances)}}function lg(n,e){let t=Ai(n.defs,e),r=Ai(n.instances,s=>t[s.defId]);return{defs:t,instances:r}}function qV(n,e){let{defs:t,instances:r}=n,s={},i={};for(let a in t)e.defs[a]||(s[a]=t[a]);for(let a in r)!e.instances[a]&&s[r[a].defId]&&(i[a]=r[a]);return{defs:s,instances:i}}function GV(n,e){return Array.isArray(n)?du(n,null,e,!0):typeof n=="object"&&n?du([n],null,e,!0):n!=null?String(n):null}function _w(n){return Array.isArray(n)?n:typeof n=="string"?n.split(/\s+/):[]}var qm={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:N,overlap:N,allow:N,className:_w,classNames:_w,color:String,backgroundColor:String,borderColor:String,textColor:String},QV={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function Tc(n,e){let t=GV(n.constraint,e);return{display:n.display||null,startEditable:n.startEditable!=null?n.startEditable:n.editable,durationEditable:n.durationEditable!=null?n.durationEditable:n.editable,constraints:t!=null?[t]:[],overlap:n.overlap!=null?n.overlap:null,allows:n.allow!=null?[n.allow]:[],backgroundColor:n.backgroundColor||n.color||"",borderColor:n.borderColor||n.color||"",textColor:n.textColor||"",classNames:(n.className||[]).concat(n.classNames||[])}}function tb(n){return n.reduce(KV,QV)}function KV(n,e){return{display:e.display!=null?e.display:n.display,startEditable:e.startEditable!=null?e.startEditable:n.startEditable,durationEditable:e.durationEditable!=null?e.durationEditable:n.durationEditable,constraints:n.constraints.concat(e.constraints),overlap:typeof e.overlap=="boolean"?e.overlap:n.overlap,allows:n.allows.concat(e.allows),backgroundColor:e.backgroundColor||n.backgroundColor,borderColor:e.borderColor||n.borderColor,textColor:e.textColor||n.textColor,classNames:n.classNames.concat(e.classNames)}}var ZV={id:String,defaultAllDay:Boolean,url:String,format:String,events:N,eventDataTransform:N,success:N,failure:N};function rb(n,e,t=sb(e)){let r;if(typeof n=="string"?r={url:n}:typeof n=="function"||Array.isArray(n)?r={events:n}:typeof n=="object"&&n&&(r=n),r){let{refined:s,extra:i}=Su(r,t),a=XV(s,e);if(a)return{_raw:n,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:s.defaultAllDay,eventDataTransform:s.eventDataTransform,success:s.success,failure:s.failure,publicId:s.id||"",sourceId:Li(),sourceDefId:a.sourceDefId,meta:a.meta,ui:Tc(s,e),extendedProps:i}}return null}function sb(n){return Object.assign(Object.assign(Object.assign({},qm),ZV),n.pluginHooks.eventSourceRefiners)}function XV(n,e){let t=e.pluginHooks.eventSourceDefs;for(let r=t.length-1;r>=0;r-=1){let i=t[r].parseMeta(n);if(i)return{sourceDefId:r,meta:i}}return null}function tR(n,e,t,r,s){switch(e.type){case"RECEIVE_EVENTS":return JV(n,t[e.sourceId],e.fetchId,e.fetchRange,e.rawEvents,s);case"RESET_RAW_EVENTS":return e$(n,t[e.sourceId],e.rawEvents,r.activeRange,s);case"ADD_EVENTS":return t$(n,e.eventStore,r?r.activeRange:null,s);case"RESET_EVENTS":return e.eventStore;case"MERGE_EVENTS":return og(n,e.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return r?xo(n,r.activeRange,s):n;case"REMOVE_EVENTS":return qV(n,e.eventStore);case"REMOVE_EVENT_SOURCE":return sR(n,e.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return lg(n,i=>!i.sourceId);case"REMOVE_ALL_EVENTS":return rr();default:return n}}function JV(n,e,t,r,s,i){if(e&&t===e.latestFetchId){let a=du(rR(s,e,i),e,i);return r&&(a=xo(a,r,i)),og(sR(n,e.sourceId),a)}return n}function e$(n,e,t,r,s){let{defIdMap:i,instanceIdMap:a}=s$(n),o=du(rR(t,e,s),e,s,!1,i,a);return xo(o,r,s)}function rR(n,e,t){let r=t.options.eventDataTransform,s=e?e.eventDataTransform:null;return s&&(n=MI(n,s)),r&&(n=MI(n,r)),n}function MI(n,e){let t;if(!e)t=n;else{t=[];for(let r of n){let s=e(r);s?t.push(s):s==null&&t.push(r)}}return t}function t$(n,e,t,r){return t&&(e=xo(e,t,r)),og(n,e)}function nb(n,e,t){let{defs:r}=n,s=Js(n.instances,i=>r[i.defId].allDay?i:Object.assign(Object.assign({},i),{range:{start:t.createMarker(e.toDate(i.range.start,i.forcedStartTzo)),end:t.createMarker(e.toDate(i.range.end,i.forcedEndTzo))},forcedStartTzo:t.canComputeOffset?null:i.forcedStartTzo,forcedEndTzo:t.canComputeOffset?null:i.forcedEndTzo}));return{defs:r,instances:s}}function sR(n,e){return lg(n,t=>t.sourceId!==e)}function r$(n,e){return{defs:n.defs,instances:Ai(n.instances,t=>!e[t.instanceId])}}function s$(n){let{defs:e,instances:t}=n,r={},s={};for(let i in e){let a=e[i],{publicId:o}=a;o&&(r[o]=i)}for(let i in t){let a=t[i],o=e[a.defId],{publicId:l}=o;l&&(s[l]=i)}return{defIdMap:r,instanceIdMap:s}}var Ri=class{constructor(){this.handlers={},this.thisContext=null}setThisContext(e){this.thisContext=e}setOptions(e){this.options=e}on(e,t){n$(this.handlers,e,t)}off(e,t){i$(this.handlers,e,t)}trigger(e,...t){let r=this.handlers[e]||[],s=this.options&&this.options[e],i=[].concat(s||[],r);for(let a of i)a.apply(this.thisContext,t)}hasHandlers(e){return!!(this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e])}};function n$(n,e,t){(n[e]||(n[e]=[])).push(t)}function i$(n,e,t){t?n[e]&&(n[e]=n[e].filter(r=>r!==t)):delete n[e]}var a$={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function ib(n,e){return du(o$(n),null,e)}function o$(n){let e;return n===!0?e=[{}]:Array.isArray(n)?e=n.filter(t=>t.daysOfWeek):typeof n=="object"&&n?e=[n]:e=[],e=e.map(t=>Object.assign(Object.assign({},a$),t)),e}function cg(n,e,t){t.emitter.trigger("select",Object.assign(Object.assign({},ab(n,t)),{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view}))}function l$(n,e){e.emitter.trigger("unselect",{jsEvent:n?n.origEvent:null,view:e.viewApi||e.calendarApi.view})}function ab(n,e){let t={};for(let r of e.pluginHooks.dateSpanTransforms)Object.assign(t,r(n,e));return Object.assign(t,w$(n,e.dateEnv)),t}function uu(n,e,t){let{dateEnv:r,options:s}=t,i=e;return n?(i=tt(i),i=r.add(i,s.defaultAllDayEventDuration)):i=r.add(i,s.defaultTimedEventDuration),i}function Cu(n,e,t,r){let s=Gm(n.defs,e),i=rr();for(let a in n.defs){let o=n.defs[a];i.defs[a]=c$(o,s[a],t,r)}for(let a in n.instances){let o=n.instances[a],l=i.defs[o.defId];i.instances[a]=d$(o,l,s[o.defId],t,r)}return i}function c$(n,e,t,r){let s=t.standardProps||{};s.hasEnd==null&&e.durationEditable&&(t.startDelta||t.endDelta)&&(s.hasEnd=!0);let i=Object.assign(Object.assign(Object.assign({},n),s),{ui:Object.assign(Object.assign({},n.ui),s.ui)});t.extendedProps&&(i.extendedProps=Object.assign(Object.assign({},i.extendedProps),t.extendedProps));for(let a of r.pluginHooks.eventDefMutationAppliers)a(i,t,r);return!i.hasEnd&&r.options.forceEventDuration&&(i.hasEnd=!0),i}function d$(n,e,t,r,s){let{dateEnv:i}=s,a=r.standardProps&&r.standardProps.allDay===!0,o=r.standardProps&&r.standardProps.hasEnd===!1,l=Object.assign({},n);return a&&(l.range=XI(l.range)),r.datesDelta&&t.startEditable&&(l.range={start:i.add(l.range.start,r.datesDelta),end:i.add(l.range.end,r.datesDelta)}),r.startDelta&&t.durationEditable&&(l.range={start:i.add(l.range.start,r.startDelta),end:l.range.end}),r.endDelta&&t.durationEditable&&(l.range={start:l.range.start,end:i.add(l.range.end,r.endDelta)}),o&&(l.range={start:l.range.start,end:uu(e.allDay,l.range.start,s)}),e.allDay&&(l.range={start:tt(l.range.start),end:tt(l.range.end)}),l.range.end<l.range.start&&(l.range.end=uu(e.allDay,l.range.start,s)),l}var ya=class{constructor(e,t){this.context=e,this.internalEventSource=t}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}},ct=class n{constructor(e,t,r){this._context=e,this._def=t,this._instance=r||null}setProp(e,t){if(e in JI)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(e==="id")t=Wm[e](t),this.mutate({standardProps:{publicId:t}});else if(e in Wm)t=Wm[e](t),this.mutate({standardProps:{[e]:t}});else if(e in qm){let r=qm[e](t);e==="color"?r={backgroundColor:t,borderColor:t}:e==="editable"?r={startEditable:t,durationEditable:t}:r={[e]:t},this.mutate({standardProps:{ui:r}})}else console.warn(`Could not set prop '${e}'. Use setExtendedProp instead.`)}setExtendedProp(e,t){this.mutate({extendedProps:{[e]:t}})}setStart(e,t={}){let{dateEnv:r}=this._context,s=r.createMarker(e);if(s&&this._instance){let i=this._instance.range,a=wa(i.start,s,r,t.granularity);t.maintainDuration?this.mutate({datesDelta:a}):this.mutate({startDelta:a})}}setEnd(e,t={}){let{dateEnv:r}=this._context,s;if(!(e!=null&&(s=r.createMarker(e),!s))&&this._instance)if(s){let i=wa(this._instance.range.end,s,r,t.granularity);this.mutate({endDelta:i})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(e,t,r={}){let{dateEnv:s}=this._context,i={allDay:r.allDay},a=s.createMarker(e),o;if(a&&!(t!=null&&(o=s.createMarker(t),!o))&&this._instance){let l=this._instance.range;r.allDay===!0&&(l=XI(l));let c=wa(l.start,a,s,r.granularity);if(o){let d=wa(l.end,o,s,r.granularity);rV(c,d)?this.mutate({datesDelta:c,standardProps:i}):this.mutate({startDelta:c,endDelta:d,standardProps:i})}else i.hasEnd=!1,this.mutate({datesDelta:c,standardProps:i})}}moveStart(e){let t=De(e);t&&this.mutate({startDelta:t})}moveEnd(e){let t=De(e);t&&this.mutate({endDelta:t})}moveDates(e){let t=De(e);t&&this.mutate({datesDelta:t})}setAllDay(e,t={}){let r={allDay:e},{maintainDuration:s}=t;s==null&&(s=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(r.hasEnd=s),this.mutate({standardProps:r})}formatRange(e){let{dateEnv:t}=this._context,r=this._instance,s=Ye(e);return this._def.hasEnd?t.formatRange(r.range.start,r.range.end,s,{forcedStartTzo:r.forcedStartTzo,forcedEndTzo:r.forcedEndTzo}):t.format(r.range.start,s,{forcedTzo:r.forcedStartTzo})}mutate(e){let t=this._instance;if(t){let r=this._def,s=this._context,{eventStore:i}=s.getCurrentData(),a=xu(i,t.instanceId);a=Cu(a,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},e,s);let l=new n(s,r,t);this._def=a.defs[r.defId],this._instance=a.instances[t.instanceId],s.dispatch({type:"MERGE_EVENTS",eventStore:a}),s.emitter.trigger("eventChange",{oldEvent:l,event:this,relatedEvents:Jn(a,s,t),revert(){s.dispatch({type:"RESET_EVENTS",eventStore:i})}})}}remove(){let e=this._context,t=nR(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})}get source(){let{sourceId:e}=this._def;return e?new ya(this._context,this._context.getCurrentData().eventSources[e]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""}get endStr(){let e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(e={}){let t=this._def,{ui:r}=t,{startStr:s,endStr:i}=this,a={allDay:t.allDay};return t.title&&(a.title=t.title),s&&(a.start=s),i&&(a.end=i),t.publicId&&(a.id=t.publicId),t.groupId&&(a.groupId=t.groupId),t.url&&(a.url=t.url),r.display&&r.display!=="auto"&&(a.display=r.display),e.collapseColor&&r.backgroundColor&&r.backgroundColor===r.borderColor?a.color=r.backgroundColor:(r.backgroundColor&&(a.backgroundColor=r.backgroundColor),r.borderColor&&(a.borderColor=r.borderColor)),r.textColor&&(a.textColor=r.textColor),r.classNames.length&&(a.classNames=r.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?Object.assign(a,t.extendedProps):a.extendedProps=t.extendedProps),a}toJSON(){return this.toPlainObject()}};function nR(n){let e=n._def,t=n._instance;return{defs:{[e.defId]:e},instances:t?{[t.instanceId]:t}:{}}}function Jn(n,e,t){let{defs:r,instances:s}=n,i=[],a=t?t.instanceId:"";for(let o in s){let l=s[o],c=r[l.defId];l.instanceId!==a&&i.push(new ct(e,c,l))}return i}function dc(n,e,t,r){let s={},i={},a={},o=[],l=[],c=Gm(n.defs,e);for(let d in n.defs){let u=n.defs[d];c[u.defId].display==="inverse-background"&&(u.groupId?(s[u.groupId]=[],a[u.groupId]||(a[u.groupId]=u)):i[d]=[])}for(let d in n.instances){let u=n.instances[d],f=n.defs[u.defId],h=c[f.defId],p=u.range,m=!f.allDay&&r?ag(p,r):p,g=Wr(m,t);g&&(h.display==="inverse-background"?f.groupId?s[f.groupId].push(g):i[u.defId].push(g):h.display!=="none"&&(h.display==="background"?o:l).push({def:f,ui:h,instance:u,range:g,isStart:m.start&&m.start.valueOf()===g.start.valueOf(),isEnd:m.end&&m.end.valueOf()===g.end.valueOf()}))}for(let d in s){let u=s[d],f=CI(u,t);for(let h of f){let p=a[d],m=c[p.defId];o.push({def:p,ui:m,instance:null,range:h,isStart:!1,isEnd:!1})}}for(let d in i){let u=i[d],f=CI(u,t);for(let h of f)o.push({def:n.defs[d],ui:c[d],instance:null,range:h,isStart:!1,isEnd:!1})}return{bg:o,fg:l}}function ob(n){return n.ui.display==="background"||n.ui.display==="inverse-background"}function PI(n,e){n.fcSeg=e}function Fi(n){return n.fcSeg||n.parentNode.fcSeg||null}function Gm(n,e){return Js(n,t=>iR(t,e))}function iR(n,e){let t=[];return e[""]&&t.push(e[""]),e[n.defId]&&t.push(e[n.defId]),t.push(n.ui),tb(t)}function Lo(n,e){let t=n.map(u$);return t.sort((r,s)=>UI(r,s,e)),t.map(r=>r._seg)}function u$(n){let{eventRange:e}=n,t=e.def,r=e.instance?e.instance.range:e.range,s=r.start?r.start.valueOf():0,i=r.end?r.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},t.extendedProps),t),{id:t.publicId,start:s,end:i,duration:i-s,allDay:Number(t.allDay),_seg:n})}function h$(n,e){let{pluginHooks:t}=e,r=t.isDraggableTransformers,{def:s,ui:i}=n.eventRange,a=i.startEditable;for(let o of r)a=o(a,s,i,e);return a}function f$(n,e){return n.isStart&&n.eventRange.ui.durationEditable&&e.options.eventResizableFromStart}function p$(n,e){return n.isEnd&&n.eventRange.ui.durationEditable}function xa(n,e,t,r,s,i,a){let{dateEnv:o,options:l}=t,{displayEventTime:c,displayEventEnd:d}=l,u=n.eventRange.def,f=n.eventRange.instance;c==null&&(c=r!==!1),d==null&&(d=s!==!1);let h=f.range.start,p=f.range.end,m=i||n.start||n.eventRange.range.start,g=a||n.end||n.eventRange.range.end,y=tt(h).valueOf()===tt(m).valueOf(),T=tt(zn(p,-1)).valueOf()===tt(zn(g,-1)).valueOf();return c&&!u.allDay&&(y||T)?(m=y?h:m,g=T?p:g,d&&u.hasEnd?o.formatRange(m,g,e,{forcedStartTzo:i?null:f.forcedStartTzo,forcedEndTzo:a?null:f.forcedEndTzo}):o.format(m,e,{forcedTzo:i?null:f.forcedStartTzo})):""}function xs(n,e,t){let r=n.eventRange.range;return{isPast:r.end<=(t||e.start),isFuture:r.start>=(t||e.end),isToday:e&&Xs(e,r.start)}}function m$(n){let e=["fc-event"];return n.isMirror&&e.push("fc-event-mirror"),n.isDraggable&&e.push("fc-event-draggable"),(n.isStartResizable||n.isEndResizable)&&e.push("fc-event-resizable"),n.isDragging&&e.push("fc-event-dragging"),n.isResizing&&e.push("fc-event-resizing"),n.isSelected&&e.push("fc-event-selected"),n.isStart&&e.push("fc-event-start"),n.isEnd&&e.push("fc-event-end"),n.isPast&&e.push("fc-event-past"),n.isToday&&e.push("fc-event-today"),n.isFuture&&e.push("fc-event-future"),e}function Mu(n){return n.instance?n.instance.instanceId:`${n.def.defId}:${n.range.start.toISOString()}`}function wc(n,e){let{def:t,instance:r}=n.eventRange,{url:s}=t;if(s)return{href:s};let{emitter:i,options:a}=e,{eventInteractive:o}=a;return o==null&&(o=t.interactive,o==null&&(o=!!i.hasHandlers("eventClick"))),o?HI(l=>{i.trigger("eventClick",{el:l.target,event:new ct(e,t,r),jsEvent:l,view:e.viewApi})}):{}}var g$={start:N,end:N,allDay:Boolean};function y$(n,e,t){let r=v$(n,e),{range:s}=r;if(!s.start)return null;if(!s.end){if(t==null)return null;s.end=e.add(s.start,t)}return r}function v$(n,e){let{refined:t,extra:r}=Su(n,g$),s=t.start?e.createMarkerMeta(t.start):null,i=t.end?e.createMarkerMeta(t.end):null,{allDay:a}=t;return a==null&&(a=s&&s.isTimeUnspecified&&(!i||i.isTimeUnspecified)),Object.assign({range:{start:s?s.marker:null,end:i?i.marker:null},allDay:a},r)}function lb(n,e){return ZI(n.range,e.range)&&n.allDay===e.allDay&&T$(n,e)}function T$(n,e){for(let t in e)if(t!=="range"&&t!=="allDay"&&n[t]!==e[t])return!1;for(let t in n)if(!(t in e))return!1;return!0}function w$(n,e){return Object.assign(Object.assign({},aR(n.range,e,n.allDay)),{allDay:n.allDay})}function cb(n,e,t){return Object.assign(Object.assign({},aR(n,e,t)),{timeZone:e.timeZone})}function aR(n,e,t){return{start:e.toDate(n.start),end:e.toDate(n.end),startStr:e.formatIso(n.start,{omitTime:t}),endStr:e.formatIso(n.end,{omitTime:t})}}function b$(n,e,t){let r=Du({editable:!1},t),s=cc(r.refined,r.extra,"",n.allDay,!0,t);return{def:s,ui:iR(s,e),instance:vc(s.defId,n.range),range:n.range,isStart:!0,isEnd:!0}}function db(n,e,t){let r=!1,s=function(o){r||(r=!0,e(o))},i=function(o){r||(r=!0,t(o))},a=n(s,i);a&&typeof a.then=="function"&&a.then(s,i)}var Qm=class extends Error{constructor(e,t){super(e),this.response=t}};function ub(n,e,t){n=n.toUpperCase();let r={method:n};return n==="GET"?e+=(e.indexOf("?")===-1?"?":"&")+new URLSearchParams(t):(r.body=new URLSearchParams(t),r.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(e,r).then(s=>{if(s.ok)return s.json().then(i=>[i,s],()=>{throw new Qm("Failure parsing JSON",s)});throw new Qm("Request failed",s)})}var gw;function hb(){return gw==null&&(gw=k$()),gw}function k$(){if(typeof document=="undefined")return!0;let n=document.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.innerHTML="<table><tr><td><div></div></td></tr></table>",n.querySelector("table").style.height="100px",n.querySelector("div").style.height="100%",document.body.appendChild(n);let t=n.querySelector("div").offsetHeight>0;return document.body.removeChild(n),t}var hu=class extends Ie{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{lu(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{lu(()=>{this.setState({forPrint:!1})})}}render(){let{props:e}=this,{options:t}=e,{forPrint:r}=this.state,s=r||t.height==="auto"||t.contentHeight==="auto",i=!s&&t.height!=null?t.height:"",a=["fc",r?"fc-media-print":"fc-media-screen",`fc-direction-${t.direction}`,e.theme.getClass("root")];return hb()||a.push("fc-liquid-hack"),e.children(a,i,s,r)}componentDidMount(){let{emitter:e}=this.props;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:e}=this.props;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)}},Sn=class{constructor(e){this.component=e.component,this.isHitComboAllowed=e.isHitComboAllowed||null}destroy(){}};function oR(n,e){return{component:n,el:e.el,useEventCenter:e.useEventCenter!=null?e.useEventCenter:!0,isHitComboAllowed:e.isHitComboAllowed||null}}function Pu(n){return{[n.component.uid]:n}}var Fo={},ss=class extends Tr{constructor(e,t){super(e,t),this.handleRefresh=()=>{let r=this.computeTiming();r.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(r.state),this.clearTimeout(),this.setTimeout(r.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:t}=this;return e.children(t.nowDate,t.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:e,context:t}=this,r=t.nowManager.getDateMarker(),{nowIndicatorSnap:s}=t.options;s==="auto"&&(s=/year|month|week|day/.test(e.unit)||(e.unitValue||1)===1);let i,a;return s?(i=t.dateEnv.startOf(r,e.unit),a=t.dateEnv.add(i,De(1,e.unit)).valueOf()-r.valueOf()):(i=r,a=1e3*60),a=Math.min(1e3*60*60*24,a),{state:{nowDate:i,todayRange:E$(i)},waitMs:a}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{let t=this.computeTiming();this.setState(t.state,()=>{this.setTimeout(t.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};ss.contextType=en;function E$(n){let e=tt(n),t=kt(e,1);return{start:e,end:t}}var fu=class{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(e){this.currentDataManager.dispatch(e)}get view(){return this.getCurrentData().viewApi}batchRendering(e){e()}updateSize(){this.trigger("_resize",!0)}setOption(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})}getOption(e){return this.currentDataManager.currentCalendarOptionsInput[e]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(e,t){let{currentDataManager:r}=this;r.currentCalendarOptionsRefiners[e]?r.emitter.on(e,t):console.warn(`Unknown listener name '${e}'`)}off(e,t){this.currentDataManager.emitter.off(e,t)}trigger(e,...t){this.currentDataManager.emitter.trigger(e,...t)}changeView(e,t){this.batchRendering(()=>{if(this.unselect(),t)if(t.start&&t.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{let{dateEnv:r}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:r.createMarker(t)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})})}zoomTo(e,t){let r=this.getCurrentData(),s;t=t||"day",s=r.viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),s?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:s.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})}getUnitViewSpec(e){let{viewSpecs:t,toolbarConfig:r}=this.getCurrentData(),s=[].concat(r.header?r.header.viewsWithButtons:[],r.footer?r.footer.viewsWithButtons:[]),i,a;for(let o in t)s.push(o);for(i=0;i<s.length;i+=1)if(a=t[s[i]],a&&a.singleUnit===e)return a;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})}nextYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})}today(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.nowManager.getDateMarker()})}gotoDate(e){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})}incrementDate(e){let t=this.getCurrentData(),r=De(e);r&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,r)}))}getDate(){let e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)}formatDate(e,t){let{dateEnv:r}=this.getCurrentData();return r.format(r.createMarker(e),Ye(t))}formatRange(e,t,r){let{dateEnv:s}=this.getCurrentData();return s.formatRange(s.createMarker(e),s.createMarker(t),Ye(r),r)}formatIso(e,t){let{dateEnv:r}=this.getCurrentData();return r.formatIso(r.createMarker(e),{omitTime:t})}select(e,t){let r;t==null?e.start!=null?r=e:r={start:e,end:null}:r={start:e,end:t};let s=this.getCurrentData(),i=y$(r,s.dateEnv,De({days:1}));i&&(this.dispatch({type:"SELECT_DATES",selection:i}),cg(i,null,s))}unselect(e){let t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),l$(e,t))}addEvent(e,t){if(e instanceof ct){let a=e._def,o=e._instance;return this.getCurrentData().eventStore.defs[a.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:Co({def:a,instance:o})}),this.triggerEventAdd(e)),e}let r=this.getCurrentData(),s;if(t instanceof ya)s=t.internalEventSource;else if(typeof t=="boolean")t&&([s]=ng(r.eventSources));else if(t!=null){let a=this.getEventSourceById(t);if(!a)return console.warn(`Could not find an event source with ID "${t}"`),null;s=a.internalEventSource}let i=eR(e,s,r,!1);if(i){let a=new ct(r,i.def,i.def.recurringDef?null:i.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:Co(i)}),this.triggerEventAdd(a),a}return null}triggerEventAdd(e){let{emitter:t}=this.getCurrentData();t.trigger("eventAdd",{event:e,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:nR(e)})}})}getEventById(e){let t=this.getCurrentData(),{defs:r,instances:s}=t.eventStore;e=String(e);for(let i in r){let a=r[i];if(a.publicId===e){if(a.recurringDef)return new ct(t,a,null);for(let o in s){let l=s[o];if(l.defId===a.defId)return new ct(t,a,l)}}}return null}getEvents(){let e=this.getCurrentData();return Jn(e.eventStore,e)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let e=this.getCurrentData(),t=e.eventSources,r=[];for(let s in t)r.push(new ya(e,t[s]));return r}getEventSourceById(e){let t=this.getCurrentData(),r=t.eventSources;e=String(e);for(let s in r)if(r[s].publicId===e)return new ya(t,r[s]);return null}addEventSource(e){let t=this.getCurrentData();if(e instanceof ya)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;let r=rb(e,t);return r?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[r]}),new ya(t,r)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(e){let t=De(e);t&&this.trigger("_scrollRequest",{time:t})}};function fb(n,e){return n.left>=e.left&&n.left<e.right&&n.top>=e.top&&n.top<e.bottom}function dg(n,e){let t={left:Math.max(n.left,e.left),right:Math.min(n.right,e.right),top:Math.max(n.top,e.top),bottom:Math.min(n.bottom,e.bottom)};return t.left<t.right&&t.top<t.bottom?t:!1}function pb(n,e){return{left:Math.min(Math.max(n.left,e.left),e.right),top:Math.min(Math.max(n.top,e.top),e.bottom)}}function mb(n){return{left:(n.left+n.right)/2,top:(n.top+n.bottom)/2}}function gb(n,e){return{left:n.left-e.left,top:n.top-e.top}}var yw=rr(),pu=class{constructor(){this.getKeysForEventDefs=le(this._getKeysForEventDefs),this.splitDateSelection=le(this._splitDateSpan),this.splitEventStore=le(this._splitEventStore),this.splitIndividualUi=le(this._splitIndividualUi),this.splitEventDrag=le(this._splitInteraction),this.splitEventResize=le(this._splitInteraction),this.eventUiBuilders={}}splitProps(e){let t=this.getKeyInfo(e),r=this.getKeysForEventDefs(e.eventStore),s=this.splitDateSelection(e.dateSelection),i=this.splitIndividualUi(e.eventUiBases,r),a=this.splitEventStore(e.eventStore,r),o=this.splitEventDrag(e.eventDrag),l=this.splitEventResize(e.eventResize),c={};this.eventUiBuilders=Js(t,(d,u)=>this.eventUiBuilders[u]||le(S$));for(let d in t){let u=t[d],f=a[d]||yw,h=this.eventUiBuilders[d];c[d]={businessHours:u.businessHours||e.businessHours,dateSelection:s[d]||null,eventStore:f,eventUiBases:h(e.eventUiBases[""],u.ui,i[d]),eventSelection:f.instances[e.eventSelection]?e.eventSelection:"",eventDrag:o[d]||null,eventResize:l[d]||null}}return c}_splitDateSpan(e){let t={};if(e){let r=this.getKeysForDateSpan(e);for(let s of r)t[s]=e}return t}_getKeysForEventDefs(e){return Js(e.defs,t=>this.getKeysForEventDef(t))}_splitEventStore(e,t){let{defs:r,instances:s}=e,i={};for(let a in r)for(let o of t[a])i[o]||(i[o]=rr()),i[o].defs[a]=r[a];for(let a in s){let o=s[a];for(let l of t[o.defId])i[l]&&(i[l].instances[a]=o)}return i}_splitIndividualUi(e,t){let r={};for(let s in e)if(s)for(let i of t[s])r[i]||(r[i]={}),r[i][s]=e[s];return r}_splitInteraction(e){let t={};if(e){let r=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),s=this._getKeysForEventDefs(e.mutatedEvents),i=this._splitEventStore(e.mutatedEvents,s),a=o=>{t[o]||(t[o]={affectedEvents:r[o]||yw,mutatedEvents:i[o]||yw,isEvent:e.isEvent})};for(let o in r)a(o);for(let o in i)a(o)}return t}};function S$(n,e,t){let r=[];n&&r.push(n),e&&r.push(e);let s={"":tb(r)};return t&&Object.assign(s,t),s}function _u(n,e,t,r){return{dow:n.getUTCDay(),isDisabled:!!(r&&(!r.activeRange||!Xs(r.activeRange,n))),isOther:!!(r&&!Xs(r.currentRange,n)),isToday:!!(e&&Xs(e,n)),isPast:!!(t?n<t:e&&n<e.start),isFuture:!!(t?n>t:e&&n>=e.end)}}function bc(n,e){let t=["fc-day",`fc-day-${iV[n.dow]}`];return n.isDisabled?t.push("fc-day-disabled"):(n.isToday&&(t.push("fc-day-today"),t.push(e.getClass("today"))),n.isPast&&t.push("fc-day-past"),n.isFuture&&t.push("fc-day-future"),n.isOther&&t.push("fc-day-other")),t}var D$=Ye({year:"numeric",month:"long",day:"numeric"}),x$=Ye({week:"long"});function ei(n,e,t="day",r=!0){let{dateEnv:s,options:i,calendarApi:a}=n,o=s.format(e,t==="week"?x$:D$);if(i.navLinks){let l=s.toDate(e),c=d=>{let u=t==="day"?i.navLinkDayClick:t==="week"?i.navLinkWeekClick:null;typeof u=="function"?u.call(a,s.toDate(e),d):(typeof u=="string"&&(t=u),a.zoomTo(e,t))};return Object.assign({title:pc(i.navLinkHint,[o,l],o),"data-navlink":""},r?FI(c):{onClick:c})}return{"aria-label":o}}var vw=null;function lR(){return vw===null&&(vw=C$()),vw}function C$(){let n=document.createElement("div");Oo(n,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),n.innerHTML="<div></div>",document.body.appendChild(n);let t=n.firstChild.getBoundingClientRect().left>n.getBoundingClientRect().left;return wu(n),t}var Tw;function cR(){return Tw||(Tw=M$()),Tw}function M$(){let n=document.createElement("div");n.style.overflow="scroll",n.style.position="absolute",n.style.top="-9999px",n.style.left="-9999px",document.body.appendChild(n);let e=dR(n);return document.body.removeChild(n),e}function dR(n){return{x:n.offsetHeight-n.clientHeight,y:n.offsetWidth-n.clientWidth}}function uR(n,e=!1){let t=window.getComputedStyle(n),r=parseInt(t.borderLeftWidth,10)||0,s=parseInt(t.borderRightWidth,10)||0,i=parseInt(t.borderTopWidth,10)||0,a=parseInt(t.borderBottomWidth,10)||0,o=dR(n),l=o.y-r-s,c=o.x-i-a,d={borderLeft:r,borderRight:s,borderTop:i,borderBottom:a,scrollbarBottom:c,scrollbarLeft:0,scrollbarRight:0};return lR()&&t.direction==="rtl"?d.scrollbarLeft=l:d.scrollbarRight=l,e&&(d.paddingLeft=parseInt(t.paddingLeft,10)||0,d.paddingRight=parseInt(t.paddingRight,10)||0,d.paddingTop=parseInt(t.paddingTop,10)||0,d.paddingBottom=parseInt(t.paddingBottom,10)||0),d}function yb(n,e=!1,t){let r=t?n.getBoundingClientRect():Au(n),s=uR(n,e),i={left:r.left+s.borderLeft+s.scrollbarLeft,right:r.right-s.borderRight-s.scrollbarRight,top:r.top+s.borderTop,bottom:r.bottom-s.borderBottom-s.scrollbarBottom};return e&&(i.left+=s.paddingLeft,i.right-=s.paddingRight,i.top+=s.paddingTop,i.bottom-=s.paddingBottom),i}function Au(n){let e=n.getBoundingClientRect();return{left:e.left+window.scrollX,top:e.top+window.scrollY,right:e.right+window.scrollX,bottom:e.bottom+window.scrollY}}function P$(n){let e=ug(n),t=n.getBoundingClientRect();for(let r of e){let s=dg(t,r.getBoundingClientRect());if(s)t=s;else return null}return t}function ug(n){let e=[];for(;n instanceof HTMLElement;){let t=window.getComputedStyle(n);if(t.position==="fixed")break;/(auto|scroll)/.test(t.overflow+t.overflowY+t.overflowX)&&e.push(n),n=n.parentNode}return e}var Dn=class{constructor(e,t,r,s){this.els=t;let i=this.originClientRect=e.getBoundingClientRect();r&&this.buildElHorizontals(i.left),s&&this.buildElVerticals(i.top)}buildElHorizontals(e){let t=[],r=[];for(let s of this.els){let i=s.getBoundingClientRect();t.push(i.left-e),r.push(i.right-e)}this.lefts=t,this.rights=r}buildElVerticals(e){let t=[],r=[];for(let s of this.els){let i=s.getBoundingClientRect();t.push(i.top-e),r.push(i.bottom-e)}this.tops=t,this.bottoms=r}leftToIndex(e){let{lefts:t,rights:r}=this,s=t.length,i;for(i=0;i<s;i+=1)if(e>=t[i]&&e<r[i])return i}topToIndex(e){let{tops:t,bottoms:r}=this,s=t.length,i;for(i=0;i<s;i+=1)if(e>=t[i]&&e<r[i])return i}getWidth(e){return this.rights[e]-this.lefts[e]}getHeight(e){return this.bottoms[e]-this.tops[e]}similarTo(e){return Hm(this.tops||[],e.tops||[])&&Hm(this.bottoms||[],e.bottoms||[])&&Hm(this.lefts||[],e.lefts||[])&&Hm(this.rights||[],e.rights||[])}};function Hm(n,e){let t=n.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(Math.round(n[r])!==Math.round(e[r]))return!1;return!0}var Mo=class{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}},mu=class extends Mo{constructor(e){super(),this.el=e}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(e){this.el.scrollTop=e}setScrollLeft(e){this.el.scrollLeft=e}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}},gu=class extends Mo{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(e){window.scroll(window.scrollX,e)}setScrollLeft(e){window.scroll(e,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}},Qt=class extends Ie{constructor(){super(...arguments),this.uid=Li()}prepareHits(){}queryHit(e,t,r,s){return null}isValidSegDownEl(e){return!this.props.eventDrag&&!this.props.eventResize&&!tr(e,".fc-event-mirror")}isValidDateDownEl(e){return!tr(e,".fc-event:not(.fc-bg-event)")&&!tr(e,".fc-more-link")&&!tr(e,"a[data-navlink]")&&!tr(e,".fc-popover")}};var Po=class{constructor(e=t=>t.thickness||1){this.getEntryThickness=e,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(e){let t=[];for(let r of e)this.insertEntry(r,t);return t}insertEntry(e,t){let r=this.findInsertion(e);this.isInsertionValid(r,e)?this.insertEntryAt(e,r):this.handleInvalidInsertion(r,e,t)}isInsertionValid(e,t){return(this.maxCoord===-1||e.levelCoord+this.getEntryThickness(t)<=this.maxCoord)&&(this.maxStackCnt===-1||e.stackCnt<this.maxStackCnt)}handleInvalidInsertion(e,t,r){if(this.allowReslicing&&e.touchingEntry){let s=Object.assign(Object.assign({},t),{span:Iu(t.span,e.touchingEntry.span)});r.push(s),this.splitEntry(t,e.touchingEntry,r)}else r.push(t)}splitEntry(e,t,r){let s=e.span,i=t.span;s.start<i.start&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:s.start,end:i.start}},r),s.end>i.end&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:i.end,end:s.end}},r)}insertEntryAt(e,t){let{entriesByLevel:r,levelCoords:s}=this;t.lateral===-1?(ww(s,t.level,t.levelCoord),ww(r,t.level,[e])):ww(r[t.level],t.lateral,e),this.stackCnts[Gn(e)]=t.stackCnt}findInsertion(e){let{levelCoords:t,entriesByLevel:r,strictOrder:s,stackCnts:i}=this,a=t.length,o=0,l=-1,c=-1,d=null,u=0;for(let p=0;p<a;p+=1){let m=t[p];if(!s&&m>=o+this.getEntryThickness(e))break;let g=r[p],y,T=vu(g,e.span.start,yu),w=T[0]+T[1];for(;(y=g[w])&&y.span.start<e.span.end;){let b=m+this.getEntryThickness(y);b>o&&(o=b,d=y,l=p,c=w),b===o&&(u=Math.max(u,i[Gn(y)]+1)),w+=1}}let f=0;if(d)for(f=l+1;f<a&&t[f]<o;)f+=1;let h=-1;return f<a&&t[f]===o&&(h=vu(r[f],e.span.end,yu)[0]),{touchingLevel:l,touchingLateral:c,touchingEntry:d,stackCnt:u,levelCoord:o,level:f,lateral:h}}toRects(){let{entriesByLevel:e,levelCoords:t}=this,r=e.length,s=[];for(let i=0;i<r;i+=1){let a=e[i],o=t[i];for(let l of a)s.push(Object.assign(Object.assign({},l),{thickness:this.getEntryThickness(l),levelCoord:o}))}return s}};function yu(n){return n.span.end}function Gn(n){return n.index+":"+n.span.start}function vb(n){let e=[];for(let t of n){let r=[],s={span:t.span,entries:[t]};for(let i of e)Iu(i.span,s.span)?s={entries:i.entries.concat(s.entries),span:_$(i.span,s.span)}:r.push(i);r.push(s),e=r}return e}function _$(n,e){return{start:Math.min(n.start,e.start),end:Math.max(n.end,e.end)}}function Iu(n,e){let t=Math.max(n.start,e.start),r=Math.min(n.end,e.end);return t<r?{start:t,end:r}:null}function ww(n,e,t){n.splice(e,0,t)}function vu(n,e,t){let r=0,s=n.length;if(!s||e<t(n[r]))return[0,0];if(e>t(n[s-1]))return[s,0];for(;r<s;){let i=Math.floor(r+(s-r)/2),a=t(n[i]);if(e<a)s=i;else if(e>a)r=i+1;else return[i,1]}return[r,0]}var Tu=class{constructor(e,t){this.emitter=new Ri}destroy(){}setMirrorIsVisible(e){}setMirrorNeedsRevert(e){}setAutoScrollEnabled(e){}},kc={},A$={startTime:De,duration:De,create:Boolean,sourceId:String};function Ru(n){let{refined:e,extra:t}=Su(n,A$);return{startTime:e.startTime||null,duration:e.duration||null,create:e.create!=null?e.create:!0,sourceId:e.sourceId,leftoverProps:t}}function hR(n,e){return!n||e>10?Ye({weekday:"short"}):e>1?Ye({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):Ye({weekday:"long"})}var fR="fc-col-header-cell";function pR(n){return n.text}var Km=class extends Ie{render(){let{dateEnv:e,options:t,theme:r,viewApi:s}=this.context,{props:i}=this,{date:a,dateProfile:o}=i,l=_u(a,i.todayRange,null,o),c=[fR].concat(bc(l,r)),d=e.format(a,i.dayHeaderFormat),u=!l.isDisabled&&i.colCnt>1?ei(this.context,a):{},f=e.toDate(a);e.namedTimeZoneImpl&&(f=zn(f,36e5));let h=Object.assign(Object.assign(Object.assign({date:f,view:s},i.extraRenderProps),{text:d}),l);return k(It,{elTag:"th",elClasses:c,elAttrs:Object.assign({role:"columnheader",colSpan:i.colSpan,"data-date":l.isDisabled?void 0:Sa(a)},i.extraDataAttrs),renderProps:h,generatorName:"dayHeaderContent",customGenerator:t.dayHeaderContent,defaultGenerator:pR,classNameGenerator:t.dayHeaderClassNames,didMount:t.dayHeaderDidMount,willUnmount:t.dayHeaderWillUnmount},p=>k("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&k(p,{elTag:"a",elAttrs:u,elClasses:["fc-col-header-cell-cushion",i.isSticky&&"fc-sticky"]})))}},I$=Ye({weekday:"long"}),Zm=class extends Ie{render(){let{props:e}=this,{dateEnv:t,theme:r,viewApi:s,options:i}=this.context,a=kt(new Date(2592e5),e.dow),o={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=t.format(a,e.dayHeaderFormat),c=Object.assign(Object.assign(Object.assign(Object.assign({date:a},o),{view:s}),e.extraRenderProps),{text:l});return k(It,{elTag:"th",elClasses:[fR,...bc(o,r),...e.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:e.colSpan},e.extraDataAttrs),renderProps:c,generatorName:"dayHeaderContent",customGenerator:i.dayHeaderContent,defaultGenerator:pR,classNameGenerator:i.dayHeaderClassNames,didMount:i.dayHeaderDidMount,willUnmount:i.dayHeaderWillUnmount},d=>k("div",{className:"fc-scrollgrid-sync-inner"},k(d,{elTag:"a",elClasses:["fc-col-header-cell-cushion",e.isSticky&&"fc-sticky"],elAttrs:{"aria-label":t.format(a,I$)}})))}},Ni=class extends Ie{constructor(){super(...arguments),this.createDayHeaderFormatter=le(R$)}render(){let{context:e}=this,{dates:t,dateProfile:r,datesRepDistinctDays:s,renderIntro:i}=this.props,a=this.createDayHeaderFormatter(e.options.dayHeaderFormat,s,t.length);return k(ss,{unit:"day"},(o,l)=>k("tr",{role:"row"},i&&i("day"),t.map(c=>s?k(Km,{key:c.toISOString(),date:c,dateProfile:r,todayRange:l,colCnt:t.length,dayHeaderFormat:a}):k(Zm,{key:c.getUTCDay(),dow:c.getUTCDay(),dayHeaderFormat:a}))))}};function R$(n,e,t){return n||hR(e,t)}var _o=class{constructor(e,t){let r=e.start,{end:s}=e,i=[],a=[],o=-1;for(;r<s;)t.isHiddenDay(r)?i.push(o+.5):(o+=1,i.push(o),a.push(r)),r=kt(r,1);this.dates=a,this.indices=i,this.cnt=a.length}sliceRange(e){let t=this.getDateDayIndex(e.start),r=this.getDateDayIndex(kt(e.end,-1)),s=Math.max(0,t),i=Math.min(this.cnt-1,r);return s=Math.ceil(s),i=Math.floor(i),s<=i?{firstIndex:s,lastIndex:i,isStart:t===s,isEnd:r===i}:null}getDateDayIndex(e){let{indices:t}=this,r=Math.floor(Zn(this.dates[0],e));return r<0?t[0]-1:r>=t.length?t[t.length-1]+1:t[r]}},Ao=class{constructor(e,t){let{dates:r}=e,s,i,a;if(t){for(i=r[0].getUTCDay(),s=1;s<r.length&&r[s].getUTCDay()!==i;s+=1);a=Math.ceil(r.length/s)}else a=1,s=r.length;this.rowCnt=a,this.colCnt=s,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let e=[];for(let t=0;t<this.rowCnt;t+=1){let r=[];for(let s=0;s<this.colCnt;s+=1)r.push(this.buildCell(t,s));e.push(r)}return e}buildCell(e,t){let r=this.daySeries.dates[e*this.colCnt+t];return{key:r.toISOString(),date:r}}buildHeaderDates(){let e=[];for(let t=0;t<this.colCnt;t+=1)e.push(this.cells[0][t].date);return e}sliceRange(e){let{colCnt:t}=this,r=this.daySeries.sliceRange(e),s=[];if(r){let{firstIndex:i,lastIndex:a}=r,o=i;for(;o<=a;){let l=Math.floor(o/t),c=Math.min((l+1)*t,a+1);s.push({row:l,firstCol:o%t,lastCol:(c-1)%t,isStart:r.isStart&&o===i,isEnd:r.isEnd&&c-1===a}),o=c}}return s}},Io=class{constructor(){this.sliceBusinessHours=le(this._sliceBusinessHours),this.sliceDateSelection=le(this._sliceDateSpan),this.sliceEventStore=le(this._sliceEventStore),this.sliceEventDrag=le(this._sliceInteraction),this.sliceEventResize=le(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(e,t,r,s,...i){let{eventUiBases:a}=e,o=this.sliceEventStore(e.eventStore,a,t,r,...i);return{dateSelectionSegs:this.sliceDateSelection(e.dateSelection,t,r,a,s,...i),businessHourSegs:this.sliceBusinessHours(e.businessHours,t,r,s,...i),fgEventSegs:o.fg,bgEventSegs:o.bg,eventDrag:this.sliceEventDrag(e.eventDrag,a,t,r,...i),eventResize:this.sliceEventResize(e.eventResize,a,t,r,...i),eventSelection:e.eventSelection}}sliceNowDate(e,t,r,s,...i){return this._sliceDateSpan({range:{start:e,end:zn(e,1)},allDay:!1},t,r,{},s,...i)}_sliceBusinessHours(e,t,r,s,...i){return e?this._sliceEventStore(xo(e,Bm(t,!!r),s),{},t,r,...i).bg:[]}_sliceEventStore(e,t,r,s,...i){if(e){let a=dc(e,t,Bm(r,!!s),s);return{bg:this.sliceEventRanges(a.bg,i),fg:this.sliceEventRanges(a.fg,i)}}return{bg:[],fg:[]}}_sliceInteraction(e,t,r,s,...i){if(!e)return null;let a=dc(e.mutatedEvents,t,Bm(r,!!s),s);return{segs:this.sliceEventRanges(a.fg,i),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}}_sliceDateSpan(e,t,r,s,i,...a){if(!e)return[];let o=Bm(t,!!r),l=Wr(e.range,o);if(l){e=Object.assign(Object.assign({},e),{range:l});let c=b$(e,s,i),d=this.sliceRange(e.range,...a);for(let u of d)u.eventRange=c;return d}return[]}sliceEventRanges(e,t){let r=[];for(let s of e)r.push(...this.sliceEventRange(s,t));return r}sliceEventRange(e,t){let r=e.range;this.forceDayIfListItem&&e.ui.display==="list-item"&&(r={start:r.start,end:kt(r.start,1)});let s=this.sliceRange(r,...t);for(let i of s)i.eventRange=e,i.isStart=e.isStart&&i.isStart,i.isEnd=e.isEnd&&i.isEnd;return s}};function Bm(n,e){let t=n.activeRange;return e?t:{start:zn(t.start,n.slotMinTime.milliseconds),end:zn(t.end,n.slotMaxTime.milliseconds-864e5)}}function Nu(n,e,t){let{instances:r}=n.mutatedEvents;for(let s in r)if(!yc(e.validRange,r[s].range))return!1;return mR({eventDrag:n},t)}function Tb(n,e,t){return yc(e.validRange,n.range)?mR({dateSelection:n},t):!1}function mR(n,e){let t=e.getCurrentData(),r=Object.assign({businessHours:t.businessHours,dateSelection:"",eventStore:t.eventStore,eventUiBases:t.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},n);return(e.pluginHooks.isPropsValid||gR)(r,e)}function gR(n,e,t={},r){return!(n.eventDrag&&!N$(n,e,t,r)||n.dateSelection&&!O$(n,e,t,r))}function N$(n,e,t,r){let s=e.getCurrentData(),i=n.eventDrag,a=i.mutatedEvents,o=a.defs,l=a.instances,c=Gm(o,i.isEvent?n.eventUiBases:{"":s.selectionConfig});r&&(c=Js(c,r));let d=r$(n.eventStore,i.affectedEvents.instances),u=d.defs,f=d.instances,h=Gm(u,n.eventUiBases);for(let p in l){let m=l[p],g=m.range,y=c[m.defId],T=o[m.defId];if(!yR(y.constraints,g,d,n.businessHours,e))return!1;let{eventOverlap:w}=e.options,b=typeof w=="function"?w:null;for(let S in f){let D=f[S];if(ig(g,D.range)&&(h[D.defId].overlap===!1&&i.isEvent||y.overlap===!1||b&&!b(new ct(e,u[D.defId],D),new ct(e,T,m))))return!1}let E=s.eventStore;for(let S of y.allows){let D=Object.assign(Object.assign({},t),{range:m.range,allDay:T.allDay}),x=E.defs[T.defId],M=E.instances[p],B;if(x?B=new ct(e,x,M):B=new ct(e,T),!S(ab(D,e),B))return!1}}return!0}function O$(n,e,t,r){let s=n.eventStore,i=s.defs,a=s.instances,o=n.dateSelection,l=o.range,{selectionConfig:c}=e.getCurrentData();if(r&&(c=r(c)),!yR(c.constraints,l,s,n.businessHours,e))return!1;let{selectOverlap:d}=e.options,u=typeof d=="function"?d:null;for(let f in a){let h=a[f];if(ig(l,h.range)&&(c.overlap===!1||u&&!u(new ct(e,i[h.defId],h),null)))return!1}for(let f of c.allows){let h=Object.assign(Object.assign({},t),o);if(!f(ab(h,e),null))return!1}return!0}function yR(n,e,t,r,s){for(let i of n)if(!F$(L$(i,e,t,r,s),e))return!1;return!0}function L$(n,e,t,r,s){return n==="businessHours"?bw(xo(r,e,s)):typeof n=="string"?bw(lg(t,i=>i.groupId===n)):typeof n=="object"&&n?bw(xo(n,e,s)):[]}function bw(n){let{instances:e}=n,t=[];for(let r in e)t.push(e[r].range);return t}function F$(n,e){for(let t of n)if(yc(t,e))return!0;return!1}var Um=/^(visible|hidden)$/,uc=class extends Ie{constructor(){super(...arguments),this.handleEl=e=>{this.el=e,Ds(this.props.elRef,e)}}render(){let{props:e}=this,{liquid:t,liquidIsAbsolute:r}=e,s=t&&r,i=["fc-scroller"];return t&&(r?i.push("fc-scroller-liquid-absolute"):i.push("fc-scroller-liquid")),k("div",{ref:this.handleEl,className:i.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:s&&-(e.overcomeLeft||0)||"",right:s&&-(e.overcomeRight||0)||"",bottom:s&&-(e.overcomeBottom||0)||"",marginLeft:!s&&-(e.overcomeLeft||0)||"",marginRight:!s&&-(e.overcomeRight||0)||"",marginBottom:!s&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)}needsXScrolling(){if(Um.test(this.props.overflowX))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:r}=e;for(let s=0;s<r.length;s+=1)if(r[s].getBoundingClientRect().width>t)return!0;return!1}needsYScrolling(){if(Um.test(this.props.overflowY))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:r}=e;for(let s=0;s<r.length;s+=1)if(r[s].getBoundingClientRect().height>t)return!0;return!1}getXScrollbarWidth(){return Um.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return Um.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}},ns=class{constructor(e){this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(t,r)=>{let{depths:s,currentMap:i}=this,a=!1,o=!1;t!==null?(a=r in i,i[r]=t,s[r]=(s[r]||0)+1,o=!0):(s[r]-=1,s[r]||(delete i[r],delete this.callbackMap[r],a=!0)),this.masterCallback&&(a&&this.masterCallback(null,String(r)),o&&this.masterCallback(t,String(r)))}}createRef(e){let t=this.callbackMap[e];return t||(t=this.callbackMap[e]=r=>{this.handleValue(r,String(e))}),t}collect(e,t,r){return zI(this.currentMap,e,t,r)}getAll(){return ng(this.currentMap)}};function vR(n){let e=OI(n,".fc-scrollgrid-shrink"),t=0;for(let r of e)t=Math.max(t,JW(r));return Math.ceil(t)}function wb(n,e){return n.liquid&&e.liquid}function TR(n,e){return e.maxHeight!=null||wb(n,e)}function wR(n,e,t,r){let{expandRows:s}=t;return typeof e.content=="function"?e.content(t):k("table",{role:"presentation",className:[e.tableClassName,n.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:s?t.clientHeight:""}},t.tableColGroupNode,k(r?"thead":"tbody",{role:"presentation"},typeof e.rowContent=="function"?e.rowContent(t):e.rowContent))}function bR(n,e){return Kn(n,e,Ar)}function kR(n,e){let t=[];for(let r of n){let s=r.span||1;for(let i=0;i<s;i+=1)t.push(k("col",{style:{width:r.width==="shrink"?ER(e):r.width||"",minWidth:r.minWidth||""}}))}return k("colgroup",{},...t)}function ER(n){return n==null?4:n}function SR(n){for(let e of n)if(e.width==="shrink")return!0;return!1}function DR(n,e){let t=["fc-scrollgrid",e.theme.getClass("table")];return n&&t.push("fc-scrollgrid-liquid"),t}function xR(n,e){let t=["fc-scrollgrid-section",`fc-scrollgrid-section-${n.type}`,n.className];return e&&n.liquid&&n.maxHeight==null&&t.push("fc-scrollgrid-section-liquid"),n.isSticky&&t.push("fc-scrollgrid-section-sticky"),t}function Ec(n){return k("div",{className:"fc-scrollgrid-sticky-shim",style:{width:n.clientWidth,minWidth:n.tableMinWidth}})}function Ho(n){let{stickyHeaderDates:e}=n;return(e==null||e==="auto")&&(e=n.height==="auto"||n.viewHeight==="auto"),e}function Ou(n){let{stickyFooterScrollbar:e}=n;return(e==null||e==="auto")&&(e=n.height==="auto"||n.viewHeight==="auto"),e}var ba=class extends Ie{constructor(){super(...arguments),this.processCols=le(e=>e,bR),this.renderMicroColGroup=le(kR),this.scrollerRefs=new ns,this.scrollerElRefs=new ns(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:e,state:t,context:r}=this,s=e.sections||[],i=this.processCols(e.cols),a=this.renderMicroColGroup(i,t.shrinkWidth),o=DR(e.liquid,r);e.collapsibleWidth&&o.push("fc-scrollgrid-collapsible");let l=s.length,c=0,d,u=[],f=[],h=[];for(;c<l&&(d=s[c]).type==="header";)u.push(this.renderSection(d,a,!0)),c+=1;for(;c<l&&(d=s[c]).type==="body";)f.push(this.renderSection(d,a,!1)),c+=1;for(;c<l&&(d=s[c]).type==="footer";)h.push(this.renderSection(d,a,!0)),c+=1;let p=!hb(),m={role:"rowgroup"};return k("table",{role:"grid",className:o.join(" "),style:{height:e.height}},!!(!p&&u.length)&&k("thead",m,...u),!!(!p&&f.length)&&k("tbody",m,...f),!!(!p&&h.length)&&k("tfoot",m,...h),p&&k("tbody",m,...u,...f,...h))}renderSection(e,t,r){return"outerContent"in e?k($e,{key:e.key},e.outerContent):k("tr",{key:e.key,role:"presentation",className:xR(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,e.chunk,r))}renderChunkTd(e,t,r,s){if("outerContent"in r)return r.outerContent;let{props:i}=this,{forceYScrollbars:a,scrollerClientWidths:o,scrollerClientHeights:l}=this.state,c=TR(i,e),d=wb(i,e),u=i.liquid?a?"scroll":c?"auto":"hidden":"visible",f=e.key,h=wR(e,r,{tableColGroupNode:t,tableMinWidth:"",clientWidth:!i.collapsibleWidth&&o[f]!==void 0?o[f]:null,clientHeight:l[f]!==void 0?l[f]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},s);return k(s?"th":"td",{ref:r.elRef,role:"presentation"},k("div",{className:`fc-scroller-harness${d?" fc-scroller-harness-liquid":""}`},k(uc,{ref:this.scrollerRefs.createRef(f),elRef:this.scrollerElRefs.createRef(f),overflowY:u,overflowX:i.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:d,liquidIsAbsolute:!0},h)))}_handleScrollerEl(e,t){let r=H$(this.props.sections,t);r&&Ds(r.chunk.scrollerElRef,e)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return SR(this.props.cols)?vR(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let e=cR(),{scrollerRefs:t,scrollerElRefs:r}=this,s=!1,i={},a={};for(let o in t.currentMap){let l=t.currentMap[o];if(l&&l.needsYScrolling()){s=!0;break}}for(let o of this.props.sections){let l=o.key,c=r.currentMap[l];if(c){let d=c.parentNode;i[l]=Math.floor(d.getBoundingClientRect().width-(s?e.y:0)),a[l]=Math.floor(d.getBoundingClientRect().height)}}return{forceYScrollbars:s,scrollerClientWidths:i,scrollerClientHeights:a}}};ba.addStateEquality({scrollerClientWidths:Ar,scrollerClientHeights:Ar});function H$(n,e){for(let t of n)if(t.key===e)return t;return null}var Oi=class extends Ie{constructor(){super(...arguments),this.buildPublicEvent=le((e,t,r)=>new ct(e,t,r)),this.handleEl=e=>{this.el=e,Ds(this.props.elRef,e),e&&PI(e,this.props.seg)}}render(){let{props:e,context:t}=this,{options:r}=t,{seg:s}=e,{eventRange:i}=s,{ui:a}=i,o={event:this.buildPublicEvent(t,i.def,i.instance),view:t.viewApi,timeText:e.timeText,textColor:a.textColor,backgroundColor:a.backgroundColor,borderColor:a.borderColor,isDraggable:!e.disableDragging&&h$(s,t),isStartResizable:!e.disableResizing&&f$(s,t),isEndResizable:!e.disableResizing&&p$(s),isMirror:!!(e.isDragging||e.isResizing||e.isDateSelecting),isStart:!!s.isStart,isEnd:!!s.isEnd,isPast:!!e.isPast,isFuture:!!e.isFuture,isToday:!!e.isToday,isSelected:!!e.isSelected,isDragging:!!e.isDragging,isResizing:!!e.isResizing};return k(It,{elRef:this.handleEl,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:[...m$(o),...s.eventRange.ui.classNames,...e.elClasses||[]],elStyle:e.elStyle,renderProps:o,generatorName:"eventContent",customGenerator:r.eventContent,defaultGenerator:e.defaultGenerator,classNameGenerator:r.eventClassNames,didMount:r.eventDidMount,willUnmount:r.eventWillUnmount},e.children)}componentDidUpdate(e){this.el&&this.props.seg!==e.seg&&PI(this.el,this.props.seg)}},ka=class extends Ie{render(){let{props:e,context:t}=this,{options:r}=t,{seg:s}=e,{ui:i}=s.eventRange,a=r.eventTimeFormat||e.defaultTimeFormat,o=xa(s,a,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return k(Oi,Object.assign({},e,{elTag:"a",elStyle:{borderColor:i.borderColor,backgroundColor:i.backgroundColor},elAttrs:wc(s,t),defaultGenerator:B$,timeText:o}),(l,c)=>k($e,null,k(l,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:c.textColor}}),!!c.isStartResizable&&k("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!c.isEndResizable&&k("div",{className:"fc-event-resizer fc-event-resizer-end"})))}};ka.addPropsEquality({seg:Ar});function B$(n){return k("div",{className:"fc-event-main-frame"},n.timeText&&k("div",{className:"fc-event-time"},n.timeText),k("div",{className:"fc-event-title-container"},k("div",{className:"fc-event-title fc-sticky"},n.event.title||k($e,null,"\xA0"))))}var Lu=n=>k(en.Consumer,null,e=>{let{options:t}=e,r={isAxis:n.isAxis,date:e.dateEnv.toDate(n.date),view:e.viewApi};return k(It,{elRef:n.elRef,elTag:n.elTag||"div",elAttrs:n.elAttrs,elClasses:n.elClasses,elStyle:n.elStyle,renderProps:r,generatorName:"nowIndicatorContent",customGenerator:t.nowIndicatorContent,classNameGenerator:t.nowIndicatorClassNames,didMount:t.nowIndicatorDidMount,willUnmount:t.nowIndicatorWillUnmount},n.children)}),U$=Ye({day:"numeric"}),Ea=class extends Ie{constructor(){super(...arguments),this.refineRenderProps=gc(j$)}render(){let{props:e,context:t}=this,{options:r}=t,s=this.refineRenderProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,isMonthStart:e.isMonthStart||!1,showDayNumber:e.showDayNumber,extraRenderProps:e.extraRenderProps,viewApi:t.viewApi,dateEnv:t.dateEnv,monthStartFormat:r.monthStartFormat});return k(It,{elRef:e.elRef,elTag:e.elTag,elAttrs:Object.assign(Object.assign({},e.elAttrs),s.isDisabled?{}:{"data-date":Sa(e.date)}),elClasses:[...bc(s,t.theme),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,generatorName:"dayCellContent",customGenerator:r.dayCellContent,defaultGenerator:e.defaultGenerator,classNameGenerator:s.isDisabled?void 0:r.dayCellClassNames,didMount:r.dayCellDidMount,willUnmount:r.dayCellWillUnmount},e.children)}};function Sc(n){return!!(n.dayCellContent||Pw("dayCellContent",n))}function j$(n){let{date:e,dateEnv:t,dateProfile:r,isMonthStart:s}=n,i=_u(e,n.todayRange,null,r),a=n.showDayNumber?t.format(e,s?n.monthStartFormat:U$):"";return Object.assign(Object.assign(Object.assign({date:t.toDate(e),view:n.viewApi},i),{isMonthStart:s,dayNumberText:a}),n.extraRenderProps)}var Ro=class extends Ie{render(){let{props:e}=this,{seg:t}=e;return k(Oi,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:t.eventRange.ui.backgroundColor},defaultGenerator:W$,seg:t,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday,disableDragging:!0,disableResizing:!0})}};function W$(n){let{title:e}=n.event;return e&&k("div",{className:"fc-event-title"},n.event.title)}function Fu(n){return k("div",{className:`fc-${n}`})}var Hu=n=>k(en.Consumer,null,e=>{let{dateEnv:t,options:r}=e,{date:s}=n,i=r.weekNumberFormat||n.defaultFormat,a=t.computeWeekNumber(s),o=t.format(s,i),l={num:a,text:o,date:s};return k(It,{elRef:n.elRef,elTag:n.elTag,elAttrs:n.elAttrs,elClasses:n.elClasses,elStyle:n.elStyle,renderProps:l,generatorName:"weekNumberContent",customGenerator:r.weekNumberContent,defaultGenerator:V$,classNameGenerator:r.weekNumberClassNames,didMount:r.weekNumberDidMount,willUnmount:r.weekNumberWillUnmount},n.children)});function V$(n){return n.text}var kw=10,Aw=class extends Ie{constructor(){super(...arguments),this.state={titleId:is()},this.handleRootEl=e=>{this.rootEl=e,this.props.elRef&&Ds(this.props.elRef,e)},this.handleDocumentMouseDown=e=>{let t=Jm(e);this.rootEl.contains(t)||this.handleCloseClick()},this.handleDocumentKeyDown=e=>{e.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:e}=this.props;e&&e()}}render(){let{theme:e,options:t}=this.context,{props:r,state:s}=this,i=["fc-popover",e.getClass("popover")].concat(r.extraClassNames||[]);return yI(k("div",Object.assign({},r.extraAttrs,{id:r.id,className:i.join(" "),"aria-labelledby":s.titleId,ref:this.handleRootEl}),k("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},k("span",{className:"fc-popover-title",id:s.titleId},r.title),k("span",{className:"fc-popover-close "+e.getIconClass("close"),title:t.closeHint,onClick:this.handleCloseClick})),k("div",{className:"fc-popover-body "+e.getClass("popoverContent")},r.children)),r.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:e}=this.context,{alignmentEl:t,alignGridTop:r}=this.props,{rootEl:s}=this,i=P$(t);if(i){let a=s.getBoundingClientRect(),o=r?tr(t,".fc-scrollgrid").getBoundingClientRect().top:i.top,l=e?i.right-a.width:i.left;o=Math.max(o,kw),l=Math.min(l,document.documentElement.clientWidth-kw-a.width),l=Math.max(l,kw);let c=s.offsetParent.getBoundingClientRect();Oo(s,{top:o-c.top,left:l-c.left})}}},Iw=class extends Qt{constructor(){super(...arguments),this.handleRootEl=e=>{this.rootEl=e,e?this.context.registerInteractiveComponent(this,{el:e,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:e,dateEnv:t}=this.context,{props:r}=this,{startDate:s,todayRange:i,dateProfile:a}=r,o=t.format(s,e.dayPopoverFormat);return k(Ea,{elRef:this.handleRootEl,date:s,dateProfile:a,todayRange:i},(l,c,d)=>k(Aw,{elRef:d.ref,id:r.id,title:o,extraClassNames:["fc-more-popover"].concat(d.className||[]),extraAttrs:d,parentEl:r.parentEl,alignmentEl:r.alignmentEl,alignGridTop:r.alignGridTop,onClose:r.onClose},Sc(e)&&k(l,{elTag:"div",elClasses:["fc-more-popover-misc"]}),r.children))}queryHit(e,t,r,s){let{rootEl:i,props:a}=this;return e>=0&&e<r&&t>=0&&t<s?{dateProfile:a.dateProfile,dateSpan:Object.assign({allDay:!a.forceTimed,range:{start:a.startDate,end:a.endDate}},a.extraDateSpan),dayEl:i,rect:{left:0,top:0,right:r,bottom:s},layer:1}:null}},No=class extends Ie{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:is()},this.handleLinkEl=e=>{this.linkEl=e,this.props.elRef&&Ds(this.props.elRef,e)},this.handleClick=e=>{let{props:t,context:r}=this,{moreLinkClick:s}=r.options,i=_I(t).start;function a(o){let{def:l,instance:c,range:d}=o.eventRange;return{event:new ct(r,l,c),start:r.dateEnv.toDate(d.start),end:r.dateEnv.toDate(d.end),isStart:o.isStart,isEnd:o.isEnd}}typeof s=="function"&&(s=s({date:i,allDay:!!t.allDayDate,allSegs:t.allSegs.map(a),hiddenSegs:t.hiddenSegs.map(a),jsEvent:e,view:r.viewApi})),!s||s==="popover"?this.setState({isPopoverOpen:!0}):typeof s=="string"&&r.calendarApi.zoomTo(i,s)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:e,state:t}=this;return k(en.Consumer,null,r=>{let{viewApi:s,options:i,calendarApi:a}=r,{moreLinkText:o}=i,{moreCnt:l}=e,c=_I(e),d=typeof o=="function"?o.call(a,l):`+${l} ${o}`,u=pc(i.moreLinkHint,[l],d),f={num:l,shortText:`+${l}`,text:d,view:s};return k($e,null,!!e.moreCnt&&k(It,{elTag:e.elTag||"a",elRef:this.handleLinkEl,elClasses:[...e.elClasses||[],"fc-more-link"],elStyle:e.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},e.elAttrs),FI(this.handleClick)),{title:u,"aria-expanded":t.isPopoverOpen,"aria-controls":t.isPopoverOpen?t.popoverId:""}),renderProps:f,generatorName:"moreLinkContent",customGenerator:i.moreLinkContent,defaultGenerator:e.defaultGenerator||$$,classNameGenerator:i.moreLinkClassNames,didMount:i.moreLinkDidMount,willUnmount:i.moreLinkWillUnmount},e.children),t.isPopoverOpen&&k(Iw,{id:t.popoverId,startDate:c.start,endDate:c.end,dateProfile:e.dateProfile,todayRange:e.todayRange,extraDateSpan:e.extraDateSpan,parentEl:this.parentEl,alignmentEl:e.alignmentElRef?e.alignmentElRef.current:this.linkEl,alignGridTop:e.alignGridTop,forceTimed:e.forceTimed,onClose:this.handlePopoverClose},e.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=tr(this.linkEl,".fc-view-harness"))}};function $$(n){return n.text}function _I(n){if(n.allDayDate)return{start:n.allDayDate,end:kt(n.allDayDate,1)};let{hiddenSegs:e}=n;return{start:hg(e),end:z$(e)}}function hg(n){return n.reduce(Y$).eventRange.range.start}function Y$(n,e){return n.eventRange.range.start<e.eventRange.range.start?n:e}function z$(n){return n.reduce(q$).eventRange.range.end}function q$(n,e){return n.eventRange.range.end>e.eventRange.range.end?n:e}var G$=[],RR={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},NR=Object.assign(Object.assign({},RR),{buttonHints:{prev:"Previous $0",next:"Next $0",today(n,e){return e==="day"?"Today":`This ${n}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(n){return`Show ${n} more event${n===1?"":"s"}`}});function Q$(n){let e=n.length>0?n[0].code:"en",t=G$.concat(n),r={en:NR};for(let s of t)r[s.code]=s;return{map:r,defaultCode:e}}function OR(n,e){return typeof n=="object"&&!Array.isArray(n)?LR(n.code,[n.code],n):K$(n,e)}function K$(n,e){let t=[].concat(n||[]),r=Z$(t,e)||NR;return LR(n,t,r)}function Z$(n,e){for(let t=0;t<n.length;t+=1){let r=n[t].toLocaleLowerCase().split("-");for(let s=r.length;s>0;s-=1){let i=r.slice(0,s).join("-");if(e[i])return e[i]}}return null}function LR(n,e,t){let r=sg([RR,t],["buttonText"]);delete r.code;let{week:s}=r;return delete r.week,{codeArg:n,codes:e,week:s,simpleNumberFormat:new Intl.NumberFormat(n),options:r}}function Ir(n){return{id:Li(),name:n.name,premiumReleaseDate:n.premiumReleaseDate?new Date(n.premiumReleaseDate):void 0,deps:n.deps||[],reducers:n.reducers||[],isLoadingFuncs:n.isLoadingFuncs||[],contextInit:[].concat(n.contextInit||[]),eventRefiners:n.eventRefiners||{},eventDefMemberAdders:n.eventDefMemberAdders||[],eventSourceRefiners:n.eventSourceRefiners||{},isDraggableTransformers:n.isDraggableTransformers||[],eventDragMutationMassagers:n.eventDragMutationMassagers||[],eventDefMutationAppliers:n.eventDefMutationAppliers||[],dateSelectionTransformers:n.dateSelectionTransformers||[],datePointTransforms:n.datePointTransforms||[],dateSpanTransforms:n.dateSpanTransforms||[],views:n.views||{},viewPropsTransformers:n.viewPropsTransformers||[],isPropsValid:n.isPropsValid||null,externalDefTransforms:n.externalDefTransforms||[],viewContainerAppends:n.viewContainerAppends||[],eventDropTransformers:n.eventDropTransformers||[],componentInteractions:n.componentInteractions||[],calendarInteractions:n.calendarInteractions||[],themeClasses:n.themeClasses||{},eventSourceDefs:n.eventSourceDefs||[],cmdFormatter:n.cmdFormatter,recurringTypes:n.recurringTypes||[],namedTimeZonedImpl:n.namedTimeZonedImpl,initialView:n.initialView||"",elementDraggingImpl:n.elementDraggingImpl,optionChangeHandlers:n.optionChangeHandlers||{},scrollGridImpl:n.scrollGridImpl||null,listenerRefiners:n.listenerRefiners||{},optionRefiners:n.optionRefiners||{},propSetHandlers:n.propSetHandlers||{}}}function X$(n,e){let t={},r={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function s(i){for(let a of i){let o=a.name,l=t[o];l===void 0?(t[o]=a.id,s(a.deps),r=e2(r,a)):l!==a.id&&console.warn(`Duplicate plugin '${o}'`)}}return n&&s(n),s(e),r}function J$(){let n=[],e=[],t;return(r,s)=>((!t||!Kn(r,n)||!Kn(s,e))&&(t=X$(r,s)),n=r,e=s,t)}function e2(n,e){return{premiumReleaseDate:t2(n.premiumReleaseDate,e.premiumReleaseDate),reducers:n.reducers.concat(e.reducers),isLoadingFuncs:n.isLoadingFuncs.concat(e.isLoadingFuncs),contextInit:n.contextInit.concat(e.contextInit),eventRefiners:Object.assign(Object.assign({},n.eventRefiners),e.eventRefiners),eventDefMemberAdders:n.eventDefMemberAdders.concat(e.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},n.eventSourceRefiners),e.eventSourceRefiners),isDraggableTransformers:n.isDraggableTransformers.concat(e.isDraggableTransformers),eventDragMutationMassagers:n.eventDragMutationMassagers.concat(e.eventDragMutationMassagers),eventDefMutationAppliers:n.eventDefMutationAppliers.concat(e.eventDefMutationAppliers),dateSelectionTransformers:n.dateSelectionTransformers.concat(e.dateSelectionTransformers),datePointTransforms:n.datePointTransforms.concat(e.datePointTransforms),dateSpanTransforms:n.dateSpanTransforms.concat(e.dateSpanTransforms),views:Object.assign(Object.assign({},n.views),e.views),viewPropsTransformers:n.viewPropsTransformers.concat(e.viewPropsTransformers),isPropsValid:e.isPropsValid||n.isPropsValid,externalDefTransforms:n.externalDefTransforms.concat(e.externalDefTransforms),viewContainerAppends:n.viewContainerAppends.concat(e.viewContainerAppends),eventDropTransformers:n.eventDropTransformers.concat(e.eventDropTransformers),calendarInteractions:n.calendarInteractions.concat(e.calendarInteractions),componentInteractions:n.componentInteractions.concat(e.componentInteractions),themeClasses:Object.assign(Object.assign({},n.themeClasses),e.themeClasses),eventSourceDefs:n.eventSourceDefs.concat(e.eventSourceDefs),cmdFormatter:e.cmdFormatter||n.cmdFormatter,recurringTypes:n.recurringTypes.concat(e.recurringTypes),namedTimeZonedImpl:e.namedTimeZonedImpl||n.namedTimeZonedImpl,initialView:n.initialView||e.initialView,elementDraggingImpl:n.elementDraggingImpl||e.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},n.optionChangeHandlers),e.optionChangeHandlers),scrollGridImpl:e.scrollGridImpl||n.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},n.listenerRefiners),e.listenerRefiners),optionRefiners:Object.assign(Object.assign({},n.optionRefiners),e.optionRefiners),propSetHandlers:Object.assign(Object.assign({},n.propSetHandlers),e.propSetHandlers)}}function t2(n,e){return n===void 0?e:e===void 0?n:new Date(Math.max(n.valueOf(),e.valueOf()))}var ti=class extends Ii{};ti.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};ti.prototype.baseIconClass="fc-icon";ti.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};ti.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};ti.prototype.iconOverrideOption="buttonIcons";ti.prototype.iconOverrideCustomButtonOption="icon";ti.prototype.iconOverridePrefix="fc-icon-";function r2(n,e){let t={},r;for(r in n)kb(r,t,n,e);for(r in e)kb(r,t,n,e);return t}function kb(n,e,t,r){if(e[n])return e[n];let s=s2(n,e,t,r);return s&&(e[n]=s),s}function s2(n,e,t,r){let s=t[n],i=r[n],a=d=>s&&s[d]!==null?s[d]:i&&i[d]!==null?i[d]:null,o=a("component"),l=a("superType"),c=null;if(l){if(l===n)throw new Error("Can't have a custom view type that references itself");c=kb(l,e,t,r)}return!o&&c&&(o=c.component),o?{type:n,component:o,defaults:Object.assign(Object.assign({},c?c.defaults:{}),s?s.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),i?i.rawOptions:{})}:null}function CR(n){return Js(n,n2)}function n2(n){let e=typeof n=="function"?{component:n}:n,{component:t}=e;return e.content?t=MR(e):t&&!(t.prototype instanceof Ie)&&(t=MR(Object.assign(Object.assign({},e),{content:t}))),{superType:e.type,component:t,rawOptions:e}}function MR(n){return e=>k(en.Consumer,null,t=>k(It,{elTag:"div",elClasses:Xw(t.viewSpec),renderProps:Object.assign(Object.assign({},e),{nextDayThreshold:t.options.nextDayThreshold}),generatorName:void 0,customGenerator:n.content,classNameGenerator:n.classNames,didMount:n.didMount,willUnmount:n.willUnmount}))}function i2(n,e,t,r){let s=CR(n),i=CR(e.views),a=r2(s,i);return Js(a,o=>a2(o,i,e,t,r))}function a2(n,e,t,r,s){let i=n.overrides.duration||n.defaults.duration||r.duration||t.duration,a=null,o="",l="",c={};if(i&&(a=o2(i),a)){let f=au(a);o=f.unit,f.value===1&&(l=o,c=e[o]?e[o].rawOptions:{})}let d=f=>{let h=f.buttonText||{},p=n.defaults.buttonTextKey;return p!=null&&h[p]!=null?h[p]:h[n.type]!=null?h[n.type]:h[l]!=null?h[l]:null},u=f=>{let h=f.buttonHints||{},p=n.defaults.buttonTextKey;return p!=null&&h[p]!=null?h[p]:h[n.type]!=null?h[n.type]:h[l]!=null?h[l]:null};return{type:n.type,component:n.component,duration:a,durationUnit:o,singleUnit:l,optionDefaults:n.defaults,optionOverrides:Object.assign(Object.assign({},c),n.overrides),buttonTextOverride:d(r)||d(t)||n.overrides.buttonText,buttonTextDefault:d(s)||n.defaults.buttonText||d(Xn)||n.type,buttonTitleOverride:u(r)||u(t)||n.overrides.buttonHint,buttonTitleDefault:u(s)||n.defaults.buttonHint||u(Xn)}}var PR={};function o2(n){let e=JSON.stringify(n),t=PR[e];return t===void 0&&(t=De(n),PR[e]=t),t}function l2(n,e){switch(e.type){case"CHANGE_VIEW_TYPE":n=e.viewType}return n}function c2(n,e){switch(e.type){case"CHANGE_DATE":return e.dateMarker;default:return n}}function d2(n,e,t){let r=n.initialDate;return r!=null?e.createMarker(r):t.getDateMarker()}function u2(n,e){switch(e.type){case"SET_OPTION":return Object.assign(Object.assign({},n),{[e.optionName]:e.rawOptionValue});default:return n}}function h2(n,e,t,r){let s;switch(e.type){case"CHANGE_VIEW_TYPE":return r.build(e.dateMarker||t);case"CHANGE_DATE":return r.build(e.dateMarker);case"PREV":if(s=r.buildPrev(n,t),s.isValid)return s;break;case"NEXT":if(s=r.buildNext(n,t),s.isValid)return s;break}return n}function f2(n,e,t){let r=e?e.activeRange:null;return HR({},w2(n,t),r,t)}function p2(n,e,t,r){let s=t?t.activeRange:null;switch(e.type){case"ADD_EVENT_SOURCES":return HR(n,e.sources,s,r);case"REMOVE_EVENT_SOURCE":return g2(n,e.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return t?BR(n,s,r):n;case"FETCH_EVENT_SOURCES":return Ab(n,e.sourceIds?Qw(e.sourceIds):UR(n,r),s,e.isRefetch||!1,r);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return T2(n,e.sourceId,e.fetchId,e.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return n}}function m2(n,e,t){let r=e?e.activeRange:null;return Ab(n,UR(n,t),r,!0,t)}function FR(n){for(let e in n)if(n[e].isFetching)return!0;return!1}function HR(n,e,t,r){let s={};for(let i of e)s[i.sourceId]=i;return t&&(s=BR(s,t,r)),Object.assign(Object.assign({},n),s)}function g2(n,e){return Ai(n,t=>t.sourceId!==e)}function BR(n,e,t){return Ab(n,Ai(n,r=>y2(r,e,t)),e,!1,t)}function y2(n,e,t){return jR(n,t)?!t.options.lazyFetching||!n.fetchRange||n.isFetching||e.start<n.fetchRange.start||e.end>n.fetchRange.end:!n.latestFetchId}function Ab(n,e,t,r,s){let i={};for(let a in n){let o=n[a];e[a]?i[a]=v2(o,t,r,s):i[a]=o}return i}function v2(n,e,t,r){let{options:s,calendarApi:i}=r,a=r.pluginHooks.eventSourceDefs[n.sourceDefId],o=Li();return a.fetch({eventSource:n,range:e,isRefetch:t,context:r},l=>{let{rawEvents:c}=l;s.eventSourceSuccess&&(c=s.eventSourceSuccess.call(i,c,l.response)||c),n.success&&(c=n.success.call(i,c,l.response)||c),r.dispatch({type:"RECEIVE_EVENTS",sourceId:n.sourceId,fetchId:o,fetchRange:e,rawEvents:c})},l=>{let c=!1;s.eventSourceFailure&&(s.eventSourceFailure.call(i,l),c=!0),n.failure&&(n.failure(l),c=!0),c||console.warn(l.message,l),r.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:n.sourceId,fetchId:o,fetchRange:e,error:l})}),Object.assign(Object.assign({},n),{isFetching:!0,latestFetchId:o})}function T2(n,e,t,r){let s=n[e];return s&&t===s.latestFetchId?Object.assign(Object.assign({},n),{[e]:Object.assign(Object.assign({},s),{isFetching:!1,fetchRange:r})}):n}function UR(n,e){return Ai(n,t=>jR(t,e))}function w2(n,e){let t=sb(e),r=[].concat(n.eventSources||[]),s=[];n.initialEvents&&r.unshift(n.initialEvents),n.events&&r.unshift(n.events);for(let i of r){let a=rb(i,e,t);a&&s.push(a)}return s}function jR(n,e){return!e.pluginHooks.eventSourceDefs[n.sourceDefId].ignoreRange}function b2(n,e){switch(e.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return e.selection;default:return n}}function k2(n,e){switch(e.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return e.eventInstanceId;default:return n}}function E2(n,e){let t;switch(e.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return n}}function S2(n,e){let t;switch(e.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return n}}function D2(n,e,t,r,s){let i=n.headerToolbar?_R(n.headerToolbar,n,e,t,r,s):null,a=n.footerToolbar?_R(n.footerToolbar,n,e,t,r,s):null;return{header:i,footer:a}}function _R(n,e,t,r,s,i){let a={},o=[],l=!1;for(let c in n){let d=n[c],u=x2(d,e,t,r,s,i);a[c]=u.widgets,o.push(...u.viewsWithButtons),l=l||u.hasTitle}return{sectionWidgets:a,viewsWithButtons:o,hasTitle:l}}function x2(n,e,t,r,s,i){let a=e.direction==="rtl",o=e.customButtons||{},l=t.buttonText||{},c=e.buttonText||{},d=t.buttonHints||{},u=e.buttonHints||{},f=n?n.split(" "):[],h=[],p=!1;return{widgets:f.map(g=>g.split(",").map(y=>{if(y==="title")return p=!0,{buttonName:y};let T,w,b,E,S,D;if(T=o[y])b=x=>{T.click&&T.click.call(x.target,x,x.target)},(E=r.getCustomButtonIconClass(T))||(E=r.getIconClass(y,a))||(S=T.text),D=T.hint||T.text;else if(w=s[y]){h.push(y),b=()=>{i.changeView(y)},(S=w.buttonTextOverride)||(E=r.getIconClass(y,a))||(S=w.buttonTextDefault);let x=w.buttonTextOverride||w.buttonTextDefault;D=pc(w.buttonTitleOverride||w.buttonTitleDefault||e.viewHint,[x,y],x)}else if(i[y])if(b=()=>{i[y]()},(S=l[y])||(E=r.getIconClass(y,a))||(S=c[y]),y==="prevYear"||y==="nextYear"){let x=y==="prevYear"?"prev":"next";D=pc(d[x]||u[x],[c.year||"year","year"],c[y])}else D=x=>pc(d[y]||u[y],[c[x]||x,x],c[y]);return{buttonName:y,buttonClick:b,buttonIcon:E,buttonText:S,buttonHint:D}})),viewsWithButtons:h,hasTitle:p}}var Eb=class{constructor(e,t,r){this.type=e,this.getCurrentData=t,this.dateEnv=r}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}},C2={ignoreRange:!0,parseMeta(n){return Array.isArray(n.events)?n.events:null},fetch(n,e){e({rawEvents:n.eventSource.meta})}},M2=Ir({name:"array-event-source",eventSourceDefs:[C2]}),P2={parseMeta(n){return typeof n.events=="function"?n.events:null},fetch(n,e,t){let{dateEnv:r}=n.context,s=n.eventSource.meta;db(s.bind(null,cb(n.range,r)),i=>e({rawEvents:i}),t)}},_2=Ir({name:"func-event-source",eventSourceDefs:[P2]}),A2={method:String,extraParams:N,startParam:String,endParam:String,timeZoneParam:String},I2={parseMeta(n){return n.url&&(n.format==="json"||!n.format)?{url:n.url,format:"json",method:(n.method||"GET").toUpperCase(),extraParams:n.extraParams,startParam:n.startParam,endParam:n.endParam,timeZoneParam:n.timeZoneParam}:null},fetch(n,e,t){let{meta:r}=n.eventSource,s=N2(r,n.range,n.context);ub(r.method,r.url,s).then(([i,a])=>{e({rawEvents:i,response:a})},t)}},R2=Ir({name:"json-event-source",eventSourceRefiners:A2,eventSourceDefs:[I2]});function N2(n,e,t){let{dateEnv:r,options:s}=t,i,a,o,l,c={};return i=n.startParam,i==null&&(i=s.startParam),a=n.endParam,a==null&&(a=s.endParam),o=n.timeZoneParam,o==null&&(o=s.timeZoneParam),typeof n.extraParams=="function"?l=n.extraParams():l=n.extraParams||{},Object.assign(c,l),c[i]=r.formatIso(e.start),c[a]=r.formatIso(e.end),r.timeZone!=="local"&&(c[o]=r.timeZone),c}var O2={daysOfWeek:N,startTime:De,endTime:De,duration:De,startRecur:N,endRecur:N},L2={parse(n,e){if(n.daysOfWeek||n.startTime||n.endTime||n.startRecur||n.endRecur){let t={daysOfWeek:n.daysOfWeek||null,startTime:n.startTime||null,endTime:n.endTime||null,startRecur:n.startRecur?e.createMarker(n.startRecur):null,endRecur:n.endRecur?e.createMarker(n.endRecur):null,dateEnv:e},r;return n.duration&&(r=n.duration),!r&&n.startTime&&n.endTime&&(r=WI(n.endTime,n.startTime)),{allDayGuess:!n.startTime&&!n.endTime,duration:r,typeData:t}}return null},expand(n,e,t){let r=Wr(e,{start:n.startRecur,end:n.endRecur});return r?H2(n.daysOfWeek,n.startTime,n.dateEnv,t,r):[]}},F2=Ir({name:"simple-recurring-event",recurringTypes:[L2],eventRefiners:O2});function H2(n,e,t,r,s){let i=n?Qw(n):null,a=tt(s.start),o=s.end,l=[];for(e&&(e.milliseconds<0?o=kt(o,1):e.milliseconds>=1e3*60*60*24&&(a=kt(a,-1)));a<o;){let c;(!i||i[a.getUTCDay()])&&(e?c=r.add(a,e):c=a,l.push(r.createMarker(t.toDate(c)))),a=kt(a,1)}return l}var B2=Ir({name:"change-handler",optionChangeHandlers:{events(n,e){AR([n],e)},eventSources:AR}});function AR(n,e){let t=ng(e.getCurrentData().eventSources);if(t.length===1&&n.length===1&&Array.isArray(t[0]._raw)&&Array.isArray(n[0])){e.dispatch({type:"RESET_RAW_EVENTS",sourceId:t[0].sourceId,rawEvents:n[0]});return}let r=[];for(let s of n){let i=!1;for(let a=0;a<t.length;a+=1)if(t[a]._raw===s){t.splice(a,1),i=!0;break}i||r.push(s)}for(let s of t)e.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:s.sourceId});for(let s of r)e.calendarApi.addEventSource(s)}function U2(n,e){e.emitter.trigger("datesSet",Object.assign(Object.assign({},cb(n.activeRange,e.dateEnv)),{view:e.viewApi}))}function j2(n,e){let{emitter:t}=e;t.hasHandlers("eventsSet")&&t.trigger("eventsSet",Jn(n,e))}var W2=[M2,_2,R2,F2,B2,Ir({name:"misc",isLoadingFuncs:[n=>FR(n.eventSources)],propSetHandlers:{dateProfile:U2,eventStore:j2}})],Sb=class{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new So(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t=[],r;for(;r=e.shift();)this.runTask(r),t.push(r);this.drained(t)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}};function V2(n,e,t){let r;return/^(year|month)$/.test(n.currentRangeUnit)?r=n.currentRange:r=n.activeRange,t.formatRange(r.start,r.end,Ye(e.titleFormat||$2(n)),{isEndExclusive:n.isRangeAllDay,defaultSeparator:e.titleRangeSeparator})}function $2(n){let{currentRangeUnit:e}=n;if(e==="year")return{year:"numeric"};if(e==="month")return{year:"numeric",month:"long"};let t=lc(n.currentRange.start,n.currentRange.end);return t!==null&&t>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var fg=class{constructor(){this.resetListeners=new Set}handleInput(e,t){let r=this.dateEnv;if(e!==r&&(typeof t=="function"?this.nowFn=t:r||(this.nowAnchorDate=e.toDate(t?e.createMarker(t):e.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=e,r))for(let s of this.resetListeners.values())s()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(e){this.resetListeners.add(e)}removeResetListener(e){this.resetListeners.delete(e)}},Db=class{constructor(e){this.computeCurrentViewData=le(this._computeCurrentViewData),this.organizeRawLocales=le(Q$),this.buildLocale=le(OR),this.buildPluginHooks=J$(),this.buildDateEnv=le(Y2),this.buildTheme=le(z2),this.parseToolbars=le(D2),this.buildViewSpecs=le(i2),this.buildDateProfileGenerator=gc(q2),this.buildViewApi=le(G2),this.buildViewUiProps=gc(Z2),this.buildEventUiBySource=le(Q2,Ar),this.buildEventUiBases=le(K2),this.parseContextBusinessHours=gc(X2),this.buildTitle=le(V2),this.nowManager=new fg,this.emitter=new Ri,this.actionRunner=new Sb(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=f=>{this.actionRunner.request(f)},this.props=e,this.actionRunner.pause(),this.nowManager=new fg;let t={},r=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),s=r.calendarOptions.initialView||r.pluginHooks.initialView,i=this.computeCurrentViewData(s,r,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(i.options);let a={nowManager:this.nowManager,dateEnv:r.dateEnv,options:r.calendarOptions,pluginHooks:r.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},o=d2(r.calendarOptions,r.dateEnv,this.nowManager),l=i.dateProfileGenerator.build(o);Xs(l.activeRange,o)||(o=l.currentRange.start);for(let f of r.pluginHooks.contextInit)f(a);let c=f2(r.calendarOptions,l,a),d={dynamicOptionOverrides:t,currentViewType:s,currentDate:o,dateProfile:l,businessHours:this.parseContextBusinessHours(a),eventSources:c,eventUiBases:{},eventStore:rr(),renderableEventStore:rr(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(a).selectionConfig},u=Object.assign(Object.assign({},a),d);for(let f of r.pluginHooks.reducers)Object.assign(d,f(null,null,u));bb(d,a)&&this.emitter.trigger("loading",!0),this.state=d,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:r}=this;t===void 0?r.optionOverrides=e:(r.optionOverrides=Object.assign(Object.assign({},r.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(t===void 0||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:r,emitter:s}=this,i=u2(r.dynamicOptionOverrides,e),a=this.computeOptionsData(t.optionOverrides,i,t.calendarApi),o=l2(r.currentViewType,e),l=this.computeCurrentViewData(o,a,t.optionOverrides,i);t.calendarApi.currentDataManager=this,s.setThisContext(t.calendarApi),s.setOptions(l.options);let c={nowManager:this.nowManager,dateEnv:a.dateEnv,options:a.calendarOptions,pluginHooks:a.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:s,getCurrentData:this.getCurrentData},{currentDate:d,dateProfile:u}=r;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(u=l.dateProfileGenerator.build(d)),d=c2(d,e),u=h2(u,e,d,l.dateProfileGenerator),(e.type==="PREV"||e.type==="NEXT"||!Xs(u.currentRange,d))&&(d=u.currentRange.start);let f=p2(r.eventSources,e,u,c),h=tR(r.eventStore,e,f,u,c),m=FR(f)&&!l.options.progressiveEventRendering&&r.renderableEventStore||h,{eventUiSingleBase:g,selectionConfig:y}=this.buildViewUiProps(c),T=this.buildEventUiBySource(f),w=this.buildEventUiBases(m.defs,g,T),b={dynamicOptionOverrides:i,currentViewType:o,currentDate:d,dateProfile:u,eventSources:f,eventStore:h,renderableEventStore:m,selectionConfig:y,eventUiBases:w,businessHours:this.parseContextBusinessHours(c),dateSelection:b2(r.dateSelection,e),eventSelection:k2(r.eventSelection,e),eventDrag:E2(r.eventDrag,e),eventResize:S2(r.eventResize,e)},E=Object.assign(Object.assign({},c),b);for(let x of a.pluginHooks.reducers)Object.assign(b,x(r,e,E));let S=bb(r,c),D=bb(b,c);!S&&D?s.trigger("loading",!0):S&&!D&&s.trigger("loading",!1),this.state=b,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,r=this.data,s=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),i=this.computeCurrentViewData(t.currentViewType,s,e.optionOverrides,t.dynamicOptionOverrides),a=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(t.dateProfile,i.options,s.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},s),i),t),o=s.pluginHooks.optionChangeHandlers,l=r&&r.calendarOptions,c=s.calendarOptions;if(l&&l!==c){l.timeZone!==c.timeZone&&(t.eventSources=a.eventSources=m2(a.eventSources,t.dateProfile,a),t.eventStore=a.eventStore=nb(a.eventStore,r.dateEnv,a.dateEnv),t.renderableEventStore=a.renderableEventStore=nb(a.renderableEventStore,r.dateEnv,a.dateEnv));for(let d in o)(this.optionsForHandling.indexOf(d)!==-1||l[d]!==c[d])&&o[d](c[d],a)}this.optionsForHandling=[],e.onData&&e.onData(a)}computeOptionsData(e,t,r){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:s,pluginHooks:i,localeDefaults:a,availableLocaleData:o,extra:l}=this.processRawCalendarOptions(e,t);IR(l);let c=this.buildDateEnv(s.timeZone,s.locale,s.weekNumberCalculation,s.firstDay,s.weekText,i,o,s.defaultRangeSeparator),d=this.buildViewSpecs(i.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,a),u=this.buildTheme(s,i),f=this.parseToolbars(s,this.stableOptionOverrides,u,d,r);return this.stableCalendarOptionsData={calendarOptions:s,pluginHooks:i,dateEnv:c,viewSpecs:d,theme:u,toolbarConfig:f,localeDefaults:a,availableRawLocales:o.map}}processRawCalendarOptions(e,t){let{locales:r,locale:s}=rg([Xn,e,t]),i=this.organizeRawLocales(r),a=i.map,o=this.buildLocale(s||i.defaultCode,a).options,l=this.buildPluginHooks(e.plugins||[],W2),c=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zw),qw),Gw),l.listenerRefiners),l.optionRefiners),d={},u=rg([Xn,o,e,t]),f={},h=this.currentCalendarOptionsInput,p=this.currentCalendarOptionsRefined,m=!1;for(let g in u)this.optionsForRefining.indexOf(g)===-1&&(u[g]===h[g]||Da[g]&&g in h&&Da[g](h[g],u[g]))?f[g]=p[g]:c[g]?(f[g]=c[g](u[g]),m=!0):d[g]=h[g];return m&&(this.currentCalendarOptionsInput=u,this.currentCalendarOptionsRefined=f,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:i,localeDefaults:o,extra:d}}_computeCurrentViewData(e,t,r,s){let i=t.viewSpecs[e];if(!i)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:a,extra:o}=this.processRawViewOptions(i,t.pluginHooks,t.localeDefaults,r,s);IR(o),this.nowManager.handleInput(t.dateEnv,a.now);let l=this.buildDateProfileGenerator({dateProfileGeneratorClass:i.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:i.duration,durationUnit:i.durationUnit,usesMinMaxTime:i.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:a.slotMinTime,slotMaxTime:a.slotMaxTime,showNonCurrentDates:a.showNonCurrentDates,dayCount:a.dayCount,dateAlignment:a.dateAlignment,dateIncrement:a.dateIncrement,hiddenDays:a.hiddenDays,weekends:a.weekends,validRangeInput:a.validRange,visibleRangeInput:a.visibleRange,fixedWeekCount:a.fixedWeekCount}),c=this.buildViewApi(e,this.getCurrentData,t.dateEnv);return{viewSpec:i,options:a,dateProfileGenerator:l,viewApi:c}}processRawViewOptions(e,t,r,s,i){let a=rg([Xn,e.optionDefaults,r,s,e.optionOverrides,i]),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zw),qw),Gw),YI),t.listenerRefiners),t.optionRefiners),l={},c=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,u=!1,f={};for(let h in a)a[h]===c[h]||Da[h]&&Da[h](a[h],c[h])?l[h]=d[h]:(a[h]===this.currentCalendarOptionsInput[h]||Da[h]&&Da[h](a[h],this.currentCalendarOptionsInput[h])?h in this.currentCalendarOptionsRefined&&(l[h]=this.currentCalendarOptionsRefined[h]):o[h]?l[h]=o[h](a[h]):f[h]=a[h],u=!0);return u&&(this.currentViewOptionsInput=a,this.currentViewOptionsRefined=l),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:f}}};function Y2(n,e,t,r,s,i,a,o){let l=OR(e||a.defaultCode,a.map);return new ou({calendarSystem:"gregory",timeZone:n,namedTimeZoneImpl:i.namedTimeZonedImpl,locale:l,weekNumberCalculation:t,firstDay:r,weekText:s,cmdFormatter:i.cmdFormatter,defaultSeparator:o})}function z2(n,e){let t=e.themeClasses[n.themeSystem]||ti;return new t(n)}function q2(n){let e=n.dateProfileGeneratorClass||Do;return new e(n)}function G2(n,e,t){return new Eb(n,e,t)}function Q2(n){return Js(n,e=>e.ui)}function K2(n,e,t){let r={"":e};for(let s in n){let i=n[s];i.sourceId&&t[i.sourceId]&&(r[s]=t[i.sourceId])}return r}function Z2(n){let{options:e}=n;return{eventUiSingleBase:Tc({display:e.eventDisplay,editable:e.editable,startEditable:e.eventStartEditable,durationEditable:e.eventDurationEditable,constraint:e.eventConstraint,overlap:typeof e.eventOverlap=="boolean"?e.eventOverlap:void 0,allow:e.eventAllow,backgroundColor:e.eventBackgroundColor,borderColor:e.eventBorderColor,textColor:e.eventTextColor,color:e.eventColor},n),selectionConfig:Tc({constraint:e.selectConstraint,overlap:typeof e.selectOverlap=="boolean"?e.selectOverlap:void 0,allow:e.selectAllow},n)}}function bb(n,e){for(let t of e.pluginHooks.isLoadingFuncs)if(t(n))return!0;return!1}function X2(n){return ib(n.options.businessHours,n)}function IR(n,e){for(let t in n)console.warn(`Unknown option '${t}'`+(e?` for view '${e}'`:""))}var xb=class extends Ie{render(){let e=this.props.widgetGroups.map(t=>this.renderWidgetGroup(t));return k("div",{className:"fc-toolbar-chunk"},...e)}renderWidgetGroup(e){let{props:t}=this,{theme:r}=this.context,s=[],i=!0;for(let a of e){let{buttonName:o,buttonClick:l,buttonText:c,buttonIcon:d,buttonHint:u}=a;if(o==="title")i=!1,s.push(k("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let f=o===t.activeButton,h=!t.isTodayEnabled&&o==="today"||!t.isPrevEnabled&&o==="prev"||!t.isNextEnabled&&o==="next",p=[`fc-${o}-button`,r.getClass("button")];f&&p.push(r.getClass("buttonActive")),s.push(k("button",{type:"button",title:typeof u=="function"?u(t.navUnit):u,disabled:h,"aria-pressed":f,className:p.join(" "),onClick:l},c||(d?k("span",{className:d,role:"img"}):"")))}}if(s.length>1){let a=i&&r.getClass("buttonGroup")||"";return k("div",{className:a},...s)}return s[0]}},pg=class extends Ie{render(){let{model:e,extraClassName:t}=this.props,r=!1,s,i,a=e.sectionWidgets,o=a.center;return a.left?(r=!0,s=a.left):s=a.start,a.right?(r=!0,i=a.right):i=a.end,k("div",{className:[t||"","fc-toolbar",r?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",s||[]),this.renderSection("center",o||[]),this.renderSection("end",i||[]))}renderSection(e,t){let{props:r}=this;return k(xb,{key:e,widgetGroups:t,title:r.title,navUnit:r.navUnit,activeButton:r.activeButton,isTodayEnabled:r.isTodayEnabled,isPrevEnabled:r.isPrevEnabled,isNextEnabled:r.isNextEnabled,titleId:r.titleId})}},Cb=class extends Ie{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,Ds(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:r}=e,s=["fc-view-harness",r||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],i="",a="";return r?t.availableWidth!==null?i=t.availableWidth/r:a=`${1/r*100}%`:i=e.height||"",k("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:s.join(" "),style:{height:i,paddingBottom:a}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}},Mb=class extends Sn{constructor(e){super(e),this.handleSegClick=(t,r)=>{let{component:s}=this,{context:i}=s,a=Fi(r);if(a&&s.isValidSegDownEl(t.target)){let o=tr(t.target,".fc-event-forced-url"),l=o?o.querySelector("a[href]").href:"";i.emitter.trigger("eventClick",{el:r,event:new ct(s.context,a.eventRange.def,a.eventRange.instance),jsEvent:t,view:i.viewApi}),l&&!t.defaultPrevented&&(window.location.href=l)}},this.destroy=Nw(e.el,"click",".fc-event",this.handleSegClick)}},Pb=class extends Sn{constructor(e){super(e),this.handleEventElRemove=t=>{t===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(t,r)=>{Fi(r)&&(this.currentSegEl=r,this.triggerEvent("eventMouseEnter",t,r))},this.handleSegLeave=(t,r)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",t,r))},this.removeHoverListeners=LI(e.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,r){let{component:s}=this,{context:i}=s,a=Fi(r);(!t||s.isValidSegDownEl(t.target))&&i.emitter.trigger(e,{el:r,event:new ct(i,a.eventRange.def,a.eventRange.instance),jsEvent:t,view:i.viewApi})}},_b=class extends qn{constructor(){super(...arguments),this.buildViewContext=le(KI),this.buildViewPropTransformers=le(eY),this.buildToolbarProps=le(J2),this.headerRef=xt(),this.footerRef=xt(),this.interactionsStore={},this.state={viewLabelId:is()},this.registerInteractiveComponent=(e,t)=>{let r=oR(e,t),a=[Mb,Pb].concat(this.props.pluginHooks.componentInteractions).map(o=>new o(r));this.interactionsStore[e.uid]=a,Fo[e.uid]=r},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let r of t)r.destroy();delete this.interactionsStore[e.uid]}delete Fo[e.uid]},this.resizeRunner=new So(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let{props:e}=this,{toolbarConfig:t,options:r}=e,s=!1,i="",a;e.isHeightAuto||e.forPrint?i="":r.height!=null?s=!0:r.contentHeight!=null?i=r.contentHeight:a=Math.max(r.aspectRatio,.5);let o=this.buildViewContext(e.viewSpec,e.viewApi,e.options,e.dateProfileGenerator,e.dateEnv,e.nowManager,e.theme,e.pluginHooks,e.dispatch,e.getCurrentData,e.emitter,e.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=t.header&&t.header.hasTitle?this.state.viewLabelId:void 0;return k(en.Provider,{value:o},k(ss,{unit:"day"},c=>{let d=this.buildToolbarProps(e.viewSpec,e.dateProfile,e.dateProfileGenerator,e.currentDate,c,e.viewTitle);return k($e,null,t.header&&k(pg,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:t.header,titleId:l},d)),k(Cb,{liquid:s,height:i,aspectRatio:a,labeledById:l},this.renderView(e),this.buildAppendContent()),t.footer&&k(pg,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:t.footer,titleId:""},d)))}))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map(r=>new r(e)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let r in t)t[r](e[r],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:r}=t.pluginHooks;for(let s in r)t[s]!==e[s]&&r[s](t[s],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this,t=e.pluginHooks.viewContainerAppends.map(r=>r(e));return k($e,{},...t)}renderView(e){let{pluginHooks:t}=e,{viewSpec:r}=e,s={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},i=this.buildViewPropTransformers(t.viewPropsTransformers);for(let o of i)Object.assign(s,o.transform(s,e));let a=r.component;return k(a,Object.assign({},s))}};function J2(n,e,t,r,s,i){let a=t.build(s,void 0,!1),o=t.buildPrev(e,r,!1),l=t.buildNext(e,r,!1);return{title:i,activeButton:n.type,navUnit:n.singleUnit,isTodayEnabled:a.isValid&&!Xs(e.currentRange,s),isPrevEnabled:o.isValid,isNextEnabled:l.isValid}}function eY(n){return n.map(e=>new e)}var mg=class extends fu{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=r=>{switch(r.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=r=>{this.currentData=r,this.renderRunner.request(r.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:r}=this;lu(()=>{ga(k(hu,{options:r.calendarOptions,theme:r.theme,emitter:r.emitter},(s,i,a,o)=>(this.setClassNames(s),this.setHeight(i),k(Zw.Provider,{value:this.customContentRenderId},k(_b,Object.assign({isHeightAuto:a,forPrint:o},r))))),this.el)})}else this.isRendered&&(this.isRendered=!1,ga(null,this.el),this.setClassNames([]),this.setHeight(""))},II(e),this.el=e,this.renderRunner=new So(this.handleRenderRequest),new Db({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){lu(()=>{super.updateSize()})}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!Kn(e,this.currentClassNames)){let{classList:t}=this.el;for(let r of this.currentClassNames)t.remove(r);for(let r of e)t.add(r);this.currentClassNames=e}}setHeight(e){Rw(this.el,"height",e)}};var _n=Ee(wn());var Ib=class extends Qt{constructor(){super(...arguments),this.headerElRef=xt()}renderSimpleLayout(e,t){let{props:r,context:s}=this,i=[],a=Ho(s.options);return e&&i.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),i.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),k(Ss,{elClasses:["fc-daygrid"],viewSpec:s.viewSpec},k(ba,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[],sections:i}))}renderHScrollLayout(e,t,r,s){let i=this.context.pluginHooks.scrollGridImpl;if(!i)throw new Error("No ScrollGrid implementation");let{props:a,context:o}=this,l=!a.forPrint&&Ho(o.options),c=!a.forPrint&&Ou(o.options),d=[];return e&&d.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),c&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:Ec}]}),k(Ss,{elClasses:["fc-daygrid"],viewSpec:o.viewSpec},k(i,{liquid:!a.isHeightAuto&&!a.forPrint,forPrint:a.forPrint,collapsibleWidth:a.forPrint,colGroups:[{cols:[{span:r,minWidth:s}]}],sections:d}))}};function yg(n,e){let t=[];for(let r=0;r<e;r+=1)t[r]=[];for(let r of n)t[r.row].push(r);return t}function gg(n,e){let t=[];for(let r=0;r<e;r+=1)t[r]=[];for(let r of n)t[r.firstCol].push(r);return t}function WR(n,e){let t=[];if(n){for(let r=0;r<e;r+=1)t[r]={affectedInstances:n.affectedInstances,isEvent:n.isEvent,segs:[]};for(let r of n.segs)t[r.row].segs.push(r)}else for(let r=0;r<e;r+=1)t[r]=null;return t}var VR=Ye({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function $R(n){let{display:e}=n.eventRange.ui;return e==="list-item"||e==="auto"&&!n.eventRange.def.allDay&&n.firstCol===n.lastCol&&n.isStart&&n.isEnd}var vg=class extends Ie{render(){let{props:e}=this;return k(ka,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:VR,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}},Tg=class extends Ie{render(){let{props:e,context:t}=this,{options:r}=t,{seg:s}=e,i=r.eventTimeFormat||VR,a=xa(s,i,t,!0,e.defaultDisplayEventEnd);return k(Oi,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:wc(e.seg,t),defaultGenerator:tY,timeText:a,isResizing:!1,isDateSelecting:!1}))}};function tY(n){return k($e,null,k("div",{className:"fc-daygrid-event-dot",style:{borderColor:n.borderColor||n.backgroundColor}}),n.timeText&&k("div",{className:"fc-event-time"},n.timeText),k("div",{className:"fc-event-title"},n.event.title||k($e,null,"\xA0")))}var Rb=class extends Ie{constructor(){super(...arguments),this.compileSegs=le(rY)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:r}=this.compileSegs(e.singlePlacements);return k(No,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:r,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let s=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return k($e,null,t.map(i=>{let a=i.eventRange.instance.instanceId;return k("div",{className:"fc-daygrid-event-harness",key:a,style:{visibility:s[a]?"hidden":""}},$R(i)?k(Tg,Object.assign({seg:i,isDragging:!1,isSelected:a===e.eventSelection,defaultDisplayEventEnd:!1},xs(i,e.todayRange))):k(vg,Object.assign({seg:i,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:a===e.eventSelection,defaultDisplayEventEnd:!1},xs(i,e.todayRange))))}))}})}};function rY(n){let e=[],t=[];for(let r of n)e.push(r.seg),r.isVisible||t.push(r.seg);return{allSegs:e,invisibleSegs:t}}var sY=Ye({week:"narrow"}),Nb=class extends Qt{constructor(){super(...arguments),this.rootElRef=xt(),this.state={dayNumberId:is()},this.handleRootEl=e=>{Ds(this.rootElRef,e),Ds(this.props.elRef,e)}}render(){let{context:e,props:t,state:r,rootElRef:s}=this,{options:i,dateEnv:a}=e,{date:o,dateProfile:l}=t,c=t.showDayNumber&&iY(o,l.currentRange,a);return k(Ea,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":r.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:nY,date:o,dateProfile:l,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:c,extraRenderProps:t.extraRenderProps},(d,u)=>k("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&k(Hu,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:ei(e,o,"week"),date:o,defaultFormat:sY}),!u.isDisabled&&(t.showDayNumber||Sc(i)||t.forceDayTop)?k("div",{className:"fc-daygrid-day-top"},k(d,{elTag:"a",elClasses:["fc-daygrid-day-number",c&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},ei(e,o)),{id:r.dayNumberId})})):t.showDayNumber?k("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},k("a",{className:"fc-daygrid-day-number"},"\xA0")):void 0,k("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,k("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},k(Rb,{allDayDate:o,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:s,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),k("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}};function nY(n){return n.dayNumberText||k($e,null,"\xA0")}function iY(n,e,t){let{start:r,end:s}=e,i=zn(s,-1),a=t.getYear(r),o=t.getMonth(r),l=t.getYear(i),c=t.getMonth(i);return!(a===l&&o===c)&&(n.valueOf()===r.valueOf()||t.getDay(n)===1&&n.valueOf()<s.valueOf())}function YR(n){return n.eventRange.instance.instanceId+":"+n.firstCol}function zR(n){return YR(n)+":"+n.lastCol}function aY(n,e,t,r,s,i,a){let o=new Ob(y=>{let T=n[y.index].eventRange.instance.instanceId+":"+y.span.start+":"+(y.span.end-1);return s[T]||1});o.allowReslicing=!0,o.strictOrder=r,e===!0||t===!0?(o.maxCoord=i,o.hiddenConsumes=!0):typeof e=="number"?o.maxStackCnt=e:typeof t=="number"&&(o.maxStackCnt=t,o.hiddenConsumes=!0);let l=[],c=[];for(let y=0;y<n.length;y+=1){let T=n[y],w=zR(T);s[w]!=null?l.push({index:y,span:{start:T.firstCol,end:T.lastCol+1}}):c.push(T)}let d=o.addSegs(l),u=o.toRects(),{singleColPlacements:f,multiColPlacements:h,leftoverMargins:p}=oY(u,n,a),m=[],g=[];for(let y of c){h[y.firstCol].push({seg:y,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let T=y.firstCol;T<=y.lastCol;T+=1)f[T].push({seg:Dc(y,T,T+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let y=0;y<a.length;y+=1)m.push(0);for(let y of d){let T=n[y.index],w=y.span;h[w.start].push({seg:Dc(T,w.start,w.end,a),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let b=w.start;b<w.end;b+=1)m[b]+=1,f[b].push({seg:Dc(T,b,b+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let y=0;y<a.length;y+=1)g.push(p[y]);return{singleColPlacements:f,multiColPlacements:h,moreCnts:m,moreMarginTops:g}}function oY(n,e,t){let r=lY(n,t.length),s=[],i=[],a=[];for(let o=0;o<t.length;o+=1){let l=r[o],c=[],d=0,u=0;for(let h of l){let p=e[h.index];c.push({seg:Dc(p,o,o+1,t),isVisible:!0,isAbsolute:!1,absoluteTop:h.levelCoord,marginTop:h.levelCoord-d}),d=h.levelCoord+h.thickness}let f=[];d=0,u=0;for(let h of l){let p=e[h.index],m=h.span.end-h.span.start>1,g=h.span.start===o;u+=h.levelCoord-d,d=h.levelCoord+h.thickness,m?(u+=h.thickness,g&&f.push({seg:Dc(p,h.span.start,h.span.end,t),isVisible:!0,isAbsolute:!0,absoluteTop:h.levelCoord,marginTop:0})):g&&(f.push({seg:Dc(p,h.span.start,h.span.end,t),isVisible:!0,isAbsolute:!1,absoluteTop:h.levelCoord,marginTop:u}),u=0)}s.push(c),i.push(f),a.push(u)}return{singleColPlacements:s,multiColPlacements:i,leftoverMargins:a}}function lY(n,e){let t=[];for(let r=0;r<e;r+=1)t.push([]);for(let r of n)for(let s=r.span.start;s<r.span.end;s+=1)t[s].push(r);return t}function Dc(n,e,t,r){if(n.firstCol===e&&n.lastCol===t-1)return n;let s=n.eventRange,i=s.range,a=Wr(i,{start:r[e].date,end:kt(r[t-1].date,1)});return Object.assign(Object.assign({},n),{firstCol:e,lastCol:t-1,eventRange:{def:s.def,ui:Object.assign(Object.assign({},s.ui),{durationEditable:!1}),instance:s.instance,range:a},isStart:n.isStart&&a.start.valueOf()===i.start.valueOf(),isEnd:n.isEnd&&a.end.valueOf()===i.end.valueOf()})}var Ob=class extends Po{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){let t=super.addSegs(e),{entriesByLevel:r}=this,s=i=>!this.forceHidden[Gn(i)];for(let i=0;i<r.length;i+=1)r[i]=r[i].filter(s);return t}handleInvalidInsertion(e,t,r){let{entriesByLevel:s,forceHidden:i}=this,{touchingEntry:a,touchingLevel:o,touchingLateral:l}=e;if(this.hiddenConsumes&&a){let c=Gn(a);if(!i[c])if(this.allowReslicing){let d=Object.assign(Object.assign({},a),{span:Iu(a.span,t.span)}),u=Gn(d);i[u]=!0,s[o][l]=d,r.push(d),this.splitEntry(a,t,r)}else i[c]=!0,r.push(a)}super.handleInvalidInsertion(e,t,r)}},wg=class extends Qt{constructor(){super(...arguments),this.cellElRefs=new ns,this.frameElRefs=new ns,this.fgElRefs=new ns,this.segHarnessRefs=new ns,this.rootElRef=xt(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:r}=this,{options:s}=r,i=e.cells.length,a=gg(e.businessHourSegs,i),o=gg(e.bgEventSegs,i),l=gg(this.getHighlightSegs(),i),c=gg(this.getMirrorSegs(),i),{singleColPlacements:d,multiColPlacements:u,moreCnts:f,moreMarginTops:h}=aY(Lo(e.fgEventSegs,s.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,s.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),p=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return k("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((m,g)=>{let y=this.renderFgSegs(g,e.forPrint?d[g]:u[g],e.todayRange,p),T=this.renderFgSegs(g,cY(c[g],u),e.todayRange,{},!!e.eventDrag,!!e.eventResize,!1);return k(Nb,{key:m.key,elRef:this.cellElRefs.createRef(m.key),innerElRef:this.frameElRefs.createRef(m.key),dateProfile:e.dateProfile,date:m.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&g===0,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:m.extraRenderProps,extraDataAttrs:m.extraDataAttrs,extraClassNames:m.extraClassNames,extraDateSpan:m.extraDateSpan,moreCnt:f[g],moreMarginTop:h[g],singlePlacements:d[g],fgContentElRef:this.fgElRefs.createRef(m.key),fgContent:k($e,null,k($e,null,y),k($e,null,T)),bgContent:k($e,null,this.renderFillSegs(l[g],"highlight"),this.renderFillSegs(a[g],"non-business"),this.renderFillSegs(o[g],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let r=this.props;this.updateSizing(!Ar(e,r))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,r,s,i,a,o){let{context:l}=this,{eventSelection:c}=this.props,{framePositions:d}=this.state,u=this.props.cells.length===1,f=i||a||o,h=[];if(d)for(let p of t){let{seg:m}=p,{instanceId:g}=m.eventRange.instance,y=p.isVisible&&!s[g],T=p.isAbsolute,w="",b="";T&&(l.isRtl?(b=0,w=d.lefts[m.lastCol]-d.lefts[m.firstCol]):(w=0,b=d.rights[m.firstCol]-d.rights[m.lastCol])),h.push(k("div",{className:"fc-daygrid-event-harness"+(T?" fc-daygrid-event-harness-abs":""),key:YR(m),ref:f?null:this.segHarnessRefs.createRef(zR(m)),style:{visibility:y?"":"hidden",marginTop:T?"":p.marginTop,top:T?p.absoluteTop:"",left:w,right:b}},$R(m)?k(Tg,Object.assign({seg:m,isDragging:i,isSelected:g===c,defaultDisplayEventEnd:u},xs(m,r))):k(vg,Object.assign({seg:m,isDragging:i,isResizing:a,isDateSelecting:o,isSelected:g===c,defaultDisplayEventEnd:u},xs(m,r)))))}return h}renderFillSegs(e,t){let{isRtl:r}=this.context,{todayRange:s}=this.props,{framePositions:i}=this.state,a=[];if(i)for(let o of e){let l=r?{right:0,left:i.lefts[o.lastCol]-i.lefts[o.firstCol]}:{left:0,right:i.rights[o.firstCol]-i.rights[o.lastCol]};a.push(k("div",{key:Mu(o.eventRange),className:"fc-daygrid-bg-harness",style:l},t==="bg-event"?k(Ro,Object.assign({seg:o},xs(o,s))):Fu(t)))}return k($e,{},...a)}updateSizing(e){let{props:t,state:r,frameElRefs:s}=this;if(!t.forPrint&&t.clientWidth!==null){if(e){let l=t.cells.map(c=>s.currentMap[c.key]);if(l.length){let c=this.rootElRef.current,d=new Dn(c,l,!0,!1);(!r.framePositions||!r.framePositions.similarTo(d))&&this.setState({framePositions:new Dn(c,l,!0,!1)})}}let i=this.state.segHeights,a=this.querySegHeights(),o=t.dayMaxEvents===!0||t.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},i),a),maxContentHeight:o?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let r in e){let s=Math.round(e[r].getBoundingClientRect().height);t[r]=Math.max(t[r]||0,s)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],r=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-r.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}};wg.addStateEquality({segHeights:Ar});function cY(n,e){if(!n.length)return[];let t=dY(e);return n.map(r=>({seg:r,isVisible:!0,isAbsolute:!0,absoluteTop:t[r.eventRange.instance.instanceId],marginTop:0}))}function dY(n){let e={};for(let t of n)for(let r of t)e[r.seg.eventRange.instance.instanceId]=r.absoluteTop;return e}var Bu=class extends Qt{constructor(){super(...arguments),this.splitBusinessHourSegs=le(yg),this.splitBgEventSegs=le(uY),this.splitFgEventSegs=le(yg),this.splitDateSelectionSegs=le(yg),this.splitEventDrag=le(WR),this.splitEventResize=le(WR),this.rowRefs=new ns}render(){let{props:e,context:t}=this,r=e.cells.length,s=this.splitBusinessHourSegs(e.businessHourSegs,r),i=this.splitBgEventSegs(e.bgEventSegs,r),a=this.splitFgEventSegs(e.fgEventSegs,r),o=this.splitDateSelectionSegs(e.dateSelectionSegs,r),l=this.splitEventDrag(e.eventDrag,r),c=this.splitEventResize(e.eventResize,r),d=r>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return k(ss,{unit:"day"},(u,f)=>k($e,null,e.cells.map((h,p)=>k(wg,{ref:this.rowRefs.createRef(p),key:h.length?h[0].date.toISOString():p,showDayNumbers:r>1,showWeekNumbers:e.showWeekNumbers,todayRange:f,dateProfile:e.dateProfile,cells:h,renderIntro:e.renderRowIntro,businessHourSegs:s[p],eventSelection:e.eventSelection,bgEventSegs:i[p],fgEventSegs:a[p],dateSelectionSegs:o[p],eventDrag:l[p],eventResize:c[p],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:d,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){let e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new Dn(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new Dn(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:r,rowPositions:s}=this,i=r.leftToIndex(e),a=s.topToIndex(t);if(a!=null&&i!=null){let o=this.props.cells[a][i];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(a,i),allDay:!0},o.extraDateSpan),dayEl:this.getCellEl(a,i),rect:{left:r.lefts[i],right:r.rights[i],top:s.tops[a],bottom:s.bottoms[a]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let r=this.props.cells[e][t].date,s=kt(r,1);return{start:r,end:s}}};function uY(n,e){return yg(n.filter(hY),e)}function hY(n){return n.eventRange.def.allDay}var Lb=class extends Qt{constructor(){super(...arguments),this.elRef=xt(),this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:r,expandRows:s}=e,i=r===!0||t===!0;i&&!s&&(i=!1,t=null,r=null);let a=["fc-daygrid-body",i?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",s?"":"fc-daygrid-body-natural"];return k("div",{ref:this.elRef,className:a.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},k("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:s?e.clientHeight:""}},e.colGroupNode,k("tbody",{role:"presentation"},k(Bu,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:r,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){let e=fY(this.elRef.current,this.props.dateProfile);if(e){let t=e.closest(".fc-daygrid-body"),r=t.closest(".fc-scroller"),s=e.getBoundingClientRect().top-t.getBoundingClientRect().top;r.scrollTop=s?s+1:0}this.needsScrollReset=!1}}};function fY(n,e){let t;return e.currentRangeUnit.match(/year|month/)&&(t=n.querySelector(`[data-date="${mc(e.currentDate)}-01"]`)),t||(t=n.querySelector(`[data-date="${Sa(e.currentDate)}"]`)),t}var Uu=class extends Io{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}},ju=class extends Qt{constructor(){super(...arguments),this.slicer=new Uu,this.tableRef=xt()}render(){let{props:e,context:t}=this;return k(Lb,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}},bg=class extends Ib{constructor(){super(...arguments),this.buildDayTableModel=le(Fb),this.headerRef=xt(),this.tableRef=xt()}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:r}=this,s=this.buildDayTableModel(r.dateProfile,t),i=e.dayHeaders&&k(Ni,{ref:this.headerRef,dateProfile:r.dateProfile,dates:s.headerDates,datesRepDistinctDays:s.rowCnt===1}),a=o=>k(ju,{ref:this.tableRef,dateProfile:r.dateProfile,dayTableModel:s,businessHours:r.businessHours,dateSelection:r.dateSelection,eventStore:r.eventStore,eventUiBases:r.eventUiBases,eventSelection:r.eventSelection,eventDrag:r.eventDrag,eventResize:r.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:o.tableColGroupNode,tableMinWidth:o.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!r.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:o.clientWidth,clientHeight:o.clientHeight,forPrint:r.forPrint});return e.dayMinWidth?this.renderHScrollLayout(i,a,s.colCnt,e.dayMinWidth):this.renderSimpleLayout(i,a)}};function Fb(n,e){let t=new _o(n.renderRange,e);return new Ao(t,/year|month|week/.test(n.currentRangeUnit))}var xc=class extends Do{buildRenderRange(e,t,r){let s=super.buildRenderRange(e,t,r),{props:i}=this;return Hb({currentRange:s,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:i.fixedWeekCount,dateEnv:i.dateEnv})}};function Hb(n){let{dateEnv:e,currentRange:t}=n,{start:r,end:s}=t,i;if(n.snapToWeek&&(r=e.startOfWeek(r),i=e.startOfWeek(s),i.valueOf()!==s.valueOf()&&(s=eg(i,1))),n.fixedWeekCount){let a=e.startOfWeek(e.startOfMonth(kt(t.end,-1))),o=Math.ceil(Ww(a,s));s=eg(s,6-o)}return{start:r,end:s}}var pY=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';Qn(pY);var qR=Ir({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:bg,dateProfileGeneratorClass:xc},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});var Ub=class extends pu{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?ob(e)?["timed","allDay"]:["allDay"]:["timed"]}},mY=Ye({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function XR(n){let e=["fc-timegrid-slot","fc-timegrid-slot-label",n.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return k(en.Consumer,null,t=>{if(!n.isLabeled)return k("td",{className:e.join(" "),"data-time":n.isoTimeStr});let{dateEnv:r,options:s,viewApi:i}=t,a=s.slotLabelFormat==null?mY:Array.isArray(s.slotLabelFormat)?Ye(s.slotLabelFormat[0]):Ye(s.slotLabelFormat),o={level:0,time:n.time,date:r.toDate(n.date),view:i,text:r.format(n.date,a)};return k(It,{elTag:"td",elClasses:e,elAttrs:{"data-time":n.isoTimeStr},renderProps:o,generatorName:"slotLabelContent",customGenerator:s.slotLabelContent,defaultGenerator:gY,classNameGenerator:s.slotLabelClassNames,didMount:s.slotLabelDidMount,willUnmount:s.slotLabelWillUnmount},l=>k("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},k(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function gY(n){return n.text}var jb=class extends Ie{render(){return this.props.slatMetas.map(e=>k("tr",{key:e.key},k(XR,Object.assign({},e))))}},yY=Ye({week:"short"}),vY=5,Wb=class extends Qt{constructor(){super(...arguments),this.allDaySplitter=new Ub,this.headerElRef=xt(),this.rootElRef=xt(),this.scrollerElRef=xt(),this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:r}=this.context,{dateProfile:s}=this.props,i=s.renderRange,o=Zn(i.start,i.end)===1?ei(this.context,i.start,"week"):{};return r.weekNumbers&&e==="day"?k(Hu,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:i.start,defaultFormat:yY},l=>k("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},k(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:o}))):k("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},k("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:r}=this.context,s={text:t.allDayText,view:r};return k(It,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:s,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:TY,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},i=>k("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",e==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},k(i,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,r){let{context:s,props:i}=this,a=[],o=Ho(s.options);return e&&a.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(a.push({type:"body",key:"all-day",chunk:{content:t}}),a.push({type:"body",key:"all-day-divider",outerContent:k("tr",{role:"presentation",className:"fc-scrollgrid-section"},k("td",{className:"fc-timegrid-divider "+s.theme.getClass("tableCellShaded")}))})),a.push({type:"body",key:"body",liquid:!0,expandRows:!!s.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:r}}),k(Ss,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:s.viewSpec},k(ba,{liquid:!i.isHeightAuto&&!i.forPrint,collapsibleWidth:i.forPrint,cols:[{width:"shrink"}],sections:a}))}renderHScrollLayout(e,t,r,s,i,a,o){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:c,props:d}=this,u=!d.forPrint&&Ho(c.options),f=!d.forPrint&&Ou(c.options),h=[];e&&h.push({type:"header",key:"header",isSticky:u,syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>k("tr",{role:"presentation"},this.renderHeadAxis("day",m.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(h.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>k("tr",{role:"presentation"},this.renderTableRowAxis(m.rowSyncHeights[0]))},{key:"cols",content:t}]}),h.push({key:"all-day-divider",type:"body",outerContent:k("tr",{role:"presentation",className:"fc-scrollgrid-section"},k("td",{colSpan:2,className:"fc-timegrid-divider "+c.theme.getClass("tableCellShaded")}))}));let p=c.options.nowIndicator;return h.push({type:"body",key:"body",liquid:!0,expandRows:!!c.options.expandRows,chunks:[{key:"axis",content:m=>k("div",{className:"fc-timegrid-axis-chunk"},k("table",{"aria-hidden":!0,style:{height:m.expandRows?m.clientHeight:""}},m.tableColGroupNode,k("tbody",null,k(jb,{slatMetas:a}))),k("div",{className:"fc-timegrid-now-indicator-container"},k(ss,{unit:p?"minute":"day"},g=>{let y=p&&o&&o.safeComputeTop(g);return typeof y=="number"?k(Lu,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:y},isAxis:!0,date:g}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:r}]}),f&&h.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:Ec},{key:"cols",content:Ec}]}),k(Ss,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:c.viewSpec},k(l,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:s,minWidth:i}]}],sections:h}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return(e===!0||t===!0)&&(e=void 0,t=vY),{dayMaxEvents:e,dayMaxEventRows:t}}};function TY(n){return n.text}var Vb=class{constructor(e,t,r){this.positions=e,this.dateProfile=t,this.slotDuration=r}safeComputeTop(e){let{dateProfile:t}=this;if(Xs(t.currentRange,e)){let r=tt(e),s=e.valueOf()-r.valueOf();if(s>=Es(t.slotMinTime)&&s<Es(t.slotMaxTime))return this.computeTimeTop(De(s))}return null}computeDateTop(e,t){return t||(t=tt(e)),this.computeTimeTop(De(e.valueOf()-t.valueOf()))}computeTimeTop(e){let{positions:t,dateProfile:r}=this,s=t.els.length,i=(e.milliseconds-Es(r.slotMinTime))/Es(this.slotDuration),a,o;return i=Math.max(0,i),i=Math.min(s,i),a=Math.floor(i),a=Math.min(a,s-1),o=i-a,t.tops[a]+t.getHeight(a)*o}},$b=class extends Ie{render(){let{props:e,context:t}=this,{options:r}=t,{slatElRefs:s}=e;return k("tbody",null,e.slatMetas.map((i,a)=>{let o={time:i.time,date:t.dateEnv.toDate(i.date),view:t.viewApi};return k("tr",{key:i.key,ref:s.createRef(i.key)},e.axis&&k(XR,Object.assign({},i)),k(It,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!i.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":i.isoTimeStr},renderProps:o,generatorName:"slotLaneContent",customGenerator:r.slotLaneContent,classNameGenerator:r.slotLaneClassNames,didMount:r.slotLaneDidMount,willUnmount:r.slotLaneWillUnmount}))}))}},Yb=class extends Ie{constructor(){super(...arguments),this.rootElRef=xt(),this.slatElRefs=new ns}render(){let{props:e,context:t}=this;return k("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},k("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,k($b,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;t.onCoords&&t.clientWidth!==null&&this.rootElRef.current.offsetHeight&&t.onCoords(new Vb(new Dn(this.rootElRef.current,wY(this.slatElRefs.currentMap,t.slatMetas),!1,!0),this.props.dateProfile,e.options.slotDuration))}};function wY(n,e){return e.map(t=>n[t.key])}function Wu(n,e){let t=[],r;for(r=0;r<e;r+=1)t.push([]);if(n)for(r=0;r<n.length;r+=1)t[n[r].col].push(n[r]);return t}function GR(n,e){let t=[];if(n){for(let r=0;r<e;r+=1)t[r]={affectedInstances:n.affectedInstances,isEvent:n.isEvent,segs:[]};for(let r of n.segs)t[r.col].segs.push(r)}else for(let r=0;r<e;r+=1)t[r]=null;return t}var zb=class extends Ie{render(){let{props:e}=this;return k(No,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>JR(e.hiddenSegs,e),defaultGenerator:bY,forceTimed:!0},t=>k(t,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}};function bY(n){return n.shortText}function kY(n,e,t){let r=new Po;e!=null&&(r.strictOrder=e),t!=null&&(r.maxStackCnt=t);let s=r.addSegs(n),i=vb(s),a=EY(r);return a=CY(a,1),{segRects:MY(a),hiddenGroups:i}}function EY(n){let{entriesByLevel:e}=n,t=Xb((r,s)=>r+":"+s,(r,s)=>{let i=xY(n,r,s),a=QR(i,t),o=e[r][s];return[Object.assign(Object.assign({},o),{nextLevelNodes:a[0]}),o.thickness+a[1]]});return QR(e.length?{level:0,lateralStart:0,lateralEnd:e[0].length}:null,t)[0]}function QR(n,e){if(!n)return[[],0];let{level:t,lateralStart:r,lateralEnd:s}=n,i=r,a=[];for(;i<s;)a.push(e(t,i)),i+=1;return a.sort(SY),[a.map(DY),a[0][1]]}function SY(n,e){return e[1]-n[1]}function DY(n){return n[0]}function xY(n,e,t){let{levelCoords:r,entriesByLevel:s}=n,i=s[e][t],a=r[e]+i.thickness,o=r.length,l=e;for(;l<o&&r[l]<a;l+=1);for(;l<o;l+=1){let c=s[l],d,u=vu(c,i.span.start,yu),f=u[0]+u[1],h=f;for(;(d=c[h])&&d.span.start<i.span.end;)h+=1;if(f<h)return{level:l,lateralStart:f,lateralEnd:h}}return null}function CY(n,e){let t=Xb((r,s,i)=>Gn(r),(r,s,i)=>{let{nextLevelNodes:a,thickness:o}=r,l=o+i,c=o/l,d,u=[];if(!a.length)d=e;else for(let h of a)if(d===void 0){let p=t(h,s,l);d=p[0],u.push(p[1])}else{let p=t(h,d,0);u.push(p[1])}let f=(d-s)*c;return[d-f,Object.assign(Object.assign({},r),{thickness:f,nextLevelNodes:u})]});return n.map(r=>t(r,0,0)[1])}function MY(n){let e=[],t=Xb((s,i,a)=>Gn(s),(s,i,a)=>{let o=Object.assign(Object.assign({},s),{levelCoord:i,stackDepth:a,stackForward:0});return e.push(o),o.stackForward=r(s.nextLevelNodes,i+s.thickness,a+1)+1});function r(s,i,a){let o=0;for(let l of s)o=Math.max(t(l,i,a),o);return o}return r(n,0,0),e}function Xb(n,e){let t={};return(...r)=>{let s=n(...r);return s in t?t[s]:t[s]=e(...r)}}function KR(n,e,t=null,r=0){let s=[];if(t)for(let i=0;i<n.length;i+=1){let a=n[i],o=t.computeDateTop(a.start,e),l=Math.max(o+(r||0),t.computeDateTop(a.end,e));s.push({start:Math.round(o),end:Math.round(l)})}return s}function PY(n,e,t,r){let s=[],i=[];for(let c=0;c<n.length;c+=1){let d=e[c];d?s.push({index:c,thickness:1,span:d}):i.push(n[c])}let{segRects:a,hiddenGroups:o}=kY(s,t,r),l=[];for(let c of a)l.push({seg:n[c.index],rect:c});for(let c of i)l.push({seg:c,rect:null});return{segPlacements:l,hiddenGroups:o}}var _Y=Ye({hour:"numeric",minute:"2-digit",meridiem:!1}),kg=class extends Ie{render(){return k(ka,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:_Y}))}},qb=class extends Ie{constructor(){super(...arguments),this.sortEventSegs=le(Lo)}render(){let{props:e,context:t}=this,{options:r}=t,s=r.selectMirror,i=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||s&&e.dateSelectionSegs||[],a=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},o=this.sortEventSegs(e.fgEventSegs,r.eventOrder);return k(Ea,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},l=>k("div",{className:"fc-timegrid-col-frame"},k("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),k("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(o,a,!1,!1,!1)),k("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(i,{},!!e.eventDrag,!!e.eventResize,!!s,"mirror")),k("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),Sc(r)&&k(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,r,s,i,a){let{props:o}=this;return o.forPrint?JR(e,o):this.renderPositionedFgSegs(e,t,r,s,i,a)}renderPositionedFgSegs(e,t,r,s,i,a){let{eventMaxStack:o,eventShortHeight:l,eventOrderStrict:c,eventMinHeight:d}=this.context.options,{date:u,slatCoords:f,eventSelection:h,todayRange:p,nowDate:m}=this.props,g=r||s||i,y=KR(e,u,f,d),{segPlacements:T,hiddenGroups:w}=PY(e,y,c,o);return k($e,null,this.renderHiddenGroups(w,e),T.map(b=>{let{seg:E,rect:S}=b,D=E.eventRange.instance.instanceId,x=g||!!(!t[D]&&S),M=Bb(S&&S.span),B=!g&&S?this.computeSegHStyle(S):{left:0,right:0},Q=!!S&&S.stackForward>0,P=!!S&&S.span.end-S.span.start<l;return k("div",{className:"fc-timegrid-event-harness"+(Q?" fc-timegrid-event-harness-inset":""),key:a||D,style:Object.assign(Object.assign({visibility:x?"":"hidden"},M),B)},k(kg,Object.assign({seg:E,isDragging:r,isResizing:s,isDateSelecting:i,isSelected:D===h,isShort:P},xs(E,p,m))))}))}renderHiddenGroups(e,t){let{extraDateSpan:r,dateProfile:s,todayRange:i,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c}=this.props;return k($e,null,e.map(d=>{let u=Bb(d.span),f=AY(d.entries,t);return k(zb,{key:tg(hg(f)),hiddenSegs:f,top:u.top,bottom:u.bottom,extraDateSpan:r,dateProfile:s,todayRange:i,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c})}))}renderFillSegs(e,t){let{props:r,context:s}=this,a=KR(e,r.date,r.slatCoords,s.options.eventMinHeight).map((o,l)=>{let c=e[l];return k("div",{key:Mu(c.eventRange),className:"fc-timegrid-bg-harness",style:Bb(o)},t==="bg-event"?k(Ro,Object.assign({seg:c},xs(c,r.todayRange,r.nowDate))):Fu(t))});return k($e,null,a)}renderNowIndicator(e){let{slatCoords:t,date:r}=this.props;return t?e.map((s,i)=>k(Lu,{key:i,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(s.start,r)},isAxis:!1,date:r})):null}computeSegHStyle(e){let{isRtl:t,options:r}=this.context,s=r.slotEventOverlap,i=e.levelCoord,a=e.levelCoord+e.thickness,o,l;s&&(a=Math.min(1,i+(a-i)*2)),t?(o=1-a,l=i):(o=i,l=1-a);let c={zIndex:e.stackDepth+1,left:o*100+"%",right:l*100+"%"};return s&&!e.stackForward&&(c[t?"marginLeft":"marginRight"]=20),c}};function JR(n,{todayRange:e,nowDate:t,eventSelection:r,eventDrag:s,eventResize:i}){let a=(s?s.affectedInstances:null)||(i?i.affectedInstances:null)||{};return k($e,null,n.map(o=>{let l=o.eventRange.instance.instanceId;return k("div",{key:l,style:{visibility:a[l]?"hidden":""}},k(kg,Object.assign({seg:o,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===r,isShort:!1},xs(o,e,t))))}))}function Bb(n){return n?{top:n.start,bottom:-n.end}:{top:"",bottom:""}}function AY(n,e){return n.map(t=>e[t.index])}var Gb=class extends Ie{constructor(){super(...arguments),this.splitFgEventSegs=le(Wu),this.splitBgEventSegs=le(Wu),this.splitBusinessHourSegs=le(Wu),this.splitNowIndicatorSegs=le(Wu),this.splitDateSelectionSegs=le(Wu),this.splitEventDrag=le(GR),this.splitEventResize=le(GR),this.rootElRef=xt(),this.cellElRefs=new ns}render(){let{props:e,context:t}=this,r=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),s=e.cells.length,i=this.splitFgEventSegs(e.fgEventSegs,s),a=this.splitBgEventSegs(e.bgEventSegs,s),o=this.splitBusinessHourSegs(e.businessHourSegs,s),l=this.splitNowIndicatorSegs(e.nowIndicatorSegs,s),c=this.splitDateSelectionSegs(e.dateSelectionSegs,s),d=this.splitEventDrag(e.eventDrag,s),u=this.splitEventResize(e.eventResize,s);return k("div",{className:"fc-timegrid-cols",ref:this.rootElRef},k("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,k("tbody",{role:"presentation"},k("tr",{role:"row"},e.axis&&k("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},k("div",{className:"fc-timegrid-col-frame"},k("div",{className:"fc-timegrid-now-indicator-container"},typeof r=="number"&&k(Lu,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:r},isAxis:!0,date:e.nowDate})))),e.cells.map((f,h)=>k(qb,{key:f.key,elRef:this.cellElRefs.createRef(f.key),dateProfile:e.dateProfile,date:f.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:f.extraRenderProps,extraDataAttrs:f.extraDataAttrs,extraClassNames:f.extraClassNames,extraDateSpan:f.extraDateSpan,fgEventSegs:i[h],bgEventSegs:a[h],businessHourSegs:o[h],nowIndicatorSegs:l[h],dateSelectionSegs:c[h],eventDrag:d[h],eventResize:u[h],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;e.onColCoords&&e.clientWidth!==null&&e.onColCoords(new Dn(this.rootElRef.current,IY(this.cellElRefs.currentMap,e.cells),!0,!1))}};function IY(n,e){return e.map(t=>n[t.key])}var Qb=class extends Qt{constructor(){super(...arguments),this.processSlotOptions=le(RY),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:r}=this.state;if(t&&r){if(e.time){let s=r.computeTimeTop(e.time);s=Math.ceil(s),s&&(s+=1),t(s)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return k("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},k(Yb,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),k(Gb,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:r,options:s}=this.context,{colCoords:i}=this,{dateProfile:a}=this.props,{slatCoords:o}=this.state,{snapDuration:l,snapsPerSlot:c}=this.processSlotOptions(this.props.slotDuration,s.snapDuration),d=i.leftToIndex(e),u=o.positions.topToIndex(t);if(d!=null&&u!=null){let f=this.props.cells[d],h=o.positions.tops[u],p=o.positions.getHeight(u),m=(t-h)/p,g=Math.floor(m*c),y=u*c+g,T=this.props.cells[d].date,w=ku(a.slotMinTime,jw(l,y)),b=r.add(T,w),E=r.add(b,l);return{dateProfile:a,dateSpan:Object.assign({range:{start:b,end:E},allDay:!1},f.extraDateSpan),dayEl:i.els[d],rect:{left:i.lefts[d],right:i.rights[d],top:h,bottom:h+p},layer:0}}return null}};function RY(n,e){let t=e||n,r=Eu(n,t);return r===null&&(t=n,r=1),{snapDuration:t,snapsPerSlot:r}}var Kb=class extends Io{sliceRange(e,t){let r=[];for(let s=0;s<t.length;s+=1){let i=Wr(e,t[s]);i&&r.push({start:i.start,end:i.end,isStart:i.start.valueOf()===e.start.valueOf(),isEnd:i.end.valueOf()===e.end.valueOf(),col:s})}return r}},Zb=class extends Qt{constructor(){super(...arguments),this.buildDayRanges=le(NY),this.slicer=new Kb,this.timeColsRef=xt()}render(){let{props:e,context:t}=this,{dateProfile:r,dayTableModel:s}=e,{nowIndicator:i,nextDayThreshold:a}=t.options,o=this.buildDayRanges(s,r,t.dateEnv);return k(ss,{unit:i?"minute":"day"},(l,c)=>k(Qb,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,r,null,t,o),{forPrint:e.forPrint,axis:e.axis,dateProfile:r,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:s.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:l,nowIndicatorSegs:i&&this.slicer.sliceNowDate(l,r,a,t,o),todayRange:c,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}};function NY(n,e,t){let r=[];for(let s of n.headerDates)r.push({start:t.add(s,e.slotMinTime),end:t.add(s,e.slotMaxTime)});return r}var ZR=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function OY(n,e,t,r,s){let i=new Date(0),a=n,o=De(0),l=t||LY(r),c=[];for(;Es(a)<Es(e);){let d=s.add(i,a),u=Eu(o,l)!==null;c.push({date:d,time:a,key:d.toISOString(),isoTimeStr:$w(d),isLabeled:u}),a=ku(a,r),o=ku(o,r)}return c}function LY(n){let e,t,r;for(e=ZR.length-1;e>=0;e-=1)if(t=De(ZR[e]),r=Eu(t,n),r!==null&&r>1)return t;return n}var Eg=class extends Wb{constructor(){super(...arguments),this.buildTimeColsModel=le(FY),this.buildSlatMetas=le(OY)}render(){let{options:e,dateEnv:t,dateProfileGenerator:r}=this.context,{props:s}=this,{dateProfile:i}=s,a=this.buildTimeColsModel(i,r),o=this.allDaySplitter.splitProps(s),l=this.buildSlatMetas(i.slotMinTime,i.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:c}=e,d=!c,u=c,f=e.dayHeaders&&k(Ni,{dates:a.headerDates,dateProfile:i,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),h=e.allDaySlot!==!1&&(m=>k(ju,Object.assign({},o.allDay,{dateProfile:i,dayTableModel:a,nextDayThreshold:e.nextDayThreshold,tableMinWidth:m.tableMinWidth,colGroupNode:m.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:m.clientWidth,clientHeight:m.clientHeight,forPrint:s.forPrint},this.getAllDayMaxEventProps()))),p=m=>k(Zb,Object.assign({},o.timed,{dayTableModel:a,dateProfile:i,axis:d,slotDuration:e.slotDuration,slatMetas:l,forPrint:s.forPrint,tableColGroupNode:m.tableColGroupNode,tableMinWidth:m.tableMinWidth,clientWidth:m.clientWidth,clientHeight:m.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:m.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return u?this.renderHScrollLayout(f,h,p,a.colCnt,c,l,this.state.slatCoords):this.renderSimpleLayout(f,h,p)}};function FY(n,e){let t=new _o(n.renderRange,e);return new Ao(t,!1)}var HY='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';Qn(HY);var BY={allDaySlot:Boolean},eN=Ir({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:BY,views:{timeGrid:{component:Eg,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});var Jb=class extends Qt{constructor(){super(...arguments),this.buildDayTableModel=le(Fb),this.slicer=new Uu,this.state={labelId:is()}}render(){let{props:e,state:t,context:r}=this,{dateProfile:s,forPrint:i}=e,{options:a}=r,o=this.buildDayTableModel(s,r.dateProfileGenerator),l=this.slicer.sliceProps(e,s,a.nextDayThreshold,r,o),c=e.tableWidth!=null?e.tableWidth/a.aspectRatio:null,d=o.cells.length,u=c!=null?c/d:null;return k("div",{ref:e.elRef,"data-date":e.isoDateStr,className:"fc-multimonth-month",style:{width:e.width},role:"grid","aria-labelledby":t.labelId},k("div",{className:"fc-multimonth-header",style:{marginBottom:u},role:"presentation"},k("div",{className:"fc-multimonth-title",id:t.labelId},r.dateEnv.format(e.dateProfile.currentRange.start,e.titleFormat)),k("table",{className:["fc-multimonth-header-table",r.theme.getClass("table")].join(" "),role:"presentation"},k("thead",{role:"rowgroup"},k(Ni,{dateProfile:e.dateProfile,dates:o.headerDates,datesRepDistinctDays:!1})))),k("div",{className:["fc-multimonth-daygrid","fc-daygrid","fc-daygrid-body",!i&&"fc-daygrid-body-balanced",i&&"fc-daygrid-body-unbalanced",i&&"fc-daygrid-body-natural"].join(" "),style:{marginTop:-u}},k("table",{className:["fc-multimonth-daygrid-table",r.theme.getClass("table")].join(" "),style:{height:i?"":c},role:"presentation"},k("tbody",{role:"rowgroup"},k(Bu,Object.assign({},l,{dateProfile:s,cells:o.cells,eventSelection:e.eventSelection,dayMaxEvents:!i,dayMaxEventRows:!i,showWeekNumbers:a.weekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:i}))))))}},ek=class extends Qt{constructor(){super(...arguments),this.splitDateProfileByMonth=le(jY),this.buildMonthFormat=le($Y),this.scrollElRef=xt(),this.firstMonthElRef=xt(),this.needsScrollReset=!1,this.handleSizing=e=>{e&&this.updateSize()}}render(){let{context:e,props:t,state:r}=this,{options:s}=e,{clientWidth:i,clientHeight:a}=r,o=r.monthHPadding||0,l=Math.min(i!=null?Math.floor(i/(s.multiMonthMinWidth+o)):1,s.multiMonthMaxColumns)||1,c=100/l+"%",d=i==null?null:i/l-o,u=i!=null&&l===1,f=this.splitDateProfileByMonth(e.dateProfileGenerator,t.dateProfile,e.dateEnv,u?!1:s.fixedWeekCount,s.showNonCurrentDates),h=this.buildMonthFormat(s.multiMonthTitleFormat,f),p=["fc-multimonth",u?"fc-multimonth-singlecol":"fc-multimonth-multicol",d!=null&&d<400?"fc-multimonth-compact":"",t.isHeightAuto?"":"fc-scroller"];return k(Ss,{elRef:this.scrollElRef,elClasses:p,viewSpec:e.viewSpec},f.map((m,g)=>{let y=mc(m.currentRange.start);return k(Jb,Object.assign({},t,{key:y,isoDateStr:y,elRef:g===0?this.firstMonthElRef:void 0,titleFormat:h,dateProfile:m,width:c,tableWidth:d,clientWidth:i,clientHeight:a}))}))}componentDidMount(){this.updateSize(),this.context.addResizeHandler(this.handleSizing),this.requestScrollReset()}componentDidUpdate(e){Ar(e,this.props)||this.handleSizing(!1),e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}updateSize(){let e=this.scrollElRef.current,t=this.firstMonthElRef.current;e&&this.setState({clientWidth:e.clientWidth,clientHeight:e.clientHeight}),t&&e&&this.state.monthHPadding==null&&this.setState({monthHPadding:e.clientWidth-t.firstChild.offsetWidth})}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.state.monthHPadding!=null){let{currentDate:e}=this.props.dateProfile,t=this.scrollElRef.current,r=t.querySelector(`[data-date="${mc(e)}"]`);t.scrollTop=r.getBoundingClientRect().top-this.firstMonthElRef.current.getBoundingClientRect().top,this.needsScrollReset=!1}}shouldComponentUpdate(){return!0}},UY=De(1,"month");function jY(n,e,t,r,s){let{start:i,end:a}=e.currentRange,o=i,l=[];for(;o.valueOf()<a.valueOf();){let c=t.add(o,UY),d={start:n.skipHiddenDays(o),end:n.skipHiddenDays(c,-1,!0)},u=Hb({currentRange:d,snapToWeek:!0,fixedWeekCount:r,dateEnv:t});u={start:n.skipHiddenDays(u.start),end:n.skipHiddenDays(u.end,-1,!0)};let f=e.activeRange?Wr(e.activeRange,s?u:d):null;l.push({currentDate:e.currentDate,isValid:e.isValid,validRange:e.validRange,renderRange:u,activeRange:f,currentRange:d,currentRangeUnit:"month",isRangeAllDay:!0,dateIncrement:e.dateIncrement,slotMinTime:e.slotMaxTime,slotMaxTime:e.slotMinTime}),o=c}return l}var WY=Ye({year:"numeric",month:"long"}),VY=Ye({month:"long"});function $Y(n,e){return n||(e[0].currentRange.start.getUTCFullYear()!==e[e.length-1].currentRange.start.getUTCFullYear()?WY:VY)}var YY={multiMonthTitleFormat:Ye,multiMonthMaxColumns:Number,multiMonthMinWidth:Number},zY=".fc .fc-multimonth{border:1px solid var(--fc-border-color);display:flex;flex-wrap:wrap;overflow-x:hidden;overflow-y:auto}.fc .fc-multimonth-title{font-size:1.2em;font-weight:700;padding:1em 0;text-align:center}.fc .fc-multimonth-daygrid{background:var(--fc-page-bg-color)}.fc .fc-multimonth-daygrid-table,.fc .fc-multimonth-header-table{table-layout:fixed;width:100%}.fc .fc-multimonth-daygrid-table{border-top-style:hidden!important}.fc .fc-multimonth-singlecol .fc-multimonth{position:relative}.fc .fc-multimonth-singlecol .fc-multimonth-header{background:var(--fc-page-bg-color);position:relative;top:0;z-index:2}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid{position:relative;z-index:1}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid-table,.fc .fc-multimonth-singlecol .fc-multimonth-header-table{border-left-style:hidden;border-right-style:hidden}.fc .fc-multimonth-singlecol .fc-multimonth-month:last-child .fc-multimonth-daygrid-table{border-bottom-style:hidden}.fc .fc-multimonth-multicol{line-height:1}.fc .fc-multimonth-multicol .fc-multimonth-month{padding:0 1.2em 1.2em}.fc .fc-multimonth-multicol .fc-daygrid-more-link{border:1px solid var(--fc-event-border-color);display:block;float:none;padding:1px}.fc .fc-multimonth-compact{line-height:1}.fc .fc-multimonth-compact .fc-multimonth-daygrid-table,.fc .fc-multimonth-compact .fc-multimonth-header-table{font-size:.9em}.fc-media-screen .fc-multimonth-singlecol .fc-multimonth-header{position:sticky}.fc-media-print .fc-multimonth{overflow:visible}";Qn(zY);var tN=Ir({name:"@fullcalendar/multimonth",initialView:"multiMonthYear",optionRefiners:YY,views:{multiMonth:{component:ek,dateProfileGeneratorClass:xc,multiMonthMinWidth:350,multiMonthMaxColumns:3},multiMonthYear:{type:"multiMonth",duration:{years:1},fixedWeekCount:!0,showNonCurrentDates:!1}}});var tk=class extends Ie{constructor(){super(...arguments),this.state={textId:is()}}render(){let{theme:e,dateEnv:t,options:r,viewApi:s}=this.context,{cellId:i,dayDate:a,todayRange:o}=this.props,{textId:l}=this.state,c=_u(a,o),d=r.listDayFormat?t.format(a,r.listDayFormat):"",u=r.listDaySideFormat?t.format(a,r.listDaySideFormat):"",f=Object.assign({date:t.toDate(a),view:s,textId:l,text:d,sideText:u,navLinkAttrs:ei(this.context,a),sideNavLinkAttrs:ei(this.context,a,"day",!1)},c);return k(It,{elTag:"tr",elClasses:["fc-list-day",...bc(c,e)],elAttrs:{"data-date":Sa(a)},renderProps:f,generatorName:"dayHeaderContent",customGenerator:r.dayHeaderContent,defaultGenerator:qY,classNameGenerator:r.dayHeaderClassNames,didMount:r.dayHeaderDidMount,willUnmount:r.dayHeaderWillUnmount},h=>k("th",{scope:"colgroup",colSpan:3,id:i,"aria-labelledby":l},k(h,{elTag:"div",elClasses:["fc-list-day-cushion",e.getClass("tableCellShaded")]})))}};function qY(n){return k($e,null,n.text&&k("a",Object.assign({id:n.textId,className:"fc-list-day-text"},n.navLinkAttrs),n.text),n.sideText&&k("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},n.sideNavLinkAttrs),n.sideText))}var GY=Ye({hour:"numeric",minute:"2-digit",meridiem:"short"}),rk=class extends Ie{render(){let{props:e,context:t}=this,{options:r}=t,{seg:s,timeHeaderId:i,eventHeaderId:a,dateHeaderId:o}=e,l=r.eventTimeFormat||GY;return k(Oi,Object.assign({},e,{elTag:"tr",elClasses:["fc-list-event",s.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>QY(s,t),seg:s,timeText:"",disableDragging:!0,disableResizing:!0}),(c,d)=>k($e,null,KY(s,l,t,i,o),k("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},k("span",{className:"fc-list-event-dot",style:{borderColor:d.borderColor||d.backgroundColor}})),k(c,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${a} ${o}`}})))}};function QY(n,e){let t=wc(n,e);return k("a",Object.assign({},t),n.eventRange.def.title)}function KY(n,e,t,r,s){let{options:i}=t;if(i.displayEventTime!==!1){let a=n.eventRange.def,o=n.eventRange.instance,l=!1,c;if(a.allDay?l=!0:Jw(n.eventRange.range)?n.isStart?c=xa(n,e,t,null,null,o.range.start,n.end):n.isEnd?c=xa(n,e,t,null,null,n.start,o.range.end):l=!0:c=xa(n,e,t),l){let d={text:t.options.allDayText,view:t.viewApi};return k(It,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${r} ${s}`},renderProps:d,generatorName:"allDayContent",customGenerator:i.allDayContent,defaultGenerator:ZY,classNameGenerator:i.allDayClassNames,didMount:i.allDayDidMount,willUnmount:i.allDayWillUnmount})}return k("td",{className:"fc-list-event-time"},c)}return null}function ZY(n){return n.text}var Sg=class extends Qt{constructor(){super(...arguments),this.computeDateVars=le(JY),this.eventStoreToSegs=le(this._eventStoreToSegs),this.state={timeHeaderId:is(),eventHeaderId:is(),dateHeaderIdRoot:is()},this.setRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:e,context:t}=this,{dayDates:r,dayRanges:s}=this.computeDateVars(e.dateProfile),i=this.eventStoreToSegs(e.eventStore,e.eventUiBases,s);return k(Ss,{elRef:this.setRootEl,elClasses:["fc-list",t.theme.getClass("table"),t.options.stickyHeaderDates!==!1?"fc-list-sticky":""],viewSpec:t.viewSpec},k(uc,{liquid:!e.isHeightAuto,overflowX:e.isHeightAuto?"visible":"hidden",overflowY:e.isHeightAuto?"visible":"auto"},i.length>0?this.renderSegList(i,r):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:e,viewApi:t}=this.context,r={text:e.noEventsText,view:t};return k(It,{elTag:"div",elClasses:["fc-list-empty"],renderProps:r,generatorName:"noEventsContent",customGenerator:e.noEventsContent,defaultGenerator:XY,classNameGenerator:e.noEventsClassNames,didMount:e.noEventsDidMount,willUnmount:e.noEventsWillUnmount},s=>k(s,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(e,t){let{theme:r,options:s}=this.context,{timeHeaderId:i,eventHeaderId:a,dateHeaderIdRoot:o}=this.state,l=ez(e);return k(ss,{unit:"day"},(c,d)=>{let u=[];for(let f=0;f<l.length;f+=1){let h=l[f];if(h){let p=Sa(t[f]),m=o+"-"+p;u.push(k(tk,{key:p,cellId:m,dayDate:t[f],todayRange:d})),h=Lo(h,s.eventOrder);for(let g of h)u.push(k(rk,Object.assign({key:p+":"+g.eventRange.instance.instanceId,seg:g,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:i,eventHeaderId:a,dateHeaderId:m},xs(g,d,c))))}}return k("table",{className:"fc-list-table "+r.getClass("table")},k("thead",null,k("tr",null,k("th",{scope:"col",id:i},s.timeHint),k("th",{scope:"col","aria-hidden":!0}),k("th",{scope:"col",id:a},s.eventHint))),k("tbody",null,u))})}_eventStoreToSegs(e,t,r){return this.eventRangesToSegs(dc(e,t,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,r)}eventRangesToSegs(e,t){let r=[];for(let s of e)r.push(...this.eventRangeToSegs(s,t));return r}eventRangeToSegs(e,t){let{dateEnv:r}=this.context,{nextDayThreshold:s}=this.context.options,i=e.range,a=e.def.allDay,o,l,c,d=[];for(o=0;o<t.length;o+=1)if(l=Wr(i,t[o]),l&&(c={component:this,eventRange:e,start:l.start,end:l.end,isStart:e.isStart&&l.start.valueOf()===i.start.valueOf(),isEnd:e.isEnd&&l.end.valueOf()===i.end.valueOf(),dayIndex:o},d.push(c),!c.isEnd&&!a&&o+1<t.length&&i.end<r.add(t[o+1].start,s))){c.end=i.end,c.isEnd=!0;break}return d}};function XY(n){return n.text}function JY(n){let e=tt(n.renderRange.start),t=n.renderRange.end,r=[],s=[];for(;e<t;)r.push(e),s.push({start:e,end:kt(e,1)}),e=kt(e,1);return{dayDates:r,dayRanges:s}}function ez(n){let e=[],t,r;for(t=0;t<n.length;t+=1)r=n[t],(e[r.dayIndex]||(e[r.dayIndex]=[])).push(r);return e}var tz=':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}';Qn(tz);var rz={listDayFormat:rN,listDaySideFormat:rN,noEventsClassNames:N,noEventsContent:N,noEventsDidMount:N,noEventsWillUnmount:N};function rN(n){return n===!1?null:Ye(n)}var sN=Ir({name:"@fullcalendar/list",optionRefiners:rz,views:{list:{component:Sg,buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});kc.touchMouseIgnoreWait=500;var sk=0,Dg=0,nk=!1,xg=class{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&sz(t)&&this.tryStart(t)){let r=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let r=this.createEventFromMouse(t);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let r=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r);let s=t.target;this.shouldIgnoreMove||s.addEventListener("touchmove",this.handleTouchMove),s.addEventListener("touchend",this.handleTouchEnd),s.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let r=this.createEventFromTouch(t);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleTouchEnd=t=>{if(this.isDragging){let r=t.target;r.removeEventListener("touchmove",this.handleTouchMove),r.removeEventListener("touchend",this.handleTouchEnd),r.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,nz()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let r=window.scrollX-this.prevScrollX+this.prevPageX,s=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:r,pageY:s,deltaX:r-this.origPageX,deltaY:s-this.origPageY})}},this.containerEl=e,this.emitter=new Ri,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),iz()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),az()}tryStart(e){let t=this.querySubjectEl(e),r=e.target;return t&&(!this.handleSelector||tr(r,this.handleSelector))?(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){nk=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?tr(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return sk||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(nk=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let r=0,s=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(r=e.pageX-this.origPageX,s=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:r,deltaY:s}}createEventFromTouch(e,t){let r=e.touches,s,i,a=0,o=0;return r&&r.length?(s=r[0].pageX,i=r[0].pageY):(s=e.pageX,i=e.pageY),t?(this.origPageX=s,this.origPageY=i):(a=s-this.origPageX,o=i-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:s,pageY:i,deltaX:a,deltaY:o}}};function sz(n){return n.button===0&&!n.ctrlKey}function nz(){sk+=1,setTimeout(()=>{sk-=1},kc.touchMouseIgnoreWait)}function iz(){Dg+=1,Dg===1&&window.addEventListener("touchmove",iN,{passive:!1})}function az(){Dg-=1,Dg||window.removeEventListener("touchmove",iN,{passive:!1})}function iN(n){nk&&n.preventDefault()}var ik=class{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,r){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=r-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let r=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(r,this.revertDuration):setTimeout(r,0)}doRevertAnimation(e,t){let r=this.mirrorEl,s=this.sourceEl.getBoundingClientRect();r.style.transition="top "+t+"ms,left "+t+"ms",Oo(r,{left:s.left,top:s.top}),Ow(r,()=>{r.style.transition="",e()})}cleanup(){this.mirrorEl&&(wu(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&Oo(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),Oo(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}},Cg=class extends Mo{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}},Mg=class extends Cg{constructor(e,t){super(new mu(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return yb(this.scrollController.el)}},ak=class extends Cg{constructor(e){super(new gu,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}},nN=typeof performance=="function"?performance.now:Date.now,ok=class{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=nN();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,r){this.isEnabled&&(this.scrollCaches=this.buildCaches(r),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let r=e-window.scrollX,s=t-window.scrollY,i=this.pointerScreenY===null?0:s-this.pointerScreenY,a=this.pointerScreenX===null?0:r-this.pointerScreenX;i<0?this.everMovedUp=!0:i>0&&(this.everMovedDown=!0),a<0?this.everMovedLeft=!0:a>0&&(this.everMovedRight=!0),this.pointerScreenX=r,this.pointerScreenY=s,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(nN()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:r}=e,{edgeThreshold:s}=this,i=s-e.distance,a=i*i/(s*s)*this.maxVelocity*t,o=1;switch(e.name){case"left":o=-1;case"right":r.setScrollLeft(r.getScrollLeft()+a*o);break;case"top":o=-1;case"bottom":r.setScrollTop(r.getScrollTop()+a*o);break}}computeBestEdge(e,t){let{edgeThreshold:r}=this,s=null,i=this.scrollCaches||[];for(let a of i){let o=a.clientRect,l=e-o.left,c=o.right-e,d=t-o.top,u=o.bottom-t;l>=0&&c>=0&&d>=0&&u>=0&&(d<=r&&this.everMovedUp&&a.canScrollUp()&&(!s||s.distance>d)&&(s={scrollCache:a,name:"top",distance:d}),u<=r&&this.everMovedDown&&a.canScrollDown()&&(!s||s.distance>u)&&(s={scrollCache:a,name:"bottom",distance:u}),l<=r&&this.everMovedLeft&&a.canScrollLeft()&&(!s||s.distance>l)&&(s={scrollCache:a,name:"left",distance:l}),c<=r&&this.everMovedRight&&a.canScrollRight()&&(!s||s.distance>c)&&(s={scrollCache:a,name:"right",distance:c}))}return s}buildCaches(e){return this.queryScrollEls(e).map(t=>t===window?new ak(!1):new Mg(t,!1))}queryScrollEls(e){let t=[];for(let r of this.scrollQuery)typeof r=="object"?t.push(r):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(r)));return t}},Ca=class extends Tu{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=s=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,Lw(document.body),Hw(document.body),s.isTouch||s.origEvent.preventDefault(),this.emitter.trigger("pointerdown",s),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(s.subjectEl,s.pageX,s.pageY),this.startDelay(s),this.minDistance||this.handleDistanceSurpassed(s)))},this.onPointerMove=s=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",s),!this.isDistanceSurpassed){let i=this.minDistance,a,{deltaX:o,deltaY:l}=s;a=o*o+l*l,a>=i*i&&this.handleDistanceSurpassed(s)}this.isDragging&&(s.origEvent.type!=="scroll"&&(this.mirror.handleMove(s.pageX,s.pageY),this.autoScroller.handleMove(s.pageX,s.pageY)),this.emitter.trigger("dragmove",s))}},this.onPointerUp=s=>{this.isInteracting&&(this.isInteracting=!1,Fw(document.body),Bw(document.body),this.emitter.trigger("pointerup",s),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(s)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let r=this.pointer=new xg(e);r.emitter.on("pointerdown",this.onPointerDown),r.emitter.on("pointermove",this.onPointerMove),r.emitter.on("pointerup",this.onPointerUp),t&&(r.selector=t),this.mirror=new ik,this.autoScroller=new ok}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)},this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}},lk=class{constructor(e){this.el=e,this.origRect=Au(e),this.scrollCaches=ug(e).map(t=>new Mg(t,!0))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let r={left:e,top:t};for(let s of this.scrollCaches)if(!oz(s.getEventTarget())&&!fb(r,s.clientRect))return!1;return!0}};function oz(n){let e=n.tagName;return e==="HTML"||e==="BODY"}var Bo=class{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=r=>{let{dragging:s}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(r),this.initialHit||!this.requireInitial?(s.setIgnoreMove(!1),this.emitter.trigger("pointerdown",r)):s.setIgnoreMove(!0)},this.handleDragStart=r=>{this.emitter.trigger("dragstart",r),this.handleMove(r,!0)},this.handleDragMove=r=>{this.emitter.trigger("dragmove",r),this.handleMove(r)},this.handlePointerUp=r=>{this.releaseHits(),this.emitter.trigger("pointerup",r)},this.handleDragEnd=r=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,r),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",r)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new Ri}processFirstCoord(e){let t={left:e.pageX,top:e.pageY},r=t,s=e.subjectEl,i;s instanceof HTMLElement&&(i=Au(s),r=pb(r,i));let a=this.initialHit=this.queryHitForOffset(r.left,r.top);if(a){if(this.useSubjectCenter&&i){let o=dg(i,a.rect);o&&(r=mb(o))}this.coordAdjust=gb(r,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let r=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);(t||!_g(this.movingHit,r))&&(this.movingHit=r,this.emitter.trigger("hitupdate",r,!1,e))}prepareHits(){this.offsetTrackers=Js(this.droppableStore,e=>(e.component.prepareHits(),new lk(e.el)))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:r,offsetTrackers:s}=this,i=null;for(let a in r){let o=r[a].component,l=s[a];if(l&&l.isWithinClipping(e,t)){let c=l.computeLeft(),d=l.computeTop(),u=e-c,f=t-d,{origRect:h}=l,p=h.right-h.left,m=h.bottom-h.top;if(u>=0&&u<p&&f>=0&&f<m){let g=o.queryHit(u,f,p,m);g&&yc(g.dateProfile.activeRange,g.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(u+c-window.scrollX,f+d-window.scrollY)))&&(!i||g.layer>i.layer)&&(g.componentId=a,g.context=o.context,g.rect.left+=c,g.rect.right+=c,g.rect.top+=d,g.rect.bottom+=d,i=g)}}}return i}};function _g(n,e){return!n&&!e?!0:!!n!=!!e?!1:lb(n.dateSpan,e.dateSpan)}function pk(n,e){let t={};for(let r of e.pluginHooks.datePointTransforms)Object.assign(t,r(n,e));return Object.assign(t,lz(n,e.dateEnv)),t}function lz(n,e){return{date:e.toDate(n.range.start),dateStr:e.formatIso(n.range.start,{omitTime:n.allDay}),allDay:n.allDay}}var ck=class extends Sn{constructor(e){super(e),this.handlePointerDown=r=>{let{dragging:s}=this,i=r.origEvent.target;s.setIgnoreMove(!this.component.isValidDateDownEl(i))},this.handleDragEnd=r=>{let{component:s}=this,{pointer:i}=this.dragging;if(!i.wasTouchScroll){let{initialHit:a,finalHit:o}=this.hitDragging;if(a&&o&&_g(a,o)){let{context:l}=s,c=Object.assign(Object.assign({},pk(a.dateSpan,l)),{dayEl:a.dayEl,jsEvent:r.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",c)}}},this.dragging=new Ca(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new Bo(this.dragging,Pu(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},dk=class extends Sn{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=a=>{let{component:o,dragging:l}=this,{options:c}=o.context,d=c.selectable&&o.isValidDateDownEl(a.origEvent.target);l.setIgnoreMove(!d),l.delay=a.isTouch?cz(o):null},this.handleDragStart=a=>{this.component.context.calendarApi.unselect(a)},this.handleHitUpdate=(a,o)=>{let{context:l}=this.component,c=null,d=!1;if(a){let u=this.hitDragging.initialHit;a.componentId===u.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(u,a)||(c=dz(u,a,l.pluginHooks.dateSelectionTransformers)),(!c||!Tb(c,a.dateProfile,l))&&(d=!0,c=null)}c?l.dispatch({type:"SELECT_DATES",selection:c}):o||l.dispatch({type:"UNSELECT_DATES"}),d?hc():fc(),o||(this.dragSelection=c)},this.handlePointerUp=a=>{this.dragSelection&&(cg(this.dragSelection,a,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:r}=t.context,s=this.dragging=new Ca(e.el);s.touchScrollAllowed=!1,s.minDistance=r.selectMinDistance||0,s.autoScroller.isEnabled=r.dragScroll;let i=this.hitDragging=new Bo(this.dragging,Pu(e));i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}};function cz(n){let{options:e}=n.context,t=e.selectLongPressDelay;return t==null&&(t=e.longPressDelay),t}function dz(n,e,t){let r=n.dateSpan,s=e.dateSpan,i=[r.range.start,r.range.end,s.range.start,s.range.end];i.sort(Uw);let a={};for(let o of t){let l=o(n,e);if(l===!1)return null;l&&Object.assign(a,l)}return a.range={start:i[0],end:i[3]},a.allDay=r.allDay,a}var Vu=class n extends Sn{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=a=>{let o=a.origEvent.target,{component:l,dragging:c}=this,{mirror:d}=c,{options:u}=l.context,f=l.context;this.subjectEl=a.subjectEl;let h=this.subjectSeg=Fi(a.subjectEl),m=(this.eventRange=h.eventRange).instance.instanceId;this.relevantEvents=xu(f.getCurrentData().eventStore,m),c.minDistance=a.isTouch?0:u.eventDragMinDistance,c.delay=a.isTouch&&m!==l.props.eventSelection?hz(l):null,u.fixedMirrorParent?d.parentNode=u.fixedMirrorParent:d.parentNode=tr(o,".fc"),d.revertDuration=u.dragRevertDuration;let g=l.isValidSegDownEl(o)&&!tr(o,".fc-event-resizer");c.setIgnoreMove(!g),this.isDragging=g&&a.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=a=>{let o=this.component.context,l=this.eventRange,c=l.instance.instanceId;a.isTouch?c!==this.component.props.eventSelection&&o.dispatch({type:"SELECT_EVENT",eventInstanceId:c}):o.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(o.calendarApi.unselect(a),o.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new ct(o,l.def,l.instance),jsEvent:a.origEvent,view:o.viewApi}))},this.handleHitUpdate=(a,o)=>{if(!this.isDragging)return;let l=this.relevantEvents,c=this.hitDragging.initialHit,d=this.component.context,u=null,f=null,h=null,p=!1,m={affectedEvents:l,mutatedEvents:rr(),isEvent:!0};if(a){u=a.context;let g=u.options;d===u||g.editable&&g.droppable?(f=uz(c,a,this.eventRange.instance.range.start,u.getCurrentData().pluginHooks.eventDragMutationMassagers),f&&(h=Cu(l,u.getCurrentData().eventUiBases,f,u),m.mutatedEvents=h,Nu(m,a.dateProfile,u)||(p=!0,f=null,h=null,m.mutatedEvents=rr()))):u=null}this.displayDrag(u,m),p?hc():fc(),o||(d===u&&_g(c,a)&&(f=null),this.dragging.setMirrorNeedsRevert(!f),this.dragging.setMirrorIsVisible(!a||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=u,this.validMutation=f,this.mutatedRelevantEvents=h)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=a=>{if(this.isDragging){let o=this.component.context,l=o.viewApi,{receivingContext:c,validMutation:d}=this,u=this.eventRange.def,f=this.eventRange.instance,h=new ct(o,u,f),p=this.relevantEvents,m=this.mutatedRelevantEvents,{finalHit:g}=this.hitDragging;if(this.clearDrag(),o.emitter.trigger("eventDragStop",{el:this.subjectEl,event:h,jsEvent:a.origEvent,view:l}),d){if(c===o){let y=new ct(o,m.defs[u.defId],f?m.instances[f.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:m});let T={oldEvent:h,event:y,relatedEvents:Jn(m,o,f),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:p})}},w={};for(let b of o.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(w,b(d,o));o.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},T),w),{el:a.subjectEl,delta:d.datesDelta,jsEvent:a.origEvent,view:l})),o.emitter.trigger("eventChange",T)}else if(c){let y={event:h,relatedEvents:Jn(p,o,f),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:p})}};o.emitter.trigger("eventLeave",Object.assign(Object.assign({},y),{draggedEl:a.subjectEl,view:l})),o.dispatch({type:"REMOVE_EVENTS",eventStore:p}),o.emitter.trigger("eventRemove",y);let T=m.defs[u.defId],w=m.instances[f.instanceId],b=new ct(c,T,w);c.dispatch({type:"MERGE_EVENTS",eventStore:m});let E={event:b,relatedEvents:Jn(m,c,w),revert(){c.dispatch({type:"REMOVE_EVENTS",eventStore:m})}};c.emitter.trigger("eventAdd",E),a.isTouch&&c.dispatch({type:"SELECT_EVENT",eventInstanceId:f.instanceId}),c.emitter.trigger("drop",Object.assign(Object.assign({},pk(g.dateSpan,c)),{draggedEl:a.subjectEl,jsEvent:a.origEvent,view:g.context.viewApi})),c.emitter.trigger("eventReceive",Object.assign(Object.assign({},E),{draggedEl:a.subjectEl,view:g.context.viewApi}))}}else o.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:r}=t.context,s=this.dragging=new Ca(e.el);s.pointer.selector=n.SELECTOR,s.touchScrollAllowed=!1,s.autoScroller.isEnabled=r.dragScroll;let i=this.hitDragging=new Bo(this.dragging,Fo);i.useSubjectCenter=e.useEventCenter,i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("pointerup",this.handlePointerUp),i.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let r=this.component.context,s=this.receivingContext;s&&s!==e&&(s===r?s.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:rr(),isEvent:!0}}):s.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}};Vu.SELECTOR=".fc-event-draggable, .fc-event-resizable";function uz(n,e,t,r){let s=n.dateSpan,i=e.dateSpan,a=s.range.start,o=i.range.start,l={};s.allDay!==i.allDay&&(l.allDay=i.allDay,l.hasEnd=e.context.options.allDayMaintainDuration,i.allDay?a=tt(t):a=t);let c=wa(a,o,n.context.dateEnv,n.componentId===e.componentId?n.largeUnit:null);c.milliseconds&&(l.allDay=!1);let d={datesDelta:c,standardProps:l};for(let u of r)u(d,n,e);return d}function hz(n){let{options:e}=n.context,t=e.eventLongPressDelay;return t==null&&(t=e.longPressDelay),t}var uk=class extends Sn{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=i=>{let{component:a}=this,o=this.querySegEl(i),l=Fi(o),c=this.eventRange=l.eventRange;this.dragging.minDistance=a.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(i.origEvent.target)||i.isTouch&&this.component.props.eventSelection!==c.instance.instanceId)},this.handleDragStart=i=>{let{context:a}=this.component,o=this.eventRange;this.relevantEvents=xu(a.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(i);this.draggingSegEl=l,this.draggingSeg=Fi(l),a.calendarApi.unselect(),a.emitter.trigger("eventResizeStart",{el:l,event:new ct(a,o.def,o.instance),jsEvent:i.origEvent,view:a.viewApi})},this.handleHitUpdate=(i,a,o)=>{let{context:l}=this.component,c=this.relevantEvents,d=this.hitDragging.initialHit,u=this.eventRange.instance,f=null,h=null,p=!1,m={affectedEvents:c,mutatedEvents:rr(),isEvent:!0};i&&(i.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,i)||(f=fz(d,i,o.subjectEl.classList.contains("fc-event-resizer-start"),u.range))),f&&(h=Cu(c,l.getCurrentData().eventUiBases,f,l),m.mutatedEvents=h,Nu(m,i.dateProfile,l)||(p=!0,f=null,h=null,m.mutatedEvents=null)),h?l.dispatch({type:"SET_EVENT_RESIZE",state:m}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),p?hc():fc(),a||(f&&_g(d,i)&&(f=null),this.validMutation=f,this.mutatedRelevantEvents=h)},this.handleDragEnd=i=>{let{context:a}=this.component,o=this.eventRange.def,l=this.eventRange.instance,c=new ct(a,o,l),d=this.relevantEvents,u=this.mutatedRelevantEvents;if(a.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:c,jsEvent:i.origEvent,view:a.viewApi}),this.validMutation){let f=new ct(a,u.defs[o.defId],l?u.instances[l.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:u});let h={oldEvent:c,event:f,relatedEvents:Jn(u,a,l),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:d})}};a.emitter.trigger("eventResize",Object.assign(Object.assign({},h),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||De(0),endDelta:this.validMutation.endDelta||De(0),jsEvent:i.origEvent,view:a.viewApi})),a.emitter.trigger("eventChange",h)}else a.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,r=this.dragging=new Ca(e.el);r.pointer.selector=".fc-event-resizer",r.touchScrollAllowed=!1,r.autoScroller.isEnabled=t.context.options.dragScroll;let s=this.hitDragging=new Bo(this.dragging,Pu(e));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return tr(e.subjectEl,".fc-event")}};function fz(n,e,t,r){let s=n.context.dateEnv,i=n.dateSpan.range.start,a=e.dateSpan.range.start,o=wa(i,a,s,n.largeUnit);if(t){if(s.add(r.start,o)<r.end)return{startDelta:o}}else if(s.add(r.end,o)>r.start)return{endDelta:o};return null}var hk=class{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=r=>{r.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=r=>{let s=this.context.options.unselectCancel,i=Jm(r.origEvent);this.matchesCancel=!!tr(i,s),this.matchesEvent=!!tr(i,Vu.SELECTOR)},this.onDocumentPointerUp=r=>{let{context:s}=this,{documentPointer:i}=this,a=s.getCurrentData();if(!i.wasTouchScroll){if(a.dateSelection&&!this.isRecentPointerDateSelect){let o=s.options.unselectAuto;o&&(!o||!this.matchesCancel)&&s.calendarApi.unselect(r)}a.eventSelection&&!this.matchesEvent&&s.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new xg(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}},pz={fixedMirrorParent:N},mz={dateClick:N,eventDragStart:N,eventDragStop:N,eventDrop:N,eventResizeStart:N,eventResizeStop:N,eventResize:N,drop:N,eventReceive:N,eventLeave:N},fk=class{constructor(e,t){this.receivingContext=null,this.droppableEvent=null,this.suppliedDragMeta=null,this.dragMeta=null,this.handleDragStart=s=>{this.dragMeta=this.buildDragMeta(s.subjectEl)},this.handleHitUpdate=(s,i,a)=>{let{dragging:o}=this.hitDragging,l=null,c=null,d=!1,u={affectedEvents:rr(),mutatedEvents:rr(),isEvent:this.dragMeta.create};s&&(l=s.context,this.canDropElOnCalendar(a.subjectEl,l)&&(c=gz(s.dateSpan,this.dragMeta,l),u.mutatedEvents=Co(c),d=!Nu(u,s.dateProfile,l),d&&(u.mutatedEvents=rr(),c=null))),this.displayDrag(l,u),o.setMirrorIsVisible(i||!c||!document.querySelector(".fc-event-mirror")),d?hc():fc(),i||(o.setMirrorNeedsRevert(!c),this.receivingContext=l,this.droppableEvent=c)},this.handleDragEnd=s=>{let{receivingContext:i,droppableEvent:a}=this;if(this.clearDrag(),i&&a){let o=this.hitDragging.finalHit,l=o.context.viewApi,c=this.dragMeta;if(i.emitter.trigger("drop",Object.assign(Object.assign({},pk(o.dateSpan,i)),{draggedEl:s.subjectEl,jsEvent:s.origEvent,view:l})),c.create){let d=Co(a);i.dispatch({type:"MERGE_EVENTS",eventStore:d}),s.isTouch&&i.dispatch({type:"SELECT_EVENT",eventInstanceId:a.instance.instanceId}),i.emitter.trigger("eventReceive",{event:new ct(i,a.def,a.instance),relatedEvents:[],revert(){i.dispatch({type:"REMOVE_EVENTS",eventStore:d})},draggedEl:s.subjectEl,view:l})}}this.receivingContext=null,this.droppableEvent=null};let r=this.hitDragging=new Bo(e,Fo);r.requireInitial=!1,r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("dragend",this.handleDragEnd),this.suppliedDragMeta=t}buildDragMeta(e){return typeof this.suppliedDragMeta=="object"?Ru(this.suppliedDragMeta):typeof this.suppliedDragMeta=="function"?Ru(this.suppliedDragMeta(e)):yz(e)}displayDrag(e,t){let r=this.receivingContext;r&&r!==e&&r.dispatch({type:"UNSET_EVENT_DRAG"}),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){this.receivingContext&&this.receivingContext.dispatch({type:"UNSET_EVENT_DRAG"})}canDropElOnCalendar(e,t){let r=t.options.dropAccept;return typeof r=="function"?r.call(t.calendarApi,e):typeof r=="string"&&r?!!Xm(e,r):!0}};function gz(n,e,t){let r=Object.assign({},e.leftoverProps);for(let d of t.pluginHooks.externalDefTransforms)Object.assign(r,d(n,e));let{refined:s,extra:i}=Du(r,t),a=cc(s,i,e.sourceId,n.allDay,t.options.forceEventDuration||!!e.duration,t),o=n.range.start;n.allDay&&e.startTime&&(o=t.dateEnv.add(o,e.startTime));let l=e.duration?t.dateEnv.add(o,e.duration):uu(n.allDay,o,t),c=vc(a.defId,{start:o,end:l});return{def:a,instance:c}}function yz(n){let e=vz(n,"event"),t=e?JSON.parse(e):{create:!1};return Ru(t)}kc.dataAttrPrefix="";function vz(n,e){let t=kc.dataAttrPrefix,r=(t?t+"-":"")+e;return n.getAttribute("data-"+r)||""}var Pg=class{constructor(e,t={}){this.handlePointerDown=s=>{let{dragging:i}=this,{minDistance:a,longPressDelay:o}=this.settings;i.minDistance=a!=null?a:s.isTouch?0:Xn.eventDragMinDistance,i.delay=s.isTouch?o!=null?o:Xn.longPressDelay:0},this.handleDragStart=s=>{s.isTouch&&this.dragging.delay&&s.subjectEl.classList.contains("fc-event")&&this.dragging.mirror.getMirrorEl().classList.add("fc-event-selected")},this.settings=t;let r=this.dragging=new Ca(e);r.touchScrollAllowed=!1,t.itemSelector!=null&&(r.pointer.selector=t.itemSelector),t.appendTo!=null&&(r.mirror.parentNode=t.appendTo),r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),new fk(r,t.eventData)}destroy(){this.dragging.destroy()}};var aN=Ir({name:"@fullcalendar/interaction",componentInteractions:[ck,dk,Vu,uk],calendarInteractions:[hk],elementDraggingImpl:Ca,optionRefiners:pz,listenerRefiners:mz});or();var Ls=require("obsidian");var Qe=require("obsidian");ec();ru();var oN=require("obsidian"),Ag=class{constructor(e){this.menu=new oN.Menu,this.options=e,this.buildMenu()}buildMenu(){this.getStatusOptions().forEach((t,r)=>{this.menu.addItem(s=>{let i=t.label;s.setIcon("circle"),t.value===this.options.currentValue&&(i=`\u2713 ${t.label}`),s.setTitle(i),s.onClick(async()=>{this.options.onSelect(t.value)})})})}getStatusOptions(){let e=this.options.plugin.settings.customStatuses,t=[];return e&&e.length>0&&[...e].sort((s,i)=>s.order-i.order).forEach(s=>{t.push({label:s.label,value:s.value,color:s.color})}),t}capitalizeFirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}show(e){this.menu.showAtMouseEvent(e),setTimeout(()=>{this.applyColorStyling()},10)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4}),setTimeout(()=>{this.applyColorStyling()},10)}applyColorStyling(){let e=this.getStatusOptions(),t=document.querySelector(".menu");if(!t)return;let r=t.querySelectorAll(".menu-item");e.forEach((s,i)=>{let a=r[i];if(a&&s.color){let o=a.querySelector(".menu-item-icon");o&&(o.style.color=s.color)}})}};tc();var mk=require("obsidian");Sm();var Cc=class{constructor(e,t,r,s){this.plugin=e,this.task=t,this.triggerElement=r,this.onUpdate=s}show(e){let t=new mk.Menu;this.addQuickRemindersSection(t,"due","Remind before due..."),this.addQuickRemindersSection(t,"scheduled","Remind before scheduled..."),t.addSeparator(),t.addItem(r=>{r.setTitle("Manage All Reminders...").setIcon("settings").onClick(()=>{this.openReminderModal()})}),this.task.reminders&&this.task.reminders.length>0&&t.addItem(r=>{r.setTitle("Clear All Reminders").setIcon("trash").onClick(async()=>{await this.clearAllReminders()})}),e?t.showAtMouseEvent(e):t.showAtMouseEvent(new MouseEvent("contextmenu"))}addQuickRemindersSection(e,t,r){if(!(t==="due"?this.task.due:this.task.scheduled)){e.addItem(i=>{i.setTitle(r).setIcon("bell").setDisabled(!0)});return}e.addItem(i=>{i.setTitle(r).setIcon("bell").onClick(a=>{this.showQuickReminderSubmenu(t,a instanceof MouseEvent?a:void 0)})})}showQuickReminderSubmenu(e,t){let r=new mk.Menu;[{label:"At time of event",offset:"PT0M"},{label:"5 minutes before",offset:"-PT5M"},{label:"15 minutes before",offset:"-PT15M"},{label:"1 hour before",offset:"-PT1H"},{label:"1 day before",offset:"-P1D"}].forEach(i=>{r.addItem(a=>{a.setTitle(i.label).onClick(async()=>{await this.addQuickReminder(e,i.offset,i.label)})})}),t?r.showAtMouseEvent(t):r.showAtMouseEvent(new MouseEvent("contextmenu"))}async addQuickReminder(e,t,r){let s={id:`rem_${Date.now()}`,type:"relative",relatedTo:e,offset:t,description:r},i=[...this.task.reminders||[],s];await this.saveReminders(i)}async clearAllReminders(){await this.saveReminders([])}async saveReminders(e){let t;if(this.task.path&&this.task.path.trim()!==""){let r=await this.plugin.cacheManager.getTaskInfo(this.task.path);r?(t={...r,reminders:e},await this.plugin.taskService.updateProperty(t,"reminders",e)):t={...this.task,reminders:e}}else t={...this.task,reminders:e};this.onUpdate(t)}openReminderModal(){new Pi(this.plugin.app,this.plugin,this.task,async t=>{await this.saveReminders(t)}).open()}};Ne();At();var Mc=class extends Qe.Modal{constructor(t,r){super(t);this.title="";this.details="";this.dueDate="";this.scheduledDate="";this.priority="normal";this.status="open";this.contexts="";this.projects="";this.tags="";this.timeEstimate=0;this.recurrenceRule="";this.reminders=[];this.userFields={};this.selectedProjectFiles=[];this.isExpanded=!1;this.plugin=r}onOpen(){this.containerEl.addClass("tasknotes-plugin","minimalist-task-modal"),this.titleEl.setText(this.getModalTitle());let t=this.titleEl.createSpan("modal-header-icon");(0,Qe.setIcon)(t,"tasknotes-simple"),this.titleEl.insertBefore(t,this.titleEl.firstChild),this.initializeFormData().then(()=>{this.createModalContent(),this.focusTitleInput()})}createModalContent(){let{contentEl:t}=this;t.empty();let r=t.createDiv("minimalist-modal-container");this.createTitleInput(r),this.createActionBar(r),this.createDetailsSection(r),this.createActionButtons(r)}createTitleInput(t){let r=t.createDiv("title-input-container");this.titleInput=r.createEl("input",{type:"text",cls:"title-input",placeholder:"What needs to be done?"}),this.titleInput.value=this.title,this.titleInput.addEventListener("input",s=>{this.title=s.target.value})}createActionBar(t){this.actionBar=t.createDiv("action-bar"),this.createActionIcon(this.actionBar,"calendar","Set due date",(r,s)=>{this.showDateContextMenu(s,"due")},"due-date"),this.createActionIcon(this.actionBar,"calendar-clock","Set scheduled date",(r,s)=>{this.showDateContextMenu(s,"scheduled")},"scheduled-date"),this.createActionIcon(this.actionBar,"dot-square","Set status",(r,s)=>{this.showStatusContextMenu(s)},"status"),this.createActionIcon(this.actionBar,"star","Set priority",(r,s)=>{this.showPriorityContextMenu(s)},"priority"),this.createActionIcon(this.actionBar,"refresh-ccw","Set recurrence",(r,s)=>{this.showRecurrenceContextMenu(s)},"recurrence"),this.createActionIcon(this.actionBar,"bell","Set reminders",(r,s)=>{this.showReminderContextMenu(s)},"reminders"),this.updateIconStates()}createActionIcon(t,r,s,i,a){let o=t.createDiv("action-icon");o.setAttribute("aria-label",s),o.setAttribute("data-initial-tooltip",s),a&&o.setAttribute("data-type",a);let l=o.createSpan("icon");return(0,Qe.setIcon)(l,r),o.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),i(o,c)}),o}createDetailsSection(t){this.detailsContainer=t.createDiv("details-container"),this.isExpanded||(this.detailsContainer.style.display="none");let r=this.getModalTitle()==="Edit task",s=this.getModalTitle()==="Create task"&&this.plugin.settings.enableNaturalLanguageInput;if(r||s){let i=this.detailsContainer.createDiv("detail-label");i.textContent="Title";let a=this.detailsContainer.createEl("input",{type:"text",cls:"title-input-detailed",placeholder:"Task title..."});a.value=this.title,a.addEventListener("input",o=>{this.title=o.target.value}),s&&!this.titleInput&&(this.titleInput=a)}if(this.getModalTitle()!=="Edit task"){let i=this.detailsContainer.createDiv("detail-label");i.textContent="Details",this.detailsInput=this.detailsContainer.createEl("textarea",{cls:"details-input",placeholder:"Add more details..."}),this.detailsInput.value=this.details,this.detailsInput.addEventListener("input",a=>{this.details=a.target.value})}this.createAdditionalFields(this.detailsContainer)}createAdditionalFields(t){new Qe.Setting(t).setName("Projects").addButton(r=>{r.setButtonText("Add Project").setTooltip("Select a project note using fuzzy search").onClick(()=>{new _l(this.app,this.plugin,i=>{this.addProject(i)}).open()}),r.buttonEl.addClasses(["tn-btn","tn-btn--ghost"])}),this.projectsList=t.createDiv({cls:"task-projects-list"}),new Qe.Setting(t).setName("Contexts").addText(r=>{r.setPlaceholder("context1, context2").setValue(this.contexts).onChange(s=>{this.contexts=s}),this.contextsInput=r.inputEl,new vk(this.app,r.inputEl,this.plugin)}),new Qe.Setting(t).setName("Tags").addText(r=>{r.setPlaceholder("tag1, tag2").setValue(this.tags).onChange(s=>{this.tags=ha(s)}),this.tagsInput=r.inputEl,new Tk(this.app,r.inputEl,this.plugin)}),new Qe.Setting(t).setName("Time estimate (minutes)").addText(r=>{r.setPlaceholder("30").setValue(this.timeEstimate.toString()).onChange(s=>{this.timeEstimate=parseInt(s)||0}),this.timeEstimateInput=r.inputEl}),this.createUserFields(t)}createUserFields(t){var s;let r=((s=this.plugin.settings)==null?void 0:s.userFields)||[];r.length>0&&t.createDiv({cls:"user-fields-separator"}).createDiv({text:"Custom Fields",cls:"detail-label-section"});for(let i of r){if(!i||!i.key||!i.displayName)continue;let a=this.userFields[i.key]||"";switch(i.type){case"boolean":new Qe.Setting(t).setName(i.displayName).addToggle(o=>{o.setValue(a===!0||a==="true").onChange(l=>{this.userFields[i.key]=l})});break;case"number":new Qe.Setting(t).setName(i.displayName).addText(o=>{o.setPlaceholder("0").setValue(a?String(a):"").onChange(l=>{let c=parseFloat(l);this.userFields[i.key]=isNaN(c)?null:c})});break;case"date":new Qe.Setting(t).setName(i.displayName).addText(o=>{o.setPlaceholder("YYYY-MM-DD").setValue(a?String(a):"").onChange(d=>{this.userFields[i.key]=d||null});let l=o.inputEl.parentElement;l&&l.addClass("tn-date-control");let c=l==null?void 0:l.createEl("button",{cls:"user-field-date-picker-btn"});c&&(c.setAttribute("aria-label",`Pick ${i.displayName.toLowerCase()} date`),(0,Qe.setIcon)(c,"calendar"),c.addEventListener("click",d=>{d.preventDefault(),new ts({currentValue:o.getValue()||void 0,onSelect:f=>{o.setValue(f||""),this.userFields[i.key]=f||null}}).showAtElement(c)}))});break;case"list":new Qe.Setting(t).setName(i.displayName).addText(o=>{var d;let l=Array.isArray(a)?a.join(", "):a?String(a):"";o.setPlaceholder("item1, item2, item3").setValue(l).onChange(u=>{u.trim()?this.userFields[i.key]=u.split(",").map(f=>f.trim()).filter(f=>f):this.userFields[i.key]=null}),new Ig(this.app,o.inputEl,this.plugin,i);let c=t.querySelector(".user-field-link-preview");c&&((d=c.detach)==null||d.call(c))});break;case"text":default:new Qe.Setting(t).setName(i.displayName).addText(o=>{o.setPlaceholder(`Enter ${i.displayName.toLowerCase()}...`).setValue(a?String(a):"").onChange(l=>{this.userFields[i.key]=l||null}),new Ig(this.app,o.inputEl,this.plugin,i)});break}}}createActionButtons(t){let r=t.createDiv("button-container");this.getModalTitle()==="Edit task"&&(r.createEl("button",{cls:"open-note-button",text:"Open note"}).addEventListener("click",async()=>{await this.openTaskNote()}),r.createDiv("button-spacer")),r.createEl("button",{cls:"save-button",text:"Save"}).addEventListener("click",async()=>{await this.handleSave(),this.close()}),r.createEl("button",{cls:"cancel-button",text:"Cancel"}).addEventListener("click",()=>{this.close()})}expandModal(){this.isExpanded||(this.isExpanded=!0,this.detailsContainer.style.display="block",this.containerEl.addClass("expanded"),this.detailsContainer.style.opacity="0",this.detailsContainer.style.transform="translateY(-10px)",setTimeout(()=>{this.detailsContainer.style.opacity="1",this.detailsContainer.style.transform="translateY(0)"},50))}showDateContextMenu(t,r){let s=r==="due"?this.dueDate:this.scheduledDate,i=r==="due"?"Set Due Date":"Set Scheduled Date";new ts({currentValue:s?we(s):void 0,currentTime:s?xr(s):void 0,title:i,onSelect:(o,l)=>{if(o){let c=l?Ur(o,l):o;r==="due"?this.dueDate=c:this.scheduledDate=c}else r==="due"?this.dueDate="":this.scheduledDate="";this.updateDateIconState()}}).show(t)}showStatusContextMenu(t){new Ag({currentValue:this.status,onSelect:s=>{this.status=s,this.updateStatusIconState()},plugin:this.plugin}).show(t)}showPriorityContextMenu(t){new Zs({currentValue:this.priority,onSelect:s=>{this.priority=s,this.updatePriorityIconState()},plugin:this.plugin}).show(t)}showRecurrenceContextMenu(t){new Ks({currentValue:this.recurrenceRule,onSelect:s=>{this.recurrenceRule=s||"",this.updateRecurrenceIconState()},app:this.app}).show(t)}showReminderContextMenu(t){let r={title:this.title,status:this.status,priority:this.priority,due:this.dueDate,scheduled:this.scheduledDate,path:"",archived:!1,reminders:this.reminders};new Cc(this.plugin,r,t.target,i=>{this.reminders=i.reminders||[],this.updateReminderIconState()}).show(t)}updateDateIconState(){this.updateIconStates()}updateStatusIconState(){this.updateIconStates()}updatePriorityIconState(){this.updateIconStates()}updateRecurrenceIconState(){this.updateIconStates()}updateReminderIconState(){this.updateIconStates()}getDefaultStatus(){let t=this.plugin.settings.customStatuses;return t&&t.length>0?[...t].sort((s,i)=>s.order-i.order)[0].value:"open"}getDefaultPriority(){let t=this.plugin.settings.customPriorities;return t&&t.length>0?[...t].sort((s,i)=>s.weight-i.weight)[0].value:"normal"}getRecurrenceDisplayText(){if(!this.recurrenceRule)return"";let t=this.recurrenceRule;if(t.includes("FREQ=DAILY"))return"Daily";if(t.includes("FREQ=WEEKLY")){if(t.includes("INTERVAL=2"))return"Every 2 weeks";if(t.includes("BYDAY=MO,TU,WE,TH,FR"))return"Weekdays";if(t.includes("BYDAY=")){let s=t.match(/BYDAY=([A-Z]{2})/);return s?`Weekly on ${{SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"}[s[1]]||s[1]}`:"Weekly"}else return"Weekly"}else if(t.includes("FREQ=MONTHLY")){if(t.includes("INTERVAL=3"))return"Every 3 months";if(t.includes("BYMONTHDAY=")){let s=t.match(/BYMONTHDAY=(\d+)/);return s?`Monthly on the ${this.getOrdinal(parseInt(s[1]))}`:"Monthly"}else return t.includes("BYDAY=")?"Monthly (by weekday)":"Monthly"}else if(t.includes("FREQ=YEARLY")){if(t.includes("BYMONTH=")&&t.includes("BYMONTHDAY=")){let s=t.match(/BYMONTH=(\d+)/),i=t.match(/BYMONTHDAY=(\d+)/);if(s&&i){let o=["","January","February","March","April","May","June","July","August","September","October","November","December"][parseInt(s[1])],l=this.getOrdinal(parseInt(i[1]));return`Yearly on ${o} ${l}`}}return"Yearly"}let r="";if(t.includes("COUNT=")){let s=t.match(/COUNT=(\d+)/);s&&(r=` (${s[1]} times)`)}else if(t.includes("UNTIL=")){let s=t.match(/UNTIL=(\d{8})/);if(s){let i=s[1];r=` (until ${`${i.slice(0,4)}-${i.slice(4,6)}-${i.slice(6,8)}`})`}}return"Custom"+r}getOrdinal(t){let r=["th","st","nd","rd"],s=t%100;return t+(r[(s-20)%10]||r[s]||r[0])}updateIconStates(){if(!this.actionBar)return;let t=this.actionBar.querySelector('[data-type="due-date"]');t&&(this.dueDate?(t.classList.add("has-value"),(0,Qe.setTooltip)(t,`Due: ${this.dueDate}`,{placement:"top"})):(t.classList.remove("has-value"),(0,Qe.setTooltip)(t,"Set due date",{placement:"top"})));let r=this.actionBar.querySelector('[data-type="scheduled-date"]');r&&(this.scheduledDate?(r.classList.add("has-value"),(0,Qe.setTooltip)(r,`Scheduled: ${this.scheduledDate}`,{placement:"top"})):(r.classList.remove("has-value"),(0,Qe.setTooltip)(r,"Set scheduled date",{placement:"top"})));let s=this.actionBar.querySelector('[data-type="status"]');if(s){let l=this.plugin.settings.customStatuses.find(u=>u.value===this.status),c=l?l.label:this.status;this.status&&l&&l.value!==this.getDefaultStatus()?(s.classList.add("has-value"),(0,Qe.setTooltip)(s,`Status: ${c}`,{placement:"top"})):(s.classList.remove("has-value"),(0,Qe.setTooltip)(s,"Set status",{placement:"top"}));let d=s.querySelector(".icon");d&&l&&l.color?d.style.color=l.color:d&&(d.style.color="")}let i=this.actionBar.querySelector('[data-type="priority"]');if(i){let l=this.plugin.settings.customPriorities.find(u=>u.value===this.priority),c=l?l.label:this.priority;this.priority&&l&&l.value!==this.getDefaultPriority()?(i.classList.add("has-value"),(0,Qe.setTooltip)(i,`Priority: ${c}`,{placement:"top"})):(i.classList.remove("has-value"),(0,Qe.setTooltip)(i,"Set priority",{placement:"top"}));let d=i.querySelector(".icon");d&&l&&l.color?d.style.color=l.color:d&&(d.style.color="")}let a=this.actionBar.querySelector('[data-type="recurrence"]');a&&(this.recurrenceRule&&this.recurrenceRule.trim()?(a.classList.add("has-value"),(0,Qe.setTooltip)(a,`Recurrence: ${this.getRecurrenceDisplayText()}`,{placement:"top"})):(a.classList.remove("has-value"),(0,Qe.setTooltip)(a,"Set recurrence",{placement:"top"})));let o=this.actionBar.querySelector('[data-type="reminders"]');if(o)if(this.reminders&&this.reminders.length>0){o.classList.add("has-value");let l=this.reminders.length,c=l===1?"1 reminder set":`${l} reminders set`;(0,Qe.setTooltip)(o,c,{placement:"top"})}else o.classList.remove("has-value"),(0,Qe.setTooltip)(o,"Set reminders",{placement:"top"})}focusTitleInput(){setTimeout(()=>{this.titleInput.focus(),this.titleInput.select()},100)}addProject(t){this.selectedProjectFiles.some(r=>r.path===t.path)||(this.selectedProjectFiles.push(t),this.updateProjectsFromFiles(),this.renderProjectsList())}removeProject(t){this.selectedProjectFiles=this.selectedProjectFiles.filter(r=>r.path!==t.path),this.updateProjectsFromFiles(),this.renderProjectsList()}updateProjectsFromFiles(){let t=this.app.workspace.getActiveFile(),r=(t==null?void 0:t.path)||"";this.projects=this.selectedProjectFiles.map(s=>`[[${this.app.metadataCache.fileToLinktext(s,r,!0)}]]`).join(", ")}initializeProjectsFromStrings(t){this.selectedProjectFiles=[];for(let r of t){if(!r||typeof r!="string"||r.trim()==="")continue;let s=r.match(/^\[\[([^\]]+)\]\]$/);if(s){let i=s[1],a=this.app.metadataCache.getFirstLinkpathDest(i,"");a&&this.selectedProjectFiles.push(a)}else{let a=this.app.vault.getMarkdownFiles().find(o=>o.basename===r||o.name===r+".md");a&&this.selectedProjectFiles.push(a)}}this.updateProjectsFromFiles()}renderProjectsList(){this.projectsList&&(this.projectsList.empty(),this.selectedProjectFiles.length!==0&&this.selectedProjectFiles.forEach(t=>{let r=this.projectsList.createDiv({cls:"task-project-item"}),s=r.createDiv({cls:"task-project-info"}),i=s.createSpan({cls:"task-project-name"});if(i.textContent=t.name,t.path!==t.name){let o=s.createDiv({cls:"task-project-path"});o.textContent=t.path}let a=r.createEl("button",{cls:"task-project-remove",text:"\xD7"});(0,Qe.setTooltip)(a,"Remove project",{placement:"top"}),a.addEventListener("click",()=>{this.removeProject(t)})}))}validateForm(){return this.title.trim().length>0}},vk=class extends Qe.AbstractInputSuggest{constructor(e,t,r){super(e,t),this.plugin=r,this.input=t}async getSuggestions(e){let t=this.input.value.split(",").map(i=>i.trim()),r=t[t.length-1];return r?this.plugin.cacheManager.getAllContexts().filter(i=>i&&typeof i=="string").filter(i=>i.toLowerCase().includes(r.toLowerCase())&&!t.slice(0,-1).includes(i)).slice(0,10).map(i=>({value:i,display:i,type:"context",toString(){return this.value}})):[]}renderSuggestion(e,t){t.textContent=e.display}selectSuggestion(e){let t=this.input.value.split(",").map(r=>r.trim());t[t.length-1]=e.value,this.input.value=t.join(", ")+", ",this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}},Tk=class extends Qe.AbstractInputSuggest{constructor(e,t,r){super(e,t),this.plugin=r,this.input=t}async getSuggestions(e){let t=this.input.value.split(",").map(i=>i.trim()),r=t[t.length-1];return r?this.plugin.cacheManager.getAllTags().filter(i=>i&&typeof i=="string").filter(i=>i.toLowerCase().includes(r.toLowerCase())&&!t.slice(0,-1).includes(i)).slice(0,10).map(i=>({value:i,display:i,type:"tag",toString(){return this.value}})):[]}renderSuggestion(e,t){t.textContent=e.display}selectSuggestion(e){let t=this.input.value.split(",").map(r=>r.trim());t[t.length-1]=e.value,this.input.value=t.join(", ")+", ",this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}},Ig=class extends Qe.AbstractInputSuggest{constructor(e,t,r,s){super(e,t),this.plugin=r,this.input=t,this.fieldConfig=s}async getSuggestions(e){let t=this.fieldConfig.type==="list",r="",s=[];if(t?(s=this.input.value.split(",").map(o=>o.trim()),r=s[s.length-1]||""):r=this.input.value.trim(),!r)return[];let i=r.match(/\[\[([^\]]*)$/);if(i){let o=i[1]||"",{FileSuggestHelper:l}=await Promise.resolve().then(()=>(yk(),gk));return(await l.suggest(this.plugin,o)).map(d=>({value:d.insertText,display:d.displayText,type:"user-field",fieldKey:this.fieldConfig.key,toString(){return this.value}}))}return(await this.getExistingUserFieldValues(this.fieldConfig.key)).filter(o=>o&&typeof o=="string").filter(o=>o.toLowerCase().includes(r.toLowerCase())&&(!t||!s.slice(0,-1).includes(o))).slice(0,10).map(o=>({value:o,display:o,type:"user-field",fieldKey:this.fieldConfig.key,toString(){return this.value}}))}async getExistingUserFieldValues(e){var s,i;let t=async()=>{try{let a=this.plugin.app.vault.getMarkdownFiles(),o=new Set;for(let l of a)try{let c=this.plugin.app.metadataCache.getFileCache(l),d=c==null?void 0:c.frontmatter;if(d&&d[e]!==void 0){let u=d[e];Array.isArray(u)?u.forEach(f=>{typeof f=="string"&&f.trim()&&o.add(f.trim())}):typeof u=="string"&&u.trim()?o.add(u.trim()):(typeof u=="number"||typeof u=="boolean")&&o.add(u.toString())}if(o.size>=200)break}catch(c){continue}return Array.from(o).sort()}catch(a){return console.error("Error getting user field values:",a),[]}},r=(i=(s=this.plugin.settings)==null?void 0:s.suggestionDebounceMs)!=null?i:0;return r?new Promise(a=>{let o=this.plugin;o.__userFieldSuggestTimer&&clearTimeout(o.__userFieldSuggestTimer),o.__userFieldSuggestTimer=setTimeout(async()=>{let l=await t();a(l)},r)}):t()}renderSuggestion(e,t){t.textContent=e.display}selectSuggestion(e){var r;if(this.fieldConfig.type==="list"){let s=this.input.value.split(","),i=(r=s.pop())!=null?r:"",a=s.join(","),o=i.trim(),l=/\[\[/.test(o)?o.replace(/\[\[[^\]]*$/,`[[${e.value}]]`):e.value,c=(a?a+", ":"")+l;this.input.value=c.endsWith(",")?c+" ":c+", "}else{let s=this.input.value,i=s.replace(/\[\[[^\]]*$/,`[[${e.value}]]`);this.input.value=i===s?e.value:i}this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}};Ne();Ft();var wk=require("obsidian");function dN(n,e){if(!n||!e)throw new Error("Invalid context or settings provided");if(!n.title||typeof n.title!="string")throw new Error("Context must have a valid title");if(n.title.trim().length===0)throw new Error("Title cannot be empty");let t=n.date||new Date;if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date provided in context");try{let r=e.icsIntegration;if(r)switch(r.icsNoteFilenameFormat){case"title":return Rr(n.title);case"zettel":return Uo(t);case"timestamp":return uN(t);case"custom":{let s={icsEventTitle:n.icsEventTitle?Rr(n.icsEventTitle):Rr(n.title),icsEventLocation:n.icsEventLocation?Rr(n.icsEventLocation):"",icsEventDescription:n.icsEventDescription?Rr(n.icsEventDescription.substring(0,50)):"",icsEventTitleWithDate:Rr(`${n.icsEventTitle||n.title} - ${C(t,"PPP")}`)};return hN(n,r.customICSNoteFilenameTemplate,t,s)}default:return Rr(n.title)}return Rr(n.title)}catch(r){return console.error("Error generating ICS note filename:",r),Rr(n.title)}}function Rg(n,e){if(!n||!e)throw new Error("Invalid context or settings provided");if(!n.title||typeof n.title!="string")throw new Error("Context must have a valid title");if(n.title.trim().length===0)throw new Error("Title cannot be empty");let t=n.date||new Date;if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date provided in context");if(e.storeTitleInFilename)return Rr(n.title);try{switch(e.taskFilenameFormat){case"title":return Rr(n.title);case"zettel":return Uo(t);case"timestamp":return uN(t);case"custom":return hN(n,e.customFilenameTemplate,t);default:return Uo(t)}}catch(r){return console.error("Error generating filename:",r),Uo(t)}}function Uo(n){let e=C(n,"yyMMdd"),t=new Date(n);t.setHours(0,0,0,0);let s=Math.floor((n.getTime()-t.getTime())/1e3).toString(36);return`${e}${s}`}function uN(n){return C(n,"yyyy-MM-dd-HHmmss")}function hN(n,e,t,r){if(!n||!e||!t)throw new Error("Invalid inputs for custom filename generation");if(typeof e!="string"||e.trim().length===0)throw new Error("Template must be a non-empty string");if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date for filename generation");try{let s=Rr(n.title),i=n.priority&&["low","normal","medium","high"].includes(n.priority)?n.priority:"normal",a=n.status&&["open","in-progress","done","scheduled"].includes(n.status)?n.status:"open",o={title:s,date:C(t,"yyyy-MM-dd"),time:C(t,"HHmmss"),priority:i,status:a,timestamp:C(t,"yyyy-MM-dd-HHmmss"),dateTime:C(t,"yyyy-MM-dd-HHmm"),year:C(t,"yyyy"),month:C(t,"MM"),day:C(t,"dd"),hour:C(t,"HH"),minute:C(t,"mm"),second:C(t,"ss"),dueDate:n.dueDate||"",scheduledDate:n.scheduledDate||"",shortDate:C(t,"yyMMdd"),monthName:C(t,"MMMM"),monthNameShort:C(t,"MMM"),dayName:C(t,"EEEE"),dayNameShort:C(t,"EEE"),week:C(t,"ww"),quarter:C(t,"q"),time12:C(t,"hh:mm a"),time24:C(t,"HH:mm"),hourPadded:C(t,"HH"),hour12:C(t,"hh"),ampm:C(t,"a"),unix:Math.floor(t.getTime()/1e3).toString(),unixMs:t.getTime().toString(),milliseconds:C(t,"SSS"),ms:C(t,"SSS"),timezone:C(t,"xxx"),timezoneShort:C(t,"xx"),utcOffset:C(t,"xxx"),utcOffsetShort:C(t,"xx"),utcZ:"Z",priorityShort:i.substring(0,1).toUpperCase(),statusShort:a.substring(0,1).toUpperCase(),titleLower:s.toLowerCase(),titleUpper:s.toUpperCase(),titleSnake:s.toLowerCase().replace(/\s+/g,"_"),titleKebab:s.toLowerCase().replace(/\s+/g,"-"),titleCamel:s.replace(/(?:^\w|[A-Z]|\b\w)/g,(c,d)=>d===0?c.toLowerCase():c.toUpperCase()).replace(/\s+/g,""),titlePascal:s.replace(/(?:^\w|[A-Z]|\b\w)/g,c=>c.toUpperCase()).replace(/\s+/g,""),zettel:Uo(t),nano:Date.now().toString()+Math.random().toString(36).substring(2,7),...r||{}},l=e;if(e.length>500)throw new Error("Template too long");return Object.entries(o).forEach(([c,d])=>{try{let u=new RegExp(`\\{${c}\\}`,"g");l=l.replace(u,d)}catch(u){console.warn(`Error replacing template variable ${c}:`,u)}}),l=l.replace(/\{[^}]+\}/g,""),l.trim()||(l=s||Uo(t)),Rr(l)}catch(s){return console.error("Error generating custom filename:",s),Rr(n.title)||Uo(t)}}function Rr(n){if(!n||typeof n!="string")return"untitled";try{let e=n.trim().replace(/\s+/g," ").replace(/[<>:"/\\|?*#\[\]]/g,"").replace(/./g,r=>{let s=r.charCodeAt(0);return s<=31||s>=127&&s<=159?"":r}).replace(/^\.+|\.+$/g,"").trim();return(!e||e.length===0)&&(e="untitled"),["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"].includes(e.toUpperCase())&&(e=`task-${e}`),e}catch(e){return console.error("Error sanitizing filename:",e),"untitled"}}async function Yu(n,e,t){if(!n||typeof n!="string")throw new Error("Base filename must be a non-empty string");if(typeof e!="string")throw new Error("Folder path must be a string");if(!t)throw new Error("Vault must be provided");let r=Rr(n);if(!r)throw new Error("Base filename cannot be sanitized to a valid name");let s=e.replace(/\.\./g,"").trim();try{let i=(0,wk.normalizePath)(`${s}/${r}.md`);if(i.length>260)throw new Error("Generated path too long");if(!t.getAbstractFileByPath(i))return r;for(let l=2;l<=999;l++){let c=`${r}-${l}`,d=(0,wk.normalizePath)(`${s}/${c}.md`);if(d.length>260)break;if(!t.getAbstractFileByPath(d))return c}let a=Date.now().toString(36),o=`${r.substring(0,50)}-${a}`;return Rr(o)}catch(i){return console.error("Error generating unique filename:",i),`task-${Date.now().toString(36)}`}}At();ip();ip();var ap=class{constructor(e,t,r,s="en"){this.nlpParser=new ai(e,t,r,s)}extractTaskDataFromInput(e){return this.nlpParser.parseInput(e)}getStatusSuggestions(e,t,r=10){let s=e.toLowerCase();return t.filter(i=>i&&typeof i.value=="string"&&typeof i.label=="string").filter(i=>i.value.trim()!==""&&i.label.trim()!=="").filter(i=>i.value.toLowerCase().includes(s)||i.label.toLowerCase().includes(s)).slice(0,r).map(i=>({value:i.value,label:i.label,display:i.label,type:"status",toString(){return this.value}}))}hasStatusTrigger(e,t,r){return t.trim()?e.slice(0,r).lastIndexOf(t)!==-1:!1}extractQueryAfterTrigger(e,t,r){if(!t.trim())return"";let s=e.slice(0,r),i=s.lastIndexOf(t);if(i===-1)return"";let a=i+t.length,l=s.slice(a).match(/^[^\s@#+]*/);return l?l[0]:""}applyStatusSelection(e,t,r,s){if(!t.trim())return{newText:e,newCursorPos:r};let i=e.slice(0,r),a=e.slice(r),o=i.lastIndexOf(t);if(o===-1)return{newText:e,newCursorPos:r};let l=e.slice(0,o),c=s.label,d=l+c+a,u=o+c.length;return{newText:d,newCursorPos:u}}isValidStatusContext(e,t){return!((e.slice(0,t).match(/"/g)||[]).length%2===1)}};Ne();Al();Gp();var DS=class extends Ls.AbstractInputSuggest{constructor(t,r,s){super(t,r);this.currentTrigger=null;this.plugin=s,this.textarea=r,this.obsidianApp=t}async getSuggestions(t){var g,y,T,w,b,E;let r=this.textarea.selectionStart,s=this.textarea.value.slice(0,r),i=s.lastIndexOf("@"),a=s.lastIndexOf("#"),o=s.lastIndexOf("+"),l=(this.plugin.settings.statusSuggestionTrigger||"").trim(),c=l?s.lastIndexOf(l):-1,d=-1,u=null,f=S=>{if(S===-1)return!1;if(S===0)return!0;let D=s[S-1];return!/\w/.test(D)},h=[{type:"@",index:i},{type:"#",index:a},{type:"+",index:o},{type:"status",index:c}].filter(S=>f(S.index));if(h.length===0)return this.currentTrigger=null,[];h.sort((S,D)=>D.index-S.index),d=h[0].index,u=h[0].type;let p=u==="status"?(l==null?void 0:l.length)||0:1,m=s.slice(d+p);if(u==="+"&&/^\[\[[^\]]*\]\]/.test(m))return this.currentTrigger=null,[];if((u==="@"||u==="#"||u==="status")&&(m.includes(" ")||m.includes(`
`)))return this.currentTrigger=null,[];if(this.currentTrigger=u,u==="@")return this.plugin.cacheManager.getAllContexts().filter(D=>D&&typeof D=="string").filter(D=>D.toLowerCase().includes(m.toLowerCase())).slice(0,10).map(D=>({value:D,display:D,type:"context",toString(){return this.value}}));if(u==="status")return new ap(this.plugin.settings.customStatuses,this.plugin.settings.customPriorities,this.plugin.settings.nlpDefaultToScheduled,this.plugin.settings.nlpLanguage).getStatusSuggestions(m,this.plugin.settings.customStatuses||[],10);if(u==="#")return this.plugin.cacheManager.getAllTags().filter(D=>D&&typeof D=="string").filter(D=>D.toLowerCase().includes(m.toLowerCase())).slice(0,10).map(D=>({value:D,display:D,type:"tag",toString(){return this.value}}));if(u==="+"){let{FileSuggestHelper:S}=await Promise.resolve().then(()=>(yk(),gk)),D=(this.plugin.settings.excludedFolders||"").split(",").map(Q=>Q.trim()).filter(Boolean),M=(await S.suggest(this.plugin,m)).filter(Q=>{var A,j,U;let P=(U=(A=this.obsidianApp)!=null?A:this.app)!=null?U:(j=this.plugin)==null?void 0:j.app,I=P==null?void 0:P.vault.getMarkdownFiles().find(V=>V.basename===Q.insertText);return I?!D.some(V=>I.path.startsWith(V)):!0}),B=(T=(g=this.obsidianApp)!=null?g:this.app)!=null?T:(y=this.plugin)==null?void 0:y.app;try{let Q=new lo({getFrontmatter:I=>{let A=B==null?void 0:B.vault.getAbstractFileByPath(I.path),j=A?B==null?void 0:B.metadataCache.getFileCache(A):void 0;return(j==null?void 0:j.frontmatter)||{}}}),P=((E=(b=(w=this.plugin.settings)==null?void 0:w.projectAutosuggest)==null?void 0:b.rows)!=null?E:[]).slice(0,3);return M.map(I=>{var Ae;let A=B==null?void 0:B.vault.getMarkdownFiles().find(ve=>ve.basename===I.insertText);if(!A)return{basename:I.insertText,displayName:I.displayText,type:"project",toString(){return this.basename}};let j=B==null?void 0:B.metadataCache.getFileCache(A),U=(j==null?void 0:j.frontmatter)||{},V=this.plugin.fieldMapper.mapFromFrontmatter(U,A.path,this.plugin.settings.storeTitleInFilename),F=typeof V.title=="string"?V.title:"",$=(0,Ls.parseFrontMatterAliases)(U)||[],Z=Array.isArray($)?$.filter(ve=>typeof ve=="string"):[],re={basename:A.basename,name:A.name,path:A.path,parent:((Ae=A.parent)==null?void 0:Ae.path)||"",title:F,aliases:Z,frontmatter:U},he=((ve,Nt,ee)=>{var pt;let oe=[];for(let Yt of ve)try{let Nn=ia(Yt),yn=[];for(let ra of Nn){if(ra.property.startsWith("literal:")){yn.push(ra.property.slice(8));continue}let Xa=ee.resolve(ra.property,Nt)||"";if(Xa)if(ra.showName){let Pp=(pt=ra.displayName)!=null?pt:ra.property;yn.push(`${Pp}: ${Xa}`)}else yn.push(Xa)}let yd=yn.join(" ");yd.trim()&&oe.push(yd)}catch(Nn){}return oe.join(" | ")||A.basename})(P,re,Q);return{basename:I.insertText,displayName:he,type:"project",entry:{basename:re.basename,name:re.name,path:re.path,parent:re.parent,title:re.title,aliases:re.aliases,frontmatter:re.frontmatter},toString(){return this.basename}}})}catch(Q){return console.error("Enhanced project autosuggest failed, falling back to basic suggestions",Q),M.map(P=>({basename:P.insertText,displayName:P.displayText,type:"project",toString(){return this.basename}}))}}return[]}renderSuggestion(t,r){var l,c,d,u,f;let s=r.createSpan("nlp-suggest-icon");s.textContent=this.currentTrigger==="status"?this.plugin.settings.statusSuggestionTrigger||"":this.currentTrigger||"";let i=r.createSpan("nlp-suggest-text"),a=(h,p)=>{if(!p)return;let m=p.toLowerCase().split(/\s+/).filter(Boolean);if(!m.length)return;let g=y=>{var T;if(y.nodeType===Node.TEXT_NODE){let w=y.nodeValue||"",b=w.toLowerCase(),E=[];for(let M of m){let B=b.indexOf(M);for(;B!==-1;)E.push({start:B,end:B+M.length}),B=b.indexOf(M,B+1)}E.sort((M,B)=>M.start-B.start);let S=[];for(let M of E)(!S.length||M.start>=S[S.length-1].end)&&S.push(M);if(!S.length)return;let D=document.createDocumentFragment(),x=0;for(let M of S){M.start>x&&D.appendChild(document.createTextNode(w.slice(x,M.start)));let B=document.createElement("mark");B.textContent=w.slice(M.start,M.end),D.appendChild(B),x=M.end}x<w.length&&D.appendChild(document.createTextNode(w.slice(x))),(T=y.parentNode)==null||T.replaceChild(D,y)}else if(y.nodeType===Node.ELEMENT_NODE&&y.tagName!=="MARK"){let w=Array.from(y.childNodes);for(let b of w)g(b)}};g(h)},o="";if(this.currentTrigger==="+"){let h=this.textarea.selectionStart,p=this.textarea.value.slice(0,h),m=p.lastIndexOf("+");if(m!==-1){let g=p.slice(m+1);g&&!g.includes(`
`)&&(o=g.trim())}}if(t.type==="project"){let h=i.createDiv({cls:"nlp-suggest-project__filename",text:t.basename});o&&a(h,o);let p=((d=(c=(l=this.plugin.settings)==null?void 0:l.projectAutosuggest)==null?void 0:c.rows)!=null?d:[]).slice(0,3);if(Array.isArray(p)&&p.length>0&&t.entry){let m=new lo({getFrontmatter:g=>g.frontmatter});for(let g=0;g<Math.min(p.length,3);g++){let y=p[g];if(y)try{let T=ia(y),w=i.createDiv({cls:"nlp-suggest-project__meta"}),b=new Set(["title","aliases","file.basename"]),E=!1;for(let S of T){if(S.property.startsWith("literal:")){let B=S.property.slice(8);B&&(w.childNodes.length&&w.appendChild(document.createTextNode(" ")),w.appendChild(document.createTextNode(B)),E=!0);continue}let D=m.resolve(S.property,t.entry);if(!D)continue;if(w.childNodes.length&&w.appendChild(document.createTextNode(" ")),S.showName){let B=document.createElement("span");B.className="nlp-suggest-project__meta-label",B.textContent=`${(u=S.displayName)!=null?u:S.property}:`,w.appendChild(B),w.appendChild(document.createTextNode(" "))}let x=document.createElement("span");x.className="nlp-suggest-project__meta-value",x.textContent=D,w.appendChild(x),E=!0;let M=S.searchable===!0||b.has(S.property);o&&M&&a(x,o)}(!E||((f=w.textContent)==null?void 0:f.trim().length)===0)&&w.remove()}catch(T){}}}}else t.type,i.textContent=t.display}selectSuggestion(t){if(!this.currentTrigger)return;let r=this.textarea.selectionStart,s=this.textarea.value.slice(0,r),i=this.textarea.value.slice(r),a=-1,o=(this.plugin.settings.statusSuggestionTrigger||"").trim();if(this.currentTrigger==="@"?a=s.lastIndexOf("@"):this.currentTrigger==="#"?a=s.lastIndexOf("#"):this.currentTrigger==="+"?a=s.lastIndexOf("+"):this.currentTrigger==="status"&&o&&(a=s.lastIndexOf(o)),a===-1)return;let l=t.type==="project"?t.basename:t.value,c=s.slice(0,a),d="";this.currentTrigger==="+"?d="+[["+l+"]]":this.currentTrigger==="status"?d=t.type==="status"?t.label:l:d=this.currentTrigger+l;let u=c+d+(d?" ":"")+i;this.textarea.value=u;let f=c.length+d.length+(d?1:0);this.textarea.setSelectionRange(f,f),this.textarea.dispatchEvent(new Event("input",{bubbles:!0})),this.textarea.focus()}},ll=class extends Mc{constructor(e,t,r={},s){super(e,t),this.options=r,this.nlParser=new ai(t.settings.customStatuses,t.settings.customPriorities,t.settings.nlpDefaultToScheduled,t.settings.nlpLanguage),this.statusSuggestionService=s||new ap(t.settings.customStatuses,t.settings.customPriorities,t.settings.nlpDefaultToScheduled,t.settings.nlpLanguage)}getModalTitle(){return"Create task"}createModalContent(){let{contentEl:e}=this;e.empty();let t=e.createDiv("minimalist-modal-container");this.plugin.settings.enableNaturalLanguageInput?this.createNaturalLanguageInput(t):(this.createTitleInput(t),this.isExpanded=!0,this.containerEl.addClass("expanded")),this.createActionBar(t),this.createDetailsSection(t),(this.options.prePopulatedValues&&this.options.prePopulatedValues.projects||this.selectedProjectFiles.length>0)&&this.renderProjectsList(),this.createActionButtons(t)}createNaturalLanguageInput(e){let t=e.createDiv("nl-input-container");this.nlInput=t.createEl("textarea",{cls:"nl-input",attr:{placeholder:`Buy groceries tomorrow at 3pm @home #errands

Add details here...`,rows:"3"}}),this.nlPreviewContainer=t.createDiv("nl-preview-container"),this.nlInput.addEventListener("input",()=>{let r=this.nlInput.value.trim();r?this.updateNaturalLanguagePreview(r):this.clearNaturalLanguagePreview()}),this.nlInput.addEventListener("keydown",r=>{let s=this.nlInput.value.trim();s&&(r.key==="Enter"&&(r.ctrlKey||r.metaKey)?(r.preventDefault(),this.handleSave()):r.key==="Tab"&&r.shiftKey&&(r.preventDefault(),this.parseAndFillForm(s)))}),this.nlpSuggest=new DS(this.app,this.nlInput,this.plugin),setTimeout(()=>{this.nlInput.focus()},100)}updateNaturalLanguagePreview(e){if(!this.nlPreviewContainer)return;let t=this.nlParser.parseInput(e),r=this.nlParser.getPreviewData(t);r.length>0&&t.title?(this.nlPreviewContainer.empty(),this.nlPreviewContainer.style.display="block",r.forEach(s=>{let i=this.nlPreviewContainer.createDiv("nl-preview-item");i.textContent=s.text})):this.clearNaturalLanguagePreview()}clearNaturalLanguagePreview(){this.nlPreviewContainer&&(this.nlPreviewContainer.empty(),this.nlPreviewContainer.style.display="none")}createActionBar(e){if(this.actionBar=e.createDiv("action-bar"),this.plugin.settings.enableNaturalLanguageInput){this.createActionIcon(this.actionBar,"wand","Fill form from natural language",(r,s)=>{var a;let i=(a=this.nlInput)==null?void 0:a.value.trim();i&&this.parseAndFillForm(i)}),this.createActionIcon(this.actionBar,this.isExpanded?"chevron-up":"chevron-down",this.isExpanded?"Hide detailed options":"Show detailed options",(r,s)=>{this.toggleDetailedForm();let i=r.querySelector(".icon");i&&(0,Ls.setIcon)(i,this.isExpanded?"chevron-up":"chevron-down"),(0,Ls.setTooltip)(r,this.isExpanded?"Hide detailed options":"Show detailed options",{placement:"top"})});let t=this.actionBar.createDiv("action-separator");t.style.width="1px",t.style.height="24px",t.style.backgroundColor="var(--background-modifier-border)",t.style.margin="0 var(--size-4-2)"}this.createActionIcon(this.actionBar,"calendar","Set due date",(t,r)=>{this.showDateContextMenu(r,"due")},"due-date"),this.createActionIcon(this.actionBar,"calendar-clock","Set scheduled date",(t,r)=>{this.showDateContextMenu(r,"scheduled")},"scheduled-date"),this.createActionIcon(this.actionBar,"dot-square","Set status",(t,r)=>{this.showStatusContextMenu(r)},"status"),this.createActionIcon(this.actionBar,"star","Set priority",(t,r)=>{this.showPriorityContextMenu(r)},"priority"),this.createActionIcon(this.actionBar,"refresh-ccw","Set recurrence",(t,r)=>{this.showRecurrenceContextMenu(r)},"recurrence"),this.createActionIcon(this.actionBar,"bell","Set reminders",(t,r)=>{this.showReminderContextMenu(r)},"reminders"),this.updateIconStates()}parseAndFillForm(e){let t=this.statusSuggestionService.extractTaskDataFromInput(e);this.applyParsedData(t),this.isExpanded||this.expandModal()}applyParsedData(e){e.title&&(this.title=e.title),e.status&&(this.status=e.status),e.priority&&(this.priority=e.priority),e.dueDate&&(this.dueDate=e.dueTime?Ur(e.dueDate,e.dueTime):e.dueDate),e.scheduledDate&&(this.scheduledDate=e.scheduledTime?Ur(e.scheduledDate,e.scheduledTime):e.scheduledDate),e.contexts&&e.contexts.length>0&&(this.contexts=e.contexts.join(", ")),e.tags&&e.tags.length>0&&(this.tags=ha(e.tags.join(", "))),e.details&&(this.details=e.details),e.recurrence&&(this.recurrenceRule=e.recurrence),e.estimate!==void 0&&(this.timeEstimate=e.estimate>0?e.estimate:0,this.timeEstimateInput&&(this.timeEstimateInput.value=this.timeEstimate>0?this.timeEstimate.toString():"")),this.titleInput&&(this.titleInput.value=this.title),this.detailsInput&&(this.detailsInput.value=this.details),this.contextsInput&&(this.contextsInput.value=this.contexts),this.tagsInput&&(this.tagsInput.value=this.tags),e.projects&&e.projects.length>0&&(this.initializeProjectsFromStrings(e.projects),this.renderProjectsList()),this.updateIconStates()}toggleDetailedForm(){this.isExpanded?(this.isExpanded=!1,this.detailsContainer.style.display="none",this.containerEl.removeClass("expanded")):this.expandModal()}async initializeFormData(){this.priority=this.plugin.settings.defaultTaskPriority,this.status=this.plugin.settings.defaultTaskStatus;let e=this.plugin.settings.taskCreationDefaults;if(this.dueDate=Qs(e.defaultDueDate),this.scheduledDate=Qs(e.defaultScheduledDate),this.contexts=e.defaultContexts||"",this.tags=e.defaultTags||"",e.defaultProjects){let t=bn(e.defaultProjects);t.length>0&&this.initializeProjectsFromStrings(t)}if(e.defaultTimeEstimate&&e.defaultTimeEstimate>0&&(this.timeEstimate=e.defaultTimeEstimate),e.defaultReminders&&e.defaultReminders.length>0){let{convertDefaultRemindersToReminders:t}=await Promise.resolve().then(()=>(lp(),op));this.reminders=t(e.defaultReminders)}this.options.prePopulatedValues&&this.applyPrePopulatedValues(this.options.prePopulatedValues)}applyPrePopulatedValues(e){e.title!==void 0&&(this.title=e.title),e.due!==void 0&&(this.dueDate=e.due),e.scheduled!==void 0&&(this.scheduledDate=e.scheduled),e.priority!==void 0&&(this.priority=e.priority),e.status!==void 0&&(this.status=e.status),e.contexts!==void 0&&(this.contexts=e.contexts.join(", ")),e.projects!==void 0&&(e.projects.filter(r=>r&&typeof r=="string"&&r.trim()!=="").length>0&&this.initializeProjectsFromStrings(e.projects),this.renderProjectsList()),e.tags!==void 0&&(this.tags=ha(e.tags.filter(t=>t!==this.plugin.settings.taskTag).join(", "))),e.timeEstimate!==void 0&&(this.timeEstimate=e.timeEstimate),e.recurrence!==void 0&&typeof e.recurrence=="string"&&(this.recurrenceRule=e.recurrence)}async handleSave(){if(this.plugin.settings.enableNaturalLanguageInput&&this.nlInput){let e=this.nlInput.value.trim();if(e&&!this.title.trim()){let t=this.statusSuggestionService.extractTaskDataFromInput(e);this.applyParsedData(t)}}if(!this.validateForm()){new Ls.Notice("Please enter a task title");return}try{let e=this.buildTaskData(),t=await this.plugin.taskService.createTask(e),r=t.taskInfo.title.replace(/[<>:"/\\|?*]/g,"").trim(),s=t.file.basename;s.startsWith("task-")&&s!==r?new Ls.Notice(`Task "${t.taskInfo.title}" created successfully (filename shortened due to length)`):new Ls.Notice(`Task "${t.taskInfo.title}" created successfully`),this.options.onTaskCreated&&this.options.onTaskCreated(t.taskInfo),this.close()}catch(e){console.error("Failed to create task:",e),new Ls.Notice("Failed to create task: "+e.message)}}buildTaskData(){let e=Ue(),t=this.contexts.split(",").map(a=>a.trim()).filter(a=>a.length>0),r=bn(this.projects),s=ha(this.tags).split(",").map(a=>a.trim()).filter(a=>a.length>0);this.plugin.settings.taskTag&&!s.includes(this.plugin.settings.taskTag)&&s.push(this.plugin.settings.taskTag);let i={title:this.title.trim(),due:this.dueDate||void 0,scheduled:this.scheduledDate||void 0,priority:this.priority,status:this.status,contexts:t.length>0?t:void 0,projects:r.length>0?r:void 0,tags:s.length>0?s:void 0,timeEstimate:this.timeEstimate>0?this.timeEstimate:void 0,recurrence:this.recurrenceRule||void 0,reminders:this.reminders.length>0?this.reminders:void 0,creationContext:"manual-creation",dateCreated:e,dateModified:e,customFrontmatter:this.buildCustomFrontmatter()};return this.details.trim()&&(i.details=this.details.trim()),i}buildCustomFrontmatter(){let e={};for(let[t,r]of Object.entries(this.userFields))r!=null&&r!==""&&(e[t]=r);return e}generateFilename(e){let t={title:e.title||"",status:e.status||"open",priority:e.priority||"normal",dueDate:e.due,scheduledDate:e.scheduled};return Rg(t,this.plugin.settings)}createTitleInput(e){this.plugin.settings.enableNaturalLanguageInput||super.createTitleInput(e)}};var wr=require("obsidian");Ne();Ne();Ft();At();Al();CS();var Fa=class extends Mc{constructor(t,r,s){super(t,r);this.completedInstancesChanges=new Set;this.calendarWrapper=null;this.isExpanded=!0;this.task=s.task,this.options=s}getModalTitle(){return"Edit task"}async initializeFormData(){this.title=this.task.title,this.dueDate=this.task.due||"",this.scheduledDate=this.task.scheduled||"",this.priority=this.task.priority,this.status=this.task.status,this.contexts=this.task.contexts?this.task.contexts.join(", "):"",this.task.projects&&this.task.projects.length>0?this.task.projects.filter(r=>r&&typeof r=="string"&&r.trim()!=="").length>0?this.initializeProjectsFromStrings(this.task.projects):(this.projects="",this.selectedProjectFiles=[]):(this.projects="",this.selectedProjectFiles=[]),this.tags=this.task.tags?ha(this.task.tags.filter(t=>t!==this.plugin.settings.taskTag).join(", ")):"",this.timeEstimate=this.task.timeEstimate||0,this.task.recurrence?typeof this.task.recurrence=="string"?this.recurrenceRule=this.task.recurrence:typeof this.task.recurrence=="object"&&this.task.recurrence.frequency&&(this.recurrenceRule=this.convertLegacyRecurrenceToString(this.task.recurrence)):this.recurrenceRule="",this.reminders=this.task.reminders?[...this.task.reminders]:[],await this.initializeUserFields()}async initializeUserFields(){var t;try{let r=this.app.vault.getAbstractFileByPath(this.task.path);if(!r||!(r instanceof wr.TFile))return;let s=this.app.metadataCache.getFileCache(r),i=s==null?void 0:s.frontmatter;if(!i)return;let a=((t=this.plugin.settings)==null?void 0:t.userFields)||[];for(let o of a){if(!o||!o.key)continue;let l=i[o.key];l!==void 0&&(this.userFields[o.key]=l)}}catch(r){console.error("Error initializing user fields:",r)}}convertLegacyRecurrenceToString(t){if(!t.frequency)return"";let r=t.frequency;return t.frequency==="weekly"&&t.days_of_week&&(r+=` on ${t.days_of_week.join(", ")}`),t.frequency==="monthly"&&t.day_of_month&&(r+=` on day ${t.day_of_month}`),r}showReminderContextMenu(t){let r={...this.task,title:this.title,due:this.dueDate,scheduled:this.scheduledDate,reminders:this.reminders};new Cc(this.plugin,r,t.target,i=>{this.reminders=i.reminders||[],this.updateReminderIconState()}).show(t)}async onOpen(){this.completedInstancesChanges.clear(),await this.refreshTaskData(),this.containerEl.addClass("tasknotes-plugin","minimalist-task-modal"),this.titleEl.setText(this.getModalTitle());let t=this.titleEl.createSpan("modal-header-icon");(0,wr.setIcon)(t,"tasknotes-simple"),this.titleEl.insertBefore(t,this.titleEl.firstChild),this.initializeFormData().then(()=>{this.createModalContent(),this.renderProjectsList(),this.updateIconStates(),this.focusTitleInput()})}async refreshTaskData(){try{let t=this.app.vault.getAbstractFileByPath(this.task.path);if(!t||!(t instanceof wr.TFile)){console.warn("Could not find file for task:",this.task.path);return}let r=await this.app.vault.read(t),s=SA(this.app,r,this.task.path,t,this.plugin.fieldMapper,this.plugin.settings.storeTitleInFilename);s&&(this.task=s,this.options.task=s)}catch(t){console.warn("Could not refresh task data:",t)}}createModalContent(){let{contentEl:t}=this;t.empty();let r=t.createDiv("minimalist-modal-container");this.createActionBar(r),this.createDetailsSection(r),this.createCompletionsCalendarSection(r),this.createMetadataSection(r),this.createActionButtons(r)}createCompletionsCalendarSection(t){if(this.task.recurrence){let r=t.createDiv("completions-calendar-container"),s=r.createDiv("detail-label");s.textContent="Completions";let i=r.createDiv("completions-calendar-content");this.createRecurringCalendar(i)}}createMetadataSection(t){this.metadataContainer=t.createDiv("metadata-container");let r=this.metadataContainer.createDiv("detail-label");r.textContent="Task Information";let s=this.metadataContainer.createDiv("metadata-content"),i=En(this.task.timeEntries||[]);if(i>0){let a=s.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Total tracked time: ",a.createSpan("metadata-value").textContent=vm(i)}if(this.task.dateCreated){let a=s.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Created: ",a.createSpan("metadata-value").textContent=ET(this.task.dateCreated)}if(this.task.dateModified){let a=s.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Modified: ",a.createSpan("metadata-value").textContent=ET(this.task.dateModified)}if(this.task.path){let a=s.createDiv("metadata-item");a.createSpan("metadata-key").textContent="File: ",a.createSpan("metadata-value").textContent=this.task.path}}createRecurringCalendar(t){this.calendarWrapper=t.createDiv("recurring-calendar");let s=Ge();if(this.task.complete_instances&&this.task.complete_instances.length>0){let i=this.task.complete_instances.filter(a=>a&&typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a.trim())).map(a=>Bl(a).getTime()).filter(a=>!isNaN(a));i.length>0&&(s=new Date(Math.max(...i)))}this.renderCalendarMonth(this.calendarWrapper,s)}renderCalendarMonth(t,r){t.empty();let s=t.createDiv("recurring-calendar__header"),i=s.createEl("button",{cls:"recurring-calendar__nav",text:"\u2039"}),a=s.createSpan("recurring-calendar__month");a.textContent=C(r,"MMM yyyy");let o=s.createEl("button",{cls:"recurring-calendar__nav",text:"\u203A"}),l=t.createDiv("recurring-calendar__grid"),c=MT(r),d=PT(r),u=this.plugin.settings.calendarViewSettings.firstDay||0,f=CT(c,u),h=x_(d,u),p=D_(f,h),m=MT(r);m.setUTCMonth(m.getUTCMonth()-1);let g=PT(r);g.setUTCMonth(g.getUTCMonth()+1);let y=Zd(this.task,m,g),T=new Set(y.map(b=>ue(b))),w=new Set(this.task.complete_instances||[]);this.completedInstancesChanges.forEach(b=>{w.has(b)?w.delete(b):w.add(b)}),p.forEach(b=>{let E=ue(b),S=b.getUTCMonth()===r.getUTCMonth(),D=T.has(E),x=w.has(E),M=l.createDiv("recurring-calendar__day");M.textContent=String(b.getUTCDate()),S||M.addClass("recurring-calendar__day--faded"),M.addClass("recurring-calendar__day--clickable"),D&&M.addClass("recurring-calendar__day--recurring"),x&&M.addClass("recurring-calendar__day--completed"),M.addEventListener("click",()=>{this.toggleCompletedInstance(E),this.renderCalendarMonth(t,r)})}),i.addEventListener("click",()=>{let b=new Date(r);b.setUTCMonth(b.getUTCMonth()-1),this.renderCalendarMonth(t,b)}),o.addEventListener("click",()=>{let b=new Date(r);b.setUTCMonth(b.getUTCMonth()+1),this.renderCalendarMonth(t,b)})}toggleCompletedInstance(t){this.completedInstancesChanges.has(t)?this.completedInstancesChanges.delete(t):this.completedInstancesChanges.add(t)}async handleSave(){if(!this.validateForm()){new wr.Notice("Please enter a task title");return}try{let t=this.getChanges();if(Object.keys(t).length===0){new wr.Notice("No changes to save"),this.close();return}let r=await this.plugin.taskService.updateTask(this.task,t);new wr.Notice(`Task "${r.title}" updated successfully`),this.options.onTaskUpdated&&this.options.onTaskUpdated(r)}catch(t){console.error("Failed to update task:",t),new wr.Notice("Failed to update task: "+t.message)}}getChanges(){let t={};this.title.trim()!==this.task.title&&(t.title=this.title.trim()),this.dueDate!==(this.task.due||"")&&(t.due=this.dueDate||void 0),this.scheduledDate!==(this.task.scheduled||"")&&(t.scheduled=this.scheduledDate||void 0),this.priority!==this.task.priority&&(t.priority=this.priority),this.status!==this.task.status&&(t.status=this.status);let r=this.contexts.split(",").map(m=>m.trim()).filter(m=>m.length>0),s=this.task.contexts||[];JSON.stringify(r.sort())!==JSON.stringify(s.sort())&&(t.contexts=r.length>0?r:void 0);let i=bn(this.projects),a=this.task.projects||[];JSON.stringify(i.sort())!==JSON.stringify(a.sort())&&(t.projects=i);let o=this.tags.split(",").map(m=>m.trim()).filter(m=>m.length>0);this.plugin.settings.taskTag&&!o.includes(this.plugin.settings.taskTag)&&o.push(this.plugin.settings.taskTag);let l=this.task.tags||[];JSON.stringify(o.sort())!==JSON.stringify(l.sort())&&(t.tags=o.length>0?o:void 0);let c=this.timeEstimate>0?this.timeEstimate:void 0,d=this.task.timeEstimate;c!==d&&(t.timeEstimate=c);let u=typeof this.task.recurrence=="string"?this.task.recurrence:"";this.recurrenceRule!==u&&(t.recurrence=this.recurrenceRule||void 0);let f=this.task.reminders||[],h=this.reminders||[];if(JSON.stringify(h)!==JSON.stringify(f)&&(t.reminders=h.length>0?h:void 0),this.completedInstancesChanges.size>0){let m=new Set(this.task.complete_instances||[]);if(this.completedInstancesChanges.forEach(g=>{m.has(g)?m.delete(g):m.add(g)}),t.complete_instances=Array.from(m),this.task.recurrence){let g={...this.task,...t},y=Xd(g,this.plugin.settings.maintainDueDateOffsetInRecurring);y.scheduled&&(t.scheduled=y.scheduled),y.due&&(t.due=y.due)}}let p=this.getUserFieldChanges();return Object.keys(p).length>0&&(t.customFrontmatter=p),Object.keys(t).length>0&&(t.dateModified=Ue()),t}getUserFieldChanges(){var r;let t={};try{let s=this.app.vault.getAbstractFileByPath(this.task.path);if(!s||!(s instanceof wr.TFile))return t;let i=this.app.metadataCache.getFileCache(s),a=(i==null?void 0:i.frontmatter)||{},o=((r=this.plugin.settings)==null?void 0:r.userFields)||[];for(let l of o){if(!l||!l.key)continue;let c=this.userFields[l.key],d=a[l.key];this.isDifferent(c,d)&&(t[l.key]=c==null||c===""?null:c)}}catch(s){console.error("Error comparing user fields:",s)}return t}isDifferent(t,r){let s=o=>o==null||o===""?null:o,i=s(t),a=s(r);return Array.isArray(i)||Array.isArray(a)?JSON.stringify(i)!==JSON.stringify(a):i!==a}async openTaskNote(){try{let t=this.app.vault.getAbstractFileByPath(this.task.path);if(!t){new wr.Notice(`Could not find task file: ${this.task.path}`);return}await this.app.workspace.getLeaf(!0).openFile(t),this.close()}catch(t){console.error("Failed to open task note:",t),new wr.Notice("Failed to open task note")}}async archiveTask(){try{let t=await this.plugin.taskService.toggleArchive(this.task);this.task=t,this.options.onTaskUpdated&&this.options.onTaskUpdated(t);let r=t.archived?"archived":"unarchived";new wr.Notice(`Task ${r} successfully`),this.close()}catch(t){console.error("Failed to archive task:",t),new wr.Notice("Failed to archive task")}}createActionButtons(t){let r=t.createDiv("button-container");r.createEl("button",{cls:"open-note-button",text:"Open note"}).addEventListener("click",async()=>{await this.openTaskNote()}),r.createEl("button",{cls:"archive-button",text:this.task.archived?"Unarchive":"Archive"}).addEventListener("click",async()=>{await this.archiveTask()}),r.createDiv("button-spacer"),r.createEl("button",{cls:"save-button",text:"Save"}).addEventListener("click",async()=>{await this.handleSave(),this.close()}),r.createEl("button",{cls:"cancel-button",text:"Cancel"}).addEventListener("click",()=>{this.close()})}renderProjectsList(){if(!this.projectsList||(this.projectsList.empty(),this.selectedProjectFiles.length===0))return;let t={metadataCache:this.app.metadataCache,workspace:this.app.workspace};this.selectedProjectFiles.forEach(r=>{let s=this.projectsList.createDiv({cls:"task-project-item"}),i=s.createDiv({cls:"task-project-info"}),a=i.createDiv({cls:"task-project-name clickable-project"}),o=`[[${r.path}|${r.name}]]`;if(by(a,[o],t),r.path!==r.name){let c=i.createDiv({cls:"task-project-path"});c.textContent=r.path}let l=s.createEl("button",{cls:"task-project-remove",text:"\xD7"});(0,wr.setTooltip)(l,"Remove project",{placement:"top"}),l.addEventListener("click",()=>{this.removeProject(r)})})}};var oi=require("obsidian");Ft();Ne();At();var ky=class extends oi.FuzzySuggestModal{constructor(e,t,r,s){super(e),this.plugin=t,this.onScheduleTask=r,this.defaultScheduleOptions=s,this.setPlaceholder("Type to search for an unscheduled task..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to schedule task"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText("Schedule Task"),this.titleEl.setAttribute("id","unscheduled-tasks-selector-title"),this.containerEl.setAttribute("aria-labelledby","unscheduled-tasks-selector-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),this.containerEl.addClass("unscheduled-tasks-selector-modal"),this.loadUnscheduledTasks()}async loadUnscheduledTasks(){try{let e=this.plugin.cacheManager.getAllTaskPaths(),t=Array.from(e).map(s=>this.plugin.cacheManager.getTaskInfo(s)),r=(await Promise.all(t)).filter(s=>s!==null);this.tasks=r.filter(s=>!s.archived&&!this.plugin.statusManager.isCompletedStatus(s.status)&&!s.scheduled)}catch(e){console.error("Error loading unscheduled tasks:",e),this.tasks=[]}}getItems(){return this.tasks.sort((e,t)=>{var a,o;if(e.due&&!t.due)return-1;if(!e.due&&t.due)return 1;if(e.due&&t.due){let l=e.due.localeCompare(t.due);if(l!==0)return l}let r={high:0,normal:1,low:2},s=(a=r[e.priority])!=null?a:1,i=(o=r[t.priority])!=null?o:1;return s!==i?s-i:e.title.localeCompare(t.title)})}getItemText(e){return e.title}renderSuggestion(e,t){let r=e.item;t.empty(),t.addClass("unscheduled-tasks-selector__suggestion");let s=t.createDiv({cls:"unscheduled-tasks-selector__content"}),i=s.createDiv({cls:"unscheduled-tasks-selector__title"});this.renderHighlightedText(i,e,r.title);let a=s.createDiv({cls:"unscheduled-tasks-selector__meta"});if(r.priority&&a.createSpan({text:r.priority.toUpperCase(),cls:`unscheduled-tasks-selector__priority priority-${(r.priority||"normal").toLowerCase()}`}),r.due){let c=a.createSpan({cls:"unscheduled-tasks-selector__due"}),d=this.plugin.settings.calendarViewSettings.timeFormat,u=zt(r.due)?C(Ut(r.due),d==="12"?"MMM d, h:mm a":"MMM d, HH:mm"):C(Ut(r.due),"MMM d");if(Ul(we(r.due))){c.addClass("overdue");let f=c.createSpan();(0,oi.setIcon)(f,"alert-triangle"),c.createSpan({text:` Overdue: ${u}`})}else if(oa(we(r.due))){c.addClass("due-today");let f=c.createSpan();(0,oi.setIcon)(f,"calendar"),c.createSpan({text:` Due today: ${u}`})}else c.setText(`Due: ${u}`)}if(r.timeEstimate&&a.createSpan({text:`~${r.timeEstimate}min`,cls:"unscheduled-tasks-selector__time-estimate"}),r.contexts&&r.contexts.length>0){let c=a.createSpan({cls:"unscheduled-tasks-selector__contexts"});c.textContent=`@${r.contexts.join(", @")}`}let o=Xr(r.projects||[]);if(o.length>0){let c=a.createSpan({cls:"unscheduled-tasks-selector__projects"});N6(c,o,this.plugin)}let l=s.createDiv({cls:"unscheduled-tasks-selector__schedule-icon"});(0,oi.setIcon)(l,"calendar-plus")}renderHighlightedText(e,t,r){e.empty();let s=t.match.matches;if(!s||s.length===0){e.textContent=r;return}let i=0;for(let a of s)a[0]>i&&e.appendText(r.slice(i,a[0])),e.createEl("mark",{text:r.slice(a[0],a[1]+1)}),i=a[1]+1;i<r.length&&e.appendText(r.slice(i))}onChooseItem(e,t){this.onScheduleTask(e,this.defaultScheduleOptions)}onNoSuggestion(){this.resultContainerEl.createDiv({cls:"unscheduled-tasks-selector__no-results"}).setText("No unscheduled tasks found. All tasks are either scheduled, completed, or archived.")}};function R6(n){return!!(n&&typeof n=="string"&&n.startsWith("[[")&&n.endsWith("]]"))}function N6(n,e,t){n.innerHTML="",e.forEach((r,s)=>{if(s>0){let a=document.createTextNode(", ");n.appendChild(a)}let i=document.createTextNode("+");if(n.appendChild(i),R6(r)){let a=r.slice(2,-2);n.createEl("a",{cls:"unscheduled-tasks-selector__project-link internal-link",text:a,attr:{"data-href":a}}).addEventListener("click",async l=>{l.preventDefault(),l.stopPropagation();let c=t.app.metadataCache.getFirstLinkpathDest(a,"");c instanceof oi.TFile?await t.app.workspace.getLeaf(!1).openFile(c):new oi.Notice(`Note "${a}" not found`)})}else{let a=document.createTextNode(r);n.appendChild(a)}})}var Ct=require("obsidian");At();Ne();var Ha=Ee(wn()),Ey=class extends Ct.Modal{constructor(t,r,s){super(t);this.selectedAttachments=[];this.plugin=r,this.options=s}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("timeblock-creation-modal"),new Ct.Setting(t).setName("Create timeblock").setHeading();let r=t.createDiv({cls:"timeblock-date-display"});r.createEl("strong",{text:"Date: "});let s=Bl(this.options.date);r.createSpan({text:s.toLocaleDateString()}),new Ct.Setting(t).setName("Title").setDesc("Title for your timeblock").addText(c=>{this.titleInput=c.inputEl,c.setPlaceholder("e.g., Deep work session").setValue(this.options.prefilledTitle||"").onChange(()=>this.validateForm()),window.setTimeout(()=>this.titleInput.focus(),100)});let i=t.createDiv({cls:"timeblock-time-container"});new Ct.Setting(i).setName("Start time").setDesc("When the timeblock starts").addText(c=>{this.startTimeInput=c.inputEl,c.setPlaceholder("09:00").setValue(this.options.startTime||"").onChange(()=>this.validateForm()),this.startTimeInput.type="time"}),new Ct.Setting(i).setName("End time").setDesc("When the timeblock ends").addText(c=>{this.endTimeInput=c.inputEl,c.setPlaceholder("11:00").setValue(this.options.endTime||"").onChange(()=>this.validateForm()),this.endTimeInput.type="time"}),new Ct.Setting(t).setName("Description").setDesc("Optional description for the timeblock").addTextArea(c=>{this.descriptionInput=c.inputEl,c.setPlaceholder("Focus on new features, no interruptions").setValue(""),this.descriptionInput.rows=3}),new Ct.Setting(t).setName("Color").setDesc("Optional color for the timeblock").addText(c=>{this.colorInput=c.inputEl,c.setPlaceholder("#3b82f6").setValue("#6366f1"),this.colorInput.type="color"}),new Ct.Setting(t).setName("Attachments").setDesc("Files or notes to link to this timeblock").addButton(c=>{c.setButtonText("Add Attachment").setTooltip("Select a file or note using fuzzy search").onClick(()=>{new ic(this.app,this.plugin,u=>{this.addAttachment(u)}).open()})}),this.attachmentsList=t.createDiv({cls:"timeblock-attachments-list"}),this.renderAttachmentsList();let a=t.createDiv({cls:"timeblock-modal-buttons"});a.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),a.createEl("button",{text:"Create timeblock",cls:"mod-cta timeblock-create-button"}).addEventListener("click",()=>this.handleSubmit()),this.validateForm()}validateForm(){var o,l,c;let t=this.contentEl.querySelector(".timeblock-create-button");if(!t)return;let r=(o=this.titleInput)==null?void 0:o.value.trim(),s=(l=this.startTimeInput)==null?void 0:l.value,i=(c=this.endTimeInput)==null?void 0:c.value,a=!!(r&&s&&i);if(a&&s&&i){let[d,u]=s.split(":").map(Number),[f,h]=i.split(":").map(Number),p=d*60+u;f*60+h<=p&&(a=!1)}t.disabled=!a,t.style.opacity=a?"1":"0.5"}async handleSubmit(){try{let t=this.titleInput.value.trim(),r=this.startTimeInput.value,s=this.endTimeInput.value,i=this.descriptionInput.value.trim(),a=this.colorInput.value;if(!t||!r||!s){new Ct.Notice("Please fill in all required fields");return}let o=this.selectedAttachments.map(c=>`[[${c.path}]]`),l={id:xA(),title:t,startTime:r,endTime:s};i&&(l.description=i),a&&(l.color=a),o.length>0&&(l.attachments=o),await this.saveTimeblockToDailyNote(l),this.plugin.emitter.trigger("data-changed"),new Ct.Notice(`Timeblock "${t}" created successfully`),this.close()}catch(t){console.error("Error creating timeblock:",t),new Ct.Notice("Failed to create timeblock. Check console for details.")}}async saveTimeblockToDailyNote(t){if(!(0,Ha.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let r=window.moment(this.options.date),s=(0,Ha.getAllDailyNotes)(),i=(0,Ha.getDailyNote)(r,s);if(!i&&(i=await(0,Ha.createDailyNote)(r),!i))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let a=await this.app.vault.read(i),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let f=a.substring(3,u);l=a.substring(u+3);try{o=(0,Ct.parseYaml)(f)||{}}catch(h){console.error("Error parsing existing frontmatter:",h),o={}}}}o.timeblocks||(o.timeblocks=[]),o.timeblocks.push(t);let d=`---
${(0,Ct.stringifyYaml)(o)}---${l}`;await this.app.vault.modify(i,d)}addAttachment(t){if(this.selectedAttachments.some(r=>r.path===t.path)){new Ct.Notice(`"${t.name}" is already attached`);return}this.selectedAttachments.push(t),this.renderAttachmentsList(),new Ct.Notice(`Added "${t.name}" as attachment`)}removeAttachment(t){this.selectedAttachments=this.selectedAttachments.filter(r=>r.path!==t.path),this.renderAttachmentsList(),new Ct.Notice(`Removed "${t.name}" from attachments`)}renderAttachmentsList(){if(this.attachmentsList.empty(),this.selectedAttachments.length===0){let t=this.attachmentsList.createDiv({cls:"timeblock-attachments-empty"});t.textContent="No attachments added yet";return}this.selectedAttachments.forEach(t=>{let r=this.attachmentsList.createDiv({cls:"timeblock-attachment-item"}),s=r.createDiv({cls:"timeblock-attachment-info"}),i=s.createSpan({cls:"timeblock-attachment-name"});if(i.textContent=t.name,t.path!==t.name){let o=s.createDiv({cls:"timeblock-attachment-path"});o.textContent=t.path}let a=r.createEl("button",{cls:"timeblock-attachment-remove",text:"\xD7"});(0,Ct.setTooltip)(a,"Remove attachment",{placement:"top"}),a.addEventListener("click",()=>{this.removeAttachment(t)})})}onClose(){let{contentEl:t}=this;t.empty()}};var ie=require("obsidian");or();var Sy=class{constructor(e){this.dragState=null;this.onReorder=e}setupDragAndDrop(e,t){this.initializeDragState(),e.addEventListener("dragstart",r=>this.handleDragStart(r,e,t)),e.addEventListener("dragend",()=>this.handleDragEnd(e)),e.addEventListener("dragover",r=>this.handleDragOver(r,e)),e.addEventListener("drop",r=>this.handleDrop(r,t))}setupGlobalHandlers(e){e.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation()}),e.addEventListener("drop",t=>{var i;if(t.preventDefault(),t.stopPropagation(),!((i=this.dragState)!=null&&i.draggedElement)||this.dragState.dropHandled)return;this.dragState.dropHandled=!0;let r=this.dragState.draggedIndex,s=this.calculateDropPosition();r!==s&&this.onReorder(r,s)})}initializeDragState(){this.dragState||(this.dragState={draggedElement:null,placeholder:null,draggedIndex:-1,dropHandled:!1})}handleDragStart(e,t,r){this.dragState&&(this.dragState.draggedElement=t,this.dragState.draggedIndex=r,this.dragState.dropHandled=!1,t.classList.add("filter-bar__view-item-container--dragging"),this.dragState.placeholder=t.cloneNode(!0),this.dragState.placeholder.classList.add("filter-bar__view-item-container--placeholder"),this.dragState.placeholder.classList.remove("filter-bar__view-item-container--dragging"),e.dataTransfer&&(e.dataTransfer.setData("text/plain",r.toString()),e.dataTransfer.effectAllowed="move"))}handleDragEnd(e){var t;this.dragState&&(e.classList.remove("filter-bar__view-item-container--dragging"),(t=this.dragState.placeholder)!=null&&t.parentNode&&this.dragState.placeholder.parentNode.removeChild(this.dragState.placeholder),this.resetDragState())}handleDragOver(e,t){var a;if(e.preventDefault(),!((a=this.dragState)!=null&&a.draggedElement)||this.dragState.draggedElement===t)return;let r=t.getBoundingClientRect(),i=e.clientY-r.top<r.height/2;t.parentNode&&this.dragState.placeholder&&(i?t.parentNode.insertBefore(this.dragState.placeholder,t):t.parentNode.insertBefore(this.dragState.placeholder,t.nextSibling))}handleDrop(e,t){var i,a;if(e.preventDefault(),!((i=this.dragState)!=null&&i.draggedElement)||this.dragState.dropHandled)return;this.dragState.dropHandled=!0;let r=this.dragState.draggedIndex,s=(a=this.calculateDropPosition())!=null?a:t;r!==s&&this.onReorder(r,s)}calculateDropPosition(){var r,s;if(!((s=(r=this.dragState)==null?void 0:r.placeholder)!=null&&s.parentNode))return-1;let e=this.dragState.placeholder.parentNode,t=0;for(let i of e.children){if(i===this.dragState.placeholder)break;i.classList.contains("filter-bar__view-item-container")&&!i.classList.contains("filter-bar__view-item-container--placeholder")&&t++}return t>this.dragState.draggedIndex&&t--,t}resetDragState(){this.dragState&&(this.dragState.draggedElement=null,this.dragState.placeholder=null,this.dragState.draggedIndex=-1,this.dragState.dropHandled=!1)}};var li=class{constructor(){this.events={}}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.events[e]=this.events[e].filter(r=>r!==t)}}emit(e,...t){this.events[e]&&this.events[e].forEach(r=>{r(...t)})}removeAllListeners(e){e?delete this.events[e]:this.events={}}};Ne();var Fr=class extends Error{constructor(t,r,s){super(t);this.field=r;this.nodeId=s;this.name="FilterValidationError"}},Ba=class extends Error{constructor(t,r){super(t);this.nodeId=r;this.name="FilterEvaluationError"}},Le=class{static generateId(){return`filter_${Date.now()}_${++this.idCounter}`}static deepCloneFilterQuery(e){return JSON.parse(JSON.stringify(e))}static validateFilterNode(e,t=!0){if(!e||typeof e!="object")throw new Fr("Filter node must be an object");if(!("id"in e)||!e.id||typeof e.id!="string")throw new Fr("Filter node must have a valid string ID",void 0,"id"in e?String(e.id):"unknown");if(e.type==="condition")this.validateCondition(e,t);else if(e.type==="group")this.validateGroup(e,t);else throw new Fr(`Unknown filter node type: ${e.type}`,void 0,e.id)}static validateCondition(e,t=!0){if(typeof e.property!="string")throw new Fr("Condition must have a valid property","property",e.id);if(t&&e.property==="")throw new Fr("Property must be selected","property",e.id);if(e.property==="")return;if(!e.operator||typeof e.operator!="string")throw new Fr("Condition must have a valid operator","operator",e.id);if(!this.getValidOperatorsForProperty(e.property).includes(e.operator))throw new Fr(`Operator '${e.operator}' is not valid for property '${e.property}'`,"operator",e.id);if(t&&this.operatorRequiresValue(e.operator)&&(e.value===null||e.value===void 0||e.value===""))throw new Fr(`Operator '${e.operator}' requires a value`,"value",e.id)}static validateGroup(e,t=!0){if(!e.conjunction||!["and","or"].includes(e.conjunction))throw new Fr("Group must have a valid conjunction (and/or)","conjunction",e.id);if(!Array.isArray(e.children))throw new Fr("Group must have a children array","children",e.id);e.children.forEach((r,s)=>{try{this.validateFilterNode(r,t)}catch(i){throw i instanceof Fr?new Fr(`Child ${s}: ${i.message}`,i.field,e.id):i}})}static getValidOperatorsForProperty(e){return typeof e=="string"&&e.startsWith("user:")?["is","is-not","contains","does-not-contain","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty","is-checked","is-not-checked","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal"]:{"":[],title:["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],path:["contains","does-not-contain","is-empty","is-not-empty"],status:["is","is-not","is-empty","is-not-empty"],priority:["is","is-not","is-empty","is-not-empty"],tags:["contains","does-not-contain","is-empty","is-not-empty"],contexts:["contains","does-not-contain","is-empty","is-not-empty"],projects:["contains","does-not-contain","is-empty","is-not-empty"],due:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],scheduled:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],completedDate:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],"file.ctime":["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],"file.mtime":["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],archived:["is-checked","is-not-checked"],timeEstimate:["is","is-not","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal"],recurrence:["is-empty","is-not-empty"],"status.isCompleted":["is-checked","is-not-checked"]}[e]||[]}static isFilterNodeComplete(e){try{return this.validateFilterNode(e,!0),!0}catch(t){return!1}}static operatorRequiresValue(e){return!["is-empty","is-not-empty","is-checked","is-not-checked"].includes(e)}static getTaskPropertyValue(e,t){switch(t){case"title":return e.title;case"path":return e.path;case"status":return e.status;case"priority":return e.priority;case"tags":return e.tags||[];case"contexts":return e.contexts||[];case"projects":return e.projects||[];case"due":return e.due;case"scheduled":return e.scheduled;case"completedDate":return e.completedDate;case"file.ctime":return e.dateCreated;case"file.mtime":return e.dateModified;case"archived":return e.archived;case"timeEstimate":return e.timeEstimate;case"recurrence":return e.recurrence;case"status.isCompleted":return;default:throw new Ba(`Unknown property: ${t}`)}}static applyOperator(e,t,r,s,i){try{switch(t){case"is":return this.isEqual(e,r,i);case"is-not":return!this.isEqual(e,r,i);case"contains":return this.contains(e,r);case"does-not-contain":return!this.contains(e,r);case"is-before":return this.isBefore(e,r);case"is-after":return this.isAfter(e,r);case"is-on-or-before":return this.isOnOrBefore(e,r);case"is-on-or-after":return this.isOnOrAfter(e,r);case"is-empty":return this.isEmpty(e);case"is-not-empty":return!this.isEmpty(e);case"is-checked":return e===!0;case"is-not-checked":return e!==!0;case"is-greater-than":return this.isGreaterThan(e,r);case"is-less-than":return this.isLessThan(e,r);case"is-greater-than-or-equal":return this.isGreaterThanOrEqual(e,r);case"is-less-than-or-equal":return this.isLessThanOrEqual(e,r);default:throw new Ba(`Unknown operator: ${t}`,s)}}catch(a){throw a instanceof Ba?a:new Ba(`Error applying operator '${t}': ${a.message}`,s)}}static isEqual(e,t,r){return r&&this.isDateProperty(r)&&typeof e=="string"&&typeof t=="string"&&(e||_T(t))?this.isEqualDate(e,t):Array.isArray(e)?Array.isArray(t)?e.some(s=>t.includes(s)):e.includes(t):Array.isArray(t)?t.includes(e):e===t}static contains(e,t){if(Array.isArray(e)){if(Array.isArray(t))return t.some(r=>e.some(s=>typeof s=="string"&&typeof r=="string"&&s.toLowerCase().includes(r.toLowerCase())));{let r=typeof t=="string"?t.toLowerCase():String(t!=null?t:"").toLowerCase();return e.some(s=>typeof s=="string"&&s.toLowerCase().includes(r))}}else if(typeof e=="string")return Array.isArray(t)?t.some(r=>typeof r=="string"&&e.toLowerCase().includes(r.toLowerCase())):typeof t=="string"&&e.toLowerCase().includes(t.toLowerCase());return!1}static isBefore(e,t){if(!e||!t)return!1;try{let r=jl(t);return la(e,r)}catch(r){return!1}}static isAfter(e,t){if(!e||!t)return!1;try{let r=jl(t);return la(r,e)}catch(r){return!1}}static isOnOrBefore(e,t){if(!e||!t)return!1;try{let r=jl(t);return la(e,r)||lr(we(e),we(r))}catch(r){return!1}}static isOnOrAfter(e,t){if(!e||!t)return!1;try{let r=jl(t);return la(r,e)||lr(we(e),we(r))}catch(r){return!1}}static isDateProperty(e){return["due","scheduled","completedDate","file.ctime","file.mtime"].includes(e)}static isEqualDate(e,t){try{let r=jl(t);return lr(we(e),we(r))}catch(r){return!1}}static isEmpty(e){return e==null?!0:typeof e=="string"?e.trim()==="":Array.isArray(e)?e.length===0?!0:e.every(t=>{if(typeof t!="string")return!1;let r=t.trim();return r.length===0||r==='""'||r==="''"}):!1}static isGreaterThan(e,t){let r=typeof e=="number"?e:parseFloat(e),s=typeof t=="number"?t:parseFloat(t);return isNaN(r)||isNaN(s)?!1:r>s}static isLessThan(e,t){let r=typeof e=="number"?e:parseFloat(e),s=typeof t=="number"?t:parseFloat(t);return isNaN(r)||isNaN(s)?!1:r<s}static isGreaterThanOrEqual(e,t){let r=typeof e=="number"?e:parseFloat(e),s=typeof t=="number"?t:parseFloat(t);return isNaN(r)||isNaN(s)?!1:r>=s}static isLessThanOrEqual(e,t){let r=typeof e=="number"?e:parseFloat(e),s=typeof t=="number"?t:parseFloat(t);return isNaN(r)||isNaN(s)?!1:r<=s}};Le.idCounter=0;Ne();em();ec();var fH=require("obsidian"),Dy=null,hH=null,xy=class{constructor(e,t,r){this.currentProperties=e;this.plugin=t;this.onUpdate=r}show(e){try{let t=new fH.Menu,r=this.getCachedProperties(),s=this.groupProperties(r);this.addPropertyGroup(t,"CORE PROPERTIES",s.core),this.addPropertyGroup(t,"ORGANIZATION",s.organization),s.user.length>0&&this.addPropertyGroup(t,"CUSTOM PROPERTIES",s.user),this.showMenu(t,e)}catch(t){console.error("PropertyVisibilityDropdown: Error showing menu:",t),this.plugin.app.workspace.trigger("notice","Failed to show properties menu")}}showMenu(e,t){e.showAtMouseEvent?e.showAtMouseEvent(t):e.showAtPosition?e.showAtPosition({x:t.clientX,y:t.clientY}):console.error("PropertyVisibilityDropdown: No menu show method available")}getCachedProperties(){return Dy&&hH===this.plugin||(Dy=this.computeAvailableProperties(),hH=this.plugin),Dy}groupProperties(e){let t={core:[],organization:[],user:[]};for(let r of e)t[r.category].push(r);return t}computeAvailableProperties(){let e=[];return e.push({id:"status",name:"Status Dot",category:"core"},{id:"priority",name:"Priority Dot",category:"core"},{id:"due",name:"Due Date",category:"core"},{id:"scheduled",name:"Scheduled Date",category:"core"},{id:"timeEstimate",name:"Time Estimate",category:"core"},{id:"totalTrackedTime",name:"Total Tracked Time",category:"core"},{id:"recurrence",name:"Recurrence",category:"core"},{id:"completedDate",name:"Completed Date",category:"core"},{id:"file.ctime",name:"Created Date",category:"core"},{id:"file.mtime",name:"Modified Date",category:"core"}),e.push({id:"projects",name:"Projects",category:"organization"},{id:"contexts",name:"Contexts",category:"organization"},{id:"tags",name:"Tags",category:"organization"}),this.addUserProperties(e),e}addUserProperties(e){try{let t=this.plugin.settings.userFields||[];for(let r of t)r.id&&r.displayName&&e.push({id:`user:${r.id}`,name:r.displayName,category:"user"})}catch(t){console.warn("PropertyVisibilityDropdown: Error loading user properties:",t)}}addPropertyGroup(e,t,r){if(r.length===0)return;e.addSeparator(),e.addItem(i=>{i.setTitle(t),i.setDisabled(!0)});let s=new Set(this.currentProperties);for(let i of r){let a=s.has(i.id);e.addItem(o=>{o.setTitle(i.name),o.setIcon(a?"check-square":"square"),o.onClick(()=>{this.toggleProperty(i.id)})})}}toggleProperty(e){try{let t=new Set(this.currentProperties);t.has(e)?t.delete(e):t.add(e);let r=Array.from(t);this.onUpdate(r)}catch(t){console.error("PropertyVisibilityDropdown: Error toggling property:",t)}}};var MS=class extends ie.Modal{constructor(e,t){super(e),this.onSubmit=t}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Save view"});let t=new ie.TextComponent(e).setPlaceholder("Enter view name...").onChange(s=>{this.name=s});t.inputEl.style.width="100%";let r=e.createDiv({cls:"modal-button-container"});new ie.ButtonComponent(r).setButtonText("Save").setCta().onClick(()=>{this.name&&(this.onSubmit(this.name),this.close())})}onClose(){this.contentEl.empty()}},hn=class extends li{constructor(t,r,s,i,a,o="right",l){var c,d;super();this.savedViews=[];this.activeSavedView=null;this.isLoadingSavedView=!1;this.isSettingSavedView=!1;this.temporaryVisibleProperties=null;this.viewsButtonAlignment="right";this.isUserTyping=!1;this.viewOptionsConfig=null;this.ignoreNextClick=!1;this.sectionStates={filterBox:!1,filters:!0,display:!0,viewOptions:!1};this.enableGroupExpandCollapse=!0;this.forceShowExpandCollapse=!1;this.app=t,this.plugin=r,this.container=s,this.currentQuery=Le.deepCloneFilterQuery(i),this.filterOptions=a,this.viewsButtonAlignment=o,this.enableGroupExpandCollapse=(c=l==null?void 0:l.enableGroupExpandCollapse)!=null?c:!0,this.forceShowExpandCollapse=(d=l==null?void 0:l.forceShowExpandCollapse)!=null?d:!1,this.viewType=l==null?void 0:l.viewType,this.dragDropHandler=new Sy((u,f)=>{this.emit("reorderViews",u,f)}),this.ensureValidFilterQuery(),this.debouncedEmitQueryChange=(0,ie.debounce)(()=>{!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.emit("queryChange",Le.deepCloneFilterQuery(this.currentQuery)),this.updateFilterToggleBadge()},300),this.debouncedHandleSearchInput=(0,ie.debounce)(()=>{this.handleSearchInput()},800),this.render(),this.updateUI(),this.setupClickOutsideHandlers()}ensureValidFilterQuery(){var t,r,s;if(!this.currentQuery||typeof this.currentQuery!="object"||this.currentQuery.type!=="group"||!Array.isArray(this.currentQuery.children)||typeof this.currentQuery.conjunction!="string"){let i=(t=this.currentQuery)!=null&&t.sortKey&&typeof this.currentQuery.sortKey=="string"?this.currentQuery.sortKey:"due",a=(r=this.currentQuery)!=null&&r.sortDirection&&typeof this.currentQuery.sortDirection=="string"?this.currentQuery.sortDirection:"asc",o=(s=this.currentQuery)!=null&&s.groupKey&&typeof this.currentQuery.groupKey=="string"?this.currentQuery.groupKey:"none";this.currentQuery={type:"group",id:Le.generateId(),conjunction:"and",children:[],sortKey:i,sortDirection:a,groupKey:o}}}updateQuery(t){this.currentQuery=Le.deepCloneFilterQuery(t),this.ensureValidFilterQuery(),this.detectActiveSavedView(),this.updateUI()}handleSearchInput(){var t;try{let r=((t=this.searchInput)==null?void 0:t.getValue().trim())||"";this.removeSearchConditions(),r&&this.addSearchConditionWithGrouping(r),this.updateFilterBuilder(),this.emitQueryChange(),setTimeout(()=>{this.isUserTyping=!1},1e3)}catch(r){console.error("Error handling search input:",r)}}removeSearchConditions(){if(!Array.isArray(this.currentQuery.children)){this.currentQuery.children=[];return}let t=this.currentQuery.children.findIndex(r=>r.type==="condition"&&r.property==="title"&&r.operator==="contains"&&r.id.startsWith("search_"));if(t!==-1&&(this.currentQuery.children.splice(t,1),this.currentQuery.children.length===1&&this.currentQuery.children[0].type==="group")){let r=this.currentQuery.children[0];this.currentQuery.children=r.children,this.currentQuery.conjunction=r.conjunction}}addSearchConditionWithGrouping(t){Array.isArray(this.currentQuery.children)||(this.currentQuery.children=[]);let r={type:"condition",id:`search_${Le.generateId()}`,property:"title",operator:"contains",value:t},s=this.currentQuery.children.filter(i=>!(i.type==="condition"&&i.property==="title"&&i.operator==="contains"&&i.id.startsWith("search_")));if(s.length===0)this.currentQuery.children=[r];else{let i={type:"group",id:Le.generateId(),conjunction:this.currentQuery.conjunction,children:s};this.currentQuery.children=[r,i],this.currentQuery.conjunction="and"}}updateSavedViews(t){this.savedViews=t,this.renderViewSelectorDropdown(),this.detectActiveSavedView()}detectActiveSavedView(){var r;if(this.isLoadingSavedView||this.isSettingSavedView)return;let t=null;for(let s=this.savedViews.length-1;s>=0;s--){let i=this.savedViews[s];if(this.queriesMatch(this.currentQuery,i.query)){t=i;break}}if(t&&((r=this.activeSavedView)==null?void 0:r.id)!==t.id){if(this.activeSavedView=t,this.temporaryVisibleProperties&&t.visibleProperties){let s=new Set(this.temporaryVisibleProperties),i=new Set(t.visibleProperties);s.size===i.size&&[...s].every(a=>i.has(a))&&(this.temporaryVisibleProperties=null)}this.updateViewSelectorButtonState(),this.emit("activeSavedViewChanged",t)}else!t&&this.activeSavedView&&(this.activeSavedView=null,this.updateViewSelectorButtonState(),this.emit("activeSavedViewChanged",null))}queriesMatch(t,r){let s=i=>{let a=Le.deepCloneFilterQuery(i);return delete a.sortKey,delete a.sortDirection,delete a.groupKey,a};try{let i=s(t),a=s(r);return JSON.stringify(i)===JSON.stringify(a)}catch(i){return console.warn("Error comparing queries:",i),!1}}getCurrentQuery(){return Le.deepCloneFilterQuery(this.currentQuery)}clearActiveSavedView(){this.activeSavedView=null,this.updateViewSelectorButtonState()}render(){try{typeof this.container.empty=="function"?this.container.empty():this.container.innerHTML="",typeof this.container.addClass=="function"?this.container.addClass("advanced-filter-bar"):this.container.classList&&this.container.classList.add("advanced-filter-bar"),this.renderTopControls()}catch(t){console.error("Error rendering FilterBar:",t),this.renderFallbackUI()}}renderFallbackUI(){try{if(this.container.children.length===0){typeof this.container.addClass=="function"?this.container.addClass("advanced-filter-bar"):this.container.classList&&this.container.classList.add("advanced-filter-bar");let t;typeof this.container.createDiv=="function"?t=this.container.createDiv({cls:"filter-bar-error"}):(t=document.createElement("div"),t.className="filter-bar-error",this.container.appendChild(t)),t.textContent="Filter bar temporarily unavailable"}}catch(t){console.error("Error rendering fallback FilterBar UI:",t)}}renderTopControls(){let t=this.container.createDiv("filter-bar__top-controls"),r=()=>{this.viewSelectorButton=new ie.ButtonComponent(t).setButtonText("Views").setClass("filter-bar__templates-button").setTooltip("Saved filter views").onClick(()=>{this.toggleViewSelectorDropdown()}),this.viewSelectorButton.buttonEl.addClass("clickable-icon");let u=this.viewSelectorButton.buttonEl.createDiv("filter-bar__chevron-container");(0,ie.setIcon)(u,"chevrons-up-down"),this.updateViewSelectorButtonState()},s=()=>{let u=new ie.ButtonComponent(t).setTooltip("Toggle filter").setClass("filter-bar__filter-toggle").onClick(()=>{this.toggleMainFilterBox()});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let f=u.buttonEl.createSpan({cls:"button-icon"});(0,ie.setIcon)(f,"list-filter");let h=u.buttonEl.createSpan({cls:"button-text",text:"Filters"});u.buttonEl.addEventListener("contextmenu",p=>{p.preventDefault(),p.stopPropagation(),this.hasActiveFilters()&&this.clearAllFilters()})},i=()=>{let u=new ie.ButtonComponent(t).setTooltip("Configure visible properties").setClass("filter-bar__properties-button").onClick(p=>{let m=p instanceof MouseEvent?p:new MouseEvent("click",{bubbles:!0,cancelable:!0});this.showPropertiesDropdown(m)});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let f=u.buttonEl.createSpan({cls:"button-icon"});(0,ie.setIcon)(f,"list");let h=u.buttonEl.createSpan({cls:"button-text",text:"Properties"})},a=()=>{this.searchInput=new ie.TextComponent(t).setPlaceholder("Search tasks..."),this.searchInput.inputEl.addClass("filter-bar__search-input"),(0,ie.setTooltip)(this.searchInput.inputEl,"Search task titles",{placement:"top"}),this.searchInput.onChange(()=>{this.isUserTyping=!0,this.debouncedHandleSearchInput()})},o=()=>{if(this.viewType==="advanced-calendar")return;let u=new ie.ButtonComponent(t).setTooltip("Sort and group options").setClass("filter-bar__sort-group-button").onClick(p=>{this.showSortGroupContextMenu(p)});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let f=u.buttonEl.createSpan({cls:"button-icon"});(0,ie.setIcon)(f,"arrow-up-down");let h=u.buttonEl.createSpan({cls:"button-text",text:"Sort"})},l=()=>{if(this.viewType==="subtask-widget")return;let u=new ie.ButtonComponent(t).setTooltip("Create new task").setClass("filter-bar__new-task-button").onClick(()=>{this.createNewTask()});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let f=u.buttonEl.createSpan({cls:"button-icon"});(0,ie.setIcon)(f,"plus");let h=u.buttonEl.createSpan({cls:"button-text",text:"New"})},c=()=>{let u=(this.currentQuery.groupKey||"none")!=="none";this.enableGroupExpandCollapse&&(u||this.forceShowExpandCollapse)&&(new ie.ButtonComponent(t).setIcon("list-tree").setTooltip("Expand All Groups").setClass("filter-bar__expand-groups").onClick(()=>this.emit("expandAllGroups")).buttonEl.addClass("clickable-icon"),new ie.ButtonComponent(t).setIcon("list-collapse").setTooltip("Collapse All Groups").setClass("filter-bar__collapse-groups").onClick(()=>this.emit("collapseAllGroups")).buttonEl.addClass("clickable-icon"))};this.viewsButtonAlignment==="left"?(r(),a(),o(),s(),i(),l()):(a(),o(),s(),i(),l(),r()),this.updateViewSelectorButtonState(),this.renderMainFilterBox(t);let d=this.viewsButtonAlignment==="left"?"filter-bar__view-selector-dropdown filter-bar__view-selector-dropdown--hidden filter-bar__view-selector-dropdown--left":"filter-bar__view-selector-dropdown filter-bar__view-selector-dropdown--hidden";this.viewSelectorDropdown=t.createDiv({cls:d}),this.renderViewSelectorDropdown()}renderMainFilterBox(t){this.mainFilterBox=t.createDiv("filter-bar__main-box"),this.sectionStates.filterBox||this.mainFilterBox.addClass("filter-bar__main-box--collapsed"),this.positionFilterBox(),this.renderFilterBuilder(this.mainFilterBox),this.renderViewOptions(this.mainFilterBox)}positionFilterBox(){if(!this.mainFilterBox)return;let t=this.container.querySelector(".filter-bar__filter-toggle");if(t){let r=this.container.getBoundingClientRect(),s=t.getBoundingClientRect(),i=this.mainFilterBox.getBoundingClientRect(),a=s.left-r.left,o=this.container.closest(".workspace-leaf");if(o){let l=o.getBoundingClientRect(),c=30,d=r.left+a+i.width,u=l.right-c;if(d>u){let f=d-u;a=a-f,a<0&&(a=0)}}this.mainFilterBox.style.left=`${a}px`}}setupClickOutsideHandlers(){this.abortController=new AbortController;let{signal:t}=this.abortController;document.addEventListener("click",r=>{this.handleDocumentClick(r)},{signal:t,passive:!0}),document.addEventListener("keydown",r=>{this.handleKeyDown(r)},{signal:t})}ignoreNextClickOutside(){this.ignoreNextClick=!0,this.ignoreClickTimeout&&window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=window.setTimeout(()=>{this.ignoreNextClick=!1,this.ignoreClickTimeout=void 0},100)}handleKeyDown(t){var r;if(t.key==="Escape"){if(this.sectionStates.filterBox){this.sectionStates.filterBox=!1,this.updateFilterBoxState(),t.preventDefault();return}this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(r=this.viewSelectorButton)!=null&&r.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"),t.preventDefault())}}handleDocumentClick(t){var s;if(this.ignoreNextClick){this.ignoreNextClick=!1;return}let r=t.target;if(r){if(this.sectionStates.filterBox&&this.mainFilterBox&&this.container){let i=this.container.querySelector(".filter-bar__filter-toggle"),a=this.container.contains(r),o=i&&i.contains(r);!a&&!o&&(this.sectionStates.filterBox=!1,this.updateFilterBoxState())}this.viewSelectorDropdown&&((s=this.viewSelectorButton)!=null&&s.buttonEl)&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&!this.viewSelectorButton.buttonEl.contains(r)&&!this.viewSelectorDropdown.contains(r)&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}}toggleMainFilterBox(){this.sectionStates.filterBox=!this.sectionStates.filterBox,this.positionFilterBox(),this.updateFilterBoxState()}updateFilterBoxState(){let t=this.container.querySelector(".filter-bar__main-box"),r=this.container.querySelector(".filter-bar__filter-toggle");t&&t.classList.toggle("filter-bar__main-box--collapsed",!this.sectionStates.filterBox),r&&r.classList.toggle("filter-bar__filter-toggle--active",this.sectionStates.filterBox)}async deleteView(t){await aa(this.app,{title:"Delete View",message:`Are you sure you want to delete the view "${t.name}"?`,isDestructive:!0})&&this.emit("deleteView",t.id)}renderViewSelectorDropdown(){if(this.viewSelectorDropdown)if(this.viewSelectorDropdown.empty(),this.savedViews.length===0)this.viewSelectorDropdown.createDiv({text:"No saved views",cls:"filter-bar__view-empty-message"});else{let t=this.viewSelectorDropdown.createDiv("filter-bar__view-section"),r=t.createDiv({text:"Saved views",cls:"filter-bar__view-section-header"});(0,ie.setTooltip)(r,"Your saved filter configurations",{placement:"top"}),this.savedViews.forEach((s,i)=>{let a=t.createDiv({cls:"filter-bar__view-item-container"});a.draggable=!0,a.setAttribute("data-view-index",i.toString());let o=a.createDiv({cls:"filter-bar__view-drag-handle"});(0,ie.setTooltip)(o,"Drag to reorder views",{placement:"top"});let l=new ie.ButtonComponent(a).setButtonText(s.name).setClass("filter-bar__view-item").setTooltip(`Load saved view: ${s.name}`).onClick(()=>{this.activeSavedView&&this.activeSavedView.id===s.id?this.clearAllFilters():this.loadSavedView(s)});this.activeSavedView&&this.activeSavedView.id===s.id&&(l.buttonEl.classList.add("filter-bar__view-item--active"),a.classList.add("filter-bar__view-item-container--active")),new ie.ButtonComponent(a).setIcon("trash-2").setClass("filter-bar__view-delete").setTooltip("Delete view").onClick(async()=>{await aa(this.app,{title:"Delete View",message:`Are you sure you want to delete the view "${s.name}"?`,isDestructive:!0})&&this.emit("deleteView",s.id)}),this.dragDropHandler.setupDragAndDrop(a,i)}),this.dragDropHandler.setupGlobalHandlers(t)}}renderFilterBuilder(t){let r=t.createDiv("filter-bar__section"),s=r.createDiv("filter-bar__section-header"),i=s.createDiv("filter-bar__section-header-main");i.createSpan({text:"Filter",cls:"filter-bar__section-title"}),(0,ie.setTooltip)(i,"Click to expand/collapse filter conditions",{placement:"top"}),this.activeSavedView&&i.createSpan({text:`(${this.activeSavedView.name})`,cls:"filter-bar__active-view-name"});let a=s.createDiv("filter-bar__section-header-actions");new ie.ButtonComponent(a).setIcon("eraser").setTooltip("Clear all filters and groups").setClass("filter-bar__clear-all-button").onClick(()=>{this.clearAllFiltersKeepModalOpen()}).buttonEl.addClass("clickable-icon"),new ie.ButtonComponent(a).setIcon("save").setTooltip("Save current filter as view").setClass("filter-bar__save-button").onClick(()=>{this.showSaveViewDialog()}).buttonEl.addClass("clickable-icon"),new ie.ButtonComponent(a).setIcon("x").setTooltip("Close filter modal").setClass("filter-bar__close-modal-button").onClick(()=>{this.closeFilterModal()}).buttonEl.addClass("clickable-icon");let d=r.createDiv("filter-bar__section-content");this.sectionStates.filters||d.addClass("filter-bar__section-content--collapsed"),this.filterBuilder=d.createDiv("filter-bar__filter-builder"),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),i.addEventListener("click",()=>{this.toggleSection("filters",s,d)})}renderFilterGroup(t,r,s,i,a){if(!r||typeof r!="object"){console.error("FilterBar: Invalid group object provided to renderFilterGroup");return}Array.isArray(r.children)||(r.children=[]);let o=t.createDiv("filter-bar__group"),l=o.createDiv("filter-bar__group-header"),c=l.createDiv("filter-bar__conjunction");(0,ie.setTooltip)(c,"Choose whether ALL or ANY of the conditions must match",{placement:"top"}),new ie.DropdownComponent(c).addOption("and","All").addOption("or","Any").setValue(r.conjunction||"and").onChange(f=>{r.conjunction=f,this.updateUI(),this.emitQueryChange()}),c.createSpan({text:"of the following are true:",cls:"filter-bar__conjunction-text"}),s>0&&i&&a!==void 0&&new ie.ButtonComponent(l).setIcon("trash-2").setClass("filter-bar__delete-button").setTooltip("Delete filter group").onClick(()=>{this.removeFilterGroup(i,a)});let d=o.createDiv("filter-bar__children");r.children.forEach((f,h)=>{this.renderFilterNode(d,f,r,h,s+1)});let u=o.createDiv("filter-bar__group-actions");new ie.ButtonComponent(u).setIcon("plus").setButtonText("Add filter").setClass("filter-bar__action-button").setClass("filter-bar__add-filter").setTooltip("Add a new filter condition").onClick(()=>{this.addFilterCondition(r)}),new ie.ButtonComponent(u).setIcon("plus-circle").setButtonText("Add filter group").setClass("filter-bar__action-button").setClass("filter-bar__add-group").setTooltip("Add a nested filter group").onClick(()=>{this.addFilterGroup(r)})}renderFilterNode(t,r,s,i,a){r.type==="condition"?this.renderFilterCondition(t,r,s,i,a):r.type==="group"&&this.renderFilterGroup(t,r,a,s,i)}renderFilterCondition(t,r,s,i,a){var f;let o=t.createDiv("filter-bar__condition");o.createSpan({text:i===0?"where":s.conjunction,cls:"filter-bar__condition-prefix"});let l=Object.fromEntries([["","Select..."],...Fl.map(h=>[h.id,h.label]),...((f=this.filterOptions.userProperties)==null?void 0:f.map(h=>[h.id,h.label]))||[]]),c=new ie.DropdownComponent(o).addOptions(l).setValue(r.property);(0,ie.setTooltip)(c.selectEl,"Choose which task property to filter by",{placement:"top"}),c.onChange(h=>{if(r.property=h,h!==""){let p=Fl.find(m=>m.id===h);if(p&&p.supportedOperators.length>0){let m=p.supportedOperators[0];r.operator=m;let g=Fd.find(y=>y.id===m);r.value=g!=null&&g.requiresValue?"":null}}this.updateUI(),this.emitQueryChange()});let d=new ie.DropdownComponent(o);this.updateOperatorOptions(d,r.property),d.setValue(r.operator),(0,ie.setTooltip)(d.selectEl,"Choose how to compare the property value",{placement:"top"}),d.onChange(h=>{r.operator=h,this.updateUI(),this.emitQueryChange()});let u=o.createDiv("filter-bar__value-container");this.renderValueInput(u,r),new ie.ButtonComponent(o).setIcon("trash-2").setClass("filter-bar__delete-button").setTooltip("Delete condition").onClick(()=>{this.removeFilterCondition(s,i)})}updateOperatorOptions(t,r){var i;t.selectEl.empty();let s=Fl.find(a=>a.id===r)||((i=this.filterOptions.userProperties)==null?void 0:i.find(a=>a.id===r));s&&s.supportedOperators.forEach(a=>{let o=Fd.find(l=>l.id===a);o&&t.addOption(o.id,o.label)})}renderValueInput(t,r){var a;t.empty();let s=Fl.find(o=>o.id===r.property)||((a=this.filterOptions.userProperties)==null?void 0:a.find(o=>o.id===r.property)),i=Fd.find(o=>o.id===r.operator);if(!(!s||!i||!i.requiresValue))switch(s.valueInputType){case"text":this.renderTextInput(t,r);break;case"select":this.renderSelectInput(t,r,s);break;case"date":this.renderDateInput(t,r);break;case"number":this.renderNumberInput(t,r);break}}renderTextInput(t,r){let s=new ie.TextComponent(t).setValue(String(r.value||"")).onChange(i=>{r.value=i||null,this.debouncedEmitQueryChange()});(0,ie.setTooltip)(s.inputEl,"Enter the value to filter by",{placement:"top"})}renderSelectInput(t,r,s){let i=new ie.DropdownComponent(t).addOption("","Select...");switch(s.id){case"status":this.filterOptions.statuses.forEach(a=>{i.addOption(a.value,a.label)});break;case"priority":this.filterOptions.priorities.forEach(a=>{i.addOption(a.value,a.label)});break;case"tags":this.filterOptions.tags.forEach(a=>{i.addOption(a,a)});break;case"contexts":this.filterOptions.contexts.forEach(a=>{i.addOption(a,a)});break;case"projects":this.filterOptions.projects.forEach(a=>{i.addOption(a,a)});break;case"path":this.filterOptions.folders.forEach(a=>{i.addOption(a,a)});break}if((0,ie.setTooltip)(i.selectEl,`Select a ${s.label.toLowerCase()} to filter by`,{placement:"top"}),s.id==="projects"){let a=String(r.value||"");if(a.startsWith("[[")&&a.endsWith("]]")){let o=a.substring(2,a.length-2);i.setValue(o)}else i.setValue(a)}else if(s.id==="path"){let a=String(r.value||"");i.setValue(a===""?"(Root)":a)}else i.setValue(String(r.value||""));i.onChange(a=>{s.id==="projects"&&a?r.value=`[[${a}]]`:s.id==="path"&&a==="(Root)"?r.value="":r.value=a||null,this.emitQueryChange()})}renderDateInput(t,r){let s=t.createDiv("filter-date-input-container"),i=new ie.TextComponent(s).setValue(String(r.value||"")).onChange(l=>{r.value=l||null,this.updateDateInputValidation(i,l);let c=(l||"").trim();(c===""||AT(c))&&this.debouncedEmitQueryChange()});i.setPlaceholder("today, 2024-12-25, next week..."),i.inputEl.addClass("filter-date-text-input"),(0,ie.setTooltip)(i.inputEl,"Enter a date using natural language or ISO format",{placement:"top"}),this.updateDateInputValidation(i,String(r.value||""));let a=s.createEl("button",{cls:"filter-date-picker-button"});(0,ie.setTooltip)(a,"Pick date & time",{placement:"top"}),(0,ie.setIcon)(a,"calendar"),a.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),new ts({currentValue:String(r.value||void 0),onSelect:d=>{i.setValue(d||""),r.value=d||null,this.updateDateInputValidation(i,i.getValue()),this.debouncedEmitQueryChange()}}).showAtElement(a)});let o=s.createEl("button",{cls:"filter-date-help-button",text:"?"});(0,ie.setTooltip)(o,"Show natural language date examples",{placement:"top"}),o.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),this.showNaturalLanguageDateHelp(o)})}updateDateInputValidation(t,r){let s=t.inputEl;s.removeClass("is-valid","is-invalid","is-empty");let i=r.trim();i===""?s.addClass("is-empty"):AT(i)?s.addClass("is-valid"):s.addClass("is-invalid")}showNaturalLanguageDateHelp(t){document.querySelectorAll(".filter-date-help-tooltip").forEach(l=>l.remove());let r=document.body.createDiv("filter-date-help-tooltip");r.createEl("h4",{text:"Natural Language Dates"});let s=r.createEl("ul");["today","tomorrow","yesterday","next week","last week","in 3 days","2 days ago","in 1 week","2 weeks ago","2024-12-25","2024-12-25T14:30:00"].forEach(l=>{s.createEl("li",{text:l})});let a=t.getBoundingClientRect();r.style.position="absolute",r.style.top=`${a.bottom+5}px`,r.style.left=`${a.left}px`,r.style.zIndex="1000";let o=()=>{r.remove(),document.removeEventListener("click",o)};setTimeout(()=>{document.addEventListener("click",o)},100)}renderNumberInput(t,r){let s=new ie.TextComponent(t).setValue(String(r.value||"")).onChange(i=>{r.value=i?parseFloat(i):null,this.debouncedEmitQueryChange()});s.inputEl.type="number",(0,ie.setTooltip)(s.inputEl,"Enter a numeric value to filter by",{placement:"top"})}renderDisplaySection(t){let r=t.createDiv("filter-bar__section"),s=r.createDiv("filter-bar__section-header"),i=s.createDiv("filter-bar__section-header-main");i.createSpan({text:"Display & Organization",cls:"filter-bar__section-title"}),(0,ie.setTooltip)(i,"Click to expand/collapse sorting and grouping options",{placement:"top"});let a=r.createDiv("filter-bar__section-content");this.sectionStates.display||a.addClass("filter-bar__section-content--collapsed"),this.displaySection=a;let o=this.displaySection.createDiv("filter-bar__display-controls"),l=o.createDiv("filter-bar__sort-container");l.createSpan({text:"Sort by:",cls:"filter-bar__label"}),new ie.ButtonComponent(l).setClass("filter-bar__sort-direction").setTooltip("Toggle sort direction").onClick(()=>{this.currentQuery.sortDirection=this.currentQuery.sortDirection==="asc"?"desc":"asc",this.emitImmediateQueryChange()});let d={...{due:"Due Date",scheduled:"Scheduled Date",priority:"Priority",title:"Title",dateCreated:"Created Date",tags:"Tags"}},u=this.filterOptions.userProperties||[];for(let T of u)!(T!=null&&T.id)||!(T!=null&&T.label)||typeof T.id=="string"&&T.id.startsWith("user:")&&(d[T.id]=`${T.label}`);let f=new ie.DropdownComponent(l).addOptions(d).setValue(this.currentQuery.sortKey||"due").onChange(T=>{this.currentQuery.sortKey=T,this.emitImmediateQueryChange()});(0,ie.setTooltip)(f.selectEl,"Choose how to sort tasks",{placement:"top"});let h=o.createDiv("filter-bar__group-container");h.createSpan({text:"Group by:",cls:"filter-bar__label"});let m={...{none:"None",status:"Status",priority:"Priority",context:"Context",project:"Project",due:"Due Date",scheduled:"Scheduled Date",tags:"Tags"}},g=this.filterOptions.userProperties||[];for(let T of g)!(T!=null&&T.id)||!(T!=null&&T.label)||typeof T.id=="string"&&T.id.startsWith("user:")&&(m[T.id]=T.label);let y=new ie.DropdownComponent(h).addOptions(m).setValue(this.currentQuery.groupKey||"none").onChange(T=>{this.currentQuery.groupKey=T,this.updateExpandCollapseButtons(),this.updateDisplaySection(),this.updateFilterToggleBadge(),this.emitQueryChange()});(0,ie.setTooltip)(y.selectEl,"Group tasks by a common property",{placement:"top"}),i.addEventListener("click",()=>{this.toggleSection("display",s,a)})}removeFilterGroup(t,r){t.children.splice(r,1),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete(),this.emitQueryChange()}renderViewOptions(t){let r=t.createDiv("filter-bar__section");this.viewOptionsContainer=r.createDiv("filter-bar__view-options-container"),this.populateViewOptions()}setViewOptions(t){this.viewOptionsConfig=t,this.populateViewOptions()}populateViewOptions(){if(!this.viewOptionsContainer)return;this.viewOptionsContainer.empty();let t=this.viewOptionsConfig;if(!t||t.length===0){this.viewOptionsContainer.addClass("filter-bar__section--hidden");return}this.viewOptionsContainer.removeClass("filter-bar__section--hidden");let r=this.viewOptionsContainer.createDiv("filter-bar__section-header"),s=r.createDiv("filter-bar__section-header-main");s.createSpan({text:"View Options",cls:"filter-bar__section-title"}),(0,ie.setTooltip)(s,"Click to expand/collapse view-specific options",{placement:"top"});let i=this.viewOptionsContainer.createDiv("filter-bar__section-content");this.sectionStates.viewOptions||i.addClass("filter-bar__section-content--collapsed"),t.forEach(a=>{let l=i.createDiv("filter-bar__view-option").createEl("label",{cls:"filter-bar__view-option-label"}),c=l.createEl("input",{type:"checkbox",cls:"filter-bar__view-option-checkbox"});c.checked=a.value,(0,ie.setTooltip)(c,`Toggle ${a.label.toLowerCase()}`,{placement:"top"}),l.createSpan({text:a.label,cls:"filter-bar__view-option-text"}),c.addEventListener("change",()=>{a.onChange(c.checked)})}),s.addEventListener("click",()=>{this.toggleSection("viewOptions",r,i)})}addFilterCondition(t){let r={type:"condition",id:Le.generateId(),property:"",operator:"contains",value:""};t.children.push(r),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete()}addFilterGroup(t){let r={type:"group",id:Le.generateId(),conjunction:"and",children:[]};t.children.push(r),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete()}removeFilterCondition(t,r){t.children.splice(r,1),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete(),this.emitQueryChange()}updateViewSelectorButtonState(){var t;(t=this.viewSelectorButton)!=null&&t.buttonEl&&(this.activeSavedView?this.viewSelectorButton.buttonEl.classList.add("filter-bar__templates-button--saved-view-active"):this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--saved-view-active"))}toggleViewSelectorDropdown(){if(!this.viewSelectorDropdown||!this.viewSelectorButton)return;let t=this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden");this.viewSelectorDropdown.classList.toggle("filter-bar__view-selector-dropdown--hidden",!t),t?this.viewSelectorButton.buttonEl.classList.add("filter-bar__templates-button--active"):this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active")}showSortGroupContextMenu(t){try{let r=new ie.Menu,i={...{due:"Due Date",scheduled:"Scheduled Date",priority:"Priority",title:"Title",dateCreated:"Created Date",tags:"Tags"}},a=this.filterOptions.userProperties||[];for(let o of a)!(o!=null&&o.id)||!(o!=null&&o.label)||typeof o.id=="string"&&o.id.startsWith("user:")&&(i[o.id]=`${o.label}`);if(r.addItem(o=>{o.setTitle("SORT"),o.setDisabled(!0)}),Object.entries(i).forEach(([o,l])=>{r.addItem(c=>{c.setTitle(l),this.currentQuery.sortKey===o&&c.setIcon("check"),c.onClick(()=>{this.currentQuery.sortKey=o,this.emitImmediateQueryChange(),this.updateDisplaySection()})})}),r.addSeparator(),r.addItem(o=>{o.setTitle("ORDER"),o.setDisabled(!0)}),r.addItem(o=>{o.setTitle("Ascending"),this.currentQuery.sortDirection==="asc"&&o.setIcon("check"),o.onClick(()=>{this.currentQuery.sortDirection="asc",this.emitImmediateQueryChange(),this.updateDisplaySection()})}),r.addItem(o=>{o.setTitle("Descending"),this.currentQuery.sortDirection==="desc"&&o.setIcon("check"),o.onClick(()=>{this.currentQuery.sortDirection="desc",this.emitImmediateQueryChange(),this.updateDisplaySection()})}),this.viewType!=="agenda"){let l={...{none:"None",status:"Status",priority:"Priority",context:"Context",project:"Project",due:"Due Date",scheduled:"Scheduled Date",tags:"Tags"}},c=this.filterOptions.userProperties||[];for(let d of c)!(d!=null&&d.id)||!(d!=null&&d.label)||typeof d.id=="string"&&d.id.startsWith("user:")&&(l[d.id]=d.label);r.addSeparator(),r.addItem(d=>{d.setTitle("GROUP"),d.setDisabled(!0)}),Object.entries(l).forEach(([d,u])=>{r.addItem(f=>{f.setTitle(u),this.currentQuery.groupKey===d&&f.setIcon("check"),f.onClick(()=>{this.currentQuery.groupKey=d,this.updateExpandCollapseButtons(),this.updateDisplaySection(),this.updateFilterToggleBadge(),this.emitQueryChange()})})})}r.showAtMouseEvent(t)}catch(r){console.error("FilterBar: Error showing sort/group context menu:",r)}}createNewTask(){try{this.plugin&&typeof this.plugin.openTaskCreationModal=="function"?this.plugin.openTaskCreationModal():this.plugin&&typeof this.plugin.createTask=="function"?this.plugin.createTask():this.emit("createNewTask")}catch(t){console.error("FilterBar: Error creating new task:",t)}}showPropertiesDropdown(t){try{new xy(this.getCurrentVisibleProperties(),this.plugin,this.handlePropertiesUpdate.bind(this)).show(t)}catch(r){console.error("FilterBar: Error showing properties dropdown:",r),this.plugin.app.workspace.trigger("notice","Failed to show properties menu")}}handlePropertiesUpdate(t){if(!Array.isArray(t)){console.warn("FilterBar: Invalid properties array received:",t);return}this.temporaryVisibleProperties=t,this.emit("propertiesChanged",t)}getCurrentVisibleProperties(){var t;return this.temporaryVisibleProperties||((t=this.activeSavedView)==null?void 0:t.visibleProperties)||this.plugin.settings.defaultVisibleProperties||this.getDefaultFallbackProperties()}getDefaultFallbackProperties(){return["status","priority","due","scheduled","projects","contexts","tags"]}getCurrentSavedView(){return this.activeSavedView}setActiveSavedView(t){if(this.isSettingSavedView=!0,this.activeSavedView=t,t&&this.temporaryVisibleProperties&&t.visibleProperties){let r=new Set(this.temporaryVisibleProperties),s=new Set(t.visibleProperties);r.size===s.size&&[...r].every(i=>s.has(i))&&(this.temporaryVisibleProperties=null)}this.updateViewSelectorButtonState(),this.emit("activeSavedViewChanged",t),this.isSettingSavedView=!1}toggleSection(t,r,s){this.sectionStates[t]=!this.sectionStates[t];let i=this.sectionStates[t];r.classList.toggle("filter-bar__section-header--collapsed",!i),s.classList.toggle("filter-bar__section-content--collapsed",!i)}showSaveViewDialog(){new MS(this.app,t=>{let r=this.getCurrentViewOptions(),s=this.getCurrentVisibleProperties();this.emit("saveView",{name:t,query:this.currentQuery,viewOptions:r,visibleProperties:s}),this.toggleViewSelectorDropdown()}).open()}getCurrentViewOptions(){if(!this.viewOptionsConfig||this.viewOptionsConfig.length===0)return;let t={};return this.viewOptionsConfig.forEach(r=>{t[r.id]=r.value}),t}clearAllFilters(){var t;this.currentQuery={type:"group",id:Le.generateId(),conjunction:"and",children:[],sortKey:this.currentQuery.sortKey||"due",sortDirection:this.currentQuery.sortDirection||"asc",groupKey:"none"},this.activeSavedView=null,this.temporaryVisibleProperties=null,this.searchInput&&this.searchInput.setValue(""),this.updateFilterBuilder(),this.updateDisplaySection(),this.updateViewSelectorButtonState(),this.emitQueryChange(),this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(t=this.viewSelectorButton)!=null&&t.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}clearAllFiltersKeepModalOpen(){var t;this.currentQuery={type:"group",id:Le.generateId(),conjunction:"and",children:[],sortKey:this.currentQuery.sortKey||"due",sortDirection:this.currentQuery.sortDirection||"asc",groupKey:"none"},this.activeSavedView=null,this.temporaryVisibleProperties=null,this.searchInput&&this.searchInput.setValue(""),this.updateFilterBuilder(),this.updateDisplaySection(),this.updateViewSelectorButtonState(),this.updateFilterToggleBadge(),setTimeout(()=>{this.emitQueryChangeIfComplete()},100),this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(t=this.viewSelectorButton)!=null&&t.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}closeFilterModal(){this.sectionStates.filterBox=!1,this.updateFilterBoxState()}loadSavedView(t){this.isLoadingSavedView=!0,this.currentQuery=Le.deepCloneFilterQuery(t.query),this.activeSavedView=t,this.temporaryVisibleProperties=null,this.render(),this.emitQueryChange(),t.viewOptions&&this.emit("loadViewOptions",t.viewOptions),t.visibleProperties&&this.emit("propertiesChanged",t.visibleProperties),this.emit("activeSavedViewChanged",t),this.toggleViewSelectorDropdown(),this.updateViewSelectorButtonState(),this.isLoadingSavedView=!1}updateUI(){this.syncSearchInput(),this.render(),this.updateViewSelectorButtonState(),this.updateFilterToggleBadge()}updateDisplaySection(){try{this.updateExpandCollapseButtons()}catch(t){console.error("Error updating display section:",t)}}updateExpandCollapseButtons(){try{let t=(this.currentQuery.groupKey||"none")!=="none",r=this.enableGroupExpandCollapse&&(t||this.forceShowExpandCollapse),s=this.container.querySelector(".filter-bar__expand-groups"),i=this.container.querySelector(".filter-bar__collapse-groups");s&&(s.style.display=r?"":"none"),i&&(i.style.display=r?"":"none")}catch(t){console.error("Error updating expand/collapse buttons:",t)}}updateFilterBuilder(){var t,r;try{if(this.filterBuilder&&this.filterBuilder.isConnected){let s=(t=this.searchInput)==null?void 0:t.getValue(),i=((r=this.searchInput)==null?void 0:r.inputEl)===document.activeElement;this.filterBuilder.empty(),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),this.searchInput&&s!==void 0&&(this.searchInput.setValue(s),i&&this.searchInput.inputEl.focus()),this.updateFilterBoxState()}}catch(s){console.error("Error updating filter builder:",s)}}updateFilterBuilderComplete(){var t,r;try{if(this.filterBuilder&&this.filterBuilder.isConnected){let s=(t=this.searchInput)==null?void 0:t.getValue(),i=((r=this.searchInput)==null?void 0:r.inputEl)===document.activeElement;this.filterBuilder.empty(),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),this.searchInput&&s!==void 0&&(this.searchInput.setValue(s),i&&this.searchInput.inputEl.focus()),this.updateFilterBoxState()}}catch(s){console.error("Error updating filter builder completely:",s),this.render()}}syncSearchInput(){if(!this.searchInput||this.isUserTyping)return;if(!this.currentQuery||!Array.isArray(this.currentQuery.children)){this.searchInput.setValue("");return}let t=this.currentQuery.children.find(r=>r.type==="condition"&&r.property==="title"&&r.operator==="contains"&&r.id.startsWith("search_"));this.searchInput.setValue(String((t==null?void 0:t.value)||""))}emitQueryChange(){!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.updateFilterToggleBadge(),this.emitQueryChangeIfComplete()}emitImmediateQueryChange(){!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.updateFilterToggleBadge(),this.emit("queryChange",Le.deepCloneFilterQuery(this.currentQuery))}emitQueryChangeIfComplete(){this.isQueryMeaningful(this.currentQuery)&&this.emit("queryChange",Le.deepCloneFilterQuery(this.currentQuery))}isQueryMeaningful(t){return t.children.length===0?!0:this.hasCompleteConditions(t)}hasCompleteConditions(t){for(let r of t.children)if(r.type==="condition"){if(Le.isFilterNodeComplete(r))return!0}else if(r.type==="group"&&this.hasCompleteConditions(r))return!0;return!1}updateFilterOptions(t){this.filterOptions=t,this.updateUI()}hasActiveFilters(){var t;try{if(this.activeSavedView)return!0;let r=this.isQueryMeaningful(this.currentQuery)&&this.currentQuery.children.length>0,s=((t=this.currentQuery.groupKey)!=null?t:"none")!=="none";return r||!!s}catch(r){return!1}}updateFilterToggleBadge(){let t=null;if(typeof this.container.querySelector=="function"&&(t=this.container.querySelector(".filter-bar__filter-toggle")),!t)return;let r=this.hasActiveFilters();t.classList.toggle("has-active-filters",r),(0,ie.setTooltip)(t,r?"Active filters \u2013 Click to modify, right-click to clear":"Toggle filter",{placement:"top"})}getCurrentFilterOptions(){return this.filterOptions}async forceRefreshOptions(t){let r=await t.getFilterOptions();this.updateFilterOptions(r)}destroy(){try{this.container&&this.container.isConnected&&this.container.empty(),this.removeAllListeners(),this.abortController&&(this.abortController.abort(),this.abortController=void 0),this.ignoreClickTimeout&&(window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=void 0)}catch(t){console.error("Error destroying FilterBar:",t);try{this.removeAllListeners(),this.abortController&&(this.abortController.abort(),this.abortController=void 0),this.ignoreClickTimeout&&(window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=void 0)}catch(r){console.error("Error during FilterBar cleanup fallback:",r)}}}};function Ua(n,e){var r;let t={viewId:n.getViewType(),debounceDelay:100,maxBatchSize:5,changeDetectionEnabled:!0,...e};if(n.performanceConfig=t,n.viewPerformanceService=n.plugin.viewPerformanceService,n.viewPerformanceService){let s={updateForTask:n.updateForTask.bind(n),refresh:n.refresh.bind(n),shouldRefreshForTask:(r=n.shouldRefreshForTask)==null?void 0:r.bind(n)};n.viewPerformanceService.registerView(t,s)}else console.warn(`[ViewOptimizations] ViewPerformanceService not available for ${t.viewId}`)}function ja(n){n.viewPerformanceService&&n.performanceConfig&&n.viewPerformanceService.unregisterView(n.performanceConfig.viewId)}function My(n,e){if(!n)return!0;let t=!q6(n.timeEntries,e.timeEntries);return n.due!==e.due||n.scheduled!==e.scheduled||n.status!==e.status||n.completedDate!==e.completedDate||n.recurrence!==e.recurrence||n.priority!==e.priority||n.title!==e.title||n.archived!==e.archived||n.path!==e.path||n.timeEstimate!==e.timeEstimate||n.totalTrackedTime!==e.totalTrackedTime||t}async function Py(n,e,t){var s,i,a;if(!n.taskElements){await((s=n.refresh)==null?void 0:s.call(n));return}let r=n.taskElements.get(e);switch(t){case"update":if(r){let o=await n.plugin.cacheManager.getTaskInfo(e);if(o){let l=((i=n.getCurrentVisibleProperties)==null?void 0:i.call(n))||["due","scheduled","projects","contexts","tags"];await z6(r,o,n.plugin,l)}else r.remove(),n.taskElements.delete(e)}break;case"delete":r&&(r.remove(),n.taskElements.delete(e));break;case"create":await((a=n.refresh)==null?void 0:a.call(n));break}}async function z6(n,e,t,r){try{let{updateTaskCard:s}=await Promise.resolve().then(()=>(Fs(),rd));s(n,e,t,r,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0}),n.classList.add("task-card--updated"),window.setTimeout(()=>{n.classList.remove("task-card--updated")},1e3)}catch(s){console.error("[ViewOptimizations] Error updating task element in place:",s)}}function q6(n,e){if(n===e)return!0;if(!n||!e)return n===e;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++){let r=n[t],s=e[t];if(r.startTime!==s.startTime||r.endTime!==s.endTime||r.description!==s.description||r.duration!==s.duration)return!1}return!0}Ne();At();At();var _y=class extends _e.ItemView{constructor(t,r){super(t);this.calendar=null;this.listeners=[];this.functionListeners=[];this.resizeObserver=null;this.resizeTimeout=null;this.filterBar=null;this.pendingRecurringUpdate=!1;this.lastRefreshTime=0;this.updateDebounceTimer=null;this.eventSourceRefreshTimer=null;this.pendingRefreshTasks=new Set;this.headerCollapsed=!0;this.plugin=r,this.showScheduled=this.plugin.settings.calendarViewSettings.defaultShowScheduled,this.showDue=this.plugin.settings.calendarViewSettings.defaultShowDue,this.showTimeEntries=this.plugin.settings.calendarViewSettings.defaultShowTimeEntries,this.showRecurring=this.plugin.settings.calendarViewSettings.defaultShowRecurring,this.showICSEvents=this.plugin.settings.calendarViewSettings.defaultShowICSEvents,this.showTimeblocks=this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.showAllDaySlot=!0,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"}}getViewType(){return kn}getDisplayText(){return"Advanced Calendar"}getIcon(){return"calendar-range"}async onOpen(){var i,a,o,l;await this.plugin.onReady(),await this.plugin.waitForMigration();let t=this.plugin.viewStateManager.getFilterState(kn);t?this.currentQuery=t:this.plugin.filterService&&(this.currentQuery=this.plugin.filterService.createDefaultQuery());let r=this.plugin.viewStateManager.getViewPreferences(kn);r&&(this.showScheduled=r.showScheduled,this.showDue=r.showDue,this.showTimeEntries=r.showTimeEntries,this.showRecurring=r.showRecurring,this.showICSEvents=(i=r.showICSEvents)!=null?i:this.plugin.settings.calendarViewSettings.defaultShowICSEvents,this.showTimeblocks=(a=r.showTimeblocks)!=null?a:this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.headerCollapsed=(o=r.headerCollapsed)!=null?o:!0,this.showAllDaySlot=(l=r.showAllDaySlot)!=null?l:!0);let s=async()=>{let c=this.contentEl;c.empty(),c.addClass("tasknotes-plugin"),c.addClass("advanced-calendar-view"),await this.renderView(),this.registerEvents(),await this.initializeCalendar()};await s(),this.contentEl.onWindowMigrated(s)}async renderView(){let{contentEl:t}=this;t.empty();let r=t.createDiv({cls:"advanced-calendar-view__container"});await this.createHeader(r),r.createDiv({cls:"advanced-calendar-view__calendar-container",attr:{id:"advanced-calendar"}})}async createHeader(t){let r=t.createDiv({cls:"advanced-calendar-view__header"}),i=r.createDiv({cls:"advanced-calendar-view__mobile-toggle"}).createEl("button",{text:this.headerCollapsed?"Show filters":"Hide filters",cls:"advanced-calendar-view__collapse-btn"});i.addEventListener("click",()=>{this.headerCollapsed=!this.headerCollapsed,i.textContent=this.headerCollapsed?"Show filters":"Hide filters",this.saveViewPreferences(),this.updateHeaderVisibility()});let o=r.createDiv({cls:`advanced-calendar-view__main-row ${this.headerCollapsed?"collapsed":"expanded"}`}).createDiv({cls:"filter-bar-container"});await this.waitForCacheReady();let l=await this.plugin.filterService.getFilterOptions();this.filterBar=new hn(this.app,this.plugin,o,this.currentQuery,l,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"advanced-calendar"});let c=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(c),this.filterBar.on("saveView",({name:d,query:u,viewOptions:f,visibleProperties:h})=>{let p=this.plugin.viewStateManager.saveView(d,u,f,h);this.filterBar.setActiveSavedView(p)}),this.filterBar.on("deleteView",d=>{this.plugin.viewStateManager.deleteView(d)}),this.filterBar.on("loadViewOptions",d=>{this.applyViewOptions(d)}),this.plugin.viewStateManager.on("saved-views-changed",d=>{var u;(u=this.filterBar)==null||u.updateSavedViews(d)}),this.filterBar.on("reorderViews",(d,u)=>{this.plugin.viewStateManager.reorderSavedViews(d,u)}),this.filterBar.on("manageViews",()=>{}),this.filterBar.on("queryChange",async d=>{this.currentQuery=d,await this.plugin.viewStateManager.setFilterState(kn,d),this.refreshEvents()}),this.setupViewOptions()}updateHeaderVisibility(){let t=this.contentEl.querySelector(".advanced-calendar-view__main-row");t&&(t.className=`advanced-calendar-view__main-row ${this.headerCollapsed?"collapsed":"expanded"}`),this.calendar&&this.calendar.setOption("headerToolbar",this.getHeaderToolbarConfig())}setupViewOptions(){if(!this.filterBar)return;let t=[{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents,onChange:r=>{this.showICSEvents=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"timeEntries",label:"Time entries",value:this.showTimeEntries,onChange:r=>{this.showTimeEntries=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"timeblocks",label:"Timeblocks",value:this.showTimeblocks,onChange:r=>{this.showTimeblocks=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"scheduled",label:"Scheduled dates",value:this.showScheduled,onChange:r=>{this.showScheduled=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"due",label:"Due dates",value:this.showDue,onChange:r=>{this.showDue=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"allDaySlot",label:"All-day slot",value:this.showAllDaySlot,onChange:r=>{this.showAllDaySlot=r,this.saveViewPreferences(),this.calendar&&this.calendar.setOption("allDaySlot",r)}}];if(!this.plugin.settings.calendarViewSettings.enableTimeblocking){let r=t.findIndex(s=>s.id==="timeblocks");r!==-1&&t.splice(r,1)}this.filterBar.setViewOptions(t)}getViewOptionsConfig(){let t=[{id:"scheduled",label:"Scheduled tasks",value:this.showScheduled},{id:"due",label:"Due dates",value:this.showDue},{id:"timeEntries",label:"Time entries",value:this.showTimeEntries},{id:"recurring",label:"Recurring tasks",value:this.showRecurring},{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents}];return this.plugin.settings.calendarViewSettings.enableTimeblocking&&t.push({id:"timeblocks",label:"Timeblocks",value:this.showTimeblocks}),t}onViewOptionChange(t,r){switch(t){case"scheduled":this.showScheduled=r;break;case"due":this.showDue=r;break;case"timeEntries":this.showTimeEntries=r;break;case"recurring":this.showRecurring=r;break;case"icsEvents":this.showICSEvents=r;break;case"timeblocks":this.showTimeblocks=r;break;case"allDaySlot":this.showAllDaySlot=r,this.calendar&&this.calendar.setOption("allDaySlot",r);break}this.saveViewPreferences(),this.refreshEvents(),this.setupViewOptions()}getHeaderToolbarConfig(){let t=this.contentEl.ownerDocument.defaultView||window;if(this.headerCollapsed&&t.innerWidth<=768)return!1;let r=this.contentEl.querySelector(".advanced-calendar-view__calendar-container");return{left:"prev,next today",center:(r?r.getBoundingClientRect().width:t.innerWidth)<=600?"":"title",right:"refreshICS multiMonthYear,dayGridMonth,timeGridWeek,timeGridCustom,timeGridDay,listWeek"}}getCustomButtons(){return{refreshICS:{text:"Refresh",hint:"Refresh Calendar Subscriptions",click:()=>{this.handleRefreshClick()}}}}async handleRefreshClick(){if(!this.plugin.icsSubscriptionService){new _e.Notice("ICS subscription service not available");return}try{await this.plugin.icsSubscriptionService.refreshAllSubscriptions(),new _e.Notice("All calendar subscriptions refreshed successfully"),this.refreshEvents()}catch(t){console.error("Error refreshing subscriptions:",t),new _e.Notice("Failed to refresh some calendar subscriptions")}}openScheduleTasksModal(){new ky(this.app,this.plugin,(r,s)=>{r&&this.scheduleTask(r,s)}).open()}async scheduleTask(t,r){try{let s;if(r!=null&&r.date)r.allDay?s=C(r.date,"yyyy-MM-dd"):r.time?s=C(r.date,"yyyy-MM-dd")+"T"+r.time:s=C(r.date,"yyyy-MM-dd")+"T09:00";else{let i=Ge();s=C(i,"yyyy-MM-dd")+"T09:00"}await this.plugin.taskService.updateProperty(t,"scheduled",s)}catch(s){console.error("Error scheduling task:",s)}}async initializeCalendar(){let t=this.contentEl.querySelector("#advanced-calendar");if(!t){console.error("Calendar element not found");return}let r=this.plugin.settings.calendarViewSettings;this.updateTodayHighlight();let s=this.getCustomButtons(),i=this.getHeaderToolbarConfig();this.calendar=new mg(t,{plugins:[qR,eN,tN,sN,aN],initialView:r.defaultView,headerToolbar:i,customButtons:s,buttonText:{multiMonthYear:"Y",dayGridMonth:"M",timeGridWeek:"W",timeGridDay:"D",listWeek:"List"},views:{timeGridCustom:{type:"timeGrid",duration:{days:r.customDayCount||3},buttonText:`${r.customDayCount||3}D`}},height:"100%",editable:!0,droppable:!0,selectable:!0,selectMirror:r.selectMirror,locale:this.getUserLocale(),firstDay:r.firstDay,weekNumbers:r.weekNumbers,weekends:r.showWeekends,nowIndicator:r.nowIndicator,navLinks:!0,navLinkDayClick:this.handleDateTitleClick.bind(this),slotMinTime:r.slotMinTime,slotMaxTime:r.slotMaxTime,scrollTime:r.scrollTime,slotDuration:r.slotDuration,slotLabelInterval:this.getSlotLabelInterval(r.slotDuration),allDaySlot:this.showAllDaySlot,eventTimeFormat:this.getTimeFormat(r.timeFormat),slotLabelFormat:this.getTimeFormat(r.timeFormat),select:this.handleDateSelect.bind(this),eventClick:this.handleEventClick.bind(this),eventDrop:this.handleEventDrop.bind(this),eventAllow:a=>!0,eventResize:this.handleEventResize.bind(this),drop:this.handleExternalDrop.bind(this),eventReceive:this.handleEventReceive.bind(this),eventDidMount:this.handleEventDidMount.bind(this),events:this.getCalendarEvents.bind(this)}),requestAnimationFrame(()=>{this.calendar&&(this.calendar.render(),this.setupResizeHandling(),this.refreshEvents())})}saveViewPreferences(){let t={showScheduled:this.showScheduled,showDue:this.showDue,showTimeEntries:this.showTimeEntries,showRecurring:this.showRecurring,showICSEvents:this.showICSEvents,showTimeblocks:this.showTimeblocks,headerCollapsed:this.headerCollapsed,showAllDaySlot:this.showAllDaySlot};this.plugin.viewStateManager.setViewPreferences(kn,t)}applyViewOptions(t){t.hasOwnProperty("showScheduled")&&(this.showScheduled=t.showScheduled),t.hasOwnProperty("showDue")&&(this.showDue=t.showDue),t.hasOwnProperty("showTimeEntries")&&(this.showTimeEntries=t.showTimeEntries),t.hasOwnProperty("showRecurring")&&(this.showRecurring=t.showRecurring),t.hasOwnProperty("showICSEvents")&&(this.showICSEvents=t.showICSEvents),t.hasOwnProperty("showTimeblocks")&&(this.showTimeblocks=t.showTimeblocks),t.hasOwnProperty("showAllDaySlot")&&(this.showAllDaySlot=t.showAllDaySlot,this.calendar&&this.calendar.setOption("allDaySlot",this.showAllDaySlot)),this.setupViewOptions(),this.refreshEvents()}setupResizeHandling(){if(!this.calendar)return;this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.functionListeners.forEach(a=>a()),this.functionListeners=[];let t=this.contentEl.ownerDocument.defaultView||window,r=()=>{this.resizeTimeout&&t.clearTimeout(this.resizeTimeout),this.resizeTimeout=t.setTimeout(()=>{this.calendar&&(this.calendar.updateSize(),this.updateHeaderVisibility())},150)};if(t.ResizeObserver){this.resizeObserver=new t.ResizeObserver(r);let a=this.contentEl.querySelector(".advanced-calendar-view__calendar-container");a&&this.resizeObserver.observe(a)}let s=this.plugin.app.workspace.on("layout-change",r);this.listeners.push(s),t.addEventListener("resize",r),this.functionListeners.push(()=>t.removeEventListener("resize",r));let i=this.plugin.app.workspace.on("active-leaf-change",a=>{a===this.leaf&&setTimeout(r,100)});this.listeners.push(i)}getSlotLabelInterval(t){switch(t){case"00:15:00":return"01:00:00";case"00:30:00":return"01:00:00";case"01:00:00":return"01:00:00";default:return"01:00:00"}}getUserLocale(){let t=this.plugin.settings.calendarViewSettings.locale;if(t&&t.trim()!=="")return t.trim();if(navigator.language)return navigator.language;if(navigator.languages&&navigator.languages.length>0)return navigator.languages[0];let r=navigator.userLanguage||navigator.browserLanguage;return r||"en"}getTimeFormat(t){return t==="12"?{hour:"numeric",minute:"2-digit",omitZeroMinute:!0,hour12:!0}:{hour:"2-digit",minute:"2-digit",hour12:!1}}async getCalendarEvents(){var s;let t=[];try{let i=await this.plugin.filterService.getGroupedTasks(this.currentQuery),a=[];for(let h of i.values())a.push(...h);let o=(s=this.calendar)==null?void 0:s.view,l=Ge(),c=(o==null?void 0:o.activeStart)||Sr(l),d=(o==null?void 0:o.activeEnd)||Hv(l),{utcStart:u,utcEnd:f}=xT(c,d);for(let h of a){if(h.recurrence){if(!h.scheduled)continue;if(this.showRecurring){let p=this.generateRecurringTaskInstances(h,u,f);t.push(...p)}}else{let p=!!h.scheduled,m=!!h.due;if(!p&&!m)continue;if(this.showScheduled&&p){let g=this.createScheduledEvent(h);g&&t.push(g)}if(this.showDue&&m){let g=this.createDueEvent(h);g&&t.push(g)}}if(this.showTimeEntries&&h.timeEntries){let p=this.createTimeEntryEvents(h);t.push(...p)}}if(this.showICSEvents&&this.plugin.icsSubscriptionService){let h=this.plugin.icsSubscriptionService.getAllEvents();for(let p of h){let m=this.createICSEvent(p);m&&t.push(m)}}}catch(i){console.error("Error getting calendar events:",i)}if(this.showTimeblocks&&this.plugin.settings.calendarViewSettings.enableTimeblocking)try{let i=await this.getTimeblockEvents();t.push(...i)}catch(i){console.error("Error getting timeblock events:",i)}let r=t.filter(i=>i.extendedProps?i.id?!0:(console.error("[AdvancedCalendarView] Event missing ID, filtering out:",i),!1):(console.error(`[AdvancedCalendarView] Event ${i.id} missing extendedProps, filtering out:`,i),!1));return r.length!==t.length&&console.error(`[AdvancedCalendarView] Filtered out ${t.length-r.length} malformed events`),r}async generateEventsForTask(t){var s;let r=[];try{let i=(s=this.calendar)==null?void 0:s.view,a=Ge(),o=(i==null?void 0:i.activeStart)||Sr(a),l=(i==null?void 0:i.activeEnd)||Hv(a),{utcStart:c,utcEnd:d}=xT(o,l);if(t.recurrence){if(t.scheduled&&this.showRecurring){let u=this.generateRecurringTaskInstances(t,c,d);r.push(...u)}}else{let u=!!t.scheduled,f=!!t.due;if(!u&&!f)return r;if(this.showScheduled&&u){let h=this.createScheduledEvent(t);h&&r.push(h)}if(this.showDue&&f){let h=this.createDueEvent(t);h&&r.push(h)}}if(this.showTimeEntries&&t.timeEntries){let u=this.createTimeEntryEvents(t);r.push(...u)}}catch(i){console.error(`Error generating events for task ${t.path}:`,i)}return r}createScheduledEvent(t){if(!t.scheduled)return null;let r=zt(t.scheduled),s=t.scheduled,i;if(r&&t.timeEstimate){let c=Ut(s),d=new Date(c.getTime()+t.timeEstimate*60*1e3);i=C(d,"yyyy-MM-dd'T'HH:mm")}else r||(i=this.calculateAllDayEndDate(s,t.timeEstimate));let a=this.plugin.priorityManager.getPriorityConfig(t.priority),o=(a==null?void 0:a.color)||"var(--color-accent)",l=this.plugin.statusManager.isCompletedStatus(t.status);return{id:`scheduled-${t.path}`,title:t.title,start:s,end:i,allDay:!r,backgroundColor:"transparent",borderColor:o,textColor:o,editable:!0,extendedProps:{taskInfo:t,eventType:"scheduled",isCompleted:l}}}createDueEvent(t){if(!t.due)return null;let r=zt(t.due),s=t.due,i;if(r){let d=Ut(s),u=new Date(d.getTime()+1800*1e3);i=C(u,"yyyy-MM-dd'T'HH:mm")}let a=this.plugin.priorityManager.getPriorityConfig(t.priority),o=(a==null?void 0:a.color)||"var(--color-orange)",l=this.hexToRgba(o,.15),c=this.plugin.statusManager.isCompletedStatus(t.status);return{id:`due-${t.path}`,title:`DUE: ${t.title}`,start:s,end:i,allDay:!r,backgroundColor:l,borderColor:o,textColor:o,editable:!1,extendedProps:{taskInfo:t,eventType:"due",isCompleted:c}}}hexToRgba(t,r){t=t.replace("#","");let s=parseInt(t.substring(0,2),16),i=parseInt(t.substring(2,4),16),a=parseInt(t.substring(4,6),16);return`rgba(${s}, ${i}, ${a}, ${r})`}createTimeEntryEvents(t){if(!t.timeEntries)return[];let r=this.plugin.statusManager.isCompletedStatus(t.status);return t.timeEntries.filter(s=>s.endTime).map((s,i)=>({id:`timeentry-${t.path}-${i}`,title:t.title,start:s.startTime,end:s.endTime,allDay:!1,backgroundColor:"var(--color-base-50)",borderColor:"var(--color-base-40)",textColor:"var(--text-on-accent)",editable:!1,extendedProps:{taskInfo:t,eventType:"timeEntry",isCompleted:r,timeEntryIndex:i}}))}createICSEvent(t){try{let r=this.plugin.icsSubscriptionService.getSubscriptions().find(a=>a.id===t.subscriptionId);if(!r||!r.enabled)return null;let s=this.hexToRgba(r.color,.2),i=r.color;return{id:t.id,title:t.title,start:t.start,end:t.end,allDay:t.allDay,backgroundColor:s,borderColor:i,textColor:i,editable:!1,extendedProps:{icsEvent:t,eventType:"ics",subscriptionName:r.name}}}catch(r){return console.error("Error creating ICS event:",r),null}}generateRecurringTaskInstances(t,r,s){if(!t.recurrence||!t.scheduled)return[];let i=[],a=zt(t.scheduled),o=this.getRecurringTime(t),l=we(t.scheduled),c=a?xr(t.scheduled):null,d=c?`${l}T${c}`:l,u=this.createNextScheduledEvent(t,d,l,c||"09:00");u&&i.push(u);let f=Zd(t,r,s);for(let h of f){let p=ue(h);if(p===l)continue;let m=a?`${p}T${o}`:p,g=this.createRecurringEvent(t,m,p,o);g&&i.push(g)}return i}getRecurringTime(t){if(t.recurrence&&typeof t.recurrence=="string"){let r=t.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(r&&r[1].includes("T")){let s=r[1].split("T")[1];if(s.length>=4){let i=s.slice(0,2),a=s.slice(2,4);return`${i}:${a}`}}}if(t.scheduled){let r=xr(t.scheduled);if(r)return r}return"09:00"}createNextScheduledEvent(t,r,s,i){var f;let a=zt(r),o;if(a&&t.timeEstimate){let h=Ut(r),p=new Date(h.getTime()+t.timeEstimate*60*1e3);o=C(p,"yyyy-MM-dd'T'HH:mm")}else a||(o=this.calculateAllDayEndDate(r,t.timeEstimate));let l=this.plugin.priorityManager.getPriorityConfig(t.priority),c=(l==null?void 0:l.color)||"var(--color-accent)",d=((f=t.complete_instances)==null?void 0:f.includes(s))||!1,u=d?"rgba(0,0,0,0.3)":"transparent";return{id:`next-scheduled-${t.path}-${s}`,title:t.title,start:r,end:o,allDay:!a,backgroundColor:u,borderColor:c,textColor:c,editable:!0,extendedProps:{taskInfo:t,eventType:"scheduled",isCompleted:d,isNextScheduledOccurrence:!0,instanceDate:s,recurringTemplateTime:i}}}createRecurringEvent(t,r,s,i){var f;let a=zt(r),o;if(a&&t.timeEstimate){let h=Ut(r),p=new Date(h.getTime()+t.timeEstimate*60*1e3);o=C(p,"yyyy-MM-dd'T'HH:mm")}else a||(o=this.calculateAllDayEndDate(r,t.timeEstimate));let l=this.plugin.priorityManager.getPriorityConfig(t.priority),c=(l==null?void 0:l.color)||"var(--color-accent)",d=((f=t.complete_instances)==null?void 0:f.includes(s))||!1,u=d?"rgba(0,0,0,0.3)":"transparent";return{id:`recurring-${t.path}-${s}`,title:t.title,start:r,end:o,allDay:!a,backgroundColor:u,borderColor:c,textColor:c,editable:!0,extendedProps:{taskInfo:t,eventType:"recurring",isCompleted:d,isRecurringInstance:!0,isPatternInstance:!0,instanceDate:s,recurringTemplateTime:i}}}calculateAllDayEndDate(t,r){if(!r||r<=0)return;let s=1440,i=Ut(t),a=Math.max(1,Math.ceil(r/s)),o=new Date(i.getTime()+a*s*60*1e3);return C(o,"yyyy-MM-dd")}handleDateSelect(t){var l;let{start:r,end:s,allDay:i,jsEvent:a}=t;this.plugin.settings.calendarViewSettings.enableTimeblocking&&this.showTimeblocks&&a&&a.shiftKey?this.handleTimeblockCreation(r,s,i):this.handleTaskCreation(r,s,i),(l=this.calendar)==null||l.unselect()}parseSlotDurationToMinutes(t){let r=t.split(":"),s=parseInt(r[0],10),i=parseInt(r[1],10);return s*60+i}handleTaskCreation(t,r,s){let i=s?C(t,"yyyy-MM-dd"):C(t,"yyyy-MM-dd'T'HH:mm"),a=Math.round((r.getTime()-t.getTime())/(1e3*60)),o=this.plugin.settings.calendarViewSettings.slotDuration,l=this.parseSlotDurationToMinutes(o),c=!s&&a>l,d={scheduled:i};s||c&&(d.timeEstimate=a),new ll(this.app,this.plugin,{prePopulatedValues:d}).open()}handleTimeblockCreation(t,r,s){if(s){new _e.Notice("Timeblocks must have specific times. Please select a time range in week or day view.");return}let i=C(t,"yyyy-MM-dd"),a=C(t,"HH:mm"),o=C(r,"HH:mm");new Ey(this.app,this.plugin,{date:i,startTime:a,endTime:o}).open()}async handleDateTitleClick(t){try{if(!(0,_n.appHasDailyNotesPluginLoaded)()){new _e.Notice("Daily Notes core plugin is not enabled. Please enable it in Settings > Core plugins.");return}let r=window.moment(t),s=(0,_n.getAllDailyNotes)(),i=(0,_n.getDailyNote)(r,s);if(!i)try{i=await(0,_n.createDailyNote)(r)}catch(a){let o=a instanceof Error?a.message:String(a);console.error("Failed to create daily note:",a),new _e.Notice(`Failed to create daily note: ${o}`);return}i&&await this.app.workspace.getLeaf(!1).openFile(i)}catch(r){let s=r instanceof Error?r.message:String(r);console.error("Failed to navigate to daily note:",r),new _e.Notice(`Failed to navigate to daily note: ${s}`)}}async getTimeblockEvents(){var r;let t=[];try{if(!(0,_n.appHasDailyNotesPluginLoaded)())return t;let s=(r=this.calendar)==null?void 0:r.view;if(!s)return t;let i=s.activeStart,a=s.activeEnd,o=(0,_n.getAllDailyNotes)(),l=ue(i),c=ue(a),d=new Date(`${l}T00:00:00.000Z`),u=new Date(`${c}T00:00:00.000Z`);for(let f=new Date(d);f<=u;f.setUTCDate(f.getUTCDate()+1)){let h=ue(f),p=new Date(`${h}T12:00:00`),m=window.moment(p),g=(0,_n.getDailyNote)(m,o);if(g)try{let y=await this.app.vault.read(g),T=ZT(y,g.path);for(let w of T){let b=DA(w,h);t.push(b)}}catch(y){console.error(`Error reading daily note ${g.path}:`,y)}}}catch(s){console.error("Error getting timeblock events:",s)}return t}handleEventClick(t){var u,f,h;if(!((u=t==null?void 0:t.event)!=null&&u.extendedProps)){console.warn("[AdvancedCalendarView] Event clicked without extendedProps");return}let{taskInfo:r,icsEvent:s,timeblock:i,eventType:a,subscriptionName:o,originalDate:l}=t.event.extendedProps,c=t.jsEvent;if(!(((h=(f=this.calendar)==null?void 0:f.view)==null?void 0:h.type)==="listWeek"&&r&&(a==="scheduled"||a==="due"||a==="recurring"))){if(a==="timeEntry"){r&&c.button===0&&!c.ctrlKey&&!c.metaKey&&new Fa(this.app,this.plugin,{task:r}).open();return}if(a==="timeblock"){this.showTimeblockInfo(i,t.event.start,l);return}if(a==="ics"){this.showICSEventInfo(s,o);return}c.ctrlKey||c.metaKey?this.app.vault.getAbstractFileByPath(r.path)instanceof _e.TFile&&this.app.workspace.openLinkText(r.path,"",!0):c.button===0&&new Fa(this.app,this.plugin,{task:r}).open()}}async handleEventDrop(t){var u;if(!((u=t==null?void 0:t.event)!=null&&u.extendedProps)){console.warn("[AdvancedCalendarView] Event dropped without extendedProps");return}let{taskInfo:r,timeblock:s,eventType:i,isRecurringInstance:a,isNextScheduledOccurrence:o,isPatternInstance:l,originalDate:c}=t.event.extendedProps;if(i==="timeEntry"||i==="ics"){t.revert();return}if(i==="timeblock"){await this.handleTimeblockDrop(t,s,c);return}let d=a||o||l;try{let f=t.event.start,h=t.event.allDay;if(o){let p;h?p=C(f,"yyyy-MM-dd"):p=C(f,"yyyy-MM-dd'T'HH:mm"),await this.plugin.taskService.updateProperty(r,"scheduled",p),new _e.Notice("Rescheduled next occurrence. This does not change the recurrence pattern.")}else if(l)await this.handlePatternInstanceDrop(r,f,h);else if(a){let p=we(r.scheduled),m;if(h)m=p,new _e.Notice("Updated recurring task to all-day. This affects all future instances.");else{let g=C(f,"HH:mm");m=`${p}T${g}`,new _e.Notice(`Updated recurring task time to ${g}. This affects all future instances.`)}await this.plugin.taskService.updateProperty(r,"scheduled",m)}else{let p;h?p=C(f,"yyyy-MM-dd"):p=C(f,"yyyy-MM-dd'T'HH:mm");let m=i==="scheduled"?"scheduled":"due";await this.plugin.taskService.updateProperty(r,m,p)}if(d){let p=r.recurrence;setTimeout(async()=>{let m=await this.plugin.cacheManager.getTaskInfo(r.path);m&&m.recurrence},1500)}}catch(f){console.error("Error updating task date:",f),t.revert()}}async handlePatternInstanceDrop(t,r,s){try{if(!t.recurrence||typeof t.recurrence!="string")throw new Error("Task does not have a valid RRULE string");let i=t.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/),a;if(i){let o=i[1],l;if(s)l=o.slice(0,8);else{let c=o.slice(0,8),d=String(r.getHours()).padStart(2,"0"),u=String(r.getMinutes()).padStart(2,"0");l=`${c}T${d}${u}00Z`}a=t.recurrence.replace(/DTSTART:[^;]+/,`DTSTART:${l}`),new _e.Notice("Updated recurring pattern time. All future instances now appear at this time.")}else{let o=CA(t,r,s);if(!o)throw new Error("Failed to add DTSTART to recurrence rule");a=o,new _e.Notice("Added time information to recurring pattern. All future instances now appear at this time.")}await this.plugin.taskService.updateProperty(t,"recurrence",a)}catch(i){throw console.error("Error updating pattern instance time:",i),i}}async handleTimeblockDrop(t,r,s){try{let i=t.event.start,a=t.event.end,o=C(i,"yyyy-MM-dd"),l=C(i,"HH:mm"),c=C(a,"HH:mm");await XT(this.app,r.id,s,o,l,c),this.refreshEvents(),s!==o?new _e.Notice(`Moved timeblock "${r.title}" to ${o}`):new _e.Notice(`Updated timeblock "${r.title}" time`)}catch(i){console.error("Error moving timeblock:",i),new _e.Notice(`Failed to move timeblock: ${i.message}`),t.revert()}}async handleEventResize(t){var o;if(!((o=t==null?void 0:t.event)!=null&&o.extendedProps)){console.warn("[AdvancedCalendarView] Event resized without extendedProps");return}let{taskInfo:r,timeblock:s,eventType:i,originalDate:a}=t.event.extendedProps;if(i==="timeblock"){await this.handleTimeblockResize(t,s,a);return}if(i!=="scheduled"&&i!=="recurring"){t.revert();return}try{let l=t.event.start,c=t.event.end;if(l&&c){let d=Math.round((c.getTime()-l.getTime())/6e4);await this.plugin.taskService.updateProperty(r,"timeEstimate",d)}}catch(l){console.error("Error updating task duration:",l),t.revert()}}async handleTimeblockResize(t,r,s){try{let i=t.event.start,a=t.event.end;if(!i||!a){t.revert();return}let o=C(i,"HH:mm"),l=C(a,"HH:mm"),[c,d]=o.split(":").map(Number),[u,f]=l.split(":").map(Number),h=c*60+d;if(u*60+f<=h){new _e.Notice("End time must be after start time"),t.revert();return}await XT(this.app,r.id,s,s,o,l),this.refreshEvents(),new _e.Notice(`Updated timeblock "${r.title}" duration`)}catch(i){console.error("Error resizing timeblock:",i),new _e.Notice(`Failed to resize timeblock: ${i.message}`),t.revert()}}async handleExternalDrop(t){try{let r;if(t.dataTransfer&&(r=t.dataTransfer.getData("text/plain")||t.dataTransfer.getData("application/x-task-path")),!r&&t.draggedEl&&(r=t.draggedEl.dataset.taskPath),!r){console.warn("No task path found in drop data",t);return}let s=await this.plugin.cacheManager.getTaskInfo(r);if(!s){console.warn("Task not found:",r);return}let i=t.date;if(!i){console.warn("No drop date provided");return}let a;t.allDay?a=C(i,"yyyy-MM-dd"):a=C(i,"yyyy-MM-dd'T'HH:mm"),await this.plugin.taskService.updateProperty(s,"scheduled",a);let o=this.plugin.settings.calendarViewSettings.timeFormat,l=t.allDay?"MMM d, yyyy":o==="12"?"MMM d, yyyy h:mm a":"MMM d, yyyy HH:mm";new _e.Notice(`Task "${s.title}" scheduled for ${C(i,l)}`),t.draggedEl&&t.draggedEl.remove()}catch(r){console.error("Error handling external drop:",r),new _e.Notice("Failed to schedule task"),t.draggedEl&&t.draggedEl.remove()}}handleEventReceive(t){t.event.remove()}handleEventDidMount(t){var m,g;if(!((m=t==null?void 0:t.event)!=null&&m.extendedProps)){console.warn("[AdvancedCalendarView] Event mounted without extendedProps:",t==null?void 0:t.event);return}let r=t.event.extendedProps||{},{taskInfo:s,icsEvent:i,timeblock:a,eventType:o,isCompleted:l=!1,isRecurringInstance:c=!1,instanceDate:d,subscriptionName:u}=r,f=t.view.type.startsWith("list");if(f&&o==="ics"){t.el.setAttribute("data-event-type","ics"),t.el.setAttribute("data-ics-event","true");return}if(f&&s&&(o==="scheduled"||o==="due"||o==="recurring"||o==="timeEntry")){this.enhanceListViewTaskEvent(t,s,o,l);return}if(t.el.setAttribute("data-event-type",o||"unknown"),o==="ics"){t.el.setAttribute("data-ics-event","true"),t.el.setAttribute("data-subscription",u||"Unknown"),t.el.classList.add("fc-ics-event"),(0,_e.setTooltip)(t.el,`${(i==null?void 0:i.title)||"Event"} (from ${u||"Calendar subscription"})`,{placement:"top"}),t.el.addEventListener("contextmenu",y=>{y.preventDefault(),y.stopPropagation(),this.showICSEventContextMenu(y,i,u)});return}if(o==="timeblock"){t.el.setAttribute("data-timeblock-id",(a==null?void 0:a.id)||""),t.el.style.borderStyle="solid",t.el.style.borderWidth="2px",t.el.classList.add("fc-timeblock-event"),t.event.setProp&&t.event.setProp("editable",!0);let y=((g=a==null?void 0:a.attachments)==null?void 0:g.length)||0,T=`${(a==null?void 0:a.title)||"Timeblock"}${a!=null&&a.description?` - ${a.description}`:""}${y>0?` (${y} attachment${y>1?"s":""})`:""}`;(0,_e.setTooltip)(t.el,T,{placement:"top"});return}if(!s||!s.path)return;if(t.el.setAttribute("data-task-path",s.path),t.el.classList.add("fc-task-event"),s.tags&&s.tags.length>0&&s.tags.forEach(y=>{let T=y.replace(/[^a-zA-Z0-9-_]/g,"");T&&t.el.classList.add(`fc-tag-${T}`)}),t.event.setProp)switch(o){case"scheduled":case"recurring":t.event.setProp("editable",!0);break;case"due":case"timeEntry":t.event.setProp("editable",!1);break;default:t.event.setProp("editable",!0)}let{isNextScheduledOccurrence:h=!1,isPatternInstance:p=!1}=r;if(h?(t.el.style.borderStyle="solid",t.el.style.borderWidth="2px",t.el.setAttribute("data-next-scheduled","true"),t.el.classList.add("fc-next-scheduled-event"),l&&(t.el.style.opacity="0.6")):p?(t.el.style.borderStyle="dashed",t.el.style.borderWidth="2px",t.el.style.opacity=l?"0.4":"0.7",t.el.setAttribute("data-pattern-instance","true"),t.el.classList.add("fc-pattern-instance-event")):c&&(t.el.style.borderStyle="dashed",t.el.style.borderWidth="2px",t.el.setAttribute("data-recurring","true"),t.el.classList.add("fc-recurring-event"),l&&(t.el.style.opacity="0.6")),l){let y=t.el.querySelector(".fc-event-title, .fc-event-title-container");y?y.style.textDecoration="line-through":t.el.style.textDecoration="line-through",t.el.classList.add("fc-completed-event")}s&&(o!=="ics"&&t.el.addEventListener("mouseover",y=>{this.plugin.app.vault.getAbstractFileByPath(s.path)&&this.plugin.app.workspace.trigger("hover-link",{event:y,source:"tasknotes-advanced-calendar",hoverParent:t.el,targetEl:t.el,linktext:s.path,sourcePath:s.path})}),t.el.addEventListener("contextmenu",y=>{if(y.preventDefault(),y.stopPropagation(),o==="timeEntry"){let{timeEntryIndex:T}=r;this.showTimeEntryContextMenu(y,s,T)}else{let{isNextScheduledOccurrence:T,isPatternInstance:w}=r,b;if((c||T||w)&&d)b=qe(d);else{let E=t.event.start;if(E){let S=C(E,"yyyy-MM-dd");b=qe(S)}else b=Ge()}this.showTaskContextMenuForEvent(y,s,b)}}))}registerEvents(){this.functionListeners.forEach(o=>o()),this.functionListeners=[];let t=this.plugin.emitter.on(ar,async()=>{if(this.refreshEvents(),this.filterBar){let o=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(o)}});this.listeners.push(t);let r=this.plugin.emitter.on($s,async()=>{this.refreshEvents()});this.listeners.push(r),Ua(this,{viewId:kn,debounceDelay:200,maxBatchSize:20,changeDetectionEnabled:!0});let s=this.plugin.filterService.on("data-changed",()=>{this.refreshEvents()});if(this.functionListeners.push(s),this.plugin.icsSubscriptionService){let o=this.plugin.icsSubscriptionService.on("data-changed",()=>{this.refreshEvents()});this.functionListeners.push(o)}let i=this.plugin.emitter.on(TT,o=>{this.showTimeblocks=o&&this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.refreshEvents(),this.setupViewOptions()});this.listeners.push(i);let a=this.plugin.emitter.on("settings-changed",()=>{this.updateTodayHighlight(),this.updateCustomViewConfiguration()});this.listeners.push(a)}updateCustomViewConfiguration(){if(!this.calendar)return;let t=this.plugin.settings.calendarViewSettings;this.calendar.setOption("views",{timeGridCustom:{type:"timeGrid",duration:{days:t.customDayCount||3},buttonText:`${t.customDayCount||3} D`}}),this.calendar.setOption("headerToolbar",this.getHeaderToolbarConfig())}getCurrentVisibleProperties(){var t;return(t=this.filterBar)==null?void 0:t.getCurrentVisibleProperties()}enhanceListViewTaskEvent(t,r,s,i){let{el:a}=t;a.classList.add("fc-task-event","fc-list-task-card"),a.setAttribute("data-task-path",r.path),a.setAttribute("data-event-type",s);let o=this.plugin.priorityManager.getPriorityConfig(r.priority);o&&a.style.setProperty("--priority-color",o.color);let l=this.plugin.statusManager.getStatusConfig(r.status);l&&a.style.setProperty("--current-status-color",l.color);let c=this.getCurrentVisibleProperties()||["due","scheduled","projects","contexts","tags"],d=a.querySelector(".fc-list-event-title, .fc-event-title"),u=a.querySelector(".fc-list-event-graphic");if(u&&l){u.innerHTML="";let f=u.createEl("div",{cls:"fc-list-event-status-dot"});f.style.width="10px",f.style.height="10px",f.style.borderRadius="50%",f.style.border=`2px solid ${l.color}`,f.style.backgroundColor=i?l.color:"transparent",f.setAttribute("aria-label",`Status: ${l.label||r.status}`)}if(d){for(;d.firstChild;)d.removeChild(d.firstChild);let f=d.createEl("div",{cls:"fc-list-task-title-row"});if(r.priority&&o&&(!c||c.includes("priority"))){let m=f.createEl("span",{cls:"fc-list-task-priority-dot",attr:{"aria-label":`Priority: ${o.label}`}});m.style.borderColor=o.color,m.addEventListener("click",g=>{g.stopPropagation(),new Zs({currentValue:r.priority,onSelect:async T=>{try{await this.plugin.updateTaskProperty(r,"priority",T)}catch(w){console.error("Error updating priority:",w),new _e.Notice("Failed to update priority")}},plugin:this.plugin}).show(g)})}if(r.recurrence){let m=f.createEl("span",{cls:"fc-list-task-recurring-indicator",attr:{"aria-label":"Recurring task"}});(0,_e.setIcon)(m,"rotate-ccw"),m.addEventListener("click",g=>{g.stopPropagation(),new Ks({currentValue:typeof r.recurrence=="string"?r.recurrence:void 0,onSelect:async T=>{try{await this.plugin.updateTaskProperty(r,"recurrence",T||void 0)}catch(w){console.error("Error updating recurrence:",w),new _e.Notice("Failed to update recurrence")}},app:this.plugin.app}).show(g)})}let h=f.createEl("span",{cls:"fc-list-task-title",text:r.title});i&&(h.style.textDecoration="line-through",h.style.opacity="0.7");let p=d.createEl("div",{cls:"fc-list-task-metadata"});this.addTaskMetadataToListEvent(p,r,c,s)}this.addTaskInteractionsToListEvent(a,r)}renderListViewProperty(t,r,s){var o;let i=null;switch(r){case"due":i=s.due;break;case"scheduled":i=s.scheduled;break;case"projects":i=s.projects;break;case"contexts":i=s.contexts;break;case"tags":i=s.tags;break;case"timeEstimate":i=s.timeEstimate;break;case"totalTrackedTime":i=s.totalTrackedTime;break;case"recurrence":i=s.recurrence;break;case"completedDate":i=s.completedDate;break;case"file.ctime":i=s.dateCreated;break;case"file.mtime":i=s.dateModified;break;default:if(r.startsWith("user:")){let l=r.slice(5),c=(o=this.plugin.settings.userFields)==null?void 0:o.find(d=>d.id===l);c!=null&&c.key&&(i=s[c.key])}else s.customProperties&&r in s.customProperties&&(i=s.customProperties[r]);break}if(!this.hasValidValue(i))return null;let a=t.createEl("span",{cls:`fc-list-task-${r.replace(":","-").replace(".","-")}`});return this.renderPropertyValue(a,r,i,s),a}hasValidValue(t){return t!=null&&!(Array.isArray(t)&&t.length===0)&&!(typeof t=="string"&&t.trim()==="")}renderPropertyValue(t,r,s,i){var a;switch(r){case"due":this.renderDueDateProperty(t,s,i);break;case"scheduled":this.renderScheduledDateProperty(t,s,i);break;case"projects":this.renderProjectsProperty(t,s);break;case"contexts":this.renderContextsProperty(t,s);break;case"tags":this.renderTagsProperty(t,s);break;case"timeEstimate":t.textContent=`${this.plugin.formatTime(s)} estimated`;break;case"totalTrackedTime":s>0&&(t.textContent=`${this.plugin.formatTime(s)} tracked`);break;case"recurrence":t.textContent=`Recurring: ${this.getRecurrenceDisplayText(s)}`;break;case"completedDate":t.textContent=`Completed: ${this.formatDateForDisplay(s)}`;break;case"file.ctime":t.textContent=`Created: ${this.formatDateForDisplay(s)}`;break;case"file.mtime":t.textContent=`Modified: ${this.formatDateForDisplay(s)}`;break;default:if(r.startsWith("user:")){let o=r.slice(5),l=(a=this.plugin.settings.userFields)==null?void 0:a.find(d=>d.id===o),c=(l==null?void 0:l.displayName)||o;t.textContent=`${c}: ${String(s)}`}else{let o=r.charAt(0).toUpperCase()+r.slice(1);t.textContent=`${o}: ${String(s)}`}break}}renderDueDateProperty(t,r,s){let i=this.plugin.settings.calendarViewSettings.timeFormat,a=jt(r,{dateFormat:"MMM d",showTime:!0,userTimeFormat:i});t.textContent=`Due: ${a}`,t.classList.add("fc-list-task-date","fc-list-task-date--due"),t.addEventListener("click",o=>{o.stopPropagation()})}renderScheduledDateProperty(t,r,s){let i=this.plugin.settings.calendarViewSettings.timeFormat,a=jt(r,{dateFormat:"MMM d",showTime:!0,userTimeFormat:i});t.textContent=`Scheduled: ${a}`,t.classList.add("fc-list-task-date","fc-list-task-date--scheduled")}renderProjectsProperty(t,r){let s=t.createEl("span",{cls:"fc-list-task-projects-icon"});(0,_e.setIcon)(s,"folder"),t.createEl("span",{text:` ${r.join(", ")}`})}renderContextsProperty(t,r){t.textContent=`@ ${r.join(", ")}`}renderTagsProperty(t,r){t.textContent=`# ${r.join(", ")}`}getRecurrenceDisplayText(t){return ua(t)}formatDateForDisplay(t){let r=this.plugin.settings.calendarViewSettings.timeFormat;return jt(t,{dateFormat:"MMM d",showTime:!1,userTimeFormat:r})}addTaskMetadataToListEvent(t,r,s,i){let a=[];for(let o of s){if(o==="status"||o==="priority"||o==="due"&&i==="due"||o==="scheduled"&&(i==="scheduled"||i==="recurring"))continue;let l=null;l=this.renderListViewProperty(t,o,r),l&&a.push(l)}}addTaskInteractionsToListEvent(t,r){let s=this.plugin.selectedDate||new Date;t.addEventListener("mouseover",nc(r,this.plugin));let{clickHandler:i,dblclickHandler:a}=sc({task:r,plugin:this.plugin,excludeSelector:".fc-list-task-priority-dot, .fc-list-task-recurring-indicator",contextMenuHandler:async o=>{await this.showTaskContextMenuForEvent(o,r,s)}});t.addEventListener("click",i),t.addEventListener("dblclick",a),t.addEventListener("contextmenu",async o=>{o.preventDefault(),o.stopPropagation(),await this.showTaskContextMenuForEvent(o,r,s)})}async updateForTask(t,r){if(this.calendar)try{this.pendingRefreshTasks.add(t),this.scheduleEventSourceRefresh()}catch(s){console.error(`[AdvancedCalendarView] Error in event source refresh for ${t}:`,s),await this.refreshEvents(!1)}}async refresh(t=!1){await this.refreshEvents(t)}shouldRefreshForTask(t,r){return My(t,r)}scheduleEventSourceRefresh(){this.eventSourceRefreshTimer&&clearTimeout(this.eventSourceRefreshTimer),this.eventSourceRefreshTimer=window.setTimeout(()=>{this.performEventSourceRefresh()},150)}async performEventSourceRefresh(){if(!this.calendar)return;let t=Array.from(this.pendingRefreshTasks);this.pendingRefreshTasks.clear(),this.eventSourceRefreshTimer=null;try{let r=this.calendar.getEventSources();r.length>0?r.forEach(s=>{s.refetch()}):await this.refreshEvents(!1)}catch(r){console.error("[AdvancedCalendarView] Error during event source refetch:",r),await this.refreshEvents(!1)}}async refreshEvents(t=!1){if(this.calendar)try{this.calendar.removeAllEventSources(),this.calendar.addEventSource({events:this.getCalendarEvents.bind(this)}),this.lastRefreshTime=Date.now()}catch(r){throw console.error("Calendar refresh failed:",r),r}}async onClose(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),ja(this),this.updateDebounceTimer&&(clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=null),this.eventSourceRefreshTimer&&(clearTimeout(this.eventSourceRefreshTimer),this.eventSourceRefreshTimer=null),this.pendingRefreshTasks.clear(),this.functionListeners.forEach(t=>t()),this.functionListeners=[],this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.listeners=[],this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.calendar&&(this.calendar.destroy(),this.calendar=null),this.contentEl.empty()}showICSEventInfo(t,r){new To(this.app,this.plugin,t,r).open()}showTimeblockInfo(t,r,s){new Cm(this.app,this.plugin,t,r,s).open()}showICSEventContextMenu(t,r,s){new Jl({icsEvent:r,plugin:this.plugin,subscriptionName:s,onUpdate:()=>{}}).show(t)}async showTaskContextMenuForEvent(t,r,s){new rc({task:r,plugin:this.plugin,targetDate:s,onUpdate:()=>{}}).show(t)}showTimeEntryContextMenu(t,r,s){let i=new _e.Menu;i.addItem(a=>a.setTitle("Open task").setIcon("edit").onClick(()=>{new Fa(this.app,this.plugin,{task:r}).open()})),i.addSeparator(),i.addItem(a=>a.setTitle("Delete time entry").setIcon("trash").onClick(async()=>{var o;try{let l=(o=r.timeEntries)==null?void 0:o[s];if(!l){new _e.Notice("Time entry not found");return}let c="";if(l.startTime&&l.endTime){let u=Ut(l.startTime),h=Ut(l.endTime).getTime()-u.getTime(),p=Math.round(h/(1e3*60)),m=Math.floor(p/60),g=p%60;m>0?c=` (${m}h ${g}m)`:c=` (${g}m)`}await new Promise(u=>{let f=new _e.Modal(this.app);f.setTitle("Delete Time Entry"),f.setContent(`Are you sure you want to delete this time entry${c}? This action cannot be undone.`);let h=f.contentEl.createDiv({cls:"modal-button-container"});h.style.display="flex",h.style.justifyContent="flex-end",h.style.gap="8px",h.style.marginTop="20px";let p=h.createEl("button",{text:"Cancel"}),m=h.createEl("button",{text:"Delete",cls:"mod-warning"});p.onclick=()=>{f.close(),u(!1)},m.onclick=()=>{f.close(),u(!0)},f.open()})&&(await this.plugin.taskService.deleteTimeEntry(r,s),new _e.Notice("Time entry deleted"))}catch(l){console.error("Error deleting time entry:",l),new _e.Notice("Failed to delete time entry")}})),i.showAtMouseEvent(t)}updateTodayHighlight(){let t=this.contentEl.querySelector(".advanced-calendar-view__calendar-container");if(!t)return;this.plugin.settings.calendarViewSettings.showTodayHighlight?t.removeClass("hide-today-highlight"):t.addClass("hide-today-highlight")}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(t=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),t()})})}};var us=require("obsidian");or();Fs();var br=class n{static formatGroupName(e,t){let r=t.priorityManager.getPriorityConfig(e);if(r)return`${r.label} priority`;let s=t.statusManager.getStatusConfig(e);if(s)return s.label;switch(e){case"all":return"All tasks";case"no-status":return"No status assigned";case"No Status":return"No Status";case"No Priority":return"No Priority";case"No Context":return"No Context";case"No Project":return"No Project";case"No Due Date":return"No Due Date";case"No Scheduled Date":return"No Scheduled Date";default:return e}}static getGroupDisplayName(e,t,r){return`${n.formatGroupName(e,r)} (${t})`}static isGroupCollapsed(e,t,r,s){var i;try{let o=(s.viewStateManager.getViewPreferences(e)||{}).collapsedGroups||{};return!!((i=o==null?void 0:o[t])!=null&&i[r])}catch(a){return!1}}static setGroupCollapsed(e,t,r,s,i){let o={...i.viewStateManager.getViewPreferences(e)||{}};o.collapsedGroups||(o.collapsedGroups={}),o.collapsedGroups[t]||(o.collapsedGroups[t]={}),o.collapsedGroups[t][r]=s,i.viewStateManager.setViewPreferences(e,o)}static expandAllGroups(e,t,r){let s=r.viewStateManager.getViewPreferences(e)||{},i={...s.collapsedGroups||{}};i[t]={},r.viewStateManager.setViewPreferences(e,{...s,collapsedGroups:i})}static collapseAllGroups(e,t,r,s){let i=s.viewStateManager.getViewPreferences(e)||{},a={...i.collapsedGroups||{}},o={};r.forEach(l=>{o[l]=!0}),a[t]=o,s.viewStateManager.setViewPreferences(e,{...i,collapsedGroups:a})}};var Mt=class n{static formatGroupCount(e,t,r={}){let s=t>0?Math.round(e/t*100):0,i=["agenda-view__item-count"];r.additionalClasses&&i.push(...r.additionalClasses);let a;return r.showPercentage?a=`${s}%`:r.hideCompleted?a=`${t}`:a=`${e} / ${t}`,{text:a,classes:i,completed:e,total:t,percentage:s}}static calculateGroupStats(e,t){let r=e.length;return{completed:e.filter(i=>t.statusManager.isCompletedStatus(i.status)).length,total:r}}static createCountElement(e,t,r,s={}){let i=n.formatGroupCount(t,r,s),a=e.createEl("div",{text:i.text,cls:i.classes.join(" ")});return a.setAttribute("data-completed",t.toString()),a.setAttribute("data-total",r.toString()),a.setAttribute("data-percentage",i.percentage.toString()),a}static updateCountElement(e,t,r,s={}){let i=n.formatGroupCount(t,r,s);e.textContent=i.text,e.className=i.classes.join(" "),e.setAttribute("data-completed",t.toString()),e.setAttribute("data-total",r.toString()),e.setAttribute("data-percentage",i.percentage.toString())}};var Wa=class{constructor(e){this.headingElement=null;this.countElement=null;this.dividerElement=null;this.container=e,this.instanceId="fh-"+Math.random().toString(36).substr(2,9),this.render()}render(){let e=this.container.createDiv("filter-heading"),t=e.createDiv("filter-heading__content");this.headingElement=t.createEl("h2",{cls:"filter-heading__title",text:"All"}),this.countElement=t.createDiv("filter-heading__count agenda-view__item-count"),this.dividerElement=e.createDiv("filter-heading__divider")}update(e,t,r){if(!this.headingElement||!this.countElement)return;let s=(e==null?void 0:e.name)||"All";this.headingElement.textContent=s;let i=Mt.formatGroupCount(t,r).text;this.countElement.textContent=i}destroy(){let e=this.container.querySelector(".filter-heading");e&&e.remove()}};var dp=class extends us.ItemView{constructor(t,r){super(t);this.taskListContainer=null;this.loadingIndicator=null;this.isTasksLoading=!1;this.filterBar=null;this.filterHeading=null;this.taskElements=new Map;this.listeners=[];this.functionListeners=[];this.plugin=r,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"},this.registerEvents()}getViewType(){return Zr}getDisplayText(){return"Tasks"}getIcon(){return"check-square"}registerEvents(){this.listeners.forEach(i=>this.plugin.emitter.offref(i)),this.listeners=[],this.functionListeners.forEach(i=>i()),this.functionListeners=[];let t=this.plugin.emitter.on(ar,async()=>{if(this.refresh(),this.filterBar){let i=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(i)}});this.listeners.push(t);let r=this.plugin.emitter.on($s,async()=>{this.refresh()});this.listeners.push(r);let s=this.plugin.filterService.on("data-changed",()=>{this.refreshTasks()});this.functionListeners.push(s)}async onOpen(){try{await this.plugin.onReady(),await this.plugin.waitForMigration(),this.currentQuery=this.plugin.filterService.createDefaultQuery();let t=this.plugin.viewStateManager.getFilterState(Zr);t&&(this.currentQuery=t),await this.refresh(),Ua(this,{viewId:Zr,debounceDelay:100,maxBatchSize:8,changeDetectionEnabled:!0})}catch(t){console.error("TaskListView: Error during onOpen:",t),this.fallbackToPolling()}}async fallbackToPolling(){this.contentEl.empty(),this.contentEl.createDiv({cls:"task-list-view__loading"}).createSpan({text:"Initializing..."});let r=0,s=50,i=async()=>{r++,this.plugin.cacheManager&&this.plugin.cacheManager.isInitialized()?await this.refresh():r<s?setTimeout(i,100):await this.refresh()};i()}async onClose(){ja(this),this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.functionListeners.forEach(t=>t()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.filterHeading&&(this.filterHeading.destroy(),this.filterHeading=null),this.contentEl.empty()}async refresh(t=!1){return xi.measure("task-list-refresh",async()=>{t&&this.taskElements.clear(),this.contentEl.empty(),this.taskElements.clear(),await this.render()})}async updateForTask(t,r){await Py(this,t,r)}async render(){let t=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container task-list-view-container"});this.createHeader(t),await this.createTasksContent(t)}createHeader(t){t.createDiv({cls:"detail-view-header task-list-header"})}async createTasksContent(t){let r=t.createDiv({cls:"filter-bar-container"});await this.waitForCacheReady(),this.currentQuery=this.plugin.filterService.createDefaultQuery();let s=this.plugin.viewStateManager.getFilterState(Zr);s&&(this.currentQuery=s);let i=await this.plugin.filterService.getFilterOptions();this.filterBar=new hn(this.app,this.plugin,r,this.currentQuery,i,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"task-list"});let a=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(a),this.filterBar.on("saveView",({name:d,query:u,viewOptions:f,visibleProperties:h})=>{let p=this.plugin.viewStateManager.saveView(d,u,f,h);this.filterBar.setActiveSavedView(p)}),this.filterBar.on("deleteView",d=>{this.plugin.viewStateManager.deleteView(d)}),this.plugin.viewStateManager.on("saved-views-changed",d=>{var u;(u=this.filterBar)==null||u.updateSavedViews(d)}),this.filterBar.on("reorderViews",(d,u)=>{this.plugin.viewStateManager.reorderSavedViews(d,u)}),this.filterBar.on("queryChange",async d=>{this.currentQuery=d,this.plugin.viewStateManager.setFilterState(Zr,d);let u=this.contentEl.querySelector(".filter-heading__controls");u&&this.createExpandCollapseButtons(u),await this.refreshTasks()}),this.filterBar.on("propertiesChanged",d=>{this.refreshTaskDisplay()}),this.filterHeading=new Wa(t);let o=t.querySelector(".filter-heading");if(o){let d=o.querySelector(".filter-heading__content");if(d){let u=d.createDiv({cls:"filter-heading__controls"});this.createExpandCollapseButtons(u)}}let l=t.createDiv({cls:"task-list"});this.loadingIndicator=l.createDiv({cls:"loading-indicator"}),this.loadingIndicator.createDiv({cls:"loading-spinner"}),this.loadingIndicator.createDiv({cls:"loading-text",text:"Loading tasks..."}),this.loadingIndicator.addClass("is-hidden"),this.taskListContainer=l,this.isTasksLoading=!0,this.updateLoadingState(),await this.refreshTasks(),this.isTasksLoading=!1,this.updateLoadingState();let c=this.contentEl.querySelector(".filter-heading__controls");c&&this.createExpandCollapseButtons(c)}createExpandCollapseButtons(t){if(!((this.currentQuery.groupKey||"none")!=="none")){t.style.display="none";return}t.style.display="flex",t.empty(),new us.ButtonComponent(t).setIcon("list-tree").setTooltip("Expand All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none";this.contentEl.querySelectorAll(".task-group").forEach(o=>{o.classList.remove("is-collapsed");let l=o.querySelector(".task-cards");l&&(l.style.display="")}),br.expandAllGroups(Zr,a,this.plugin)}).buttonEl.addClass("clickable-icon"),new us.ButtonComponent(t).setIcon("list-collapse").setTooltip("Collapse All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none",o=[];this.contentEl.querySelectorAll(".task-group").forEach(l=>{let c=l.dataset.group;if(c){o.push(c),l.classList.add("is-collapsed");let d=l.querySelector(".task-cards");d&&(d.style.display="none")}}),br.collapseAllGroups(Zr,a,o,this.plugin)}).buttonEl.addClass("clickable-icon")}async updateFilterHeading(){if(!(!this.filterHeading||!this.filterBar))try{let t=await this.plugin.filterService.getGroupedTasks(this.currentQuery),r=Array.from(t.values()).flat(),s=Mt.calculateGroupStats(r,this.plugin),i=this.filterBar.activeSavedView||null;this.filterHeading.update(i,s.completed,s.total)}catch(t){console.error("Error updating filter heading in TaskListView:",t)}}async refreshTasks(){var t;if(this.taskListContainer)try{this.isTasksLoading=!0,this.updateLoadingState();let r=await this.plugin.filterService.getGroupedTasks(this.currentQuery);this.renderTaskItems(this.taskListContainer,r)}catch(r){let s=r instanceof Error?r.message:String(r);console.error("TaskListView: Error refreshing tasks:",{error:s,stack:r instanceof Error?r.stack:void 0,query:this.currentQuery,cacheInitialized:((t=this.plugin.cacheManager)==null?void 0:t.isInitialized())||!1,visibleProperties:this.getCurrentVisibleProperties(),filterServiceQuery:JSON.stringify(this.currentQuery,null,2)}),this.taskListContainer.empty();let i=this.taskListContainer.createDiv({cls:"error-container"});i.createEl("p",{text:"Error loading tasks. Please try refreshing.",cls:"error-message"}),i.createEl("button",{text:"Retry",cls:"mod-cta"}).addEventListener("click",()=>{this.refreshTasks()})}finally{this.isTasksLoading=!1,this.updateLoadingState(),await this.updateFilterHeading()}}renderTaskItems(t,r){if(Array.from(r.values()).reduce((i,a)=>i+a.length,0)===0){t.empty(),this.taskElements.clear(),t.createEl("p",{text:"No tasks found for the selected filters."});return}if(this.currentQuery.groupKey==="none"&&r.has("all")){let i=r.get("all")||[];this.renderTaskListWithReconciler(t,i)}else this.renderGroupedTasksWithReconciler(t,r)}renderTaskListWithReconciler(t,r){Array.from(t.children).forEach(s=>{let i=s;i.dataset.key||i.remove()});try{this.plugin.domReconciler.updateList(t,r,s=>s.path,s=>this.createTaskCardForReconciler(s),(s,i)=>this.updateTaskCardForReconciler(s,i))}catch(s){throw console.error("TaskListView: Error in renderTaskListWithReconciler:",s),s}this.taskElements.clear(),Array.from(t.children).forEach(s=>{let i=s.dataset.key;i&&this.taskElements.set(i,s)})}renderGroupedTasksWithReconciler(t,r){let s=t.scrollTop,i=new Map;Array.from(t.children).forEach(a=>{let o=a.dataset.group;o&&i.set(o,a)}),t.empty(),this.taskElements.clear(),r.forEach((a,o)=>{if(a.length===0)return;let l=t.createDiv({cls:"task-section task-group"});l.setAttribute("data-group",o);let c=this.currentQuery.groupKey||"none",d=c==="none"&&o==="all",u=this.isGroupCollapsed(c,o);if(!d){let h=l.createEl("h3",{cls:"task-group-header task-list-view__group-header"}),p=h.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle group"}});try{(0,us.setIcon)(p,"chevron-right")}catch(y){}let m=p.querySelector("svg");m?(m.classList.add("chevron"),m.setAttr("width","16"),m.setAttr("height","16")):(p.textContent="\u25B8",p.addClass("chevron-text"));let g=Mt.calculateGroupStats(a,this.plugin);c==="project"&&this.isClickableProject(o)?this.createClickableProjectHeader(h,o,g):(h.createSpan({text:this.formatGroupName(o)}),h.createSpan({text:` ${Mt.formatGroupCount(g.completed,g.total).text}`,cls:"agenda-view__item-count"})),this.registerDomEvent(h,"click",y=>{if(y.target.closest("a"))return;let w=!l.hasClass("is-collapsed");this.setGroupCollapsed(c,o,w),l.toggleClass("is-collapsed",w);let b=l.querySelector(".task-cards");b&&(b.style.display=w?"none":""),p.setAttr("aria-expanded",String(!w))}),this.registerDomEvent(p,"click",y=>{y.preventDefault(),y.stopPropagation();let T=!l.hasClass("is-collapsed");this.setGroupCollapsed(c,o,T),l.toggleClass("is-collapsed",T);let w=l.querySelector(".task-cards");w&&(w.style.display=T?"none":""),p.setAttr("aria-expanded",String(!T))}),p.setAttr("aria-expanded",String(!u))}let f=l.createDiv({cls:"tasks-container task-cards"});u&&!d&&(l.addClass("is-collapsed"),f.style.display="none"),this.plugin.domReconciler.updateList(f,a,h=>h.path,h=>this.createTaskCardForReconciler(h),(h,p)=>this.updateTaskCardForReconciler(h,p)),Array.from(f.children).forEach(h=>{let p=h.dataset.key;p&&this.taskElements.set(p,h)})}),t.scrollTop=s}isGroupCollapsed(t,r){return br.isGroupCollapsed(Zr,t,r,this.plugin)}setGroupCollapsed(t,r,s){br.setGroupCollapsed(Zr,t,r,s,this.plugin)}getCurrentVisibleProperties(){var t;return(t=this.filterBar)==null?void 0:t.getCurrentVisibleProperties()}refreshTaskDisplay(){if(!this.taskListContainer)return;let t=this.taskListContainer.querySelectorAll(".task-card"),r=this.getCurrentVisibleProperties();t.forEach(s=>{let i=s.dataset.taskPath;i&&this.plugin.cacheManager.getTaskInfo(i).then(a=>{a&&Pn(s,a,this.plugin,r)})})}createTaskCardForReconciler(t){try{let r=this.getCurrentVisibleProperties(),s=fr(t,this.plugin,r,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1});return s.dataset.key=t.path,this.addDragHandlers(s,t),s}catch(r){throw console.error("TaskListView: Error creating task card for",t.path,":",r),r}}updateTaskCardForReconciler(t,r){let s=this.getCurrentVisibleProperties();Pn(t,r,this.plugin,s,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1})}addDragHandlers(t,r){this.plugin.dragDropManager.makeTaskCardDraggable(t,r.path)}formatGroupName(t){return br.formatGroupName(t,this.plugin)}updateLoadingState(){this.loadingIndicator&&(this.isTasksLoading?this.loadingIndicator.removeClass("is-hidden"):this.loadingIndicator.addClass("is-hidden"))}openTask(t){let r=this.app.vault.getAbstractFileByPath(t);r instanceof us.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(t=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),t()})})}isClickableProject(t){var r;return!t||typeof t!="string"?!1:t.startsWith("[[")&&t.endsWith("]]")||t.includes("/")?!0:(r=this.plugin)!=null&&r.app?this.plugin.app.vault.getAbstractFileByPath(t+".md")instanceof us.TFile?!0:!!this.plugin.app.metadataCache.getFirstLinkpathDest(t,""):!1}createClickableProjectHeader(t,r,s){if(!r||typeof r!="string")return;let i=r,a=r;if(r.startsWith("[[")&&r.endsWith("]]")){let l=r.slice(2,-2);i=l,a=l}let o=t.createEl("a",{cls:"internal-link task-list-view__project-link",text:a});this.registerDomEvent(o,"click",async l=>{l.preventDefault(),l.stopPropagation();try{let c=this.plugin.app.vault.getAbstractFileByPath(i);if(c instanceof us.TFile){await this.plugin.app.workspace.getLeaf(!1).openFile(c);return}let d=this.plugin.app.metadataCache.getFirstLinkpathDest(i,"");d?await this.plugin.app.workspace.getLeaf(!1).openFile(d):new us.Notice(`Project file not found: ${a}`)}catch(c){console.error("Error opening project file:",c),new us.Notice(`Error opening project: ${a}`)}}),this.addHoverPreview(o,i),s&&t.createSpan({text:` ${Mt.formatGroupCount(s.completed,s.total).text}`,cls:"agenda-view__item-count"})}addHoverPreview(t,r){t.addEventListener("mouseover",s=>{this.app.vault.getAbstractFileByPath(r)&&this.app.workspace.trigger("hover-link",{event:s,source:"tasknotes-tasklistview",hoverParent:this,targetEl:t,linktext:r,sourcePath:r})})}};var ci=require("obsidian");Ne();or();var up=require("obsidian");Ne();var AS=Ee(wn()),MH={showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:3,showDailyNoteBadge:!0};function Ay(n,e,t={}){let r={...MH,...t},s=document.createElement("div"),i=!1;try{let u=(0,AS.getAllDailyNotes)();i=Object.values(u).some(f=>f.path===n.path)}catch(u){i=!1}let a=["note-card"];i&&a.push("note-card--daily-note"),a.push("note-card--compact","note-card--shadow-light"),s.className=a.join(" "),s.dataset.notePath=n.path,r.showDailyNoteBadge&&i&&s.createSpan({cls:"note-card__badge",text:"Daily",attr:{title:"Daily note"}});let o=s.createDiv({cls:"note-card__main-row"}),c=o.createEl("span",{cls:"note-card__icon"}).createEl("span");(0,up.setIcon)(c,"file-text");let d=o.createDiv({cls:"note-card__content"});if(d.createDiv({cls:"note-card__title",text:n.title}),r.showTags&&n.tags&&n.tags.length>0){d.createEl("div",{cls:"note-card__divider"});let f=n.tags.slice(0,r.maxTags).map(h=>`#${h}`).join(" ");n.tags.length>r.maxTags&&(f+=` +${n.tags.length-r.maxTags}`),d.createEl("div",{cls:"note-card__tags-text",text:f})}if(r.showCreatedDate&&n.createdDate){let f=e.settings.calendarViewSettings.timeFormat==="12"?"MMM d, yyyy h:mm a":"MMM d, yyyy HH:mm",h=n.createdDate.indexOf("T")>0?Ts(n.createdDate,f):n.createdDate;d.createDiv({cls:"note-card__metadata",text:`Created: ${h}`,attr:{title:`Created: ${h}`}})}return r.showPath&&d.createDiv({cls:"note-card__metadata",text:n.path,attr:{title:`Path: ${n.path}`}}),s.addEventListener("click",()=>{let u=e.app.vault.getAbstractFileByPath(n.path);u instanceof up.TFile&&e.app.workspace.getLeaf(!1).openFile(u)}),s.addEventListener("mouseover",u=>{e.app.vault.getAbstractFileByPath(n.path)&&e.app.workspace.trigger("hover-link",{event:u,source:"tasknotes-note-card",hoverParent:s,targetEl:s,linktext:n.path,sourcePath:n.path})}),s}function PH(n,e,t,r={}){var f;let s={...MH,...r},i=!1;try{let h=(0,AS.getAllDailyNotes)();i=Object.values(h).some(p=>p.path===e.path)}catch(h){i=!1}let a=["note-card"];i&&a.push("note-card--daily-note"),a.push("note-card--compact","note-card--shadow-light"),n.className=a.join(" ");let o=n.querySelector(".note-card__icon");if(!o){let h=n.querySelector(".note-card__main-row")||n.createDiv({cls:"note-card__main-row"});o=h.createEl("span",{cls:"note-card__icon"});let p=o.createEl("span");(0,up.setIcon)(p,"file-text");let m=n.querySelector(".note-card__content");m&&!((f=m.parentElement)!=null&&f.classList.contains("note-card__main-row"))&&h.appendChild(m)}let l=n.querySelector(".note-card__title");l&&(l.textContent=e.title);let c=n.querySelector(".note-card__metadata");if(c&&s.showCreatedDate&&e.createdDate){let p=t.settings.calendarViewSettings.timeFormat==="12"?"MMM d, yyyy h:mm a":"MMM d, yyyy HH:mm",m=e.createdDate.indexOf("T")>0?Ts(e.createdDate,p):e.createdDate;c.textContent=`Created: ${m}`}let d=n.querySelector(".note-card__metadata");d&&s.showPath&&(d.textContent=e.path);let u=n.querySelector(".note-card__tags-text");if(u&&s.showTags&&e.tags&&e.tags.length>0){let p=e.tags.slice(0,s.maxTags).map(m=>`#${m}`).join(" ");e.tags.length>s.maxTags&&(p+=` +${e.tags.length-s.maxTags}`),u.textContent=p}n.classList.add("note-card--updated"),window.setTimeout(()=>{n.classList.remove("note-card--updated")},1e3)}var Iy=class extends ci.ItemView{constructor(t,r){super(t);this.loadingIndicator=null;this.isNotesLoading=!1;this.listeners=[];this.plugin=r,this.registerEvents()}getViewType(){return Rl}getDisplayText(){return"Notes"}getIcon(){return"file-text"}registerEvents(){this.listeners.forEach(s=>this.plugin.emitter.offref(s)),this.listeners=[];let t=this.plugin.emitter.on(Ti,()=>{this.refresh(!0)});this.listeners.push(t);let r=this.plugin.emitter.on(ar,()=>{this.refresh()});this.listeners.push(r)}async onOpen(){await this.plugin.onReady(),await this.refresh()}async onClose(){this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.contentEl.empty()}async refresh(t=!1){let r=this.contentEl.querySelector(".notes-view"),s=0;if(r&&!t){let i=r.querySelector(".notes-view__list");i&&(s=i.scrollTop)}if(this.contentEl.empty(),await this.render(t),s>0){let i=this.contentEl.querySelector(".notes-view__list");i&&(i.scrollTop=s)}}async render(t=!1){let r=this.contentEl.createDiv({cls:"tasknotes-plugin notes-view"});this.createHeader(r),await this.createNotesContent(r,t)}createHeader(t){let r=t.createDiv({cls:"notes-view__header"}),s=Ts(this.plugin.selectedDate.toISOString(),"EEEE, MMMM d, yyyy"),i=r.createDiv();new ci.Setting(i).setName("Notes").setHeading(),i.createEl("div",{text:s,cls:"notes-view__date"});let o=r.createDiv({cls:"notes-view__actions"}).createEl("button",{text:"Refresh",cls:"notes-view__refresh-button",attr:{"aria-label":"Refresh notes list",title:"Refresh notes list"}});o.addEventListener("click",async()=>{if(o.classList.contains("is-loading"))return;o.classList.add("is-loading"),o.disabled=!0;let l=o.textContent;o.textContent="Refreshing...";try{await this.refresh(!0)}finally{o.classList.remove("is-loading"),o.disabled=!1,o.textContent=l}})}async createNotesContent(t,r=!1){let s=t.createDiv({cls:"notes-view__list"});this.loadingIndicator=s.createDiv({cls:"notes-view__loading is-hidden"}),this.loadingIndicator.createSpan({text:"Loading notes..."}),this.isNotesLoading=!0,this.updateLoadingState();let i=await this.getNotesForView(r);if(this.isNotesLoading=!1,this.updateLoadingState(),i.length===0){let a=s.createDiv({cls:"notes-view__empty"}),o=a.createDiv({cls:"notes-view__empty-icon"});(0,ci.setIcon)(o,"file-text"),this.plugin.settings.disableNoteIndexing?(new ci.Setting(a).setName("Note indexing disabled").setHeading(),a.createEl("p",{text:"Note indexing has been disabled in settings for better performance. To view notes, enable note indexing in Settings > TaskNotes > General > Performance settings and restart the plugin.",cls:"notes-view__empty-description"})):(new ci.Setting(a).setName("No notes found").setHeading(),a.createEl("p",{text:"No notes found for the selected date. Try selecting a different date in the Mini Calendar view or create some notes.",cls:"notes-view__empty-description"}))}else{let a=s.createDiv({cls:"notes-view__container"});this.renderNotesWithReconciler(a,i)}}renderNotesWithReconciler(t,r){this.plugin.domReconciler.updateList(t,r,s=>s.path,s=>this.createNoteCardForReconciler(s),(s,i)=>this.updateNoteCardForReconciler(s,i))}createNoteCardForReconciler(t){let r=Ay(t,this.plugin,{showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:5,showDailyNoteBadge:!0});return r.dataset.key=t.path,r}updateNoteCardForReconciler(t,r){PH(t,r,this.plugin,{showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:5,showDailyNoteBadge:!0})}updateLoadingState(){var t,r;this.loadingIndicator&&(this.isNotesLoading?(t=this.loadingIndicator)==null||t.classList.remove("is-hidden"):(r=this.loadingIndicator)==null||r.classList.add("is-hidden"))}async getNotesForView(t=!1){try{return this.isNotesLoading=!0,this.updateLoadingState(),this.plugin.settings.disableNoteIndexing?[]:(await this.plugin.cacheManager.getNotesForDate(this.plugin.selectedDate)).sort((a,o)=>a.title.localeCompare(o.title))}finally{this.isNotesLoading=!1,this.updateLoadingState()}}openNote(t){let r=this.app.vault.getAbstractFileByPath(t);r instanceof ci.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}};or();var kr=require("obsidian");Ft();Ne();var _H=require("obsidian");Ne();function AH(n,e){try{if(!n.start)return"";let t=new Date(n.start);if(n.allDay)return"All day";let r=e.settings.calendarViewSettings.timeFormat,s=ST(t,r);if(n.end){let i=new Date(n.end),a=ST(i,r);return`${s} \u2013 ${a}`}return s}catch(t){return""}}function IH(n,e,t={}){var m;let r=document.createElement("div");r.className="task-card task-card--ics",r.dataset.key=n.id;let s=(m=e.icsSubscriptionService)==null?void 0:m.getSubscriptions().find(g=>g.id===n.subscriptionId),i=(s==null?void 0:s.color)||"var(--color-accent)",a=(s==null?void 0:s.name)||"Calendar",o=r.createEl("div",{cls:"task-card__main-row"}),l=o.createEl("span",{cls:"ics-card__icon"}),c=l.createDiv({attr:{"aria-label":"Calendar event"}});(0,_H.setIcon)(c,"calendar");let d=l;d.style.display="inline-flex",d.style.width="16px",d.style.height="16px",d.style.marginRight="8px",d.style.alignItems="center",d.style.justifyContent="center",d.style.flexShrink="0",c.style.width="100%",c.style.height="100%",c.style.color=i;let u=o.createEl("div",{cls:"task-card__content"});u.createEl("div",{cls:"task-card__title",text:n.title||"Untitled event"});let f=u.createEl("div",{cls:"task-card__metadata"}),h=[],p=AH(n,e);return p&&h.push(p),n.location&&h.push(n.location),h.push(a),f.textContent=h.join(" \u2022 "),r.addEventListener("click",()=>{let{ICSEventInfoModal:g}=(Em(),Td(MA));new g(e.app,e,n,a).open()}),r.addEventListener("contextmenu",g=>{g.preventDefault(),g.stopPropagation(),new Jl({icsEvent:n,plugin:e,subscriptionName:a,onUpdate:()=>{e.app.workspace.trigger("tasknotes:refresh-views")}}).show(g)}),r.style.setProperty("--current-status-color",i),r}function Ry(n,e,t,r={}){var d;let s=(d=t.icsSubscriptionService)==null?void 0:d.getSubscriptions().find(u=>u.id===e.subscriptionId),i=(s==null?void 0:s.color)||"var(--color-accent)",a=(s==null?void 0:s.name)||"Calendar";n.style.setProperty("--current-status-color",i);let o=n.querySelector(".ics-card__icon");o&&(o.style.color=i);let l=n.querySelector(".task-card__title");l&&(l.textContent=e.title||"Untitled event");let c=n.querySelector(".task-card__metadata");if(c){let u=[],f=AH(e,t);f&&u.push(f),e.location&&u.push(e.location),u.push(a),c.textContent=u.join(" \u2022 ")}}Fs();var RH=require("obsidian");At();Ft();Al();Ne();var Va=class extends li{constructor(t,r,s,i){super();this.plugin=i;this.indexQueryCache=new Map;this.cacheTimeout=3e4;this.cacheTimers=new Map;this.filterOptionsCache=null;this.filterOptionsCacheTimestamp=0;this.filterOptionsCacheTTL=3e5;this.filterOptionsComputeCount=0;this.filterOptionsCacheHits=0;this.cacheManager=t,this.statusManager=r,this.priorityManager=s}async getGroupedTasks(t,r){try{Le.validateFilterNode(t,!1);let s=this.getIndexOptimizedTaskPaths(t),a=(await this.pathsToTaskInfos(Array.from(s))).filter(l=>this.evaluateFilterNode(t,l,r)),o=this.sortTasks(a,t.sortKey||"due",t.sortDirection||"asc");return this.currentSortKey=t.sortKey||"due",this.currentSortDirection=t.sortDirection||"asc",this.groupTasks(o,t.groupKey||"none",r)}catch(s){if(s instanceof Fr||s instanceof Ba)return console.error("Filter error:",s.message,{nodeId:s.nodeId,field:s.field}),new Map;throw s}}getIndexOptimizedTaskPaths(t){let r=this.analyzeQueryOptimizationSafety(t);if(!r.canOptimize)return this.cacheManager.getAllTaskPaths();if(r.strategy==="intersect"){let s=this.getPathsForIndexableCondition(r.conditions[0]);for(let i=1;i<r.conditions.length;i++){let a=this.getPathsForIndexableCondition(r.conditions[i]);s=this.intersectPathSets(s,a)}return s}else if(r.strategy==="single")return this.getPathsForIndexableCondition(r.conditions[0]);return this.cacheManager.getAllTaskPaths()}analyzeQueryOptimizationSafety(t){let r=this.findIndexableConditions(t);return r.length===0?{canOptimize:!1,conditions:[],reason:"No indexable conditions found"}:this.isSimpleQuery(t,r)?{canOptimize:!0,strategy:r.length===1?"single":"intersect",conditions:r}:{canOptimize:!1,conditions:r,reason:"Complex query structure with OR conditions - optimization not safe"}}isSimpleQuery(t,r){return r.length===0||this.hasIndexableConditionInOrGroup(t,r)?!1:r.length===1||t.type==="group"&&t.conjunction==="and"&&t.children.filter(i=>i.type==="condition"&&this.isIndexableCondition(i)).length===r.length}hasIndexableConditionInOrGroup(t,r){return this.checkNodeForOrWithIndexable(t,r)}checkNodeForOrWithIndexable(t,r){if(t.type==="condition")return!1;if(t.type==="group"){if(t.conjunction==="or"&&t.children.some(i=>i.type==="condition"&&r.includes(i)))return!0;for(let s of t.children)if(this.checkNodeForOrWithIndexable(s,r))return!0}return!1}findIndexableConditions(t){let r=[];if(t.type==="condition")this.isIndexableCondition(t)&&r.push(t);else if(t.type==="group")for(let s of t.children)r.push(...this.findIndexableConditions(s));return r}isIndexableCondition(t){let{property:r,operator:s,value:i}=t;return!!(r==="status"&&s==="is"&&i||r==="due"&&(s==="is"||s==="is-before"||s==="is-after")&&i||r==="scheduled"&&(s==="is"||s==="is-before"||s==="is-after")&&i)}getCachedIndexResult(t,r){let s=this.indexQueryCache.get(t);if(s)return new Set(s);let i=r();this.indexQueryCache.set(t,new Set(i));let a=this.cacheTimers.get(t);a&&clearTimeout(a);let o=setTimeout(()=>{this.indexQueryCache.delete(t),this.cacheTimers.delete(t)},this.cacheTimeout);return this.cacheTimers.set(t,o),i}clearIndexQueryCache(){for(let t of this.cacheTimers.values())clearTimeout(t);this.indexQueryCache.clear(),this.cacheTimers.clear()}getCacheStats(){return{entryCount:this.indexQueryCache.size,cacheKeys:Array.from(this.indexQueryCache.keys()),timeoutMs:this.cacheTimeout}}getPathsForIndexableCondition(t){let{property:r,operator:s,value:i}=t,a=`${r}:${s}:${i}`;return this.getCachedIndexResult(a,()=>r==="status"&&s==="is"&&i&&typeof i=="string"?new Set(this.cacheManager.getTaskPathsByStatus(i)):(r==="due"||r==="scheduled")&&s==="is"&&i&&typeof i=="string"?new Set(this.cacheManager.getTasksForDate(i)):(r==="due"||r==="scheduled")&&(s==="is-before"||s==="is-after")&&i&&typeof i=="string"?this.getTaskPathsForDateRange(r,s,i):this.cacheManager.getAllTaskPaths())}getTaskPathsForDateRange(t,r,s){return this.cacheManager.getAllTaskPaths()}intersectPathSets(t,r){let s=new Set;for(let i of t)r.has(i)&&s.add(i);return s}async pathsToTaskInfos(t){let r=[];for(let i=0;i<t.length;i+=50){let a=t.slice(i,i+50),o=await Promise.all(a.map(l=>this.cacheManager.getCachedTaskInfo(l)));for(let l of o)l&&r.push(l)}return r}evaluateFilterNode(t,r,s){return t.type==="condition"?this.evaluateCondition(t,r,s):t.type==="group"?this.evaluateGroup(t,r,s):!0}evaluateGroup(t,r,s){if(t.children.length===0)return!0;let i=t.children.filter(a=>a.type==="condition"?Le.isFilterNodeComplete(a):!0);return i.length===0?!0:t.conjunction==="and"?i.every(a=>this.evaluateFilterNode(a,r,s)):t.conjunction==="or"?i.some(a=>this.evaluateFilterNode(a,r,s)):!0}normalizeUserListValue(t){let r=[],s=o=>{if(!o)return;let l=String(o).trim();if(!l)return;let c=l.match(/^\[\[([^|\]]+)(?:\|([^\]]+))?\]\]$/);if(c){let d=c[1]||"",f=c[2]||d.split("#")[0].split("/").pop()||d;f&&r.push(f),r.push(l);return}r.push(l)};if(Array.isArray(t))for(let o of t)s(String(o));else if(typeof t=="string"){let o=bn(t);for(let l of o)s(l)}else t!=null&&s(String(t));let i=new Set,a=[];for(let o of r)i.has(o)||(i.add(o),a.push(o));return a}evaluateCondition(t,r,s){var c,d,u;let{property:i,operator:a,value:o}=t;if(typeof i=="string"&&i.startsWith("user:")){let f=i.slice(5),p=(((d=(c=this.plugin)==null?void 0:c.settings)==null?void 0:d.userFields)||[]).find(y=>(y.id||y.key)===f),m;if(p)try{let y=this.cacheManager.getApp(),T=y.vault.getAbstractFileByPath(r.path);if(T){let w=(u=y.metadataCache.getFileCache(T))==null?void 0:u.frontmatter,b=w?w[p.key]:void 0;switch(p.type){case"boolean":m=typeof b=="boolean"?b:String(b).toLowerCase()==="true";break;case"number":m=typeof b=="number"?b:b!=null?parseFloat(String(b)):void 0;break;case"list":m=this.normalizeUserListValue(b);break;default:m=b!=null?String(b):void 0}}}catch(y){}if((p==null?void 0:p.type)==="list"&&(a==="contains"||a==="does-not-contain")){let y=Array.isArray(m)?m:m!=null?[String(m)]:[],w=(Array.isArray(o)?o:[String(o!=null?o:"")]).some(b=>typeof b=="string"&&y.some(E=>typeof E=="string"&&E.toLowerCase().includes(b.toLowerCase())));return a==="contains"?w:!w}let g=(p==null?void 0:p.type)==="date"?"due":i;return Le.applyOperator(m,a,o,t.id,g)}let l=Le.getTaskPropertyValue(r,i);if(i==="status.isCompleted"){let f=Vn(r,s||new Date);l=this.statusManager.isCompletedStatus(f)}return i==="projects"&&(a==="contains"||a==="does-not-contain")?this.evaluateProjectsCondition(l,a,o):Le.applyOperator(l,a,o,t.id,i)}evaluateProjectsCondition(t,r,s){if(!Array.isArray(t)||typeof s!="string")return!1;let i=this.extractProjectName(s);if(!i)return!1;let a=t.some(o=>{if(!o||typeof o!="string")return!1;let l=this.extractProjectName(o);return l?l===i?!0:this.compareProjectWikilinks(o,s):!1});return r==="contains"?a:!a}extractProjectName(t){if(!t||typeof t!="string")return null;if(t.startsWith("[[")&&t.endsWith("]]")){let s=t.slice(2,-2).split("/");return s[s.length-1]||null}return t.trim()||null}compareProjectWikilinks(t,r){var l;if(!((l=this.plugin)!=null&&l.app))return!1;let s=this.extractWikilinkPath(t),i=this.extractWikilinkPath(r);if(!s||!i)return!1;let a=this.plugin.app.metadataCache.getFirstLinkpathDest(s,""),o=this.plugin.app.metadataCache.getFirstLinkpathDest(i,"");return a&&o?a.path===o.path:!1}extractWikilinkPath(t){return!t||typeof t!="string"?null:t.startsWith("[[")&&t.endsWith("]]")?t.slice(2,-2):t}resolveProjectToAbsolutePath(t){var s;if(!t||typeof t!="string")return t||"";if(!((s=this.plugin)!=null&&s.app))return t;if(t.startsWith("[[")&&t.endsWith("]]")){let i=t.slice(2,-2),a=i,o=i.indexOf("|");o!==-1&&(a=i.substring(0,o).trim());let l=this.plugin.app.metadataCache.getFirstLinkpathDest(a,"");return l?l.path.replace(/\.md$/,""):a.replace(/\.md$/,"")}if(t.includes("|")){let a=t.split("|")[0].trim(),o=this.plugin.app.metadataCache.getFirstLinkpathDest(a,"");return o?o.path.replace(/\.md$/,""):a.replace(/\.md$/,"")}if(t.includes("/")){let i=this.plugin.app.metadataCache.getFirstLinkpathDest(t,"");return i?i.path.replace(/\.md$/,""):t.replace(/\.md$/,"")}let r=this.plugin.app.metadataCache.getFirstLinkpathDest(t,"");return r?r.path.replace(/\.md$/,""):t}getPreferredProjectFormat(t){return!t||t==="No Project"?t:t.includes("/")||t.endsWith(".md")?`[[${t}]]`:`[[${t}]]`}async getTaskPathsInDateRange(t,r){let s=new Set,i=qe(t),a=qe(r);for(let d=new Date(i);d<=a;d.setDate(d.getDate()+1)){let u=C(d,"yyyy-MM-dd");this.cacheManager.getTaskPathsByDate(u).forEach(h=>s.add(h))}let o=this.cacheManager.getAllTaskPaths(),l=50,c=Array.from(o);for(let d=0;d<c.length;d+=l){let u=c.slice(d,d+l),f=await Promise.all(u.map(h=>this.cacheManager.getCachedTaskInfo(h)));for(let h of f)if(h&&h.recurrence&&!h.due){for(let p=new Date(i);p<=a;p.setDate(p.getDate()+1))if(Kd(h,p)){s.add(h.path);break}}}return s}getOverdueTaskPaths(){return this.cacheManager.getOverdueTaskPaths()}combineTaskPathSets(t){let r=new Set;return t.forEach(s=>{s.forEach(i=>r.add(i))}),r}isDateInRange(t,r,s){try{let i=we(t),a=we(r),o=we(s),l=sm(i),c=sm(a),d=sm(o);return l>=c&&l<=d}catch(i){return console.error("Error checking date range:",{dateString:t,startDateString:r,endDateString:s,error:i}),!1}}isSameDayAs(t,r){try{let s=C(t,"yyyy-MM-dd");return lr(s,r)}catch(s){return console.error("Error comparing date object with date string:",{dateObj:t,dateString:r,error:s}),!1}}sortTasks(t,r,s){return t.sort((i,a)=>{let o=0;if(typeof r=="string"&&r.startsWith("user:"))o=this.compareByUserField(i,a,r);else switch(r){case"due":o=this.compareDates(i.due,a.due);break;case"scheduled":o=this.compareDates(i.scheduled,a.scheduled);break;case"priority":o=this.comparePriorities(i.priority,a.priority);break;case"title":o=i.title.localeCompare(a.title);break;case"dateCreated":o=this.compareDates(i.dateCreated,a.dateCreated);break;case"tags":o=this.compareTags(i.tags,a.tags);break}return o===0&&(o=this.applyFallbackSorting(i,a,r)),s==="desc"?-o:o})}compareDates(t,r){if(!t&&!r)return 0;if(!t)return 1;if(!r)return-1;try{return la(t,r)?-1:la(r,t)?1:0}catch(s){return console.error("Error comparing dates time-aware:",{dateA:t,dateB:r,error:s}),t.localeCompare(r)}}comparePriorities(t,r){let s=this.priorityManager.getPriorityWeight(t);return this.priorityManager.getPriorityWeight(r)-s}compareTags(t,r){let s=t&&t.length>0?t:[],i=r&&r.length>0?r:[];if(s.length===0&&i.length===0)return 0;if(s.length===0)return 1;if(i.length===0)return-1;let a=s[0].toLowerCase(),o=i[0].toLowerCase();return a.localeCompare(o)}applyFallbackSorting(t,r,s){let a=["scheduled","due","priority","title"].filter(o=>o!==s);for(let o of a){let l=0;switch(o){case"scheduled":l=this.compareDates(t.scheduled,r.scheduled);break;case"due":l=this.compareDates(t.due,r.due);break;case"priority":l=this.comparePriorities(t.priority,r.priority);break;case"title":l=t.title.localeCompare(r.title);break}if(l!==0)return l}return 0}compareByUserField(t,r,s){var u,f;let i=s.slice(5),o=(((f=(u=this.plugin)==null?void 0:u.settings)==null?void 0:f.userFields)||[]).find(h=>(h.id||h.key)===i);if(!o)return 0;let l=h=>{var p;try{let m=this.cacheManager.getApp(),g=m.vault.getAbstractFileByPath(h.path),y=g?(p=m.metadataCache.getFileCache(g))==null?void 0:p.frontmatter:void 0;return y?y[o.key]:void 0}catch(m){return}},c=l(t),d=l(r);switch(o.type){case"number":{let h=typeof c=="number"?c:c!=null?parseFloat(String(c)):NaN,p=typeof d=="number"?d:d!=null?parseFloat(String(d)):NaN,m=!isNaN(h),g=!isNaN(p);return m&&g?h-p:m&&!g?-1:!m&&g?1:0}case"boolean":{let h=g=>{if(typeof g=="boolean")return g;if(g==null)return;let y=String(g).trim().toLowerCase();if(y==="true")return!0;if(y==="false")return!1},p=h(c),m=h(d);return p===m?0:p===!0?-1:m===!0?1:p===!1?-1:m===!1?1:0}case"date":{let h=c?Date.parse(String(c)):NaN,p=d?Date.parse(String(d)):NaN,m=!isNaN(h),g=!isNaN(p);return m&&g?h-p:m&&!g?-1:!m&&g?1:0}case"list":{let h=g=>{if(Array.isArray(g))return this.normalizeUserListValue(g)[0];if(typeof g=="string")return g.trim().length===0?"":this.normalizeUserListValue(g)[0]},p=h(c),m=h(d);return(p==null||p==="")&&(m==null||m==="")?0:p==null||p===""?1:m==null||m===""?-1:p.localeCompare(m)}case"text":default:{let h=c!=null?String(c):"",p=d!=null?String(d):"";return h.localeCompare(p)}}}groupTasks(t,r,s){if(r==="none")return new Map([["all",t]]);let i=new Map;for(let a of t)if(r==="project"){let o=Xr(a.projects||[]);if(o.length>0)for(let l of o){let c=this.resolveProjectToAbsolutePath(l);i.has(c)||i.set(c,[]),i.get(c).push(a)}else{let l="No Project";i.has(l)||i.set(l,[]),i.get(l).push(a)}}else if(r==="tags"){let o=a.tags||[];if(o.length>0)for(let l of o)i.has(l)||i.set(l,[]),i.get(l).push(a);else{let l="No Tags";i.has(l)||i.set(l,[]),i.get(l).push(a)}}else{let o;if(typeof r=="string"&&r.startsWith("user:"))o=this.getUserFieldGroupValue(a,r);else switch(r){case"status":o=a.status||"no-status";break;case"priority":o=a.priority||"unknown";break;case"context":o=a.contexts&&a.contexts.length>0?a.contexts[0]:"none";break;case"due":o=this.getDueDateGroup(a,s);break;case"scheduled":o=this.getScheduledDateGroup(a,s);break;default:o="unknown"}i.has(o)||i.set(o,[]),i.get(o).push(a)}return this.sortGroups(i,r)}getUserFieldGroupValue(t,r){var o,l,c;let s=r.slice(5),a=(((l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.userFields)||[]).find(d=>(d.id||d.key)===s);if(!a)return"unknown-field";try{let d=this.cacheManager.getApp(),u=d.vault.getAbstractFileByPath(t.path);if(!u)return"no-value";let f=(c=d.metadataCache.getFileCache(u))==null?void 0:c.frontmatter,h=f?f[a.key]:void 0;switch(a.type){case"boolean":{if(typeof h=="boolean")return h?"true":"false";if(h==null)return"no-value";let p=String(h).trim().toLowerCase();return p==="true"?"true":p==="false"?"false":"no-value"}case"number":{if(typeof h=="number")return String(h);if(typeof h=="string"){let p=h.match(/^(\d+(?:\.\d+)?)/);return p?p[1]:"non-numeric"}return"no-value"}case"date":return h?String(h):"no-date";case"list":{if(Array.isArray(h)){let p=this.normalizeUserListValue(h);return p.length>0?p[0]:"empty"}if(typeof h=="string"){if(h.trim().length===0)return"empty";let p=this.normalizeUserListValue(h);return p.length>0?p[0]:"empty"}return"no-value"}case"text":default:return h?String(h).trim()||"empty":"no-value"}}catch(d){return console.error("Error extracting user field value for grouping",d),"error"}}getDueDateGroup(t,r){var o,l,c;let s=r||new Date;s.setHours(0,0,0,0);let i=this.statusManager.isCompletedStatus(t.status),a=(c=(l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.hideCompletedFromOverdue)!=null?c:!0;if(t.recurrence)if(Kd(t,s)){let d=C(s,"yyyy-MM-dd");return this.getDateGroupFromDateStringWithTask(d,i,a)}else return t.due?this.getDateGroupFromDateStringWithTask(t.due,i,a):"No due date";return t.due?this.getDateGroupFromDateStringWithTask(t.due,i,a):"No due date"}getDateGroupFromDateString(t){let r=qt();if(Un(t))return"Overdue";let s=we(t);if(lr(s,r))return"Today";try{let i=new Date;i.setDate(i.getDate()+1);let a=C(i,"yyyy-MM-dd");if(lr(s,a))return"Tomorrow";let o=new Date;o.setDate(o.getDate()+7);let l=C(o,"yyyy-MM-dd");return Bn(s,l)||lr(s,l)?"Next seven days":"Later"}catch(i){return console.error(`Error categorizing date ${t}:`,i),"Invalid Date"}}getDueDateGroupFromDate(t){return this.getDateGroupFromDateString(t)}getDueDateGroupForTask(t){var i,a,o;if(!t.due)return"No due date";let r=this.statusManager.isCompletedStatus(t.status),s=(o=(a=(i=this.plugin)==null?void 0:i.settings)==null?void 0:a.hideCompletedFromOverdue)!=null?o:!0;return this.getDateGroupFromDateStringWithTask(t.due,r,s)}getDateGroupFromDateStringWithTask(t,r,s){let i=qt();if(Un(t,r,s))return"Overdue";let a=we(t);if(lr(a,i))return"Today";try{let o=new Date;o.setDate(o.getDate()+1);let l=C(o,"yyyy-MM-dd");if(lr(a,l))return"Tomorrow";let c=new Date;c.setDate(c.getDate()+7);let d=C(c,"yyyy-MM-dd");return Bn(a,d)||lr(a,d)?"Next seven days":"Later"}catch(o){return console.error(`Error categorizing date ${t}:`,o),"Invalid Date"}}getScheduledDateGroup(t,r){var a,o,l;if(!t.scheduled)return"No scheduled date";let s=this.statusManager.isCompletedStatus(t.status),i=(l=(o=(a=this.plugin)==null?void 0:a.settings)==null?void 0:o.hideCompletedFromOverdue)!=null?l:!0;return this.getScheduledDateGroupForTask(t.scheduled,s,i)}getScheduledDateGroupForTask(t,r,s){let i=qt();if(Un(t,r,s))return"Past scheduled";let a=we(t);if(lr(a,i))return"Today";try{let o=new Date;o.setDate(o.getDate()+1);let l=C(o,"yyyy-MM-dd");if(lr(a,l))return"Tomorrow";let c=new Date;c.setDate(c.getDate()+7);let d=C(c,"yyyy-MM-dd");return Bn(a,d)||lr(a,d)?"Next seven days":"Later"}catch(o){return console.error(`Error categorizing scheduled date ${t}:`,o),"Invalid Date"}}getScheduledDateGroupFromDate(t){let r=qt();if(Un(t))return"Past scheduled";let s=we(t);if(lr(s,r))return"Today";try{let i=new Date;i.setDate(i.getDate()+1);let a=C(i,"yyyy-MM-dd");if(lr(s,a))return"Tomorrow";let o=new Date;o.setDate(o.getDate()+7);let l=C(o,"yyyy-MM-dd");return Bn(s,l)||lr(s,l)?"Next seven days":"Later"}catch(i){return console.error(`Error categorizing scheduled date ${t}:`,i),"Invalid Date"}}sortGroups(t,r){let s=new Map,i;if(typeof r=="string"&&r.startsWith("user:"))i=this.sortUserFieldGroups(Array.from(t.keys()),r),this.currentSortKey===r&&this.currentSortDirection==="desc"&&i.reverse();else switch(r){case"priority":i=Array.from(t.keys()).sort((a,o)=>{let l=this.priorityManager.getPriorityWeight(a);return this.priorityManager.getPriorityWeight(o)-l});break;case"status":i=Array.from(t.keys()).sort((a,o)=>{let l=this.statusManager.getStatusOrder(a),c=this.statusManager.getStatusOrder(o);return l-c});break;case"due":{let a=["Overdue","Today","Tomorrow","Next seven days","Later","No due date"];i=Array.from(t.keys()).sort((o,l)=>{let c=a.indexOf(o),d=a.indexOf(l);return c-d});break}case"scheduled":{let a=["Past scheduled","Today","Tomorrow","Next seven days","Later","No scheduled date"];i=Array.from(t.keys()).sort((o,l)=>{let c=a.indexOf(o),d=a.indexOf(l);return c-d});break}case"project":i=Array.from(t.keys()).sort((a,o)=>a==="No Project"?1:o==="No Project"?-1:a.localeCompare(o));break;case"tags":i=Array.from(t.keys()).sort((a,o)=>a==="No Tags"?1:o==="No Tags"?-1:a.localeCompare(o));break;default:i=Array.from(t.keys()).sort()}for(let a of i)s.set(a,t.get(a));return s}sortUserFieldGroups(t,r){var o,l;let s=r.slice(5),a=(((l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.userFields)||[]).find(c=>(c.id||c.key)===s);if(!a)return t.sort();switch(a.type){case"number":return t.sort((c,d)=>{let u=parseFloat(c),f=parseFloat(d),h=!isNaN(u),p=!isNaN(f);return h&&p?f-u:h&&!p?-1:!h&&p?1:c.localeCompare(d)});case"boolean":return t.sort((c,d)=>c==="true"&&d==="false"?-1:c==="false"&&d==="true"?1:c.localeCompare(d));case"date":return t.sort((c,d)=>{let u=Date.parse(c),f=Date.parse(d),h=!isNaN(u),p=!isNaN(f);return h&&p?u-f:h&&!p?-1:!h&&p?1:c.localeCompare(d)});case"text":case"list":default:return t.sort((c,d)=>c.localeCompare(d))}}async getFilterOptions(){let t=Date.now();if(this.filterOptionsCache&&t-this.filterOptionsCacheTimestamp<this.filterOptionsCacheTTL)return this.filterOptionsCacheHits++,this.filterOptionsCache;let r={statuses:this.statusManager.getAllStatuses(),priorities:this.priorityManager.getAllPriorities(),contexts:this.cacheManager.getAllContexts(),projects:this.cacheManager.getAllProjects(),tags:this.cacheManager.getAllTags(),folders:this.extractUniqueFolders(),userProperties:this.buildUserPropertyDefinitions()};return this.filterOptionsComputeCount++,this.filterOptionsCache=r,this.filterOptionsCacheTimestamp=t,r}buildUserPropertyDefinitions(){var s,i;let t=((i=(s=this.plugin)==null?void 0:s.settings)==null?void 0:i.userFields)||[],r=[];for(let a of t){if(!a||!a.key||!a.displayName)continue;let o=`user:${a.id||a.key}`,l,c;switch(a.type){case"number":l=["is","is-not","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal","is-empty","is-not-empty"],c="number";break;case"date":l=["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],c="date";break;case"boolean":l=["is-checked","is-not-checked"],c="none";break;case"list":l=["contains","does-not-contain","is-empty","is-not-empty"],c="text";break;case"text":default:l=["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],c="text";break}r.push({id:o,label:a.displayName,category:a.type==="boolean"?"boolean":a.type==="number"?"numeric":a.type==="date"?"date":"text",supportedOperators:l,valueInputType:c})}return r}checkAndInvalidateFilterOptionsCache(){if(!this.filterOptionsCache)return;Date.now()-this.filterOptionsCacheTimestamp>3e4&&this.invalidateFilterOptionsCache()}invalidateFilterOptionsCache(){this.filterOptionsCache&&(this.filterOptionsCache=null)}refreshFilterOptions(){this.invalidateFilterOptionsCache()}getFilterOptionsCacheStats(){let t=Date.now(),r=this.filterOptionsCache?t-this.filterOptionsCacheTimestamp:0,s=this.filterOptionsCache?Math.max(0,this.filterOptionsCacheTTL-r):0,i=this.filterOptionsCacheHits+this.filterOptionsComputeCount,a=i>0?(this.filterOptionsCacheHits/i*100).toFixed(1)+"%":"0%";return{cacheHits:this.filterOptionsCacheHits,computeCount:this.filterOptionsComputeCount,hitRate:a,isCurrentlyCached:!!this.filterOptionsCache,cacheAge:r,ttlRemaining:s}}createDefaultQuery(){return{type:"group",id:Le.generateId(),conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"}}addQuickToggleCondition(t,r,s){let i=JSON.parse(JSON.stringify(t));if(this.removeQuickToggleCondition(i,r),!s){let a;switch(r){case"showCompleted":a={type:"condition",id:Le.generateId(),property:"status.isCompleted",operator:"is-not-checked",value:null};break;case"showArchived":a={type:"condition",id:Le.generateId(),property:"archived",operator:"is-not-checked",value:null};break;case"showRecurrent":a={type:"condition",id:Le.generateId(),property:"recurrence",operator:"is-empty",value:null};break}i.children.push(a)}return i}removeQuickToggleCondition(t,r){let s;switch(r){case"showCompleted":s="status.isCompleted";break;case"showArchived":s="archived";break;case"showRecurrent":s="recurrence";break}t.children=t.children.filter(i=>i.type==="condition"?i.property!==s:!0)}normalizeQuery(t){let r=this.createDefaultQuery();return{...r,...t,type:"group",id:t.id||r.id,conjunction:t.conjunction||r.conjunction,children:t.children||r.children,sortKey:t.sortKey||r.sortKey,sortDirection:t.sortDirection||r.sortDirection,groupKey:t.groupKey||r.groupKey}}initialize(){this.cacheManager.on("file-updated",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-added",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-deleted",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-renamed",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("indexes-built",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")})}cleanup(){this.clearIndexQueryCache(),this.invalidateFilterOptionsCache(),this.removeAllListeners()}static createDateRangeFromDates(t){if(t.length===0)throw new Error("No dates provided");let r=t[0],s=t[t.length-1];return{start:C(r,"yyyy-MM-dd"),end:C(s,"yyyy-MM-dd")}}static shouldIncludeOverdueForRange(t,r){if(!r)return!1;let i=C(new Date,"yyyy-MM-dd");return t.some(a=>C(a,"yyyy-MM-dd")===i)}async getTasksForDate(t,r,s=!1){let i=ue(t),a=oa(i),o=this.cacheManager.getAllTaskPaths(),d=(await this.pathsToTaskInfos(Array.from(o))).filter(u=>this.evaluateFilterNode(r,u)).filter(u=>{var f,h,p;if(u.recurrence){let m=qe(i);return Kd(u,m)}if(u.due&&we(u.due)===i||u.scheduled&&we(u.scheduled)===i)return!0;if(s&&a){let m=this.statusManager.isCompletedStatus(u.status),g=(p=(h=(f=this.plugin)==null?void 0:f.settings)==null?void 0:h.hideCompletedFromOverdue)!=null?p:!0;if(u.due&&we(u.due)!==i&&Un(u.due,m,g)||u.scheduled&&we(u.scheduled)!==i&&Un(u.scheduled,m,g))return!0}return!1});return this.sortTasks(d,r.sortKey||"due",r.sortDirection||"asc")}async getAgendaData(t,r,s=!1){let i=[];for(let a of t){let o=await this.getTasksForDate(a,r,s&&Bd(a));i.push({date:new Date(a),tasks:o})}return i}async getFlatAgendaData(t,r,s=!1){let i=await this.getAgendaData(t,r,s),a=[];for(let o of i)for(let l of o.tasks)a.push({...l,agendaDate:o.date});return a}extractUniqueFolders(){let t=this.cacheManager.getAllTaskPaths(),r=new Set;for(let i of t){let a=i.lastIndexOf("/");if(a>0){let o=i.substring(0,a);r.add(o)}else a===-1&&r.add("")}return Array.from(r).sort().map(i=>i===""?"(Root)":i)}extractProjectNamesFromTaskValue(t,r){if(!t||t.trim()===""||t==='""')return[];let s=t.replace(/^"(.*)"$/,"$1");if(s.startsWith("[[")&&s.endsWith("]]")){let i=s.slice(2,-2),a=(0,RH.parseLinktext)(i),o=this.cacheManager.getApp().metadataCache.getFirstLinkpathDest(a.path,r);if(o)return[o.basename];{let l=a.subpath||(a.path.includes("/")?a.path.split("/").pop():a.path);return l?[l]:[]}}else return[s]}};var hp=class extends kr.ItemView{constructor(t,r){super(t);this.taskElements=new Map;this.daysToShow=7;this.groupByDate=!0;this.showOverdueOnToday=!0;this.showNotes=!0;this.showICSEvents=!0;this.filterBar=null;this.filterHeading=null;this.listeners=[];this.functionListeners=[];this.plugin=r,this.startDate=new Date(r.selectedDate),this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"scheduled",sortDirection:"asc",groupKey:"none"},this.registerEvents()}registerEvents(){this.listeners.forEach(a=>this.plugin.emitter.offref(a)),this.listeners=[],this.functionListeners.forEach(a=>a()),this.functionListeners=[];let t=this.plugin.emitter.on(ar,async()=>{if(this.refresh(),this.filterBar){let a=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(a)}});this.listeners.push(t);let r=this.plugin.emitter.on($s,async()=>{this.refresh()});this.listeners.push(r);let s=this.plugin.emitter.on(Ti,a=>{this.startDate=new Date(a),this.updatePeriodDisplay(),this.refresh()});this.listeners.push(s);let i=this.plugin.filterService.on("data-changed",()=>{this.refresh()});if(this.functionListeners.push(i),this.plugin.icsSubscriptionService){let a=this.plugin.icsSubscriptionService.on("data-changed",()=>{this.refresh()});this.functionListeners.push(a)}}getViewType(){return Bt}getDisplayText(){return"Agenda"}getIcon(){return"calendar-clock"}async onOpen(){await this.plugin.onReady(),await this.plugin.waitForMigration();let t=this.plugin.viewStateManager.getFilterState(Bt);t&&(this.currentQuery=t);let r=this.contentEl;r.empty();let s=r.createDiv({cls:"tasknotes-plugin agenda-view"});this.showLoadingIndicator(),await this.renderView(s),this.hideLoadingIndicator(),Ua(this,{viewId:Bt,debounceDelay:150,maxBatchSize:3,changeDetectionEnabled:!0})}async onClose(){ja(this),this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.functionListeners.forEach(t=>t()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.filterHeading&&(this.filterHeading.destroy(),this.filterHeading=null),this.taskElements.clear(),this.contentEl.empty()}async renderView(t){t.empty(),await this.createAgendaControls(t),await this.renderAgendaContent(t)}async createAgendaControls(t){let r=t.createDiv({cls:"agenda-view__controls"}),i=r.createDiv({cls:"agenda-view__header"}).createDiv({cls:"agenda-view__header-content"}),a=i.createDiv({cls:"agenda-view__nav-section"}),o=a.createEl("button",{cls:"agenda-view__nav-button agenda-view__nav-button--prev",text:"\u2039",attr:{"aria-label":"Previous period",title:"Previous period"}});o.addClass("clickable-icon");let l=a.createEl("button",{cls:"agenda-view__nav-button agenda-view__nav-button--next",text:"\u203A",attr:{"aria-label":"Next period",title:"Next period"}});l.addClass("clickable-icon"),i.createDiv({cls:"agenda-view__title-section"}).createDiv({cls:"agenda-view__period-title",text:this.getCurrentPeriodText()});let d=i.createDiv({cls:"agenda-view__actions-section"});o.addEventListener("click",()=>{this.navigateToPreviousPeriod()}),l.addEventListener("click",()=>{this.navigateToNextPeriod()});let u=d.createEl("button",{text:"Today",cls:"agenda-view__today-button",attr:{"aria-label":"Go to today",title:"Go to today"}});u.addClass("clickable-icon"),u.addEventListener("click",()=>{let T=Ge();this.startDate=T,this.plugin.setSelectedDate(T),this.updatePeriodDisplay(),this.refresh()});let f=d.createEl("button",{text:"Refresh calendars",cls:"agenda-view__today-button",attr:{"aria-label":"Refresh calendar subscriptions",title:"Refresh calendar subscriptions"}});f.addClass("clickable-icon"),f.addEventListener("click",async()=>{if(!this.plugin.icsSubscriptionService){new kr.Notice("Calendar service not ready yet");return}try{await this.plugin.icsSubscriptionService.refreshAllSubscriptions(),new kr.Notice("Calendar subscriptions refreshed"),this.refresh()}catch(T){console.error("Failed to refresh ICS subscriptions",T),new kr.Notice("Failed to refresh calendar subscriptions")}});let h=r.createDiv({cls:"agenda-view__filter-container"});await this.waitForCacheReady(),this.currentQuery=this.plugin.filterService.createDefaultQuery(),this.currentQuery.sortKey="scheduled",this.currentQuery.sortDirection="asc",this.currentQuery.groupKey="none";let p=this.plugin.viewStateManager.getFilterState(Bt);p&&(this.currentQuery=p);let m=await this.plugin.filterService.getFilterOptions();this.filterBar=new hn(this.app,this.plugin,h,this.currentQuery,m,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"agenda"});let g=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(g),this.filterBar.on("saveView",({name:T,query:w,viewOptions:b,visibleProperties:E})=>{let S=this.plugin.viewStateManager.saveView(T,w,b,E);this.filterBar.setActiveSavedView(S)}),this.filterBar.on("deleteView",T=>{this.plugin.viewStateManager.deleteView(T)}),this.filterBar.on("loadViewOptions",T=>{this.applyViewOptions(T)}),this.plugin.viewStateManager.on("saved-views-changed",T=>{var w;(w=this.filterBar)==null||w.updateSavedViews(T)}),this.filterBar.on("reorderViews",(T,w)=>{this.plugin.viewStateManager.reorderSavedViews(T,w)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async T=>{this.currentQuery=T;let w=T;await this.plugin.viewStateManager.setFilterState(Bt,w),this.refresh()}),this.filterBar.on("activeSavedViewChanged",()=>{this.updateFilterHeading()}),this.filterBar.on("propertiesChanged",T=>{this.refresh()}),this.filterBar.on("expandAllGroups",()=>{this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(E=>{let S=E;S.classList.remove("is-collapsed");let D=S.querySelector(".agenda-view__day-items");D&&(D.style.display="");let x=S.querySelector(".task-group-toggle");x&&x.setAttr("aria-expanded","true")});let b={...this.plugin.viewStateManager.getViewPreferences(Bt)||{},collapsedDays:{}};this.plugin.viewStateManager.setViewPreferences(Bt,b)}),this.filterBar.on("collapseAllGroups",()=>{let T={};this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(S=>{let D=S,x=D.dataset.day;x&&(T[x]=!0),D.classList.add("is-collapsed");let M=D.querySelector(".agenda-view__day-items");M&&(M.style.display="none");let B=D.querySelector(".task-group-toggle");B&&B.setAttr("aria-expanded","false")});let E={...this.plugin.viewStateManager.getViewPreferences(Bt)||{},collapsedDays:T};this.plugin.viewStateManager.setViewPreferences(Bt,E)}),this.filterHeading=new Wa(t);let y=t.querySelector(".filter-heading");if(y){let T=y.querySelector(".filter-heading__content");if(T){let w=T.createDiv({cls:"filter-heading__controls"});this.createExpandCollapseButtons(w)}}this.updateFilterHeading(),this.setupViewOptions()}createExpandCollapseButtons(t){t.style.display="flex",t.empty(),new kr.ButtonComponent(t).setIcon("list-tree").setTooltip("Expand All Days").setClass("agenda-view-control-button").onClick(()=>{this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(l=>{let c=l;c.classList.remove("is-collapsed");let d=c.querySelector(".agenda-view__day-items");d&&(d.style.display="");let u=c.querySelector(".task-group-toggle");u&&u.setAttr("aria-expanded","true")});let o={...this.plugin.viewStateManager.getViewPreferences(Bt)||{},collapsedDays:{}};this.plugin.viewStateManager.setViewPreferences(Bt,o)}).buttonEl.addClass("clickable-icon"),new kr.ButtonComponent(t).setIcon("list-collapse").setTooltip("Collapse All Days").setClass("agenda-view-control-button").onClick(()=>{let i={};this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(c=>{let d=c,u=d.dataset.day;u&&(i[u]=!0),d.classList.add("is-collapsed");let f=d.querySelector(".agenda-view__day-items");f&&(f.style.display="none");let h=d.querySelector(".task-group-toggle");h&&h.setAttr("aria-expanded","false")});let l={...this.plugin.viewStateManager.getViewPreferences(Bt)||{},collapsedDays:i};this.plugin.viewStateManager.setViewPreferences(Bt,l)}).buttonEl.addClass("clickable-icon")}setupViewOptions(){if(!this.filterBar)return;let t=[{id:"showOverdueOnToday",label:"Show overdue on today",value:this.showOverdueOnToday,onChange:r=>{this.showOverdueOnToday=r,this.refresh()}},{id:"showNotes",label:"Show notes",value:this.showNotes,onChange:r=>{this.showNotes=r,this.refresh()}},{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents,onChange:r=>{this.showICSEvents=r,this.refresh()}}];this.filterBar.setViewOptions(t)}applyViewOptions(t){t.hasOwnProperty("showOverdueOnToday")&&(this.showOverdueOnToday=t.showOverdueOnToday),t.hasOwnProperty("showNotes")&&(this.showNotes=t.showNotes),t.hasOwnProperty("icsEvents")&&(this.showICSEvents=t.icsEvents),t.hasOwnProperty("showICSEvents")&&(this.showICSEvents=t.showICSEvents),this.setupViewOptions(),this.refresh()}renderPeriodSelector(t){let r=t.createEl("select",{cls:"agenda-view__period-select"});[{value:"7",text:"7 days"},{value:"14",text:"14 days"},{value:"30",text:"30 days"},{value:"week",text:"This week"}].forEach(i=>{let a=r.createEl("option",{value:i.value,text:i.text});(i.value==="7"&&this.daysToShow===7||i.value==="week"&&this.daysToShow===-1)&&(a.selected=!0)}),r.addEventListener("change",()=>{let i=r.value;i==="week"?this.daysToShow=-1:this.daysToShow=parseInt(i),this.refresh()})}getDateRange(){let t=this.getAgendaDates();return Va.createDateRangeFromDates(t)}async addNotesToAgendaData(t){if(this.plugin.settings.disableNoteIndexing||!this.showNotes)return t.map(s=>({...s,notes:[]}));let r=t.map(async s=>{let i=await this.plugin.cacheManager.getNotesForDate(s.date);return{...s,notes:i}});return Promise.all(r)}async renderAgendaContent(t){let r=t.querySelector(".agenda-view__content");r||(r=t.createDiv({cls:"agenda-view__content"}));try{let s=this.getAgendaDates(),i=[];for(let l of s){let c=await this.plugin.filterService.getTasksForDate(l,this.currentQuery,this.showOverdueOnToday),d=[];if(this.showICSEvents&&this.plugin.icsSubscriptionService){let u=this.plugin.icsSubscriptionService.getAllEvents();d=this.filterICSEventsForDate(u,l)}i.push({date:l,tasks:c,ics:d})}let o=(await this.addNotesToAgendaData(i.map(l=>({date:l.date,tasks:l.tasks})))).map((l,c)=>({...l,ics:i[c].ics}));this.groupByDate?this.renderGroupedAgendaWithReconciler(r,o):this.renderFlatAgendaWithReconciler(r,o)}catch(s){console.error("Error rendering agenda content:",s),r.empty(),r.createDiv({cls:"agenda-view__error"}).createSpan({text:"Error loading agenda. Please try refreshing."})}}filterICSEventsForDate(t,r){try{let s=ho(r),i=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),a=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999);return t.filter(o=>{let l=new Date(o.start),c=o.end?new Date(o.end):null;return c?l<=a&&c>=i:l>=i&&l<=a})}catch(s){return[]}}renderGroupedAgendaWithReconciler(t,r){t.empty(),this.taskElements.clear();let s=!1;if(r.forEach(i=>{let a=ue(i.date);if(i.tasks.length>0||i.notes.length>0||this.showICSEvents&&i.ics.length>0){s=!0;let l=a,c=this.isDayCollapsed(l),d=t.createDiv({cls:"agenda-view__day-section task-group"});d.setAttribute("data-day",l);let u=this.createDayHeader(i,l);d.appendChild(u);let f=d.createDiv({cls:"agenda-view__day-items"});c&&(d.addClass("is-collapsed"),f.style.display="none"),this.addDayHeaderClickHandlers(u,d,f,l);let h=[];i.tasks.forEach(p=>{h.push({type:"task",item:p,date:i.date})}),i.notes.forEach(p=>{h.push({type:"note",item:p,date:i.date})}),this.showICSEvents&&[...i.ics].sort((m,g)=>{try{let y=new Date(m.start).getTime(),T=new Date(g.start).getTime();return y-T}catch(y){return 0}}).forEach(m=>{h.push({type:"ics",item:m,date:i.date})}),this.plugin.domReconciler.updateList(f,h,p=>`${p.type}-${p.item.path||p.item.id||"unknown"}`,p=>this.createDayItemElement(p),(p,m)=>this.updateDayItemElement(p,m))}}),!s){t.empty();let i=t.createDiv({cls:"agenda-view__empty"});new kr.Setting(i).setName("No items scheduled").setHeading(),i.createEl("p",{text:"No items scheduled for this period.",cls:"agenda-view__empty-description"});let a=i.createEl("p",{cls:"agenda-view__empty-tip"});a.createEl("span",{text:"Tip: "}),a.appendChild(document.createTextNode("Create tasks with due or scheduled dates, or add notes to see them here."));return}}renderFlatAgendaWithReconciler(t,r){this.taskElements.clear();let s=[];if(r.forEach(i=>{i.tasks.forEach(a=>{s.push({type:"task",item:a,date:i.date})}),i.notes.forEach(a=>{s.push({type:"note",item:a,date:i.date})}),this.showICSEvents&&[...i.ics].sort((o,l)=>{try{let c=new Date(o.start).getTime(),d=new Date(l.start).getTime();return c-d}catch(c){return 0}}).forEach(o=>{s.push({type:"ics",item:o,date:i.date})})}),s.length===0){t.empty();let i=t.createDiv({cls:"agenda-view__empty"});new kr.Setting(i).setName("No items found").setHeading(),i.createEl("p",{text:"No items found for the selected period.",cls:"agenda-view__empty-description"});return}s.sort((i,a)=>i.date.getTime()-a.date.getTime()),this.plugin.domReconciler.updateList(t,s,i=>`${i.type}-${i.item.path||i.item.id||"unknown"}`,i=>this.createFlatAgendaItemElement(i),(i,a)=>this.updateFlatAgendaItemElement(i,a))}createAgendaItemElement(t){var r,s;if(t.type==="day-header"){let i=document.createElement("div");i.className="agenda-view__day-header task-group-header",i.setAttribute("data-day",t.dayKey);let a=i.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle day"}});try{(0,kr.setIcon)(a,"chevron-right")}catch(p){}let o=a.querySelector("svg");o?(o.classList.add("chevron"),o.setAttr("width","16"),o.setAttr("height","16")):(a.textContent="\u25B8",a.addClass("chevron-text"));let l=i.createDiv({cls:"agenda-view__day-header-text"}),c=ho(t.date),d=C(c,"EEEE"),u=C(c,"MMMM d");Bd(t.date)?(l.createSpan({cls:"agenda-view__day-name agenda-view__day-name--today",text:"Today"}),l.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${u}`})):(l.createSpan({cls:"agenda-view__day-name",text:d}),l.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${u}`}));let f=t.item.tasks||[],h;if(f.length>0){let p=Mt.calculateGroupStats(f,this.plugin);h=Mt.formatGroupCount(p.completed,p.total).text}else h=`${(((r=t.item.notes)==null?void 0:r.length)||0)+(((s=t.item.ics)==null?void 0:s.length)||0)}`;return i.createDiv({cls:"agenda-view__item-count",text:h}),i}else return t.type==="task"?this.createTaskItemElement(t.item,t.date):t.type==="note"?this.createNoteItemElement(t.item,t.date):this.createICSEventItemElement(t.item)}updateAgendaItemElement(t,r){var s,i;if(r.type==="day-header"){let a=t.querySelector(".agenda-view__item-count");if(a){let o=r.item.tasks||[],l;if(o.length>0){let c=Mt.calculateGroupStats(o,this.plugin);l=Mt.formatGroupCount(c.completed,c.total).text}else l=`${(((s=r.item.notes)==null?void 0:s.length)||0)+(((i=r.item.ics)==null?void 0:i.length)||0)}`;a.textContent=l}}else if(r.type==="task"){let a=this.getCurrentVisibleProperties();Pn(t,r.item,this.plugin,a,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}else r.type==="ics"&&Ry(t,r.item,this.plugin)}createFlatAgendaItemElement(t){return t.type==="task"?this.createTaskItemElement(t.item,t.date):t.type==="note"?this.createNoteItemElement(t.item,t.date):this.createICSEventItemElement(t.item)}updateFlatAgendaItemElement(t,r){if(r.type==="task"){let s=this.getCurrentVisibleProperties();Pn(t,r.item,this.plugin,s,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}else r.type==="ics"&&Ry(t,r.item,this.plugin)}getCurrentVisibleProperties(){var t;return(t=this.filterBar)==null?void 0:t.getCurrentVisibleProperties()}createTaskItemElement(t,r){let s=this.getCurrentVisibleProperties(),i=fr(t,this.plugin,s,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r});if(t.path){let a=t.recurrence&&r?`${t.path}:${ue(r)}`:t.path;this.taskElements.set(a,i)}return this.addDragHandlers(i,t),i}createNoteItemElement(t,r){let s=Ay(t,this.plugin,{showCreatedDate:!1,showTags:!0,showPath:!1,maxTags:3,showDailyNoteBadge:!1});if(!this.groupByDate&&r){let i=ho(r);s.createSpan({cls:"agenda-view__note-date",text:C(i,"MMM d")})}return s}createICSEventItemElement(t){return IH(t,this.plugin,{})}addDragHandlers(t,r){this.plugin.dragDropManager.makeTaskCardDraggable(t,r.path)}addHoverPreview(t,r){t.addEventListener("mouseover",s=>{this.app.vault.getAbstractFileByPath(r)&&this.app.workspace.trigger("hover-link",{event:s,source:"tasknotes-agenda",hoverParent:this,targetEl:t,linktext:r,sourcePath:r})})}openFile(t){let r=this.app.vault.getAbstractFileByPath(t);r instanceof kr.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}getAgendaDates(){let t=[];if(this.daysToShow===-1){let s={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},i=Er(this.startDate,s),a=to(this.startDate,s),o=i;for(;o<=a;){let l=wt(o);t.push(l),o=Br(o,1)}}else for(let r=0;r<this.daysToShow;r++){let s=Br(this.startDate,r),i=wt(s);t.push(i)}return t}navigateToPreviousPeriod(){this.daysToShow===-1?this.startDate=Br(this.startDate,-7):this.startDate=Br(this.startDate,-this.daysToShow),this.updatePeriodDisplay(),this.refresh()}navigateToNextPeriod(){this.daysToShow===-1?this.startDate=Br(this.startDate,7):this.startDate=Br(this.startDate,this.daysToShow),this.updatePeriodDisplay(),this.refresh()}updatePeriodDisplay(){let t=this.contentEl.querySelector(".agenda-view__period-title");t&&(t.textContent=this.getCurrentPeriodText())}getCurrentPeriodText(){let t=this.getAgendaDates();if(t.length===0)return"";let r=ho(t[0]),s=ho(t[t.length-1]);return kd(t[0],t[t.length-1])?C(r,"EEEE, MMMM d, yyyy"):`${C(r,"MMM d")} - ${C(s,"MMM d, yyyy")}`}showLoadingIndicator(){let t=this.contentEl.querySelector(".agenda-view");if(!t||t.querySelector(".agenda-view__loading"))return;let r=document.createElement("div");r.className="agenda-view__loading",r.textContent="Loading agenda...",t.prepend(r)}hideLoadingIndicator(){let t=this.contentEl.querySelector(".agenda-view__loading");t&&t.remove()}async updateFilterHeading(){if(!(!this.filterHeading||!this.filterBar))try{let t=this.getAgendaDates(),r=[];for(let a of t){let o=await this.plugin.filterService.getTasksForDate(a,this.currentQuery,this.showOverdueOnToday);r.push(...o)}let s=Mt.calculateGroupStats(r,this.plugin),i=this.filterBar.activeSavedView||null;this.filterHeading.update(i,s.completed,s.total)}catch(t){console.error("Error updating filter heading in AgendaView:",t)}}async refresh(){let t=this.contentEl.querySelector(".agenda-view");t&&(this.setupViewOptions(),await this.renderAgendaContent(t),this.updateFilterHeading())}shouldRefreshForTask(t,r){return My(t,r)}async updateForTask(t,r){let s=await this.plugin.cacheManager.getTaskInfo(t);if(s!=null&&s.recurrence){await this.refresh();return}let i=this.taskElements.get(t);switch(r){case"update":if(i){let a=await this.plugin.cacheManager.getTaskInfo(t);if(a)try{let o=this.plugin.settings.defaultVisibleProperties||["due","scheduled"];Pn(i,a,this.plugin,o,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0}),i.classList.add("task-card--updated"),window.setTimeout(()=>{i.classList.remove("task-card--updated")},1e3),console.log(`[AgendaView] Selectively updated task: ${t}`)}catch(o){console.error("[AgendaView] Error in selective update:",o),await this.refresh()}else i.remove(),this.taskElements.delete(t)}else await this.refresh();break;case"delete":i&&(i.remove(),this.taskElements.delete(t));break;case"create":await this.refresh();break}}createDayHeader(t,r){var p,m;let s=document.createElement("div");s.className="agenda-view__day-header task-group-header",s.setAttribute("data-day",r);let i=s.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle day"}});try{(0,kr.setIcon)(i,"chevron-right")}catch(g){}let a=i.querySelector("svg");a?(a.classList.add("chevron"),a.setAttr("width","16"),a.setAttr("height","16")):(i.textContent="\u25B8",i.addClass("chevron-text"));let o=s.createDiv({cls:"agenda-view__day-header-text"}),l=ho(t.date),c=C(l,"EEEE"),d=C(l,"MMMM d");Bd(t.date)?(o.createSpan({cls:"agenda-view__day-name agenda-view__day-name--today",text:"Today"}),o.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${d}`})):(o.createSpan({cls:"agenda-view__day-name",text:c}),o.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${d}`}));let u=t.tasks||[],f;if(u.length>0){let g=Mt.calculateGroupStats(u,this.plugin);f=Mt.formatGroupCount(g.completed,g.total).text}else f=`${(((p=t.notes)==null?void 0:p.length)||0)+(((m=t.ics)==null?void 0:m.length)||0)}`;s.createDiv({cls:"agenda-view__item-count",text:f});let h=this.isDayCollapsed(r);return i.setAttr("aria-expanded",String(!h)),s}addDayHeaderClickHandlers(t,r,s,i){let a=t.querySelector(".task-group-toggle");this.registerDomEvent(t,"click",o=>{if(o.target.closest("a"))return;let c=!r.hasClass("is-collapsed");this.setDayCollapsed(i,c),r.toggleClass("is-collapsed",c),s.style.display=c?"none":"",a&&a.setAttr("aria-expanded",String(!c))}),a&&this.registerDomEvent(a,"click",o=>{o.preventDefault(),o.stopPropagation();let l=!r.hasClass("is-collapsed");this.setDayCollapsed(i,l),r.toggleClass("is-collapsed",l),s.style.display=l?"none":"",a.setAttr("aria-expanded",String(!l))})}createDayItemElement(t){return t.type==="task"?this.createTaskItemElement(t.item,t.date):t.type==="note"?this.createNoteItemElement(t.item,t.date):this.createICSEventItemElement(t.item)}updateDayItemElement(t,r){if(r.type==="task"){let s=this.getCurrentVisibleProperties();Pn(t,r.item,this.plugin,s,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}else r.type==="ics"&&Ry(t,r.item,this.plugin)}isDayCollapsed(t){try{return!!((this.plugin.viewStateManager.getViewPreferences(Bt)||{}).collapsedDays||{})[t]}catch(r){return!1}}setDayCollapsed(t,r){let i={...this.plugin.viewStateManager.getViewPreferences(Bt)||{}};i.collapsedDays||(i.collapsedDays={}),i.collapsedDays[t]=r,this.plugin.viewStateManager.setViewPreferences(Bt,i)}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(t=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),t()})})}};var $a=require("obsidian");or();var nd=require("obsidian");Ne();At();var sd=class extends nd.FuzzySuggestModal{constructor(e,t,r,s){super(e),this.plugin=t,this.tasks=r,this.onChooseTask=s,this.setPlaceholder("Type to search for a task..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText("Select Task"),this.titleEl.setAttribute("id","task-selector-title"),this.containerEl.setAttribute("aria-labelledby","task-selector-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true")}getItems(){return this.tasks.filter(e=>!e.archived).sort((e,t)=>{var l,c;let r=this.plugin.statusManager.isCompletedStatus(e.status),s=this.plugin.statusManager.isCompletedStatus(t.status);if(r!==s)return r?1:-1;if(e.due&&!t.due)return-1;if(!e.due&&t.due)return 1;if(e.due&&t.due){let d=e.due.localeCompare(t.due);if(d!==0)return d}let i={high:0,normal:1,low:2},a=(l=i[e.priority])!=null?l:1,o=(c=i[t.priority])!=null?c:1;return a!==o?a-o:e.title.localeCompare(t.title)})}getItemText(e){let t=e.title;e.due&&(t+=` ${e.due}`),e.priority!=="normal"&&(t+=` ${e.priority}`),e.contexts&&e.contexts.length>0&&(t+=` ${e.contexts.join(" ")}`);let r=Xr(e.projects||[]);return r.length>0&&(t+=` ${r.join(" ")}`),t}renderSuggestion(e,t){let r=e.item,s=t.createDiv({cls:"task-selector-modal__suggestion"}),i=s.createDiv({cls:"task-selector-modal__title"}),a=r.priority!=="normal"?`task-selector-modal__task-title--${r.priority}-priority`:"";i.createSpan({cls:`task-selector-modal__task-title ${a}`,text:r.title});let o=s.createDiv({cls:"task-selector-modal__meta"});if(r.due){let c=Ul(r.due),d=oa(r.due),u=r.due,f="task-selector-modal__due-date";c?(u=`Overdue (${r.due})`,f+=" task-selector-modal__due-date--overdue"):d&&(u="Due today",f+=" task-selector-modal__due-date--today"),o.createSpan({cls:f,text:u})}if(r.contexts&&r.contexts.length>0){let c=o.createSpan({cls:"task-selector-modal__contexts"});r.contexts.forEach((d,u)=>{u>0&&c.createSpan({text:", "}),c.createSpan({cls:"task-selector-modal__context-tag",text:`${d}`})})}let l=Xr(r.projects||[]);if(l.length>0){let c=o.createSpan({cls:"task-selector-modal__projects"});l.forEach((d,u)=>{u>0&&c.createSpan({text:", "});let f=document.createTextNode("+");if(c.appendChild(f),G6(d)){let h=d.slice(2,-2);c.createEl("a",{cls:"task-selector-modal__project-link internal-link",text:h,attr:{"data-href":h}}).addEventListener("click",async m=>{m.preventDefault(),m.stopPropagation();let g=this.plugin.app.metadataCache.getFirstLinkpathDest(h,"");g instanceof nd.TFile?(await this.plugin.app.workspace.getLeaf(!1).openFile(g),this.close()):new nd.Notice(`Note "${h}" not found`)})}else c.createSpan({cls:"task-selector-modal__project-tag",text:d})})}if(r.status!=="open"){let c=this.plugin.statusManager.getStatusConfig(r.status);o.createSpan({cls:"task-selector-modal__status",text:c?c.label:r.status})}}onChooseItem(e,t){this.onChooseTask(e)}onClose(){super.onClose()}};function G6(n){return!!(n&&typeof n=="string"&&n.startsWith("[[")&&n.endsWith("]]"))}Fs();var Ny=class extends $a.ItemView{constructor(t,r){super(t);this.timerDisplay=null;this.statusDisplay=null;this.progressCircle=null;this.progressContainer=null;this.startButton=null;this.pauseButton=null;this.stopButton=null;this.taskDisplay=null;this.statsDisplay=null;this.taskSelectButton=null;this.taskClearButton=null;this.currentSelectedTask=null;this.taskCardContainer=null;this.addTimeButton=null;this.subtractTimeButton=null;this.skipBreakButton=null;this.statElements={pomodoros:null};this.resizeObserver=null;this.resizeTimeout=null;this.functionListeners=[];this.currentCircleSize=300;this.currentCircumference=0;this.listeners=[];this.plugin=r,this.registerEvents()}getViewType(){return Nl}getDisplayText(){return"Pomodoro"}getIcon(){return"clock"}registerEvents(){this.listeners.forEach(o=>this.plugin.emitter.offref(o)),this.listeners=[];let t=this.plugin.emitter.on(Nd,({session:o,task:l})=>{this.updateDisplay(o,l)});this.listeners.push(t);let r=this.plugin.emitter.on(Od,({session:o,nextType:l})=>{this.onPomodoroComplete(o,l)});this.listeners.push(r);let s=this.plugin.emitter.on(Ld,({session:o})=>{this.updateDisplay()});this.listeners.push(s);let i=this.plugin.emitter.on(Vs,({timeRemaining:o,session:l})=>{this.updateTimer(o),this.updateDisplay(l)});this.listeners.push(i);let a=this.plugin.emitter.on(dt,async({path:o,originalTask:l,updatedTask:c})=>{if(!o||!c)return;if(this.currentSelectedTask&&(this.currentSelectedTask.path===o||l&&this.currentSelectedTask.path===l.path)){this.currentSelectedTask=c,this.updateTaskCardDisplay(c);let u=this.plugin.pomodoroService.getState();u.currentSession&&l&&l.path!==c.path&&u.currentSession.taskPath===l.path&&await this.plugin.pomodoroService.assignTaskToCurrentSession(c)}});this.listeners.push(a)}async onOpen(){await this.plugin.onReady(),await this.render(),this.ensureResizeHandlingSetup(),this.plugin.app.workspace.layoutReady?setTimeout(()=>this.ensureResizeHandlingSetup(),50):this.plugin.app.workspace.onLayoutReady(()=>{this.ensureResizeHandlingSetup()})}async onClose(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.functionListeners.forEach(t=>t()),this.timerDisplay=null,this.statusDisplay=null,this.progressCircle=null,this.progressContainer=null,this.startButton=null,this.pauseButton=null,this.stopButton=null,this.taskDisplay=null,this.statsDisplay=null,this.taskSelectButton=null,this.taskClearButton=null,this.currentSelectedTask=null,this.taskCardContainer=null,this.statElements={pomodoros:null},this.contentEl.empty()}async render(){let t=this.contentEl.createDiv({cls:"tasknotes-plugin pomodoro-view"});this.statusDisplay=t.createDiv({cls:"pomodoro-view__status",text:"Focus"});let r=t.createDiv({cls:"pomodoro-view__timer-section"});this.progressContainer=r.createDiv({cls:"pomodoro-view__progress-container"});let s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("class","pomodoro-view__progress-svg"),s.setAttribute("width","300"),s.setAttribute("height","300"),s.setAttribute("viewBox","0 0 300 300"),this.progressContainer.appendChild(s);let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttributeNS(null,"cx","150"),i.setAttributeNS(null,"cy","150"),i.setAttributeNS(null,"r","140"),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"stroke","var(--tn-border-color)"),i.setAttributeNS(null,"stroke-width","2"),s.appendChild(i),this.progressCircle=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.progressCircle.setAttributeNS(null,"cx","150"),this.progressCircle.setAttributeNS(null,"cy","150"),this.progressCircle.setAttributeNS(null,"r","140"),this.progressCircle.setAttributeNS(null,"fill","none"),this.progressCircle.setAttributeNS(null,"stroke","var(--tn-interactive-accent)"),this.progressCircle.setAttributeNS(null,"stroke-width","4"),this.progressCircle.setAttributeNS(null,"stroke-linecap","round");let o=2*Math.PI*140;this.progressCircle.setAttributeNS(null,"stroke-dasharray",o.toString()),this.progressCircle.setAttributeNS(null,"stroke-dashoffset",o.toString()),this.progressCircle.addClass("pomodoro-view__progress-circle"),s.appendChild(this.progressCircle);let l=this.progressContainer.createDiv({cls:"pomodoro-view__timer-overlay"}),d=`${this.plugin.settings.pomodoroWorkDuration.toString().padStart(2,"0")}:00`;this.timerDisplay=l.createDiv({cls:"pomodoro-view__timer-display",text:d});let u=l.createDiv({cls:"pomodoro-view__time-controls"});this.subtractTimeButton=u.createEl("button",{cls:"pomodoro-view__time-adjust-button pomodoro-view__subtract-time",text:"-"}),this.addTimeButton=u.createEl("button",{cls:"pomodoro-view__time-adjust-button pomodoro-view__add-time",text:"+"}),this.taskDisplay=t.createDiv({cls:"pomodoro-view__task-display"});let f=t.createDiv({cls:"pomodoro-view__task-selector"}),h=f.createDiv({cls:"pomodoro-view__task-buttons"});this.taskSelectButton=h.createEl("button",{cls:"pomodoro-view__task-select-button",text:"Choose task..."}),this.taskClearButton=h.createEl("button",{cls:"pomodoro-view__task-clear-button pomodoro-view__task-clear-button--hidden",text:"Clear task"}),this.taskCardContainer=f.createDiv({cls:"pomodoro-view__task-card-container"});let p=t.createDiv({cls:"pomodoro-view__control-section"}),m=p.createDiv({cls:"pomodoro-view__primary-controls"});this.startButton=m.createEl("button",{text:"Start",cls:"pomodoro-view__start-button"}),this.pauseButton=m.createEl("button",{text:"Pause",cls:"pomodoro-view__pause-button"}),this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton=m.createEl("button",{text:"Stop",cls:"pomodoro-view__stop-button"}),this.stopButton.addClass("pomodoro-view__stop-button--hidden"),this.skipBreakButton=p.createEl("button",{cls:"pomodoro-view__skip-break-button",text:"Skip break"}),this.skipBreakButton.addClass("pomodoro-view__skip-break-button--hidden");let g=t.createDiv({cls:"pomodoro-view__stats-section"});this.statsDisplay=g.createDiv({cls:"pomodoro-view__stats"});let y=this.statsDisplay.createDiv({cls:"pomodoro-view__stat pomodoro-view__stat--clickable"});if(this.statElements.pomodoros=y.createSpan({cls:"pomodoro-view__stat-value",text:"0"}),y.createSpan({cls:"pomodoro-view__stat-label",text:"completed today"}),this.registerDomEvent(y,"click",()=>{this.plugin.activatePomodoroStatsView()}),this.registerDomEvent(this.startButton,"click",async()=>{var T,w,b;if(!((T=this.startButton)!=null&&T.hasClass("is-loading"))){(w=this.startButton)==null||w.addClass("pomodoro-view__start-button--loading");try{let E=this.plugin.pomodoroService.getState();E.currentSession&&!E.isRunning?await this.plugin.pomodoroService.resumePomodoro():E.nextSessionType==="short-break"?await this.plugin.pomodoroService.startBreak(!1):E.nextSessionType==="long-break"?await this.plugin.pomodoroService.startBreak(!0):await this.plugin.pomodoroService.startPomodoro(this.currentSelectedTask||void 0)}finally{(b=this.startButton)==null||b.removeClass("pomodoro-view__start-button--loading")}}}),this.registerDomEvent(this.pauseButton,"click",()=>{this.plugin.pomodoroService.pausePomodoro()}),this.registerDomEvent(this.stopButton,"click",()=>{this.plugin.pomodoroService.stopPomodoro()}),this.registerDomEvent(this.skipBreakButton,"click",()=>{let T=this.plugin.pomodoroService.getState();T.currentSession?this.plugin.pomodoroService.stopPomodoro():(T.nextSessionType==="short-break"||T.nextSessionType==="long-break")&&this.plugin.pomodoroService.startPomodoro(this.currentSelectedTask||void 0)}),this.registerDomEvent(this.addTimeButton,"click",()=>{this.adjustSessionTime(60)}),this.registerDomEvent(this.subtractTimeButton,"click",()=>{this.adjustSessionTime(-60)}),this.registerDomEvent(this.taskSelectButton,"click",async()=>{await this.openTaskSelector()}),this.registerDomEvent(this.taskClearButton,"click",async()=>{await this.selectTask(null)}),this.restoreLastSelectedTask(),this.updateDisplay(),this.updateStats().catch(T=>{console.error("Failed to update initial stats:",T)}),this.plugin.pomodoroService){let T=this.plugin.pomodoroService.getState();this.updateTimer(T.timeRemaining)}}setupResizeHandling(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.functionListeners.forEach(a=>a()),this.functionListeners=[];let t=this.contentEl.ownerDocument.defaultView||window,r=()=>{this.resizeTimeout&&t.clearTimeout(this.resizeTimeout),this.resizeTimeout=t.setTimeout(()=>{this.updateResponsiveLayout()},150)};if(t.ResizeObserver){this.resizeObserver=new t.ResizeObserver(r);let a=this.contentEl.querySelector(".pomodoro-view");a&&this.resizeObserver.observe(a)}let s=this.plugin.app.workspace.on("layout-change",r);this.listeners.push(s),t.addEventListener("resize",r),this.functionListeners.push(()=>t.removeEventListener("resize",r));let i=this.plugin.app.workspace.on("active-leaf-change",a=>{a===this.leaf&&t.setTimeout(()=>{this.updateResponsiveLayout()},100)});this.listeners.push(i),this.updateResponsiveLayout()}ensureResizeHandlingSetup(t=0){let s=Math.min(100*Math.pow(1.5,t),1e3);setTimeout(()=>{if(!this.resizeObserver){let i=this.contentEl.querySelector(".pomodoro-view");i?i.getBoundingClientRect().width>0?this.setupResizeHandling():t<10&&this.ensureResizeHandlingSetup(t+1):t<10&&this.ensureResizeHandlingSetup(t+1)}},s)}updateResponsiveLayout(){let t=this.contentEl.querySelector(".pomodoro-view");if(!t)return;let r=t.getBoundingClientRect(),s=r.width,i=r.height,a=Math.min(s/600,1),o=Math.min(i/800,1),l=Math.min(a*.7+o*.3,1);t.classList.remove("pomodoro-view--tiny","pomodoro-view--extra-narrow","pomodoro-view--very-narrow","pomodoro-view--narrow","pomodoro-view--small","pomodoro-view--medium-small","pomodoro-view--medium","pomodoro-view--wide"),s<=200?t.classList.add("pomodoro-view--tiny"):s<=250?t.classList.add("pomodoro-view--extra-narrow"):s<=300?t.classList.add("pomodoro-view--very-narrow"):s<=350?t.classList.add("pomodoro-view--narrow"):s<=400?t.classList.add("pomodoro-view--small"):s<=500?t.classList.add("pomodoro-view--medium-small"):s<=600?t.classList.add("pomodoro-view--medium"):t.classList.add("pomodoro-view--wide");let c=t.querySelector(".pomodoro-view__timer-display");if(c){let d,u;s<=200?(d=2,u="700"):s<=250?(d=2.2,u="650"):s<=300?(d=2.5,u="600"):s<=350?(d=3,u="600"):s<=400?(d=3.2,u="550"):s<=500?(d=3.6,u="500"):s<=600?(d=4,u="500"):(d=4.5,u="400");let h=`${Math.max(d*l,1.5).toFixed(1)}rem`;c.style.fontSize=h,c.style.fontWeight=u}this.updateProgressCircleSize(s,i)}updateProgressCircleSize(t,r){if(!this.progressContainer)return;let s=this.progressContainer.querySelector(".pomodoro-view__progress-svg");if(!s)return;let i=Math.min(t*.8,r*.4),a;if(t<=200?a=Math.max(120,Math.min(i,t-40)):t<=250?a=Math.max(150,Math.min(i,t-50)):t<=300?a=Math.max(180,Math.min(i,t-60)):t<=350?a=Math.max(200,Math.min(i,t-70)):t<=400?a=Math.max(230,Math.min(i,t-80)):t<=500?a=Math.max(250,Math.min(i,t-100)):t<=600?a=Math.max(280,Math.min(i,300)):a=Math.max(300,Math.min(i,t*.5,400)),a===this.currentCircleSize)return;this.currentCircleSize=a,s.setAttribute("width",a.toString()),s.setAttribute("height",a.toString()),s.setAttribute("viewBox",`0 0 ${a} ${a}`),this.progressContainer.style.width=`${a}px`,this.progressContainer.style.height=`${a}px`;let o=a/2,l=o-20;if(s.querySelectorAll("circle").forEach(d=>{d.setAttribute("cx",o.toString()),d.setAttribute("cy",o.toString()),d.setAttribute("r",l.toString())}),this.progressCircle){let d=2*Math.PI*l;if(this.currentCircumference=d,this.progressCircle.setAttribute("stroke-dasharray",d.toString()),this.progressCircle.setAttribute("stroke-dashoffset",d.toString()),this.plugin.pomodoroService){let u=this.plugin.pomodoroService.getState();this.updateProgress(u)}}}async openTaskSelector(){try{let r=(await this.plugin.cacheManager.getAllTasks()).filter(i=>!i.archived);if(r.length===0){new $a.Notice("No unarchived tasks found. Create some tasks first.");return}new sd(this.app,this.plugin,r,i=>{this.selectTask(i)}).open()}catch(t){console.error("Error opening task selector:",t),new $a.Notice("Failed to load tasks")}}async selectTask(t){this.currentSelectedTask=t,this.taskSelectButton&&(t?(this.taskSelectButton.textContent="Change task...",(0,$a.setTooltip)(this.taskSelectButton,"Select a different task",{placement:"top"}),this.taskSelectButton.removeClass("pomodoro-view__task-select-button--no-task")):(this.taskSelectButton.textContent="Choose task...",this.taskSelectButton.removeAttribute("title"),this.taskSelectButton.addClass("pomodoro-view__task-select-button--no-task"))),this.taskClearButton&&(t?this.taskClearButton.removeClass("pomodoro-view__task-clear-button--hidden"):this.taskClearButton.addClass("pomodoro-view__task-clear-button--hidden")),this.updateTaskCardDisplay(t),await this.plugin.pomodoroService.saveLastSelectedTask(t==null?void 0:t.path);let r=this.plugin.pomodoroService.getState();r.currentSession&&r.currentSession.type==="work"&&await this.plugin.pomodoroService.assignTaskToCurrentSession(t||void 0)}updateTaskCardDisplay(t){if(this.taskCardContainer)if(this.taskCardContainer.empty(),t){let r=fr(t,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!0,showRecurringControls:!1,groupByDate:!1});this.taskCardContainer.appendChild(r),this.taskCardContainer.removeClass("pomodoro-view__task-card-container--empty")}else this.taskCardContainer.addClass("pomodoro-view__task-card-container--empty")}async restoreLastSelectedTask(){try{if(!this.plugin.pomodoroService){console.log("PomodoroView: pomodoroService not available, skipping restore");return}let t=await this.plugin.pomodoroService.getLastSelectedTaskPath();if(t){let r=await this.plugin.cacheManager.getTaskByPath(t);r&&!this.plugin.statusManager.isCompletedStatus(r.status)&&!r.archived&&await this.selectTask(r)}}catch(t){console.error("Error restoring last selected task:",t)}}async updateTaskButtonFromPath(t){try{let r=await this.plugin.cacheManager.getTaskInfo(t);if(r){this.currentSelectedTask=r,this.taskSelectButton&&(this.taskSelectButton.textContent="Change task...",(0,$a.setTooltip)(this.taskSelectButton,"Select a different task",{placement:"top"}),this.taskSelectButton.removeClass("pomodoro-no-task"),this.taskSelectButton.removeClass("pomodoro-view__task-select-button--no-task")),this.taskClearButton&&this.taskClearButton.removeClass("pomodoro-view__task-clear-button--hidden"),this.updateTaskCardDisplay(r);return}this.currentSelectedTask=null,this.taskSelectButton&&(this.taskSelectButton.textContent="Choose task...",this.taskSelectButton.removeAttribute("title"),this.taskSelectButton.addClass("pomodoro-view__task-select-button--no-task")),this.taskClearButton&&this.taskClearButton.addClass("pomodoro-view__task-clear-button--hidden"),this.updateTaskCardDisplay(null)}catch(r){console.error("Error updating task button from path:",r)}}updateDisplay(t,r){var i,a;if(!this.plugin.pomodoroService){this.statusDisplay&&(this.statusDisplay.textContent="Ready to start",this.statusDisplay.className="pomodoro-status pomodoro-view__status");return}let s=this.plugin.pomodoroService.getState();if(this.updateTimer(s.timeRemaining),this.updateProgress(s),this.statusDisplay)if(s.isRunning&&s.currentSession){let o=s.currentSession.type==="work"?"Working":s.currentSession.type==="short-break"?"Short break":"Long break";this.statusDisplay.textContent=o,this.statusDisplay.className=`pomodoro-status pomodoro-view__status pomodoro-status-${s.currentSession.type} pomodoro-view__status--${s.currentSession.type}`}else s.currentSession&&!s.isRunning?(this.statusDisplay.textContent="Paused",this.statusDisplay.className="pomodoro-status pomodoro-view__status pomodoro-status-paused pomodoro-view__status--paused"):(this.statusDisplay.textContent="Ready to start",this.statusDisplay.className="pomodoro-status pomodoro-view__status");if(this.taskDisplay){let o=(i=s.currentSession)==null?void 0:i.taskPath,l=this.taskDisplay.dataset.currentTaskPath;o!==l&&(this.taskDisplay.empty(),this.taskDisplay.dataset.currentTaskPath=o||"")}if(this.taskSelectButton&&(a=s.currentSession)!=null&&a.taskPath&&!this.currentSelectedTask&&this.updateTaskButtonFromPath(s.currentSession.taskPath),this.startButton&&this.pauseButton&&this.stopButton&&(s.isRunning?(this.startButton.addClass("pomodoro-view__start-button--hidden"),this.pauseButton.removeClass("pomodoro-view__pause-button--hidden"),this.stopButton.removeClass("pomodoro-view__stop-button--hidden")):s.currentSession?(this.startButton.removeClass("pomodoro-view__start-button--hidden"),this.startButton.textContent="Resume",this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton.removeClass("pomodoro-view__stop-button--hidden")):(this.startButton.removeClass("pomodoro-view__start-button--hidden"),s.nextSessionType==="short-break"?this.startButton.textContent="Start Short Break":s.nextSessionType==="long-break"?this.startButton.textContent="Start Long Break":this.startButton.textContent="Start",this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton.addClass("pomodoro-view__stop-button--hidden"))),this.skipBreakButton){let o=s.currentSession&&(s.currentSession.type==="short-break"||s.currentSession.type==="long-break"),l=!s.currentSession&&(s.nextSessionType==="short-break"||s.nextSessionType==="long-break");o||l?(this.skipBreakButton.removeClass("pomodoro-view__skip-break-button--hidden"),this.skipBreakButton.textContent="Skip break"):this.skipBreakButton.addClass("pomodoro-view__skip-break-button--hidden")}this.addTimeButton&&this.subtractTimeButton&&(this.addTimeButton.removeClass("pomodoro-view__time-adjust-button--hidden"),this.subtractTimeButton.removeClass("pomodoro-view__time-adjust-button--hidden")),this.updateStats().catch(o=>{console.error("Failed to update stats:",o)})}updateTimer(t){if(this.timerDisplay){let r=Math.max(0,Math.floor(t)),s=Math.floor(r/60),i=r%60;this.timerDisplay.textContent=`${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`,r<=60&&r>0?this.timerDisplay.addClass("pomodoro-view__timer-display--warning"):this.timerDisplay.removeClass("pomodoro-view__timer-display--warning")}}updateProgress(t){if(!this.progressCircle)return;let r=this.currentCircumference;if(r===0){let c=this.progressCircle.getAttribute("r"),d=c?parseInt(c):140;r=2*Math.PI*d,this.currentCircumference=r}if(!t.currentSession){this.progressCircle.setAttributeNS(null,"stroke-dashoffset",r.toString()),this.progressCircle.removeClass("pomodoro-view__progress-circle--work"),this.progressCircle.removeClass("pomodoro-view__progress-circle--short-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--long-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--warning");return}let s=t.currentSession.activePeriods||[],i=0;for(let c of s)if(c.endTime){let d=new Date(c.startTime).getTime(),u=new Date(c.endTime).getTime();i+=Math.floor((u-d)/1e3)}else if(t.isRunning){let d=new Date(c.startTime).getTime(),u=Date.now();i+=Math.floor((u-d)/1e3)}let a=t.currentSession.plannedDuration*60,o=a>0?Math.max(0,Math.min(1,i/a)):0,l=r-o*r;this.progressCircle.setAttributeNS(null,"stroke-dashoffset",l.toString()),this.progressCircle.removeClass("pomodoro-view__progress-circle--work"),this.progressCircle.removeClass("pomodoro-view__progress-circle--short-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--long-break"),this.progressCircle.addClass(`pomodoro-view__progress-circle--${t.currentSession.type}`),t.timeRemaining<=60&&t.timeRemaining>0?this.progressCircle.addClass("pomodoro-view__progress-circle--warning"):this.progressCircle.removeClass("pomodoro-view__progress-circle--warning")}async updateStats(){try{if(!this.plugin.pomodoroService){this.statElements.pomodoros&&(this.statElements.pomodoros.textContent="0");return}let t=await this.plugin.pomodoroService.getTodayStats();this.statElements.pomodoros&&this.statElements.pomodoros.textContent!==t.pomodorosCompleted.toString()&&(this.statElements.pomodoros.textContent=t.pomodorosCompleted.toString())}catch(t){console.error("Failed to update stats:",t),this.statElements.pomodoros&&(this.statElements.pomodoros.textContent="0")}}adjustSessionTime(t){if(!this.plugin.pomodoroService)return;let r=this.plugin.pomodoroService.getState();if(r.currentSession)this.plugin.pomodoroService.adjustSessionTime(t);else{let s=Math.max(60,r.timeRemaining+t);this.plugin.pomodoroService.adjustPreparedTimer(s)}if(this.plugin.pomodoroService){let s=this.plugin.pomodoroService.getState();this.updateTimer(s.timeRemaining),this.updateProgress(s)}}onPomodoroComplete(t,r){if(this.updateDisplay(),this.statusDisplay)if(t.type==="work"){let s=r==="long-break";this.statusDisplay.textContent=`Great work! Time for a ${s?"long":"short"} break`}else this.statusDisplay.textContent="Break complete! Ready for the next pomodoro?"}};var zi=require("obsidian");Ft();or();Ne();function fp(n){if(n.activePeriods&&Array.isArray(n.activePeriods))return n.activePeriods.filter(e=>e.endTime).reduce((e,t)=>{let r=new Date(t.startTime),i=new Date(t.endTime).getTime()-r.getTime();return e+Math.round(i/(1e3*60))},0);if(n.duration!==void 0)return n.duration;if(n.startTime&&n.endTime){let e=new Date(n.startTime),r=new Date(n.endTime).getTime()-e.getTime();return Math.round(r/(1e3*60))}return 0}var NH=`
  let timerInterval;

  self.onmessage = function(e) {
    const { command, duration } = e.data;

    if (command === 'start') {
      if (timerInterval) {
        clearInterval(timerInterval);
      }

      let timeRemaining = duration;
      timerInterval = setInterval(() => {
        timeRemaining--;
        // Notificar al hilo principal cada segundo para actualizar la UI
        self.postMessage({ type: 'tick', timeRemaining: timeRemaining });

        if (timeRemaining <= 0) {
          self.postMessage({ type: 'done' });
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }, 1000);

    } else if (command === 'stop') {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }
  };
`;var Oy=class extends zi.ItemView{constructor(t,r){super(t);this.overviewStatsEl=null;this.todayStatsEl=null;this.weekStatsEl=null;this.recentSessionsEl=null;this.overallStatsEl=null;this.plugin=r}getViewType(){return Ol}getDisplayText(){return"Pomodoro stats"}getIcon(){return"bar-chart"}calculateActualDuration(t){return t.filter(r=>r.endTime).reduce((r,s)=>{let i=new Date(s.startTime),o=(s.endTime?new Date(s.endTime):new Date).getTime()-i.getTime();return r+Math.round(o/(1e3*60))},0)}async onOpen(){await this.plugin.onReady(),await this.render()}async onClose(){this.contentEl.empty()}async render(){let t=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container pomodoro-stats-container pomodoro-stats-view"}),r=t.createDiv({cls:"pomodoro-stats-header pomodoro-stats-view__header"});new zi.Setting(r).setName("Pomodoro statistics").setHeading();let s=r.createEl("button",{cls:"pomodoro-stats-refresh-button pomodoro-stats-view__refresh-button",text:"Refresh"});this.registerDomEvent(s,"click",()=>{this.refreshStats()});let i=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new zi.Setting(i).setName("Overview").setHeading(),this.overviewStatsEl=i.createDiv({cls:"pomodoro-overview-grid pomodoro-stats-view__overview-grid"});let a=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new zi.Setting(a).setName("Today").setHeading(),this.todayStatsEl=a.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let o=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new zi.Setting(o).setName("This week").setHeading(),this.weekStatsEl=o.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let l=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new zi.Setting(l).setName("All time").setHeading(),this.overallStatsEl=l.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let c=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new zi.Setting(c).setName("Recent sessions").setHeading(),this.recentSessionsEl=c.createDiv({cls:"pomodoro-recent-sessions pomodoro-stats-view__recent-sessions"}),await this.refreshStats()}async refreshStats(){try{await Promise.all([this.updateOverviewStats(),this.updateTodayStats(),this.updateWeekStats(),this.updateOverallStats(),this.updateRecentSessions()])}catch(t){console.error("Failed to refresh stats:",t)}}async updateOverviewStats(){if(!this.overviewStatsEl)return;let t=await this.plugin.pomodoroService.getTodayStats(),r=await this.calculateOverallStatsFromHistory(),s=Ge(),i=new Date(s);i.setDate(i.getDate()-1);let a=wt(i),o=await this.calculateStatsForRange(a,a);this.renderOverviewStats(this.overviewStatsEl,t,r,o)}async updateTodayStats(){if(!this.todayStatsEl)return;let t=await this.plugin.pomodoroService.getTodayStats();this.renderStatsGrid(this.todayStatsEl,t)}async updateWeekStats(){if(!this.weekStatsEl)return;let t=Ge(),r=wt(t),i={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},a=Er(r,i),o=to(r,i),l=await this.calculateStatsForRange(a,o);this.renderStatsGrid(this.weekStatsEl,l)}async updateOverallStats(){if(!this.overallStatsEl)return;let t=await this.plugin.pomodoroService.getSessionHistory(),r=this.calculateOverallStats(t);this.renderStatsGrid(this.overallStatsEl,r)}async calculateOverallStatsFromHistory(){let t=await this.plugin.pomodoroService.getSessionHistory();return this.calculateOverallStats(t)}async updateRecentSessions(){var s;if(!this.recentSessionsEl)return;let r=(await this.plugin.pomodoroService.getSessionHistory()).filter(i=>i.type==="work").slice(-10).reverse();if(this.recentSessionsEl.empty(),r.length===0){this.recentSessionsEl.createDiv({cls:"pomodoro-no-sessions pomodoro-stats-view__no-sessions",text:"No sessions recorded yet"});return}for(let i of r){let a=this.recentSessionsEl.createDiv({cls:"pomodoro-session-item pomodoro-stats-view__session-item"}),o=a.createSpan({cls:"session-date pomodoro-stats-view__session-date"}),l=this.plugin.settings.calendarViewSettings.timeFormat;o.textContent=C(new Date(i.startTime),l==="12"?"MMM d, h:mm a":"MMM d, HH:mm");let c=a.createSpan({cls:"session-duration pomodoro-stats-view__session-duration"}),d=fp(i);c.textContent=`${d}min`;let u=a.createSpan({cls:"session-status pomodoro-stats-view__session-status"});if(u.textContent=i.completed?"Completed":"Interrupted",u.addClass(i.completed?"status-completed":"status-interrupted"),u.addClass(i.completed?"pomodoro-stats-view__session-status--completed":"pomodoro-stats-view__session-status--interrupted"),i.taskPath){let f=a.createSpan({cls:"session-task pomodoro-stats-view__session-task"}),h=((s=i.taskPath.split("/").pop())==null?void 0:s.replace(".md",""))||"";f.textContent=h}}}renderOverviewStats(t,r,s,i){t.empty();let a=y=>{if(y<60)return`${y}m`;let T=Math.floor(y/60),w=y%60;return w>0?`${T}h${w}m`:`${T}h`},o=r.pomodorosCompleted-i.pomodorosCompleted,l=r.totalMinutes-i.totalMinutes,c=t.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),d=c.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});if(d.textContent=r.pomodorosCompleted.toString(),c.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Today's Pomos"}),o!==0){let y=c.createDiv({cls:"overview-change pomodoro-stats-view__overview-change"});y.textContent=`${o>0?"+":""}${o} from yesterday`,y.addClass(o>0?"positive":"negative")}let u=t.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),f=u.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});f.textContent=s.pomodorosCompleted.toString(),u.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Total Pomos"});let h=t.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),p=h.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});if(p.textContent=a(r.totalMinutes),h.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Today's Focus"}),l!==0){let y=h.createDiv({cls:"overview-change pomodoro-stats-view__overview-change"});y.textContent=`${a(Math.abs(l))} ${l>0?"more":"less"} than yesterday`,y.addClass(l>0?"positive":"negative")}let m=t.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),g=m.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});g.textContent=a(s.totalMinutes),m.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Total Focus Duration"})}renderStatsGrid(t,r){t.empty();let s=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});s.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.pomodorosCompleted.toString()}),s.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Pomodoros"});let i=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});i.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.currentStreak.toString()}),i.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Streak"});let a=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});a.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.totalMinutes.toString()}),a.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Minutes"});let o=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});o.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.averageSessionLength.toString()}),o.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Avg Length"});let l=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});l.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:`${r.completionRate}%`}),l.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Completion"})}async calculateStatsForRange(t,r){let s=await this.plugin.pomodoroService.getSessionHistory(),i=Sr(t),a=Sr(r),o=s.filter(l=>{try{let c=kT(l.startTime),d=Sr(c);return d>=i&&d<=a}catch(c){return console.error("Error parsing session timestamp for filtering:",{sessionStartTime:l.startTime,error:c}),!1}});return this.calculateStatsFromSessions(o)}calculateOverallStats(t){return this.calculateStatsFromSessions(t)}calculateStatsFromSessions(t){let r=t.filter(c=>c.type==="work"),s=r.filter(c=>c.completed),i=0;for(let c=r.length-1;c>=0&&r[c].completed;c--)i++;let a=s.reduce((c,d)=>c+fp(d),0),o=s.length>0?a/s.length:0,l=r.length>0?s.length/r.length*100:0;return{pomodorosCompleted:s.length,currentStreak:i,totalMinutes:a,averageSessionLength:Math.round(o),completionRate:Math.round(l)}}};var di=require("obsidian");Ft();or();At();Ne();Fs();var Ly=class extends di.ItemView{constructor(t,r){super(t);this.overviewStatsEl=null;this.todayStatsEl=null;this.weekStatsEl=null;this.monthStatsEl=null;this.projectsStatsEl=null;this.filtersEl=null;this.currentFilters={dateRange:"all",selectedProjects:[],minTimeSpent:0};this.drilldownModal=null;this.currentDrilldownData=null;this.listeners=[];this.statsCache=new Map;this.lastCacheTime=0;this.CACHE_DURATION=6e4;this.debounceTimeout=null;this.plugin=r}getViewType(){return Ll}getDisplayText(){return"Statistics"}getIcon(){return"bar-chart-4"}async onOpen(){await this.plugin.onReady();let t=this.plugin.emitter.on(dt,async({path:r,originalTask:s,updatedTask:i})=>{if(!r||!i||!this.drilldownModal||!this.currentDrilldownData)return;this.currentDrilldownData.tasks.some(o=>o.path===r||s&&o.path===s.path)&&await this.refreshDrilldownModal()});this.listeners.push(t),await this.render()}async onClose(){this.contentEl.empty(),this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.listeners=[]}async render(){let t=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container stats-container stats-view"}),r=t.createDiv({cls:"stats-header stats-view__header"});new di.Setting(r).setName("Task & Project Statistics").setHeading();let s=r.createEl("button",{cls:"stats-refresh-button stats-view__refresh-button",text:"Refresh"});this.registerDomEvent(s,"click",()=>{this.refreshStats()});let i=t.createDiv({cls:"stats-section stats-view__section"});new di.Setting(i).setName("Filters").setHeading(),this.filtersEl=i.createDiv({cls:"stats-filters stats-view__filters"}),this.renderFilters();let a=t.createDiv({cls:"stats-section stats-view__section"});new di.Setting(a).setName("Overview").setHeading(),this.overviewStatsEl=a.createDiv({cls:"stats-overview-grid stats-view__overview-grid"});let o=t.createDiv({cls:"stats-section stats-view__section"});new di.Setting(o).setName("Today").setHeading(),this.todayStatsEl=o.createDiv({cls:"stats-grid stats-view__stats-grid"});let l=t.createDiv({cls:"stats-section stats-view__section"});new di.Setting(l).setName("This Week").setHeading(),this.weekStatsEl=l.createDiv({cls:"stats-grid stats-view__stats-grid"});let c=t.createDiv({cls:"stats-section stats-view__section"});new di.Setting(c).setName("This Month").setHeading(),this.monthStatsEl=c.createDiv({cls:"stats-grid stats-view__stats-grid"});let d=t.createDiv({cls:"stats-section stats-view__section"});new di.Setting(d).setName("Project Breakdown").setHeading(),this.projectsStatsEl=d.createDiv({cls:"stats-projects stats-view__projects"}),await this.refreshStats()}async refreshStats(){try{this.clearCache();let t=await Promise.allSettled([this.updateOverviewStats(),this.updateTodayStats(),this.updateWeekStats(),this.updateMonthStats(),this.updateProjectStats()])}catch(t){}}async getAllTasks(){let t=`all-tasks-${JSON.stringify(this.currentFilters)}`;if(this.isCacheValid()&&this.statsCache.has(t)){let i=this.statsCache.get(t);if(i)return i}let r=await this.plugin.cacheManager.getAllTaskPaths(),s=[];for(let i of r)try{let a=await this.plugin.cacheManager.getTaskInfo(i);a&&s.push(a)}catch(a){}return s=this.applyTaskFilters(s),this.statsCache.set(t,s),this.lastCacheTime=Date.now(),s}applyTaskFilters(t){let r=t,s=this.getFilterDateRange();return(s.start||s.end)&&(r=r.filter(i=>{if(i.timeEntries&&i.timeEntries.length>0)return i.timeEntries.some(a=>{if(!a.startTime)return!1;let o=new Date(a.startTime);return!(s.start&&o<s.start||s.end&&o>s.end)});if(i.completedDate){let a=new Date(i.completedDate);return!(s.start&&a<s.start||s.end&&a>s.end)}if(i.dateCreated){let a=new Date(i.dateCreated);return!(s.start&&a<s.start||s.end&&a>s.end)}return!(s.start||s.end)})),this.currentFilters.minTimeSpent>0&&(r=r.filter(i=>En(i.timeEntries||[])>=this.currentFilters.minTimeSpent)),r}async updateOverviewStats(){if(!this.overviewStatsEl)return;let t=await this.getAllTasks(),r=this.calculateOverallStats(t);this.renderOverviewStats(this.overviewStatsEl,r)}async updateTodayStats(){if(!this.todayStatsEl)return;let t=Ge(),r=wt(t),s=Sr(r),i=await this.calculateStatsForRange(s,r);this.renderTimeRangeStats(this.todayStatsEl,i)}async updateWeekStats(){if(!this.weekStatsEl)return;let t=Ge(),r=wt(t),i={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},a=Er(r,i),o=to(r,i),l=await this.calculateStatsForRange(a,o);this.renderTimeRangeStats(this.weekStatsEl,l)}async updateMonthStats(){if(!this.monthStatsEl)return;let t=Ge(),r=wt(t),s=Uv(r),i=Bv(r),a=await this.calculateStatsForRange(s,i);this.renderTimeRangeStats(this.monthStatsEl,a)}async updateProjectStats(){if(!this.projectsStatsEl)return;let t=await this.getAllTasks(),r=this.calculateProjectStats(t);await this.renderProjectStats(this.projectsStatsEl,r)}consolidateProjectName(t){var r;if(!t||typeof t!="string")return t;if(t.startsWith("[[")&&t.endsWith("]]")){let s=this.extractWikilinkPath(t);if(s&&((r=this.plugin)!=null&&r.app)){let i=this.plugin.app.metadataCache.getFirstLinkpathDest(s,"");if(i)return i.basename;let a=this.extractProjectName(t);if(a)return a}}if(t.includes("|")){let s=t.split("|");return s[s.length-1]||t}if(t.includes("/")){let s=t.split("/");return s[s.length-1]||t}return t}extractWikilinkPath(t){if(!t||typeof t!="string"||!t.startsWith("[[")||!t.endsWith("]]"))return null;let r=t.slice(2,-2),s=r.indexOf("|");return s!==-1?r.substring(0,s).trim():r}extractProjectName(t){if(!t)return null;if(t.startsWith("[[")&&t.endsWith("]]")){let r=this.extractWikilinkPath(t);if(!r)return null;let s=r.split("/");return s[s.length-1]||r}if(t.includes("|")){let r=t.split("|");return r[r.length-1]||t}if(t.includes("/")){let r=t.split("/");return r[r.length-1]||t}return t}calculateOverallStats(t){let r=0,s=0,i=new Set;for(let a of t){r+=En(a.timeEntries||[]),this.plugin.statusManager.isCompletedStatus(a.status)&&s++;let o=this.getTaskProjects(a);for(let l of o)i.add(l)}return{totalTimeSpent:r,totalTasks:t.length,completedTasks:s,activeProjects:i.size,completionRate:t.length>0?s/t.length*100:0,avgTimePerTask:t.length>0?r/t.length:0}}async calculateStatsForRange(t,r){let i=(await this.getAllTasks()).filter(l=>{if(l.timeEntries&&l.timeEntries.length>0)return l.timeEntries.some(c=>{if(!c.startTime)return!1;let d=new Date(c.startTime);return d>=t&&d<=r});if(l.completedDate){let c=new Date(l.completedDate);return c>=t&&c<=r}if(l.dateCreated){let c=new Date(l.dateCreated);return c>=t&&c<=r}return!1}),a=this.calculateOverallStats(i),o=this.calculateProjectStats(i);return{overall:a,projects:o}}calculateProjectStats(t){let r=new Map;for(let i of t){let a=En(i.timeEntries||[]),o=this.plugin.statusManager.isCompletedStatus(i.status),l;i.timeEntries&&i.timeEntries.length>0?l=[...i.timeEntries].sort((u,f)=>new Date(f.startTime).getTime()-new Date(u.startTime).getTime())[0].startTime:i.completedDate?l=i.completedDate:i.dateModified&&(l=i.dateModified);let c=this.getTaskProjects(i);for(let d of c){r.has(d)||r.set(d,{tasks:[],totalTime:0,completedCount:0,lastActivity:void 0});let u=r.get(d);u&&(u.tasks.push(i),u.totalTime+=a,o&&u.completedCount++,l&&(!u.lastActivity||new Date(l)>new Date(u.lastActivity))&&(u.lastActivity=l))}}let s=[];for(let[i,a]of r.entries())s.push({projectName:i,totalTimeSpent:a.totalTime,taskCount:a.tasks.length,completedTaskCount:a.completedCount,avgTimePerTask:a.tasks.length>0?a.totalTime/a.tasks.length:0,lastActivity:a.lastActivity});return s.sort((i,a)=>i.projectName==="No Project"?1:a.projectName==="No Project"?-1:a.totalTimeSpent-i.totalTimeSpent),s}renderFilters(){if(!this.filtersEl)return;this.filtersEl.empty();let t=this.filtersEl.createDiv({cls:"stats-view__filter-grid"}),r=t.createDiv({cls:"stats-view__filter-item"}),s=r.createDiv({cls:"stats-view__filter-label"});s.textContent="Date Range";let i=r.createEl("select",{cls:"stats-view__filter-select"}),a=[{value:"all",text:"All Time"},{value:"7days",text:"Last 7 Days"},{value:"30days",text:"Last 30 Days"},{value:"90days",text:"Last 90 Days"},{value:"custom",text:"Custom Range"}];for(let h of a){let p=i.createEl("option",{value:h.value,text:h.text});h.value===this.currentFilters.dateRange&&(p.selected=!0)}this.registerDomEvent(i,"change",()=>{this.currentFilters.dateRange=i.value,this.renderCustomDateInputs(),this.applyFilters()});let o=t.createDiv({cls:"stats-view__custom-dates"});this.currentFilters.dateRange==="custom"&&this.renderCustomDateInputs(o);let l=t.createDiv({cls:"stats-view__filter-item"}),c=l.createDiv({cls:"stats-view__filter-label"});c.textContent="Min Time (minutes)";let d=l.createEl("input",{cls:"stats-view__filter-input",type:"number",value:this.currentFilters.minTimeSpent.toString(),placeholder:"0"});this.registerDomEvent(d,"input",()=>{this.currentFilters.minTimeSpent=parseInt(d.value)||0,this.applyFilters()});let f=t.createDiv({cls:"stats-view__filter-buttons"}).createEl("button",{cls:"stats-view__filter-button stats-view__filter-button--reset",text:"Reset Filters"});this.registerDomEvent(f,"click",()=>{this.currentFilters={dateRange:"all",selectedProjects:[],minTimeSpent:0},this.renderFilters(),this.applyFilters()})}renderCustomDateInputs(t){var s;let r=t||((s=this.filtersEl)==null?void 0:s.querySelector(".stats-view__custom-dates"));if(r&&(r.empty(),this.currentFilters.dateRange==="custom")){let i=r.createDiv({cls:"stats-view__date-input-container"});i.createDiv({cls:"stats-view__date-label",text:"From"});let a=i.createEl("input",{cls:"stats-view__date-input",type:"date",value:this.currentFilters.customStartDate||""}),o=r.createDiv({cls:"stats-view__date-input-container"});o.createDiv({cls:"stats-view__date-label",text:"To"});let l=o.createEl("input",{cls:"stats-view__date-input",type:"date",value:this.currentFilters.customEndDate||""});this.registerDomEvent(a,"change",()=>{this.currentFilters.customStartDate=a.value,this.applyFilters()}),this.registerDomEvent(l,"change",()=>{this.currentFilters.customEndDate=l.value,this.applyFilters()})}}async applyFilters(){this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(async()=>{await this.refreshStats(),this.debounceTimeout=null},300)}isCacheValid(){return Date.now()-this.lastCacheTime<this.CACHE_DURATION}clearCache(){this.statsCache.clear(),this.lastCacheTime=0}getTaskProjects(t){try{if(!t||!Array.isArray(t.projects))return["No Project"];let r=Xr(t.projects);return r.length>0?r.map(s=>this.consolidateProjectName(s)).filter(s=>typeof s=="string"&&s.length>0):["No Project"]}catch(r){return["No Project"]}}getFilterDateRange(){let t=Ge(),r=wt(t);switch(this.currentFilters.dateRange){case"7days":return{start:Dl(r,7),end:r};case"30days":return{start:Dl(r,30),end:r};case"90days":return{start:Dl(r,90),end:r};case"custom":return{start:this.currentFilters.customStartDate?new Date(this.currentFilters.customStartDate):void 0,end:this.currentFilters.customEndDate?new Date(this.currentFilters.customEndDate):void 0};case"all":default:return{}}}renderOverviewStats(t,r){t.empty();let s=m=>{if(m<60)return`${Math.round(m)}m`;let g=Math.floor(m/60),y=Math.round(m%60);return y>0?`${g}h ${y}m`:`${g}h`},i=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),a=i.createDiv({cls:"overview-value stats-view__overview-value"});a.textContent=s(r.totalTimeSpent),i.createDiv({cls:"overview-label stats-view__overview-label",text:"Total Time Tracked"});let o=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),l=o.createDiv({cls:"overview-value stats-view__overview-value"});l.textContent=r.totalTasks.toString(),o.createDiv({cls:"overview-label stats-view__overview-label",text:"Total Tasks"});let c=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),d=c.createDiv({cls:"overview-value stats-view__overview-value"});d.textContent=`${Math.round(r.completionRate)}%`,c.createDiv({cls:"overview-label stats-view__overview-label",text:"Completion Rate"});let u=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),f=u.createDiv({cls:"overview-value stats-view__overview-value"});f.textContent=r.activeProjects.toString(),u.createDiv({cls:"overview-label stats-view__overview-label",text:"Active Projects"});let h=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),p=h.createDiv({cls:"overview-value stats-view__overview-value"});p.textContent=s(r.avgTimePerTask),h.createDiv({cls:"overview-label stats-view__overview-label",text:"Avg Time per Task"})}renderTimeRangeStats(t,r){t.empty();let s=c=>{if(c<60)return`${Math.round(c)}m`;let d=Math.floor(c/60),u=Math.round(c%60);return u>0?`${d}h ${u}m`:`${d}h`},i=t.createDiv({cls:"stats-stat-card stats-view__stat-card"});i.createDiv({cls:"stat-value stats-view__stat-value",text:s(r.overall.totalTimeSpent)}),i.createDiv({cls:"stat-label stats-view__stat-label",text:"Time Tracked"});let a=t.createDiv({cls:"stats-stat-card stats-view__stat-card"});a.createDiv({cls:"stat-value stats-view__stat-value",text:r.overall.totalTasks.toString()}),a.createDiv({cls:"stat-label stats-view__stat-label",text:"Tasks"});let o=t.createDiv({cls:"stats-stat-card stats-view__stat-card"});o.createDiv({cls:"stat-value stats-view__stat-value",text:r.overall.completedTasks.toString()}),o.createDiv({cls:"stat-label stats-view__stat-label",text:"Completed"});let l=t.createDiv({cls:"stats-stat-card stats-view__stat-card"});l.createDiv({cls:"stat-value stats-view__stat-value",text:r.overall.activeProjects.toString()}),l.createDiv({cls:"stat-label stats-view__stat-label",text:"Projects"})}async renderProjectStats(t,r){if(t.empty(),r.length===0){t.createDiv({cls:"stats-no-data stats-view__no-data",text:"No project data available"});return}let s=o=>{if(o<60)return`${Math.round(o)}m`;let l=Math.floor(o/60),c=Math.round(o%60);return c>0?`${l}h ${c}m`:`${l}h`},i=o=>{if(!o)return"N/A";try{let l=new Date(o);return C(l,"MMM d, yyyy")}catch(l){return"N/A"}},a=Math.max(...r.map(o=>o.totalTimeSpent));for(let o of r){let l=["stats-project-item","stats-view__project-item","stats-view__project-item--clickable"];o.projectName==="No Project"&&l.push("stats-view__project-item--no-project");let c=t.createDiv({cls:l.join(" ")});this.registerDomEvent(c,"click",()=>{this.openProjectDrilldown(o.projectName)});let d=c.createDiv({cls:"stats-view__project-header"}),u=d.createDiv({cls:"project-name stats-view__project-name"});u.textContent=o.projectName,d.createDiv({cls:"stats-view__click-indicator",text:"\u2192"});let f=o.taskCount>0?o.completedTaskCount/o.taskCount*100:0,h=c.createDiv({cls:"stats-view__project-content-grid"}),p=h.createDiv({cls:"stats-view__progress-container"});this.renderProgressCircle(p,f,o.completedTaskCount,o.taskCount);let m=h.createDiv({cls:"stats-view__stats-container"});if(o.totalTimeSpent>0){let w=m.createDiv({cls:"stats-view__time-bar"}),E=w.createDiv({cls:"stats-view__time-bar-visual"}).createDiv({cls:"stats-view__time-bar-fill"}),S=a>0?o.totalTimeSpent/a*100:0;E.style.width=`${S}%`;let D=w.createDiv({cls:"stats-view__time-bar-label"});D.textContent=s(o.totalTimeSpent)}let g=m.createDiv({cls:"project-stats stats-view__project-stats"});if(o.lastActivity){let w=g.createDiv({cls:"project-stat stats-view__project-stat"});w.textContent=`Last activity: ${i(o.lastActivity)}`}if(o.avgTimePerTask>0){let w=g.createDiv({cls:"project-stat stats-view__project-stat"});w.textContent=`Avg: ${s(o.avgTimePerTask)}/task`}let y=m.createDiv({cls:"stats-view__trend-container"}),T=y.createDiv({cls:"stats-view__sparkline"});try{let w=await this.calculateProjectTrend(o.projectName);w.length>0&&w.some(b=>b.value>0)?this.renderSparkline(T,w):y.remove()}catch(w){y.remove()}}}renderProgressCircle(t,r,s,i){let c=2*Math.PI*27.5,d=c-r/100*c,u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("width","60"),u.setAttribute("height","60"),u.setAttribute("viewBox","0 0 60 60"),u.classList.add("stats-view__progress-circle-svg");let f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("cx",(60/2).toString()),f.setAttribute("cy",(60/2).toString()),f.setAttribute("r",27.5.toString()),f.classList.add("stats-view__progress-circle-bg");let h=document.createElementNS("http://www.w3.org/2000/svg","circle");h.setAttribute("cx",(60/2).toString()),h.setAttribute("cy",(60/2).toString()),h.setAttribute("r",27.5.toString()),h.setAttribute("stroke-dasharray",`${c} ${c}`),h.setAttribute("stroke-dashoffset",d.toString()),h.classList.add("stats-view__progress-circle-fg");let p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x","50%"),p.setAttribute("y","50%"),p.setAttribute("dy","0.3em"),p.setAttribute("text-anchor","middle"),p.classList.add("stats-view__progress-circle-text"),p.textContent=`${Math.round(r)}%`,u.appendChild(f),u.appendChild(h),u.appendChild(p),t.appendChild(u);let m=t.createDiv({cls:"stats-view__progress-label"});m.textContent=`${s}/${i} tasks`}async calculateProjectTrend(t){try{let r=await this.plugin.cacheManager.getAllTaskPaths(),s=[];for(let l of r)try{let c=await this.plugin.cacheManager.getTaskInfo(l);c&&this.getTaskProjects(c).includes(t)&&s.push(c)}catch(c){}let i=[],a=Ge(),o=wt(a);for(let l=29;l>=0;l--){let c=Dl(o,l),d=C(c,"yyyy-MM-dd"),u=0;for(let f of s)if(f.timeEntries)for(let h of f.timeEntries)h.startTime&&C(new Date(h.startTime),"yyyy-MM-dd")===d&&(u+=En([h]));i.push({date:d,value:u})}return i}catch(r){return[]}}renderSparkline(t,r){if(t.empty(),r.length===0)return;let s=100,i=20,a=Math.max(...r.map(d=>d.value));if(a===0)return;let o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width",s.toString()),o.setAttribute("height",i.toString()),o.setAttribute("viewBox",`0 0 ${s} ${i}`),o.classList.add("stats-view__sparkline-svg");let l=document.createElementNS("http://www.w3.org/2000/svg","path"),c="";r.forEach((d,u)=>{let f=u/(r.length-1)*s,h=i-d.value/a*i;u===0?c+=`M ${f} ${h}`:c+=` L ${f} ${h}`}),l.setAttribute("d",c),l.setAttribute("fill","none"),l.setAttribute("stroke","currentColor"),l.setAttribute("stroke-width","1.5"),l.setAttribute("opacity","0.7"),o.appendChild(l),t.appendChild(o)}async openProjectDrilldown(t){this.closeDrilldownModal();let r=document.body.createDiv({cls:"stats-view__modal-backdrop"});this.drilldownModal=r;let s=r.createDiv({cls:"stats-view__modal tasknotes-plugin"}),i=s.createDiv({cls:"stats-view__modal-header"}),a=i.createDiv({cls:"stats-view__modal-title"});a.textContent=`${t} - Detailed View`;let o=i.createEl("button",{cls:"stats-view__modal-close",text:"\xD7"}),l=s.createDiv({cls:"stats-view__modal-content"});l.textContent="Loading...",this.registerDomEvent(o,"click",()=>this.closeDrilldownModal()),this.registerDomEvent(r,"click",d=>{d.target===r&&this.closeDrilldownModal()});let c=d=>{d.key==="Escape"&&(this.closeDrilldownModal(),document.removeEventListener("keydown",c))};document.addEventListener("keydown",c);try{let d=await this.getProjectDrilldownData(t);this.currentDrilldownData=d,this.renderDrilldownContent(l,d)}catch(d){console.error("Error loading drill-down data:",d),l.textContent="Error loading project details."}}closeDrilldownModal(){this.drilldownModal&&(this.drilldownModal.remove(),this.drilldownModal=null,this.currentDrilldownData=null)}async refreshDrilldownModal(){if(!this.drilldownModal||!this.currentDrilldownData)return;let t=this.drilldownModal.querySelector(".stats-view__modal-content");if(t)try{let r=await this.getProjectDrilldownData(this.currentDrilldownData.projectName);this.currentDrilldownData=r,this.renderDrilldownContent(t,r)}catch(r){console.error("Error refreshing drill-down modal:",r)}}async getProjectDrilldownData(t){var f;let r=await this.plugin.cacheManager.getAllTaskPaths(),s=[];for(let h of r)try{let p=await this.plugin.cacheManager.getTaskInfo(h);p&&this.getTaskProjects(p).includes(t)&&s.push(p)}catch(p){console.error(`Failed to get task for drill-down: ${h}`,p)}let i=s.reduce((h,p)=>h+En(p.timeEntries||[]),0),a=s.filter(h=>this.plugin.statusManager.isCompletedStatus(h.status)).length,o=s.length>0?a/s.length*100:0,l=s.filter(h=>{var p;return((p=h.timeEntries)==null?void 0:p.length)||h.completedDate}).sort((h,p)=>{var y,T;let m=(y=h.timeEntries)!=null&&y.length?Math.max(...h.timeEntries.map(w=>new Date(w.startTime).getTime())):h.completedDate?new Date(h.completedDate).getTime():0;return((T=p.timeEntries)!=null&&T.length?Math.max(...p.timeEntries.map(w=>new Date(w.startTime).getTime())):p.completedDate?new Date(p.completedDate).getTime():0)-m}).slice(0,10),c=[],d=Ge(),u=wt(d);for(let h=29;h>=0;h--){let p=Dl(u,h),m=C(p,"yyyy-MM-dd"),g=0,y=0,T=0;for(let w of s){if(w.timeEntries){let b=w.timeEntries.filter(E=>C(new Date(E.startTime),"yyyy-MM-dd")===m);b.length>0&&(g+=En(b),y++)}w.completedDate&&C(new Date(w.completedDate),"yyyy-MM-dd")===m&&(T++,(f=w.timeEntries)!=null&&f.some(b=>C(new Date(b.startTime),"yyyy-MM-dd")===m)||y++)}c.push({date:m,timeSpent:g,taskCount:y,completedTasks:T})}return{projectName:t,tasks:s,totalTimeSpent:i,completionRate:o,timeByDay:c,recentActivity:l}}renderDrilldownContent(t,r){t.empty();let s=b=>{if(b<60)return`${Math.round(b)}m`;let E=Math.floor(b/60),S=Math.round(b%60);return S>0?`${E}h ${S}m`:`${E}h`},a=t.createDiv({cls:"stats-view__drilldown-overview"}).createDiv({cls:"stats-view__drilldown-stats"}),o=a.createDiv({cls:"stats-view__drilldown-card"});o.createDiv({cls:"stats-view__drilldown-value",text:s(r.totalTimeSpent)}),o.createDiv({cls:"stats-view__drilldown-label",text:"Total Time"});let l=a.createDiv({cls:"stats-view__drilldown-card"});l.createDiv({cls:"stats-view__drilldown-value",text:r.tasks.length.toString()}),l.createDiv({cls:"stats-view__drilldown-label",text:"Total Tasks"});let c=a.createDiv({cls:"stats-view__drilldown-card"});c.createDiv({cls:"stats-view__drilldown-value",text:`${Math.round(r.completionRate)}%`}),c.createDiv({cls:"stats-view__drilldown-label",text:"Completed"});let d=a.createDiv({cls:"stats-view__drilldown-card"}),u=r.tasks.length>0?r.totalTimeSpent/r.tasks.length:0;d.createDiv({cls:"stats-view__drilldown-value",text:s(u)}),d.createDiv({cls:"stats-view__drilldown-label",text:"Avg per Task"});let f=t.createDiv({cls:"stats-view__drilldown-section"});f.createDiv({cls:"stats-view__drilldown-heading",text:"Activity Over Time (Last 30 Days)"});let h=f.createDiv({cls:"stats-view__activity-chart"});this.renderActivityChart(h,r.timeByDay);let p=t.createDiv({cls:"stats-view__drilldown-section"}),m=p.createDiv({cls:"stats-view__section-header"});m.createDiv({cls:"stats-view__drilldown-heading",text:"All Project Tasks"});let y=m.createDiv({cls:"stats-view__task-filters"}).createEl("select",{cls:"stats-view__filter-select"});y.createEl("option",{value:"all",text:"All Tasks"}),y.createEl("option",{value:"active",text:"Active Only"}),y.createEl("option",{value:"completed",text:"Completed Only"});let T=p.createDiv({cls:"stats-view__task-list"}),w=(b="all")=>{T.empty();let E=r.tasks;if(b==="active"?E=r.tasks.filter(D=>!this.plugin.statusManager.isCompletedStatus(D.status)):b==="completed"&&(E=r.tasks.filter(D=>this.plugin.statusManager.isCompletedStatus(D.status))),E.sort((D,x)=>{let M=this.plugin.statusManager.isCompletedStatus(D.status),B=this.plugin.statusManager.isCompletedStatus(x.status);if(M!==B)return M?1:-1;let Q=P=>{var I;return(I=P.timeEntries)!=null&&I.length?Math.max(...P.timeEntries.map(A=>new Date(A.startTime).getTime())):P.dateModified?new Date(P.dateModified).getTime():0};return Q(x)-Q(D)}),E.length===0){T.createDiv({cls:"stats-view__no-data",text:"No tasks found"});return}let S=T.createDiv({cls:"stats-view__task-count"});S.textContent=`Showing ${E.length} task${E.length!==1?"s":""}`;for(let D of E){let x=fr(D,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1});T.appendChild(x)}};w("all"),this.registerDomEvent(y,"change",()=>{w(y.value)})}renderActivityChart(t,r){if(t.empty(),r.length===0)return;let s=Math.max(...r.map(a=>a.timeSpent));if(s===0){t.createDiv({cls:"stats-view__no-data",text:"No time tracking data"});return}let i=t.createDiv({cls:"stats-view__bar-chart"});for(let a of r){let l=i.createDiv({cls:"stats-view__bar-container"}).createDiv({cls:"stats-view__bar"}),c=a.timeSpent/s*40;l.style.height=`${c}px`;let d=`${C(new Date(a.date),"MMM d")}: ${Math.round(a.timeSpent)}m`;l.setAttribute("title",d)}}};var Hs=require("obsidian");or();Fs();var pp=class extends Hs.ItemView{constructor(t,r){super(t);this.boardContainer=null;this.filterBar=null;this.taskElements=new Map;this.previousGroupKey=null;this.listeners=[];this.functionListeners=[];this.columnOrder=[];this.debouncedRefresh=(0,Hs.debounce)(()=>{this.refresh()},150);this.plugin=r,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"priority",sortDirection:"desc",groupKey:"status"},this.previousGroupKey=this.currentQuery.groupKey||null,this.registerEvents()}getViewType(){return ys}getDisplayText(){return"Kanban"}getIcon(){return"layout-grid"}registerEvents(){this.listeners.forEach(s=>this.plugin.emitter.offref(s)),this.listeners=[],this.functionListeners.forEach(s=>s()),this.functionListeners=[];let t=this.plugin.emitter.on(ar,async()=>{if(this.refresh(),this.filterBar){let s=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(s)}});this.listeners.push(t);let r=this.plugin.filterService.on("data-changed",()=>{this.refresh()});this.functionListeners.push(r)}async onOpen(){await this.plugin.onReady(),await this.plugin.waitForMigration();let t=this.plugin.viewStateManager.getFilterState(ys);t&&(this.currentQuery=t,this.previousGroupKey=this.currentQuery.groupKey||null),this.loadColumnOrder(),this.contentEl.empty(),await this.render(),Ua(this,{viewId:ys,debounceDelay:120,maxBatchSize:5,changeDetectionEnabled:!0})}async onClose(){ja(this),this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.functionListeners.forEach(t=>t()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.contentEl.empty()}async refresh(){this.boardContainer?await this.loadAndRenderBoard():await this.render()}async updateForTask(t,r){await Py(this,t,r)}async render(){let t=this.contentEl;t.empty(),t.addClass("tasknotes-plugin","kanban-view"),await this.renderHeader(t),this.boardContainer=t.createDiv({cls:"kanban-view__board-container"}),await this.loadAndRenderBoard()}async renderHeader(t){let r=t.createDiv({cls:"kanban-view__header"}),s=r.createDiv({cls:"kanban-view__filter-container"});this.currentQuery=this.plugin.filterService.createDefaultQuery(),this.currentQuery.sortKey="priority",this.currentQuery.sortDirection="desc",this.currentQuery.groupKey="status";let i=this.plugin.viewStateManager.getFilterState(ys);i&&(this.currentQuery=i);let a=await this.plugin.filterService.getFilterOptions();this.filterBar=new hn(this.app,this.plugin,s,this.currentQuery,a,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1});let o=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(o),this.filterBar.on("saveView",({name:h,query:p,viewOptions:m,visibleProperties:g})=>{let y=this.plugin.viewStateManager.saveView(h,p,m,g);this.filterBar.setActiveSavedView(y)}),this.filterBar.on("deleteView",h=>{this.plugin.viewStateManager.deleteView(h)}),this.plugin.viewStateManager.on("saved-views-changed",h=>{var p;(p=this.filterBar)==null||p.updateSavedViews(h)}),this.filterBar.on("reorderViews",(h,p)=>{this.plugin.viewStateManager.reorderSavedViews(h,p)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async h=>{this.currentQuery=h,await this.plugin.viewStateManager.setFilterState(ys,h),this.loadAndRenderBoard()}),this.filterBar.on("propertiesChanged",h=>{this.loadAndRenderBoard()});let l=r.createDiv({cls:"kanban-view__actions"});l.createDiv({cls:"kanban-view__actions-left"}).createEl("button",{cls:"kanban-view__new-task-button",text:"New task"}).addEventListener("click",()=>{this.plugin.openTaskCreationModal()});let f=l.createDiv({cls:"kanban-view__actions-right"}).createDiv({cls:"kanban-view__stats"});this.updateBoardStats(f)}updateBoardStats(t,r){if(t.empty(),!r||r.length===0)return;let s=r.length,i=r.filter(a=>this.plugin.statusManager.isCompletedStatus(a.status)).length;if(s>0){let a=Math.round(i/s*100);t.createSpan({text:`${s} tasks \u2022 ${a}% complete`,cls:"kanban-view__stats-simple"})}}async loadAndRenderBoard(){var s,i;if(!this.boardContainer)return;let t=this.currentQuery.groupKey||null;this.previousGroupKey!==null&&this.previousGroupKey!==t&&(this.boardContainer.empty(),this.columnOrder=[]),this.previousGroupKey=t;let r=null;this.boardContainer.children.length===0&&(r=this.boardContainer.createDiv({cls:"kanban-view__loading",text:"Loading board..."}));try{let a=await this.plugin.filterService.getGroupedTasks(this.currentQuery,this.plugin.selectedDate);r&&r.remove(),this.renderBoardFromGroupedTasksWithReconciler(a);let o=Array.from(a.values()).flat(),l=this.contentEl.querySelector(".kanban-view__stats");l&&this.updateBoardStats(l,o)}catch(a){let o=a instanceof Error?a.message:String(a);console.error("KanbanView: Error loading Kanban board:",{error:o,stack:a instanceof Error?a.stack:void 0,query:this.currentQuery,cacheInitialized:((s=this.plugin.cacheManager)==null?void 0:s.isInitialized())||!1,visibleProperties:this.getCurrentVisibleProperties(),filterServiceQuery:JSON.stringify(this.currentQuery,null,2)}),console.error("KanbanView: Detailed error context:",{pluginInitialized:!!this.plugin,filterServiceInitialized:!!((i=this.plugin)!=null&&i.filterService),containerExists:!!this.boardContainer}),new Hs.Notice("Failed to load Kanban board. See console for details."),r&&r.remove(),this.boardContainer.empty(),this.boardContainer.createDiv({cls:"kanban-view__error",text:"Error loading board."})}}renderBoardFromGroupedTasks(t){if(!this.boardContainer)return;this.boardContainer.empty(),this.taskElements.clear();let r=Array.from(t.keys()).sort();this.columnOrder.length===0&&(this.columnOrder=[...r],this.columnOrder.length>0&&this.saveColumnOrder()),this.renderBoardFromGroupedTasksWithOrder(t)}renderColumn(t,r,s){let i=t.createDiv({cls:"kanban-view__column"});i.dataset.columnId=r,r==="uncategorized"&&i.addClass("kanban-view__column--uncategorized");let a=i.createDiv({cls:"kanban-view__column-header"});a.draggable=!0,a.dataset.columnId=r,this.addColumnDragHandlers(a);let o=this.formatColumnTitle(r,this.currentQuery.groupKey||"none");a.createEl("div",{text:o,cls:"kanban-view__column-title"}),a.createEl("div",{text:`${s.length} tasks`,cls:"kanban-view__column-count"});let l=i.createDiv({cls:"kanban-view__column-body"});if(s.length===0){let d=l.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(d)}else s.forEach(d=>{let u=this.getCurrentVisibleProperties(),f=fr(d,this.plugin,u,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});f.draggable=!0,this.addDragHandlers(f,d),l.appendChild(f),this.taskElements.set(d.path,f)});l.createEl("button",{cls:"kanban-view__add-card-button",text:"+ Add a card"}).addEventListener("click",()=>{this.openTaskCreationModalForColumn(r)}),this.addColumnDropHandlers(i)}addColumnDragHandlers(t){t.addEventListener("dragstart",r=>{if(r.dataTransfer){let s=t.dataset.columnId;s&&(r.dataTransfer.setData("text/plain",`column:${s}`),r.dataTransfer.effectAllowed="move")}t.classList.add("kanban-view__column-header--dragging")}),t.addEventListener("dragend",()=>{t.classList.remove("kanban-view__column-header--dragging")})}loadColumnOrder(){let t=this.plugin.viewStateManager.getViewPreferences(ys);t!=null&&t.columnOrder&&(this.columnOrder=[...t.columnOrder])}saveColumnOrder(){let t=this.plugin.viewStateManager.getViewPreferences(ys)||{};t.columnOrder=[...this.columnOrder],this.plugin.viewStateManager.setViewPreferences(ys,t)}async reorderColumns(t,r){var o;if(this.columnOrder.length===0){let l=(o=this.boardContainer)==null?void 0:o.querySelectorAll(".kanban-view__column");this.columnOrder=Array.from(l||[]).map(c=>c.dataset.columnId||"").filter(c=>c)}let s=this.columnOrder.indexOf(t),i=this.columnOrder.indexOf(r);if(s===-1||i===-1)return;let[a]=this.columnOrder.splice(s,1);this.columnOrder.splice(i,0,a),this.saveColumnOrder(),this.renderBoardWithOrder()}async renderBoardWithOrder(){if(this.boardContainer)try{let t=await this.plugin.filterService.getGroupedTasks(this.currentQuery,this.plugin.selectedDate);this.renderBoardFromGroupedTasksWithReconciler(t);let r=Array.from(t.values()).flat(),s=this.contentEl.querySelector(".kanban-view__stats");s&&this.updateBoardStats(s,r)}catch(t){console.error("Error reordering Kanban board:",t),this.refresh()}}renderBoardFromGroupedTasksWithOrder(t){if(!this.boardContainer)return;let r=this.boardContainer.querySelector(".kanban-view__board");r?r.empty():r=this.boardContainer.createDiv({cls:"kanban-view__board"}),this.taskElements.clear(),this.columnOrder.forEach(l=>{if(t.has(l)){let c=t.get(l)||[];this.renderColumn(r,l,c)}});let s=Array.from(t.keys()),i=s;if(this.currentQuery.groupKey==="status"){let l=this.plugin.statusManager.getAllStatuses().map(c=>c.value);i=[...new Set([...s,...l])]}let a=!1,o=this.columnOrder.length;this.columnOrder=this.columnOrder.filter(l=>i.includes(l)),this.columnOrder.length!==o&&(a=!0),i.forEach(l=>{if(!this.columnOrder.includes(l)){this.columnOrder.push(l),a=!0;let c=t.get(l)||[];this.renderColumn(r,l,c)}}),a&&this.saveColumnOrder()}addDragHandlers(t,r){t.addEventListener("dragstart",s=>{s.dataTransfer&&(s.dataTransfer.setData("text/plain",r.path),s.dataTransfer.effectAllowed="move"),window.setTimeout(()=>t.classList.add("task-card--dragging"),0)}),t.addEventListener("dragend",()=>{t.classList.remove("task-card--dragging")})}addColumnDropHandlers(t){t.addEventListener("dragover",r=>{var s;r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move",((s=this.boardContainer)==null?void 0:s.querySelector(".kanban-view__column-header--dragging"))?t.classList.add("kanban-view__column--column-drop-target"):t.classList.add("kanban-view__column--dragover"))}),t.addEventListener("dragleave",r=>{t.contains(r.relatedTarget)||(t.classList.remove("kanban-view__column--dragover"),t.classList.remove("kanban-view__column--column-drop-target"))}),t.addEventListener("drop",async r=>{var o,l;r.preventDefault(),r.stopPropagation(),(o=this.boardContainer)==null||o.querySelectorAll(".kanban-view__column--dragover, .kanban-view__column--column-drop-target").forEach(c=>{c.classList.remove("kanban-view__column--dragover","kanban-view__column--column-drop-target")});let s=(l=r.dataTransfer)==null?void 0:l.getData("text/plain");if(s!=null&&s.startsWith("column:")){let c=s.replace("column:",""),d=t.dataset.columnId;c&&d&&c!==d&&await this.reorderColumns(c,d);return}let i=s,a=t.dataset.columnId;if(!a){let c=r.target.closest(".kanban-view__column");a=(c==null?void 0:c.getAttribute("data-column-id"))||void 0}if(i&&a&&a!=="uncategorized"){let c=await this.plugin.cacheManager.getCachedTaskInfo(i);if(c)try{let d,u;switch(this.currentQuery.groupKey){case"status":d="status",u=a;break;case"priority":d="priority",u=a;break;case"context":d="contexts",u=[a];break;case"project":if(d="projects",a==="No Project")u=[];else{let f=this.findExistingProjectFormat(c,a);f?u=[f]:u=[`[[${a.includes("/")?`${a}.md`:a}]]`]}break;default:throw new Error(`Unsupported groupBy: ${this.currentQuery.groupKey}`)}await this.plugin.updateTaskProperty(c,d,u,{silent:!0}),new Hs.Notice(`Task moved to "${this.formatColumnTitle(a,this.currentQuery.groupKey)}"`)}catch(d){console.error("Failed to move task:",d),new Hs.Notice("Failed to move task"),this.refresh()}}})}renderBoardFromGroupedTasksWithReconciler(t){if(!this.boardContainer)return;let r=this.boardContainer.querySelector(".kanban-view__board");r||(r=this.boardContainer.createDiv({cls:"kanban-view__board"}));let s=Array.from(t.keys()),i=s;if(this.currentQuery.groupKey==="status"){let d=this.plugin.statusManager.getAllStatuses().map(u=>u.value);i=[...new Set([...s,...d])]}i=i.sort(),this.columnOrder.length===0&&(this.columnOrder=[...i],this.columnOrder.length>0&&this.saveColumnOrder());let a=!1,o=this.columnOrder.length;this.columnOrder=this.columnOrder.filter(d=>i.includes(d)),this.columnOrder.length!==o&&(a=!0),i.forEach(d=>{this.columnOrder.includes(d)||(this.columnOrder.push(d),a=!0)}),a&&this.saveColumnOrder();let l=this.columnOrder.map(d=>({id:d,tasks:t.get(d)||[]}));this.plugin.domReconciler.updateList(r,l,d=>d.id,d=>this.createColumnElement(d.id,d.tasks),(d,u)=>this.updateColumnElement(d,u.id,u.tasks)),this.taskElements.clear(),r.querySelectorAll(".task-card[data-task-path]").forEach(d=>{let u=d.dataset.taskPath;u&&this.taskElements.set(u,d)})}createColumnElement(t,r){let s=document.createElement("div");s.className="kanban-view__column",s.dataset.columnId=t,t==="uncategorized"&&s.classList.add("kanban-view__column--uncategorized");let i=s.createDiv({cls:"kanban-view__column-header"});i.draggable=!0,i.dataset.columnId=t,this.addColumnDragHandlers(i);let a=this.formatColumnTitle(t,this.currentQuery.groupKey||"none"),o=i.createEl("div",{cls:"kanban-view__column-title"});this.currentQuery.groupKey==="project"&&t!=="No Project"?this.createClickableProjectTitle(o,t,a):o.textContent=a,i.createEl("div",{text:`${r.length} tasks`,cls:"kanban-view__column-count"});let l=s.createDiv({cls:"kanban-view__column-body"}),c=l.createDiv({cls:"kanban-view__tasks-container"});if(r.length===0){let u=c.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(u)}else this.plugin.domReconciler.updateList(c,r,u=>u.path,u=>this.createTaskCardElement(u),(u,f)=>this.updateTaskCardElement(u,f));return l.createEl("button",{cls:"kanban-view__add-card-button",text:"+ Add a card"}).addEventListener("click",()=>{this.openTaskCreationModalForColumn(t)}),this.addColumnDropHandlers(s),s}updateColumnElement(t,r,s){let i=t.querySelector(".kanban-view__column-count");i&&(i.textContent=`${s.length} tasks`);let a=t.querySelector(".kanban-view__column-body");if(a){let o=a.querySelector(".kanban-view__add-card-button"),l=a.querySelector(".kanban-view__tasks-container");if(l||(l=a.createDiv({cls:"kanban-view__tasks-container"}),o?a.insertBefore(l,o):a.appendChild(l)),s.length===0){l.empty();let c=l.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(c)}else{let c=l.querySelector(".kanban-view__column-empty");c&&c.remove(),this.plugin.domReconciler.updateList(l,s,d=>d.path,d=>this.createTaskCardElement(d),(d,u)=>this.updateTaskCardElement(d,u))}}}createTaskCardElement(t){let r=this.getCurrentVisibleProperties(),s=fr(t,this.plugin,r,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});return s.draggable=!0,this.addDragHandlers(s,t),this.taskElements.set(t.path,s),s}updateTaskCardElement(t,r){let s=this.getCurrentVisibleProperties();Pn(t,r,this.plugin,s,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0}),this.taskElements.set(r.path,t)}getCurrentVisibleProperties(){var t;return(t=this.filterBar)==null?void 0:t.getCurrentVisibleProperties()}formatColumnTitle(t,r){var s,i;switch(r){case"status":return((s=this.plugin.statusManager.getStatusConfig(t))==null?void 0:s.label)||t;case"priority":return((i=this.plugin.priorityManager.getPriorityConfig(t))==null?void 0:i.label)||t;case"context":return t==="uncategorized"?"Uncategorized":`@${t}`;case"project":return t==="No Project"?"No Project":t;case"due":return t;case"none":default:return t}}isResolvedProjectPath(t){var r;return(r=this.plugin)!=null&&r.app?this.plugin.app.vault.getAbstractFileByPath(t+".md")instanceof Hs.TFile?!0:!!this.plugin.app.metadataCache.getFirstLinkpathDest(t,""):!1}findExistingProjectFormat(t,r){var i;let s=((i=t.projects)==null?void 0:i.filter(a=>a&&typeof a=="string"&&a.trim()!==""))||[];for(let a of s)if(this.plugin.filterService.resolveProjectToAbsolutePath(a)===r)return a;return null}createClickableProjectTitle(t,r,s){if(r.includes("/")||this.isResolvedProjectPath(r)){let a=t.createEl("a",{cls:"internal-link kanban-view__project-link",text:s});a.addEventListener("click",async o=>{o.preventDefault(),o.stopPropagation();try{let l=this.plugin.app.vault.getAbstractFileByPath(r);if(l instanceof Hs.TFile)await this.plugin.app.workspace.getLeaf(!1).openFile(l);else{let c=this.plugin.app.metadataCache.getFirstLinkpathDest(r,"");c?await this.plugin.app.workspace.getLeaf(!1).openFile(c):new Hs.Notice(`Project file not found: ${r}`)}}catch(l){console.error("Error opening project file:",l),new Hs.Notice(`Error opening project: ${r}`)}}),a.addEventListener("mouseover",o=>{this.plugin.app.workspace.trigger("hover-link",{event:o,source:"tasknotes-kanban",hoverParent:this,targetEl:a,linktext:r,sourcePath:r})})}else t.textContent=s}openTaskCreationModalForColumn(t){let r={};switch(this.currentQuery.groupKey){case"status":t!=="uncategorized"&&(r.status=t);break;case"priority":t!=="uncategorized"&&(r.priority=t);break;case"context":t!=="uncategorized"&&(r.contexts=[t]);break;case"project":t!=="No Project"&&(r.projects=[t]);break}this.plugin.openTaskCreationModal(r)}};var An=require("obsidian"),hs=Ee(wn());or();Ne();var Fy=class{constructor(e){this.timerWorker=null;this.activeAudioContexts=new Set;this.cleanupTimeouts=new Set;this.lastSelectedTaskPathLoaded=!1;this.plugin=e,this.state={isRunning:!1,timeRemaining:e.settings.pomodoroWorkDuration*60}}async initialize(){await this.loadState(),this.setupWorker(),this.state.isRunning&&this.state.currentSession&&this.resumeTimer()}setWebhookNotifier(e){this.webhookNotifier=e}setupWorker(){let e=new Blob([NH],{type:"application/javascript"}),t=URL.createObjectURL(e);this.timerWorker=new Worker(t),this.timerWorker.onmessage=r=>{r.data.type==="done"&&this.completePomodoro(),r.data.type==="tick"&&(this.state.timeRemaining=r.data.timeRemaining,this.plugin.emitter.trigger(Vs,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}}async loadState(){try{let e=await this.plugin.loadData();if(e!=null&&e.pomodoroState){this.state=e.pomodoroState,this.state.timeRemaining=Math.max(0,this.state.timeRemaining||0);let t=ue(Ge());if(e.lastPomodoroDate!==t&&this.state.currentSession&&(this.state.currentSession=void 0,this.state.isRunning=!1),this.state.currentSession){let s=new Date(this.state.currentSession.startTime).getTime();(Date.now()-s)/(1e3*60*60)>24&&(this.state.currentSession=void 0,this.state.isRunning=!1,this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60)}this.state.currentSession||(this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60)}}catch(e){console.error("Failed to load pomodoro state:",e),this.state={isRunning:!1,timeRemaining:this.plugin.settings.pomodoroWorkDuration*60}}}async saveState(){try{let e=await this.plugin.loadData()||{};e.pomodoroState=this.state,e.lastPomodoroDate=ue(Ge()),await this.plugin.saveData(e)}catch(e){console.error("Failed to save pomodoro state:",e)}}async saveLastSelectedTask(e){this.lastSelectedTaskPath=e,this.lastSelectedTaskPathLoaded=!0;try{let t=await this.plugin.loadData()||{};t.lastSelectedTaskPath=e,await this.plugin.saveData(t)}catch(t){console.error("Failed to save last selected task:",t)}}async getLastSelectedTaskPath(){if(this.lastSelectedTaskPathLoaded)return this.lastSelectedTaskPath;try{let e=await this.plugin.loadData(),t=e==null?void 0:e.lastSelectedTaskPath;return typeof t=="string"&&t.trim().length>0?this.lastSelectedTaskPath=t:this.lastSelectedTaskPath=void 0,this.lastSelectedTaskPathLoaded=!0,this.lastSelectedTaskPath}catch(e){console.error("Failed to load last selected task:",e);return}}async startPomodoro(e,t){var l;if(this.state.isRunning){new An.Notice("A pomodoro is already running");return}if(this.state.currentSession&&!this.state.isRunning){new An.Notice("Resume the current session instead of starting a new one");return}let s=(t?Math.max(1,Math.min(120,t))*60:null)||Math.max(1,Math.min(7200,this.state.timeRemaining)),i=s/60;console.log("Starting pomodoro with planned duration:",i,"minutes");let a=Ue(),o={id:Date.now().toString(),taskPath:e==null?void 0:e.path,startTime:a,plannedDuration:i,type:"work",completed:!1,activePeriods:[{startTime:a}]};if(e!=null&&e.path&&(this.lastWorkSessionTaskPath=e.path,this.lastSelectedTaskPath=e.path,this.lastSelectedTaskPathLoaded=!0),this.state.currentSession=o,this.state.isRunning=!0,this.state.timeRemaining=s,this.state.nextSessionType=void 0,await this.saveState(),this.startTimer(),e)try{await this.plugin.taskService.startTimeTracking(e)}catch(c){(l=c.message)!=null&&l.includes("Time tracking is already active")||console.error("Failed to start time tracking for Pomodoro:",c)}if(this.plugin.emitter.trigger(Nd,{session:o,task:e}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("pomodoro.started",{session:o,task:e})}catch(c){console.warn("Failed to trigger webhook for pomodoro start:",c)}new Notification(`Pomodoro started${e?` for: ${e.title}`:""}`)}async startBreak(e=!1){if(this.state.isRunning){new An.Notice("A timer is already running");return}if(this.state.currentSession&&!this.state.isRunning){new An.Notice("Resume the current session instead of starting a new one");return}let t=e?Math.max(1,Math.min(60,this.plugin.settings.pomodoroLongBreakDuration)):Math.max(1,Math.min(30,this.plugin.settings.pomodoroShortBreakDuration)),r=Ue(),s={id:Date.now().toString(),startTime:r,plannedDuration:t,type:e?"long-break":"short-break",completed:!1,activePeriods:[{startTime:r}]};this.state.currentSession=s,this.state.isRunning=!0,this.state.timeRemaining=s.plannedDuration*60,this.state.nextSessionType=void 0,await this.saveState(),this.startTimer(),new An.Notice(`${e?"Long":"Short"} break started`)}async pausePomodoro(){if(this.state.isRunning){if(this.stopTimer(),this.state.isRunning=!1,this.state.currentSession&&this.state.currentSession.activePeriods.length>0){let e=this.state.currentSession.activePeriods[this.state.currentSession.activePeriods.length-1];e.endTime||(e.endTime=Ue())}if(this.state.currentSession&&this.state.currentSession.taskPath)try{let e=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);e&&await this.plugin.taskService.stopTimeTracking(e)}catch(e){console.error("Failed to stop time tracking for Pomodoro pause:",e)}await this.saveState(),this.plugin.emitter.trigger(Vs,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),new An.Notice("Pomodoro paused")}}async resumePomodoro(){var e;if(!(this.state.isRunning||!this.state.currentSession)){if(this.state.isRunning=!0,this.state.currentSession&&this.state.currentSession.activePeriods.push({startTime:Ue()}),await this.saveState(),this.startTimer(),this.state.currentSession&&this.state.currentSession.taskPath)try{let t=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);t&&await this.plugin.taskService.startTimeTracking(t)}catch(t){(e=t.message)!=null&&e.includes("Time tracking is already active")||console.error("Failed to start time tracking for Pomodoro resume:",t)}this.plugin.emitter.trigger(Vs,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),new An.Notice("Pomodoro resumed")}}async stopPomodoro(){if(!this.state.currentSession)return;let e=this.state.isRunning;if(this.stopTimer(),this.state.currentSession){if(this.state.currentSession.interrupted=!0,this.state.currentSession.endTime=Ue(),this.state.currentSession.activePeriods.length>0){let t=this.state.currentSession.activePeriods[this.state.currentSession.activePeriods.length-1];t.endTime||(t.endTime=Ue())}await this.addSessionToHistory(this.state.currentSession)}if(this.plugin.emitter.trigger(Ld,{session:this.state.currentSession}),this.webhookNotifier&&this.state.currentSession)try{let t=this.state.currentSession.taskPath?await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath):void 0;await this.webhookNotifier.triggerWebhook("pomodoro.interrupted",{session:this.state.currentSession,task:t})}catch(t){console.warn("Failed to trigger webhook for pomodoro interruption:",t)}if(this.state.currentSession&&this.state.currentSession.taskPath&&e)try{let t=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);t&&await this.plugin.taskService.stopTimeTracking(t)}catch(t){console.error("Failed to stop time tracking for Pomodoro interrupt:",t)}this.state.currentSession=void 0,this.state.isRunning=!1,this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60,await this.saveState(),this.plugin.emitter.trigger(Vs,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),e&&new An.Notice("Pomodoro stopped and reset")}startTimer(){this.timerWorker&&this.timerWorker.postMessage({command:"start",duration:this.state.timeRemaining})}stopTimer(){this.timerWorker&&this.timerWorker.postMessage({command:"stop"})}resumeTimer(){if(this.state.currentSession&&this.state.currentSession.startTime){let e=new Date(this.state.currentSession.startTime).getTime(),t=Date.now();if(e>t){this.stopPomodoro();return}let r=this.state.currentSession.plannedDuration*60;if(!this.state.isRunning&&this.state.timeRemaining>0)this.state.timeRemaining=Math.min(this.state.timeRemaining,r);else if(this.state.isRunning){let s=this.state.currentSession.activePeriods||[],i=0;for(let a of s){let o=new Date(a.startTime).getTime(),l=a.endTime?new Date(a.endTime).getTime():t;i+=Math.floor((l-o)/1e3)}this.state.timeRemaining=Math.max(0,r-i)}this.state.timeRemaining>0&&this.state.isRunning?this.startTimer():this.state.timeRemaining<=0&&this.completePomodoro()}}async autoStartWorkSession(){if(!this.state.isRunning)try{let e=await this.getAutoStartTask();e?await this.startPomodoro(e):await this.startPomodoro()}catch(e){console.error("Failed to auto-start work session:",e)}}async getAutoStartTask(){var s;let e=[];this.lastWorkSessionTaskPath&&e.push(this.lastWorkSessionTaskPath),(s=this.state.currentSession)!=null&&s.taskPath&&e.push(this.state.currentSession.taskPath);let t=await this.getLastSelectedTaskPath();t&&e.push(t);let r=Array.from(new Set(e.filter(i=>typeof i=="string"&&i.length>0)));for(let i of r)try{let a=await this.plugin.cacheManager.getTaskInfo(i);if(!a){this.clearCachedTaskPath(i);continue}if(a.archived||this.plugin.statusManager.isCompletedStatus(a.status)){this.clearCachedTaskPath(i);continue}return a}catch(a){console.warn(`Failed to load task for auto-start (${i}):`,a)}}clearCachedTaskPath(e){this.lastWorkSessionTaskPath===e&&(this.lastWorkSessionTaskPath=void 0),this.lastSelectedTaskPath===e&&(this.lastSelectedTaskPath=void 0,this.lastSelectedTaskPathLoaded=!0)}async completePomodoro(){if(this.stopTimer(),!this.state.currentSession)return;let e=this.state.currentSession;if(e.completed=!0,e.endTime=Ue(),e.type==="work"&&e.taskPath&&(this.lastWorkSessionTaskPath=e.taskPath),e.activePeriods.length>0){let r=e.activePeriods[e.activePeriods.length-1];r.endTime||(r.endTime=Ue())}if(e.type==="work"&&this.state.isRunning&&e.taskPath)try{let r=await this.plugin.cacheManager.getTaskInfo(e.taskPath);r&&await this.plugin.taskService.stopTimeTracking(r)}catch(r){console.error("Failed to stop time tracking for Pomodoro completion:",r)}let t=!1;if(e.type==="work")try{t=((await this.getTodayStats()).pomodorosCompleted+1)%this.plugin.settings.pomodoroLongBreakInterval===0}catch(r){console.error("Failed to calculate break type:",r),t=!1}if(await this.addSessionToHistory(e),this.plugin.emitter.trigger(Od,{session:e,nextType:e.type==="work"?t?"long-break":"short-break":"work"}),this.webhookNotifier)try{let r=e.taskPath?await this.plugin.cacheManager.getTaskInfo(e.taskPath):void 0;await this.webhookNotifier.triggerWebhook("pomodoro.completed",{session:e,task:r})}catch(r){console.warn("Failed to trigger webhook for pomodoro completion:",r)}if(this.plugin.settings.pomodoroNotifications){let r=e.type==="work"?"\u{1F345} Pomodoro completed!":"\u2615 Break completed!",s=e.type==="work"?`Time for a ${t?"long break \u{1F4A4}":"short break \u2615"}`:"Ready for the next pomodoro?";new Notification(r,{body:s})}if(this.plugin.settings.pomodoroSoundEnabled&&this.playCompletionSound(),this.state.currentSession=void 0,this.state.isRunning=!1,e.type==="work"){let r=t?this.plugin.settings.pomodoroLongBreakDuration:this.plugin.settings.pomodoroShortBreakDuration;if(this.state.timeRemaining=r*60,this.state.nextSessionType=t?"long-break":"short-break",this.plugin.settings.pomodoroAutoStartBreaks){let s=setTimeout(()=>this.startBreak(t),1e3);this.cleanupTimeouts.add(s)}}else if(this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60,this.state.nextSessionType="work",this.plugin.settings.pomodoroAutoStartWork){let r=setTimeout(()=>{this.autoStartWorkSession()},1e3);this.cleanupTimeouts.add(r)}await this.saveState(),this.plugin.emitter.trigger(Vs,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession})}playCompletionSound(){try{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),r=e.createGain();t.connect(r),r.connect(e.destination);let s=Math.max(0,Math.min(1,this.plugin.settings.pomodoroSoundVolume/100));r.gain.value=s*.3,t.frequency.value=800,t.type="sine",t.start(),t.stop(e.currentTime+.1),this.activeAudioContexts.add(e);let i=setTimeout(()=>{try{let o=e.createOscillator();o.connect(r),o.frequency.value=1e3,o.type="sine",o.start(),o.stop(e.currentTime+.1)}catch(o){console.error("Failed to play second beep:",o)}},150);this.cleanupTimeouts.add(i);let a=setTimeout(()=>{this.activeAudioContexts.delete(e),e.close().catch(()=>{})},300);this.cleanupTimeouts.add(a)}catch(e){console.error("Failed to play completion sound:",e)}}getState(){return{...this.state}}adjustSessionTime(e){if(this.state.currentSession){this.stopTimer(),this.state.timeRemaining=Math.max(1,this.state.timeRemaining+e);let t=this.state.currentSession.activePeriods||[],r=0;for(let i of t)if(i.endTime){let a=new Date(i.startTime).getTime(),o=new Date(i.endTime).getTime();r+=Math.floor((o-a)/1e3)}else if(this.state.isRunning){let a=new Date(i.startTime).getTime(),o=Date.now();r+=Math.floor((o-a)/1e3)}let s=r+this.state.timeRemaining;this.state.currentSession.plannedDuration=Math.ceil(s/60),this.saveState(),this.startTimer(),this.plugin.emitter.trigger(Vs,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession})}}adjustPreparedTimer(e){this.state.currentSession||(this.stopTimer(),this.state.timeRemaining=Math.max(1,e),this.saveState(),console.log("Adjusted prepared timer to:",this.state.timeRemaining,"seconds"),this.plugin.emitter.trigger(Vs,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}isRunning(){return this.state.isRunning}getCurrentSession(){return this.state.currentSession}getTimeRemaining(){return this.state.timeRemaining}async getPomodorosCompleted(){return(await this.getTodayStats()).pomodorosCompleted}async getCurrentStreak(){return(await this.getTodayStats()).currentStreak}async getTotalMinutesToday(){return(await this.getTodayStats()).totalMinutes}async assignTaskToCurrentSession(e){this.state.currentSession&&(this.state.currentSession.taskPath=e==null?void 0:e.path,e!=null&&e.path?(this.lastWorkSessionTaskPath=e.path,this.lastSelectedTaskPath=e.path,this.lastSelectedTaskPathLoaded=!0):(this.lastWorkSessionTaskPath=void 0,this.lastSelectedTaskPath=void 0,this.lastSelectedTaskPathLoaded=!0),await this.saveState(),this.plugin.emitter.trigger(Vs,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}async getSessionHistory(){try{let e=[],t=await this.plugin.loadData(),r=(t==null?void 0:t.pomodoroHistory)||[];if(this.plugin.settings.pomodoroStorageLocation==="daily-notes"){let s=await this.loadHistoryFromDailyNotes();e=s,r.length>0&&(e=this.mergeHistories(r,s))}else e=r;return e.sort((s,i)=>new Date(s.startTime).getTime()-new Date(i.startTime).getTime())}catch(e){return console.error("Failed to load session history:",e),[]}}async saveSessionHistory(e){try{if(this.plugin.settings.pomodoroStorageLocation==="daily-notes")await this.saveHistoryToDailyNotes(e);else{let t=await this.plugin.loadData()||{};t.pomodoroHistory=e,await this.plugin.saveData(t)}}catch(t){console.error("Failed to save session history:",t)}}async addSessionToHistory(e){if(!e.endTime){console.warn("Cannot add session to history without end time");return}let t={id:e.id,startTime:e.startTime,endTime:e.endTime,plannedDuration:e.plannedDuration,type:e.type,taskPath:e.taskPath,completed:e.completed&&!e.interrupted,activePeriods:e.activePeriods.slice()};try{if(this.plugin.settings.pomodoroStorageLocation==="daily-notes")await this.addSingleSessionToDailyNote(t);else{let r=await this.getSessionHistory();r.push(t),await this.saveSessionHistory(r)}}catch(r){console.error("Failed to add session to history:",r)}}async getStatsForDate(e){let t=ue(e),i=(await this.getSessionHistory()).filter(u=>ue(new Date(u.startTime))===t).filter(u=>u.type==="work"),a=i.filter(u=>u.completed),o=0;for(let u=i.length-1;u>=0&&i[u].completed;u--)o++;let l=a.reduce((u,f)=>u+fp(f),0),c=a.length>0?l/a.length:0,d=i.length>0?a.length/i.length*100:0;return{pomodorosCompleted:a.length,currentStreak:o,totalMinutes:l,averageSessionLength:Math.round(c),completionRate:Math.round(d)}}async getTodayStats(){let e=Ge(),t=wt(e);return this.getStatsForDate(t)}cleanup(){this.stopTimer(),this.timerWorker&&(this.timerWorker.terminate(),this.timerWorker=null);for(let e of this.cleanupTimeouts)clearTimeout(e);this.cleanupTimeouts.clear();for(let e of this.activeAudioContexts)e.state!=="closed"&&e.close().catch(()=>{});this.activeAudioContexts.clear(),this.saveState()}async saveHistoryToDailyNotes(e){try{if(!(0,hs.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes core plugin is not enabled");let t=this.groupSessionsByDate(e);for(let[r,s]of t)await this.updateDailyNotePomodoros(r,s)}catch(t){throw console.error("Failed to save history to daily notes:",t),t}}async loadHistoryFromDailyNotes(){try{if(!(0,hs.appHasDailyNotesPluginLoaded)())return[];let e=[],t=(0,hs.getAllDailyNotes)(),r=this.plugin.fieldMapper.toUserField("pomodoros");for(let[,s]of Object.entries(t))try{let i=this.plugin.app.metadataCache.getFileCache(s),a=i==null?void 0:i.frontmatter;if(a&&a[r]){let o=a[r];Array.isArray(o)&&e.push(...o)}}catch(i){console.warn(`Failed to read pomodoro data from daily note ${s.path}:`,i)}return e}catch(e){return console.error("Failed to load history from daily notes:",e),[]}}groupSessionsByDate(e){let t=new Map;for(let r of e){let s=new Date(r.startTime),i=ue(s);t.has(i)||t.set(i,[]),t.get(i).push(r)}return t}async addSingleSessionToDailyNote(e){try{let t=new Date(e.startTime),r=window.moment(t),s=(0,hs.getAllDailyNotes)(),i=(0,hs.getDailyNote)(r,s);if(!i&&(i=await(0,hs.createDailyNote)(r),!i))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let a=this.plugin.fieldMapper.toUserField("pomodoros");await this.plugin.app.fileManager.processFrontMatter(i,o=>{let l=o[a]||[];new Set(l.map(d=>d.id)).has(e.id)||(o[a]=[...l,e])})}catch(t){console.error("Failed to add session to daily note:",t)}}async updateDailyNotePomodoros(e,t){try{let r=Ut(e),s=window.moment(r),i=(0,hs.getAllDailyNotes)(),a=(0,hs.getDailyNote)(s,i);if(!a&&(a=await(0,hs.createDailyNote)(s),!a))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let o=this.plugin.fieldMapper.toUserField("pomodoros");await this.plugin.app.fileManager.processFrontMatter(a,l=>{let c=l[o]||[],d=new Set(c.map(f=>f.id)),u=t.filter(f=>!d.has(f.id));u.length>0&&(l[o]=[...c,...u])})}catch(r){console.error(`Failed to update daily note for ${e}:`,r)}}mergeHistories(e,t){let r=[...t],s=new Set(t.map(i=>i.id));for(let i of e)s.has(i.id)||r.push(i);return r}async migrateTodailyNotes(){try{if(!(0,hs.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes core plugin must be enabled for migration");let e=await this.plugin.loadData(),t=(e==null?void 0:e.pomodoroHistory)||[];if(t.length===0)return;await this.saveHistoryToDailyNotes(t),e.pomodoroHistory=[],await this.plugin.saveData(e),new An.Notice(`Successfully migrated ${t.length} pomodoro sessions to daily notes.`)}catch(e){throw console.error("Failed to migrate pomodoro data to daily notes:",e),new An.Notice("Failed to migrate pomodoro data. Please try again or check the console for details."),e}}};At();var Bs=require("obsidian");Ne();At();var Hy=class extends Bs.Events{constructor(t,r,s){super();this.tasksByDate=new Map;this.tasksByStatus=new Map;this.overdueTasks=new Set;this.projectReferences=new Map;this.initialized=!1;this.indexesBuilt=!1;this.eventListeners=[];this.debouncedHandlers=new Map;this.DEBOUNCE_DELAY=300;this.lastKnownTaskInfo=new Map;this.lastKnownFrontmatter=new Map;this.app=t,this.settings=r,this.taskTag=r.taskTag,this.excludedFolders=r.excludedFolders?r.excludedFolders.split(",").map(i=>i.trim()).filter(i=>i.length>0):[],this.fieldMapper=s,this.disableNoteIndexing=r.disableNoteIndexing,this.storeTitleInFilename=r.storeTitleInFilename}initialize(){this.initialized||(this.setupNativeEventListeners(),this.initialized=!0,this.trigger("cache-initialized",{message:"Minimal native cache ready"}))}getApp(){return this.app}isTaskFile(t){if(!t)return!1;if(this.settings.taskIdentificationMethod==="property"){let r=this.settings.taskPropertyName,s=this.settings.taskPropertyValue;if(!r||!s)return!1;let i=t[r];return i===void 0?!1:Array.isArray(i)?i.some(a=>this.comparePropertyValues(a,s)):this.comparePropertyValues(i,s)}else return Array.isArray(t.tags)&&t.tags.includes(this.taskTag)}comparePropertyValues(t,r){if(typeof t=="boolean"&&typeof r=="string"){let s=r.toLowerCase();if(s==="true"||s==="false")return t===(s==="true")}return t===r}setupNativeEventListeners(){this.eventListeners.push(this.app.metadataCache.on("changed",(t,r,s)=>{t instanceof Bs.TFile&&t.extension==="md"&&this.isValidFile(t.path)&&this.handleFileChangedDebounced(t,s)})),this.eventListeners.push(this.app.metadataCache.on("deleted",(t,r)=>{t instanceof Bs.TFile&&t.extension==="md"&&this.handleFileDeleted(t.path)})),this.eventListeners.push(this.app.vault.on("rename",(t,r)=>{t instanceof Bs.TFile&&t.extension==="md"&&this.handleFileRenamed(t,r)}))}ensureIndexesBuilt(){this.indexesBuilt||(this.indexesBuilt=!0,window.setTimeout(()=>this.buildEssentialIndexes(),1))}async buildEssentialIndexes(){try{let t=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path)),r=50;for(let s=0;s<t.length;s+=r){let i=t.slice(s,s+r);for(let a of i)try{let o=this.app.metadataCache.getFileCache(a);o!=null&&o.frontmatter&&this.isTaskFile(o.frontmatter)&&await this.indexTaskFile(a,o.frontmatter)}catch(o){console.error(`Error indexing file ${a.path}:`,o)}await new Promise(a=>window.setTimeout(a,1))}this.trigger("indexes-built",{tasksByDate:this.tasksByDate.size,tasksByStatus:this.tasksByStatus.size,overdueTasks:this.overdueTasks.size})}catch(t){console.error("Error building essential indexes:",t)}}async indexTaskFile(t,r){if(this.fieldMapper)try{let s=this.extractTaskInfoFromNative(t.path,r);if(!s)return;this.updateDateIndex(t.path,s),this.updateStatusIndex(t.path,s.status),this.updateOverdueIndex(t.path,s),this.updateProjectReferencesIndex(t.path,s.projects)}catch(s){console.error(`Error indexing task ${t.path}:`,s)}}async getTaskInfo(t){let r=this.app.vault.getAbstractFileByPath(t);if(!(r instanceof Bs.TFile))return null;let s=this.app.metadataCache.getFileCache(r);return s!=null&&s.frontmatter?this.extractTaskInfoFromNative(t,s.frontmatter):null}async getAllTasks(){return this.getFilteredTasks()}async getFilteredTasks(t){let r=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path)),s=[],i=100;for(let a=0;a<r.length;a+=i){let o=r.slice(a,a+i);for(let l of o){let c=this.app.metadataCache.getFileCache(l);if(c!=null&&c.frontmatter&&this.isTaskFile(c.frontmatter)){if(t&&!t(l,c.frontmatter))continue;let d=this.extractTaskInfoFromNative(l.path,c.frontmatter);d&&s.push(d)}}a+i<r.length&&await new Promise(l=>setTimeout(l,1))}return s}async streamTasks(t){let r=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path)),s=50;for(let i=0;i<r.length;i+=s){let a=r.slice(i,i+s);for(let o of a){let l=this.app.metadataCache.getFileCache(o);if(l!=null&&l.frontmatter&&this.isTaskFile(l.frontmatter)){let c=this.extractTaskInfoFromNative(o.path,l.frontmatter);if(c&&!await t(c))return}}i+s<r.length&&await new Promise(o=>setTimeout(o,1))}}getTasksForDate(t){this.ensureIndexesBuilt();let r=this.tasksByDate.get(t)||new Set;return Array.from(r)}getTasksReferencingProject(t){this.ensureIndexesBuilt();let r=this.projectReferences.get(t)||new Set;return Array.from(r)}isFileUsedAsProject(t){this.ensureIndexesBuilt();let r=this.projectReferences.get(t);return r?r.size>0:!1}getTaskPathsByStatus(t){this.ensureIndexesBuilt();let r=this.tasksByStatus.get(t)||new Set;return Array.from(r)}getOverdueTaskPaths(){return this.ensureIndexesBuilt(),new Set(this.overdueTasks)}async getCalendarData(t,r){let s=new Map,i=new Map,a=new Set,o=this.app.vault.getMarkdownFiles().filter(c=>this.isValidFile(c.path));try{let{getAllDailyNotes:c}=wn(),d=c();for(let[u]of Object.entries(d))a.add(u)}catch(c){}for(let c of o){let d=this.app.metadataCache.getFileCache(c);if(!(d!=null&&d.frontmatter))continue;let u=d.frontmatter;if(!this.isTaskFile(u)&&!this.disableNoteIndexing){let h=null;if(this.fieldMapper){let p=this.fieldMapper.toUserField("dateCreated");if(u[p]){let m=u[p];try{let g=new Date(m);isNaN(g.getTime())||(h=g.toISOString().split("T")[0])}catch(g){}}}if(!h){let m=c.basename.match(/(\d{4}-\d{2}-\d{2})/);m&&(h=m[1],a.add(h))}if(h){let p=i.get(h)||0;i.set(h,p+1)}}}let l=new Date(t,r+1,0).getDate();for(let c=1;c<=l;c++){let d=`${t}-${String(r+1).padStart(2,"0")}-${String(c).padStart(2,"0")}`,u=this.getTasksForDate(d);if(u.length>0){let h=(await Promise.all(u.map(p=>this.getTaskInfo(p)))).filter(p=>p!==null);if(h.length>0){let p={count:h.length,hasDue:h.some(m=>m.due&&!m.scheduled),hasScheduled:h.some(m=>m.scheduled),hasCompleted:h.some(m=>m.status==="completed"||m.status==="done"),hasArchived:h.some(m=>m.archived),tasks:h};s.set(d,p)}}}return{tasks:s,notes:i,dailyNotes:a}}getAllTaskPaths(){let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)&&t.add(s.path)}return t}getAllStatuses(){if(this.ensureIndexesBuilt(),this.tasksByStatus.size===0&&this.indexesBuilt){console.debug("MinimalNativeCache: Indexes marked as built but tasksByStatus is empty, computing statuses synchronously");let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);a!=null&&a.status&&t.add(a.status)}}return Array.from(t).sort()}return Array.from(this.tasksByStatus.keys()).sort()}getAllPriorities(){let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);a!=null&&a.priority&&t.add(a.priority)}}return Array.from(t).sort()}getAllTags(){try{let s=this.app.metadataCache.getTags();if(s&&typeof s=="object"){let i=Object.keys(s).map(a=>a.startsWith("#")?a.slice(1):a).filter(a=>a.length>0);return Array.from(new Set(i)).sort()}}catch(s){console.warn("MinimalNativeCache: Failed to use native getTags(), falling back to manual scan:",s)}let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);a!=null&&a.tags&&Array.isArray(a.tags)&&a.tags.forEach(o=>t.add(o))}}return Array.from(t).sort()}getAllContexts(){let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);a!=null&&a.contexts&&Array.isArray(a.contexts)&&a.contexts.forEach(o=>t.add(o))}}return Array.from(t).sort()}getAllProjects(){var s;try{let i=new Set,a=this.app.metadataCache.resolvedLinks;if(a&&typeof a=="object"){for(let[o,l]of Object.entries(a)){if(!l||!this.isValidFile(o))continue;let c=this.app.metadataCache.getCache(o);if(!(c!=null&&c.frontmatter)||!this.isTaskFile(c.frontmatter))continue;let d=((s=this.fieldMapper)==null?void 0:s.toUserField("projects"))||"projects",u=c.frontmatter[d];if(!Array.isArray(u))continue;if(u.some(h=>typeof h=="string"&&h.startsWith("[[")&&h.endsWith("]]"))){for(let h of Object.keys(l))if(l[h]>0){let p=this.app.vault.getAbstractFileByPath(h);p instanceof Bs.TFile&&i.add(p.basename)}}}if(i.size>0)return Array.from(i).sort()}}catch(i){console.warn("MinimalNativeCache: Failed to use native resolvedLinks for projects, falling back to manual scan:",i)}let t=new Set,r=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of r){let a=this.app.metadataCache.getFileCache(i);if(a!=null&&a.frontmatter&&this.isTaskFile(a.frontmatter)){let o=this.extractTaskInfoFromNative(i.path,a.frontmatter);if(o&&o.projects){let l=Xr(o.projects);l.length>0&&l.forEach(c=>{this.extractProjectNamesFromValue(c,i.path).forEach(u=>{let f=u.trim();f.length>0&&t.add(f)})})}}}return Array.from(t).sort()}getAllProjectsWithDetails(){let t=new Map,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter),o=Xr((a==null?void 0:a.projects)||[]);o.length>0&&o.forEach(l=>{this.extractProjectDetailsFromValue(l,s.path).forEach(d=>{let u=t.get(d.name);u?u.usageCount++:t.set(d.name,{...d,usageCount:1})})})}}return Array.from(t.values()).sort((s,i)=>s.name.localeCompare(i.name))}getAllProjectFiles(){return this.getAllProjectsWithDetails().filter(r=>r.isLinkedNote&&r.exists&&r.filePath).map(r=>({name:r.name,path:r.filePath,usageCount:r.usageCount}))}extractProjectNamesFromValue(t,r){var i;if(!t)return[];let s=[];if(t.startsWith("[[")&&t.endsWith("]]")){let a=t.slice(2,-2),l=(0,Bs.parseLinktext)(a).path,c;if(c=this.app.metadataCache.getFirstLinkpathDest(l,""),!c){let d=r.substring(0,r.lastIndexOf("/"));c=this.app.metadataCache.getFirstLinkpathDest(l,d)}if(c)s.push(c.basename);else{let d=((i=l.split("/").pop())==null?void 0:i.replace(/\.md$/,""))||l;s.push(d)}}else{let a=t.trim();a&&s.push(a)}return s}extractProjectDetailsFromValue(t,r){var i;if(!t)return[];let s=[];if(t.startsWith("[[")&&t.endsWith("]]")){let a=t.slice(2,-2),l=(0,Bs.parseLinktext)(a).path,c;if(c=this.app.metadataCache.getFirstLinkpathDest(l,""),!c){let d=r.substring(0,r.lastIndexOf("/"));c=this.app.metadataCache.getFirstLinkpathDest(l,d)}if(c)s.push({name:c.basename,isLinkedNote:!0,filePath:c.path,exists:!0});else{let d=((i=l.split("/").pop())==null?void 0:i.replace(/\.md$/,""))||l;s.push({name:d,isLinkedNote:!0,filePath:void 0,exists:!1})}}else{let a=t.trim();a&&s.push({name:a,isLinkedNote:!1,filePath:void 0,exists:!1})}return s}getCachedTaskInfoSync(t){let r=this.app.vault.getAbstractFileByPath(t);if(!(r instanceof Bs.TFile))return null;let s=this.app.metadataCache.getFileCache(r);return!(s!=null&&s.frontmatter)||!this.isTaskFile(s.frontmatter)?null:this.extractTaskInfoFromNative(t,s.frontmatter)}async getCachedTaskInfo(t){return this.getTaskInfo(t)}async getTaskByPath(t){return this.getTaskInfo(t)}async getNotesForDate(t){if(this.disableNoteIndexing)return[];let r=we(t.toISOString()),s=[],i=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of i){let o=this.app.metadataCache.getFileCache(a);if(!(o!=null&&o.frontmatter))continue;let l=o.frontmatter;if(this.isTaskFile(l))continue;let d=null;if(this.fieldMapper){let u=this.fieldMapper.toUserField("dateCreated");if(l[u]){let f=l[u];if(typeof f=="string"&&f.trim()){let h=f.trim();if(h.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(h))console.debug("Skipping invalid time-only date in note frontmatter:",{path:a.path,dateValue:h});else try{let p=qe(f);d=ue(p)}catch(p){console.debug("Failed to parse date from note frontmatter:",{path:a.path,dateValue:f,error:p instanceof Error?p.message:String(p)})}}}}if(!d){let f=a.basename.match(/(\d{4}-\d{2}-\d{2})/);if(f)try{let h=qe(f[1]);d=ue(h)}catch(h){}}if(d===r){let u=[];if(l.tags&&(Array.isArray(l.tags)?u=l.tags.filter(h=>typeof h=="string"):typeof l.tags=="string"&&(u=[l.tags])),o.tags){let h=o.tags.map(p=>p.tag.replace("#",""));u=[...new Set([...u,...h])]}let f={title:a.basename,tags:u,path:a.path,createdDate:d,lastModified:a.stat.mtime};s.push(f)}}return s}async getTaskInfoForDate(t){let r=t.toISOString().split("T")[0],s=this.getTasksForDate(r);return(await Promise.all(s.map(a=>this.getTaskInfo(a)))).filter(a=>a!==null)}getTaskPathsByDate(t){return new Set(this.getTasksForDate(t))}getTaskPathsByPriority(t){let r=[],s=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of s){let a=this.app.metadataCache.getFileCache(i);if(a!=null&&a.frontmatter&&this.isTaskFile(a.frontmatter)){let o=this.extractTaskInfoFromNative(i.path,a.frontmatter);(o==null?void 0:o.priority)===t&&r.push(i.path)}}return r}async rebuildDailyNotesCache(t,r){}updateDateIndex(t,r){for(let s of this.tasksByDate.values())s.delete(t);if(r.due){let s=we(r.due);this.tasksByDate.has(s)||this.tasksByDate.set(s,new Set),this.tasksByDate.get(s).add(t)}if(r.scheduled){let s=we(r.scheduled);this.tasksByDate.has(s)||this.tasksByDate.set(s,new Set),this.tasksByDate.get(s).add(t)}}updateStatusIndex(t,r){for(let s of this.tasksByStatus.values())s.delete(t);this.tasksByStatus.has(r)||this.tasksByStatus.set(r,new Set),this.tasksByStatus.get(r).add(t)}updateOverdueIndex(t,r){if(this.overdueTasks.delete(t),!r.recurrence){let s=qt();r.due&&Bn(r.due,s)?this.overdueTasks.add(t):!r.due&&r.scheduled&&Bn(r.scheduled,s)&&this.overdueTasks.add(t)}}updateProjectReferencesIndex(t,r){for(let s of this.projectReferences.values())s.delete(t);if(r&&r.length>0){for(let s of r)if(!(!s||typeof s!="string")&&s.startsWith("[[")&&s.endsWith("]]")){let i=s.slice(2,-2).trim(),a=this.app.metadataCache.getFirstLinkpathDest(i,"");if(a){let o=a.path;this.projectReferences.has(o)||this.projectReferences.set(o,new Set),this.projectReferences.get(o).add(t)}}}}handleFileChangedDebounced(t,r){let s=this.app.metadataCache.getFileCache(t);if(!(s!=null&&s.frontmatter)||!this.isTaskFile(s.frontmatter))return;let i=s.frontmatter,a=this.lastKnownFrontmatter.get(t.path);if(this.frontmatterEquals(i,a))return;this.lastKnownFrontmatter.set(t.path,this.deepClone(i));let o=this.extractTaskInfoFromNative(t.path,i),l=this.getLastKnownTaskInfo(t.path);if(this.taskInfoEquals(o,l)){this.setLastKnownTaskInfo(t.path,o);return}this.setLastKnownTaskInfo(t.path,o);let c=this.debouncedHandlers.get(t.path);c&&clearTimeout(c);let d=setTimeout(()=>{this.handleFileChanged(t,r),this.debouncedHandlers.delete(t.path)},this.DEBOUNCE_DELAY);this.debouncedHandlers.set(t.path,d)}async handleFileChanged(t,r){if(!this.initialized)return;this.clearFileFromIndexes(t.path),await this.waitForFreshData(t);let s=this.app.metadataCache.getFileCache(t);s!=null&&s.frontmatter&&this.isTaskFile(s.frontmatter)&&await this.indexTaskFile(t,s.frontmatter),this.trigger("file-updated",{path:t.path,file:t})}handleFileDeleted(t){this.initialized&&(this.clearFileFromIndexes(t),this.lastKnownTaskInfo.delete(t),this.lastKnownFrontmatter.delete(t),this.trigger("file-deleted",{path:t}))}async handleFileRenamed(t,r){if(!this.initialized)return;this.clearFileFromIndexes(r),this.lastKnownTaskInfo.delete(r),this.lastKnownFrontmatter.delete(r),await this.waitForFreshData(t);let s=this.app.metadataCache.getFileCache(t);if(s!=null&&s.frontmatter&&this.isTaskFile(s.frontmatter)){await this.indexTaskFile(t,s.frontmatter);let i=this.extractTaskInfoFromNative(t.path,s.frontmatter);this.setLastKnownTaskInfo(t.path,i),this.lastKnownFrontmatter.set(t.path,this.deepClone(s.frontmatter))}this.trigger("file-renamed",{oldPath:r,newPath:t.path,file:t})}async waitForFreshData(t,r=10){let s=Date.now();for(let a=0;a<r;a++)try{if(!await this.app.vault.adapter.stat(t.path))break;let l=this.app.metadataCache.getFileCache(t);if(l!=null&&l.frontmatter&&(this.extractTaskInfoFromNative(t.path,l.frontmatter)||!this.isTaskFile(l.frontmatter)))return;let c=Math.min(50*Math.pow(1.5,a),200);await new Promise(d=>setTimeout(d,c))}catch(o){await new Promise(l=>setTimeout(l,50))}let i=Date.now()-s;i>3e3&&console.warn(`MinimalNativeCache: Waited ${i}ms for fresh data on ${t.path} - consider investigating file system performance`)}async waitForFreshTaskData(t,r,s=10){let i=Date.now();for(let o=0;o<s;o++)try{let l=this.app.metadataCache.getFileCache(t);if(!(l!=null&&l.frontmatter)){let u=Math.min(50*Math.pow(1.5,o),200);await new Promise(f=>setTimeout(f,u));continue}let c=this.extractTaskInfoFromNative(t.path,l.frontmatter);if(c)if(r){let u=!0;for(let[f,h]of Object.entries(r))if(c[f]!==h){u=!1;break}if(u)return}else return;let d=Math.min(50*Math.pow(1.5,o),200);await new Promise(u=>setTimeout(u,d))}catch(l){await new Promise(c=>setTimeout(c,50))}let a=Date.now()-i;a>3e3&&console.warn(`MinimalNativeCache: Waited ${a}ms for fresh task data on ${t.path}`,r)}getLastKnownTaskInfo(t){return this.lastKnownTaskInfo.get(t)||null}setLastKnownTaskInfo(t,r){this.lastKnownTaskInfo.set(t,r)}taskInfoEquals(t,r){return t===null&&r===null?!0:t===null||r===null||!(t.title===r.title&&t.status===r.status&&t.priority===r.priority&&t.due===r.due&&t.scheduled===r.scheduled&&t.archived===r.archived&&t.completedDate===r.completedDate&&t.recurrence===r.recurrence&&t.timeEstimate===r.timeEstimate)?!1:this.arraysEqual(t.tags,r.tags)&&this.arraysEqual(t.contexts,r.contexts)&&this.arraysEqual(t.projects,r.projects)&&this.objectsEqual(t.timeEntries,r.timeEntries)&&this.objectsEqual(t.reminders,r.reminders)&&this.objectsEqual(t.complete_instances,r.complete_instances)}arraysEqual(t,r){if(t===r)return!0;if(!t||!r)return t===r;if(t.length!==r.length)return!1;if(t.length===0)return!0;if(typeof t[0]=="string"){let s=[...t].sort(),i=[...r].sort();return s.every((a,o)=>a===i[o])}return JSON.stringify(t)===JSON.stringify(r)}objectsEqual(t,r){return t===r?!0:!t||!r?t===r:JSON.stringify(t)===JSON.stringify(r)}frontmatterEquals(t,r){return t===r?!0:!t||!r?t===r:JSON.stringify(t)===JSON.stringify(r)}deepClone(t){return t===null||typeof t!="object"?t:JSON.parse(JSON.stringify(t))}extractTaskInfoFromNative(t,r){if(!this.fieldMapper)return null;try{let s=this.fieldMapper.mapFromFrontmatter(r,t,this.storeTitleInFilename),i=s.timeEntries?En(s.timeEntries):0;return{id:t,title:s.title||"Untitled task",status:s.status||"open",priority:s.priority||"normal",due:s.due,scheduled:s.scheduled,path:t,archived:s.archived||!1,tags:Array.isArray(s.tags)?s.tags:[],contexts:Array.isArray(s.contexts)?s.contexts:[],projects:Array.isArray(s.projects)?s.projects:[],recurrence:s.recurrence,complete_instances:s.complete_instances,completedDate:s.completedDate,timeEstimate:s.timeEstimate,timeEntries:s.timeEntries,totalTrackedTime:i,dateCreated:s.dateCreated,dateModified:s.dateModified,reminders:s.reminders}}catch(s){return console.error(`Error extracting task info from native metadata for ${t}:`,s),null}}isValidFile(t){return!this.excludedFolders.some(r=>t.startsWith(r))}clearFileFromIndexes(t){for(let r of this.tasksByDate.values())r.delete(t);for(let r of this.tasksByStatus.values())r.delete(t);this.overdueTasks.delete(t);for(let r of this.projectReferences.values())r.delete(t)}clearAllIndexes(){this.tasksByDate.clear(),this.tasksByStatus.clear(),this.overdueTasks.clear(),this.projectReferences.clear()}updateConfig(t,r,s,i=!1,a=!1){this.taskTag=t,this.excludedFolders=r?r.split(",").map(o=>o.trim()).filter(o=>o.length>0):[],this.fieldMapper=s,this.disableNoteIndexing=i,this.storeTitleInFilename=a,this.initialized&&(this.clearAllIndexes(),this.indexesBuilt=!1)}clearCacheEntry(t){let r=this.app.vault.getAbstractFileByPath(t);if(r instanceof Bs.TFile){let s=this.app.metadataCache.getFileCache(r);s!=null&&s.frontmatter&&this.isTaskFile(s.frontmatter)&&this.indexTaskFile(r,s.frontmatter)}}async clearAllCaches(){this.clearAllIndexes(),this.indexesBuilt=!1}updateTaskInfoInCache(t,r){this.indexesBuilt&&(this.clearFileFromIndexes(t),this.updateDateIndex(t,r),this.updateStatusIndex(t,r.status),this.updateOverdueIndex(t,r),this.updateProjectReferencesIndex(t,r.projects))}subscribe(t,r){return this.on(t,r),()=>this.off(t,r)}isInitialized(){return this.initialized}getStats(){return{indexSizes:{tasksByDate:this.tasksByDate.size,tasksByStatus:this.tasksByStatus.size,overdueTasks:this.overdueTasks.size},memoryFootprint:"Minimal - only essential indexes"}}destroy(){this.eventListeners.forEach(t=>{this.app.metadataCache.offref(t)}),this.eventListeners=[],this.debouncedHandlers.forEach(t=>clearTimeout(t)),this.debouncedHandlers.clear(),this.lastKnownTaskInfo.clear(),this.lastKnownFrontmatter.clear(),this.clearAllIndexes(),this.initialized=!1,this.indexesBuilt=!1}};var id=class{constructor(){this.inFlightRequests=new Map;this.prefetchQueue=new Set;this.prefetchPromises=new Map;this.activeTimeouts=new Set}async execute(e,t,r=5e3){if(this.inFlightRequests.has(e))return this.inFlightRequests.get(e);let s=this.createRequest(e,t,r);return this.inFlightRequests.set(e,s),s}async createRequest(e,t,r){try{let s=await t(),i=setTimeout(()=>{this.inFlightRequests.delete(e),this.activeTimeouts.delete(i)},r);return this.activeTimeouts.add(i),s}catch(s){throw this.inFlightRequests.delete(e),s}}prefetch(e,t,r="low"){if(!(this.inFlightRequests.has(e)||this.prefetchPromises.has(e)))if(r==="high")this.executePrefetch(e,t);else if(this.prefetchQueue.add(e),"requestIdleCallback"in window)requestIdleCallback(()=>{this.processPrefetchQueue(e,t)});else{let s=setTimeout(()=>{this.processPrefetchQueue(e,t),this.activeTimeouts.delete(s)},50);this.activeTimeouts.add(s)}}async executePrefetch(e,t){try{let r=t();this.prefetchPromises.set(e,r),await r;let s=setTimeout(()=>{this.prefetchPromises.delete(e),this.activeTimeouts.delete(s)},3e4);this.activeTimeouts.add(s)}catch(r){this.prefetchPromises.delete(e)}}processPrefetchQueue(e,t){this.prefetchQueue.has(e)&&(this.prefetchQueue.delete(e),this.executePrefetch(e,t))}getPrefetchedData(e){return this.prefetchPromises.get(e)||null}cancel(e){this.inFlightRequests.delete(e),this.prefetchPromises.delete(e),this.prefetchQueue.delete(e)}cancelAll(){this.inFlightRequests.clear(),this.prefetchPromises.clear(),this.prefetchQueue.clear();for(let e of this.activeTimeouts)clearTimeout(e);this.activeTimeouts.clear()}getStats(){return{inFlightCount:this.inFlightRequests.size,prefetchCount:this.prefetchPromises.size,queuedCount:this.prefetchQueue.size}}},By=class{constructor(e){this.lastAccessTime=new Map;this.deduplicator=e}recordAccess(e,t,r){let s=this.getDateKey(e);this.lastAccessTime.set(s,Date.now()),this.prefetchAdjacentDates(e,t,r)}prefetchAdjacentDates(e,t,r){this.getAdjacentDates(e).forEach(({date:i,priority:a})=>{let o=`${t}-${this.getDateKey(i)}`;this.deduplicator.prefetch(o,()=>r(i),a)})}getAdjacentDates(e){let t=[],r=new Date(e);r.setDate(e.getDate()-1),t.push({date:r,priority:"high"});let s=new Date(e);s.setDate(e.getDate()+1),t.push({date:s,priority:"high"});for(let i=2;i<=7;i++){let a=new Date(e);a.setDate(e.getDate()-i),t.push({date:a,priority:"low"});let o=new Date(e);o.setDate(e.getDate()+i),t.push({date:o,priority:"low"})}return t}getDateKey(e){return e.toISOString().split("T")[0]}cleanup(){let e=Date.now(),t=1440*60*1e3;for(let[r,s]of this.lastAccessTime)e-s>t&&this.lastAccessTime.delete(r)}};var ad=class{constructor(){this.updateQueue=[];this.isProcessing=!1;this.activeTimeouts=new Set}scheduleUpdate(e){this.updateQueue.push(e),this.isProcessing||(this.isProcessing=!0,requestAnimationFrame(()=>{this.processUpdates()}))}processUpdates(){let e=[...this.updateQueue];this.updateQueue=[];try{e.forEach(t=>{try{t()}catch(r){console.error("Error processing DOM update:",r)}})}finally{this.isProcessing=!1,this.updateQueue.length>0&&requestAnimationFrame(()=>{this.processUpdates()})}}updateAttributes(e,t){for(let[r,s]of Object.entries(t))s===null?e.removeAttribute(r):e.getAttribute(r)!==s&&e.setAttribute(r,s)}updateClasses(e,t){for(let[r,s]of Object.entries(t))s?e.classList.add(r):e.classList.remove(r)}updateTextContent(e,t){e.textContent!==t&&(e.textContent=t)}updateStyles(e,t){for(let[r,s]of Object.entries(t))s===null?e.style.removeProperty(r):e.style.setProperty(r,s)}preserveState(e){let t={scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,focused:document.activeElement===e,selection:null};return(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&(t.selection={start:e.selectionStart||0,end:e.selectionEnd||0}),t}restoreState(e,t){e.scrollTop=t.scrollTop,e.scrollLeft=t.scrollLeft,t.focused&&e.focus(),t.selection&&(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&e.setSelectionRange(t.selection.start,t.selection.end)}animateUpdate(e,t,r=1500){e.classList.add(`task-${t}`);let s=setTimeout(()=>{e.classList.remove(`task-${t}`),this.activeTimeouts.delete(s)},r);this.activeTimeouts.add(s)}updateList(e,t,r,s,i){let a=new Map,o=new Set;Array.from(e.children).forEach(d=>{let u=d.dataset.key;u&&(a.set(u,d),o.add(u))});let l=new Set(t.map(r)),c=document.createDocumentFragment();t.forEach(d=>{let u=r(d),f=a.get(u);if(f)i&&i(f,d),c.appendChild(f);else{let h=s(d);h.dataset.key=u,c.appendChild(h)}}),o.forEach(d=>{if(!l.has(d)){let u=a.get(d);u&&u.parentNode&&u.remove()}}),e.replaceChildren(c)}createOptimisticUpdate(e,t,r){return t(e),{commit:()=>{},revert:()=>{r(e)}}}destroy(){this.updateQueue=[],this.isProcessing=!1;for(let e of this.activeTimeouts)clearTimeout(e);this.activeTimeouts.clear()}},Uy=class{constructor(){this.stateMap=new Map}saveState(e,t){let r=new ad;this.stateMap.set(e,r.preserveState(t))}restoreState(e,t){let r=this.stateMap.get(e);r&&new ad().restoreState(t,r)}clearState(e){e?this.stateMap.delete(e):this.stateMap.clear()}destroy(){this.stateMap.clear()}};QT();IS();var jy=class n{constructor(e){this.priorities=e}getPriorityConfig(e){return this.priorities.find(t=>t.value===e)}getPrioritiesByWeight(){return[...this.priorities].sort((e,t)=>t.weight-e.weight)}getPrioritiesByWeightAsc(){return[...this.priorities].sort((e,t)=>e.weight-t.weight)}getNextPriority(e){var i;let t=this.getPrioritiesByWeightAsc(),r=t.findIndex(a=>a.value===e);if(r===-1)return((i=t[0])==null?void 0:i.value)||"normal";let s=(r+1)%t.length;return t[s].value}comparePriorities(e,t){let r=this.getPriorityConfig(e),s=this.getPriorityConfig(t),i=(r==null?void 0:r.weight)||0;return((s==null?void 0:s.weight)||0)-i}getPriorityStyles(){let e=[];for(let t of this.priorities){let r=`--priority-${t.value.replace(/[^a-zA-Z0-9-]/g,"-")}-color`;e.push(`${r}: ${t.color};`)}return`:root { ${e.join(" ")} }`}getAllPriorities(){return[...this.priorities]}updatePriorities(e){this.priorities=e}getHighestPriority(){var t;return(t=this.getPrioritiesByWeight()[0])==null?void 0:t.value}getLowestPriority(){var t;return(t=this.getPrioritiesByWeightAsc()[0])==null?void 0:t.value}getPriorityWeight(e){let t=this.getPriorityConfig(e);return(t==null?void 0:t.weight)||0}isHigherPriority(e,t){return this.comparePriorities(e,t)>0}static validatePriorities(e){let t=[];e.length<1&&t.push("At least 1 priority is required");let r=e.map(c=>c.value),s=new Set(r);r.length!==s.size&&t.push("Priority values must be unique");let i=e.map(c=>c.id),a=new Set(i);i.length!==a.size&&t.push("Priority IDs must be unique");let o=e.map(c=>c.weight),l=new Set(o);o.length!==l.size&&t.push("Priority weights must be unique");for(let c of e){if(!c.value||c.value.trim()===""){t.push("Priority values cannot be empty");break}if(!c.label||c.label.trim()===""){t.push("Priority labels cannot be empty");break}if(!c.color||!c.color.match(/^#[0-9a-fA-F]{6}$/)){t.push("Priority colors must be valid hex colors (#rrggbb)");break}if(typeof c.weight!="number"||c.weight<0){t.push("Priority weights must be non-negative numbers");break}}return{valid:t.length===0,errors:t}}static generatePriorityId(e){let t=new Set(e.map(i=>i.id)),r=1,s=`priority-${r}`;for(;t.has(s);)r++,s=`priority-${r}`;return s}static generatePriorityWeight(e){let t=e.map(r=>r.weight);return t.length===0?1:Math.max(...t)+1}static createDefaultPriority(e){let t=n.generatePriorityId(e),r=n.generatePriorityWeight(e);return{id:t,value:"new-priority",label:"New priority",color:"#808080",weight:r}}};or();var Xt=require("obsidian");Ft();var OH=require("obsidian");function Wy(n,e){let t=Q6(n),r=t.frontmatter?K6(t.frontmatter,e):{},s=Z6(t.body,e);return{frontmatter:r,body:s}}function Q6(n){var t,r;let e=n.split(`
`);if(((t=e[0])==null?void 0:t.trim())==="---"){let s=-1;for(let i=1;i<e.length;i++)if(((r=e[i])==null?void 0:r.trim())==="---"){s=i;break}if(s>0){let a=e.slice(1,s).join(`
`),l=e.slice(s+1).join(`
`);return{frontmatter:a.trim()||null,body:l}}}return{frontmatter:null,body:n}}function K6(n,e){try{let t=X6(n,e),r=(0,OH.parseYaml)(t);return typeof r!="object"||r===null?(console.warn("Template frontmatter did not parse to a valid object"),{}):r}catch(t){return console.error("Error processing template frontmatter:",t),{}}}function Z6(n,e){return J6(n,e)}function X6(n,e){var d;let t=n,r=new Date,s=e.title||"",i=mp(s)?`"${cl(s)}"`:s;t=t.replace(/\{\{title\}\}/g,i),t=t.replace(/\{\{priority\}\}/g,e.priority||""),t=t.replace(/\{\{status\}\}/g,e.status||"");let a=Array.isArray(e.contexts)?e.contexts.join(", "):"";t=t.replace(/\{\{contexts\}\}/g,a);let o=Array.isArray(e.tags)?e.tags.join(", "):"";t=t.replace(/\{\{tags\}\}/g,o),t=t.replace(/\{\{timeEstimate\}\}/g,((d=e.timeEstimate)==null?void 0:d.toString())||""),t=t.replace(/\{\{dueDate\}\}/g,e.dueDate||""),t=t.replace(/\{\{scheduledDate\}\}/g,e.scheduledDate||""),t=t.replace(/\{\{details\}\}/g,e.details||"");let l=e.parentNote||"",c=l?`"${cl(l)}"`:"";if(t=t.replace(/\{\{parentNote\}\}/g,c),t=t.replace(/\{\{date\}\}/g,C(r,"yyyy-MM-dd")),t=t.replace(/\{\{time\}\}/g,C(r,"HH:mm")),"icsEventTitle"in e){let u=e,f=u.icsEventTitle||"",h=mp(f)?`"${cl(f)}"`:f;t=t.replace(/\{\{icsEventTitle\}\}/g,h),t=t.replace(/\{\{icsEventStart\}\}/g,u.icsEventStart||""),t=t.replace(/\{\{icsEventEnd\}\}/g,u.icsEventEnd||"");let p=u.icsEventLocation||"",m=p&&mp(p)?`"${cl(p)}"`:p;t=t.replace(/\{\{icsEventLocation\}\}/g,m);let g=u.icsEventDescription||"",y=g&&mp(g)?`"${cl(g)}"`:g;t=t.replace(/\{\{icsEventDescription\}\}/g,y),t=t.replace(/\{\{icsEventUrl\}\}/g,u.icsEventUrl||"");let T=u.icsEventSubscription||"",w=T&&mp(T)?`"${cl(T)}"`:T;t=t.replace(/\{\{icsEventSubscription\}\}/g,w);let b=u.icsEventId||"",E=b?`"${cl(b)}"`:"";t=t.replace(/\{\{icsEventId\}\}/g,E)}return t}function mp(n){if(!n)return!1;let e=/[[\]{}:>|*&!%#`@,]/,t=/^[-?]/,r=/^\d+\.?\d*$/,s=/^(true|false|yes|no|on|off)$/i;return e.test(n)||t.test(n)||r.test(n)||s.test(n)}function cl(n){return n?n.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):""}function J6(n,e){var a;let t=n,r=new Date;t=t.replace(/\{\{title\}\}/g,e.title||""),t=t.replace(/\{\{priority\}\}/g,e.priority||""),t=t.replace(/\{\{status\}\}/g,e.status||"");let s=Array.isArray(e.contexts)?e.contexts.join(", "):"";t=t.replace(/\{\{contexts\}\}/g,s);let i=Array.isArray(e.tags)?e.tags.join(", "):"";if(t=t.replace(/\{\{tags\}\}/g,i),t=t.replace(/\{\{timeEstimate\}\}/g,((a=e.timeEstimate)==null?void 0:a.toString())||""),t=t.replace(/\{\{dueDate\}\}/g,e.dueDate||""),t=t.replace(/\{\{scheduledDate\}\}/g,e.scheduledDate||""),t=t.replace(/\{\{details\}\}/g,e.details||""),t=t.replace(/\{\{parentNote\}\}/g,e.parentNote||""),t=t.replace(/\{\{date\}\}/g,C(r,"yyyy-MM-dd")),t=t.replace(/\{\{time\}\}/g,C(r,"HH:mm")),"icsEventTitle"in e){let o=e;t=t.replace(/\{\{icsEventTitle\}\}/g,o.icsEventTitle||""),t=t.replace(/\{\{icsEventStart\}\}/g,o.icsEventStart||""),t=t.replace(/\{\{icsEventEnd\}\}/g,o.icsEventEnd||""),t=t.replace(/\{\{icsEventLocation\}\}/g,o.icsEventLocation||""),t=t.replace(/\{\{icsEventDescription\}\}/g,o.icsEventDescription||""),t=t.replace(/\{\{icsEventUrl\}\}/g,o.icsEventUrl||""),t=t.replace(/\{\{icsEventSubscription\}\}/g,o.icsEventSubscription||""),t=t.replace(/\{\{icsEventId\}\}/g,o.icsEventId||"")}return t}function LH(n,e){return{...e,...n}}At();Ne();Ft();var Vy=class{constructor(e){this.plugin=e}setWebhookNotifier(e){this.webhookNotifier=e}setAutoArchiveService(e){this.autoArchiveService=e}processFolderTemplate(e,t,r=new Date){if(!e)return e;let s=e;if(t){let o=Array.isArray(t.contexts)&&t.contexts.length>0?t.contexts[0]:"";s=s.replace(/\{\{context\}\}/g,o);let l=Array.isArray(t.projects)&&t.projects.length>0?t.projects[0].replace(/\[{2}(.*)]{2}/,"$1"):"";s=s.replace(/\{\{project\}\}/g,l);let c=Array.isArray(t.projects)&&t.projects.length>0?t.projects.map(x=>x.replace(/\[{2}(.*)]{2}/,"$1")).join("/"):"";s=s.replace(/\{\{projects\}\}/g,c);let d=Array.isArray(t.contexts)&&t.contexts.length>0?t.contexts.join("/"):"";s=s.replace(/\{\{contexts\}\}/g,d);let u=t.priority||"";s=s.replace(/\{\{priority\}\}/g,u);let f=t.status||"";s=s.replace(/\{\{status\}\}/g,f);let h=t.title?t.title.replace(/[<>:"/\\|?*]/g,"_"):"";s=s.replace(/\{\{title\}\}/g,h);let p=t.due||"";s=s.replace(/\{\{dueDate\}\}/g,p);let m=t.scheduled||"";s=s.replace(/\{\{scheduledDate\}\}/g,m);let g=u?u.substring(0,1).toUpperCase():"";s=s.replace(/\{\{priorityShort\}\}/g,g);let y=f?f.substring(0,1).toUpperCase():"";s=s.replace(/\{\{statusShort\}\}/g,y);let T=h?h.toLowerCase():"";s=s.replace(/\{\{titleLower\}\}/g,T);let w=h?h.toUpperCase():"";s=s.replace(/\{\{titleUpper\}\}/g,w);let b=h?h.toLowerCase().replace(/\s+/g,"_"):"";s=s.replace(/\{\{titleSnake\}\}/g,b);let E=h?h.toLowerCase().replace(/\s+/g,"-"):"";s=s.replace(/\{\{titleKebab\}\}/g,E);let S=h?h.replace(/(?:^\w|[A-Z]|\b\w)/g,(x,M)=>M===0?x.toLowerCase():x.toUpperCase()).replace(/\s+/g,""):"";s=s.replace(/\{\{titleCamel\}\}/g,S);let D=h?h.replace(/(?:^\w|[A-Z]|\b\w)/g,x=>x.toUpperCase()).replace(/\s+/g,""):"";s=s.replace(/\{\{titlePascal\}\}/g,D)}s=s.replace(/\{\{year\}\}/g,C(r,"yyyy")),s=s.replace(/\{\{month\}\}/g,C(r,"MM")),s=s.replace(/\{\{day\}\}/g,C(r,"dd")),s=s.replace(/\{\{date\}\}/g,C(r,"yyyy-MM-dd")),s=s.replace(/\{\{time\}\}/g,C(r,"HHmmss")),s=s.replace(/\{\{timestamp\}\}/g,C(r,"yyyy-MM-dd-HHmmss")),s=s.replace(/\{\{dateTime\}\}/g,C(r,"yyyy-MM-dd-HHmm")),s=s.replace(/\{\{hour\}\}/g,C(r,"HH")),s=s.replace(/\{\{minute\}\}/g,C(r,"mm")),s=s.replace(/\{\{second\}\}/g,C(r,"ss")),s=s.replace(/\{\{shortDate\}\}/g,C(r,"yyMMdd")),s=s.replace(/\{\{monthName\}\}/g,C(r,"MMMM")),s=s.replace(/\{\{monthNameShort\}\}/g,C(r,"MMM")),s=s.replace(/\{\{dayName\}\}/g,C(r,"EEEE")),s=s.replace(/\{\{dayNameShort\}\}/g,C(r,"EEE")),s=s.replace(/\{\{week\}\}/g,C(r,"ww")),s=s.replace(/\{\{quarter\}\}/g,C(r,"q")),s=s.replace(/\{\{time12\}\}/g,C(r,"hh:mm a")),s=s.replace(/\{\{time24\}\}/g,C(r,"HH:mm")),s=s.replace(/\{\{hourPadded\}\}/g,C(r,"HH")),s=s.replace(/\{\{hour12\}\}/g,C(r,"hh")),s=s.replace(/\{\{ampm\}\}/g,C(r,"a")),s=s.replace(/\{\{unix\}\}/g,Math.floor(r.getTime()/1e3).toString()),s=s.replace(/\{\{unixMs\}\}/g,r.getTime().toString()),s=s.replace(/\{\{milliseconds\}\}/g,C(r,"SSS")),s=s.replace(/\{\{ms\}\}/g,C(r,"SSS")),s=s.replace(/\{\{timezone\}\}/g,C(r,"xxx")),s=s.replace(/\{\{timezoneShort\}\}/g,C(r,"xx")),s=s.replace(/\{\{utcOffset\}\}/g,C(r,"xxx")),s=s.replace(/\{\{utcOffsetShort\}\}/g,C(r,"xx")),s=s.replace(/\{\{utcZ\}\}/g,"Z");let i=(()=>{let o=C(r,"yyMMdd"),l=new Date(r);l.setHours(0,0,0,0);let d=Math.floor((r.getTime()-l.getTime())/1e3).toString(36);return`${o}${d}`})();s=s.replace(/\{\{zettel\}\}/g,i);let a=Date.now().toString()+Math.random().toString(36).substring(2,7);return s=s.replace(/\{\{nano\}\}/g,a),s}async createTask(e){var t;try{if(!e.title||!e.title.trim())throw new Error("Title is required");let r=e.title.trim(),s=e.priority||this.plugin.settings.defaultTaskPriority,i=e.status||this.plugin.settings.defaultTaskStatus,a=e.dateCreated||Ue(),o=e.dateModified||Ue(),l=e.contexts||[],c=e.projects||[],d=e.tags||[];this.plugin.settings.taskIdentificationMethod==="tag"&&(d.includes(this.plugin.settings.taskTag)||(d=[this.plugin.settings.taskTag,...d]));let u={title:r,priority:s,status:i,date:new Date,dueDate:e.due,scheduledDate:e.scheduled},f=Rg(u,this.plugin.settings),h="";if(e.creationContext==="inline-conversion"){let x=this.plugin.settings.inlineTaskConvertFolder||"";if(x.trim()){if(x.includes("{{currentNotePath}}")){let M=this.plugin.app.workspace.getActiveFile(),B=((t=M==null?void 0:M.parent)==null?void 0:t.path)||"";h=x.replace(/\{\{currentNotePath\}\}/g,B)}else h=x;h=this.processFolderTemplate(h,e)}else{let M=this.plugin.settings.tasksFolder||"";h=this.processFolderTemplate(M,e)}}else{let x=this.plugin.settings.tasksFolder||"";h=this.processFolderTemplate(x,e)}h&&await Gl(this.plugin.app.vault,h);let p=await Yu(f,h,this.plugin.app.vault),m=h?`${h}/${p}.md`:`${p}.md`,g={title:r,status:i,priority:s,due:e.due||void 0,scheduled:e.scheduled||void 0,contexts:l.length>0?l:void 0,projects:c.length>0?c:void 0,timeEstimate:e.timeEstimate&&e.timeEstimate>0?e.timeEstimate:void 0,dateCreated:a,dateModified:o,recurrence:e.recurrence||void 0,reminders:e.reminders&&e.reminders.length>0?e.reminders:void 0,icsEventId:e.icsEventId||void 0},y=this.plugin.fieldMapper.mapToFrontmatter(g,this.plugin.settings.taskTag,this.plugin.settings.storeTitleInFilename);if(this.plugin.settings.taskIdentificationMethod==="property"){let x=this.plugin.settings.taskPropertyName,M=this.plugin.settings.taskPropertyValue;if(x&&M){let Q=M.toLowerCase(),P=Q==="true"||Q==="false"?Q==="true":M;y[x]=P}let B=d.filter(Q=>Q!==this.plugin.settings.taskTag);B.length>0&&(y.tags=B)}else y.tags=d;let T=await this.applyTemplate(e),w=LH(y,T.frontmatter);e.customFrontmatter&&(w={...w,...e.customFrontmatter});let E=`---
${(0,Xt.stringifyYaml)(w)}---

`;T.body&&T.body.trim()&&(E+=`${T.body.trim()}

`);let S=await this.plugin.app.vault.create(m,E),D={...g,...w,title:w.title||g.title||r,status:w.status||g.status||i,priority:w.priority||g.priority||s,path:S.path,tags:d,archived:!1};try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(S,{title:D.title}),this.plugin.cacheManager.updateTaskInfoInCache(S.path,D)}catch(x){console.error("Error updating cache for new task:",x)}if(this.plugin.emitter.trigger(dt,{path:S.path,updatedTask:D}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("task.created",{task:D})}catch(x){console.warn("Failed to trigger webhook for task creation:",x)}return{file:S,taskInfo:D}}catch(r){let s=r instanceof Error?r.message:String(r);throw console.error("Error creating task:",{error:s,stack:r instanceof Error?r.stack:void 0,taskData:e}),new Error(`Failed to create task: ${s}`)}}async applyTemplate(e){var r,s,i,a;let t=this.plugin.settings.taskCreationDefaults;if(!t.useBodyTemplate||!((r=t.bodyTemplate)!=null&&r.trim()))return{frontmatter:{},body:((s=e.details)==null?void 0:s.trim())||""};try{let o=(0,Xt.normalizePath)(t.bodyTemplate.trim());o.endsWith(".md")||(o+=".md");let l=this.plugin.app.vault.getAbstractFileByPath(o);if(l instanceof Xt.TFile){let c=await this.plugin.app.vault.read(l),d={title:e.title||"",priority:e.priority||"",status:e.status||"",contexts:Array.isArray(e.contexts)?e.contexts:[],tags:Array.isArray(e.tags)?e.tags:[],timeEstimate:e.timeEstimate||0,dueDate:e.due||"",scheduledDate:e.scheduled||"",details:e.details||"",parentNote:e.parentNote||""};return Wy(c,d)}else return console.warn(`Task body template not found: ${o}`),new Xt.Notice(`Task body template not found: ${o}`),{frontmatter:{},body:((i=e.details)==null?void 0:i.trim())||""}}catch(o){return console.error("Error reading task body template:",o),new Xt.Notice(`Error reading task body template: ${t.bodyTemplate}`),{frontmatter:{},body:((a=e.details)==null?void 0:a.trim())||""}}}async toggleStatus(e){try{let r=this.plugin.statusManager.isCompletedStatus(e.status)?this.plugin.settings.defaultTaskStatus:this.plugin.statusManager.getCompletedStatuses()[0]||"done";return await this.updateProperty(e,"status",r)}catch(t){let r=t instanceof Error?t.message:String(t);throw console.error("Error toggling task status:",{error:r,stack:t instanceof Error?t.stack:void 0,taskPath:e.path,currentStatus:e.status}),new Error(`Failed to toggle task status: ${r}`)}}async updateProperty(e,t,r,s={}){try{let i=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(i instanceof Xt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let a=await this.plugin.cacheManager.getTaskInfo(e.path)||e,o={...a};o[t]=r,o.dateModified=Ue(),t==="status"&&!a.recurrence&&(this.plugin.statusManager.isCompletedStatus(r)?o.completedDate=nm():o.completedDate=void 0),await this.plugin.app.fileManager.processFrontMatter(i,l=>{let c=this.plugin.fieldMapper.toUserField(t);if(t==="status"){let u=String(r).toLowerCase(),f=u==="true"||u==="false"?u==="true":r;if(l[c]=f,!a.recurrence){let h=this.plugin.fieldMapper.toUserField("completedDate");this.plugin.statusManager.isCompletedStatus(r)?l[h]=nm():l[h]&&delete l[h]}}else(t==="due"||t==="scheduled")&&!r?delete l[c]:l[c]=r;let d=this.plugin.fieldMapper.toUserField("dateModified");l[d]=o.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(i,{[t]:r}),await this.plugin.cacheManager.updateTaskInfoInCache(e.path,o)}catch(l){console.error("Error updating task cache:",{error:l instanceof Error?l.message:String(l),taskPath:e.path})}try{this.plugin.emitter.trigger(dt,{path:e.path,originalTask:e,updatedTask:o})}catch(l){console.error("Error emitting task update event:",{error:l instanceof Error?l.message:String(l),taskPath:e.path})}if(this.webhookNotifier)try{let l=this.plugin.statusManager.isCompletedStatus(e.status),c=t==="status"&&this.plugin.statusManager.isCompletedStatus(r);t==="status"&&!l&&c?await this.webhookNotifier.triggerWebhook("task.completed",{task:o}):await this.webhookNotifier.triggerWebhook("task.updated",{task:o,previous:e})}catch(l){console.warn("Failed to trigger webhook for property update:",l)}if(this.autoArchiveService&&t==="status"&&r!==e.status)try{let l=this.plugin.statusManager.getStatusConfig(r);l&&(l.autoArchive?await this.autoArchiveService.scheduleAutoArchive(o,l):await this.autoArchiveService.cancelAutoArchive(o.path))}catch(l){console.warn("Failed to handle auto-archive for status property change:",l)}return o}catch(i){let a=i instanceof Error?i.message:String(i);throw console.error("Error updating task property:",{error:a,stack:i instanceof Error?i.stack:void 0,taskPath:e.path,property:String(t),value:r}),new Error(`Failed to update task property: ${a}`)}}async toggleArchive(e){var o,l;let t=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(t instanceof Xt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let r=this.plugin.fieldMapper.getMapping().archiveTag,s=e.archived,i={...e};i.archived=!s,i.dateModified=Ue(),i.tags||(i.tags=[]),s?i.tags=i.tags.filter(c=>c!==r):i.tags.includes(r)||(i.tags=[...i.tags,r]),await this.plugin.app.fileManager.processFrontMatter(t,c=>{let d=this.plugin.fieldMapper.toUserField("dateModified");s?c.tags&&Array.isArray(c.tags)&&(c.tags=c.tags.filter(u=>u!==r),c.tags.length===0&&delete c.tags):(c.tags?Array.isArray(c.tags)||(c.tags=[c.tags]):c.tags=[],c.tags.includes(r)||c.tags.push(r)),c[d]=i.dateModified});let a=t;if(this.plugin.settings.moveArchivedTasks)try{if(!s&&((o=this.plugin.settings.archiveFolder)!=null&&o.trim())){let c=this.plugin.settings.archiveFolder.trim();await Gl(this.plugin.app.vault,c);let d=`${c}/${t.name}`;if(this.plugin.app.vault.getAbstractFileByPath(d))throw new Error(`A file named "${t.name}" already exists in the archive folder "${c}". Cannot move task to avoid overwriting existing file.`);await this.plugin.app.fileManager.renameFile(t,d),a=this.plugin.app.vault.getAbstractFileByPath(d),i.path=d,this.plugin.cacheManager.clearCacheEntry(e.path)}else if(s&&((l=this.plugin.settings.tasksFolder)!=null&&l.trim())){let c=this.plugin.settings.tasksFolder.trim();await Gl(this.plugin.app.vault,c);let d=`${c}/${t.name}`;if(this.plugin.app.vault.getAbstractFileByPath(d))throw new Error(`A file named "${t.name}" already exists in the tasks folder "${c}". Cannot move task to avoid overwriting existing file.`);await this.plugin.app.fileManager.renameFile(t,d),a=this.plugin.app.vault.getAbstractFileByPath(d),i.path=d,this.plugin.cacheManager.clearCacheEntry(e.path)}}catch(c){let d=c instanceof Error?c.message:String(c),u=s?"unarchiving":"archiving";console.error(`Error moving ${u} task:`,d),new Xt.Notice(`Failed to move ${u} task: ${d}`)}try{a instanceof Xt.TFile&&this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(a,{archived:i.archived}),await this.plugin.cacheManager.updateTaskInfoInCache(i.path,i)}catch(c){console.error("Error updating cache for archived task:",c)}if(this.plugin.emitter.trigger(dt,{path:i.path,originalTask:e,updatedTask:i}),this.webhookNotifier)try{i.archived?await this.webhookNotifier.triggerWebhook("task.archived",{task:i}):await this.webhookNotifier.triggerWebhook("task.unarchived",{task:i})}catch(c){console.warn("Failed to trigger webhook for task archive/unarchive:",c)}return i}async startTimeTracking(e){var a;let t=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(t instanceof Xt.TFile))throw new Error(`Cannot find task file: ${e.path}`);if(this.plugin.getActiveTimeSession(e))throw new Error("Time tracking is already active for this task");let s={...e};s.dateModified=Ue(),s.timeEntries||(s.timeEntries=[]);let i={startTime:Ue(),description:"Work session"};s.timeEntries=[...s.timeEntries,i],await this.plugin.app.fileManager.processFrontMatter(t,o=>{let l=this.plugin.fieldMapper.toUserField("timeEntries"),c=this.plugin.fieldMapper.toUserField("dateModified");o[l]||(o[l]=[]),o[l].push(i),o[c]=s.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(t,{timeEntries:s.timeEntries}),await this.plugin.cacheManager.updateTaskInfoInCache(e.path,s)}catch(o){console.error("Error updating cache for time tracking start:",o)}if(this.plugin.emitter.trigger(dt,{path:e.path,originalTask:e,updatedTask:s}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("time.started",{task:s,session:(a=s.timeEntries)==null?void 0:a[s.timeEntries.length-1]})}catch(o){console.warn("Failed to trigger webhook for time tracking start:",o)}return s}async stopTimeTracking(e){var i;let t=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(t instanceof Xt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let r=this.plugin.getActiveTimeSession(e);if(!r)throw new Error("No active time tracking session for this task");let s={...e};if(s.dateModified=Ue(),s.timeEntries&&Array.isArray(s.timeEntries)){let a=s.timeEntries.findIndex(o=>o.startTime===r.startTime&&!o.endTime);a!==-1&&(s.timeEntries=[...s.timeEntries],s.timeEntries[a]={...s.timeEntries[a],endTime:Ue()})}await this.plugin.app.fileManager.processFrontMatter(t,a=>{let o=this.plugin.fieldMapper.toUserField("timeEntries"),l=this.plugin.fieldMapper.toUserField("dateModified");if(a[o]&&Array.isArray(a[o])){let c=a[o].findIndex(d=>d.startTime===r.startTime&&!d.endTime);c!==-1&&(a[o][c].endTime=Ue())}a[l]=s.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(t,{timeEntries:s.timeEntries}),await this.plugin.cacheManager.updateTaskInfoInCache(e.path,s)}catch(a){console.error("Error updating cache for time tracking stop:",a)}if(this.plugin.emitter.trigger(dt,{path:e.path,originalTask:e,updatedTask:s}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("time.stopped",{task:s,session:(i=s.timeEntries)==null?void 0:i[s.timeEntries.length-1]})}catch(a){console.warn("Failed to trigger webhook for time tracking stop:",a)}return s}async updateTask(e,t){try{let r=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(r instanceof Xt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let s=this.plugin.settings.storeTitleInFilename&&t.title&&t.title!==e.title,i=e.path;if(s){let l=r.parent?r.parent.path:"",c=await Yu(t.title,l,this.plugin.app.vault);i=l?`${l}/${c}.md`:`${c}.md`}let a={};if(t.recurrence!==void 0&&t.recurrence!==e.recurrence){let l={...e,...t},c=Xd(l,this.plugin.settings.maintainDueDateOffsetInRecurring);if(c.scheduled&&(a.scheduled=c.scheduled),c.due&&(a.due=c.due),typeof t.recurrence=="string"&&t.recurrence&&!t.recurrence.includes("DTSTART:")){let d={...e,...t,...a},u=Jd(d);u&&(a.recurrence=u)}}else if(t.recurrence!==void 0&&!e.recurrence&&t.recurrence&&typeof t.recurrence=="string"&&!t.recurrence.includes("DTSTART:")){let l={...e,...t},c=Jd(l);c&&(a.recurrence=c)}if(t.scheduled!==void 0&&t.scheduled!==e.scheduled&&e.recurrence&&typeof e.recurrence=="string"&&!e.recurrence.includes("DTSTART:")){let l={...e,...t},c=Jd(l);c&&(a.recurrence=c)}await this.plugin.app.fileManager.processFrontMatter(r,l=>{let c={...e,...t,...a,dateModified:Ue()},d=this.plugin.fieldMapper.mapToFrontmatter(c,this.plugin.settings.taskTag,this.plugin.settings.storeTitleInFilename);Object.keys(d).forEach(u=>{d[u]!==void 0&&(l[u]=d[u])}),t.customFrontmatter&&Object.keys(t.customFrontmatter).forEach(u=>{let f=t.customFrontmatter[u];f===null?delete l[u]:l[u]=f}),t.hasOwnProperty("due")&&t.due===void 0&&delete l[this.plugin.fieldMapper.toUserField("due")],t.hasOwnProperty("scheduled")&&t.scheduled===void 0&&delete l[this.plugin.fieldMapper.toUserField("scheduled")],t.hasOwnProperty("contexts")&&t.contexts===void 0&&delete l[this.plugin.fieldMapper.toUserField("contexts")],t.hasOwnProperty("timeEstimate")&&t.timeEstimate===void 0&&delete l[this.plugin.fieldMapper.toUserField("timeEstimate")],t.hasOwnProperty("completedDate")&&t.completedDate===void 0&&delete l[this.plugin.fieldMapper.toUserField("completedDate")],t.hasOwnProperty("recurrence")&&t.recurrence===void 0&&delete l[this.plugin.fieldMapper.toUserField("recurrence")],s&&delete l[this.plugin.fieldMapper.toUserField("title")],t.hasOwnProperty("tags")?l.tags=t.tags:e.tags&&(l.tags=e.tags)}),s&&await this.plugin.app.fileManager.renameFile(r,i);let o={...e,...t,...a,path:i,dateModified:Ue()};t.status!==void 0&&!e.recurrence&&(this.plugin.statusManager.isCompletedStatus(t.status)?e.completedDate||(o.completedDate=nm()):o.completedDate=void 0),s&&this.plugin.cacheManager.clearCacheEntry(e.path);try{let l=this.plugin.app.vault.getAbstractFileByPath(i);if(l instanceof Xt.TFile&&this.plugin.cacheManager.waitForFreshTaskData){let c={};t.title!==void 0&&(c.title=t.title),t.status!==void 0&&(c.status=t.status),t.priority!==void 0&&(c.priority=t.priority),Object.keys(c).length>0&&await this.plugin.cacheManager.waitForFreshTaskData(l,c)}await this.plugin.cacheManager.updateTaskInfoInCache(i,o)}catch(l){console.error("Error updating task cache:",{error:l instanceof Error?l.message:String(l),taskPath:i})}try{this.plugin.emitter.trigger(dt,{path:i,originalTask:e,updatedTask:o})}catch(l){console.error("Error emitting task update event:",{error:l instanceof Error?l.message:String(l),taskPath:i})}if(this.webhookNotifier)try{let l=this.plugin.statusManager.isCompletedStatus(e.status),c=this.plugin.statusManager.isCompletedStatus(o.status);!l&&c?await this.webhookNotifier.triggerWebhook("task.completed",{task:o}):await this.webhookNotifier.triggerWebhook("task.updated",{task:o,previous:e})}catch(l){console.warn("Failed to trigger webhook for task update:",l)}if(this.autoArchiveService&&t.status!==void 0&&t.status!==e.status)try{let l=this.plugin.statusManager.getStatusConfig(o.status);l&&(l.autoArchive?await this.autoArchiveService.scheduleAutoArchive(o,l):await this.autoArchiveService.cancelAutoArchive(o.path))}catch(l){console.warn("Failed to handle auto-archive for status change:",l)}return o}catch(r){let s=r instanceof Error?r.message:String(r);throw console.error("Error updating task:",{error:s,stack:r instanceof Error?r.stack:void 0,taskPath:e.path,updates:t}),new Error(`Failed to update task: ${s}`)}}async deleteTask(e){try{let t=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(t instanceof Xt.TFile))throw new Error(`Cannot find task file: ${e.path}`);if(await this.plugin.app.vault.delete(t),this.plugin.cacheManager.clearCacheEntry(e.path),this.plugin.emitter.trigger(Rd,{path:e.path,deletedTask:e}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("task.deleted",{task:e})}catch(r){console.warn("Failed to trigger webhook for task deletion:",r)}}catch(t){let r=t instanceof Error?t.message:String(t);throw console.error("Error deleting task:",{error:r,stack:t instanceof Error?t.stack:void 0,taskPath:e.path}),new Error(`Failed to delete task: ${r}`)}}async toggleRecurringTaskComplete(e,t){let r=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(r instanceof Xt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let s=await this.plugin.cacheManager.getTaskInfo(e.path)||e;if(!s.recurrence)throw new Error("Task is not recurring");let i=t||(()=>{let f=Ge();return wt(f)})(),a=ue(i),o=Array.isArray(s.complete_instances)?s.complete_instances:[],c=!o.includes(a),d={...s};if(d.dateModified=Ue(),c?o.includes(a)||(d.complete_instances=[...o,a]):d.complete_instances=o.filter(f=>f!==a),c&&typeof d.recurrence=="string"&&!d.recurrence.includes("DTSTART:")){let f=Jd(d);f&&(d.recurrence=f)}let u=Xd(d,this.plugin.settings.maintainDueDateOffsetInRecurring);u.scheduled&&(d.scheduled=u.scheduled),u.due&&(d.due=u.due),await this.plugin.app.fileManager.processFrontMatter(r,f=>{let h=this.plugin.fieldMapper.toUserField("completeInstances"),p=this.plugin.fieldMapper.toUserField("dateModified"),m=this.plugin.fieldMapper.toUserField("scheduled"),g=this.plugin.fieldMapper.toUserField("due"),y=this.plugin.fieldMapper.toUserField("recurrence");f[h]||(f[h]=[]);let T=f[h];c?T.includes(a)||(f[h]=[...T,a]):f[h]=T.filter(w=>w!==a),d.recurrence!==s.recurrence&&(f[y]=d.recurrence),d.scheduled&&(f[m]=d.scheduled),d.due&&(f[g]=d.due),f[p]=d.dateModified});try{if(this.plugin.cacheManager.waitForFreshTaskData){let f={complete_instances:d.complete_instances};d.scheduled!==s.scheduled&&(f.scheduled=d.scheduled),d.due!==s.due&&(f.due=d.due),await this.plugin.cacheManager.waitForFreshTaskData(r,f)}await this.plugin.cacheManager.updateTaskInfoInCache(s.path,d)}catch(f){console.error("Error updating cache for recurring task:",f)}if(this.plugin.emitter.trigger(dt,{path:s.path,originalTask:s,updatedTask:d}),c&&this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("recurring.instance.completed",{task:d,date:a,targetDate:i})}catch(f){console.error("Error triggering recurring task completion webhook:",f)}return d}async deleteTimeEntry(e,t){let r=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(r instanceof Xt.TFile))throw new Error(`Cannot find task file: ${e.path}`);if(!e.timeEntries||!Array.isArray(e.timeEntries))throw new Error("Task has no time entries");if(t<0||t>=e.timeEntries.length)throw new Error("Invalid time entry index");let s={...e};s.dateModified=Ue(),s.timeEntries=e.timeEntries.filter((i,a)=>a!==t),await this.plugin.app.fileManager.processFrontMatter(r,i=>{let a=this.plugin.fieldMapper.toUserField("timeEntries"),o=this.plugin.fieldMapper.toUserField("dateModified");i[a]&&Array.isArray(i[a])&&(i[a]=i[a].filter((l,c)=>c!==t)),i[o]=s.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(r,{timeEntries:s.timeEntries}),await this.plugin.cacheManager.updateTaskInfoInCache(e.path,s)}catch(i){console.error("Error updating cache for time entry deletion:",i)}return this.plugin.emitter.trigger(dt,{path:e.path,originalTask:e,updatedTask:s}),s}};or();var $y=class{constructor(e){this.globalTaskVersionCache=new Map;this.lastGlobalRefreshTime=0;this.globalTaskCount=0;this.viewHandlers=new Map;this.viewDebounceTimers=new Map;this.viewPendingUpdates=new Map;this.viewConfigs=new Map;this.updateInProgress=new Set;this.eventListener=null;this.plugin=e,this.setupGlobalEventListener()}registerView(e,t){this.viewConfigs.set(e.viewId,{debounceDelay:100,maxBatchSize:5,changeDetectionEnabled:!0,...e}),this.viewHandlers.set(e.viewId,t),this.viewPendingUpdates.set(e.viewId,new Set)}unregisterView(e){let t=this.viewDebounceTimers.get(e);t&&(clearTimeout(t),this.viewDebounceTimers.delete(e)),this.viewConfigs.delete(e),this.viewHandlers.delete(e),this.viewPendingUpdates.delete(e),this.updateInProgress.delete(e)}setupGlobalEventListener(){this.eventListener=this.plugin.emitter.on(dt,async({path:e,originalTask:t,updatedTask:r})=>{if(!e||!r){await this.triggerFullRefreshForAllViews();return}r.path||(r.path=e),this.hasTaskChanged(r)&&await this.handleTaskUpdateForAllViews(r,t)})}async handleTaskUpdateForAllViews(e,t){let r=[];for(let[s,i]of this.viewHandlers)i.shouldRefreshForTask&&!i.shouldRefreshForTask(t,e)||r.push(this.scheduleViewUpdate(s,e.path));await Promise.all(r),Math.random()<.1&&await this.cleanupTaskVersionCache()}async scheduleViewUpdate(e,t){let r=this.viewConfigs.get(e);if(!r)return;let s=this.viewPendingUpdates.get(e);s&&s.add(t);let i=this.viewDebounceTimers.get(e);i&&clearTimeout(i);let a=window.setTimeout(async()=>{await this.processPendingUpdatesForView(e)},r.debounceDelay);this.viewDebounceTimers.set(e,a)}async processPendingUpdatesForView(e){if(this.updateInProgress.has(e))return;let t=this.viewConfigs.get(e),r=this.viewHandlers.get(e),s=this.viewPendingUpdates.get(e);if(!(!t||!r||!s||s.size===0)){this.updateInProgress.add(e);try{let i=Array.from(s);if(s.clear(),i.length>t.maxBatchSize)await r.refresh();else{let a=i.map(o=>r.updateForTask(o,"update").catch(l=>{console.error(`[ViewPerformanceService] Error updating task ${o} in ${e}:`,l)}));await Promise.all(a)}}catch(i){console.error(`[ViewPerformanceService] Error processing updates for ${e}:`,i),await r.refresh()}finally{this.updateInProgress.delete(e),this.viewDebounceTimers.delete(e)}}}async triggerFullRefreshForAllViews(){let e=[];for(let[t,r]of this.viewHandlers)this.updateInProgress.has(t)||e.push(r.refresh(!0));await Promise.all(e),this.lastGlobalRefreshTime=Date.now()}hasTaskChanged(e){let t=this.globalTaskVersionCache.get(e.path),r=e.dateModified||Date.now().toString();return t!==r?(this.globalTaskVersionCache.set(e.path,r),!0):!1}shouldDoFullRefresh(){let e=Date.now()-this.lastGlobalRefreshTime,t=this.globalTaskVersionCache.size;return e>600*1e3||Math.abs(t-this.globalTaskCount)>20||t===0}async cleanupTaskVersionCache(){try{let e=this.plugin.cacheManager.getAllTaskPaths(),t=new Set(e),r=0;for(let s of this.globalTaskVersionCache.keys())t.has(s)||(this.globalTaskVersionCache.delete(s),r++);this.globalTaskCount=t.size,this.globalTaskVersionCache.size>2e3&&(this.globalTaskVersionCache.clear(),this.lastGlobalRefreshTime=0)}catch(e){console.error("[ViewPerformanceService] Error during cache cleanup:",e)}}async forceRefreshAll(){this.globalTaskVersionCache.clear(),await this.triggerFullRefreshForAllViews()}getStats(){return{registeredViews:Array.from(this.viewConfigs.keys()),cacheSize:this.globalTaskVersionCache.size,activeUpdates:Array.from(this.updateInProgress),totalPendingUpdates:Array.from(this.viewPendingUpdates.values()).reduce((e,t)=>e+t.size,0),lastGlobalRefresh:new Date(this.lastGlobalRefreshTime).toISOString()}}destroy(){this.eventListener&&(this.plugin.emitter.offref(this.eventListener),this.eventListener=null);for(let e of this.viewDebounceTimers.values())clearTimeout(e);this.viewHandlers.clear(),this.viewDebounceTimers.clear(),this.viewPendingUpdates.clear(),this.viewConfigs.clear(),this.updateInProgress.clear(),this.globalTaskVersionCache.clear()}};var Yy=class{constructor(e){this.processorInterval=null;this.PROCESSOR_INTERVAL_MS=6e4;this.plugin=e}async start(){await this.processQueue(),this.processorInterval=setInterval(()=>{this.processQueue().catch(e=>{console.error("Error processing auto-archive queue:",e)})},this.PROCESSOR_INTERVAL_MS)}stop(){this.processorInterval&&(clearInterval(this.processorInterval),this.processorInterval=null)}async scheduleAutoArchive(e,t){if(!t.autoArchive)return;let r=Date.now(),s=r+t.autoArchiveDelay*60*1e3,i={taskPath:e.path,statusChangeTimestamp:r,archiveAfterTimestamp:s,statusValue:t.value};await this.cancelAutoArchive(e.path);let a=await this.getQueue();a.push(i),await this.saveQueue(a)}async cancelAutoArchive(e){let t=await this.getQueue(),r=t.filter(s=>s.taskPath!==e);r.length!==t.length&&await this.saveQueue(r)}async processQueue(){let e=await this.getQueue();if(e.length===0)return;let t=Date.now(),r=[],s=[];for(let o of e)t>=o.archiveAfterTimestamp?r.push(o):s.push(o);if(r.length===0)return;let i=[];for(let o of r)try{await this.processItem(o)||i.push(o)}catch(l){console.error(`Error processing auto-archive for ${o.taskPath}:`,l),i.push(o)}let a=[...i,...s];await this.saveQueue(a)}async processItem(e){let t=await this.plugin.cacheManager.getTaskByPath(e.taskPath);if(!t||t.status!==e.statusValue||t.archived)return!0;try{return await this.plugin.taskService.toggleArchive(t),!0}catch(r){return console.error(`Failed to archive task ${e.taskPath}:`,r),!1}}async getQueue(){let e=await this.plugin.loadData();return(e==null?void 0:e.autoArchiveQueue)||[]}async saveQueue(e){let t=await this.plugin.loadData()||{};t.autoArchiveQueue=e,await this.plugin.saveData(t)}async clearQueue(){await this.saveQueue([])}async getQueueStatus(){let e=await this.getQueue();return{count:e.length,items:e}}};var zy=class extends li{constructor(t,r){super();this.filterState={};this.viewPreferences={};this.savedViews=[];this.storageKey="tasknotes-view-filter-state";this.preferencesStorageKey="tasknotes-view-preferences";this.savedViewsStorageKey="tasknotes-saved-views";this.app=t,this.plugin=r,this.loadFromStorage(),this.loadPreferencesFromStorage(),this.savedViews=[...this.plugin.settings.savedViews]}async initializeSavedViews(){await this.migrateAndLoadSavedViews()}getFilterState(t){let r=this.filterState[t];if(r){if(typeof r!="object"||r.type!=="group"||!Array.isArray(r.children)||typeof r.conjunction!="string"){console.warn(`ViewStateManager: Ignoring old format filter state for ${t}, will use default`),delete this.filterState[t],this.saveToStorage();return}return Le.deepCloneFilterQuery(r)}}setFilterState(t,r){this.filterState[t]=Le.deepCloneFilterQuery(r),this.saveToStorage(),this.emit("filter-state-changed",{viewType:t,query:Le.deepCloneFilterQuery(r)})}clearFilterState(t){delete this.filterState[t],this.saveToStorage(),this.emit("filter-state-cleared",{viewType:t})}clearAllFilterStates(){this.filterState={},this.saveToStorage(),this.emit("all-filter-states-cleared")}getViewPreferences(t){return this.viewPreferences[t]}setViewPreferences(t,r){this.viewPreferences[t]={...r},this.savePreferencesToStorage(),this.emit("view-preferences-changed",{viewType:t,preferences:r})}clearViewPreferences(t){delete this.viewPreferences[t],this.savePreferencesToStorage(),this.emit("view-preferences-cleared",{viewType:t})}clearAllViewPreferences(){this.viewPreferences={},this.savePreferencesToStorage(),this.emit("all-view-preferences-cleared")}loadFromStorage(){try{let t=this.app.loadLocalStorage(this.storageKey);t&&typeof t=="string"&&(this.filterState=JSON.parse(t))}catch(t){console.warn("Failed to load view filter state from storage:",t),this.filterState={}}}saveToStorage(){try{this.app.saveLocalStorage(this.storageKey,JSON.stringify(this.filterState))}catch(t){console.warn("Failed to save view filter state to storage:",t)}}loadPreferencesFromStorage(){try{let t=this.app.loadLocalStorage(this.preferencesStorageKey);t&&typeof t=="string"&&(this.viewPreferences=JSON.parse(t))}catch(t){console.warn("Failed to load view preferences from storage:",t),this.viewPreferences={}}}savePreferencesToStorage(){try{this.app.saveLocalStorage(this.preferencesStorageKey,JSON.stringify(this.viewPreferences))}catch(t){console.warn("Failed to save view preferences to storage:",t)}}getAllFilterStates(){return{...this.filterState}}getSavedViews(){return this.savedViews.map(t=>({...t,query:Le.deepCloneFilterQuery(t.query),viewOptions:t.viewOptions?{...t.viewOptions}:void 0}))}saveView(t,r,s,i){let a={id:this.generateId(),name:t,query:Le.deepCloneFilterQuery(r),viewOptions:s?{...s}:void 0,visibleProperties:i?[...i]:void 0};return this.savedViews.push(a),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews()),a}updateView(t,r){let s=this.savedViews.findIndex(a=>a.id===t);if(s===-1)throw new Error(`Saved view with ID ${t} not found`);let i={...r};i.query&&(i.query=Le.deepCloneFilterQuery(i.query)),i.viewOptions&&(i.viewOptions={...i.viewOptions}),this.savedViews[s]={...this.savedViews[s],...i},this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}deleteView(t){let r=this.savedViews.findIndex(s=>s.id===t);if(r===-1)throw new Error(`Saved view with ID ${t} not found`);this.savedViews.splice(r,1),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}getSavedView(t){let r=this.savedViews.find(s=>s.id===t);if(r)return{...r,query:Le.deepCloneFilterQuery(r.query),viewOptions:r.viewOptions?{...r.viewOptions}:void 0,visibleProperties:r.visibleProperties?[...r.visibleProperties]:void 0}}clearAllSavedViews(){this.savedViews=[],this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}updateSavedViewProperties(t,r){let s=this.savedViews.find(i=>i.id===t);s&&(s.visibleProperties=r,this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews()))}getSavedViewProperties(t){let r=this.savedViews.find(s=>s.id===t);return r==null?void 0:r.visibleProperties}reorderSavedViews(t,r){if(t<0||t>=this.savedViews.length||r<0||r>this.savedViews.length||t===r)return;r=Math.min(r,this.savedViews.length-1);let[s]=this.savedViews.splice(t,1);this.savedViews.splice(r,0,s),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2,9)}async migrateAndLoadSavedViews(){try{this.savedViews=[...this.plugin.settings.savedViews];let t=this.app.loadLocalStorage(this.savedViewsStorageKey);if(t&&typeof t=="string"&&this.savedViews.length===0){console.log("TaskNotes: Migrating saved views from localStorage to plugin data...");let r=JSON.parse(t);this.savedViews=[...r],await this.saveSavedViewsToPluginData(),this.app.saveLocalStorage(this.savedViewsStorageKey,null),console.log(`TaskNotes: Successfully migrated ${r.length} saved views to plugin data.`)}}catch(t){console.warn("Failed to load/migrate saved views:",t),this.savedViews=[]}}async saveSavedViewsToPluginData(){try{this.plugin.settings.savedViews=[...this.savedViews],await this.plugin.saveSettings()}catch(t){console.warn("Failed to save saved views to plugin data:",t)}}needsMigration(){let r=!!this.app.loadLocalStorage(this.savedViewsStorageKey),s=this.plugin.settings.savedViews&&this.plugin.settings.savedViews.length>0;return r&&!s}async performMigration(){try{this.clearAllFilterStates(),await this.migrateAndLoadSavedViews(),this.emit("migration-complete")}catch(t){console.error("Error during ViewStateManager migration:",t),this.savedViews=[],await this.saveSavedViewsToPluginData()}}cleanup(){this.removeAllListeners()}};qy();NS();var LS=class{constructor(e){this.plugin=e}createPostProcessor(){return(e,t)=>{if(!this.plugin.settings.enableTaskLinkOverlay)return;let r=e.querySelectorAll("a");for(let s of Array.from(r)){let i=s,a=i.getAttribute("href");i.classList.contains("internal-link")?this.processLink(i,t.sourcePath,"internal"):a&&!a.startsWith("http://")&&!a.startsWith("https://")&&!a.includes("://")&&this.processLink(i,t.sourcePath,"external")}}}async processLink(e,t,r){try{let s=e.getAttribute("href");if(!s)return;let i=s;if(r==="internal"){if(s.startsWith("app://")){let l=new URL(s);i=decodeURIComponent(l.pathname),i.startsWith("/")&&(i=i.substring(1))}}else{if(s.startsWith("http://")||s.startsWith("https://")||s.includes("://"))return;i=s}let a=this.resolveLinkPath(i,t);if(!a)return;let o=this.getTaskInfo(a);if(!o)return;await this.replaceWithTaskWidget(e,o,i)}catch(s){console.debug("Error processing link in reading mode:",s)}}resolveLinkPath(e,t){try{let r=e.replace(/\.\./g,"").trim();if(!r)return null;let s=this.plugin.app.metadataCache.getFirstLinkpathDest(r,t);return(s==null?void 0:s.path)||null}catch(r){return console.debug("Error resolving link path:",e,r),null}}getTaskInfo(e){try{if(!e||typeof e!="string"||e.trim().length===0)return null;let t=this.plugin.cacheManager;if(!t||!t.getCachedTaskInfoSync)return null;let r=t.getCachedTaskInfoSync(e);return r&&typeof r=="object"&&r.title?r:null}catch(t){return console.debug("Error getting task info for:",e,t),null}}async replaceWithTaskWidget(e,t,r){var s;try{let i=e.textContent||`[[${r}]]`,a,o=e.textContent||"";o!==r&&o!==t.title&&(a=o);let l=new ld(t,this.plugin,i,a),c=this.createReadingModeWidget(l,t,i,a);(s=e.parentNode)==null||s.replaceChild(c,e)}catch(i){console.error("Error replacing wikilink with task widget:",i)}}createReadingModeWidget(e,t,r,s){let i={},a=e.toDOM(i);return a.classList.add("task-inline-preview--reading-mode"),a}};function UH(n){return new LS(n).createPostProcessor()}var cd=require("@codemirror/view");or();var fn=require("obsidian"),Qy=require("@codemirror/state");Fs();var FS=Qy.StateEffect.define(),HS=class extends cd.WidgetType{constructor(t,r,s,i=0){super();this.plugin=t;this.tasks=r;this.notePath=s;this.version=i;this.groupedTasks=new Map;this.filterBar=null;this.filterHeading=null;this.savedViewsUnsubscribe=null;this.taskListContainer=null;this.editorView=null;this.viewType=`${vT}:${s}`,this.groupedTasks.set("all",[...r]),this.filterService=new Va(t.cacheManager,t.statusManager,t.priorityManager,t);let a=this.plugin.viewStateManager.getFilterState(this.viewType);this.currentQuery=a||{type:"group",id:"root",conjunction:"and",children:[],sortKey:"priority",sortDirection:"desc",groupKey:"none"}}eq(t){let r=this.tasks.length===t.tasks.length&&this.tasks.every((s,i)=>{let a=t.tasks[i];return s.title===a.title&&s.status===a.status&&s.priority===a.priority&&s.due===a.due&&s.scheduled===a.scheduled&&s.path===a.path&&JSON.stringify(s.contexts||[])===JSON.stringify(a.contexts||[])&&JSON.stringify(s.projects||[])===JSON.stringify(a.projects||[])&&JSON.stringify(s.tags||[])===JSON.stringify(a.tags||[])&&s.timeEstimate===a.timeEstimate&&s.recurrence===a.recurrence&&JSON.stringify(s.complete_instances||[])===JSON.stringify(a.complete_instances||[])});return r&&this!==t&&this.notePath===t.notePath&&(t.currentQuery=this.currentQuery),this.version===t.version&&r}destroy(){this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.filterHeading&&(this.filterHeading.destroy(),this.filterHeading=null),this.savedViewsUnsubscribe&&(this.savedViewsUnsubscribe(),this.savedViewsUnsubscribe=null)}toDOM(t){this.editorView=t;let r=document.createElement("div");r.className="tasknotes-plugin project-note-subtasks project-subtasks-widget",r.setAttribute("contenteditable","false"),r.setAttribute("spellcheck","false"),r.setAttribute("data-widget-type","project-subtasks");let s=r.createEl("div",{cls:"project-note-subtasks__header"}),i=s.createEl("h3",{cls:"project-note-subtasks__title"});i.createSpan({text:"Subtasks"}),s.createEl("button",{text:"New",cls:"project-note-subtasks__new-btn"}).addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.createNewSubtask()});let o=r.createEl("div",{cls:"project-note-subtasks__content"});this.getCollapsedState()&&(i.classList.add("collapsed"),o.classList.add("collapsed")),i.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),i.classList.contains("collapsed")?(i.classList.remove("collapsed"),o.classList.remove("collapsed"),this.setCollapsedState(!1)):(i.classList.add("collapsed"),o.classList.add("collapsed"),this.setCollapsedState(!0))});let c=o.createEl("div",{cls:"project-note-subtasks__filter"});return this.taskListContainer=o.createEl("div",{cls:"project-note-subtasks__list"}),this.initializeFilterBar(c).then(()=>{this.taskListContainer&&this.applyFiltersAndRender(this.taskListContainer)}),this.renderTaskGroups(this.taskListContainer),r}async initializeFilterBar(t){try{let r=await this.filterService.getFilterOptions();this.filterBar=new hn(this.plugin.app,this.plugin,t,this.currentQuery,r,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"subtask-widget"});let s=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(s),this.filterBar.on("queryChange",a=>{this.currentQuery=a,this.plugin.viewStateManager.setFilterState(this.viewType,a);let o=t.querySelector(".filter-heading__controls");o&&this.createExpandCollapseButtons(o),this.taskListContainer&&this.applyFiltersAndRender(this.taskListContainer)}),this.filterBar.on("activeSavedViewChanged",()=>{this.editorView&&yp(this.editorView)}),this.filterBar.on("saveView",a=>{let o=this.plugin.viewStateManager.saveView(a.name,a.query,a.viewOptions,a.visibleProperties);this.filterBar.setActiveSavedView(o)}),this.filterBar.on("deleteView",a=>{this.plugin.viewStateManager.deleteView(a)}),this.filterBar.on("reorderViews",(a,o)=>{this.plugin.viewStateManager.reorderSavedViews(a,o)}),this.savedViewsUnsubscribe=this.plugin.viewStateManager.on("saved-views-changed",a=>{this.filterBar&&this.filterBar.updateSavedViews(a)}),this.filterBar.on("expandAllGroups",()=>{let a=this.currentQuery.groupKey||"none";br.expandAllGroups(this.viewType,a,this.plugin),this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(o=>{o.classList.remove("is-collapsed");let l=o.querySelector(".task-cards");l&&(l.style.display="")})}),this.filterBar.on("collapseAllGroups",()=>{let a=this.currentQuery.groupKey||"none",o=[];this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(l=>{let c=l.dataset.group;if(c){o.push(c),l.classList.add("is-collapsed");let d=l.querySelector(".task-cards");d&&(d.style.display="none")}}),br.collapseAllGroups(this.viewType,a,o,this.plugin)}),this.filterHeading=new Wa(t);let i=t.querySelector(".filter-heading");if(i){let a=i.querySelector(".filter-heading__content");if(a){let o=a.createDiv({cls:"filter-heading__controls"});this.createExpandCollapseButtons(o)}}this.updateFilterHeading()}catch(r){console.error("Error initializing filter bar for subtasks:",r)}}createExpandCollapseButtons(t){if(!((this.currentQuery.groupKey||"none")!=="none")){t.style.display="none";return}t.style.display="flex",t.empty(),new fn.ButtonComponent(t).setIcon("list-tree").setTooltip("Expand All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none";this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(o=>{o.classList.remove("is-collapsed");let l=o.querySelector(".task-cards");l&&(l.style.display="")}),br.expandAllGroups(this.viewType,a,this.plugin)}).buttonEl.addClass("clickable-icon"),new fn.ButtonComponent(t).setIcon("list-collapse").setTooltip("Collapse All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none",o=[];this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(l=>{let c=l.dataset.group;if(c){o.push(c),l.classList.add("is-collapsed");let d=l.querySelector(".task-cards");d&&(d.style.display="none")}}),br.collapseAllGroups(this.viewType,a,o,this.plugin)}).buttonEl.addClass("clickable-icon")}updateFilterHeading(){if(!(!this.filterHeading||!this.filterBar))try{let t=Array.from(this.groupedTasks.values()).flat(),r=Mt.calculateGroupStats(t,this.plugin),s=this.filterBar.activeSavedView||null;this.filterHeading.update(s,r.completed,r.total)}catch(t){console.error("Error updating filter heading in ProjectSubtasksWidget:",t)}}async applyFiltersAndRender(t){try{let r=await this.filterService.getGroupedTasks(this.currentQuery),s=new Set(this.tasks.map(i=>i.path));this.groupedTasks.clear();for(let[i,a]of r){let o=a.filter(l=>s.has(l.path));o.length>0&&this.groupedTasks.set(i,o)}t&&this.renderTaskGroups(t),this.updateFilterHeading()}catch(r){console.error("Error applying filters to subtasks:",r),this.groupedTasks.clear(),this.groupedTasks.set("all",[...this.tasks]),this.updateFilterHeading()}}renderTaskGroups(t){var s,i;if(t.empty(),this.currentQuery.groupKey==="none"||this.groupedTasks.size<=1)(this.groupedTasks.size===1?Array.from(this.groupedTasks.values())[0]:this.groupedTasks.get("all")||[]).forEach(o=>{let l=fr(o,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});l.classList.add("project-note-subtasks__task"),t.appendChild(l)});else for(let[a,o]of this.groupedTasks.entries()){if(o.length===0)continue;let l=t.createEl("div",{cls:"project-note-subtasks__group-section task-group"});l.setAttribute("data-group",a);let c=this.currentQuery.groupKey||"none",d=br.isGroupCollapsed(this.viewType,c,a,this.plugin),u=l.createEl("div",{cls:"project-note-subtasks__group-header task-group-header"}),f=u.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle group"}});try{(0,fn.setIcon)(f,"chevron-right")}catch(y){}let h=f.querySelector("svg");h?(h.classList.add("chevron"),h.setAttr("width","16"),h.setAttr("height","16")):(f.textContent="\u25B8",f.addClass("chevron-text"));let p=u.createEl("h4",{cls:"project-note-subtasks__group-title"});p.createSpan({text:this.getGroupDisplayName(a)});let m=Mt.calculateGroupStats(o,this.plugin);p.createSpan({text:` ${Mt.formatGroupCount(m.completed,m.total).text}`,cls:"agenda-view__item-count"});let g=l.createEl("div",{cls:"project-note-subtasks__group task-cards"});d&&(l.classList.add("is-collapsed"),g.style.display="none"),u.addEventListener("click",y=>{if(y.target.closest("a"))return;let w=!l.classList.contains("is-collapsed");br.setGroupCollapsed(this.viewType,c,a,w,this.plugin),l.classList.toggle("is-collapsed",w),g.style.display=w?"none":"",f.setAttribute("aria-expanded",String(!w))}),f.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation();let T=!l.classList.contains("is-collapsed");br.setGroupCollapsed(this.viewType,c,a,T,this.plugin),l.classList.toggle("is-collapsed",T),g.style.display=T?"none":"",f.setAttribute("aria-expanded",String(!T))}),f.setAttribute("aria-expanded",String(!d)),o.forEach(y=>{let T=fr(y,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});T.classList.add("project-note-subtasks__task"),g.appendChild(T)})}let r=(i=(s=t.parentElement)==null?void 0:s.parentElement)==null?void 0:i.querySelector(".project-note-subtasks__title");if(r){r.empty(),r.createSpan({text:"Subtasks "});let a=Array.from(this.groupedTasks.values()).flat(),o=Mt.calculateGroupStats(a,this.plugin);r.createSpan({text:Mt.formatGroupCount(o.completed,o.total).text,cls:"agenda-view__item-count"})}}getGroupDisplayName(t){return br.formatGroupName(t,this.plugin)}createNewSubtask(){let t=this.plugin.app.workspace.getActiveFile();if(!t)return;let r=`[[${t.basename}]]`;this.plugin.openTaskCreationModal({projects:[r]})}getCollapsedState(){try{return localStorage.getItem("tasknotes-project-subtasks-collapsed")==="true"}catch(t){return!1}}setCollapsedState(t){try{t?localStorage.setItem("tasknotes-project-subtasks-collapsed","true"):localStorage.removeItem("tasknotes-project-subtasks-collapsed")}catch(r){}}},BS=class{constructor(e,t){this.plugin=t;this.cachedTasks=[];this.currentFile=null;this.eventListeners=[];this.version=0;this.view=e,this.projectService=t.projectSubtasksService,this.decorations=this.buildDecorations(e),this.setupEventListeners(),this.loadTasksForCurrentFile(e)}update(e){this.view=e.view;let t=e.transactions.some(s=>s.effects.some(i=>i.is(FS)));(e.docChanged||e.viewportChanged||t)&&(t&&this.version++,this.decorations=this.buildDecorations(e.view));let r=this.getFileFromView(e.view);r!==this.currentFile&&(this.currentFile=r,this.loadTasksForCurrentFile(e.view))}destroy(){this.eventListeners.forEach(e=>{this.plugin.emitter.offref(e)}),this.eventListeners=[]}setupEventListeners(){let e=this.plugin.emitter.on(ar,()=>{this.loadTasksForCurrentFile(this.view)}),t=this.plugin.emitter.on(dt,()=>{this.loadTasksForCurrentFile(this.view)}),r=this.plugin.emitter.on(Rd,()=>{this.loadTasksForCurrentFile(this.view)}),s=this.plugin.emitter.on($s,()=>{this.loadTasksForCurrentFile(this.view)}),i=this.plugin.emitter.on("settings-changed",()=>{this.loadTasksForCurrentFile(this.view)}),a=this.plugin.emitter.on("file-updated",c=>{this.loadTasksForCurrentFile(this.view)}),o=this.plugin.emitter.on("file-deleted",c=>{this.loadTasksForCurrentFile(this.view)}),l=this.plugin.emitter.on("file-renamed",c=>{this.loadTasksForCurrentFile(this.view)});this.eventListeners.push(e,t,r,s,i,a,o,l)}dispatchUpdate(){if(this.version++,this.view&&typeof this.view.dispatch=="function")try{this.view.dispatch({effects:[FS.of({forceUpdate:!0})]})}catch(e){console.error("Error dispatching project subtasks update:",e)}}async loadTasksForCurrentFile(e){let t=this.getFileFromView(e);if(t instanceof fn.TFile)try{let r=await this.projectService.getTasksLinkedToProject(t);(r.length!==this.cachedTasks.length||r.some((i,a)=>{let o=this.cachedTasks[a];return!o||i.title!==o.title||i.status!==o.status||i.priority!==o.priority||i.due!==o.due||i.path!==o.path}))&&(this.cachedTasks=r,this.dispatchUpdate())}catch(r){console.error("Error loading tasks for project note:",r)}else this.cachedTasks.length>0&&(this.cachedTasks=[],this.dispatchUpdate())}getFileFromView(e){let t=e.state.field(fn.editorInfoField,!1);return(t==null?void 0:t.file)||null}isTableCellEditor(e){try{let t=e.dom;if(t.closest("td, th")||t.closest(".cm-table-widget"))return!0;let i=e.state.field(fn.editorInfoField,!1);if(!(i!=null&&i.file)){let a=t.parentElement;for(;a&&a!==document.body;){if(a.tagName==="TABLE"||a.tagName==="TD"||a.tagName==="TH"||a.classList.contains("markdown-rendered"))return!0;a=a.parentElement}}return!1}catch(t){return console.debug("Error detecting table cell editor:",t),!1}}buildDecorations(e){var r;let t=new Qy.RangeSetBuilder;try{if(this.isTableCellEditor(e)||!this.plugin.settings.showProjectSubtasks||!e.state.field(fn.editorLivePreviewField)||this.cachedTasks.length===0)return t.finish();let s=e.state.doc;if(s.length===0)return t.finish();let i=this.findInsertionPosition(e,s);(i<0||i>s.length)&&(i=0);let a=(r=this.currentFile)==null?void 0:r.path;if(!a){let l=this.getFileFromView(e);a=l==null?void 0:l.path}if(!a)return console.warn("ProjectNoteDecorations: Cannot create widget without file context"),t.finish();let o=cd.Decoration.widget({widget:new HS(this.plugin,this.cachedTasks,a,this.version),side:1});t.add(i,i,o)}catch(s){console.error("Error building project note decorations:",s)}return t.finish()}findInsertionPosition(e,t){if(t.lines===0)return 0;if((this.plugin.settings.projectSubtasksPosition||"bottom")==="top"){let s=t.toString(),a=/^---\n[\s\S]*?\n---\n/.exec(s);return a?a[0].length:0}else return t.length}},a4={decorations:n=>n.decorations};function jH(n){return cd.ViewPlugin.fromClass(class extends BS{constructor(e){super(e,n)}destroy(){super.destroy()}},a4)}function yp(n){if(!n||typeof n.dispatch!="function"){console.warn("Invalid EditorView passed to dispatchProjectSubtasksUpdate:",n);return}try{n.dispatch({effects:[FS.of({forceUpdate:!0})]})}catch(e){console.error("Error dispatching project subtasks update:",e)}}var Ky=class{constructor(e){this.draggableInstances=new Map;this.plugin=e}makeTaskCardDraggable(e,t){if(this.draggableInstances.has(e))return;e.dataset.taskPath=t;let r=new Pg(e);this.draggableInstances.set(e,r),e.style.cursor="grab",e.addEventListener("dragstart",s=>{e.classList.add("task-card--dragging"),s.dataTransfer&&(s.dataTransfer.setData("text/plain",t),s.dataTransfer.setData("application/x-task-path",t),s.dataTransfer.effectAllowed="copy")}),e.addEventListener("dragend",()=>{e.classList.remove("task-card--dragging")})}removeDraggable(e){let t=this.draggableInstances.get(e);t&&(t.destroy(),this.draggableInstances.delete(e))}destroy(){this.draggableInstances.forEach(e=>{e.destroy()}),this.draggableInstances.clear()}};Ne();var Xi=require("obsidian");var sv=class n{constructor(e){R(this,"icaltype","binary");this.value=e}static fromString(e){return new n(e)}decodeValue(){return this._b64_decode(this.value)}setEncodedValue(e){this.value=this._b64_encode(e)}_b64_encode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,s,i,a,o,l,c,d,u=0,f=0,h="",p=[];if(!e)return e;do r=e.charCodeAt(u++),s=e.charCodeAt(u++),i=e.charCodeAt(u++),d=r<<16|s<<8|i,a=d>>18&63,o=d>>12&63,l=d>>6&63,c=d&63,p[f++]=t.charAt(a)+t.charAt(o)+t.charAt(l)+t.charAt(c);while(u<e.length);h=p.join("");let m=e.length%3;return(m?h.slice(0,m-3):h)+"===".slice(m||3)}_b64_decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,s,i,a,o,l,c,d,u=0,f=0,h="",p=[];if(!e)return e;e+="";do a=t.indexOf(e.charAt(u++)),o=t.indexOf(e.charAt(u++)),l=t.indexOf(e.charAt(u++)),c=t.indexOf(e.charAt(u++)),d=a<<18|o<<12|l<<6|c,r=d>>16&255,s=d>>8&255,i=d&255,l==64?p[f++]=String.fromCharCode(r):c==64?p[f++]=String.fromCharCode(r,s):p[f++]=String.fromCharCode(r,s,i);while(u<e.length);return h=p.join(""),h}toString(){return this.value}},o4=/([PDWHMTS]{1,1})/,l4=["weeks","days","hours","minutes","seconds","isNegative"],js=class n{constructor(e){R(this,"weeks",0);R(this,"days",0);R(this,"hours",0);R(this,"minutes",0);R(this,"seconds",0);R(this,"isNegative",!1);R(this,"icalclass","icalduration");R(this,"icaltype","duration");this.wrappedJSObject=this,this.fromData(e)}static fromSeconds(e){return new n().fromSeconds(e)}static isValueString(e){return e[0]==="P"||e[1]==="P"}static fromString(e){let t=0,r=Object.create(null),s=0;for(;(t=e.search(o4))!==-1;){let i=e[t],a=e.slice(0,Math.max(0,t));e=e.slice(t+1),s+=c4(i,a,r)}if(s<2)throw new Error('invalid duration value: Not enough duration components in "'+e+'"');return new n(r)}static fromData(e){return new n(e)}clone(){return n.fromData(this)}toSeconds(){let e=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-e:e}fromSeconds(e){let t=Math.abs(e);return this.isNegative=e<0,this.days=mr(t/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,t-=(this.days+7*this.weeks)*86400,this.hours=mr(t/3600),t-=this.hours*3600,this.minutes=mr(t/60),t-=this.minutes*60,this.seconds=t,this}fromData(e){for(let t of l4)e&&t in e?this[t]=e[t]:this[t]=0}reset(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0}compare(e){let t=this.toSeconds(),r=e.toSeconds();return(t>r)-(t<r)}normalize(){this.fromSeconds(this.toSeconds())}toString(){if(this.toSeconds()==0)return"PT0S";{let e="";this.isNegative&&(e+="-"),e+="P";let t=!1;return this.weeks?this.days||this.hours||this.minutes||this.seconds?e+=this.weeks*7+this.days+"D":(e+=this.weeks+"W",t=!0):this.days&&(e+=this.days+"D"),t||(this.hours||this.minutes||this.seconds)&&(e+="T",this.hours&&(e+=this.hours+"H"),this.minutes&&(e+=this.minutes+"M"),this.seconds&&(e+=this.seconds+"S")),e}}toICALString(){return this.toString()}};function c4(n,e,t){let r;switch(n){case"P":e&&e==="-"?t.isNegative=!0:t.isNegative=!1;break;case"D":r="days";break;case"W":r="weeks";break;case"H":r="hours";break;case"M":r="minutes";break;case"S":r="seconds";break;default:return 0}if(r){if(!e&&e!==0)throw new Error('invalid duration value: Missing number before "'+n+'"');let s=parseInt(e,10);if(wp(s))throw new Error('invalid duration value: Invalid number "'+e+'" before "'+n+'"');t[r]=s}return 1}var Tp=class n{constructor(e){R(this,"start",null);R(this,"end",null);R(this,"duration",null);R(this,"icalclass","icalperiod");R(this,"icaltype","period");if(this.wrappedJSObject=this,e&&"start"in e){if(e.start&&!(e.start instanceof ce))throw new TypeError(".start must be an instance of ICAL.Time");this.start=e.start}if(e&&e.end&&e.duration)throw new Error("cannot accept both end and duration");if(e&&"end"in e){if(e.end&&!(e.end instanceof ce))throw new TypeError(".end must be an instance of ICAL.Time");this.end=e.end}if(e&&"duration"in e){if(e.duration&&!(e.duration instanceof js))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=e.duration}}static fromString(e,t){let r=e.split("/");if(r.length!==2)throw new Error('Invalid string value: "'+e+'" must contain a "/" char.');let s={start:ce.fromDateTimeString(r[0],t)},i=r[1];return js.isValueString(i)?s.duration=js.fromString(i):s.end=ce.fromDateTimeString(i,t),new n(s)}static fromData(e){return new n(e)}static fromJSON(e,t,r){function s(i,a){return r?ce.fromString(i,a):ce.fromDateTimeString(i,a)}return js.isValueString(e[1])?n.fromData({start:s(e[0],t),duration:js.fromString(e[1])}):n.fromData({start:s(e[0],t),end:s(e[1],t)})}clone(){return n.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})}getDuration(){return this.duration?this.duration:this.end.subtractDate(this.start)}getEnd(){if(this.end)return this.end;{let e=this.start.clone();return e.addDuration(this.duration),e}}compare(e){return e.compare(this.start)<0?1:e.compare(this.getEnd())>0?-1:0}toString(){return this.start+"/"+(this.end||this.duration)}toJSON(){return[this.start.toString(),(this.end||this.duration).toString()]}toICALString(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}},ud,te=class te{constructor(e,t){R(this,"icalclass","icaltime");R(this,"_cachedUnixTime",null);R(this,"zone",null);R(this,"_pendingNormalization",!1);this.wrappedJSObject=this,this._time=Object.create(null),this._time.year=0,this._time.month=1,this._time.day=1,this._time.hour=0,this._time.minute=0,this._time.second=0,this._time.isDate=!1,this.fromData(e,t)}static daysInMonth(e,t){let r=[0,31,28,31,30,31,30,31,31,30,31,30,31],s=30;return e<1||e>12||(s=r[e],e==2&&(s+=te.isLeapYear(t))),s}static isLeapYear(e){return e<=1752?e%4==0:e%4==0&&e%100!=0||e%400==0}static fromDayOfYear(e,t){let r=t,s=e,i=new te;i.auto_normalize=!1;let a=te.isLeapYear(r)?1:0;if(s<1)return r--,a=te.isLeapYear(r)?1:0,s+=te.daysInYearPassedMonth[a][12],te.fromDayOfYear(s,r);if(s>te.daysInYearPassedMonth[a][12])return a=te.isLeapYear(r)?1:0,s-=te.daysInYearPassedMonth[a][12],r++,te.fromDayOfYear(s,r);i.year=r,i.isDate=!0;for(let o=11;o>=0;o--)if(s>te.daysInYearPassedMonth[a][o]){i.month=o+1,i.day=s-te.daysInYearPassedMonth[a][o];break}return i.auto_normalize=!0,i}static fromStringv2(e){return new te({year:parseInt(e.slice(0,4),10),month:parseInt(e.slice(5,7),10),day:parseInt(e.slice(8,10),10),isDate:!0})}static fromDateString(e){return new te({year:Hr(e.slice(0,4)),month:Hr(e.slice(5,7)),day:Hr(e.slice(8,10)),isDate:!0})}static fromDateTimeString(e,t){if(e.length<19)throw new Error('invalid date-time value: "'+e+'"');let r,s;e.slice(-1)==="Z"?r=ot.utcTimezone:t&&(s=t.getParameter("tzid"),t.parent&&(t.parent.name==="standard"||t.parent.name==="daylight"?r=ot.localTimezone:s&&(r=t.parent.getTimeZoneByID(s))));let i={year:Hr(e.slice(0,4)),month:Hr(e.slice(5,7)),day:Hr(e.slice(8,10)),hour:Hr(e.slice(11,13)),minute:Hr(e.slice(14,16)),second:Hr(e.slice(17,19))};return s&&!r&&(i.timezone=s),new te(i,r)}static fromString(e,t){return e.length>10?te.fromDateTimeString(e,t):te.fromDateString(e)}static fromJSDate(e,t){return new te().fromJSDate(e,t)}static now(){return te.fromJSDate(new Date,!1)}static weekOneStarts(e,t){let r=te.fromData({year:e,month:1,day:1,isDate:!0}),s=r.dayOfWeek(),i=t||te.DEFAULT_WEEK_START;return s>te.THURSDAY&&(r.day+=7),i>te.THURSDAY&&(r.day-=7),r.day-=s-i,r}static getDominicalLetter(e){let t="GFEDCBA",r=(e+(e/4|0)+(e/400|0)-(e/100|0)-1)%7;return te.isLeapYear(e)?t[(r+6)%7]+t[r]:t[r]}static get epochTime(){return Ja(this,ud)||Ip(this,ud,te.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"})),Ja(this,ud)}static _cmp_attr(e,t,r){return e[r]>t[r]?1:e[r]<t[r]?-1:0}get icaltype(){return this.isDate?"date":"date-time"}get year(){return this._getTimeAttr("year")}set year(e){this._setTimeAttr("year",e)}get month(){return this._getTimeAttr("month")}set month(e){this._setTimeAttr("month",e)}get day(){return this._getTimeAttr("day")}set day(e){this._setTimeAttr("day",e)}get hour(){return this._getTimeAttr("hour")}set hour(e){this._setTimeAttr("hour",e)}get minute(){return this._getTimeAttr("minute")}set minute(e){this._setTimeAttr("minute",e)}get second(){return this._getTimeAttr("second")}set second(e){this._setTimeAttr("second",e)}get isDate(){return this._getTimeAttr("isDate")}set isDate(e){this._setTimeAttr("isDate",e)}_getTimeAttr(e){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[e]}_setTimeAttr(e,t){e==="isDate"&&t&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[e]=t}clone(){return new te(this._time,this.zone)}reset(){this.fromData(te.epochTime),this.zone=ot.utcTimezone}resetTo(e,t,r,s,i,a,o){this.fromData({year:e,month:t,day:r,hour:s,minute:i,second:a,zone:o})}fromJSDate(e,t){return e?t?(this.zone=ot.utcTimezone,this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()):(this.zone=ot.localTimezone,this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.hour=e.getHours(),this.minute=e.getMinutes(),this.second=e.getSeconds()):this.reset(),this._cachedUnixTime=null,this}fromData(e,t){if(e)for(let[r,s]of Object.entries(e))r!=="icaltype"&&(this[r]=s);if(t&&(this.zone=t),e&&!("isDate"in e)?this.isDate=!("hour"in e):e&&"isDate"in e&&(this.isDate=e.isDate),e&&"timezone"in e){let r=iv.get(e.timezone);this.zone=r||ot.localTimezone}return e&&"zone"in e&&(this.zone=e.zone),this.zone||(this.zone=ot.localTimezone),this._cachedUnixTime=null,this}dayOfWeek(e){let t=e||te.SUNDAY,r=(this.year<<12)+(this.month<<8)+(this.day<<3)+t;if(r in te._dowCache)return te._dowCache[r];let s=this.day,i=this.month+(this.month<3?12:0),a=this.year-(this.month<3?1:0),o=s+a+mr((i+1)*26/10)+mr(a/4);return o+=mr(a/100)*6+mr(a/400),o=(o+7-t)%7+1,te._dowCache[r]=o,o}dayOfYear(){let e=te.isLeapYear(this.year)?1:0;return te.daysInYearPassedMonth[e][this.month-1]+this.day}startOfWeek(e){let t=e||te.SUNDAY,r=this.clone();return r.day-=(this.dayOfWeek()+7-t)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}endOfWeek(e){let t=e||te.SUNDAY,r=this.clone();return r.day+=(7-this.dayOfWeek()+t-te.SUNDAY)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}startOfMonth(){let e=this.clone();return e.day=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}endOfMonth(){let e=this.clone();return e.day=te.daysInMonth(e.month,e.year),e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}startOfYear(){let e=this.clone();return e.day=1,e.month=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}endOfYear(){let e=this.clone();return e.day=31,e.month=12,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}startDoyWeek(e){let t=e||te.SUNDAY,r=this.dayOfWeek()-t;return r<0&&(r+=7),this.dayOfYear()-r}getDominicalLetter(){return te.getDominicalLetter(this.year)}nthWeekDay(e,t){let r=te.daysInMonth(this.month,this.year),s,i=t,a=0,o=this.clone();if(i>=0){o.day=1,i!=0&&i--,a=o.day;let l=o.dayOfWeek(),c=e-l;c<0&&(c+=7),a+=c,a-=e,s=e}else{o.day=r;let l=o.dayOfWeek();i++,s=l-e,s<0&&(s+=7),s=r-s}return s+=i*7,a+s}isNthWeekDay(e,t){let r=this.dayOfWeek();return t===0&&r===e||this.nthWeekDay(e,t)===this.day}weekNumber(e){let t=(this.year<<12)+(this.month<<8)+(this.day<<3)+e;if(t in te._wnCache)return te._wnCache[t];let r,s=this.clone();s.isDate=!0;let i=this.year;s.month==12&&s.day>25?(r=te.weekOneStarts(i+1,e),s.compare(r)<0?r=te.weekOneStarts(i,e):i++):(r=te.weekOneStarts(i,e),s.compare(r)<0&&(r=te.weekOneStarts(--i,e)));let a=s.subtractDate(r).toSeconds()/86400,o=mr(a/7)+1;return te._wnCache[t]=o,o}addDuration(e){let t=e.isNegative?-1:1,r=this.second,s=this.minute,i=this.hour,a=this.day;r+=t*e.seconds,s+=t*e.minutes,i+=t*e.hours,a+=t*e.days,a+=t*7*e.weeks,this.second=r,this.minute=s,this.hour=i,this.day=a,this._cachedUnixTime=null}subtractDate(e){let t=this.toUnixTime()+this.utcOffset(),r=e.toUnixTime()+e.utcOffset();return js.fromSeconds(t-r)}subtractDateTz(e){let t=this.toUnixTime(),r=e.toUnixTime();return js.fromSeconds(t-r)}compare(e){if(e instanceof Tp)return-1*e.compare(this);{let t=this.toUnixTime(),r=e.toUnixTime();return t>r?1:r>t?-1:0}}compareDateOnlyTz(e,t){let r=this.convertToZone(t),s=e.convertToZone(t),i=0;return(i=te._cmp_attr(r,s,"year"))!=0||(i=te._cmp_attr(r,s,"month"))!=0||(i=te._cmp_attr(r,s,"day"))!=0,i}convertToZone(e){let t=this.clone(),r=this.zone.tzid==e.tzid;return!this.isDate&&!r&&ot.convert_time(t,this.zone,e),t.zone=e,t}utcOffset(){return this.zone==ot.localTimezone||this.zone==ot.utcTimezone?0:this.zone.utcOffset(this)}toICALString(){let e=this.toString();return e.length>10?lt.icalendar.value["date-time"].toICAL(e):lt.icalendar.value.date.toICAL(e)}toString(){let e=this.year+"-"+ms(this.month)+"-"+ms(this.day);return this.isDate||(e+="T"+ms(this.hour)+":"+ms(this.minute)+":"+ms(this.second),this.zone===ot.utcTimezone&&(e+="Z")),e}toJSDate(){return this.zone==ot.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(this.toUnixTime()*1e3)}_normalize(){return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this}adjust(e,t,r,s,i){let a,o,l=0,c=0,d,u,f,h,p,m=i||this._time;if(m.isDate||(d=m.second+s,m.second=d%60,a=mr(d/60),m.second<0&&(m.second+=60,a--),u=m.minute+r+a,m.minute=u%60,o=mr(u/60),m.minute<0&&(m.minute+=60,o--),f=m.hour+t+o,m.hour=f%24,l=mr(f/24),m.hour<0&&(m.hour+=24,l--)),m.month>12?c=mr((m.month-1)/12):m.month<1&&(c=mr(m.month/12)-1),m.year+=c,m.month-=12*c,h=m.day+e+l,h>0)for(;p=te.daysInMonth(m.month,m.year),!(h<=p);)m.month++,m.month>12&&(m.year++,m.month=1),h-=p;else for(;h<=0;)m.month==1?(m.year--,m.month=12):m.month--,h+=te.daysInMonth(m.month,m.year);return m.day=h,this._cachedUnixTime=null,this}fromUnixTime(e){this.zone=ot.utcTimezone;let t=new Date(e*1e3);this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this._time.isDate?(this.hour=0,this.minute=0,this.second=0):(this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds()),this._cachedUnixTime=null}toUnixTime(){if(this._cachedUnixTime!==null)return this._cachedUnixTime;let e=this.utcOffset(),t=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-e);return this._cachedUnixTime=t/1e3,this._cachedUnixTime}toJSON(){let e=["year","month","day","hour","minute","second","isDate"],t=Object.create(null),r=0,s=e.length,i;for(;r<s;r++)i=e[r],t[i]=this[i];return this.zone&&(t.timezone=this.zone.tzid),t}};ud=new WeakMap,R(te,"_dowCache",{}),R(te,"_wnCache",{}),R(te,"fromData",function(t,r){return new te().fromData(t,r)}),Ap(te,ud,null),R(te,"daysInYearPassedMonth",[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]]),R(te,"SUNDAY",1),R(te,"MONDAY",2),R(te,"TUESDAY",3),R(te,"WEDNESDAY",4),R(te,"THURSDAY",5),R(te,"FRIDAY",6),R(te,"SATURDAY",7),R(te,"DEFAULT_WEEK_START",2);var ce=te,d4=/[^ \t]/,nv=":",WS=";",u4="=",h4="unknown",f4="text",p4={"^'":'"',"^n":`
`,"^^":"^"};function it(n){let e={},t=e.component=[];if(e.stack=[t],it._eachLine(n,function(r,s){it._handleContentLine(s,e)}),e.stack.length>1)throw new Zi("invalid ical body. component began but did not end");return e=null,t.length==1?t[0]:t}it.property=function(n,e){let t={component:[[],[]],designSet:e||lt.defaultSet};return it._handleContentLine(n,t),t.component[1][0]};it.component=function(n){return it(n)};var Zi=class extends Error{constructor(){super(...arguments);R(this,"name",this.constructor.name)}};it.ParserError=Zi;it._handleContentLine=function(n,e){let t=n.indexOf(nv),r=n.indexOf(WS),s,i,a,o,l={};r!==-1&&t!==-1&&r>t&&(r=-1);let c;if(r!==-1){if(a=n.slice(0,Math.max(0,r)).toLowerCase(),c=it._parseParameters(n.slice(Math.max(0,r)),0,e.designSet),c[2]==-1)throw new Zi("Invalid parameters in '"+n+"'");l=c[0];let y;if(typeof c[1]=="string"?y=c[1].length:y=c[1].reduce((T,w)=>T+w.length,0),s=y+c[2]+r,(i=n.slice(Math.max(0,s)).indexOf(nv))!==-1)o=n.slice(Math.max(0,s+i+1));else throw new Zi("Missing parameter value in '"+n+"'")}else if(t!==-1){if(a=n.slice(0,Math.max(0,t)).toLowerCase(),o=n.slice(Math.max(0,t+1)),a==="begin"){let y=[o.toLowerCase(),[],[]];e.stack.length===1?e.component.push(y):e.component[2].push(y),e.stack.push(e.component),e.component=y,e.designSet||(e.designSet=lt.getDesignSet(e.component[0]));return}else if(a==="end"){e.component=e.stack.pop();return}}else throw new Zi('invalid line (no token ";" or ":") "'+n+'"');let d,u=!1,f=!1,h,p,m;e.designSet.propertyGroups&&a.indexOf(".")!==-1?(p=a.split("."),l.group=p[0],m=p[1]):m=a,m in e.designSet.property&&(h=e.designSet.property[m],"multiValue"in h&&(u=h.multiValue),"structuredValue"in h&&(f=h.structuredValue),o&&"detectType"in h&&(d=h.detectType(o))),d||("value"in l?d=l.value.toLowerCase():h?d=h.defaultType:d=h4),delete l.value;let g;u&&f?(o=it._parseMultiValue(o,f,d,[],u,e.designSet,f),g=[m,l,d,o]):u?(g=[m,l,d],it._parseMultiValue(o,u,d,g,null,e.designSet,!1)):f?(o=it._parseMultiValue(o,f,d,[],null,e.designSet,f),g=[m,l,d,o]):(o=it._parseValue(o,d,e.designSet,!1),g=[m,l,d,o]),e.component[0]==="vcard"&&e.component[1].length===0&&!(a==="version"&&o==="4.0")&&(e.designSet=lt.getDesignSet("vcard3")),e.component[1].push(g)};it._parseValue=function(n,e,t,r){return e in t.value&&"fromICAL"in t.value[e]?t.value[e].fromICAL(n,r):n};it._parseParameters=function(n,e,t){let r=e,s=0,i=u4,a={},o,l,c,d=-1,u,f,h;for(;s!==!1&&(s=n.indexOf(i,s+1))!==-1;){if(o=n.slice(r+1,s),o.length==0)throw new Zi("Empty parameter name in '"+n+"'");if(l=o.toLowerCase(),h=!1,f=!1,l in t.param&&t.param[l].valueType?u=t.param[l].valueType:u=f4,l in t.param&&(f=t.param[l].multiValue,t.param[l].multiValueSeparateDQuote&&(h=it._rfc6868Escape('"'+f+'"'))),n[s+1]==='"'){if(d=s+2,s=n.indexOf('"',d),f&&s!=-1){let y=!0;for(;y;)n[s+1]==f&&n[s+2]=='"'?s=n.indexOf('"',s+3):y=!1}if(s===-1)throw new Zi('invalid line (no matching double quote) "'+n+'"');c=n.slice(d,s),r=n.indexOf(WS,s);let g=n.indexOf(nv,s);(r===-1||g!==-1&&r>g)&&(s=!1)}else{d=s+1;let g=n.indexOf(WS,d),y=n.indexOf(nv,d);y!==-1&&g>y?(g=y,s=!1):g===-1?(y===-1?g=n.length:g=y,s=!1):(r=g,s=g),c=n.slice(d,g)}let m=c.length;if(c=it._rfc6868Escape(c),d+=m-c.length,f){let g=h||f;c=it._parseMultiValue(c,g,u,[],null,t)}else c=it._parseValue(c,u,t);f&&l in a?Array.isArray(a[l])?a[l].push(c):a[l]=[a[l],c]:a[l]=c}return[a,c,d]};it._rfc6868Escape=function(n){return n.replace(/\^['n^]/g,function(e){return p4[e]})};it._parseMultiValue=function(n,e,t,r,s,i,a){let o=0,l=0,c;if(e.length===0)return n;for(;(o=JH(n,e,l))!==-1;)c=n.slice(l,o),s?c=it._parseMultiValue(c,s,t,[],null,i,a):c=it._parseValue(c,t,i,a),r.push(c),l=o+e.length;return c=n.slice(l),s?c=it._parseMultiValue(c,s,t,[],null,i,a):c=it._parseValue(c,t,i,a),r.push(c),r.length==1?r[0]:r};it._eachLine=function(n,e){let t=n.length,r=n.search(d4),s=r,i,a,o;do s=n.indexOf(`
`,r)+1,s>1&&n[s-2]==="\r"?o=2:o=1,s===0&&(s=t,o=0),a=n[r],a===" "||a==="	"?i+=n.slice(r+1,s-o):(i&&e(null,i),i=n.slice(r,s-o)),r=s;while(s!==t);i=i.trim(),i.length&&e(null,i)};var m4=["tzid","location","tznames","latitude","longitude"],hd,fd,Je=class Je{constructor(e){R(this,"tzid","");R(this,"location","");R(this,"tznames","");R(this,"latitude",0);R(this,"longitude",0);R(this,"component",null);R(this,"expandedUntilYear",0);R(this,"icalclass","icaltimezone");this.wrappedJSObject=this,this.fromData(e)}static _compare_change_fn(e,t){return e.year<t.year?-1:e.year>t.year?1:e.month<t.month?-1:e.month>t.month?1:e.day<t.day?-1:e.day>t.day?1:e.hour<t.hour?-1:e.hour>t.hour?1:e.minute<t.minute?-1:e.minute>t.minute?1:e.second<t.second?-1:e.second>t.second?1:0}static convert_time(e,t,r){if(e.isDate||t.tzid==r.tzid||t==Je.localTimezone||r==Je.localTimezone)return e.zone=r,e;let s=t.utcOffset(e);return e.adjust(0,0,0,-s),s=r.utcOffset(e),e.adjust(0,0,0,s),null}static fromData(e){return new Je().fromData(e)}static get utcTimezone(){return Ja(this,hd)||Ip(this,hd,Je.fromData({tzid:"UTC"})),Ja(this,hd)}static get localTimezone(){return Ja(this,fd)||Ip(this,fd,Je.fromData({tzid:"floating"})),Ja(this,fd)}static adjust_change(e,t,r,s,i){return ce.prototype.adjust.call(e,t,r,s,i,e)}fromData(e){if(this.expandedUntilYear=0,this.changes=[],e instanceof pn)this.component=e;else{if(e&&"component"in e)if(typeof e.component=="string"){let t=it(e.component);this.component=new pn(t)}else e.component instanceof pn?this.component=e.component:this.component=null;for(let t of m4)e&&t in e&&(this[t]=e[t])}return this.component instanceof pn&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this}utcOffset(e){if(this==Je.utcTimezone||this==Je.localTimezone||(this._ensureCoverage(e.year),!this.changes.length))return 0;let t={year:e.year,month:e.month,day:e.day,hour:e.hour,minute:e.minute,second:e.second},r=this._findNearbyChange(t),s=-1,i=1;for(;;){let l=pl(this.changes[r],!0);if(l.utcOffset<l.prevUtcOffset?Je.adjust_change(l,0,0,0,l.utcOffset):Je.adjust_change(l,0,0,0,l.prevUtcOffset),Je._compare_change_fn(t,l)>=0?s=r:i=-1,i==-1&&s!=-1)break;if(r+=i,r<0)return 0;if(r>=this.changes.length)break}let a=this.changes[s];if(a.utcOffset-a.prevUtcOffset<0&&s>0){let l=pl(a,!0);if(Je.adjust_change(l,0,0,0,l.prevUtcOffset),Je._compare_change_fn(t,l)<0){let c=this.changes[s-1],d=!1;a.is_daylight!=d&&c.is_daylight==d&&(a=c)}}return a.utcOffset}_findNearbyChange(e){let t=hl(this.changes,e,Je._compare_change_fn);return t>=this.changes.length?this.changes.length-1:t}_ensureCoverage(e){if(Je._minimumExpansionYear==-1){let r=ce.now();Je._minimumExpansionYear=r.year}let t=e;if(t<Je._minimumExpansionYear&&(t=Je._minimumExpansionYear),t+=Je.EXTRA_COVERAGE,!this.changes.length||this.expandedUntilYear<e){let r=this.component.getAllSubcomponents(),s=r.length,i=0;for(;i<s;i++)this._expandComponent(r[i],t,this.changes);this.changes.sort(Je._compare_change_fn),this.expandedUntilYear=t}}_expandComponent(e,t,r){if(!e.hasProperty("dtstart")||!e.hasProperty("tzoffsetto")||!e.hasProperty("tzoffsetfrom"))return null;let s=e.getFirstProperty("dtstart").getFirstValue(),i;function a(l){return l.factor*(l.hours*3600+l.minutes*60)}function o(){let l={};return l.is_daylight=e.name=="daylight",l.utcOffset=a(e.getFirstProperty("tzoffsetto").getFirstValue()),l.prevUtcOffset=a(e.getFirstProperty("tzoffsetfrom").getFirstValue()),l}if(!e.hasProperty("rrule")&&!e.hasProperty("rdate"))i=o(),i.year=s.year,i.month=s.month,i.day=s.day,i.hour=s.hour,i.minute=s.minute,i.second=s.second,Je.adjust_change(i,0,0,0,-i.prevUtcOffset),r.push(i);else{let l=e.getAllProperties("rdate");for(let d of l){let u=d.getFirstValue();i=o(),i.year=u.year,i.month=u.month,i.day=u.day,u.isDate?(i.hour=s.hour,i.minute=s.minute,i.second=s.second,s.zone!=Je.utcTimezone&&Je.adjust_change(i,0,0,0,-i.prevUtcOffset)):(i.hour=u.hour,i.minute=u.minute,i.second=u.second,u.zone!=Je.utcTimezone&&Je.adjust_change(i,0,0,0,-i.prevUtcOffset)),r.push(i)}let c=e.getFirstProperty("rrule");if(c){c=c.getFirstValue(),i=o(),c.until&&c.until.zone==Je.utcTimezone&&(c.until.adjust(0,0,0,i.prevUtcOffset),c.until.zone=Je.localTimezone);let d=c.iterator(s),u;for(;(u=d.next())&&(i=o(),!(u.year>t||!u));)i.year=u.year,i.month=u.month,i.day=u.day,i.hour=u.hour,i.minute=u.minute,i.second=u.second,i.isDate=u.isDate,Je.adjust_change(i,0,0,0,-i.prevUtcOffset),r.push(i)}}return r}toString(){return this.tznames?this.tznames:this.tzid}};hd=new WeakMap,fd=new WeakMap,Ap(Je,hd,null),Ap(Je,fd,null),R(Je,"_minimumExpansionYear",-1),R(Je,"EXTRA_COVERAGE",5);var ot=Je,Yr=null,iv={get count(){return Yr===null?0:Object.keys(Yr).length},reset:function(){Yr=Object.create(null);let n=ot.utcTimezone;Yr.Z=n,Yr.UTC=n,Yr.GMT=n},_hard_reset:function(){Yr=null},has:function(n){return Yr===null?!1:!!Yr[n]},get:function(n){return Yr===null&&this.reset(),Yr[n]},register:function(n,e){if(Yr===null&&this.reset(),typeof n=="string"&&e instanceof ot&&([n,e]=[e,n]),e||(n instanceof ot?e=n.tzid:n.name==="vtimezone"&&(n=new ot(n),e=n.tzid)),!e)throw new TypeError("Neither a timezone nor a name was passed");if(n instanceof ot)Yr[e]=n;else throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")},remove:function(n){return Yr===null?null:delete Yr[n]}};function g4(n){let e,t,r,s,i;if(!n||n.name!=="vcalendar")return n;for(e=n.getAllSubcomponents(),t=[],r={},i=0;i<e.length;i++)if(e[i].name==="vtimezone"){let a=e[i].getFirstProperty("tzid").getFirstValue();r[a]=e[i]}else t=t.concat(e[i].getAllProperties());for(s={},i=0;i<t.length;i++){let a=t[i].getParameter("tzid");a&&(s[a]=!0)}for(let[a,o]of Object.entries(r))s[a]||n.removeSubcomponent(o);for(let a of Object.keys(s))!r[a]&&iv.has(a)&&n.addSubcomponent(iv.get(a).component);return n}function wp(n){return typeof n=="number"&&isNaN(n)}function Hr(n){let e=parseInt(n,10);if(wp(e))throw new Error('Could not extract integer from "'+n+'"');return e}function Qi(n,e){if(typeof n!="undefined")return n instanceof e?n:new e(n)}function JH(n,e,t){for(;(t=n.indexOf(e,t))!==-1;)if(t>0&&n[t-1]==="\\")t+=1;else return t;return-1}function hl(n,e,t){if(!n.length)return 0;let r=0,s=n.length-1,i,a;for(;r<=s;)if(i=r+Math.floor((s-r)/2),a=t(e,n[i]),a<0)s=i-1;else if(a>0)r=i+1;else break;return a<0?i:a>0?i+1:i}function pl(n,e){if(!n||typeof n!="object")return n;if(n instanceof Date)return new Date(n.getTime());if("clone"in n)return n.clone();if(Array.isArray(n)){let t=[];for(let r=0;r<n.length;r++)t.push(e?pl(n[r],!0):n[r]);return t}else{let t={};for(let[r,s]of Object.entries(n))e?t[r]=pl(s,!0):t[r]=s;return t}}function eB(n){let e="",t=n||"",r=0,s=0;for(;t.length;){let i=t.codePointAt(r);i<128?++s:i<2048?s+=2:i<65536?s+=3:s+=4,s<fi.foldLength+1?r+=i>65535?2:1:(e+=fi.newLineChar+" "+t.slice(0,Math.max(0,r)),t=t.slice(Math.max(0,r)),r=s=0)}return e.slice(fi.newLineChar.length+1)}function ms(n){switch(typeof n!="string"&&(typeof n=="number"&&(n=parseInt(n)),n=String(n)),n.length){case 0:return"00";case 1:return"0"+n;default:return n}}function mr(n){return n<0?Math.ceil(n):Math.floor(n)}function ml(n,e){for(let t in n){let r=Object.getOwnPropertyDescriptor(n,t);r&&!Object.getOwnPropertyDescriptor(e,t)&&Object.defineProperty(e,t,r)}return e}var y4=Object.freeze({__proto__:null,binsearchInsert:hl,clone:pl,extend:ml,foldline:eB,formatClassType:Qi,isStrictlyNaN:wp,pad2:ms,strictParseInt:Hr,trunc:mr,unescapedIndexOf:JH,updateTimezones:g4}),Ki=class n{constructor(e){R(this,"hours",0);R(this,"minutes",0);R(this,"factor",1);R(this,"icaltype","utc-offset");this.fromData(e)}static fromString(e){let t={};return t.factor=e[0]==="+"?1:-1,t.hours=Hr(e.slice(1,3)),t.minutes=Hr(e.slice(4,6)),new n(t)}static fromSeconds(e){let t=new n;return t.fromSeconds(e),t}clone(){return n.fromSeconds(this.toSeconds())}fromData(e){if(e)for(let[t,r]of Object.entries(e))this[t]=r;this._normalize()}fromSeconds(e){let t=Math.abs(e);return this.factor=e<0?-1:1,this.hours=mr(t/3600),t-=this.hours*3600,this.minutes=mr(t/60),this}toSeconds(){return this.factor*(60*this.minutes+3600*this.hours)}compare(e){let t=this.toSeconds(),r=e.toSeconds();return(t>r)-(r>t)}_normalize(){let e=this.toSeconds(),t=this.factor;for(;e<-43200;)e+=97200;for(;e>50400;)e-=97200;this.fromSeconds(e),e==0&&(this.factor=t)}toICALString(){return lt.icalendar.value["utc-offset"].toICAL(this.toString())}toString(){return(this.factor==1?"+":"-")+ms(this.hours)+":"+ms(this.minutes)}},ul=class n extends ce{constructor(t,r,s){super(t,r);R(this,"icalclass","vcardtime");R(this,"icaltype","date-and-or-time");this.icaltype=s||"date-and-or-time"}static fromDateAndOrTimeString(t,r){function s(g,y,T){return g?Hr(g.slice(y,y+T)):null}let i=t.split("T"),a=i[0],o=i[1],l=o?lt.vcard.value.time._splitZone(o):[],c=l[0],d=l[1],u=a?a.length:0,f=d?d.length:0,h=a&&a[0]=="-"&&a[1]=="-",p=d&&d[0]=="-",m={year:h?null:s(a,0,4),month:h&&(u==4||u==7)?s(a,2,2):u==7||u==10?s(a,5,2):null,day:u==5?s(a,3,2):u==7&&h?s(a,5,2):u==10?s(a,8,2):null,hour:p?null:s(d,0,2),minute:p&&f==3?s(d,1,2):f>4?p?s(d,1,2):s(d,3,2):null,second:f==4?s(d,2,2):f==6?s(d,4,2):f==8?s(d,6,2):null};return c=="Z"?c=ot.utcTimezone:c&&c[3]==":"?c=Ki.fromString(c):c=null,new n(m,c,r)}clone(){return new n(this._time,this.zone,this.icaltype)}_normalize(){return this}utcOffset(){return this.zone instanceof Ki?this.zone.toSeconds():ce.prototype.utcOffset.apply(this,arguments)}toICALString(){return lt.vcard.value[this.icaltype].toICAL(this.toString())}toString(){let t=this.year,r=this.month,s=this.day,i=this.hour,a=this.minute,o=this.second,l=t!==null,c=r!==null,d=s!==null,u=i!==null,f=a!==null,h=o!==null,p=(l?ms(t)+(c||d?"-":""):c||d?"--":"")+(c?ms(r):"")+(d?"-"+ms(s):""),m=(u?ms(i):"-")+(u&&f?":":"")+(f?ms(a):"")+(!u&&!f?"-":"")+(f&&h?":":"")+(h?ms(o):""),g;switch(this.zone===ot.utcTimezone?g="Z":this.zone instanceof Ki?g=this.zone.toString():this.zone===ot.localTimezone?g="":this.zone instanceof ot?g=Ki.fromSeconds(this.zone.utcOffset(this)).toString():g="",this.icaltype){case"time":return m+g;case"date-and-or-time":case"date-time":return p+(m=="--"?"":"T"+m+g);case"date":return p}return null}},ps=class ps{constructor(e){R(this,"completed",!1);R(this,"rule",null);R(this,"dtstart",null);R(this,"last",null);R(this,"occurrence_number",0);R(this,"by_indices",null);R(this,"initialized",!1);R(this,"by_data",null);R(this,"days",null);R(this,"days_index",0);this.fromData(e)}fromData(e){if(this.rule=Qi(e.rule,In),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=Qi(e.dtstart,ce),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");if(e.by_data?this.by_data=e.by_data:this.by_data=pl(this.rule.parts,!0),e.occurrence_number&&(this.occurrence_number=e.occurrence_number),this.days=e.days||[],e.last&&(this.last=Qi(e.last,ce)),this.by_indices=e.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=e.initialized||!1,!this.initialized)try{this.init()}catch(t){if(t instanceof dd)this.completed=!0;else throw t}}init(){this.initialized=!0,this.last=this.dtstart.clone();let e=this.by_data;if("BYDAY"in e&&this.sort_byday_rules(e.BYDAY),"BYYEARDAY"in e&&("BYMONTH"in e||"BYWEEKNO"in e||"BYMONTHDAY"in e))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in e&&"BYMONTHDAY"in e)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if(this.rule.freq=="MONTHLY"&&("BYYEARDAY"in e||"BYWEEKNO"in e))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if(this.rule.freq=="WEEKLY"&&("BYYEARDAY"in e||"BYMONTHDAY"in e))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if(this.rule.freq!="YEARLY"&&"BYYEARDAY"in e)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),this.rule.freq=="WEEKLY")if("BYDAY"in e){let[,t]=this.ruleDayOfWeek(e.BYDAY[0],this.rule.wkst),r=t-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<t&&r>=0||r<0)&&(this.last.day+=r)}else{let t=In.numericDayToIcalDay(this.dtstart.dayOfWeek());e.BYDAY=[t]}if(this.rule.freq=="YEARLY"){let t=this.rule.until?this.rule.until.year:2e4;for(;this.last.year<=t&&(this.expand_year_days(this.last.year),!(this.days.length>0));)this.increment_year(this.rule.interval);if(this.days.length==0)throw new dd;if(!this._nextByYearDay()&&!this.next_year()&&!this.next_year()&&!this.next_year())throw new dd}if(this.rule.freq=="MONTHLY"){if(this.has_by_data("BYDAY")){let t=null,r=this.last.clone(),s=ce.daysInMonth(this.last.month,this.last.year);for(let i of this.by_data.BYDAY){this.last=r.clone();let[a,o]=this.ruleDayOfWeek(i),l=this.last.nthWeekDay(o,a);if(a>=6||a<=-6)throw new Error("Malformed values in BYDAY part");if(l>s||l<=0){if(t&&t.month==r.month)continue;for(;l>s||l<=0;)this.increment_month(),s=ce.daysInMonth(this.last.month,this.last.year),l=this.last.nthWeekDay(o,a)}this.last.day=l,(!t||this.last.compare(t)<0)&&(t=this.last.clone())}if(this.last=t.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>s||this.last.day==0)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")){this.last.day=1;let t=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY).filter(r=>r>=this.last.day);if(t.length)this.last.day=t[0],this.by_data.BYMONTHDAY=t;else if(!this.next_month()&&!this.next_month()&&!this.next_month())throw new dd}}}next(e=!1){let t=this.last?this.last.clone():null;if((this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)&&(this.completed=!0),this.completed)return null;if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;let r,s=0;do switch(r=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":if(r=this.next_month(),r)s=0;else if(++s==336)return this.completed=!0,null;break;case"YEARLY":if(r=this.next_year(),r)s=0;else if(++s==28)return this.completed=!0,null;break;default:return null}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!r);if(this.last.compare(t)==0){if(e)throw new Error("Same occurrence found twice, protecting you from death by recursion");this.next(!0)}return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)}next_second(){return this.next_generic("BYSECOND","SECONDLY","second","minute")}increment_second(e){return this.increment_generic(e,"second",60,"minute")}next_minute(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")}increment_minute(e){return this.increment_generic(e,"minute",60,"hour")}next_hour(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")}increment_hour(e){this.increment_generic(e,"hour",24,"monthday")}next_day(){let e=this.rule.freq=="DAILY";return this.next_hour()==0||(e?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0}next_week(){let e=0;if(this.next_weekday_by_week()==0)return e;if(this.has_by_data("BYWEEKNO")){this.by_indices.BYWEEKNO++,this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,e=1),this.last.month=1,this.last.day=1;let t=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*t,e&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return e}normalizeByMonthDayRules(e,t,r){let s=ce.daysInMonth(t,e),i=[],a=0,o=r.length,l;for(;a<o;a++){if(l=parseInt(r[a],10),isNaN(l))throw new Error("Invalid BYMONTHDAY value");if(!(Math.abs(l)>s)){if(l<0)l=s+(l+1);else if(l===0)continue;i.indexOf(l)===-1&&i.push(l)}}return i.sort(function(c,d){return c-d})}_byDayAndMonthDay(e){let t,r=this.by_data.BYDAY,s,i=0,a,o=r.length,l=0,c,d=this,u=this.last.day;function f(){for(c=ce.daysInMonth(d.last.month,d.last.year),t=d.normalizeByMonthDayRules(d.last.year,d.last.month,d.by_data.BYMONTHDAY),a=t.length;t[i]<=u&&!(e&&t[i]==u)&&i<a-1;)i++}function h(){u=0,d.increment_month(),i=0,f()}f(),e&&(u-=1);let p=48;for(;!l&&p;){if(p--,s=u+1,s>c){h();continue}let m=t[i++];if(m>=s)u=m;else{h();continue}for(let g=0;g<o;g++){let y=this.ruleDayOfWeek(r[g]),T=y[0],w=y[1];if(this.last.day=u,this.last.isNthWeekDay(w,T)){l=1;break}}if(!l&&i===a){h();continue}}if(p<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return l}next_month(){let e=1;if(this.next_hour()==0)return e;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))e=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){let t=ce.daysInMonth(this.last.month,this.last.year),r=0,s=0;if(this.has_by_data("BYSETPOS")){let a=this.last.day;for(let o=1;o<=t;o++)this.last.day=o,this.is_day_in_byday(this.last)&&(s++,o<=a&&r++);this.last.day=a}e=0;let i;for(i=this.last.day+1;i<=t;i++)if(this.last.day=i,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++r)||this.check_set_position(r-s-1))){e=1;break}i>t&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data("BYSETPOS")||this.check_set_position(1))&&(e=1):e=0)}else if(this.has_by_data("BYMONTHDAY")){if(this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month(),this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length))return 0;let t=ce.daysInMonth(this.last.month,this.last.year),r=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];r<0&&(r=t+r+1),r>t?(this.last.day=1,e=this.is_day_in_byday(this.last)):this.last.day=r}else{this.increment_month();let t=ce.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>t?e=0:this.last.day=this.by_data.BYMONTHDAY[0]}return e}next_weekday_by_week(){let e=0;if(this.next_hour()==0)return e;if(!this.has_by_data("BYDAY"))return 1;for(;;){let t=new ce;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,e=1);let r=this.by_data.BYDAY[this.by_indices.BYDAY],i=this.ruleDayOfWeek(r)[1];i-=this.rule.wkst,i<0&&(i+=7),t.year=this.last.year,t.month=this.last.month,t.day=this.last.day;let a=t.startDoyWeek(this.rule.wkst);if(i+a<1&&!e)continue;let o=ce.fromDayOfYear(a+i,this.last.year);return this.last.year=o.year,this.last.month=o.month,this.last.day=o.day,e}}next_year(){return this.next_hour()==0||(this.days.length==0||++this.days_index==this.days.length)&&(this.days_index=0,this.increment_year(this.rule.interval),this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY)),this.expand_year_days(this.last.year),this.days.length==0)?0:this._nextByYearDay()}_nextByYearDay(){let e=this.days[this.days_index],t=this.last.year;if(Math.abs(e)==366&&!ce.isLeapYear(this.last.year))return 0;e<1&&(e+=1,t+=1);let r=ce.fromDayOfYear(e,t);return this.last.day=r.day,this.last.month=r.month,1}ruleDayOfWeek(e,t){let r=e.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(r){let s=parseInt(r[1]||0,10);return e=In.icalDayToNumericDay(r[2],t),[s,e]}else return[0,0]}next_generic(e,t,r,s,i){let a=e in this.by_data,o=this.rule.freq==t,l=0;if(i&&this[i]()==0)return l;if(a){this.by_indices[e]++;let c=this.by_data[e];this.by_indices[e]==c.length&&(this.by_indices[e]=0,l=1),this.last[r]=c[this.by_indices[e]]}else o&&this["increment_"+r](this.rule.interval);return a&&l&&o&&this["increment_"+s](1),l}increment_monthday(e){for(let t=0;t<e;t++){let r=ce.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>r&&(this.last.day-=r,this.increment_month())}}increment_month(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{this.rule.freq=="MONTHLY"?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;let e=mr(this.last.month/12);this.last.month%=12,this.last.month++,e!=0&&this.increment_year(e)}this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY))}increment_year(e){this.last.day=1,this.last.year+=e}increment_generic(e,t,r,s){this.last[t]+=e;let i=mr(this.last[t]/r);this.last[t]%=r,i!=0&&this["increment_"+s](i)}has_by_data(e){return e in this.rule.parts}expand_year_days(e){let t=new ce;this.days=[];let r={},s=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(let o of s)o in this.rule.parts&&(r[o]=this.rule.parts[o]);if("BYMONTH"in r&&"BYWEEKNO"in r){let o=1,l={};t.year=e,t.isDate=!0;for(let c=0;c<this.by_data.BYMONTH.length;c++){let d=this.by_data.BYMONTH[c];t.month=d,t.day=1;let u=t.weekNumber(this.rule.wkst);t.day=ce.daysInMonth(d,e);let f=t.weekNumber(this.rule.wkst);for(c=u;c<f;c++)l[c]=1}for(let c=0;c<this.by_data.BYWEEKNO.length&&o;c++)this.by_data.BYWEEKNO[c]<52?o&=l[c]:o=0;o?delete r.BYMONTH:delete r.BYWEEKNO}let i=Object.keys(r).length;if(i==0){let o=this.dtstart.clone();o.year=this.last.year,this.days.push(o.dayOfYear())}else if(i==1&&"BYMONTH"in r)for(let o of this.by_data.BYMONTH){let l=this.dtstart.clone();l.year=e,l.month=o,l.isDate=!0,this.days.push(l.dayOfYear())}else if(i==1&&"BYMONTHDAY"in r)for(let o of this.by_data.BYMONTHDAY){let l=this.dtstart.clone();if(o<0){let c=ce.daysInMonth(l.month,e);o=o+c+1}l.day=o,l.year=e,l.isDate=!0,this.days.push(l.dayOfYear())}else if(i==2&&"BYMONTHDAY"in r&&"BYMONTH"in r)for(let o of this.by_data.BYMONTH){let l=ce.daysInMonth(o,e);for(let c of this.by_data.BYMONTHDAY)c<0&&(c=c+l+1),t.day=c,t.month=o,t.year=e,t.isDate=!0,this.days.push(t.dayOfYear())}else if(!(i==1&&"BYWEEKNO"in r)){if(!(i==2&&"BYWEEKNO"in r&&"BYMONTHDAY"in r)){if(i==1&&"BYDAY"in r)this.days=this.days.concat(this.expand_by_day(e));else if(i==2&&"BYDAY"in r&&"BYMONTH"in r){for(let o of this.by_data.BYMONTH){let l=ce.daysInMonth(o,e);t.year=e,t.month=o,t.day=1,t.isDate=!0;let c=t.dayOfWeek(),d=t.dayOfYear()-1;t.day=l;let u=t.dayOfWeek();if(this.has_by_data("BYSETPOS")){let f=[];for(let h=1;h<=l;h++)t.day=h,this.is_day_in_byday(t)&&f.push(h);for(let h=0;h<f.length;h++)(this.check_set_position(h+1)||this.check_set_position(h-f.length))&&this.days.push(d+f[h])}else for(let f of this.by_data.BYDAY){let h=this.ruleDayOfWeek(f),p=h[0],m=h[1],g,y=(m+7-c)%7+1,T=l-(u+7-m)%7;if(p==0)for(let w=y;w<=l;w+=7)this.days.push(d+w);else p>0?(g=y+(p-1)*7,g<=l&&this.days.push(d+g)):(g=T+(p+1)*7,g>0&&this.days.push(d+g))}}this.days.sort(function(o,l){return o-l})}else if(i==2&&"BYDAY"in r&&"BYMONTHDAY"in r){let o=this.expand_by_day(e);for(let l of o){let c=ce.fromDayOfYear(l,e);this.by_data.BYMONTHDAY.indexOf(c.day)>=0&&this.days.push(l)}}else if(i==3&&"BYDAY"in r&&"BYMONTHDAY"in r&&"BYMONTH"in r){let o=this.expand_by_day(e);for(let l of o){let c=ce.fromDayOfYear(l,e);this.by_data.BYMONTH.indexOf(c.month)>=0&&this.by_data.BYMONTHDAY.indexOf(c.day)>=0&&this.days.push(l)}}else if(i==2&&"BYDAY"in r&&"BYWEEKNO"in r){let o=this.expand_by_day(e);for(let l of o){let d=ce.fromDayOfYear(l,e).weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(d)&&this.days.push(l)}}else if(!(i==3&&"BYDAY"in r&&"BYWEEKNO"in r&&"BYMONTHDAY"in r))if(i==1&&"BYYEARDAY"in r)this.days=this.days.concat(this.by_data.BYYEARDAY);else if(i==2&&"BYYEARDAY"in r&&"BYDAY"in r){let o=ce.isLeapYear(e)?366:365,l=new Set(this.expand_by_day(e));for(let c of this.by_data.BYYEARDAY)c<0&&(c+=o+1),l.has(c)&&this.days.push(c)}else this.days=[]}}let a=ce.isLeapYear(e)?366:365;return this.days.sort((o,l)=>(o<0&&(o+=a+1),l<0&&(l+=a+1),o-l)),0}expand_by_day(e){let t=[],r=this.last.clone();r.year=e,r.month=1,r.day=1,r.isDate=!0;let s=r.dayOfWeek();r.month=12,r.day=31,r.isDate=!0;let i=r.dayOfWeek(),a=r.dayOfYear();for(let o of this.by_data.BYDAY){let l=this.ruleDayOfWeek(o),c=l[0],d=l[1];if(c==0){let u=(d+7-s)%7+1;for(let f=u;f<=a;f+=7)t.push(f)}else if(c>0){let u;d>=s?u=d-s+1:u=d-s+8,t.push(u+(c-1)*7)}else{let u;c=-c,d<=i?u=a-i+d:u=a-i+d-7,t.push(u-(c-1)*7)}}return t}is_day_in_byday(e){if(this.by_data.BYDAY)for(let t of this.by_data.BYDAY){let r=this.ruleDayOfWeek(t),s=r[0],i=r[1],a=e.dayOfWeek();if(s==0&&i==a||e.nthWeekDay(i,s)==e.day)return 1}return 0}check_set_position(e){return this.has_by_data("BYSETPOS")?this.by_data.BYSETPOS.indexOf(e)!==-1:!1}sort_byday_rules(e){for(let t=0;t<e.length;t++)for(let r=0;r<t;r++){let s=this.ruleDayOfWeek(e[r],this.rule.wkst)[1],i=this.ruleDayOfWeek(e[t],this.rule.wkst)[1];if(s>i){let a=e[t];e[t]=e[r],e[r]=a}}}check_contract_restriction(e,t){let r=ps._indexMap[e],s=ps._expandMap[this.rule.freq][r],i=!1;if(e in this.by_data&&s==ps.CONTRACT){let a=this.by_data[e];for(let o of a)if(o==t){i=!0;break}}else i=!0;return i}check_contracting_rules(){let e=this.last.dayOfWeek(),t=this.last.weekNumber(this.rule.wkst),r=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",In.numericDayToIcalDay(e))&&this.check_contract_restriction("BYWEEKNO",t)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",r)}setup_defaults(e,t,r){let s=ps._indexMap[e];return ps._expandMap[this.rule.freq][s]!=ps.CONTRACT&&(e in this.by_data||(this.by_data[e]=[r]),this.rule.freq!=t)?this.by_data[e][0]:r}toJSON(){let e=Object.create(null);return e.initialized=this.initialized,e.rule=this.rule.toJSON(),e.dtstart=this.dtstart.toJSON(),e.by_data=this.by_data,e.days=this.days,e.last=this.last.toJSON(),e.by_indices=this.by_indices,e.occurrence_number=this.occurrence_number,e}};R(ps,"_indexMap",{BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8}),R(ps,"_expandMap",{SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]}),R(ps,"UNKNOWN",0),R(ps,"CONTRACT",1),R(ps,"EXPAND",2),R(ps,"ILLEGAL",3);var bp=ps,dd=class extends Error{constructor(){super("Recurrence rule has no valid occurrences")}},v4=/^(SU|MO|TU|WE|TH|FR|SA)$/,T4=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,tB={SU:ce.SUNDAY,MO:ce.MONDAY,TU:ce.TUESDAY,WE:ce.WEDNESDAY,TH:ce.THURSDAY,FR:ce.FRIDAY,SA:ce.SATURDAY},w4=Object.fromEntries(Object.entries(tB).map(n=>n.reverse())),WH=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],In=class n{constructor(e){R(this,"parts",null);R(this,"interval",1);R(this,"wkst",ce.MONDAY);R(this,"until",null);R(this,"count",null);R(this,"freq",null);R(this,"icalclass","icalrecur");R(this,"icaltype","recur");this.wrappedJSObject=this,this.parts={},e&&typeof e=="object"&&this.fromData(e)}static fromString(e){let t=this._stringToData(e,!1);return new n(t)}static fromData(e){return new n(e)}static _stringToData(e,t){let r=Object.create(null),s=e.split(";"),i=s.length;for(let a=0;a<i;a++){let o=s[a].split("="),l=o[0].toUpperCase(),c=o[0].toLowerCase(),d=t?c:l,u=o[1];if(l in jS){let f=u.split(","),h=new Set;for(let p of f)h.add(jS[l](p));f=[...h],r[d]=f.length==1?f[0]:f}else l in US?US[l](u,r,t):r[c]=u}return r}static icalDayToNumericDay(e,t){let r=t||ce.SUNDAY;return(tB[e]-r+7)%7+1}static numericDayToIcalDay(e,t){let r=t||ce.SUNDAY,s=e+r-ce.SUNDAY;return s>7&&(s-=7),w4[s]}iterator(e){return new bp({rule:this,dtstart:e})}clone(){return new n(this.toJSON())}isFinite(){return!!(this.count||this.until)}isByCount(){return!!(this.count&&!this.until)}addComponent(e,t){let r=e.toUpperCase();r in this.parts?this.parts[r].push(t):this.parts[r]=[t]}setComponent(e,t){this.parts[e.toUpperCase()]=t.slice()}getComponent(e){let t=e.toUpperCase();return t in this.parts?this.parts[t].slice():[]}getNextOccurrence(e,t){let r=this.iterator(e),s;do s=r.next();while(s&&s.compare(t)<=0);return s&&t.zone&&(s.zone=t.zone),s}fromData(e){for(let t in e){let r=t.toUpperCase();r in jS?Array.isArray(e[t])?this.parts[r]=e[t]:this.parts[r]=[e[t]]:this[t]=e[t]}this.interval&&typeof this.interval!="number"&&US.INTERVAL(this.interval,this),this.wkst&&typeof this.wkst!="number"&&(this.wkst=n.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof ce)&&(this.until=ce.fromString(this.until))}toJSON(){let e=Object.create(null);e.freq=this.freq,this.count&&(e.count=this.count),this.interval>1&&(e.interval=this.interval);for(let[t,r]of Object.entries(this.parts))Array.isArray(r)&&r.length==1?e[t.toLowerCase()]=r[0]:e[t.toLowerCase()]=pl(r);return this.until&&(e.until=this.until.toString()),"wkst"in this&&this.wkst!==ce.DEFAULT_WEEK_START&&(e.wkst=n.numericDayToIcalDay(this.wkst)),e}toString(){let e="FREQ="+this.freq;this.count&&(e+=";COUNT="+this.count),this.interval>1&&(e+=";INTERVAL="+this.interval);for(let[t,r]of Object.entries(this.parts))e+=";"+t+"="+r;return this.until&&(e+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==ce.DEFAULT_WEEK_START&&(e+=";WKST="+n.numericDayToIcalDay(this.wkst)),e}};function za(n,e,t,r){let s=r;if(r[0]==="+"&&(s=r.slice(1)),s=Hr(s),e!==void 0&&r<e)throw new Error(n+': invalid value "'+r+'" must be > '+e);if(t!==void 0&&r>t)throw new Error(n+': invalid value "'+r+'" must be < '+e);return s}var US={FREQ:function(n,e,t){if(WH.indexOf(n)!==-1)e.freq=n;else throw new Error('invalid frequency "'+n+'" expected: "'+WH.join(", ")+'"')},COUNT:function(n,e,t){e.count=Hr(n)},INTERVAL:function(n,e,t){e.interval=Hr(n),e.interval<1&&(e.interval=1)},UNTIL:function(n,e,t){n.length>10?e.until=lt.icalendar.value["date-time"].fromICAL(n):e.until=lt.icalendar.value.date.fromICAL(n),t||(e.until=ce.fromString(e.until))},WKST:function(n,e,t){if(v4.test(n))e.wkst=In.icalDayToNumericDay(n);else throw new Error('invalid WKST value "'+n+'"')}},jS={BYSECOND:za.bind(void 0,"BYSECOND",0,60),BYMINUTE:za.bind(void 0,"BYMINUTE",0,59),BYHOUR:za.bind(void 0,"BYHOUR",0,23),BYDAY:function(n){if(T4.test(n))return n;throw new Error('invalid BYDAY value "'+n+'"')},BYMONTHDAY:za.bind(void 0,"BYMONTHDAY",-31,31),BYYEARDAY:za.bind(void 0,"BYYEARDAY",-366,366),BYWEEKNO:za.bind(void 0,"BYWEEKNO",-53,53),BYMONTH:za.bind(void 0,"BYMONTH",1,12),BYSETPOS:za.bind(void 0,"BYSETPOS",-366,366)},b4=/\\\\|\\;|\\,|\\[Nn]/g,k4=/\\|;|,|\n/g,VH=/\\\\|\\,|\\[Nn]/g,$H=/\\|,|\n/g;function VS(n,e){return{matches:/.*/,fromICAL:function(r,s){return S4(r,n,s)},toICAL:function(r,s){let i=e;return s&&(i=new RegExp(i.source+"|"+s,i.flags)),r.replace(i,function(a){switch(a){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case`
`:return"\\n";default:return a}})}}}var et={defaultType:"text"},kp={defaultType:"text",multiValue:","},av={defaultType:"text",structuredValue:";"},Zy={defaultType:"integer"},Xy={defaultType:"date-time",allowedTypes:["date-time","date"]},Jy={defaultType:"date-time"},fs={defaultType:"uri"},YH={defaultType:"utc-offset"},zH={defaultType:"recur"},qH={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function E4(n){switch(n){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return`
`;default:return n}}function S4(n,e,t){return n.indexOf("\\")===-1?n:(t&&(e=new RegExp(e.source+"|\\\\"+t,e.flags)),n.replace(e,E4))}var YS={categories:kp,url:fs,version:et,uid:et},zS={boolean:{values:["TRUE","FALSE"],fromICAL:function(n){switch(n){case"TRUE":return!0;case"FALSE":return!1;default:return!1}},toICAL:function(n){return n?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(n){let e=parseFloat(n);return wp(e)?0:e},toICAL:function(n){return String(n)}},integer:{fromICAL:function(n){let e=parseInt(n);return wp(e)?0:e},toICAL:function(n){return String(n)}},"utc-offset":{toICAL:function(n){return n.length<7?n.slice(0,3)+n.slice(4,6):n.slice(0,3)+n.slice(4,6)+n.slice(7,9)},fromICAL:function(n){return n.length<6?n.slice(0,3)+":"+n.slice(3,5):n.slice(0,3)+":"+n.slice(3,5)+":"+n.slice(5,7)},decorate:function(n){return Ki.fromString(n)},undecorate:function(n){return n.toString()}}},D4={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},Jt=ml(zS,{text:VS(b4,k4),uri:{},binary:{decorate:function(n){return sv.fromString(n)},undecorate:function(n){return n.toString()}},"cal-address":{},date:{decorate:function(n,e){return lt.strict?ce.fromDateString(n,e):ce.fromString(n,e)},undecorate:function(n){return n.toString()},fromICAL:function(n){return!lt.strict&&n.length>=15?Jt["date-time"].fromICAL(n):n.slice(0,4)+"-"+n.slice(4,6)+"-"+n.slice(6,8)},toICAL:function(n){let e=n.length;return e==10?n.slice(0,4)+n.slice(5,7)+n.slice(8,10):e>=19?Jt["date-time"].toICAL(n):n}},"date-time":{fromICAL:function(n){if(!lt.strict&&n.length==8)return Jt.date.fromICAL(n);{let e=n.slice(0,4)+"-"+n.slice(4,6)+"-"+n.slice(6,8)+"T"+n.slice(9,11)+":"+n.slice(11,13)+":"+n.slice(13,15);return n[15]&&n[15]==="Z"&&(e+="Z"),e}},toICAL:function(n){let e=n.length;if(e==10&&!lt.strict)return Jt.date.toICAL(n);if(e>=19){let t=n.slice(0,4)+n.slice(5,7)+n.slice(8,13)+n.slice(14,16)+n.slice(17,19);return n[19]&&n[19]==="Z"&&(t+="Z"),t}else return n},decorate:function(n,e){return lt.strict?ce.fromDateTimeString(n,e):ce.fromString(n,e)},undecorate:function(n){return n.toString()}},duration:{decorate:function(n){return js.fromString(n)},undecorate:function(n){return n.toString()}},period:{fromICAL:function(n){let e=n.split("/");return e[0]=Jt["date-time"].fromICAL(e[0]),js.isValueString(e[1])||(e[1]=Jt["date-time"].fromICAL(e[1])),e},toICAL:function(n){return n=n.slice(),!lt.strict&&n[0].length==10?n[0]=Jt.date.toICAL(n[0]):n[0]=Jt["date-time"].toICAL(n[0]),js.isValueString(n[1])||(!lt.strict&&n[1].length==10?n[1]=Jt.date.toICAL(n[1]):n[1]=Jt["date-time"].toICAL(n[1])),n.join("/")},decorate:function(n,e){return Tp.fromJSON(n,e,!lt.strict)},undecorate:function(n){return n.toJSON()}},recur:{fromICAL:function(n){return In._stringToData(n,!0)},toICAL:function(n){let e="";for(let[t,r]of Object.entries(n))t=="until"?r.length>10?r=Jt["date-time"].toICAL(r):r=Jt.date.toICAL(r):t=="wkst"?typeof r=="number"&&(r=In.numericDayToIcalDay(r)):Array.isArray(r)&&(r=r.join(",")),e+=t.toUpperCase()+"="+r+";";return e.slice(0,Math.max(0,e.length-1))},decorate:function(e){return In.fromData(e)},undecorate:function(n){return n.toJSON()}},time:{fromICAL:function(n){if(n.length<6)return n;let e=n.slice(0,2)+":"+n.slice(2,4)+":"+n.slice(4,6);return n[6]==="Z"&&(e+="Z"),e},toICAL:function(n){if(n.length<8)return n;let e=n.slice(0,2)+n.slice(3,5)+n.slice(6,8);return n[8]==="Z"&&(e+="Z"),e}}}),x4=ml(YS,{action:et,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:et,class:et,comment:et,completed:Jy,contact:et,created:Jy,description:et,dtend:Xy,dtstamp:Jy,dtstart:Xy,due:Xy,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:zH,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":Jy,location:et,method:et,organizer:{defaultType:"cal-address"},"percent-complete":Zy,priority:Zy,prodid:et,"related-to":et,repeat:Zy,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(n){return n.indexOf("/")!==-1?"period":n.indexOf("T")===-1?"date":"date-time"}},"recurrence-id":Xy,resources:kp,"request-status":av,rrule:zH,sequence:Zy,status:et,summary:et,transp:et,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:YH,tzoffsetto:YH,tzurl:fs,tzid:et,tzname:et}),Us=ml(zS,{text:VS(VH,$H),uri:VS(VH,$H),date:{decorate:function(n){return ul.fromDateAndOrTimeString(n,"date")},undecorate:function(n){return n.toString()},fromICAL:function(n){return n.length==8?Jt.date.fromICAL(n):n[0]=="-"&&n.length==6?n.slice(0,4)+"-"+n.slice(4):n},toICAL:function(n){return n.length==10?Jt.date.toICAL(n):n[0]=="-"&&n.length==7?n.slice(0,4)+n.slice(5):n}},time:{decorate:function(n){return ul.fromDateAndOrTimeString("T"+n,"time")},undecorate:function(n){return n.toString()},fromICAL:function(n){let e=Us.time._splitZone(n,!0),t=e[0],r=e[1];return r.length==6?r=r.slice(0,2)+":"+r.slice(2,4)+":"+r.slice(4,6):r.length==4&&r[0]!="-"?r=r.slice(0,2)+":"+r.slice(2,4):r.length==5&&(r=r.slice(0,3)+":"+r.slice(3,5)),t.length==5&&(t[0]=="-"||t[0]=="+")&&(t=t.slice(0,3)+":"+t.slice(3)),r+t},toICAL:function(n){let e=Us.time._splitZone(n),t=e[0],r=e[1];return r.length==8?r=r.slice(0,2)+r.slice(3,5)+r.slice(6,8):r.length==5&&r[0]!="-"?r=r.slice(0,2)+r.slice(3,5):r.length==6&&(r=r.slice(0,3)+r.slice(4,6)),t.length==6&&(t[0]=="-"||t[0]=="+")&&(t=t.slice(0,3)+t.slice(4)),r+t},_splitZone:function(n,e){let t=n.length-1,r=n.length-(e?5:6),s=n[r],i,a;return n[t]=="Z"?(i=n[t],a=n.slice(0,Math.max(0,t))):n.length>6&&(s=="-"||s=="+")?(i=n.slice(r),a=n.slice(0,Math.max(0,r))):(i="",a=n),[i,a]}},"date-time":{decorate:function(n){return ul.fromDateAndOrTimeString(n,"date-time")},undecorate:function(n){return n.toString()},fromICAL:function(n){return Us["date-and-or-time"].fromICAL(n)},toICAL:function(n){return Us["date-and-or-time"].toICAL(n)}},"date-and-or-time":{decorate:function(n){return ul.fromDateAndOrTimeString(n,"date-and-or-time")},undecorate:function(n){return n.toString()},fromICAL:function(n){let e=n.split("T");return(e[0]?Us.date.fromICAL(e[0]):"")+(e[1]?"T"+Us.time.fromICAL(e[1]):"")},toICAL:function(n){let e=n.split("T");return Us.date.toICAL(e[0])+(e[1]?"T"+Us.time.toICAL(e[1]):"")}},timestamp:Jt["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/},"phone-number":{fromICAL:function(n){return Array.from(n).filter(function(e){return e==="\\"?void 0:e}).join("")},toICAL:function(n){return Array.from(n).map(function(e){return e===","||e===";"?"\\"+e:e}).join("")}}}),C4={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},M4=ml(YS,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:qH,bday:qH,caladruri:fs,caluri:fs,clientpidmap:av,email:et,fburl:fs,fn:et,gender:av,geo:fs,impp:fs,key:fs,kind:et,lang:{defaultType:"language-tag"},logo:fs,member:fs,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:kp,note:et,org:{defaultType:"text",structuredValue:";"},photo:fs,related:fs,rev:{defaultType:"timestamp"},role:et,sound:fs,source:fs,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:et,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:et}),P4=ml(zS,{binary:Jt.binary,date:Us.date,"date-time":Us["date-time"],"phone-number":Us["phone-number"],uri:Jt.uri,text:Us.text,time:Jt.time,vcard:Jt.text,"utc-offset":{toICAL:function(n){return n.slice(0,7)},fromICAL:function(n){return n.slice(0,7)},decorate:function(n){return Ki.fromString(n)},undecorate:function(n){return n.toString()}}}),_4={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},A4=ml(YS,{fn:et,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:kp,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(n){return n.indexOf("T")===-1?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:et,tel:{defaultType:"phone-number"},email:et,mailer:et,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:et,role:et,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:av,note:kp,prodid:et,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(n){return n.indexOf("T")===-1?"date":"date-time"}},"sort-string":et,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:et,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),Gi={name:"ical",value:Jt,param:D4,property:x4,propertyGroups:!1},GH={name:"vcard4",value:Us,param:C4,property:M4,propertyGroups:!0},QH={name:"vcard3",value:P4,param:_4,property:A4,propertyGroups:!0},lt={strict:!0,defaultSet:Gi,defaultType:"unknown",components:{vcard:GH,vcard3:QH,vevent:Gi,vtodo:Gi,vjournal:Gi,valarm:Gi,vtimezone:Gi,daylight:Gi,standard:Gi},icalendar:Gi,vcard:GH,vcard3:QH,getDesignSet:function(n){return n&&n in lt.components?lt.components[n]:lt.defaultSet}},rv=`\r
`,KH="unknown",I4={'"':"^'","\n":"^n","^":"^^"};function Pt(n){typeof n[0]=="string"&&(n=[n]);let e=0,t=n.length,r="";for(;e<t;e++)r+=Pt.component(n[e])+rv;return r}Pt.component=function(n,e){let t=n[0].toUpperCase(),r="BEGIN:"+t+rv,s=n[1],i=0,a=s.length,o=n[0];for(o==="vcard"&&n[1].length>0&&!(n[1][0][0]==="version"&&n[1][0][3]==="4.0")&&(o="vcard3"),e=e||lt.getDesignSet(o);i<a;i++)r+=Pt.property(s[i],e)+rv;let l=n[2]||[],c=0,d=l.length;for(;c<d;c++)r+=Pt.component(l[c],e)+rv;return r+="END:"+t,r};Pt.property=function(n,e,t){let r=n[0].toUpperCase(),s=n[0],i=n[1];e||(e=lt.defaultSet);let a=i.group,o;e.propertyGroups&&a?o=a.toUpperCase()+"."+r:o=r;for(let[h,p]of Object.entries(i)){if(e.propertyGroups&&h=="group")continue;let m=e.param[h],g=m&&m.multiValue;g&&Array.isArray(p)?(p=p.map(function(y){return y=Pt._rfc6868Unescape(y),y=Pt.paramPropertyValue(y,m.multiValueSeparateDQuote),y}),p=Pt.multiValue(p,g,"unknown",null,e)):(p=Pt._rfc6868Unescape(p),p=Pt.paramPropertyValue(p)),o+=";"+h.toUpperCase()+"="+p}if(n.length===3)return o+":";let l=n[2],c,d=!1,u=!1,f=!1;return s in e.property?(c=e.property[s],"multiValue"in c&&(d=c.multiValue),"structuredValue"in c&&Array.isArray(n[3])&&(u=c.structuredValue),"defaultType"in c?l===c.defaultType&&(f=!0):l===KH&&(f=!0)):l===KH&&(f=!0),f||(o+=";VALUE="+l.toUpperCase()),o+=":",d&&u?o+=Pt.multiValue(n[3],u,l,d,e,u):d?o+=Pt.multiValue(n.slice(3),d,l,null,e,!1):u?o+=Pt.multiValue(n[3],u,l,null,e,u):o+=Pt.value(n[3],l,e,!1),t?o:eB(o)};Pt.paramPropertyValue=function(n,e){return!e&&n.indexOf(",")===-1&&n.indexOf(":")===-1&&n.indexOf(";")===-1?n:'"'+n+'"'};Pt.multiValue=function(n,e,t,r,s,i){let a="",o=n.length,l=0;for(;l<o;l++)r&&Array.isArray(n[l])?a+=Pt.multiValue(n[l],r,t,null,s,i):a+=Pt.value(n[l],t,s,i),l!==o-1&&(a+=e);return a};Pt.value=function(n,e,t,r){return e in t.value&&"toICAL"in t.value[e]?t.value[e].toICAL(n,r):n};Pt._rfc6868Unescape=function(n){return n.replace(/[\n^"]/g,function(e){return I4[e]})};var ZH=0,ev=1,tv=2,qa=3,fl=class n{static fromString(e,t){return new n(it.property(e,t))}constructor(e,t){this._parent=t||null,typeof e=="string"?(this.jCal=[e,{},lt.defaultType],this.jCal[tv]=this.getDefaultType()):this.jCal=e,this._updateType()}get type(){return this.jCal[tv]}get name(){return this.jCal[ZH]}get parent(){return this._parent}set parent(e){let t=!this._parent||e&&e._designSet!=this._parent._designSet;this._parent=e,this.type==lt.defaultType&&t&&(this.jCal[tv]=this.getDefaultType(),this._updateType())}get _designSet(){return this.parent?this.parent._designSet:lt.defaultSet}_updateType(){let e=this._designSet;this.type in e.value&&("decorate"in e.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in e.property&&(this.isMultiValue="multiValue"in e.property[this.name],this.isStructuredValue="structuredValue"in e.property[this.name]))}_hydrateValue(e){return this._values&&this._values[e]?this._values[e]:this.jCal.length<=qa+e?null:this.isDecorated?(this._values||(this._values=[]),this._values[e]=this._decorate(this.jCal[qa+e])):this.jCal[qa+e]}_decorate(e){return this._designSet.value[this.type].decorate(e,this)}_undecorate(e){return this._designSet.value[this.type].undecorate(e,this)}_setDecoratedValue(e,t){this._values||(this._values=[]),typeof e=="object"&&"icaltype"in e?(this.jCal[qa+t]=this._undecorate(e),this._values[t]=e):(this.jCal[qa+t]=e,this._values[t]=this._decorate(e))}getParameter(e){if(e in this.jCal[ev])return this.jCal[ev][e]}getFirstParameter(e){let t=this.getParameter(e);return Array.isArray(t)?t[0]:t}setParameter(e,t){let r=e.toLowerCase();typeof t=="string"&&r in this._designSet.param&&"multiValue"in this._designSet.param[r]&&(t=[t]),this.jCal[ev][e]=t}removeParameter(e){delete this.jCal[ev][e]}getDefaultType(){let e=this.jCal[ZH],t=this._designSet;if(e in t.property){let r=t.property[e];if("defaultType"in r)return r.defaultType}return lt.defaultType}resetType(e){this.removeAllValues(),this.jCal[tv]=e,this._updateType()}getFirstValue(){return this._hydrateValue(0)}getValues(){let e=this.jCal.length-qa;if(e<1)return[];let t=0,r=[];for(;t<e;t++)r[t]=this._hydrateValue(t);return r}removeAllValues(){this._values&&(this._values.length=0),this.jCal.length=3}setValues(e){if(!this.isMultiValue)throw new Error(this.name+`: does not not support mulitValue.
override isMultiValue`);let t=e.length,r=0;if(this.removeAllValues(),t>0&&typeof e[0]=="object"&&"icaltype"in e[0]&&this.resetType(e[0].icaltype),this.isDecorated)for(;r<t;r++)this._setDecoratedValue(e[r],r);else for(;r<t;r++)this.jCal[qa+r]=e[r]}setValue(e){this.removeAllValues(),typeof e=="object"&&"icaltype"in e&&this.resetType(e.icaltype),this.isDecorated?this._setDecoratedValue(e,0):this.jCal[qa]=e}toJSON(){return this.jCal}toICALString(){return Pt.property(this.jCal,this._designSet,!0)}},Ga=0,hi=1,Qa=2,R4=0,N4=3,pn=class n{constructor(e,t){R(this,"_hydratedPropertyCount",0);R(this,"_hydratedComponentCount",0);R(this,"_timezoneCache",null);R(this,"_components",null);R(this,"_properties",null);typeof e=="string"&&(e=[e,[],[]]),this.jCal=e,this.parent=t||null,!this.parent&&this.name==="vcalendar"&&(this._timezoneCache=new Map)}static fromString(e){return new n(it.component(e))}get name(){return this.jCal[Ga]}get _designSet(){var t;let e=this.parent&&this.parent._designSet;if(!e&&this.name=="vcard"){let r=(t=this.jCal[hi])==null?void 0:t[0];if(r&&r[R4]=="version"&&r[N4]=="3.0")return lt.getDesignSet("vcard3")}return e||lt.getDesignSet(this.name)}_hydrateComponent(e){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[e])return this._components[e];let t=new n(this.jCal[Qa][e],this);return this._hydratedComponentCount++,this._components[e]=t}_hydrateProperty(e){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[e])return this._properties[e];let t=new fl(this.jCal[hi][e],this);return this._hydratedPropertyCount++,this._properties[e]=t}getFirstSubcomponent(e){if(e){let t=0,r=this.jCal[Qa],s=r.length;for(;t<s;t++)if(r[t][Ga]===e)return this._hydrateComponent(t)}else if(this.jCal[Qa].length)return this._hydrateComponent(0);return null}getAllSubcomponents(e){let t=this.jCal[Qa].length,r=0;if(e){let s=this.jCal[Qa],i=[];for(;r<t;r++)e===s[r][Ga]&&i.push(this._hydrateComponent(r));return i}else{if(!this._components||this._hydratedComponentCount!==t)for(;r<t;r++)this._hydrateComponent(r);return this._components||[]}}hasProperty(e){let t=this.jCal[hi],r=t.length,s=0;for(;s<r;s++)if(t[s][Ga]===e)return!0;return!1}getFirstProperty(e){if(e){let t=0,r=this.jCal[hi],s=r.length;for(;t<s;t++)if(r[t][Ga]===e)return this._hydrateProperty(t)}else if(this.jCal[hi].length)return this._hydrateProperty(0);return null}getFirstPropertyValue(e){let t=this.getFirstProperty(e);return t?t.getFirstValue():null}getAllProperties(e){let t=this.jCal[hi].length,r=0;if(e){let s=this.jCal[hi],i=[];for(;r<t;r++)e===s[r][Ga]&&i.push(this._hydrateProperty(r));return i}else{if(!this._properties||this._hydratedPropertyCount!==t)for(;r<t;r++)this._hydrateProperty(r);return this._properties||[]}}_removeObjectByIndex(e,t,r){if(t=t||[],t[r]){let s=t[r];"parent"in s&&(s.parent=null)}t.splice(r,1),this.jCal[e].splice(r,1)}_removeObject(e,t,r){let s=0,i=this.jCal[e],a=i.length,o=this[t];if(typeof r=="string"){for(;s<a;s++)if(i[s][Ga]===r)return this._removeObjectByIndex(e,o,s),!0}else if(o){for(;s<a;s++)if(o[s]&&o[s]===r)return this._removeObjectByIndex(e,o,s),!0}return!1}_removeAllObjects(e,t,r){let s=this[t],i=this.jCal[e],a=i.length-1;for(;a>=0;a--)(!r||i[a][Ga]===r)&&this._removeObjectByIndex(e,s,a)}addSubcomponent(e){this._components||(this._components=[],this._hydratedComponentCount=0),e.parent&&e.parent.removeSubcomponent(e);let t=this.jCal[Qa].push(e.jCal);return this._components[t-1]=e,this._hydratedComponentCount++,e.parent=this,e}removeSubcomponent(e){let t=this._removeObject(Qa,"_components",e);return t&&this._hydratedComponentCount--,t}removeAllSubcomponents(e){let t=this._removeAllObjects(Qa,"_components",e);return this._hydratedComponentCount=0,t}addProperty(e){if(!(e instanceof fl))throw new TypeError("must be instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),e.parent&&e.parent.removeProperty(e);let t=this.jCal[hi].push(e.jCal);return this._properties[t-1]=e,this._hydratedPropertyCount++,e.parent=this,e}addPropertyWithValue(e,t){let r=new fl(e);return r.setValue(t),this.addProperty(r),r}updatePropertyWithValue(e,t){let r=this.getFirstProperty(e);return r?r.setValue(t):r=this.addPropertyWithValue(e,t),r}removeProperty(e){let t=this._removeObject(hi,"_properties",e);return t&&this._hydratedPropertyCount--,t}removeAllProperties(e){let t=this._removeAllObjects(hi,"_properties",e);return this._hydratedPropertyCount=0,t}toJSON(){return this.jCal}toString(){return Pt.component(this.jCal,this._designSet)}getTimeZoneByID(e){if(this.parent)return this.parent.getTimeZoneByID(e);if(!this._timezoneCache)return null;if(this._timezoneCache.has(e))return this._timezoneCache.get(e);let t=this.getAllSubcomponents("vtimezone");for(let r of t)if(r.getFirstProperty("tzid").getFirstValue()===e){let s=new ot({component:r,tzid:e});return this._timezoneCache.set(e,s),s}return null}},ov=class{constructor(e){R(this,"complete",!1);R(this,"ruleIterators",null);R(this,"ruleDates",null);R(this,"exDates",null);R(this,"ruleDateInc",0);R(this,"exDateInc",0);R(this,"exDate",null);R(this,"ruleDate",null);R(this,"dtstart",null);R(this,"last",null);this.ruleDates=[],this.exDates=[],this.fromData(e)}fromData(e){let t=Qi(e.dtstart,ce);if(t)this.dtstart=t;else throw new Error(".dtstart (ICAL.Time) must be given");if(e.component)this._init(e.component);else{if(this.last=Qi(e.last,ce)||t.clone(),!e.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=e.ruleIterators.map(function(r){return Qi(r,bp)}),this.ruleDateInc=e.ruleDateInc,this.exDateInc=e.exDateInc,e.ruleDates&&(this.ruleDates=e.ruleDates.map(r=>Qi(r,ce)),this.ruleDate=this.ruleDates[this.ruleDateInc]),e.exDates&&(this.exDates=e.exDates.map(r=>Qi(r,ce)),this.exDate=this.exDates[this.exDateInc]),typeof e.complete!="undefined"&&(this.complete=e.complete)}}_compare_special(e,t){return!e.isDate&&t.isDate?new ce({year:e.year,month:e.month,day:e.day}).compare(t):e.compare(t)}next(){let e,t,r,s=500,i=0;for(;;){if(i++>s)throw new Error("max tries have occurred, rule may be impossible to fulfill.");if(t=this.ruleDate,e=this._nextRecurrenceIter(this.last),!t&&!e){this.complete=!0;break}if((!t||e&&t.compare(e.last)>0)&&(t=e.last.clone(),e.next()),this.ruleDate===t&&this._nextRuleDay(),this.last=t,this.exDate&&(r=this._compare_special(this.last,this.exDate),r>0&&this._nextExDay(),r===0)){this._nextExDay();continue}return this.last}}toJSON(){function e(r){return r.toJSON()}let t=Object.create(null);return t.ruleIterators=this.ruleIterators.map(e),this.ruleDates&&(t.ruleDates=this.ruleDates.map(e)),this.exDates&&(t.exDates=this.exDates.map(e)),t.ruleDateInc=this.ruleDateInc,t.exDateInc=this.exDateInc,t.last=this.last.toJSON(),t.dtstart=this.dtstart.toJSON(),t.complete=this.complete,t}_extractDates(e,t){let r=[],s=e.getAllProperties(t);for(let i=0,a=s.length;i<a;i++)for(let o of s[i].getValues()){let l=hl(r,o,(c,d)=>c.compare(d));r.splice(l,0,o)}return r}_init(e){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!e.hasProperty("rdate")&&!e.hasProperty("rrule")&&!e.hasProperty("recurrence-id")){this.ruleDate=this.last.clone(),this.complete=!0;return}if(e.hasProperty("rdate")&&(this.ruleDates=this._extractDates(e,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=hl(this.ruleDates,this.last,(t,r)=>t.compare(r)),this.ruleDate=this.ruleDates[this.ruleDateInc]),e.hasProperty("rrule")){let t=e.getAllProperties("rrule"),r=0,s=t.length,i,a;for(;r<s;r++)i=t[r].getFirstValue(),a=i.iterator(this.dtstart),this.ruleIterators.push(a),a.next()}e.hasProperty("exdate")&&(this.exDates=this._extractDates(e,"exdate"),this.exDateInc=hl(this.exDates,this.last,this._compare_special),this.exDate=this.exDates[this.exDateInc])}_nextExDay(){this.exDate=this.exDates[++this.exDateInc]}_nextRuleDay(){this.ruleDate=this.ruleDates[++this.ruleDateInc]}_nextRecurrenceIter(){let e=this.ruleIterators;if(e.length===0)return null;let t=e.length,r,s,i=0,a;for(;i<t;i++){if(r=e[i],s=r.last,r.completed){t--,i!==0&&i--,e.splice(i,1);continue}(!a||a.last.compare(s)>0)&&(a=r)}return a}},vp=class vp{constructor(e,t){R(this,"exceptions",null);R(this,"strictExceptions",!1);e instanceof pn||(t=e,e=null),e?this.component=e:this.component=new pn("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],t&&t.strictExceptions&&(this.strictExceptions=t.strictExceptions),t&&t.exceptions?t.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach(function(r){r.hasProperty("recurrence-id")&&this.relateException(r)},this)}relateException(e){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(e instanceof pn&&(e=new vp(e)),this.strictExceptions&&e.uid!==this.uid)throw new Error("attempted to relate unrelated exception");let t=e.recurrenceId.toString();if(this.exceptions[t]=e,e.modifiesFuture()){let r=[e.recurrenceId.toUnixTime(),t],s=hl(this.rangeExceptions,r,XH);this.rangeExceptions.splice(s,0,r)}}modifiesFuture(){return this.component.hasProperty("recurrence-id")?this.component.getFirstProperty("recurrence-id").getParameter("range")===vp.THISANDFUTURE:!1}findRangeException(e){if(!this.rangeExceptions.length)return null;let t=e.toUnixTime(),r=hl(this.rangeExceptions,[t],XH);if(r-=1,r<0)return null;let s=this.rangeExceptions[r];return t<s[0]?null:s[1]}getOccurrenceDetails(e){let t=e.toString(),r=e.convertToZone(ot.utcTimezone).toString(),s,i={recurrenceId:e};if(t in this.exceptions)s=i.item=this.exceptions[t],i.startDate=s.startDate,i.endDate=s.endDate,i.item=s;else if(r in this.exceptions)s=this.exceptions[r],i.startDate=s.startDate,i.endDate=s.endDate,i.item=s;else{let a=this.findRangeException(e),o;if(a){let l=this.exceptions[a];i.item=l;let c=this._rangeExceptionCache[a];if(!c){let u=l.recurrenceId.clone(),f=l.startDate.clone();u.zone=f.zone,c=f.subtractDate(u),this._rangeExceptionCache[a]=c}let d=e.clone();d.zone=l.startDate.zone,d.addDuration(c),o=d.clone(),o.addDuration(l.duration),i.startDate=d,i.endDate=o}else o=e.clone(),o.addDuration(this.duration),i.endDate=o,i.startDate=e,i.item=this}return i}iterator(e){return new ov({component:this.component,dtstart:e||this.startDate})}isRecurring(){let e=this.component;return e.hasProperty("rrule")||e.hasProperty("rdate")}isRecurrenceException(){return this.component.hasProperty("recurrence-id")}getRecurrenceTypes(){let e=this.component.getAllProperties("rrule"),t=0,r=e.length,s=Object.create(null);for(;t<r;t++){let i=e[t].getFirstValue();s[i.freq]=!0}return s}get uid(){return this._firstProp("uid")}set uid(e){this._setProp("uid",e)}get startDate(){return this._firstProp("dtstart")}set startDate(e){this._setTime("dtstart",e)}get endDate(){let e=this._firstProp("dtend");if(!e){let t=this._firstProp("duration");e=this.startDate.clone(),t?e.addDuration(t):e.isDate&&(e.day+=1)}return e}set endDate(e){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",e)}get duration(){let e=this._firstProp("duration");return e||this.endDate.subtractDateTz(this.startDate)}set duration(e){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",e)}get location(){return this._firstProp("location")}set location(e){this._setProp("location",e)}get attendees(){return this.component.getAllProperties("attendee")}get summary(){return this._firstProp("summary")}set summary(e){this._setProp("summary",e)}get description(){return this._firstProp("description")}set description(e){this._setProp("description",e)}get color(){return this._firstProp("color")}set color(e){this._setProp("color",e)}get organizer(){return this._firstProp("organizer")}set organizer(e){this._setProp("organizer",e)}get sequence(){return this._firstProp("sequence")}set sequence(e){this._setProp("sequence",e)}get recurrenceId(){return this._firstProp("recurrence-id")}set recurrenceId(e){this._setTime("recurrence-id",e)}_setTime(e,t){let r=this.component.getFirstProperty(e);r||(r=new fl(e),this.component.addProperty(r)),t.zone===ot.localTimezone||t.zone===ot.utcTimezone?r.removeParameter("tzid"):r.setParameter("tzid",t.zone.tzid),r.setValue(t)}_setProp(e,t){this.component.updatePropertyWithValue(e,t)}_firstProp(e){return this.component.getFirstPropertyValue(e)}toString(){return this.component.toString()}};R(vp,"THISANDFUTURE","THISANDFUTURE");var lv=vp;function XH(n,e){return n[0]>e[0]?1:e[0]>n[0]?-1:0}var $S=class{constructor(e){R(this,"parseEvent",!0);R(this,"parseTimezone",!0);R(this,"oncomplete",function(){});R(this,"onerror",function(e){});R(this,"ontimezone",function(e){});R(this,"onevent",function(e){});typeof e=="undefined"&&(e={});for(let[t,r]of Object.entries(e))this[t]=r}process(e){typeof e=="string"&&(e=it(e)),e instanceof pn||(e=new pn(e));let t=e.getAllSubcomponents(),r=0,s=t.length,i;for(;r<s;r++)switch(i=t[r],i.name){case"vtimezone":if(this.parseTimezone){let a=i.getFirstPropertyValue("tzid");a&&this.ontimezone(new ot({tzid:a,component:i}))}break;case"vevent":this.parseEvent&&this.onevent(new lv(i));break;default:continue}this.oncomplete()}},fi={foldLength:75,debug:!1,newLineChar:`\r
`,Binary:sv,Component:pn,ComponentParser:$S,Duration:js,Event:lv,Period:Tp,Property:fl,Recur:In,RecurExpansion:ov,RecurIterator:bp,Time:ce,Timezone:ot,TimezoneService:iv,UtcOffset:Ki,VCardTime:ul,parse:it,stringify:Pt,design:lt,helpers:y4};var cv=class extends li{constructor(t){super();this.subscriptions=[];this.cache=new Map;this.refreshTimers=new Map;this.fileWatchers=new Map;this.plugin=t}async initialize(){await this.loadSubscriptions(),this.subscriptions.forEach(t=>{t.enabled&&(t.type==="remote"?this.startRefreshTimer(t):t.type==="local"&&this.startFileWatcher(t))}),this.emit("data-changed")}async loadSubscriptions(){try{let t=await this.plugin.loadData();this.subscriptions=(t==null?void 0:t.icsSubscriptions)||[]}catch(t){console.error("Failed to load ICS subscriptions:",t),this.subscriptions=[]}}async saveSubscriptions(){try{let t=await this.plugin.loadData()||{};t.icsSubscriptions=this.subscriptions,await this.plugin.saveData(t)}catch(t){throw console.error("Failed to save ICS subscriptions:",t),t}}getSubscriptions(){return[...this.subscriptions]}async addSubscription(t){let r={...t,id:this.generateId()};return this.subscriptions.push(r),await this.saveSubscriptions(),r.enabled&&(r.type==="remote"?(this.startRefreshTimer(r),await this.fetchSubscription(r.id)):r.type==="local"&&(this.startFileWatcher(r),await this.fetchSubscription(r.id))),this.emit("data-changed"),r}async updateSubscription(t,r){let s=this.subscriptions.findIndex(o=>o.id===t);if(s===-1)throw new Error("Subscription not found");let i=this.subscriptions[s],a={...i,...r};this.subscriptions[s]=a,await this.saveSubscriptions(),this.stopRefreshTimer(t),this.stopFileWatcher(t),a.enabled&&(a.type==="remote"?this.startRefreshTimer(a):a.type==="local"&&this.startFileWatcher(a)),(r.url&&r.url!==i.url||r.filePath&&r.filePath!==i.filePath)&&this.cache.delete(t),this.emit("data-changed")}async removeSubscription(t){let r=this.subscriptions.findIndex(s=>s.id===t);if(r===-1)throw new Error("Subscription not found");this.subscriptions.splice(r,1),await this.saveSubscriptions(),this.stopRefreshTimer(t),this.stopFileWatcher(t),this.cache.delete(t),this.emit("data-changed")}async fetchSubscription(t){let r=this.subscriptions.find(s=>s.id===t);if(!(!r||!r.enabled))try{let s;if(r.type==="remote"){if(!r.url)throw new Error("Remote subscription missing URL");s=(await(0,Xi.requestUrl)({url:r.url,method:"GET",headers:{Accept:"text/calendar,*/*;q=0.1","Accept-Language":"en-US,en;q=0.9","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}})).text}else if(r.type==="local"){if(!r.filePath)throw new Error("Local subscription missing file path");s=await this.readLocalICSFile(r.filePath)}else throw new Error("Unknown subscription type");let i=this.parseICS(s,r.id),a={subscriptionId:t,events:i,lastUpdated:new Date().toISOString(),expires:new Date(Date.now()+r.refreshInterval*60*1e3).toISOString()};this.cache.set(t,a),await this.updateSubscription(t,{lastFetched:new Date().toISOString(),lastError:void 0}),this.emit("data-changed")}catch(s){let i=s instanceof Error?s.message:String(s);await this.updateSubscription(t,{lastError:i}),r.type==="remote"?i.includes("404")?new Xi.Notice(`Calendar "${r.name}" not found (404). Please check the ICS URL is correct and the calendar is publicly accessible.`):i.includes("500")||i.includes("OwaBasicUnsupportedException")?new Xi.Notice(`Calendar "${r.name}" access denied (500). This may be due to Microsoft Outlook server restrictions. Try regenerating the ICS URL from your calendar settings.`):new Xi.Notice(`Failed to fetch remote calendar "${r.name}": ${i}`):new Xi.Notice(`Failed to read local calendar "${r.name}": ${i}`)}}parseICS(t,r){try{let s=fi.parse(t),i=new fi.Component(s);i.getAllSubcomponents("vtimezone").forEach(d=>{fi.TimezoneService.register(d)});let o=i.getAllSubcomponents("vevent"),l=[],c=new Map;return o.forEach(d=>{let u=new fi.Event(d),f=u.uid;if(!f)return;let h=d.getFirstPropertyValue("recurrence-id");if(h){c.has(f)||c.set(f,new Map);let p=h.toString();c.get(f).set(p,u)}}),o.forEach(d=>{try{let u=new fi.Event(d);if(d.getFirstPropertyValue("recurrence-id"))return;let h=u.summary||"Untitled Event",p=u.description||void 0,m=u.location||void 0,g=u.startDate,y=u.endDate;if(!g)return;let T=g.isDate,w=g.toJSDate().toISOString(),b=y?y.toJSDate().toISOString():void 0,E=u.uid||`${r}-${l.length}`,S=`${r}-${E}`,D={id:S,subscriptionId:r,title:h,description:p,start:w,end:b,allDay:T,location:m,url:u.url||void 0};if(u.isRecurring()){let x=new Set;d.getAllProperties("exdate").forEach(U=>{let V=U.getFirstValue();V&&(Array.isArray(V)?V:[V]).forEach($=>{$&&typeof $.toString=="function"&&x.add($.toString())})});let B=c.get(E)||new Map,Q=u.iterator(g),P=new fi.Time;P.fromJSDate(new Date(Date.now()+365*24*60*60*1e3));let I,A=0,j=100;for(;(I=Q.next())&&A<j&&!(I.compare(P)>0);){let U=I.toString();if(x.has(U)){A++;continue}let V=B.get(U);if(V){let F=V.startDate,$=V.endDate;F&&l.push({id:`${S}-${A}`,subscriptionId:r,title:V.summary||h,description:V.description||p,start:F.toJSDate().toISOString(),end:$?$.toJSDate().toISOString():void 0,allDay:F.isDate,location:V.location||m,url:V.url||D.url})}else{let F=I.toJSDate().toISOString(),$=b;if(y&&g){let Z=y.toJSDate().getTime()-g.toJSDate().getTime();$=new Date(I.toJSDate().getTime()+Z).toISOString()}l.push({...D,id:`${S}-${A}`,start:F,end:$})}A++}}else l.push(D)}catch(u){console.warn("Failed to parse individual event:",u)}}),l}catch(s){throw console.error("Failed to parse ICS data:",s),new Error("Invalid ICS format")}}getAllEvents(){let t=[];return this.cache.forEach(r=>{new Date(r.expires)>new Date&&t.push(...r.events)}),t}getEventsForSubscription(t){let r=this.cache.get(t);return!r||new Date(r.expires)<=new Date?[]:[...r.events]}async refreshAllSubscriptions(){let t=this.subscriptions.filter(r=>r.enabled);for(let r of t)await this.fetchSubscription(r.id)}async readLocalICSFile(t){try{let r=this.plugin.app.vault.getAbstractFileByPath(t);if(!r||!(r instanceof Xi.TFile))throw new Error(`File not found: ${t}`);if(r.extension!=="ics")throw new Error(`File is not an ICS file: ${t}`);return await this.plugin.app.vault.cachedRead(r)}catch(r){throw new Error(`Failed to read local ICS file "${t}": ${r instanceof Error?r.message:String(r)}`)}}startFileWatcher(t){if(!t.filePath)return;this.stopFileWatcher(t.id);let r=(c,d)=>{(c.path===t.filePath||d===t.filePath)&&setTimeout(()=>{this.fetchSubscription(t.id)},1e3)},s=this.plugin.app.vault.on("modify",r),i=this.plugin.app.vault.on("rename",r),a=this.plugin.app.vault.on("delete",c=>{c.path===t.filePath&&this.updateSubscription(t.id,{lastError:"Local ICS file was deleted"})});this.fileWatchers.set(t.id,()=>{this.plugin.app.vault.offref(s),this.plugin.app.vault.offref(i),this.plugin.app.vault.offref(a)});let o=t.refreshInterval*60*1e3,l=setInterval(()=>{this.fetchSubscription(t.id)},o);this.refreshTimers.set(t.id,l)}stopFileWatcher(t){let r=this.fileWatchers.get(t);r&&(r(),this.fileWatchers.delete(t))}async refreshSubscription(t){await this.fetchSubscription(t)}startRefreshTimer(t){this.stopRefreshTimer(t.id);let r=t.refreshInterval*60*1e3,s=setInterval(()=>{this.fetchSubscription(t.id)},r);this.refreshTimers.set(t.id,s)}stopRefreshTimer(t){let r=this.refreshTimers.get(t);r&&(clearInterval(r),this.refreshTimers.delete(t))}generateId(){return"ics_"+Math.random().toString(36).substring(2,11)+Date.now().toString(36)}destroy(){this.refreshTimers.forEach(t=>clearInterval(t)),this.refreshTimers.clear(),this.fileWatchers.forEach(t=>t()),this.fileWatchers.clear(),this.cache.clear(),this.removeAllListeners()}getLocalICSFiles(){return this.plugin.app.vault.getFiles().filter(t=>t.extension==="ics").sort((t,r)=>t.path.localeCompare(r.path))}};var Ji=require("obsidian");Ft();Ne();At();var dv=class{constructor(e){this.plugin=e}async createTaskFromICS(e,t){try{let r=this.plugin.icsSubscriptionService.getSubscriptions().find(o=>o.id===e.subscriptionId),s=(r==null?void 0:r.name)||"Unknown Calendar",i=(t==null?void 0:t.scheduled)!==void 0?t.scheduled:this.computeScheduledFromICSEvent(e),a={title:(t==null?void 0:t.title)||e.title,status:(t==null?void 0:t.status)||this.plugin.settings.defaultTaskStatus,priority:(t==null?void 0:t.priority)||this.plugin.settings.defaultTaskPriority,due:(t==null?void 0:t.due)||void 0,scheduled:i,contexts:(t==null?void 0:t.contexts)||(e.location?[e.location]:void 0),projects:t==null?void 0:t.projects,tags:(t==null?void 0:t.tags)||[this.plugin.fieldMapper.toUserField("icsEventTag")],timeEstimate:(t==null?void 0:t.timeEstimate)||this.calculateEventDuration(e),details:(t==null?void 0:t.details)||this.buildICSEventDetails(e,s),icsEventId:[e.id],creationContext:"ics-event",dateCreated:Ue(),dateModified:Ue(),...t};return await this.plugin.taskService.createTask(a)}catch(r){let s=r instanceof Error?r.message:String(r);throw console.error("Error creating task from ICS event:",{error:s,icsEventId:e.id,icsEventTitle:e.title}),new Error(`Failed to create task from ICS event: ${s}`)}}computeScheduledFromICSEvent(e){try{if(!e.start)return;let t=new Date(e.start);return e.allDay?ue(t):C(t,"yyyy-MM-dd'T'HH:mm")}catch(t){return console.warn("Failed to compute scheduled from ICS event start:",{start:e.start,error:t}),e.start}}async createNoteFromICS(e,t){var r;try{let s=this.plugin.icsSubscriptionService.getSubscriptions().find(w=>w.id===e.subscriptionId),i=(s==null?void 0:s.name)||"Unknown Calendar",a=(t==null?void 0:t.title)||`${e.title} - ${C(new Date(e.start),"PPP")}`,o=(t==null?void 0:t.folder)||((r=this.plugin.settings.icsIntegration)==null?void 0:r.defaultNoteFolder)||"",l={title:e.title,priority:"",status:"",date:new Date(e.start),dueDate:e.end,scheduledDate:e.start,icsEventTitle:e.title,icsEventLocation:e.location,icsEventDescription:e.description},c=dN(l,this.plugin.settings),d=await Yu(c,o,this.plugin.app.vault),u=o?`${o}/${d}.md`:`${d}.md`;o&&await Gl(this.plugin.app.vault,o);let f={title:a,priority:"",status:"",contexts:e.location?[e.location]:[],tags:[this.plugin.fieldMapper.toUserField("icsEventTag")],timeEstimate:0,dueDate:e.end||"",scheduledDate:e.start||"",details:e.description||"",parentNote:"",icsEventTitle:e.title,icsEventStart:e.start,icsEventEnd:e.end||"",icsEventLocation:e.location||"",icsEventDescription:e.description||"",icsEventUrl:e.url||"",icsEventSubscription:i,icsEventId:e.id},h={title:a,dateCreated:Ue(),dateModified:Ue(),tags:[this.plugin.fieldMapper.toUserField("icsEventTag")],[this.plugin.fieldMapper.toUserField("icsEventId")]:[e.id]},p=this.buildICSEventDetails(e,i);if(t!=null&&t.template)try{let w=(0,Ji.normalizePath)(t.template.trim()),b=this.plugin.app.vault.getAbstractFileByPath(w.endsWith(".md")?w:`${w}.md`);if(b instanceof Ji.TFile){let E=await this.plugin.app.vault.read(b),S=Wy(E,f);h={...h,...S.frontmatter},p=S.body||p}else console.warn(`ICS note template not found: ${w}`),new Ji.Notice(`Template not found: ${w}`)}catch(w){console.error("Error processing ICS note template:",w),new Ji.Notice(`Error processing template: ${t.template}`)}let g=`${Object.keys(h).length>0?`---
${Object.entries(h).map(([w,b])=>`${w}: ${this.formatYamlValue(b)}`).join(`
`)}
---

`:""}${p}`,y=await this.plugin.app.vault.create(u,g),T={title:a,path:y.path,tags:h.tags||[],createdDate:h.dateCreated,lastModified:Date.now()};return{file:y,noteInfo:T}}catch(s){let i=s instanceof Error?s.message:String(s);throw console.error("Error creating note from ICS event:",{error:i,icsEventId:e.id,icsEventTitle:e.title}),new Error(`Failed to create note from ICS event: ${i}`)}}async findRelatedNotes(e){try{let t=[],r=this.plugin.fieldMapper.toUserField("icsEventId"),s=await this.plugin.cacheManager.getAllTasks();for(let a of s)a.icsEventId&&a.icsEventId.includes(e.id)&&t.push(a);let i=this.plugin.app.vault.getMarkdownFiles();for(let a of i)try{let o=this.plugin.app.metadataCache.getFileCache(a),l=o==null?void 0:o.frontmatter,c=l==null?void 0:l[r],d=Array.isArray(c)?c.includes(e.id):c===e.id;if(l&&d){let u={title:l.title||a.basename,path:a.path,tags:l.tags||[],createdDate:l.dateCreated,lastModified:a.stat.mtime};t.push(u)}}catch(o){continue}return t}catch(t){return console.error("Error finding related notes for ICS event:",t),[]}}async linkNoteToICS(e,t){try{let r=this.plugin.app.vault.getAbstractFileByPath(e);if(!(r instanceof Ji.TFile))throw new Error(`Cannot find note file: ${e}`);await this.plugin.app.fileManager.processFrontMatter(r,s=>{let i=this.plugin.fieldMapper.toUserField("icsEventId"),a=s[i];a?Array.isArray(a)||(a=[a]):a=[],a.includes(t.id)||a.push(t.id),s[i]=a,s.dateModified=Ue()}),new Ji.Notice(`Linked note to ICS event: ${t.title}`)}catch(r){let s=r instanceof Error?r.message:String(r);throw console.error("Error linking note to ICS event:",{error:s,notePath:e,icsEventId:t.id}),new Error(`Failed to link note to ICS event: ${s}`)}}buildICSEventDetails(e,t){let r=[];if(r.push(`# ${e.title}`),r.push(""),e.start){let s=new Date(e.start);r.push(`**Start:** ${C(s,"PPPp")}`)}if(e.end&&!e.allDay){let s=new Date(e.end);r.push(`**End:** ${C(s,"PPPp")}`)}return e.location&&r.push(`**Location:** ${e.location}`),r.push(`**Calendar:** ${t}`),e.description&&(r.push(""),r.push("## Description"),r.push(e.description)),e.url&&(r.push(""),r.push(`**Event URL:** ${e.url}`)),r.join(`
`)}formatYamlValue(e){return typeof e=="string"?e.includes(":")||e.includes("#")||e.includes("[")||e.includes("{")?`"${e.replace(/"/g,'\\"')}"`:e:Array.isArray(e)?`[${e.map(t=>typeof t=="string"?`"${t}"`:t).join(", ")}]`:String(e)}calculateEventDuration(e){if(!(!e.start||!e.end))try{let t=new Date(e.start).getTime(),r=new Date(e.end).getTime();if(isNaN(t)||isNaN(r))return;let s=r-t,i=Math.round(s/(1e3*60));return i>0&&i<1440?i:void 0}catch(t){console.warn("Error calculating event duration:",t);return}}};At();var uv=class{constructor(e){this.migrationInProgress=!1;this.app=e}async needsMigration(){var t;let e=this.app.vault.getMarkdownFiles().filter(r=>{var s,i;return r.path.includes("task")||((i=(s=this.app.metadataCache.getFileCache(r))==null?void 0:s.frontmatter)==null?void 0:i.status)});for(let r of e){let s=(t=this.app.metadataCache.getFileCache(r))==null?void 0:t.frontmatter;if(s!=null&&s.recurrence&&typeof s.recurrence=="object")return!0}return!1}async getMigrationCount(){var r;let e=this.app.vault.getMarkdownFiles().filter(s=>{var i,a;return s.path.includes("task")||((a=(i=this.app.metadataCache.getFileCache(s))==null?void 0:i.frontmatter)==null?void 0:a.status)}),t=0;for(let s of e){let i=(r=this.app.metadataCache.getFileCache(s))==null?void 0:r.frontmatter;i!=null&&i.recurrence&&typeof i.recurrence=="object"&&t++}return t}async performMigration(e){if(this.migrationInProgress)throw new Error("Migration already in progress");this.migrationInProgress=!0;let t=[],r=0;try{let s=this.app.vault.getMarkdownFiles().filter(a=>{var l;let o=(l=this.app.metadataCache.getFileCache(a))==null?void 0:l.frontmatter;return(o==null?void 0:o.recurrence)&&typeof o.recurrence=="object"}),i=s.length;for(let a=0;a<s.length;a++){let o=s[a];e&&e(a+1,i,o.name),await this.migrateFile(o).then(()=>{r++}).catch(l=>{let c=`Failed to migrate ${o.path}: ${l instanceof Error?l.message:String(l)}`;t.push(c),console.error(c,l)}),a%10===0&&await new Promise(l=>setTimeout(l,50))}return{success:r,errors:t}}finally{this.migrationInProgress=!1}}async migrateFile(e){await this.app.fileManager.processFrontMatter(e,t=>{if(!(!t.recurrence||typeof t.recurrence!="object"))try{let r=KT(t.recurrence);t.recurrence=r}catch(r){throw new Error(`Failed to convert recurrence to rrule: ${r instanceof Error?r.message:String(r)}`)}})}isMigrationInProgress(){return this.migrationInProgress}};var gs=require("obsidian"),qS=class extends gs.Modal{constructor(t,r){super(t);this.migrationCount=0;this.migrationService=r}async onOpen(){let{contentEl:t}=this;if(t.empty(),this.migrationCount=await this.migrationService.getMigrationCount(),new gs.Setting(t).setName("Recurrence system migration").setHeading(),t.createEl("p",{text:"TaskNotes has an updated, more powerful recurrence system based on the RFC 5545 standard. This migration will convert your existing recurring tasks to use the new format."}),t.createEl("p",{text:`Found ${this.migrationCount} task(s) that need migration.`}),this.migrationCount===0){t.createEl("p",{text:"No migration needed! All your tasks are already using the new recurrence format.",cls:"text-success"}),new gs.Setting(t).addButton(h=>{h.setButtonText("Close").setCta().onClick(()=>this.close())});return}let r=t.createDiv("migration-warning");new gs.Setting(r).setName("\u26A0\uFE0F Important notes").setHeading();let s=r.createEl("ul");s.createEl("li",{text:"We strongly recommend backing up your vault before proceeding."}),s.createEl("li",{text:"The migration will convert your recurrence objects to standardized rrule strings."}),s.createEl("li",{text:"You can continue using your tasks normally after migration."}),s.createEl("li",{text:"The migration is permanent - your legacy recurrence objects will be replaced."});let i=t.createDiv("migration-benefits");new gs.Setting(i).setName("\u2728 What You Get").setHeading();let a=i.createEl("ul");a.createEl("li",{text:'More powerful recurrence patterns (e.g., "every other Tuesday", "last Friday of the month")'}),a.createEl("li",{text:"Better performance for calendar views"}),a.createEl("li",{text:"Improved compatibility with calendar standards"}),a.createEl("li",{text:"Enhanced natural language processing for task creation"});let o=t.createDiv("migration-progress");o.style.display="none",new gs.Setting(o).setName("Migration progress").setHeading();let l=o.createEl("progress");l.max=this.migrationCount,l.value=0;let c=o.createEl("p",{text:"Preparing migration..."}),d=t.createDiv("migration-buttons");d.style.display="flex",d.style.gap="10px",d.style.marginTop="20px";let u=d.createEl("button",{text:"Cancel"});u.onclick=()=>this.close();let f=d.createEl("button",{text:`Migrate ${this.migrationCount} Task(s)`,cls:"mod-cta"});f.onclick=async()=>{f.disabled=!0,u.disabled=!0,o.style.display="block";try{let h=await this.migrationService.performMigration((p,m,g)=>{l.value=p,c.textContent=`Migrating ${p}/${m}: ${g}`});if(c.textContent=`Migration completed! ${h.success} files migrated successfully.`,h.errors.length>0){let p=o.createDiv("migration-errors");new gs.Setting(p).setName("\u26A0\uFE0F Errors Encountered").setHeading();let m=p.createEl("ul");h.errors.forEach(g=>{m.createEl("li",{text:g})}),new gs.Notice(`Migration completed with ${h.errors.length} errors. Check the migration modal for details.`,1e4)}else new gs.Notice(`Migration completed successfully! ${h.success} tasks migrated.`,5e3);f.textContent="Migration Complete",u.textContent="Close",u.disabled=!1}catch(h){c.textContent=`Migration failed: ${h instanceof Error?h.message:String(h)}`,new gs.Notice(`Migration failed: ${h instanceof Error?h.message:String(h)}`,1e4),f.disabled=!1,u.disabled=!1}}}onClose(){let{contentEl:t}=this;t.empty()}};function rB(n,e){let t=new gs.Notice("",0),r=t.messageEl.createDiv();r.style.display="flex",r.style.flexDirection="column",r.style.gap="12px",r.style.padding="8px";let s=r.createSpan();s.textContent="TaskNotes has an updated recurrence system. Migrate your existing recurring tasks to continue using them.",s.style.lineHeight="1.4",s.style.marginBottom="4px";let i=r.createDiv();i.style.display="flex",i.style.gap="8px",i.style.justifyContent="flex-end",i.style.alignItems="center";let a=i.createEl("button",{text:"Migrate Now",cls:"mod-cta"}),o=i.createEl("button",{text:"Remind Later"});a.onclick=()=>{t.hide(),new qS(n,e).open()},o.onclick=()=>{t.hide()}}var GS=require("obsidian"),hv=class{constructor(e){this.statusBarElement=null;this.updateTimeout=null;this.plugin=e,this.requestDeduplicator=new id}initialize(){this.plugin.settings.showTrackedTasksInStatusBar&&(this.statusBarElement=this.plugin.addStatusBarItem(),this.statusBarElement.addClass("tasknotes-status-bar"),this.statusBarElement.style.cursor="pointer",this.statusBarElement.addEventListener("click",()=>{this.handleStatusBarClick()}),this.updateStatusBar())}async updateStatusBar(){if(!(!this.statusBarElement||!this.plugin.settings.showTrackedTasksInStatusBar))try{let e=await this.requestDeduplicator.execute("update-status-bar",()=>this.getTrackedTasks());this.renderStatusBar(e)}catch(e){console.error("Error updating status bar:",e)}}async getTrackedTasks(){return(await this.plugin.cacheManager.getAllTasks()).filter(t=>t.archived?!1:this.plugin.getActiveTimeSession(t)!==null)}renderStatusBar(e){if(!this.statusBarElement)return;let t=e.length;if(t===0){this.statusBarElement.style.display="none";return}this.statusBarElement.style.display="",this.statusBarElement.empty(),this.statusBarElement.createEl("span",{cls:"tasknotes-status-icon",text:"\u23F1\uFE0F"});let r=this.statusBarElement.createEl("span",{cls:"tasknotes-status-text"});if(t===1){let s=e[0],i=s.title.length>30?s.title.substring(0,30)+"...":s.title;r.setText(`Tracking: ${i}`),(0,GS.setTooltip)(this.statusBarElement,`Currently tracking: ${s.title}`,{placement:"top"})}else{r.setText(`Tracking ${t} tasks`);let s=e.slice(0,5).map(a=>a.title).join(`
`),i=t>5?`${s}
... and ${t-5} more`:s;(0,GS.setTooltip)(this.statusBarElement,`Currently tracking:
${i}`,{placement:"top"})}}async handleStatusBarClick(){try{if((await this.getTrackedTasks()).length===0)return;await this.plugin.activateTasksView()}catch(e){console.error("Error handling status bar click:",e)}}requestUpdate(){this.updateTimeout&&window.clearTimeout(this.updateTimeout),this.updateTimeout=window.setTimeout(()=>{this.updateStatusBar()},100)}updateVisibility(){this.plugin.settings.showTrackedTasksInStatusBar?this.statusBarElement?this.updateStatusBar():this.initialize():this.hide()}hide(){this.statusBarElement&&(this.statusBarElement.style.display="none")}destroy(){this.updateTimeout&&(window.clearTimeout(this.updateTimeout),this.updateTimeout=null),this.requestDeduplicator&&this.requestDeduplicator.cancelAll(),this.statusBarElement=null}};var sB=require("obsidian"),fv=class{constructor(e){this.projectIndex=new Map;this.indexLastBuilt=0;this.INDEX_TTL=3e4;this.stats={indexBuilds:0,indexHits:0,indexMisses:0};this.plugin=e}getFilesLinkingToProject(e){let t=this.plugin.app.metadataCache.resolvedLinks,r=[];for(let[s,i]of Object.entries(t))i&&i[e]>0&&r.push(s);return r}getUnresolvedProjectReferences(e){let r=this.plugin.app.metadataCache.unresolvedLinks[e];return r?Object.keys(r).filter(s=>!s.includes("#")&&!s.includes("|")):[]}async getTasksLinkedToProject(e){try{let t=this.getFilesLinkingToProject(e.path),r=[];for(let s of t){let i=await this.plugin.cacheManager.getTaskInfo(s);i&&await this.isLinkFromProjectsField(s,e.path)&&r.push(i)}return r}catch(t){return console.error("Error getting tasks linked to project:",t),[]}}async isTaskUsedAsProject(e){return this.isTaskUsedAsProjectSync(e)}async buildProjectStatusCache(){console.log("[ProjectSubtasksService] Using native APIs, cache building skipped")}async isLinkFromProjectsField(e,t){var r;try{let s=this.plugin.app.vault.getAbstractFileByPath(e);if(!(s instanceof sB.TFile))return!1;let i=this.plugin.app.metadataCache.getFileCache(s),a=this.plugin.fieldMapper.toUserField("projects");if(!((r=i==null?void 0:i.frontmatter)!=null&&r[a]))return!1;let o=i.frontmatter[a];if(!Array.isArray(o))return!1;for(let l of o)if(!(!l||typeof l!="string")&&l.startsWith("[[")&&l.endsWith("]]")){let c=l.slice(2,-2).trim(),d=this.plugin.app.metadataCache.getFirstLinkpathDest(c,e);if(d&&d.path===t)return!0}return!1}catch(s){return console.error("Error checking if link is from projects field:",s),!1}}isTaskUsedAsProjectSync(e){return this.ensureIndexBuilt(),this.projectIndex.has(e)?(this.stats.indexHits++,this.projectIndex.get(e)):(this.stats.indexMisses++,!1)}buildProjectIndex(){var t;let e=Date.now();this.projectIndex.clear(),this.stats.indexBuilds++;try{let r=this.plugin.app.metadataCache.resolvedLinks,s=new Set;for(let[a,o]of Object.entries(r)){if(!o)continue;let l=this.plugin.app.metadataCache.getCache(a),c=this.plugin.fieldMapper.toUserField("projects"),d=(t=l==null?void 0:l.frontmatter)==null?void 0:t[c];if(Array.isArray(d)&&d.some(u=>typeof u=="string"&&u.startsWith("[[")&&u.endsWith("]]")))for(let u of Object.keys(o))o[u]>0&&s.add(u)}for(let a of s)this.projectIndex.set(a,!0);this.indexLastBuilt=Date.now();let i=Date.now()-e;console.log(`[ProjectSubtasksService] Built project index: ${this.projectIndex.size} projects from ${Object.keys(r).length} files in ${i}ms`)}catch(r){console.error("Error building project index:",r)}}ensureIndexBuilt(){Date.now()-this.indexLastBuilt>this.INDEX_TTL&&this.buildProjectIndex()}destroy(){this.projectIndex.clear(),this.stats={indexBuilds:0,indexHits:0,indexMisses:0}}sortTasks(e){return e.sort((t,r)=>{let s=this.plugin.statusManager.isCompletedStatus(t.status),i=this.plugin.statusManager.isCompletedStatus(r.status);if(s!==i)return s?1:-1;let a=this.plugin.priorityManager.getPriorityWeight(t.priority),o=this.plugin.priorityManager.getPriorityWeight(r.priority);return a!==o?o-a:t.due&&r.due?new Date(t.due).getTime()-new Date(r.due).getTime():t.due?-1:r.due?1:t.title.localeCompare(r.title)})}};var pv=class{constructor(e){this.expandedProjects=new Set;this.plugin=e}isExpanded(e){return this.expandedProjects.has(e)}toggle(e){return this.expandedProjects.has(e)?(this.expandedProjects.delete(e),!1):(this.expandedProjects.add(e),!0)}setExpanded(e,t){t?this.expandedProjects.add(e):this.expandedProjects.delete(e)}getExpandedProjects(){return Array.from(this.expandedProjects)}clearAll(){this.expandedProjects.clear()}collapseAll(){this.clearAll()}};var nB=require("obsidian");or();Ne();var mv=class{constructor(e){this.notificationQueue=[];this.processedReminders=new Set;this.lastBroadScanTime=Date.now();this.lastQuickCheckTime=Date.now();this.BROAD_SCAN_INTERVAL=300*1e3;this.QUICK_CHECK_INTERVAL=30*1e3;this.QUEUE_WINDOW=300*1e3;this.plugin=e}async initialize(){this.plugin.settings.enableNotifications&&(this.plugin.settings.notificationType==="system"&&"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission(),this.setupTaskUpdateListener(),this.startBroadScan(),this.startQuickCheck(),await this.scanTasksAndBuildQueue())}destroy(){this.broadScanInterval&&clearInterval(this.broadScanInterval),this.quickCheckInterval&&clearInterval(this.quickCheckInterval),this.taskUpdateListener&&this.plugin.emitter.offref(this.taskUpdateListener),this.notificationQueue=[],this.processedReminders.clear()}startBroadScan(){this.broadScanInterval=setInterval(async()=>{let e=Date.now();e-this.lastBroadScanTime>this.BROAD_SCAN_INTERVAL+6e4&&(console.log("NotificationService: Detected potential system sleep, performing catch-up scan"),await this.handleSystemWakeUp()),await this.scanTasksAndBuildQueue(),this.lastBroadScanTime=e},this.BROAD_SCAN_INTERVAL)}startQuickCheck(){this.quickCheckInterval=setInterval(()=>{let e=Date.now();e-this.lastQuickCheckTime>this.QUICK_CHECK_INTERVAL+6e4&&console.log("NotificationService: Detected potential system sleep during quick check"),this.checkNotificationQueue(),this.lastQuickCheckTime=e},this.QUICK_CHECK_INTERVAL)}async scanTasksAndBuildQueue(){this.notificationQueue=[];let e=await this.plugin.cacheManager.getAllTasks(),t=Date.now(),r=t+this.QUEUE_WINDOW;for(let s of e)if(!(!s.reminders||s.reminders.length===0))for(let i of s.reminders){let a=`${s.path}-${i.id}`;if(this.processedReminders.has(a))continue;let o=this.calculateNotificationTime(s,i);o!==null&&o>t&&o<=r&&this.notificationQueue.push({taskPath:s.path,reminder:i,notifyAt:o})}this.notificationQueue.sort((s,i)=>s.notifyAt-i.notifyAt)}calculateNotificationTime(e,t){try{if(t.type==="absolute")return t.absoluteTime?Ut(t.absoluteTime).getTime():null;if(t.type==="relative"){if(!t.relatedTo||!t.offset)return null;let r=t.relatedTo==="due"?e.due:e.scheduled;if(!r)return null;let s=Ut(r),i=this.parseISO8601Duration(t.offset);return i===null?null:s.getTime()+i}}catch(r){return console.error("Error calculating notification time:",r),null}return null}parseISO8601Duration(e){let t=e.match(/^(-?)P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)W)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?)?$/);if(!t)return null;let[,r,s,i,a,o,l,c,d]=t,u=0;return s&&(u+=parseInt(s)*365*24*60*60*1e3),i&&(u+=parseInt(i)*30*24*60*60*1e3),a&&(u+=parseInt(a)*7*24*60*60*1e3),o&&(u+=parseInt(o)*24*60*60*1e3),l&&(u+=parseInt(l)*60*60*1e3),c&&(u+=parseInt(c)*60*1e3),d&&(u+=parseInt(d)*1e3),r==="-"?-u:u}checkNotificationQueue(){let e=Date.now(),t=[];for(let r=0;r<this.notificationQueue.length;r++){let s=this.notificationQueue[r];if(s.notifyAt<=e){this.triggerNotification(s),t.push(r);let i=`${s.taskPath}-${s.reminder.id}`;this.processedReminders.add(i)}else break}for(let r=t.length-1;r>=0;r--)this.notificationQueue.splice(t[r],1)}async triggerNotification(e){let t=this.plugin.app.vault.getAbstractFileByPath(e.taskPath);if(!t)return;let r=this.plugin.app.metadataCache.getFileCache(t);if(!r||!r.frontmatter)return;let s=this.plugin.fieldMapper.mapFromFrontmatter(r.frontmatter,e.taskPath,this.plugin.settings.storeTitleInFilename),i=e.reminder.description||this.generateDefaultMessage(s,e.reminder);if(this.plugin.settings.notificationType==="system")if("Notification"in window&&Notification.permission==="granted"){let a=new Notification("TaskNotes Reminder",{body:i,tag:`tasknotes-${e.taskPath}-${e.reminder.id}`});a.onclick=()=>{this.plugin.app.workspace.openLinkText(e.taskPath,"",!1),a.close()}}else this.showInAppNotice(i,e.taskPath);else this.showInAppNotice(i,e.taskPath);this.plugin.apiService&&await this.plugin.apiService.triggerWebhook("reminder.triggered",{task:s,reminder:e.reminder,notificationTime:new Date(e.notifyAt).toISOString(),message:i,notificationType:this.plugin.settings.notificationType})}showInAppNotice(e,t){let r=new nB.Notice(e,0);r.noticeEl.addEventListener("click",()=>{this.plugin.app.workspace.openLinkText(t,"",!1),r.hide()}),r.noticeEl.style.cursor="pointer"}generateDefaultMessage(e,t){if(t.type==="absolute")return`Reminder: ${e.title}`;{let r=t.relatedTo==="due"?"due":"scheduled",s=this.formatDurationForDisplay(t.offset||"");return s.startsWith("-")?`${e.title} is ${r} in ${s.substring(1)}`:s==="PT0S"||s==="PT0M"?`${e.title} is ${r} now`:`${e.title} was ${r} ${s} ago`}}formatDurationForDisplay(e){let t=this.parseISO8601Duration(e);if(t===null)return e;let r=Math.abs(t),s=Math.floor(r/(60*1e3)),i=Math.floor(r/(3600*1e3)),a=Math.floor(r/(1440*60*1e3)),o="";return a>0?o=`${a} day${a>1?"s":""}`:i>0?o=`${i} hour${i>1?"s":""}`:s>0?o=`${s} minute${s>1?"s":""}`:o="now",t<0?`-${o}`:o}async refreshReminders(){await this.scanTasksAndBuildQueue()}clearProcessedRemindersForTask(e){let t=[];for(let r of this.processedReminders)r.startsWith(`${e}-`)&&t.push(r);t.forEach(r=>this.processedReminders.delete(r))}setupTaskUpdateListener(){this.taskUpdateListener=this.plugin.emitter.on(dt,async({path:e,originalTask:t,updatedTask:r})=>{if(!e||!r)return;this.removeNotificationsForTask(e),this.clearProcessedRemindersForTask(e);let s=Date.now(),i=s+this.QUEUE_WINDOW;if(r.reminders&&r.reminders.length>0){for(let a of r.reminders){let o=`${e}-${a.id}`;if(this.processedReminders.has(o))continue;let l=this.calculateNotificationTime(r,a);l!==null&&l>s&&l<=i&&this.notificationQueue.push({taskPath:e,reminder:a,notifyAt:l})}this.notificationQueue.sort((a,o)=>a.notifyAt-o.notifyAt)}})}removeNotificationsForTask(e){this.notificationQueue=this.notificationQueue.filter(t=>t.taskPath!==e)}async handleSystemWakeUp(){let e=Date.now(),t=[];for(let r of this.processedReminders){let[s,i]=r.split("-",2);if(!(!s||!i))try{let a=await this.plugin.cacheManager.getTaskInfo(s);if(a&&a.reminders){let o=a.reminders.find(l=>l.id===i);if(o){let l=this.calculateNotificationTime(a,o);l&&l<=e&&t.push(r)}}}catch(a){t.push(r)}}t.forEach(r=>this.processedReminders.delete(r)),await this.scanTasksAndBuildQueue()}};var iB=require("obsidian");Dm();var gv=class{constructor(e){this.intervalId=null;this.lastExportTime=null;this.nextExportTime=null;this.plugin=e}start(){if(!this.plugin.settings.icsIntegration.enableAutoExport)return;this.stop();let e=this.plugin.settings.icsIntegration.autoExportInterval,t=e*60*1e3;this.nextExportTime=new Date(Date.now()+t),this.intervalId=setInterval(async()=>{await this.performExport(),this.nextExportTime=new Date(Date.now()+t)},t),console.log(`TaskNotes: Auto export started (interval: ${e} minutes)`)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null,this.nextExportTime=null)}updateInterval(e){this.plugin.settings.icsIntegration.enableAutoExport&&this.start()}async exportNow(){await this.performExport()}getLastExportTime(){return this.lastExportTime}getNextExportTime(){return this.nextExportTime}async performExport(){try{let e=this.plugin.settings.icsIntegration.autoExportPath||"tasknotes-calendar.ics",t=await this.plugin.cacheManager.getAllTasks();if(t.length===0){console.log("TaskNotes: Auto export skipped - no tasks found");return}let r=$n.generateMultipleTasksICSContent(t),s=e;await this.plugin.app.vault.adapter.exists(s)?await this.plugin.app.vault.adapter.write(s,r):await this.plugin.app.vault.create(s,r),this.lastExportTime=new Date,console.log(`TaskNotes: Auto export completed - ${t.length} tasks exported to ${e}`)}catch(e){console.error("TaskNotes: Auto export failed:",e),(!this.lastExportTime||Date.now()-this.lastExportTime.getTime()>360*60*1e3)&&new iB.Notice(`TaskNotes auto export failed: ${e instanceof Error?e.message:String(e)}`)}}destroy(){this.stop()}};var Mp=class extends ye.Plugin{constructor(){super(...arguments);this.previousCacheSettings=null;this.previousTimeTrackingSettings=null;this.lastKnownDate=new Date().toDateString();this.selectedDate=wt(Ge());this.taskUpdateListenerForEditor=null;this.initializationComplete=!1;this.migrationComplete=!1;this.migrationPromise=null}async onload(){var t;if(this.readyPromise=new Promise(r=>{this.resolveReady=r}),await this.loadSettings(),(0,ye.addIcon)("tasknotes-simple",`<g>
			<defs>
				<mask id="tasknotes-mask">
					<rect width="100" height="100" fill="white"/>
					<path fill="black" d="m 5.9,52.4 -0.09,4.51 c 4.71,0.09 7.61,1.48 9.95,3.57 2.35,2.09 4.11,5.01 5.90,8.14 1.80,3.13 3.62,6.46 6.45,9.12 2.23,2.09 5.14,3.67 8.83,4.21 0.46,-1.51 1.05,-2.95 1.77,-4.33 -3.44,-0.21 -5.62,-1.39 -7.53,-3.17 -2.14,-2.01 -3.82,-4.92 -5.63,-8.08 -1.81,-3.16 -3.77,-6.56 -6.82,-9.27 -3.05,-2.71 -7.07,-4.59 -11.83,-4.70 z"/>
					<path fill="black" d="M 73.6,18.3 69.9,20.9 c 4.06,5.75 4.40,11.33 2.77,16.78 -1.63,5.45 -5.41,10.67 -9.65,14.78 -8.49,8.20 -16.59,14.11 -21.83,21.18 -5.24,7.07 -7.22,15.59 -3.13,27.21 l 4.25,-1.50 c -3.74,-10.62 -2.11,-16.80 2.50,-23.01 4.61,-6.21 12.63,-12.19 21.34,-20.64 4.65,-4.50 8.89,-10.23 10.84,-16.72 1.95,-6.49 1.42,-13.86 -3.40,-20.68 z"/>
				</mask>
			</defs>
			<path fill="currentColor" mask="url(#tasknotes-mask)" d="m 98.5,0.6 c -0.38,0 -0.83,0.09 -1.33,0.23 -2,0.59 -4.66,2.18 -5.78,3.22 -1.25,1.16 -4.16,4.93 -6.08,7.19 -2.67,3.12 -5.65,6.58 -9.32,11.13 2.58,5.61 2.61,11.38 1.05,16.60 -1.95,6.49 -6.19,12.22 -10.84,16.72 -8.71,8.43 -16.73,14.41 -21.34,20.64 -4.47,6.03 -6.13,12.03 -2.81,22.08 0.19,-0.23 0.37,-0.49 0.54,-0.80 10.57,-19.70 17.89,-27.30 41.9,-47.08 v 0 c 2.40,-1.97 3.71,-4.33 4.52,-7.14 0.81,-2.82 1.11,-6.10 1.52,-9.92 0.81,-7.64 2.02,-17.43 8.43,-29.95 0.37,-0.73 0.57,-1.30 0.62,-1.72 0.05,-0.43 -0.04,-0.71 -0.22,-0.90 -0.19,-0.18 -0.48,-0.27 -0.86,-0.26 z M 72.7,26.3 c -0.75,0.92 -1.51,1.84 -2.27,2.78 -9.09,11.05 -19.45,22.93 -28.54,29.97 -1.48,1.14 -2.98,1.54 -4.46,1.38 -1.49,-0.16 -2.97,-0.89 -4.43,-1.96 -2.91,-2.16 -5.74,-5.74 -8.35,-9.19 -2.62,-3.45 -5.04,-6.77 -7.12,-8.39 -1.04,-0.81 -1.99,-1.19 -2.83,-0.97 -0.84,0.22 -1.60,1.05 -2.26,2.70 -1.03,2.61 -1.60,6.22 -3.42,10.05 4.08,0.62 7.27,2.27 9.73,4.45 3.05,2.71 5.01,6.11 6.82,9.27 1.81,3.16 3.49,6.07 5.63,8.08 1.90,1.78 4.08,2.96 7.53,3.17 0.71,-1.37 1.55,-2.69 2.49,-3.95 5.24,-7.07 13.34,-12.98 21.83,-21.18 4.24,-4.11 8.02,-9.33 9.65,-14.78 1.12,-3.73 1.31,-7.53 0.01,-11.42 z M 10.3,49.1 c -0.09,0.29 -0.18,0.56 -0.28,0.85 0.10,-0.29 0.19,-0.56 0.28,-0.85 z m -4.02,7.84 c -0.01,0.01 -0.02,0.02 -0.03,0.03 0.01,-0.01 0.02,-0.02 0.03,-0.03 0,0 0,0 0,0 z m 0.12,0 c -1.08,1.40 -2.40,2.79 -4.05,4.12 -1.20,1.0 -1.85,1.86 -2.03,2.71 -0.18,0.85 0.10,1.67 0.76,2.53 1.32,1.71 4.16,3.54 7.81,5.91 7.28,4.73 17.75,11.63 25.63,24.16 0.64,1.02 1.74,2.04 2.95,2.65 -0.91,-5.36 -0.91,-8.78 -0.54,-11.88 -3.33,-0.55 -6.07,-2.12 -8.39,-4.72 -2.83,-3.17 -4.69,-6.59 -6.54,-9.85 -1.85,-3.26 -3.69,-6.37 -6.08,-8.47 -2.06,-1.81 -4.61,-3.0 -8.49,-3.17 z"/>
		</g>`),this.fieldMapper=new ql(this.settings.fieldMapping),this.statusManager=new od(this.settings.customStatuses),this.priorityManager=new jy(this.settings.customPriorities),this.requestDeduplicator=new id,this.predictivePrefetcher=new By(this.requestDeduplicator),this.domReconciler=new ad,this.uiStateManager=new Uy,this.cacheManager=new Hy(this.app,this.settings,this.fieldMapper),this.emitter=this.cacheManager,this.taskService=new Vy(this),this.filterService=new Va(this.cacheManager,this.statusManager,this.priorityManager,this),this.viewStateManager=new zy(this.app,this),this.projectSubtasksService=new fv(this),this.expandedProjectsService=new pv(this),this.autoArchiveService=new Yy(this),this.dragDropManager=new Ky(this),this.migrationService=new uv(this.app),this.statusBarService=new hv(this),this.notificationService=new mv(this),this.viewPerformanceService=new $y(this),this.taskService.setAutoArchiveService(this.autoArchiveService),this.addRibbonIcon("calendar-days","Open mini calendar",async()=>{await this.activateCalendarView()}),this.addRibbonIcon("calendar","Open advanced calendar",async()=>{await this.activateAdvancedCalendarView()}),this.addRibbonIcon("check-square","Open task list",async()=>{await this.activateTasksView()}),this.addRibbonIcon("sticky-note","Open notes",async()=>{await this.activateNotesView()}),this.addRibbonIcon("list","Open agenda",async()=>{await this.activateAgendaView()}),this.addRibbonIcon("columns-3","Open kanban board",async()=>{await this.activateKanbanView()}),this.addRibbonIcon("timer","Open pomodoro",async()=>{await this.activatePomodoroView()}),this.addRibbonIcon("bar-chart-3","Open pomodoro stats",async()=>{await this.activatePomodoroStatsView()}),this.addRibbonIcon("tasknotes-simple","Create new task",()=>{this.openTaskCreationModal()}),this.addCommands(),this.addSettingTab(new rm(this.app,this)),this.migrationPromise=this.performEarlyMigrationCheck(),(t=this.settings)!=null&&t.enableBases)try{let{registerBasesTaskList:r}=await Promise.resolve().then(()=>(wv(),Tv));await r(this)}catch(r){console.debug("[TaskNotes][Bases] Early registration failed:",r)}this.app.workspace.onLayoutReady(()=>{this.initializeAfterLayoutReady()}),this.resolveReady()}async initializeHTTPAPI(){if(!(ye.Platform.isMobile||!this.settings.enableAPI))try{let{HTTPAPIService:t}=await Promise.resolve().then(()=>(FB(),LB));this.apiService=new t(this,this.taskService,this.filterService,this.cacheManager),this.taskService.setWebhookNotifier(this.apiService),this.pomodoroService.setWebhookNotifier(this.apiService),await this.apiService.start(),new ye.Notice(`TaskNotes API started on port ${this.apiService.getPort()}`)}catch(t){console.error("Failed to initialize HTTP API:",t),new ye.Notice("Failed to start TaskNotes API server. Check console for details.")}}async initializeAfterLayoutReady(){var t;if(!this.initializationComplete){this.initializationComplete=!0;try{if(this.injectCustomStyles(),this.registerView(uo,r=>new Tm(r,this)),this.registerView(kn,r=>new _y(r,this)),this.registerView(Zr,r=>new dp(r,this)),this.registerView(Rl,r=>new Iy(r,this)),this.registerView(Bt,r=>new hp(r,this)),this.registerView(Nl,r=>new Ny(r,this)),this.registerView(Ol,r=>new Oy(r,this)),this.registerView(Ll,r=>new Ly(r,this)),this.registerView(ys,r=>new pp(r,this)),this.registerEditorExtension(BH(this)),this.registerEditorExtension(jH(this)),this.registerMarkdownPostProcessor(UH(this)),this.cacheManager.initialize(),this.filterService.initialize(),this.statusBarService.initialize(),await this.notificationService.initialize(),await this.projectSubtasksService.buildProjectStatusCache(),await this.warmupProjectIndexes(),await this.autoArchiveService.start(),this.setupDateChangeDetection(),this.initializeServicesLazily(),(t=this.settings)!=null&&t.enableBases)try{let{registerBasesTaskList:r}=await Promise.resolve().then(()=>(wv(),Tv));await r(this)}catch(r){console.debug("[TaskNotes][Bases] Registration failed:",r)}}catch(r){console.error("Error during post-layout initialization:",r)}}}initializeServicesLazily(){setTimeout(async()=>{try{this.pomodoroService=new Fy(this),await this.pomodoroService.initialize(),this.icsSubscriptionService=new cv(this),await this.icsSubscriptionService.initialize(),this.icsNoteService=new dv(this),this.autoExportService=new gv(this),this.autoExportService.start(),await this.initializeHTTPAPI();let{TaskLinkDetectionService:t}=await Promise.resolve().then(()=>(RS(),FH));this.taskLinkDetectionService=new t(this);let{InstantTaskConvertService:r}=await Promise.resolve().then(()=>(BB(),HB));this.instantTaskConvertService=new r(this,this.statusManager,this.priorityManager);let{createInstantConvertButtons:s}=await Promise.resolve().then(()=>(WB(),jB));this.registerEditorExtension(s(this)),this.taskUpdateListenerForEditor=this.emitter.on(dt,i=>{this.app.workspace.iterateRootLeaves(a=>{var o;if(a.view&&a.view.getViewType()==="markdown"){let l=a.view.editor;if(l&&l.cm){let c=(i==null?void 0:i.path)||((o=i==null?void 0:i.updatedTask)==null?void 0:o.path);Ya(l.cm,c),yp(l.cm)}}})}),this.registerEvent(this.app.workspace.on("active-leaf-change",i=>{setTimeout(()=>{if(i&&i.view&&i.view.getViewType()==="markdown"){let a=i.view.editor;a&&a.cm&&(Ya(a.cm),yp(a.cm))}},50)})),this.registerEvent(this.app.workspace.on("layout-change",()=>{setTimeout(()=>{let i=this.app.workspace.getActiveViewOfType(ye.MarkdownView);if(i){let a=i.editor;a&&a.cm&&(Ya(a.cm),yp(a.cm))}},100)})),this.setupStatusBarEventListeners(),this.setupTimeTrackingEventListeners(),await this.showMigrationPromptsIfNeeded()}catch(t){console.error("Error during lazy service initialization:",t)}},10)}async warmupProjectIndexes(){try{let t=Date.now();this.cacheManager.getTasksForDate(new Date().toISOString().split("T")[0]);let r=Date.now()-t;r>2e3&&console.log(`[TaskNotes] Project indexes warmed up in ${r}ms`)}catch(t){console.error("[TaskNotes] Error during project index warmup:",t)}}async onReady(){if(!this.readyPromise)throw new Error("Plugin not yet initialized");await this.readyPromise}setupStatusBarEventListeners(){this.statusBarService&&(this.registerEvent(this.emitter.on(dt,()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on(ar,()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.pomodoroService&&(this.registerEvent(this.emitter.on("pomodoro-start",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on("pomodoro-stop",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on("pomodoro-state-changed",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)}))))}setupTimeTrackingEventListeners(){if(this.settings.autoStopTimeTrackingOnComplete){let t=this.emitter.on(dt,async r=>{await this.handleAutoStopTimeTracking(r)});this.registerEvent(t)}this.updatePreviousTimeTrackingSettings()}async handleAutoStopTimeTracking(t){let{originalTask:r,updatedTask:s}=t;if(!r||!s)return;let i=this.statusManager.isCompletedStatus(r.status),a=this.statusManager.isCompletedStatus(s.status);if(!i&&a&&this.getActiveTimeSession(s))try{await this.stopTimeTracking(s),this.settings.autoStopTimeTrackingNotification&&new ye.Notice(`Auto-stopped time tracking for: ${s.title}`),console.log(`Auto-stopped time tracking for completed task: ${s.title}`)}catch(l){console.error("Error auto-stopping time tracking:",l)}}haveTimeTrackingSettingsChanged(){return this.previousTimeTrackingSettings?this.settings.autoStopTimeTrackingOnComplete!==this.previousTimeTrackingSettings.autoStopTimeTrackingOnComplete:!0}updatePreviousTimeTrackingSettings(){this.previousTimeTrackingSettings={autoStopTimeTrackingOnComplete:this.settings.autoStopTimeTrackingOnComplete}}async performEarlyMigrationCheck(){try{if(console.log("TaskNotes: Starting early migration check..."),await this.viewStateManager.initializeSavedViews(),this.viewStateManager.needsMigration()&&(console.log("TaskNotes: Performing view state migration..."),await this.viewStateManager.performMigration()),this.settings.recurrenceMigrated===!0){this.migrationComplete=!0;return}if(!await this.migrationService.needsMigration()){this.settings.recurrenceMigrated=!0,await this.saveSettings(),this.migrationComplete=!0;return}this.migrationComplete=!0,console.log("TaskNotes: Early migration check complete. Will show prompts after UI initialization.")}catch(t){console.error("Error during early migration check:",t),this.migrationComplete=!0}}async showMigrationPromptsIfNeeded(){try{if(this.settings.recurrenceMigrated===!0)return;await this.migrationService.needsMigration()&&setTimeout(()=>{rB(this.app,this.migrationService)},1e3)}catch(t){console.error("Error showing migration prompts:",t)}}async waitForMigration(){for(this.migrationPromise&&await this.migrationPromise;!this.migrationComplete;)await new Promise(t=>setTimeout(t,50))}setSelectedDate(t){this.selectedDate=t,this.emitter.trigger(Ti,t)}notifyDataChanged(t,r=!1,s=!0){t?(this.cacheManager.clearCacheEntry(t),this.taskLinkDetectionService&&this.taskLinkDetectionService.clearCacheForFile(t)):r&&(this.cacheManager.clearAllCaches(),this.taskLinkDetectionService&&this.taskLinkDetectionService.clearCache()),s&&requestAnimationFrame(()=>{this.emitter.trigger(ar)})}setupDateChangeDetection(){let t=()=>{let r=new Date().toDateString();r!==this.lastKnownDate&&(this.lastKnownDate=r,this.emitter.trigger($s))};this.dateCheckInterval=window.setInterval(t,6e4),this.registerInterval(this.dateCheckInterval),this.scheduleNextMidnightCheck()}scheduleNextMidnightCheck(){let t=new Date,r=new Date(t);r.setHours(24,0,0,0);let s=r.getTime()-t.getTime();this.midnightTimeout&&window.clearTimeout(this.midnightTimeout),this.midnightTimeout=window.setTimeout(()=>{let i=new Date().toDateString();i!==this.lastKnownDate&&(this.lastKnownDate=i,this.emitter.trigger($s)),this.scheduleNextMidnightCheck()},s),this.registerInterval(this.midnightTimeout)}onunload(){var r;if((r=this.settings)!=null&&r.enableBases)try{let{unregisterBasesViews:s}=(wv(),Td(Tv));s(this)}catch(s){console.debug("[TaskNotes][Bases] Unregistration failed:",s)}let t=xi.getStats("cache-initialization");t&&t.count>0&&xi.logSummary(),this.pomodoroService&&this.pomodoroService.cleanup(),this.filterService&&this.filterService.cleanup(),this.viewPerformanceService&&this.viewPerformanceService.destroy(),this.autoArchiveService&&this.autoArchiveService.stop(),this.icsSubscriptionService&&this.icsSubscriptionService.destroy(),this.autoExportService&&this.autoExportService.destroy(),this.taskLinkDetectionService&&this.taskLinkDetectionService.cleanup(),this.dragDropManager&&this.dragDropManager.destroy(),this.apiService&&this.apiService.stop(),this.viewStateManager&&this.viewStateManager.cleanup(),this.statusBarService&&this.statusBarService.destroy(),this.notificationService&&this.notificationService.destroy(),this.cacheManager&&this.cacheManager.destroy(),this.requestDeduplicator&&this.requestDeduplicator.cancelAll(),this.domReconciler&&this.domReconciler.destroy(),this.uiStateManager&&this.uiStateManager.destroy(),typeof xi!="undefined"&&xi.destroy(),this.taskUpdateListenerForEditor&&this.emitter.offref(this.taskUpdateListenerForEditor),this.emitter&&this.emitter.off,this.initializationComplete=!1}async loadSettings(){let t=await this.loadData();t&&"useNativeMetadataCache"in t&&delete t.useNativeMetadataCache,t&&typeof t.enableAPI=="undefined"&&(t.enableAPI=!1),t&&typeof t.apiPort=="undefined"&&(t.apiPort=8080),t&&typeof t.apiAuthToken=="undefined"&&(t.apiAuthToken=""),this.settings={...Qr,...t,fieldMapping:{...Qr.fieldMapping,...(t==null?void 0:t.fieldMapping)||{}},taskCreationDefaults:{...Qr.taskCreationDefaults,...(t==null?void 0:t.taskCreationDefaults)||{}},calendarViewSettings:{...Qr.calendarViewSettings,...(t==null?void 0:t.calendarViewSettings)||{}},icsIntegration:{...Qr.icsIntegration,...(t==null?void 0:t.icsIntegration)||{}},customStatuses:(t==null?void 0:t.customStatuses)||Qr.customStatuses,customPriorities:(t==null?void 0:t.customPriorities)||Qr.customPriorities,savedViews:(t==null?void 0:t.savedViews)||Qr.savedViews};let r=Object.keys(Qr.fieldMapping).some(i=>{var a;return!((a=t==null?void 0:t.fieldMapping)!=null&&a[i])}),s=Object.keys(Qr.calendarViewSettings).some(i=>{var a;return!((a=t==null?void 0:t.calendarViewSettings)!=null&&a[i])});(r||s)&&setTimeout(async()=>{try{let i=await this.loadData()||{},a=Object.keys(Qr);for(let o of a)i[o]=this.settings[o];await this.saveData(i)}catch(i){console.error("Failed to save migrated settings:",i)}},100),this.updatePreviousCacheSettings()}async saveSettings(){var a;let t=await this.loadData()||{},r=Object.keys(Qr);for(let o of r)t[o]=this.settings[o];await this.saveData(t);let s=this.haveCacheSettingsChanged(),i=this.haveTimeTrackingSettingsChanged();this.fieldMapper&&this.fieldMapper.updateMapping(this.settings.fieldMapping),this.statusManager&&this.statusManager.updateStatuses(this.settings.customStatuses),this.priorityManager&&this.priorityManager.updatePriorities(this.settings.customPriorities),s&&(console.debug("Cache-related settings changed, updating cache configuration"),this.cacheManager.updateConfig(this.settings.taskTag,this.settings.excludedFolders,this.fieldMapper,this.settings.disableNoteIndexing,this.settings.storeTitleInFilename),this.updatePreviousCacheSettings()),this.injectCustomStyles(),i&&this.setupTimeTrackingEventListeners(),this.statusBarService&&this.statusBarService.updateVisibility(),(a=this.filterService)==null||a.refreshFilterOptions(),this.notifyDataChanged(),this.emitter.trigger("settings-changed",this.settings)}addCommands(){this.addCommand({id:"open-calendar-view",name:"Open mini calendar view",callback:async()=>{await this.activateCalendarView()}}),this.addCommand({id:"open-advanced-calendar-view",name:"Open advanced calendar view",callback:async()=>{await this.activateAdvancedCalendarView()}}),this.addCommand({id:"open-tasks-view",name:"Open tasks view",callback:async()=>{await this.activateTasksView()}}),this.addCommand({id:"open-notes-view",name:"Open notes view",callback:async()=>{await this.activateNotesView()}}),this.addCommand({id:"open-agenda-view",name:"Open agenda view",callback:async()=>{await this.activateAgendaView()}}),this.addCommand({id:"open-pomodoro-view",name:"Open pomodoro timer",callback:async()=>{await this.activatePomodoroView()}}),this.addCommand({id:"open-kanban-view",name:"Open kanban board",callback:async()=>{await this.activateKanbanView()}}),this.addCommand({id:"open-pomodoro-stats",name:"Open pomodoro statistics",callback:async()=>{await this.activatePomodoroStatsView()}}),this.addCommand({id:"open-statistics",name:"Open task & project statistics",callback:async()=>{await this.activateStatsView()}}),this.addCommand({id:"create-new-task",name:"Create new task",callback:()=>{this.openTaskCreationModal()}}),this.addCommand({id:"convert-to-tasknote",name:"Convert task to TaskNote",editorCallback:async t=>{await this.convertTaskToTaskNote(t)}}),this.addCommand({id:"batch-convert-all-tasks",name:"Convert all tasks in note",editorCallback:async t=>{await this.batchConvertAllTasks(t)}}),this.addCommand({id:"insert-tasknote-link",name:"Insert tasknote link",editorCallback:t=>{this.insertTaskNoteLink(t)}}),this.addCommand({id:"create-inline-task",name:"Create new inline task",editorCallback:async t=>{await this.createInlineTask(t)}}),this.addCommand({id:"quick-actions-current-task",name:"Quick actions for current task",callback:async()=>{await this.openQuickActionsForCurrentTask()}}),this.addCommand({id:"go-to-today",name:"Go to today's note",callback:async()=>{await this.navigateToCurrentDailyNote()}}),this.addCommand({id:"start-pomodoro",name:"Start pomodoro timer",callback:async()=>{await this.pomodoroService.startPomodoro()}}),this.addCommand({id:"stop-pomodoro",name:"Stop pomodoro timer",callback:async()=>{await this.pomodoroService.stopPomodoro()}}),this.addCommand({id:"pause-pomodoro",name:"Pause/resume pomodoro timer",callback:async()=>{let t=this.pomodoroService.getState();t.isRunning?await this.pomodoroService.pausePomodoro():t.currentSession&&await this.pomodoroService.resumePomodoro()}}),this.addCommand({id:"refresh-cache",name:"Refresh cache",callback:async()=>{await this.refreshCache()}}),this.addCommand({id:"export-all-tasks-ics",name:"Export all tasks as ICS file",callback:async()=>{try{let t=await this.cacheManager.getAllTasks(),{CalendarExportService:r}=await Promise.resolve().then(()=>(Dm(),PA));r.downloadAllTasksICSFile(t)}catch(t){console.error("Error exporting all tasks as ICS:",t),new ye.Notice("Failed to export tasks as ICS file")}}})}async activateView(t){let{workspace:r}=this.app,s=this.getLeafOfType(t);return s||(s=r.getLeaf("tab"),await s.setViewState({type:t,active:!0})),r.setActiveLeaf(s,{focus:!0}),r.revealLeaf(s),s}async activateCalendarView(){return this.activateView(uo)}async activateAdvancedCalendarView(){return this.activateView(kn)}async activateTasksView(){return this.activateView(Zr)}async activateNotesView(){return this.activateView(Rl)}async activateAgendaView(){return this.activateView(Bt)}async activatePomodoroView(){return this.activateView(Nl)}async activatePomodoroStatsView(){return this.activateView(Ol)}async activateStatsView(){return this.activateView(Ll)}async activateKanbanView(){return this.activateView(ys)}async openTagsPane(t){var s;let{workspace:r}=this.app;try{let i=r.getLeavesOfType("search").first();if(!i){let l=r.getLeftLeaf(!1);if(!l)return console.warn("Could not get left leaf for search pane"),!1;try{await l.setViewState({type:"search",active:!0}),i=l}catch(c){return console.warn("Failed to create search view:",c),!1}}if(!i||!i.view)return console.warn("No search leaf available"),!1;let a=`tag:${t}`,o=i.view;if(typeof o.setQuery=="function")o.setQuery(a);else if(typeof((s=o.searchComponent)==null?void 0:s.setValue)=="function")o.searchComponent.setValue(a);else if(o.searchInputEl)o.searchInputEl.value=a,typeof o.startSearch=="function"&&o.startSearch();else return console.warn("[TaskNotes] Could not find method to set search query"),new ye.Notice("Search pane opened but could not set tag query"),!1;return r.revealLeaf(i),r.setActiveLeaf(i,{focus:!0}),!0}catch(i){return console.error("[TaskNotes] Error opening search pane with tag:",i),new ye.Notice(`Failed to open search pane for tag: ${t}`),!1}}getLeafOfType(t){let{workspace:r}=this.app,s=r.getLeavesOfType(t);for(let i of s)if(i.view&&i.view.getViewType()===t)return i;return s.length>0?s[0]:null}getCalendarLeaf(){return this.getLeafOfType(uo)}async navigateToCurrentDailyNote(){let t=new Date;await this.navigateToDailyNote(t)}async navigateToDailyNote(t){try{if(!(0,Za.appHasDailyNotesPluginLoaded)()){new ye.Notice("Daily Notes core plugin is not enabled. Please enable it in Settings > Core plugins.");return}let r=window.moment(t),s=(0,Za.getAllDailyNotes)(),i=(0,Za.getDailyNote)(r,s),a=!1;if(!i)try{i=await(0,Za.createDailyNote)(r),a=!0}catch(o){let l=o instanceof Error?o.message:String(o);console.error("Failed to create daily note:",o),new ye.Notice(`Failed to create daily note: ${l}`);return}i&&(await this.app.workspace.getLeaf(!1).openFile(i),a&&this.notifyDataChanged(i.path,!1,!0))}catch(r){let s=r instanceof Error?r.message:String(r);console.error("Failed to navigate to daily note:",r),new ye.Notice(`Failed to navigate to daily note: ${s}`)}}injectCustomStyles(){let t=document.getElementById("tasknotes-custom-styles");t&&t.remove();let r=this.statusManager.getStatusStyles(),s=this.priorityManager.getPriorityStyles(),i=document.createElement("style");i.id="tasknotes-custom-styles",i.textContent=`
		${r}
		${s}
	`,document.head.appendChild(i)}async updateTaskProperty(t,r,s,i={}){try{let a=await this.taskService.updateProperty(t,r,s,i);if(!i.silent)if(r==="status"){let o=typeof s=="string"?s:String(s),l=this.statusManager.getStatusConfig(o);new ye.Notice(`Task marked as '${(l==null?void 0:l.label)||o}'`)}else new ye.Notice(`Task ${r} updated`);return a}catch(a){throw console.error(`Failed to update task ${r}:`,a),new ye.Notice(`Failed to update task ${r}`),a}}async toggleRecurringTaskComplete(t,r){var s;try{let i=await this.taskService.toggleRecurringTaskComplete(t,r),a=r||(()=>{let u=Ge();return wt(u)})(),o=ue(a),c=((s=i.complete_instances)==null?void 0:s.includes(o))?"completed":"marked incomplete",d=Ut(o);return new ye.Notice(`Recurring task ${c} for ${C(d,"MMM d")}`),i}catch(i){throw console.error("Failed to toggle recurring task completion:",i),new ye.Notice("Failed to update recurring task"),i}}async toggleTaskArchive(t){try{let r=await this.taskService.toggleArchive(t),s=r.archived?"archived":"unarchived";return new ye.Notice(`Task ${s}`),r}catch(r){throw console.error("Failed to toggle task archive:",r),new ye.Notice("Failed to update task archive status"),r}}async toggleTaskStatus(t){try{let r=await this.taskService.toggleStatus(t),s=this.statusManager.getStatusConfig(r.status);return new ye.Notice(`Task marked as '${(s==null?void 0:s.label)||r.status}'`),r}catch(r){throw console.error("Failed to toggle task status:",r),new ye.Notice("Failed to update task status"),r}}openTaskCreationModal(t){new ll(this.app,this,{prePopulatedValues:t}).open()}async applyProjectSubtaskFilter(t){try{let r=this.app.vault.getAbstractFileByPath(t.path);if(!r){new ye.Notice("Project file not found");return}let s=this.app.workspace.getActiveViewOfType(dp)||this.app.workspace.getActiveViewOfType(pp)||this.app.workspace.getActiveViewOfType(hp);if(!s||!("filterBar"in s)){new ye.Notice("No compatible view active to apply filter");return}let i=s.filterBar;if(!i){new ye.Notice("Filter bar not available");return}this.addProjectCondition(i,r.basename),new ye.Notice(`Filtered to show subtasks of: ${t.title}`)}catch(r){console.error("Error applying project subtask filter:",r),new ye.Notice("Failed to apply project filter")}}addProjectCondition(t,r){this.removeProjectConditions(t),Array.isArray(t.currentQuery.children)||(t.currentQuery.children=[]);let s={type:"condition",id:`project_${this.generateFilterId()}`,property:"projects",operator:"contains",value:`[[${r}]]`},i=t.currentQuery.children.filter(a=>!(a.type==="condition"&&a.property==="projects"&&a.operator==="contains"&&a.id.startsWith("project_")));if(i.length===0)t.currentQuery.children=[s];else{let a={type:"group",id:this.generateFilterId(),conjunction:t.currentQuery.conjunction,children:i};t.currentQuery.children=[s,a],t.currentQuery.conjunction="and"}t.updateFilterBuilder(),t.emit("queryChange",t.currentQuery)}removeProjectConditions(t){if(!Array.isArray(t.currentQuery.children)){t.currentQuery.children=[];return}t.currentQuery.children=t.currentQuery.children.filter(r=>r.type==="condition"?!(r.property==="projects"&&r.operator==="contains"&&r.id.startsWith("project_")):!0)}generateFilterId(){return`filter-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async startTimeTracking(t,r){try{let s=await this.taskService.startTimeTracking(t);return new ye.Notice("Time tracking started"),this.statusBarService&&setTimeout(()=>{this.statusBarService.requestUpdate()},50),s}catch(s){throw console.error("Failed to start time tracking:",s),s.message==="Time tracking is already active for this task"?new ye.Notice("Time tracking is already active for this task"):new ye.Notice("Failed to start time tracking"),s}}async stopTimeTracking(t){try{let r=await this.taskService.stopTimeTracking(t);return new ye.Notice("Time tracking stopped"),this.statusBarService&&setTimeout(()=>{this.statusBarService.requestUpdate()},50),r}catch(r){throw console.error("Failed to stop time tracking:",r),r.message==="No active time tracking session for this task"?new ye.Notice("No active time tracking session for this task"):new ye.Notice("Failed to stop time tracking"),r}}getActiveTimeSession(t){return EA(t.timeEntries||[])}isRecurringTaskCompleteForDate(t,r){if(!t.recurrence)return!1;let s=ue(r);return(Array.isArray(t.complete_instances)?t.complete_instances:[]).includes(s)}formatTime(t){return vm(t)}async openTaskEditModal(t){new Fa(this.app,this,{task:t}).open()}async openDueDateModal(t){try{let{DueDateModal:r}=await Promise.resolve().then(()=>($B(),VB));new r(this.app,t,this).open()}catch(r){console.error("Error loading DueDateModal:",r)}}async openScheduledDateModal(t){try{let{ScheduledDateModal:r}=await Promise.resolve().then(()=>(zB(),YB));new r(this.app,t,this).open()}catch(r){console.error("Error loading ScheduledDateModal:",r)}}async refreshCache(){try{let t=new ye.Notice("Refreshing TaskNotes cache...",0);await this.cacheManager.clearAllCaches(),this.notifyDataChanged(void 0,!0,!0),t.hide(),new ye.Notice("TaskNotes cache refreshed successfully")}catch(t){console.error("Error refreshing cache:",t),new ye.Notice("Failed to refresh cache. Please try again.")}}async convertTaskToTaskNote(t){try{let r=t.getCursor();if(!this.instantTaskConvertService){new ye.Notice("Task conversion service not available. Please try again.");return}await this.instantTaskConvertService.instantConvertTask(t,r.line)}catch(r){console.error("Error converting task:",r),new ye.Notice("Failed to convert task. Please try again.")}}async batchConvertAllTasks(t){try{if(!this.instantTaskConvertService){new ye.Notice("Task conversion service not available. Please try again.");return}await this.instantTaskConvertService.batchConvertAllTasks(t)}catch(r){console.error("Error batch converting tasks:",r),new ye.Notice("Failed to batch convert tasks. Please try again.")}}async insertTaskNoteLink(t){try{let s=(await this.cacheManager.getAllTasks()).filter(a=>!a.archived);new sd(this.app,this,s,a=>{if(a){let o=this.app.vault.getAbstractFileByPath(a.path);if(o){let l=this.app.workspace.getActiveFile(),c=(l==null?void 0:l.path)||"",d=this.app.fileManager.generateMarkdownLink(o,c,"",a.title),u=t.getCursor();t.replaceRange(d,u);let f={line:u.line,ch:u.ch+d.length};t.setCursor(f)}else new ye.Notice("Failed to create link - file not found")}}).open()}catch(r){console.error("Error inserting tasknote link:",r),new ye.Notice("Failed to insert tasknote link")}}extractSelectionInfoForCommand(t,r){let s=t.getSelection();if(s&&s.trim()){let i=t.listSelections()[0],a=Math.min(i.anchor.line,i.head.line),o=Math.max(i.anchor.line,i.head.line),l=[];for(let f=a;f<=o;f++)l.push(t.getLine(f));let c=l[0],u=l.slice(1).join(`
`).trimEnd();return{taskLine:c,details:u,startLine:a,endLine:o,originalContent:l}}else{let i=t.getLine(r);return{taskLine:i,details:"",startLine:r,endLine:r,originalContent:[i]}}}async openQuickActionsForCurrentTask(){try{let t=this.app.workspace.getActiveFile();if(!t){new ye.Notice("No file is currently open");return}let r=await this.cacheManager.getTaskInfo(t.path);if(!r){new ye.Notice("Current file is not a TaskNote");return}let{TaskActionPaletteModal:s}=await Promise.resolve().then(()=>(GB(),qB));new s(this.app,r,this,this.selectedDate).open()}catch(t){console.error("Error opening quick actions:",t),new ye.Notice("Failed to open quick actions")}}async createInlineTask(t){try{let r=t.getCursor(),s=t.getLine(r.line),i=s.trim(),a;if(i==="")a={line:r.line,ch:r.ch};else{let c={line:r.line,ch:s.length};t.replaceRange(`
`,c),a={line:r.line+1,ch:0}}let o={editor:t,insertionPoint:a};new ll(this.app,this,{onTaskCreated:c=>{this.handleInlineTaskCreated(c,o)}}).open()}catch(r){console.error("Error creating inline task:",r),new ye.Notice("Failed to create inline task")}}handleInlineTaskCreated(t,r){try{let{editor:s,insertionPoint:i}=r,a=this.app.vault.getAbstractFileByPath(t.path);if(!a){new ye.Notice("Failed to create link - file not found");return}let o=this.app.workspace.getActiveFile(),l=(o==null?void 0:o.path)||"",c=this.app.fileManager.generateMarkdownLink(a,l,"",t.title);s.replaceRange(c,i);let d={line:i.line,ch:i.ch+c.length};s.setCursor(d),new ye.Notice(`Inline task "${t.title}" created and linked successfully`)}catch(s){console.error("Error handling inline task creation:",s),new ye.Notice("Failed to insert task link")}}haveCacheSettingsChanged(){if(!this.previousCacheSettings)return!0;let t={taskTag:this.settings.taskTag,excludedFolders:this.settings.excludedFolders,disableNoteIndexing:this.settings.disableNoteIndexing,storeTitleInFilename:this.settings.storeTitleInFilename,fieldMapping:this.settings.fieldMapping};return t.taskTag!==this.previousCacheSettings.taskTag||t.excludedFolders!==this.previousCacheSettings.excludedFolders||t.disableNoteIndexing!==this.previousCacheSettings.disableNoteIndexing||t.storeTitleInFilename!==this.previousCacheSettings.storeTitleInFilename||JSON.stringify(t.fieldMapping)!==JSON.stringify(this.previousCacheSettings.fieldMapping)}updatePreviousCacheSettings(){this.previousCacheSettings={taskTag:this.settings.taskTag,excludedFolders:this.settings.excludedFolders,disableNoteIndexing:this.settings.disableNoteIndexing,storeTitleInFilename:this.settings.storeTitleInFilename,fieldMapping:JSON.parse(JSON.stringify(this.settings.fieldMapping))}}};var Q4=Mp;
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/

/* nosourcemap */