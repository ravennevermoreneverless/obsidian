/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var vE=Object.create;var sa=Object.defineProperty;var wE=Object.getOwnPropertyDescriptor;var bE=Object.getOwnPropertyNames;var TE=Object.getPrototypeOf,EE=Object.prototype.hasOwnProperty;var kE=(n,t,e)=>t in n?sa(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var _=(n,t)=>()=>(n&&(t=n(n=0)),t);var vl=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),pi=(n,t)=>{for(var e in t)sa(n,e,{get:t[e],enumerable:!0})},gm=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of bE(t))!EE.call(n,i)&&i!==e&&sa(n,i,{get:()=>t[i],enumerable:!(r=wE(t,i))||r.enumerable});return n};var Ve=(n,t,e)=>(e=n!=null?vE(TE(n)):{},gm(t||!n||!n.__esModule?sa(e,"default",{value:n,enumerable:!0}):e,n)),DE=n=>gm(sa({},"__esModule",{value:!0}),n);var Q=(n,t,e)=>(kE(n,typeof t!="symbol"?t+"":t,e),e);function mi(n){return mi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mi(n)}var wl=_(()=>{});function pe(n){if(n===null||n===!0||n===!1)return NaN;var t=Number(n);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}var kt=_(()=>{});function z(n,t){if(t.length<n)throw new TypeError(n+" argument"+(n>1?"s":"")+" required, but only "+t.length+" present")}var Ce=_(()=>{});function X(n){z(1,arguments);var t=Object.prototype.toString.call(n);return n instanceof Date||mi(n)==="object"&&t==="[object Date]"?new Date(n.getTime()):typeof n=="number"||t==="[object Number]"?new Date(n):((typeof n=="string"||t==="[object String]")&&typeof console!="undefined"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}var He=_(()=>{wl();Ce()});function gt(n,t){z(2,arguments);var e=X(n),r=pe(t);return isNaN(r)?new Date(NaN):(r&&e.setDate(e.getDate()+r),e)}var bl=_(()=>{kt();He();Ce()});function Tl(n,t){z(2,arguments);var e=X(n),r=pe(t);if(isNaN(r))return new Date(NaN);if(!r)return e;var i=e.getDate(),s=new Date(e.getTime());s.setMonth(e.getMonth()+r+1,0);var a=s.getDate();return i>=a?s:(e.setFullYear(s.getFullYear(),s.getMonth(),i),e)}var ym=_(()=>{kt();He();Ce()});function gi(n,t){if(z(2,arguments),!t||mi(t)!=="object")return new Date(NaN);var e=t.years?pe(t.years):0,r=t.months?pe(t.months):0,i=t.weeks?pe(t.weeks):0,s=t.days?pe(t.days):0,a=t.hours?pe(t.hours):0,o=t.minutes?pe(t.minutes):0,l=t.seconds?pe(t.seconds):0,c=X(n),d=r||e?Tl(c,r+e*12):c,u=s||i?gt(d,s+i*7):d,h=o+a*60,f=l+h*60,p=f*1e3,m=new Date(u.getTime()+p);return m}var vm=_(()=>{wl();bl();ym();He();Ce();kt()});function Xd(n,t){z(2,arguments);var e=X(n).getTime(),r=pe(t);return new Date(e+r)}var wm=_(()=>{kt();He();Ce()});function Ht(){return SE}var SE,hn=_(()=>{SE={}});function fn(n,t){var e,r,i,s,a,o,l,c;z(1,arguments);var d=Ht(),u=pe((e=(r=(i=(s=t==null?void 0:t.weekStartsOn)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(o=a.options)===null||o===void 0?void 0:o.weekStartsOn)!==null&&i!==void 0?i:d.weekStartsOn)!==null&&r!==void 0?r:(l=d.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&e!==void 0?e:0);if(!(u>=0&&u<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=X(n),f=h.getDay(),p=(f<u?7:0)+f-u;return h.setDate(h.getDate()-p),h.setHours(0,0,0,0),h}var bm=_(()=>{He();kt();Ce();hn()});function eu(n){var t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return t.setUTCFullYear(n.getFullYear()),n.getTime()-t.getTime()}var Tm=_(()=>{});function We(n){z(1,arguments);var t=X(n);return t.setHours(0,0,0,0),t}var tu=_(()=>{He();Ce()});function El(n,t){z(2,arguments);var e=pe(t),r=e*7;return gt(n,r)}var Em=_(()=>{kt();bl();Ce()});var CE,xE,ru,iu,GA,_E,km,QA,ME,AE,KA,nu=_(()=>{CE=365.2425,xE=Math.pow(10,8)*24*60*60*1e3,ru=6e4,iu=36e5,GA=-xE,_E=3600,km=_E*24,QA=km*7,ME=km*CE,AE=ME/12,KA=AE*3});function Lr(n,t){z(2,arguments);var e=We(n),r=We(t);return e.getTime()===r.getTime()}var su=_(()=>{tu();Ce()});function au(n){return z(1,arguments),n instanceof Date||mi(n)==="object"&&Object.prototype.toString.call(n)==="[object Date]"}var Dm=_(()=>{wl();Ce()});function rt(n){if(z(1,arguments),!au(n)&&typeof n!="number")return!1;var t=X(n);return!isNaN(Number(t))}var ou=_(()=>{Dm();He();Ce()});function pn(n){z(1,arguments);var t=X(n);return t.setHours(23,59,59,999),t}var Sm=_(()=>{He();Ce()});function mn(n,t){var e,r,i,s,a,o,l,c;z(1,arguments);var d=Ht(),u=pe((e=(r=(i=(s=t==null?void 0:t.weekStartsOn)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(o=a.options)===null||o===void 0?void 0:o.weekStartsOn)!==null&&i!==void 0?i:d.weekStartsOn)!==null&&r!==void 0?r:(l=d.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&e!==void 0?e:0);if(!(u>=0&&u<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=X(n),f=h.getDay(),p=(f<u?-7:0)+6-(f-u);return h.setDate(h.getDate()+p),h.setHours(23,59,59,999),h}var Cm=_(()=>{hn();He();kt();Ce()});function lu(n,t){z(2,arguments);var e=pe(t);return Xd(n,-e)}var xm=_(()=>{wm();Ce();kt()});function cu(n){z(1,arguments);var t=X(n),e=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=t.getTime(),i=e-r;return Math.floor(i/IE)+1}var IE,_m=_(()=>{He();Ce();IE=864e5});function yi(n){z(1,arguments);var t=1,e=X(n),r=e.getUTCDay(),i=(r<t?7:0)+r-t;return e.setUTCDate(e.getUTCDate()-i),e.setUTCHours(0,0,0,0),e}var kl=_(()=>{He();Ce()});function aa(n){z(1,arguments);var t=X(n),e=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(e+1,0,4),r.setUTCHours(0,0,0,0);var i=yi(r),s=new Date(0);s.setUTCFullYear(e,0,4),s.setUTCHours(0,0,0,0);var a=yi(s);return t.getTime()>=i.getTime()?e+1:t.getTime()>=a.getTime()?e:e-1}var du=_(()=>{He();Ce();kl()});function uu(n){z(1,arguments);var t=aa(n),e=new Date(0);e.setUTCFullYear(t,0,4),e.setUTCHours(0,0,0,0);var r=yi(e);return r}var Mm=_(()=>{du();kl();Ce()});function hu(n){z(1,arguments);var t=X(n),e=yi(t).getTime()-uu(t).getTime();return Math.round(e/PE)+1}var PE,Am=_(()=>{He();kl();Mm();Ce();PE=6048e5});function vi(n,t){var e,r,i,s,a,o,l,c;z(1,arguments);var d=Ht(),u=pe((e=(r=(i=(s=t==null?void 0:t.weekStartsOn)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(o=a.options)===null||o===void 0?void 0:o.weekStartsOn)!==null&&i!==void 0?i:d.weekStartsOn)!==null&&r!==void 0?r:(l=d.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&e!==void 0?e:0);if(!(u>=0&&u<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=X(n),f=h.getUTCDay(),p=(f<u?7:0)+f-u;return h.setUTCDate(h.getUTCDate()-p),h.setUTCHours(0,0,0,0),h}var Dl=_(()=>{He();Ce();kt();hn()});function oa(n,t){var e,r,i,s,a,o,l,c;z(1,arguments);var d=X(n),u=d.getUTCFullYear(),h=Ht(),f=pe((e=(r=(i=(s=t==null?void 0:t.firstWeekContainsDate)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(o=a.options)===null||o===void 0?void 0:o.firstWeekContainsDate)!==null&&i!==void 0?i:h.firstWeekContainsDate)!==null&&r!==void 0?r:(l=h.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&e!==void 0?e:1);if(!(f>=1&&f<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var p=new Date(0);p.setUTCFullYear(u+1,0,f),p.setUTCHours(0,0,0,0);var m=vi(p,t),g=new Date(0);g.setUTCFullYear(u,0,f),g.setUTCHours(0,0,0,0);var v=vi(g,t);return d.getTime()>=m.getTime()?u+1:d.getTime()>=v.getTime()?u:u-1}var fu=_(()=>{He();Ce();Dl();kt();hn()});function pu(n,t){var e,r,i,s,a,o,l,c;z(1,arguments);var d=Ht(),u=pe((e=(r=(i=(s=t==null?void 0:t.firstWeekContainsDate)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(o=a.options)===null||o===void 0?void 0:o.firstWeekContainsDate)!==null&&i!==void 0?i:d.firstWeekContainsDate)!==null&&r!==void 0?r:(l=d.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&e!==void 0?e:1),h=oa(n,t),f=new Date(0);f.setUTCFullYear(h,0,u),f.setUTCHours(0,0,0,0);var p=vi(f,t);return p}var Im=_(()=>{fu();Ce();Dl();kt();hn()});function mu(n,t){z(1,arguments);var e=X(n),r=vi(e,t).getTime()-pu(e,t).getTime();return Math.round(r/NE)+1}var NE,Pm=_(()=>{He();Dl();Im();Ce();NE=6048e5});function ye(n,t){for(var e=n<0?"-":"",r=Math.abs(n).toString();r.length<t;)r="0"+r;return e+r}var gu=_(()=>{});var OE,Fr,Nm=_(()=>{gu();OE={y:function(t,e){var r=t.getUTCFullYear(),i=r>0?r:1-r;return ye(e==="yy"?i%100:i,e.length)},M:function(t,e){var r=t.getUTCMonth();return e==="M"?String(r+1):ye(r+1,2)},d:function(t,e){return ye(t.getUTCDate(),e.length)},a:function(t,e){var r=t.getUTCHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h:function(t,e){return ye(t.getUTCHours()%12||12,e.length)},H:function(t,e){return ye(t.getUTCHours(),e.length)},m:function(t,e){return ye(t.getUTCMinutes(),e.length)},s:function(t,e){return ye(t.getUTCSeconds(),e.length)},S:function(t,e){var r=e.length,i=t.getUTCMilliseconds(),s=Math.floor(i*Math.pow(10,r-3));return ye(s,e.length)}},Fr=OE});function Om(n,t){var e=n>0?"-":"+",r=Math.abs(n),i=Math.floor(r/60),s=r%60;if(s===0)return e+String(i);var a=t||"";return e+String(i)+a+ye(s,2)}function Rm(n,t){if(n%60===0){var e=n>0?"-":"+";return e+ye(Math.abs(n)/60,2)}return gn(n,t)}function gn(n,t){var e=t||"",r=n>0?"-":"+",i=Math.abs(n),s=ye(Math.floor(i/60),2),a=ye(i%60,2);return r+s+e+a}var rs,RE,Lm,Fm=_(()=>{_m();Am();du();Pm();fu();gu();Nm();rs={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},RE={G:function(t,e,r){var i=t.getUTCFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return r.era(i,{width:"abbreviated"});case"GGGGG":return r.era(i,{width:"narrow"});case"GGGG":default:return r.era(i,{width:"wide"})}},y:function(t,e,r){if(e==="yo"){var i=t.getUTCFullYear(),s=i>0?i:1-i;return r.ordinalNumber(s,{unit:"year"})}return Fr.y(t,e)},Y:function(t,e,r,i){var s=oa(t,i),a=s>0?s:1-s;if(e==="YY"){var o=a%100;return ye(o,2)}return e==="Yo"?r.ordinalNumber(a,{unit:"year"}):ye(a,e.length)},R:function(t,e){var r=aa(t);return ye(r,e.length)},u:function(t,e){var r=t.getUTCFullYear();return ye(r,e.length)},Q:function(t,e,r){var i=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case"Q":return String(i);case"QQ":return ye(i,2);case"Qo":return r.ordinalNumber(i,{unit:"quarter"});case"QQQ":return r.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(i,{width:"wide",context:"formatting"})}},q:function(t,e,r){var i=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case"q":return String(i);case"qq":return ye(i,2);case"qo":return r.ordinalNumber(i,{unit:"quarter"});case"qqq":return r.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(i,{width:"wide",context:"standalone"})}},M:function(t,e,r){var i=t.getUTCMonth();switch(e){case"M":case"MM":return Fr.M(t,e);case"Mo":return r.ordinalNumber(i+1,{unit:"month"});case"MMM":return r.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(i,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(i,{width:"wide",context:"formatting"})}},L:function(t,e,r){var i=t.getUTCMonth();switch(e){case"L":return String(i+1);case"LL":return ye(i+1,2);case"Lo":return r.ordinalNumber(i+1,{unit:"month"});case"LLL":return r.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(i,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(i,{width:"wide",context:"standalone"})}},w:function(t,e,r,i){var s=mu(t,i);return e==="wo"?r.ordinalNumber(s,{unit:"week"}):ye(s,e.length)},I:function(t,e,r){var i=hu(t);return e==="Io"?r.ordinalNumber(i,{unit:"week"}):ye(i,e.length)},d:function(t,e,r){return e==="do"?r.ordinalNumber(t.getUTCDate(),{unit:"date"}):Fr.d(t,e)},D:function(t,e,r){var i=cu(t);return e==="Do"?r.ordinalNumber(i,{unit:"dayOfYear"}):ye(i,e.length)},E:function(t,e,r){var i=t.getUTCDay();switch(e){case"E":case"EE":case"EEE":return r.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(i,{width:"short",context:"formatting"});case"EEEE":default:return r.day(i,{width:"wide",context:"formatting"})}},e:function(t,e,r,i){var s=t.getUTCDay(),a=(s-i.weekStartsOn+8)%7||7;switch(e){case"e":return String(a);case"ee":return ye(a,2);case"eo":return r.ordinalNumber(a,{unit:"day"});case"eee":return r.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(s,{width:"short",context:"formatting"});case"eeee":default:return r.day(s,{width:"wide",context:"formatting"})}},c:function(t,e,r,i){var s=t.getUTCDay(),a=(s-i.weekStartsOn+8)%7||7;switch(e){case"c":return String(a);case"cc":return ye(a,e.length);case"co":return r.ordinalNumber(a,{unit:"day"});case"ccc":return r.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(s,{width:"narrow",context:"standalone"});case"cccccc":return r.day(s,{width:"short",context:"standalone"});case"cccc":default:return r.day(s,{width:"wide",context:"standalone"})}},i:function(t,e,r){var i=t.getUTCDay(),s=i===0?7:i;switch(e){case"i":return String(s);case"ii":return ye(s,e.length);case"io":return r.ordinalNumber(s,{unit:"day"});case"iii":return r.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(i,{width:"short",context:"formatting"});case"iiii":default:return r.day(i,{width:"wide",context:"formatting"})}},a:function(t,e,r){var i=t.getUTCHours(),s=i/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,e,r){var i=t.getUTCHours(),s;switch(i===12?s=rs.noon:i===0?s=rs.midnight:s=i/12>=1?"pm":"am",e){case"b":case"bb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,e,r){var i=t.getUTCHours(),s;switch(i>=17?s=rs.evening:i>=12?s=rs.afternoon:i>=4?s=rs.morning:s=rs.night,e){case"B":case"BB":case"BBB":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,e,r){if(e==="ho"){var i=t.getUTCHours()%12;return i===0&&(i=12),r.ordinalNumber(i,{unit:"hour"})}return Fr.h(t,e)},H:function(t,e,r){return e==="Ho"?r.ordinalNumber(t.getUTCHours(),{unit:"hour"}):Fr.H(t,e)},K:function(t,e,r){var i=t.getUTCHours()%12;return e==="Ko"?r.ordinalNumber(i,{unit:"hour"}):ye(i,e.length)},k:function(t,e,r){var i=t.getUTCHours();return i===0&&(i=24),e==="ko"?r.ordinalNumber(i,{unit:"hour"}):ye(i,e.length)},m:function(t,e,r){return e==="mo"?r.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):Fr.m(t,e)},s:function(t,e,r){return e==="so"?r.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):Fr.s(t,e)},S:function(t,e){return Fr.S(t,e)},X:function(t,e,r,i){var s=i._originalDate||t,a=s.getTimezoneOffset();if(a===0)return"Z";switch(e){case"X":return Rm(a);case"XXXX":case"XX":return gn(a);case"XXXXX":case"XXX":default:return gn(a,":")}},x:function(t,e,r,i){var s=i._originalDate||t,a=s.getTimezoneOffset();switch(e){case"x":return Rm(a);case"xxxx":case"xx":return gn(a);case"xxxxx":case"xxx":default:return gn(a,":")}},O:function(t,e,r,i){var s=i._originalDate||t,a=s.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Om(a,":");case"OOOO":default:return"GMT"+gn(a,":")}},z:function(t,e,r,i){var s=i._originalDate||t,a=s.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Om(a,":");case"zzzz":default:return"GMT"+gn(a,":")}},t:function(t,e,r,i){var s=i._originalDate||t,a=Math.floor(s.getTime()/1e3);return ye(a,e.length)},T:function(t,e,r,i){var s=i._originalDate||t,a=s.getTime();return ye(a,e.length)}};Lm=RE});var Bm,Hm,LE,FE,Ym,Um=_(()=>{Bm=function(t,e){switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Hm=function(t,e){switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},LE=function(t,e){var r=t.match(/(P+)(p+)?/)||[],i=r[1],s=r[2];if(!s)return Bm(t,e);var a;switch(i){case"P":a=e.dateTime({width:"short"});break;case"PP":a=e.dateTime({width:"medium"});break;case"PPP":a=e.dateTime({width:"long"});break;case"PPPP":default:a=e.dateTime({width:"full"});break}return a.replace("{{date}}",Bm(i,e)).replace("{{time}}",Hm(s,e))},FE={p:Hm,P:LE},Ym=FE});function Vm(n){return BE.indexOf(n)!==-1}function Wm(n){return HE.indexOf(n)!==-1}function yu(n,t,e){if(n==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(e,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(n==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(e,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(n==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(e,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(n==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(e,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var BE,HE,jm=_(()=>{BE=["D","DD"],HE=["YY","YYYY"]});var YE,UE,$m,zm=_(()=>{YE={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},UE=function(t,e,r){var i,s=YE[t];return typeof s=="string"?i=s:e===1?i=s.one:i=s.other.replace("{{count}}",e.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+i:i+" ago":i},$m=UE});function la(n){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.width?String(t.width):n.defaultWidth,r=n.formats[e]||n.formats[n.defaultWidth];return r}}var qm=_(()=>{});var VE,WE,jE,$E,Gm,Qm=_(()=>{qm();VE={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},WE={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},jE={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},$E={date:la({formats:VE,defaultWidth:"full"}),time:la({formats:WE,defaultWidth:"full"}),dateTime:la({formats:jE,defaultWidth:"full"})},Gm=$E});var zE,qE,Km,Zm=_(()=>{zE={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},qE=function(t,e,r,i){return zE[t]},Km=qE});function yn(n){return function(t,e){var r=e!=null&&e.context?String(e.context):"standalone",i;if(r==="formatting"&&n.formattingValues){var s=n.defaultFormattingWidth||n.defaultWidth,a=e!=null&&e.width?String(e.width):s;i=n.formattingValues[a]||n.formattingValues[s]}else{var o=n.defaultWidth,l=e!=null&&e.width?String(e.width):n.defaultWidth;i=n.values[l]||n.values[o]}var c=n.argumentCallback?n.argumentCallback(t):t;return i[c]}}var Jm=_(()=>{});var GE,QE,KE,ZE,JE,XE,ek,tk,Xm,eg=_(()=>{Jm();GE={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},QE={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},KE={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ZE={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},JE={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},XE={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ek=function(t,e){var r=Number(t),i=r%100;if(i>20||i<10)switch(i%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},tk={ordinalNumber:ek,era:yn({values:GE,defaultWidth:"wide"}),quarter:yn({values:QE,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:yn({values:KE,defaultWidth:"wide"}),day:yn({values:ZE,defaultWidth:"wide"}),dayPeriod:yn({values:JE,defaultWidth:"wide",formattingValues:XE,defaultFormattingWidth:"wide"})},Xm=tk});function vn(n){return function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e.width,i=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],s=t.match(i);if(!s)return null;var a=s[0],o=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],l=Array.isArray(o)?ik(o,function(u){return u.test(a)}):rk(o,function(u){return u.test(a)}),c;c=n.valueCallback?n.valueCallback(l):l,c=e.valueCallback?e.valueCallback(c):c;var d=t.slice(a.length);return{value:c,rest:d}}}function rk(n,t){for(var e in n)if(n.hasOwnProperty(e)&&t(n[e]))return e}function ik(n,t){for(var e=0;e<n.length;e++)if(t(n[e]))return e}var tg=_(()=>{});function vu(n){return function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.match(n.matchPattern);if(!r)return null;var i=r[0],s=t.match(n.parsePattern);if(!s)return null;var a=n.valueCallback?n.valueCallback(s[0]):s[0];a=e.valueCallback?e.valueCallback(a):a;var o=t.slice(i.length);return{value:a,rest:o}}}var rg=_(()=>{});var nk,sk,ak,ok,lk,ck,dk,uk,hk,fk,pk,mk,gk,ig,ng=_(()=>{tg();rg();nk=/^(\d+)(th|st|nd|rd)?/i,sk=/\d+/i,ak={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ok={any:[/^b/i,/^(a|c)/i]},lk={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ck={any:[/1/i,/2/i,/3/i,/4/i]},dk={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},uk={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},hk={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},fk={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},pk={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},mk={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},gk={ordinalNumber:vu({matchPattern:nk,parsePattern:sk,valueCallback:function(t){return parseInt(t,10)}}),era:vn({matchPatterns:ak,defaultMatchWidth:"wide",parsePatterns:ok,defaultParseWidth:"any"}),quarter:vn({matchPatterns:lk,defaultMatchWidth:"wide",parsePatterns:ck,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:vn({matchPatterns:dk,defaultMatchWidth:"wide",parsePatterns:uk,defaultParseWidth:"any"}),day:vn({matchPatterns:hk,defaultMatchWidth:"wide",parsePatterns:fk,defaultParseWidth:"any"}),dayPeriod:vn({matchPatterns:pk,defaultMatchWidth:"any",parsePatterns:mk,defaultParseWidth:"any"})},ig=gk});var yk,sg,ag=_(()=>{zm();Qm();Zm();eg();ng();yk={code:"en-US",formatDistance:$m,formatLong:Gm,formatRelative:Km,localize:Xm,match:ig,options:{weekStartsOn:0,firstWeekContainsDate:1}},sg=yk});var og,lg=_(()=>{ag();og=sg});function I(n,t,e){var r,i,s,a,o,l,c,d,u,h,f,p,m,g,v,T,k,D;z(2,arguments);var M=String(t),E=Ht(),C=(r=(i=e==null?void 0:e.locale)!==null&&i!==void 0?i:E.locale)!==null&&r!==void 0?r:og,S=pe((s=(a=(o=(l=e==null?void 0:e.firstWeekContainsDate)!==null&&l!==void 0?l:e==null||(c=e.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&o!==void 0?o:E.firstWeekContainsDate)!==null&&a!==void 0?a:(u=E.locale)===null||u===void 0||(h=u.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&s!==void 0?s:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var O=pe((f=(p=(m=(g=e==null?void 0:e.weekStartsOn)!==null&&g!==void 0?g:e==null||(v=e.locale)===null||v===void 0||(T=v.options)===null||T===void 0?void 0:T.weekStartsOn)!==null&&m!==void 0?m:E.weekStartsOn)!==null&&p!==void 0?p:(k=E.locale)===null||k===void 0||(D=k.options)===null||D===void 0?void 0:D.weekStartsOn)!==null&&f!==void 0?f:0);if(!(O>=0&&O<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!C.localize)throw new RangeError("locale must contain localize property");if(!C.formatLong)throw new RangeError("locale must contain formatLong property");var F=X(n);if(!rt(F))throw new RangeError("Invalid time value");var P=eu(F),x=lu(F,P),B={firstWeekContainsDate:S,weekStartsOn:O,locale:C,_originalDate:F},L=M.match(wk).map(function(H){var w=H[0];if(w==="p"||w==="P"){var R=Ym[w];return R(H,C.formatLong)}return H}).join("").match(vk).map(function(H){if(H==="''")return"'";var w=H[0];if(w==="'")return kk(H);var R=Lm[w];if(R)return!(e!=null&&e.useAdditionalWeekYearTokens)&&Wm(H)&&yu(H,t,String(n)),!(e!=null&&e.useAdditionalDayOfYearTokens)&&Vm(H)&&yu(H,t,String(n)),R(x,H,C.localize,B);if(w.match(Ek))throw new RangeError("Format string contains an unescaped latin alphabet character `"+w+"`");return H}).join("");return L}function kk(n){var t=n.match(bk);return t?t[1].replace(Tk,"'"):n}var vk,wk,bk,Tk,Ek,cg=_(()=>{ou();xm();He();Fm();Um();Tm();jm();kt();Ce();hn();lg();vk=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,wk=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,bk=/^'([^]*?)'?$/,Tk=/''/g,Ek=/[a-zA-Z]/});function Br(n,t){z(2,arguments);var e=X(n),r=X(t);return e.getTime()<r.getTime()}var dg=_(()=>{He();Ce()});function Sl(n,t){z(2,arguments);var e=X(n),r=X(t);return e.getFullYear()===r.getFullYear()&&e.getMonth()===r.getMonth()}var ug=_(()=>{He();Ce()});function is(n){return z(1,arguments),Lr(n,Date.now())}var hg=_(()=>{su();Ce()});function ns(n,t){var e;z(1,arguments);var r=pe((e=t==null?void 0:t.additionalDigits)!==null&&e!==void 0?e:2);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof n=="string"||Object.prototype.toString.call(n)==="[object String]"))return new Date(NaN);var i=xk(n),s;if(i.date){var a=_k(i.date,r);s=Mk(a.restDateString,a.year)}if(!s||isNaN(s.getTime()))return new Date(NaN);var o=s.getTime(),l=0,c;if(i.time&&(l=Ak(i.time),isNaN(l)))return new Date(NaN);if(i.timezone){if(c=Ik(i.timezone),isNaN(c))return new Date(NaN)}else{var d=new Date(o+l),u=new Date(0);return u.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),u}return new Date(o+l+c)}function xk(n){var t={},e=n.split(Cl.dateTimeDelimiter),r;if(e.length>2)return t;if(/:/.test(e[0])?r=e[0]:(t.date=e[0],r=e[1],Cl.timeZoneDelimiter.test(t.date)&&(t.date=n.split(Cl.timeZoneDelimiter)[0],r=n.substr(t.date.length,n.length))),r){var i=Cl.timezone.exec(r);i?(t.time=r.replace(i[1],""),t.timezone=i[1]):t.time=r}return t}function _k(n,t){var e=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=n.match(e);if(!r)return{year:NaN,restDateString:""};var i=r[1]?parseInt(r[1]):null,s=r[2]?parseInt(r[2]):null;return{year:s===null?i:s*100,restDateString:n.slice((r[1]||r[2]).length)}}function Mk(n,t){if(t===null)return new Date(NaN);var e=n.match(Dk);if(!e)return new Date(NaN);var r=!!e[4],i=ca(e[1]),s=ca(e[2])-1,a=ca(e[3]),o=ca(e[4]),l=ca(e[5])-1;if(r)return Lk(t,o,l)?Pk(t,o,l):new Date(NaN);var c=new Date(0);return!Ok(t,s,a)||!Rk(t,i)?new Date(NaN):(c.setUTCFullYear(t,s,Math.max(i,a)),c)}function ca(n){return n?parseInt(n):1}function Ak(n){var t=n.match(Sk);if(!t)return NaN;var e=wu(t[1]),r=wu(t[2]),i=wu(t[3]);return Fk(e,r,i)?e*iu+r*ru+i*1e3:NaN}function wu(n){return n&&parseFloat(n.replace(",","."))||0}function Ik(n){if(n==="Z")return 0;var t=n.match(Ck);if(!t)return 0;var e=t[1]==="+"?-1:1,r=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return Bk(r,i)?e*(r*iu+i*ru):NaN}function Pk(n,t,e){var r=new Date(0);r.setUTCFullYear(n,0,4);var i=r.getUTCDay()||7,s=(t-1)*7+e+1-i;return r.setUTCDate(r.getUTCDate()+s),r}function fg(n){return n%400===0||n%4===0&&n%100!==0}function Ok(n,t,e){return t>=0&&t<=11&&e>=1&&e<=(Nk[t]||(fg(n)?29:28))}function Rk(n,t){return t>=1&&t<=(fg(n)?366:365)}function Lk(n,t,e){return t>=1&&t<=53&&e>=0&&e<=6}function Fk(n,t,e){return n===24?t===0&&e===0:e>=0&&e<60&&t>=0&&t<60&&n>=0&&n<25}function Bk(n,t){return t>=0&&t<=59}var Cl,Dk,Sk,Ck,Nk,pg=_(()=>{nu();Ce();kt();Cl={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Dk=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Sk=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Ck=/^([+-])(\d{2})(?::?(\d{2}))?$/;Nk=[31,null,31,30,31,30,31,31,30,31,30,31]});var je=_(()=>{vm();bl();Em();Sm();Cm();cg();dg();su();ug();hg();ou();pg();tu();bm();nu()});var Yt=vl(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});var Ne=require("obsidian"),bu="YYYY-MM-DD",Tu="gggg-[W]ww",mg="YYYY-MM",gg="YYYY-[Q]Q",yg="YYYY";function da(n){var e,r;let t=window.app.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e[n])==null?void 0:r.enabled)}function ua(){var n,t,e,r;try{let{internalPlugins:i,plugins:s}=window.app;if(da("daily")){let{format:c,folder:d,template:u}=((t=(n=s.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:t.daily)||{};return{format:c||bu,folder:(d==null?void 0:d.trim())||"",template:(u==null?void 0:u.trim())||""}}let{folder:a,format:o,template:l}=((r=(e=i.getPluginById("daily-notes"))==null?void 0:e.instance)==null?void 0:r.options)||{};return{format:o||bu,folder:(a==null?void 0:a.trim())||"",template:(l==null?void 0:l.trim())||""}}catch(i){console.info("No custom daily note settings found!",i)}}function ha(){var n,t,e,r,i,s,a;try{let o=window.app.plugins,l=(n=o.getPlugin("calendar"))==null?void 0:n.options,c=(e=(t=o.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.weekly;if(da("weekly"))return{format:c.format||Tu,folder:((r=c.folder)==null?void 0:r.trim())||"",template:((i=c.template)==null?void 0:i.trim())||""};let d=l||{};return{format:d.weeklyNoteFormat||Tu,folder:((s=d.weeklyNoteFolder)==null?void 0:s.trim())||"",template:((a=d.weeklyNoteTemplate)==null?void 0:a.trim())||""}}catch(o){console.info("No custom weekly note settings found!",o)}}function fa(){var t,e,r,i;let n=window.app.plugins;try{let s=da("monthly")&&((e=(t=n.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.monthly)||{};return{format:s.format||mg,folder:((r=s.folder)==null?void 0:r.trim())||"",template:((i=s.template)==null?void 0:i.trim())||""}}catch(s){console.info("No custom monthly note settings found!",s)}}function pa(){var t,e,r,i;let n=window.app.plugins;try{let s=da("quarterly")&&((e=(t=n.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.quarterly)||{};return{format:s.format||gg,folder:((r=s.folder)==null?void 0:r.trim())||"",template:((i=s.template)==null?void 0:i.trim())||""}}catch(s){console.info("No custom quarterly note settings found!",s)}}function ma(){var t,e,r,i;let n=window.app.plugins;try{let s=da("yearly")&&((e=(t=n.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.yearly)||{};return{format:s.format||yg,folder:((r=s.folder)==null?void 0:r.trim())||"",template:((i=s.template)==null?void 0:i.trim())||""}}catch(s){console.info("No custom yearly note settings found!",s)}}function vg(...n){let t=[];for(let r=0,i=n.length;r<i;r++)t=t.concat(n[r].split("/"));let e=[];for(let r=0,i=t.length;r<i;r++){let s=t[r];!s||s==="."||e.push(s)}return t[0]===""&&e.unshift(""),e.join("/")}function Hk(n){let t=n.substring(n.lastIndexOf("/")+1);return t.lastIndexOf(".")!=-1&&(t=t.substring(0,t.lastIndexOf("."))),t}async function Yk(n){let t=n.replace(/\\/g,"/").split("/");if(t.pop(),t.length){let e=vg(...t);window.app.vault.getAbstractFileByPath(e)||await window.app.vault.createFolder(e)}}async function ga(n,t){t.endsWith(".md")||(t+=".md");let e=Ne.normalizePath(vg(n,t));return await Yk(e),e}async function ss(n){let{metadataCache:t,vault:e}=window.app,r=Ne.normalizePath(n);if(r==="/")return Promise.resolve(["",null]);try{let i=t.getFirstLinkpathDest(r,""),s=await e.cachedRead(i),a=window.app.foldManager.load(i);return[s,a]}catch(i){return console.error(`Failed to read the daily note template '${r}'`,i),new Ne.Notice("Failed to read the daily note template"),["",null]}}function rr(n,t="day"){let e=n.clone().startOf(t).format();return`${t}-${e}`}function wg(n){return n.replace(/\[[^\]]*\]/g,"")}function Uk(n,t){if(t==="week"){let e=wg(n);return/w{1,2}/i.test(e)&&(/M{1,4}/.test(e)||/D{1,4}/.test(e))}return!1}function as(n,t){return bg(n.basename,t)}function Vk(n,t){return bg(Hk(n),t)}function bg(n,t){let r={day:ua,week:ha,month:fa,quarter:pa,year:ma}[t]().format.split("/").pop(),i=window.moment(n,r,!0);if(!i.isValid())return null;if(Uk(r,t)&&t==="week"){let s=wg(r);if(/w{1,2}/i.test(s))return window.moment(n,r.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return i}var Eu=class extends Error{};async function Tg(n){let t=window.app,{vault:e}=t,r=window.moment,{template:i,format:s,folder:a}=ua(),[o,l]=await ss(i),c=n.format(s),d=await ga(a,c);try{let u=await e.create(d,o.replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,r().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(h,f,p,m,g,v)=>{let T=r(),k=n.clone().set({hour:T.get("hour"),minute:T.get("minute"),second:T.get("second")});return p&&k.add(parseInt(m,10),g),v?k.format(v.substring(1).trim()):k.format(s)}).replace(/{{\s*yesterday\s*}}/gi,n.clone().subtract(1,"day").format(s)).replace(/{{\s*tomorrow\s*}}/gi,n.clone().add(1,"d").format(s)));return t.foldManager.save(u,l),u}catch(u){console.error(`Failed to create file: '${d}'`,u),new Ne.Notice("Unable to create new file.")}}function Wk(n,t){var e;return(e=t[rr(n,"day")])!=null?e:null}function jk(){let{vault:n}=window.app,{folder:t}=ua(),e=n.getAbstractFileByPath(Ne.normalizePath(t));if(!e)throw new Eu("Failed to find daily notes folder");let r={};return Ne.Vault.recurseChildren(e,i=>{if(i instanceof Ne.TFile){let s=as(i,"day");if(s){let a=rr(s,"day");r[a]=i}}}),r}var ku=class extends Error{};function $k(){let{moment:n}=window,t=n.localeData()._week.dow,e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;t;)e.push(e.shift()),t--;return e}function zk(n){return $k().indexOf(n.toLowerCase())}async function Eg(n){let{vault:t}=window.app,{template:e,format:r,folder:i}=ha(),[s,a]=await ss(e),o=n.format(r),l=await ga(i,o);try{let c=await t.create(l,s.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,f,p,m)=>{let g=window.moment(),v=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&v.add(parseInt(f,10),p),m?v.format(m.substring(1).trim()):v.format(r)}).replace(/{{\s*title\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(d,u,h)=>{let f=zk(u);return n.weekday(f).format(h.trim())}));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new Ne.Notice("Unable to create new file.")}}function qk(n,t){var e;return(e=t[rr(n,"week")])!=null?e:null}function Gk(){let n={};if(!Dg())return n;let{vault:t}=window.app,{folder:e}=ha(),r=t.getAbstractFileByPath(Ne.normalizePath(e));if(!r)throw new ku("Failed to find weekly notes folder");return Ne.Vault.recurseChildren(r,i=>{if(i instanceof Ne.TFile){let s=as(i,"week");if(s){let a=rr(s,"week");n[a]=i}}}),n}var Du=class extends Error{};async function kg(n){let{vault:t}=window.app,{template:e,format:r,folder:i}=fa(),[s,a]=await ss(e),o=n.format(r),l=await ga(i,o);try{let c=await t.create(l,s.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,f,p,m)=>{let g=window.moment(),v=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&v.add(parseInt(f,10),p),m?v.format(m.substring(1).trim()):v.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new Ne.Notice("Unable to create new file.")}}function Qk(n,t){var e;return(e=t[rr(n,"month")])!=null?e:null}function Kk(){let n={};if(!Sg())return n;let{vault:t}=window.app,{folder:e}=fa(),r=t.getAbstractFileByPath(Ne.normalizePath(e));if(!r)throw new Du("Failed to find monthly notes folder");return Ne.Vault.recurseChildren(r,i=>{if(i instanceof Ne.TFile){let s=as(i,"month");if(s){let a=rr(s,"month");n[a]=i}}}),n}var Su=class extends Error{};async function Zk(n){let{vault:t}=window.app,{template:e,format:r,folder:i}=pa(),[s,a]=await ss(e),o=n.format(r),l=await ga(i,o);try{let c=await t.create(l,s.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,f,p,m)=>{let g=window.moment(),v=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&v.add(parseInt(f,10),p),m?v.format(m.substring(1).trim()):v.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new Ne.Notice("Unable to create new file.")}}function Jk(n,t){var e;return(e=t[rr(n,"quarter")])!=null?e:null}function Xk(){let n={};if(!Cg())return n;let{vault:t}=window.app,{folder:e}=pa(),r=t.getAbstractFileByPath(Ne.normalizePath(e));if(!r)throw new Su("Failed to find quarterly notes folder");return Ne.Vault.recurseChildren(r,i=>{if(i instanceof Ne.TFile){let s=as(i,"quarter");if(s){let a=rr(s,"quarter");n[a]=i}}}),n}var Cu=class extends Error{};async function eD(n){let{vault:t}=window.app,{template:e,format:r,folder:i}=ma(),[s,a]=await ss(e),o=n.format(r),l=await ga(i,o);try{let c=await t.create(l,s.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,f,p,m)=>{let g=window.moment(),v=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&v.add(parseInt(f,10),p),m?v.format(m.substring(1).trim()):v.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new Ne.Notice("Unable to create new file.")}}function tD(n,t){var e;return(e=t[rr(n,"year")])!=null?e:null}function rD(){let n={};if(!xg())return n;let{vault:t}=window.app,{folder:e}=ma(),r=t.getAbstractFileByPath(Ne.normalizePath(e));if(!r)throw new Cu("Failed to find yearly notes folder");return Ne.Vault.recurseChildren(r,i=>{if(i instanceof Ne.TFile){let s=as(i,"year");if(s){let a=rr(s,"year");n[a]=i}}}),n}function iD(){var r,i;let{app:n}=window,t=n.internalPlugins.plugins["daily-notes"];if(t&&t.enabled)return!0;let e=n.plugins.getPlugin("periodic-notes");return e&&((i=(r=e.settings)==null?void 0:r.daily)==null?void 0:i.enabled)}function Dg(){var e,r;let{app:n}=window;if(n.plugins.getPlugin("calendar"))return!0;let t=n.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e.weekly)==null?void 0:r.enabled)}function Sg(){var e,r;let{app:n}=window,t=n.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e.monthly)==null?void 0:r.enabled)}function Cg(){var e,r;let{app:n}=window,t=n.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e.quarterly)==null?void 0:r.enabled)}function xg(){var e,r;let{app:n}=window,t=n.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e.yearly)==null?void 0:r.enabled)}function nD(n){let t={day:ua,week:ha,month:fa,quarter:pa,year:ma}[n];return t()}function sD(n,t){return{day:Tg,month:kg,week:Eg}[n](t)}se.DEFAULT_DAILY_NOTE_FORMAT=bu;se.DEFAULT_MONTHLY_NOTE_FORMAT=mg;se.DEFAULT_QUARTERLY_NOTE_FORMAT=gg;se.DEFAULT_WEEKLY_NOTE_FORMAT=Tu;se.DEFAULT_YEARLY_NOTE_FORMAT=yg;se.appHasDailyNotesPluginLoaded=iD;se.appHasMonthlyNotesPluginLoaded=Sg;se.appHasQuarterlyNotesPluginLoaded=Cg;se.appHasWeeklyNotesPluginLoaded=Dg;se.appHasYearlyNotesPluginLoaded=xg;se.createDailyNote=Tg;se.createMonthlyNote=kg;se.createPeriodicNote=sD;se.createQuarterlyNote=Zk;se.createWeeklyNote=Eg;se.createYearlyNote=eD;se.getAllDailyNotes=jk;se.getAllMonthlyNotes=Kk;se.getAllQuarterlyNotes=Xk;se.getAllWeeklyNotes=Gk;se.getAllYearlyNotes=rD;se.getDailyNote=Wk;se.getDailyNoteSettings=ua;se.getDateFromFile=as;se.getDateFromPath=Vk;se.getDateUID=rr;se.getMonthlyNote=Qk;se.getMonthlyNoteSettings=fa;se.getPeriodicNoteSettings=nD;se.getQuarterlyNote=Jk;se.getQuarterlyNoteSettings=pa;se.getTemplateInfo=ss;se.getWeeklyNote=qk;se.getWeeklyNoteSettings=ha;se.getYearlyNote=tD;se.getYearlyNoteSettings=ma});var wi,xu=_(()=>{wi=class{constructor(t){this.statuses=t}getNextStatus(t){var s;let e=this.getStatusesByOrder(),r=e.findIndex(a=>a.value===t);if(r===-1)return((s=e[0])==null?void 0:s.value)||"open";let i=(r+1)%e.length;return e[i].value}getStatusConfig(t){return this.statuses.find(e=>e.value===t)}getCompletedStatuses(){return this.statuses.filter(t=>t.isCompleted).map(t=>t.value)}getOpenStatuses(){return this.statuses.filter(t=>!t.isCompleted).map(t=>t.value)}getStatusesByOrder(){return[...this.statuses].sort((t,e)=>t.order-e.order)}isCompletedStatus(t){let e=this.getStatusConfig(t);return(e==null?void 0:e.isCompleted)||!1}getStatusOrder(t){let e=this.getStatusConfig(t);return(e==null?void 0:e.order)||0}getStatusStyles(){let t=[];for(let e of this.statuses){let r=`--status-${e.value.replace(/[^a-zA-Z0-9-]/g,"-")}-color`;t.push(`${r}: ${e.color};`)}return`:root { ${t.join(" ")} }`}getAllStatuses(){return[...this.statuses]}getNonCompletionStatuses(){return this.statuses.filter(t=>!t.isCompleted)}updateStatuses(t){this.statuses=t}static validateStatuses(t){let e=[];t.length<2&&e.push("At least 2 statuses are required"),t.some(l=>l.isCompleted)||e.push("At least one status must be marked as completed");let i=t.map(l=>l.value),s=new Set(i);i.length!==s.size&&e.push("Status values must be unique");let a=t.map(l=>l.id),o=new Set(a);a.length!==o.size&&e.push("Status IDs must be unique");for(let l of t){if(!l.value||l.value.trim()===""){e.push("Status values cannot be empty");break}if(!l.label||l.label.trim()===""){e.push("Status labels cannot be empty");break}if(!l.color||!l.color.match(/^#[0-9a-fA-F]{6}$/)){e.push("Status colors must be valid hex colors (#rrggbb)");break}}return{valid:e.length===0,errors:e}}static generateStatusId(t){let e=new Set(t.map(s=>s.id)),r=1,i=`status-${r}`;for(;e.has(i);)r++,i=`status-${r}`;return i}static createDefaultStatus(t){let e=wi.generateStatusId(t),r=Math.max(...t.map(i=>i.order),0)+1;return{id:e,value:"new-status",label:"New status",color:"#808080",isCompleted:!1,order:r}}}});var Hr,_u=_(()=>{Hr=class{constructor(t){this.priorities=t}getPriorityConfig(t){return this.priorities.find(e=>e.value===t)}getPrioritiesByWeight(){return[...this.priorities].sort((t,e)=>e.weight-t.weight)}getPrioritiesByWeightAsc(){return[...this.priorities].sort((t,e)=>t.weight-e.weight)}getNextPriority(t){var s;let e=this.getPrioritiesByWeightAsc(),r=e.findIndex(a=>a.value===t);if(r===-1)return((s=e[0])==null?void 0:s.value)||"normal";let i=(r+1)%e.length;return e[i].value}comparePriorities(t,e){let r=this.getPriorityConfig(t),i=this.getPriorityConfig(e),s=(r==null?void 0:r.weight)||0;return((i==null?void 0:i.weight)||0)-s}getPriorityStyles(){let t=[];for(let e of this.priorities){let r=`--priority-${e.value.replace(/[^a-zA-Z0-9-]/g,"-")}-color`;t.push(`${r}: ${e.color};`)}return`:root { ${t.join(" ")} }`}getAllPriorities(){return[...this.priorities]}updatePriorities(t){this.priorities=t}getHighestPriority(){var e;return(e=this.getPrioritiesByWeight()[0])==null?void 0:e.value}getLowestPriority(){var e;return(e=this.getPrioritiesByWeightAsc()[0])==null?void 0:e.value}getPriorityWeight(t){let e=this.getPriorityConfig(t);return(e==null?void 0:e.weight)||0}isHigherPriority(t,e){return this.comparePriorities(t,e)>0}static validatePriorities(t){let e=[];t.length<1&&e.push("At least 1 priority is required");let r=t.map(c=>c.value),i=new Set(r);r.length!==i.size&&e.push("Priority values must be unique");let s=t.map(c=>c.id),a=new Set(s);s.length!==a.size&&e.push("Priority IDs must be unique");let o=t.map(c=>c.weight),l=new Set(o);o.length!==l.size&&e.push("Priority weights must be unique");for(let c of t){if(!c.value||c.value.trim()===""){e.push("Priority values cannot be empty");break}if(!c.label||c.label.trim()===""){e.push("Priority labels cannot be empty");break}if(!c.color||!c.color.match(/^#[0-9a-fA-F]{6}$/)){e.push("Priority colors must be valid hex colors (#rrggbb)");break}if(typeof c.weight!="number"||c.weight<0){e.push("Priority weights must be non-negative numbers");break}}return{valid:e.length===0,errors:e}}static generatePriorityId(t){let e=new Set(t.map(s=>s.id)),r=1,i=`priority-${r}`;for(;e.has(i);)r++,i=`priority-${r}`;return i}static generatePriorityWeight(t){let e=t.map(r=>r.weight);return e.length===0?1:Math.max(...e)+1}static createDefaultPriority(t){let e=Hr.generatePriorityId(t),r=Hr.generatePriorityWeight(t);return{id:e,value:"new-priority",label:"New priority",color:"#808080",weight:r}}}});async function wn(n,t){return new Mu(n,t).show()}var xl,Mu,Au=_(()=>{xl=require("obsidian"),Mu=class extends xl.Modal{constructor(e,r){super(e);this.options={confirmText:"Confirm",cancelText:"Cancel",isDestructive:!1,...r}}show(){return new Promise(e=>{this.resolve=e,this.open()})}onOpen(){let{contentEl:e}=this;e.empty(),new xl.Setting(e).setName(this.options.title).setHeading(),e.createEl("p",{text:this.options.message});let r=e.createEl("div",{cls:"modal-button-container"});r.style.display="flex",r.style.gap="10px",r.style.justifyContent="flex-end",r.style.marginTop="20px";let i=r.createEl("button",{text:this.options.cancelText});i.addEventListener("click",()=>{this.resolve(!1),this.close()});let s=r.createEl("button",{text:this.options.confirmText,cls:this.options.isDestructive?"mod-warning":"mod-cta"});this.options.isDestructive&&(s.style.backgroundColor="var(--color-red)",s.style.color="white"),s.addEventListener("click",()=>{this.resolve(!0),this.close()}),i.focus()}onClose(){let{contentEl:e}=this;e.empty(),this.resolve&&this.resolve(!1)}}});async function _g(n,t){return new Iu(n,t).show()}var _l,Iu,Mg=_(()=>{_l=require("obsidian"),Iu=class extends _l.Modal{constructor(e,r){super(e);this.hasExistingData=r}show(){return new Promise(e=>{this.resolve=e,this.open()})}onOpen(){let{contentEl:e}=this;e.empty();let r=this.hasExistingData?"Migrate pomodoro data?":"Switch to daily notes storage?";new _l.Setting(e).setName(r).setHeading();let i=this.hasExistingData?"This will migrate your existing pomodoro session data to daily notes frontmatter. The data will be grouped by date and stored in each daily note.":"Pomodoro session data will be stored in daily notes frontmatter instead of the plugin data file.",a=e.createEl("p").createEl("strong");a.textContent=i,e.createEl("br"),e.createEl("p",{text:"What this means:"});let o=e.createEl("ul");["Daily Notes core plugin must remain enabled","Data will be stored in your daily notes frontmatter",this.hasExistingData?"Existing plugin data will be migrated and then cleared":"Future sessions will be saved to daily notes","This provides better data longevity with your notes"].forEach(f=>{let p=o.createEl("li");p.textContent=`\u2022 ${f}`}),e.createEl("br");let c=e.createEl("p");if(this.hasExistingData){let f=c.createEl("strong");f.textContent="\u26A0\uFE0F Make sure you have backups if needed. This change cannot be automatically undone."}else c.textContent="You can switch back to plugin storage at any time in the future.";let d=e.createEl("div",{cls:"modal-button-container"});d.style.display="flex",d.style.gap="10px",d.style.justifyContent="flex-end",d.style.marginTop="20px",d.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.resolve(!1),this.close()});let h=d.createEl("button",{text:this.hasExistingData?"Migrate data":"Switch storage",cls:"mod-cta"});h.addEventListener("click",()=>{this.resolve(!0),this.close()}),window.setTimeout(()=>{h.focus()},50)}onClose(){let{contentEl:e}=this;e.empty(),this.resolve&&this.resolve(!1)}}});var Yr,os,Pu=_(()=>{Yr=require("obsidian"),os=class extends Yr.FuzzySuggestModal{constructor(e,r,i){super(e);this.plugin=r,this.onChoose=i,this.setPlaceholder("Type to search for project notes..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles().filter(e=>e instanceof Yr.TFile&&e.extension==="md"&&!e.path.includes(".trash"))}getItemText(e){let r=`${e.name} ${e.path}`;if(e instanceof Yr.TFile){let i=this.app.metadataCache.getFileCache(e);if(i!=null&&i.frontmatter){let s=(0,Yr.parseFrontMatterAliases)(i.frontmatter);s&&s.length>0&&(r+=` ${s.join(" ")}`)}}return r}renderSuggestion(e,r){let i=e.item;r.empty();let s=r.createDiv({cls:"project-suggestion"}),a=s.createSpan({cls:"project-name"});if(a.textContent=i.name,i instanceof Yr.TFile){let o=this.app.metadataCache.getFileCache(i);if(o!=null&&o.frontmatter){let l=this.plugin.fieldMapper.toUserField("title"),c=o.frontmatter[l];if(c){let d=s.createDiv({cls:"project-title"});d.textContent=c}else{let d=(0,Yr.parseFrontMatterAliases)(o.frontmatter);if(d&&d.length>0){let u=s.createDiv({cls:"project-aliases"});u.textContent=d.join(", ")}}}}if(i.path!==i.name){let o=s.createDiv({cls:"project-path"});o.textContent=i.path}}onChooseItem(e,r){this.onChoose(e)}}});var N,Al,aD,oD,lD,cD,mr,Ml,Nu=_(()=>{N=require("obsidian");xu();_u();Au();Mg();Pu();Al={title:"title",status:"status",priority:"priority",due:"due",scheduled:"scheduled",contexts:"contexts",projects:"projects",timeEstimate:"timeEstimate",completedDate:"completedDate",dateCreated:"dateCreated",dateModified:"dateModified",recurrence:"recurrence",archiveTag:"archived",timeEntries:"timeEntries",completeInstances:"complete_instances",pomodoros:"pomodoros",icsEventId:"icsEventId",icsEventTag:"ics_event"},aD=[{id:"none",value:"none",label:"None",color:"#cccccc",isCompleted:!1,order:0},{id:"open",value:"open",label:"Open",color:"#808080",isCompleted:!1,order:1},{id:"in-progress",value:"in-progress",label:"In progress",color:"#0066cc",isCompleted:!1,order:2},{id:"done",value:"done",label:"Done",color:"#00aa00",isCompleted:!0,order:3}],oD=[{id:"none",value:"none",label:"None",color:"#cccccc",weight:0},{id:"low",value:"low",label:"Low",color:"#00aa00",weight:1},{id:"normal",value:"normal",label:"Normal",color:"#ffaa00",weight:2},{id:"high",value:"high",label:"High",color:"#ff0000",weight:3}],lD={defaultContexts:"",defaultTags:"",defaultProjects:"",defaultTimeEstimate:0,defaultRecurrence:"none",defaultDueDate:"none",defaultScheduledDate:"today",bodyTemplate:"",useBodyTemplate:!1},cD={defaultView:"dayGridMonth",customDayCount:3,slotDuration:"00:30:00",slotMinTime:"00:00:00",slotMaxTime:"24:00:00",scrollTime:"08:00:00",firstDay:1,timeFormat:"24",showWeekends:!0,defaultShowScheduled:!0,defaultShowDue:!0,defaultShowDueWhenScheduled:!0,defaultShowTimeEntries:!1,defaultShowRecurring:!0,defaultShowICSEvents:!0,enableTimeblocking:!1,defaultShowTimeblocks:!0,nowIndicator:!0,selectMirror:!0,weekNumbers:!1,showTodayHighlight:!0},mr={tasksFolder:"TaskNotes/Tasks",taskTag:"task",excludedFolders:"",defaultTaskPriority:"normal",defaultTaskStatus:"open",taskOrgFiltersCollapsed:!1,taskFilenameFormat:"zettel",storeTitleInFilename:!0,customFilenameTemplate:"{title}",taskCreationDefaults:lD,calendarViewSettings:cD,pomodoroWorkDuration:25,pomodoroShortBreakDuration:5,pomodoroLongBreakDuration:15,pomodoroLongBreakInterval:4,pomodoroAutoStartBreaks:!0,pomodoroAutoStartWork:!1,pomodoroNotifications:!0,pomodoroSoundEnabled:!0,pomodoroSoundVolume:50,pomodoroStorageLocation:"plugin",enableTaskLinkOverlay:!0,enableInstantTaskConvert:!0,useDefaultsOnInstantConvert:!0,enableNaturalLanguageInput:!0,nlpDefaultToScheduled:!0,inlineTaskConvertFolder:"{{currentNotePath}}",disableNoteIndexing:!1,fieldMapping:Al,customStatuses:aD,customPriorities:oD,recurrenceMigrated:!1,showTrackedTasksInStatusBar:!1,autoStopTimeTrackingOnComplete:!0,autoStopTimeTrackingNotification:!1,showProjectSubtasks:!0,hideCompletedFromOverdue:!0,icsIntegration:{defaultNoteTemplate:"",defaultNoteFolder:""},savedViews:[]},Ml=class extends N.PluginSettingTab{constructor(e,r){super(e,r);this.activeTab="task-defaults";this.tabContents={};this.selectedDefaultProjectFiles=[];this.plugin=r}display(){let{containerEl:e}=this;e.empty(),e.addClass("tasknotes-settings"),e.addClass("tasknotes-plugin"),e.addClass("settings-view");let r=e.createDiv("settings-tab-nav settings-view__tab-nav"),i=[{id:"task-defaults",name:"Task defaults"},{id:"general",name:"Inline tasks"},{id:"calendar",name:"Calendar"},{id:"field-mapping",name:"Field mapping"},{id:"statuses",name:"Statuses"},{id:"priorities",name:"Priorities"},{id:"pomodoro",name:"Pomodoro"},{id:"misc",name:"Misc"}];i.forEach(a=>{let o=this.activeTab===a.id,l=r.createEl("button",{text:a.name,cls:o?"settings-tab-button settings-view__tab-button active settings-view__tab-button--active":"settings-tab-button settings-view__tab-button",attr:{role:"tab","aria-selected":o.toString(),"aria-controls":`settings-tab-${a.id}`,id:`tab-button-${a.id}`,tabindex:o?"0":"-1"}});l.addEventListener("click",()=>{this.switchTab(a.id)}),l.addEventListener("keydown",c=>{if(c.key==="ArrowLeft"||c.key==="ArrowRight"){c.preventDefault();let d=i.findIndex(f=>f.id===a.id),u=c.key==="ArrowRight"?(d+1)%i.length:(d-1+i.length)%i.length,h=i[u].id;this.switchTab(h)}})});let s=e.createDiv("settings-tab-contents settings-view__tab-contents");i.forEach(a=>{let o=s.createDiv("settings-tab-content settings-view__tab-content");o.setAttribute("role","tabpanel"),o.setAttribute("id",`settings-tab-${a.id}`),o.setAttribute("aria-labelledby",`tab-button-${a.id}`),this.activeTab===a.id&&(o.addClass("active"),o.addClass("settings-view__tab-content--active")),this.tabContents[a.id]=o}),this.renderActiveTab()}switchTab(e){this.activeTab=e,this.display(),window.setTimeout(()=>{let r=this.containerEl.querySelector(`#tab-button-${e}`);r&&r.focus()},50)}renderActiveTab(){switch(Object.values(this.tabContents).forEach(e=>e.empty()),this.activeTab){case"general":this.renderGeneralTab();break;case"task-defaults":this.renderTaskDefaultsTab();break;case"calendar":this.renderCalendarTab();break;case"field-mapping":this.renderFieldMappingTab();break;case"statuses":this.renderStatusesTab();break;case"priorities":this.renderPrioritiesTab();break;case"pomodoro":this.renderPomodoroTab();break;case"misc":this.renderMiscTab();break}}renderGeneralTab(){let e=this.tabContents.general;new N.Setting(e).setName("Inline tasks").setHeading(),e.createEl("p",{text:"Configure how TaskNotes integrates with your editor and existing Markdown tasks.",cls:"settings-help-note"}),new N.Setting(e).setName("Task link overlay").setDesc("Replace wikilinks to task files with interactive task cards in both live preview and reading modes").addToggle(s=>(s.toggleEl.setAttribute("aria-label","Enable task link overlay in live preview and reading modes"),s.setValue(this.plugin.settings.enableTaskLinkOverlay).onChange(async a=>{this.plugin.settings.enableTaskLinkOverlay=a,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Instant task convert").setDesc("Show a convert button next to checkbox tasks for instant conversion to TaskNotes").addToggle(s=>(s.toggleEl.setAttribute("aria-label","Enable instant task conversion buttons"),s.setValue(this.plugin.settings.enableInstantTaskConvert).onChange(async a=>{this.plugin.settings.enableInstantTaskConvert=a,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Use task defaults on instant convert").setDesc("Apply your configured task creation defaults when converting checkbox tasks to TaskNotes (contexts, tags, dates, folder, etc.)").addToggle(s=>(s.toggleEl.setAttribute("aria-label","Apply task creation defaults during instant conversion"),s.setValue(this.plugin.settings.useDefaultsOnInstantConvert).onChange(async a=>{this.plugin.settings.useDefaultsOnInstantConvert=a,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Inline task folder").setDesc("Folder for converted inline tasks. Use {{currentNotePath}} to place tasks in the same folder as the note.").addText(s=>(s.inputEl.setAttribute("aria-label","Folder for inline task conversion"),s.setPlaceholder("{{currentNotePath}}").setValue(this.plugin.settings.inlineTaskConvertFolder).onChange(async a=>{this.plugin.settings.inlineTaskConvertFolder=a,await this.plugin.saveSettings()})));let r=e.createDiv("settings-help-section");r.createEl("h4",{text:"How inline task features work:"});let i=r.createEl("ul");i.createEl("li",{text:"Task link overlay: When you link to a task file like [[My Task]], it shows an interactive task card instead of a plain link"}),i.createEl("li",{text:'Instant task convert: Shows a "Convert to TaskNote" button next to standard Markdown checkboxes like - [ ] My task'}),r.createEl("p",{text:"These features help bridge regular Markdown tasks with the full TaskNotes system.",cls:"settings-help-note"})}renderTaskDefaultsTab(){let e=this.tabContents["task-defaults"];new N.Setting(e).setName("Task organization").setHeading(),new N.Setting(e).setName("Default tasks folder").setDesc("Default folder for new tasks (tasks are identified by tag, not folder)").addText(c=>(c.inputEl.setAttribute("aria-label","Default tasks folder path"),c.setPlaceholder("TaskNotes/Tasks").setValue(this.plugin.settings.tasksFolder).onChange(async d=>{this.plugin.settings.tasksFolder=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Task tag").setDesc("Tag that identifies notes as tasks (without #)").addText(c=>(c.inputEl.setAttribute("aria-label","Task identification tag"),c.setPlaceholder("task").setValue(this.plugin.settings.taskTag).onChange(async d=>{this.plugin.settings.taskTag=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Excluded folders").setDesc("Comma-separated list of folder paths to exclude from Notes tab").addText(c=>(c.inputEl.setAttribute("aria-label","Comma-separated list of folders to exclude"),c.setPlaceholder("Templates,Archive").setValue(this.plugin.settings.excludedFolders).onChange(async d=>{this.plugin.settings.excludedFolders=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Task filenames").setHeading(),new N.Setting(e).setName("Store title exclusively in filename").setDesc("When disabled, the task's title will be stored in the note frontmatter. You will be able to define custom templates for the filename of the task, but these will not be updated by the TaskNotes plugin after task creation. Moving the title into the frontmatter is a significant storage change and care must be taken when mixing tasks with their titles in the filename, and those with their titles in the frontmatter. Toggling this option will not affect existing tasks; it will affect tasks on creation and edit.").addToggle(c=>(c.toggleEl.setAttribute("aria-label","Store title exclusively in filename"),c.setValue(this.plugin.settings.storeTitleInFilename).onChange(async d=>{this.plugin.settings.storeTitleInFilename=d,await this.plugin.saveSettings(),this.renderActiveTab()}))),this.plugin.settings.storeTitleInFilename||(new N.Setting(e).setName("Filename format").setDesc("How task filenames should be generated").addDropdown(c=>(c.selectEl.setAttribute("aria-label","Task filename generation format"),c.addOption("title","Task title").addOption("zettel","Zettelkasten format (YYMMDD + base36 seconds since midnight)").addOption("timestamp","Full timestamp (YYYY-MM-DD-HHMMSS)").addOption("custom","Custom template").setValue(this.plugin.settings.taskFilenameFormat).onChange(async d=>{this.plugin.settings.taskFilenameFormat=d,await this.plugin.saveSettings(),this.renderActiveTab()}))),this.plugin.settings.taskFilenameFormat==="custom"&&(new N.Setting(e).setName("Custom filename template").setDesc("Template for custom filenames. Available variables: {title}, {date}, {time}, {priority}, {status}, {timestamp}, {dueDate}, {scheduledDate}, etc.").addText(c=>(c.inputEl.setAttribute("aria-label","Custom filename template with variables"),c.setPlaceholder("{date}-{title}-{dueDate}").setValue(this.plugin.settings.customFilenameTemplate).onChange(async d=>{this.plugin.settings.customFilenameTemplate=d,await this.plugin.saveSettings()}))),e.createEl("p",{text:"Note: {dueDate} and {scheduledDate} are in YYYY-MM-DD format and will be empty if not set.",cls:"settings-help-note"}))),new N.Setting(e).setName("Basic defaults").setHeading(),new N.Setting(e).setName("Enable natural language task input").setDesc('Show a smart input field in task creation modal that can parse natural language like "Buy groceries tomorrow 3pm high priority @home #errands"').addToggle(c=>(c.toggleEl.setAttribute("aria-label","Enable natural language task input"),c.setValue(this.plugin.settings.enableNaturalLanguageInput).onChange(async d=>{this.plugin.settings.enableNaturalLanguageInput=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Default date type for natural language input").setDesc('When dates are mentioned without "due" or "scheduled" keywords (e.g., "task friday"), default to scheduled date. When disabled, defaults to due date.').addToggle(c=>(c.toggleEl.setAttribute("aria-label","Default to scheduled date for natural language input"),c.setValue(this.plugin.settings.nlpDefaultToScheduled).onChange(async d=>{this.plugin.settings.nlpDefaultToScheduled=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Default task status").setDesc("Default status for new tasks").addDropdown(c=>(c.selectEl.setAttribute("aria-label","Default status for new tasks"),this.plugin.settings.customStatuses.forEach(d=>{c.addOption(d.value,d.label)}),c.setValue(this.plugin.settings.defaultTaskStatus).onChange(async d=>{this.plugin.settings.defaultTaskStatus=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Default task priority").setDesc("Default priority for new tasks").addDropdown(c=>(c.selectEl.setAttribute("aria-label","Default priority for new tasks"),this.plugin.settings.customPriorities.forEach(d=>{c.addOption(d.value,d.label)}),c.setValue(this.plugin.settings.defaultTaskPriority).onChange(async d=>{this.plugin.settings.defaultTaskPriority=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Default contexts").setDesc("Default contexts for new tasks (comma-separated)").addText(c=>(c.inputEl.setAttribute("aria-label","Default contexts for new tasks"),c.setPlaceholder("work, personal").setValue(this.plugin.settings.taskCreationDefaults.defaultContexts).onChange(async d=>{this.plugin.settings.taskCreationDefaults.defaultContexts=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Default tags").setDesc("Default tags for new tasks (comma-separated)").addText(c=>(c.inputEl.setAttribute("aria-label","Default tags for new tasks"),c.setPlaceholder("project, urgent").setValue(this.plugin.settings.taskCreationDefaults.defaultTags).onChange(async d=>{this.plugin.settings.taskCreationDefaults.defaultTags=d,await this.plugin.saveSettings()})));let r=new N.Setting(e).setName("Default projects").setDesc("Default projects for new tasks");this.initializeDefaultProjectsFromSettings();let i=r.settingEl.createDiv("default-projects-container"),s=i.createDiv("default-projects-list");i.createEl("button",{cls:"default-project-add-btn",text:"+ Add project"}).addEventListener("click",()=>{new os(this.app,this.plugin,c=>{this.addDefaultProject(c),this.renderDefaultProjectsList(s),this.updateDefaultProjectsInSettings()}).open()}),this.renderDefaultProjectsList(s),new N.Setting(e).setName("Default time estimate").setDesc("Default time estimate for new tasks in minutes (0 = no default)").addText(c=>(c.inputEl.setAttribute("aria-label","Default time estimate in minutes"),c.setPlaceholder("0").setValue(this.plugin.settings.taskCreationDefaults.defaultTimeEstimate.toString()).onChange(async d=>{let u=parseInt(d)||0;this.plugin.settings.taskCreationDefaults.defaultTimeEstimate=u,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Default recurrence").setDesc("Default recurrence pattern for new tasks").addDropdown(c=>(c.selectEl.setAttribute("aria-label","Default recurrence pattern"),c.addOption("none","None").addOption("daily","Daily").addOption("weekly","Weekly").addOption("monthly","Monthly").addOption("yearly","Yearly").setValue(this.plugin.settings.taskCreationDefaults.defaultRecurrence).onChange(async d=>{this.plugin.settings.taskCreationDefaults.defaultRecurrence=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Date defaults").setHeading(),new N.Setting(e).setName("Default due date").setDesc("Default due date for new tasks").addDropdown(c=>(c.selectEl.setAttribute("aria-label","Default due date for new tasks"),c.addOption("none","None").addOption("today","Today").addOption("tomorrow","Tomorrow").addOption("next-week","Next week").setValue(this.plugin.settings.taskCreationDefaults.defaultDueDate).onChange(async d=>{this.plugin.settings.taskCreationDefaults.defaultDueDate=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Default scheduled date").setDesc("Default scheduled date for new tasks").addDropdown(c=>(c.selectEl.setAttribute("aria-label","Default scheduled date for new tasks"),c.addOption("none","None").addOption("today","Today").addOption("tomorrow","Tomorrow").addOption("next-week","Next week").setValue(this.plugin.settings.taskCreationDefaults.defaultScheduledDate).onChange(async d=>{this.plugin.settings.taskCreationDefaults.defaultScheduledDate=d,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Body template").setHeading(),new N.Setting(e).setName("Use body template").setDesc("Pre-fill task details with content from a template file").addToggle(c=>(c.toggleEl.setAttribute("aria-label","Enable body template for new tasks"),c.setValue(this.plugin.settings.taskCreationDefaults.useBodyTemplate).onChange(async d=>{this.plugin.settings.taskCreationDefaults.useBodyTemplate=d,await this.plugin.saveSettings(),this.renderActiveTab()}))),this.plugin.settings.taskCreationDefaults.useBodyTemplate&&new N.Setting(e).setName("Body template file").setDesc("Path to template file for task body content. Supports template variables like {{title}}, {{date}}, {{time}}, {{priority}}, {{status}}, etc.").addText(c=>(c.inputEl.setAttribute("aria-label","Path to body template file"),c.setPlaceholder("Templates/Task Template.md").setValue(this.plugin.settings.taskCreationDefaults.bodyTemplate).onChange(async d=>{this.plugin.settings.taskCreationDefaults.bodyTemplate=d,await this.plugin.saveSettings()})));let o=e.createDiv("settings-help-section");o.createEl("h4",{text:"Template variables:"});let l=o.createEl("ul");l.createEl("li",{text:"{{title}} - Task title"}),l.createEl("li",{text:"{{details}} - User-provided details from modal"}),l.createEl("li",{text:"{{date}} - Current date (YYYY-MM-DD)"}),l.createEl("li",{text:"{{time}} - Current time (HH:MM)"}),l.createEl("li",{text:"{{priority}} - Task priority"}),l.createEl("li",{text:"{{status}} - Task status"}),l.createEl("li",{text:"{{contexts}} - Task contexts"}),l.createEl("li",{text:"{{tags}} - Task tags"}),l.createEl("li",{text:"{{timeEstimate}} - Time estimate in minutes"}),l.createEl("li",{text:"{{dueDate}} - Task due date"}),l.createEl("li",{text:"{{scheduledDate}} - Task scheduled date"}),l.createEl("li",{text:"{{parentNote}} - Parent note as a properly formatted markdown link"}),o.createEl("p",{text:`Template is applied when the task is created with all final values from the form. Use {{details}} to include user content from the Details field.
{{parentNote}} will resolve to a quoted markdown link (e.g., "[[Note Name]]") for the note where the task was created. For project organization, use it as a YAML list item: "project:\\n  - {{parentNote}}". Variables use the same format as daily note templates.`,cls:"settings-help-note"})}renderCalendarTab(){let e=this.tabContents.calendar;new N.Setting(e).setName("Calendar view settings").setHeading(),new N.Setting(e).setName("Default view").setDesc("Initial view when opening the Advanced Calendar").addDropdown(P=>(P.selectEl.setAttribute("aria-label","Default calendar view"),P.addOption("dayGridMonth","Month").addOption("timeGridWeek","Week").addOption("timeGridDay","Day").addOption("timeGridCustom","Custom Days").addOption("multiMonthYear","Year").setValue(this.plugin.settings.calendarViewSettings.defaultView).onChange(async x=>{this.plugin.settings.calendarViewSettings.defaultView=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Custom view day count").setDesc("Number of days to show in the custom view (2-10 days)").addSlider(P=>(P.sliderEl.setAttribute("aria-label","Number of days in custom view"),P.setLimits(2,10,1).setValue(this.plugin.settings.calendarViewSettings.customDayCount).setDynamicTooltip().onChange(async x=>{this.plugin.settings.calendarViewSettings.customDayCount=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("First day of week").setDesc("Which day should be the first column in week and month views").addDropdown(P=>(P.selectEl.setAttribute("aria-label","First day of week"),P.addOption("0","Sunday").addOption("1","Monday").addOption("2","Tuesday").addOption("3","Wednesday").addOption("4","Thursday").addOption("5","Friday").addOption("6","Saturday").setValue(this.plugin.settings.calendarViewSettings.firstDay.toString()).onChange(async x=>{this.plugin.settings.calendarViewSettings.firstDay=parseInt(x),await this.plugin.saveSettings()}))),new N.Setting(e).setName("Show weekends").setDesc("Display Saturday and Sunday in calendar views").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show weekends in calendar"),P.setValue(this.plugin.settings.calendarViewSettings.showWeekends).onChange(async x=>{this.plugin.settings.calendarViewSettings.showWeekends=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Show week numbers").setDesc("Display week numbers on the left side of calendar views").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show week numbers"),P.setValue(this.plugin.settings.calendarViewSettings.weekNumbers).onChange(async x=>{this.plugin.settings.calendarViewSettings.weekNumbers=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Time settings").setHeading(),new N.Setting(e).setName("Time format").setDesc("Display times in 12-hour or 24-hour format").addDropdown(P=>(P.selectEl.setAttribute("aria-label","Time format"),P.addOption("12","12-hour (9:00 AM)").addOption("24","24-hour (09:00)").setValue(this.plugin.settings.calendarViewSettings.timeFormat).onChange(async x=>{this.plugin.settings.calendarViewSettings.timeFormat=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Time slot duration").setDesc("Duration of each time slot in week and day views").addDropdown(P=>(P.selectEl.setAttribute("aria-label","Time slot duration"),P.addOption("00:15:00","15 minutes").addOption("00:30:00","30 minutes").addOption("01:00:00","1 hour").setValue(this.plugin.settings.calendarViewSettings.slotDuration).onChange(async x=>{this.plugin.settings.calendarViewSettings.slotDuration=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Day start time").setDesc("First time slot to display in day/week views").addText(P=>(P.inputEl.setAttribute("aria-label","Day start time (HH:MM:SS format)"),P.setPlaceholder("00:00:00").setValue(this.plugin.settings.calendarViewSettings.slotMinTime).onChange(async x=>{/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/.test(x)&&(this.plugin.settings.calendarViewSettings.slotMinTime=x,await this.plugin.saveSettings())}))),new N.Setting(e).setName("Day end time").setDesc("Last time slot to display in day/week views").addText(P=>(P.inputEl.setAttribute("aria-label","Day end time (HH:MM:SS format)"),P.setPlaceholder("24:00:00").setValue(this.plugin.settings.calendarViewSettings.slotMaxTime).onChange(async x=>{/^([0-1]?[0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9]$/.test(x)&&(this.plugin.settings.calendarViewSettings.slotMaxTime=x,await this.plugin.saveSettings())}))),new N.Setting(e).setName("Initial scroll time").setDesc("Time to scroll to when opening day/week views").addText(P=>(P.inputEl.setAttribute("aria-label","Initial scroll time (HH:MM:SS format)"),P.setPlaceholder("08:00:00").setValue(this.plugin.settings.calendarViewSettings.scrollTime).onChange(async x=>{/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/.test(x)&&(this.plugin.settings.calendarViewSettings.scrollTime=x,await this.plugin.saveSettings())}))),new N.Setting(e).setName("Default event visibility").setHeading(),e.createEl("p",{text:"Configure which event types are visible by default when opening the Advanced Calendar. Users can still toggle these on/off in the calendar view.",cls:"settings-help-note"}),new N.Setting(e).setName("Show scheduled tasks").setDesc("Display tasks with scheduled dates by default").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show scheduled tasks by default"),P.setValue(this.plugin.settings.calendarViewSettings.defaultShowScheduled).onChange(async x=>{this.plugin.settings.calendarViewSettings.defaultShowScheduled=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Show due dates").setDesc("Display task due dates by default").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show due dates by default"),P.setValue(this.plugin.settings.calendarViewSettings.defaultShowDue).onChange(async x=>{this.plugin.settings.calendarViewSettings.defaultShowDue=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Show due dates when scheduled").setDesc("Display due dates even for tasks that already have scheduled dates").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show due dates when scheduled dates exist"),P.setValue(this.plugin.settings.calendarViewSettings.defaultShowDueWhenScheduled).onChange(async x=>{this.plugin.settings.calendarViewSettings.defaultShowDueWhenScheduled=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Show time entries").setDesc("Display completed time tracking entries by default").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show time entries by default"),P.setValue(this.plugin.settings.calendarViewSettings.defaultShowTimeEntries).onChange(async x=>{this.plugin.settings.calendarViewSettings.defaultShowTimeEntries=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Show recurring tasks").setDesc("Display recurring task instances by default").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show recurring tasks by default"),P.setValue(this.plugin.settings.calendarViewSettings.defaultShowRecurring).onChange(async x=>{this.plugin.settings.calendarViewSettings.defaultShowRecurring=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Show ICS events").setDesc("Display events from ICS subscriptions by default").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show ICS events by default"),P.setValue(this.plugin.settings.calendarViewSettings.defaultShowICSEvents).onChange(async x=>{this.plugin.settings.calendarViewSettings.defaultShowICSEvents=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Timeblocking").setHeading(),new N.Setting(e).setName("Enable timeblocking").setDesc("Enable timeblock functionality for lightweight scheduling in daily notes").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Enable timeblocking feature"),P.setValue(this.plugin.settings.calendarViewSettings.enableTimeblocking).onChange(async x=>{this.plugin.settings.calendarViewSettings.enableTimeblocking=x,await this.plugin.saveSettings(),this.plugin.emitter.trigger("timeblocking-toggled",x)}))),new N.Setting(e).setName("Show timeblocks").setDesc("Display timeblocks from daily notes by default").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show timeblocks by default"),P.setValue(this.plugin.settings.calendarViewSettings.defaultShowTimeblocks).setDisabled(!this.plugin.settings.calendarViewSettings.enableTimeblocking).onChange(async x=>{this.plugin.settings.calendarViewSettings.defaultShowTimeblocks=x,await this.plugin.saveSettings()}))),e.createEl("p",{text:'Timeblocks are defined in daily note frontmatter using the "timeblocks" field. Each timeblock can have a title, start time, end time, and optional attachments as markdown links to tasks or notes.',cls:"settings-help-note"}),e.createEl("p",{text:"\u{1F4A1} Tip: In the calendar view, hold Shift + drag to create timeblocks \u2022 Drag to move \u2022 Resize edges to adjust duration",cls:"settings-help-note"}),new N.Setting(e).setName("Calendar behavior").setHeading(),new N.Setting(e).setName("Current time indicator").setDesc("Show a line indicating the current time in week and day views").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Show current time indicator"),P.setValue(this.plugin.settings.calendarViewSettings.nowIndicator).onChange(async x=>{this.plugin.settings.calendarViewSettings.nowIndicator=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Selection mirror").setDesc("Show a visual preview while dragging to select time ranges").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Enable selection mirror"),P.setValue(this.plugin.settings.calendarViewSettings.selectMirror).onChange(async x=>{this.plugin.settings.calendarViewSettings.selectMirror=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Highlight today").setDesc("Highlight the current date with a background color in calendar views").addToggle(P=>(P.toggleEl.setAttribute("aria-label","Highlight today"),P.setValue(this.plugin.settings.calendarViewSettings.showTodayHighlight).onChange(async x=>{this.plugin.settings.calendarViewSettings.showTodayHighlight=x,await this.plugin.saveSettings()}))),new N.Setting(e).setName("Calendar subscriptions").setHeading(),e.createEl("p",{text:"Subscribe to external calendar feeds (ICS/iCal format) to display events alongside your tasks.",cls:"settings-help-note"});let r=e.createDiv("settings-list settings-view__list");this.renderSubscriptionList(r),new N.Setting(e).setName("Add calendar subscription").setDesc("Subscribe to an external calendar feed or add a local ICS file");let i=e.createDiv("ics-add-subscription-form"),s=i.createDiv("ics-form-row");s.createEl("label",{text:"Source type:",cls:"ics-form-label"});let a=s.createEl("select",{cls:"ics-form-select"});a.createEl("option",{value:"remote",text:"Remote URL"}),a.createEl("option",{value:"local",text:"Local file"});let o=i.createDiv("ics-form-row");o.createEl("label",{text:"Name:",cls:"ics-form-label"});let l=o.createEl("input",{type:"text",placeholder:"My Calendar",cls:"ics-form-input"}),c=i.createDiv("ics-form-row");c.createEl("label",{text:"ICS URL:",cls:"ics-form-label"});let d=c.createEl("input",{type:"url",placeholder:"https://example.com/calendar.ics",cls:"ics-form-input"}),u=i.createDiv("ics-form-row ics-form-row-hidden");u.createEl("label",{text:"ICS file:",cls:"ics-form-label"});let h=u.createEl("select",{cls:"ics-form-select"}),f=()=>{var x;h.empty(),h.createEl("option",{value:"",text:"Select an ICS file..."});let P=((x=this.plugin.icsSubscriptionService)==null?void 0:x.getLocalICSFiles())||[];P.forEach(B=>{h.createEl("option",{value:B.path,text:B.path})}),P.length===0&&h.createEl("option",{value:"",text:"No .ics files found in vault",attr:{disabled:"true"}})};f(),a.addEventListener("change",()=>{let P=a.value==="remote";c.style.display=P?"flex":"none",u.style.display=P?"none":"flex",P||f()});let p=i.createDiv("ics-form-row ics-form-row-multi"),m=p.createDiv("ics-form-group");m.createEl("label",{text:"Color:",cls:"ics-form-label"});let g=m.createEl("input",{type:"color",value:"#3788d8",cls:"ics-form-color"}),v=p.createDiv("ics-form-group");v.createEl("label",{text:"Refresh (min):",cls:"ics-form-label"});let T=v.createEl("input",{type:"number",value:"60",cls:"ics-form-number"});T.setAttribute("min","15"),T.setAttribute("max","1440"),T.setAttribute("step","15");let D=p.createDiv("ics-form-group").createEl("label",{cls:"ics-form-checkbox-label"}),M=D.createEl("input",{type:"checkbox",cls:"ics-form-checkbox"});M.checked=!0,D.createSpan({text:" Enabled"});let C=i.createDiv("ics-form-row").createEl("button",{text:"Add Subscription",cls:"ics-form-button mod-cta"});C.addEventListener("click",async()=>{let P=l.value.trim(),x=a.value,B=d.value.trim(),L=h.value.trim(),H=g.value,w=parseInt(T.value),R=M.checked;if(!P){new N.Notice("Name is required");return}if(x==="remote"&&!B){new N.Notice("URL is required for remote subscriptions");return}if(x==="local"&&!L){new N.Notice("Please select a local ICS file");return}if(w<15||w>1440){new N.Notice("Refresh interval must be between 15 and 1440 minutes");return}try{C.textContent="Adding...",C.disabled=!0;let U={name:P,type:x,color:H,refreshInterval:w,enabled:R,...x==="remote"?{url:B}:{filePath:L}};await this.plugin.icsSubscriptionService.addSubscription(U),new N.Notice(`Added ${x} subscription "${P}"`),l.value="",d.value="",h.value="",g.value="#3788d8",T.value="60",M.checked=!0,a.value="remote",c.style.display="flex",u.style.display="none",this.renderActiveTab()}catch(U){console.error("Error adding subscription:",U),new N.Notice("Failed to add subscription")}finally{C.textContent="Add Subscription",C.disabled=!1}}),new N.Setting(e).setName("Refresh all subscriptions").setDesc("Manually refresh all enabled calendar subscriptions").addButton(P=>P.setButtonText("Refresh all").onClick(async()=>{if(this.plugin.icsSubscriptionService){P.setButtonText("Refreshing..."),P.setDisabled(!0);try{await this.plugin.icsSubscriptionService.refreshAllSubscriptions(),new N.Notice("All calendar subscriptions refreshed successfully")}catch(x){console.error("Error refreshing subscriptions:",x),new N.Notice("Failed to refresh some calendar subscriptions")}finally{P.setButtonText("Refresh all"),P.setDisabled(!1)}}}));let S=e.createDiv("settings-help-section");S.createEl("h4",{text:"Calendar sources:"}),S.createEl("h5",{text:"Remote calendar URLs:"});let O=S.createEl("ul");O.createEl("li",{text:"Google Calendar: Settings \u2192 Calendar settings \u2192 Integrate calendar \u2192 Secret address in iCal format"}),O.createEl("li",{text:"Outlook/Office 365: Calendar settings \u2192 Share calendar \u2192 Publish a calendar \u2192 ICS format"}),O.createEl("li",{text:'Other services: Look for "Calendar subscription", "ICS feed", "iCal URL", or "Webcal" options'}),S.createEl("h5",{text:"Local ICS files:"});let F=S.createEl("ul");F.createEl("li",{text:"Place .ics files anywhere in your vault"}),F.createEl("li",{text:"Export from Apple Calendar: File \u2192 Export \u2192 Export as .ics file"}),F.createEl("li",{text:"Export from Google Calendar: Settings \u2192 Export \u2192 Download your data"}),F.createEl("li",{text:"Files are automatically watched for changes and refreshed"}),S.createEl("p",{text:'Important: For Google Calendar remote URLs, you must use the "Secret address" (private URL) from your calendar settings. The calendar must be set to "Make available to public" for the secret URL to work.',cls:"settings-help-note"}),S.createEl("p",{text:"Note: Only read-only access is supported. You cannot edit calendar events from within TaskNotes.",cls:"settings-help-note"}),new N.Setting(e).setName("Content creation from events").setHeading(),new N.Setting(e).setName("Default note template").setDesc("Template file for notes created from ICS events (leave empty for default format)").addText(P=>{var x;return P.setValue(((x=this.plugin.settings.icsIntegration)==null?void 0:x.defaultNoteTemplate)||"").setPlaceholder("templates/ics-note-template.md").onChange(async B=>{this.plugin.settings.icsIntegration||(this.plugin.settings.icsIntegration={defaultNoteTemplate:"",defaultNoteFolder:""}),this.plugin.settings.icsIntegration.defaultNoteTemplate=B,await this.plugin.saveSettings()})}),new N.Setting(e).setName("Default note folder").setDesc("Folder for notes created from ICS events (leave empty for vault root)").addText(P=>{var x;return P.setValue(((x=this.plugin.settings.icsIntegration)==null?void 0:x.defaultNoteFolder)||"").setPlaceholder("Notes/Calendar Events").onChange(async B=>{this.plugin.settings.icsIntegration||(this.plugin.settings.icsIntegration={defaultNoteTemplate:"",defaultNoteFolder:""}),this.plugin.settings.icsIntegration.defaultNoteFolder=B,await this.plugin.saveSettings()})})}renderMiscTab(){let e=this.tabContents.misc;new N.Setting(e).setName("Miscellaneous settings").setHeading(),e.createEl("p",{text:"Configure various plugin features and display options.",cls:"settings-help-note"}),new N.Setting(e).setName("Show tracked tasks in status bar").setDesc("Display currently tracked tasks (with active time tracking) in the status bar at the bottom of the app").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Show tracked tasks in status bar"),r.setValue(this.plugin.settings.showTrackedTasksInStatusBar).onChange(async i=>{this.plugin.settings.showTrackedTasksInStatusBar=i,await this.plugin.saveSettings(),this.plugin.statusBarService&&this.plugin.statusBarService.updateVisibility()}))),new N.Setting(e).setName("Show project subtasks widget").setDesc("Display a collapsible widget showing all tasks that reference the current note as a project").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Show project subtasks widget"),r.setValue(this.plugin.settings.showProjectSubtasks).onChange(async i=>{this.plugin.settings.showProjectSubtasks=i,await this.plugin.saveSettings(),this.plugin.notifyDataChanged()}))),new N.Setting(e).setName("Hide completed tasks from overdue").setDesc("When enabled, completed tasks will not appear as overdue in the agenda view, even if their due/scheduled date has passed").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Hide completed tasks from overdue status"),r.setValue(this.plugin.settings.hideCompletedFromOverdue).onChange(async i=>{this.plugin.settings.hideCompletedFromOverdue=i,await this.plugin.saveSettings(),this.plugin.notifyDataChanged()}))),new N.Setting(e).setName("Disable note indexing").setDesc("Disable indexing and caching of non-task notes to improve performance in large vaults. Note: This will disable the Notes view and notes display in the Agenda view. Requires plugin restart to take effect.").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Disable note indexing for better performance"),r.setValue(this.plugin.settings.disableNoteIndexing).onChange(async i=>{this.plugin.settings.disableNoteIndexing=i,await this.plugin.saveSettings(),new N.Notice("Note indexing setting changed. Please restart Obsidian or reload the plugin for changes to take effect.")})))}renderFieldMappingTab(){let e=this.tabContents["field-mapping"],r=e.createDiv("settings-warning settings-view__warning"),i=r.createEl("strong",{cls:"settings-view__warning-icon"});(0,N.setIcon)(i,"alert-triangle"),i.createSpan({text:" Warning:"}),r.createSpan({text:" TaskNotes will read AND write using these property names. Changing these after creating tasks may cause inconsistencies."}),new N.Setting(e).setName("Field mapping").setHeading(),e.createEl("p",{text:"Configure which frontmatter properties TaskNotes should use for each field.",cls:"settings-help-note"});let s=e.createEl("table",{cls:"settings-table settings-view__table"}),a=s.createEl("tr");a.createEl("th",{cls:"settings-view__table-header",text:"TaskNotes field"}),a.createEl("th",{cls:"settings-view__table-header",text:"Your property name"}),[["title","Title"],["status","Status"],["priority","Priority"],["due","Due date"],["scheduled","Scheduled date"],["contexts","Contexts"],["projects","Projects"],["timeEstimate","Time estimate"],["completedDate","Completed date"],["dateCreated","Created date"],["dateModified","Modified date"],["recurrence","Recurrence"],["archiveTag","Archive tag"],["icsEventId","ICS Event ID"],["icsEventTag","ICS Event Tag"]].forEach(([l,c])=>{let d=s.createEl("tr",{cls:"settings-view__table-row"}),u=d.createEl("td",{cls:"settings-view__table-cell"});u.textContent=c;let f=d.createEl("td",{cls:"settings-view__table-cell"}).createEl("input",{type:"text",value:this.plugin.settings.fieldMapping[l],cls:"settings-view__table-input",attr:{"aria-label":`Property name for ${c}`,id:`field-mapping-${l}`}});f.addEventListener("change",async()=>{try{this.plugin.settings.fieldMapping[l]=f.value,await this.plugin.saveSettings()}catch(p){console.error(`Error updating field mapping for ${l}:`,p),new N.Notice(`Failed to update field mapping for ${c}. Please try again.`)}})}),new N.Setting(e).setName("Reset to defaults").setDesc("Reset all field mappings to default values").addButton(l=>l.setButtonText("Reset").setWarning().onClick(async()=>{this.plugin.settings.fieldMapping={...Al},await this.plugin.saveSettings(),this.renderActiveTab()}))}renderStatusesTab(){let e=this.tabContents.statuses;new N.Setting(e).setName("Task statuses").setHeading(),e.createEl("p",{text:"Customize the status options available for your tasks. These statuses control the task lifecycle and determine when tasks are considered complete.",cls:"settings-help-note"});let r=e.createDiv("settings-help-section");r.createEl("h4",{text:"How statuses work:"});let i=r.createEl("ul");i.createEl("li",{text:'Value: The internal identifier stored in your task files (e.g., "in-progress")'}),i.createEl("li",{text:'Label: The display name shown in the interface (e.g., "In Progress")'}),i.createEl("li",{text:"Color: Visual indicator color for the status dot and badges"}),i.createEl("li",{text:"Completed: When checked, tasks with this status are considered finished and may be filtered differently"}),r.createEl("p",{text:"The order below determines the sequence when cycling through statuses by clicking on task status badges.",cls:"settings-help-note"});let s=e.createDiv("settings-headers-row settings-view__list-headers");s.createDiv("settings-header-spacer settings-view__header-spacer"),s.createDiv("settings-header-spacer settings-view__header-spacer"),s.createEl("span",{text:"Value",cls:"settings-column-header settings-view__column-header"}),s.createEl("span",{text:"Display Label",cls:"settings-column-header settings-view__column-header"}),s.createEl("span",{text:"Color",cls:"settings-column-header settings-view__column-header"}),s.createEl("span",{text:"Mark as Completed",cls:"settings-column-header settings-view__column-header"}),s.createDiv("settings-header-spacer settings-view__header-spacer");let a=e.createDiv("settings-list settings-view__list");this.renderStatusList(a),new N.Setting(e).setName("Add new status").setDesc("Create a new status option for your tasks").addButton(o=>o.setButtonText("Add status").onClick(async()=>{let l=wi.createDefaultStatus(this.plugin.settings.customStatuses);this.plugin.settings.customStatuses.push(l),await this.plugin.saveSettings(),this.renderActiveTab()})),e.createEl("p",{text:'Note: You must have at least 2 statuses, and at least one status must be marked as "Completed".',cls:"settings-validation-note"})}renderStatusList(e){e.empty(),[...this.plugin.settings.customStatuses].sort((i,s)=>i.order-s.order).forEach((i,s)=>{let a=e.createDiv("settings-item-row settings-view__item-row");a.setAttribute("draggable","true"),a.setAttribute("data-status-id",i.id);let o=a.createDiv("settings-drag-handle");o.innerHTML="\u2630",(0,N.setTooltip)(o,"Drag to reorder",{placement:"top"});let l=a.createDiv("settings-color-indicator settings-view__color-indicator");l.style.setProperty("--indicator-color",i.color);let c=a.createEl("input",{type:"text",value:i.value,cls:"settings-input value-input settings-view__input settings-view__input--value",attr:{"aria-label":`Status value for ${i.label}`,id:`status-value-${i.id}`}}),d=a.createEl("input",{type:"text",value:i.label,cls:"settings-input label-input settings-view__input settings-view__input--label",attr:{"aria-label":`Display label for ${i.label} status`,id:`status-label-${i.id}`}}),u=a.createEl("input",{type:"color",value:i.color,cls:"settings-input color-input settings-view__input settings-view__input--color",attr:{"aria-label":`Color for ${i.label} status`,id:`status-color-${i.id}`}}),h=a.createEl("label",{cls:"settings-checkbox-label settings-view__checkbox-label",attr:{for:`status-completed-${i.id}`}}),f=h.createEl("input",{type:"checkbox",cls:"settings-view__checkbox",attr:{id:`status-completed-${i.id}`,"aria-label":`Mark ${i.label} as completed status`}});f.checked=i.isCompleted,h.createSpan({text:"Completed"});let p=a.createEl("button",{text:"Delete",cls:"settings-delete-button settings-view__delete-button"}),m=async()=>{try{i.value=c.value,i.label=d.value,i.color=u.value,i.isCompleted=f.checked,await this.plugin.saveSettings(),l.style.setProperty("--indicator-color",i.color)}catch(g){console.error("Error updating status configuration:",g),new N.Notice("Failed to update status configuration. Please try again.")}};c.addEventListener("change",m),d.addEventListener("change",m),u.addEventListener("change",m),f.addEventListener("change",m),p.addEventListener("click",async()=>{if(this.plugin.settings.customStatuses.length<=2){new N.Notice("You must have at least 2 statuses");return}if(await wn(this.app,{title:"Delete Status",message:`Are you sure you want to delete the status "${i.label}"?

This action cannot be undone and may affect existing tasks.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})){let v=this.plugin.settings.customStatuses.findIndex(T=>T.id===i.id);v!==-1&&(this.plugin.settings.customStatuses.splice(v,1),await this.plugin.saveSettings(),this.renderActiveTab())}}),a.addEventListener("dragstart",g=>{g.dataTransfer.setData("text/plain",i.id),a.classList.add("dragging")}),a.addEventListener("dragend",()=>{a.classList.remove("dragging")}),a.addEventListener("dragover",g=>{g.preventDefault();let v=e.querySelector(".dragging");if(v&&v!==a){let T=a.getBoundingClientRect(),k=T.top+T.height/2;g.clientY<k?(a.classList.add("drag-over-top"),a.classList.remove("drag-over-bottom")):(a.classList.add("drag-over-bottom"),a.classList.remove("drag-over-top"))}}),a.addEventListener("dragleave",()=>{a.classList.remove("drag-over-top","drag-over-bottom")}),a.addEventListener("drop",async g=>{g.preventDefault(),a.classList.remove("drag-over-top","drag-over-bottom");let v=g.dataTransfer.getData("text/plain"),T=i.id;v!==T&&await this.reorderStatus(v,T,g.clientY<a.getBoundingClientRect().top+a.getBoundingClientRect().height/2)})})}async reorderStatus(e,r,i){let s=[...this.plugin.settings.customStatuses],a=s.findIndex(d=>d.id===e),o=s.findIndex(d=>d.id===r);if(a===-1||o===-1)return;let[l]=s.splice(a,1),c=o;a<o&&c--,i||c++,s.splice(c,0,l),s.forEach((d,u)=>{d.order=u}),this.plugin.settings.customStatuses=s,await this.plugin.saveSettings(),this.renderActiveTab()}renderPrioritiesTab(){let e=this.tabContents.priorities;new N.Setting(e).setName("Task priorities").setHeading(),e.createEl("p",{text:"Customize the priority levels available for your tasks. Priority weights determine sorting order and visual hierarchy in your task views.",cls:"settings-help-note"});let r=e.createDiv("settings-help-section");r.createEl("h4",{text:"How priorities work:"});let i=r.createEl("ul");i.createEl("li",{text:'Value: The internal identifier stored in your task files (e.g., "high")'}),i.createEl("li",{text:'Display Label: The display name shown in the interface (e.g., "High Priority")'}),i.createEl("li",{text:"Color: Visual indicator color for the priority dot and badges"}),i.createEl("li",{text:"Weight: Numeric value for sorting (higher weights appear first in lists)"}),r.createEl("p",{text:"Tasks are automatically sorted by priority weight in descending order (highest weight first). Weights can be any positive number.",cls:"settings-help-note"});let s=e.createDiv("settings-headers-row settings-view__list-headers");s.createDiv("settings-header-spacer settings-view__header-spacer"),s.createEl("span",{text:"Value",cls:"settings-column-header settings-view__column-header"}),s.createEl("span",{text:"Display Label",cls:"settings-column-header settings-view__column-header"}),s.createEl("span",{text:"Color",cls:"settings-column-header settings-view__column-header"}),s.createEl("span",{text:"Weight",cls:"settings-column-header settings-view__column-header"}),s.createDiv("settings-header-spacer settings-view__header-spacer");let a=e.createDiv("settings-list settings-view__list");this.renderPriorityList(a),new N.Setting(e).setName("Add new priority").setDesc("Create a new priority level for your tasks").addButton(o=>o.setButtonText("Add priority").onClick(async()=>{let l=Hr.createDefaultPriority(this.plugin.settings.customPriorities);this.plugin.settings.customPriorities.push(l),await this.plugin.saveSettings(),this.renderActiveTab()})),e.createEl("p",{text:"Note: You must have at least 1 priority. Higher weights take precedence in sorting and visual hierarchy.",cls:"settings-validation-note"})}renderPriorityList(e){e.empty(),[...this.plugin.settings.customPriorities].sort((i,s)=>s.weight-i.weight).forEach((i,s)=>{let a=e.createDiv("settings-item-row settings-view__item-row"),o=a.createDiv("settings-color-indicator settings-view__color-indicator");o.style.setProperty("--indicator-color",i.color);let l=a.createEl("input",{type:"text",value:i.value,cls:"settings-input value-input settings-view__input settings-view__input--value",attr:{"aria-label":`Priority value for ${i.label}`,id:`priority-value-${i.id}`}}),c=a.createEl("input",{type:"text",value:i.label,cls:"settings-input label-input settings-view__input settings-view__input--label",attr:{"aria-label":`Display label for ${i.label} priority`,id:`priority-label-${i.id}`}}),d=a.createEl("input",{type:"color",value:i.color,cls:"settings-input color-input settings-view__input settings-view__input--color",attr:{"aria-label":`Color for ${i.label} priority`,id:`priority-color-${i.id}`}}),u=a.createEl("input",{type:"number",value:i.weight.toString(),cls:"settings-input weight-input settings-view__input settings-view__input--weight",attr:{min:"0",step:"1","aria-label":`Weight for ${i.label} priority`,id:`priority-weight-${i.id}`}}),h=a.createEl("button",{text:"Delete",cls:"settings-delete-button settings-view__delete-button"}),f=async()=>{try{i.value=l.value,i.label=c.value,i.color=d.value;let p=parseInt(u.value);if(isNaN(p)||p<0){new N.Notice("Priority weight must be a valid positive number.");return}i.weight=p,await this.plugin.saveSettings(),o.style.setProperty("--indicator-color",i.color)}catch(p){console.error("Error updating priority configuration:",p),new N.Notice("Failed to update priority configuration. Please try again.")}};l.addEventListener("change",f),c.addEventListener("change",f),d.addEventListener("change",f),u.addEventListener("change",f),h.addEventListener("click",async()=>{if(this.plugin.settings.customPriorities.length<=1){new N.Notice("You must have at least 1 priority");return}if(await wn(this.app,{title:"Delete Priority",message:`Are you sure you want to delete the priority "${i.label}"?

This action cannot be undone and may affect existing tasks.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})){let m=this.plugin.settings.customPriorities.findIndex(g=>g.id===i.id);m!==-1&&(this.plugin.settings.customPriorities.splice(m,1),await this.plugin.saveSettings(),this.renderActiveTab())}})})}renderPomodoroTab(){let e=this.tabContents.pomodoro;new N.Setting(e).setName("Work duration").setDesc("Duration of work intervals in minutes").addText(r=>r.setPlaceholder("25").setValue(this.plugin.settings.pomodoroWorkDuration.toString()).onChange(async i=>{try{let s=parseInt(i);if(isNaN(s)||s<=0){new N.Notice("Work duration must be a positive number.");return}this.plugin.settings.pomodoroWorkDuration=s,await this.plugin.saveSettings()}catch(s){console.error("Error updating pomodoro work duration:",s),new N.Notice("Failed to update work duration setting.")}})),new N.Setting(e).setName("Short break duration").setDesc("Duration of short breaks in minutes").addText(r=>r.setPlaceholder("5").setValue(this.plugin.settings.pomodoroShortBreakDuration.toString()).onChange(async i=>{try{let s=parseInt(i);if(isNaN(s)||s<=0){new N.Notice("Short break duration must be a positive number.");return}this.plugin.settings.pomodoroShortBreakDuration=s,await this.plugin.saveSettings()}catch(s){console.error("Error updating pomodoro short break duration:",s),new N.Notice("Failed to update short break duration setting.")}})),new N.Setting(e).setName("Long break duration").setDesc("Duration of long breaks in minutes").addText(r=>r.setPlaceholder("15").setValue(this.plugin.settings.pomodoroLongBreakDuration.toString()).onChange(async i=>{try{let s=parseInt(i);if(isNaN(s)||s<=0){new N.Notice("Long break duration must be a positive number.");return}this.plugin.settings.pomodoroLongBreakDuration=s,await this.plugin.saveSettings()}catch(s){console.error("Error updating pomodoro long break duration:",s),new N.Notice("Failed to update long break duration setting.")}})),new N.Setting(e).setName("Long break interval").setDesc("Take a long break after this many pomodoros").addText(r=>r.setPlaceholder("4").setValue(this.plugin.settings.pomodoroLongBreakInterval.toString()).onChange(async i=>{try{let s=parseInt(i);if(isNaN(s)||s<=0){new N.Notice("Long break interval must be a positive number.");return}this.plugin.settings.pomodoroLongBreakInterval=s,await this.plugin.saveSettings()}catch(s){console.error("Error updating pomodoro long break interval:",s),new N.Notice("Failed to update long break interval setting.")}})),new N.Setting(e).setName("Auto-start breaks").setDesc("Automatically start break timer after work session").addToggle(r=>r.setValue(this.plugin.settings.pomodoroAutoStartBreaks).onChange(async i=>{this.plugin.settings.pomodoroAutoStartBreaks=i,await this.plugin.saveSettings()})),new N.Setting(e).setName("Auto-start work").setDesc("Automatically start work timer after break").addToggle(r=>r.setValue(this.plugin.settings.pomodoroAutoStartWork).onChange(async i=>{this.plugin.settings.pomodoroAutoStartWork=i,await this.plugin.saveSettings()})),new N.Setting(e).setName("Enable notifications").setDesc("Show notifications when pomodoro sessions complete").addToggle(r=>r.setValue(this.plugin.settings.pomodoroNotifications).onChange(async i=>{this.plugin.settings.pomodoroNotifications=i,await this.plugin.saveSettings()})),new N.Setting(e).setName("Enable sound").setDesc("Play sound when pomodoro sessions complete").addToggle(r=>r.setValue(this.plugin.settings.pomodoroSoundEnabled).onChange(async i=>{this.plugin.settings.pomodoroSoundEnabled=i,await this.plugin.saveSettings()})),new N.Setting(e).setName("Sound volume").setDesc("Volume for completion sounds (0-100)").addSlider(r=>r.setLimits(0,100,5).setValue(this.plugin.settings.pomodoroSoundVolume).setDynamicTooltip().onChange(async i=>{try{this.plugin.settings.pomodoroSoundVolume=i,await this.plugin.saveSettings()}catch(s){console.error("Error updating pomodoro sound volume:",s),new N.Notice("Failed to update sound volume setting.")}})),new N.Setting(e).setName("Data storage location").setDesc("Choose where to store pomodoro session data. Daily notes provides better data longevity as the data stays with your notes, but requires the Daily Notes core plugin to be enabled.").addDropdown(r=>r.addOption("plugin","Plugin data file (default)").addOption("daily-notes","Daily notes frontmatter").setValue(this.plugin.settings.pomodoroStorageLocation).onChange(async i=>{try{if(i==="daily-notes"){let{appHasDailyNotesPluginLoaded:s}=await Promise.resolve().then(()=>Ve(Yt()));if(!s()){new N.Notice("Daily Notes core plugin must be enabled to use this storage option. Please enable it in Settings > Core plugins and try again."),r.setValue("plugin");return}let a=await this.plugin.loadData(),o=(a==null?void 0:a.pomodoroHistory)&&Array.isArray(a.pomodoroHistory)&&a.pomodoroHistory.length>0;if(!await _g(this.app,o)){r.setValue("plugin");return}}this.plugin.settings.pomodoroStorageLocation=i,await this.plugin.saveSettings(),i==="daily-notes"&&await this.plugin.pomodoroService.migrateTodailyNotes()}catch(s){console.error("Error updating pomodoro storage location:",s),new N.Notice("Failed to update storage location setting."),r.setValue("plugin")}})),new N.Setting(e).setName("Auto-stop time tracking on completion").setDesc("Automatically stop time tracking when a task is marked as completed").addToggle(r=>r.setValue(this.plugin.settings.autoStopTimeTrackingOnComplete).onChange(async i=>{this.plugin.settings.autoStopTimeTrackingOnComplete=i,await this.plugin.saveSettings()})),new N.Setting(e).setName("Show auto-stop notifications").setDesc("Show a notice when time tracking is automatically stopped").addToggle(r=>r.setValue(this.plugin.settings.autoStopTimeTrackingNotification).onChange(async i=>{this.plugin.settings.autoStopTimeTrackingNotification=i,await this.plugin.saveSettings()}))}renderSubscriptionList(e){if(e.empty(),!this.plugin.icsSubscriptionService){e.createEl("p",{text:"ICS Subscription service not available",cls:"settings-help-note"});return}let r=this.plugin.icsSubscriptionService.getSubscriptions();if(r.length===0){e.createEl("p",{text:"No calendar subscriptions configured",cls:"settings-help-note"});return}r.forEach(i=>{let s=e.createDiv("settings-item-row ics-subscription-row"),a=s.createDiv("settings-status-indicator");i.enabled?(a.addClass("enabled"),(0,N.setTooltip)(a,i.lastError?`Error: ${i.lastError}`:"Active",{placement:"top"}),i.lastError&&a.addClass("error")):(a.addClass("disabled"),(0,N.setTooltip)(a,"Disabled",{placement:"top"}));let o=s.createDiv("ics-subscription-info");o.createEl("div",{cls:"ics-subscription-name",text:i.name}).createEl("span",{cls:`ics-subscription-type-badge ${i.type}`,text:i.type==="remote"?"URL":"FILE"});let c=i.type==="remote"?i.url:i.filePath;o.createEl("div",{cls:"ics-subscription-url",text:c||"Unknown source"});let d=o.createEl("div",{cls:"ics-subscription-meta"}),u=`Refresh: ${i.refreshInterval}min`,h=i.lastFetched?` \u2022 Last: ${new Date(i.lastFetched).toLocaleString()}`:"";d.textContent=u+h,i.lastError&&o.createEl("div",{cls:"ics-subscription-error",text:`Error: ${i.lastError}`});let f=s.createDiv("ics-subscription-actions");f.createEl("button",{text:i.enabled?"Disable":"Enable",cls:`ics-subscription-toggle ${i.enabled?"enabled":"disabled"}`}).addEventListener("click",async()=>{try{await this.plugin.icsSubscriptionService.updateSubscription(i.id,{enabled:!i.enabled}),this.renderActiveTab()}catch(T){console.error("Error toggling subscription:",T),new N.Notice("Failed to update subscription")}});let m=f.createEl("button",{text:"Refresh",cls:"ics-subscription-refresh"});m.addEventListener("click",async()=>{if(!i.enabled){new N.Notice("Enable the subscription first");return}m.textContent="Refreshing...",m.disabled=!0;try{await this.plugin.icsSubscriptionService.refreshSubscription(i.id),new N.Notice(`Refreshed "${i.name}"`),this.renderActiveTab()}catch(T){console.error("Error refreshing subscription:",T),new N.Notice("Failed to refresh subscription")}finally{m.textContent="Refresh",m.disabled=!1}}),f.createEl("button",{text:"Edit",cls:"ics-subscription-edit"}).addEventListener("click",()=>{this.showInlineEditForm(i,s)}),f.createEl("button",{text:"Delete",cls:"ics-subscription-delete"}).addEventListener("click",async()=>{if(await wn(this.app,{title:"Delete Subscription",message:`Are you sure you want to delete the subscription "${i.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0}))try{await this.plugin.icsSubscriptionService.removeSubscription(i.id),new N.Notice(`Deleted subscription "${i.name}"`),this.renderActiveTab()}catch(k){console.error("Error deleting subscription:",k),new N.Notice("Failed to delete subscription")}})})}showInlineEditForm(e,r){let i=Array.from(r.children);r.empty(),r.addClass("ics-subscription-editing");let s=r.createDiv("ics-edit-form"),a=s.createDiv("ics-edit-row");a.createEl("label",{text:"Name:",cls:"ics-edit-label"});let o=a.createEl("input",{type:"text",value:e.name,cls:"ics-edit-input"}),l=s.createDiv("ics-edit-row");l.createEl("label",{text:"URL:",cls:"ics-edit-label"});let c=l.createEl("input",{type:"url",value:e.url,cls:"ics-edit-input"}),d=s.createDiv("ics-edit-row ics-edit-settings"),u=d.createDiv("ics-edit-group");u.createEl("label",{text:"Color:",cls:"ics-edit-label"});let h=u.createEl("input",{type:"color",value:e.color,cls:"ics-edit-color"}),f=d.createDiv("ics-edit-group");f.createEl("label",{text:"Refresh (min):",cls:"ics-edit-label"});let p=f.createEl("input",{type:"number",value:e.refreshInterval.toString(),cls:"ics-edit-number"});p.setAttribute("min","15"),p.setAttribute("max","1440"),p.setAttribute("step","15");let g=d.createDiv("ics-edit-group").createEl("label",{cls:"ics-edit-checkbox-label"}),v=g.createEl("input",{type:"checkbox",cls:"ics-edit-checkbox"});v.checked=e.enabled,g.createSpan({text:" Enabled"});let T=s.createDiv("ics-edit-row ics-edit-buttons"),k=T.createEl("button",{text:"Save",cls:"ics-edit-button mod-cta"}),D=T.createEl("button",{text:"Cancel",cls:"ics-edit-button"});k.addEventListener("click",async()=>{let M=o.value.trim(),E=c.value.trim(),C=h.value,S=parseInt(p.value),O=v.checked;if(!M||!E){new N.Notice("Name and URL are required");return}if(S<15||S>1440){new N.Notice("Refresh interval must be between 15 and 1440 minutes");return}try{k.textContent="Saving...",k.disabled=!0,await this.plugin.icsSubscriptionService.updateSubscription(e.id,{name:M,url:E,color:C,refreshInterval:S,enabled:O}),new N.Notice(`Updated subscription "${M}"`),this.renderActiveTab()}catch(F){console.error("Error updating subscription:",F),new N.Notice("Failed to update subscription")}}),D.addEventListener("click",()=>{r.empty(),r.removeClass("ics-subscription-editing"),i.forEach(M=>r.appendChild(M)),this.renderActiveTab()}),window.setTimeout(()=>o.focus(),50)}initializeDefaultProjectsFromSettings(){let e=this.plugin.settings.taskCreationDefaults.defaultProjects;if(!e){this.selectedDefaultProjectFiles=[];return}let r=e.split(",").map(i=>i.trim()).filter(i=>i.length>0);this.selectedDefaultProjectFiles=[];for(let i of r){let s=i.match(/^\[\[([^\]]+)\]\]$/);if(s){let a=s[1],o=this.app.metadataCache.getFirstLinkpathDest(a,"");o&&this.selectedDefaultProjectFiles.push(o)}else{let o=this.app.vault.getMarkdownFiles().find(l=>l.basename===i||l.name===i+".md");o&&this.selectedDefaultProjectFiles.push(o)}}}addDefaultProject(e){this.selectedDefaultProjectFiles.some(i=>i.path===e.path)||this.selectedDefaultProjectFiles.push(e)}removeDefaultProject(e){this.selectedDefaultProjectFiles=this.selectedDefaultProjectFiles.filter(r=>r.path!==e.path)}renderDefaultProjectsList(e){if(e.empty(),this.selectedDefaultProjectFiles.length===0){let r=e.createDiv({cls:"default-projects-empty"});r.textContent="No default projects selected";return}this.selectedDefaultProjectFiles.forEach(r=>{let i=e.createDiv({cls:"default-project-item"}),s=i.createDiv({cls:"default-project-info"}),a=s.createSpan({cls:"default-project-name"});if(a.textContent=r.name,r.path!==r.name){let l=s.createDiv({cls:"default-project-path"});l.textContent=r.path}let o=i.createEl("button",{cls:"default-project-remove",text:"\xD7"});(0,N.setTooltip)(o,"Remove project",{placement:"top"}),o.addEventListener("click",()=>{this.removeDefaultProject(r),this.renderDefaultProjectsList(e),this.updateDefaultProjectsInSettings()})})}updateDefaultProjectsInSettings(){let e=this.app.workspace.getActiveFile(),r=(e==null?void 0:e.path)||"",i=this.selectedDefaultProjectFiles.map(s=>`[[${this.app.metadataCache.fileToLinktext(s,r,!0)}]]`);this.plugin.settings.taskCreationDefaults.defaultProjects=i.join(", "),this.plugin.saveSettings()}}});function he(n){if(!n){let e=new Error("Date string cannot be empty");throw console.error("Date parsing error:",{dateString:n,error:e.message}),e}let t=n.trim();try{if(t.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(t)){let e=new Error(`Invalid date format - time without date: ${n}`);throw console.warn("Date parsing error - incomplete time format:",{original:n,trimmed:t,error:e.message}),e}if(/^\d{4}-W\d{2}$/.test(t)){let[e,r]=t.split("-W"),i=parseInt(e,10),s=parseInt(r,10);if(isNaN(i)||isNaN(s)){let d=new Error(`Invalid numeric values in ISO week format: ${n}`);throw console.warn("Date parsing error - invalid ISO week numbers:",{original:n,year:e,week:r,yearNum:i,weekNum:s}),d}if(s<1||s>53){let d=new Error(`Invalid week number in ISO week format: ${n} (week must be 1-53)`);throw console.warn("Date parsing error - week number out of range:",{original:n,weekNum:s,error:d.message}),d}let a=new Date(i,0,4),o=a.getDay(),l=new Date(a);l.setDate(a.getDate()-(o===0?6:o-1));let c=new Date(l);if(c.setDate(l.getDate()+(s-1)*7),!rt(c)){let d=new Error(`Failed to calculate date from ISO week format: ${n}`);throw console.error("Date parsing error - ISO week calculation failed:",{original:n,yearNum:i,weekNum:s,jan4:a.toISOString(),targetWeekMonday:c.toString()}),d}return c}if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}(:\d{2})?/.test(t)){let e=t.replace(" ","T"),r=ns(e);if(!rt(r)){let i=new Error(`Invalid space-separated datetime: ${n}`);throw console.warn("Date parsing error - space-separated datetime invalid:",{original:n,converted:e,error:i.message}),i}return r}if(t.includes("T")||t.includes("Z")||t.match(/[+-]\d{2}:\d{2}$/)){let e=ns(t);if(!rt(e)){let r=new Error(`Invalid timezone-aware date: ${n}`);throw console.warn("Date parsing error - timezone-aware format invalid:",{original:n,trimmed:t,error:r.message}),r}return e}else{let e=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!e){let o=new Error(`Invalid date-only string: ${n} (expected format: yyyy-MM-dd)`);throw console.warn("Date parsing error - date-only format invalid:",{original:n,trimmed:t,expectedFormat:"yyyy-MM-dd",error:o.message}),o}let[,r,i,s]=e,a=new Date(parseInt(r,10),parseInt(i,10)-1,parseInt(s,10));if(!rt(a)||a.getFullYear()!==parseInt(r,10)||a.getMonth()!==parseInt(i,10)-1||a.getDate()!==parseInt(s,10)){let o=new Error(`Invalid date values: ${n}`);throw console.warn("Date parsing error - invalid date values:",{original:n,year:r,month:i,day:s,error:o.message}),o}return a}}catch(e){if(e instanceof Error&&e.message.includes("Invalid date"))throw e;let r=new Error(`Unexpected error parsing date "${n}": ${e instanceof Error?e.message:String(e)}`);throw console.error("Unexpected date parsing error:",{original:n,trimmed:t,error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),r}}function Ze(n,t){try{let e=he(n),r=he(t);return Lr(e,r)}catch(e){return console.error("Error comparing dates:",{date1:n,date2:t,error:e}),!1}}function gr(n,t){try{let e=We(he(n)),r=We(he(t));return Br(e,r)}catch(e){return console.error("Error comparing dates for before:",{date1:n,date2:t,error:e}),!1}}function $e(){return I(new Date,"yyyy-MM-dd")}function Ta(n){if(!n)return n;try{if(n.includes("T")||n.includes("Z")||n.match(/[+-]\d{2}:\d{2}$/)){let e=n.split("T")[0];if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e}let t=he(n);return rt(t)?I(t,"yyyy-MM-dd"):n}catch(t){return console.error("Error normalizing date string:",{dateString:n,error:t}),n}}function bn(n,t,e){return new Date(n,t,e)}function Ig(n){if(!n||n.trim()==="")return!0;try{return he(n),!0}catch(t){return!1}}function cs(n,t){try{let e=he(n),r=gt(e,t);return I(r,"yyyy-MM-dd")}catch(e){throw console.error("Error adding days to date string:",{dateString:n,days:t,error:e}),e}}function Pg(n,t){try{let e=he(n),r=El(e,t);return I(r,"yyyy-MM-dd")}catch(e){throw console.error("Error adding weeks to date string:",{dateString:n,weeks:t,error:e}),e}}function ds(n){try{let t=he(n);return We(t)}catch(t){throw console.error("Error getting start of day for date string:",{dateString:n,error:t}),t}}function ki(n){return Ze(n,$e())}function us(n){return gr(n,$e())}function Ea(n,t="MMM d, yyyy"){try{let e=he(n);return I(e,t)}catch(e){return console.error("Error formatting date for display:",{dateString:n,error:e}),n}}function ce(){let n=new Date,t=-n.getTimezoneOffset(),e=t>=0?"+":"-",r=f=>String(Math.abs(f)).padStart(2,"0"),i=r(Math.floor(Math.abs(t)/60)),s=r(Math.abs(t)%60),a=n.getFullYear(),o=r(n.getMonth()+1),l=r(n.getDate()),c=r(n.getHours()),d=r(n.getMinutes()),u=r(n.getSeconds()),h=String(n.getMilliseconds()).padStart(3,"0");return`${a}-${o}-${l}T${c}:${d}:${u}.${h}${e}${i}:${s}`}function Ll(){return Te(new Date)}function Ru(n){try{if(!n)throw new Error("Timestamp string cannot be empty");let t=ns(n);if(!rt(t))throw new Error(`Invalid timestamp: ${n}`);return t}catch(t){throw console.error("Error parsing timestamp:",{timestampString:n,error:t}),t}}function Lu(n,t="MMM d, yyyy h:mm a"){if(!n)return n;try{let e=Ru(n);return rt(e)?I(e,t):n}catch(e){return console.error("Error formatting timestamp for display:",{timestampString:n,error:e}),n}}function dt(n){return n?/T\d{2}:\d{2}/.test(n):!1}function Z(n){if(!n)return"";try{let t=he(n);return I(t,"yyyy-MM-dd")}catch(t){return console.error("Error extracting date part:",{dateString:n,error:t}),n}}function It(n){if(!n||!dt(n))return null;try{let t=he(n);return I(t,"HH:mm")}catch(t){return console.error("Error extracting time part:",{dateString:n,error:t}),null}}function yr(n,t){if(!n)return"";if(!t)return n;try{let e=Z(n);return!e||!/^\d{4}-\d{2}-\d{2}$/.test(e)?(console.warn("Invalid date part from dateString:",{dateString:n,datePart:e}),n):/^\d{2}:\d{2}$/.test(t)?`${e}T${t}`:(console.warn("Invalid time format, expected HH:mm:",t),n)}catch(e){return console.error("Error combining date and time:",{dateString:n,timeString:t,error:e}),n}}function Je(n,t={}){if(!n)return"";let{dateFormat:e="MMM d, yyyy",timeFormat:r="h:mm a",showTime:i=!0}=t;try{let s=he(n);return dt(n)&&i?!e||e.trim()===""?I(s,r):I(s,`${e} ${r}`):!e||e.trim()===""?"":I(s,e)}catch(s){return console.error("Error formatting datetime for display:",{dateString:n,error:s}),n}}function Di(n,t){try{let e=he(n),r=he(t);if(dt(n)&&dt(t))return Br(e,r);if(!dt(n)&&!dt(t))return Br(We(e),We(r));let i=dt(n)?e:pn(e),s=dt(t)?r:pn(r);return Br(i,s)}catch(e){return console.error("Error comparing dates time-aware:",{date1:n,date2:t,error:e}),!1}}function Ut(n,t,e){if(!n||e&&t)return!1;try{let r=he(n),i=new Date;if(dt(n))return Br(r,i);let s=We(i),a=We(r);return Br(a,s)}catch(r){return console.error("Error checking overdue status:",{dateString:n,error:r}),!1}}function ka(n){if(!n)return!1;try{let t=he(n),e=new Date;return Lr(t,e)}catch(t){return console.error("Error checking if today:",{dateString:n,error:t}),!1}}function Fl(n,t){if(!n||n.trim()==="")return!0;try{if(!Ig(n))return!1;if(t&&t.trim()!==""){if(!/^\d{2}:\d{2}$/.test(t))return!1;let e=yr(n,t);return Ig(e)}return!0}catch(e){return!1}}function Ng(n){return Array.isArray(n)?n.filter(t=>{if(typeof t!="string"||!t.trim())return!1;let e=t.trim();if(e.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(e)||!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;try{return he(e),!0}catch(r){return console.warn("Invalid complete_instances entry (date parsing failed):",t,r),!1}}).map(t=>t.trim()):[]}function yt(n){try{let e=Z(n).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!e)throw new Error(`Invalid date format for RRULE: ${n}`);let[,r,i,s]=e,a=parseInt(r,10),o=parseInt(i,10),l=parseInt(s,10);if(o<1||o>12)throw new Error(`Invalid month in date: ${n}`);if(l<1||l>31)throw new Error(`Invalid day in date: ${n}`);let c=new Date(Date.UTC(a,o-1,l));if(c.getUTCFullYear()!==a||c.getUTCMonth()!==o-1||c.getUTCDate()!==l)throw new Error(`Invalid date values: ${n}`);return c}catch(t){throw console.error("Error creating UTC date for RRULE:",{dateString:n,error:t}),t}}function Og(n,t){try{let e=I(n,"yyyy-MM-dd"),r=I(t,"yyyy-MM-dd"),i=yt(e),s=yt(r);return{utcStart:i,utcEnd:s}}catch(e){throw console.error("Error normalizing calendar boundaries to UTC:",{startDate:n,endDate:t,error:e}),e}}function Te(n){try{let t=n.getUTCFullYear(),e=String(n.getUTCMonth()+1).padStart(2,"0"),r=String(n.getUTCDate()).padStart(2,"0");return`${t}-${e}-${r}`}catch(t){return console.error("Error formatting UTC date for calendar:",{utcDate:n,error:t}),n.toISOString().split("T")[0]}}function Rg(n,t){let e=[],r=Te(n),i=Te(t),s=yt(r),a=yt(i);for(;s<=a;)e.push(new Date(s)),s.setUTCDate(s.getUTCDate()+1);return e}function Fu(n,t=1){let e=yt(Te(n)),i=(e.getUTCDay()-t+7)%7,s=new Date(e);return s.setUTCDate(s.getUTCDate()-i),s}function Lg(n,t=1){let e=Fu(n,t),r=new Date(e);return r.setUTCDate(r.getUTCDate()+6),r}function Bu(n){let t=yt(Te(n));return new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),1))}function Hu(n){let t=yt(Te(n));return new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth()+1,0))}function Yu(n){if(!n||typeof n!="string")return!1;let t=n.toLowerCase().trim().replace(/\s+/g," ");return t in Ou?!0:[/^in\s+(\d+)\s+(days?)$/,/^(\d+)\s+(days?)\s+ago$/,/^in\s+(\d+)\s+(weeks?)$/,/^(\d+)\s+(weeks?)\s+ago$/].some(r=>r.test(t))}function Uu(n){if(typeof n!="string")return!1;let t=n.trim();if(t===""||Yu(t))return!0;try{let e=he(t);return rt(e)}catch(e){return!1}}function hs(n){if(!n||typeof n!="string")return n;let t=n.toLowerCase().trim().replace(/\s+/g," ");if(t in Ou)try{return Ou[t]()}catch(e){return console.error("Error resolving natural language date:",{value:n,error:e}),n}try{let e=t.match(/^in\s+(\d+)\s+(days?)$/);if(e){let r=parseInt(e[1],10);return cs($e(),r)}if(e=t.match(/^(\d+)\s+(days?)\s+ago$/),e){let r=parseInt(e[1],10);return cs($e(),-r)}if(e=t.match(/^in\s+(\d+)\s+(weeks?)$/),e){let r=parseInt(e[1],10);return Pg($e(),r)}if(e=t.match(/^(\d+)\s+(weeks?)\s+ago$/),e){let r=parseInt(e[1],10);return Pg($e(),-r)}}catch(e){console.error("Error parsing relative natural language date:",{value:n,error:e})}return n}var Ou,we=_(()=>{je();Ou={today:()=>$e(),tomorrow:()=>cs($e(),1),yesterday:()=>cs($e(),-1),"next week":()=>cs($e(),7),"last week":()=>cs($e(),-7)}});var Da,Ye,Tn=_(()=>{Da=["MO","TU","WE","TH","FR","SA","SU"],Ye=function(){function n(t,e){if(e===0)throw new Error("Can't create weekday with n == 0");this.weekday=t,this.n=e}return n.fromStr=function(t){return new n(Da.indexOf(t))},n.prototype.nth=function(t){return this.n===t?this:new n(this.weekday,t)},n.prototype.equals=function(t){return this.weekday===t.weekday&&this.n===t.n},n.prototype.toString=function(){var t=Da[this.weekday];return this.n&&(t=(this.n>0?"+":"")+String(this.n)+t),t},n.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},n}()});function En(n,t,e){e===void 0&&(e=" ");var r=String(n);return t=t>>0,r.length>t?String(r):(t=t-r.length,t>e.length&&(e+=de(e,t/e.length)),e.slice(0,t)+String(r))}var Me,Pt,Vu,nt,Vt,de,Fg,Bg,ut,Bl,Nt,Fe,fe,vt=_(()=>{Tn();Me=function(n){return n!=null},Pt=function(n){return typeof n=="number"},Vu=function(n){return typeof n=="string"&&Da.includes(n)},nt=Array.isArray,Vt=function(n,t){t===void 0&&(t=n),arguments.length===1&&(t=n,n=0);for(var e=[],r=n;r<t;r++)e.push(r);return e},de=function(n,t){var e=0,r=[];if(nt(n))for(;e<t;e++)r[e]=[].concat(n);else for(;e<t;e++)r[e]=n;return r},Fg=function(n){return nt(n)?n:[n]};Bg=function(n,t,e){var r=n.split(t);return e?r.slice(0,e).concat([r.slice(e).join(t)]):r},ut=function(n,t){var e=n%t;return e*t<0?e+t:e},Bl=function(n,t){return{div:Math.floor(n/t),mod:ut(n,t)}},Nt=function(n){return!Me(n)||n.length===0},Fe=function(n){return!Nt(n)},fe=function(n,t){return Fe(n)&&n.indexOf(t)!==-1}});var vr,dD,Yg,Hl,Ug,uD,fs,Wu,kn,hD,Sa,Yl,fD,Vr,ju,Ul,Vl,$u,Wr,ps,Ca,Hg,Vg,ht=_(()=>{vt();vr=function(n,t,e,r,i,s){return r===void 0&&(r=0),i===void 0&&(i=0),s===void 0&&(s=0),new Date(Date.UTC(n,t-1,e,r,i,s))},dD=[31,28,31,30,31,30,31,31,30,31,30,31],Yg=1e3*60*60*24,Hl=9999,Ug=vr(1970,1,1),uD=[6,0,1,2,3,4,5],fs=function(n){return n%4===0&&n%100!==0||n%400===0},Wu=function(n){return n instanceof Date},kn=function(n){return Wu(n)&&!isNaN(n.getTime())},hD=function(n,t){var e=n.getTime(),r=t.getTime(),i=e-r;return Math.round(i/Yg)},Sa=function(n){return hD(n,Ug)},Yl=function(n){return new Date(Ug.getTime()+n*Yg)},fD=function(n){var t=n.getUTCMonth();return t===1&&fs(n.getUTCFullYear())?29:dD[t]},Vr=function(n){return uD[n.getUTCDay()]},ju=function(n,t){var e=vr(n,t+1,1);return[Vr(e),fD(e)]},Ul=function(n,t){return t=t||n,new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))},Vl=function(n){var t=new Date(n.getTime());return t},$u=function(n){for(var t=[],e=0;e<n.length;e++)t.push(Vl(n[e]));return t},Wr=function(n){n.sort(function(t,e){return t.getTime()-e.getTime()})},ps=function(n,t){t===void 0&&(t=!0);var e=new Date(n);return[En(e.getUTCFullYear().toString(),4,"0"),En(e.getUTCMonth()+1,2,"0"),En(e.getUTCDate(),2,"0"),"T",En(e.getUTCHours(),2,"0"),En(e.getUTCMinutes(),2,"0"),En(e.getUTCSeconds(),2,"0"),t?"Z":""].join("")},Ca=function(n){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,e=t.exec(n);if(!e)throw new Error("Invalid UNTIL value: ".concat(n));return new Date(Date.UTC(parseInt(e[1],10),parseInt(e[2],10)-1,parseInt(e[3],10),parseInt(e[5],10)||0,parseInt(e[6],10)||0,parseInt(e[7],10)||0))},Hg=function(n,t){var e=n.toLocaleString("sv-SE",{timeZone:t});return e.replace(" ","T")+"Z"},Vg=function(n,t){var e=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(Hg(n,e)),i=new Date(Hg(n,t!=null?t:"UTC")),s=i.getTime()-r.getTime();return new Date(n.getTime()-s)}});var pD,jr,Wl=_(()=>{pD=function(){function n(t,e){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=t,this.args=e,t==="between"?(this.maxDate=e.inc?e.before:new Date(e.before.getTime()-1),this.minDate=e.inc?e.after:new Date(e.after.getTime()+1)):t==="before"?this.maxDate=e.inc?e.dt:new Date(e.dt.getTime()-1):t==="after"&&(this.minDate=e.inc?e.dt:new Date(e.dt.getTime()+1))}return n.prototype.accept=function(t){++this.total;var e=this.minDate&&t<this.minDate,r=this.maxDate&&t>this.maxDate;if(this.method==="between"){if(e)return!0;if(r)return!1}else if(this.method==="before"){if(r)return!1}else if(this.method==="after")return e?!0:(this.add(t),!1);return this.add(t)},n.prototype.add=function(t){return this._result.push(t),!0},n.prototype.getValue=function(){var t=this._result;switch(this.method){case"all":case"between":return t;case"before":case"after":default:return t.length?t[t.length-1]:null}},n.prototype.clone=function(){return new n(this.method,this.args)},n}(),jr=pD});function ms(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");zu(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function V(n,t,e){if(e||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return n.concat(s||Array.prototype.slice.call(t))}var zu,st,$r=_(()=>{zu=function(n,t){return zu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},zu(n,t)};st=function(){return st=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},st.apply(this,arguments)}});var mD,qu,Wg=_(()=>{$r();Wl();mD=function(n){ms(t,n);function t(e,r,i){var s=n.call(this,e,r)||this;return s.iterator=i,s}return t.prototype.add=function(e){return this.iterator(e,this._result.length)?(this._result.push(e),!0):!1},t}(jr),qu=mD});var gD,Dn,jl=_(()=>{gD={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},Dn=gD});var jg,yD,vD,wD,wr,$g=_(()=>{jl();Wt();vt();jg=function(n,t){return n.indexOf(t)!==-1},yD=function(n){return n.toString()},vD=function(n,t,e){return"".concat(t," ").concat(e,", ").concat(n)},wD=function(){function n(t,e,r,i){if(e===void 0&&(e=yD),r===void 0&&(r=Dn),i===void 0&&(i=vD),this.text=[],this.language=r||Dn,this.gettext=e,this.dateFormatter=i,this.rrule=t,this.options=t.options,this.origOptions=t.origOptions,this.origOptions.bymonthday){var s=[].concat(this.options.bymonthday),a=[].concat(this.options.bynmonthday);s.sort(function(d,u){return d-u}),a.sort(function(d,u){return u-d}),this.bymonthday=s.concat(a),this.bymonthday.length||(this.bymonthday=null)}if(Me(this.origOptions.byweekday)){var o=nt(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],l=String(o);this.byweekday={allWeeks:o.filter(function(d){return!d.n}),someWeeks:o.filter(function(d){return Boolean(d.n)}),isWeekdays:l.indexOf("MO")!==-1&&l.indexOf("TU")!==-1&&l.indexOf("WE")!==-1&&l.indexOf("TH")!==-1&&l.indexOf("FR")!==-1&&l.indexOf("SA")===-1&&l.indexOf("SU")===-1,isEveryDay:l.indexOf("MO")!==-1&&l.indexOf("TU")!==-1&&l.indexOf("WE")!==-1&&l.indexOf("TH")!==-1&&l.indexOf("FR")!==-1&&l.indexOf("SA")!==-1&&l.indexOf("SU")!==-1};var c=function(d,u){return d.weekday-u.weekday};this.byweekday.allWeeks.sort(c),this.byweekday.someWeeks.sort(c),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return n.isFullyConvertible=function(t){var e=!0;if(!(t.options.freq in n.IMPLEMENTED)||t.origOptions.until&&t.origOptions.count)return!1;for(var r in t.origOptions){if(jg(["dtstart","tzid","wkst","freq"],r))return!0;if(!jg(n.IMPLEMENTED[t.options.freq],r))return!1}return e},n.prototype.isFullyConvertible=function(){return n.isFullyConvertible(this.rrule)},n.prototype.toString=function(){var t=this.gettext;if(!(this.options.freq in n.IMPLEMENTED))return t("RRule error: Unable to fully convert this rrule to text");if(this.text=[t("every")],this[W.FREQUENCIES[this.options.freq]](),this.options.until){this.add(t("until"));var e=this.options.until;this.add(this.dateFormatter(e.getUTCFullYear(),this.language.monthNames[e.getUTCMonth()],e.getUTCDate()))}else this.options.count&&this.add(t("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?t("times"):t("time"));return this.isFullyConvertible()||this.add(t("(~ approximate)")),this.text.join("")},n.prototype.HOURLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("hours"):t("hour"))},n.prototype.MINUTELY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("minutes"):t("minute"))},n.prototype.DAILY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(this.plural(this.options.interval)?t("days"):t("day")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},n.prototype.WEEKLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?t("weeks"):t("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(t("on")).add(t("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?t("days"):t("day")):(this.options.interval===1&&this.add(t("week")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},n.prototype.MONTHLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(t("months")),this.plural(this.options.interval)&&this.add(t("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("months"):t("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(t("on")).add(t("weekdays")):this.byweekday&&this._byweekday()},n.prototype.YEARLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(t("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("years"):t("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(t("on the")).add(this.list(this.options.byyearday,this.nth,t("and"))).add(t("day")),this.options.byweekno&&this.add(t("in")).add(this.plural(this.options.byweekno.length)?t("weeks"):t("week")).add(this.list(this.options.byweekno,void 0,t("and")))},n.prototype._bymonthday=function(){var t=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,t("or"))).add(t("the")).add(this.list(this.bymonthday,this.nth,t("or"))):this.add(t("on the")).add(this.list(this.bymonthday,this.nth,t("and")))},n.prototype._byweekday=function(){var t=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(t("and")),this.add(t("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,t("and"))))},n.prototype._byhour=function(){var t=this.gettext;this.add(t("at")).add(this.list(this.origOptions.byhour,void 0,t("and")))},n.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},n.prototype.nth=function(t){t=parseInt(t.toString(),10);var e,r=this.gettext;if(t===-1)return r("last");var i=Math.abs(t);switch(i){case 1:case 21:case 31:e=i+r("st");break;case 2:case 22:e=i+r("nd");break;case 3:case 23:e=i+r("rd");break;default:e=i+r("th")}return t<0?e+" "+r("last"):e},n.prototype.monthtext=function(t){return this.language.monthNames[t-1]},n.prototype.weekdaytext=function(t){var e=Pt(t)?(t+1)%7:t.getJsWeekday();return(t.n?this.nth(t.n)+" ":"")+this.language.dayNames[e]},n.prototype.plural=function(t){return t%100!==1},n.prototype.add=function(t){return this.text.push(" "),this.text.push(t),this},n.prototype.list=function(t,e,r,i){var s=this;i===void 0&&(i=","),nt(t)||(t=[t]);var a=function(l,c,d){for(var u="",h=0;h<l.length;h++)h!==0&&(h===l.length-1?u+=" "+d+" ":u+=c+" "),u+=l[h];return u};e=e||function(l){return l.toString()};var o=function(l){return e&&e.call(s,l)};return r?a(t.map(o),i,r):t.map(o).join(i+" ")},n}(),wr=wD});function xa(n,t){t===void 0&&(t=Dn);var e={},r=new bD(t.tokens);if(!r.start(n))return null;return i(),e;function i(){r.expect("every");var h=r.acceptNumber();if(h&&(e.interval=parseInt(h[0],10)),r.isDone())throw new Error("Unexpected end");switch(r.symbol){case"day(s)":e.freq=W.DAILY,r.nextSymbol()&&(a(),u());break;case"weekday(s)":e.freq=W.WEEKLY,e.byweekday=[W.MO,W.TU,W.WE,W.TH,W.FR],r.nextSymbol(),a(),u();break;case"week(s)":e.freq=W.WEEKLY,r.nextSymbol()&&(s(),a(),u());break;case"hour(s)":e.freq=W.HOURLY,r.nextSymbol()&&(s(),u());break;case"minute(s)":e.freq=W.MINUTELY,r.nextSymbol()&&(s(),u());break;case"month(s)":e.freq=W.MONTHLY,r.nextSymbol()&&(s(),u());break;case"year(s)":e.freq=W.YEARLY,r.nextSymbol()&&(s(),u());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":e.freq=W.WEEKLY;var f=r.symbol.substr(0,2).toUpperCase();if(e.byweekday=[W[f]],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var p=l();if(!p)throw new Error("Unexpected symbol "+r.symbol+", expected weekday");e.byweekday.push(W[p]),r.nextSymbol()}a(),d(),u();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(e.freq=W.YEARLY,e.bymonth=[o()],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var m=o();if(!m)throw new Error("Unexpected symbol "+r.symbol+", expected month");e.bymonth.push(m),r.nextSymbol()}s(),u();break;default:throw new Error("Unknown symbol")}}function s(){var h=r.accept("on"),f=r.accept("the");if(h||f)do{var p=c(),m=l(),g=o();if(p)m?(r.nextSymbol(),e.byweekday||(e.byweekday=[]),e.byweekday.push(W[m].nth(p))):(e.bymonthday||(e.bymonthday=[]),e.bymonthday.push(p),r.accept("day(s)"));else if(m)r.nextSymbol(),e.byweekday||(e.byweekday=[]),e.byweekday.push(W[m]);else if(r.symbol==="weekday(s)")r.nextSymbol(),e.byweekday||(e.byweekday=[W.MO,W.TU,W.WE,W.TH,W.FR]);else if(r.symbol==="week(s)"){r.nextSymbol();var v=r.acceptNumber();if(!v)throw new Error("Unexpected symbol "+r.symbol+", expected week number");for(e.byweekno=[parseInt(v[0],10)];r.accept("comma");){if(v=r.acceptNumber(),!v)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");e.byweekno.push(parseInt(v[0],10))}}else if(g)r.nextSymbol(),e.bymonth||(e.bymonth=[]),e.bymonth.push(g);else return}while(r.accept("comma")||r.accept("the")||r.accept("on"))}function a(){var h=r.accept("at");if(h)do{var f=r.acceptNumber();if(!f)throw new Error("Unexpected symbol "+r.symbol+", expected hour");for(e.byhour=[parseInt(f[0],10)];r.accept("comma");){if(f=r.acceptNumber(),!f)throw new Error("Unexpected symbol "+r.symbol+"; expected hour");e.byhour.push(parseInt(f[0],10))}}while(r.accept("comma")||r.accept("at"))}function o(){switch(r.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function l(){switch(r.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return r.symbol.substr(0,2).toUpperCase();default:return!1}}function c(){switch(r.symbol){case"last":return r.nextSymbol(),-1;case"first":return r.nextSymbol(),1;case"second":return r.nextSymbol(),r.accept("last")?-2:2;case"third":return r.nextSymbol(),r.accept("last")?-3:3;case"nth":var h=parseInt(r.value[1],10);if(h<-366||h>366)throw new Error("Nth out of range: "+h);return r.nextSymbol(),r.accept("last")?-h:h;default:return!1}}function d(){r.accept("on"),r.accept("the");var h=c();if(h)for(e.bymonthday=[h],r.nextSymbol();r.accept("comma");){if(h=c(),!h)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");e.bymonthday.push(h),r.nextSymbol()}}function u(){if(r.symbol==="until"){var h=Date.parse(r.text);if(!h)throw new Error("Cannot parse until date:"+r.text);e.until=new Date(h)}else r.accept("for")&&(e.count=parseInt(r.value[0],10),r.expect("number"))}}var bD,zg=_(()=>{jl();Wt();bD=function(){function n(t){this.done=!0,this.rules=t}return n.prototype.start=function(t){return this.text=t,this.done=!1,this.nextSymbol()},n.prototype.isDone=function(){return this.done&&this.symbol===null},n.prototype.nextSymbol=function(){var t,e;this.symbol=null,this.value=null;do{if(this.done)return!1;var r=void 0;t=null;for(var i in this.rules){r=this.rules[i];var s=r.exec(this.text);s&&(t===null||s[0].length>t[0].length)&&(t=s,e=i)}if(t!=null&&(this.text=this.text.substr(t[0].length),this.text===""&&(this.done=!0)),t==null){this.done=!0,this.symbol=null,this.value=null;return}}while(e==="SKIP");return this.symbol=e,this.value=t,!0},n.prototype.accept=function(t){if(this.symbol===t){if(this.value){var e=this.value;return this.nextSymbol(),e}return this.nextSymbol(),!0}return!1},n.prototype.acceptNumber=function(){return this.accept("number")},n.prototype.expect=function(t){if(this.accept(t))return!0;throw new Error("expected "+t+" but found "+this.symbol)},n}()});function _a(n){return n<ae.HOURLY}var ae,zr=_(()=>{(function(n){n[n.YEARLY=0]="YEARLY",n[n.MONTHLY=1]="MONTHLY",n[n.WEEKLY=2]="WEEKLY",n[n.DAILY=3]="DAILY",n[n.HOURLY=4]="HOURLY",n[n.MINUTELY=5]="MINUTELY",n[n.SECONDLY=6]="SECONDLY"})(ae||(ae={}))});var qg,gs,Gg,Qg,Kg=_(()=>{$g();zg();Wt();zr();jl();qg=function(n,t){return t===void 0&&(t=Dn),new W(xa(n,t)||void 0)},gs=["count","until","interval","byweekday","bymonthday","bymonth"];wr.IMPLEMENTED=[];wr.IMPLEMENTED[ae.HOURLY]=gs;wr.IMPLEMENTED[ae.MINUTELY]=gs;wr.IMPLEMENTED[ae.DAILY]=["byhour"].concat(gs);wr.IMPLEMENTED[ae.WEEKLY]=gs;wr.IMPLEMENTED[ae.MONTHLY]=gs;wr.IMPLEMENTED[ae.YEARLY]=["byweekno","byyearday"].concat(gs);Gg=function(n,t,e,r){return new wr(n,t,e,r).toString()},Qg=wr.isFullyConvertible});var ys,Zg,$l=_(()=>{$r();zr();vt();ht();ys=function(){function n(t,e,r,i){this.hour=t,this.minute=e,this.second=r,this.millisecond=i||0}return n.prototype.getHours=function(){return this.hour},n.prototype.getMinutes=function(){return this.minute},n.prototype.getSeconds=function(){return this.second},n.prototype.getMilliseconds=function(){return this.millisecond},n.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},n}(),Zg=function(n){ms(t,n);function t(e,r,i,s,a,o,l){var c=n.call(this,s,a,o,l)||this;return c.year=e,c.month=r,c.day=i,c}return t.fromDate=function(e){return new this(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.valueOf()%1e3)},t.prototype.getWeekday=function(){return Vr(new Date(this.getTime()))},t.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},t.prototype.getDay=function(){return this.day},t.prototype.getMonth=function(){return this.month},t.prototype.getYear=function(){return this.year},t.prototype.addYears=function(e){this.year+=e},t.prototype.addMonths=function(e){if(this.month+=e,this.month>12){var r=Math.floor(this.month/12),i=ut(this.month,12);this.month=i,this.year+=r,this.month===0&&(this.month=12,--this.year)}},t.prototype.addWeekly=function(e,r){r>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-r))+e*7:this.day+=-(this.getWeekday()-r)+e*7,this.fixDay()},t.prototype.addDaily=function(e){this.day+=e,this.fixDay()},t.prototype.addHours=function(e,r,i){for(r&&(this.hour+=Math.floor((23-this.hour)/e)*e);;){this.hour+=e;var s=Bl(this.hour,24),a=s.div,o=s.mod;if(a&&(this.hour=o,this.addDaily(a)),Nt(i)||fe(i,this.hour))break}},t.prototype.addMinutes=function(e,r,i,s){for(r&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/e)*e);;){this.minute+=e;var a=Bl(this.minute,60),o=a.div,l=a.mod;if(o&&(this.minute=l,this.addHours(o,!1,i)),(Nt(i)||fe(i,this.hour))&&(Nt(s)||fe(s,this.minute)))break}},t.prototype.addSeconds=function(e,r,i,s,a){for(r&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/e)*e);;){this.second+=e;var o=Bl(this.second,60),l=o.div,c=o.mod;if(l&&(this.second=c,this.addMinutes(l,!1,i,s)),(Nt(i)||fe(i,this.hour))&&(Nt(s)||fe(s,this.minute))&&(Nt(a)||fe(a,this.second)))break}},t.prototype.fixDay=function(){if(!(this.day<=28)){var e=ju(this.year,this.month-1)[1];if(!(this.day<=e))for(;this.day>e;){if(this.day-=e,++this.month,this.month===13&&(this.month=1,++this.year,this.year>Hl))return;e=ju(this.year,this.month-1)[1]}}},t.prototype.add=function(e,r){var i=e.freq,s=e.interval,a=e.wkst,o=e.byhour,l=e.byminute,c=e.bysecond;switch(i){case ae.YEARLY:return this.addYears(s);case ae.MONTHLY:return this.addMonths(s);case ae.WEEKLY:return this.addWeekly(s,a);case ae.DAILY:return this.addDaily(s);case ae.HOURLY:return this.addHours(s,r,o);case ae.MINUTELY:return this.addMinutes(s,r,o,l);case ae.SECONDLY:return this.addSeconds(s,r,o,l,c)}},t}(ys)});function Gu(n){for(var t=[],e=Object.keys(n),r=0,i=e;r<i.length;r++){var s=i[r];fe(ey,s)||t.push(s),Wu(n[s])&&!kn(n[s])&&t.push(s)}if(t.length)throw new Error("Invalid options: "+t.join(", "));return st({},n)}function Jg(n){var t=st(st({},Ma),Gu(n));if(Me(t.byeaster)&&(t.freq=W.YEARLY),!(Me(t.freq)&&W.FREQUENCIES[t.freq]))throw new Error("Invalid frequency: ".concat(t.freq," ").concat(n.freq));if(t.dtstart||(t.dtstart=new Date(new Date().setMilliseconds(0))),Me(t.wkst)?Pt(t.wkst)||(t.wkst=t.wkst.weekday):t.wkst=W.MO.weekday,Me(t.bysetpos)){Pt(t.bysetpos)&&(t.bysetpos=[t.bysetpos]);for(var e=0;e<t.bysetpos.length;e++){var r=t.bysetpos[e];if(r===0||!(r>=-366&&r<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(Boolean(t.byweekno)||Fe(t.byweekno)||Fe(t.byyearday)||Boolean(t.bymonthday)||Fe(t.bymonthday)||Me(t.byweekday)||Me(t.byeaster)))switch(t.freq){case W.YEARLY:t.bymonth||(t.bymonth=t.dtstart.getUTCMonth()+1),t.bymonthday=t.dtstart.getUTCDate();break;case W.MONTHLY:t.bymonthday=t.dtstart.getUTCDate();break;case W.WEEKLY:t.byweekday=[Vr(t.dtstart)];break}if(Me(t.bymonth)&&!nt(t.bymonth)&&(t.bymonth=[t.bymonth]),Me(t.byyearday)&&!nt(t.byyearday)&&Pt(t.byyearday)&&(t.byyearday=[t.byyearday]),!Me(t.bymonthday))t.bymonthday=[],t.bynmonthday=[];else if(nt(t.bymonthday)){for(var i=[],s=[],e=0;e<t.bymonthday.length;e++){var r=t.bymonthday[e];r>0?i.push(r):r<0&&s.push(r)}t.bymonthday=i,t.bynmonthday=s}else t.bymonthday<0?(t.bynmonthday=[t.bymonthday],t.bymonthday=[]):(t.bynmonthday=[],t.bymonthday=[t.bymonthday]);if(Me(t.byweekno)&&!nt(t.byweekno)&&(t.byweekno=[t.byweekno]),!Me(t.byweekday))t.bynweekday=null;else if(Pt(t.byweekday))t.byweekday=[t.byweekday],t.bynweekday=null;else if(Vu(t.byweekday))t.byweekday=[Ye.fromStr(t.byweekday).weekday],t.bynweekday=null;else if(t.byweekday instanceof Ye)!t.byweekday.n||t.freq>W.MONTHLY?(t.byweekday=[t.byweekday.weekday],t.bynweekday=null):(t.bynweekday=[[t.byweekday.weekday,t.byweekday.n]],t.byweekday=null);else{for(var a=[],o=[],e=0;e<t.byweekday.length;e++){var l=t.byweekday[e];if(Pt(l)){a.push(l);continue}else if(Vu(l)){a.push(Ye.fromStr(l).weekday);continue}!l.n||t.freq>W.MONTHLY?a.push(l.weekday):o.push([l.weekday,l.n])}t.byweekday=Fe(a)?a:null,t.bynweekday=Fe(o)?o:null}return Me(t.byhour)?Pt(t.byhour)&&(t.byhour=[t.byhour]):t.byhour=t.freq<W.HOURLY?[t.dtstart.getUTCHours()]:null,Me(t.byminute)?Pt(t.byminute)&&(t.byminute=[t.byminute]):t.byminute=t.freq<W.MINUTELY?[t.dtstart.getUTCMinutes()]:null,Me(t.bysecond)?Pt(t.bysecond)&&(t.bysecond=[t.bysecond]):t.bysecond=t.freq<W.SECONDLY?[t.dtstart.getUTCSeconds()]:null,{parsedOptions:t}}function Xg(n){var t=n.dtstart.getTime()%1e3;if(!_a(n.freq))return[];var e=[];return n.byhour.forEach(function(r){n.byminute.forEach(function(i){n.bysecond.forEach(function(s){e.push(new ys(r,i,s,t))})})}),e}var Qu=_(()=>{$r();zr();vt();Wt();ht();Tn();$l()});function Ia(n){var t=n.split(`
`).map(TD).filter(function(e){return e!==null});return st(st({},t[0]),t[1])}function Aa(n){var t={},e=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(n);if(!e)return t;var r=e[1],i=e[2];return r&&(t.tzid=r),t.dtstart=Ca(i),t}function TD(n){if(n=n.replace(/^\s+|\s+$/,""),!n.length)return null;var t=/^([A-Z]+?)[:;]/.exec(n.toUpperCase());if(!t)return ty(n);var e=t[1];switch(e.toUpperCase()){case"RRULE":case"EXRULE":return ty(n);case"DTSTART":return Aa(n);default:throw new Error("Unsupported RFC prop ".concat(e," in ").concat(n))}}function ty(n){var t=n.replace(/^RRULE:/i,""),e=Aa(t),r=n.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return r.forEach(function(i){var s=i.split("="),a=s[0],o=s[1];switch(a.toUpperCase()){case"FREQ":e.freq=ae[o.toUpperCase()];break;case"WKST":e.wkst=jt[o.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var l=ED(o),c=a.toLowerCase();e[c]=l;break;case"BYWEEKDAY":case"BYDAY":e.byweekday=kD(o);break;case"DTSTART":case"TZID":var d=Aa(n);e.tzid=d.tzid,e.dtstart=d.dtstart;break;case"UNTIL":e.until=Ca(o);break;case"BYEASTER":e.byeaster=Number(o);break;default:throw new Error("Unknown RRULE property '"+a+"'")}}),e}function ED(n){if(n.indexOf(",")!==-1){var t=n.split(",");return t.map(ry)}return ry(n)}function ry(n){return/^[+-]?\d+$/.test(n)?Number(n):n}function kD(n){var t=n.split(",");return t.map(function(e){if(e.length===2)return jt[e];var r=e.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!r||r.length<3)throw new SyntaxError("Invalid weekday string: ".concat(e));var i=Number(r[1]),s=r[2],a=jt[s].weekday;return new Ye(a,i)})}var Ku=_(()=>{$r();zr();Tn();ht();Wt()});var Sn,zl=_(()=>{ht();Sn=function(){function n(t,e){if(isNaN(t.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=t,this.tzid=e}return Object.defineProperty(n.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),n.prototype.toString=function(){var t=ps(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(t):";TZID=".concat(this.tzid,":").concat(t)},n.prototype.getTime=function(){return this.date.getTime()},n.prototype.rezonedDate=function(){return this.isUTC?this.date:Vg(this.date,this.tzid)},n}()});function Pa(n){for(var t=[],e="",r=Object.keys(n),i=Object.keys(Ma),s=0;s<r.length;s++)if(r[s]!=="tzid"&&fe(i,r[s])){var a=r[s].toUpperCase(),o=n[r[s]],l="";if(!(!Me(o)||nt(o)&&!o.length)){switch(a){case"FREQ":l=W.FREQUENCIES[n.freq];break;case"WKST":Pt(o)?l=new Ye(o).toString():l=o.toString();break;case"BYWEEKDAY":a="BYDAY",l=Fg(o).map(function(f){return f instanceof Ye?f:nt(f)?new Ye(f[0],f[1]):new Ye(f)}).toString();break;case"DTSTART":e=DD(o,n.tzid);break;case"UNTIL":l=ps(o,!n.tzid);break;default:if(nt(o)){for(var c=[],d=0;d<o.length;d++)c[d]=String(o[d]);l=c.toString()}else l=String(o)}l&&t.push([a,l])}}var u=t.map(function(f){var p=f[0],m=f[1];return"".concat(p,"=").concat(m.toString())}).join(";"),h="";return u!==""&&(h="RRULE:".concat(u)),[e,h].filter(function(f){return!!f}).join(`
`)}function DD(n,t){return n?"DTSTART"+new Sn(new Date(n),t).toString():""}var Zu=_(()=>{Wt();vt();Tn();ht();zl()});function SD(n,t){return Array.isArray(n)?!Array.isArray(t)||n.length!==t.length?!1:n.every(function(e,r){return e.getTime()===t[r].getTime()}):n instanceof Date?t instanceof Date&&n.getTime()===t.getTime():n===t}var iy,ny=_(()=>{Wl();ht();vt();iy=function(){function n(){this.all=!1,this.before=[],this.after=[],this.between=[]}return n.prototype._cacheAdd=function(t,e,r){e&&(e=e instanceof Date?Vl(e):$u(e)),t==="all"?this.all=e:(r._value=e,this[t].push(r))},n.prototype._cacheGet=function(t,e){var r=!1,i=e?Object.keys(e):[],s=function(d){for(var u=0;u<i.length;u++){var h=i[u];if(!SD(e[h],d[h]))return!0}return!1},a=this[t];if(t==="all")r=this.all;else if(nt(a))for(var o=0;o<a.length;o++){var l=a[o];if(!(i.length&&s(l))){r=l._value;break}}if(!r&&this.all){for(var c=new jr(t,e),o=0;o<this.all.length&&c.accept(this.all[o]);o++);r=c.getValue(),this._cacheAdd(t,r,e)}return nt(r)?$u(r):r instanceof Date?Vl(r):r},n}()});var sy,ay,CD,xD,Si,ft,oy,ly,_D,MD,Ci,pt,cy,dy,uy,hy,Ju,fy=_(()=>{$r();vt();sy=V(V(V(V(V(V(V(V(V(V(V(V(V([],de(1,31),!0),de(2,28),!0),de(3,31),!0),de(4,30),!0),de(5,31),!0),de(6,30),!0),de(7,31),!0),de(8,31),!0),de(9,30),!0),de(10,31),!0),de(11,30),!0),de(12,31),!0),de(1,7),!0),ay=V(V(V(V(V(V(V(V(V(V(V(V(V([],de(1,31),!0),de(2,29),!0),de(3,31),!0),de(4,30),!0),de(5,31),!0),de(6,30),!0),de(7,31),!0),de(8,31),!0),de(9,30),!0),de(10,31),!0),de(11,30),!0),de(12,31),!0),de(1,7),!0),CD=Vt(1,29),xD=Vt(1,30),Si=Vt(1,31),ft=Vt(1,32),oy=V(V(V(V(V(V(V(V(V(V(V(V(V([],ft,!0),xD,!0),ft,!0),Si,!0),ft,!0),Si,!0),ft,!0),ft,!0),Si,!0),ft,!0),Si,!0),ft,!0),ft.slice(0,7),!0),ly=V(V(V(V(V(V(V(V(V(V(V(V(V([],ft,!0),CD,!0),ft,!0),Si,!0),ft,!0),Si,!0),ft,!0),ft,!0),Si,!0),ft,!0),Si,!0),ft,!0),ft.slice(0,7),!0),_D=Vt(-28,0),MD=Vt(-29,0),Ci=Vt(-30,0),pt=Vt(-31,0),cy=V(V(V(V(V(V(V(V(V(V(V(V(V([],pt,!0),MD,!0),pt,!0),Ci,!0),pt,!0),Ci,!0),pt,!0),pt,!0),Ci,!0),pt,!0),Ci,!0),pt,!0),pt.slice(0,7),!0),dy=V(V(V(V(V(V(V(V(V(V(V(V(V([],pt,!0),_D,!0),pt,!0),Ci,!0),pt,!0),Ci,!0),pt,!0),pt,!0),Ci,!0),pt,!0),Ci,!0),pt,!0),pt.slice(0,7),!0),uy=[0,31,60,91,121,152,182,213,244,274,305,335,366],hy=[0,31,59,90,120,151,181,212,243,273,304,334,365],Ju=function(){for(var n=[],t=0;t<55;t++)n=n.concat(Vt(7));return n}()});function py(n,t){var e=vr(n,1,1),r=fs(n)?366:365,i=fs(n+1)?366:365,s=Sa(e),a=Vr(e),o=st(st({yearlen:r,nextyearlen:i,yearordinal:s,yearweekday:a},AD(n)),{wnomask:null});if(Nt(t.byweekno))return o;o.wnomask=de(0,r+7);var l,c,d=l=ut(7-a+t.wkst,7);d>=4?(d=0,c=o.yearlen+ut(a-t.wkst,7)):c=r-d;for(var u=Math.floor(c/7),h=ut(c,7),f=Math.floor(u+h/4),p=0;p<t.byweekno.length;p++){var m=t.byweekno[p];if(m<0&&(m+=f+1),m>0&&m<=f){var g=void 0;m>1?(g=d+(m-1)*7,d!==l&&(g-=7-l)):g=d;for(var v=0;v<7&&(o.wnomask[g]=1,g++,o.wdaymask[g]!==t.wkst);v++);}}if(fe(t.byweekno,1)){var g=d+f*7;if(d!==l&&(g-=7-l),g<r)for(var p=0;p<7&&(o.wnomask[g]=1,g+=1,o.wdaymask[g]!==t.wkst);p++);}if(d){var T=void 0;if(fe(t.byweekno,-1))T=-1;else{var k=Vr(vr(n-1,1,1)),D=ut(7-k.valueOf()+t.wkst,7),M=fs(n-1)?366:365,E=void 0;D>=4?(D=0,E=M+ut(k-t.wkst,7)):E=r-d,T=Math.floor(52+ut(E,7)/4)}if(fe(t.byweekno,T))for(var g=0;g<d;g++)o.wnomask[g]=1}return o}function AD(n){var t=fs(n)?366:365,e=vr(n,1,1),r=Vr(e);return t===365?{mmask:sy,mdaymask:ly,nmdaymask:dy,wdaymask:Ju.slice(r),mrange:hy}:{mmask:ay,mdaymask:oy,nmdaymask:cy,wdaymask:Ju.slice(r),mrange:uy}}var my=_(()=>{$r();ht();vt();fy()});function gy(n,t,e,r,i,s){var a={lastyear:n,lastmonth:t,nwdaymask:[]},o=[];if(s.freq===W.YEARLY)if(Nt(s.bymonth))o=[[0,e]];else for(var l=0;l<s.bymonth.length;l++)t=s.bymonth[l],o.push(r.slice(t-1,t+1));else s.freq===W.MONTHLY&&(o=[r.slice(t-1,t+1)]);if(Nt(o))return a;a.nwdaymask=de(0,e);for(var l=0;l<o.length;l++)for(var c=o[l],d=c[0],u=c[1]-1,h=0;h<s.bynweekday.length;h++){var f=void 0,p=s.bynweekday[h],m=p[0],g=p[1];g<0?(f=u+(g+1)*7,f-=ut(i[f]-m,7)):(f=d+(g-1)*7,f+=ut(7-i[f]+m,7)),d<=f&&f<=u&&(a.nwdaymask[f]=1)}return a}var yy=_(()=>{Wt();vt()});function vy(n,t){t===void 0&&(t=0);var e=n%19,r=Math.floor(n/100),i=n%100,s=Math.floor(r/4),a=r%4,o=Math.floor((r+8)/25),l=Math.floor((r-o+1)/3),c=Math.floor(19*e+r-s-l+15)%30,d=Math.floor(i/4),u=i%4,h=Math.floor(32+2*a+2*d-c-u)%7,f=Math.floor((e+11*c+22*h)/451),p=Math.floor((c+h-7*f+114)/31),m=(c+h-7*f+114)%31+1,g=Date.UTC(n,p-1,m+t),v=Date.UTC(n,0,1);return[Math.ceil((g-v)/(1e3*60*60*24))]}var wy=_(()=>{});var ID,by,Ty=_(()=>{vt();zr();my();yy();wy();$l();ht();ID=function(){function n(t){this.options=t}return n.prototype.rebuild=function(t,e){var r=this.options;if(t!==this.lastyear&&(this.yearinfo=py(t,r)),Fe(r.bynweekday)&&(e!==this.lastmonth||t!==this.lastyear)){var i=this.yearinfo,s=i.yearlen,a=i.mrange,o=i.wdaymask;this.monthinfo=gy(t,e,s,a,o,r)}Me(r.byeaster)&&(this.eastermask=vy(t,r.byeaster))},Object.defineProperty(n.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),n.prototype.ydayset=function(){return[Vt(this.yearlen),0,this.yearlen]},n.prototype.mdayset=function(t,e){for(var r=this.mrange[e-1],i=this.mrange[e],s=de(null,this.yearlen),a=r;a<i;a++)s[a]=a;return[s,r,i]},n.prototype.wdayset=function(t,e,r){for(var i=de(null,this.yearlen+7),s=Sa(vr(t,e,r))-this.yearordinal,a=s,o=0;o<7&&(i[s]=s,++s,this.wdaymask[s]!==this.options.wkst);o++);return[i,a,s]},n.prototype.ddayset=function(t,e,r){var i=de(null,this.yearlen),s=Sa(vr(t,e,r))-this.yearordinal;return i[s]=s,[i,s,s+1]},n.prototype.htimeset=function(t,e,r,i){var s=this,a=[];return this.options.byminute.forEach(function(o){a=a.concat(s.mtimeset(t,o,r,i))}),Wr(a),a},n.prototype.mtimeset=function(t,e,r,i){var s=this.options.bysecond.map(function(a){return new ys(t,e,a,i)});return Wr(s),s},n.prototype.stimeset=function(t,e,r,i){return[new ys(t,e,r,i)]},n.prototype.getdayset=function(t){switch(t){case ae.YEARLY:return this.ydayset.bind(this);case ae.MONTHLY:return this.mdayset.bind(this);case ae.WEEKLY:return this.wdayset.bind(this);case ae.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},n.prototype.gettimeset=function(t){switch(t){case ae.HOURLY:return this.htimeset.bind(this);case ae.MINUTELY:return this.mtimeset.bind(this);case ae.SECONDLY:return this.stimeset.bind(this)}},n}(),by=ID});function Ey(n,t,e,r,i,s){for(var a=[],o=0;o<n.length;o++){var l=void 0,c=void 0,d=n[o];d<0?(l=Math.floor(d/t.length),c=ut(d,t.length)):(l=Math.floor((d-1)/t.length),c=ut(d-1,t.length));for(var u=[],h=e;h<r;h++){var f=s[h];Me(f)&&u.push(f)}var p=void 0;l<0?p=u.slice(l)[0]:p=u[l];var m=t[c],g=Yl(i.yearordinal+p),v=Ul(g,m);fe(a,v)||a.push(v)}return Wr(a),a}var ky=_(()=>{ht();vt()});function ql(n,t){var e=t.dtstart,r=t.freq,i=t.interval,s=t.until,a=t.bysetpos,o=t.count;if(o===0||i===0)return qr(n);var l=Zg.fromDate(e),c=new by(t);c.rebuild(l.year,l.month);for(var d=OD(c,l,t);;){var u=c.getdayset(r)(l.year,l.month,l.day),h=u[0],f=u[1],p=u[2],m=ND(h,f,p,c,t);if(Fe(a))for(var g=Ey(a,d,f,p,c,h),v=0;v<g.length;v++){var T=g[v];if(s&&T>s)return qr(n);if(T>=e){var k=Dy(T,t);if(!n.accept(k)||o&&(--o,!o))return qr(n)}}else for(var v=f;v<p;v++){var D=h[v];if(Me(D))for(var M=Yl(c.yearordinal+D),E=0;E<d.length;E++){var C=d[E],T=Ul(M,C);if(s&&T>s)return qr(n);if(T>=e){var k=Dy(T,t);if(!n.accept(k)||o&&(--o,!o))return qr(n)}}}if(t.interval===0||(l.add(t,m),l.year>Hl))return qr(n);_a(r)||(d=c.gettimeset(r)(l.hour,l.minute,l.second,0)),c.rebuild(l.year,l.month)}}function PD(n,t,e){var r=e.bymonth,i=e.byweekno,s=e.byweekday,a=e.byeaster,o=e.bymonthday,l=e.bynmonthday,c=e.byyearday;return Fe(r)&&!fe(r,n.mmask[t])||Fe(i)&&!n.wnomask[t]||Fe(s)&&!fe(s,n.wdaymask[t])||Fe(n.nwdaymask)&&!n.nwdaymask[t]||a!==null&&!fe(n.eastermask,t)||(Fe(o)||Fe(l))&&!fe(o,n.mdaymask[t])&&!fe(l,n.nmdaymask[t])||Fe(c)&&(t<n.yearlen&&!fe(c,t+1)&&!fe(c,-n.yearlen+t)||t>=n.yearlen&&!fe(c,t+1-n.yearlen)&&!fe(c,-n.nextyearlen+t-n.yearlen))}function Dy(n,t){return new Sn(n,t.tzid).rezonedDate()}function qr(n){return n.getValue()}function ND(n,t,e,r,i){for(var s=!1,a=t;a<e;a++){var o=n[a];s=PD(r,o,i),s&&(n[o]=null)}return s}function OD(n,t,e){var r=e.freq,i=e.byhour,s=e.byminute,a=e.bysecond;return _a(r)?Xg(e):r>=W.HOURLY&&Fe(i)&&!fe(i,t.hour)||r>=W.MINUTELY&&Fe(s)&&!fe(s,t.minute)||r>=W.SECONDLY&&Fe(a)&&!fe(a,t.second)?[]:n.gettimeset(r)(t.hour,t.minute,t.second,t.millisecond)}var Xu=_(()=>{zr();ht();Ty();Wt();Qu();vt();zl();ky();$l()});var jt,Ma,ey,W,Wt=_(()=>{ht();Wl();Wg();Kg();zr();Qu();Ku();Zu();ny();Tn();Xu();jt={MO:new Ye(0),TU:new Ye(1),WE:new Ye(2),TH:new Ye(3),FR:new Ye(4),SA:new Ye(5),SU:new Ye(6)},Ma={freq:ae.YEARLY,dtstart:null,interval:1,wkst:jt.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},ey=Object.keys(Ma),W=function(){function n(t,e){t===void 0&&(t={}),e===void 0&&(e=!1),this._cache=e?null:new iy,this.origOptions=Gu(t);var r=Jg(t).parsedOptions;this.options=r}return n.parseText=function(t,e){return xa(t,e)},n.fromText=function(t,e){return qg(t,e)},n.fromString=function(t){return new n(n.parseString(t)||void 0)},n.prototype._iter=function(t){return ql(t,this.options)},n.prototype._cacheGet=function(t,e){return this._cache?this._cache._cacheGet(t,e):!1},n.prototype._cacheAdd=function(t,e,r){if(this._cache)return this._cache._cacheAdd(t,e,r)},n.prototype.all=function(t){if(t)return this._iter(new qu("all",{},t));var e=this._cacheGet("all");return e===!1&&(e=this._iter(new jr("all",{})),this._cacheAdd("all",e)),e},n.prototype.between=function(t,e,r,i){if(r===void 0&&(r=!1),!kn(t)||!kn(e))throw new Error("Invalid date passed in to RRule.between");var s={before:e,after:t,inc:r};if(i)return this._iter(new qu("between",s,i));var a=this._cacheGet("between",s);return a===!1&&(a=this._iter(new jr("between",s)),this._cacheAdd("between",a,s)),a},n.prototype.before=function(t,e){if(e===void 0&&(e=!1),!kn(t))throw new Error("Invalid date passed in to RRule.before");var r={dt:t,inc:e},i=this._cacheGet("before",r);return i===!1&&(i=this._iter(new jr("before",r)),this._cacheAdd("before",i,r)),i},n.prototype.after=function(t,e){if(e===void 0&&(e=!1),!kn(t))throw new Error("Invalid date passed in to RRule.after");var r={dt:t,inc:e},i=this._cacheGet("after",r);return i===!1&&(i=this._iter(new jr("after",r)),this._cacheAdd("after",i,r)),i},n.prototype.count=function(){return this.all().length},n.prototype.toString=function(){return Pa(this.origOptions)},n.prototype.toText=function(t,e,r){return Gg(this,t,e,r)},n.prototype.isFullyConvertibleToText=function(){return Qg(this)},n.prototype.clone=function(){return new n(this.origOptions)},n.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],n.YEARLY=ae.YEARLY,n.MONTHLY=ae.MONTHLY,n.WEEKLY=ae.WEEKLY,n.DAILY=ae.DAILY,n.HOURLY=ae.HOURLY,n.MINUTELY=ae.MINUTELY,n.SECONDLY=ae.SECONDLY,n.MO=jt.MO,n.TU=jt.TU,n.WE=jt.WE,n.TH=jt.TH,n.FR=jt.FR,n.SA=jt.SA,n.SU=jt.SU,n.parseString=Ia,n.optionsToString=Pa,n}()});function Sy(n,t,e,r,i,s){var a={},o=n.accept;function l(h,f){e.forEach(function(p){p.between(h,f,!0).forEach(function(m){a[Number(m)]=!0})})}i.forEach(function(h){var f=new Sn(h,s).rezonedDate();a[Number(f)]=!0}),n.accept=function(h){var f=Number(h);return isNaN(f)?o.call(this,h):!a[f]&&(l(new Date(f-1),new Date(f+1)),!a[f])?(a[f]=!0,o.call(this,h)):!0},n.method==="between"&&(l(n.args.after,n.args.before),n.accept=function(h){var f=Number(h);return a[f]?!0:(a[f]=!0,o.call(this,h))});for(var c=0;c<r.length;c++){var d=new Sn(r[c],s).rezonedDate();if(!n.accept(new Date(d.getTime())))break}t.forEach(function(h){ql(n,h.options)});var u=n._result;switch(Wr(u),n.method){case"all":case"between":return u;case"before":return u.length&&u[u.length-1]||null;case"after":default:return u.length&&u[0]||null}}var Cy=_(()=>{zl();Xu();ht()});function RD(n,t){var e=[],r=[],i=[],s=[],a=Aa(n),o=a.dtstart,l=a.tzid,c=YD(n,t.unfold);return c.forEach(function(d){var u;if(d){var h=HD(d),f=h.name,p=h.parms,m=h.value;switch(f.toUpperCase()){case"RRULE":if(p.length)throw new Error("unsupported RRULE parm: ".concat(p.join(",")));e.push(Ia(d));break;case"RDATE":var g=(u=/RDATE(?:;TZID=([^:=]+))?/i.exec(d))!==null&&u!==void 0?u:[],v=g[1];v&&!l&&(l=v),r=r.concat(_y(m,p));break;case"EXRULE":if(p.length)throw new Error("unsupported EXRULE parm: ".concat(p.join(",")));i.push(Ia(m));break;case"EXDATE":s=s.concat(_y(m,p));break;case"DTSTART":break;default:throw new Error("unsupported property: "+f)}}}),{dtstart:o,tzid:l,rrulevals:e,rdatevals:r,exrulevals:i,exdatevals:s}}function LD(n,t){var e=RD(n,t),r=e.rrulevals,i=e.rdatevals,s=e.exrulevals,a=e.exdatevals,o=e.dtstart,l=e.tzid,c=t.cache===!1;if(t.compatible&&(t.forceset=!0,t.unfold=!0),t.forceset||r.length>1||i.length||s.length||a.length){var d=new rh(c);return d.dtstart(o),d.tzid(l||void 0),r.forEach(function(h){d.rrule(new W(eh(h,o,l),c))}),i.forEach(function(h){d.rdate(h)}),s.forEach(function(h){d.exrule(new W(eh(h,o,l),c))}),a.forEach(function(h){d.exdate(h)}),t.compatible&&t.dtstart&&d.rdate(o),d}var u=r[0]||{};return new W(eh(u,u.dtstart||t.dtstart||o,u.tzid||t.tzid||l),c)}function Gl(n,t){return t===void 0&&(t={}),LD(n,FD(t))}function eh(n,t,e){return st(st({},n),{dtstart:t,tzid:e})}function FD(n){var t=[],e=Object.keys(n),r=Object.keys(xy);if(e.forEach(function(i){fe(r,i)||t.push(i)}),t.length)throw new Error("Invalid options: "+t.join(", "));return st(st({},xy),n)}function BD(n){if(n.indexOf(":")===-1)return{name:"RRULE",value:n};var t=Bg(n,":",1),e=t[0],r=t[1];return{name:e,value:r}}function HD(n){var t=BD(n),e=t.name,r=t.value,i=e.split(";");if(!i)throw new Error("empty property name");return{name:i[0].toUpperCase(),parms:i.slice(1),value:r}}function YD(n,t){if(t===void 0&&(t=!1),n=n&&n.trim(),!n)throw new Error("Invalid empty string");if(!t)return n.split(/\s/);for(var e=n.split(`
`),r=0;r<e.length;){var i=e[r]=e[r].replace(/\s+$/g,"");i?r>0&&i[0]===" "?(e[r-1]+=i.slice(1),e.splice(r,1)):r+=1:e.splice(r,1)}return e}function UD(n){n.forEach(function(t){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(t))throw new Error("unsupported RDATE/EXDATE parm: "+t)})}function _y(n,t){return UD(t),n.split(",").map(function(e){return Ca(e)})}var xy,th=_(()=>{$r();Wt();ih();ht();vt();Ku();xy={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null}});function My(n){var t=this;return function(e){if(e!==void 0&&(t["_".concat(n)]=e),t["_".concat(n)]!==void 0)return t["_".concat(n)];for(var r=0;r<t._rrule.length;r++){var i=t._rrule[r].origOptions[n];if(i)return i}}}function Ay(n,t){if(!(n instanceof W))throw new TypeError(String(n)+" is not RRule instance");fe(t.map(String),String(n))||t.push(n)}function Iy(n,t){if(!(n instanceof Date))throw new TypeError(String(n)+" is not Date instance");fe(t.map(Number),Number(n))||(t.push(n),Wr(t))}function Py(n,t,e){var r=!e||e.toUpperCase()==="UTC",i=r?"".concat(n,":"):"".concat(n,";TZID=").concat(e,":"),s=t.map(function(a){return ps(a.valueOf(),r)}).join(",");return"".concat(i).concat(s)}var rh,ih=_(()=>{$r();Wt();ht();vt();Cy();th();Zu();rh=function(n){ms(t,n);function t(e){e===void 0&&(e=!1);var r=n.call(this,{},e)||this;return r.dtstart=My.apply(r,["dtstart"]),r.tzid=My.apply(r,["tzid"]),r._rrule=[],r._rdate=[],r._exrule=[],r._exdate=[],r}return t.prototype._iter=function(e){return Sy(e,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},t.prototype.rrule=function(e){Ay(e,this._rrule)},t.prototype.exrule=function(e){Ay(e,this._exrule)},t.prototype.rdate=function(e){Iy(e,this._rdate)},t.prototype.exdate=function(e){Iy(e,this._exdate)},t.prototype.rrules=function(){return this._rrule.map(function(e){return Gl(e.toString())})},t.prototype.exrules=function(){return this._exrule.map(function(e){return Gl(e.toString())})},t.prototype.rdates=function(){return this._rdate.map(function(e){return new Date(e.getTime())})},t.prototype.exdates=function(){return this._exdate.map(function(e){return new Date(e.getTime())})},t.prototype.valueOf=function(){var e=[];return!this._rrule.length&&this._dtstart&&(e=e.concat(Pa({dtstart:this._dtstart}))),this._rrule.forEach(function(r){e=e.concat(r.toString().split(`
`))}),this._exrule.forEach(function(r){e=e.concat(r.toString().split(`
`).map(function(i){return i.replace(/^RRULE:/,"EXRULE:")}).filter(function(i){return!/^DTSTART/.test(i)}))}),this._rdate.length&&e.push(Py("RDATE",this._rdate,this.tzid())),this._exdate.length&&e.push(Py("EXDATE",this._exdate,this.tzid())),e},t.prototype.toString=function(){return this.valueOf().join(`
`)},t.prototype.clone=function(){var e=new t(!!this._cache);return this._rrule.forEach(function(r){return e.rrule(r.clone())}),this._exrule.forEach(function(r){return e.exrule(r.clone())}),this._rdate.forEach(function(r){return e.rdate(new Date(r.getTime()))}),this._exdate.forEach(function(r){return e.exdate(new Date(r.getTime()))}),e},t}(W)});var nh=_(()=>{Wt();ih();th();zr();Tn();ht()});var vs,sh=_(()=>{we();vs=class{constructor(t){this.mapping=t}toUserField(t){return this.mapping[t]}mapFromFrontmatter(t,e,r){var s;if(!t)return{};let i={path:e};if(t[this.mapping.title]!==void 0)i.title=t[this.mapping.title];else if(r){let a=(s=e.split("/").pop())==null?void 0:s.replace(".md","");a&&(i.title=a)}if(t[this.mapping.status]!==void 0&&(i.status=t[this.mapping.status]),t[this.mapping.priority]!==void 0&&(i.priority=t[this.mapping.priority]),t[this.mapping.due]!==void 0&&(i.due=t[this.mapping.due]),t[this.mapping.scheduled]!==void 0&&(i.scheduled=t[this.mapping.scheduled]),t[this.mapping.contexts]!==void 0){let a=t[this.mapping.contexts];i.contexts=Array.isArray(a)?a:[a]}if(t[this.mapping.projects]!==void 0){let a=t[this.mapping.projects];i.projects=Array.isArray(a)?a:[a]}if(t[this.mapping.timeEstimate]!==void 0&&(i.timeEstimate=t[this.mapping.timeEstimate]),t[this.mapping.completedDate]!==void 0&&(i.completedDate=t[this.mapping.completedDate]),t[this.mapping.recurrence]!==void 0&&(i.recurrence=t[this.mapping.recurrence]),t[this.mapping.dateCreated]!==void 0&&(i.dateCreated=t[this.mapping.dateCreated]),t[this.mapping.dateModified]!==void 0&&(i.dateModified=t[this.mapping.dateModified]),t[this.mapping.timeEntries]!==void 0&&(i.timeEntries=t[this.mapping.timeEntries]),t[this.mapping.completeInstances]!==void 0&&(i.complete_instances=Ng(t[this.mapping.completeInstances])),t[this.mapping.icsEventId]!==void 0){let a=t[this.mapping.icsEventId];i.icsEventId=Array.isArray(a)?a:[a]}return t.tags&&Array.isArray(t.tags)&&(i.tags=t.tags,i.archived=t.tags.includes(this.mapping.archiveTag)),t.timeEntries!==void 0&&(i.timeEntries=t.timeEntries),i}mapToFrontmatter(t,e,r){let i={};t.title!==void 0&&(i[this.mapping.title]=t.title),r&&delete i[this.mapping.title],t.status!==void 0&&(i[this.mapping.status]=t.status),t.priority!==void 0&&(i[this.mapping.priority]=t.priority),t.due!==void 0&&(i[this.mapping.due]=t.due),t.scheduled!==void 0&&(i[this.mapping.scheduled]=t.scheduled),t.contexts!==void 0&&(i[this.mapping.contexts]=t.contexts),t.projects!==void 0&&(i[this.mapping.projects]=t.projects),t.timeEstimate!==void 0&&(i[this.mapping.timeEstimate]=t.timeEstimate),t.completedDate!==void 0&&(i[this.mapping.completedDate]=t.completedDate),t.recurrence!==void 0&&(i[this.mapping.recurrence]=t.recurrence),t.dateCreated!==void 0&&(i[this.mapping.dateCreated]=t.dateCreated),t.dateModified!==void 0&&(i[this.mapping.dateModified]=t.dateModified),t.timeEntries!==void 0&&(i[this.mapping.timeEntries]=t.timeEntries),t.complete_instances!==void 0&&(i[this.mapping.completeInstances]=t.complete_instances),t.icsEventId!==void 0&&t.icsEventId.length>0&&(i[this.mapping.icsEventId]=t.icsEventId);let s=t.tags?[...t.tags]:[];return e&&!s.includes(e)&&s.push(e),t.archived===!0&&!s.includes(this.mapping.archiveTag)?s.push(this.mapping.archiveTag):t.archived===!1&&(s=s.filter(a=>a!==this.mapping.archiveTag)),s.length>0&&(i.tags=s),t.timeEntries!==void 0&&(i.timeEntries=t.timeEntries),i}updateMapping(t){this.mapping=t}getMapping(){return{...this.mapping}}static validateMapping(t){let e=[],r=Object.keys(t);for(let a of r)(!t[a]||t[a].trim()==="")&&e.push(`Field "${a}" cannot be empty`);let i=Object.values(t),s=new Set(i);return i.length!==s.size&&e.push("Field mappings must have unique property names"),{valid:e.length===0,errors:e}}}});function Ql(n){if(!n.startsWith("---"))return{};let t=n.indexOf("---",3);if(t===-1)return{};let e=n.substring(3,t);try{return(0,Cn.parseYaml)(e)||{}}catch(r){return console.error("Error parsing frontmatter:",r),{}}}async function Kl(n,t){try{let r=(0,Cn.normalizePath)(t).split("/").filter(s=>s.length>0),i="";for(let s of r)i=i?`${i}/${s}`:s,n.getAbstractFileByPath(i)||await n.createFolder(i)}catch(e){let r=e instanceof Error?e.message:String(e),i=e instanceof Error?e.stack:void 0;console.error("Error creating folder structure:",{error:r,stack:i,folderPath:t,normalizedPath:(0,Cn.normalizePath)(t)});let s=new Error(`Failed to create folder "${t}": ${r}`);throw i&&(s.stack=i),s}}function VD(n,t){try{let e=new Date(n),r=new Date(t);if(isNaN(e.getTime())||isNaN(r.getTime()))return console.error("Invalid timestamps for duration calculation:",{startTime:n,endTime:t}),0;if(r<=e)return console.error("End time is not after start time:",{startTime:n,endTime:t}),0;let i=r.getTime()-e.getTime(),s=Math.round(i/(1e3*60));return Math.max(0,s)}catch(e){return console.error("Error calculating duration:",e,{startTime:n,endTime:t}),0}}function Na(n){return!n||!Array.isArray(n)?0:n.reduce((t,e)=>{if(!e.startTime||!e.endTime)return t;let r=VD(e.startTime,e.endTime);return t+r},0)}function Ny(n){return!n||!Array.isArray(n)?null:n.find(t=>t.startTime&&!t.endTime)||null}function Zl(n){if(!n||n===0||isNaN(n))return"0m";let t=Math.floor(n/60),e=n%60;return t===0?`${e}m`:e===0?`${t}h`:`${t}h ${e}m`}function ws(n){if(n==="none")return"";let t=new Date,e;switch(n){case"today":e=t;break;case"tomorrow":e=new Date(t),e.setDate(t.getDate()+1);break;case"next-week":e=new Date(t),e.setDate(t.getDate()+7);break;default:return""}return I(e,"yyyy-MM-dd")}function Oa(n,t){return n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()}function Oy(n,t,e,r,i,s){var c;let a=n.metadataCache.getFileCache(r),o=a==null?void 0:a.frontmatter;if(o)if(i){let d=i.mapFromFrontmatter(o,e,s);return{title:d.title||"Untitled task",status:d.status||"open",priority:d.priority||"normal",due:d.due,scheduled:d.scheduled,path:e,archived:d.archived||!1,tags:d.tags||[],contexts:d.contexts||[],projects:d.projects||[],recurrence:d.recurrence,complete_instances:d.complete_instances,completedDate:d.completedDate,timeEstimate:d.timeEstimate,timeEntries:d.timeEntries,dateCreated:d.dateCreated,dateModified:d.dateModified}}else{let u=new vs(Al).mapFromFrontmatter(o,e,s);return{title:u.title||"Untitled task",status:u.status||"open",priority:u.priority||"normal",due:u.due,scheduled:u.scheduled,path:e,archived:u.archived||!1,tags:u.tags||[],contexts:u.contexts||[],projects:u.projects||[],recurrence:u.recurrence,complete_instances:u.complete_instances,completedDate:u.completedDate,timeEstimate:u.timeEstimate,timeEntries:u.timeEntries,dateCreated:u.dateCreated,dateModified:u.dateModified}}return{title:((c=e.split("/").pop())==null?void 0:c.replace(".md",""))||"Untitled",status:"open",priority:"normal",path:e,archived:!1}}function Ra(n,t){if(!n.recurrence)return!0;if(typeof n.recurrence=="string")try{let l;if(n.scheduled)l=yt(n.scheduled);else if(n.dateCreated)l=yt(n.dateCreated);else return!1;let c=W.parseString(n.recurrence);c.dtstart=l;let d=new W(c),u=yt(Te(t));return d.between(u,new Date(u.getTime()+24*60*60*1e3-1),!0).length>0}catch(l){return console.error("Error evaluating rrule:",l,{task:n.title,recurrence:n.recurrence}),!0}let e=n.recurrence.frequency,r=he(Te(t)),i=r.getDay(),s=r.getDate(),a=r.getMonth()+1,o=["sun","mon","tue","wed","thu","fri","sat"];switch(e){case"daily":return!0;case"weekly":return(n.recurrence.days_of_week||[]).includes(o[i]);case"monthly":return s===n.recurrence.day_of_month;case"yearly":{if(n.recurrence.month_of_year&&n.recurrence.day_of_month)return s===n.recurrence.day_of_month&&a===n.recurrence.month_of_year;if(n.due)try{let l=he(n.due);return l.getDate()===s&&l.getMonth()===r.getMonth()}catch(l){return console.error(`Error parsing due date ${n.due}:`,l),!1}return!1}default:return!1}}function Gr(n,t){if(!n.recurrence)return n.status||"open";let e=I(t,"yyyy-MM-dd");return(Array.isArray(n.complete_instances)?n.complete_instances:[]).includes(e)?"done":"open"}function Jl(n,t,e){if(!n.recurrence)return[];if(typeof n.recurrence=="string")try{let s;if(n.scheduled)s=yt(n.scheduled);else if(n.dateCreated)s=yt(n.dateCreated);else return[];let a=W.parseString(n.recurrence);return a.dtstart=s,new W(a).between(t,e,!0)}catch(s){console.error("Error generating recurring instances:",s,{task:n.title,recurrence:n.recurrence})}let r=[],i=new Date(t);for(;i<=e;)Ra(n,i)&&r.push(new Date(i)),i.setDate(i.getDate()+1);return r}function ah(n){if(!n||!n.frequency)throw new Error("Invalid recurrence object");try{let t={};switch(n.frequency){case"daily":t.freq=W.DAILY;break;case"weekly":if(t.freq=W.WEEKLY,n.days_of_week&&Array.isArray(n.days_of_week)){let r={sun:W.SU,mon:W.MO,tue:W.TU,wed:W.WE,thu:W.TH,fri:W.FR,sat:W.SA};t.byweekday=n.days_of_week.map(i=>r[i.toLowerCase()]).filter(Boolean)}break;case"monthly":t.freq=W.MONTHLY,n.day_of_month&&(t.bymonthday=[n.day_of_month]);break;case"yearly":t.freq=W.YEARLY,n.month_of_year&&(t.bymonth=[n.month_of_year]),n.day_of_month&&(t.bymonthday=[n.day_of_month]);break;default:throw new Error(`Unsupported frequency: ${n.frequency}`)}return new W(t).toString()}catch(t){throw console.error("Error converting legacy recurrence to rrule:",t,{recurrence:n}),t}}function xn(n){if(!n)return"";try{if(typeof n=="string"&&n.includes("FREQ="))return W.fromString(n).toText();if(typeof n=="object"&&n.frequency){let t=ah(n);return W.fromString(t).toText()}return"rrule"}catch(t){return console.error("Error converting recurrence to display text:",t,{recurrence:n}),"rrule"}}function WD(n){if(!n||typeof n!="object"||!n.id||typeof n.id!="string"||!n.title||typeof n.title!="string"||!n.startTime||typeof n.startTime!="string"||!n.endTime||typeof n.endTime!="string")return!1;let t=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;if(!t.test(n.startTime)||!t.test(n.endTime))return!1;let[e,r]=n.startTime.split(":").map(Number),[i,s]=n.endTime.split(":").map(Number),a=e*60+r;if(i*60+s<=a||n.attachments&&!Array.isArray(n.attachments))return!1;if(n.attachments){for(let l of n.attachments)if(typeof l!="string"||!l.trim())return!1}return!(n.color&&typeof n.color!="string"||n.description&&typeof n.description!="string")}function oh(n,t){try{let e=Ql(n);if(!e||!e.timeblocks||!Array.isArray(e.timeblocks))return[];let r=[];for(let i of e.timeblocks)WD(i)?r.push(i):console.warn(`Invalid timeblock in ${t}:`,i);return r}catch(e){return console.error(`Error extracting timeblocks from ${t}:`,e),[]}}function Ry(n,t){let e=`${t}T${n.startTime}:00`,r=`${t}T${n.endTime}:00`;return{id:`timeblock-${n.id}`,title:n.title,start:e,end:r,allDay:!1,backgroundColor:n.color||"#6366f1",borderColor:n.color||"#4f46e5",editable:!0,eventType:"timeblock",extendedProps:{type:"timeblock",eventType:"timeblock",timeblock:n,originalDate:t,description:n.description,attachments:n.attachments||[]}}}function Ly(){return`tb-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}async function lh(n,t,e,r,i,s){let{getDailyNote:a,getAllDailyNotes:o,appHasDailyNotesPluginLoaded:l}=await Promise.resolve().then(()=>Ve(Yt()));if(!l())throw new Error("Daily Notes plugin is not enabled");let c=o(),d=window.moment(e),u=a(d,c);if(!u)throw new Error(`Daily note for ${e} not found`);let h=await n.vault.read(u),f=oh(h,u.path),p=f.findIndex(v=>v.id===t);if(p===-1)throw new Error(`Timeblock ${t} not found`);let m=f[p];if(e===r){await jD(n,u,t,i,s);return}await $D(n,u,t);let g={...m,startTime:i,endTime:s};await zD(n,r,g)}async function jD(n,t,e,r,i){let s=await n.vault.read(t),a=Ql(s)||{};if(!a.timeblocks||!Array.isArray(a.timeblocks))throw new Error("No timeblocks found in frontmatter");let o=a.timeblocks.findIndex(l=>l.id===e);if(o===-1)throw new Error(`Timeblock ${e} not found`);a.timeblocks[o].startTime=r,a.timeblocks[o].endTime=i,await ch(n,t,a,s)}async function $D(n,t,e){let r=await n.vault.read(t),i=Ql(r)||{};!i.timeblocks||!Array.isArray(i.timeblocks)||(i.timeblocks=i.timeblocks.filter(s=>s.id!==e),await ch(n,t,i,r))}async function zD(n,t,e){let{createDailyNote:r,getDailyNote:i,getAllDailyNotes:s}=await Promise.resolve().then(()=>Ve(Yt())),a=window.moment(t),o=s(),l=i(a,o);l||(l=await r(a));let c=await n.vault.read(l),d=Ql(c)||{};d.timeblocks||(d.timeblocks=[]),d.timeblocks.push(e),await ch(n,l,d,c)}async function ch(n,t,e,r){let i=r;if(r.startsWith("---")){let o=r.indexOf("---",3);o!==-1&&(i=r.substring(o+3))}let a=`---
${(0,Cn.stringifyYaml)(e)}---${i}`;await n.vault.modify(t,a)}function Ot(n){return!n||!Array.isArray(n)?[]:n.filter(t=>{if(typeof t!="string")return!1;let e=t.trim();return!(e.length===0||e==='""'||e==="''")})}var Cn,at=_(()=>{Cn=require("obsidian");je();nh();sh();Nu();we()});var Co,oi,hd=_(()=>{Co=require("obsidian"),oi=class{constructor(t){this.menu=new Co.Menu,this.options=t,this.buildMenu()}buildMenu(){this.options.title&&(this.menu.addItem(e=>{e.setTitle(this.options.title),e.setIcon("calendar"),e.setDisabled(!0)}),this.menu.addSeparator()),this.getDateOptions().forEach(e=>{this.menu.addItem(r=>{let i=e.label;e.icon&&r.setIcon(e.icon),e.value&&e.value===this.options.currentValue&&(i=`\u2713 ${e.label}`),r.setTitle(i),r.onClick(async()=>{this.options.onSelect(e.value,null)})})}),this.menu.addSeparator(),this.menu.addItem(e=>{e.setTitle("Pick date & time..."),e.setIcon("calendar"),e.onClick(async()=>{this.showDateTimePicker()})}),this.options.currentValue&&this.menu.addItem(e=>{e.setTitle("Clear date"),e.setIcon("x"),e.onClick(async()=>{this.options.onSelect(null,null)})})}getDateOptions(){let t=window.moment(),e=[];e.push({label:"Today",value:t.format("YYYY-MM-DD"),icon:"calendar-check",isToday:!0}),e.push({label:"Tomorrow",value:t.clone().add(1,"day").format("YYYY-MM-DD"),icon:"calendar-plus"});let r=t.clone().day(6);(r.isBefore(t)||r.isSame(t,"day"))&&r.add(1,"week"),e.push({label:"This weekend",value:r.format("YYYY-MM-DD"),icon:"calendar-days"});let i=t.clone().day(1).add(1,"week");e.push({label:"Next week",value:i.format("YYYY-MM-DD"),icon:"calendar-plus"});let s=t.clone().add(1,"month").startOf("month");return e.push({label:"Next month",value:s.format("YYYY-MM-DD"),icon:"calendar-range"}),e}show(t){this.menu.showAtMouseEvent(t)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4})}showDateTimePicker(){let t=this.createModal(),e=this.createHeader(),r=this.createDateSection(),i=this.createTimeSection(),s=this.createButtonSection();t.appendChild(e),t.appendChild(r.container),t.appendChild(i.container),t.appendChild(s.container),document.body.appendChild(t),this.setupModalEventHandlers(t,r.input,i.input,s.selectButton),setTimeout(()=>{r.input.focus()},100)}createModal(){let t=document.createElement("div");return t.className="date-picker-modal",t}createHeader(){let t=document.createElement("div");t.className="date-picker-modal__header";let e=document.createElement("div");e.className="date-picker-modal__header-icon",(0,Co.setIcon)(e,"calendar");let r=document.createElement("h3");return r.className="date-picker-modal__header-title",r.textContent="Set date & time",t.appendChild(e),t.appendChild(r),t}createDateSection(){var s;let t=document.createElement("div");t.className="date-picker-modal__section";let e=this.createInputLabel("calendar","Date"),r=this.createInputContainer(),i=this.createDateInput();return(s=this.options.currentValue)!=null&&s.trim()&&(i.value=this.options.currentValue),r.appendChild(i),t.appendChild(e),t.appendChild(r),{container:t,input:i}}createTimeSection(){var s;let t=document.createElement("div");t.className="date-picker-modal__section date-picker-modal__section--buttons";let e=this.createInputLabel("clock","Time (optional)"),r=this.createInputContainer(),i=this.createTimeInput();return(s=this.options.currentTime)!=null&&s.trim()&&(i.value=this.options.currentTime),r.appendChild(i),t.appendChild(e),t.appendChild(r),{container:t,input:i}}createInputLabel(t,e){let r=document.createElement("label");r.className="date-picker-modal__label";let i=document.createElement("div");i.className="date-picker-modal__label-icon",(0,Co.setIcon)(i,t==="calendar"?"calendar":"clock");let s=document.createElement("span");return s.textContent=e,r.appendChild(i),r.appendChild(s),r}createInputContainer(){let t=document.createElement("div");return t.className="date-picker-modal__input-container",t}createDateInput(){let t=document.createElement("input");return t.type="date",t.className="date-picker-modal__input",this.addPickerClickHandler(t),t}createTimeInput(){let t=document.createElement("input");return t.type="time",t.className="date-picker-modal__input",this.addPickerClickHandler(t),t}addPickerClickHandler(t){t.addEventListener("click",()=>{if("showPicker"in t)try{t.showPicker()}catch(e){t.focus()}else t.focus()})}createButtonSection(){let t=document.createElement("div");t.className="date-picker-modal__buttons";let e=this.createButton("Cancel",!1),r=this.createButton("Select",!0);return t.appendChild(e),t.appendChild(r),{container:t,selectButton:r}}createButton(t,e){let r=document.createElement("button");return r.textContent=t,r.className=e?"date-picker-modal__button date-picker-modal__button--primary":"date-picker-modal__button date-picker-modal__button--secondary",r}setupModalEventHandlers(t,e,r,i){i.addEventListener("click",()=>{e.value&&this.options.onSelect(e.value,r.value||null),document.body.removeChild(t)}),t.querySelector(".date-picker-modal__button--secondary").addEventListener("click",()=>{document.body.removeChild(t)});let a=c=>{c.key==="Escape"&&(document.body.removeChild(t),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a);let o=c=>{c.key==="Enter"&&(c.preventDefault(),i.click())};e.addEventListener("keydown",o),r.addEventListener("keydown",o);let l=c=>{t.contains(c.target)||(document.body.removeChild(t),document.removeEventListener("click",l),document.removeEventListener("keydown",a))};setTimeout(()=>{document.addEventListener("click",l)},100)}}});var lb,Hi,fd=_(()=>{lb=require("obsidian"),Hi=class{constructor(t){this.menu=new lb.Menu,this.options=t,this.buildMenu()}buildMenu(){let t=this.options.plugin.settings.customPriorities;this.sortedPriorities=[...t].sort((e,r)=>r.weight-e.weight),this.sortedPriorities.forEach(e=>{this.menu.addItem(r=>{let i=e.label;r.setIcon("star"),e.value===this.options.currentValue&&(i=`\u2713 ${e.label}`),r.setTitle(i),r.onClick(async()=>{this.options.onSelect(e.value)})})})}show(t){this.menu.showAtMouseEvent(t),setTimeout(()=>{this.applyColorStyling()},10)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4}),setTimeout(()=>{this.applyColorStyling()},10)}applyColorStyling(){let t=document.querySelector(".menu");if(!t)return;let e=t.querySelectorAll(".menu-item");this.sortedPriorities.forEach((r,i)=>{let s=e[i];if(s&&r.color){let a=s.querySelector(".menu-item-icon");a&&(a.style.color=r.color)}})}}});var cr,Yi,bp,md=_(()=>{cr=require("obsidian"),Yi=class{constructor(t){this.menu=new cr.Menu,this.options=t,this.buildMenu()}buildMenu(){this.getRecurrenceOptions().forEach(e=>{this.menu.addItem(r=>{let i=e.label;e.icon&&r.setIcon(e.icon),e.value===this.options.currentValue&&(i=`\u2713 ${e.label}`),r.setTitle(i),r.onClick(async()=>{this.options.onSelect(e.value)})})}),this.menu.addSeparator(),this.menu.addItem(e=>{e.setTitle("Custom recurrence..."),e.setIcon("settings"),e.onClick(async()=>{this.showCustomRecurrenceModal()})}),this.options.currentValue&&this.menu.addItem(e=>{e.setTitle("Clear recurrence"),e.setIcon("x"),e.onClick(async()=>{this.options.onSelect(null)})})}getRecurrenceOptions(){let t=[],e=new Date,r=["SU","MO","TU","WE","TH","FR","SA"],i=["January","February","March","April","May","June","July","August","September","October","November","December"],s=r[e.getDay()],a=e.getDate(),o=e.getMonth()+1,l=i[e.getMonth()],c=e.toLocaleDateString("en-US",{weekday:"long"});return t.push({label:"Daily",value:"FREQ=DAILY;INTERVAL=1",icon:"calendar-days"}),t.push({label:`Weekly on ${c}`,value:`FREQ=WEEKLY;INTERVAL=1;BYDAY=${s}`,icon:"calendar"}),t.push({label:`Every 2 weeks on ${c}`,value:`FREQ=WEEKLY;INTERVAL=2;BYDAY=${s}`,icon:"calendar"}),t.push({label:`Monthly on the ${this.getOrdinal(a)}`,value:`FREQ=MONTHLY;INTERVAL=1;BYMONTHDAY=${a}`,icon:"calendar-range"}),t.push({label:`Every 3 months on the ${this.getOrdinal(a)}`,value:`FREQ=MONTHLY;INTERVAL=3;BYMONTHDAY=${a}`,icon:"calendar-range"}),t.push({label:`Yearly on ${l} ${this.getOrdinal(a)}`,value:`FREQ=YEARLY;INTERVAL=1;BYMONTH=${o};BYMONTHDAY=${a}`,icon:"calendar-clock"}),t.push({label:"Weekdays only",value:"FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR",icon:"briefcase"}),t}getOrdinal(t){let e=["th","st","nd","rd"],r=t%100;return t+(e[(r-20)%10]||e[r]||e[0])}showCustomRecurrenceModal(){new bp(this.options.app,this.options.currentValue||"",t=>{t&&this.options.onSelect(t)}).open()}show(t){this.menu.showAtMouseEvent(t)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4})}},bp=class extends cr.Modal{constructor(e,r,i){super(e);this.frequency="DAILY";this.interval=1;this.byDay=[];this.byMonthDay=[];this.byMonth=[];this.until="";this.endType="never";this.currentValue=r,this.onSubmit=i,this.parseCurrentValue()}parseCurrentValue(){if(!this.currentValue)return;let e=this.currentValue.split(";");for(let r of e){let[i,s]=r.split("=");switch(i){case"FREQ":this.frequency=s;break;case"INTERVAL":this.interval=parseInt(s)||1;break;case"BYDAY":{let a=s.split(","),o=[];for(let l of a){let c=l.match(/^(-?\d+)([A-Z]{2})$/);c?(this.bySetPos=parseInt(c[1]),o.push(c[2])):o.push(l)}this.byDay=o;break}case"BYMONTHDAY":this.byMonthDay=s.split(",").map(a=>parseInt(a));break;case"BYMONTH":this.byMonth=s.split(",").map(a=>parseInt(a));break;case"BYSETPOS":this.bySetPos=parseInt(s);break;case"COUNT":this.count=parseInt(s),this.endType="count";break;case"UNTIL":s.length===8?this.until=`${s.slice(0,4)}-${s.slice(4,6)}-${s.slice(6,8)}`:this.until=s,this.endType="until";break}}}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Custom Recurrence"}),new cr.Setting(e).setName("Frequency").addDropdown(j=>{j.addOption("DAILY","Daily").addOption("WEEKLY","Weekly").addOption("MONTHLY","Monthly").addOption("YEARLY","Yearly").setValue(this.frequency).onChange(G=>{this.frequency=G,this.updateFrequencySpecificVisibility()})}),new cr.Setting(e).setName("Interval").setDesc("Every X days/weeks/months/years").addText(j=>{j.setValue(this.interval.toString()).onChange(G=>{this.interval=parseInt(G)||1})});let r=new cr.Setting(e).setName("Days of week").setDesc("Select specific days (for weekly recurrence)"),i=r.controlEl.createDiv("days-container");[{key:"MO",label:"Mon"},{key:"TU",label:"Tue"},{key:"WE",label:"Wed"},{key:"TH",label:"Thu"},{key:"FR",label:"Fri"},{key:"SA",label:"Sat"},{key:"SU",label:"Sun"}].forEach(j=>{let G=i.createEl("label",{cls:"day-checkbox"});G.style.display="inline-block",G.style.marginRight="8px";let Be=G.createEl("input",{type:"checkbox"});Be.checked=this.byDay.includes(j.key),Be.addEventListener("change",()=>{Be.checked?this.byDay.includes(j.key)||this.byDay.push(j.key):this.byDay=this.byDay.filter(un=>un!==j.key)}),G.createSpan({text:` ${j.label}`})});let a=new cr.Setting(e).setName("Monthly recurrence").setDesc("Choose how to repeat monthly"),o=a.controlEl.createDiv("monthly-options"),l=o.createEl("label",{cls:"radio-option"});l.style.display="block",l.style.marginBottom="8px";let c=l.createEl("input",{type:"radio",value:"bydate"});c.name="monthly-type",c.checked=this.byMonthDay.length>0||this.byDay.length===0&&this.bySetPos===void 0,l.createSpan({text:" On day "});let d=l.createEl("select");d.style.marginLeft="4px",d.style.marginRight="4px";for(let j=1;j<=31;j++){let G=d.createEl("option",{value:j.toString(),text:j.toString()});(this.byMonthDay.length>0&&this.byMonthDay[0]===j||this.byMonthDay.length===0&&j===new Date().getDate())&&(G.selected=!0)}l.createSpan({text:" of each month"});let u=o.createEl("label",{cls:"radio-option"});u.style.display="block",u.style.marginBottom="8px";let h=u.createEl("input",{type:"radio",value:"byday"});h.name="monthly-type",h.checked=this.byDay.length>0&&this.bySetPos!==void 0,u.createSpan({text:" On the "});let f=u.createEl("select");f.style.marginLeft="4px",f.style.marginRight="4px";let p=[{value:"1",text:"first"},{value:"2",text:"second"},{value:"3",text:"third"},{value:"4",text:"fourth"},{value:"-1",text:"last"}];p.forEach(j=>{let G=f.createEl("option",{value:j.value,text:j.text});(this.bySetPos===parseInt(j.value)||!this.bySetPos&&j.value==="1")&&(G.selected=!0)});let m=u.createEl("select");m.style.marginLeft="4px",m.style.marginRight="4px";let g=[{value:"MO",text:"Monday"},{value:"TU",text:"Tuesday"},{value:"WE",text:"Wednesday"},{value:"TH",text:"Thursday"},{value:"FR",text:"Friday"},{value:"SA",text:"Saturday"},{value:"SU",text:"Sunday"}],v=new Date,T=["SU","MO","TU","WE","TH","FR","SA"][v.getDay()];g.forEach(j=>{let G=m.createEl("option",{value:j.value,text:j.text});(this.byDay.length>0&&this.byDay[0]===j.value||this.byDay.length===0&&j.value===T)&&(G.selected=!0)}),u.createSpan({text:" of each month"});let k=new cr.Setting(e).setName("Yearly recurrence").setDesc("Choose how to repeat yearly"),D=k.controlEl.createDiv("yearly-options"),M=D.createEl("label",{cls:"radio-option"});M.style.display="block",M.style.marginBottom="8px";let E=M.createEl("input",{type:"radio",value:"bydate"});E.name="yearly-type",E.checked=this.byMonthDay.length>0||this.byDay.length===0&&this.bySetPos===void 0,M.createSpan({text:" On "});let C=M.createEl("select");C.style.marginLeft="4px",C.style.marginRight="4px";let S=["January","February","March","April","May","June","July","August","September","October","November","December"];S.forEach((j,G)=>{let Be=C.createEl("option",{value:(G+1).toString(),text:j});(this.byMonth.length>0&&this.byMonth[0]===G+1||this.byMonth.length===0&&G+1===new Date().getMonth()+1)&&(Be.selected=!0)});let O=M.createEl("select");O.style.marginLeft="4px",O.style.marginRight="4px";for(let j=1;j<=31;j++){let G=O.createEl("option",{value:j.toString(),text:j.toString()});(this.byMonthDay.length>0&&this.byMonthDay[0]===j||this.byMonthDay.length===0&&j===new Date().getDate())&&(G.selected=!0)}M.createSpan({text:" each year"});let F=D.createEl("label",{cls:"radio-option"});F.style.display="block",F.style.marginBottom="8px";let P=F.createEl("input",{type:"radio",value:"byday"});P.name="yearly-type",P.checked=this.byDay.length>0&&this.bySetPos!==void 0,F.createSpan({text:" On the "});let x=F.createEl("select");x.style.marginLeft="4px",x.style.marginRight="4px",p.forEach(j=>{let G=x.createEl("option",{value:j.value,text:j.text});(this.bySetPos===parseInt(j.value)||!this.bySetPos&&j.value==="1")&&(G.selected=!0)});let B=F.createEl("select");B.style.marginLeft="4px",B.style.marginRight="4px",g.forEach(j=>{let G=B.createEl("option",{value:j.value,text:j.text});(this.byDay.length>0&&this.byDay[0]===j.value||this.byDay.length===0&&j.value===T)&&(G.selected=!0)});let L=F.createEl("select");L.style.marginLeft="4px",L.style.marginRight="4px",S.forEach((j,G)=>{let Be=L.createEl("option",{value:(G+1).toString(),text:j});(this.byMonth.length>0&&this.byMonth[0]===G+1||this.byMonth.length===0&&G+1===new Date().getMonth()+1)&&(Be.selected=!0)}),F.createSpan({text:" each year"}),new cr.Setting(e).setName("End condition").setDesc("Choose when the recurrence should end");let H=e.createDiv("end-condition-container"),w=H.createEl("label",{cls:"radio-option"});w.style.display="block",w.style.marginBottom="8px";let R=w.createEl("input",{type:"radio",value:"never"});R.name="end-type",R.checked=this.endType==="never",w.createSpan({text:" Never ends"});let U=H.createEl("label",{cls:"radio-option"});U.style.display="block",U.style.marginBottom="8px";let Y=U.createEl("input",{type:"radio",value:"count"});Y.name="end-type",Y.checked=this.endType==="count",U.createSpan({text:" End after "});let te=U.createEl("input",{type:"number",placeholder:"10"});te.style.width="60px",te.style.marginLeft="4px",te.style.marginRight="4px",te.value=this.count?this.count.toString():"",U.createSpan({text:" occurrences"});let re=H.createEl("label",{cls:"radio-option"});re.style.display="block",re.style.marginBottom="8px";let ge=re.createEl("input",{type:"radio",value:"until"});ge.name="end-type",ge.checked=this.endType==="until",re.createSpan({text:" End on "});let Le=re.createEl("input",{type:"date"});Le.style.marginLeft="4px",Le.value=this.until?this.until.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"):"",R.addEventListener("change",()=>{R.checked&&(this.endType="never")}),Y.addEventListener("change",()=>{Y.checked&&(this.endType="count")}),ge.addEventListener("change",()=>{ge.checked&&(this.endType="until")}),te.addEventListener("input",()=>{this.count=parseInt(te.value)||void 0,te.value&&(Y.checked=!0,this.endType="count")}),Le.addEventListener("input",()=>{this.until=Le.value?Le.value.replace(/-/g,""):"",Le.value&&(ge.checked=!0,this.endType="until")}),this.updateFrequencySpecificVisibility=()=>{r.settingEl.style.display=this.frequency==="WEEKLY"?"flex":"none",a.settingEl.style.display=this.frequency==="MONTHLY"?"flex":"none",k.settingEl.style.display=this.frequency==="YEARLY"?"flex":"none"},this.updateFrequencySpecificVisibility();let Ie=e.createDiv("button-container");Ie.style.display="flex",Ie.style.justifyContent="flex-end",Ie.style.gap="8px",Ie.style.marginTop="16px",Ie.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),Ie.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",()=>{let j=c.checked?"bydate":"byday",G=E.checked?"bydate":"byday";this.frequency==="MONTHLY"?j==="bydate"?(this.byMonthDay=[parseInt(d.value)],this.byDay=[],this.bySetPos=void 0):(this.byMonthDay=[],this.byDay=[m.value],this.bySetPos=parseInt(f.value)):this.frequency==="YEARLY"&&(G==="bydate"?(this.byMonth=[parseInt(C.value)],this.byMonthDay=[parseInt(O.value)],this.byDay=[],this.bySetPos=void 0):(this.byMonth=[parseInt(L.value)],this.byMonthDay=[],this.byDay=[B.value],this.bySetPos=parseInt(x.value)));let Be=this.buildRRule(j,G);this.onSubmit(Be),this.close()})}updateFrequencySpecificVisibility(){}buildRRule(e,r){let i=[`FREQ=${this.frequency}`];switch(this.interval>1&&i.push(`INTERVAL=${this.interval}`),this.frequency){case"WEEKLY":this.byDay.length>0&&i.push(`BYDAY=${this.byDay.join(",")}`);break;case"MONTHLY":if(e==="bydate"){let s=this.byMonthDay.length>0?this.byMonthDay[0]:new Date().getDate();i.push(`BYMONTHDAY=${s}`)}else if(e==="byday"&&this.byDay.length>0){let s=this.bySetPos||1;i.push(`BYDAY=${s}${this.byDay[0]}`)}break;case"YEARLY":if(r==="bydate"){let s=this.byMonth.length>0?this.byMonth[0]:new Date().getMonth()+1,a=this.byMonthDay.length>0?this.byMonthDay[0]:new Date().getDate();i.push(`BYMONTH=${s}`),i.push(`BYMONTHDAY=${a}`)}else if(r==="byday"){let s=this.byMonth.length>0?this.byMonth[0]:new Date().getMonth()+1;if(i.push(`BYMONTH=${s}`),this.byDay.length>0){let a=this.bySetPos||1;i.push(`BYDAY=${a}${this.byDay[0]}`)}}break}switch(this.endType){case"count":this.count&&this.count>0&&i.push(`COUNT=${this.count}`);break;case"until":if(this.until){let s=this.until.replace(/-/g,"");i.push(`UNTIL=${s}`)}break}return i.join(";")}onClose(){let{contentEl:e}=this;e.empty()}}});var db=vl((Dp,Sp)=>{(function(n,t){typeof Dp=="object"&&typeof Sp!="undefined"?Sp.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis!="undefined"?globalThis:n||self).dayjs_plugin_quarterOfYear=t()})(Dp,function(){"use strict";var n="month",t="quarter";return function(e,r){var i=r.prototype;i.quarter=function(o){return this.$utils().u(o)?Math.ceil((this.month()+1)/3):this.month(this.month()%3+3*(o-1))};var s=i.add;i.add=function(o,l){return o=Number(o),this.$utils().p(l)===t?this.add(3*o,n):s.bind(this)(o,l)};var a=i.startOf;i.startOf=function(o,l){var c=this.$utils(),d=!!c.u(l)||l;if(c.p(o)===t){var u=this.quarter()-1;return d?this.month(3*u).startOf(n).startOf("day"):this.month(3*u+2).endOf(n).endOf("day")}return a.bind(this)(o,l)}}})});var Ui=vl((Cp,xp)=>{(function(n,t){typeof Cp=="object"&&typeof xp!="undefined"?xp.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis!="undefined"?globalThis:n||self).dayjs=t()})(Cp,function(){"use strict";var n=1e3,t=6e4,e=36e5,r="millisecond",i="second",s="minute",a="hour",o="day",l="week",c="month",d="quarter",u="year",h="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(x){var B=["th","st","nd","rd"],L=x%100;return"["+x+(B[(L-20)%10]||B[L]||B[0])+"]"}},v=function(x,B,L){var H=String(x);return!H||H.length>=B?x:""+Array(B+1-H.length).join(L)+x},T={s:v,z:function(x){var B=-x.utcOffset(),L=Math.abs(B),H=Math.floor(L/60),w=L%60;return(B<=0?"+":"-")+v(H,2,"0")+":"+v(w,2,"0")},m:function x(B,L){if(B.date()<L.date())return-x(L,B);var H=12*(L.year()-B.year())+(L.month()-B.month()),w=B.clone().add(H,c),R=L-w<0,U=B.clone().add(H+(R?-1:1),c);return+(-(H+(L-w)/(R?w-U:U-w))||0)},a:function(x){return x<0?Math.ceil(x)||0:Math.floor(x)},p:function(x){return{M:c,y:u,w:l,d:o,D:h,h:a,m:s,s:i,ms:r,Q:d}[x]||String(x||"").toLowerCase().replace(/s$/,"")},u:function(x){return x===void 0}},k="en",D={};D[k]=g;var M="$isDayjsObject",E=function(x){return x instanceof F||!(!x||!x[M])},C=function x(B,L,H){var w;if(!B)return k;if(typeof B=="string"){var R=B.toLowerCase();D[R]&&(w=R),L&&(D[R]=L,w=R);var U=B.split("-");if(!w&&U.length>1)return x(U[0])}else{var Y=B.name;D[Y]=B,w=Y}return!H&&w&&(k=w),w||!H&&k},S=function(x,B){if(E(x))return x.clone();var L=typeof B=="object"?B:{};return L.date=x,L.args=arguments,new F(L)},O=T;O.l=C,O.i=E,O.w=function(x,B){return S(x,{locale:B.$L,utc:B.$u,x:B.$x,$offset:B.$offset})};var F=function(){function x(L){this.$L=C(L.locale,null,!0),this.parse(L),this.$x=this.$x||L.x||{},this[M]=!0}var B=x.prototype;return B.parse=function(L){this.$d=function(H){var w=H.date,R=H.utc;if(w===null)return new Date(NaN);if(O.u(w))return new Date;if(w instanceof Date)return new Date(w);if(typeof w=="string"&&!/Z$/i.test(w)){var U=w.match(p);if(U){var Y=U[2]-1||0,te=(U[7]||"0").substring(0,3);return R?new Date(Date.UTC(U[1],Y,U[3]||1,U[4]||0,U[5]||0,U[6]||0,te)):new Date(U[1],Y,U[3]||1,U[4]||0,U[5]||0,U[6]||0,te)}}return new Date(w)}(L),this.init()},B.init=function(){var L=this.$d;this.$y=L.getFullYear(),this.$M=L.getMonth(),this.$D=L.getDate(),this.$W=L.getDay(),this.$H=L.getHours(),this.$m=L.getMinutes(),this.$s=L.getSeconds(),this.$ms=L.getMilliseconds()},B.$utils=function(){return O},B.isValid=function(){return this.$d.toString()!==f},B.isSame=function(L,H){var w=S(L);return this.startOf(H)<=w&&w<=this.endOf(H)},B.isAfter=function(L,H){return S(L)<this.startOf(H)},B.isBefore=function(L,H){return this.endOf(H)<S(L)},B.$g=function(L,H,w){return O.u(L)?this[H]:this.set(w,L)},B.unix=function(){return Math.floor(this.valueOf()/1e3)},B.valueOf=function(){return this.$d.getTime()},B.startOf=function(L,H){var w=this,R=!!O.u(H)||H,U=O.p(L),Y=function(j,G){var Be=O.w(w.$u?Date.UTC(w.$y,G,j):new Date(w.$y,G,j),w);return R?Be:Be.endOf(o)},te=function(j,G){return O.w(w.toDate()[j].apply(w.toDate("s"),(R?[0,0,0,0]:[23,59,59,999]).slice(G)),w)},re=this.$W,ge=this.$M,Le=this.$D,Ie="set"+(this.$u?"UTC":"");switch(U){case u:return R?Y(1,0):Y(31,11);case c:return R?Y(1,ge):Y(0,ge+1);case l:var tt=this.$locale().weekStart||0,At=(re<tt?re+7:re)-tt;return Y(R?Le-At:Le+(6-At),ge);case o:case h:return te(Ie+"Hours",0);case a:return te(Ie+"Minutes",1);case s:return te(Ie+"Seconds",2);case i:return te(Ie+"Milliseconds",3);default:return this.clone()}},B.endOf=function(L){return this.startOf(L,!1)},B.$set=function(L,H){var w,R=O.p(L),U="set"+(this.$u?"UTC":""),Y=(w={},w[o]=U+"Date",w[h]=U+"Date",w[c]=U+"Month",w[u]=U+"FullYear",w[a]=U+"Hours",w[s]=U+"Minutes",w[i]=U+"Seconds",w[r]=U+"Milliseconds",w)[R],te=R===o?this.$D+(H-this.$W):H;if(R===c||R===u){var re=this.clone().set(h,1);re.$d[Y](te),re.init(),this.$d=re.set(h,Math.min(this.$D,re.daysInMonth())).$d}else Y&&this.$d[Y](te);return this.init(),this},B.set=function(L,H){return this.clone().$set(L,H)},B.get=function(L){return this[O.p(L)]()},B.add=function(L,H){var w,R=this;L=Number(L);var U=O.p(H),Y=function(ge){var Le=S(R);return O.w(Le.date(Le.date()+Math.round(ge*L)),R)};if(U===c)return this.set(c,this.$M+L);if(U===u)return this.set(u,this.$y+L);if(U===o)return Y(1);if(U===l)return Y(7);var te=(w={},w[s]=t,w[a]=e,w[i]=n,w)[U]||1,re=this.$d.getTime()+L*te;return O.w(re,this)},B.subtract=function(L,H){return this.add(-1*L,H)},B.format=function(L){var H=this,w=this.$locale();if(!this.isValid())return w.invalidDate||f;var R=L||"YYYY-MM-DDTHH:mm:ssZ",U=O.z(this),Y=this.$H,te=this.$m,re=this.$M,ge=w.weekdays,Le=w.months,Ie=w.meridiem,tt=function(G,Be,un,yl){return G&&(G[Be]||G(H,R))||un[Be].slice(0,yl)},At=function(G){return O.s(Y%12||12,G,"0")},j=Ie||function(G,Be,un){var yl=G<12?"AM":"PM";return un?yl.toLowerCase():yl};return R.replace(m,function(G,Be){return Be||function(un){switch(un){case"YY":return String(H.$y).slice(-2);case"YYYY":return O.s(H.$y,4,"0");case"M":return re+1;case"MM":return O.s(re+1,2,"0");case"MMM":return tt(w.monthsShort,re,Le,3);case"MMMM":return tt(Le,re);case"D":return H.$D;case"DD":return O.s(H.$D,2,"0");case"d":return String(H.$W);case"dd":return tt(w.weekdaysMin,H.$W,ge,2);case"ddd":return tt(w.weekdaysShort,H.$W,ge,3);case"dddd":return ge[H.$W];case"H":return String(Y);case"HH":return O.s(Y,2,"0");case"h":return At(1);case"hh":return At(2);case"a":return j(Y,te,!0);case"A":return j(Y,te,!1);case"m":return String(te);case"mm":return O.s(te,2,"0");case"s":return String(H.$s);case"ss":return O.s(H.$s,2,"0");case"SSS":return O.s(H.$ms,3,"0");case"Z":return U}return null}(G)||U.replace(":","")})},B.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},B.diff=function(L,H,w){var R,U=this,Y=O.p(H),te=S(L),re=(te.utcOffset()-this.utcOffset())*t,ge=this-te,Le=function(){return O.m(U,te)};switch(Y){case u:R=Le()/12;break;case c:R=Le();break;case d:R=Le()/3;break;case l:R=(ge-re)/6048e5;break;case o:R=(ge-re)/864e5;break;case a:R=ge/e;break;case s:R=ge/t;break;case i:R=ge/n;break;default:R=ge}return w?R:O.a(R)},B.daysInMonth=function(){return this.endOf(c).$D},B.$locale=function(){return D[this.$L]},B.locale=function(L,H){if(!L)return this.$L;var w=this.clone(),R=C(L,H,!0);return R&&(w.$L=R),w},B.clone=function(){return O.w(this.$d,this)},B.toDate=function(){return new Date(this.valueOf())},B.toJSON=function(){return this.isValid()?this.toISOString():null},B.toISOString=function(){return this.$d.toISOString()},B.toString=function(){return this.$d.toUTCString()},x}(),P=F.prototype;return S.prototype=P,[["$ms",r],["$s",i],["$m",s],["$H",a],["$W",o],["$M",c],["$y",u],["$D",h]].forEach(function(x){P[x[1]]=function(B){return this.$g(B,x[0],x[1])}}),S.extend=function(x,B){return x.$i||(x(B,F,S),x.$i=!0),S},S.locale=C,S.isDayjs=E,S.unix=function(x){return S(1e3*x)},S.en=D[k],S.Ls=D,S.p={},S})});var ie,_e,Ft,Mr=_(()=>{(function(n){n[n.AM=0]="AM",n[n.PM=1]="PM"})(ie||(ie={}));(function(n){n[n.SUNDAY=0]="SUNDAY",n[n.MONDAY=1]="MONDAY",n[n.TUESDAY=2]="TUESDAY",n[n.WEDNESDAY=3]="WEDNESDAY",n[n.THURSDAY=4]="THURSDAY",n[n.FRIDAY=5]="FRIDAY",n[n.SATURDAY=6]="SATURDAY"})(_e||(_e={}));(function(n){n[n.JANUARY=1]="JANUARY",n[n.FEBRUARY=2]="FEBRUARY",n[n.MARCH=3]="MARCH",n[n.APRIL=4]="APRIL",n[n.MAY=5]="MAY",n[n.JUNE=6]="JUNE",n[n.JULY=7]="JULY",n[n.AUGUST=8]="AUGUST",n[n.SEPTEMBER=9]="SEPTEMBER",n[n.OCTOBER=10]="OCTOBER",n[n.NOVEMBER=11]="NOVEMBER",n[n.DECEMBER=12]="DECEMBER"})(Ft||(Ft={}))});function ub(n,t){n.assign("day",t.getDate()),n.assign("month",t.getMonth()+1),n.assign("year",t.getFullYear())}function hb(n,t){n.assign("hour",t.getHours()),n.assign("minute",t.getMinutes()),n.assign("second",t.getSeconds()),n.assign("millisecond",t.getMilliseconds()),n.assign("meridiem",t.getHours()<12?ie.AM:ie.PM)}function gd(n,t){n.imply("day",t.getDate()),n.imply("month",t.getMonth()+1),n.imply("year",t.getFullYear())}function fb(n,t){n.imply("hour",t.getHours()),n.imply("minute",t.getMinutes()),n.imply("second",t.getSeconds()),n.imply("millisecond",t.getMilliseconds()),n.imply("meridiem",t.getHours()<12?ie.AM:ie.PM)}var _p=_(()=>{Mr()});function Vi(n,t,e,r,i=0){let s=0,a=0;for(;a<r;)s++,new Date(n,t-1,s).getDay()===e&&a++;return new Date(n,t-1,s,i)}function pb(n,t,e,r=0){let i=e===0?7:e,s=new Date(n,t-1+1,1,12),a=s.getDay()===0?7:s.getDay(),o;return a===i?o=7:a<i?o=7+a-i:o=a-i,s.setDate(s.getDate()-o),new Date(n,t-1,s.getDate(),r)}function yd(n,t,e={}){var i;if(n==null)return null;if(typeof n=="number")return n;let r=(i=e[n])!=null?i:PM[n];return r==null?null:typeof r=="number"?r:t==null?null:(0,Mp.default)(t).isAfter(r.dstStart(t.getFullYear()))&&!(0,Mp.default)(t).isAfter(r.dstEnd(t.getFullYear()))?r.timezoneOffsetDuringDst:r.timezoneOffsetNonDst}var Mp,PM,Ap=_(()=>{Mp=Ve(Ui(),1);Mr();PM={ACDT:630,ACST:570,ADT:-180,AEDT:660,AEST:600,AFT:270,AKDT:-480,AKST:-540,ALMT:360,AMST:-180,AMT:-240,ANAST:720,ANAT:720,AQTT:300,ART:-180,AST:-240,AWDT:540,AWST:480,AZOST:0,AZOT:-60,AZST:300,AZT:240,BNT:480,BOT:-240,BRST:-120,BRT:-180,BST:60,BTT:360,CAST:480,CAT:120,CCT:390,CDT:-300,CEST:120,CET:{timezoneOffsetDuringDst:2*60,timezoneOffsetNonDst:60,dstStart:n=>pb(n,Ft.MARCH,_e.SUNDAY,2),dstEnd:n=>pb(n,Ft.OCTOBER,_e.SUNDAY,3)},CHADT:825,CHAST:765,CKT:-600,CLST:-180,CLT:-240,COT:-300,CST:-360,CT:{timezoneOffsetDuringDst:-5*60,timezoneOffsetNonDst:-6*60,dstStart:n=>Vi(n,Ft.MARCH,_e.SUNDAY,2,2),dstEnd:n=>Vi(n,Ft.NOVEMBER,_e.SUNDAY,1,2)},CVT:-60,CXT:420,ChST:600,DAVT:420,EASST:-300,EAST:-360,EAT:180,ECT:-300,EDT:-240,EEST:180,EET:120,EGST:0,EGT:-60,EST:-300,ET:{timezoneOffsetDuringDst:-4*60,timezoneOffsetNonDst:-5*60,dstStart:n=>Vi(n,Ft.MARCH,_e.SUNDAY,2,2),dstEnd:n=>Vi(n,Ft.NOVEMBER,_e.SUNDAY,1,2)},FJST:780,FJT:720,FKST:-180,FKT:-240,FNT:-120,GALT:-360,GAMT:-540,GET:240,GFT:-180,GILT:720,GMT:0,GST:240,GYT:-240,HAA:-180,HAC:-300,HADT:-540,HAE:-240,HAP:-420,HAR:-360,HAST:-600,HAT:-90,HAY:-480,HKT:480,HLV:-210,HNA:-240,HNC:-360,HNE:-300,HNP:-480,HNR:-420,HNT:-150,HNY:-540,HOVT:420,ICT:420,IDT:180,IOT:360,IRDT:270,IRKST:540,IRKT:540,IRST:210,IST:330,JST:540,KGT:360,KRAST:480,KRAT:480,KST:540,KUYT:240,LHDT:660,LHST:630,LINT:840,MAGST:720,MAGT:720,MART:-510,MAWT:300,MDT:-360,MESZ:120,MEZ:60,MHT:720,MMT:390,MSD:240,MSK:180,MST:-420,MT:{timezoneOffsetDuringDst:-6*60,timezoneOffsetNonDst:-7*60,dstStart:n=>Vi(n,Ft.MARCH,_e.SUNDAY,2,2),dstEnd:n=>Vi(n,Ft.NOVEMBER,_e.SUNDAY,1,2)},MUT:240,MVT:300,MYT:480,NCT:660,NDT:-90,NFT:690,NOVST:420,NOVT:360,NPT:345,NST:-150,NUT:-660,NZDT:780,NZST:720,OMSST:420,OMST:420,PDT:-420,PET:-300,PETST:720,PETT:720,PGT:600,PHOT:780,PHT:480,PKT:300,PMDT:-120,PMST:-180,PONT:660,PST:-480,PT:{timezoneOffsetDuringDst:-7*60,timezoneOffsetNonDst:-8*60,dstStart:n=>Vi(n,Ft.MARCH,_e.SUNDAY,2,2),dstEnd:n=>Vi(n,Ft.NOVEMBER,_e.SUNDAY,1,2)},PWT:540,PYST:-180,PYT:-240,RET:240,SAMT:240,SAST:120,SBT:660,SCT:240,SGT:480,SRT:-180,SST:-660,TAHT:-600,TFT:300,TJT:300,TKT:780,TLT:540,TMT:300,TVT:720,ULAT:480,UTC:0,UYST:-120,UYT:-180,UZT:300,VET:-210,VLAST:660,VLAT:660,VUT:660,WAST:120,WAT:60,WEST:60,WESZ:60,WET:0,WEZ:0,WFT:720,WGST:-120,WGT:-180,WIB:420,WIT:540,WITA:480,WST:780,WT:0,YAKST:600,YAKT:600,YAPT:600,YEKST:360,YEKT:360}});function mb(n,t){var r,i,s,a,o,l,c;let e=new Date(n);if(t.y&&(t.year=t.y,delete t.y),t.mo&&(t.month=t.mo,delete t.mo),t.M&&(t.month=t.M,delete t.M),t.w&&(t.week=t.w,delete t.w),t.d&&(t.day=t.d,delete t.d),t.h&&(t.hour=t.h,delete t.h),t.m&&(t.minute=t.m,delete t.m),t.s&&(t.second=t.s,delete t.s),t.ms&&(t.millisecond=t.ms,delete t.ms),"year"in t){let d=Math.floor(t.year);e.setFullYear(e.getFullYear()+d);let u=t.year-d;u>0&&(t.month=(r=t==null?void 0:t.month)!=null?r:0,t.month+=u*12)}if("quarter"in t){let d=Math.floor(t.quarter);e.setMonth(e.getMonth()+d*3)}if("month"in t){let d=Math.floor(t.month);e.setMonth(e.getMonth()+d);let u=t.month-d;u>0&&(t.week=(i=t==null?void 0:t.week)!=null?i:0,t.week+=u*4)}if("week"in t){let d=Math.floor(t.week);e.setDate(e.getDate()+d*7);let u=t.week-d;u>0&&(t.day=(s=t==null?void 0:t.day)!=null?s:0,t.day+=Math.round(u*7))}if("day"in t){let d=Math.floor(t.day);e.setDate(e.getDate()+d);let u=t.day-d;u>0&&(t.hour=(a=t==null?void 0:t.hour)!=null?a:0,t.hour+=Math.round(u*24))}if("hour"in t){let d=Math.floor(t.hour);e.setHours(e.getHours()+d);let u=t.hour-d;u>0&&(t.minute=(o=t==null?void 0:t.minute)!=null?o:0,t.minute+=Math.round(u*60))}if("minute"in t){let d=Math.floor(t.minute);e.setMinutes(e.getMinutes()+d);let u=t.minute-d;u>0&&(t.second=(l=t==null?void 0:t.second)!=null?l:0,t.second+=Math.round(u*60))}if("second"in t){let d=Math.floor(t.second);e.setSeconds(e.getSeconds()+d);let u=t.second-d;u>0&&(t.millisecond=(c=t==null?void 0:t.millisecond)!=null?c:0,t.millisecond+=Math.round(u*1e3))}if("millisecond"in t){let d=Math.floor(t.millisecond);e.setMilliseconds(e.getMilliseconds()+d)}return e}function Us(n){let t={};for(let e in n)t[e]=-n[e];return t}var Mo=_(()=>{});var gb,Ip,Wi,oe,dr,ur=_(()=>{gb=Ve(db(),1),Ip=Ve(Ui(),1);_p();Ap();Mo();Ip.default.extend(gb.default);Wi=class{constructor(t){Q(this,"instant");Q(this,"timezoneOffset");var e;t=t!=null?t:new Date,t instanceof Date?(this.instant=t,this.timezoneOffset=null):(this.instant=(e=t.instant)!=null?e:new Date,this.timezoneOffset=yd(t.timezone,this.instant))}getDateWithAdjustedTimezone(){let t=new Date(this.instant);return this.timezoneOffset!==null&&t.setMinutes(t.getMinutes()-this.getSystemTimezoneAdjustmentMinute(this.instant)),t}getSystemTimezoneAdjustmentMinute(t,e){var s;(!t||t.getTime()<0)&&(t=new Date);let r=-t.getTimezoneOffset(),i=(s=e!=null?e:this.timezoneOffset)!=null?s:r;return r-i}getTimezoneOffset(){var t;return(t=this.timezoneOffset)!=null?t:-this.instant.getTimezoneOffset()}},oe=class{constructor(t,e){Q(this,"knownValues");Q(this,"impliedValues");Q(this,"reference");Q(this,"_tags",new Set);if(this.reference=t,this.knownValues={},this.impliedValues={},e)for(let i in e)this.knownValues[i]=e[i];let r=t.getDateWithAdjustedTimezone();this.imply("day",r.getDate()),this.imply("month",r.getMonth()+1),this.imply("year",r.getFullYear()),this.imply("hour",12),this.imply("minute",0),this.imply("second",0),this.imply("millisecond",0)}get(t){return t in this.knownValues?this.knownValues[t]:t in this.impliedValues?this.impliedValues[t]:null}isCertain(t){return t in this.knownValues}getCertainComponents(){return Object.keys(this.knownValues)}imply(t,e){return t in this.knownValues?this:(this.impliedValues[t]=e,this)}assign(t,e){return this.knownValues[t]=e,delete this.impliedValues[t],this}delete(t){delete this.knownValues[t],delete this.impliedValues[t]}clone(){let t=new oe(this.reference);t.knownValues={},t.impliedValues={};for(let e in this.knownValues)t.knownValues[e]=this.knownValues[e];for(let e in this.impliedValues)t.impliedValues[e]=this.impliedValues[e];return t}isOnlyDate(){return!this.isCertain("hour")&&!this.isCertain("minute")&&!this.isCertain("second")}isOnlyTime(){return!this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")&&!this.isCertain("year")}isOnlyWeekdayComponent(){return this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")}isDateWithUnknownYear(){return this.isCertain("month")&&!this.isCertain("year")}isValidDate(){let t=this.dateWithoutTimezoneAdjustment();return!(t.getFullYear()!==this.get("year")||t.getMonth()!==this.get("month")-1||t.getDate()!==this.get("day")||this.get("hour")!=null&&t.getHours()!=this.get("hour")||this.get("minute")!=null&&t.getMinutes()!=this.get("minute"))}toString(){return`[ParsingComponents {
            tags: ${JSON.stringify(Array.from(this._tags).sort())}, 
            knownValues: ${JSON.stringify(this.knownValues)}, 
            impliedValues: ${JSON.stringify(this.impliedValues)}}, 
            reference: ${JSON.stringify(this.reference)}]`}dayjs(){return(0,Ip.default)(this.dateWithoutTimezoneAdjustment())}date(){let t=this.dateWithoutTimezoneAdjustment(),e=this.reference.getSystemTimezoneAdjustmentMinute(t,this.get("timezoneOffset"));return new Date(t.getTime()+e*6e4)}addTag(t){return this._tags.add(t),this}addTags(t){for(let e of t)this._tags.add(e);return this}tags(){return new Set(this._tags)}dateWithoutTimezoneAdjustment(){let t=new Date(this.get("year"),this.get("month")-1,this.get("day"),this.get("hour"),this.get("minute"),this.get("second"),this.get("millisecond"));return t.setFullYear(this.get("year")),t}static createRelativeFromReference(t,e){let r=mb(t.getDateWithAdjustedTimezone(),e),i=new oe(t);return i.addTag("result/relativeDate"),e.hour||e.minute||e.second?(i.addTag("result/relativeDateAndTime"),hb(i,r),ub(i,r),i.assign("timezoneOffset",t.getTimezoneOffset())):(fb(i,r),i.imply("timezoneOffset",t.getTimezoneOffset()),e.day?(i.assign("day",r.getDate()),i.assign("month",r.getMonth()+1),i.assign("year",r.getFullYear()),i.assign("weekday",r.getDay())):e.week?(i.assign("day",r.getDate()),i.assign("month",r.getMonth()+1),i.assign("year",r.getFullYear()),i.imply("weekday",r.getDay())):(i.imply("day",r.getDate()),e.month?(i.assign("month",r.getMonth()+1),i.assign("year",r.getFullYear())):(i.imply("month",r.getMonth()+1),e.year?i.assign("year",r.getFullYear()):i.imply("year",r.getFullYear())))),i}},dr=class{constructor(t,e,r,i,s){Q(this,"refDate");Q(this,"index");Q(this,"text");Q(this,"reference");Q(this,"start");Q(this,"end");this.reference=t,this.refDate=t.instant,this.index=e,this.text=r,this.start=i||new oe(t),this.end=s}clone(){let t=new dr(this.reference,this.index,this.text);return t.start=this.start?this.start.clone():null,t.end=this.end?this.end.clone():null,t}date(){return this.start.date()}addTag(t){return this.start.addTag(t),this.end&&this.end.addTag(t),this}addTags(t){return this.start.addTags(t),this.end&&this.end.addTags(t),this}tags(){let t=new Set(this.start.tags());if(this.end)for(let e of this.end.tags())t.add(e);return t}toString(){let t=Array.from(this.tags()).sort();return`[ParsingResult {index: ${this.index}, text: '${this.text}', tags: ${JSON.stringify(t)} ...}]`}}});function Pp(n,t,e="\\s{0,5},?\\s{0,5}"){let r=t.replace(/\((?!\?)/g,"(?:");return`${n}${r}(?:${e}${r}){0,10}`}function NM(n){let t;return n instanceof Array?t=[...n]:n instanceof Map?t=Array.from(n.keys()):t=Object.keys(n),t}function lt(n){return`(?:${NM(n).sort((e,r)=>r.length-e.length).join("|").replace(/\./g,"\\.")})`}var ji=_(()=>{});function vd(n){return n<100&&(n>50?n=n+1900:n=n+2e3),n}function $i(n,t,e){let r=(0,yb.default)(n),i=r;i=i.month(e-1),i=i.date(t),i=i.year(r.year());let s=i.add(1,"y"),a=i.add(-1,"y");return Math.abs(s.diff(r))<Math.abs(i.diff(r))?i=s:Math.abs(a.diff(r))<Math.abs(i.diff(r))&&(i=a),i.year()}var yb,Vs=_(()=>{yb=Ve(Ui(),1)});function OM(n){let t=n.toLowerCase();return Np[t]!==void 0?Np[t]:t==="a"||t==="an"||t=="the"?1:t.match(/few/)?3:t.match(/half/)?.5:t.match(/couple/)?2:t.match(/several/)?7:parseFloat(t)}function js(n){let t=n.toLowerCase();return Op[t]!==void 0?Op[t]:(t=t.replace(/(?:st|nd|rd|th)$/i,""),parseInt(t))}function qi(n){if(/BE/i.test(n))return n=n.replace(/BE/i,""),parseInt(n)-543;if(/BCE?/i.test(n))return n=n.replace(/BCE?/i,""),-parseInt(n);if(/(AD|CE)/i.test(n))return n=n.replace(/(AD|CE)/i,""),parseInt(n);let t=parseInt(n);return vd(t)}function Zt(n){let t={},e=n,r=vb.exec(e);for(;r;)LM(t,r),e=e.substring(r[0].length).trim(),r=vb.exec(e);return Object.keys(t).length==0?null:t}function LM(n,t){if(t[0].match(/^[a-zA-Z]+$/))return;let e=OM(t[1]),r=Ao[t[2].toLowerCase()];n[r]=e}var wd,Rp,Kt,Np,Op,wb,Ao,bb,Ws,zi,Tb,vb,RM,Eb,li,Gi,Qe=_(()=>{ji();Vs();wd={sunday:0,sun:0,"sun.":0,monday:1,mon:1,"mon.":1,tuesday:2,tue:2,"tue.":2,wednesday:3,wed:3,"wed.":3,thursday:4,thurs:4,"thurs.":4,thur:4,"thur.":4,thu:4,"thu.":4,friday:5,fri:5,"fri.":5,saturday:6,sat:6,"sat.":6},Rp={january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12},Kt={...Rp,jan:1,"jan.":1,feb:2,"feb.":2,mar:3,"mar.":3,apr:4,"apr.":4,jun:6,"jun.":6,jul:7,"jul.":7,aug:8,"aug.":8,sep:9,"sep.":9,sept:9,"sept.":9,oct:10,"oct.":10,nov:11,"nov.":11,dec:12,"dec.":12},Np={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12},Op={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,twentieth:20,"twenty first":21,"twenty-first":21,"twenty second":22,"twenty-second":22,"twenty third":23,"twenty-third":23,"twenty fourth":24,"twenty-fourth":24,"twenty fifth":25,"twenty-fifth":25,"twenty sixth":26,"twenty-sixth":26,"twenty seventh":27,"twenty-seventh":27,"twenty eighth":28,"twenty-eighth":28,"twenty ninth":29,"twenty-ninth":29,thirtieth:30,"thirty first":31,"thirty-first":31},wb={second:"second",seconds:"second",minute:"minute",minutes:"minute",hour:"hour",hours:"hour",day:"d",days:"d",week:"week",weeks:"week",month:"month",months:"month",quarter:"quarter",quarters:"quarter",year:"year",years:"year"},Ao={s:"second",sec:"second",second:"second",seconds:"second",m:"minute",min:"minute",mins:"minute",minute:"minute",minutes:"minute",h:"hour",hr:"hour",hrs:"hour",hour:"hour",hours:"hour",d:"d",day:"d",days:"d",w:"w",week:"week",weeks:"week",mo:"month",mon:"month",mos:"month",month:"month",months:"month",qtr:"quarter",quarter:"quarter",quarters:"quarter",y:"year",yr:"year",year:"year",years:"year",...wb},bb=`(?:${lt(Np)}|[0-9]+|[0-9]+\\.[0-9]+|half(?:\\s{0,2}an?)?|an?\\b(?:\\s{0,2}few)?|few|several|the|a?\\s{0,2}couple\\s{0,2}(?:of)?)`;Ws=`(?:${lt(Op)}|[0-9]{1,2}(?:st|nd|rd|th)?)`;zi="(?:[1-9][0-9]{0,3}\\s{0,2}(?:BE|AD|BC|BCE|CE)|[1-2][0-9]{3}|[5-9][0-9]|2[0-5])";Tb=`(${bb})\\s{0,3}(${lt(Ao)})`,vb=new RegExp(Tb,"i"),RM=`(${bb})\\s{0,3}(${lt(wb)})`,Eb="\\s{0,5},?(?:\\s*and)?\\s{0,5}",li=Pp("(?:(?:about|around)\\s{0,3})?",Tb,Eb),Gi=Pp("(?:(?:about|around)\\s{0,3})?",RM,Eb)});var Se,bt=_(()=>{Se=class{constructor(){Q(this,"cachedInnerPattern",null);Q(this,"cachedPattern",null)}innerPatternHasChange(t,e){return this.innerPattern(t)!==e}patternLeftBoundary(){return"(\\W|^)"}pattern(t){return this.cachedInnerPattern&&!this.innerPatternHasChange(t,this.cachedInnerPattern)?this.cachedPattern:(this.cachedInnerPattern=this.innerPattern(t),this.cachedPattern=new RegExp(`${this.patternLeftBoundary()}${this.cachedInnerPattern.source}`,this.cachedInnerPattern.flags),this.cachedPattern)}extract(t,e){var i;let r=(i=e[1])!=null?i:"";e.index=e.index+r.length,e[0]=e[0].substring(r.length);for(let s=2;s<e.length;s++)e[s-1]=e[s];return this.innerExtract(t,e)}}});var FM,BM,HM,Io,kb=_(()=>{Qe();ur();bt();FM=new RegExp(`(?:(?:within|in|for)\\s*)?(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${li})(?=\\W|$)`,"i"),BM=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${li})(?=\\W|$)`,"i"),HM=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${Gi})(?=\\W|$)`,"i"),Io=class extends Se{constructor(e){super();Q(this,"strictMode");this.strictMode=e}innerPattern(e){return this.strictMode?HM:e.option.forwardDate?FM:BM}innerExtract(e,r){if(r[0].match(/^for\s*the\s*\w+/))return null;let i=Zt(r[1]);return i?(e.debug(()=>{console.log(i),console.log(oe.createRelativeFromReference(e.reference,i))}),oe.createRelativeFromReference(e.reference,i)):null}}});var YM,Db,Sb,UM,Cb,Po,xb=_(()=>{Vs();Qe();Qe();Qe();ji();bt();YM=new RegExp(`(?:on\\s{0,3})?(${Ws})(?:\\s{0,3}(?:to|\\-|\\\u2013|until|through|till)?\\s{0,3}(${Ws}))?(?:-|/|\\s{0,3}(?:of)?\\s{0,3})(${lt(Kt)})(?:(?:-|/|,?\\s{0,3})(${zi}(?!\\w)))?(?=\\W|$)`,"i"),Db=1,Sb=2,UM=3,Cb=4,Po=class extends Se{innerPattern(){return YM}innerExtract(t,e){let r=t.createParsingResult(e.index,e[0]),i=Kt[e[UM].toLowerCase()],s=js(e[Db]);if(s>31)return e.index=e.index+e[Db].length,null;if(r.start.assign("month",i),r.start.assign("day",s),e[Cb]){let a=qi(e[Cb]);r.start.assign("year",a)}else{let a=$i(t.refDate,s,i);r.start.imply("year",a)}if(e[Sb]){let a=js(e[Sb]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var VM,WM,_b,Lp,Fp,No,Mb=_(()=>{Vs();Qe();Qe();Qe();ji();bt();VM=new RegExp(`(${lt(Kt)})(?:-|/|\\s*,?\\s*)(${Ws})(?!\\s*(?:am|pm))\\s*(?:(?:to|\\-)\\s*(${Ws})\\s*)?(?:(?:-|/|\\s*,\\s*|\\s+)(${zi}))?(?=\\W|$)(?!\\:\\d)`,"i"),WM=1,_b=2,Lp=3,Fp=4,No=class extends Se{constructor(e){super();Q(this,"shouldSkipYearLikeDate");this.shouldSkipYearLikeDate=e}innerPattern(){return VM}innerExtract(e,r){let i=Kt[r[WM].toLowerCase()],s=js(r[_b]);if(s>31||this.shouldSkipYearLikeDate&&!r[Lp]&&!r[Fp]&&r[_b].match(/^2[0-5]$/))return null;let a=e.createParsingComponents({day:s,month:i}).addTag("parser/ENMonthNameMiddleEndianParser");if(r[Fp]){let c=qi(r[Fp]);a.assign("year",c)}else{let c=$i(e.refDate,s,i);a.imply("year",c)}if(!r[Lp])return a;let o=js(r[Lp]),l=e.createParsingResult(r.index,r[0]);return l.start=a,l.end=a.clone(),l.end.assign("day",o),l}}});var jM,$M,zM,Ab,Oo,Ib=_(()=>{Qe();Vs();ji();Qe();bt();jM=new RegExp(`((?:in)\\s*)?(${lt(Kt)})\\s*(?:(?:,|-|of)?\\s*(${zi})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`,"i"),$M=1,zM=2,Ab=3,Oo=class extends Se{innerPattern(){return jM}innerExtract(t,e){let r=e[zM].toLowerCase();if(e[0].length<=3&&!Rp[r])return null;let i=t.createParsingResult(e.index+(e[$M]||"").length,e.index+e[0].length);i.start.imply("day",1),i.start.addTag("parser/ENMonthNameParser");let s=Kt[r];if(i.start.assign("month",s),e[Ab]){let a=qi(e[Ab]);i.start.assign("year",a)}else{let a=$i(t.refDate,1,s);i.start.imply("year",a)}return i}}});var qM,GM,QM,Pb,KM,Ro,Nb=_(()=>{Qe();ji();bt();qM=new RegExp(`([0-9]{4})[-\\.\\/\\s](?:(${lt(Kt)})|([0-9]{1,2}))[-\\.\\/\\s]([0-9]{1,2})(?=\\W|$)`,"i"),GM=1,QM=2,Pb=3,KM=4,Ro=class extends Se{constructor(e){super();Q(this,"strictMonthDateOrder");this.strictMonthDateOrder=e}innerPattern(){return qM}innerExtract(e,r){let i=parseInt(r[GM]),s=parseInt(r[KM]),a=r[Pb]?parseInt(r[Pb]):Kt[r[QM].toLowerCase()];if(a<1||a>12){if(this.strictMonthDateOrder)return null;s>=1&&s<=12&&([a,s]=[s,a])}return s<1||s>31?null:{day:s,month:a,year:i}}}});var ZM,JM,XM,Lo,Ob=_(()=>{bt();ZM=new RegExp("([0-9]|0[1-9]|1[012])/([0-9]{4})","i"),JM=1,XM=2,Lo=class extends Se{innerPattern(){return ZM}innerExtract(t,e){let r=parseInt(e[XM]),i=parseInt(e[JM]);return t.createParsingComponents().imply("day",1).assign("month",i).assign("year",r)}}});function e0(n,t,e,r){return new RegExp(`${n}${t}(\\d{1,4})(?:(?:\\.|:|\uFF1A)(\\d{1,2})(?:(?::|\uFF1A)(\\d{2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${e}`,r)}function t0(n,t){return new RegExp(`^(${n})(\\d{1,4})(?:(?:\\.|\\:|\\\uFF1A)(\\d{1,2})(?:(?:\\.|\\:|\\\uFF1A)(\\d{1,2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${t}`,"i")}var Rb,$s,bd,Td,Fo,Ed,Lb=_(()=>{Mr();Rb=2,$s=3,bd=4,Td=5,Fo=6,Ed=class{constructor(t=!1){Q(this,"strictMode");Q(this,"cachedPrimaryPrefix",null);Q(this,"cachedPrimarySuffix",null);Q(this,"cachedPrimaryTimePattern",null);Q(this,"cachedFollowingPhase",null);Q(this,"cachedFollowingSuffix",null);Q(this,"cachedFollowingTimePatten",null);this.strictMode=t}patternFlags(){return"i"}primaryPatternLeftBoundary(){return"(^|\\s|T|\\b)"}primarySuffix(){return"(?!/)(?=\\W|$)"}followingSuffix(){return"(?!/)(?=\\W|$)"}pattern(t){return this.getPrimaryTimePatternThroughCache()}extract(t,e){let r=this.extractPrimaryTimeComponents(t,e);if(!r)return e[0].match(/^\d{4}/)?(e.index+=4,null):(e.index+=e[0].length,null);let i=e.index+e[1].length,s=e[0].substring(e[1].length),a=t.createParsingResult(i,s,r);e.index+=e[0].length;let o=t.text.substring(e.index),c=this.getFollowingTimePatternThroughCache().exec(o);return s.match(/^\d{3,4}/)&&c&&(c[0].match(/^\s*([+-])\s*\d{2,4}$/)||c[0].match(/^\s*([+-])\s*\d{2}\W\d{2}/))?null:!c||c[0].match(/^\s*([+-])\s*\d{3,4}$/)?this.checkAndReturnWithoutFollowingPattern(a):(a.end=this.extractFollowingTimeComponents(t,c,a),a.end&&(a.text+=c[0]),this.checkAndReturnWithFollowingPattern(a))}extractPrimaryTimeComponents(t,e,r=!1){let i=t.createParsingComponents(),s=0,a=null,o=parseInt(e[Rb]);if(o>100){if(this.strictMode||e[$s]!=null)return null;s=o%100,o=Math.floor(o/100)}if(o>24)return null;if(e[$s]!=null){if(e[$s].length==1&&!e[Fo])return null;s=parseInt(e[$s])}if(s>=60)return null;if(o>12&&(a=ie.PM),e[Fo]!=null){if(o>12)return null;let l=e[Fo][0].toLowerCase();l=="a"&&(a=ie.AM,o==12&&(o=0)),l=="p"&&(a=ie.PM,o!=12&&(o+=12))}if(i.assign("hour",o),i.assign("minute",s),a!==null?i.assign("meridiem",a):o<12?i.imply("meridiem",ie.AM):i.imply("meridiem",ie.PM),e[Td]!=null){let l=parseInt(e[Td].substring(0,3));if(l>=1e3)return null;i.assign("millisecond",l)}if(e[bd]!=null){let l=parseInt(e[bd]);if(l>=60)return null;i.assign("second",l)}return i}extractFollowingTimeComponents(t,e,r){let i=t.createParsingComponents();if(e[Td]!=null){let l=parseInt(e[Td].substring(0,3));if(l>=1e3)return null;i.assign("millisecond",l)}if(e[bd]!=null){let l=parseInt(e[bd]);if(l>=60)return null;i.assign("second",l)}let s=parseInt(e[Rb]),a=0,o=-1;if(e[$s]!=null?a=parseInt(e[$s]):s>100&&(a=s%100,s=Math.floor(s/100)),a>=60||s>24)return null;if(s>=12&&(o=ie.PM),e[Fo]!=null){if(s>12)return null;let l=e[Fo][0].toLowerCase();l=="a"&&(o=ie.AM,s==12&&(s=0,i.isCertain("day")||i.imply("day",i.get("day")+1))),l=="p"&&(o=ie.PM,s!=12&&(s+=12)),r.start.isCertain("meridiem")||(o==ie.AM?(r.start.imply("meridiem",ie.AM),r.start.get("hour")==12&&r.start.assign("hour",0)):(r.start.imply("meridiem",ie.PM),r.start.get("hour")!=12&&r.start.assign("hour",r.start.get("hour")+12)))}return i.assign("hour",s),i.assign("minute",a),o>=0?i.assign("meridiem",o):r.start.isCertain("meridiem")&&r.start.get("hour")>12?r.start.get("hour")-12>s?i.imply("meridiem",ie.AM):s<=12&&(i.assign("hour",s+12),i.assign("meridiem",ie.PM)):s>12?i.imply("meridiem",ie.PM):s<=12&&i.imply("meridiem",ie.AM),i.date().getTime()<r.start.date().getTime()&&i.imply("day",i.get("day")+1),i}checkAndReturnWithoutFollowingPattern(t){if(t.text.match(/^\d$/)||t.text.match(/^\d\d\d+$/)||t.text.match(/\d[apAP]$/))return null;let e=t.text.match(/[^\d:.](\d[\d.]+)$/);if(e){let r=e[1];if(this.strictMode||r.includes(".")&&!r.match(/\d(\.\d{2})+$/)||parseInt(r)>24)return null}return t}checkAndReturnWithFollowingPattern(t){if(t.text.match(/^\d+-\d+$/))return null;let e=t.text.match(/[^\d:.](\d[\d.]+)\s*-\s*(\d[\d.]+)$/);if(e){if(this.strictMode)return null;let r=e[1],i=e[2];if(i.includes(".")&&!i.match(/\d(\.\d{2})+$/))return null;let s=parseInt(i),a=parseInt(r);if(s>24||a>24)return null}return t}getPrimaryTimePatternThroughCache(){let t=this.primaryPrefix(),e=this.primarySuffix();return this.cachedPrimaryPrefix===t&&this.cachedPrimarySuffix===e?this.cachedPrimaryTimePattern:(this.cachedPrimaryTimePattern=e0(this.primaryPatternLeftBoundary(),t,e,this.patternFlags()),this.cachedPrimaryPrefix=t,this.cachedPrimarySuffix=e,this.cachedPrimaryTimePattern)}getFollowingTimePatternThroughCache(){let t=this.followingPhase(),e=this.followingSuffix();return this.cachedFollowingPhase===t&&this.cachedFollowingSuffix===e?this.cachedFollowingTimePatten:(this.cachedFollowingTimePatten=t0(t,e),this.cachedFollowingPhase=t,this.cachedFollowingSuffix=e,this.cachedFollowingTimePatten)}}});var Bo,Fb=_(()=>{Mr();Lb();Bo=class extends Ed{constructor(t){super(t)}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|to|until|through|till|\\?)\\s*"}primaryPrefix(){return"(?:(?:at|from)\\s*)??"}primarySuffix(){return"(?:\\s*(?:o\\W*clock|at\\s*night|in\\s*the\\s*(?:morning|afternoon)))?(?!/)(?=\\W|$)"}extractPrimaryTimeComponents(t,e){let r=super.extractPrimaryTimeComponents(t,e);if(!r)return r;if(e[0].endsWith("night")){let i=r.get("hour");i>=6&&i<12?(r.assign("hour",r.get("hour")+12),r.assign("meridiem",ie.PM)):i<6&&r.assign("meridiem",ie.AM)}if(e[0].endsWith("afternoon")){r.assign("meridiem",ie.PM);let i=r.get("hour");i>=0&&i<=6&&r.assign("hour",r.get("hour")+12)}return e[0].endsWith("morning")&&(r.assign("meridiem",ie.AM),r.get("hour")<12&&r.assign("hour",r.get("hour"))),r.addTag("parser/ENTimeExpressionParser")}extractFollowingTimeComponents(t,e,r){let i=super.extractFollowingTimeComponents(t,e,r);return i&&i.addTag("parser/ENTimeExpressionParser"),i}}});var r0,i0,Ho,Bb=_(()=>{Qe();ur();bt();Mo();r0=new RegExp(`(${li})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),i0=new RegExp(`(${Gi})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),Ho=class extends Se{constructor(e){super();Q(this,"strictMode");this.strictMode=e}innerPattern(){return this.strictMode?i0:r0}innerExtract(e,r){let i=Zt(r[1]);return i?oe.createRelativeFromReference(e.reference,Us(i)):null}}});var n0,s0,a0,Yo,Hb=_(()=>{Qe();ur();bt();n0=new RegExp(`(${li})\\s{0,5}(?:later|after|from now|henceforth|forward|out)(?=(?:\\W|$))`,"i"),s0=new RegExp(`(${Gi})\\s{0,5}(later|after|from now)(?=\\W|$)`,"i"),a0=1,Yo=class extends Se{constructor(e){super();Q(this,"strictMode");this.strictMode=e}innerPattern(){return this.strictMode?s0:n0}innerExtract(e,r){let i=Zt(r[a0]);return i?oe.createRelativeFromReference(e.reference,i):null}}});var zs,Jt,Qi=_(()=>{zs=class{refine(t,e){return e.filter(r=>this.isValid(t,r))}},Jt=class{refine(t,e){if(e.length<2)return e;let r=[],i=e[0],s=null;for(let a=1;a<e.length;a++){s=e[a];let o=t.text.substring(i.index+i.text.length,s.index);if(!this.shouldMergeResults(o,i,s,t))r.push(i),i=s;else{let l=i,c=s,d=this.mergeResults(o,l,c,t);t.debug(()=>{console.log(`${this.constructor.name} merged ${l} and ${c} into ${d}`)}),i=d}}return i!=null&&r.push(i),r}}});var Uo,Yb=_(()=>{Qi();Uo=class extends Jt{shouldMergeResults(t,e,r){return!e.end&&!r.end&&t.match(this.patternBetween())!=null}mergeResults(t,e,r){if(!e.start.isOnlyWeekdayComponent()&&!r.start.isOnlyWeekdayComponent()&&(r.start.getCertainComponents().forEach(s=>{e.start.isCertain(s)||e.start.imply(s,r.start.get(s))}),e.start.getCertainComponents().forEach(s=>{r.start.isCertain(s)||r.start.imply(s,e.start.get(s))})),e.start.date().getTime()>r.start.date().getTime()){let s=e.start.dayjs(),a=r.start.dayjs();r.start.isOnlyWeekdayComponent()&&a.add(7,"days").isAfter(s)?(a=a.add(7,"days"),r.start.imply("day",a.date()),r.start.imply("month",a.month()+1),r.start.imply("year",a.year())):e.start.isOnlyWeekdayComponent()&&s.add(-7,"days").isBefore(a)?(s=s.add(-7,"days"),e.start.imply("day",s.date()),e.start.imply("month",s.month()+1),e.start.imply("year",s.year())):r.start.isDateWithUnknownYear()&&a.add(1,"years").isAfter(s)?(a=a.add(1,"years"),r.start.imply("year",a.year())):e.start.isDateWithUnknownYear()&&s.add(-1,"years").isBefore(a)?(s=s.add(-1,"years"),e.start.imply("year",s.year())):[r,e]=[e,r]}let i=e.clone();return i.start=e.start,i.end=r.start,i.index=Math.min(e.index,r.index),e.index<r.index?i.text=e.text+t+r.text:i.text=r.text+t+e.text,i}}});var Vo,Ub=_(()=>{Yb();Vo=class extends Uo{patternBetween(){return/^\s*(to|-||until|through|till)\s*$/i}}});function Vb(n,t){t=t.add(1,"day"),Bp(n,t),kd(n,t)}function ci(n,t){n.assign("day",t.date()),n.assign("month",t.month()+1),n.assign("year",t.year())}function Wb(n,t){n.assign("hour",t.hour()),n.assign("minute",t.minute()),n.assign("second",t.second()),n.assign("millisecond",t.millisecond()),n.get("hour")<12?n.assign("meridiem",ie.AM):n.assign("meridiem",ie.PM)}function Bp(n,t){n.imply("day",t.date()),n.imply("month",t.month()+1),n.imply("year",t.year())}function kd(n,t){n.imply("hour",t.hour()),n.imply("minute",t.minute()),n.imply("second",t.second()),n.imply("millisecond",t.millisecond())}var Dd=_(()=>{Mr()});function Hp(n,t){let e=n.clone(),r=n.start,i=t.start;if(e.start=jb(r,i),n.end!=null||t.end!=null){let s=n.end==null?n.start:n.end,a=t.end==null?t.start:t.end,o=jb(s,a);if(n.end==null&&o.date().getTime()<e.start.date().getTime()){let l=o.dayjs().add(1,"day");o.isCertain("day")?ci(o,l):Bp(o,l)}e.end=o}return e}function jb(n,t){let e=n.clone();return t.isCertain("hour")?(e.assign("hour",t.get("hour")),e.assign("minute",t.get("minute")),t.isCertain("second")?(e.assign("second",t.get("second")),t.isCertain("millisecond")?e.assign("millisecond",t.get("millisecond")):e.imply("millisecond",t.get("millisecond"))):(e.imply("second",t.get("second")),e.imply("millisecond",t.get("millisecond")))):(e.imply("hour",t.get("hour")),e.imply("minute",t.get("minute")),e.imply("second",t.get("second")),e.imply("millisecond",t.get("millisecond"))),t.isCertain("timezoneOffset")&&e.assign("timezoneOffset",t.get("timezoneOffset")),t.isCertain("meridiem")?e.assign("meridiem",t.get("meridiem")):t.get("meridiem")!=null&&e.get("meridiem")==null&&e.imply("meridiem",t.get("meridiem")),e.get("meridiem")==ie.PM&&e.get("hour")<12&&(t.isCertain("hour")?e.assign("hour",e.get("hour")+12):e.imply("hour",e.get("hour")+12)),e.addTags(n.tags()),e.addTags(t.tags()),e}var $b=_(()=>{Mr();Dd()});var Wo,zb=_(()=>{Qi();$b();Wo=class extends Jt{shouldMergeResults(t,e,r){return(e.start.isOnlyDate()&&r.start.isOnlyTime()||r.start.isOnlyDate()&&e.start.isOnlyTime())&&t.match(this.patternBetween())!=null}mergeResults(t,e,r){let i=e.start.isOnlyDate()?Hp(e,r):Hp(r,e);return i.index=e.index,i.text=e.text+t+r.text,i}}});var qs,qb=_(()=>{zb();qs=class extends Wo{patternBetween(){return new RegExp("^\\s*(T|at|after|before|on|of|,|-|\\.|\u2219|:)?\\s*$")}}});var o0,jo,Gb=_(()=>{Ap();o0=new RegExp("^\\s*,?\\s*\\(?([A-Z]{2,4})\\)?(?=\\W|$)","i"),jo=class{constructor(t){Q(this,"timezoneOverrides");this.timezoneOverrides=t}refine(t,e){var i;let r=(i=t.option.timezones)!=null?i:{};return e.forEach(s=>{var f,p;let a=t.text.substring(s.index+s.text.length),o=o0.exec(a);if(!o)return;let l=o[1].toUpperCase(),c=(p=(f=s.start.date())!=null?f:s.refDate)!=null?p:new Date,d={...this.timezoneOverrides,...r},u=yd(l,c,d);if(u==null)return;t.debug(()=>{console.log(`Extracting timezone: '${l}' into: ${u} for: ${s.start}`)});let h=s.start.get("timezoneOffset");h!==null&&u!=h&&(s.start.isCertain("timezoneOffset")||l!=o[1])||s.start.isOnlyDate()&&l!=o[1]||(s.text+=o[0],s.start.isCertain("timezoneOffset")||s.start.assign("timezoneOffset",u),s.end!=null&&!s.end.isCertain("timezoneOffset")&&s.end.assign("timezoneOffset",u))}),e}}});var l0,c0,d0,u0,$o,Qb=_(()=>{l0=new RegExp("^\\s*(?:\\(?(?:GMT|UTC)\\s?)?([+-])(\\d{1,2})(?::?(\\d{2}))?\\)?","i"),c0=1,d0=2,u0=3,$o=class{refine(t,e){return e.forEach(function(r){if(r.start.isCertain("timezoneOffset"))return;let i=t.text.substring(r.index+r.text.length),s=l0.exec(i);if(!s)return;t.debug(()=>{console.log(`Extracting timezone: '${s[0]}' into : ${r}`)});let a=parseInt(s[d0]),o=parseInt(s[u0]||"0"),l=a*60+o;l>14*60||(s[c0]==="-"&&(l=-l),r.end!=null&&r.end.assign("timezoneOffset",l),r.start.assign("timezoneOffset",l),r.text+=s[0])}),e}}});var Ki,Yp=_(()=>{Ki=class{refine(t,e){if(e.length<2)return e;let r=[],i=e[0];for(let s=1;s<e.length;s++){let a=e[s];if(a.index>=i.index+i.text.length){r.push(i),i=a;continue}let o=null,l=null;a.text.length>i.text.length?(o=a,l=i):(o=i,l=a),t.debug(()=>{console.log(`${this.constructor.name} remove ${l} by ${o}`)}),i=o}return i!=null&&r.push(i),r}}});var Kb,zo,Zb=_(()=>{Kb=Ve(Ui(),1);_p();zo=class{refine(t,e){return t.option.forwardDate&&e.forEach(r=>{let i=(0,Kb.default)(t.reference.getDateWithAdjustedTimezone());if(r.start.isOnlyTime()&&t.reference.instant>r.start.date()){let s=t.reference.getDateWithAdjustedTimezone(),a=new Date(s);a.setDate(a.getDate()+1),gd(r.start,a),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} time from the ref date (${s}) to the following day (${a})`)}),r.end&&r.end.isOnlyTime()&&(gd(r.end,a),r.start.date()>r.end.date()&&(a.setDate(a.getDate()+1),gd(r.end,a)))}if(r.start.isOnlyWeekdayComponent()&&i.isAfter(r.start.dayjs())&&(i.day()>=r.start.get("weekday")?i=i.day(r.start.get("weekday")+7):i=i.day(r.start.get("weekday")),r.start.imply("day",i.date()),r.start.imply("month",i.month()+1),r.start.imply("year",i.year()),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} weekday (${r.start})`)}),r.end&&r.end.isOnlyWeekdayComponent()&&(i.day()>r.end.get("weekday")?i=i.day(r.end.get("weekday")+7):i=i.day(r.end.get("weekday")),r.end.imply("day",i.date()),r.end.imply("month",i.month()+1),r.end.imply("year",i.year()),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} weekday (${r.end})`)}))),r.start.isDateWithUnknownYear()&&i.isAfter(r.start.dayjs()))for(let s=0;s<3&&i.isAfter(r.start.dayjs());s++)r.start.imply("year",r.start.get("year")+1),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} year (${r.start})`)}),r.end&&!r.end.isCertain("year")&&(r.end.imply("year",r.end.get("year")+1),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} month (${r.start})`)}))}),e}}});var qo,Jb=_(()=>{Qi();qo=class extends zs{constructor(e){super();Q(this,"strictMode");this.strictMode=e}isValid(e,r){return r.text.replace(" ","").match(/^\d*(\.\d*)?$/)?(e.debug(()=>{console.log(`Removing unlikely result '${r.text}'`)}),!1):r.start.isValidDate()?r.end&&!r.end.isValidDate()?(e.debug(()=>{console.log(`Removing invalid result: ${r} (${r.end})`)}),!1):this.strictMode?this.isStrictModeValid(e,r):!0:(e.debug(()=>{console.log(`Removing invalid result: ${r} (${r.start})`)}),!1)}isStrictModeValid(e,r){return r.start.isOnlyWeekdayComponent()?(e.debug(()=>{console.log(`(Strict) Removing weekday only component: ${r} (${r.end})`)}),!1):!0}}});var h0,f0,p0,m0,Xb,g0,eT,tT,y0,rT,iT,Go,nT=_(()=>{bt();h0=new RegExp("([0-9]{4})\\-([0-9]{1,2})\\-([0-9]{1,2})(?:T([0-9]{1,2}):([0-9]{1,2})(?::([0-9]{1,2})(?:\\.(\\d{1,4}))?)?(Z|([+-]\\d{2}):?(\\d{2})?)?)?(?=\\W|$)","i"),f0=1,p0=2,m0=3,Xb=4,g0=5,eT=6,tT=7,y0=8,rT=9,iT=10,Go=class extends Se{innerPattern(){return h0}innerExtract(t,e){let r=t.createParsingComponents({year:parseInt(e[f0]),month:parseInt(e[p0]),day:parseInt(e[m0])});if(e[Xb]!=null&&(r.assign("hour",parseInt(e[Xb])),r.assign("minute",parseInt(e[g0])),e[eT]!=null&&r.assign("second",parseInt(e[eT])),e[tT]!=null&&r.assign("millisecond",parseInt(e[tT])),e[y0]!=null)){let i=0;if(e[rT]){let s=parseInt(e[rT]),a=0;e[iT]!=null&&(a=parseInt(e[iT])),i=s*60,i<0?i-=a:i+=a}r.assign("timezoneOffset",i)}return r.addTag("parser/ISOFormatParser")}}});var Qo,sT=_(()=>{Qi();Qo=class extends Jt{mergeResults(t,e,r){let i=r.clone();return i.index=e.index,i.text=e.text+t+i.text,i.start.assign("weekday",e.start.get("weekday")),i.end&&i.end.assign("weekday",e.start.get("weekday")),i}shouldMergeResults(t,e,r){return e.start.isOnlyWeekdayComponent()&&!e.start.isCertain("hour")&&r.start.isCertain("day")&&t.match(/^,?\s*$/)!=null}}});function aT(n,t=!1){return n.parsers.unshift(new Go),n.refiners.unshift(new Qo),n.refiners.unshift(new $o),n.refiners.unshift(new Ki),n.refiners.push(new jo),n.refiners.push(new Ki),n.refiners.push(new zo),n.refiners.push(new qo(t)),n}var oT=_(()=>{Gb();Qb();Yp();Zb();Jb();nT();sT()});function lT(n){let t=(0,Gs.default)(n.getDateWithAdjustedTimezone()),e=new oe(n,{});return ci(e,t),Wb(e,t),e.assign("timezoneOffset",n.getTimezoneOffset()),e.addTag("casualReference/now"),e}function cT(n){let t=(0,Gs.default)(n.getDateWithAdjustedTimezone()),e=new oe(n,{});return ci(e,t),kd(e,t),e.addTag("casualReference/today"),e}function dT(n){return v0(n,1).addTag("casualReference/yesterday")}function v0(n,t){return Sd(n,-t)}function uT(n){return Sd(n,1).addTag("casualReference/tomorrow")}function Sd(n,t){let e=(0,Gs.default)(n.getDateWithAdjustedTimezone()),r=new oe(n,{});return e=e.add(t,"day"),ci(r,e),kd(r,e),r}function hT(n,t=22){let e=(0,Gs.default)(n.getDateWithAdjustedTimezone()),r=new oe(n,{});return ci(r,e),r.imply("hour",t),r.imply("meridiem",ie.PM),r.addTag("casualReference/tonight"),r}function fT(n,t=20){let e=new oe(n,{});return e.imply("meridiem",ie.PM),e.imply("hour",t),e.addTag("casualReference/evening"),e}function pT(n){let t=new oe(n,{}),e=(0,Gs.default)(n.getDateWithAdjustedTimezone());return e.hour()>2&&Vb(t,e),t.assign("hour",0),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/midnight"),t}function mT(n,t=6){let e=new oe(n,{});return e.imply("meridiem",ie.AM),e.imply("hour",t),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/morning"),e}function gT(n,t=15){let e=new oe(n,{});return e.imply("meridiem",ie.PM),e.imply("hour",t),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/afternoon"),e}function yT(n){let t=new oe(n,{});return t.imply("meridiem",ie.AM),t.assign("hour",12),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/noon"),t}var Gs,Up=_(()=>{ur();Gs=Ve(Ui(),1);Dd();Mr()});var wT,w0,Ko,bT=_(()=>{wT=Ve(Ui(),1);bt();Dd();Up();w0=/(now|today|tonight|tomorrow|overmorrow|tmr|tmrw|yesterday|last\s*night)(?=\W|$)/i,Ko=class extends Se{innerPattern(t){return w0}innerExtract(t,e){let r=(0,wT.default)(t.refDate),i=e[0].toLowerCase(),s=t.createParsingComponents();switch(i){case"now":s=lT(t.reference);break;case"today":s=cT(t.reference);break;case"yesterday":s=dT(t.reference);break;case"tomorrow":case"tmr":case"tmrw":s=uT(t.reference);break;case"tonight":s=hT(t.reference);break;case"overmorrow":s=Sd(t.reference,2);break;default:i.match(/last\s*night/)&&(r.hour()>6&&(r=r.add(-1,"day")),ci(s,r),s.imply("hour",0));break}return s.addTag("parser/ENCasualDateParser"),s}}});var b0,Zo,TT=_(()=>{bt();Up();b0=/(?:this)?\s{0,3}(morning|afternoon|evening|night|midnight|midday|noon)(?=\W|$)/i,Zo=class extends Se{innerPattern(){return b0}innerExtract(t,e){let r=null;switch(e[1].toLowerCase()){case"afternoon":r=gT(t.reference);break;case"evening":case"night":r=fT(t.reference);break;case"midnight":r=pT(t.reference);break;case"morning":r=mT(t.reference);break;case"noon":case"midday":r=yT(t.reference);break}return r&&r.addTag("parser/ENCasualTimeParser"),r}}});function ET(n){let t={};for(let e in n)t[e]=-n[e];return t}function kT(n,t){let e=n.clone(),r=n.dayjs();for(let i in t)r=r.add(t[i],i);return("day"in t||"d"in t||"week"in t||"month"in t||"year"in t)&&(e.imply("day",r.date()),e.imply("month",r.month()+1),e.imply("year",r.year())),("second"in t||"minute"in t||"hour"in t)&&(e.imply("second",r.second()),e.imply("minute",r.minute()),e.imply("hour",r.hour())),e}var Vp=_(()=>{});function DT(n,t,e){let r=n.getDateWithAdjustedTimezone(),i=T0(r,t,e),s=new oe(n);return s=kT(s,{day:i}),s.assign("weekday",t),s}function T0(n,t,e){let r=n.getDay();switch(e){case"this":return Cd(n,t);case"last":return ST(n,t);case"next":return r==_e.SUNDAY?t==_e.SUNDAY?7:t:r==_e.SATURDAY?t==_e.SATURDAY?7:t==_e.SUNDAY?8:1+t:t<r&&t!=_e.SUNDAY?Cd(n,t):Cd(n,t)+7}return E0(n,t)}function E0(n,t){let e=ST(n,t),r=Cd(n,t);return r<-e?r:e}function Cd(n,t){let e=n.getDay(),r=t-e;return r<0&&(r+=7),r}function ST(n,t){let e=n.getDay(),r=t-e;return r>=0&&(r-=7),r}var CT=_(()=>{Mr();ur();Vp()});var k0,D0,S0,C0,Jo,xT=_(()=>{Qe();ji();bt();CT();Mr();k0=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:on\\s*?)?(?:(this|last|past|next)\\s*)?(${lt(wd)}|weekend|weekday)(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(this|last|past|next)\\s*week)?(?=\\W|$)`,"i"),D0=1,S0=2,C0=3,Jo=class extends Se{innerPattern(){return k0}innerExtract(t,e){let r=e[D0],i=e[C0],s=r||i;s=s||"",s=s.toLowerCase();let a=null;s=="last"||s=="past"?a="last":s=="next"?a="next":s=="this"&&(a="this");let o=e[S0].toLowerCase(),l;if(wd[o]!==void 0)l=wd[o];else if(o=="weekend")l=a=="last"?_e.SUNDAY:_e.SATURDAY;else if(o=="weekday"){let c=t.reference.getDateWithAdjustedTimezone().getDay();c==_e.SUNDAY||c==_e.SATURDAY?l=a=="last"?_e.FRIDAY:_e.MONDAY:(l=c-1,l=a=="last"?l-1:l+1,l=l%5+1)}else return null;return DT(t.reference,l,a)}}});var _T,x0,_0,M0,Xo,MT=_(()=>{Qe();ur();_T=Ve(Ui(),1);bt();ji();x0=new RegExp(`(this|last|past|next|after\\s*this)\\s*(${lt(Ao)})(?=\\s*)(?=\\W|$)`,"i"),_0=1,M0=2,Xo=class extends Se{innerPattern(){return x0}innerExtract(t,e){let r=e[_0].toLowerCase(),i=e[M0].toLowerCase(),s=Ao[i];if(r=="next"||r.startsWith("after")){let l={};return l[s]=1,oe.createRelativeFromReference(t.reference,l)}if(r=="last"||r=="past"){let l={};return l[s]=-1,oe.createRelativeFromReference(t.reference,l)}let a=t.createParsingComponents(),o=(0,_T.default)(t.reference.instant);return i.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):i.match(/month/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):i.match(/year/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var A0,I0,P0,AT,IT,Wp,el,PT=_(()=>{Vs();A0=new RegExp("([^\\d]|^)([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}|[0-9]{2}))?(\\W|$)","i"),I0=1,P0=5,AT=2,IT=3,Wp=4,el=class{constructor(t){Q(this,"groupNumberMonth");Q(this,"groupNumberDay");this.groupNumberMonth=t?IT:AT,this.groupNumberDay=t?AT:IT}pattern(){return A0}extract(t,e){let r=e.index+e[I0].length,i=e.index+e[0].length-e[P0].length;if(r>0&&t.text.substring(0,r).match("\\d/?$")||i<t.text.length&&t.text.substring(i).match("^/?\\d"))return;let s=t.text.substring(r,i);if(s.match(/^\d\.\d$/)||s.match(/^\d\.\d{1,2}\.\d{1,2}\s*$/)||!e[Wp]&&s.indexOf("/")<0)return;let a=t.createParsingResult(r,s),o=parseInt(e[this.groupNumberMonth]),l=parseInt(e[this.groupNumberDay]);if((o<1||o>12)&&o>12)if(l>=1&&l<=12&&o<=31)[l,o]=[o,l];else return null;if(l<1||l>31)return null;if(a.start.assign("day",l),a.start.assign("month",o),e[Wp]){let c=parseInt(e[Wp]),d=vd(c);a.start.assign("year",d)}else{let c=$i(t.refDate,l,o);a.start.imply("year",c)}return a.addTag("parser/SlashDateFormatParser")}}});var N0,O0,tl,NT=_(()=>{Qe();ur();bt();Mo();N0=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${li})(?=\\W|$)`,"i"),O0=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${Gi})(?=\\W|$)`,"i"),tl=class extends Se{constructor(e=!0){super();Q(this,"allowAbbreviations");this.allowAbbreviations=e}innerPattern(){return this.allowAbbreviations?N0:O0}innerExtract(e,r){let i=r[1].toLowerCase(),s=Zt(r[2]);if(!s)return null;switch(i){case"last":case"past":case"-":s=Us(s);break}return oe.createRelativeFromReference(e.reference,s)}}});function R0(n){return n.text.match(/^[+-]/i)!=null}function OT(n){return n.text.match(/^-/i)!=null}var rl,RT=_(()=>{Qi();ur();Qe();Vp();rl=class extends Jt{shouldMergeResults(t,e,r){return t.match(/^\s*$/i)?R0(r)||OT(r):!1}mergeResults(t,e,r,i){let s=Zt(r.text);OT(r)&&(s=ET(s));let a=oe.createRelativeFromReference(new Wi(e.start.date()),s);return new dr(e.reference,e.index,`${e.text}${t}${r.text}`,a)}}});function LT(n){return n.text.match(/\s+(before|from)$/i)!=null}function L0(n){return n.text.match(/\s+(after|since)$/i)!=null}var il,FT=_(()=>{Qi();ur();Qe();Mo();il=class extends Jt{patternBetween(){return/^\s*$/i}shouldMergeResults(t,e,r){return!t.match(this.patternBetween())||!LT(e)&&!L0(e)?!1:!!r.start.get("day")&&!!r.start.get("month")&&!!r.start.get("year")}mergeResults(t,e,r){let i=Zt(e.text);LT(e)&&(i=Us(i));let s=oe.createRelativeFromReference(new Wi(r.start.date()),i);return new dr(r.reference,e.index,`${e.text}${t}${r.text}`,s)}}});var F0,B0,nl,BT=_(()=>{Qe();F0=new RegExp(`^\\s*(${zi})`,"i"),B0=1,nl=class{refine(t,e){return e.forEach(function(r){if(!r.start.isDateWithUnknownYear())return;let i=t.text.substring(r.index+r.text.length),s=F0.exec(i);if(!s||s[0].trim().length<=3)return;t.debug(()=>{console.log(`Extracting year: '${s[0]}' into : ${r}`)});let a=qi(s[B0]);r.end!=null&&r.end.assign("year",a),r.start.assign("year",a),r.text+=s[0]}),e}}});var sl,HT=_(()=>{Qi();sl=class extends zs{constructor(){super()}isValid(t,e){let r=e.text.trim();return r===t.text.trim()?!0:r.toLowerCase()==="may"&&!t.text.substring(0,e.index).trim().match(/\b(in)$/i)?(t.debug(()=>{console.log(`Removing unlikely result: ${e}`)}),!1):r.toLowerCase().endsWith("the second")?(t.text.substring(e.index+e.text.length).trim().length>0&&t.debug(()=>{console.log(`Removing unlikely result: ${e}`)}),!1):!0}}});var Jn,jp=_(()=>{kb();xb();Mb();Ib();Nb();Ob();Fb();Bb();Hb();Ub();qb();oT();bT();TT();xT();MT();PT();NT();RT();FT();Yp();BT();HT();Jn=class{createCasualConfiguration(t=!1){let e=this.createConfiguration(!1,t);return e.parsers.push(new Ko),e.parsers.push(new Zo),e.parsers.push(new Oo),e.parsers.push(new Xo),e.parsers.push(new tl),e.refiners.push(new sl),e}createConfiguration(t=!0,e=!1){let r=aT({parsers:[new el(e),new Io(t),new Po,new No(e),new Jo,new Lo,new Bo(t),new Ho(t),new Yo(t)],refiners:[new qs]},t);return r.parsers.unshift(new Ro(t)),r.refiners.unshift(new il),r.refiners.unshift(new rl),r.refiners.unshift(new Ki),r.refiners.push(new qs),r.refiners.push(new nl),r.refiners.push(new Vo),r}}});var di,$p,YT=_(()=>{ur();jp();di=class{constructor(t){Q(this,"parsers");Q(this,"refiners");Q(this,"defaultConfig",new Jn);t=t||this.defaultConfig.createCasualConfiguration(),this.parsers=[...t.parsers],this.refiners=[...t.refiners]}clone(){return new di({parsers:[...this.parsers],refiners:[...this.refiners]})}parseDate(t,e,r){let i=this.parse(t,e,r);return i.length>0?i[0].start.date():null}parse(t,e,r){let i=new $p(t,e,r),s=[];return this.parsers.forEach(a=>{let o=di.executeParser(i,a);s=s.concat(o)}),s.sort((a,o)=>a.index-o.index),this.refiners.forEach(function(a){s=a.refine(i,s)}),s}static executeParser(t,e){let r=[],i=e.pattern(t),s=t.text,a=t.text,o=i.exec(a);for(;o;){let l=o.index+s.length-a.length;o.index=l;let c=e.extract(t,o);if(!c){a=s.substring(o.index+1),o=i.exec(a);continue}let d=null;c instanceof dr?d=c:c instanceof oe?(d=t.createParsingResult(o.index,o[0]),d.start=c):d=t.createParsingResult(o.index,o[0],c);let u=d.index,h=d.text;t.debug(()=>console.log(`${e.constructor.name} extracted (at index=${u}) '${h}'`)),r.push(d),a=s.substring(u+h.length),o=i.exec(a)}return r}},$p=class{constructor(t,e,r){Q(this,"text");Q(this,"option");Q(this,"reference");Q(this,"refDate");this.text=t,this.reference=new Wi(e),this.option=r!=null?r:{},this.refDate=this.reference.instant}createParsingComponents(t){return t instanceof oe?t:new oe(this.reference,t)}createParsingResult(t,e,r,i){let s=typeof e=="string"?e:this.text.substring(t,e),a=r?this.createParsingComponents(r):null,o=i?this.createParsingComponents(i):null;return new dr(this.reference,t,s,a,o)}debug(t){this.option.debug&&(this.option.debug instanceof Function?this.option.debug(t):this.option.debug.debug(t))}}});var zp,UT,H0,sU,VT=_(()=>{YT();jp();zp=new Jn,UT=new di(zp.createCasualConfiguration(!1)),H0=new di(zp.createConfiguration(!0,!1)),sU=new di(zp.createCasualConfiguration(!0))});function qp(n,t,e){return U0.parse(n,t,e)}var U0,WT=_(()=>{VT();U0=UT});var Qs,Gp=_(()=>{je();WT();nh();Qs=class{constructor(t=[],e=[],r=!0){this.isValidDateString=t=>/^\d{4}-\d{2}-\d{2}$/.test(t);this.isValidTimeString=t=>/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(t);this.escapeRegex=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.cleanupWhitespace=t=>t.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").trim();this.defaultToScheduled=r,this.priorityPatterns=this.buildPriorityPatterns(e),this.statusPatterns=this.buildStatusPatterns(t)}parseInput(t){let e={title:"",tags:[],contexts:[],projects:[]},[r,i]=this.extractTitleAndDetails(t);i&&(e.details=i);let s=r;return s=this.extractTags(s,e),s=this.extractContexts(s,e),s=this.extractProjects(s,e),s=this.extractPriority(s,e),s=this.extractStatus(s,e),s=this.extractExplicitDates(s,e),s=this.extractRecurrence(s,e),s=this.extractTimeEstimate(s,e),s=this.parseDatesAndTimes(s,e),e.title=s.trim(),this.validateAndCleanupResult(e)}extractTitleAndDetails(t){let e=t.trim(),r=e.indexOf(`
`);if(r!==-1){let i=e.substring(0,r).trim(),s=e.substring(r+1).trim();return[i,s]}return[e,void 0]}extractTags(t,e){let r=t.match(/#[\w/]+/g);return r?(e.tags.push(...r.map(i=>i.substring(1))),this.cleanupWhitespace(t.replace(/#[\w/]+/g,""))):t}extractContexts(t,e){let r=t.match(/@\w+/g);return r?(e.contexts.push(...r.map(i=>i.substring(1))),this.cleanupWhitespace(t.replace(/@\w+/g,""))):t}extractProjects(t,e){let r=t,i=r.match(/\+\[\[[^\]]+\]\]/g);i&&(e.projects.push(...i.map(a=>a.slice(3,-2))),r=this.cleanupWhitespace(r.replace(/\+\[\[[^\]]+\]\]/g,"")));let s=r.match(/\+[\w/]+/g);return s&&(e.projects.push(...s.map(a=>a.substring(1))),r=this.cleanupWhitespace(r.replace(/\+[\w/]+/g,""))),r}buildPriorityPatterns(t){return t.length>0?t.flatMap(e=>[{regex:new RegExp(`\\b${this.escapeRegex(e.value)}\\b`,"i"),value:e.value},{regex:new RegExp(`\\b${this.escapeRegex(e.label)}\\b`,"i"),value:e.value}]):[{regex:/\b(urgent|critical|highest)\b/i,value:"urgent"},{regex:/\b(high)\b/i,value:"high"},{regex:/\b(important)\b/i,value:"high"},{regex:/\b(medium|normal)\b/i,value:"normal"},{regex:/\b(low|minor)\b/i,value:"low"}]}extractPriority(t,e){let r=null;for(let i of this.priorityPatterns){let s=t.match(i.regex);s&&s.index!==void 0&&(!r||s.index<r.index)&&(r={pattern:i,index:s.index})}return r?(e.priority=r.pattern.value,this.cleanupWhitespace(t.replace(r.pattern.regex,""))):t}buildStatusPatterns(t){return t.length>0?t.flatMap(e=>[{regex:new RegExp(`\\b${this.escapeRegex(e.value)}\\b`,"i"),value:e.value},{regex:new RegExp(`\\b${this.escapeRegex(e.label)}\\b`,"i"),value:e.value}]):[{regex:/\b(todo|to do|open)\b/i,value:"open"},{regex:/\b(in progress|in-progress|doing)\b/i,value:"in-progress"},{regex:/\b(done|completed|finished)\b/i,value:"done"},{regex:/\b(cancelled|canceled)\b/i,value:"cancelled"},{regex:/\b(waiting|blocked|on hold)\b/i,value:"waiting"}]}extractStatus(t,e){for(let r of this.statusPatterns)if(r.regex.test(t))return e.status=r.value,this.cleanupWhitespace(t.replace(r.regex,""));return t}extractExplicitDates(t,e){let r=t,i=[{type:"due",regex:/\b(due\s+(?:on\s+)?|deadline\s+(?:on\s+)?|must\s+be\s+done\s+(?:by\s+)?)/i},{type:"scheduled",regex:/\b(scheduled\s+(?:for\s+)?|start\s+(?:on\s+)?|begin\s+(?:on\s+)?|work\s+on\s+)/i}];for(let s of i){let a=r.match(s.regex);if(a){let o=a.index+a[0].length,l=r.substring(o),c=this.parseChronoFromPosition(l);if(c.success){s.type==="due"?(e.dueDate=c.date,c.time&&(e.dueTime=c.time)):(e.scheduledDate=c.date,c.time&&(e.scheduledTime=c.time)),r=r.replace(s.regex,""),c.matchedText&&(r=r.replace(c.matchedText,"")),r=this.cleanupWhitespace(r);break}}}return r}parseChronoFromPosition(t){try{let e=qp(t,new Date,{forwardDate:!0});if(e.length>0){let r=e[0];if(r.index<=3){let i=r.start.date();if(rt(i)){let s={success:!0,date:I(i,"yyyy-MM-dd"),matchedText:r.text};return r.start.isCertain("hour")&&(s.time=I(i,"HH:mm")),s}}}}catch(e){console.debug("Error parsing date with chrono:",e)}return{success:!1}}extractRecurrence(t,e){let r=[{regex:/\bevery\s+(first|second|third|fourth|last)\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)\b/i,handler:i=>{let s=i[1].toLowerCase(),o=i[2].toLowerCase().toUpperCase().substring(0,2),l={first:1,second:2,third:3,fourth:4,last:-1}[s]||1;return`FREQ=MONTHLY;BYDAY=${o};BYSETPOS=${l}`}},{regex:/\bevery\s+(\d+)\s+(days?|weeks?|months?|years?)\b/i,handler:i=>{let s=parseInt(i[1]),a=i[2].replace(/s$/,"").toLowerCase();return`FREQ=${{day:"DAILY",week:"WEEKLY",month:"MONTHLY",year:"YEARLY"}[a]};INTERVAL=${s}`}},{regex:/\bevery\s+other\s+(day|week|month|year)\b/i,handler:i=>{let s=i[1].toLowerCase();return`FREQ=${{day:"DAILY",week:"WEEKLY",month:"MONTHLY",year:"YEARLY"}[s]};INTERVAL=2`}},{regex:/\bevery\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)\b/i,handler:i=>`FREQ=WEEKLY;BYDAY=${i[1].toUpperCase().substring(0,2)}`},{regex:/\b(mondays|tuesdays|wednesdays|thursdays|fridays|saturdays|sundays)\b/i,handler:i=>`FREQ=WEEKLY;BYDAY=${i[1].replace(/s$/,"").toUpperCase().substring(0,2)}`},{regex:/\b(daily|every day)\b/i,handler:()=>"FREQ=DAILY"},{regex:/\b(weekly|every week)\b/i,handler:()=>"FREQ=WEEKLY"},{regex:/\b(monthly|every month)\b/i,handler:()=>"FREQ=MONTHLY"},{regex:/\b(yearly|annually|every year)\b/i,handler:()=>"FREQ=YEARLY"}];for(let i of r){let s=t.match(i.regex);if(s){let a=i.handler(s);if(this.isValidRRuleString(a))return e.recurrence=a,this.cleanupWhitespace(t.replace(i.regex,""))}}return t}isValidRRuleString(t){if(t.includes("BYDAY=undefined")||t.includes("BYDAY=;")||t.includes("BYDAY=")){let e=t.match(/BYDAY=([^;]*)/);if(e&&(!e[1]||e[1]==="undefined"||e[1].trim()===""))return!1}return!!t.includes("FREQ=")}extractTimeEstimate(t,e){let r=[{regex:/\b(\d+)h\s*(\d+)m\b/i,handler:a=>parseInt(a[1])*60+parseInt(a[2])},{regex:/\b(\d+)\s*(?:hr|hrs|hour|hours|h)\b/i,handler:a=>parseInt(a[1])*60},{regex:/\b(\d+)\s*(?:min|mins|minute|minutes|m)\b/i,handler:a=>parseInt(a[1])}],i=t,s=0;for(let a of r){let o=i.match(a.regex);o&&(s+=a.handler(o),i=this.cleanupWhitespace(i.replace(a.regex,"")))}return s>0&&(e.estimate=s),i}parseDatesAndTimes(t,e){var i,s;let r=t;try{let a=qp(t,new Date,{forwardDate:!0});if(a.length===0)return t;let o=a[0],l=o.text,c=o.start.date(),d=(i=o.end)==null?void 0:i.date(),u=/due|by|deadline/i.test(o.text),h=/scheduled|from|start|on/i.test(o.text);if(d&&rt(d)&&d.getTime()!==c.getTime())e.scheduledDate=I(c,"yyyy-MM-dd"),o.start.isCertain("hour")&&(e.scheduledTime=I(c,"HH:mm")),e.dueDate=I(d,"yyyy-MM-dd"),(s=o.end)!=null&&s.isCertain("hour")&&(e.dueTime=I(d,"HH:mm"));else if(rt(c)){let f=I(c,"yyyy-MM-dd"),p=o.start.isCertain("hour")?I(c,"HH:mm"):void 0;u&&!h?(e.dueDate=f,e.dueTime=p):h&&!u||this.defaultToScheduled?(e.scheduledDate=f,e.scheduledTime=p):(e.dueDate=f,e.dueTime=p)}r=this.cleanupWhitespace(r.replace(l,""))}catch(a){console.debug("Chrono-node parsing failed:",a)}return r}validateAndCleanupResult(t){return t.title.trim()||(t.title="Untitled Task"),t.tags=[...new Set(t.tags.filter(Boolean))],t.contexts=[...new Set(t.contexts.filter(Boolean))],t.projects=[...new Set(t.projects.filter(Boolean))],t.dueDate&&!this.isValidDateString(t.dueDate)&&delete t.dueDate,t.scheduledDate&&!this.isValidDateString(t.scheduledDate)&&delete t.scheduledDate,t.dueTime&&!this.isValidTimeString(t.dueTime)&&delete t.dueTime,t.scheduledTime&&!this.isValidTimeString(t.scheduledTime)&&delete t.scheduledTime,t}getPreviewData(t){let e=[];if(t.title&&e.push({icon:"edit-3",text:`"${t.title}"`}),t.details&&e.push({icon:"file-text",text:`Details: "${t.details.substring(0,50)}${t.details.length>50?"...":""}"`}),t.dueDate){let r=t.dueTime?`${t.dueDate} at ${t.dueTime}`:t.dueDate;e.push({icon:"calendar",text:`Due: ${r}`})}if(t.scheduledDate){let r=t.scheduledTime?`${t.scheduledDate} at ${t.scheduledTime}`:t.scheduledDate;e.push({icon:"calendar-clock",text:`Scheduled: ${r}`})}if(t.priority&&e.push({icon:"alert-triangle",text:`Priority: ${t.priority}`}),t.status&&e.push({icon:"activity",text:`Status: ${t.status}`}),t.contexts&&t.contexts.length>0&&e.push({icon:"map-pin",text:`Contexts: ${t.contexts.map(r=>"@"+r).join(", ")}`}),t.projects&&t.projects.length>0){let r=t.projects.map(i=>i.includes(" ")||i.includes("-")||i.match(/[A-Z]/)?`+[[${i}]]`:`+${i}`).join(", ");e.push({icon:"folder",text:`Projects: ${r}`})}if(t.tags&&t.tags.length>0&&e.push({icon:"tag",text:`Tags: ${t.tags.map(r=>"#"+r).join(", ")}`}),t.recurrence){let r="Invalid recurrence";try{t.recurrence.includes("FREQ=")&&this.isValidRRuleString(t.recurrence)&&(r=W.fromString(t.recurrence).toText())}catch(i){console.debug("Error parsing rrule for preview:",i)}e.push({icon:"repeat",text:`Recurrence: ${r}`})}return t.estimate&&e.push({icon:"clock",text:`Estimate: ${t.estimate} min`}),e}getPreviewText(t){return this.getPreviewData(t).map(e=>e.text).join(" \u2022 ")}}});var Xp={};pi(Xp,{DEFAULT_TASK_CARD_OPTIONS:()=>Jp,createTaskCard:()=>Bt,showDeleteConfirmationModal:()=>jT,showTaskContextMenu:()=>al,updateTaskCard:()=>Nr});function Ad(n,t,e,r){n.addEventListener("click",i=>{i.stopPropagation();let s=r==="due"?t.due:t.scheduled;new oi({currentValue:Z(s||""),currentTime:It(s||""),onSelect:async(o,l)=>{try{let c;o?l?c=`${o}T${l}`:c=o:c=void 0,await e.updateTaskProperty(t,r,c)}catch(c){console.error(`Error updating ${r} date:`,c),new ne.Notice(`Failed to update ${r} date`)}}}).show(i)})}function Bt(n,t,e={}){let r={...Jp,...e},i=r.targetDate||t.selectedDate,s=n.recurrence?Gr(n,i):n.status,a=document.createElement("div"),o=t.getActiveTimeSession(n)!==null,l=t.statusManager.isCompletedStatus(s),c=!!n.recurrence,d=["task-card"];l&&d.push("task-card--completed"),n.archived&&d.push("task-card--archived"),o&&d.push("task-card--actively-tracked"),c&&d.push("task-card--recurring"),r.showCheckbox&&d.push("task-card--checkbox-enabled"),n.priority&&d.push(`task-card--priority-${n.priority}`),s&&d.push(`task-card--status-${s}`),a.className=d.join(" "),a.dataset.taskPath=n.path,a.dataset.key=n.path,a.dataset.status=s;let u=t.priorityManager.getPriorityConfig(n.priority);u&&a.style.setProperty("--priority-color",u.color);let h=t.statusManager.getStatusConfig(s);if(h&&a.style.setProperty("--current-status-color",h.color),r.showCheckbox){let E=a.createEl("input",{type:"checkbox",cls:"task-card__checkbox"});E.checked=t.statusManager.isCompletedStatus(s),E.addEventListener("click",async C=>{C.stopPropagation();try{n.recurrence?await t.toggleRecurringTaskComplete(n,i):await t.toggleTaskStatus(n)}catch(S){let O=S instanceof Error?S.message:String(S);console.error("Error in task checkbox handler:",{error:O,taskPath:n.path}),new ne.Notice(`Failed to toggle task status: ${O}`)}})}let f=a.createEl("span",{cls:"task-card__status-dot"});if(h&&(f.style.borderColor=h.color),f.addEventListener("click",async E=>{E.stopPropagation();try{if(n.recurrence){let C=await t.toggleRecurringTaskComplete(n,i),S=Gr(C,i),O=t.statusManager.getStatusConfig(S),F=t.statusManager.isCompletedStatus(S);O&&(f.style.borderColor=O.color);let P=["task-card"];F&&P.push("task-card--completed"),n.archived&&P.push("task-card--archived"),t.getActiveTimeSession(n)&&P.push("task-card--actively-tracked"),n.recurrence&&P.push("task-card--recurring"),n.priority&&P.push(`task-card--priority-${n.priority}`),S&&P.push(`task-card--status-${S}`),a.className=P.join(" "),a.dataset.status=S;let x=a.querySelector(".task-card__title");x&&x.classList.toggle("completed",F)}else{let C=await t.cacheManager.getTaskInfo(n.path);if(!C){new ne.Notice("Task not found");return}let S=C.status||"open",O=t.statusManager.getNextStatus(S);await t.updateTaskProperty(C,"status",O)}}catch(C){let S=C instanceof Error?C.message:String(C);console.error("Error cycling task status:",{error:S,taskPath:n.path}),new ne.Notice(`Failed to update task status: ${S}`)}}),n.priority&&u){let E=a.createEl("span",{cls:"task-card__priority-dot",attr:{"aria-label":`Priority: ${u.label}`}});E.style.borderColor=u.color,E.addEventListener("click",C=>{C.stopPropagation(),new Hi({currentValue:n.priority,onSelect:async O=>{try{await t.updateTaskProperty(n,"priority",O)}catch(F){console.error("Error updating priority:",F),new ne.Notice("Failed to update priority")}},plugin:t}).show(C)})}if(n.recurrence){let E=a.createEl("div",{cls:"task-card__recurring-indicator",attr:{"aria-label":`Recurring: ${xn(n.recurrence)} (click to change)`,title:`Recurring: ${xn(n.recurrence)} (click to change)`}});(0,ne.setIcon)(E,"rotate-ccw"),E.addEventListener("click",C=>{C.stopPropagation(),new Yi({currentValue:typeof n.recurrence=="string"?n.recurrence:void 0,onSelect:async O=>{try{await t.updateTaskProperty(n,"recurrence",O||void 0)}catch(F){console.error("Error updating recurrence:",F),new ne.Notice("Failed to update recurrence")}},app:t.app}).show(C)})}let p=a.createEl("div",{cls:"task-card__project-indicator-placeholder",attr:{style:"display: none;"}});t.projectSubtasksService.isTaskUsedAsProject(n.path).then(E=>{E?(p.className="task-card__project-indicator",p.removeAttribute("style"),p.setAttribute("aria-label","This task is used as a project (click to filter subtasks)"),(0,ne.setTooltip)(p,"This task is used as a project (click to filter subtasks)",{placement:"top"}),(0,ne.setIcon)(p,"folder"),p.addEventListener("click",async C=>{C.stopPropagation();try{await t.applyProjectSubtaskFilter(n)}catch(S){console.error("Error filtering project subtasks:",S),new ne.Notice("Failed to filter project subtasks")}})):p.remove()}).catch(E=>{console.error("Error checking if task is used as project:",E),p.remove()});let m=a.createEl("div",{cls:"task-card__content"}),g=a.createEl("div",{cls:"task-card__context-menu",attr:{"aria-label":"Task options"}});(0,ne.setIcon)(g,"ellipsis-vertical"),(0,ne.setTooltip)(g,"Task options",{placement:"top"}),g.addEventListener("click",async E=>{E.stopPropagation(),E.preventDefault(),await al(E,n.path,t,i)});let v=m.createEl("div",{cls:"task-card__title",text:n.title});t.statusManager.isCompletedStatus(s)&&v.classList.add("completed");let T=m.createEl("div",{cls:"task-card__metadata"}),k=[];if(n.recurrence){let E=xn(n.recurrence),C=T.createEl("span");C.textContent=`Recurring: ${E}`,k.push(C)}if(n.due){let E=ka(n.due),C=Ut(n.due),S="";if(E){let F=Je(n.due,{dateFormat:"",timeFormat:"h:mm a",showTime:!0});F.trim()===""?S="Due: Today":S=`Due: Today at ${F}`}else C?S=`Due: ${Je(n.due,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})} (overdue)`:S=`Due: ${Je(n.due,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})}`;let O=T.createEl("span",{cls:"task-card__metadata-date task-card__metadata-date--due",text:S});Ad(O,n,t,"due"),k.push(O)}if(n.scheduled){let E=ka(n.scheduled),C=Ut(n.scheduled),S="";if(E){let F=Je(n.scheduled,{dateFormat:"",timeFormat:"h:mm a",showTime:!0});F.trim()===""?S="Scheduled: Today":S=`Scheduled: Today at ${F}`}else C?S=`Scheduled: ${Je(n.scheduled,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})} (past)`:S=`Scheduled: ${Je(n.scheduled,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})}`;let O=T.createEl("span",{cls:"task-card__metadata-date task-card__metadata-date--scheduled",text:S});Ad(O,n,t,"scheduled"),k.push(O)}if(n.contexts&&n.contexts.length>0){let E=T.createEl("span");E.textContent=`@${n.contexts.join(", @")}`,k.push(E)}let D=Ot(n.projects||[]);if(D.length>0){let E=T.createEl("span");$T(E,D,t),k.push(E)}let M=Na(n.timeEntries||[]);if(n.timeEstimate||M>0){let E=[];M>0&&E.push(`${t.formatTime(M)} spent`),n.timeEstimate&&E.push(`${t.formatTime(n.timeEstimate)} estimated`);let C=T.createEl("span");C.textContent=E.join(", "),k.push(C)}if(k.length>0)for(let E=1;E<k.length;E++){let C=T.createEl("span",{cls:"task-card__metadata-separator",text:" \u2022 "});k[E].insertAdjacentElement("beforebegin",C)}else T.style.display="none";return a.addEventListener("click",async E=>{if(E.target!==a.querySelector(".task-card__checkbox"))if(E.ctrlKey||E.metaKey){let C=t.app.vault.getAbstractFileByPath(n.path);C instanceof ne.TFile&&t.app.workspace.getLeaf(!1).openFile(C)}else await t.openTaskEditModal(n)}),a.addEventListener("contextmenu",async E=>{E.preventDefault();let C=a.dataset.taskPath;C&&await al(E,C,t,i)}),a.addEventListener("mouseover",E=>{t.app.vault.getAbstractFileByPath(n.path)&&t.app.workspace.trigger("hover-link",{event:E,source:"tasknotes-task-card",hoverParent:a,targetEl:a,linktext:n.path,sourcePath:n.path})}),a}async function al(n,t,e,r){var i;try{let s=await e.cacheManager.getTaskInfo(t);if(!s){console.error(`No task found for path: ${t}`);return}let a=new ne.Menu;if((s.recurrence?e.statusManager.getNonCompletionStatuses():e.statusManager.getAllStatuses()).forEach(l=>{a.addItem(c=>{let d=s.status===l.value;c.setTitle(`${l.label}`),c.setIcon("circle"),d&&c.setIcon("check"),c.onClick(async()=>{try{await e.updateTaskProperty(s,"status",l.value)}catch(u){let h=u instanceof Error?u.message:String(u);console.error("Error updating task status:",{error:h,taskPath:s.path}),new ne.Notice(`Failed to update task status: ${h}`)}})})}),s.recurrence){a.addSeparator();let l=Te(r),c=((i=s.complete_instances)==null?void 0:i.includes(l))||!1;a.addItem(d=>{d.setTitle(c?"Mark incomplete for this date":"Mark complete for this date"),d.setIcon(c?"x":"check"),d.onClick(async()=>{try{await e.toggleRecurringTaskComplete(s,r)}catch(u){let h=u instanceof Error?u.message:String(u);console.error("Error toggling recurring task completion:",{error:h,taskPath:s.path}),new ne.Notice(`Failed to toggle recurring task completion: ${h}`)}})})}a.addSeparator(),e.priorityManager.getPrioritiesByWeight().forEach(l=>{a.addItem(c=>{let d=s.priority===l.value;c.setTitle(`Priority: ${l.label}`),c.setIcon("flag"),d&&c.setIcon("check"),c.onClick(async()=>{try{await e.updateTaskProperty(s,"priority",l.value)}catch(u){let h=u instanceof Error?u.message:String(u);console.error("Error updating task priority:",{error:h,taskPath:s.path}),new ne.Notice(`Failed to update task priority: ${h}`)}})})}),a.addSeparator(),a.addItem(l=>{l.setTitle("Set due date..."),l.setIcon("calendar"),l.onClick(()=>{e.openDueDateModal(s)})}),a.addItem(l=>{l.setTitle("Set scheduled date..."),l.setIcon("calendar-clock"),l.onClick(()=>{e.openScheduledDateModal(s)})}),a.addSeparator(),a.addItem(l=>{let c=e.getActiveTimeSession(s);l.setTitle(c?"Stop time tracking":"Start time tracking"),l.setIcon(c?"pause":"play"),l.onClick(async()=>{e.getActiveTimeSession(s)?await e.stopTimeTracking(s):await e.startTimeTracking(s)})}),a.addItem(l=>{l.setTitle(s.archived?"Unarchive":"Archive"),l.setIcon(s.archived?"archive-restore":"archive"),l.onClick(async()=>{try{await e.toggleTaskArchive(s)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error toggling task archive:",{error:d,taskPath:s.path}),new ne.Notice(`Failed to toggle task archive: ${d}`)}})}),a.addSeparator(),a.addItem(l=>{l.setTitle("Open note"),l.setIcon("file-text"),l.onClick(()=>{let c=e.app.vault.getAbstractFileByPath(t);c instanceof ne.TFile&&e.app.workspace.getLeaf(!1).openFile(c)})}),a.addItem(l=>{l.setTitle("Copy task title"),l.setIcon("copy"),l.onClick(async()=>{try{await navigator.clipboard.writeText(s.title),new ne.Notice("Task title copied to clipboard")}catch(c){new ne.Notice("Failed to copy to clipboard")}})}),a.addSeparator(),a.addItem(l=>{l.setTitle("Create subtask"),l.setIcon("plus"),l.onClick(()=>{let c=e.app.vault.getAbstractFileByPath(s.path);if(c instanceof ne.TFile){let d=`[[${c.basename}]]`;e.openTaskCreationModal({projects:[d]})}})}),a.addItem(l=>{l.setTitle("Delete task"),l.setIcon("trash"),l.onClick(async()=>{try{await jT(s,e)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error deleting task:",{error:d,taskPath:s.path}),new ne.Notice(`Failed to delete task: ${d}`)}})}),a.showAtMouseEvent(n)}catch(s){let a=s instanceof Error?s.message:String(s);console.error("Error creating context menu:",{error:a,taskPath:t}),new ne.Notice(`Failed to create context menu: ${a}`)}}function Nr(n,t,e,r={}){let s={...Jp,...r}.targetDate||e.selectedDate,a=t.recurrence?Gr(t,s):t.status,o=e.getActiveTimeSession(t)!==null,l=e.statusManager.isCompletedStatus(a),c=!!t.recurrence,d=["task-card"];l&&d.push("task-card--completed"),t.archived&&d.push("task-card--archived"),o&&d.push("task-card--actively-tracked"),c&&d.push("task-card--recurring"),t.priority&&d.push(`task-card--priority-${t.priority}`),a&&d.push(`task-card--status-${a}`),n.className=d.join(" "),n.dataset.status=a;let u=e.priorityManager.getPriorityConfig(t.priority);u&&n.style.setProperty("--priority-color",u.color);let h=e.statusManager.getStatusConfig(a);h&&n.style.setProperty("--current-status-color",h.color);let f=n.querySelector(".task-card__checkbox");f&&(f.checked=e.statusManager.isCompletedStatus(a));let p=n.querySelector(".task-card__status-dot");p&&h&&(p.style.borderColor=h.color);let m=n.querySelector(".task-card__priority-dot");if(t.priority&&u&&!m){let M=n.createEl("span",{cls:"task-card__priority-dot",attr:{"aria-label":`Priority: ${u.label}`}});M.style.borderColor=u.color,p==null||p.insertAdjacentElement("afterend",M)}else!t.priority&&m?m.remove():t.priority&&u&&m&&(m.style.borderColor=u.color,m.setAttribute("aria-label",`Priority: ${u.label}`));let g=n.querySelector(".task-card__recurring-indicator");if(t.recurrence&&!g){let M=n.createEl("span",{cls:"task-card__recurring-indicator",attr:{"aria-label":`Recurring: ${xn(t.recurrence)}`}});p==null||p.insertAdjacentElement("afterend",M)}else if(!t.recurrence&&g)g.remove();else if(t.recurrence&&g){let M=xn(t.recurrence);g.setAttribute("aria-label",`Recurring: ${M}`)}let v=n.querySelector(".task-card__project-indicator"),T=n.querySelector(".task-card__project-indicator-placeholder");e.projectSubtasksService.isTaskUsedAsProject(t.path).then(M=>{if(M&&!v&&!T){let E=n.createEl("div",{cls:"task-card__project-indicator",attr:{"aria-label":"This task is used as a project (click to filter subtasks)",title:"This task is used as a project (click to filter subtasks)"}});(0,ne.setIcon)(E,"folder"),E.addEventListener("click",async S=>{S.stopPropagation();try{await e.applyProjectSubtaskFilter(t)}catch(O){console.error("Error filtering project subtasks:",O),new ne.Notice("Failed to filter project subtasks")}});let C=n.querySelector(".task-card__recurring-indicator")||n.querySelector(".task-card__priority-dot")||n.querySelector(".task-card__status-dot");C==null||C.insertAdjacentElement("afterend",E)}else!M&&(v||T)&&(v==null||v.remove(),T==null||T.remove())}).catch(M=>{console.error("Error checking if task is used as project in update:",M)});let k=n.querySelector(".task-card__title");k&&(k.textContent=t.title,k.classList.toggle("completed",e.statusManager.isCompletedStatus(a)));let D=n.querySelector(".task-card__metadata");if(D){D.innerHTML="";let M=[];if(t.recurrence){let S=xn(t.recurrence),O=D.createEl("span");O.textContent=`Recurring: ${S}`,M.push(O)}if(t.due){let S=ka(t.due),O=Ut(t.due),F="";if(S){let x=Je(t.due,{dateFormat:"",timeFormat:"h:mm a",showTime:!0});x.trim()===""?F="Due: Today":F=`Due: Today at ${x}`}else O?F=`Due: ${Je(t.due,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})} (overdue)`:F=`Due: ${Je(t.due,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})}`;let P=D.createEl("span",{cls:"task-card__metadata-date task-card__metadata-date--due",text:F});Ad(P,t,e,"due"),M.push(P)}if(t.scheduled){let S=ka(t.scheduled),O=Ut(t.scheduled),F="";if(S){let x=Je(t.scheduled,{dateFormat:"",timeFormat:"h:mm a",showTime:!0});x.trim()===""?F="Scheduled: Today":F=`Scheduled: Today at ${x}`}else O?F=`Scheduled: ${Je(t.scheduled,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})} (past)`:F=`Scheduled: ${Je(t.scheduled,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})}`;let P=D.createEl("span",{cls:"task-card__metadata-date task-card__metadata-date--scheduled",text:F});Ad(P,t,e,"scheduled"),M.push(P)}if(t.contexts&&t.contexts.length>0){let S=D.createEl("span");S.textContent=`@${t.contexts.join(", @")}`,M.push(S)}let E=Ot(t.projects||[]);if(E.length>0){let S=D.createEl("span");$T(S,E,e),M.push(S)}let C=Na(t.timeEntries||[]);if(t.timeEstimate||C>0){let S=[];C>0&&S.push(`${e.formatTime(C)} spent`),t.timeEstimate&&S.push(`${e.formatTime(t.timeEstimate)} estimated`);let O=D.createEl("span");O.textContent=S.join(", "),M.push(O)}if(M.length>0){for(let S=1;S<M.length;S++){let O=D.createEl("span",{cls:"task-card__metadata-separator",text:" \u2022 "});M[S].insertAdjacentElement("beforebegin",O)}D.style.display=""}else D.style.display="none"}}async function jT(n,t){return new Promise((e,r)=>{new Zp(t.app,n,t,async()=>{try{await t.taskService.deleteTask(n),e()}catch(s){r(s)}}).open()})}function $0(n){return n.startsWith("[[")&&n.endsWith("]]")}function $T(n,t,e){n.innerHTML="",t.forEach((r,i)=>{if(i>0){let a=document.createTextNode(", ");n.appendChild(a)}let s=document.createTextNode("+");if(n.appendChild(s),$0(r)){let a=r.slice(2,-2),o=n.createEl("a",{cls:"task-card__project-link internal-link",text:a,attr:{"data-href":a,role:"button",tabindex:"0"}});o.addEventListener("click",async l=>{l.preventDefault(),l.stopPropagation();try{let c=e.app.metadataCache.getFirstLinkpathDest(a,"");c instanceof ne.TFile?await e.app.workspace.getLeaf(!1).openFile(c):new ne.Notice(`Note "${a}" not found`)}catch(c){console.error("Error opening project link:",c),new ne.Notice(`Failed to open note "${a}"`)}}),o.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),o.click())}),o.addEventListener("mouseover",l=>{let c=e.app.metadataCache.getFirstLinkpathDest(a,"");c instanceof ne.TFile&&e.app.workspace.trigger("hover-link",{event:l,source:"tasknotes-project-link",hoverParent:n,targetEl:o,linktext:a,sourcePath:c.path})})}else{let a=document.createTextNode(r);n.appendChild(a)}})}var ne,Jp,Zp,ui=_(()=>{ne=require("obsidian");at();we();hd();fd();md();Jp={showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1};Zp=class extends ne.Modal{constructor(e,r,i,s){super(e);this.task=r,this.plugin=i,this.onConfirm=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Delete Task"});let r=e.createEl("p");r.appendText('Are you sure you want to delete the task "'),r.createEl("strong",{text:this.task.title}),r.appendText('"?'),e.createEl("p",{cls:"mod-warning",text:"This action cannot be undone. The task file will be permanently deleted."});let i=e.createEl("div",{cls:"modal-button-container"});i.style.display="flex",i.style.gap="10px",i.style.justifyContent="flex-end",i.style.marginTop="20px";let s=i.createEl("button",{text:"Cancel"});s.addEventListener("click",()=>{this.close()});let a=i.createEl("button",{text:"Delete",cls:"mod-warning"});a.style.backgroundColor="var(--color-red)",a.style.color="white",a.addEventListener("click",async()=>{try{await this.onConfirm(),this.close(),new ne.Notice("Task deleted successfully")}catch(o){let l=o instanceof Error?o.message:String(o);new ne.Notice(`Failed to delete task: ${l}`),console.error("Error in delete confirmation:",o)}}),s.focus()}onClose(){let{contentEl:e}=this;e.empty()}}});var XT={};pi(XT,{TaskLinkDetectionService:()=>hl});var ta,hl,tm=_(()=>{ta=require("obsidian"),hl=class{constructor(t){this.linkCache=new Map;this.plugin=t}async detectTaskLink(t,e){let r=this.parseWikilink(t);if(!r)return{isValidTaskLink:!1};let{linkPath:i,displayText:s}=r,a=`${e}:${i}`,o=this.linkCache.get(a);if(o){let u=this.plugin.app.vault.getAbstractFileByPath(i);if(u instanceof ta.TFile&&u.stat.mtime===o.lastModified)return o.result}let l=this.resolveLinkPath(i,e);if(!l){let u={isValidTaskLink:!1};return this.cacheResult(a,u,0),u}let c=this.plugin.app.vault.getAbstractFileByPath(l);if(!(c instanceof ta.TFile)){let u={isValidTaskLink:!1};return this.cacheResult(a,u,0),u}try{let u=await this.plugin.cacheManager.getTaskInfo(l);if(u){let h={isValidTaskLink:!0,taskPath:l,taskInfo:u,displayText:s};return this.cacheResult(a,h,c.stat.mtime),h}}catch(u){console.debug("TaskLinkDetectionService: Error checking task info for link:",l,u)}let d={isValidTaskLink:!1};return this.cacheResult(a,d,c.stat.mtime),d}parseWikilink(t){let e=t.slice(2,-2).trim();if(!e)return null;let r=e.indexOf("|");if(r!==-1){let s=e.slice(0,r).trim(),a=e.slice(r+1).trim();return!s||!a?null:{linkPath:(0,ta.parseLinktext)(s).path,displayText:a}}let i=(0,ta.parseLinktext)(e);return{linkPath:i.path,displayText:i.subpath||void 0}}resolveLinkPath(t,e){try{let r=this.plugin.app.metadataCache.getFirstLinkpathDest(t,e);return(r==null?void 0:r.path)||null}catch(r){return console.debug("Error resolving link path:",t,r),null}}cacheResult(t,e,r){if(this.linkCache.set(t,{result:e,lastModified:r}),this.linkCache.size>1e3){let i=this.linkCache.keys().next().value;this.linkCache.delete(i)}}clearCacheForFile(t){for(let[e]of this.linkCache)e.includes(t)&&this.linkCache.delete(e)}clearCache(){this.linkCache.clear()}findWikilinks(t){let e=[],r=/\[\[([^\]]+)\]\]/g,i;for(;(i=r.exec(t))!==null;)e.push({match:i[0],start:i.index,end:i.index+i[0].length});return e}cleanup(){this.linkCache.clear()}}});var eE,Ue,sn,rm=_(()=>{eE=require("@codemirror/view"),Ue=require("obsidian");we();at();Wd();hd();fd();md();sn=class extends eE.WidgetType{constructor(e,r,i,s){super();this.taskInfo=e,this.plugin=r,this.originalText=i,this.displayText=s}toDOM(e){let r=document.createElement("span"),i=this.plugin.selectedDate||new Date,s=this.taskInfo.recurrence?Gr(this.taskInfo,i):this.taskInfo.status,a=["tasknotes-plugin","task-inline-preview"];this.taskInfo.priority&&a.push(`task-inline-preview--priority-${this.taskInfo.priority}`),this.plugin.statusManager.isCompletedStatus(s)&&a.push("task-inline-preview--completed"),r.className=a.join(" ");let o=this.plugin.statusManager.getStatusConfig(s),l=r.createEl("span",{cls:"task-inline-preview__status-dot"});if((0,Ue.setTooltip)(l,`Status: ${o?o.label:s}`,{placement:"top"}),o&&(l.style.borderColor=o.color,this.plugin.statusManager.isCompletedStatus(s)?l.style.backgroundColor=o.color:l.style.backgroundColor="transparent"),l.addEventListener("click",async u=>{u.stopPropagation(),u.preventDefault();try{if(this.taskInfo.recurrence){let h=await this.plugin.toggleRecurringTaskComplete(this.taskInfo,i),f=Gr(h,i),p=this.plugin.statusManager.getStatusConfig(f),m=this.plugin.statusManager.isCompletedStatus(f);p&&(l.style.borderColor=p.color,m?l.style.backgroundColor=p.color:l.style.backgroundColor="transparent"),m?r.classList.add("task-inline-preview--completed"):r.classList.remove("task-inline-preview--completed"),this.taskInfo=h}else{let h=await this.plugin.cacheManager.getTaskInfo(this.taskInfo.path);if(!h)return;let f=h.status||"open",p=this.plugin.statusManager.getNextStatus(f);await this.plugin.updateTaskProperty(h,"status",p),this.taskInfo.status=p;let m=this.plugin.statusManager.getStatusConfig(p);m&&(l.style.borderColor=m.color),this.plugin.statusManager.isCompletedStatus(p)?(r.classList.add("task-inline-preview--completed"),m&&(l.style.backgroundColor=m.color)):(r.classList.remove("task-inline-preview--completed"),l.style.backgroundColor="transparent")}setTimeout(()=>{e&&typeof e.dispatch=="function"&&an(e,this.taskInfo.path)},50)}catch(h){console.error("Error cycling task status in inline widget:",h)}}),this.taskInfo.priority){let u=this.plugin.priorityManager.getPriorityConfig(this.taskInfo.priority);if(u){let h=r.createEl("span",{cls:"task-inline-preview__priority-dot task-card__priority-dot"});(0,Ue.setTooltip)(h,`Priority: ${u.label} (click to change)`,{placement:"top"}),h.style.backgroundColor=u.color,h.addEventListener("click",f=>{f.stopPropagation(),f.preventDefault(),new Hi({currentValue:this.taskInfo.priority,onSelect:async m=>{try{await this.plugin.updateTaskProperty(this.taskInfo,"priority",m),this.taskInfo.priority=m;let g=this.plugin.priorityManager.getPriorityConfig(m);g&&(h.style.backgroundColor=g.color,(0,Ue.setTooltip)(h,`Priority: ${g.label} (click to change)`,{placement:"top"}))}catch(g){console.error("Error updating priority:",g),new Ue.Notice("Failed to update priority")}},plugin:this.plugin}).show(f)})}}let c=this.taskInfo.title.length>80?this.taskInfo.title.slice(0,77)+"...":this.taskInfo.title;if(r.createEl("span",{cls:"task-inline-preview__title",text:c}),this.taskInfo.due){let u=Je(this.taskInfo.due,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0}),h=Je(this.taskInfo.due,{dateFormat:"MMM d, yyyy",timeFormat:"h:mm a",showTime:!0}),f=r.createEl("span",{cls:"task-inline-preview__date task-inline-preview__date--due task-card__metadata-date task-card__metadata-date--due"});(0,Ue.setTooltip)(f,`Due: ${h} (click to change)`,{placement:"top"});let p=f.createEl("span",{cls:"task-inline-preview__date-icon"});(0,Ue.setIcon)(p,"calendar"),f.appendText(u),f.addEventListener("click",m=>{m.stopPropagation(),m.preventDefault(),new oi({currentValue:Z(this.taskInfo.due||""),currentTime:It(this.taskInfo.due||""),onSelect:async(v,T)=>{try{let k;v?T?k=`${v}T${T}`:k=v:k=void 0,await this.plugin.updateTaskProperty(this.taskInfo,"due",k),this.taskInfo.due=k}catch(k){console.error("Error updating due date:",k),new Ue.Notice("Failed to update due date")}}}).show(m)})}if(this.taskInfo.scheduled&&(!this.taskInfo.due||this.taskInfo.scheduled!==this.taskInfo.due)){let u=Je(this.taskInfo.scheduled,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0}),h=Je(this.taskInfo.scheduled,{dateFormat:"MMM d, yyyy",timeFormat:"h:mm a",showTime:!0}),f=r.createEl("span",{cls:"task-inline-preview__date task-inline-preview__date--scheduled task-card__metadata-date task-card__metadata-date--scheduled"});(0,Ue.setTooltip)(f,`Scheduled: ${h} (click to change)`,{placement:"top"});let p=f.createEl("span",{cls:"task-inline-preview__date-icon"});(0,Ue.setIcon)(p,"clock"),f.appendText(u),f.addEventListener("click",m=>{m.stopPropagation(),m.preventDefault(),new oi({currentValue:Z(this.taskInfo.scheduled||""),currentTime:It(this.taskInfo.scheduled||""),onSelect:async(v,T)=>{try{let k;v?T?k=`${v}T${T}`:k=v:k=void 0,await this.plugin.updateTaskProperty(this.taskInfo,"scheduled",k),this.taskInfo.scheduled=k}catch(k){console.error("Error updating scheduled date:",k),new Ue.Notice("Failed to update scheduled date")}}}).show(m)})}if(this.taskInfo.recurrence){let u=r.createEl("span",{cls:"task-inline-preview__recurring-indicator",attr:{"aria-label":"Recurring task (click to change)"}});(0,Ue.setTooltip)(u,"Recurring task (click to change)",{placement:"top"}),(0,Ue.setIcon)(u,"rotate-ccw"),u.addEventListener("click",h=>{h.stopPropagation(),h.preventDefault(),new Yi({currentValue:typeof this.taskInfo.recurrence=="string"?this.taskInfo.recurrence:void 0,onSelect:async p=>{try{await this.plugin.updateTaskProperty(this.taskInfo,"recurrence",p||void 0),this.taskInfo.recurrence=p||void 0}catch(m){console.error("Error updating recurrence:",m),new Ue.Notice("Failed to update recurrence")}},app:this.plugin.app}).show(h)})}let d=r.createEl("span",{cls:"task-inline-preview__pencil",text:""});return(0,Ue.setTooltip)(d,"Task options",{placement:"top"}),(0,Ue.setIcon)(d,"ellipsis-vertical"),r.dataset.taskPath=this.taskInfo.path,r.dataset.originalText=this.originalText,this.addDragHandlers(r),r.addEventListener("click",async u=>{u.preventDefault(),u.stopPropagation();let h=u.target;if(h===d||d.contains(h)||h.closest(".task-inline-preview__pencil")){this.showTaskContextMenu(u,r);return}if(u.ctrlKey||u.metaKey){let f=this.plugin.app.vault.getAbstractFileByPath(this.taskInfo.path);f instanceof Ue.TFile&&this.plugin.app.workspace.getLeaf(!1).openFile(f)}else await this.plugin.openTaskEditModal(this.taskInfo)}),r.addEventListener("contextmenu",async u=>{u.preventDefault(),u.stopPropagation(),await this.showTaskContextMenu(u,r)}),r.addEventListener("mouseover",u=>{this.plugin.app.vault.getAbstractFileByPath(this.taskInfo.path)&&this.plugin.app.workspace.trigger("hover-link",{event:u,source:"tasknotes-task-card",hoverParent:r,targetEl:r,linktext:this.taskInfo.path,sourcePath:this.taskInfo.path})}),r}addDragHandlers(e){this.plugin.dragDropManager.makeTaskCardDraggable(e,this.taskInfo.path)}async showTaskContextMenu(e,r){try{let{showTaskContextMenu:i}=await Promise.resolve().then(()=>(ui(),Xp)),s=this.plugin.selectedDate||new Date;await i(e,this.taskInfo.path,this.plugin,s)}catch(i){console.error(`Error showing context menu for task ${this.taskInfo.path}:`,i),await this.plugin.openTaskEditModal(this.taskInfo)}}eq(e){return e instanceof sn?this.taskInfo.path===e.taskInfo.path&&this.taskInfo.status===e.taskInfo.status&&this.taskInfo.title===e.taskInfo.title&&this.taskInfo.priority===e.taskInfo.priority&&this.taskInfo.archived===e.taskInfo.archived&&this.taskInfo.due===e.taskInfo.due&&this.taskInfo.scheduled===e.taskInfo.scheduled&&this.taskInfo.recurrence===e.taskInfo.recurrence&&JSON.stringify(this.taskInfo.complete_instances)===JSON.stringify(e.taskInfo.complete_instances)&&this.taskInfo.dateModified===e.taskInfo.dateModified:!1}ignoreEvent(){return!1}get estimatedHeight(){return-1}get block(){return!1}}});function J0(n){let t=new Map;return Rr.ViewPlugin.fromClass(class{constructor(e){this.decorations=this.buildDecorations(e)}update(e){var i,s;if(!((i=n==null?void 0:n.settings)!=null&&i.enableTaskLinkOverlay)){this.decorations=Rr.Decoration.none;return}try{if(!e.state.field(on.editorLivePreviewField)){this.decorations=Rr.Decoration.none;return}}catch(a){console.debug("Error checking live preview mode:",a),this.decorations=Rr.Decoration.none;return}let r=e.transactions.some(a=>a.effects.some(o=>o.is(im)));if(e.docChanged||e.selectionSet||r){if(r){let a=(s=e.transactions.flatMap(o=>o.effects).find(o=>o.is(im)))==null?void 0:s.value;if(a!=null&&a.taskPath)for(let[o]of t.entries())o.includes(a.taskPath)&&t.delete(o);else t.clear()}this.decorations=this.buildDecorations(e.view)}}buildDecorations(e){var r;try{return(r=n==null?void 0:n.settings)!=null&&r.enableTaskLinkOverlay?e.state.field(on.editorLivePreviewField)?X0(e.state,n,t):Rr.Decoration.none:Rr.Decoration.none}catch(i){return console.error("Error building task link decorations:",i),Rr.Decoration.none}}},{decorations:e=>e.decorations})}function X0(n,t,e){var l,c;let r=new jd.RangeSetBuilder;if(!n||!t||!e)return console.warn("Invalid inputs for building task link decorations"),r.finish();let i=n.doc;if(!i)return console.warn("Invalid document state"),r.finish();if(!t.app||!t.app.workspace)return console.warn("Plugin app or workspace not available"),r.finish();let s=t.taskLinkDetectionService||new hl(t),a=t.app.workspace.getActiveViewOfType(on.MarkdownView);if(!a)return r.finish();let o=(l=a.file)==null?void 0:l.path;if(!o)return r.finish();if(typeof o!="string"||o.length===0)return console.warn("Invalid current file path"),r.finish();try{let d=i.toString();if(typeof d!="string")return console.warn("Invalid document text"),r.finish();if(d.length>1e5)return console.warn("Document too large for task link processing, skipping"),r.finish();let u=(c=n.selection)==null?void 0:c.main.head,h=s.findWikilinks(d);if(!Array.isArray(h))return console.warn("Invalid wikilinks result from detection service"),r.finish();for(let f of h)try{if(!f||typeof f.match!="string"||typeof f.start!="number"||typeof f.end!="number"){console.debug("Invalid wikilink object:",f);continue}if(f.start<0||f.end<=f.start||f.start>=d.length||f.end>d.length){console.debug("Invalid wikilink positions:",f.start,f.end);continue}let p=eA(f.match);if(!p)continue;let{linkPath:m}=p;if(!m||typeof m!="string"||m.trim().length===0){console.debug("Invalid link path:",m);continue}let g=tA(m,o,t);if(!g)continue;let v=rA(g,t);if(v){if(!v.title||typeof v.title!="string"){console.debug("Invalid task info for:",g);continue}if(u!==void 0&&u>=f.start&&u<=f.end){console.debug("Cursor is within wikilink range, skipping decoration to show plain text");continue}let T=`${g}-${f.start}-${f.end}`,k=new sn(v,t,f.match,p.displayText),D=e.get(T);(!D||!D.eq(k))&&e.set(T,k);let M=Rr.Decoration.replace({widget:e.get(T),inclusive:!0});r.add(f.start,f.end,M)}}catch(p){console.debug("Error processing wikilink:",f.match,p);continue}}catch(d){console.error("Error in buildTaskLinkDecorations:",d)}return r.finish()}function eA(n){if(!n||typeof n!="string"||n.length<4||!n.startsWith("[[")||!n.endsWith("]]"))return null;let t=n.slice(2,-2).trim();if(!t||t.length===0)return null;if(t.length>500)return console.debug("Wikilink content too long, skipping:",t.length),null;let e=t.indexOf("|");if(e!==-1){let i=t.slice(0,e).trim(),s=t.slice(e+1).trim();if(!i||!s)return null;let a=(0,on.parseLinktext)(i);return a.path?{linkPath:a.path,displayText:s}:null}let r=(0,on.parseLinktext)(t);return r.path?{linkPath:r.path,displayText:r.subpath||void 0}:null}function tA(n,t,e){if(!n||typeof n!="string"||n.trim().length===0||!t||typeof t!="string"||!e||!e.app||!e.app.metadataCache)return null;try{let r=n.replace(/\.\./g,"").trim();if(!r)return null;let i=e.app.metadataCache.getFirstLinkpathDest(r,t);return!i||!i.path||typeof i.path!="string"?null:i.path}catch(r){return console.debug("Error resolving link path:",n,r),null}}function rA(n,t){if(!n||typeof n!="string"||n.trim().length===0||!t)return null;try{if(n.length>260)return console.debug("File path too long:",n.length),null;let e=/[<>:"|?*]/,r=n.split("").some(a=>{let o=a.charCodeAt(0);return o<=31||o===127});if(e.test(n)||r)return console.debug("File path contains invalid characters:",n),null;let i=t.cacheManager;if(!i||!i.getCachedTaskInfoSync)return null;let s=i.getCachedTaskInfoSync(n);return s&&typeof s=="object"&&s.title?s:null}catch(e){return console.debug("Error getting task info for:",n,e),null}}function tE(n){return J0(n)}function an(n,t){if(!n||typeof n.dispatch!="function"){console.warn("Invalid EditorView passed to dispatchTaskUpdate:",n);return}try{n.dispatch({effects:[im.of({taskPath:t})]})}catch(e){console.error("Error dispatching task update:",e)}}var jd,Rr,on,im,Wd=_(()=>{jd=require("@codemirror/state"),Rr=require("@codemirror/view"),on=require("obsidian");tm();rm();im=jd.StateEffect.define()});var sE=vl((b$,lm)=>{var y;(function(){typeof lm=="object"?y=lm.exports:typeof HTMLScriptElement!="undefined"&&"noModule"in HTMLScriptElement.prototype?window.ICAL=y={}:typeof y!="object"&&(y={})})();y.foldLength=75;y.newLineChar=`\r
`;y.helpers={updateTimezones:function(n){var t,e,r,i,s,a;if(!n||n.name!=="vcalendar")return n;for(t=n.getAllSubcomponents(),e=[],r={},s=0;s<t.length;s++)t[s].name==="vtimezone"?(a=t[s].getFirstProperty("tzid").getFirstValue(),r[a]=t[s]):e=e.concat(t[s].getAllProperties());for(i={},s=0;s<e.length;s++)(a=e[s].getParameter("tzid"))&&(i[a]=!0);for(s in r)r.hasOwnProperty(s)&&!i[s]&&n.removeSubcomponent(r[s]);for(s in i)i.hasOwnProperty(s)&&!r[s]&&y.TimezoneService.has(s)&&n.addSubcomponent(y.TimezoneService.get(s).component);return n},isStrictlyNaN:function(n){return typeof n=="number"&&isNaN(n)},strictParseInt:function(n){var t=parseInt(n,10);if(y.helpers.isStrictlyNaN(t))throw new Error('Could not extract integer from "'+n+'"');return t},formatClassType:function(t,e){if(typeof t!="undefined")return t instanceof e?t:new e(t)},unescapedIndexOf:function(n,t,e){for(;(e=n.indexOf(t,e))!==-1;)if(e>0&&n[e-1]==="\\")e+=1;else return e;return-1},binsearchInsert:function(n,t,e){if(!n.length)return 0;for(var r=0,i=n.length-1,s,a;r<=i;)if(s=r+Math.floor((i-r)/2),a=e(t,n[s]),a<0)i=s-1;else if(a>0)r=s+1;else break;return a<0?s:a>0?s+1:s},dumpn:function(){y.debug&&(typeof console!="undefined"&&"log"in console?y.helpers.dumpn=function(t){console.log(t)}:y.helpers.dumpn=function(t){dump(t+`
`)},y.helpers.dumpn(arguments[0]))},clone:function(n,t){if(!n||typeof n!="object")return n;if(n instanceof Date)return new Date(n.getTime());if("clone"in n)return n.clone();if(Array.isArray(n)){for(var e=[],r=0;r<n.length;r++)e.push(t?y.helpers.clone(n[r],!0):n[r]);return e}else{var i={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t?i[s]=y.helpers.clone(n[s],!0):i[s]=n[s]);return i}},foldline:function(t){for(var e="",r=t||"",i=0,s=0;r.length;){var a=r.codePointAt(i);a<128?++s:a<2048?s+=2:a<65536?s+=3:s+=4,s<y.foldLength+1?i+=a>65535?2:1:(e+=y.newLineChar+" "+r.substring(0,i),r=r.substring(i),i=s=0)}return e.substr(y.newLineChar.length+1)},pad2:function(t){typeof t!="string"&&(typeof t=="number"&&(t=parseInt(t)),t=String(t));var e=t.length;switch(e){case 0:return"00";case 1:return"0"+t;default:return t}},trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)},inherits:function(n,t,e){function r(){}r.prototype=n.prototype,t.prototype=new r,e&&y.helpers.extend(e,t.prototype)},extend:function(n,t){for(var e in n){var r=Object.getOwnPropertyDescriptor(n,e);r&&!Object.getOwnPropertyDescriptor(t,e)&&Object.defineProperty(t,e,r)}return t}};y.design=function(){"use strict";var n=/\\\\|\\;|\\,|\\[Nn]/g,t=/\\|;|,|\n/g,e=/\\\\|\\,|\\[Nn]/g,r=/\\|,|\n/g;function i(w,R){var U={matches:/.*/,fromICAL:function(Y,te){return g(Y,w,te)},toICAL:function(Y,te){var re=R;return te&&(re=new RegExp(re.source+"|"+te)),Y.replace(re,function(ge){switch(ge){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case`
`:return"\\n";default:return ge}})}};return U}var s={defaultType:"text"},a={defaultType:"text",multiValue:","},o={defaultType:"text",structuredValue:";"},l={defaultType:"integer"},c={defaultType:"date-time",allowedTypes:["date-time","date"]},d={defaultType:"date-time"},u={defaultType:"uri"},h={defaultType:"utc-offset"},f={defaultType:"recur"},p={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function m(w){switch(w){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return`
`;default:return w}}function g(w,R,U){return w.indexOf("\\")===-1?w:(U&&(R=new RegExp(R.source+"|\\\\"+U)),w.replace(R,m))}var v={categories:a,url:u,version:s,uid:s},T={boolean:{values:["TRUE","FALSE"],fromICAL:function(w){switch(w){case"TRUE":return!0;case"FALSE":return!1;default:return!1}},toICAL:function(w){return w?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(w){var R=parseFloat(w);return y.helpers.isStrictlyNaN(R)?0:R},toICAL:function(w){return String(w)}},integer:{fromICAL:function(w){var R=parseInt(w);return y.helpers.isStrictlyNaN(R)?0:R},toICAL:function(w){return String(w)}},"utc-offset":{toICAL:function(w){return w.length<7?w.substr(0,3)+w.substr(4,2):w.substr(0,3)+w.substr(4,2)+w.substr(7,2)},fromICAL:function(w){return w.length<6?w.substr(0,3)+":"+w.substr(3,2):w.substr(0,3)+":"+w.substr(3,2)+":"+w.substr(5,2)},decorate:function(w){return y.UtcOffset.fromString(w)},undecorate:function(w){return w.toString()}}},k={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},D=y.helpers.extend(T,{text:i(n,t),uri:{},binary:{decorate:function(w){return y.Binary.fromString(w)},undecorate:function(w){return w.toString()}},"cal-address":{},date:{decorate:function(w,R){return H.strict?y.Time.fromDateString(w,R):y.Time.fromString(w,R)},undecorate:function(w){return w.toString()},fromICAL:function(w){return!H.strict&&w.length>=15?D["date-time"].fromICAL(w):w.substr(0,4)+"-"+w.substr(4,2)+"-"+w.substr(6,2)},toICAL:function(w){var R=w.length;return R==10?w.substr(0,4)+w.substr(5,2)+w.substr(8,2):R>=19?D["date-time"].toICAL(w):w}},"date-time":{fromICAL:function(w){if(!H.strict&&w.length==8)return D.date.fromICAL(w);var R=w.substr(0,4)+"-"+w.substr(4,2)+"-"+w.substr(6,2)+"T"+w.substr(9,2)+":"+w.substr(11,2)+":"+w.substr(13,2);return w[15]&&w[15]==="Z"&&(R+="Z"),R},toICAL:function(w){var R=w.length;if(R==10&&!H.strict)return D.date.toICAL(w);if(R>=19){var U=w.substr(0,4)+w.substr(5,2)+w.substr(8,5)+w.substr(14,2)+w.substr(17,2);return w[19]&&w[19]==="Z"&&(U+="Z"),U}else return w},decorate:function(w,R){return H.strict?y.Time.fromDateTimeString(w,R):y.Time.fromString(w,R)},undecorate:function(w){return w.toString()}},duration:{decorate:function(w){return y.Duration.fromString(w)},undecorate:function(w){return w.toString()}},period:{fromICAL:function(w){var R=w.split("/");return R[0]=D["date-time"].fromICAL(R[0]),y.Duration.isValueString(R[1])||(R[1]=D["date-time"].fromICAL(R[1])),R},toICAL:function(w){return!H.strict&&w[0].length==10?w[0]=D.date.toICAL(w[0]):w[0]=D["date-time"].toICAL(w[0]),y.Duration.isValueString(w[1])||(!H.strict&&w[1].length==10?w[1]=D.date.toICAL(w[1]):w[1]=D["date-time"].toICAL(w[1])),w.join("/")},decorate:function(w,R){return y.Period.fromJSON(w,R,!H.strict)},undecorate:function(w){return w.toJSON()}},recur:{fromICAL:function(w){return y.Recur._stringToData(w,!0)},toICAL:function(w){var R="";for(var U in w)if(Object.prototype.hasOwnProperty.call(w,U)){var Y=w[U];U=="until"?Y.length>10?Y=D["date-time"].toICAL(Y):Y=D.date.toICAL(Y):U=="wkst"?typeof Y=="number"&&(Y=y.Recur.numericDayToIcalDay(Y)):Array.isArray(Y)&&(Y=Y.join(",")),R+=U.toUpperCase()+"="+Y+";"}return R.substr(0,R.length-1)},decorate:function(R){return y.Recur.fromData(R)},undecorate:function(w){return w.toJSON()}},time:{fromICAL:function(w){if(w.length<6)return w;var R=w.substr(0,2)+":"+w.substr(2,2)+":"+w.substr(4,2);return w[6]==="Z"&&(R+="Z"),R},toICAL:function(w){if(w.length<8)return w;var R=w.substr(0,2)+w.substr(3,2)+w.substr(6,2);return w[8]==="Z"&&(R+="Z"),R}}}),M=y.helpers.extend(v,{action:s,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:s,class:s,comment:s,completed:d,contact:s,created:d,description:s,dtend:c,dtstamp:d,dtstart:c,due:c,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:f,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":d,location:s,method:s,organizer:{defaultType:"cal-address"},"percent-complete":l,priority:l,prodid:s,"related-to":s,repeat:l,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(w){return w.indexOf("/")!==-1?"period":w.indexOf("T")===-1?"date":"date-time"}},"recurrence-id":c,resources:a,"request-status":o,rrule:f,sequence:l,status:s,summary:s,transp:s,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:h,tzoffsetto:h,tzurl:u,tzid:s,tzname:s}),E=y.helpers.extend(T,{text:i(e,r),uri:i(e,r),date:{decorate:function(w){return y.VCardTime.fromDateAndOrTimeString(w,"date")},undecorate:function(w){return w.toString()},fromICAL:function(w){return w.length==8?D.date.fromICAL(w):w[0]=="-"&&w.length==6?w.substr(0,4)+"-"+w.substr(4):w},toICAL:function(w){return w.length==10?D.date.toICAL(w):w[0]=="-"&&w.length==7?w.substr(0,4)+w.substr(5):w}},time:{decorate:function(w){return y.VCardTime.fromDateAndOrTimeString("T"+w,"time")},undecorate:function(w){return w.toString()},fromICAL:function(w){var R=E.time._splitZone(w,!0),U=R[0],Y=R[1];return Y.length==6?Y=Y.substr(0,2)+":"+Y.substr(2,2)+":"+Y.substr(4,2):Y.length==4&&Y[0]!="-"?Y=Y.substr(0,2)+":"+Y.substr(2,2):Y.length==5&&(Y=Y.substr(0,3)+":"+Y.substr(3,2)),U.length==5&&(U[0]=="-"||U[0]=="+")&&(U=U.substr(0,3)+":"+U.substr(3)),Y+U},toICAL:function(w){var R=E.time._splitZone(w),U=R[0],Y=R[1];return Y.length==8?Y=Y.substr(0,2)+Y.substr(3,2)+Y.substr(6,2):Y.length==5&&Y[0]!="-"?Y=Y.substr(0,2)+Y.substr(3,2):Y.length==6&&(Y=Y.substr(0,3)+Y.substr(4,2)),U.length==6&&(U[0]=="-"||U[0]=="+")&&(U=U.substr(0,3)+U.substr(4)),Y+U},_splitZone:function(w,R){var U=w.length-1,Y=w.length-(R?5:6),te=w[Y],re,ge;return w[U]=="Z"?(re=w[U],ge=w.substr(0,U)):w.length>6&&(te=="-"||te=="+")?(re=w.substr(Y),ge=w.substr(0,Y)):(re="",ge=w),[re,ge]}},"date-time":{decorate:function(w){return y.VCardTime.fromDateAndOrTimeString(w,"date-time")},undecorate:function(w){return w.toString()},fromICAL:function(w){return E["date-and-or-time"].fromICAL(w)},toICAL:function(w){return E["date-and-or-time"].toICAL(w)}},"date-and-or-time":{decorate:function(w){return y.VCardTime.fromDateAndOrTimeString(w,"date-and-or-time")},undecorate:function(w){return w.toString()},fromICAL:function(w){var R=w.split("T");return(R[0]?E.date.fromICAL(R[0]):"")+(R[1]?"T"+E.time.fromICAL(R[1]):"")},toICAL:function(w){var R=w.split("T");return E.date.toICAL(R[0])+(R[1]?"T"+E.time.toICAL(R[1]):"")}},timestamp:D["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/}}),C={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},S=y.helpers.extend(v,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:p,bday:p,caladruri:u,caluri:u,clientpidmap:o,email:s,fburl:u,fn:s,gender:o,geo:u,impp:u,key:u,kind:s,lang:{defaultType:"language-tag"},logo:u,member:u,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:a,note:s,org:{defaultType:"text",structuredValue:";"},photo:u,related:u,rev:{defaultType:"timestamp"},role:s,sound:u,source:u,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:s,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:s}),O=y.helpers.extend(T,{binary:D.binary,date:E.date,"date-time":E["date-time"],"phone-number":{},uri:D.uri,text:D.text,time:D.time,vcard:D.text,"utc-offset":{toICAL:function(w){return w.substr(0,7)},fromICAL:function(w){return w.substr(0,7)},decorate:function(w){return y.UtcOffset.fromString(w)},undecorate:function(w){return w.toString()}}}),F={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},P=y.helpers.extend(v,{fn:s,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:a,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(w){return w.indexOf("T")===-1?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:s,tel:{defaultType:"phone-number"},email:s,mailer:s,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:s,role:s,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:o,note:a,prodid:s,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(w){return w.indexOf("T")===-1?"date":"date-time"}},"sort-string":s,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:s,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),x={value:D,param:k,property:M},B={value:E,param:C,property:S},L={value:O,param:F,property:P},H={strict:!0,defaultSet:x,defaultType:"unknown",components:{vcard:B,vcard3:L,vevent:x,vtodo:x,vjournal:x,valarm:x,vtimezone:x,daylight:x,standard:x},icalendar:x,vcard:B,vcard3:L,getDesignSet:function(w){var R=w&&w in H.components;return R?H.components[w]:H.defaultSet}};return H}();y.stringify=function(){"use strict";var n=`\r
`,t="unknown",e=y.design,r=y.helpers;function i(a){typeof a[0]=="string"&&(a=[a]);for(var o=0,l=a.length,c="";o<l;o++)c+=i.component(a[o])+n;return c}i.component=function(a,o){var l=a[0].toUpperCase(),c="BEGIN:"+l+n,d=a[1],u=0,h=d.length,f=a[0];for(f==="vcard"&&a[1].length>0&&!(a[1][0][0]==="version"&&a[1][0][3]==="4.0")&&(f="vcard3"),o=o||e.getDesignSet(f);u<h;u++)c+=i.property(d[u],o)+n;for(var p=a[2]||[],m=0,g=p.length;m<g;m++)c+=i.component(p[m],o)+n;return c+="END:"+l,c},i.property=function(a,o,l){var c=a[0].toUpperCase(),d=a[0],u=a[1],h=c,f;for(f in u){var p=u[f];if(u.hasOwnProperty(f)){var v=f in o.param&&o.param[f].multiValue;v&&Array.isArray(p)?(o.param[f].multiValueSeparateDQuote&&(v='"'+v+'"'),p=p.map(i._rfc6868Unescape),p=i.multiValue(p,v,"unknown",null,o)):p=i._rfc6868Unescape(p),h+=";"+f.toUpperCase(),h+="="+i.propertyValue(p)}}if(a.length===3)return h+":";var m=a[2];o||(o=e.defaultSet);var g,v=!1,T=!1,k=!1;return d in o.property?(g=o.property[d],"multiValue"in g&&(v=g.multiValue),"structuredValue"in g&&Array.isArray(a[3])&&(T=g.structuredValue),"defaultType"in g?m===g.defaultType&&(k=!0):m===t&&(k=!0)):m===t&&(k=!0),k||(h+=";VALUE="+m.toUpperCase()),h+=":",v&&T?h+=i.multiValue(a[3],T,m,v,o,T):v?h+=i.multiValue(a.slice(3),v,m,null,o,!1):T?h+=i.multiValue(a[3],T,m,null,o,T):h+=i.value(a[3],m,o,!1),l?h:y.helpers.foldline(h)},i.propertyValue=function(a){return r.unescapedIndexOf(a,",")===-1&&r.unescapedIndexOf(a,":")===-1&&r.unescapedIndexOf(a,";")===-1?a:'"'+a+'"'},i.multiValue=function(a,o,l,c,d,u){for(var h="",f=a.length,p=0;p<f;p++)c&&Array.isArray(a[p])?h+=i.multiValue(a[p],c,l,null,d,u):h+=i.value(a[p],l,d,u),p!==f-1&&(h+=o);return h},i.value=function(a,o,l,c){return o in l.value&&"toICAL"in l.value[o]?l.value[o].toICAL(a,c):a},i._rfc6868Unescape=function(a){return a.replace(/[\n^"]/g,function(o){return s[o]})};var s={'"':"^'","\n":"^n","^":"^^"};return i}();y.parse=function(){"use strict";var n=/[^ \t]/,t=",",e=":",r=";",i="=",s="unknown",a="text",o=y.design,l=y.helpers;function c(h){this.message=h,this.name="ParserError";try{throw new Error}catch(p){if(p.stack){var f=p.stack.split(`
`);f.shift(),this.stack=f.join(`
`)}}}c.prototype=Error.prototype;function d(h){var f={},p=f.component=[];if(f.stack=[p],d._eachLine(h,function(m,g){d._handleContentLine(g,f)}),f.stack.length>1)throw new c("invalid ical body. component began but did not end");return f=null,p.length==1?p[0]:p}d.property=function(h,f){var p={component:[[],[]],designSet:f||o.defaultSet};return d._handleContentLine(h,p),p.component[1][0]},d.component=function(h){return d(h)},d.ParserError=c,d._handleContentLine=function(h,f){var p=h.indexOf(e),m=h.indexOf(r),g,v,T,k,D={};m!==-1&&p!==-1&&m>p&&(m=-1);var M;if(m!==-1){if(T=h.substring(0,m).toLowerCase(),M=d._parseParameters(h.substring(m),0,f.designSet),M[2]==-1)throw new c("Invalid parameters in '"+h+"'");if(D=M[0],g=M[1].length+M[2]+m,(v=h.substring(g).indexOf(e))!==-1)k=h.substring(g+v+1);else throw new c("Missing parameter value in '"+h+"'")}else if(p!==-1){if(T=h.substring(0,p).toLowerCase(),k=h.substring(p+1),T==="begin"){var E=[k.toLowerCase(),[],[]];f.stack.length===1?f.component.push(E):f.component[2].push(E),f.stack.push(f.component),f.component=E,f.designSet||(f.designSet=o.getDesignSet(f.component[0]));return}else if(T==="end"){f.component=f.stack.pop();return}}else throw new c('invalid line (no token ";" or ":") "'+h+'"');var C,S=!1,O=!1,F;T in f.designSet.property&&(F=f.designSet.property[T],"multiValue"in F&&(S=F.multiValue),"structuredValue"in F&&(O=F.structuredValue),k&&"detectType"in F&&(C=F.detectType(k))),C||("value"in D?C=D.value.toLowerCase():F?C=F.defaultType:C=s),delete D.value;var P;S&&O?(k=d._parseMultiValue(k,O,C,[],S,f.designSet,O),P=[T,D,C,k]):S?(P=[T,D,C],d._parseMultiValue(k,S,C,P,null,f.designSet,!1)):O?(k=d._parseMultiValue(k,O,C,[],null,f.designSet,O),P=[T,D,C,k]):(k=d._parseValue(k,C,f.designSet,!1),P=[T,D,C,k]),f.component[0]==="vcard"&&f.component[1].length===0&&!(T==="version"&&k==="4.0")&&(f.designSet=o.getDesignSet("vcard3")),f.component[1].push(P)},d._parseValue=function(h,f,p,m){return f in p.value&&"fromICAL"in p.value[f]?p.value[f].fromICAL(h,m):h},d._parseParameters=function(h,f,p){for(var m=f,g=0,v=i,T={},k,D,M,E=-1,C,S,O;g!==!1&&(g=l.unescapedIndexOf(h,v,g+1))!==-1;){if(k=h.substr(m+1,g-m-1),k.length==0)throw new c("Empty parameter name in '"+h+"'");D=k.toLowerCase(),O=!1,S=!1,D in p.param&&p.param[D].valueType?C=p.param[D].valueType:C=a,D in p.param&&(S=p.param[D].multiValue,p.param[D].multiValueSeparateDQuote&&(O=d._rfc6868Escape('"'+S+'"')));var F=h[g+1];if(F==='"'){if(E=g+2,g=l.unescapedIndexOf(h,'"',E),S&&g!=-1)for(var P=!0;P;)h[g+1]==S&&h[g+2]=='"'?g=l.unescapedIndexOf(h,'"',g+3):P=!1;if(g===-1)throw new c('invalid line (no matching double quote) "'+h+'"');M=h.substr(E,g-E),m=l.unescapedIndexOf(h,r,g),m===-1&&(g=!1)}else{E=g+1;var x=l.unescapedIndexOf(h,r,E),B=l.unescapedIndexOf(h,e,E);B!==-1&&x>B?(x=B,g=!1):x===-1?(B===-1?x=h.length:x=B,g=!1):(m=x,g=x),M=h.substr(E,x-E)}if(M=d._rfc6868Escape(M),S){var L=O||S;M=d._parseMultiValue(M,L,C,[],null,p)}else M=d._parseValue(M,C,p);S&&D in T?Array.isArray(T[D])?T[D].push(M):T[D]=[T[D],M]:T[D]=M}return[T,M,E]},d._rfc6868Escape=function(h){return h.replace(/\^['n^]/g,function(f){return u[f]})};var u={"^'":'"',"^n":`
`,"^^":"^"};return d._parseMultiValue=function(h,f,p,m,g,v,T){var k=0,D=0,M;if(f.length===0)return h;for(;(k=l.unescapedIndexOf(h,f,D))!==-1;)M=h.substr(D,k-D),g?M=d._parseMultiValue(M,g,p,[],null,v,T):M=d._parseValue(M,p,v,T),m.push(M),D=k+f.length;return M=h.substr(D),g?M=d._parseMultiValue(M,g,p,[],null,v,T):M=d._parseValue(M,p,v,T),m.push(M),m.length==1?m[0]:m},d._eachLine=function(h,f){var p=h.length,m=h.search(n),g=m,v,T,k;do g=h.indexOf(`
`,m)+1,g>1&&h[g-2]==="\r"?k=2:k=1,g===0&&(g=p,k=0),T=h[m],T===" "||T==="	"?v+=h.substr(m+1,g-m-(k+1)):(v&&f(null,v),v=h.substr(m,g-m-k)),m=g;while(g!==p);v=v.trim(),v.length&&f(null,v)},d}();y.Component=function(){"use strict";var n=1,t=2,e=0;function r(i,s){typeof i=="string"&&(i=[i,[],[]]),this.jCal=i,this.parent=s||null}return r.prototype={_hydratedPropertyCount:0,_hydratedComponentCount:0,get name(){return this.jCal[e]},get _designSet(){var i=this.parent&&this.parent._designSet;return i||y.design.getDesignSet(this.name)},_hydrateComponent:function(i){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[i])return this._components[i];var s=new r(this.jCal[t][i],this);return this._hydratedComponentCount++,this._components[i]=s},_hydrateProperty:function(i){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[i])return this._properties[i];var s=new y.Property(this.jCal[n][i],this);return this._hydratedPropertyCount++,this._properties[i]=s},getFirstSubcomponent:function(i){if(i){for(var s=0,a=this.jCal[t],o=a.length;s<o;s++)if(a[s][e]===i){var l=this._hydrateComponent(s);return l}}else if(this.jCal[t].length)return this._hydrateComponent(0);return null},getAllSubcomponents:function(i){var s=this.jCal[t].length,a=0;if(i){for(var o=this.jCal[t],l=[];a<s;a++)i===o[a][e]&&l.push(this._hydrateComponent(a));return l}else{if(!this._components||this._hydratedComponentCount!==s)for(;a<s;a++)this._hydrateComponent(a);return this._components||[]}},hasProperty:function(i){for(var s=this.jCal[n],a=s.length,o=0;o<a;o++)if(s[o][e]===i)return!0;return!1},getFirstProperty:function(i){if(i){for(var s=0,a=this.jCal[n],o=a.length;s<o;s++)if(a[s][e]===i){var l=this._hydrateProperty(s);return l}}else if(this.jCal[n].length)return this._hydrateProperty(0);return null},getFirstPropertyValue:function(i){var s=this.getFirstProperty(i);return s?s.getFirstValue():null},getAllProperties:function(i){var s=this.jCal[n].length,a=0;if(i){for(var o=this.jCal[n],l=[];a<s;a++)i===o[a][e]&&l.push(this._hydrateProperty(a));return l}else{if(!this._properties||this._hydratedPropertyCount!==s)for(;a<s;a++)this._hydrateProperty(a);return this._properties||[]}},_removeObjectByIndex:function(i,s,a){if(s=s||[],s[a]){var o=s[a];"parent"in o&&(o.parent=null)}s.splice(a,1),this.jCal[i].splice(a,1)},_removeObject:function(i,s,a){var o=0,l=this.jCal[i],c=l.length,d=this[s];if(typeof a=="string"){for(;o<c;o++)if(l[o][e]===a)return this._removeObjectByIndex(i,d,o),!0}else if(d){for(;o<c;o++)if(d[o]&&d[o]===a)return this._removeObjectByIndex(i,d,o),!0}return!1},_removeAllObjects:function(i,s,a){for(var o=this[s],l=this.jCal[i],c=l.length-1;c>=0;c--)(!a||l[c][e]===a)&&this._removeObjectByIndex(i,o,c)},addSubcomponent:function(i){this._components||(this._components=[],this._hydratedComponentCount=0),i.parent&&i.parent.removeSubcomponent(i);var s=this.jCal[t].push(i.jCal);return this._components[s-1]=i,this._hydratedComponentCount++,i.parent=this,i},removeSubcomponent:function(i){var s=this._removeObject(t,"_components",i);return s&&this._hydratedComponentCount--,s},removeAllSubcomponents:function(i){var s=this._removeAllObjects(t,"_components",i);return this._hydratedComponentCount=0,s},addProperty:function(i){if(!(i instanceof y.Property))throw new TypeError("must instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),i.parent&&i.parent.removeProperty(i);var s=this.jCal[n].push(i.jCal);return this._properties[s-1]=i,this._hydratedPropertyCount++,i.parent=this,i},addPropertyWithValue:function(i,s){var a=new y.Property(i);return a.setValue(s),this.addProperty(a),a},updatePropertyWithValue:function(i,s){var a=this.getFirstProperty(i);return a?a.setValue(s):a=this.addPropertyWithValue(i,s),a},removeProperty:function(i){var s=this._removeObject(n,"_properties",i);return s&&this._hydratedPropertyCount--,s},removeAllProperties:function(i){var s=this._removeAllObjects(n,"_properties",i);return this._hydratedPropertyCount=0,s},toJSON:function(){return this.jCal},toString:function(){return y.stringify.component(this.jCal,this._designSet)}},r.fromString=function(i){return new r(y.parse.component(i))},r}();y.Property=function(){"use strict";var n=0,t=1,e=2,r=3,i=y.design;function s(a,o){this._parent=o||null,typeof a=="string"?(this.jCal=[a,{},i.defaultType],this.jCal[e]=this.getDefaultType()):this.jCal=a,this._updateType()}return s.prototype={get type(){return this.jCal[e]},get name(){return this.jCal[n]},get parent(){return this._parent},set parent(a){var o=!this._parent||a&&a._designSet!=this._parent._designSet;return this._parent=a,this.type==i.defaultType&&o&&(this.jCal[e]=this.getDefaultType(),this._updateType()),a},get _designSet(){return this.parent?this.parent._designSet:i.defaultSet},_updateType:function(){var a=this._designSet;if(this.type in a.value){var o=a.value[this.type];"decorate"in a.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in a.property&&(this.isMultiValue="multiValue"in a.property[this.name],this.isStructuredValue="structuredValue"in a.property[this.name])}},_hydrateValue:function(a){return this._values&&this._values[a]?this._values[a]:this.jCal.length<=r+a?null:this.isDecorated?(this._values||(this._values=[]),this._values[a]=this._decorate(this.jCal[r+a])):this.jCal[r+a]},_decorate:function(a){return this._designSet.value[this.type].decorate(a,this)},_undecorate:function(a){return this._designSet.value[this.type].undecorate(a,this)},_setDecoratedValue:function(a,o){this._values||(this._values=[]),typeof a=="object"&&"icaltype"in a?(this.jCal[r+o]=this._undecorate(a),this._values[o]=a):(this.jCal[r+o]=a,this._values[o]=this._decorate(a))},getParameter:function(a){if(a in this.jCal[t])return this.jCal[t][a]},getFirstParameter:function(a){var o=this.getParameter(a);return Array.isArray(o)?o[0]:o},setParameter:function(a,o){var l=a.toLowerCase();typeof o=="string"&&l in this._designSet.param&&"multiValue"in this._designSet.param[l]&&(o=[o]),this.jCal[t][a]=o},removeParameter:function(a){delete this.jCal[t][a]},getDefaultType:function(){var a=this.jCal[n],o=this._designSet;if(a in o.property){var l=o.property[a];if("defaultType"in l)return l.defaultType}return i.defaultType},resetType:function(a){this.removeAllValues(),this.jCal[e]=a,this._updateType()},getFirstValue:function(){return this._hydrateValue(0)},getValues:function(){var a=this.jCal.length-r;if(a<1)return[];for(var o=0,l=[];o<a;o++)l[o]=this._hydrateValue(o);return l},removeAllValues:function(){this._values&&(this._values.length=0),this.jCal.length=3},setValues:function(a){if(!this.isMultiValue)throw new Error(this.name+`: does not not support mulitValue.
override isMultiValue`);var o=a.length,l=0;if(this.removeAllValues(),o>0&&typeof a[0]=="object"&&"icaltype"in a[0]&&this.resetType(a[0].icaltype),this.isDecorated)for(;l<o;l++)this._setDecoratedValue(a[l],l);else for(;l<o;l++)this.jCal[r+l]=a[l]},setValue:function(a){this.removeAllValues(),typeof a=="object"&&"icaltype"in a&&this.resetType(a.icaltype),this.isDecorated?this._setDecoratedValue(a,0):this.jCal[r]=a},toJSON:function(){return this.jCal},toICALString:function(){return y.stringify.property(this.jCal,this._designSet,!0)}},s.fromString=function(a,o){return new s(y.parse.property(a,o))},s}();y.UtcOffset=function(){function n(t){this.fromData(t)}return n.prototype={hours:0,minutes:0,factor:1,icaltype:"utc-offset",clone:function(){return y.UtcOffset.fromSeconds(this.toSeconds())},fromData:function(t){if(t)for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this._normalize()},fromSeconds:function(t){var e=Math.abs(t);return this.factor=t<0?-1:1,this.hours=y.helpers.trunc(e/3600),e-=this.hours*3600,this.minutes=y.helpers.trunc(e/60),this},toSeconds:function(){return this.factor*(60*this.minutes+3600*this.hours)},compare:function(e){var r=this.toSeconds(),i=e.toSeconds();return(r>i)-(i>r)},_normalize:function(){for(var t=this.toSeconds(),e=this.factor;t<-43200;)t+=97200;for(;t>50400;)t-=97200;this.fromSeconds(t),t==0&&(this.factor=e)},toICALString:function(){return y.design.icalendar.value["utc-offset"].toICAL(this.toString())},toString:function(){return(this.factor==1?"+":"-")+y.helpers.pad2(this.hours)+":"+y.helpers.pad2(this.minutes)}},n.fromString=function(t){var e={};return e.factor=t[0]==="+"?1:-1,e.hours=y.helpers.strictParseInt(t.substr(1,2)),e.minutes=y.helpers.strictParseInt(t.substr(4,2)),new y.UtcOffset(e)},n.fromSeconds=function(t){var e=new n;return e.fromSeconds(t),e},n}();y.Binary=function(){function n(t){this.value=t}return n.prototype={icaltype:"binary",decodeValue:function(){return this._b64_decode(this.value)},setEncodedValue:function(e){this.value=this._b64_encode(e)},_b64_encode:function(e){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,a,o,l,c,d,u,h=0,f=0,p="",m=[];if(!e)return e;do i=e.charCodeAt(h++),s=e.charCodeAt(h++),a=e.charCodeAt(h++),u=i<<16|s<<8|a,o=u>>18&63,l=u>>12&63,c=u>>6&63,d=u&63,m[f++]=r.charAt(o)+r.charAt(l)+r.charAt(c)+r.charAt(d);while(h<e.length);p=m.join("");var g=e.length%3;return(g?p.slice(0,g-3):p)+"===".slice(g||3)},_b64_decode:function(e){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,a,o,l,c,d,u,h=0,f=0,p="",m=[];if(!e)return e;e+="";do o=r.indexOf(e.charAt(h++)),l=r.indexOf(e.charAt(h++)),c=r.indexOf(e.charAt(h++)),d=r.indexOf(e.charAt(h++)),u=o<<18|l<<12|c<<6|d,i=u>>16&255,s=u>>8&255,a=u&255,c==64?m[f++]=String.fromCharCode(i):d==64?m[f++]=String.fromCharCode(i,s):m[f++]=String.fromCharCode(i,s,a);while(h<e.length);return p=m.join(""),p},toString:function(){return this.value}},n.fromString=function(t){return new n(t)},n}();(function(){y.Period=function(t){if(this.wrappedJSObject=this,t&&"start"in t){if(t.start&&!(t.start instanceof y.Time))throw new TypeError(".start must be an instance of ICAL.Time");this.start=t.start}if(t&&t.end&&t.duration)throw new Error("cannot accept both end and duration");if(t&&"end"in t){if(t.end&&!(t.end instanceof y.Time))throw new TypeError(".end must be an instance of ICAL.Time");this.end=t.end}if(t&&"duration"in t){if(t.duration&&!(t.duration instanceof y.Duration))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=t.duration}},y.Period.prototype={start:null,end:null,duration:null,icalclass:"icalperiod",icaltype:"period",clone:function(){return y.Period.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})},getDuration:function(){return this.duration?this.duration:this.end.subtractDate(this.start)},getEnd:function(){if(this.end)return this.end;var n=this.start.clone();return n.addDuration(this.duration),n},toString:function(){return this.start+"/"+(this.end||this.duration)},toJSON:function(){return[this.start.toString(),(this.end||this.duration).toString()]},toICALString:function(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}},y.Period.fromString=function(t,e){var r=t.split("/");if(r.length!==2)throw new Error('Invalid string value: "'+t+'" must contain a "/" char.');var i={start:y.Time.fromDateTimeString(r[0],e)},s=r[1];return y.Duration.isValueString(s)?i.duration=y.Duration.fromString(s):i.end=y.Time.fromDateTimeString(s,e),new y.Period(i)},y.Period.fromData=function(t){return new y.Period(t)},y.Period.fromJSON=function(n,t,e){function r(i,s){return e?y.Time.fromString(i,s):y.Time.fromDateTimeString(i,s)}return y.Duration.isValueString(n[1])?y.Period.fromData({start:r(n[0],t),duration:y.Duration.fromString(n[1])}):y.Period.fromData({start:r(n[0],t),end:r(n[1],t)})}})();(function(){var n=/([PDWHMTS]{1,1})/;y.Duration=function(r){this.wrappedJSObject=this,this.fromData(r)},y.Duration.prototype={weeks:0,days:0,hours:0,minutes:0,seconds:0,isNegative:!1,icalclass:"icalduration",icaltype:"duration",clone:function(){return y.Duration.fromData(this)},toSeconds:function(){var r=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-r:r},fromSeconds:function(r){var i=Math.abs(r);return this.isNegative=r<0,this.days=y.helpers.trunc(i/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,i-=(this.days+7*this.weeks)*86400,this.hours=y.helpers.trunc(i/3600),i-=this.hours*3600,this.minutes=y.helpers.trunc(i/60),i-=this.minutes*60,this.seconds=i,this},fromData:function(r){var i=["weeks","days","hours","minutes","seconds","isNegative"];for(var s in i)if(i.hasOwnProperty(s)){var a=i[s];r&&a in r?this[a]=r[a]:this[a]=0}},reset:function(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0},compare:function(r){var i=this.toSeconds(),s=r.toSeconds();return(i>s)-(i<s)},normalize:function(){this.fromSeconds(this.toSeconds())},toString:function(){if(this.toSeconds()==0)return"PT0S";var r="";return this.isNegative&&(r+="-"),r+="P",this.weeks&&(r+=this.weeks+"W"),this.days&&(r+=this.days+"D"),(this.hours||this.minutes||this.seconds)&&(r+="T",this.hours&&(r+=this.hours+"H"),this.minutes&&(r+=this.minutes+"M"),this.seconds&&(r+=this.seconds+"S")),r},toICALString:function(){return this.toString()}},y.Duration.fromSeconds=function(r){return new y.Duration().fromSeconds(r)};function t(e,r,i){var s;switch(e){case"P":r&&r==="-"?i.isNegative=!0:i.isNegative=!1;break;case"D":s="days";break;case"W":s="weeks";break;case"H":s="hours";break;case"M":s="minutes";break;case"S":s="seconds";break;default:return 0}if(s){if(!r&&r!==0)throw new Error('invalid duration value: Missing number before "'+e+'"');var a=parseInt(r,10);if(y.helpers.isStrictlyNaN(a))throw new Error('invalid duration value: Invalid number "'+r+'" before "'+e+'"');i[s]=a}return 1}y.Duration.isValueString=function(e){return e[0]==="P"||e[1]==="P"},y.Duration.fromString=function(r){for(var i=0,s=Object.create(null),a=0;(i=r.search(n))!==-1;){var o=r[i],l=r.substr(0,i);r=r.substr(i+1),a+=t(o,l,s)}if(a<2)throw new Error('invalid duration value: Not enough duration components in "'+r+'"');return new y.Duration(s)},y.Duration.fromData=function(r){return new y.Duration(r)}})();(function(){var n=["tzid","location","tznames","latitude","longitude"];y.Timezone=function(e){this.wrappedJSObject=this,this.fromData(e)},y.Timezone.prototype={tzid:"",location:"",tznames:"",latitude:0,longitude:0,component:null,expandedUntilYear:0,icalclass:"icaltimezone",fromData:function(e){if(this.expandedUntilYear=0,this.changes=[],e instanceof y.Component)this.component=e;else{if(e&&"component"in e)if(typeof e.component=="string"){var r=y.parse(e.component);this.component=new y.Component(r)}else e.component instanceof y.Component?this.component=e.component:this.component=null;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];e&&s in e&&(this[s]=e[s])}}return this.component instanceof y.Component&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this},utcOffset:function(e){if(this==y.Timezone.utcTimezone||this==y.Timezone.localTimezone||(this._ensureCoverage(e.year),!this.changes.length))return 0;for(var r={year:e.year,month:e.month,day:e.day,hour:e.hour,minute:e.minute,second:e.second},i=this._findNearbyChange(r),s=-1,a=1;;){var o=y.helpers.clone(this.changes[i],!0);o.utcOffset<o.prevUtcOffset?y.Timezone.adjust_change(o,0,0,0,o.utcOffset):y.Timezone.adjust_change(o,0,0,0,o.prevUtcOffset);var l=y.Timezone._compare_change_fn(r,o);if(l>=0?s=i:a=-1,a==-1&&s!=-1)break;if(i+=a,i<0)return 0;if(i>=this.changes.length)break}var c=this.changes[s],d=c.utcOffset-c.prevUtcOffset;if(d<0&&s>0){var u=y.helpers.clone(c,!0);if(y.Timezone.adjust_change(u,0,0,0,u.prevUtcOffset),y.Timezone._compare_change_fn(r,u)<0){var h=this.changes[s-1],f=!1;c.is_daylight!=f&&h.is_daylight==f&&(c=h)}}return c.utcOffset},_findNearbyChange:function(e){var r=y.helpers.binsearchInsert(this.changes,e,y.Timezone._compare_change_fn);return r>=this.changes.length?this.changes.length-1:r},_ensureCoverage:function(t){if(y.Timezone._minimumExpansionYear==-1){var e=y.Time.now();y.Timezone._minimumExpansionYear=e.year}var r=t;if(r<y.Timezone._minimumExpansionYear&&(r=y.Timezone._minimumExpansionYear),r+=y.Timezone.EXTRA_COVERAGE,r>y.Timezone.MAX_YEAR&&(r=y.Timezone.MAX_YEAR),!this.changes.length||this.expandedUntilYear<t){for(var i=this.component.getAllSubcomponents(),s=i.length,a=0;a<s;a++)this._expandComponent(i[a],r,this.changes);this.changes.sort(y.Timezone._compare_change_fn),this.expandedUntilYear=r}},_expandComponent:function(t,e,r){if(!t.hasProperty("dtstart")||!t.hasProperty("tzoffsetto")||!t.hasProperty("tzoffsetfrom"))return null;var i=t.getFirstProperty("dtstart").getFirstValue(),s;function a(m){return m.factor*(m.hours*3600+m.minutes*60)}function o(){var m={};return m.is_daylight=t.name=="daylight",m.utcOffset=a(t.getFirstProperty("tzoffsetto").getFirstValue()),m.prevUtcOffset=a(t.getFirstProperty("tzoffsetfrom").getFirstValue()),m}if(!t.hasProperty("rrule")&&!t.hasProperty("rdate"))s=o(),s.year=i.year,s.month=i.month,s.day=i.day,s.hour=i.hour,s.minute=i.minute,s.second=i.second,y.Timezone.adjust_change(s,0,0,0,-s.prevUtcOffset),r.push(s);else{var l=t.getAllProperties("rdate");for(var c in l)if(l.hasOwnProperty(c)){var d=l[c],u=d.getFirstValue();s=o(),s.year=u.year,s.month=u.month,s.day=u.day,u.isDate?(s.hour=i.hour,s.minute=i.minute,s.second=i.second,i.zone!=y.Timezone.utcTimezone&&y.Timezone.adjust_change(s,0,0,0,-s.prevUtcOffset)):(s.hour=u.hour,s.minute=u.minute,s.second=u.second,u.zone!=y.Timezone.utcTimezone&&y.Timezone.adjust_change(s,0,0,0,-s.prevUtcOffset)),r.push(s)}var h=t.getFirstProperty("rrule");if(h){h=h.getFirstValue(),s=o(),h.until&&h.until.zone==y.Timezone.utcTimezone&&(h.until.adjust(0,0,0,s.prevUtcOffset),h.until.zone=y.Timezone.localTimezone);for(var f=h.iterator(i),p;(p=f.next())&&(s=o(),!(p.year>e||!p));)s.year=p.year,s.month=p.month,s.day=p.day,s.hour=p.hour,s.minute=p.minute,s.second=p.second,s.isDate=p.isDate,y.Timezone.adjust_change(s,0,0,0,-s.prevUtcOffset),r.push(s)}}return r},toString:function(){return this.tznames?this.tznames:this.tzid}},y.Timezone._compare_change_fn=function(e,r){return e.year<r.year?-1:e.year>r.year?1:e.month<r.month?-1:e.month>r.month?1:e.day<r.day?-1:e.day>r.day?1:e.hour<r.hour?-1:e.hour>r.hour?1:e.minute<r.minute?-1:e.minute>r.minute?1:e.second<r.second?-1:e.second>r.second?1:0},y.Timezone.convert_time=function(e,r,i){if(e.isDate||r.tzid==i.tzid||r==y.Timezone.localTimezone||i==y.Timezone.localTimezone)return e.zone=i,e;var s=r.utcOffset(e);return e.adjust(0,0,0,-s),s=i.utcOffset(e),e.adjust(0,0,0,s),null},y.Timezone.fromData=function(e){var r=new y.Timezone;return r.fromData(e)},y.Timezone.utcTimezone=y.Timezone.fromData({tzid:"UTC"}),y.Timezone.localTimezone=y.Timezone.fromData({tzid:"floating"}),y.Timezone.adjust_change=function(e,r,i,s,a){return y.Time.prototype.adjust.call(e,r,i,s,a,e)},y.Timezone._minimumExpansionYear=-1,y.Timezone.MAX_YEAR=2035,y.Timezone.EXTRA_COVERAGE=5})();y.TimezoneService=function(){var n,t={get count(){return Object.keys(n).length},reset:function(){n=Object.create(null);var e=y.Timezone.utcTimezone;n.Z=e,n.UTC=e,n.GMT=e},has:function(e){return!!n[e]},get:function(e){return n[e]},register:function(e,r){if(e instanceof y.Component&&e.name==="vtimezone"&&(r=new y.Timezone(e),e=r.tzid),r instanceof y.Timezone)n[e]=r;else throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")},remove:function(e){return delete n[e]}};return t.reset(),t}();(function(){y.Time=function(t,e){this.wrappedJSObject=this;var r=this._time=Object.create(null);r.year=0,r.month=1,r.day=1,r.hour=0,r.minute=0,r.second=0,r.isDate=!1,this.fromData(t,e)},y.Time._dowCache={},y.Time._wnCache={},y.Time.prototype={icalclass:"icaltime",_cachedUnixTime:null,get icaltype(){return this.isDate?"date":"date-time"},zone:null,_pendingNormalization:!1,clone:function(){return new y.Time(this._time,this.zone)},reset:function(){this.fromData(y.Time.epochTime),this.zone=y.Timezone.utcTimezone},resetTo:function(t,e,r,i,s,a,o){this.fromData({year:t,month:e,day:r,hour:i,minute:s,second:a,zone:o})},fromJSDate:function(t,e){return t?e?(this.zone=y.Timezone.utcTimezone,this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds()):(this.zone=y.Timezone.localTimezone,this.year=t.getFullYear(),this.month=t.getMonth()+1,this.day=t.getDate(),this.hour=t.getHours(),this.minute=t.getMinutes(),this.second=t.getSeconds()):this.reset(),this._cachedUnixTime=null,this},fromData:function(t,e){if(t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(r==="icaltype")continue;this[r]=t[r]}}if(e&&(this.zone=e),t&&!("isDate"in t)?this.isDate=!("hour"in t):t&&"isDate"in t&&(this.isDate=t.isDate),t&&"timezone"in t){var i=y.TimezoneService.get(t.timezone);this.zone=i||y.Timezone.localTimezone}return t&&"zone"in t&&(this.zone=t.zone),this.zone||(this.zone=y.Timezone.localTimezone),this._cachedUnixTime=null,this},dayOfWeek:function(t){var e=t||y.Time.SUNDAY,r=(this.year<<12)+(this.month<<8)+(this.day<<3)+e;if(r in y.Time._dowCache)return y.Time._dowCache[r];var i=this.day,s=this.month+(this.month<3?12:0),a=this.year-(this.month<3?1:0),o=i+a+y.helpers.trunc((s+1)*26/10)+y.helpers.trunc(a/4);return o+=y.helpers.trunc(a/100)*6+y.helpers.trunc(a/400),o=(o+7-e)%7+1,y.Time._dowCache[r]=o,o},dayOfYear:function(){var t=y.Time.isLeapYear(this.year)?1:0,e=y.Time.daysInYearPassedMonth;return e[t][this.month-1]+this.day},startOfWeek:function(t){var e=t||y.Time.SUNDAY,r=this.clone();return r.day-=(this.dayOfWeek()+7-e)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r},endOfWeek:function(t){var e=t||y.Time.SUNDAY,r=this.clone();return r.day+=(7-this.dayOfWeek()+e-y.Time.SUNDAY)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r},startOfMonth:function(){var t=this.clone();return t.day=1,t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t},endOfMonth:function(){var t=this.clone();return t.day=y.Time.daysInMonth(t.month,t.year),t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t},startOfYear:function(){var t=this.clone();return t.day=1,t.month=1,t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t},endOfYear:function(){var t=this.clone();return t.day=31,t.month=12,t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t},startDoyWeek:function(t){var e=t||y.Time.SUNDAY,r=this.dayOfWeek()-e;return r<0&&(r+=7),this.dayOfYear()-r},getDominicalLetter:function(){return y.Time.getDominicalLetter(this.year)},nthWeekDay:function(t,e){var r=y.Time.daysInMonth(this.month,this.year),i,s=e,a=0,o=this.clone();if(s>=0){o.day=1,s!=0&&s--,a=o.day;var l=o.dayOfWeek(),c=t-l;c<0&&(c+=7),a+=c,a-=t,i=t}else{o.day=r;var d=o.dayOfWeek();s++,i=d-t,i<0&&(i+=7),i=r-i}return i+=s*7,a+i},isNthWeekDay:function(n,t){var e=this.dayOfWeek();if(t===0&&e===n)return!0;var r=this.nthWeekDay(n,t);return r===this.day},weekNumber:function(t){var e=(this.year<<12)+(this.month<<8)+(this.day<<3)+t;if(e in y.Time._wnCache)return y.Time._wnCache[e];var r,i=this.clone();i.isDate=!0;var s=this.year;i.month==12&&i.day>25?(r=y.Time.weekOneStarts(s+1,t),i.compare(r)<0?r=y.Time.weekOneStarts(s,t):s++):(r=y.Time.weekOneStarts(s,t),i.compare(r)<0&&(r=y.Time.weekOneStarts(--s,t)));var a=i.subtractDate(r).toSeconds()/86400,o=y.helpers.trunc(a/7)+1;return y.Time._wnCache[e]=o,o},addDuration:function(t){var e=t.isNegative?-1:1,r=this.second,i=this.minute,s=this.hour,a=this.day;r+=e*t.seconds,i+=e*t.minutes,s+=e*t.hours,a+=e*t.days,a+=e*7*t.weeks,this.second=r,this.minute=i,this.hour=s,this.day=a,this._cachedUnixTime=null},subtractDate:function(t){var e=this.toUnixTime()+this.utcOffset(),r=t.toUnixTime()+t.utcOffset();return y.Duration.fromSeconds(e-r)},subtractDateTz:function(t){var e=this.toUnixTime(),r=t.toUnixTime();return y.Duration.fromSeconds(e-r)},compare:function(t){var e=this.toUnixTime(),r=t.toUnixTime();return e>r?1:r>e?-1:0},compareDateOnlyTz:function(t,e){function r(o){return y.Time._cmp_attr(i,s,o)}var i=this.convertToZone(e),s=t.convertToZone(e),a=0;return(a=r("year"))!=0||(a=r("month"))!=0||(a=r("day"))!=0,a},convertToZone:function(t){var e=this.clone(),r=this.zone.tzid==t.tzid;return!this.isDate&&!r&&y.Timezone.convert_time(e,this.zone,t),e.zone=t,e},utcOffset:function(){return this.zone==y.Timezone.localTimezone||this.zone==y.Timezone.utcTimezone?0:this.zone.utcOffset(this)},toICALString:function(){var n=this.toString();return n.length>10?y.design.icalendar.value["date-time"].toICAL(n):y.design.icalendar.value.date.toICAL(n)},toString:function(){var t=this.year+"-"+y.helpers.pad2(this.month)+"-"+y.helpers.pad2(this.day);return this.isDate||(t+="T"+y.helpers.pad2(this.hour)+":"+y.helpers.pad2(this.minute)+":"+y.helpers.pad2(this.second),this.zone===y.Timezone.utcTimezone&&(t+="Z")),t},toJSDate:function(){return this.zone==y.Timezone.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(this.toUnixTime()*1e3)},_normalize:function(){var t=this._time.isDate;return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this},adjust:function(t,e,r,i,s){var a,o,l=0,c=0,d,u,h,f,p,m=s||this._time;if(m.isDate||(d=m.second+i,m.second=d%60,a=y.helpers.trunc(d/60),m.second<0&&(m.second+=60,a--),u=m.minute+r+a,m.minute=u%60,o=y.helpers.trunc(u/60),m.minute<0&&(m.minute+=60,o--),h=m.hour+e+o,m.hour=h%24,l=y.helpers.trunc(h/24),m.hour<0&&(m.hour+=24,l--)),m.month>12?c=y.helpers.trunc((m.month-1)/12):m.month<1&&(c=y.helpers.trunc(m.month/12)-1),m.year+=c,m.month-=12*c,f=m.day+t+l,f>0)for(;p=y.Time.daysInMonth(m.month,m.year),!(f<=p);)m.month++,m.month>12&&(m.year++,m.month=1),f-=p;else for(;f<=0;)m.month==1?(m.year--,m.month=12):m.month--,f+=y.Time.daysInMonth(m.month,m.year);return m.day=f,this._cachedUnixTime=null,this},fromUnixTime:function(t){this.zone=y.Timezone.utcTimezone;var e=y.Time.epochTime.clone();e.adjust(0,0,0,t),this.year=e.year,this.month=e.month,this.day=e.day,this.hour=e.hour,this.minute=e.minute,this.second=Math.floor(e.second),this._cachedUnixTime=null},toUnixTime:function(){if(this._cachedUnixTime!==null)return this._cachedUnixTime;var t=this.utcOffset(),e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-t);return this._cachedUnixTime=e/1e3,this._cachedUnixTime},toJSON:function(){for(var n=["year","month","day","hour","minute","second","isDate"],t=Object.create(null),e=0,r=n.length,i;e<r;e++)i=n[e],t[i]=this[i];return this.zone&&(t.timezone=this.zone.tzid),t}},function(){function t(e){Object.defineProperty(y.Time.prototype,e,{get:function(){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[e]},set:function(i){return e==="isDate"&&i&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[e]=i,i}})}"defineProperty"in Object&&(t("year"),t("month"),t("day"),t("hour"),t("minute"),t("second"),t("isDate"))}(),y.Time.daysInMonth=function(t,e){var r=[0,31,28,31,30,31,30,31,31,30,31,30,31],i=30;return t<1||t>12||(i=r[t],t==2&&(i+=y.Time.isLeapYear(e))),i},y.Time.isLeapYear=function(t){return t<=1752?t%4==0:t%4==0&&t%100!=0||t%400==0},y.Time.fromDayOfYear=function(t,e){var r=e,i=t,s=new y.Time;s.auto_normalize=!1;var a=y.Time.isLeapYear(r)?1:0;if(i<1)return r--,a=y.Time.isLeapYear(r)?1:0,i+=y.Time.daysInYearPassedMonth[a][12],y.Time.fromDayOfYear(i,r);if(i>y.Time.daysInYearPassedMonth[a][12])return a=y.Time.isLeapYear(r)?1:0,i-=y.Time.daysInYearPassedMonth[a][12],r++,y.Time.fromDayOfYear(i,r);s.year=r,s.isDate=!0;for(var o=11;o>=0;o--)if(i>y.Time.daysInYearPassedMonth[a][o]){s.month=o+1,s.day=i-y.Time.daysInYearPassedMonth[a][o];break}return s.auto_normalize=!0,s},y.Time.fromStringv2=function(t){return new y.Time({year:parseInt(t.substr(0,4),10),month:parseInt(t.substr(5,2),10),day:parseInt(t.substr(8,2),10),isDate:!0})},y.Time.fromDateString=function(n){return new y.Time({year:y.helpers.strictParseInt(n.substr(0,4)),month:y.helpers.strictParseInt(n.substr(5,2)),day:y.helpers.strictParseInt(n.substr(8,2)),isDate:!0})},y.Time.fromDateTimeString=function(n,t){if(n.length<19)throw new Error('invalid date-time value: "'+n+'"');var e;n[19]&&n[19]==="Z"?e="Z":t&&(e=t.getParameter("tzid"));var r=new y.Time({year:y.helpers.strictParseInt(n.substr(0,4)),month:y.helpers.strictParseInt(n.substr(5,2)),day:y.helpers.strictParseInt(n.substr(8,2)),hour:y.helpers.strictParseInt(n.substr(11,2)),minute:y.helpers.strictParseInt(n.substr(14,2)),second:y.helpers.strictParseInt(n.substr(17,2)),timezone:e});return r},y.Time.fromString=function(t,e){return t.length>10?y.Time.fromDateTimeString(t,e):y.Time.fromDateString(t)},y.Time.fromJSDate=function(t,e){var r=new y.Time;return r.fromJSDate(t,e)},y.Time.fromData=function(t,e){var r=new y.Time;return r.fromData(t,e)},y.Time.now=function(){return y.Time.fromJSDate(new Date,!1)},y.Time.weekOneStarts=function(t,e){var r=y.Time.fromData({year:t,month:1,day:1,isDate:!0}),i=r.dayOfWeek(),s=e||y.Time.DEFAULT_WEEK_START;return i>y.Time.THURSDAY&&(r.day+=7),s>y.Time.THURSDAY&&(r.day-=7),r.day-=i-s,r},y.Time.getDominicalLetter=function(n){var t="GFEDCBA",e=(n+(n/4|0)+(n/400|0)-(n/100|0)-1)%7,r=y.Time.isLeapYear(n);return r?t[(e+6)%7]+t[e]:t[e]},y.Time.epochTime=y.Time.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"}),y.Time._cmp_attr=function(t,e,r){return t[r]>e[r]?1:t[r]<e[r]?-1:0},y.Time.daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]],y.Time.SUNDAY=1,y.Time.MONDAY=2,y.Time.TUESDAY=3,y.Time.WEDNESDAY=4,y.Time.THURSDAY=5,y.Time.FRIDAY=6,y.Time.SATURDAY=7,y.Time.DEFAULT_WEEK_START=y.Time.MONDAY})();(function(){y.VCardTime=function(n,t,e){this.wrappedJSObject=this;var r=this._time=Object.create(null);r.year=null,r.month=null,r.day=null,r.hour=null,r.minute=null,r.second=null,this.icaltype=e||"date-and-or-time",this.fromData(n,t)},y.helpers.inherits(y.Time,y.VCardTime,{icalclass:"vcardtime",icaltype:"date-and-or-time",zone:null,clone:function(){return new y.VCardTime(this._time,this.zone,this.icaltype)},_normalize:function(){return this},utcOffset:function(){return this.zone instanceof y.UtcOffset?this.zone.toSeconds():y.Time.prototype.utcOffset.apply(this,arguments)},toICALString:function(){return y.design.vcard.value[this.icaltype].toICAL(this.toString())},toString:function(){var t=y.helpers.pad2,e=this.year,r=this.month,i=this.day,s=this.hour,a=this.minute,o=this.second,l=e!==null,c=r!==null,d=i!==null,u=s!==null,h=a!==null,f=o!==null,p=(l?t(e)+(c||d?"-":""):c||d?"--":"")+(c?t(r):"")+(d?"-"+t(i):""),m=(u?t(s):"-")+(u&&h?":":"")+(h?t(a):"")+(!u&&!h?"-":"")+(h&&f?":":"")+(f?t(o):""),g;if(this.zone===y.Timezone.utcTimezone)g="Z";else if(this.zone instanceof y.UtcOffset)g=this.zone.toString();else if(this.zone===y.Timezone.localTimezone)g="";else if(this.zone instanceof y.Timezone){var v=y.UtcOffset.fromSeconds(this.zone.utcOffset(this));g=v.toString()}else g="";switch(this.icaltype){case"time":return m+g;case"date-and-or-time":case"date-time":return p+(m=="--"?"":"T"+m+g);case"date":return p}return null}}),y.VCardTime.fromDateAndOrTimeString=function(n,t){function e(m,g,v){return m?y.helpers.strictParseInt(m.substr(g,v)):null}var r=n.split("T"),i=r[0],s=r[1],a=s?y.design.vcard.value.time._splitZone(s):[],o=a[0],l=a[1],c=y.helpers.strictParseInt,d=i?i.length:0,u=l?l.length:0,h=i&&i[0]=="-"&&i[1]=="-",f=l&&l[0]=="-",p={year:h?null:e(i,0,4),month:h&&(d==4||d==7)?e(i,2,2):d==7||d==10?e(i,5,2):null,day:d==5?e(i,3,2):d==7&&h?e(i,5,2):d==10?e(i,8,2):null,hour:f?null:e(l,0,2),minute:f&&u==3?e(l,1,2):u>4?f?e(l,1,2):e(l,3,2):null,second:u==4?e(l,2,2):u==6?e(l,4,2):u==8?e(l,6,2):null};return o=="Z"?o=y.Timezone.utcTimezone:o&&o[3]==":"?o=y.UtcOffset.fromString(o):o=null,new y.VCardTime(p,o,t)}})();(function(){var n={SU:y.Time.SUNDAY,MO:y.Time.MONDAY,TU:y.Time.TUESDAY,WE:y.Time.WEDNESDAY,TH:y.Time.THURSDAY,FR:y.Time.FRIDAY,SA:y.Time.SATURDAY},t={};for(var e in n)n.hasOwnProperty(e)&&(t[n[e]]=e);var r=["BYSECOND","BYMINUTE","BYHOUR","BYDAY","BYMONTHDAY","BYYEARDAY","BYWEEKNO","BYMONTH","BYSETPOS"];y.Recur=function(u){this.wrappedJSObject=this,this.parts={},u&&typeof u=="object"&&this.fromData(u)},y.Recur.prototype={parts:null,interval:1,wkst:y.Time.MONDAY,until:null,count:null,freq:null,icalclass:"icalrecur",icaltype:"recur",iterator:function(d){return new y.RecurIterator({rule:this,dtstart:d})},clone:function(){return new y.Recur(this.toJSON())},isFinite:function(){return!!(this.count||this.until)},isByCount:function(){return!!(this.count&&!this.until)},addComponent:function(u,h){var f=u.toUpperCase();f in this.parts?this.parts[f].push(h):this.parts[f]=[h]},setComponent:function(u,h){this.parts[u.toUpperCase()]=h.slice()},getComponent:function(u){var h=u.toUpperCase();return h in this.parts?this.parts[h].slice():[]},getNextOccurrence:function(u,h){var f=this.iterator(u),p,m;do p=f.next();while(p&&p.compare(h)<=0);return p&&h.zone&&(p.zone=h.zone),p},fromData:function(d){for(var u in d){var h=u.toUpperCase();h in c?Array.isArray(d[u])?this.parts[h]=d[u]:this.parts[h]=[d[u]]:this[u]=d[u]}this.interval&&typeof this.interval!="number"&&l.INTERVAL(this.interval,this),this.wkst&&typeof this.wkst!="number"&&(this.wkst=y.Recur.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof y.Time)&&(this.until=y.Time.fromString(this.until))},toJSON:function(){var d=Object.create(null);d.freq=this.freq,this.count&&(d.count=this.count),this.interval>1&&(d.interval=this.interval);for(var u in this.parts)if(this.parts.hasOwnProperty(u)){var h=this.parts[u];Array.isArray(h)&&h.length==1?d[u.toLowerCase()]=h[0]:d[u.toLowerCase()]=y.helpers.clone(this.parts[u])}return this.until&&(d.until=this.until.toString()),"wkst"in this&&this.wkst!==y.Time.DEFAULT_WEEK_START&&(d.wkst=y.Recur.numericDayToIcalDay(this.wkst)),d},toString:function(){var u="FREQ="+this.freq;this.count&&(u+=";COUNT="+this.count),this.interval>1&&(u+=";INTERVAL="+this.interval);for(var h in this.parts)this.parts.hasOwnProperty(h)&&(u+=";"+h+"="+this.parts[h]);return this.until&&(u+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==y.Time.DEFAULT_WEEK_START&&(u+=";WKST="+y.Recur.numericDayToIcalDay(this.wkst)),u}};function i(d,u,h,f){var p=f;if(f[0]==="+"&&(p=f.substr(1)),p=y.helpers.strictParseInt(p),u!==void 0&&f<u)throw new Error(d+': invalid value "'+f+'" must be > '+u);if(h!==void 0&&f>h)throw new Error(d+': invalid value "'+f+'" must be < '+u);return p}y.Recur.icalDayToNumericDay=function(u,h){var f=h||y.Time.SUNDAY;return(n[u]-f+7)%7+1},y.Recur.numericDayToIcalDay=function(u,h){var f=h||y.Time.SUNDAY,p=u+f-y.Time.SUNDAY;return p>7&&(p-=7),t[p]};var s=/^(SU|MO|TU|WE|TH|FR|SA)$/,a=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,o=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],l={FREQ:function(d,u,h){if(o.indexOf(d)!==-1)u.freq=d;else throw new Error('invalid frequency "'+d+'" expected: "'+o.join(", ")+'"')},COUNT:function(d,u,h){u.count=y.helpers.strictParseInt(d)},INTERVAL:function(d,u,h){u.interval=y.helpers.strictParseInt(d),u.interval<1&&(u.interval=1)},UNTIL:function(d,u,h){d.length>10?u.until=y.design.icalendar.value["date-time"].fromICAL(d):u.until=y.design.icalendar.value.date.fromICAL(d),h||(u.until=y.Time.fromString(u.until))},WKST:function(d,u,h){if(s.test(d))u.wkst=y.Recur.icalDayToNumericDay(d);else throw new Error('invalid WKST value "'+d+'"')}},c={BYSECOND:i.bind(this,"BYSECOND",0,60),BYMINUTE:i.bind(this,"BYMINUTE",0,59),BYHOUR:i.bind(this,"BYHOUR",0,23),BYDAY:function(d){if(a.test(d))return d;throw new Error('invalid BYDAY value "'+d+'"')},BYMONTHDAY:i.bind(this,"BYMONTHDAY",-31,31),BYYEARDAY:i.bind(this,"BYYEARDAY",-366,366),BYWEEKNO:i.bind(this,"BYWEEKNO",-53,53),BYMONTH:i.bind(this,"BYMONTH",1,12),BYSETPOS:i.bind(this,"BYSETPOS",-366,366)};y.Recur.fromString=function(d){var u=y.Recur._stringToData(d,!1);return new y.Recur(u)},y.Recur.fromData=function(d){return new y.Recur(d)},y.Recur._stringToData=function(d,u){for(var h=Object.create(null),f=d.split(";"),p=f.length,m=0;m<p;m++){var g=f[m].split("="),v=g[0].toUpperCase(),T=g[0].toLowerCase(),k=u?T:v,D=g[1];if(v in c){for(var M=D.split(","),E=0,C=M.length;E<C;E++)M[E]=c[v](M[E]);h[k]=M.length==1?M[0]:M}else v in l?l[v](D,h,u):h[T]=D}return h}})();y.RecurIterator=function(){function n(t){this.fromData(t)}return n.prototype={completed:!1,rule:null,dtstart:null,last:null,occurrence_number:0,by_indices:null,initialized:!1,by_data:null,days:null,days_index:0,fromData:function(t){if(this.rule=y.helpers.formatClassType(t.rule,y.Recur),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=y.helpers.formatClassType(t.dtstart,y.Time),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");t.by_data?this.by_data=t.by_data:this.by_data=y.helpers.clone(this.rule.parts,!0),t.occurrence_number&&(this.occurrence_number=t.occurrence_number),this.days=t.days||[],t.last&&(this.last=y.helpers.formatClassType(t.last,y.Time)),this.by_indices=t.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=t.initialized||!1,this.initialized||this.init()},init:function(){this.initialized=!0,this.last=this.dtstart.clone();var e=this.by_data;if("BYDAY"in e&&this.sort_byday_rules(e.BYDAY),"BYYEARDAY"in e&&("BYMONTH"in e||"BYWEEKNO"in e||"BYMONTHDAY"in e||"BYDAY"in e))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in e&&"BYMONTHDAY"in e)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if(this.rule.freq=="MONTHLY"&&("BYYEARDAY"in e||"BYWEEKNO"in e))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if(this.rule.freq=="WEEKLY"&&("BYYEARDAY"in e||"BYMONTHDAY"in e))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if(this.rule.freq!="YEARLY"&&"BYYEARDAY"in e)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),this.rule.freq=="WEEKLY")if("BYDAY"in e){var r=this.ruleDayOfWeek(e.BYDAY[0],this.rule.wkst),i=r[0],s=r[1],a=s-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<s&&a>=0||a<0)&&(this.last.day+=a)}else{var o=y.Recur.numericDayToIcalDay(this.dtstart.dayOfWeek());e.BYDAY=[o]}if(this.rule.freq=="YEARLY"){for(;this.expand_year_days(this.last.year),!(this.days.length>0);)this.increment_year(this.rule.interval);this._nextByYearDay()}if(this.rule.freq=="MONTHLY"&&this.has_by_data("BYDAY")){var l=null,c=this.last.clone(),d=y.Time.daysInMonth(this.last.month,this.last.year);for(var u in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(u)){this.last=c.clone();var r=this.ruleDayOfWeek(this.by_data.BYDAY[u]),i=r[0],s=r[1],h=this.last.nthWeekDay(s,i);if(i>=6||i<=-6)throw new Error("Malformed values in BYDAY part");if(h>d||h<=0){if(l&&l.month==c.month)continue;for(;h>d||h<=0;)this.increment_month(),d=y.Time.daysInMonth(this.last.month,this.last.year),h=this.last.nthWeekDay(s,i)}this.last.day=h,(!l||this.last.compare(l)<0)&&(l=this.last.clone())}if(this.last=l.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>d||this.last.day==0)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")&&this.last.day<0){var d=y.Time.daysInMonth(this.last.month,this.last.year);this.last.day=d+this.last.day+1}},next:function(){var e=this.last?this.last.clone():null;if(this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)return this.completed=!0,null;if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;var r;do switch(r=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":r=this.next_month();break;case"YEARLY":this.next_year();break;default:return null}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!r);if(this.last.compare(e)==0)throw new Error("Same occurrence found twice, protecting you from death by recursion");return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)},next_second:function(){return this.next_generic("BYSECOND","SECONDLY","second","minute")},increment_second:function(e){return this.increment_generic(e,"second",60,"minute")},next_minute:function(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")},increment_minute:function(e){return this.increment_generic(e,"minute",60,"hour")},next_hour:function(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")},increment_hour:function(e){this.increment_generic(e,"hour",24,"monthday")},next_day:function(){var e="BYDAY"in this.by_data,r=this.rule.freq=="DAILY";return this.next_hour()==0||(r?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0},next_week:function(){var e=0;if(this.next_weekday_by_week()==0)return e;if(this.has_by_data("BYWEEKNO")){var r=++this.by_indices.BYWEEKNO;this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,e=1),this.last.month=1,this.last.day=1;var i=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*i,e&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return e},normalizeByMonthDayRules:function(t,e,r){for(var i=y.Time.daysInMonth(e,t),s=[],a=0,o=r.length,l;a<o;a++)if(l=r[a],!(Math.abs(l)>i)){if(l<0)l=i+(l+1);else if(l===0)continue;s.indexOf(l)===-1&&s.push(l)}return s.sort(function(c,d){return c-d})},_byDayAndMonthDay:function(t){var e,r=this.by_data.BYDAY,i,s=0,a,o=r.length,l=0,c,d=this,u=this.last.day;function h(){for(c=y.Time.daysInMonth(d.last.month,d.last.year),e=d.normalizeByMonthDayRules(d.last.year,d.last.month,d.by_data.BYMONTHDAY),a=e.length;e[s]<=u&&!(t&&e[s]==u)&&s<a-1;)s++}function f(){u=0,d.increment_month(),s=0,h()}h(),t&&(u-=1);for(var p=48;!l&&p;){if(p--,i=u+1,i>c){f();continue}var m=e[s++];if(m>=i)u=m;else{f();continue}for(var g=0;g<o;g++){var v=this.ruleDayOfWeek(r[g]),T=v[0],k=v[1];if(this.last.day=u,this.last.isNthWeekDay(k,T)){l=1;break}}if(!l&&s===a){f();continue}}if(p<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return l},next_month:function(){var e=this.rule.freq=="MONTHLY",r=1;if(this.next_hour()==0)return r;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))r=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){var i=y.Time.daysInMonth(this.last.month,this.last.year),s=0,a=0;if(this.has_by_data("BYSETPOS")){for(var o=this.last.day,l=1;l<=i;l++)this.last.day=l,this.is_day_in_byday(this.last)&&(a++,l<=o&&s++);this.last.day=o}r=0;for(var l=this.last.day+1;l<=i;l++)if(this.last.day=l,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++s)||this.check_set_position(s-a-1))){r=1;break}l>i&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data("BYSETPOS")||this.check_set_position(1))&&(r=1):r=0)}else if(this.has_by_data("BYMONTHDAY")){this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month());var i=y.Time.daysInMonth(this.last.month,this.last.year),l=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];l<0&&(l=i+l+1),l>i?(this.last.day=1,r=this.is_day_in_byday(this.last)):this.last.day=l}else{this.increment_month();var i=y.Time.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>i?r=0:this.last.day=this.by_data.BYMONTHDAY[0]}return r},next_weekday_by_week:function(){var e=0;if(this.next_hour()==0)return e;if(!this.has_by_data("BYDAY"))return 1;for(;;){var r=new y.Time;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,e=1);var i=this.by_data.BYDAY[this.by_indices.BYDAY],s=this.ruleDayOfWeek(i),a=s[1];a-=this.rule.wkst,a<0&&(a+=7),r.year=this.last.year,r.month=this.last.month,r.day=this.last.day;var o=r.startDoyWeek(this.rule.wkst);if(!(a+o<1&&!e)){var l=y.Time.fromDayOfYear(o+a,this.last.year);return this.last.year=l.year,this.last.month=l.month,this.last.day=l.day,e}}},next_year:function(){if(this.next_hour()==0)return 0;if(++this.days_index==this.days.length){this.days_index=0;do this.increment_year(this.rule.interval),this.expand_year_days(this.last.year);while(this.days.length==0)}return this._nextByYearDay(),1},_nextByYearDay:function(){var e=this.days[this.days_index],r=this.last.year;e<1&&(e+=1,r+=1);var i=y.Time.fromDayOfYear(e,r);this.last.day=i.day,this.last.month=i.month},ruleDayOfWeek:function(e,r){var i=e.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(i){var s=parseInt(i[1]||0,10);return e=y.Recur.icalDayToNumericDay(i[2],r),[s,e]}else return[0,0]},next_generic:function(e,r,i,s,a){var o=e in this.by_data,l=this.rule.freq==r,c=0;if(a&&this[a]()==0)return c;if(o){this.by_indices[e]++;var d=this.by_indices[e],u=this.by_data[e];this.by_indices[e]==u.length&&(this.by_indices[e]=0,c=1),this.last[i]=u[this.by_indices[e]]}else l&&this["increment_"+i](this.rule.interval);return o&&c&&l&&this["increment_"+s](1),c},increment_monthday:function(e){for(var r=0;r<e;r++){var i=y.Time.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>i&&(this.last.day-=i,this.increment_month())}},increment_month:function(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{this.rule.freq=="MONTHLY"?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;var e=y.helpers.trunc(this.last.month/12);this.last.month%=12,this.last.month++,e!=0&&this.increment_year(e)}},increment_year:function(e){this.last.year+=e},increment_generic:function(e,r,i,s){this.last[r]+=e;var a=y.helpers.trunc(this.last[r]/i);this.last[r]%=i,a!=0&&this["increment_"+s](a)},has_by_data:function(e){return e in this.rule.parts},expand_year_days:function(e){var r=new y.Time;this.days=[];var i={},s=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];o in this.rule.parts&&(i[o]=this.rule.parts[o])}if("BYMONTH"in i&&"BYWEEKNO"in i){var l=1,c={};r.year=e,r.isDate=!0;for(var d=0;d<this.by_data.BYMONTH.length;d++){var u=this.by_data.BYMONTH[d];r.month=u,r.day=1;var h=r.weekNumber(this.rule.wkst);r.day=y.Time.daysInMonth(u,e);var f=r.weekNumber(this.rule.wkst);for(d=h;d<f;d++)c[d]=1}for(var p=0;p<this.by_data.BYWEEKNO.length&&l;p++){var m=this.by_data.BYWEEKNO[p];m<52?l&=c[p]:l=0}l?delete i.BYMONTH:delete i.BYWEEKNO}var g=Object.keys(i).length;if(g==0){var v=this.dtstart.clone();v.year=this.last.year,this.days.push(v.dayOfYear())}else if(g==1&&"BYMONTH"in i){for(var T in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(T)){var k=this.dtstart.clone();k.year=e,k.month=this.by_data.BYMONTH[T],k.isDate=!0,this.days.push(k.dayOfYear())}}else if(g==1&&"BYMONTHDAY"in i){for(var D in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(D)){var M=this.dtstart.clone(),E=this.by_data.BYMONTHDAY[D];if(E<0){var C=y.Time.daysInMonth(M.month,e);E=E+C+1}M.day=E,M.year=e,M.isDate=!0,this.days.push(M.dayOfYear())}}else if(g==2&&"BYMONTHDAY"in i&&"BYMONTH"in i){for(var T in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(T)){var S=this.by_data.BYMONTH[T],C=y.Time.daysInMonth(S,e);for(var D in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(D)){var E=this.by_data.BYMONTHDAY[D];E<0&&(E=E+C+1),r.day=E,r.month=S,r.year=e,r.isDate=!0,this.days.push(r.dayOfYear())}}}else if(!(g==1&&"BYWEEKNO"in i)){if(!(g==2&&"BYWEEKNO"in i&&"BYMONTHDAY"in i))if(g==1&&"BYDAY"in i)this.days=this.days.concat(this.expand_by_day(e));else if(g==2&&"BYDAY"in i&&"BYMONTH"in i){for(var T in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(T)){var u=this.by_data.BYMONTH[T],C=y.Time.daysInMonth(u,e);r.year=e,r.month=this.by_data.BYMONTH[T],r.day=1,r.isDate=!0;var O=r.dayOfWeek(),F=r.dayOfYear()-1;r.day=C;var P=r.dayOfWeek();if(this.has_by_data("BYSETPOS")){for(var x=0,B=[],L=1;L<=C;L++)r.day=L,this.is_day_in_byday(r)&&B.push(L);for(var H=0;H<B.length;H++)(this.check_set_position(H+1)||this.check_set_position(H-B.length))&&this.days.push(F+B[H])}else for(var w in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(w)){var R=this.by_data.BYDAY[w],U=this.ruleDayOfWeek(R),Y=U[0],te=U[1],re,ge=(te+7-O)%7+1,Le=C-(P+7-te)%7;if(Y==0)for(var L=ge;L<=C;L+=7)this.days.push(F+L);else Y>0?(re=ge+(Y-1)*7,re<=C&&this.days.push(F+re)):(re=Le+(Y+1)*7,re>0&&this.days.push(F+re))}}this.days.sort(function(j,G){return j-G})}else if(g==2&&"BYDAY"in i&&"BYMONTHDAY"in i){var Ie=this.expand_by_day(e);for(var tt in Ie)if(Ie.hasOwnProperty(tt)){var L=Ie[tt],At=y.Time.fromDayOfYear(L,e);this.by_data.BYMONTHDAY.indexOf(At.day)>=0&&this.days.push(L)}}else if(g==3&&"BYDAY"in i&&"BYMONTHDAY"in i&&"BYMONTH"in i){var Ie=this.expand_by_day(e);for(var tt in Ie)if(Ie.hasOwnProperty(tt)){var L=Ie[tt],At=y.Time.fromDayOfYear(L,e);this.by_data.BYMONTH.indexOf(At.month)>=0&&this.by_data.BYMONTHDAY.indexOf(At.day)>=0&&this.days.push(L)}}else if(g==2&&"BYDAY"in i&&"BYWEEKNO"in i){var Ie=this.expand_by_day(e);for(var tt in Ie)if(Ie.hasOwnProperty(tt)){var L=Ie[tt],At=y.Time.fromDayOfYear(L,e),m=At.weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(m)&&this.days.push(L)}}else g==3&&"BYDAY"in i&&"BYWEEKNO"in i&&"BYMONTHDAY"in i||(g==1&&"BYYEARDAY"in i?this.days=this.days.concat(this.by_data.BYYEARDAY):this.days=[])}return 0},expand_by_day:function(e){var r=[],i=this.last.clone();i.year=e,i.month=1,i.day=1,i.isDate=!0;var s=i.dayOfWeek();i.month=12,i.day=31,i.isDate=!0;var a=i.dayOfWeek(),o=i.dayOfYear();for(var l in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(l)){var c=this.by_data.BYDAY[l],d=this.ruleDayOfWeek(c),u=d[0],h=d[1];if(u==0)for(var f=(h+7-s)%7+1,p=f;p<=o;p+=7)r.push(p);else if(u>0){var m;h>=s?m=h-s+1:m=h-s+8,r.push(m+(u-1)*7)}else{var g;u=-u,h<=a?g=o-a+h:g=o-a+h-7,r.push(g-(u-1)*7)}}return r},is_day_in_byday:function(e){for(var r in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(r)){var i=this.by_data.BYDAY[r],s=this.ruleDayOfWeek(i),a=s[0],o=s[1],l=e.dayOfWeek();if(a==0&&o==l||e.nthWeekDay(o,a)==e.day)return 1}return 0},check_set_position:function(e){if(this.has_by_data("BYSETPOS")){var r=this.by_data.BYSETPOS.indexOf(e);return r!==-1}return!1},sort_byday_rules:function(e){for(var r=0;r<e.length;r++)for(var i=0;i<r;i++){var s=this.ruleDayOfWeek(e[i],this.rule.wkst)[1],a=this.ruleDayOfWeek(e[r],this.rule.wkst)[1];if(s>a){var o=e[r];e[r]=e[i],e[i]=o}}},check_contract_restriction:function(e,r){var i=n._indexMap[e],s=n._expandMap[this.rule.freq][i],a=!1;if(e in this.by_data&&s==n.CONTRACT){var o=this.by_data[e];for(var l in o)if(o.hasOwnProperty(l)&&o[l]==r){a=!0;break}}else a=!0;return a},check_contracting_rules:function(){var e=this.last.dayOfWeek(),r=this.last.weekNumber(this.rule.wkst),i=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",y.Recur.numericDayToIcalDay(e))&&this.check_contract_restriction("BYWEEKNO",r)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",i)},setup_defaults:function(e,r,i){var s=n._indexMap[e],a=n._expandMap[this.rule.freq][s];return a!=n.CONTRACT&&(e in this.by_data||(this.by_data[e]=[i]),this.rule.freq!=r)?this.by_data[e][0]:i},toJSON:function(){var t=Object.create(null);return t.initialized=this.initialized,t.rule=this.rule.toJSON(),t.dtstart=this.dtstart.toJSON(),t.by_data=this.by_data,t.days=this.days,t.last=this.last.toJSON(),t.by_indices=this.by_indices,t.occurrence_number=this.occurrence_number,t}},n._indexMap={BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8},n._expandMap={SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]},n.UNKNOWN=0,n.CONTRACT=1,n.EXPAND=2,n.ILLEGAL=3,n}();y.RecurExpansion=function(){function n(i){return y.helpers.formatClassType(i,y.Time)}function t(i,s){return i.compare(s)}function e(i){return i.hasProperty("rdate")||i.hasProperty("rrule")||i.hasProperty("recurrence-id")}function r(i){this.ruleDates=[],this.exDates=[],this.fromData(i)}return r.prototype={complete:!1,ruleIterators:null,ruleDates:null,exDates:null,ruleDateInc:0,exDateInc:0,exDate:null,ruleDate:null,dtstart:null,last:null,fromData:function(i){var s=y.helpers.formatClassType(i.dtstart,y.Time);if(s)this.dtstart=s;else throw new Error(".dtstart (ICAL.Time) must be given");if(i.component)this._init(i.component);else{if(this.last=n(i.last)||s.clone(),!i.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=i.ruleIterators.map(function(a){return y.helpers.formatClassType(a,y.RecurIterator)}),this.ruleDateInc=i.ruleDateInc,this.exDateInc=i.exDateInc,i.ruleDates&&(this.ruleDates=i.ruleDates.map(n),this.ruleDate=this.ruleDates[this.ruleDateInc]),i.exDates&&(this.exDates=i.exDates.map(n),this.exDate=this.exDates[this.exDateInc]),typeof i.complete!="undefined"&&(this.complete=i.complete)}},next:function(){for(var i,s,a,o,l=500,c=0;;){if(c++>l)throw new Error("max tries have occured, rule may be impossible to forfill.");if(a=this.ruleDate,i=this._nextRecurrenceIter(this.last),!a&&!i){this.complete=!0;break}if((!a||i&&a.compare(i.last)>0)&&(a=i.last.clone(),i.next()),this.ruleDate===a&&this._nextRuleDay(),this.last=a,this.exDate&&(o=this.exDate.compare(this.last),o<0&&this._nextExDay(),o===0)){this._nextExDay();continue}return this.last}},toJSON:function(){function i(a){return a.toJSON()}var s=Object.create(null);return s.ruleIterators=this.ruleIterators.map(i),this.ruleDates&&(s.ruleDates=this.ruleDates.map(i)),this.exDates&&(s.exDates=this.exDates.map(i)),s.ruleDateInc=this.ruleDateInc,s.exDateInc=this.exDateInc,s.last=this.last.toJSON(),s.dtstart=this.dtstart.toJSON(),s.complete=this.complete,s},_extractDates:function(i,s){function a(f){h=y.helpers.binsearchInsert(o,f,t),o.splice(h,0,f)}for(var o=[],l=i.getAllProperties(s),c=l.length,d=0,u,h;d<c;d++)l[d].getValues().forEach(a);return o},_init:function(i){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!e(i)){this.ruleDate=this.last.clone(),this.complete=!0;return}if(i.hasProperty("rdate")&&(this.ruleDates=this._extractDates(i,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=y.helpers.binsearchInsert(this.ruleDates,this.last,t),this.ruleDate=this.ruleDates[this.ruleDateInc]),i.hasProperty("rrule"))for(var s=i.getAllProperties("rrule"),a=0,o=s.length,l,c;a<o;a++)l=s[a].getFirstValue(),c=l.iterator(this.dtstart),this.ruleIterators.push(c),c.next();i.hasProperty("exdate")&&(this.exDates=this._extractDates(i,"exdate"),this.exDateInc=y.helpers.binsearchInsert(this.exDates,this.last,t),this.exDate=this.exDates[this.exDateInc])},_nextExDay:function(){this.exDate=this.exDates[++this.exDateInc]},_nextRuleDay:function(){this.ruleDate=this.ruleDates[++this.ruleDateInc]},_nextRecurrenceIter:function(){var i=this.ruleIterators;if(i.length===0)return null;for(var s=i.length,a,o,l=0,c;l<s;l++){if(a=i[l],o=a.last,a.completed){s--,l!==0&&l--,i.splice(l,1);continue}(!c||c.last.compare(o)>0)&&(c=a)}return c}},r}();y.Event=function(){function n(e,r){e instanceof y.Component||(r=e,e=null),e?this.component=e:this.component=new y.Component("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],r&&r.strictExceptions&&(this.strictExceptions=r.strictExceptions),r&&r.exceptions?r.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach(function(i){i.hasProperty("recurrence-id")&&this.relateException(i)},this)}n.prototype={THISANDFUTURE:"THISANDFUTURE",exceptions:null,strictExceptions:!1,relateException:function(e){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(e instanceof y.Component&&(e=new y.Event(e)),this.strictExceptions&&e.uid!==this.uid)throw new Error("attempted to relate unrelated exception");var r=e.recurrenceId.toString();if(this.exceptions[r]=e,e.modifiesFuture()){var i=[e.recurrenceId.toUnixTime(),r],s=y.helpers.binsearchInsert(this.rangeExceptions,i,t);this.rangeExceptions.splice(s,0,i)}},modifiesFuture:function(){if(!this.component.hasProperty("recurrence-id"))return!1;var e=this.component.getFirstProperty("recurrence-id").getParameter("range");return e===this.THISANDFUTURE},findRangeException:function(e){if(!this.rangeExceptions.length)return null;var r=e.toUnixTime(),i=y.helpers.binsearchInsert(this.rangeExceptions,[r],t);if(i-=1,i<0)return null;var s=this.rangeExceptions[i];return r<s[0]?null:s[1]},getOccurrenceDetails:function(e){var r=e.toString(),i=e.convertToZone(y.Timezone.utcTimezone).toString(),s,a={recurrenceId:e};if(r in this.exceptions)s=a.item=this.exceptions[r],a.startDate=s.startDate,a.endDate=s.endDate,a.item=s;else if(i in this.exceptions)s=this.exceptions[i],a.startDate=s.startDate,a.endDate=s.endDate,a.item=s;else{var o=this.findRangeException(e),l;if(o){var c=this.exceptions[o];a.item=c;var d=this._rangeExceptionCache[o];if(!d){var u=c.recurrenceId.clone(),h=c.startDate.clone();u.zone=h.zone,d=h.subtractDate(u),this._rangeExceptionCache[o]=d}var f=e.clone();f.zone=c.startDate.zone,f.addDuration(d),l=f.clone(),l.addDuration(c.duration),a.startDate=f,a.endDate=l}else l=e.clone(),l.addDuration(this.duration),a.endDate=l,a.startDate=e,a.item=this}return a},iterator:function(e){return new y.RecurExpansion({component:this.component,dtstart:e||this.startDate})},isRecurring:function(){var e=this.component;return e.hasProperty("rrule")||e.hasProperty("rdate")},isRecurrenceException:function(){return this.component.hasProperty("recurrence-id")},getRecurrenceTypes:function(){for(var e=this.component.getAllProperties("rrule"),r=0,i=e.length,s=Object.create(null);r<i;r++){var a=e[r].getFirstValue();s[a.freq]=!0}return s},get uid(){return this._firstProp("uid")},set uid(e){this._setProp("uid",e)},get startDate(){return this._firstProp("dtstart")},set startDate(e){this._setTime("dtstart",e)},get endDate(){var e=this._firstProp("dtend");if(!e){var r=this._firstProp("duration");e=this.startDate.clone(),r?e.addDuration(r):e.isDate&&(e.day+=1)}return e},set endDate(e){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",e)},get duration(){var e=this._firstProp("duration");return e||this.endDate.subtractDateTz(this.startDate)},set duration(e){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",e)},get location(){return this._firstProp("location")},set location(e){return this._setProp("location",e)},get attendees(){return this.component.getAllProperties("attendee")},get summary(){return this._firstProp("summary")},set summary(e){this._setProp("summary",e)},get description(){return this._firstProp("description")},set description(e){this._setProp("description",e)},get color(){return this._firstProp("color")},set color(e){this._setProp("color",e)},get organizer(){return this._firstProp("organizer")},set organizer(e){this._setProp("organizer",e)},get sequence(){return this._firstProp("sequence")},set sequence(e){this._setProp("sequence",e)},get recurrenceId(){return this._firstProp("recurrence-id")},set recurrenceId(e){this._setTime("recurrence-id",e)},_setTime:function(e,r){var i=this.component.getFirstProperty(e);i||(i=new y.Property(e),this.component.addProperty(i)),r.zone===y.Timezone.localTimezone||r.zone===y.Timezone.utcTimezone?i.removeParameter("tzid"):i.setParameter("tzid",r.zone.tzid),i.setValue(r)},_setProp:function(e,r){this.component.updatePropertyWithValue(e,r)},_firstProp:function(e){return this.component.getFirstPropertyValue(e)},toString:function(){return this.component.toString()}};function t(e,r){return e[0]>r[0]?1:r[0]>e[0]?-1:0}return n}();y.ComponentParser=function(){function n(t){typeof t=="undefined"&&(t={});var e;for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}return n.prototype={parseEvent:!0,parseTimezone:!0,oncomplete:function(){},onerror:function(t){},ontimezone:function(t){},onevent:function(t){},process:function(t){typeof t=="string"&&(t=y.parse(t)),t instanceof y.Component||(t=new y.Component(t));for(var e=t.getAllSubcomponents(),r=0,i=e.length,s;r<i;r++)switch(s=e[r],s.name){case"vtimezone":if(this.parseTimezone){var a=s.getFirstPropertyValue("tzid");a&&this.ontimezone(new y.Timezone({tzid:a,component:s}))}break;case"vevent":this.parseEvent&&this.onevent(new y.Event(s));break;default:continue}this.oncomplete()}},n}()});var Tt,um=_(()=>{we();Tt=class{static parseTaskLine(t){if(typeof t!="string")return{isTaskLine:!1,originalText:"",error:"Invalid input: line must be a string"};if(t.length>2e3)return{isTaskLine:!1,originalText:t,error:"Line too long to process safely"};let r=t.trim().match(this.CHECKBOX_PATTERN);if(!r)return{isTaskLine:!1,originalText:t};try{let[,,i,,s]=r;if(typeof i!="string"||typeof s!="string")return{isTaskLine:!0,originalText:t,error:"Invalid checkbox format"};let a=i.toLowerCase()==="x",o=this.parseTaskContent(s,a);return!o||!o.title||o.title.trim().length===0?{isTaskLine:!0,originalText:t,error:"Task must have a title"}:{isTaskLine:!0,originalText:t,parsedData:o}}catch(i){return{isTaskLine:!0,originalText:t,error:`Failed to parse task: ${i instanceof Error?i.message:"Unknown error"}`}}}static parseTaskContent(t,e){if(typeof t!="string")throw new Error("Content must be a string");if(t.length>1e3)throw new Error("Content too long to process safely");let r=t;try{let i=this.extractDate(r,this.EMOJI_PATTERNS.DUE_DATE),s=this.extractDate(r,this.EMOJI_PATTERNS.SCHEDULED_DATE),a=this.extractDate(r,this.EMOJI_PATTERNS.START_DATE),o=this.extractDate(r,this.EMOJI_PATTERNS.CREATED_DATE),l=this.extractDate(r,this.EMOJI_PATTERNS.DONE_DATE),c=this.extractPriority(r),{recurrence:d,recurrenceData:u}=this.extractRecurrence(r),h=this.extractTags(r),f=this.extractCleanTitle(r);if(!f||f.trim().length===0)throw new Error("Title cannot be empty after parsing");if(f.length>200)throw new Error("Title too long (max 200 characters)");let p;if(e||l)p="done";else if(a)try{!us(a)&&!ki(a)?p="scheduled":p="open"}catch(m){}return{title:f.trim(),status:p,priority:c,dueDate:i,scheduledDate:s,startDate:a,createdDate:o,doneDate:l,recurrence:d,recurrenceData:u,tags:h.length>0?h:void 0,projects:void 0,isCompleted:e}}catch(i){throw new Error(`Failed to parse task content: ${i instanceof Error?i.message:"Unknown error"}`)}}static extractDate(t,e){if(!(typeof t!="string"||!e))try{let i=new RegExp(e.source,"g").exec(t);if(i&&i[1]){let s=i[1].trim();if(!/^\d{4}-\d{2}-\d{2}$/.test(s))return;try{let a=he(s);if(isNaN(a.getTime()))return;let o=a.getFullYear();return o<1900||o>2100?void 0:Te(a)}catch(a){return}}}catch(r){console.debug("Error extracting date:",r)}}static extractPriority(t){if(new RegExp(this.EMOJI_PATTERNS.HIGH_PRIORITY.source).test(t))return"high";if(new RegExp(this.EMOJI_PATTERNS.MEDIUM_PRIORITY.source).test(t))return"medium";if(new RegExp(this.EMOJI_PATTERNS.LOW_PRIORITY.source).test(t))return"low"}static extractRecurrence(t){let r=new RegExp(this.EMOJI_PATTERNS.RECURRENCE.source,"g").exec(t);if(!r||!r[1])return{};let i=r[1].trim();if(i.includes("every day"))return{recurrence:"daily",recurrenceData:{frequency:"daily"}};if(i.includes("every week"))return{recurrence:"weekly",recurrenceData:{frequency:"weekly"}};if(i.includes("every month"))return{recurrence:"monthly",recurrenceData:{frequency:"monthly"}};if(i.includes("every year"))return{recurrence:"yearly",recurrenceData:{frequency:"yearly"}};let s=i.match(/every\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)/i);return s?{recurrence:"weekly",recurrenceData:{frequency:"weekly",days_of_week:[s[1].toLowerCase().substring(0,3)]}}:{recurrence:"custom",recurrenceData:{frequency:"custom",raw:i}}}static extractTags(t){if(typeof t!="string")return[];try{let e=new RegExp(this.TAG_PATTERN.source,"g"),r=[],i;for(;(i=e.exec(t))!==null;)if(i[0]){let s=i[0].substring(1);s&&!r.includes(s)&&r.push(s)}return r}catch(e){return console.debug("Error extracting tags:",e),[]}}static extractCleanTitle(t){if(typeof t!="string")return"";try{let e=t;Object.values(this.EMOJI_PATTERNS).forEach(i=>{try{let s=new RegExp(i.source,"g");e=e.replace(s,"")}catch(s){console.debug("Error applying emoji pattern:",s)}});try{let i=new RegExp(this.TAG_PATTERN.source,"g");e=e.replace(i,"")}catch(i){console.debug("Error removing tags from title:",i)}let r=e.replace(/\s+/g," ").trim();return r.length===0?"Untitled Task":r}catch(e){return console.debug("Error extracting clean title:",e),"Untitled Task"}}static isTasksPluginFormat(t){if(typeof t!="string"||t.length>1e3)return!1;try{let e=t.trim();return this.CHECKBOX_PATTERN.test(e)?Object.values(this.EMOJI_PATTERNS).some(s=>{try{return new RegExp(s.source).test(e)}catch(a){return!1}}):!1}catch(e){return console.debug("Error validating Tasks plugin format:",e),!1}}static getSummary(t){let e=[];return e.push(`Title: "${t.title}"`),e.push(`Status: ${t.status}`),e.push(`Priority: ${t.priority}`),t.dueDate&&e.push(`Due: ${t.dueDate}`),t.startDate&&e.push(`Start: ${t.startDate}`),t.scheduledDate&&e.push(`Scheduled: ${t.scheduledDate}`),t.createdDate&&e.push(`Created: ${t.createdDate}`),t.doneDate&&e.push(`Done: ${t.doneDate}`),t.recurrence&&e.push(`Recurrence: ${t.recurrence}`),t.tags&&t.tags.length>0&&e.push(`Tags: ${t.tags.map(r=>"#"+r).join(", ")}`),t.projects&&t.projects.length>0&&e.push(`Projects: ${t.projects.map(r=>r.includes(" ")?`+[[${r}]]`:`+${r}`).join(", ")}`),e.join(" | ")}};Tt.EMOJI_PATTERNS={DUE_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,SCHEDULED_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,START_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,CREATED_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,DONE_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,HIGH_PRIORITY://g,MEDIUM_PRIORITY://g,LOW_PRIORITY://g,RECURRENCE:/\s*([^#]+?)(?=\s*[#]|$)/gu},Tt.TAG_PATTERN=/#[\w/]+/g,Tt.CHECKBOX_PATTERN=/^(\s*(?:[-*+]|\d+\.)\s+\[)([ xX])(\]\s+)(.*)/});var oE={};pi(oE,{InstantTaskConvertService:()=>hm});var Et,hm,lE=_(()=>{Et=require("obsidian");um();Gp();we();at();Wd();hm=class{constructor(t,e,r){this.plugin=t,this.statusManager=e,this.priorityManager=r,this.nlParser=new Qs(t.settings.customStatuses,t.settings.customPriorities,t.settings.nlpDefaultToScheduled)}async batchConvertAllTasks(t){try{let e=this.findAllCheckboxTasks(t);if(e.length===0){new Et.Notice("No checkbox tasks found in the current note.");return}new Et.Notice(`Converting ${e.length} task${e.length===1?"":"s"}...`);let r=await this.batchConvertTasksOptimized(t,e);if(r.failures.length===0)new Et.Notice(`\u2705 Successfully converted ${r.successCount} task${r.successCount===1?"":"s"} to TaskNotes!`);else{let i=`Converted ${r.successCount} task${r.successCount===1?"":"s"}.`;r.failures.length>0&&(i+=` ${r.failures.length} failed.`),new Et.Notice(i),console.warn("Batch conversion failures:",r.failures)}}catch(e){console.error("Error during batch task conversion:",e),new Et.Notice("Failed to perform batch conversion. Please try again.")}}async batchConvertTasksOptimized(t,e){let r=[],i=[],s=e.map(async o=>{try{let l=await this.parseTaskForBatch(o.line);if(!l)throw new Error("Failed to parse task");let c=await this.createTaskFile(l),d=this.generateLinkText(o.line,c);return{lineNumber:o.lineNumber,line:o.line,file:c,linkText:d}}catch(l){return r.push({lineNumber:o.lineNumber+1,error:l instanceof Error?l.message:String(l)}),null}}),a=await Promise.all(s);for(let o of a)o&&i.push(o);return i.length>0&&this.replaceAllTaskLines(t,i),{successCount:i.length,failures:r}}async instantConvertTask(t,e){try{let r=this.validateInputParameters(t,e);if(!r.isValid){new Et.Notice(r.error||"Invalid input parameters.");return}let i=this.extractSelectionInfo(t,e),s=i.taskLine,a=i.details,o,l=Tt.parseTaskLine(s);if(l.isTaskLine){if(l.error||!l.parsedData){new Et.Notice(`Error parsing task: ${l.error||"No data extracted"}`);return}if(!this.hasUsefulMetadata(l.parsedData)&&this.plugin.settings.enableNaturalLanguageInput){let f=this.tryNLPFallback(s,a||"");f?o=f:o=l.parsedData}else o=l.parsedData}else{let h=this.extractLineContentAsTitle(s);if(!h.trim()){new Et.Notice("Current line is empty or contains no valid content.");return}if(this.plugin.settings.enableNaturalLanguageInput){let f=this.tryNLPFallback(h,a||"");f?o=f:o={title:h,isCompleted:!1}}else o={title:h,isCompleted:!1}}let c=this.validateTaskData(o);if(!c.isValid){new Et.Notice(c.error||"Invalid task data.");return}let d=await this.createTaskFile(o,a),u=await this.replaceOriginalTaskLines(t,i,d,o.title);if(!u.success){new Et.Notice(u.error||"Failed to replace task line.");try{await this.plugin.app.vault.delete(d)}catch(h){console.warn("Failed to clean up created file after replacement failure:",h)}return}new Et.Notice(`Task converted: ${o.title}`),await this.refreshTaskLinkOverlays(t,d)}catch(r){console.error("Error during instant task conversion:",r),r.message.includes("file already exists")?new Et.Notice("A file with this name already exists. Please try again or rename the task."):r.message.includes("invalid characters")?new Et.Notice("Task title contains invalid characters for filename."):new Et.Notice("Failed to convert task. Please try again.")}}extractSelectionInfo(t,e){let r=t.getSelection();if(r&&r.trim()){let s=t.listSelections()[0],a=Math.min(s.anchor.line,s.head.line),o=Math.max(s.anchor.line,s.head.line);if(e>=a&&e<=o){let l=[];for(let h=a;h<=o;h++)l.push(t.getLine(h));let c=l[0],u=l.slice(1).join(`
`).trimEnd();return{taskLine:c,details:u,startLine:a,endLine:o,originalContent:l}}}let i=t.getLine(e);return{taskLine:i,details:"",startLine:e,endLine:e,originalContent:[i]}}validateInputParameters(t,e){if(!t)return{isValid:!1,error:"Editor is not available."};let r=t.lineCount();if(e<0||e>=r)return{isValid:!1,error:`Line number ${e} is out of bounds (0-${r-1}).`};let i=t.getLine(e);return i==null?{isValid:!1,error:`Cannot read line ${e}.`}:{isValid:!0}}validateTaskData(t){if(!t.title||t.title.trim().length===0)return{isValid:!1,error:"Task title cannot be empty."};if(t.title.length>200)return{isValid:!1,error:"Task title is too long (max 200 characters)."};let e=/[<>:"/\\|?*]/,r=t.title.split("").some(s=>{let a=s.charCodeAt(0);return a<=31||a===127});if(e.test(t.title)||r)return{isValid:!1,error:"Task title contains invalid characters for file operations."};let i=["dueDate","scheduledDate","startDate","createdDate","doneDate"];for(let s of i){let a=t[s];if(a&&!this.isValidDateFormat(a))return{isValid:!1,error:`Invalid date format in ${s}: ${a}`}}return{isValid:!0}}isValidDateFormat(t){if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;let r=new Date(t);return r instanceof Date&&!isNaN(r.getTime())&&r.toISOString().slice(0,10)===t}async createTaskFile(t,e=""){let r=this.sanitizeTitle(t.title)||"Untitled Task",i=this.plugin.app.workspace.getActiveFile(),s=i?this.plugin.app.fileManager.generateMarkdownLink(i,i.path):"",a=this.sanitizeDate(t.dueDate),o=this.sanitizeDate(t.scheduledDate),l,c,d,u,h=[],f=[this.plugin.settings.taskTag],p,m,g=t.tags||[],v=t.projects||[];if(this.plugin.settings.useDefaultsOnInstantConvert){let E=this.plugin.settings.taskCreationDefaults;if(l=(t.priority?this.sanitizePriority(t.priority):"")||this.plugin.settings.defaultTaskPriority,c=(t.status?this.sanitizeStatus(t.status):"")||this.plugin.settings.defaultTaskStatus,a?d=a:E.defaultDueDate!=="none"&&(d=ws(E.defaultDueDate)),o?u=o:E.defaultScheduledDate!=="none"&&(u=ws(E.defaultScheduledDate)),E.defaultContexts&&(h=E.defaultContexts.split(",").map(C=>C.trim()).filter(C=>C)),f=[this.plugin.settings.taskTag],g.length>0&&f.push(...g),E.defaultTags){let C=E.defaultTags.split(",").map(S=>S.trim()).filter(S=>S);f.push(...C)}f=[...new Set(f)],E.defaultTimeEstimate&&E.defaultTimeEstimate>0&&(p=E.defaultTimeEstimate),E.defaultRecurrence&&E.defaultRecurrence!=="none"&&(m={frequency:E.defaultRecurrence})}else l=(t.priority?this.sanitizePriority(t.priority):"")||"none",c=(t.status?this.sanitizeStatus(t.status):"")||"none",d=a||void 0,u=o||void 0,f=[this.plugin.settings.taskTag],g.length>0&&f.push(...g),f=[...new Set(f)];let T=[];if(this.plugin.settings.useDefaultsOnInstantConvert){let E=this.plugin.settings.taskCreationDefaults;if(E.defaultProjects){let C=E.defaultProjects.split(",").map(S=>S.trim()).filter(S=>S);T.push(...C)}}v.length>0&&T.push(...v);let k=[...new Set(T)],D={title:r,status:c,priority:l,due:d,scheduled:u,contexts:h.length>0?h:void 0,projects:k.length>0?k:void 0,tags:f,timeEstimate:p,recurrence:m,details:e,parentNote:s,creationContext:"inline-conversion",dateCreated:ce(),dateModified:ce()},{file:M}=await this.plugin.taskService.createTask(D);return M}sanitizeTitle(t){return t?t.trim().substring(0,200):""}sanitizePriority(t){return this.priorityManager.getAllPriorities().map(r=>r&&typeof r=="object"?r.value:r).filter(r=>r!=null).includes(t)?t:""}sanitizeStatus(t){return this.statusManager.getAllStatuses().map(r=>r&&typeof r=="object"?r.value:r).filter(r=>r!=null).includes(t)?t:""}sanitizeDate(t){return!t||!this.isValidDateFormat(t)?"":t}async replaceOriginalTaskLines(t,e,r,i){var s;try{if(!t||!r)return{success:!1,error:"Invalid editor or file reference."};let{startLine:a,endLine:o,originalContent:l}=e,c=t.lineCount();if(a<0||o>=c)return{success:!1,error:`Line range ${a}-${o} is no longer valid (current line count: ${c}).`};for(let D=0;D<l.length;D++)if(t.getLine(a+D)!==l[D])return{success:!1,error:"Content has changed since parsing. Please try again."};let d=Tt.parseTaskLine(l[0]),u=d.isTaskLine;if(u&&!d.isTaskLine)return{success:!1,error:"First line is no longer a valid task."};if(!u&&!this.extractLineContentAsTitle(l[0]).trim())return{success:!1,error:"First line no longer contains valid content."};let h=((s=l[0].match(/^(\s*)/))==null?void 0:s[1])||"",f="";if(u){let D=l[0].match(/^\s*((?:[-*+]|\d+\.)\s+)\[/);f=(D==null?void 0:D[1])||"- "}else{let D=l[0].match(/^\s*([-*+]\s+)/),M=l[0].match(/^\s*(\d+\.\s+)/),E=l[0].match(/^\s*(>\s*)/);D?f=D[1]:M?f=M[1]:E?f=E[1]:f="- "}let p=this.plugin.app.workspace.getActiveFile(),m=(p==null?void 0:p.path)||"",g=this.plugin.app.metadataCache.fileToLinktext(r,m,!0),v=`${h}${f}[[${g}]]`;if(v.length>500)return{success:!1,error:"Generated link text is too long."};let T={line:a,ch:0},k={line:o,ch:t.getLine(o).length};return t.replaceRange(v,T,k),{success:!0}}catch(a){return console.error("Error replacing task lines:",a),{success:!1,error:`Failed to replace lines: ${a.message}`}}}async refreshTaskLinkOverlays(t,e){try{await this.forceMetadataCacheUpdate(e),setTimeout(()=>{try{let r=t.cm;if(r){let i=t.getCursor();an(r,e.path),setTimeout(()=>{try{t.setCursor(i)}catch(s){console.debug("Error restoring cursor position:",s)}},10)}}catch(r){console.debug("Error dispatching task update for overlays:",r)}},100)}catch(r){console.debug("Error refreshing task link overlays:",r)}}async forceMetadataCacheUpdate(t){try{await this.plugin.app.vault.cachedRead(t),this.plugin.app.metadataCache.getFileCache(t)===null&&setTimeout(async()=>{try{await this.plugin.app.vault.cachedRead(t)}catch(e){console.debug("Error in delayed cache update:",e)}},10)}catch(e){console.debug("Error forcing metadata cache update:",e)}}hasUsefulMetadata(t){return!!(t.dueDate||t.scheduledDate||t.startDate||t.priority||t.status||t.recurrence||t.createdDate||t.doneDate||t.tags&&t.tags.length>0||t.projects&&t.projects.length>0)}tryNLPFallback(t,e){var r;try{let i=this.extractTaskContent(t);if(!i.trim())return null;let s=e.trim().length>0?`${i}
${e}`:i,a=this.nlParser.parseInput(s);return(r=a.title)!=null&&r.trim()?{title:a.title.trim(),isCompleted:a.isCompleted||!1,status:a.status,priority:a.priority,dueDate:a.dueDate,scheduledDate:a.scheduledDate,recurrence:a.recurrence,tags:a.tags&&a.tags.length>0?a.tags:void 0,projects:a.projects&&a.projects.length>0?a.projects:void 0,startDate:void 0,createdDate:void 0,doneDate:void 0,recurrenceData:void 0}:null}catch(i){return console.debug("NLP fallback parsing failed:",i),null}}extractTaskContent(t){return t.replace(/^\s*(?:[-*+]|\d+\.)\s*\[[ xX]\]\s*/,"").trim()}extractLineContentAsTitle(t){let e=t.trim();for(e=e.replace(/^\s*[-*+]\s+/,""),e=e.replace(/^\s*\d+\.\s+/,"");e.match(/^\s*>\s*/);)e=e.replace(/^\s*>\s*/,"");return e=e.replace(/^\s*#+\s+/,""),e.match(/^\s*(-{3,}|={3,})\s*$/)?"":e.trim()}findAllCheckboxTasks(t){let e=[],r=t.lineCount();for(let i=0;i<r;i++){let s=t.getLine(i);if(Tt.parseTaskLine(s).isTaskLine){e.push({lineNumber:i,line:s});continue}if(s.trim().includes("[ ]")||s.trim().includes("[x]")||s.trim().includes("[X]")){let o=s.trim();for(;o.match(/^\s*>\s*/);)o=o.replace(/^\s*>\s*/,"");Tt.parseTaskLine(o).isTaskLine&&e.push({lineNumber:i,line:s})}}return e}async parseTaskForBatch(t){try{let e=Tt.parseTaskLine(t);if(e.isTaskLine){if(e.error||!e.parsedData)return null;if(!this.hasUsefulMetadata(e.parsedData)&&this.plugin.settings.enableNaturalLanguageInput){let i=this.tryNLPFallback(t,"");if(i)return i}return e.parsedData}else{let r=this.extractLineContentAsTitle(t);if(!r.trim())return null;if(this.plugin.settings.enableNaturalLanguageInput){let i=this.tryNLPFallback(r,"");if(i)return i}return{title:r,isCompleted:!1}}}catch(e){return console.warn("Error parsing task for batch:",e),null}}generateLinkText(t,e){var d;let r=((d=t.match(/^(\s*)/))==null?void 0:d[1])||"",s=Tt.parseTaskLine(t).isTaskLine,a="";if(s){let u=t.match(/^\s*((?:[-*+]|\d+\.)\s+)\[/);a=(u==null?void 0:u[1])||"- "}else{let u=t.match(/^\s*([-*+]\s+)/),h=t.match(/^\s*(\d+\.\s+)/),f=t.match(/^\s*(>\s*)/);u?a=u[1]:h?a=h[1]:f?a=f[1]:a="- "}let o=this.plugin.app.workspace.getActiveFile(),l=(o==null?void 0:o.path)||"",c=this.plugin.app.metadataCache.fileToLinktext(e,l,!0);return`${r}${a}[[${c}]]`}replaceAllTaskLines(t,e){let r=e.sort((i,s)=>s.lineNumber-i.lineNumber);for(let i of r){let s=t.getLine(i.lineNumber).length;t.replaceRange(i.linkText,{line:i.lineNumber,ch:0},{line:i.lineNumber,ch:s})}}}});var dE={};pi(dE,{createInstantConvertButtons:()=>sA,createInstantConvertField:()=>cE});function cE(n){return Jd.StateField.define({create(){return tr.Decoration.none},update(t,e){if(!n||!e)return tr.Decoration.none;if(!n.settings||!n.settings.enableInstantTaskConvert)return tr.Decoration.none;if(!e.state)return console.warn("Invalid transaction state in instant convert field update"),tr.Decoration.none;try{return!e.docChanged&&t!==tr.Decoration.none?t.map(e.changes):nA(e.state,n)}catch(r){return console.error("Error updating instant convert decorations:",r),tr.Decoration.none}},provide(t){return tr.EditorView.decorations.from(t)}})}function nA(n,t){let e=new Jd.RangeSetBuilder,r=n.doc;if(!r||!t)return console.warn("Invalid state or plugin for building convert button decorations"),e.finish();if(typeof r.lines!="number"||r.lines<0)return console.warn("Invalid document lines count:",r.lines),e.finish();for(let i=0;i<r.lines;i++)try{let s=r.line(i+1);if(!s||typeof s.text!="string")continue;let a=s.text;if(a.length>1e3)continue;let o=Tt.parseTaskLine(a);if(o.isTaskLine&&o.parsedData){if(!o.parsedData.title||o.parsedData.title.trim().length===0||typeof s.to!="number"||s.to<0)continue;let l=new fl(t,i),c=tr.Decoration.widget({widget:l,side:1});e.add(s.to,s.to,c)}}catch(s){console.debug("Error processing line",i,":",s);continue}return e.finish()}function sA(n){return cE(n)}var Jd,tr,na,fl,uE=_(()=>{Jd=require("@codemirror/state"),tr=require("@codemirror/view"),na=require("obsidian");um();fl=class extends tr.WidgetType{constructor(e,r){super();this.plugin=e,this.lineNumber=r}toDOM(e){let r=document.createElement("span");r.className="tasknotes-plugin";let i=r.createEl("button",{cls:"instant-convert-button",attr:{"aria-label":"Convert to TaskNote"}});(0,na.setTooltip)(i,"Convert to TaskNote",{placement:"top"});let s=i.createEl("span",{cls:"instant-convert-button__icon"});return(0,na.setIcon)(s,"file-plus"),i.addEventListener("mousedown",async a=>{a.preventDefault(),a.stopPropagation();try{if(!this.validateButtonClick())return;let o=this.plugin.app.workspace.getActiveViewOfType(na.MarkdownView);if(!o){console.warn("No active markdown view available for task conversion");return}let l=o.editor;if(!this.validateEditorState(l))return;this.plugin.instantTaskConvertService&&l&&await this.plugin.instantTaskConvertService.instantConvertTask(l,this.lineNumber)}catch(o){console.error("Error in convert button click handler:",o)}}),r}eq(e){return e instanceof fl&&e.plugin===this.plugin&&e.lineNumber===this.lineNumber}get estimatedHeight(){return-1}ignoreEvent(){return!1}validateButtonClick(){return this.plugin?this.plugin.settings.enableInstantTaskConvert?typeof this.lineNumber!="number"||this.lineNumber<0?(console.warn("Invalid line number for task conversion:",this.lineNumber),!1):!0:(console.warn("Instant task conversion is disabled"),!1):(console.warn("Plugin not available for task conversion"),!1)}validateEditorState(e){if(!e)return console.warn("Editor not available for task conversion"),!1;let r=e.lineCount();if(this.lineNumber>=r)return console.warn(`Line number ${this.lineNumber} is out of bounds (total lines: ${r})`),!1;try{let i=e.getLine(this.lineNumber);return i?Tt.parseTaskLine(i).isTaskLine?!0:(console.warn(`Line ${this.lineNumber} is no longer a task`),!1):(console.warn(`Cannot read line ${this.lineNumber}`),!1)}catch(i){return console.warn("Error validating line content:",i),!1}}}});var hE={};pi(hE,{DueDateModal:()=>fm});var pl,fm,fE=_(()=>{pl=require("obsidian");je();we();fm=class extends pl.Modal{constructor(e,r,i){super(e);this.task=r,this.plugin=i}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-plugin"),this.titleEl.setText("Set due date"),this.titleEl.setAttribute("id","due-date-modal-title"),this.containerEl.setAttribute("aria-labelledby","due-date-modal-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),e.createEl("p",{text:`Task: ${this.task.title}`,cls:"due-date-modal__task-title"});let i=new pl.Setting(e).setName("Due date & time").setDesc("Enter due date and optional time (leave time empty for date-only)").controlEl.createDiv({cls:"modal-form__datetime-container"});this.dueDateInput=i.createEl("input",{type:"date",cls:"modal-form__input modal-form__input--date",attr:{"aria-label":"Due date for task",placeholder:"YYYY-MM-DD"}}),this.dueDateInput.value=Z(this.task.due||""),this.dueTimeInput=i.createEl("input",{type:"time",cls:"modal-form__input modal-form__input--time",attr:{"aria-label":"Due time for task (optional)",placeholder:"HH:MM"}}),this.dueTimeInput.value=It(this.task.due||"")||"",this.dueDateInput.addEventListener("keydown",m=>{m.key==="Enter"?this.save():m.key==="Escape"&&this.close()}),this.dueTimeInput.addEventListener("keydown",m=>{m.key==="Enter"?this.save():m.key==="Escape"&&this.close()}),setTimeout(()=>this.dueDateInput.focus(),100);let s=e.createDiv({cls:"modal-form__group"});new pl.Setting(s).setName("Quick options").setHeading();let a=s.createDiv({cls:"modal-form__quick-actions"});a.createEl("button",{text:"Today",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to today"}}).addEventListener("click",()=>{this.dueDateInput.value=I(new Date,"yyyy-MM-dd")}),a.createEl("button",{text:"Tomorrow",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to tomorrow"}}).addEventListener("click",()=>{this.dueDateInput.value=I(gi(new Date,{days:1}),"yyyy-MM-dd")}),a.createEl("button",{text:"Next week",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to next week"}}).addEventListener("click",()=>{this.dueDateInput.value=I(gi(new Date,{weeks:1}),"yyyy-MM-dd")}),a.createEl("button",{text:"Now",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date and time to now"}}).addEventListener("click",()=>{let m=new Date;this.dueDateInput.value=I(m,"yyyy-MM-dd"),this.dueTimeInput.value=I(m,"HH:mm")}),a.createEl("button",{text:"Clear",cls:"modal-form__button modal-form__button--quick-date modal-form__button--quick-date--clear",attr:{"aria-label":"Clear due date"}}).addEventListener("click",()=>{this.dueDateInput.value="",this.dueTimeInput.value=""});let h=e.createDiv({cls:"modal-form__buttons"});h.createEl("button",{text:"Save",cls:"modal-form__button modal-form__button--primary"}).addEventListener("click",()=>this.save()),h.createEl("button",{text:"Cancel",cls:"modal-form__button modal-form__button--secondary"}).addEventListener("click",()=>this.close())}async save(){let e=this.dueDateInput.value.trim(),r=this.dueTimeInput.value.trim(),i;if(e?r?i=yr(e,r):i=e:i=void 0,!Fl(e,r)){let s=this.contentEl.createEl("div",{text:"Please enter a valid date and time format",cls:"modal-form__error",attr:{role:"alert","aria-live":"assertive"}});this.dueDateInput.setAttribute("aria-invalid","true"),this.dueDateInput.setAttribute("aria-describedby","due-date-error"),s.setAttribute("id","due-date-error"),setTimeout(()=>{s.remove(),this.dueDateInput.removeAttribute("aria-invalid"),this.dueDateInput.removeAttribute("aria-describedby")},3e3);return}try{await this.plugin.taskService.updateProperty(this.task,"due",i),this.close()}catch(s){console.error("Failed to update due date:",s);let a=this.contentEl.createEl("div",{text:"Failed to update due date. Please try again.",cls:"modal-form__error"});setTimeout(()=>a.remove(),3e3)}}onClose(){let{contentEl:e}=this;e.empty()}}});var pE={};pi(pE,{ScheduledDateModal:()=>pm});var ml,pm,mE=_(()=>{ml=require("obsidian");je();we();pm=class extends ml.Modal{constructor(e,r,i){super(e);this.task=r,this.plugin=i}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-plugin"),this.titleEl.setText("Set scheduled date"),this.titleEl.setAttribute("id","scheduled-date-modal-title"),this.containerEl.setAttribute("aria-labelledby","scheduled-date-modal-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),e.createEl("p",{text:`Task: ${this.task.title}`,cls:"scheduled-date-modal__task-title"});let i=new ml.Setting(e).setName("Scheduled Date & Time").setDesc("Enter scheduled date and optional time (leave time empty for date-only)").controlEl.createDiv({cls:"modal-form__datetime-container"});this.scheduledDateInput=i.createEl("input",{type:"date",cls:"modal-form__input modal-form__input--date",attr:{"aria-label":"Scheduled date for task",placeholder:"YYYY-MM-DD"}}),this.scheduledDateInput.value=Z(this.task.scheduled||""),this.scheduledTimeInput=i.createEl("input",{type:"time",cls:"modal-form__input modal-form__input--time",attr:{"aria-label":"Scheduled time for task (optional)",placeholder:"HH:MM"}}),this.scheduledTimeInput.value=It(this.task.scheduled||"")||"",this.scheduledDateInput.addEventListener("keydown",m=>{m.key==="Enter"?this.save():m.key==="Escape"&&this.close()}),this.scheduledTimeInput.addEventListener("keydown",m=>{m.key==="Enter"?this.save():m.key==="Escape"&&this.close()}),window.setTimeout(()=>this.scheduledDateInput.focus(),100);let s=e.createDiv({cls:"modal-form__group"});new ml.Setting(s).setName("Quick options").setHeading();let a=s.createDiv({cls:"modal-form__quick-actions"});a.createEl("button",{text:"Today",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to today"}}).addEventListener("click",()=>{this.scheduledDateInput.value=I(new Date,"yyyy-MM-dd")}),a.createEl("button",{text:"Tomorrow",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to tomorrow"}}).addEventListener("click",()=>{this.scheduledDateInput.value=I(gi(new Date,{days:1}),"yyyy-MM-dd")}),a.createEl("button",{text:"Next week",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to next week"}}).addEventListener("click",()=>{this.scheduledDateInput.value=I(gi(new Date,{weeks:1}),"yyyy-MM-dd")}),a.createEl("button",{text:"Now",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date and time to now"}}).addEventListener("click",()=>{let m=new Date;this.scheduledDateInput.value=I(m,"yyyy-MM-dd"),this.scheduledTimeInput.value=I(m,"HH:mm")}),a.createEl("button",{text:"Clear",cls:"modal-form__button modal-form__button--quick-date modal-form__button--quick-date--clear",attr:{"aria-label":"Clear scheduled date"}}).addEventListener("click",()=>{this.scheduledDateInput.value="",this.scheduledTimeInput.value=""});let h=e.createDiv({cls:"modal-form__buttons"});h.createEl("button",{text:"Save",cls:"modal-form__button modal-form__button--primary"}).addEventListener("click",()=>this.save()),h.createEl("button",{text:"Cancel",cls:"modal-form__button modal-form__button--secondary"}).addEventListener("click",()=>this.close())}async save(){let e=this.scheduledDateInput.value.trim(),r=this.scheduledTimeInput.value.trim(),i;if(e?r?i=yr(e,r):i=e:i=void 0,!Fl(e,r)){let s=this.contentEl.createEl("div",{text:"Please enter a valid date and time format",cls:"modal-form__error",attr:{role:"alert","aria-live":"assertive"}});this.scheduledDateInput.setAttribute("aria-invalid","true"),this.scheduledDateInput.setAttribute("aria-describedby","scheduled-date-error"),s.setAttribute("id","scheduled-date-error"),window.setTimeout(()=>{s.remove(),this.scheduledDateInput.removeAttribute("aria-invalid"),this.scheduledDateInput.removeAttribute("aria-describedby")},3e3);return}try{await this.plugin.taskService.updateProperty(this.task,"scheduled",i),this.close()}catch(s){console.error("Failed to update scheduled date:",s);let a=this.contentEl.createEl("div",{text:"Failed to update scheduled date. Please try again.",cls:"modal-form__error"});window.setTimeout(()=>a.remove(),3e3)}}onClose(){let{contentEl:e}=this;e.empty()}}});var gE={};pi(gE,{TaskActionPaletteModal:()=>mm});var Ke,mm,yE=_(()=>{Ke=require("obsidian"),mm=class extends Ke.FuzzySuggestModal{constructor(e,r,i,s){super(e);this.task=r,this.plugin=i,this.targetDate=s,this.actions=this.buildActionsList(),this.setPlaceholder("Type to search for an action..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to execute"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText(`Quick actions: ${r.title}`),this.titleEl.setAttribute("id","task-action-palette-title"),this.containerEl.setAttribute("aria-labelledby","task-action-palette-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),this.containerEl.addClass("task-action-palette-modal")}buildActionsList(){let e=[];(this.task.recurrence?this.plugin.statusManager.getNonCompletionStatuses():this.plugin.statusManager.getAllStatuses()).forEach(s=>{let a=this.task.status===s.value;e.push({id:`status-${s.value}`,title:`Change status to "${s.label}"`,description:`Set task status to ${s.label}`,icon:a?"check":"circle",category:"status",keywords:["status",s.value,s.label,"change","set"],isApplicable:()=>!a,execute:async o=>{await this.plugin.updateTaskProperty(o,"status",s.value),new Ke.Notice(`Status changed to ${s.label}`)}})}),this.plugin.priorityManager.getAllPriorities().forEach(s=>{let a=this.task.priority===s.value;e.push({id:`priority-${s.value}`,title:`Set priority to "${s.label}"`,description:`Change task priority to ${s.label}`,icon:a?"check":"flag",category:"priority",keywords:["priority",s.value,s.label,"change","set"],isApplicable:()=>!a,execute:async o=>{await this.plugin.updateTaskProperty(o,"priority",s.value),new Ke.Notice(`Priority changed to ${s.label}`)}})}),e.push({id:"set-due-date",title:"Set due date",description:"Set or change the task due date",icon:"calendar",category:"dates",keywords:["due","date","deadline","set","change"],isApplicable:()=>!0,execute:async s=>{this.plugin.openDueDateModal(s)}},{id:"set-scheduled-date",title:"Set scheduled date",description:"Set or change when the task is scheduled",icon:"calendar-clock",category:"dates",keywords:["scheduled","date","schedule","set","change"],isApplicable:()=>!0,execute:async s=>{this.plugin.openScheduledDateModal(s)}},{id:"clear-due-date",title:"Clear due date",description:"Remove the due date from this task",icon:"calendar-x",category:"dates",keywords:["clear","remove","due","date"],isApplicable:s=>!!s.due,execute:async s=>{await this.plugin.updateTaskProperty(s,"due",void 0),new Ke.Notice("Due date cleared")}},{id:"clear-scheduled-date",title:"Clear scheduled date",description:"Remove the scheduled date from this task",icon:"calendar-x",category:"dates",keywords:["clear","remove","scheduled","date"],isApplicable:s=>!!s.scheduled,execute:async s=>{await this.plugin.updateTaskProperty(s,"scheduled",void 0),new Ke.Notice("Scheduled date cleared")}});let i=this.plugin.getActiveTimeSession(this.task);return e.push({id:"toggle-time-tracking",title:i?"Stop time tracking":"Start time tracking",description:i?"Stop tracking time for this task":"Start tracking time for this task",icon:i?"pause":"play",category:"tracking",keywords:["time","tracking","timer",i?"stop":"start"],isApplicable:()=>!0,execute:async s=>{this.plugin.getActiveTimeSession(s)?(await this.plugin.stopTimeTracking(s),new Ke.Notice("Time tracking stopped")):(await this.plugin.startTimeTracking(s),new Ke.Notice("Time tracking started"))}}),e.push({id:"toggle-archive",title:this.task.archived?"Unarchive task":"Archive task",description:this.task.archived?"Move task back to active tasks":"Archive this task",icon:this.task.archived?"archive-restore":"archive",category:"organization",keywords:["archive",this.task.archived?"unarchive":"archive","organize"],isApplicable:()=>!0,execute:async s=>{await this.plugin.toggleTaskArchive(s),new Ke.Notice(s.archived?"Task unarchived":"Task archived")}}),this.task.recurrence&&e.push({id:"complete-recurring-instance",title:"Complete this occurrence",description:"Mark this specific instance of the recurring task as complete",icon:"check-circle",category:"status",keywords:["complete","done","finish","recurring","instance","occurrence"],isApplicable:(s,a,o)=>!a.statusManager.isCompletedStatus(s.status),execute:async(s,a,o)=>{await a.toggleRecurringTaskComplete(s,o),new Ke.Notice("Recurring task instance completed")}}),e.push({id:"edit-task",title:"Edit task details",description:"Open the full task editor",icon:"edit",category:"other",keywords:["edit","modify","details","properties"],isApplicable:()=>!0,execute:async s=>{await this.plugin.openTaskEditModal(s)}},{id:"open-task-file",title:"Open task file",description:"Open the task file in the editor",icon:"file-text",category:"other",keywords:["open","file","editor","edit"],isApplicable:()=>!0,execute:async s=>{let a=this.plugin.app.vault.getAbstractFileByPath(s.path);a&&await this.plugin.app.workspace.getLeaf(!0).openFile(a)}},{id:"copy-task-title",title:"Copy task title",description:"Copy the task title to clipboard",icon:"copy",category:"other",keywords:["copy","clipboard","title"],isApplicable:()=>!0,execute:async s=>{try{await navigator.clipboard.writeText(s.title),new Ke.Notice("Task title copied to clipboard")}catch(a){new Ke.Notice("Failed to copy to clipboard")}}},{id:"copy-task-link",title:"Copy task link",description:"Copy a wikilink to this task",icon:"link",category:"other",keywords:["copy","link","wikilink","reference"],isApplicable:()=>!0,execute:async s=>{try{let a=this.plugin.app.vault.getAbstractFileByPath(s.path);if(a){let o=this.plugin.app.metadataCache.fileToLinktext(a,"");await navigator.clipboard.writeText(`[[${o}]]`),new Ke.Notice("Task link copied to clipboard")}}catch(a){new Ke.Notice("Failed to copy to clipboard")}}},{id:"delete-task",title:"Delete task",description:"Permanently delete this task",icon:"trash",category:"other",keywords:["delete","remove","trash"],isApplicable:()=>!0,execute:async s=>{this.close();let{showDeleteConfirmationModal:a}=await Promise.resolve().then(()=>(ui(),Xp));await a(s,this.plugin)}}),e}getItems(){return this.actions.filter(e=>e.isApplicable(this.task,this.plugin,this.targetDate)).sort((e,r)=>{var o,l;let i={status:0,priority:1,dates:2,tracking:3,organization:4,other:5},s=(o=i[e.category])!=null?o:999,a=(l=i[r.category])!=null?l:999;return s!==a?s-a:e.title.localeCompare(r.title)})}getItemText(e){return[e.title,e.description,e.category,...e.keywords].join(" ")}renderSuggestion(e,r){let i=e.item,s=r.createDiv({cls:"task-action-palette__suggestion"}),a=s.createDiv({cls:"task-action-palette__icon"});(0,Ke.setIcon)(a,i.icon);let o=s.createDiv({cls:"task-action-palette__content"});o.createDiv({cls:"task-action-palette__title",text:i.title}),o.createDiv({cls:"task-action-palette__description",text:i.description}),s.createDiv({cls:"task-action-palette__badge"}).createSpan({cls:`task-action-palette__category task-action-palette__category--${i.category}`,text:i.category})}async onChooseItem(e,r){try{let i=await this.plugin.cacheManager.getTaskInfo(this.task.path);if(!i){new Ke.Notice("Task not found");return}await e.execute(i,this.plugin,this.targetDate)}catch(i){let s=i instanceof Error?i.message:String(i);console.error("Error executing action:",{error:s,actionId:e.id,taskPath:this.task.path}),new Ke.Notice(`Failed to execute action: ${s}`)}}}});var oA={};pi(oA,{default:()=>aA});module.exports=DE(oA);var ee=require("obsidian");je();var dn=Ve(Yt());Nu();var ls="tasknotes-mini-calendar-view",Ur="tasknotes-advanced-calendar-view",bi="tasknotes-task-list-view",ya="tasknotes-notes-view",Ti="tasknotes-agenda-view",va="tasknotes-pomodoro-view",wa="tasknotes-pomodoro-stats-view",ir="tasknotes-kanban-view",Ei="date-selected";var it="data-changed",xe="task-updated",Il="task-deleted",Pl="pomodoro-start",Nl="pomodoro-complete",Ol="pomodoro-interrupt",nr="pomodoro-tick",Ag="timeblocking-toggled";var ba=[{id:"title",label:"Title",category:"text",supportedOperators:["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"text"},{id:"status",label:"Status",category:"select",supportedOperators:["is","is-not","is-empty","is-not-empty"],valueInputType:"select"},{id:"priority",label:"Priority",category:"select",supportedOperators:["is","is-not","is-empty","is-not-empty"],valueInputType:"select"},{id:"tags",label:"Tags",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"contexts",label:"Contexts",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"projects",label:"Projects",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"due",label:"Due Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"scheduled",label:"Scheduled Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"completedDate",label:"Completed Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"file.ctime",label:"Created Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"file.mtime",label:"Modified Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"archived",label:"Archived",category:"boolean",supportedOperators:["is-checked","is-not-checked"],valueInputType:"none"},{id:"timeEstimate",label:"Time Estimate",category:"numeric",supportedOperators:["is","is-not","is-greater-than","is-less-than"],valueInputType:"number"},{id:"recurrence",label:"Recurrence",category:"special",supportedOperators:["is-empty","is-not-empty"],valueInputType:"none"},{id:"status.isCompleted",label:"Completed",category:"boolean",supportedOperators:["is-checked","is-not-checked"],valueInputType:"none"}],Rl=[{id:"is",label:"is",requiresValue:!0},{id:"is-not",label:"is not",requiresValue:!0},{id:"contains",label:"contains",requiresValue:!0},{id:"does-not-contain",label:"does not contain",requiresValue:!0},{id:"is-before",label:"is before",requiresValue:!0},{id:"is-after",label:"is after",requiresValue:!0},{id:"is-on-or-before",label:"is on or before",requiresValue:!0},{id:"is-on-or-after",label:"is on or after",requiresValue:!0},{id:"is-empty",label:"is empty",requiresValue:!1},{id:"is-not-empty",label:"is not empty",requiresValue:!1},{id:"is-checked",label:"is checked",requiresValue:!1},{id:"is-not-checked",label:"is not checked",requiresValue:!1},{id:"is-greater-than",label:"is greater than",requiresValue:!0},{id:"is-less-than",label:"is less than",requiresValue:!0}];var Dt=require("obsidian");je();we();var ec=Ve(Yt());at();var bs=require("obsidian"),_n=class{constructor(){this.metrics=new Map;this.markers=new Map;this.enabled=!0;this.mutationObservers=new Set;this.performanceObservers=new Set}static getInstance(){return _n.instance||(_n.instance=new _n),_n.instance}startTimer(t){this.enabled&&this.markers.set(t,performance.now())}endTimer(t){if(!this.enabled)return 0;let e=this.markers.get(t);if(e===void 0)return t.includes("-measure-")||console.warn(`No start marker found for operation: ${t}`),0;let r=performance.now()-e;return this.recordMetric(t,r),this.markers.delete(t),r}async measure(t,e){if(!this.enabled)return e();let r=performance.now();try{return await e()}finally{let i=performance.now()-r;this.recordMetric(t,i)}}measureSync(t,e){if(!this.enabled)return e();let r=performance.now();try{return e()}finally{let i=performance.now()-r;this.recordMetric(t,i)}}recordMetric(t,e){if(!this.enabled)return;this.metrics.has(t)||this.metrics.set(t,[]);let r=this.metrics.get(t);r.push(e),r.length>50&&r.splice(0,r.length-50)}getStats(t){let e=this.metrics.get(t);if(!e||e.length===0)return null;let r=[...e].sort((a,o)=>a-o),i=r.length,s=r.reduce((a,o)=>a+o,0);return{count:i,average:s/i,min:r[0],max:r[i-1],median:r[Math.floor(i/2)],p95:r[Math.floor(i*.95)]}}getAllStats(){let t={};for(let[e]of this.metrics)t[e]=this.getStats(e);return t}logSummary(){if(!this.enabled)return;console.group("[Performance Summary]");let t=this.getAllStats();["cache-file-read","task-list-render","calendar-render","task-update","file-index","dom-update"].forEach(r=>{let i=t[r];i&&console.log(`${r}:`,{average:`${i.average.toFixed(2)}ms`,p95:`${i.p95.toFixed(2)}ms`,count:i.count})}),console.groupEnd()}monitorDOMMutations(t){if(!this.enabled)return()=>{};let e=0,r=performance.now(),i=new MutationObserver(s=>{e+=s.length;let a=performance.now()-r;e>100&&a<1e3&&console.warn(`High DOM mutation rate: ${e} mutations in ${a.toFixed(2)}ms`)});return i.observe(t,{childList:!0,subtree:!0,attributes:!0}),this.mutationObservers.add(i),()=>{i.disconnect(),this.mutationObservers.delete(i),this.recordMetric("dom-mutations",e)}}recordMemoryUsage(t){if(!this.enabled||!("memory"in performance))return;let e=performance.memory,r={used:e.usedJSHeapSize/1024/1024,total:e.totalJSHeapSize/1024/1024,limit:e.jsHeapSizeLimit/1024/1024},i=t?`memory-${t}`:"memory-usage";this.recordMetric(i,r.used),r.used>100&&console.warn(`High memory usage: ${r.used.toFixed(2)}MB`)}trackLongTasks(){if(!this.enabled||!("PerformanceObserver"in window))return()=>{};let t=new PerformanceObserver(e=>{for(let r of e.getEntries())r.duration>50&&(console.warn(`Long task detected: ${r.duration.toFixed(2)}ms`),this.recordMetric("long-task",r.duration))});try{t.observe({entryTypes:["longtask"]}),this.performanceObservers.add(t)}catch(e){console.warn("Long task monitoring not supported")}return()=>{t.disconnect(),this.performanceObservers.delete(t)}}mark(t){if(this.enabled)try{performance.mark(`tasknotes-${t}`)}catch(e){}}measureBetweenMarks(t,e,r){if(this.enabled)try{performance.measure(`tasknotes-${r}`,`tasknotes-${t}`,`tasknotes-${e}`)}catch(i){}}clear(){this.metrics.clear(),this.markers.clear()}destroy(){for(let t of this.mutationObservers)t.disconnect();this.mutationObservers.clear();for(let t of this.performanceObservers)t.disconnect();this.performanceObservers.clear(),this.clear(),_n.instance=null}setEnabled(t){this.enabled=t,t||this.clear()}exportData(){let t={timestamp:new Date().toISOString(),stats:this.getAllStats(),platform:{isDesktop:bs.Platform.isDesktop,isMobile:bs.Platform.isMobile,isWin:bs.Platform.isWin,isMacOS:bs.Platform.isMacOS,isLinux:bs.Platform.isLinux},memoryInfo:"memory"in performance?performance.memory:null};return JSON.stringify(t,null,2)}},Xl=_n;Xl.instance=null;var Qr=Xl.getInstance();we();var Fa=class extends Dt.ItemView{constructor(e,r){super(e);this.colorizeMode="tasks";this.listeners=[];this.monthCalculationCache=new Map;this.debouncedRefresh=null;this.currentCacheKey="";this.calendarDayElements=null;this.elementToDateMap=new Map;this.plugin=r;let i=this.plugin.selectedDate;this.displayedMonth=i.getMonth(),this.displayedYear=i.getFullYear(),this.registerEvents()}registerEvents(){this.listeners.forEach(s=>this.plugin.emitter.offref(s)),this.listeners=[];let e=this.plugin.emitter.on(it,()=>{this.refresh()});this.listeners.push(e);let r=this.plugin.emitter.on(Ei,s=>{this.displayedMonth!==s.getMonth()||this.displayedYear!==s.getFullYear()?(this.displayedMonth=s.getMonth(),this.displayedYear=s.getFullYear(),this.clearMonthCalculationCache(),this.colorizeMode==="daily"&&this.plugin.cacheManager.rebuildDailyNotesCache(s.getFullYear(),s.getMonth()),this.refresh()):(this.updateSelectedDate(s),this.updateMonthDisplay())});this.listeners.push(r);let i=this.plugin.emitter.on(xe,({path:s,originalTask:a,updatedTask:o})=>{if(!s||!o){console.error("EVENT_TASK_UPDATED received invalid data:",{path:s,originalTask:a,updatedTask:o});return}this.handleTaskUpdate(a,o)});this.listeners.push(i)}getViewType(){return ls}getDisplayText(){return"Mini Calendar"}getIcon(){return"calendar-days"}async onOpen(){await this.plugin.onReady();let e=this.contentEl;e.empty();let r=e.createDiv({cls:"tasknotes-plugin mini-calendar-view"});this.showLoadingIndicator(),this.renderView(r),await this.refresh(),this.registerKeyboardNavigation()}renderView(e){e.empty(),this.createCalendarControls(e),this.createCalendarGrid(e),this.colorizeCalendar()}colorizeCalendar(){switch(this.colorizeMode){case"tasks":this.colorizeCalendarForTasks();break;case"notes":this.colorizeCalendarForNotes();break;case"daily":this.colorizeCalendarForDailyNotes();break}}async navigateToPreviousPeriod(){let e=new Date(this.plugin.selectedDate),r=new Date(e);r.setMonth(r.getMonth()-1),this.plugin.setSelectedDate(r)}async navigateToNextPeriod(){let e=new Date(this.plugin.selectedDate),r=new Date(e);r.setMonth(r.getMonth()+1),this.plugin.setSelectedDate(r)}async navigateToToday(){let e=new Date;this.plugin.setSelectedDate(e)}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.monthCalculationCache.clear(),this.elementToDateMap.clear(),this.calendarDayElements=null,this.currentCacheKey="",this.contentEl.empty()}registerKeyboardNavigation(){this.registerDomEvent(document,"keydown",async e=>{if(!this.isThisViewActive())return;let r=new Date(this.plugin.selectedDate),i;switch(e.key){case"ArrowLeft":i=new Date(r),i.setDate(r.getDate()-1);break;case"ArrowRight":i=new Date(r),i.setDate(r.getDate()+1);break;case"ArrowUp":i=new Date(r),i.setDate(r.getDate()-7);break;case"ArrowDown":i=new Date(r),i.setDate(r.getDate()+7);break;case"Enter":e.preventDefault(),this.plugin.navigateToDailyNote(r);return;default:return}i&&(e.preventDefault(),this.plugin.setSelectedDate(i))})}isThisViewActive(){return this.app.workspace.getActiveViewOfType(Fa)===this}navigateDate(e,r){let i=new Date(this.plugin.selectedDate),s=new Date(i);s.setDate(i.getDate()+r*7+e),this.plugin.setSelectedDate(s)}async refresh(){this.showLoadingIndicator();try{let e=this.contentEl.querySelector(".mini-calendar-view");e||(e=this.contentEl.createDiv({cls:"tasknotes-plugin mini-calendar-view"})),this.renderView(e)}finally{this.hideLoadingIndicator()}}updateSelectedDate(e){let r=this.contentEl.querySelectorAll(".mini-calendar-view__day");r.forEach(i=>{i.classList.remove("mini-calendar-view__day--selected"),i.setAttribute("aria-selected","false"),i.setAttribute("tabindex","-1")}),r.forEach(i=>{let s=i;(s.getAttribute("aria-label")||"").includes(I(e,"EEEE, MMMM d, yyyy"))&&(s.classList.add("mini-calendar-view__day--selected"),s.setAttribute("aria-selected","true"),s.setAttribute("tabindex","0"),s.focus())}),this.plugin.selectedDate=e}updateMonthDisplay(){let e=this.contentEl.querySelector(".mini-calendar-view__month-display");e&&(e.textContent=I(this.plugin.selectedDate,"MMMM yyyy"))}showLoadingIndicator(){let e=this.contentEl.querySelector(".mini-calendar-view")||this.contentEl;if(e.querySelector(".cache-loading-indicator"))return;let r=document.createElement("div");r.className="cache-loading-indicator",r.textContent="Loading calendar data...",e.prepend(r)}hideLoadingIndicator(){let e=this.contentEl.querySelector(".cache-loading-indicator");e&&e.remove()}createCalendarControls(e){let i=e.createDiv({cls:"mini-calendar-view__controls"}).createDiv({cls:"mini-calendar-view__header"}),s=i.createEl("select",{cls:"mini-calendar-view__view-selector",attr:{title:"Change view","aria-label":"Change calendar view"}});[{value:"tasks",text:"Tasks"},{value:"notes",text:"Notes"},{value:"daily",text:"Daily notes"}].forEach(u=>{let h=s.createEl("option",{value:u.value,text:u.text});u.value===this.colorizeMode&&(h.selected=!0)}),s.addEventListener("change",async()=>{let u=s.value;this.showLoadingIndicator();try{await this.setColorizeMode(u)}finally{this.hideLoadingIndicator()}});let o=i.createDiv({cls:"mini-calendar-view__navigation"});o.createEl("button",{text:"\u2039",cls:"mini-calendar-view__nav-button mini-calendar-view__nav-button--prev",attr:{"aria-label":"Previous month",title:"Previous month"}}).addEventListener("click",()=>{this.navigateToPreviousPeriod()}),o.createDiv({cls:"mini-calendar-view__month-display",text:I(this.plugin.selectedDate,"MMMM yyyy")}),o.createEl("button",{text:"\u203A",cls:"mini-calendar-view__nav-button mini-calendar-view__nav-button--next",attr:{"aria-label":"Next month",title:"Next month"}}).addEventListener("click",()=>{this.navigateToNextPeriod()}),i.createEl("button",{text:"Today",cls:"mini-calendar-view__today-button",attr:{"aria-label":"Go to today",title:"Go to today"}}).addEventListener("click",()=>{this.navigateToToday()})}async setColorizeMode(e){if(this.colorizeMode!==e){if(this.colorizeMode=e,e==="daily"){let r=this.plugin.selectedDate.getFullYear(),i=this.plugin.selectedDate.getMonth();await this.plugin.cacheManager.rebuildDailyNotesCache(r,i)}this.colorizeCalendar()}}createCalendarGrid(e){let r=e.createDiv({cls:"mini-calendar-view__grid-container"}),i=this.plugin.selectedDate,s=i.getMonth(),a=i.getFullYear(),o=new Date(a,s,1),l=new Date(a,s+1,0),c=this.plugin.settings.calendarViewSettings.firstDay||0,d=(o.getDay()-c+7)%7,u=r.createDiv({cls:"mini-calendar-view__grid",attr:{role:"grid","aria-label":`Calendar for ${I(this.plugin.selectedDate,"MMMM yyyy")}`,id:"calendar-grid"}}),h=u.createDiv({cls:"mini-calendar-view__grid-header",attr:{role:"row"}}),f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];[...f.slice(c),...f.slice(0,c)].forEach((E,C)=>{h.createDiv({text:E,cls:"mini-calendar-view__day-header",attr:{role:"columnheader","aria-label":E}})});let m=d,g=42,v=l.getDate(),T=g-v-m,k=new Date(a,s,0).getDate(),D=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}});for(let E=0;E<m;E++){let C=k-m+E+1,S=new Date(a,s-1,C),O=Oa(S,i),F=D.createDiv({cls:`mini-calendar-view__day mini-calendar-view__day--outside-month${O?" mini-calendar-view__day--selected":""}`,text:C.toString(),attr:{role:"gridcell",tabindex:O?"0":"-1","aria-label":I(S,"EEEE, MMMM d, yyyy"),"aria-selected":O?"true":"false"}});F.addEventListener("click",()=>{this.plugin.setSelectedDate(S)}),F.addEventListener("mouseover",P=>{this.showDayPreview(P,S,F)}),F.addEventListener("keydown",P=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),this.plugin.setSelectedDate(S))}),this.addDropHandlers(F,S)}let M=new Date;for(let E=1;E<=v;E++){(E+m-1)%7===0&&E>1&&(D=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}}));let C=new Date(a,s,E),S=Oa(C,M),O=Oa(C,i),F="mini-calendar-view__day";S&&(F+=" mini-calendar-view__day--today"),O&&(F+=" mini-calendar-view__day--selected");let P=D.createDiv({cls:F,text:E.toString(),attr:{role:"gridcell",tabindex:O?"0":"-1","aria-label":I(C,"EEEE, MMMM d, yyyy")+(S?" (Today)":""),"aria-selected":O?"true":"false","aria-current":S?"date":null}});P.addEventListener("click",()=>{this.plugin.setSelectedDate(C)}),P.addEventListener("mouseover",x=>{this.showDayPreview(x,C,P)}),P.addEventListener("keydown",x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),this.plugin.setSelectedDate(C))}),this.addDropHandlers(P,C)}for(let E=1;E<=T;E++){(E+m+v-1)%7===0&&E>1&&(D=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}}));let C=new Date(a,s+1,E),S=Oa(C,i),O=D.createDiv({cls:`mini-calendar-view__day mini-calendar-view__day--outside-month${S?" mini-calendar-view__day--selected":""}`,text:E.toString(),attr:{role:"gridcell",tabindex:S?"0":"-1","aria-label":I(C,"EEEE, MMMM d, yyyy"),"aria-selected":S?"true":"false"}});O.addEventListener("click",()=>{this.plugin.setSelectedDate(C)}),O.addEventListener("mouseover",F=>{this.showDayPreview(F,C,O)}),O.addEventListener("keydown",F=>{(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),this.plugin.setSelectedDate(C))}),this.addDropHandlers(O,C)}}clearCalendarColorization(){this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(r=>{r.querySelectorAll(".note-indicator, .task-indicator, .daily-note-indicator").forEach(i=>i.remove()),r.classList.remove("mini-calendar-view__day--has-notes-few","mini-calendar-view__day--has-notes-some","mini-calendar-view__day--has-notes-many","mini-calendar-view__day--has-tasks","mini-calendar-view__day--has-completed-tasks","mini-calendar-view__day--has-archived-tasks","mini-calendar-view__day--has-scheduled-tasks","mini-calendar-view__day--has-daily-note")})}async colorizeCalendarForNotes(){return Qr.measure("calendar-colorize-notes",async()=>{this.clearCalendarColorization();let e=this.plugin.selectedDate.getFullYear(),r=this.plugin.selectedDate.getMonth(),i;try{i=await this.plugin.cacheManager.getCalendarData(e,r)}catch(o){console.warn("Failed to get calendar data from unified cache manager:",o),i=await this.plugin.cacheManager.getCalendarData(e,r)}let s=i.notes;this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(o=>{let l=o.innerText.trim();if(l){let c=this.plugin.selectedDate.getFullYear(),d=this.plugin.selectedDate.getMonth(),u=parseInt(l);if(isNaN(u))return;let h=d;o.classList.contains("mini-calendar-view__day--outside-month")&&(u>15?h=d===0?11:d-1:h=d===11?0:d+1);let f=bn(c,h,u),p=Te(f),m=s.get(p)||0;if(m>0){let g=document.createElement("div");g.className="note-indicator";let v="";m>=5?(v="many-notes",o.classList.add("mini-calendar-view__day--has-notes-many")):m>=2?(v="some-notes",o.classList.add("mini-calendar-view__day--has-notes-some")):(v="few-notes",o.classList.add("mini-calendar-view__day--has-notes-few")),g.classList.add(v),g.setAttribute("aria-label",`${m} note${m>1?"s":""}`),(0,Dt.setTooltip)(g,`${m} note${m>1?"s":""}`,{placement:"top"}),o.appendChild(g)}}})})}async colorizeCalendarForTasks(){this.clearCalendarColorization();let e=this.plugin.selectedDate.getFullYear(),r=this.plugin.selectedDate.getMonth(),s=(await this.plugin.cacheManager.getCalendarData(e,r)).tasks;this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(o=>{let l=o.innerText.trim();if(l){let c=this.plugin.selectedDate.getFullYear(),d=this.plugin.selectedDate.getMonth(),u=parseInt(l);if(isNaN(u))return;let h=`${c}-${d}-${u}-${o.classList.contains("mini-calendar-view__day--outside-month")}`,f=this.monthCalculationCache.get(h);if(!f){let g=d;o.classList.contains("mini-calendar-view__day--outside-month")&&(u>15?g=d===0?11:d-1:g=d===11?0:d+1);let v=bn(c,g,u),T=Te(v);f={actualMonth:g,dateObj:v,dateKey:T},this.monthCalculationCache.set(h,f)}let{dateKey:p}=f,m=s.get(p);if(m&&(m.hasDue||m.hasScheduled)){let g=document.createElement("div");g.className="task-indicator";let v="";m.hasArchived?(o.classList.add("mini-calendar-view__day--has-archived-tasks"),g.classList.add("archived-tasks"),v="Archived"):m.hasCompleted?(o.classList.add("mini-calendar-view__day--has-completed-tasks"),g.classList.add("completed-tasks"),v="Completed"):m.hasDue?(o.classList.add("mini-calendar-view__day--has-tasks"),g.classList.add("due-tasks"),v="Due"):m.hasScheduled&&(o.classList.add("mini-calendar-view__day--has-scheduled-tasks"),g.classList.add("scheduled-tasks"),v="Scheduled"),g.setAttribute("aria-label",`${v} tasks (${m.count})`),(0,Dt.setTooltip)(g,`${v} tasks (${m.count})`,{placement:"top"}),o.appendChild(g)}}})}async colorizeCalendarForDailyNotes(){this.clearCalendarColorization();let e=this.plugin.selectedDate.getFullYear(),r=this.plugin.selectedDate.getMonth(),i;Fa.dailyNotesInitialized?i=(await this.plugin.cacheManager.getCalendarData(e,r)).dailyNotes:(await this.plugin.cacheManager.rebuildDailyNotesCache(e,r),Fa.dailyNotesInitialized=!0,i=(await this.plugin.cacheManager.getCalendarData(e,r)).dailyNotes),this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(a=>{let o=a.innerText.trim();if(o){let l=this.plugin.selectedDate.getFullYear(),c=this.plugin.selectedDate.getMonth(),d=parseInt(o);if(isNaN(d))return;let u=`${l}-${c}-${d}-${a.classList.contains("mini-calendar-view__day--outside-month")}`,h=this.monthCalculationCache.get(u);if(!h){let p=c;a.classList.contains("mini-calendar-view__day--outside-month")&&(d>15?p=c===0?11:c-1:p=c===11?0:c+1);let m=bn(l,p,d),g=Te(m);h={actualMonth:p,dateObj:m,dateKey:g},this.monthCalculationCache.set(u,h)}let f=h.dateKey;if(i.has(f)){let p=document.createElement("div");p.className="daily-note-indicator",a.classList.add("mini-calendar-view__day--has-daily-note"),p.setAttribute("aria-label","Daily note exists"),(0,Dt.setTooltip)(p,"Daily note exists",{placement:"top"}),a.appendChild(p)}}})}handleTaskUpdate(e,r){if(this.colorizeMode!=="tasks")return;let i=new Set;e!=null&&e.due&&i.add(Ta(e.due)),r.due&&i.add(Ta(r.due)),e!=null&&e.scheduled&&i.add(Ta(e.scheduled)),r.scheduled&&i.add(Ta(r.scheduled)),i.size!==0&&this.updateCalendarCellsForDates(Array.from(i))}async updateCalendarCellsForDates(e){if(e.length===0)return;let r=this.plugin.selectedDate.getFullYear(),i=this.plugin.selectedDate.getMonth(),a=(await this.plugin.cacheManager.getCalendarData(r,i)).tasks,o=`${r}-${i}`;(this.currentCacheKey!==o||!this.calendarDayElements)&&(this.calendarDayElements=this.contentEl.querySelectorAll(".mini-calendar-view__day"),this.currentCacheKey=o,this.buildElementToDateMap(r,i));let l=new Set(e),c=[];for(let[d,u]of this.elementToDateMap)l.has(u.dateKey)&&c.push({element:d,dateKey:u.dateKey});requestAnimationFrame(()=>{c.forEach(({element:d,dateKey:u})=>{this.updateSingleCalendarCell(d,u,a)})})}updateSingleCalendarCell(e,r,i){e.querySelectorAll(".task-indicator").forEach(a=>a.remove()),e.classList.remove("has-tasks","has-scheduled-tasks","has-completed-tasks","has-archived-tasks");let s=i.get(r);if(s&&(s.hasDue||s.hasScheduled)){let a=document.createElement("div");a.className="task-indicator";let o="";s.hasArchived?(e.classList.add("has-archived-tasks"),a.classList.add("archived-tasks"),o="Archived"):s.hasCompleted?(e.classList.add("has-completed-tasks"),a.classList.add("completed-tasks"),o="Completed"):s.hasDue?(e.classList.add("has-tasks"),a.classList.add("due-tasks"),o="Due"):s.hasScheduled&&(e.classList.add("has-scheduled-tasks"),a.classList.add("scheduled-tasks"),o="Scheduled"),a.setAttribute("aria-label",`${o} tasks (${s.count})`),(0,Dt.setTooltip)(a,`${o} tasks (${s.count})`,{placement:"top"}),e.appendChild(a)}}getCellDate(e,r,i,s){let a=s;e.classList.contains("outside-month")&&(r>15?a=s===0?11:s-1:a=s===11?0:s+1);try{return bn(i,a,r)}catch(o){return console.error("Error creating date:",o),null}}buildElementToDateMap(e,r){this.elementToDateMap.clear(),this.calendarDayElements&&this.calendarDayElements.forEach(i=>{let s=i,a=s.innerText.trim();if(!a||isNaN(parseInt(a)))return;let o=parseInt(a),l=this.getCellDate(s,o,e,r);if(l){let c=Te(l);this.elementToDateMap.set(i,{date:o,dateKey:c})}})}clearMonthCalculationCache(){let e=`${this.plugin.selectedDate.getFullYear()}-${this.plugin.selectedDate.getMonth()}`;for(let[r]of this.monthCalculationCache)r.startsWith(e)||this.monthCalculationCache.delete(r)}initializeDebouncedRefresh(){this.debouncedRefresh||(this.debouncedRefresh=(0,Dt.debounce)(()=>{this.refresh()},150))}getViewStartDate(){return bn(this.plugin.selectedDate.getFullYear(),this.plugin.selectedDate.getMonth(),1)}getViewEndDate(){return bn(this.plugin.selectedDate.getFullYear(),this.plugin.selectedDate.getMonth()+1,0)}showDayPreview(e,r,i){let s=this.getDailyNotePath(r);if(!s)return;let a=this.app.vault.getAbstractFileByPath(s);a&&a instanceof Dt.TFile&&this.app.workspace.trigger("hover-link",{event:e,source:"tasknotes-calendar",hoverParent:this,targetEl:i,linktext:s,sourcePath:s})}getDailyNotePath(e){try{let r=window.moment(e),i=(0,ec.getAllDailyNotes)(),s=(0,ec.getDailyNote)(r,i);return s?s.path:null}catch(r){return null}}addDropHandlers(e,r){e.addEventListener("dragover",i=>{i.preventDefault(),i.dataTransfer.dropEffect="move",e.classList.add("mini-calendar-view__day--dragover")}),e.addEventListener("dragleave",i=>{e.contains(i.relatedTarget)||e.classList.remove("mini-calendar-view__day--dragover")}),e.addEventListener("drop",async i=>{var s,a;i.preventDefault(),i.stopPropagation(),e.classList.remove("mini-calendar-view__day--dragover");try{let o=((s=i.dataTransfer)==null?void 0:s.getData("text/plain"))||((a=i.dataTransfer)==null?void 0:a.getData("application/x-task-path"));if(!o){console.warn("No task path found in drop data");return}let l=await this.plugin.cacheManager.getTaskInfo(o);if(!l){console.warn("Task not found:",o);return}let c=Te(r);await this.plugin.taskService.updateProperty(l,"due",c),new Dt.Notice(`Task "${l.title}" due date set to ${I(r,"MMM d, yyyy")}`),this.refresh()}catch(o){console.error("Error handling task drop on mini calendar:",o),new Dt.Notice("Failed to update task due date")}})}},La=Fa;La.dailyNotesInitialized=!1;var le=require("obsidian");var Ae=require("obsidian");var Kr=require("obsidian");je();var tc=require("obsidian"),br=class{static async execute(t,e={}){let{fallback:r,errorMessage:i="An error occurred",showNotice:s=!0,logError:a=!0}=e;try{return await t()}catch(o){if(a&&console.error(i,o),s){let l=o instanceof Error?o.message:String(o);new tc.Notice(`${i}: ${l}`)}return r}}static async executeWithRetry(t,e={}){let{maxRetries:r=3,retryDelay:i=1e3,errorMessage:s="Operation failed",showNotice:a=!0}=e,o;for(let l=0;l<=r;l++)try{return await t()}catch(c){if(o=c instanceof Error?c:new Error(String(c)),l<r){await new Promise(d=>setTimeout(d,i));continue}console.error(`${s} after ${r+1} attempts:`,o),a&&new tc.Notice(`${s}: ${o.message}`);return}}static async executeWithValidation(t,e,r={}){let{showNotice:i=!0}=r;for(let s of e)if(!s.condition){i&&new tc.Notice(s.message);return}return this.execute(t,r)}};var rc=class extends Kr.Modal{constructor(e,r,i){super(e);this.title="";this.folder="";this.template="";this.useTemplate=!1;this.plugin=r,this.options=i,this.title=this.generateDefaultTitle(),this.folder=this.getDefaultFolder(),this.template=this.getDefaultTemplate()}onOpen(){this.containerEl.addClass("tasknotes-plugin","ics-note-creation-modal"),this.createModalContent()}onClose(){this.contentEl.empty()}createModalContent(){let{contentEl:e}=this;e.empty(),e.createDiv("modal-header").createEl("h2",{text:"Create from ICS Event"});let i=e.createDiv("ics-event-preview");this.createEventPreview(i),new Kr.Setting(e).setName("Title").setDesc("Title for the new content").addText(l=>{this.titleInput=l.inputEl,l.setValue(this.title).onChange(c=>{this.title=c,this.updatePreview()})}),new Kr.Setting(e).setName("Folder").setDesc("Destination folder (leave empty for vault root)").addText(l=>{this.folderInput=l.inputEl,l.setValue(this.folder).setPlaceholder("folder/subfolder").onChange(c=>{this.folder=c,this.updatePreview()})}),this.templateContainer=e.createDiv("template-settings"),this.createTemplateSettings(),this.previewContainer=e.createDiv("content-preview"),this.updatePreview();let s=e.createDiv("modal-button-container"),a=s.createEl("button",{text:"Create",cls:"mod-cta"});a.onclick=l=>{l.preventDefault(),l.stopPropagation(),console.log("Create button clicked"),this.handleCreate()};let o=s.createEl("button",{text:"Cancel"});o.onclick=l=>{l.preventDefault(),l.stopPropagation(),console.log("Cancel button clicked"),this.close()},setTimeout(()=>{var l;return(l=this.titleInput)==null?void 0:l.focus()},100)}createEventPreview(e){let{icsEvent:r,subscriptionName:i}=this.options;e.createEl("h3",{text:r.title});let s=e.createDiv("event-details");if(r.start){let o=new Date(r.start),l=s.createDiv();l.createEl("strong",{text:"Start: "}),l.appendText(I(o,"PPPp"))}if(r.end&&!r.allDay){let o=new Date(r.end),l=s.createDiv();l.createEl("strong",{text:"End: "}),l.appendText(I(o,"PPPp"))}if(r.location){let o=s.createDiv();o.createEl("strong",{text:"Location: "}),o.appendText(r.location)}let a=s.createDiv();a.createEl("strong",{text:"Calendar: "}),a.appendText(i)}createTemplateSettings(){this.templateContainer.empty(),new Kr.Setting(this.templateContainer).setName("Use Template").setDesc("Apply a template when creating the content").addToggle(e=>{e.setValue(this.useTemplate).onChange(r=>{this.useTemplate=r,this.updateTemplateInput(),this.updatePreview()})}),this.useTemplate&&new Kr.Setting(this.templateContainer).setName("Template Path").setDesc("Path to the template file").addText(e=>{this.templateInput=e.inputEl,e.setValue(this.template).setPlaceholder("templates/ics-note-template.md").onChange(r=>{this.template=r,this.updatePreview()})})}updateDefaultsForContentType(){var e,r;this.folder=((e=this.plugin.settings.icsIntegration)==null?void 0:e.defaultNoteFolder)||"",this.template=((r=this.plugin.settings.icsIntegration)==null?void 0:r.defaultNoteTemplate)||"",this.folderInput&&(this.folderInput.value=this.folder),this.templateInput&&(this.templateInput.value=this.template)}updateTemplateInput(){this.createTemplateSettings()}updatePreview(){if(!this.previewContainer)return;this.previewContainer.empty(),this.previewContainer.createEl("h4",{text:"Summary"});let e=this.previewContainer.createDiv("preview-details"),r=e.createDiv();r.createEl("strong",{text:"Type: "}),r.appendText("Note");let i=e.createDiv();i.createEl("strong",{text:"Title: "}),i.appendText(this.title||"Untitled");let s=e.createDiv();if(s.createEl("strong",{text:"Folder: "}),s.appendText(this.folder||"Vault root"),this.useTemplate&&this.template){let c=e.createDiv();c.createEl("strong",{text:"Template: "}),c.appendText(this.template)}else{let c=e.createDiv();c.createEl("strong",{text:"Template: "}),c.appendText("Default format")}let a=this.previewContainer.createDiv("template-variables");a.createEl("h5",{text:"Available Template Variables"});let o=["{{title}}","{{icsEventTitle}}","{{icsEventStart}}","{{icsEventEnd}}","{{icsEventLocation}}","{{icsEventDescription}}","{{icsEventUrl}}","{{icsEventSubscription}}","{{icsEventId}}","{{date}}","{{time}}"],l=a.createDiv("variables-list");o.forEach(c=>{l.createSpan({text:c,cls:"template-variable"})})}generateDefaultTitle(){let{icsEvent:e}=this.options,r=new Date(e.start);return`${e.title} - ${I(r,"PPP")}`}getDefaultFolder(){var e;return((e=this.plugin.settings.icsIntegration)==null?void 0:e.defaultNoteFolder)||""}getDefaultTemplate(){var e;return((e=this.plugin.settings.icsIntegration)==null?void 0:e.defaultNoteTemplate)||""}async handleCreate(){await br.executeWithValidation(async()=>{var i,s;let{icsEvent:e}=this.options,r=await this.plugin.icsNoteService.createNoteFromICS(e,{title:this.title,folder:this.folder||void 0,template:this.useTemplate&&this.template?this.template:void 0});new Kr.Notice(`Note created: ${this.title}`),(s=(i=this.options).onContentCreated)==null||s.call(i,r.file,r.noteInfo),this.close()},[{condition:!!this.title.trim(),message:"Title is required"}],{errorMessage:"Failed to create note from ICS event"})}};var Zr=require("obsidian"),ic=class extends Zr.FuzzySuggestModal{constructor(e,r,i){super(e);this.plugin=r,this.onChoose=i,this.setPlaceholder("Type to search for notes to link..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles().filter(e=>e instanceof Zr.TFile&&e.extension==="md"&&!e.path.includes(".trash"))}getItemText(e){let r=`${e.name} ${e.path}`;if(e instanceof Zr.TFile){let i=this.app.metadataCache.getFileCache(e);if(i!=null&&i.frontmatter){let s=(0,Zr.parseFrontMatterAliases)(i.frontmatter);s&&s.length>0&&(r+=` ${s.join(" ")}`)}}return r}renderSuggestion(e,r){let i=e.item;r.empty();let s=r.createDiv({cls:"ics-note-link-suggestion"}),a=s.createSpan({cls:"note-link-name"});if(a.textContent=i.name,i instanceof Zr.TFile){let o=this.app.metadataCache.getFileCache(i);if(o!=null&&o.frontmatter){let l=this.plugin.fieldMapper.toUserField("title"),c=o.frontmatter[l];if(c){let d=s.createDiv({cls:"note-link-title"});d.textContent=c}else{let d=(0,Zr.parseFrontMatterAliases)(o.frontmatter);if(d&&d.length>0){let u=s.createDiv({cls:"note-link-aliases"});u.textContent=d.join(", ")}}}}if(i.path!==i.name){let o=s.createDiv({cls:"note-link-path"});o.textContent=i.path}}onChooseItem(e,r){this.onChoose(e)}};var nc=class extends Ae.Modal{constructor(e,r,i,s){super(e);this.relatedNotes=[];this.plugin=r,this.icsEvent=i,this.subscriptionName=s}async onOpen(){await this.renderContent()}async renderContent(){let{contentEl:e}=this;e.empty(),await this.loadRelatedNotes(),new Ae.Setting(e).setName("Calendar Event").setHeading(),new Ae.Setting(e).setName("Title").setDesc(this.icsEvent.title||"Untitled Event"),this.subscriptionName&&new Ae.Setting(e).setName("Calendar").setDesc(this.subscriptionName);let r=new Date(this.icsEvent.start),i=r.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(!this.icsEvent.allDay&&(i+=` at ${r.toLocaleTimeString()}`,this.icsEvent.end)){let s=new Date(this.icsEvent.end);i+=` - ${s.toLocaleTimeString()}`}new Ae.Setting(e).setName("Date & Time").setDesc(i),this.icsEvent.location&&new Ae.Setting(e).setName("Location").setDesc(this.icsEvent.location),this.icsEvent.description&&new Ae.Setting(e).setName("Description").setDesc(this.icsEvent.description),this.icsEvent.url&&new Ae.Setting(e).setName("URL").setDesc(this.icsEvent.url),new Ae.Setting(e).setName("Related Notes & Tasks").setHeading(),this.relatedNotes.length===0?new Ae.Setting(e).setDesc("No related notes or tasks found for this event."):this.relatedNotes.forEach(s=>{let a=this.isTaskNote(s);new Ae.Setting(e).setName(s.title).setDesc(`Type: ${a?"Task":"Note"}`).addButton(o=>{o.setButtonText("Open").onClick(async()=>{await this.safeOpenFile(s.path),this.close()})})}),new Ae.Setting(e).setName("Actions").setHeading(),new Ae.Setting(e).setName("Create from Event").setDesc("Create a new note or task from this calendar event").addButton(s=>{s.setButtonText("Create Note").onClick(()=>{console.log("Create Note clicked"),this.openCreationModal()})}).addButton(s=>{s.setButtonText("Create Task").onClick(async()=>{console.log("Create Task clicked"),await this.createTaskDirectly()})}),new Ae.Setting(e).setName("Link Existing").setDesc("Link an existing note to this calendar event").addButton(s=>{s.setButtonText("Link Note").onClick(()=>{console.log("Link Note clicked"),this.linkExistingNote()})}).addButton(s=>{s.setButtonText("Refresh").onClick(()=>{console.log("Refresh clicked"),this.refreshRelatedNotes()})})}async loadRelatedNotes(){let e=await br.execute(()=>this.plugin.icsNoteService.findRelatedNotes(this.icsEvent),{fallback:[],errorMessage:"Failed to load related notes",showNotice:!1});this.relatedNotes=e||[]}openCreationModal(){console.log("Opening note creation modal");try{new rc(this.app,this.plugin,{icsEvent:this.icsEvent,subscriptionName:this.subscriptionName||"Unknown Calendar",onContentCreated:async(r,i)=>{new Ae.Notice("Note created successfully"),this.refreshRelatedNotes(),await this.safeOpenFile(r.path)}}).open()}catch(e){console.error("Error opening creation modal:",e),new Ae.Notice("Failed to open creation modal")}}async linkExistingNote(){console.log("Link existing note button clicked"),await br.execute(async()=>{new ic(this.app,this.plugin,async r=>{await br.execute(async()=>{await this.plugin.icsNoteService.linkNoteToICS(r.path,this.icsEvent),new Ae.Notice(`Linked note "${r.name}" to ICS event`),this.refreshRelatedNotes()},{errorMessage:"Failed to link note"})}).open()},{errorMessage:"Failed to open note selection"})}async createTaskDirectly(){await br.execute(async()=>{let e=await this.plugin.icsNoteService.createTaskFromICS(this.icsEvent);new Ae.Notice(`Task created: ${e.taskInfo.title}`),await this.safeOpenFile(e.file.path),this.refreshRelatedNotes()},{errorMessage:"Failed to create task from ICS event"})}async refreshRelatedNotes(){await br.execute(async()=>{await this.loadRelatedNotes(),await this.renderContent(),new Ae.Notice("Related notes refreshed")},{errorMessage:"Failed to refresh related notes"})}isTaskNote(e){var i;let r=this.plugin.settings.taskTag;return((i=e.tags)==null?void 0:i.includes(r))||!1}async safeOpenFile(e){try{let r=this.app.vault.getAbstractFileByPath(e);r instanceof Ae.TFile?await this.app.workspace.getLeaf().openFile(r):(new Ae.Notice("File not found or invalid"),console.error("Invalid file path or file not found:",e))}catch(r){console.error("Error opening file:",r),new Ae.Notice("Failed to open file")}}onClose(){let{contentEl:e}=this;e.empty()}};var Ee=require("obsidian");var xi=require("obsidian"),Ts=class extends xi.FuzzySuggestModal{constructor(e,r,i){super(e);this.plugin=r,this.onChoose=i,this.setPlaceholder("Type to search for files and notes..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles()}getItemText(e){let r=`${e.name} ${e.path}`;if(e instanceof xi.TFile){let i=this.app.metadataCache.getFileCache(e);if(i!=null&&i.frontmatter){let s=(0,xi.parseFrontMatterAliases)(i.frontmatter);s&&s.length>0&&(r+=` ${s.join(" ")}`)}}return r}renderSuggestion(e,r){let i=e.item;r.empty();let s=r.createDiv({cls:"attachment-suggestion"}),a=s.createSpan({cls:"attachment-name"});if(a.textContent=i.name,i instanceof xi.TFile){let o=this.app.metadataCache.getFileCache(i);if(o!=null&&o.frontmatter){let l=this.plugin.fieldMapper.toUserField("title"),c=o.frontmatter[l];if(c){let d=s.createDiv({cls:"attachment-title"});d.textContent=c}else{let d=(0,xi.parseFrontMatterAliases)(o.frontmatter);if(d&&d.length>0){let u=s.createDiv({cls:"attachment-aliases"});u.textContent=d.join(", ")}}}}if(i.path!==i.name){let o=s.createDiv({cls:"attachment-path"});o.textContent=i.path}}onChooseItem(e,r){this.onChoose(e)}};var Jr=Ve(Yt()),sc=class extends Ee.Modal{constructor(e,r,i,s){super(e);this.selectedAttachments=[];this.plugin=r,this.timeblock={...i},this.originalTimeblock=i,this.eventDate=s}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("timeblock-info-modal"),new Ee.Setting(e).setName("Edit Timeblock").setHeading();let r=e.createDiv({cls:"timeblock-date-display"});r.createEl("strong",{text:"Date & Time: "});let i=`${this.eventDate.toLocaleDateString()} from ${this.timeblock.startTime} to ${this.timeblock.endTime}`;r.createSpan({text:i}),new Ee.Setting(e).setName("Title").setDesc("Title for your timeblock").addText(d=>{this.titleInput=d.inputEl,d.setPlaceholder("e.g., Deep work session").setValue(this.timeblock.title||"").onChange(()=>this.validateForm())}),new Ee.Setting(e).setName("Description").setDesc("Optional description for the timeblock").addTextArea(d=>{this.descriptionInput=d.inputEl,d.setPlaceholder("Focus on new features, no interruptions").setValue(this.timeblock.description||""),this.descriptionInput.rows=3}),new Ee.Setting(e).setName("Color").setDesc("Optional color for the timeblock").addText(d=>{this.colorInput=d.inputEl,d.setPlaceholder("#3b82f6").setValue(this.timeblock.color||"#6366f1"),this.colorInput.type="color"}),new Ee.Setting(e).setName("Attachments").setDesc("Files or notes linked to this timeblock").addButton(d=>{d.setButtonText("Add Attachment").setTooltip("Select a file or note using fuzzy search").onClick(()=>{new Ts(this.app,this.plugin,h=>{this.addAttachment(h)}).open()})}),this.attachmentsList=e.createDiv({cls:"timeblock-attachments-list"}),await this.initializeAttachments(),this.renderAttachmentsList();let s=e.createDiv({cls:"timeblock-modal-buttons"});s.style.display="flex",s.style.justifyContent="space-between",s.style.alignItems="center",s.style.marginTop="20px",s.createEl("button",{text:"Delete Timeblock",cls:"mod-warning timeblock-delete-button"}).addEventListener("click",()=>this.handleDelete());let o=s.createDiv({cls:"timeblock-modal-buttons-right"});o.style.display="flex",o.style.gap="8px",o.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),o.createEl("button",{text:"Save Changes",cls:"mod-cta timeblock-save-button"}).addEventListener("click",()=>this.handleSave()),this.validateForm(),window.setTimeout(()=>this.titleInput.focus(),50)}validateForm(){var s;let e=this.contentEl.querySelector(".timeblock-save-button");if(!e)return;let i=!!((s=this.titleInput)==null?void 0:s.value.trim());e.disabled=!i,e.style.opacity=i?"1":"0.5"}async initializeAttachments(){if(this.timeblock.attachments)for(let e of this.timeblock.attachments){let r=e.replace(/^\[\[|\]\]$/g,""),i=this.app.vault.getAbstractFileByPath(r);i&&this.selectedAttachments.push(i)}}addAttachment(e){if(this.selectedAttachments.some(r=>r.path===e.path)){new Ee.Notice(`"${e.name}" is already attached`);return}this.selectedAttachments.push(e),this.renderAttachmentsList(),new Ee.Notice(`Added "${e.name}" as attachment`)}removeAttachment(e){this.selectedAttachments=this.selectedAttachments.filter(r=>r.path!==e.path),this.renderAttachmentsList(),new Ee.Notice(`Removed "${e.name}" from attachments`)}openAttachment(e){e instanceof Ee.TFile?this.app.workspace.getLeaf(!1).openFile(e):new Ee.Notice(`Cannot open "${e.name}" - file type not supported`)}renderAttachmentsList(){if(this.attachmentsList.empty(),this.selectedAttachments.length===0){let e=this.attachmentsList.createDiv({cls:"timeblock-attachments-empty"});e.textContent="No attachments";return}this.selectedAttachments.forEach(e=>{let r=this.attachmentsList.createDiv({cls:"timeblock-attachment-item"}),i=r.createDiv({cls:"timeblock-attachment-info"});i.style.cursor="pointer",(0,Ee.setTooltip)(i,"Click to open",{placement:"top"}),i.addEventListener("click",()=>this.openAttachment(e));let s=i.createSpan({cls:"timeblock-attachment-name"});if(s.textContent=e.name,e.path!==e.name){let o=i.createDiv({cls:"timeblock-attachment-path"});o.textContent=e.path}let a=r.createEl("button",{cls:"timeblock-attachment-remove",text:"\xD7"});(0,Ee.setTooltip)(a,"Remove attachment",{placement:"top"}),a.addEventListener("click",o=>{o.stopPropagation(),this.removeAttachment(e)})})}async handleSave(){try{let e=this.titleInput.value.trim();if(!e){new Ee.Notice("Please enter a title for the timeblock");return}this.timeblock.title=e,this.timeblock.description=this.descriptionInput.value.trim()||void 0,this.timeblock.color=this.colorInput.value||void 0;let r=this.selectedAttachments.map(i=>`[[${i.path}]]`);this.timeblock.attachments=r.length>0?r:void 0,await this.updateTimeblockInDailyNote(),this.plugin.emitter.trigger("data-changed"),new Ee.Notice(`Timeblock "${e}" updated successfully`),this.close()}catch(e){console.error("Error updating timeblock:",e),new Ee.Notice("Failed to update timeblock. Check console for details.")}}async updateTimeblockInDailyNote(){if(!(0,Jr.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let e=this.eventDate.toISOString().split("T")[0],r=window.moment(e),i=(0,Jr.getAllDailyNotes)(),s=(0,Jr.getDailyNote)(r,i);if(!s)throw new Error("Daily note not found");let a=await this.app.vault.read(s),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let h=a.substring(3,u);l=a.substring(u+3);try{o=(0,Ee.parseYaml)(h)||{}}catch(f){console.error("Error parsing existing frontmatter:",f),o={}}}}if(o.timeblocks&&Array.isArray(o.timeblocks)){let u=o.timeblocks.findIndex(h=>h.id===this.originalTimeblock.id||h.title===this.originalTimeblock.title&&h.startTime===this.originalTimeblock.startTime&&h.endTime===this.originalTimeblock.endTime);if(u>=0)o.timeblocks[u]=this.timeblock;else throw new Error("Timeblock not found in daily note")}else throw new Error("No timeblocks found in daily note");let d=`---
${(0,Ee.stringifyYaml)(o)}---${l}`;await this.app.vault.modify(s,d)}async handleDelete(){if(await this.showDeleteConfirmation())try{await this.deleteTimeblockFromDailyNote(),this.plugin.emitter.trigger("data-changed"),new Ee.Notice(`Timeblock "${this.timeblock.title}" deleted successfully`),this.close()}catch(r){console.error("Error deleting timeblock:",r),new Ee.Notice("Failed to delete timeblock. Check console for details.")}}async showDeleteConfirmation(){return new Promise(e=>{let r=new Ee.Modal(this.app);r.titleEl.setText("Delete Timeblock");let i=r.contentEl;i.createEl("p",{text:`Are you sure you want to delete the timeblock "${this.timeblock.title}"?`}),i.createEl("p",{text:"This action cannot be undone.",cls:"mod-warning"});let s=i.createDiv({cls:"modal-button-container"});s.style.display="flex",s.style.justifyContent="flex-end",s.style.gap="8px",s.style.marginTop="20px";let a=s.createEl("button",{text:"Cancel"});a.addEventListener("click",()=>{r.close(),e(!1)}),s.createEl("button",{text:"Delete",cls:"mod-warning"}).addEventListener("click",()=>{r.close(),e(!0)}),r.open(),setTimeout(()=>a.focus(),50)})}async deleteTimeblockFromDailyNote(){if(!(0,Jr.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let e=this.eventDate.toISOString().split("T")[0],r=window.moment(e),i=(0,Jr.getAllDailyNotes)(),s=(0,Jr.getDailyNote)(r,i);if(!s)throw new Error("Daily note not found");let a=await this.app.vault.read(s),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let h=a.substring(3,u);l=a.substring(u+3);try{o=(0,Ee.parseYaml)(h)||{}}catch(f){console.error("Error parsing existing frontmatter:",f),o={}}}}if(o.timeblocks&&Array.isArray(o.timeblocks)){let u=o.timeblocks.findIndex(h=>h.id===this.originalTimeblock.id||h.title===this.originalTimeblock.title&&h.startTime===this.originalTimeblock.startTime&&h.endTime===this.originalTimeblock.endTime);if(u>=0)o.timeblocks.splice(u,1),o.timeblocks.length===0&&delete o.timeblocks;else throw new Error("Timeblock not found in daily note")}else throw new Error("No timeblocks found in daily note");let c=Object.keys(o).length>0?(0,Ee.stringifyYaml)(o):"",d=c?`---
${c}---${l}`:l.trim();await this.app.vault.modify(s,d)}onClose(){let{contentEl:e}=this;e.empty()}};je();var dc,q,Uy,uh,Es,Mn,Fy,Vy,Wy,oc={},jy=[],qD=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function _i(n,t){for(var e in t)n[e]=t[e];return n}function $y(n){var t=n.parentNode;t&&t.removeChild(n)}function b(n,t,e){var r,i,s,a={};for(s in t)s=="key"?r=t[s]:s=="ref"?i=t[s]:a[s]=t[s];if(arguments.length>2&&(a.children=arguments.length>3?dc.call(arguments,2):e),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)a[s]===void 0&&(a[s]=n.defaultProps[s]);return ac(n,a,r,i,null)}function ac(n,t,e,r,i){var s={type:n,props:t,key:e,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i==null?++Uy:i};return i==null&&q.vnode!=null&&q.vnode(s),s}function Oe(){return{current:null}}function ve(n){return n.children}function GD(n,t,e,r,i){var s;for(s in e)s==="children"||s==="key"||s in t||lc(n,s,null,e[s],r);for(s in t)i&&typeof t[s]!="function"||s==="children"||s==="key"||s==="value"||s==="checked"||e[s]===t[s]||lc(n,s,t[s],e[s],r)}function By(n,t,e){t[0]==="-"?n.setProperty(t,e==null?"":e):n[t]=e==null?"":typeof e!="number"||qD.test(t)?e:e+"px"}function lc(n,t,e,r,i){var s;e:if(t==="style")if(typeof e=="string")n.style.cssText=e;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(t in r)e&&t in e||By(n.style,t,"");if(e)for(t in e)r&&e[t]===r[t]||By(n.style,t,e[t])}else if(t[0]==="o"&&t[1]==="n")s=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in n?t.toLowerCase().slice(2):t.slice(2),n.l||(n.l={}),n.l[t+s]=e,e?r||n.addEventListener(t,s?Yy:Hy,s):n.removeEventListener(t,s?Yy:Hy,s);else if(t!=="dangerouslySetInnerHTML"){if(i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!=="width"&&t!=="height"&&t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t in n)try{n[t]=e==null?"":e;break e}catch(a){}typeof e=="function"||(e==null||e===!1&&t.indexOf("-")==-1?n.removeAttribute(t):n.setAttribute(t,e))}}function Hy(n){Es=!0;try{return this.l[n.type+!1](q.event?q.event(n):n)}finally{Es=!1}}function Yy(n){Es=!0;try{return this.l[n.type+!0](q.event?q.event(n):n)}finally{Es=!1}}function ot(n,t){this.props=n,this.context=t}function Ba(n,t){if(t==null)return n.__?Ba(n.__,n.__.__k.indexOf(n)+1):null;for(var e;t<n.__k.length;t++)if((e=n.__k[t])!=null&&e.__e!=null)return e.__e;return typeof n.type=="function"?Ba(n):null}function zy(n){var t,e;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,t=0;t<n.__k.length;t++)if((e=n.__k[t])!=null&&e.__e!=null){n.__e=n.__c.base=e.__e;break}return zy(n)}}function QD(n){Es?setTimeout(n):Vy(n)}function dh(n){(!n.__d&&(n.__d=!0)&&Mn.push(n)&&!cc.__r++||Fy!==q.debounceRendering)&&((Fy=q.debounceRendering)||QD)(cc)}function cc(){var n,t,e,r,i,s,a,o;for(Mn.sort(function(l,c){return l.__v.__b-c.__v.__b});n=Mn.shift();)n.__d&&(t=Mn.length,r=void 0,i=void 0,a=(s=(e=n).__v).__e,(o=e.__P)&&(r=[],(i=_i({},s)).__v=s.__v+1,hh(o,s,i,e.__n,o.ownerSVGElement!==void 0,s.__h!=null?[a]:null,r,a==null?Ba(s):a,s.__h),Zy(r,s),s.__e!=a&&zy(s)),Mn.length>t&&Mn.sort(function(l,c){return l.__v.__b-c.__v.__b}));cc.__r=0}function qy(n,t,e,r,i,s,a,o,l,c){var d,u,h,f,p,m,g,v=r&&r.__k||jy,T=v.length;for(e.__k=[],d=0;d<t.length;d++)if((f=e.__k[d]=(f=t[d])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?ac(null,f,null,null,f):Array.isArray(f)?ac(ve,{children:f},null,null,null):f.__b>0?ac(f.type,f.props,f.key,f.ref?f.ref:null,f.__v):f)!=null){if(f.__=e,f.__b=e.__b+1,(h=v[d])===null||h&&f.key==h.key&&f.type===h.type)v[d]=void 0;else for(u=0;u<T;u++){if((h=v[u])&&f.key==h.key&&f.type===h.type){v[u]=void 0;break}h=null}hh(n,f,h=h||oc,i,s,a,o,l,c),p=f.__e,(u=f.ref)&&h.ref!=u&&(g||(g=[]),h.ref&&g.push(h.ref,null,f),g.push(u,f.__c||p,f)),p!=null?(m==null&&(m=p),typeof f.type=="function"&&f.__k===h.__k?f.__d=l=Gy(f,l,n):l=Qy(n,f,h,v,p,l),typeof e.type=="function"&&(e.__d=l)):l&&h.__e==l&&l.parentNode!=n&&(l=Ba(h))}for(e.__e=m,d=T;d--;)v[d]!=null&&(typeof e.type=="function"&&v[d].__e!=null&&v[d].__e==e.__d&&(e.__d=Ky(r).nextSibling),Xy(v[d],v[d]));if(g)for(d=0;d<g.length;d++)Jy(g[d],g[++d],g[++d])}function Gy(n,t,e){for(var r,i=n.__k,s=0;i&&s<i.length;s++)(r=i[s])&&(r.__=n,t=typeof r.type=="function"?Gy(r,t,e):Qy(e,r,r,i,r.__e,t));return t}function Ha(n,t){return t=t||[],n==null||typeof n=="boolean"||(Array.isArray(n)?n.some(function(e){Ha(e,t)}):t.push(n)),t}function Qy(n,t,e,r,i,s){var a,o,l;if(t.__d!==void 0)a=t.__d,t.__d=void 0;else if(e==null||i!=s||i.parentNode==null)e:if(s==null||s.parentNode!==n)n.appendChild(i),a=null;else{for(o=s,l=0;(o=o.nextSibling)&&l<r.length;l+=1)if(o==i)break e;n.insertBefore(i,s),a=s}return a!==void 0?a:i.nextSibling}function Ky(n){var t,e,r;if(n.type==null||typeof n.type=="string")return n.__e;if(n.__k){for(t=n.__k.length-1;t>=0;t--)if((e=n.__k[t])&&(r=Ky(e)))return r}return null}function hh(n,t,e,r,i,s,a,o,l){var c,d,u,h,f,p,m,g,v,T,k,D,M,E,C,S=t.type;if(t.constructor!==void 0)return null;e.__h!=null&&(l=e.__h,o=t.__e=e.__e,t.__h=null,s=[o]),(c=q.__b)&&c(t);try{e:if(typeof S=="function"){if(g=t.props,v=(c=S.contextType)&&r[c.__c],T=c?v?v.props.value:c.__:r,e.__c?m=(d=t.__c=e.__c).__=d.__E:("prototype"in S&&S.prototype.render?t.__c=d=new S(g,T):(t.__c=d=new ot(g,T),d.constructor=S,d.render=ZD),v&&v.sub(d),d.props=g,d.state||(d.state={}),d.context=T,d.__n=r,u=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),S.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=_i({},d.__s)),_i(d.__s,S.getDerivedStateFromProps(g,d.__s))),h=d.props,f=d.state,d.__v=t,u)S.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(S.getDerivedStateFromProps==null&&g!==h&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(g,T),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(g,d.__s,T)===!1||t.__v===e.__v){for(t.__v!==e.__v&&(d.props=g,d.state=d.__s,d.__d=!1),t.__e=e.__e,t.__k=e.__k,t.__k.forEach(function(O){O&&(O.__=t)}),k=0;k<d._sb.length;k++)d.__h.push(d._sb[k]);d._sb=[],d.__h.length&&a.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(g,d.__s,T),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(h,f,p)})}if(d.context=T,d.props=g,d.__P=n,D=q.__r,M=0,"prototype"in S&&S.prototype.render){for(d.state=d.__s,d.__d=!1,D&&D(t),c=d.render(d.props,d.state,d.context),E=0;E<d._sb.length;E++)d.__h.push(d._sb[E]);d._sb=[]}else do d.__d=!1,D&&D(t),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++M<25);d.state=d.__s,d.getChildContext!=null&&(r=_i(_i({},r),d.getChildContext())),u||d.getSnapshotBeforeUpdate==null||(p=d.getSnapshotBeforeUpdate(h,f)),C=c!=null&&c.type===ve&&c.key==null?c.props.children:c,qy(n,Array.isArray(C)?C:[C],t,e,r,i,s,a,o,l),d.base=t.__e,t.__h=null,d.__h.length&&a.push(d),m&&(d.__E=d.__=null),d.__e=!1}else s==null&&t.__v===e.__v?(t.__k=e.__k,t.__e=e.__e):t.__e=KD(e.__e,t,e,r,i,s,a,l);(c=q.diffed)&&c(t)}catch(O){t.__v=null,(l||s!=null)&&(t.__e=o,t.__h=!!l,s[s.indexOf(o)]=null),q.__e(O,t,e)}}function Zy(n,t){q.__c&&q.__c(t,n),n.some(function(e){try{n=e.__h,e.__h=[],n.some(function(r){r.call(e)})}catch(r){q.__e(r,e.__v)}})}function KD(n,t,e,r,i,s,a,o){var l,c,d,u=e.props,h=t.props,f=t.type,p=0;if(f==="svg"&&(i=!0),s!=null){for(;p<s.length;p++)if((l=s[p])&&"setAttribute"in l==!!f&&(f?l.localName===f:l.nodeType===3)){n=l,s[p]=null;break}}if(n==null){if(f===null)return document.createTextNode(h);n=i?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,h.is&&h),s=null,o=!1}if(f===null)u===h||o&&n.data===h||(n.data=h);else{if(s=s&&dc.call(n.childNodes),c=(u=e.props||oc).dangerouslySetInnerHTML,d=h.dangerouslySetInnerHTML,!o){if(s!=null)for(u={},p=0;p<n.attributes.length;p++)u[n.attributes[p].name]=n.attributes[p].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===n.innerHTML)||(n.innerHTML=d&&d.__html||""))}if(GD(n,h,u,i,o),d)t.__k=[];else if(p=t.props.children,qy(n,Array.isArray(p)?p:[p],t,e,r,i&&f!=="foreignObject",s,a,s?s[0]:e.__k&&Ba(e,0),o),s!=null)for(p=s.length;p--;)s[p]!=null&&$y(s[p]);o||("value"in h&&(p=h.value)!==void 0&&(p!==n.value||f==="progress"&&!p||f==="option"&&p!==u.value)&&lc(n,"value",p,u.value,!1),"checked"in h&&(p=h.checked)!==void 0&&p!==n.checked&&lc(n,"checked",p,u.checked,!1))}return n}function Jy(n,t,e){try{typeof n=="function"?n(t):n.current=t}catch(r){q.__e(r,e)}}function Xy(n,t,e){var r,i;if(q.unmount&&q.unmount(n),(r=n.ref)&&(r.current&&r.current!==n.__e||Jy(r,null,t)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){q.__e(s,t)}r.base=r.__P=null,n.__c=void 0}if(r=n.__k)for(i=0;i<r.length;i++)r[i]&&Xy(r[i],t,e||typeof n.type!="function");e||n.__e==null||$y(n.__e),n.__=n.__e=n.__d=void 0}function ZD(n,t,e){return this.constructor(n,e)}function Mi(n,t,e){var r,i,s;q.__&&q.__(n,t),i=(r=typeof e=="function")?null:e&&e.__k||t.__k,s=[],hh(t,n=(!r&&e||t).__k=b(ve,null,[n]),i||oc,oc,t.ownerSVGElement!==void 0,!r&&e?[e]:i?null:t.firstChild?dc.call(t.childNodes):null,s,!r&&e?e:i?i.__e:t.firstChild,r),Zy(s,n)}function uc(n,t){var e={__c:t="__cC"+Wy++,__:n,Consumer:function(r,i){return r.children(i)},Provider:function(r){var i,s;return this.getChildContext||(i=[],(s={})[t]=this,this.getChildContext=function(){return s},this.shouldComponentUpdate=function(a){this.props.value!==a.value&&i.some(function(o){o.__e=!0,dh(o)})},this.sub=function(a){i.push(a);var o=a.componentWillUnmount;a.componentWillUnmount=function(){i.splice(i.indexOf(a),1),o&&o.call(a)}}),r.children}};return e.Provider.__=e.Consumer.contextType=e}dc=jy.slice,q={__e:function(n,t,e,r){for(var i,s,a;t=t.__;)if((i=t.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(n)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,r||{}),a=i.__d),a)return i.__E=i}catch(o){n=o}throw n}},Uy=0,uh=function(n){return n!=null&&n.constructor===void 0},Es=!1,ot.prototype.setState=function(n,t){var e;e=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=_i({},this.state),typeof n=="function"&&(n=n(_i({},e),this.props)),n&&_i(e,n),n!=null&&this.__v&&(t&&this._sb.push(t),dh(this))},ot.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),dh(this))},ot.prototype.render=ve,Mn=[],Vy=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,cc.__r=0,Wy=0;var XD,Tr,fh,ev;var ov=[],ph=[],tv=q.__b,rv=q.__r,iv=q.diffed,nv=q.__c,sv=q.unmount;function eS(){for(var n;n=ov.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(hc),n.__H.__h.forEach(mh),n.__H.__h=[]}catch(t){n.__H.__h=[],q.__e(t,n.__v)}}q.__b=function(n){Tr=null,tv&&tv(n)},q.__r=function(n){rv&&rv(n),XD=0;var t=(Tr=n.__c).__H;t&&(fh===Tr?(t.__h=[],Tr.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.__V=ph,e.__N=e.i=void 0})):(t.__h.forEach(hc),t.__h.forEach(mh),t.__h=[])),fh=Tr},q.diffed=function(n){iv&&iv(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(ov.push(t)!==1&&ev===q.requestAnimationFrame||((ev=q.requestAnimationFrame)||tS)(eS)),t.__H.__.forEach(function(e){e.i&&(e.__H=e.i),e.__V!==ph&&(e.__=e.__V),e.i=void 0,e.__V=ph})),fh=Tr=null},q.__c=function(n,t){t.some(function(e){try{e.__h.forEach(hc),e.__h=e.__h.filter(function(r){return!r.__||mh(r)})}catch(r){t.some(function(i){i.__h&&(i.__h=[])}),t=[],q.__e(r,e.__v)}}),nv&&nv(n,t)},q.unmount=function(n){sv&&sv(n);var t,e=n.__c;e&&e.__H&&(e.__H.__.forEach(function(r){try{hc(r)}catch(i){t=i}}),e.__H=void 0,t&&q.__e(t,e.__v))};var av=typeof requestAnimationFrame=="function";function tS(n){var t,e=function(){clearTimeout(r),av&&cancelAnimationFrame(t),setTimeout(n)},r=setTimeout(e,100);av&&(t=requestAnimationFrame(e))}function hc(n){var t=Tr,e=n.__c;typeof e=="function"&&(n.__c=void 0,e()),Tr=t}function mh(n){var t=Tr;n.__c=n.__(),Tr=t}function rS(n,t){for(var e in t)n[e]=t[e];return n}function lv(n,t){for(var e in n)if(e!=="__source"&&!(e in t))return!0;for(var r in t)if(r!=="__source"&&n[r]!==t[r])return!0;return!1}function cv(n){this.props=n}(cv.prototype=new ot).isPureReactComponent=!0,cv.prototype.shouldComponentUpdate=function(n,t){return lv(this.props,n)||lv(this.state,t)};var dv=q.__b;q.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),dv&&dv(n)};var AF=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var iS=q.__e;q.__e=function(n,t,e,r){if(n.then){for(var i,s=t;s=s.__;)if((i=s.__c)&&i.__c)return t.__e==null&&(t.__e=e.__e,t.__k=e.__k),i.__c(n,t)}iS(n,t,e,r)};var uv=q.unmount;function yv(n,t,e){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),n.__c.__H=null),(n=rS({},n)).__c!=null&&(n.__c.__P===e&&(n.__c.__P=t),n.__c=null),n.__k=n.__k&&n.__k.map(function(r){return yv(r,t,e)})),n}function vv(n,t,e){return n&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(r){return vv(r,t,e)}),n.__c&&n.__c.__P===t&&(n.__e&&e.insertBefore(n.__e,n.__d),n.__c.__e=!0,n.__c.__P=e)),n}function gh(){this.__u=0,this.t=null,this.__b=null}function wv(n){var t=n.__.__c;return t&&t.__a&&t.__a(n)}function fc(){this.u=null,this.o=null}q.unmount=function(n){var t=n.__c;t&&t.__R&&t.__R(),t&&n.__h===!0&&(n.type=null),uv&&uv(n)},(gh.prototype=new ot).__c=function(n,t){var e=t.__c,r=this;r.t==null&&(r.t=[]),r.t.push(e);var i=wv(r.__v),s=!1,a=function(){s||(s=!0,e.__R=null,i?i(o):o())};e.__R=a;var o=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=vv(c,c.__c.__P,c.__c.__O)}var d;for(r.setState({__a:r.__b=null});d=r.t.pop();)d.forceUpdate()}},l=t.__h===!0;r.__u++||l||r.setState({__a:r.__b=r.__v.__k[0]}),n.then(a,a)},gh.prototype.componentWillUnmount=function(){this.t=[]},gh.prototype.render=function(n,t){if(this.__b){if(this.__v.__k){var e=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=yv(this.__b,e,r.__O=r.__P)}this.__b=null}var i=t.__a&&b(ve,null,n.fallback);return i&&(i.__h=null),[b(ve,null,t.__a?null:n.children),i]};var hv=function(n,t,e){if(++e[1]===e[0]&&n.o.delete(t),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.o.size))for(e=n.u;e;){for(;e.length>3;)e.pop()();if(e[1]<e[0])break;n.u=e=e[2]}};function nS(n){return this.getChildContext=function(){return n.context},n.children}function sS(n){var t=this,e=n.i;t.componentWillUnmount=function(){Mi(null,t.l),t.l=null,t.i=null},t.i&&t.i!==e&&t.componentWillUnmount(),n.__v?(t.l||(t.i=e,t.l={nodeType:1,parentNode:e,childNodes:[],appendChild:function(r){this.childNodes.push(r),t.i.appendChild(r)},insertBefore:function(r,i){this.childNodes.push(r),t.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),t.i.removeChild(r)}}),Mi(b(nS,{context:t.context},n.__v),t.l)):t.l&&t.componentWillUnmount()}function bv(n,t){var e=b(sS,{__v:n,i:t});return e.containerInfo=t,e}(fc.prototype=new ot).__a=function(n){var t=this,e=wv(t.__v),r=t.o.get(n);return r[0]++,function(i){var s=function(){t.props.revealOrder?(r.push(i),hv(t,n,r)):i()};e?e(s):s()}},fc.prototype.render=function(n){this.u=null,this.o=new Map;var t=Ha(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&t.reverse();for(var e=t.length;e--;)this.o.set(t[e],this.u=[1,0,this.u]);return n.children},fc.prototype.componentDidUpdate=fc.prototype.componentDidMount=function(){var n=this;this.o.forEach(function(t,e){hv(n,e,t)})};var aS=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,oS=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,lS=typeof document!="undefined",cS=function(n){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(n)};ot.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(ot.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(t){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:t})}})});var fv=q.event;function dS(){}function uS(){return this.cancelBubble}function hS(){return this.defaultPrevented}q.event=function(n){return fv&&(n=fv(n)),n.persist=dS,n.isPropagationStopped=uS,n.isDefaultPrevented=hS,n.nativeEvent=n};var fS,pv={configurable:!0,get:function(){return this.class}},mv=q.vnode;q.vnode=function(n){var t=n.type,e=n.props,r=e;if(typeof t=="string"){var i=t.indexOf("-")===-1;for(var s in r={},e){var a=e[s];lS&&s==="children"&&t==="noscript"||s==="value"&&"defaultValue"in e&&a==null||(s==="defaultValue"&&"value"in e&&e.value==null?s="value":s==="download"&&a===!0?a="":/ondoubleclick/i.test(s)?s="ondblclick":/^onchange(textarea|input)/i.test(s+t)&&!cS(e.type)?s="oninput":/^onfocus$/i.test(s)?s="onfocusin":/^onblur$/i.test(s)?s="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(s)?s=s.toLowerCase():i&&oS.test(s)?s=s.replace(/[A-Z0-9]/g,"-$&").toLowerCase():a===null&&(a=void 0),/^oninput$/i.test(s)&&(s=s.toLowerCase(),r[s]&&(s="oninputCapture")),r[s]=a)}t=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=Ha(e.children).forEach(function(o){o.props.selected=r.value.indexOf(o.props.value)!=-1})),t=="select"&&r.defaultValue!=null&&(r.value=Ha(e.children).forEach(function(o){o.props.selected=r.multiple?r.defaultValue.indexOf(o.props.value)!=-1:r.defaultValue==o.props.value})),n.props=r,e.class!=e.className&&(pv.enumerable="className"in e,e.className!=null&&(r.class=e.className),Object.defineProperty(r,"className",pv))}n.$$typeof=aS,mv&&mv(n)};var gv=q.__r;q.__r=function(n){gv&&gv(n),fS=n.__c};var Ov=[],xh=new Map;function Li(n){Ov.push(n),xh.forEach(t=>{Fv(t,n)})}function Rv(n){n.isConnected&&n.getRootNode&&Lv(n.getRootNode())}function Lv(n){let t=xh.get(n);if(!t||!t.isConnected){if(t=n.querySelector("style[data-fullcalendar]"),!t){t=document.createElement("style"),t.setAttribute("data-fullcalendar","");let e=mS();e&&(t.nonce=e);let r=n===document?document.head:n,i=n===document?r.querySelector("script,link[rel=stylesheet],link[as=style],style"):r.firstChild;r.insertBefore(t,i)}xh.set(n,t),pS(t)}}function pS(n){for(let t of Ov)Fv(n,t)}function Fv(n,t){let{sheet:e}=n,r=e.cssRules.length;t.split("}").forEach((i,s)=>{i=i.trim(),i&&e.insertRule(i+"}",r+s)})}var yh;function mS(){return yh===void 0&&(yh=gS()),yh}function gS(){let n=document.querySelector('meta[name="csp-nonce"]');if(n&&n.hasAttribute("content"))return n.getAttribute("content");let t=document.querySelector("script[nonce]");return t&&t.nonce||""}typeof document!="undefined"&&Lv(document);var yS=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';Li(yS);var Pn=class{constructor(t){this.drainedOption=t,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(t){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),t==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),t))}pause(t=""){let{pauseDepths:e}=this;e[t]=(e[t]||0)+1,this.clearTimeout()}resume(t="",e){let{pauseDepths:r}=this;t in r&&(e?delete r[t]:(r[t]-=1,r[t]<=0&&delete r[t]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}};function to(n){n.parentNode&&n.parentNode.removeChild(n)}function ze(n,t){if(n.closest)return n.closest(t);if(!document.documentElement.contains(n))return null;do{if(Pc(n,t))return n;n=n.parentElement||n.parentNode}while(n!==null&&n.nodeType===1);return null}function Pc(n,t){return(n.matches||n.matchesSelector||n.msMatchesSelector).call(n,t)}function Bv(n,t){let e=n instanceof HTMLElement?[n]:n,r=[];for(let i=0;i<e.length;i+=1){let s=e[i].querySelectorAll(t);for(let a=0;a<s.length;a+=1)r.push(s[a])}return r}var vS=/(top|left|right|bottom|width|height)$/i;function $n(n,t){for(let e in t)Bh(n,e,t[e])}function Bh(n,t,e){e==null?n.style[t]="":typeof e=="number"&&vS.test(t)?n.style[t]=`${e}px`:n.style[t]=e}function Nc(n){var t,e;return(e=(t=n.composedPath)===null||t===void 0?void 0:t.call(n)[0])!==null&&e!==void 0?e:n.target}var Tv=0;function ii(){return Tv+=1,"fc-dom-"+Tv}function ro(n){n.preventDefault()}function wS(n,t){return e=>{let r=ze(e.target,n);r&&t.call(r,e,r)}}function Hh(n,t,e,r){let i=wS(e,r);return n.addEventListener(t,i),()=>{n.removeEventListener(t,i)}}function Hv(n,t,e,r){let i;return Hh(n,"mouseover",t,(s,a)=>{if(a!==i){i=a,e(s,a);let o=l=>{i=null,r(l,a),a.removeEventListener("mouseleave",o)};a.addEventListener("mouseleave",o)}})}var Ev=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function Yh(n,t){let e=r=>{t(r),Ev.forEach(i=>{n.removeEventListener(i,e)})};Ev.forEach(r=>{n.addEventListener(r,e)})}function Yv(n){return Object.assign({onClick:n},Uv(n))}function Uv(n){return{tabIndex:0,onKeyDown(t){(t.key==="Enter"||t.key===" ")&&(n(t),t.preventDefault())}}}var kv=0;function ni(){return kv+=1,String(kv)}function Cs(){document.body.classList.add("fc-not-allowed")}function xs(){document.body.classList.remove("fc-not-allowed")}function Uh(n){n.style.userSelect="none",n.style.webkitUserSelect="none",n.addEventListener("selectstart",ro)}function Vh(n){n.style.userSelect="",n.style.webkitUserSelect="",n.removeEventListener("selectstart",ro)}function Wh(n){n.addEventListener("contextmenu",ro)}function jh(n){n.removeEventListener("contextmenu",ro)}function Vv(n){let t=[],e=[],r,i;for(typeof n=="string"?e=n.split(/\s*,\s*/):typeof n=="function"?e=[n]:Array.isArray(n)&&(e=n),r=0;r<e.length;r+=1)i=e[r],typeof i=="string"?t.push(i.charAt(0)==="-"?{field:i.substring(1),order:-1}:{field:i,order:1}):typeof i=="function"&&t.push({func:i});return t}function Wv(n,t,e){let r,i;for(r=0;r<e.length;r+=1)if(i=bS(n,t,e[r]),i)return i;return 0}function bS(n,t,e){return e.func?e.func(n,t):jv(n[e.field],t[e.field])*(e.order||1)}function jv(n,t){return!n&&!t?0:t==null?-1:n==null?1:typeof n=="string"||typeof t=="string"?String(n).localeCompare(String(t)):n-t}function In(n,t){let e=String(n);return"000".substr(0,t-e.length)+e}function _s(n,t,e){return typeof n=="function"?n(...t):typeof n=="string"?t.reduce((r,i,s)=>r.replace("$"+s,i||""),n):e}function $h(n,t){return n-t}function Ya(n){return n%1===0}function TS(n){let t=n.querySelector(".fc-scrollgrid-shrink-frame"),e=n.querySelector(".fc-scrollgrid-shrink-cushion");if(!t)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!e)throw new Error("needs fc-scrollgrid-shrink-cushion className");return n.getBoundingClientRect().width-t.getBoundingClientRect().width+e.getBoundingClientRect().width}var Dv=["years","months","days","milliseconds"],ES=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function J(n,t){return typeof n=="string"?kS(n):typeof n=="object"&&n?Sv(n):typeof n=="number"?Sv({[t||"milliseconds"]:n}):null}function kS(n){let t=ES.exec(n);if(t){let e=t[1]?-1:1;return{years:0,months:0,days:e*(t[2]?parseInt(t[2],10):0),milliseconds:e*((t[3]?parseInt(t[3],10):0)*60*60*1e3+(t[4]?parseInt(t[4],10):0)*60*1e3+(t[5]?parseInt(t[5],10):0)*1e3+(t[6]?parseInt(t[6],10):0))}}return null}function Sv(n){let t={years:n.years||n.year||0,months:n.months||n.month||0,days:n.days||n.day||0,milliseconds:(n.hours||n.hour||0)*60*60*1e3+(n.minutes||n.minute||0)*60*1e3+(n.seconds||n.second||0)*1e3+(n.milliseconds||n.millisecond||n.ms||0)},e=n.weeks||n.week;return e&&(t.days+=e*7,t.specifiedWeeks=!0),t}function DS(n,t){return n.years===t.years&&n.months===t.months&&n.days===t.days&&n.milliseconds===t.milliseconds}function io(n,t){return{years:n.years+t.years,months:n.months+t.months,days:n.days+t.days,milliseconds:n.milliseconds+t.milliseconds}}function $v(n,t){return{years:n.years-t.years,months:n.months-t.months,days:n.days-t.days,milliseconds:n.milliseconds-t.milliseconds}}function zh(n,t){return{years:n.years*t,months:n.months*t,days:n.days*t,milliseconds:n.milliseconds*t}}function SS(n){return ks(n)/365}function CS(n){return ks(n)/30}function ks(n){return Rt(n)/864e5}function Rt(n){return n.years*(365*864e5)+n.months*(30*864e5)+n.days*864e5+n.milliseconds}function no(n,t){let e=null;for(let r=0;r<Dv.length;r+=1){let i=Dv[r];if(t[i]){let s=n[i]/t[i];if(!Ya(s)||e!==null&&e!==s)return null;e=s}else if(n[i])return null}return e}function Ua(n){let t=n.milliseconds;if(t){if(t%1e3!==0)return{unit:"millisecond",value:t};if(t%(1e3*60)!==0)return{unit:"second",value:t/1e3};if(t%(1e3*60*60)!==0)return{unit:"minute",value:t/(1e3*60)};if(t)return{unit:"hour",value:t/(1e3*60*60)}}return n.days?n.specifiedWeeks&&n.days%7===0?{unit:"week",value:n.days/7}:{unit:"day",value:n.days}:n.months?{unit:"month",value:n.months}:n.years?{unit:"year",value:n.years}:{unit:"millisecond",value:0}}function Sr(n,t,e){if(n===t)return!0;let r=n.length,i;if(r!==t.length)return!1;for(i=0;i<r;i+=1)if(!(e?e(n[i],t[i]):n[i]===t[i]))return!1;return!0}var xS=["sun","mon","tue","wed","thu","fri","sat"];function Oc(n,t){let e=Ii(n);return e[2]+=t*7,St(e)}function qe(n,t){let e=Ii(n);return e[2]+=t,St(e)}function Er(n,t){let e=Ii(n);return e[6]+=t,St(e)}function qh(n,t){return si(n,t)/7}function si(n,t){return(t.valueOf()-n.valueOf())/(1e3*60*60*24)}function _S(n,t){return(t.valueOf()-n.valueOf())/(1e3*60*60)}function MS(n,t){return(t.valueOf()-n.valueOf())/(1e3*60)}function AS(n,t){return(t.valueOf()-n.valueOf())/1e3}function zv(n,t){let e=ke(n),r=ke(t);return{years:0,months:0,days:Math.round(si(e,r)),milliseconds:t.valueOf()-r.valueOf()-(n.valueOf()-e.valueOf())}}function qv(n,t){let e=Ds(n,t);return e!==null&&e%7===0?e/7:null}function Ds(n,t){return Pi(n)===Pi(t)?Math.round(si(n,t)):null}function ke(n){return St([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()])}function IS(n){return St([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours()])}function PS(n){return St([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes()])}function NS(n){return St([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds()])}function OS(n,t,e){let r=n.getUTCFullYear(),i=vh(n,r,t,e);if(i<1)return vh(n,r-1,t,e);let s=vh(n,r+1,t,e);return s>=1?Math.min(i,s):i}function vh(n,t,e,r){let i=St([t,0,1+RS(t,e,r)]),s=ke(n),a=Math.round(si(i,s));return Math.floor(a/7)+1}function RS(n,t,e){let r=7+t-e;return-((7+St([n,0,r]).getUTCDay()-t)%7)+r-1}function Cv(n){return[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()]}function xv(n){return new Date(n[0],n[1]||0,n[2]==null?1:n[2],n[3]||0,n[4]||0,n[5]||0)}function Ii(n){return[n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()]}function St(n){return n.length===1&&(n=n.concat([0])),new Date(Date.UTC(...n))}function Gh(n){return!isNaN(n.valueOf())}function Pi(n){return n.getUTCHours()*1e3*60*60+n.getUTCMinutes()*1e3*60+n.getUTCSeconds()*1e3+n.getUTCMilliseconds()}function Rc(n,t,e=!1){let r=n.toISOString();return r=r.replace(".000",""),e&&(r=r.replace("T00:00:00Z","")),r.length>10&&(t==null?r=r.replace("Z",""):t!==0&&(r=r.replace("Z",Kh(t,!0)))),r}function so(n){return n.toISOString().replace(/T.*$/,"")}function Ms(n){return n.toISOString().match(/^\d{4}-\d{2}/)[0]}function Qh(n){return In(n.getUTCHours(),2)+":"+In(n.getUTCMinutes(),2)+":"+In(n.getUTCSeconds(),2)}function Kh(n,t=!1){let e=n<0?"-":"+",r=Math.abs(n),i=Math.floor(r/60),s=Math.round(r%60);return t?`${e+In(i,2)}:${In(s,2)}`:`GMT${e}${i}${s?`:${In(s,2)}`:""}`}function $(n,t,e){let r,i;return function(...s){if(!r)i=n.apply(this,s);else if(!Sr(r,s)){e&&e(i);let a=n.apply(this,s);(!t||!t(a,i))&&(i=a)}return r=s,i}}function As(n,t,e){let r,i;return s=>{if(!r)i=n.call(this,s);else if(!wt(r,s)){e&&e(i);let a=n.call(this,s);(!t||!t(a,i))&&(i=a)}return r=s,i}}var wh={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},Tc={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},pc=/\s*([ap])\.?m\.?/i,LS=/,/g,FS=/\s+/g,BS=/\u200e/g,HS=/UTC|GMT/,_h=class{constructor(t){let e={},r={},i=9;for(let s in t)s in wh?(r[s]=t[s],wh[s]<9&&(i=Math.min(wh[s],i))):(e[s]=t[s],s in Tc&&(i=Math.min(Tc[s],i)));this.standardDateProps=e,this.extendedSettings=r,this.smallestUnitNum=i,this.buildFormattingFunc=$(_v)}format(t,e){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,e)(t)}formatRange(t,e,r,i){let{standardDateProps:s,extendedSettings:a}=this,o=$S(t.marker,e.marker,r.calendarSystem);if(!o)return this.format(t,r);let l=o;l>1&&(s.year==="numeric"||s.year==="2-digit")&&(s.month==="numeric"||s.month==="2-digit")&&(s.day==="numeric"||s.day==="2-digit")&&(l=1);let c=this.format(t,r),d=this.format(e,r);if(c===d)return c;let u=zS(s,l),h=_v(u,a,r),f=h(t),p=h(e),m=qS(c,f,d,p),g=a.separator||i||r.defaultSeparator||"";return m?m.before+f+g+p+m.after:c+g+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}};function _v(n,t,e){let r=Object.keys(n).length;return r===1&&n.timeZoneName==="short"?i=>Kh(i.timeZoneOffset):r===0&&t.week?i=>jS(e.computeWeekNumber(i.marker),e.weekText,e.weekTextLong,e.locale,t.week):YS(n,t,e)}function YS(n,t,e){n=Object.assign({},n),t=Object.assign({},t),US(n,t),n.timeZone="UTC";let r=new Intl.DateTimeFormat(e.locale.codes,n),i;if(t.omitZeroMinute){let s=Object.assign({},n);delete s.minute,i=new Intl.DateTimeFormat(e.locale.codes,s)}return s=>{let{marker:a}=s,o;i&&!a.getUTCMinutes()?o=i:o=r;let l=o.format(a);return VS(l,s,n,t,e)}}function US(n,t){n.timeZoneName&&(n.hour||(n.hour="2-digit"),n.minute||(n.minute="2-digit")),n.timeZoneName==="long"&&(n.timeZoneName="short"),t.omitZeroMinute&&(n.second||n.millisecond)&&delete t.omitZeroMinute}function VS(n,t,e,r,i){return n=n.replace(BS,""),e.timeZoneName==="short"&&(n=WS(n,i.timeZone==="UTC"||t.timeZoneOffset==null?"UTC":Kh(t.timeZoneOffset))),r.omitCommas&&(n=n.replace(LS,"").trim()),r.omitZeroMinute&&(n=n.replace(":00","")),r.meridiem===!1?n=n.replace(pc,"").trim():r.meridiem==="narrow"?n=n.replace(pc,(s,a)=>a.toLocaleLowerCase()):r.meridiem==="short"?n=n.replace(pc,(s,a)=>`${a.toLocaleLowerCase()}m`):r.meridiem==="lowercase"&&(n=n.replace(pc,s=>s.toLocaleLowerCase())),n=n.replace(FS," "),n=n.trim(),n}function WS(n,t){let e=!1;return n=n.replace(HS,()=>(e=!0,t)),e||(n+=` ${t}`),n}function jS(n,t,e,r,i){let s=[];return i==="long"?s.push(e):(i==="short"||i==="narrow")&&s.push(t),(i==="long"||i==="short")&&s.push(" "),s.push(r.simpleNumberFormat.format(n)),r.options.direction==="rtl"&&s.reverse(),s.join("")}function $S(n,t,e){return e.getMarkerYear(n)!==e.getMarkerYear(t)?5:e.getMarkerMonth(n)!==e.getMarkerMonth(t)?4:e.getMarkerDay(n)!==e.getMarkerDay(t)?2:Pi(n)!==Pi(t)?1:0}function zS(n,t){let e={};for(let r in n)(!(r in Tc)||Tc[r]<=t)&&(e[r]=n[r]);return e}function qS(n,t,e,r){let i=0;for(;i<n.length;){let s=n.indexOf(t,i);if(s===-1)break;let a=n.substr(0,s);i=s+t.length;let o=n.substr(i),l=0;for(;l<e.length;){let c=e.indexOf(r,l);if(c===-1)break;let d=e.substr(0,c);l=c+r.length;let u=e.substr(l);if(a===d&&o===u)return{before:a,after:o}}}return null}function Mv(n,t){let e=t.markerToArray(n.marker);return{marker:n.marker,timeZoneOffset:n.timeZoneOffset,array:e,year:e[0],month:e[1],day:e[2],hour:e[3],minute:e[4],second:e[5],millisecond:e[6]}}function Ec(n,t,e,r){let i=Mv(n,e.calendarSystem),s=t?Mv(t,e.calendarSystem):null;return{date:i,start:i,end:s,timeZone:e.timeZone,localeCodes:e.locale.codes,defaultSeparator:r||e.defaultSeparator}}var Mh=class{constructor(t){this.cmdStr=t}format(t,e,r){return e.cmdFormatter(this.cmdStr,Ec(t,null,e,r))}formatRange(t,e,r,i){return r.cmdFormatter(this.cmdStr,Ec(t,e,r,i))}},Ah=class{constructor(t){this.func=t}format(t,e,r){return this.func(Ec(t,null,e,r))}formatRange(t,e,r,i){return this.func(Ec(t,e,r,i))}};function be(n){return typeof n=="object"&&n?new _h(n):typeof n=="string"?new Mh(n):typeof n=="function"?new Ah(n):null}var Zh={navLinkDayClick:A,navLinkWeekClick:A,duration:J,bootstrapFontAwesome:A,buttonIcons:A,customButtons:A,defaultAllDayEventDuration:J,defaultTimedEventDuration:J,nextDayThreshold:J,scrollTime:J,scrollTimeReset:Boolean,slotMinTime:J,slotMaxTime:J,dayPopoverFormat:be,slotDuration:J,snapDuration:J,headerToolbar:A,footerToolbar:A,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:be,dayHeaderClassNames:A,dayHeaderContent:A,dayHeaderDidMount:A,dayHeaderWillUnmount:A,dayCellClassNames:A,dayCellContent:A,dayCellDidMount:A,dayCellWillUnmount:A,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:A,weekNumbers:Boolean,weekNumberClassNames:A,weekNumberContent:A,weekNumberDidMount:A,weekNumberWillUnmount:A,editable:Boolean,viewClassNames:A,viewDidMount:A,viewWillUnmount:A,nowIndicator:Boolean,nowIndicatorClassNames:A,nowIndicatorContent:A,nowIndicatorDidMount:A,nowIndicatorWillUnmount:A,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:A,locale:A,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:A,eventOrder:Vv,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:A,contentHeight:A,direction:String,weekNumberFormat:be,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:A,initialDate:A,now:A,eventDataTransform:A,stickyHeaderDates:A,stickyFooterScrollbar:A,viewHeight:A,defaultAllDay:Boolean,eventSourceFailure:A,eventSourceSuccess:A,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:A,eventConstraint:A,eventAllow:A,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:A,eventContent:A,eventDidMount:A,eventWillUnmount:A,selectConstraint:A,selectOverlap:A,selectAllow:A,droppable:Boolean,unselectCancel:String,slotLabelFormat:A,slotLaneClassNames:A,slotLaneContent:A,slotLaneDidMount:A,slotLaneWillUnmount:A,slotLabelClassNames:A,slotLabelContent:A,slotLabelDidMount:A,slotLabelWillUnmount:A,dayMaxEvents:A,dayMaxEventRows:A,dayMinWidth:Number,slotLabelInterval:J,allDayText:String,allDayClassNames:A,allDayContent:A,allDayDidMount:A,allDayWillUnmount:A,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:be,rerenderDelay:Number,moreLinkText:A,moreLinkHint:A,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:A,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:J,hiddenDays:A,fixedWeekCount:Boolean,validRange:A,visibleRange:A,titleFormat:A,eventInteractive:Boolean,noEventsText:String,viewHint:A,navLinkHint:A,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:A,moreLinkClassNames:A,moreLinkContent:A,moreLinkDidMount:A,moreLinkWillUnmount:A,monthStartFormat:be,handleCustomRendering:A,customRenderingMetaMap:A,customRenderingReplaces:Boolean},Cr={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"}},Jh={datesSet:A,eventsSet:A,eventAdd:A,eventChange:A,eventRemove:A,windowResize:A,eventClick:A,eventMouseEnter:A,eventMouseLeave:A,select:A,unselect:A,loading:A,_unmount:A,_beforeprint:A,_afterprint:A,_noEventDrop:A,_noEventResize:A,_resize:A,_scrollRequest:A},Xh={buttonText:A,buttonHints:A,views:A,plugins:A,initialEvents:A,events:A,eventSources:A},Fi={headerToolbar:An,footerToolbar:An,buttonText:An,buttonHints:An,buttonIcons:An,dateIncrement:An,plugins:mc,events:mc,eventSources:mc,resources:mc};function An(n,t){return typeof n=="object"&&typeof t=="object"&&n&&t?wt(n,t):n===t}function mc(n,t){return Array.isArray(n)&&Array.isArray(t)?Sr(n,t):n===t}var Gv={type:String,component:A,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:A,usesMinMaxTime:Boolean,classNames:A,content:A,didMount:A,willUnmount:A};function Lc(n){return Fc(n,Fi)}function ao(n,t){let e={},r={};for(let i in t)i in n&&(e[i]=t[i](n[i]));for(let i in n)i in t||(r[i]=n[i]);return{refined:e,extra:r}}function A(n){return n}var{hasOwnProperty:kc}=Object.prototype;function Fc(n,t){let e={};if(t){for(let r in t)if(t[r]===An){let i=[];for(let s=n.length-1;s>=0;s-=1){let a=n[s][r];if(typeof a=="object"&&a)i.unshift(a);else if(a!==void 0){e[r]=a;break}}i.length&&(e[r]=Fc(i))}}for(let r=n.length-1;r>=0;r-=1){let i=n[r];for(let s in i)s in e||(e[s]=i[s])}return e}function Xr(n,t){let e={};for(let r in n)t(n[r],r)&&(e[r]=n[r]);return e}function zt(n,t){let e={};for(let r in n)e[r]=t(n[r],r);return e}function ef(n){let t={};for(let e of n)t[e]=!0;return t}function Bc(n){let t=[];for(let e in n)t.push(n[e]);return t}function wt(n,t){if(n===t)return!0;for(let e in n)if(kc.call(n,e)&&!(e in t))return!1;for(let e in t)if(kc.call(t,e)&&n[e]!==t[e])return!1;return!0}var GS=/^on[A-Z]/;function QS(n,t){let e=Ih(n,t);for(let r of e)if(!GS.test(r))return!1;return!0}function Ih(n,t){let e=[];for(let r in n)kc.call(n,r)&&(r in t||e.push(r));for(let r in t)kc.call(t,r)&&n[r]!==t[r]&&e.push(r);return e}function wc(n,t,e={}){if(n===t)return!0;for(let r in t)if(!(r in n&&KS(n[r],t[r],e[r])))return!1;for(let r in n)if(!(r in t))return!1;return!0}function KS(n,t,e){return n===t||e===!0?!0:e?e(n,t):!1}function Qv(n,t=0,e,r=1){let i=[];e==null&&(e=Object.keys(n).length);for(let s=t;s<e;s+=r){let a=n[s];a!==void 0&&i.push(a)}return i}var Kv={};function ZS(n,t){Kv[n]=t}function JS(n){return new Kv[n]}var Ph=class{getMarkerYear(t){return t.getUTCFullYear()}getMarkerMonth(t){return t.getUTCMonth()}getMarkerDay(t){return t.getUTCDate()}arrayToMarker(t){return St(t)}markerToArray(t){return Ii(t)}};ZS("gregory",Ph);var XS=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function Zv(n){let t=XS.exec(n);if(t){let e=new Date(Date.UTC(Number(t[1]),t[3]?Number(t[3])-1:0,Number(t[5]||1),Number(t[7]||0),Number(t[8]||0),Number(t[10]||0),t[12]?Number(`0.${t[12]}`)*1e3:0));if(Gh(e)){let r=null;return t[13]&&(r=(t[15]==="-"?-1:1)*(Number(t[16]||0)*60+Number(t[18]||0))),{marker:e,isTimeUnspecified:!t[6],timeZoneOffset:r}}}return null}var Va=class{constructor(t){let e=this.timeZone=t.timeZone,r=e!=="local"&&e!=="UTC";t.namedTimeZoneImpl&&r&&(this.namedTimeZoneImpl=new t.namedTimeZoneImpl(e)),this.canComputeOffset=Boolean(!r||this.namedTimeZoneImpl),this.calendarSystem=JS(t.calendarSystem),this.locale=t.locale,this.weekDow=t.locale.week.dow,this.weekDoy=t.locale.week.doy,t.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof t.firstDay=="number"&&(this.weekDow=t.firstDay),typeof t.weekNumberCalculation=="function"&&(this.weekNumberFunc=t.weekNumberCalculation),this.weekText=t.weekText!=null?t.weekText:t.locale.options.weekText,this.weekTextLong=(t.weekTextLong!=null?t.weekTextLong:t.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=t.cmdFormatter,this.defaultSeparator=t.defaultSeparator}createMarker(t){let e=this.createMarkerMeta(t);return e===null?null:e.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):St(Cv(new Date))}createMarkerMeta(t){if(typeof t=="string")return this.parse(t);let e=null;return typeof t=="number"?e=this.timestampToMarker(t):t instanceof Date?(t=t.valueOf(),isNaN(t)||(e=this.timestampToMarker(t))):Array.isArray(t)&&(e=St(t)),e===null||!Gh(e)?null:{marker:e,isTimeUnspecified:!1,forcedTzo:null}}parse(t){let e=Zv(t);if(e===null)return null;let{marker:r}=e,i=null;return e.timeZoneOffset!==null&&(this.canComputeOffset?r=this.timestampToMarker(r.valueOf()-e.timeZoneOffset*60*1e3):i=e.timeZoneOffset),{marker:r,isTimeUnspecified:e.isTimeUnspecified,forcedTzo:i}}getYear(t){return this.calendarSystem.getMarkerYear(t)}getMonth(t){return this.calendarSystem.getMarkerMonth(t)}getDay(t){return this.calendarSystem.getMarkerDay(t)}add(t,e){let r=this.calendarSystem.markerToArray(t);return r[0]+=e.years,r[1]+=e.months,r[2]+=e.days,r[6]+=e.milliseconds,this.calendarSystem.arrayToMarker(r)}subtract(t,e){let r=this.calendarSystem.markerToArray(t);return r[0]-=e.years,r[1]-=e.months,r[2]-=e.days,r[6]-=e.milliseconds,this.calendarSystem.arrayToMarker(r)}addYears(t,e){let r=this.calendarSystem.markerToArray(t);return r[0]+=e,this.calendarSystem.arrayToMarker(r)}addMonths(t,e){let r=this.calendarSystem.markerToArray(t);return r[1]+=e,this.calendarSystem.arrayToMarker(r)}diffWholeYears(t,e){let{calendarSystem:r}=this;return Pi(t)===Pi(e)&&r.getMarkerDay(t)===r.getMarkerDay(e)&&r.getMarkerMonth(t)===r.getMarkerMonth(e)?r.getMarkerYear(e)-r.getMarkerYear(t):null}diffWholeMonths(t,e){let{calendarSystem:r}=this;return Pi(t)===Pi(e)&&r.getMarkerDay(t)===r.getMarkerDay(e)?r.getMarkerMonth(e)-r.getMarkerMonth(t)+(r.getMarkerYear(e)-r.getMarkerYear(t))*12:null}greatestWholeUnit(t,e){let r=this.diffWholeYears(t,e);return r!==null?{unit:"year",value:r}:(r=this.diffWholeMonths(t,e),r!==null?{unit:"month",value:r}:(r=qv(t,e),r!==null?{unit:"week",value:r}:(r=Ds(t,e),r!==null?{unit:"day",value:r}:(r=_S(t,e),Ya(r)?{unit:"hour",value:r}:(r=MS(t,e),Ya(r)?{unit:"minute",value:r}:(r=AS(t,e),Ya(r)?{unit:"second",value:r}:{unit:"millisecond",value:e.valueOf()-t.valueOf()}))))))}countDurationsBetween(t,e,r){let i;return r.years&&(i=this.diffWholeYears(t,e),i!==null)?i/SS(r):r.months&&(i=this.diffWholeMonths(t,e),i!==null)?i/CS(r):r.days&&(i=Ds(t,e),i!==null)?i/ks(r):(e.valueOf()-t.valueOf())/Rt(r)}startOf(t,e){return e==="year"?this.startOfYear(t):e==="month"?this.startOfMonth(t):e==="week"?this.startOfWeek(t):e==="day"?ke(t):e==="hour"?IS(t):e==="minute"?PS(t):e==="second"?NS(t):null}startOfYear(t){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(t)])}startOfMonth(t){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(t),this.calendarSystem.getMarkerMonth(t)])}startOfWeek(t){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(t),this.calendarSystem.getMarkerMonth(t),t.getUTCDate()-(t.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(t){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(t)):OS(t,this.weekDow,this.weekDoy)}format(t,e,r={}){return e.format({marker:t,timeZoneOffset:r.forcedTzo!=null?r.forcedTzo:this.offsetForMarker(t)},this)}formatRange(t,e,r,i={}){return i.isEndExclusive&&(e=Er(e,-1)),r.formatRange({marker:t,timeZoneOffset:i.forcedStartTzo!=null?i.forcedStartTzo:this.offsetForMarker(t)},{marker:e,timeZoneOffset:i.forcedEndTzo!=null?i.forcedEndTzo:this.offsetForMarker(e)},this,i.defaultSeparator)}formatIso(t,e={}){let r=null;return e.omitTimeZoneOffset||(e.forcedTzo!=null?r=e.forcedTzo:r=this.offsetForMarker(t)),Rc(t,r,e.omitTime)}timestampToMarker(t){return this.timeZone==="local"?St(Cv(new Date(t))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(t):St(this.namedTimeZoneImpl.timestampToArray(t))}offsetForMarker(t){return this.timeZone==="local"?-xv(Ii(t)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(Ii(t)):null}toDate(t,e){return this.timeZone==="local"?xv(Ii(t)):this.timeZone==="UTC"?new Date(t.valueOf()):this.namedTimeZoneImpl?new Date(t.valueOf()-this.namedTimeZoneImpl.offsetForArray(Ii(t))*1e3*60):new Date(t.valueOf()-(e||0))}},ei=class{constructor(t){this.iconOverrideOption&&this.setIconOverride(t[this.iconOverrideOption])}setIconOverride(t){let e,r;if(typeof t=="object"&&t){e=Object.assign({},this.iconClasses);for(r in t)e[r]=this.applyIconOverridePrefix(t[r]);this.iconClasses=e}else t===!1&&(this.iconClasses={})}applyIconOverridePrefix(t){let e=this.iconOverridePrefix;return e&&t.indexOf(e)!==0&&(t=e+t),t}getClass(t){return this.classes[t]||""}getIconClass(t,e){let r;return e&&this.rtlIconClasses?r=this.rtlIconClasses[t]||this.iconClasses[t]:r=this.iconClasses[t],r?`${this.baseIconClass} ${r}`:""}getCustomButtonIconClass(t){let e;return this.iconOverrideCustomButtonOption&&(e=t[this.iconOverrideCustomButtonOption],e)?`${this.baseIconClass} ${this.applyIconOverridePrefix(e)}`:""}};ei.prototype.classes={};ei.prototype.iconClasses={};ei.prototype.baseIconClass="";ei.prototype.iconOverridePrefix="";function Wa(n){n();let t=q.debounceRendering,e=[];function r(i){e.push(i)}for(q.debounceRendering=r,Mi(b(Nh,{}),document.createElement("div"));e.length;)e.shift()();q.debounceRendering=t}var Nh=class extends ot{render(){return b("div",{})}componentDidMount(){this.setState({})}};function Jv(n){let t=uc(n),e=t.Provider;return t.Provider=function(){let r=!this.getChildContext,i=e.apply(this,arguments);if(r){let s=[];this.shouldComponentUpdate=a=>{this.props.value!==a.value&&s.forEach(o=>{o.context=a.value,o.forceUpdate()})},this.sub=a=>{s.push(a);let o=a.componentWillUnmount;a.componentWillUnmount=()=>{s.splice(s.indexOf(a),1),o&&o.call(a)}}}return i},t}var Dc=class{constructor(t,e,r,i){this.execFunc=t,this.emitter=e,this.scrollTime=r,this.scrollTimeReset=i,this.handleScrollRequest=s=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},s),this.drain()},e.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(t){t&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}},Gt=Jv({});function Xv(n,t,e,r,i,s,a,o,l,c,d,u,h,f){return{dateEnv:i,nowManager:s,options:e,pluginHooks:o,emitter:d,dispatch:l,getCurrentData:c,calendarApi:u,viewSpec:n,viewApi:t,dateProfileGenerator:r,theme:a,isRtl:e.direction==="rtl",addResizeHandler(p){d.on("_resize",p)},removeResizeHandler(p){d.off("_resize",p)},createScrollResponder(p){return new Dc(p,d,J(e.scrollTime),e.scrollTimeReset)},registerInteractiveComponent:h,unregisterInteractiveComponent:f}}var kr=class extends ot{shouldComponentUpdate(t,e){return this.debug&&console.log(Ih(t,this.props),Ih(e,this.state)),!wc(this.props,t,this.propEquality)||!wc(this.state,e,this.stateEquality)}safeSetState(t){wc(this.state,Object.assign(Object.assign({},this.state),t),this.stateEquality)||this.setState(t)}};kr.addPropsEquality=eC;kr.addStateEquality=tC;kr.contextType=Gt;kr.prototype.propEquality={};kr.prototype.stateEquality={};var ue=class extends kr{};ue.contextType=Gt;function eC(n){let t=Object.create(this.prototype.propEquality);Object.assign(t,n),this.prototype.propEquality=t}function tC(n){let t=Object.create(this.prototype.stateEquality);Object.assign(t,n),this.prototype.stateEquality=t}function Qt(n,t){typeof n=="function"?n(t):n&&(n.current=t)}var ja=class extends ue{constructor(){super(...arguments),this.id=ni(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=t=>{let{options:e}=this.context,{generatorName:r}=this.props;(!e.customRenderingReplaces||!Oh(r,e))&&this.updateElRef(t)},this.updateElRef=t=>{this.props.elRef&&Qt(this.props.elRef,t)}}render(){let{props:t,context:e}=this,{options:r}=e,{customGenerator:i,defaultGenerator:s,renderProps:a}=t,o=tf(t,[],this.handleEl),l=!1,c,d=[],u;if(i!=null){let h=typeof i=="function"?i(a,b):i;if(h===!0)l=!0;else{let f=h&&typeof h=="object";f&&"html"in h?o.dangerouslySetInnerHTML={__html:h.html}:f&&"domNodes"in h?d=Array.prototype.slice.call(h.domNodes):(f?uh(h):typeof h!="function")?c=h:u=h}}else l=!Oh(t.generatorName,r);return l&&s&&(c=s(a)),this.queuedDomNodes=d,this.currentGeneratorMeta=u,b(t.elTag,o,c)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(t){var e;let{props:r,context:i}=this,{handleCustomRendering:s,customRenderingMetaMap:a}=i.options;if(s){let o=(e=this.currentGeneratorMeta)!==null&&e!==void 0?e:a==null?void 0:a[r.generatorName];o&&s(Object.assign(Object.assign({id:this.id,isActive:t,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:o},r),{elClasses:(r.elClasses||[]).filter(rC)}))}}applyQueueudDomNodes(){let{queuedDomNodes:t,currentDomNodes:e}=this,r=this.base;if(!Sr(t,e)){e.forEach(to);for(let i of t)r.appendChild(i);this.currentDomNodes=t}}};ja.addPropsEquality({elClasses:Sr,elStyle:wt,elAttrs:QS,renderProps:wt});function Oh(n,t){var e;return Boolean(t.handleCustomRendering&&n&&((e=t.customRenderingMetaMap)===null||e===void 0?void 0:e[n]))}function tf(n,t,e){let r=Object.assign(Object.assign({},n.elAttrs),{ref:e});return(n.elClasses||t)&&(r.className=(n.elClasses||[]).concat(t||[]).concat(r.className||[]).filter(Boolean).join(" ")),n.elStyle&&(r.style=n.elStyle),r}function rC(n){return Boolean(n)}var rf=Jv(0),Xe=class extends ot{constructor(){super(...arguments),this.InnerContent=iC.bind(void 0,this),this.handleEl=t=>{this.el=t,this.props.elRef&&(Qt(this.props.elRef,t),t&&this.didMountMisfire&&this.componentDidMount())}}render(){let{props:t}=this,e=nC(t.classNameGenerator,t.renderProps);if(t.children){let r=tf(t,e,this.handleEl),i=t.children(this.InnerContent,t.renderProps,r);return t.elTag?b(t.elTag,r,i):i}else return b(ja,Object.assign(Object.assign({},t),{elRef:this.handleEl,elTag:t.elTag||"div",elClasses:(t.elClasses||[]).concat(e),renderId:this.context}))}componentDidMount(){var t,e;this.el?(e=(t=this.props).didMount)===null||e===void 0||e.call(t,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var t,e;(e=(t=this.props).willUnmount)===null||e===void 0||e.call(t,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}};Xe.contextType=rf;function iC(n,t){let e=n.props;return b(ja,Object.assign({renderProps:e.renderProps,generatorName:e.generatorName,customGenerator:e.customGenerator,defaultGenerator:e.defaultGenerator,renderId:n.context},t))}function nC(n,t){let e=typeof n=="function"?n(t):n||[];return typeof e=="string"?[e]:e}var sr=class extends ue{render(){let{props:t,context:e}=this,{options:r}=e,i={view:e.viewApi};return b(Xe,Object.assign({},t,{elTag:t.elTag||"div",elClasses:[...nf(t.viewSpec),...t.elClasses||[]],renderProps:i,classNameGenerator:r.viewClassNames,generatorName:void 0,didMount:r.viewDidMount,willUnmount:r.viewWillUnmount}),()=>t.children)}};function nf(n){return[`fc-${n.type}-view`,"fc-view"]}function sC(n,t){let e=null,r=null;return n.start&&(e=t.createMarker(n.start)),n.end&&(r=t.createMarker(n.end)),!e&&!r||e&&r&&r<e?null:{start:e,end:r}}function Av(n,t){let e=[],{start:r}=t,i,s;for(n.sort(aC),i=0;i<n.length;i+=1)s=n[i],s.start>r&&e.push({start:r,end:s.start}),s.end>r&&(r=s.end);return r<t.end&&e.push({start:r,end:t.end}),e}function aC(n,t){return n.start.valueOf()-t.start.valueOf()}function Lt(n,t){let{start:e,end:r}=n,i=null;return t.start!==null&&(e===null?e=t.start:e=new Date(Math.max(e.valueOf(),t.start.valueOf()))),t.end!=null&&(r===null?r=t.end:r=new Date(Math.min(r.valueOf(),t.end.valueOf()))),(e===null||r===null||e<r)&&(i={start:e,end:r}),i}function ew(n,t){return(n.start===null?null:n.start.valueOf())===(t.start===null?null:t.start.valueOf())&&(n.end===null?null:n.end.valueOf())===(t.end===null?null:t.end.valueOf())}function Hc(n,t){return(n.end===null||t.start===null||n.end>t.start)&&(n.start===null||t.end===null||n.start<t.end)}function Is(n,t){return(n.start===null||t.start!==null&&t.start>=n.start)&&(n.end===null||t.end!==null&&t.end<=n.end)}function $t(n,t){return(n.start===null||t>=n.start)&&(n.end===null||t<n.end)}function oC(n,t){return t.start!=null&&n<t.start?t.start:t.end!=null&&n>=t.end?new Date(t.end.valueOf()-1):n}function tw(n){let t=Math.floor(si(n.start,n.end))||1,e=ke(n.start),r=qe(e,t);return{start:e,end:r}}function sf(n,t=J(0)){let e=null,r=null;if(n.end){r=ke(n.end);let i=n.end.valueOf()-r.valueOf();i&&i>=Rt(t)&&(r=qe(r,1))}return n.start&&(e=ke(n.start),r&&r<=e&&(r=qe(e,1))),{start:e,end:r}}function Ni(n,t,e,r){return r==="year"?J(e.diffWholeYears(n,t),"year"):r==="month"?J(e.diffWholeMonths(n,t),"month"):zv(n,t)}var Nn=class{constructor(t){this.props=t,this.initHiddenDays()}buildPrev(t,e,r){let{dateEnv:i}=this.props,s=i.subtract(i.startOf(e,t.currentRangeUnit),t.dateIncrement);return this.build(s,-1,r)}buildNext(t,e,r){let{dateEnv:i}=this.props,s=i.add(i.startOf(e,t.currentRangeUnit),t.dateIncrement);return this.build(s,1,r)}build(t,e,r=!0){let{props:i}=this,s,a,o,l,c,d;return s=this.buildValidRange(),s=this.trimHiddenDays(s),r&&(t=oC(t,s)),a=this.buildCurrentRangeInfo(t,e),o=/^(year|month|week|day)$/.test(a.unit),l=this.buildRenderRange(this.trimHiddenDays(a.range),a.unit,o),l=this.trimHiddenDays(l),c=l,i.showNonCurrentDates||(c=Lt(c,a.range)),c=this.adjustActiveRange(c),c=Lt(c,s),d=Hc(a.range,s),$t(l,t)||(t=l.start),{currentDate:t,validRange:s,currentRange:a.range,currentRangeUnit:a.unit,isRangeAllDay:o,activeRange:c,renderRange:l,slotMinTime:i.slotMinTime,slotMaxTime:i.slotMaxTime,isValid:d,dateIncrement:this.buildDateIncrement(a.duration)}}buildValidRange(){let t=this.props.validRangeInput,e=typeof t=="function"?t.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):t;return this.refineRange(e)||{start:null,end:null}}buildCurrentRangeInfo(t,e){let{props:r}=this,i=null,s=null,a=null,o;return r.duration?(i=r.duration,s=r.durationUnit,a=this.buildRangeFromDuration(t,e,i,s)):(o=this.props.dayCount)?(s="day",a=this.buildRangeFromDayCount(t,e,o)):(a=this.buildCustomVisibleRange(t))?s=r.dateEnv.greatestWholeUnit(a.start,a.end).unit:(i=this.getFallbackDuration(),s=Ua(i).unit,a=this.buildRangeFromDuration(t,e,i,s)),{duration:i,unit:s,range:a}}getFallbackDuration(){return J({day:1})}adjustActiveRange(t){let{dateEnv:e,usesMinMaxTime:r,slotMinTime:i,slotMaxTime:s}=this.props,{start:a,end:o}=t;return r&&(ks(i)<0&&(a=ke(a),a=e.add(a,i)),ks(s)>1&&(o=ke(o),o=qe(o,-1),o=e.add(o,s))),{start:a,end:o}}buildRangeFromDuration(t,e,r,i){let{dateEnv:s,dateAlignment:a}=this.props,o,l,c;if(!a){let{dateIncrement:u}=this.props;u&&Rt(u)<Rt(r)?a=Ua(u).unit:a=i}ks(r)<=1&&this.isHiddenDay(o)&&(o=this.skipHiddenDays(o,e),o=ke(o));function d(){o=s.startOf(t,a),l=s.add(o,r),c={start:o,end:l}}return d(),this.trimHiddenDays(c)||(t=this.skipHiddenDays(t,e),d()),c}buildRangeFromDayCount(t,e,r){let{dateEnv:i,dateAlignment:s}=this.props,a=0,o=t,l;s&&(o=i.startOf(o,s)),o=ke(o),o=this.skipHiddenDays(o,e),l=o;do l=qe(l,1),this.isHiddenDay(l)||(a+=1);while(a<r);return{start:o,end:l}}buildCustomVisibleRange(t){let{props:e}=this,r=e.visibleRangeInput,i=typeof r=="function"?r.call(e.calendarApi,e.dateEnv.toDate(t)):r,s=this.refineRange(i);return s&&(s.start==null||s.end==null)?null:s}buildRenderRange(t,e,r){return t}buildDateIncrement(t){let{dateIncrement:e}=this.props,r;return e||((r=this.props.dateAlignment)?J(1,r):t||J({days:1}))}refineRange(t){if(t){let e=sC(t,this.props.dateEnv);return e&&(e=sf(e)),e}return null}initHiddenDays(){let t=this.props.hiddenDays||[],e=[],r=0,i;for(this.props.weekends===!1&&t.push(0,6),i=0;i<7;i+=1)(e[i]=t.indexOf(i)!==-1)||(r+=1);if(!r)throw new Error("invalid hiddenDays");this.isHiddenDayHash=e}trimHiddenDays(t){let{start:e,end:r}=t;return e&&(e=this.skipHiddenDays(e)),r&&(r=this.skipHiddenDays(r,-1,!0)),e==null||r==null||e<r?{start:e,end:r}:null}isHiddenDay(t){return t instanceof Date&&(t=t.getUTCDay()),this.isHiddenDayHash[t]}skipHiddenDays(t,e=1,r=!1){for(;this.isHiddenDayHash[(t.getUTCDay()+(r?e:0)+7)%7];)t=qe(t,e);return t}};function Ps(n,t,e,r){return{instanceId:ni(),defId:n,range:t,forcedStartTzo:e==null?null:e,forcedEndTzo:r==null?null:r}}function lC(n,t,e,r){for(let i=0;i<r.length;i+=1){let s=r[i].parse(n,e);if(s){let{allDay:a}=n;return a==null&&(a=t,a==null&&(a=s.allDayGuess,a==null&&(a=!1))),{allDay:a,duration:s.duration,typeData:s.typeData,typeId:i}}}return null}function On(n,t,e){let{dateEnv:r,pluginHooks:i,options:s}=e,{defs:a,instances:o}=n;o=Xr(o,l=>!a[l.defId].recurringDef);for(let l in a){let c=a[l];if(c.recurringDef){let{duration:d}=c.recurringDef;d||(d=c.allDay?s.defaultAllDayEventDuration:s.defaultTimedEventDuration);let u=cC(c,d,t,r,i.recurringTypes);for(let h of u){let f=Ps(l,{start:h,end:r.add(h,d)});o[f.instanceId]=f}}}return{defs:a,instances:o}}function cC(n,t,e,r,i){let a=i[n.recurringDef.typeId].expand(n.recurringDef.typeData,{start:r.subtract(e.start,t),end:e.end},r);return n.allDay&&(a=a.map(ke)),a}var bc={id:String,groupId:String,title:String,url:String,interactive:Boolean},rw={start:A,end:A,date:A,allDay:Boolean},dC=Object.assign(Object.assign(Object.assign({},bc),rw),{extendedProps:A});function iw(n,t,e,r,i=af(e),s,a){let{refined:o,extra:l}=oo(n,e,i),c=hC(t,e),d=lC(o,c,e.dateEnv,e.pluginHooks.recurringTypes);if(d){let h=Ss(o,l,t?t.sourceId:"",d.allDay,Boolean(d.duration),e,s);return h.recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:h,instance:null}}let u=uC(o,c,e,r);if(u){let h=Ss(o,l,t?t.sourceId:"",u.allDay,u.hasEnd,e,s),f=Ps(h.defId,u.range,u.forcedStartTzo,u.forcedEndTzo);return a&&h.publicId&&a[h.publicId]&&(f.instanceId=a[h.publicId]),{def:h,instance:f}}return null}function oo(n,t,e=af(t)){return ao(n,e)}function af(n){return Object.assign(Object.assign(Object.assign({},Sc),dC),n.pluginHooks.eventRefiners)}function Ss(n,t,e,r,i,s,a){let o={title:n.title||"",groupId:n.groupId||"",publicId:n.id||"",url:n.url||"",recurringDef:null,defId:(a&&n.id?a[n.id]:"")||ni(),sourceId:e,allDay:r,hasEnd:i,interactive:n.interactive,ui:Ns(n,s),extendedProps:Object.assign(Object.assign({},n.extendedProps||{}),t)};for(let l of s.pluginHooks.eventDefMemberAdders)Object.assign(o,l(n));return Object.freeze(o.ui.classNames),Object.freeze(o.extendedProps),o}function uC(n,t,e,r){let{allDay:i}=n,s,a=null,o=!1,l,c=null,d=n.start!=null?n.start:n.date;if(s=e.dateEnv.createMarkerMeta(d),s)a=s.marker;else if(!r)return null;return n.end!=null&&(l=e.dateEnv.createMarkerMeta(n.end)),i==null&&(t!=null?i=t:i=(!s||s.isTimeUnspecified)&&(!l||l.isTimeUnspecified)),i&&a&&(a=ke(a)),l&&(c=l.marker,i&&(c=ke(c)),a&&c<=a&&(c=null)),c?o=!0:r||(o=e.options.forceEventDuration||!1,c=e.dateEnv.add(a,i?e.options.defaultAllDayEventDuration:e.options.defaultTimedEventDuration)),{allDay:i,hasEnd:o,range:{start:a,end:c},forcedStartTzo:s?s.forcedTzo:null,forcedEndTzo:l?l.forcedTzo:null}}function hC(n,t){let e=null;return n&&(e=n.defaultAllDay),e==null&&(e=t.options.defaultAllDay),e}function $a(n,t,e,r,i,s){let a=Ge(),o=af(e);for(let l of n){let c=iw(l,t,e,r,o,i,s);c&&Rn(c,a)}return a}function Rn(n,t=Ge()){return t.defs[n.def.defId]=n.def,n.instance&&(t.instances[n.instance.instanceId]=n.instance),t}function lo(n,t){let e=n.instances[t];if(e){let r=n.defs[e.defId],i=Uc(n,s=>fC(r,s));return i.defs[r.defId]=r,i.instances[e.instanceId]=e,i}return Ge()}function fC(n,t){return Boolean(n.groupId&&n.groupId===t.groupId)}function Ge(){return{defs:{},instances:{}}}function Yc(n,t){return{defs:Object.assign(Object.assign({},n.defs),t.defs),instances:Object.assign(Object.assign({},n.instances),t.instances)}}function Uc(n,t){let e=Xr(n.defs,t),r=Xr(n.instances,i=>e[i.defId]);return{defs:e,instances:r}}function pC(n,t){let{defs:e,instances:r}=n,i={},s={};for(let a in e)t.defs[a]||(i[a]=e[a]);for(let a in r)!t.instances[a]&&i[r[a].defId]&&(s[a]=r[a]);return{defs:i,instances:s}}function mC(n,t){return Array.isArray(n)?$a(n,null,t,!0):typeof n=="object"&&n?$a([n],null,t,!0):n!=null?String(n):null}function Rh(n){return Array.isArray(n)?n:typeof n=="string"?n.split(/\s+/):[]}var Sc={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:A,overlap:A,allow:A,className:Rh,classNames:Rh,color:String,backgroundColor:String,borderColor:String,textColor:String},gC={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function Ns(n,t){let e=mC(n.constraint,t);return{display:n.display||null,startEditable:n.startEditable!=null?n.startEditable:n.editable,durationEditable:n.durationEditable!=null?n.durationEditable:n.editable,constraints:e!=null?[e]:[],overlap:n.overlap!=null?n.overlap:null,allows:n.allow!=null?[n.allow]:[],backgroundColor:n.backgroundColor||n.color||"",borderColor:n.borderColor||n.color||"",textColor:n.textColor||"",classNames:(n.className||[]).concat(n.classNames||[])}}function of(n){return n.reduce(yC,gC)}function yC(n,t){return{display:t.display!=null?t.display:n.display,startEditable:t.startEditable!=null?t.startEditable:n.startEditable,durationEditable:t.durationEditable!=null?t.durationEditable:n.durationEditable,constraints:n.constraints.concat(t.constraints),overlap:typeof t.overlap=="boolean"?t.overlap:n.overlap,allows:n.allows.concat(t.allows),backgroundColor:t.backgroundColor||n.backgroundColor,borderColor:t.borderColor||n.borderColor,textColor:t.textColor||n.textColor,classNames:n.classNames.concat(t.classNames)}}var vC={id:String,defaultAllDay:Boolean,url:String,format:String,events:A,eventDataTransform:A,success:A,failure:A};function lf(n,t,e=cf(t)){let r;if(typeof n=="string"?r={url:n}:typeof n=="function"||Array.isArray(n)?r={events:n}:typeof n=="object"&&n&&(r=n),r){let{refined:i,extra:s}=ao(r,e),a=wC(i,t);if(a)return{_raw:n,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:i.defaultAllDay,eventDataTransform:i.eventDataTransform,success:i.success,failure:i.failure,publicId:i.id||"",sourceId:ni(),sourceDefId:a.sourceDefId,meta:a.meta,ui:Ns(i,t),extendedProps:s}}return null}function cf(n){return Object.assign(Object.assign(Object.assign({},Sc),vC),n.pluginHooks.eventSourceRefiners)}function wC(n,t){let e=t.pluginHooks.eventSourceDefs;for(let r=e.length-1;r>=0;r-=1){let s=e[r].parseMeta(n);if(s)return{sourceDefId:r,meta:s}}return null}function nw(n,t,e,r,i){switch(t.type){case"RECEIVE_EVENTS":return bC(n,e[t.sourceId],t.fetchId,t.fetchRange,t.rawEvents,i);case"RESET_RAW_EVENTS":return TC(n,e[t.sourceId],t.rawEvents,r.activeRange,i);case"ADD_EVENTS":return EC(n,t.eventStore,r?r.activeRange:null,i);case"RESET_EVENTS":return t.eventStore;case"MERGE_EVENTS":return Yc(n,t.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return r?On(n,r.activeRange,i):n;case"REMOVE_EVENTS":return pC(n,t.eventStore);case"REMOVE_EVENT_SOURCE":return aw(n,t.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return Uc(n,s=>!s.sourceId);case"REMOVE_ALL_EVENTS":return Ge();default:return n}}function bC(n,t,e,r,i,s){if(t&&e===t.latestFetchId){let a=$a(sw(i,t,s),t,s);return r&&(a=On(a,r,s)),Yc(aw(n,t.sourceId),a)}return n}function TC(n,t,e,r,i){let{defIdMap:s,instanceIdMap:a}=DC(n),o=$a(sw(e,t,i),t,i,!1,s,a);return On(o,r,i)}function sw(n,t,e){let r=e.options.eventDataTransform,i=t?t.eventDataTransform:null;return i&&(n=Iv(n,i)),r&&(n=Iv(n,r)),n}function Iv(n,t){let e;if(!t)e=n;else{e=[];for(let r of n){let i=t(r);i?e.push(i):i==null&&e.push(r)}}return e}function EC(n,t,e,r){return e&&(t=On(t,e,r)),Yc(n,t)}function df(n,t,e){let{defs:r}=n,i=zt(n.instances,s=>r[s.defId].allDay?s:Object.assign(Object.assign({},s),{range:{start:e.createMarker(t.toDate(s.range.start,s.forcedStartTzo)),end:e.createMarker(t.toDate(s.range.end,s.forcedEndTzo))},forcedStartTzo:e.canComputeOffset?null:s.forcedStartTzo,forcedEndTzo:e.canComputeOffset?null:s.forcedEndTzo}));return{defs:r,instances:i}}function aw(n,t){return Uc(n,e=>e.sourceId!==t)}function kC(n,t){return{defs:n.defs,instances:Xr(n.instances,e=>!t[e.instanceId])}}function DC(n){let{defs:t,instances:e}=n,r={},i={};for(let s in t){let a=t[s],{publicId:o}=a;o&&(r[o]=s)}for(let s in e){let a=e[s],o=t[a.defId],{publicId:l}=o;l&&(i[l]=s)}return{defIdMap:r,instanceIdMap:i}}var ti=class{constructor(){this.handlers={},this.thisContext=null}setThisContext(t){this.thisContext=t}setOptions(t){this.options=t}on(t,e){SC(this.handlers,t,e)}off(t,e){CC(this.handlers,t,e)}trigger(t,...e){let r=this.handlers[t]||[],i=this.options&&this.options[t],s=[].concat(i||[],r);for(let a of s)a.apply(this.thisContext,e)}hasHandlers(t){return Boolean(this.handlers[t]&&this.handlers[t].length||this.options&&this.options[t])}};function SC(n,t,e){(n[t]||(n[t]=[])).push(e)}function CC(n,t,e){e?n[t]&&(n[t]=n[t].filter(r=>r!==e)):delete n[t]}var xC={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function uf(n,t){return $a(_C(n),null,t)}function _C(n){let t;return n===!0?t=[{}]:Array.isArray(n)?t=n.filter(e=>e.daysOfWeek):typeof n=="object"&&n?t=[n]:t=[],t=t.map(e=>Object.assign(Object.assign({},xC),e)),t}function Vc(n,t,e){e.emitter.trigger("select",Object.assign(Object.assign({},hf(n,e)),{jsEvent:t?t.origEvent:null,view:e.viewApi||e.calendarApi.view}))}function MC(n,t){t.emitter.trigger("unselect",{jsEvent:n?n.origEvent:null,view:t.viewApi||t.calendarApi.view})}function hf(n,t){let e={};for(let r of t.pluginHooks.dateSpanTransforms)Object.assign(e,r(n,t));return Object.assign(e,UC(n,t.dateEnv)),e}function za(n,t,e){let{dateEnv:r,options:i}=e,s=t;return n?(s=ke(s),s=r.add(s,i.defaultAllDayEventDuration)):s=r.add(s,i.defaultTimedEventDuration),s}function co(n,t,e,r){let i=xc(n.defs,t),s=Ge();for(let a in n.defs){let o=n.defs[a];s.defs[a]=AC(o,i[a],e,r)}for(let a in n.instances){let o=n.instances[a],l=s.defs[o.defId];s.instances[a]=IC(o,l,i[o.defId],e,r)}return s}function AC(n,t,e,r){let i=e.standardProps||{};i.hasEnd==null&&t.durationEditable&&(e.startDelta||e.endDelta)&&(i.hasEnd=!0);let s=Object.assign(Object.assign(Object.assign({},n),i),{ui:Object.assign(Object.assign({},n.ui),i.ui)});e.extendedProps&&(s.extendedProps=Object.assign(Object.assign({},s.extendedProps),e.extendedProps));for(let a of r.pluginHooks.eventDefMutationAppliers)a(s,e,r);return!s.hasEnd&&r.options.forceEventDuration&&(s.hasEnd=!0),s}function IC(n,t,e,r,i){let{dateEnv:s}=i,a=r.standardProps&&r.standardProps.allDay===!0,o=r.standardProps&&r.standardProps.hasEnd===!1,l=Object.assign({},n);return a&&(l.range=tw(l.range)),r.datesDelta&&e.startEditable&&(l.range={start:s.add(l.range.start,r.datesDelta),end:s.add(l.range.end,r.datesDelta)}),r.startDelta&&e.durationEditable&&(l.range={start:s.add(l.range.start,r.startDelta),end:l.range.end}),r.endDelta&&e.durationEditable&&(l.range={start:l.range.start,end:s.add(l.range.end,r.endDelta)}),o&&(l.range={start:l.range.start,end:za(t.allDay,l.range.start,i)}),t.allDay&&(l.range={start:ke(l.range.start),end:ke(l.range.end)}),l.range.end<l.range.start&&(l.range.end=za(t.allDay,l.range.start,i)),l}var Ai=class{constructor(t,e){this.context=t,this.internalEventSource=e}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}},De=class{constructor(t,e,r){this._context=t,this._def=e,this._instance=r||null}setProp(t,e){if(t in rw)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(t==="id")e=bc[t](e),this.mutate({standardProps:{publicId:e}});else if(t in bc)e=bc[t](e),this.mutate({standardProps:{[t]:e}});else if(t in Sc){let r=Sc[t](e);t==="color"?r={backgroundColor:e,borderColor:e}:t==="editable"?r={startEditable:e,durationEditable:e}:r={[t]:e},this.mutate({standardProps:{ui:r}})}else console.warn(`Could not set prop '${t}'. Use setExtendedProp instead.`)}setExtendedProp(t,e){this.mutate({extendedProps:{[t]:e}})}setStart(t,e={}){let{dateEnv:r}=this._context,i=r.createMarker(t);if(i&&this._instance){let s=this._instance.range,a=Ni(s.start,i,r,e.granularity);e.maintainDuration?this.mutate({datesDelta:a}):this.mutate({startDelta:a})}}setEnd(t,e={}){let{dateEnv:r}=this._context,i;if(!(t!=null&&(i=r.createMarker(t),!i))&&this._instance)if(i){let s=Ni(this._instance.range.end,i,r,e.granularity);this.mutate({endDelta:s})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(t,e,r={}){let{dateEnv:i}=this._context,s={allDay:r.allDay},a=i.createMarker(t),o;if(a&&!(e!=null&&(o=i.createMarker(e),!o))&&this._instance){let l=this._instance.range;r.allDay===!0&&(l=tw(l));let c=Ni(l.start,a,i,r.granularity);if(o){let d=Ni(l.end,o,i,r.granularity);DS(c,d)?this.mutate({datesDelta:c,standardProps:s}):this.mutate({startDelta:c,endDelta:d,standardProps:s})}else s.hasEnd=!1,this.mutate({datesDelta:c,standardProps:s})}}moveStart(t){let e=J(t);e&&this.mutate({startDelta:e})}moveEnd(t){let e=J(t);e&&this.mutate({endDelta:e})}moveDates(t){let e=J(t);e&&this.mutate({datesDelta:e})}setAllDay(t,e={}){let r={allDay:t},{maintainDuration:i}=e;i==null&&(i=this._context.options.allDayMaintainDuration),this._def.allDay!==t&&(r.hasEnd=i),this.mutate({standardProps:r})}formatRange(t){let{dateEnv:e}=this._context,r=this._instance,i=be(t);return this._def.hasEnd?e.formatRange(r.range.start,r.range.end,i,{forcedStartTzo:r.forcedStartTzo,forcedEndTzo:r.forcedEndTzo}):e.format(r.range.start,i,{forcedTzo:r.forcedStartTzo})}mutate(t){let e=this._instance;if(e){let r=this._def,i=this._context,{eventStore:s}=i.getCurrentData(),a=lo(s,e.instanceId);a=co(a,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},t,i);let l=new De(i,r,e);this._def=a.defs[r.defId],this._instance=a.instances[e.instanceId],i.dispatch({type:"MERGE_EVENTS",eventStore:a}),i.emitter.trigger("eventChange",{oldEvent:l,event:this,relatedEvents:xr(a,i,e),revert(){i.dispatch({type:"RESET_EVENTS",eventStore:s})}})}}remove(){let t=this._context,e=ow(this);t.dispatch({type:"REMOVE_EVENTS",eventStore:e}),t.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){t.dispatch({type:"MERGE_EVENTS",eventStore:e})}})}get source(){let{sourceId:t}=this._def;return t?new Ai(this._context,this._context.getCurrentData().eventSources[t]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let t=this._instance;return t?this._context.dateEnv.formatIso(t.range.start,{omitTime:this._def.allDay,forcedTzo:t.forcedStartTzo}):""}get endStr(){let t=this._instance;return t&&this._def.hasEnd?this._context.dateEnv.formatIso(t.range.end,{omitTime:this._def.allDay,forcedTzo:t.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(t={}){let e=this._def,{ui:r}=e,{startStr:i,endStr:s}=this,a={allDay:e.allDay};return e.title&&(a.title=e.title),i&&(a.start=i),s&&(a.end=s),e.publicId&&(a.id=e.publicId),e.groupId&&(a.groupId=e.groupId),e.url&&(a.url=e.url),r.display&&r.display!=="auto"&&(a.display=r.display),t.collapseColor&&r.backgroundColor&&r.backgroundColor===r.borderColor?a.color=r.backgroundColor:(r.backgroundColor&&(a.backgroundColor=r.backgroundColor),r.borderColor&&(a.borderColor=r.borderColor)),r.textColor&&(a.textColor=r.textColor),r.classNames.length&&(a.classNames=r.classNames),Object.keys(e.extendedProps).length&&(t.collapseExtendedProps?Object.assign(a,e.extendedProps):a.extendedProps=e.extendedProps),a}toJSON(){return this.toPlainObject()}};function ow(n){let t=n._def,e=n._instance;return{defs:{[t.defId]:t},instances:e?{[e.instanceId]:e}:{}}}function xr(n,t,e){let{defs:r,instances:i}=n,s=[],a=e?e.instanceId:"";for(let o in i){let l=i[o],c=r[l.defId];l.instanceId!==a&&s.push(new De(t,c,l))}return s}function Cc(n,t,e,r){let i={},s={},a={},o=[],l=[],c=xc(n.defs,t);for(let d in n.defs){let u=n.defs[d];c[u.defId].display==="inverse-background"&&(u.groupId?(i[u.groupId]=[],a[u.groupId]||(a[u.groupId]=u)):s[d]=[])}for(let d in n.instances){let u=n.instances[d],h=n.defs[u.defId],f=c[h.defId],p=u.range,m=!h.allDay&&r?sf(p,r):p,g=Lt(m,e);g&&(f.display==="inverse-background"?h.groupId?i[h.groupId].push(g):s[u.defId].push(g):f.display!=="none"&&(f.display==="background"?o:l).push({def:h,ui:f,instance:u,range:g,isStart:m.start&&m.start.valueOf()===g.start.valueOf(),isEnd:m.end&&m.end.valueOf()===g.end.valueOf()}))}for(let d in i){let u=i[d],h=Av(u,e);for(let f of h){let p=a[d],m=c[p.defId];o.push({def:p,ui:m,instance:null,range:f,isStart:!1,isEnd:!1})}}for(let d in s){let u=s[d],h=Av(u,e);for(let f of h)o.push({def:n.defs[d],ui:c[d],instance:null,range:f,isStart:!1,isEnd:!1})}return{bg:o,fg:l}}function ff(n){return n.ui.display==="background"||n.ui.display==="inverse-background"}function Pv(n,t){n.fcSeg=t}function ai(n){return n.fcSeg||n.parentNode.fcSeg||null}function xc(n,t){return zt(n,e=>lw(e,t))}function lw(n,t){let e=[];return t[""]&&e.push(t[""]),t[n.defId]&&e.push(t[n.defId]),e.push(n.ui),of(e)}function uo(n,t){let e=n.map(PC);return e.sort((r,i)=>Wv(r,i,t)),e.map(r=>r._seg)}function PC(n){let{eventRange:t}=n,e=t.def,r=t.instance?t.instance.range:t.range,i=r.start?r.start.valueOf():0,s=r.end?r.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},e.extendedProps),e),{id:e.publicId,start:i,end:s,duration:s-i,allDay:Number(e.allDay),_seg:n})}function NC(n,t){let{pluginHooks:e}=t,r=e.isDraggableTransformers,{def:i,ui:s}=n.eventRange,a=s.startEditable;for(let o of r)a=o(a,i,s,t);return a}function OC(n,t){return n.isStart&&n.eventRange.ui.durationEditable&&t.options.eventResizableFromStart}function RC(n,t){return n.isEnd&&n.eventRange.ui.durationEditable}function Wc(n,t,e,r,i,s,a){let{dateEnv:o,options:l}=e,{displayEventTime:c,displayEventEnd:d}=l,u=n.eventRange.def,h=n.eventRange.instance;c==null&&(c=r!==!1),d==null&&(d=i!==!1);let f=h.range.start,p=h.range.end,m=s||n.start||n.eventRange.range.start,g=a||n.end||n.eventRange.range.end,v=ke(f).valueOf()===ke(m).valueOf(),T=ke(Er(p,-1)).valueOf()===ke(Er(g,-1)).valueOf();return c&&!u.allDay&&(v||T)?(m=v?f:m,g=T?p:g,d&&u.hasEnd?o.formatRange(m,g,t,{forcedStartTzo:s?null:h.forcedStartTzo,forcedEndTzo:a?null:h.forcedEndTzo}):o.format(m,t,{forcedTzo:s?null:h.forcedStartTzo})):""}function lr(n,t,e){let r=n.eventRange.range;return{isPast:r.end<=(e||t.start),isFuture:r.start>=(e||t.end),isToday:t&&$t(t,r.start)}}function LC(n){let t=["fc-event"];return n.isMirror&&t.push("fc-event-mirror"),n.isDraggable&&t.push("fc-event-draggable"),(n.isStartResizable||n.isEndResizable)&&t.push("fc-event-resizable"),n.isDragging&&t.push("fc-event-dragging"),n.isResizing&&t.push("fc-event-resizing"),n.isSelected&&t.push("fc-event-selected"),n.isStart&&t.push("fc-event-start"),n.isEnd&&t.push("fc-event-end"),n.isPast&&t.push("fc-event-past"),n.isToday&&t.push("fc-event-today"),n.isFuture&&t.push("fc-event-future"),t}function ho(n){return n.instance?n.instance.instanceId:`${n.def.defId}:${n.range.start.toISOString()}`}function jc(n,t){let{def:e,instance:r}=n.eventRange,{url:i}=e;if(i)return{href:i};let{emitter:s,options:a}=t,{eventInteractive:o}=a;return o==null&&(o=e.interactive,o==null&&(o=Boolean(s.hasHandlers("eventClick")))),o?Uv(l=>{s.trigger("eventClick",{el:l.target,event:new De(t,e,r),jsEvent:l,view:t.viewApi})}):{}}var FC={start:A,end:A,allDay:Boolean};function BC(n,t,e){let r=HC(n,t),{range:i}=r;if(!i.start)return null;if(!i.end){if(e==null)return null;i.end=t.add(i.start,e)}return r}function HC(n,t){let{refined:e,extra:r}=ao(n,FC),i=e.start?t.createMarkerMeta(e.start):null,s=e.end?t.createMarkerMeta(e.end):null,{allDay:a}=e;return a==null&&(a=i&&i.isTimeUnspecified&&(!s||s.isTimeUnspecified)),Object.assign({range:{start:i?i.marker:null,end:s?s.marker:null},allDay:a},r)}function pf(n,t){return ew(n.range,t.range)&&n.allDay===t.allDay&&YC(n,t)}function YC(n,t){for(let e in t)if(e!=="range"&&e!=="allDay"&&n[e]!==t[e])return!1;for(let e in n)if(!(e in t))return!1;return!0}function UC(n,t){return Object.assign(Object.assign({},cw(n.range,t,n.allDay)),{allDay:n.allDay})}function mf(n,t,e){return Object.assign(Object.assign({},cw(n,t,e)),{timeZone:t.timeZone})}function cw(n,t,e){return{start:t.toDate(n.start),end:t.toDate(n.end),startStr:t.formatIso(n.start,{omitTime:e}),endStr:t.formatIso(n.end,{omitTime:e})}}function VC(n,t,e){let r=oo({editable:!1},e),i=Ss(r.refined,r.extra,"",n.allDay,!0,e);return{def:i,ui:lw(i,t),instance:Ps(i.defId,n.range),range:n.range,isStart:!0,isEnd:!0}}function gf(n,t,e){let r=!1,i=function(o){r||(r=!0,t(o))},s=function(o){r||(r=!0,e(o))},a=n(i,s);a&&typeof a.then=="function"&&a.then(i,s)}var _c=class extends Error{constructor(t,e){super(t),this.response=e}};function yf(n,t,e){n=n.toUpperCase();let r={method:n};return n==="GET"?t+=(t.indexOf("?")===-1?"?":"&")+new URLSearchParams(e):(r.body=new URLSearchParams(e),r.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(t,r).then(i=>{if(i.ok)return i.json().then(s=>[s,i],()=>{throw new _c("Failure parsing JSON",i)});throw new _c("Request failed",i)})}var bh;function vf(){return bh==null&&(bh=WC()),bh}function WC(){if(typeof document=="undefined")return!0;let n=document.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.innerHTML="<table><tr><td><div></div></td></tr></table>",n.querySelector("table").style.height="100px",n.querySelector("div").style.height="100%",document.body.appendChild(n);let e=n.querySelector("div").offsetHeight>0;return document.body.removeChild(n),e}var qa=class extends ue{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{Wa(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{Wa(()=>{this.setState({forPrint:!1})})}}render(){let{props:t}=this,{options:e}=t,{forPrint:r}=this.state,i=r||e.height==="auto"||e.contentHeight==="auto",s=!i&&e.height!=null?e.height:"",a=["fc",r?"fc-media-print":"fc-media-screen",`fc-direction-${e.direction}`,t.theme.getClass("root")];return vf()||a.push("fc-liquid-hack"),t.children(a,s,i,r)}componentDidMount(){let{emitter:t}=this.props;t.on("_beforeprint",this.handleBeforePrint),t.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:t}=this.props;t.off("_beforeprint",this.handleBeforePrint),t.off("_afterprint",this.handleAfterPrint)}},ar=class{constructor(t){this.component=t.component,this.isHitComboAllowed=t.isHitComboAllowed||null}destroy(){}};function dw(n,t){return{component:n,el:t.el,useEventCenter:t.useEventCenter!=null?t.useEventCenter:!0,isHitComboAllowed:t.isHitComboAllowed||null}}function fo(n){return{[n.component.uid]:n}}var zn={},qt=class extends ot{constructor(t,e){super(t,e),this.handleRefresh=()=>{let r=this.computeTiming();r.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(r.state),this.clearTimeout(),this.setTimeout(r.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:t,state:e}=this;return t.children(e.nowDate,e.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(t){t.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:t,context:e}=this,r=e.nowManager.getDateMarker(),i=e.dateEnv.startOf(r,t.unit),a=e.dateEnv.add(i,J(1,t.unit)).valueOf()-r.valueOf();return a=Math.min(1e3*60*60*24,a),{state:{nowDate:i,todayRange:jC(i)},waitMs:a}}setTimeout(t=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{let e=this.computeTiming();this.setState(e.state,()=>{this.setTimeout(e.waitMs)})},t)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};qt.contextType=Gt;function jC(n){let t=ke(n),e=qe(t,1);return{start:t,end:e}}var Ga=class{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(t){this.currentDataManager.dispatch(t)}get view(){return this.getCurrentData().viewApi}batchRendering(t){t()}updateSize(){this.trigger("_resize",!0)}setOption(t,e){this.dispatch({type:"SET_OPTION",optionName:t,rawOptionValue:e})}getOption(t){return this.currentDataManager.currentCalendarOptionsInput[t]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(t,e){let{currentDataManager:r}=this;r.currentCalendarOptionsRefiners[t]?r.emitter.on(t,e):console.warn(`Unknown listener name '${t}'`)}off(t,e){this.currentDataManager.emitter.off(t,e)}trigger(t,...e){this.currentDataManager.emitter.trigger(t,...e)}changeView(t,e){this.batchRendering(()=>{if(this.unselect(),e)if(e.start&&e.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:t}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:e});else{let{dateEnv:r}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:t,dateMarker:r.createMarker(e)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:t})})}zoomTo(t,e){let r=this.getCurrentData(),i;e=e||"day",i=r.viewSpecs[e]||this.getUnitViewSpec(e),this.unselect(),i?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:i.type,dateMarker:t}):this.dispatch({type:"CHANGE_DATE",dateMarker:t})}getUnitViewSpec(t){let{viewSpecs:e,toolbarConfig:r}=this.getCurrentData(),i=[].concat(r.header?r.header.viewsWithButtons:[],r.footer?r.footer.viewsWithButtons:[]),s,a;for(let o in e)i.push(o);for(s=0;s<i.length;s+=1)if(a=e[i[s]],a&&a.singleUnit===t)return a;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.addYears(t.currentDate,-1)})}nextYear(){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.addYears(t.currentDate,1)})}today(){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.nowManager.getDateMarker()})}gotoDate(t){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.createMarker(t)})}incrementDate(t){let e=this.getCurrentData(),r=J(t);r&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.add(e.currentDate,r)}))}getDate(){let t=this.getCurrentData();return t.dateEnv.toDate(t.currentDate)}formatDate(t,e){let{dateEnv:r}=this.getCurrentData();return r.format(r.createMarker(t),be(e))}formatRange(t,e,r){let{dateEnv:i}=this.getCurrentData();return i.formatRange(i.createMarker(t),i.createMarker(e),be(r),r)}formatIso(t,e){let{dateEnv:r}=this.getCurrentData();return r.formatIso(r.createMarker(t),{omitTime:e})}select(t,e){let r;e==null?t.start!=null?r=t:r={start:t,end:null}:r={start:t,end:e};let i=this.getCurrentData(),s=BC(r,i.dateEnv,J({days:1}));s&&(this.dispatch({type:"SELECT_DATES",selection:s}),Vc(s,null,i))}unselect(t){let e=this.getCurrentData();e.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),MC(t,e))}addEvent(t,e){if(t instanceof De){let a=t._def,o=t._instance;return this.getCurrentData().eventStore.defs[a.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:Rn({def:a,instance:o})}),this.triggerEventAdd(t)),t}let r=this.getCurrentData(),i;if(e instanceof Ai)i=e.internalEventSource;else if(typeof e=="boolean")e&&([i]=Bc(r.eventSources));else if(e!=null){let a=this.getEventSourceById(e);if(!a)return console.warn(`Could not find an event source with ID "${e}"`),null;i=a.internalEventSource}let s=iw(t,i,r,!1);if(s){let a=new De(r,s.def,s.def.recurringDef?null:s.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:Rn(s)}),this.triggerEventAdd(a),a}return null}triggerEventAdd(t){let{emitter:e}=this.getCurrentData();e.trigger("eventAdd",{event:t,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:ow(t)})}})}getEventById(t){let e=this.getCurrentData(),{defs:r,instances:i}=e.eventStore;t=String(t);for(let s in r){let a=r[s];if(a.publicId===t){if(a.recurringDef)return new De(e,a,null);for(let o in i){let l=i[o];if(l.defId===a.defId)return new De(e,a,l)}}}return null}getEvents(){let t=this.getCurrentData();return xr(t.eventStore,t)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let t=this.getCurrentData(),e=t.eventSources,r=[];for(let i in e)r.push(new Ai(t,e[i]));return r}getEventSourceById(t){let e=this.getCurrentData(),r=e.eventSources;t=String(t);for(let i in r)if(r[i].publicId===t)return new Ai(e,r[i]);return null}addEventSource(t){let e=this.getCurrentData();if(t instanceof Ai)return e.eventSources[t.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[t.internalEventSource]}),t;let r=lf(t,e);return r?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[r]}),new Ai(e,r)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(t){let e=J(t);e&&this.trigger("_scrollRequest",{time:e})}};function wf(n,t){return n.left>=t.left&&n.left<t.right&&n.top>=t.top&&n.top<t.bottom}function $c(n,t){let e={left:Math.max(n.left,t.left),right:Math.min(n.right,t.right),top:Math.max(n.top,t.top),bottom:Math.min(n.bottom,t.bottom)};return e.left<e.right&&e.top<e.bottom?e:!1}function bf(n,t){return{left:Math.min(Math.max(n.left,t.left),t.right),top:Math.min(Math.max(n.top,t.top),t.bottom)}}function Tf(n){return{left:(n.left+n.right)/2,top:(n.top+n.bottom)/2}}function Ef(n,t){return{left:n.left-t.left,top:n.top-t.top}}var Th=Ge(),Qa=class{constructor(){this.getKeysForEventDefs=$(this._getKeysForEventDefs),this.splitDateSelection=$(this._splitDateSpan),this.splitEventStore=$(this._splitEventStore),this.splitIndividualUi=$(this._splitIndividualUi),this.splitEventDrag=$(this._splitInteraction),this.splitEventResize=$(this._splitInteraction),this.eventUiBuilders={}}splitProps(t){let e=this.getKeyInfo(t),r=this.getKeysForEventDefs(t.eventStore),i=this.splitDateSelection(t.dateSelection),s=this.splitIndividualUi(t.eventUiBases,r),a=this.splitEventStore(t.eventStore,r),o=this.splitEventDrag(t.eventDrag),l=this.splitEventResize(t.eventResize),c={};this.eventUiBuilders=zt(e,(d,u)=>this.eventUiBuilders[u]||$($C));for(let d in e){let u=e[d],h=a[d]||Th,f=this.eventUiBuilders[d];c[d]={businessHours:u.businessHours||t.businessHours,dateSelection:i[d]||null,eventStore:h,eventUiBases:f(t.eventUiBases[""],u.ui,s[d]),eventSelection:h.instances[t.eventSelection]?t.eventSelection:"",eventDrag:o[d]||null,eventResize:l[d]||null}}return c}_splitDateSpan(t){let e={};if(t){let r=this.getKeysForDateSpan(t);for(let i of r)e[i]=t}return e}_getKeysForEventDefs(t){return zt(t.defs,e=>this.getKeysForEventDef(e))}_splitEventStore(t,e){let{defs:r,instances:i}=t,s={};for(let a in r)for(let o of e[a])s[o]||(s[o]=Ge()),s[o].defs[a]=r[a];for(let a in i){let o=i[a];for(let l of e[o.defId])s[l]&&(s[l].instances[a]=o)}return s}_splitIndividualUi(t,e){let r={};for(let i in t)if(i)for(let s of e[i])r[s]||(r[s]={}),r[s][i]=t[i];return r}_splitInteraction(t){let e={};if(t){let r=this._splitEventStore(t.affectedEvents,this._getKeysForEventDefs(t.affectedEvents)),i=this._getKeysForEventDefs(t.mutatedEvents),s=this._splitEventStore(t.mutatedEvents,i),a=o=>{e[o]||(e[o]={affectedEvents:r[o]||Th,mutatedEvents:s[o]||Th,isEvent:t.isEvent})};for(let o in r)a(o);for(let o in s)a(o)}return e}};function $C(n,t,e){let r=[];n&&r.push(n),t&&r.push(t);let i={"":of(r)};return e&&Object.assign(i,e),i}function kf(n,t,e,r){return{dow:n.getUTCDay(),isDisabled:Boolean(r&&(!r.activeRange||!$t(r.activeRange,n))),isOther:Boolean(r&&!$t(r.currentRange,n)),isToday:Boolean(t&&$t(t,n)),isPast:Boolean(e?n<e:t?n<t.start:!1),isFuture:Boolean(e?n>e:t?n>=t.end:!1)}}function zc(n,t){let e=["fc-day",`fc-day-${xS[n.dow]}`];return n.isDisabled?e.push("fc-day-disabled"):(n.isToday&&(e.push("fc-day-today"),e.push(t.getClass("today"))),n.isPast&&e.push("fc-day-past"),n.isFuture&&e.push("fc-day-future"),n.isOther&&e.push("fc-day-other")),e}var zC=be({year:"numeric",month:"long",day:"numeric"}),qC=be({week:"long"});function qn(n,t,e="day",r=!0){let{dateEnv:i,options:s,calendarApi:a}=n,o=i.format(t,e==="week"?qC:zC);if(s.navLinks){let l=i.toDate(t),c=d=>{let u=e==="day"?s.navLinkDayClick:e==="week"?s.navLinkWeekClick:null;typeof u=="function"?u.call(a,i.toDate(t),d):(typeof u=="string"&&(e=u),a.zoomTo(t,e))};return Object.assign({title:_s(s.navLinkHint,[o,l],o),"data-navlink":""},r?Yv(c):{onClick:c})}return{"aria-label":o}}var Eh=null;function uw(){return Eh===null&&(Eh=GC()),Eh}function GC(){let n=document.createElement("div");$n(n,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),n.innerHTML="<div></div>",document.body.appendChild(n);let e=n.firstChild.getBoundingClientRect().left>n.getBoundingClientRect().left;return to(n),e}var kh;function hw(){return kh||(kh=QC()),kh}function QC(){let n=document.createElement("div");n.style.overflow="scroll",n.style.position="absolute",n.style.top="-9999px",n.style.left="-9999px",document.body.appendChild(n);let t=fw(n);return document.body.removeChild(n),t}function fw(n){return{x:n.offsetHeight-n.clientHeight,y:n.offsetWidth-n.clientWidth}}function pw(n,t=!1){let e=window.getComputedStyle(n),r=parseInt(e.borderLeftWidth,10)||0,i=parseInt(e.borderRightWidth,10)||0,s=parseInt(e.borderTopWidth,10)||0,a=parseInt(e.borderBottomWidth,10)||0,o=fw(n),l=o.y-r-i,c=o.x-s-a,d={borderLeft:r,borderRight:i,borderTop:s,borderBottom:a,scrollbarBottom:c,scrollbarLeft:0,scrollbarRight:0};return uw()&&e.direction==="rtl"?d.scrollbarLeft=l:d.scrollbarRight=l,t&&(d.paddingLeft=parseInt(e.paddingLeft,10)||0,d.paddingRight=parseInt(e.paddingRight,10)||0,d.paddingTop=parseInt(e.paddingTop,10)||0,d.paddingBottom=parseInt(e.paddingBottom,10)||0),d}function Df(n,t=!1,e){let r=e?n.getBoundingClientRect():po(n),i=pw(n,t),s={left:r.left+i.borderLeft+i.scrollbarLeft,right:r.right-i.borderRight-i.scrollbarRight,top:r.top+i.borderTop,bottom:r.bottom-i.borderBottom-i.scrollbarBottom};return t&&(s.left+=i.paddingLeft,s.right-=i.paddingRight,s.top+=i.paddingTop,s.bottom-=i.paddingBottom),s}function po(n){let t=n.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY,right:t.right+window.scrollX,bottom:t.bottom+window.scrollY}}function KC(n){let t=qc(n),e=n.getBoundingClientRect();for(let r of t){let i=$c(e,r.getBoundingClientRect());if(i)e=i;else return null}return e}function qc(n){let t=[];for(;n instanceof HTMLElement;){let e=window.getComputedStyle(n);if(e.position==="fixed")break;/(auto|scroll)/.test(e.overflow+e.overflowY+e.overflowX)&&t.push(n),n=n.parentNode}return t}var or=class{constructor(t,e,r,i){this.els=e;let s=this.originClientRect=t.getBoundingClientRect();r&&this.buildElHorizontals(s.left),i&&this.buildElVerticals(s.top)}buildElHorizontals(t){let e=[],r=[];for(let i of this.els){let s=i.getBoundingClientRect();e.push(s.left-t),r.push(s.right-t)}this.lefts=e,this.rights=r}buildElVerticals(t){let e=[],r=[];for(let i of this.els){let s=i.getBoundingClientRect();e.push(s.top-t),r.push(s.bottom-t)}this.tops=e,this.bottoms=r}leftToIndex(t){let{lefts:e,rights:r}=this,i=e.length,s;for(s=0;s<i;s+=1)if(t>=e[s]&&t<r[s])return s}topToIndex(t){let{tops:e,bottoms:r}=this,i=e.length,s;for(s=0;s<i;s+=1)if(t>=e[s]&&t<r[s])return s}getWidth(t){return this.rights[t]-this.lefts[t]}getHeight(t){return this.bottoms[t]-this.tops[t]}similarTo(t){return gc(this.tops||[],t.tops||[])&&gc(this.bottoms||[],t.bottoms||[])&&gc(this.lefts||[],t.lefts||[])&&gc(this.rights||[],t.rights||[])}};function gc(n,t){let e=n.length;if(e!==t.length)return!1;for(let r=0;r<e;r++)if(Math.round(n[r])!==Math.round(t[r]))return!1;return!0}var Ln=class{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}},Ka=class extends Ln{constructor(t){super(),this.el=t}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(t){this.el.scrollTop=t}setScrollLeft(t){this.el.scrollLeft=t}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}},Za=class extends Ln{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(t){window.scroll(window.scrollX,t)}setScrollLeft(t){window.scroll(t,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}},et=class extends ue{constructor(){super(...arguments),this.uid=ni()}prepareHits(){}queryHit(t,e,r,i){return null}isValidSegDownEl(t){return!this.props.eventDrag&&!this.props.eventResize&&!ze(t,".fc-event-mirror")}isValidDateDownEl(t){return!ze(t,".fc-event:not(.fc-bg-event)")&&!ze(t,".fc-more-link")&&!ze(t,"a[data-navlink]")&&!ze(t,".fc-popover")}};var Fn=class{constructor(t=e=>e.thickness||1){this.getEntryThickness=t,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(t){let e=[];for(let r of t)this.insertEntry(r,e);return e}insertEntry(t,e){let r=this.findInsertion(t);this.isInsertionValid(r,t)?this.insertEntryAt(t,r):this.handleInvalidInsertion(r,t,e)}isInsertionValid(t,e){return(this.maxCoord===-1||t.levelCoord+this.getEntryThickness(e)<=this.maxCoord)&&(this.maxStackCnt===-1||t.stackCnt<this.maxStackCnt)}handleInvalidInsertion(t,e,r){if(this.allowReslicing&&t.touchingEntry){let i=Object.assign(Object.assign({},e),{span:mo(e.span,t.touchingEntry.span)});r.push(i),this.splitEntry(e,t.touchingEntry,r)}else r.push(e)}splitEntry(t,e,r){let i=t.span,s=e.span;i.start<s.start&&this.insertEntry({index:t.index,thickness:t.thickness,span:{start:i.start,end:s.start}},r),i.end>s.end&&this.insertEntry({index:t.index,thickness:t.thickness,span:{start:s.end,end:i.end}},r)}insertEntryAt(t,e){let{entriesByLevel:r,levelCoords:i}=this;e.lateral===-1?(Dh(i,e.level,e.levelCoord),Dh(r,e.level,[t])):Dh(r[e.level],e.lateral,t),this.stackCnts[Dr(t)]=e.stackCnt}findInsertion(t){let{levelCoords:e,entriesByLevel:r,strictOrder:i,stackCnts:s}=this,a=e.length,o=0,l=-1,c=-1,d=null,u=0;for(let p=0;p<a;p+=1){let m=e[p];if(!i&&m>=o+this.getEntryThickness(t))break;let g=r[p],v,T=Xa(g,t.span.start,Ja),k=T[0]+T[1];for(;(v=g[k])&&v.span.start<t.span.end;){let D=m+this.getEntryThickness(v);D>o&&(o=D,d=v,l=p,c=k),D===o&&(u=Math.max(u,s[Dr(v)]+1)),k+=1}}let h=0;if(d)for(h=l+1;h<a&&e[h]<o;)h+=1;let f=-1;return h<a&&e[h]===o&&(f=Xa(r[h],t.span.end,Ja)[0]),{touchingLevel:l,touchingLateral:c,touchingEntry:d,stackCnt:u,levelCoord:o,level:h,lateral:f}}toRects(){let{entriesByLevel:t,levelCoords:e}=this,r=t.length,i=[];for(let s=0;s<r;s+=1){let a=t[s],o=e[s];for(let l of a)i.push(Object.assign(Object.assign({},l),{thickness:this.getEntryThickness(l),levelCoord:o}))}return i}};function Ja(n){return n.span.end}function Dr(n){return n.index+":"+n.span.start}function Sf(n){let t=[];for(let e of n){let r=[],i={span:e.span,entries:[e]};for(let s of t)mo(s.span,i.span)?i={entries:s.entries.concat(i.entries),span:ZC(s.span,i.span)}:r.push(s);r.push(i),t=r}return t}function ZC(n,t){return{start:Math.min(n.start,t.start),end:Math.max(n.end,t.end)}}function mo(n,t){let e=Math.max(n.start,t.start),r=Math.min(n.end,t.end);return e<r?{start:e,end:r}:null}function Dh(n,t,e){n.splice(t,0,e)}function Xa(n,t,e){let r=0,i=n.length;if(!i||t<e(n[r]))return[0,0];if(t>e(n[i-1]))return[i,0];for(;r<i;){let s=Math.floor(r+(i-r)/2),a=e(n[s]);if(t<a)i=s;else if(t>a)r=s+1;else return[s,1]}return[r,0]}var eo=class{constructor(t,e){this.emitter=new ti}destroy(){}setMirrorIsVisible(t){}setMirrorNeedsRevert(t){}setAutoScrollEnabled(t){}},Os={},JC={startTime:J,duration:J,create:Boolean,sourceId:String};function go(n){let{refined:t,extra:e}=ao(n,JC);return{startTime:t.startTime||null,duration:t.duration||null,create:t.create!=null?t.create:!0,sourceId:t.sourceId,leftoverProps:e}}function mw(n,t){return!n||t>10?be({weekday:"short"}):t>1?be({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):be({weekday:"long"})}var gw="fc-col-header-cell";function yw(n){return n.text}var Mc=class extends ue{render(){let{dateEnv:t,options:e,theme:r,viewApi:i}=this.context,{props:s}=this,{date:a,dateProfile:o}=s,l=kf(a,s.todayRange,null,o),c=[gw].concat(zc(l,r)),d=t.format(a,s.dayHeaderFormat),u=!l.isDisabled&&s.colCnt>1?qn(this.context,a):{},h=t.toDate(a);t.namedTimeZoneImpl&&(h=Er(h,36e5));let f=Object.assign(Object.assign(Object.assign({date:h,view:i},s.extraRenderProps),{text:d}),l);return b(Xe,{elTag:"th",elClasses:c,elAttrs:Object.assign({role:"columnheader",colSpan:s.colSpan,"data-date":l.isDisabled?void 0:so(a)},s.extraDataAttrs),renderProps:f,generatorName:"dayHeaderContent",customGenerator:e.dayHeaderContent,defaultGenerator:yw,classNameGenerator:e.dayHeaderClassNames,didMount:e.dayHeaderDidMount,willUnmount:e.dayHeaderWillUnmount},p=>b("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&b(p,{elTag:"a",elAttrs:u,elClasses:["fc-col-header-cell-cushion",s.isSticky&&"fc-sticky"]})))}},XC=be({weekday:"long"}),Ac=class extends ue{render(){let{props:t}=this,{dateEnv:e,theme:r,viewApi:i,options:s}=this.context,a=qe(new Date(2592e5),t.dow),o={dow:t.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=e.format(a,t.dayHeaderFormat),c=Object.assign(Object.assign(Object.assign(Object.assign({date:a},o),{view:i}),t.extraRenderProps),{text:l});return b(Xe,{elTag:"th",elClasses:[gw,...zc(o,r),...t.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:t.colSpan},t.extraDataAttrs),renderProps:c,generatorName:"dayHeaderContent",customGenerator:s.dayHeaderContent,defaultGenerator:yw,classNameGenerator:s.dayHeaderClassNames,didMount:s.dayHeaderDidMount,willUnmount:s.dayHeaderWillUnmount},d=>b("div",{className:"fc-scrollgrid-sync-inner"},b(d,{elTag:"a",elClasses:["fc-col-header-cell-cushion",t.isSticky&&"fc-sticky"],elAttrs:{"aria-label":e.format(a,XC)}})))}},ri=class extends ue{constructor(){super(...arguments),this.createDayHeaderFormatter=$(ex)}render(){let{context:t}=this,{dates:e,dateProfile:r,datesRepDistinctDays:i,renderIntro:s}=this.props,a=this.createDayHeaderFormatter(t.options.dayHeaderFormat,i,e.length);return b(qt,{unit:"day"},(o,l)=>b("tr",{role:"row"},s&&s("day"),e.map(c=>i?b(Mc,{key:c.toISOString(),date:c,dateProfile:r,todayRange:l,colCnt:e.length,dayHeaderFormat:a}):b(Ac,{key:c.getUTCDay(),dow:c.getUTCDay(),dayHeaderFormat:a}))))}};function ex(n,t,e){return n||mw(t,e)}var Bn=class{constructor(t,e){let r=t.start,{end:i}=t,s=[],a=[],o=-1;for(;r<i;)e.isHiddenDay(r)?s.push(o+.5):(o+=1,s.push(o),a.push(r)),r=qe(r,1);this.dates=a,this.indices=s,this.cnt=a.length}sliceRange(t){let e=this.getDateDayIndex(t.start),r=this.getDateDayIndex(qe(t.end,-1)),i=Math.max(0,e),s=Math.min(this.cnt-1,r);return i=Math.ceil(i),s=Math.floor(s),i<=s?{firstIndex:i,lastIndex:s,isStart:e===i,isEnd:r===s}:null}getDateDayIndex(t){let{indices:e}=this,r=Math.floor(si(this.dates[0],t));return r<0?e[0]-1:r>=e.length?e[e.length-1]+1:e[r]}},Hn=class{constructor(t,e){let{dates:r}=t,i,s,a;if(e){for(s=r[0].getUTCDay(),i=1;i<r.length&&r[i].getUTCDay()!==s;i+=1);a=Math.ceil(r.length/i)}else a=1,i=r.length;this.rowCnt=a,this.colCnt=i,this.daySeries=t,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let t=[];for(let e=0;e<this.rowCnt;e+=1){let r=[];for(let i=0;i<this.colCnt;i+=1)r.push(this.buildCell(e,i));t.push(r)}return t}buildCell(t,e){let r=this.daySeries.dates[t*this.colCnt+e];return{key:r.toISOString(),date:r}}buildHeaderDates(){let t=[];for(let e=0;e<this.colCnt;e+=1)t.push(this.cells[0][e].date);return t}sliceRange(t){let{colCnt:e}=this,r=this.daySeries.sliceRange(t),i=[];if(r){let{firstIndex:s,lastIndex:a}=r,o=s;for(;o<=a;){let l=Math.floor(o/e),c=Math.min((l+1)*e,a+1);i.push({row:l,firstCol:o%e,lastCol:(c-1)%e,isStart:r.isStart&&o===s,isEnd:r.isEnd&&c-1===a}),o=c}}return i}},Yn=class{constructor(){this.sliceBusinessHours=$(this._sliceBusinessHours),this.sliceDateSelection=$(this._sliceDateSpan),this.sliceEventStore=$(this._sliceEventStore),this.sliceEventDrag=$(this._sliceInteraction),this.sliceEventResize=$(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(t,e,r,i,...s){let{eventUiBases:a}=t,o=this.sliceEventStore(t.eventStore,a,e,r,...s);return{dateSelectionSegs:this.sliceDateSelection(t.dateSelection,e,r,a,i,...s),businessHourSegs:this.sliceBusinessHours(t.businessHours,e,r,i,...s),fgEventSegs:o.fg,bgEventSegs:o.bg,eventDrag:this.sliceEventDrag(t.eventDrag,a,e,r,...s),eventResize:this.sliceEventResize(t.eventResize,a,e,r,...s),eventSelection:t.eventSelection}}sliceNowDate(t,e,r,i,...s){return this._sliceDateSpan({range:{start:t,end:Er(t,1)},allDay:!1},e,r,{},i,...s)}_sliceBusinessHours(t,e,r,i,...s){return t?this._sliceEventStore(On(t,yc(e,Boolean(r)),i),{},e,r,...s).bg:[]}_sliceEventStore(t,e,r,i,...s){if(t){let a=Cc(t,e,yc(r,Boolean(i)),i);return{bg:this.sliceEventRanges(a.bg,s),fg:this.sliceEventRanges(a.fg,s)}}return{bg:[],fg:[]}}_sliceInteraction(t,e,r,i,...s){if(!t)return null;let a=Cc(t.mutatedEvents,e,yc(r,Boolean(i)),i);return{segs:this.sliceEventRanges(a.fg,s),affectedInstances:t.affectedEvents.instances,isEvent:t.isEvent}}_sliceDateSpan(t,e,r,i,s,...a){if(!t)return[];let o=yc(e,Boolean(r)),l=Lt(t.range,o);if(l){t=Object.assign(Object.assign({},t),{range:l});let c=VC(t,i,s),d=this.sliceRange(t.range,...a);for(let u of d)u.eventRange=c;return d}return[]}sliceEventRanges(t,e){let r=[];for(let i of t)r.push(...this.sliceEventRange(i,e));return r}sliceEventRange(t,e){let r=t.range;this.forceDayIfListItem&&t.ui.display==="list-item"&&(r={start:r.start,end:qe(r.start,1)});let i=this.sliceRange(r,...e);for(let s of i)s.eventRange=t,s.isStart=t.isStart&&s.isStart,s.isEnd=t.isEnd&&s.isEnd;return i}};function yc(n,t){let e=n.activeRange;return t?e:{start:Er(e.start,n.slotMinTime.milliseconds),end:Er(e.end,n.slotMaxTime.milliseconds-864e5)}}function yo(n,t,e){let{instances:r}=n.mutatedEvents;for(let i in r)if(!Is(t.validRange,r[i].range))return!1;return vw({eventDrag:n},e)}function Cf(n,t,e){return Is(t.validRange,n.range)?vw({dateSelection:n},e):!1}function vw(n,t){let e=t.getCurrentData(),r=Object.assign({businessHours:e.businessHours,dateSelection:"",eventStore:e.eventStore,eventUiBases:e.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},n);return(t.pluginHooks.isPropsValid||ww)(r,t)}function ww(n,t,e={},r){return!(n.eventDrag&&!tx(n,t,e,r)||n.dateSelection&&!rx(n,t,e,r))}function tx(n,t,e,r){let i=t.getCurrentData(),s=n.eventDrag,a=s.mutatedEvents,o=a.defs,l=a.instances,c=xc(o,s.isEvent?n.eventUiBases:{"":i.selectionConfig});r&&(c=zt(c,r));let d=kC(n.eventStore,s.affectedEvents.instances),u=d.defs,h=d.instances,f=xc(u,n.eventUiBases);for(let p in l){let m=l[p],g=m.range,v=c[m.defId],T=o[m.defId];if(!bw(v.constraints,g,d,n.businessHours,t))return!1;let{eventOverlap:k}=t.options,D=typeof k=="function"?k:null;for(let E in h){let C=h[E];if(Hc(g,C.range)&&(f[C.defId].overlap===!1&&s.isEvent||v.overlap===!1||D&&!D(new De(t,u[C.defId],C),new De(t,T,m))))return!1}let M=i.eventStore;for(let E of v.allows){let C=Object.assign(Object.assign({},e),{range:m.range,allDay:T.allDay}),S=M.defs[T.defId],O=M.instances[p],F;if(S?F=new De(t,S,O):F=new De(t,T),!E(hf(C,t),F))return!1}}return!0}function rx(n,t,e,r){let i=n.eventStore,s=i.defs,a=i.instances,o=n.dateSelection,l=o.range,{selectionConfig:c}=t.getCurrentData();if(r&&(c=r(c)),!bw(c.constraints,l,i,n.businessHours,t))return!1;let{selectOverlap:d}=t.options,u=typeof d=="function"?d:null;for(let h in a){let f=a[h];if(Hc(l,f.range)&&(c.overlap===!1||u&&!u(new De(t,s[f.defId],f),null)))return!1}for(let h of c.allows){let f=Object.assign(Object.assign({},e),o);if(!h(hf(f,t),null))return!1}return!0}function bw(n,t,e,r,i){for(let s of n)if(!nx(ix(s,t,e,r,i),t))return!1;return!0}function ix(n,t,e,r,i){return n==="businessHours"?Sh(On(r,t,i)):typeof n=="string"?Sh(Uc(e,s=>s.groupId===n)):typeof n=="object"&&n?Sh(On(n,t,i)):[]}function Sh(n){let{instances:t}=n,e=[];for(let r in t)e.push(t[r].range);return e}function nx(n,t){for(let e of n)if(Is(e,t))return!0;return!1}var vc=/^(visible|hidden)$/,Ic=class extends ue{constructor(){super(...arguments),this.handleEl=t=>{this.el=t,Qt(this.props.elRef,t)}}render(){let{props:t}=this,{liquid:e,liquidIsAbsolute:r}=t,i=e&&r,s=["fc-scroller"];return e&&(r?s.push("fc-scroller-liquid-absolute"):s.push("fc-scroller-liquid")),b("div",{ref:this.handleEl,className:s.join(" "),style:{overflowX:t.overflowX,overflowY:t.overflowY,left:i&&-(t.overcomeLeft||0)||"",right:i&&-(t.overcomeRight||0)||"",bottom:i&&-(t.overcomeBottom||0)||"",marginLeft:!i&&-(t.overcomeLeft||0)||"",marginRight:!i&&-(t.overcomeRight||0)||"",marginBottom:!i&&-(t.overcomeBottom||0)||"",maxHeight:t.maxHeight||""}},t.children)}needsXScrolling(){if(vc.test(this.props.overflowX))return!1;let{el:t}=this,e=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:r}=t;for(let i=0;i<r.length;i+=1)if(r[i].getBoundingClientRect().width>e)return!0;return!1}needsYScrolling(){if(vc.test(this.props.overflowY))return!1;let{el:t}=this,e=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:r}=t;for(let i=0;i<r.length;i+=1)if(r[i].getBoundingClientRect().height>e)return!0;return!1}getXScrollbarWidth(){return vc.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return vc.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}},Ct=class{constructor(t){this.masterCallback=t,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(e,r)=>{let{depths:i,currentMap:s}=this,a=!1,o=!1;e!==null?(a=r in s,s[r]=e,i[r]=(i[r]||0)+1,o=!0):(i[r]-=1,i[r]||(delete s[r],delete this.callbackMap[r],a=!0)),this.masterCallback&&(a&&this.masterCallback(null,String(r)),o&&this.masterCallback(e,String(r)))}}createRef(t){let e=this.callbackMap[t];return e||(e=this.callbackMap[t]=r=>{this.handleValue(r,String(t))}),e}collect(t,e,r){return Qv(this.currentMap,t,e,r)}getAll(){return Bc(this.currentMap)}};function Tw(n){let t=Bv(n,".fc-scrollgrid-shrink"),e=0;for(let r of t)e=Math.max(e,TS(r));return Math.ceil(e)}function xf(n,t){return n.liquid&&t.liquid}function Ew(n,t){return t.maxHeight!=null||xf(n,t)}function kw(n,t,e,r){let{expandRows:i}=e;return typeof t.content=="function"?t.content(e):b("table",{role:"presentation",className:[t.tableClassName,n.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:i?e.clientHeight:""}},e.tableColGroupNode,b(r?"thead":"tbody",{role:"presentation"},typeof t.rowContent=="function"?t.rowContent(e):t.rowContent))}function Dw(n,t){return Sr(n,t,wt)}function Sw(n,t){let e=[];for(let r of n){let i=r.span||1;for(let s=0;s<i;s+=1)e.push(b("col",{style:{width:r.width==="shrink"?Cw(t):r.width||"",minWidth:r.minWidth||""}}))}return b("colgroup",{},...e)}function Cw(n){return n==null?4:n}function xw(n){for(let t of n)if(t.width==="shrink")return!0;return!1}function _w(n,t){let e=["fc-scrollgrid",t.theme.getClass("table")];return n&&e.push("fc-scrollgrid-liquid"),e}function Mw(n,t){let e=["fc-scrollgrid-section",`fc-scrollgrid-section-${n.type}`,n.className];return t&&n.liquid&&n.maxHeight==null&&e.push("fc-scrollgrid-section-liquid"),n.isSticky&&e.push("fc-scrollgrid-section-sticky"),e}function Rs(n){return b("div",{className:"fc-scrollgrid-sticky-shim",style:{width:n.clientWidth,minWidth:n.tableMinWidth}})}function Gn(n){let{stickyHeaderDates:t}=n;return(t==null||t==="auto")&&(t=n.height==="auto"||n.viewHeight==="auto"),t}function vo(n){let{stickyFooterScrollbar:t}=n;return(t==null||t==="auto")&&(t=n.height==="auto"||n.viewHeight==="auto"),t}var Oi=class extends ue{constructor(){super(...arguments),this.processCols=$(t=>t,Dw),this.renderMicroColGroup=$(Sw),this.scrollerRefs=new Ct,this.scrollerElRefs=new Ct(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:t,state:e,context:r}=this,i=t.sections||[],s=this.processCols(t.cols),a=this.renderMicroColGroup(s,e.shrinkWidth),o=_w(t.liquid,r);t.collapsibleWidth&&o.push("fc-scrollgrid-collapsible");let l=i.length,c=0,d,u=[],h=[],f=[];for(;c<l&&(d=i[c]).type==="header";)u.push(this.renderSection(d,a,!0)),c+=1;for(;c<l&&(d=i[c]).type==="body";)h.push(this.renderSection(d,a,!1)),c+=1;for(;c<l&&(d=i[c]).type==="footer";)f.push(this.renderSection(d,a,!0)),c+=1;let p=!vf(),m={role:"rowgroup"};return b("table",{role:"grid",className:o.join(" "),style:{height:t.height}},Boolean(!p&&u.length)&&b("thead",m,...u),Boolean(!p&&h.length)&&b("tbody",m,...h),Boolean(!p&&f.length)&&b("tfoot",m,...f),p&&b("tbody",m,...u,...h,...f))}renderSection(t,e,r){return"outerContent"in t?b(ve,{key:t.key},t.outerContent):b("tr",{key:t.key,role:"presentation",className:Mw(t,this.props.liquid).join(" ")},this.renderChunkTd(t,e,t.chunk,r))}renderChunkTd(t,e,r,i){if("outerContent"in r)return r.outerContent;let{props:s}=this,{forceYScrollbars:a,scrollerClientWidths:o,scrollerClientHeights:l}=this.state,c=Ew(s,t),d=xf(s,t),u=s.liquid?a?"scroll":c?"auto":"hidden":"visible",h=t.key,f=kw(t,r,{tableColGroupNode:e,tableMinWidth:"",clientWidth:!s.collapsibleWidth&&o[h]!==void 0?o[h]:null,clientHeight:l[h]!==void 0?l[h]:null,expandRows:t.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},i);return b(i?"th":"td",{ref:r.elRef,role:"presentation"},b("div",{className:`fc-scroller-harness${d?" fc-scroller-harness-liquid":""}`},b(Ic,{ref:this.scrollerRefs.createRef(h),elRef:this.scrollerElRefs.createRef(h),overflowY:u,overflowX:s.liquid?"hidden":"visible",maxHeight:t.maxHeight,liquid:d,liquidIsAbsolute:!0},f)))}_handleScrollerEl(t,e){let r=sx(this.props.sections,e);r&&Qt(r.chunk.scrollerElRef,t)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return xw(this.props.cols)?Tw(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let t=hw(),{scrollerRefs:e,scrollerElRefs:r}=this,i=!1,s={},a={};for(let o in e.currentMap){let l=e.currentMap[o];if(l&&l.needsYScrolling()){i=!0;break}}for(let o of this.props.sections){let l=o.key,c=r.currentMap[l];if(c){let d=c.parentNode;s[l]=Math.floor(d.getBoundingClientRect().width-(i?t.y:0)),a[l]=Math.floor(d.getBoundingClientRect().height)}}return{forceYScrollbars:i,scrollerClientWidths:s,scrollerClientHeights:a}}};Oi.addStateEquality({scrollerClientWidths:wt,scrollerClientHeights:wt});function sx(n,t){for(let e of n)if(e.key===t)return e;return null}var Un=class extends ue{constructor(){super(...arguments),this.handleEl=t=>{this.el=t,t&&Pv(t,this.props.seg)}}render(){let{props:t,context:e}=this,{options:r}=e,{seg:i}=t,{eventRange:s}=i,{ui:a}=s,o={event:new De(e,s.def,s.instance),view:e.viewApi,timeText:t.timeText,textColor:a.textColor,backgroundColor:a.backgroundColor,borderColor:a.borderColor,isDraggable:!t.disableDragging&&NC(i,e),isStartResizable:!t.disableResizing&&OC(i,e),isEndResizable:!t.disableResizing&&RC(i),isMirror:Boolean(t.isDragging||t.isResizing||t.isDateSelecting),isStart:Boolean(i.isStart),isEnd:Boolean(i.isEnd),isPast:Boolean(t.isPast),isFuture:Boolean(t.isFuture),isToday:Boolean(t.isToday),isSelected:Boolean(t.isSelected),isDragging:Boolean(t.isDragging),isResizing:Boolean(t.isResizing)};return b(Xe,Object.assign({},t,{elRef:this.handleEl,elClasses:[...LC(o),...i.eventRange.ui.classNames,...t.elClasses||[]],renderProps:o,generatorName:"eventContent",customGenerator:r.eventContent,defaultGenerator:t.defaultGenerator,classNameGenerator:r.eventClassNames,didMount:r.eventDidMount,willUnmount:r.eventWillUnmount}))}componentDidUpdate(t){this.el&&this.props.seg!==t.seg&&Pv(this.el,this.props.seg)}},Vn=class extends ue{render(){let{props:t,context:e}=this,{options:r}=e,{seg:i}=t,{ui:s}=i.eventRange,a=r.eventTimeFormat||t.defaultTimeFormat,o=Wc(i,a,e,t.defaultDisplayEventTime,t.defaultDisplayEventEnd);return b(Un,Object.assign({},t,{elTag:"a",elStyle:{borderColor:s.borderColor,backgroundColor:s.backgroundColor},elAttrs:jc(i,e),defaultGenerator:ax,timeText:o}),(l,c)=>b(ve,null,b(l,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:c.textColor}}),Boolean(c.isStartResizable)&&b("div",{className:"fc-event-resizer fc-event-resizer-start"}),Boolean(c.isEndResizable)&&b("div",{className:"fc-event-resizer fc-event-resizer-end"})))}};function ax(n){return b("div",{className:"fc-event-main-frame"},n.timeText&&b("div",{className:"fc-event-time"},n.timeText),b("div",{className:"fc-event-title-container"},b("div",{className:"fc-event-title fc-sticky"},n.event.title||b(ve,null,"\xA0"))))}var wo=n=>b(Gt.Consumer,null,t=>{let{options:e}=t,r={isAxis:n.isAxis,date:t.dateEnv.toDate(n.date),view:t.viewApi};return b(Xe,Object.assign({},n,{elTag:n.elTag||"div",renderProps:r,generatorName:"nowIndicatorContent",customGenerator:e.nowIndicatorContent,classNameGenerator:e.nowIndicatorClassNames,didMount:e.nowIndicatorDidMount,willUnmount:e.nowIndicatorWillUnmount}))}),ox=be({day:"numeric"}),Ri=class extends ue{constructor(){super(...arguments),this.refineRenderProps=As(lx)}render(){let{props:t,context:e}=this,{options:r}=e,i=this.refineRenderProps({date:t.date,dateProfile:t.dateProfile,todayRange:t.todayRange,isMonthStart:t.isMonthStart||!1,showDayNumber:t.showDayNumber,extraRenderProps:t.extraRenderProps,viewApi:e.viewApi,dateEnv:e.dateEnv,monthStartFormat:r.monthStartFormat});return b(Xe,Object.assign({},t,{elClasses:[...zc(i,e.theme),...t.elClasses||[]],elAttrs:Object.assign(Object.assign({},t.elAttrs),i.isDisabled?{}:{"data-date":so(t.date)}),renderProps:i,generatorName:"dayCellContent",customGenerator:r.dayCellContent,defaultGenerator:t.defaultGenerator,classNameGenerator:i.isDisabled?void 0:r.dayCellClassNames,didMount:r.dayCellDidMount,willUnmount:r.dayCellWillUnmount}))}};function Ls(n){return Boolean(n.dayCellContent||Oh("dayCellContent",n))}function lx(n){let{date:t,dateEnv:e,dateProfile:r,isMonthStart:i}=n,s=kf(t,n.todayRange,null,r),a=n.showDayNumber?e.format(t,i?n.monthStartFormat:ox):"";return Object.assign(Object.assign(Object.assign({date:e.toDate(t),view:n.viewApi},s),{isMonthStart:i,dayNumberText:a}),n.extraRenderProps)}var Wn=class extends ue{render(){let{props:t}=this,{seg:e}=t;return b(Un,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:e.eventRange.ui.backgroundColor},defaultGenerator:cx,seg:e,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:t.isPast,isFuture:t.isFuture,isToday:t.isToday,disableDragging:!0,disableResizing:!0})}};function cx(n){let{title:t}=n.event;return t&&b("div",{className:"fc-event-title"},n.event.title)}function bo(n){return b("div",{className:`fc-${n}`})}var To=n=>b(Gt.Consumer,null,t=>{let{dateEnv:e,options:r}=t,{date:i}=n,s=r.weekNumberFormat||n.defaultFormat,a=e.computeWeekNumber(i),o=e.format(i,s);return b(Xe,Object.assign({},n,{renderProps:{num:a,text:o,date:i},generatorName:"weekNumberContent",customGenerator:r.weekNumberContent,defaultGenerator:dx,classNameGenerator:r.weekNumberClassNames,didMount:r.weekNumberDidMount,willUnmount:r.weekNumberWillUnmount}))});function dx(n){return n.text}var Ch=10,Lh=class extends ue{constructor(){super(...arguments),this.state={titleId:ii()},this.handleRootEl=t=>{this.rootEl=t,this.props.elRef&&Qt(this.props.elRef,t)},this.handleDocumentMouseDown=t=>{let e=Nc(t);this.rootEl.contains(e)||this.handleCloseClick()},this.handleDocumentKeyDown=t=>{t.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:t}=this.props;t&&t()}}render(){let{theme:t,options:e}=this.context,{props:r,state:i}=this,s=["fc-popover",t.getClass("popover")].concat(r.extraClassNames||[]);return bv(b("div",Object.assign({},r.extraAttrs,{id:r.id,className:s.join(" "),"aria-labelledby":i.titleId,ref:this.handleRootEl}),b("div",{className:"fc-popover-header "+t.getClass("popoverHeader")},b("span",{className:"fc-popover-title",id:i.titleId},r.title),b("span",{className:"fc-popover-close "+t.getIconClass("close"),title:e.closeHint,onClick:this.handleCloseClick})),b("div",{className:"fc-popover-body "+t.getClass("popoverContent")},r.children)),r.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:t}=this.context,{alignmentEl:e,alignGridTop:r}=this.props,{rootEl:i}=this,s=KC(e);if(s){let a=i.getBoundingClientRect(),o=r?ze(e,".fc-scrollgrid").getBoundingClientRect().top:s.top,l=t?s.right-a.width:s.left;o=Math.max(o,Ch),l=Math.min(l,document.documentElement.clientWidth-Ch-a.width),l=Math.max(l,Ch);let c=i.offsetParent.getBoundingClientRect();$n(i,{top:o-c.top,left:l-c.left})}}},Fh=class extends et{constructor(){super(...arguments),this.handleRootEl=t=>{this.rootEl=t,t?this.context.registerInteractiveComponent(this,{el:t,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:t,dateEnv:e}=this.context,{props:r}=this,{startDate:i,todayRange:s,dateProfile:a}=r,o=e.format(i,t.dayPopoverFormat);return b(Ri,{elRef:this.handleRootEl,date:i,dateProfile:a,todayRange:s},(l,c,d)=>b(Lh,{elRef:d.ref,id:r.id,title:o,extraClassNames:["fc-more-popover"].concat(d.className||[]),extraAttrs:d,parentEl:r.parentEl,alignmentEl:r.alignmentEl,alignGridTop:r.alignGridTop,onClose:r.onClose},Ls(t)&&b(l,{elTag:"div",elClasses:["fc-more-popover-misc"]}),r.children))}queryHit(t,e,r,i){let{rootEl:s,props:a}=this;return t>=0&&t<r&&e>=0&&e<i?{dateProfile:a.dateProfile,dateSpan:Object.assign({allDay:!a.forceTimed,range:{start:a.startDate,end:a.endDate}},a.extraDateSpan),dayEl:s,rect:{left:0,top:0,right:r,bottom:i},layer:1}:null}},jn=class extends ue{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:ii()},this.handleLinkEl=t=>{this.linkEl=t,this.props.elRef&&Qt(this.props.elRef,t)},this.handleClick=t=>{let{props:e,context:r}=this,{moreLinkClick:i}=r.options,s=Nv(e).start;function a(o){let{def:l,instance:c,range:d}=o.eventRange;return{event:new De(r,l,c),start:r.dateEnv.toDate(d.start),end:r.dateEnv.toDate(d.end),isStart:o.isStart,isEnd:o.isEnd}}typeof i=="function"&&(i=i({date:s,allDay:Boolean(e.allDayDate),allSegs:e.allSegs.map(a),hiddenSegs:e.hiddenSegs.map(a),jsEvent:t,view:r.viewApi})),!i||i==="popover"?this.setState({isPopoverOpen:!0}):typeof i=="string"&&r.calendarApi.zoomTo(s,i)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:t,state:e}=this;return b(Gt.Consumer,null,r=>{let{viewApi:i,options:s,calendarApi:a}=r,{moreLinkText:o}=s,{moreCnt:l}=t,c=Nv(t),d=typeof o=="function"?o.call(a,l):`+${l} ${o}`,u=_s(s.moreLinkHint,[l],d),h={num:l,shortText:`+${l}`,text:d,view:i};return b(ve,null,Boolean(t.moreCnt)&&b(Xe,{elTag:t.elTag||"a",elRef:this.handleLinkEl,elClasses:[...t.elClasses||[],"fc-more-link"],elStyle:t.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},t.elAttrs),Yv(this.handleClick)),{title:u,"aria-expanded":e.isPopoverOpen,"aria-controls":e.isPopoverOpen?e.popoverId:""}),renderProps:h,generatorName:"moreLinkContent",customGenerator:s.moreLinkContent,defaultGenerator:t.defaultGenerator||ux,classNameGenerator:s.moreLinkClassNames,didMount:s.moreLinkDidMount,willUnmount:s.moreLinkWillUnmount},t.children),e.isPopoverOpen&&b(Fh,{id:e.popoverId,startDate:c.start,endDate:c.end,dateProfile:t.dateProfile,todayRange:t.todayRange,extraDateSpan:t.extraDateSpan,parentEl:this.parentEl,alignmentEl:t.alignmentElRef?t.alignmentElRef.current:this.linkEl,alignGridTop:t.alignGridTop,forceTimed:t.forceTimed,onClose:this.handlePopoverClose},t.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=ze(this.linkEl,".fc-view-harness"))}};function ux(n){return n.text}function Nv(n){if(n.allDayDate)return{start:n.allDayDate,end:qe(n.allDayDate,1)};let{hiddenSegs:t}=n;return{start:Gc(t),end:fx(t)}}function Gc(n){return n.reduce(hx).eventRange.range.start}function hx(n,t){return n.eventRange.range.start<t.eventRange.range.start?n:t}function fx(n){return n.reduce(px).eventRange.range.end}function px(n,t){return n.eventRange.range.end>t.eventRange.range.end?n:t}var mx=[],Lw={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},Fw=Object.assign(Object.assign({},Lw),{buttonHints:{prev:"Previous $0",next:"Next $0",today(n,t){return t==="day"?"Today":`This ${n}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(n){return`Show ${n} more event${n===1?"":"s"}`}});function gx(n){let t=n.length>0?n[0].code:"en",e=mx.concat(n),r={en:Fw};for(let i of e)r[i.code]=i;return{map:r,defaultCode:t}}function Bw(n,t){return typeof n=="object"&&!Array.isArray(n)?Hw(n.code,[n.code],n):yx(n,t)}function yx(n,t){let e=[].concat(n||[]),r=vx(e,t)||Fw;return Hw(n,e,r)}function vx(n,t){for(let e=0;e<n.length;e+=1){let r=n[e].toLocaleLowerCase().split("-");for(let i=r.length;i>0;i-=1){let s=r.slice(0,i).join("-");if(t[s])return t[s]}}return null}function Hw(n,t,e){let r=Fc([Lw,e],["buttonText"]);delete r.code;let{week:i}=r;return delete r.week,{codeArg:n,codes:t,week:i,simpleNumberFormat:new Intl.NumberFormat(n),options:r}}function xt(n){return{id:ni(),name:n.name,premiumReleaseDate:n.premiumReleaseDate?new Date(n.premiumReleaseDate):void 0,deps:n.deps||[],reducers:n.reducers||[],isLoadingFuncs:n.isLoadingFuncs||[],contextInit:[].concat(n.contextInit||[]),eventRefiners:n.eventRefiners||{},eventDefMemberAdders:n.eventDefMemberAdders||[],eventSourceRefiners:n.eventSourceRefiners||{},isDraggableTransformers:n.isDraggableTransformers||[],eventDragMutationMassagers:n.eventDragMutationMassagers||[],eventDefMutationAppliers:n.eventDefMutationAppliers||[],dateSelectionTransformers:n.dateSelectionTransformers||[],datePointTransforms:n.datePointTransforms||[],dateSpanTransforms:n.dateSpanTransforms||[],views:n.views||{},viewPropsTransformers:n.viewPropsTransformers||[],isPropsValid:n.isPropsValid||null,externalDefTransforms:n.externalDefTransforms||[],viewContainerAppends:n.viewContainerAppends||[],eventDropTransformers:n.eventDropTransformers||[],componentInteractions:n.componentInteractions||[],calendarInteractions:n.calendarInteractions||[],themeClasses:n.themeClasses||{},eventSourceDefs:n.eventSourceDefs||[],cmdFormatter:n.cmdFormatter,recurringTypes:n.recurringTypes||[],namedTimeZonedImpl:n.namedTimeZonedImpl,initialView:n.initialView||"",elementDraggingImpl:n.elementDraggingImpl,optionChangeHandlers:n.optionChangeHandlers||{},scrollGridImpl:n.scrollGridImpl||null,listenerRefiners:n.listenerRefiners||{},optionRefiners:n.optionRefiners||{},propSetHandlers:n.propSetHandlers||{}}}function wx(n,t){let e={},r={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function i(s){for(let a of s){let o=a.name,l=e[o];l===void 0?(e[o]=a.id,i(a.deps),r=Tx(r,a)):l!==a.id&&console.warn(`Duplicate plugin '${o}'`)}}return n&&i(n),i(t),r}function bx(){let n=[],t=[],e;return(r,i)=>((!e||!Sr(r,n)||!Sr(i,t))&&(e=wx(r,i)),n=r,t=i,e)}function Tx(n,t){return{premiumReleaseDate:Ex(n.premiumReleaseDate,t.premiumReleaseDate),reducers:n.reducers.concat(t.reducers),isLoadingFuncs:n.isLoadingFuncs.concat(t.isLoadingFuncs),contextInit:n.contextInit.concat(t.contextInit),eventRefiners:Object.assign(Object.assign({},n.eventRefiners),t.eventRefiners),eventDefMemberAdders:n.eventDefMemberAdders.concat(t.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},n.eventSourceRefiners),t.eventSourceRefiners),isDraggableTransformers:n.isDraggableTransformers.concat(t.isDraggableTransformers),eventDragMutationMassagers:n.eventDragMutationMassagers.concat(t.eventDragMutationMassagers),eventDefMutationAppliers:n.eventDefMutationAppliers.concat(t.eventDefMutationAppliers),dateSelectionTransformers:n.dateSelectionTransformers.concat(t.dateSelectionTransformers),datePointTransforms:n.datePointTransforms.concat(t.datePointTransforms),dateSpanTransforms:n.dateSpanTransforms.concat(t.dateSpanTransforms),views:Object.assign(Object.assign({},n.views),t.views),viewPropsTransformers:n.viewPropsTransformers.concat(t.viewPropsTransformers),isPropsValid:t.isPropsValid||n.isPropsValid,externalDefTransforms:n.externalDefTransforms.concat(t.externalDefTransforms),viewContainerAppends:n.viewContainerAppends.concat(t.viewContainerAppends),eventDropTransformers:n.eventDropTransformers.concat(t.eventDropTransformers),calendarInteractions:n.calendarInteractions.concat(t.calendarInteractions),componentInteractions:n.componentInteractions.concat(t.componentInteractions),themeClasses:Object.assign(Object.assign({},n.themeClasses),t.themeClasses),eventSourceDefs:n.eventSourceDefs.concat(t.eventSourceDefs),cmdFormatter:t.cmdFormatter||n.cmdFormatter,recurringTypes:n.recurringTypes.concat(t.recurringTypes),namedTimeZonedImpl:t.namedTimeZonedImpl||n.namedTimeZonedImpl,initialView:n.initialView||t.initialView,elementDraggingImpl:n.elementDraggingImpl||t.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},n.optionChangeHandlers),t.optionChangeHandlers),scrollGridImpl:t.scrollGridImpl||n.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},n.listenerRefiners),t.listenerRefiners),optionRefiners:Object.assign(Object.assign({},n.optionRefiners),t.optionRefiners),propSetHandlers:Object.assign(Object.assign({},n.propSetHandlers),t.propSetHandlers)}}function Ex(n,t){return n===void 0?t:t===void 0?n:new Date(Math.max(n.valueOf(),t.valueOf()))}var _r=class extends ei{};_r.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};_r.prototype.baseIconClass="fc-icon";_r.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};_r.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};_r.prototype.iconOverrideOption="buttonIcons";_r.prototype.iconOverrideCustomButtonOption="icon";_r.prototype.iconOverridePrefix="fc-icon-";function kx(n,t){let e={},r;for(r in n)Mf(r,e,n,t);for(r in t)Mf(r,e,n,t);return e}function Mf(n,t,e,r){if(t[n])return t[n];let i=Dx(n,t,e,r);return i&&(t[n]=i),i}function Dx(n,t,e,r){let i=e[n],s=r[n],a=d=>i&&i[d]!==null?i[d]:s&&s[d]!==null?s[d]:null,o=a("component"),l=a("superType"),c=null;if(l){if(l===n)throw new Error("Can't have a custom view type that references itself");c=Mf(l,t,e,r)}return!o&&c&&(o=c.component),o?{type:n,component:o,defaults:Object.assign(Object.assign({},c?c.defaults:{}),i?i.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),s?s.rawOptions:{})}:null}function Aw(n){return zt(n,Sx)}function Sx(n){let t=typeof n=="function"?{component:n}:n,{component:e}=t;return t.content?e=Iw(t):e&&!(e.prototype instanceof ue)&&(e=Iw(Object.assign(Object.assign({},t),{content:e}))),{superType:t.type,component:e,rawOptions:t}}function Iw(n){return t=>b(Gt.Consumer,null,e=>b(Xe,{elTag:"div",elClasses:nf(e.viewSpec),renderProps:Object.assign(Object.assign({},t),{nextDayThreshold:e.options.nextDayThreshold}),generatorName:void 0,customGenerator:n.content,classNameGenerator:n.classNames,didMount:n.didMount,willUnmount:n.willUnmount}))}function Cx(n,t,e,r){let i=Aw(n),s=Aw(t.views),a=kx(i,s);return zt(a,o=>xx(o,s,t,e,r))}function xx(n,t,e,r,i){let s=n.overrides.duration||n.defaults.duration||r.duration||e.duration,a=null,o="",l="",c={};if(s&&(a=_x(s),a)){let h=Ua(a);o=h.unit,h.value===1&&(l=o,c=t[o]?t[o].rawOptions:{})}let d=h=>{let f=h.buttonText||{},p=n.defaults.buttonTextKey;return p!=null&&f[p]!=null?f[p]:f[n.type]!=null?f[n.type]:f[l]!=null?f[l]:null},u=h=>{let f=h.buttonHints||{},p=n.defaults.buttonTextKey;return p!=null&&f[p]!=null?f[p]:f[n.type]!=null?f[n.type]:f[l]!=null?f[l]:null};return{type:n.type,component:n.component,duration:a,durationUnit:o,singleUnit:l,optionDefaults:n.defaults,optionOverrides:Object.assign(Object.assign({},c),n.overrides),buttonTextOverride:d(r)||d(e)||n.overrides.buttonText,buttonTextDefault:d(i)||n.defaults.buttonText||d(Cr)||n.type,buttonTitleOverride:u(r)||u(e)||n.overrides.buttonHint,buttonTitleDefault:u(i)||n.defaults.buttonHint||u(Cr)}}var Pw={};function _x(n){let t=JSON.stringify(n),e=Pw[t];return e===void 0&&(e=J(n),Pw[t]=e),e}function Mx(n,t){switch(t.type){case"CHANGE_VIEW_TYPE":n=t.viewType}return n}function Ax(n,t){switch(t.type){case"CHANGE_DATE":return t.dateMarker;default:return n}}function Ix(n,t,e){let r=n.initialDate;return r!=null?t.createMarker(r):e.getDateMarker()}function Px(n,t){switch(t.type){case"SET_OPTION":return Object.assign(Object.assign({},n),{[t.optionName]:t.rawOptionValue});default:return n}}function Nx(n,t,e,r){let i;switch(t.type){case"CHANGE_VIEW_TYPE":return r.build(t.dateMarker||e);case"CHANGE_DATE":return r.build(t.dateMarker);case"PREV":if(i=r.buildPrev(n,e),i.isValid)return i;break;case"NEXT":if(i=r.buildNext(n,e),i.isValid)return i;break}return n}function Ox(n,t,e){let r=t?t.activeRange:null;return Uw({},Ux(n,e),r,e)}function Rx(n,t,e,r){let i=e?e.activeRange:null;switch(t.type){case"ADD_EVENT_SOURCES":return Uw(n,t.sources,i,r);case"REMOVE_EVENT_SOURCE":return Fx(n,t.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return e?Vw(n,i,r):n;case"FETCH_EVENT_SOURCES":return Bf(n,t.sourceIds?ef(t.sourceIds):Ww(n,r),i,t.isRefetch||!1,r);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return Yx(n,t.sourceId,t.fetchId,t.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return n}}function Lx(n,t,e){let r=t?t.activeRange:null;return Bf(n,Ww(n,e),r,!0,e)}function Yw(n){for(let t in n)if(n[t].isFetching)return!0;return!1}function Uw(n,t,e,r){let i={};for(let s of t)i[s.sourceId]=s;return e&&(i=Vw(i,e,r)),Object.assign(Object.assign({},n),i)}function Fx(n,t){return Xr(n,e=>e.sourceId!==t)}function Vw(n,t,e){return Bf(n,Xr(n,r=>Bx(r,t,e)),t,!1,e)}function Bx(n,t,e){return jw(n,e)?!e.options.lazyFetching||!n.fetchRange||n.isFetching||t.start<n.fetchRange.start||t.end>n.fetchRange.end:!n.latestFetchId}function Bf(n,t,e,r,i){let s={};for(let a in n){let o=n[a];t[a]?s[a]=Hx(o,e,r,i):s[a]=o}return s}function Hx(n,t,e,r){let{options:i,calendarApi:s}=r,a=r.pluginHooks.eventSourceDefs[n.sourceDefId],o=ni();return a.fetch({eventSource:n,range:t,isRefetch:e,context:r},l=>{let{rawEvents:c}=l;i.eventSourceSuccess&&(c=i.eventSourceSuccess.call(s,c,l.response)||c),n.success&&(c=n.success.call(s,c,l.response)||c),r.dispatch({type:"RECEIVE_EVENTS",sourceId:n.sourceId,fetchId:o,fetchRange:t,rawEvents:c})},l=>{let c=!1;i.eventSourceFailure&&(i.eventSourceFailure.call(s,l),c=!0),n.failure&&(n.failure(l),c=!0),c||console.warn(l.message,l),r.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:n.sourceId,fetchId:o,fetchRange:t,error:l})}),Object.assign(Object.assign({},n),{isFetching:!0,latestFetchId:o})}function Yx(n,t,e,r){let i=n[t];return i&&e===i.latestFetchId?Object.assign(Object.assign({},n),{[t]:Object.assign(Object.assign({},i),{isFetching:!1,fetchRange:r})}):n}function Ww(n,t){return Xr(n,e=>jw(e,t))}function Ux(n,t){let e=cf(t),r=[].concat(n.eventSources||[]),i=[];n.initialEvents&&r.unshift(n.initialEvents),n.events&&r.unshift(n.events);for(let s of r){let a=lf(s,t,e);a&&i.push(a)}return i}function jw(n,t){return!t.pluginHooks.eventSourceDefs[n.sourceDefId].ignoreRange}function Vx(n,t){switch(t.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return t.selection;default:return n}}function Wx(n,t){switch(t.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return t.eventInstanceId;default:return n}}function jx(n,t){let e;switch(t.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return e=t.state,{affectedEvents:e.affectedEvents,mutatedEvents:e.mutatedEvents,isEvent:e.isEvent};default:return n}}function $x(n,t){let e;switch(t.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return e=t.state,{affectedEvents:e.affectedEvents,mutatedEvents:e.mutatedEvents,isEvent:e.isEvent};default:return n}}function zx(n,t,e,r,i){let s=n.headerToolbar?Nw(n.headerToolbar,n,t,e,r,i):null,a=n.footerToolbar?Nw(n.footerToolbar,n,t,e,r,i):null;return{header:s,footer:a}}function Nw(n,t,e,r,i,s){let a={},o=[],l=!1;for(let c in n){let d=n[c],u=qx(d,t,e,r,i,s);a[c]=u.widgets,o.push(...u.viewsWithButtons),l=l||u.hasTitle}return{sectionWidgets:a,viewsWithButtons:o,hasTitle:l}}function qx(n,t,e,r,i,s){let a=t.direction==="rtl",o=t.customButtons||{},l=e.buttonText||{},c=t.buttonText||{},d=e.buttonHints||{},u=t.buttonHints||{},h=n?n.split(" "):[],f=[],p=!1;return{widgets:h.map(g=>g.split(",").map(v=>{if(v==="title")return p=!0,{buttonName:v};let T,k,D,M,E,C;if(T=o[v])D=S=>{T.click&&T.click.call(S.target,S,S.target)},(M=r.getCustomButtonIconClass(T))||(M=r.getIconClass(v,a))||(E=T.text),C=T.hint||T.text;else if(k=i[v]){f.push(v),D=()=>{s.changeView(v)},(E=k.buttonTextOverride)||(M=r.getIconClass(v,a))||(E=k.buttonTextDefault);let S=k.buttonTextOverride||k.buttonTextDefault;C=_s(k.buttonTitleOverride||k.buttonTitleDefault||t.viewHint,[S,v],S)}else if(s[v])if(D=()=>{s[v]()},(E=l[v])||(M=r.getIconClass(v,a))||(E=c[v]),v==="prevYear"||v==="nextYear"){let S=v==="prevYear"?"prev":"next";C=_s(d[S]||u[S],[c.year||"year","year"],c[v])}else C=S=>_s(d[v]||u[v],[c[S]||S,S],c[v]);return{buttonName:v,buttonClick:D,buttonIcon:M,buttonText:E,buttonHint:C}})),viewsWithButtons:f,hasTitle:p}}var Af=class{constructor(t,e,r){this.type=t,this.getCurrentData=e,this.dateEnv=r}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(t){return this.getCurrentData().options[t]}},Gx={ignoreRange:!0,parseMeta(n){return Array.isArray(n.events)?n.events:null},fetch(n,t){t({rawEvents:n.eventSource.meta})}},Qx=xt({name:"array-event-source",eventSourceDefs:[Gx]}),Kx={parseMeta(n){return typeof n.events=="function"?n.events:null},fetch(n,t,e){let{dateEnv:r}=n.context,i=n.eventSource.meta;gf(i.bind(null,mf(n.range,r)),s=>t({rawEvents:s}),e)}},Zx=xt({name:"func-event-source",eventSourceDefs:[Kx]}),Jx={method:String,extraParams:A,startParam:String,endParam:String,timeZoneParam:String},Xx={parseMeta(n){return n.url&&(n.format==="json"||!n.format)?{url:n.url,format:"json",method:(n.method||"GET").toUpperCase(),extraParams:n.extraParams,startParam:n.startParam,endParam:n.endParam,timeZoneParam:n.timeZoneParam}:null},fetch(n,t,e){let{meta:r}=n.eventSource,i=t_(r,n.range,n.context);yf(r.method,r.url,i).then(([s,a])=>{t({rawEvents:s,response:a})},e)}},e_=xt({name:"json-event-source",eventSourceRefiners:Jx,eventSourceDefs:[Xx]});function t_(n,t,e){let{dateEnv:r,options:i}=e,s,a,o,l,c={};return s=n.startParam,s==null&&(s=i.startParam),a=n.endParam,a==null&&(a=i.endParam),o=n.timeZoneParam,o==null&&(o=i.timeZoneParam),typeof n.extraParams=="function"?l=n.extraParams():l=n.extraParams||{},Object.assign(c,l),c[s]=r.formatIso(t.start),c[a]=r.formatIso(t.end),r.timeZone!=="local"&&(c[o]=r.timeZone),c}var r_={daysOfWeek:A,startTime:J,endTime:J,duration:J,startRecur:A,endRecur:A},i_={parse(n,t){if(n.daysOfWeek||n.startTime||n.endTime||n.startRecur||n.endRecur){let e={daysOfWeek:n.daysOfWeek||null,startTime:n.startTime||null,endTime:n.endTime||null,startRecur:n.startRecur?t.createMarker(n.startRecur):null,endRecur:n.endRecur?t.createMarker(n.endRecur):null,dateEnv:t},r;return n.duration&&(r=n.duration),!r&&n.startTime&&n.endTime&&(r=$v(n.endTime,n.startTime)),{allDayGuess:Boolean(!n.startTime&&!n.endTime),duration:r,typeData:e}}return null},expand(n,t,e){let r=Lt(t,{start:n.startRecur,end:n.endRecur});return r?s_(n.daysOfWeek,n.startTime,n.dateEnv,e,r):[]}},n_=xt({name:"simple-recurring-event",recurringTypes:[i_],eventRefiners:r_});function s_(n,t,e,r,i){let s=n?ef(n):null,a=ke(i.start),o=i.end,l=[];for(;a<o;){let c;(!s||s[a.getUTCDay()])&&(t?c=r.add(a,t):c=a,l.push(r.createMarker(e.toDate(c)))),a=qe(a,1)}return l}var a_=xt({name:"change-handler",optionChangeHandlers:{events(n,t){Ow([n],t)},eventSources:Ow}});function Ow(n,t){let e=Bc(t.getCurrentData().eventSources);if(e.length===1&&n.length===1&&Array.isArray(e[0]._raw)&&Array.isArray(n[0])){t.dispatch({type:"RESET_RAW_EVENTS",sourceId:e[0].sourceId,rawEvents:n[0]});return}let r=[];for(let i of n){let s=!1;for(let a=0;a<e.length;a+=1)if(e[a]._raw===i){e.splice(a,1),s=!0;break}s||r.push(i)}for(let i of e)t.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:i.sourceId});for(let i of r)t.calendarApi.addEventSource(i)}function o_(n,t){t.emitter.trigger("datesSet",Object.assign(Object.assign({},mf(n.activeRange,t.dateEnv)),{view:t.viewApi}))}function l_(n,t){let{emitter:e}=t;e.hasHandlers("eventsSet")&&e.trigger("eventsSet",xr(n,t))}var c_=[Qx,Zx,e_,n_,a_,xt({name:"misc",isLoadingFuncs:[n=>Yw(n.eventSources)],propSetHandlers:{dateProfile:o_,eventStore:l_}})],If=class{constructor(t,e){this.runTaskOption=t,this.drainedOption=e,this.queue=[],this.delayedRunner=new Pn(this.drain.bind(this))}request(t,e){this.queue.push(t),this.delayedRunner.request(e)}pause(t){this.delayedRunner.pause(t)}resume(t,e){this.delayedRunner.resume(t,e)}drain(){let{queue:t}=this;for(;t.length;){let e=[],r;for(;r=t.shift();)this.runTask(r),e.push(r);this.drained(e)}}runTask(t){this.runTaskOption&&this.runTaskOption(t)}drained(t){this.drainedOption&&this.drainedOption(t)}};function d_(n,t,e){let r;return/^(year|month)$/.test(n.currentRangeUnit)?r=n.currentRange:r=n.activeRange,e.formatRange(r.start,r.end,be(t.titleFormat||u_(n)),{isEndExclusive:n.isRangeAllDay,defaultSeparator:t.titleRangeSeparator})}function u_(n){let{currentRangeUnit:t}=n;if(t==="year")return{year:"numeric"};if(t==="month")return{year:"numeric",month:"long"};let e=Ds(n.currentRange.start,n.currentRange.end);return e!==null&&e>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var Qc=class{constructor(){this.resetListeners=new Set}handleInput(t,e){let r=this.dateEnv;if(t!==r&&(typeof e=="function"?this.nowFn=e:r||(this.nowAnchorDate=t.toDate(e?t.createMarker(e):t.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=t,r))for(let i of this.resetListeners.values())i()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(t){this.resetListeners.add(t)}removeResetListener(t){this.resetListeners.delete(t)}},Pf=class{constructor(t){this.computeCurrentViewData=$(this._computeCurrentViewData),this.organizeRawLocales=$(gx),this.buildLocale=$(Bw),this.buildPluginHooks=bx(),this.buildDateEnv=$(h_),this.buildTheme=$(f_),this.parseToolbars=$(zx),this.buildViewSpecs=$(Cx),this.buildDateProfileGenerator=As(p_),this.buildViewApi=$(m_),this.buildViewUiProps=As(v_),this.buildEventUiBySource=$(g_,wt),this.buildEventUiBases=$(y_),this.parseContextBusinessHours=As(w_),this.buildTitle=$(d_),this.nowManager=new Qc,this.emitter=new ti,this.actionRunner=new If(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=h=>{this.actionRunner.request(h)},this.props=t,this.actionRunner.pause(),this.nowManager=new Qc;let e={},r=this.computeOptionsData(t.optionOverrides,e,t.calendarApi),i=r.calendarOptions.initialView||r.pluginHooks.initialView,s=this.computeCurrentViewData(i,r,t.optionOverrides,e);t.calendarApi.currentDataManager=this,this.emitter.setThisContext(t.calendarApi),this.emitter.setOptions(s.options);let a={nowManager:this.nowManager,dateEnv:r.dateEnv,options:r.calendarOptions,pluginHooks:r.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},o=Ix(r.calendarOptions,r.dateEnv,this.nowManager),l=s.dateProfileGenerator.build(o);$t(l.activeRange,o)||(o=l.currentRange.start);for(let h of r.pluginHooks.contextInit)h(a);let c=Ox(r.calendarOptions,l,a),d={dynamicOptionOverrides:e,currentViewType:i,currentDate:o,dateProfile:l,businessHours:this.parseContextBusinessHours(a),eventSources:c,eventUiBases:{},eventStore:Ge(),renderableEventStore:Ge(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(a).selectionConfig},u=Object.assign(Object.assign({},a),d);for(let h of r.pluginHooks.reducers)Object.assign(d,h(null,null,u));_f(d,a)&&this.emitter.trigger("loading",!0),this.state=d,this.updateData(),this.actionRunner.resume()}resetOptions(t,e){let{props:r}=this;e===void 0?r.optionOverrides=t:(r.optionOverrides=Object.assign(Object.assign({},r.optionOverrides||{}),t),this.optionsForRefining.push(...e)),(e===void 0||e.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(t){let{props:e,state:r,emitter:i}=this,s=Px(r.dynamicOptionOverrides,t),a=this.computeOptionsData(e.optionOverrides,s,e.calendarApi),o=Mx(r.currentViewType,t),l=this.computeCurrentViewData(o,a,e.optionOverrides,s);e.calendarApi.currentDataManager=this,i.setThisContext(e.calendarApi),i.setOptions(l.options);let c={nowManager:this.nowManager,dateEnv:a.dateEnv,options:a.calendarOptions,pluginHooks:a.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:i,getCurrentData:this.getCurrentData},{currentDate:d,dateProfile:u}=r;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(u=l.dateProfileGenerator.build(d)),d=Ax(d,t),u=Nx(u,t,d,l.dateProfileGenerator),(t.type==="PREV"||t.type==="NEXT"||!$t(u.currentRange,d))&&(d=u.currentRange.start);let h=Rx(r.eventSources,t,u,c),f=nw(r.eventStore,t,h,u,c),m=Yw(h)&&!l.options.progressiveEventRendering&&r.renderableEventStore||f,{eventUiSingleBase:g,selectionConfig:v}=this.buildViewUiProps(c),T=this.buildEventUiBySource(h),k=this.buildEventUiBases(m.defs,g,T),D={dynamicOptionOverrides:s,currentViewType:o,currentDate:d,dateProfile:u,eventSources:h,eventStore:f,renderableEventStore:m,selectionConfig:v,eventUiBases:k,businessHours:this.parseContextBusinessHours(c),dateSelection:Vx(r.dateSelection,t),eventSelection:Wx(r.eventSelection,t),eventDrag:jx(r.eventDrag,t),eventResize:$x(r.eventResize,t)},M=Object.assign(Object.assign({},c),D);for(let S of a.pluginHooks.reducers)Object.assign(D,S(r,t,M));let E=_f(r,c),C=_f(D,c);!E&&C?i.trigger("loading",!0):E&&!C&&i.trigger("loading",!1),this.state=D,e.onAction&&e.onAction(t)}updateData(){let{props:t,state:e}=this,r=this.data,i=this.computeOptionsData(t.optionOverrides,e.dynamicOptionOverrides,t.calendarApi),s=this.computeCurrentViewData(e.currentViewType,i,t.optionOverrides,e.dynamicOptionOverrides),a=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(e.dateProfile,s.options,i.dateEnv),calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},i),s),e),o=i.pluginHooks.optionChangeHandlers,l=r&&r.calendarOptions,c=i.calendarOptions;if(l&&l!==c){l.timeZone!==c.timeZone&&(e.eventSources=a.eventSources=Lx(a.eventSources,e.dateProfile,a),e.eventStore=a.eventStore=df(a.eventStore,r.dateEnv,a.dateEnv),e.renderableEventStore=a.renderableEventStore=df(a.renderableEventStore,r.dateEnv,a.dateEnv));for(let d in o)(this.optionsForHandling.indexOf(d)!==-1||l[d]!==c[d])&&o[d](c[d],a)}this.optionsForHandling=[],t.onData&&t.onData(a)}computeOptionsData(t,e,r){if(!this.optionsForRefining.length&&t===this.stableOptionOverrides&&e===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:i,pluginHooks:s,localeDefaults:a,availableLocaleData:o,extra:l}=this.processRawCalendarOptions(t,e);Rw(l);let c=this.buildDateEnv(i.timeZone,i.locale,i.weekNumberCalculation,i.firstDay,i.weekText,s,o,i.defaultRangeSeparator),d=this.buildViewSpecs(s.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,a),u=this.buildTheme(i,s),h=this.parseToolbars(i,this.stableOptionOverrides,u,d,r);return this.stableCalendarOptionsData={calendarOptions:i,pluginHooks:s,dateEnv:c,viewSpecs:d,theme:u,toolbarConfig:h,localeDefaults:a,availableRawLocales:o.map}}processRawCalendarOptions(t,e){let{locales:r,locale:i}=Lc([Cr,t,e]),s=this.organizeRawLocales(r),a=s.map,o=this.buildLocale(i||s.defaultCode,a).options,l=this.buildPluginHooks(t.plugins||[],c_),c=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Zh),Jh),Xh),l.listenerRefiners),l.optionRefiners),d={},u=Lc([Cr,o,t,e]),h={},f=this.currentCalendarOptionsInput,p=this.currentCalendarOptionsRefined,m=!1;for(let g in u)this.optionsForRefining.indexOf(g)===-1&&(u[g]===f[g]||Fi[g]&&g in f&&Fi[g](f[g],u[g]))?h[g]=p[g]:c[g]?(h[g]=c[g](u[g]),m=!0):d[g]=f[g];return m&&(this.currentCalendarOptionsInput=u,this.currentCalendarOptionsRefined=h,this.stableOptionOverrides=t,this.stableDynamicOptionOverrides=e),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:s,localeDefaults:o,extra:d}}_computeCurrentViewData(t,e,r,i){let s=e.viewSpecs[t];if(!s)throw new Error(`viewType "${t}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:a,extra:o}=this.processRawViewOptions(s,e.pluginHooks,e.localeDefaults,r,i);Rw(o),this.nowManager.handleInput(e.dateEnv,a.now);let l=this.buildDateProfileGenerator({dateProfileGeneratorClass:s.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:s.duration,durationUnit:s.durationUnit,usesMinMaxTime:s.optionDefaults.usesMinMaxTime,dateEnv:e.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:a.slotMinTime,slotMaxTime:a.slotMaxTime,showNonCurrentDates:a.showNonCurrentDates,dayCount:a.dayCount,dateAlignment:a.dateAlignment,dateIncrement:a.dateIncrement,hiddenDays:a.hiddenDays,weekends:a.weekends,validRangeInput:a.validRange,visibleRangeInput:a.visibleRange,fixedWeekCount:a.fixedWeekCount}),c=this.buildViewApi(t,this.getCurrentData,e.dateEnv);return{viewSpec:s,options:a,dateProfileGenerator:l,viewApi:c}}processRawViewOptions(t,e,r,i,s){let a=Lc([Cr,t.optionDefaults,r,i,t.optionOverrides,s]),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Zh),Jh),Xh),Gv),e.listenerRefiners),e.optionRefiners),l={},c=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,u=!1,h={};for(let f in a)a[f]===c[f]||Fi[f]&&Fi[f](a[f],c[f])?l[f]=d[f]:(a[f]===this.currentCalendarOptionsInput[f]||Fi[f]&&Fi[f](a[f],this.currentCalendarOptionsInput[f])?f in this.currentCalendarOptionsRefined&&(l[f]=this.currentCalendarOptionsRefined[f]):o[f]?l[f]=o[f](a[f]):h[f]=a[f],u=!0);return u&&(this.currentViewOptionsInput=a,this.currentViewOptionsRefined=l),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:h}}};function h_(n,t,e,r,i,s,a,o){let l=Bw(t||a.defaultCode,a.map);return new Va({calendarSystem:"gregory",timeZone:n,namedTimeZoneImpl:s.namedTimeZonedImpl,locale:l,weekNumberCalculation:e,firstDay:r,weekText:i,cmdFormatter:s.cmdFormatter,defaultSeparator:o})}function f_(n,t){let e=t.themeClasses[n.themeSystem]||_r;return new e(n)}function p_(n){let t=n.dateProfileGeneratorClass||Nn;return new t(n)}function m_(n,t,e){return new Af(n,t,e)}function g_(n){return zt(n,t=>t.ui)}function y_(n,t,e){let r={"":t};for(let i in n){let s=n[i];s.sourceId&&e[s.sourceId]&&(r[i]=e[s.sourceId])}return r}function v_(n){let{options:t}=n;return{eventUiSingleBase:Ns({display:t.eventDisplay,editable:t.editable,startEditable:t.eventStartEditable,durationEditable:t.eventDurationEditable,constraint:t.eventConstraint,overlap:typeof t.eventOverlap=="boolean"?t.eventOverlap:void 0,allow:t.eventAllow,backgroundColor:t.eventBackgroundColor,borderColor:t.eventBorderColor,textColor:t.eventTextColor,color:t.eventColor},n),selectionConfig:Ns({constraint:t.selectConstraint,overlap:typeof t.selectOverlap=="boolean"?t.selectOverlap:void 0,allow:t.selectAllow},n)}}function _f(n,t){for(let e of t.pluginHooks.isLoadingFuncs)if(e(n))return!0;return!1}function w_(n){return uf(n.options.businessHours,n)}function Rw(n,t){for(let e in n)console.warn(`Unknown option '${e}'`+(t?` for view '${t}'`:""))}var Nf=class extends ue{render(){let t=this.props.widgetGroups.map(e=>this.renderWidgetGroup(e));return b("div",{className:"fc-toolbar-chunk"},...t)}renderWidgetGroup(t){let{props:e}=this,{theme:r}=this.context,i=[],s=!0;for(let a of t){let{buttonName:o,buttonClick:l,buttonText:c,buttonIcon:d,buttonHint:u}=a;if(o==="title")s=!1,i.push(b("h2",{className:"fc-toolbar-title",id:e.titleId},e.title));else{let h=o===e.activeButton,f=!e.isTodayEnabled&&o==="today"||!e.isPrevEnabled&&o==="prev"||!e.isNextEnabled&&o==="next",p=[`fc-${o}-button`,r.getClass("button")];h&&p.push(r.getClass("buttonActive")),i.push(b("button",{type:"button",title:typeof u=="function"?u(e.navUnit):u,disabled:f,"aria-pressed":h,className:p.join(" "),onClick:l},c||(d?b("span",{className:d,role:"img"}):"")))}}if(i.length>1){let a=s&&r.getClass("buttonGroup")||"";return b("div",{className:a},...i)}return i[0]}},Kc=class extends ue{render(){let{model:t,extraClassName:e}=this.props,r=!1,i,s,a=t.sectionWidgets,o=a.center;return a.left?(r=!0,i=a.left):i=a.start,a.right?(r=!0,s=a.right):s=a.end,b("div",{className:[e||"","fc-toolbar",r?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",i||[]),this.renderSection("center",o||[]),this.renderSection("end",s||[]))}renderSection(t,e){let{props:r}=this;return b(Nf,{key:t,widgetGroups:e,title:r.title,navUnit:r.navUnit,activeButton:r.activeButton,isTodayEnabled:r.isTodayEnabled,isPrevEnabled:r.isPrevEnabled,isNextEnabled:r.isNextEnabled,titleId:r.titleId})}},Of=class extends ue{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=t=>{this.el=t,Qt(this.props.elRef,t),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:t,state:e}=this,{aspectRatio:r}=t,i=["fc-view-harness",r||t.liquid||t.height?"fc-view-harness-active":"fc-view-harness-passive"],s="",a="";return r?e.availableWidth!==null?s=e.availableWidth/r:a=`${1/r*100}%`:s=t.height||"",b("div",{"aria-labelledby":t.labeledById,ref:this.handleEl,className:i.join(" "),style:{height:s,paddingBottom:a}},t.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}},Rf=class extends ar{constructor(t){super(t),this.handleSegClick=(e,r)=>{let{component:i}=this,{context:s}=i,a=ai(r);if(a&&i.isValidSegDownEl(e.target)){let o=ze(e.target,".fc-event-forced-url"),l=o?o.querySelector("a[href]").href:"";s.emitter.trigger("eventClick",{el:r,event:new De(i.context,a.eventRange.def,a.eventRange.instance),jsEvent:e,view:s.viewApi}),l&&!e.defaultPrevented&&(window.location.href=l)}},this.destroy=Hh(t.el,"click",".fc-event",this.handleSegClick)}},Lf=class extends ar{constructor(t){super(t),this.handleEventElRemove=e=>{e===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(e,r)=>{ai(r)&&(this.currentSegEl=r,this.triggerEvent("eventMouseEnter",e,r))},this.handleSegLeave=(e,r)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",e,r))},this.removeHoverListeners=Hv(t.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(t,e,r){let{component:i}=this,{context:s}=i,a=ai(r);(!e||i.isValidSegDownEl(e.target))&&s.emitter.trigger(t,{el:r,event:new De(s,a.eventRange.def,a.eventRange.instance),jsEvent:e,view:s.viewApi})}},Ff=class extends kr{constructor(){super(...arguments),this.buildViewContext=$(Xv),this.buildViewPropTransformers=$(T_),this.buildToolbarProps=$(b_),this.headerRef=Oe(),this.footerRef=Oe(),this.interactionsStore={},this.state={viewLabelId:ii()},this.registerInteractiveComponent=(t,e)=>{let r=dw(t,e),a=[Rf,Lf].concat(this.props.pluginHooks.componentInteractions).map(o=>new o(r));this.interactionsStore[t.uid]=a,zn[t.uid]=r},this.unregisterInteractiveComponent=t=>{let e=this.interactionsStore[t.uid];if(e){for(let r of e)r.destroy();delete this.interactionsStore[t.uid]}delete zn[t.uid]},this.resizeRunner=new Pn(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=t=>{let{options:e}=this.props;e.handleWindowResize&&t.target===window&&this.resizeRunner.request(e.windowResizeDelay)}}render(){let{props:t}=this,{toolbarConfig:e,options:r}=t,i=!1,s="",a;t.isHeightAuto||t.forPrint?s="":r.height!=null?i=!0:r.contentHeight!=null?s=r.contentHeight:a=Math.max(r.aspectRatio,.5);let o=this.buildViewContext(t.viewSpec,t.viewApi,t.options,t.dateProfileGenerator,t.dateEnv,t.nowManager,t.theme,t.pluginHooks,t.dispatch,t.getCurrentData,t.emitter,t.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=e.header&&e.header.hasTitle?this.state.viewLabelId:void 0;return b(Gt.Provider,{value:o},b(qt,{unit:"day"},c=>{let d=this.buildToolbarProps(t.viewSpec,t.dateProfile,t.dateProfileGenerator,t.currentDate,c,t.viewTitle);return b(ve,null,e.header&&b(Kc,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:e.header,titleId:l},d)),b(Of,{liquid:i,height:s,aspectRatio:a,labeledById:l},this.renderView(t),this.buildAppendContent()),e.footer&&b(Kc,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:e.footer,titleId:""},d)))}))}componentDidMount(){let{props:t}=this;this.calendarInteractions=t.pluginHooks.calendarInteractions.map(r=>new r(t)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:e}=t.pluginHooks;for(let r in e)e[r](t[r],t)}componentDidUpdate(t){let{props:e}=this,{propSetHandlers:r}=e.pluginHooks;for(let i in r)e[i]!==t[i]&&r[i](e[i],e)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let t of this.calendarInteractions)t.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:t}=this,e=t.pluginHooks.viewContainerAppends.map(r=>r(t));return b(ve,{},...e)}renderView(t){let{pluginHooks:e}=t,{viewSpec:r}=t,i={dateProfile:t.dateProfile,businessHours:t.businessHours,eventStore:t.renderableEventStore,eventUiBases:t.eventUiBases,dateSelection:t.dateSelection,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,isHeightAuto:t.isHeightAuto,forPrint:t.forPrint},s=this.buildViewPropTransformers(e.viewPropsTransformers);for(let o of s)Object.assign(i,o.transform(i,t));let a=r.component;return b(a,Object.assign({},i))}};function b_(n,t,e,r,i,s){let a=e.build(i,void 0,!1),o=e.buildPrev(t,r,!1),l=e.buildNext(t,r,!1);return{title:s,activeButton:n.type,navUnit:n.singleUnit,isTodayEnabled:a.isValid&&!$t(t.currentRange,i),isPrevEnabled:o.isValid,isNextEnabled:l.isValid}}function T_(n){return n.map(t=>new t)}var Zc=class extends Ga{constructor(t,e={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=r=>{switch(r.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=r=>{this.currentData=r,this.renderRunner.request(r.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:r}=this;Wa(()=>{Mi(b(qa,{options:r.calendarOptions,theme:r.theme,emitter:r.emitter},(i,s,a,o)=>(this.setClassNames(i),this.setHeight(s),b(rf.Provider,{value:this.customContentRenderId},b(Ff,Object.assign({isHeightAuto:a,forPrint:o},r))))),this.el)})}else this.isRendered&&(this.isRendered=!1,Mi(null,this.el),this.setClassNames([]),this.setHeight(""))},Rv(t),this.el=t,this.renderRunner=new Pn(this.handleRenderRequest),new Pf({optionOverrides:e,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let t=this.isRendering;t?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),t&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){Wa(()=>{super.updateSize()})}batchRendering(t){this.renderRunner.pause("batchRendering"),t(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(t,e){this.currentDataManager.resetOptions(t,e)}setClassNames(t){if(!Sr(t,this.currentClassNames)){let{classList:e}=this.el;for(let r of this.currentClassNames)e.remove(r);for(let r of t)e.add(r);this.currentClassNames=t}}setHeight(t){Bh(this.el,"height",t)}};var fr=Ve(Yt());var Hf=class extends et{constructor(){super(...arguments),this.headerElRef=Oe()}renderSimpleLayout(t,e){let{props:r,context:i}=this,s=[],a=Gn(i.options);return t&&s.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:t}}),s.push({type:"body",key:"body",liquid:!0,chunk:{content:e}}),b(sr,{elClasses:["fc-daygrid"],viewSpec:i.viewSpec},b(Oi,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[],sections:s}))}renderHScrollLayout(t,e,r,i){let s=this.context.pluginHooks.scrollGridImpl;if(!s)throw new Error("No ScrollGrid implementation");let{props:a,context:o}=this,l=!a.forPrint&&Gn(o.options),c=!a.forPrint&&vo(o.options),d=[];return t&&d.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:t}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:e}]}),c&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:Rs}]}),b(sr,{elClasses:["fc-daygrid"],viewSpec:o.viewSpec},b(s,{liquid:!a.isHeightAuto&&!a.forPrint,forPrint:a.forPrint,collapsibleWidth:a.forPrint,colGroups:[{cols:[{span:r,minWidth:i}]}],sections:d}))}};function Jc(n,t){let e=[];for(let r=0;r<t;r+=1)e[r]=[];for(let r of n)e[r.row].push(r);return e}function Xc(n,t){let e=[];for(let r=0;r<t;r+=1)e[r]=[];for(let r of n)e[r.firstCol].push(r);return e}function $w(n,t){let e=[];if(n){for(let r=0;r<t;r+=1)e[r]={affectedInstances:n.affectedInstances,isEvent:n.isEvent,segs:[]};for(let r of n.segs)e[r.row].segs.push(r)}else for(let r=0;r<t;r+=1)e[r]=null;return e}var zw=be({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function qw(n){let{display:t}=n.eventRange.ui;return t==="list-item"||t==="auto"&&!n.eventRange.def.allDay&&n.firstCol===n.lastCol&&n.isStart&&n.isEnd}var ed=class extends ue{render(){let{props:t}=this;return b(Vn,Object.assign({},t,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:zw,defaultDisplayEventEnd:t.defaultDisplayEventEnd,disableResizing:!t.seg.eventRange.def.allDay}))}},td=class extends ue{render(){let{props:t,context:e}=this,{options:r}=e,{seg:i}=t,s=r.eventTimeFormat||zw,a=Wc(i,s,e,!0,t.defaultDisplayEventEnd);return b(Un,Object.assign({},t,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:jc(t.seg,e),defaultGenerator:E_,timeText:a,isResizing:!1,isDateSelecting:!1}))}};function E_(n){return b(ve,null,b("div",{className:"fc-daygrid-event-dot",style:{borderColor:n.borderColor||n.backgroundColor}}),n.timeText&&b("div",{className:"fc-event-time"},n.timeText),b("div",{className:"fc-event-title"},n.event.title||b(ve,null,"\xA0")))}var Yf=class extends ue{constructor(){super(...arguments),this.compileSegs=$(k_)}render(){let{props:t}=this,{allSegs:e,invisibleSegs:r}=this.compileSegs(t.singlePlacements);return b(jn,{elClasses:["fc-daygrid-more-link"],dateProfile:t.dateProfile,todayRange:t.todayRange,allDayDate:t.allDayDate,moreCnt:t.moreCnt,allSegs:e,hiddenSegs:r,alignmentElRef:t.alignmentElRef,alignGridTop:t.alignGridTop,extraDateSpan:t.extraDateSpan,popoverContent:()=>{let i=(t.eventDrag?t.eventDrag.affectedInstances:null)||(t.eventResize?t.eventResize.affectedInstances:null)||{};return b(ve,null,e.map(s=>{let a=s.eventRange.instance.instanceId;return b("div",{className:"fc-daygrid-event-harness",key:a,style:{visibility:i[a]?"hidden":""}},qw(s)?b(td,Object.assign({seg:s,isDragging:!1,isSelected:a===t.eventSelection,defaultDisplayEventEnd:!1},lr(s,t.todayRange))):b(ed,Object.assign({seg:s,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:a===t.eventSelection,defaultDisplayEventEnd:!1},lr(s,t.todayRange))))}))}})}};function k_(n){let t=[],e=[];for(let r of n)t.push(r.seg),r.isVisible||e.push(r.seg);return{allSegs:t,invisibleSegs:e}}var D_=be({week:"narrow"}),Uf=class extends et{constructor(){super(...arguments),this.rootElRef=Oe(),this.state={dayNumberId:ii()},this.handleRootEl=t=>{Qt(this.rootElRef,t),Qt(this.props.elRef,t)}}render(){let{context:t,props:e,state:r,rootElRef:i}=this,{options:s,dateEnv:a}=t,{date:o,dateProfile:l}=e,c=e.showDayNumber&&C_(o,l.currentRange,a);return b(Ri,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...e.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},e.extraDataAttrs),e.showDayNumber?{"aria-labelledby":r.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:S_,date:o,dateProfile:l,todayRange:e.todayRange,showDayNumber:e.showDayNumber,isMonthStart:c,extraRenderProps:e.extraRenderProps},(d,u)=>b("div",{ref:e.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:e.minHeight}},e.showWeekNumber&&b(To,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:qn(t,o,"week"),date:o,defaultFormat:D_}),!u.isDisabled&&(e.showDayNumber||Ls(s)||e.forceDayTop)?b("div",{className:"fc-daygrid-day-top"},b(d,{elTag:"a",elClasses:["fc-daygrid-day-number",c&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},qn(t,o)),{id:r.dayNumberId})})):e.showDayNumber?b("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},b("a",{className:"fc-daygrid-day-number"},"\xA0")):void 0,b("div",{className:"fc-daygrid-day-events",ref:e.fgContentElRef},e.fgContent,b("div",{className:"fc-daygrid-day-bottom",style:{marginTop:e.moreMarginTop}},b(Yf,{allDayDate:o,singlePlacements:e.singlePlacements,moreCnt:e.moreCnt,alignmentElRef:i,alignGridTop:!e.showDayNumber,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange}))),b("div",{className:"fc-daygrid-day-bg"},e.bgContent)))}};function S_(n){return n.dayNumberText||b(ve,null,"\xA0")}function C_(n,t,e){let{start:r,end:i}=t,s=Er(i,-1),a=e.getYear(r),o=e.getMonth(r),l=e.getYear(s),c=e.getMonth(s);return!(a===l&&o===c)&&Boolean(n.valueOf()===r.valueOf()||e.getDay(n)===1&&n.valueOf()<i.valueOf())}function Gw(n){return n.eventRange.instance.instanceId+":"+n.firstCol}function Qw(n){return Gw(n)+":"+n.lastCol}function x_(n,t,e,r,i,s,a){let o=new Vf(v=>{let T=n[v.index].eventRange.instance.instanceId+":"+v.span.start+":"+(v.span.end-1);return i[T]||1});o.allowReslicing=!0,o.strictOrder=r,t===!0||e===!0?(o.maxCoord=s,o.hiddenConsumes=!0):typeof t=="number"?o.maxStackCnt=t:typeof e=="number"&&(o.maxStackCnt=e,o.hiddenConsumes=!0);let l=[],c=[];for(let v=0;v<n.length;v+=1){let T=n[v],k=Qw(T);i[k]!=null?l.push({index:v,span:{start:T.firstCol,end:T.lastCol+1}}):c.push(T)}let d=o.addSegs(l),u=o.toRects(),{singleColPlacements:h,multiColPlacements:f,leftoverMargins:p}=__(u,n,a),m=[],g=[];for(let v of c){f[v.firstCol].push({seg:v,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let T=v.firstCol;T<=v.lastCol;T+=1)h[T].push({seg:Fs(v,T,T+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let v=0;v<a.length;v+=1)m.push(0);for(let v of d){let T=n[v.index],k=v.span;f[k.start].push({seg:Fs(T,k.start,k.end,a),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let D=k.start;D<k.end;D+=1)m[D]+=1,h[D].push({seg:Fs(T,D,D+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let v=0;v<a.length;v+=1)g.push(p[v]);return{singleColPlacements:h,multiColPlacements:f,moreCnts:m,moreMarginTops:g}}function __(n,t,e){let r=M_(n,e.length),i=[],s=[],a=[];for(let o=0;o<e.length;o+=1){let l=r[o],c=[],d=0,u=0;for(let f of l){let p=t[f.index];c.push({seg:Fs(p,o,o+1,e),isVisible:!0,isAbsolute:!1,absoluteTop:f.levelCoord,marginTop:f.levelCoord-d}),d=f.levelCoord+f.thickness}let h=[];d=0,u=0;for(let f of l){let p=t[f.index],m=f.span.end-f.span.start>1,g=f.span.start===o;u+=f.levelCoord-d,d=f.levelCoord+f.thickness,m?(u+=f.thickness,g&&h.push({seg:Fs(p,f.span.start,f.span.end,e),isVisible:!0,isAbsolute:!0,absoluteTop:f.levelCoord,marginTop:0})):g&&(h.push({seg:Fs(p,f.span.start,f.span.end,e),isVisible:!0,isAbsolute:!1,absoluteTop:f.levelCoord,marginTop:u}),u=0)}i.push(c),s.push(h),a.push(u)}return{singleColPlacements:i,multiColPlacements:s,leftoverMargins:a}}function M_(n,t){let e=[];for(let r=0;r<t;r+=1)e.push([]);for(let r of n)for(let i=r.span.start;i<r.span.end;i+=1)e[i].push(r);return e}function Fs(n,t,e,r){if(n.firstCol===t&&n.lastCol===e-1)return n;let i=n.eventRange,s=i.range,a=Lt(s,{start:r[t].date,end:qe(r[e-1].date,1)});return Object.assign(Object.assign({},n),{firstCol:t,lastCol:e-1,eventRange:{def:i.def,ui:Object.assign(Object.assign({},i.ui),{durationEditable:!1}),instance:i.instance,range:a},isStart:n.isStart&&a.start.valueOf()===s.start.valueOf(),isEnd:n.isEnd&&a.end.valueOf()===s.end.valueOf()})}var Vf=class extends Fn{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(t){let e=super.addSegs(t),{entriesByLevel:r}=this,i=s=>!this.forceHidden[Dr(s)];for(let s=0;s<r.length;s+=1)r[s]=r[s].filter(i);return e}handleInvalidInsertion(t,e,r){let{entriesByLevel:i,forceHidden:s}=this,{touchingEntry:a,touchingLevel:o,touchingLateral:l}=t;if(this.hiddenConsumes&&a){let c=Dr(a);if(!s[c])if(this.allowReslicing){let d=Object.assign(Object.assign({},a),{span:mo(a.span,e.span)}),u=Dr(d);s[u]=!0,i[o][l]=d,r.push(d),this.splitEntry(a,e,r)}else s[c]=!0,r.push(a)}super.handleInvalidInsertion(t,e,r)}},rd=class extends et{constructor(){super(...arguments),this.cellElRefs=new Ct,this.frameElRefs=new Ct,this.fgElRefs=new Ct,this.segHarnessRefs=new Ct,this.rootElRef=Oe(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=t=>{t&&this.updateSizing(!0)}}render(){let{props:t,state:e,context:r}=this,{options:i}=r,s=t.cells.length,a=Xc(t.businessHourSegs,s),o=Xc(t.bgEventSegs,s),l=Xc(this.getHighlightSegs(),s),c=Xc(this.getMirrorSegs(),s),{singleColPlacements:d,multiColPlacements:u,moreCnts:h,moreMarginTops:f}=x_(uo(t.fgEventSegs,i.eventOrder),t.dayMaxEvents,t.dayMaxEventRows,i.eventOrderStrict,e.segHeights,e.maxContentHeight,t.cells),p=t.eventDrag&&t.eventDrag.affectedInstances||t.eventResize&&t.eventResize.affectedInstances||{};return b("tr",{ref:this.rootElRef,role:"row"},t.renderIntro&&t.renderIntro(),t.cells.map((m,g)=>{let v=this.renderFgSegs(g,t.forPrint?d[g]:u[g],t.todayRange,p),T=this.renderFgSegs(g,A_(c[g],u),t.todayRange,{},Boolean(t.eventDrag),Boolean(t.eventResize),!1);return b(Uf,{key:m.key,elRef:this.cellElRefs.createRef(m.key),innerElRef:this.frameElRefs.createRef(m.key),dateProfile:t.dateProfile,date:m.date,showDayNumber:t.showDayNumbers,showWeekNumber:t.showWeekNumbers&&g===0,forceDayTop:t.showWeekNumbers,todayRange:t.todayRange,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,extraRenderProps:m.extraRenderProps,extraDataAttrs:m.extraDataAttrs,extraClassNames:m.extraClassNames,extraDateSpan:m.extraDateSpan,moreCnt:h[g],moreMarginTop:f[g],singlePlacements:d[g],fgContentElRef:this.fgElRefs.createRef(m.key),fgContent:b(ve,null,b(ve,null,v),b(ve,null,T)),bgContent:b(ve,null,this.renderFillSegs(l[g],"highlight"),this.renderFillSegs(a[g],"non-business"),this.renderFillSegs(o[g],"bg-event")),minHeight:t.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(t,e){let r=this.props;this.updateSizing(!wt(t,r))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:t}=this;return t.eventDrag&&t.eventDrag.segs.length?t.eventDrag.segs:t.eventResize&&t.eventResize.segs.length?t.eventResize.segs:t.dateSelectionSegs}getMirrorSegs(){let{props:t}=this;return t.eventResize&&t.eventResize.segs.length?t.eventResize.segs:[]}renderFgSegs(t,e,r,i,s,a,o){let{context:l}=this,{eventSelection:c}=this.props,{framePositions:d}=this.state,u=this.props.cells.length===1,h=s||a||o,f=[];if(d)for(let p of e){let{seg:m}=p,{instanceId:g}=m.eventRange.instance,v=p.isVisible&&!i[g],T=p.isAbsolute,k="",D="";T&&(l.isRtl?(D=0,k=d.lefts[m.lastCol]-d.lefts[m.firstCol]):(k=0,D=d.rights[m.firstCol]-d.rights[m.lastCol])),f.push(b("div",{className:"fc-daygrid-event-harness"+(T?" fc-daygrid-event-harness-abs":""),key:Gw(m),ref:h?null:this.segHarnessRefs.createRef(Qw(m)),style:{visibility:v?"":"hidden",marginTop:T?"":p.marginTop,top:T?p.absoluteTop:"",left:k,right:D}},qw(m)?b(td,Object.assign({seg:m,isDragging:s,isSelected:g===c,defaultDisplayEventEnd:u},lr(m,r))):b(ed,Object.assign({seg:m,isDragging:s,isResizing:a,isDateSelecting:o,isSelected:g===c,defaultDisplayEventEnd:u},lr(m,r)))))}return f}renderFillSegs(t,e){let{isRtl:r}=this.context,{todayRange:i}=this.props,{framePositions:s}=this.state,a=[];if(s)for(let o of t){let l=r?{right:0,left:s.lefts[o.lastCol]-s.lefts[o.firstCol]}:{left:0,right:s.rights[o.firstCol]-s.rights[o.lastCol]};a.push(b("div",{key:ho(o.eventRange),className:"fc-daygrid-bg-harness",style:l},e==="bg-event"?b(Wn,Object.assign({seg:o},lr(o,i))):bo(e)))}return b(ve,{},...a)}updateSizing(t){let{props:e,state:r,frameElRefs:i}=this;if(!e.forPrint&&e.clientWidth!==null){if(t){let l=e.cells.map(c=>i.currentMap[c.key]);if(l.length){let c=this.rootElRef.current,d=new or(c,l,!0,!1);(!r.framePositions||!r.framePositions.similarTo(d))&&this.setState({framePositions:new or(c,l,!0,!1)})}}let s=this.state.segHeights,a=this.querySegHeights(),o=e.dayMaxEvents===!0||e.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},s),a),maxContentHeight:o?this.computeMaxContentHeight():null})}}querySegHeights(){let t=this.segHarnessRefs.currentMap,e={};for(let r in t){let i=Math.round(t[r].getBoundingClientRect().height);e[r]=Math.max(e[r]||0,i)}return e}computeMaxContentHeight(){let t=this.props.cells[0].key,e=this.cellElRefs.currentMap[t],r=this.fgElRefs.currentMap[t];return e.getBoundingClientRect().bottom-r.getBoundingClientRect().top}getCellEls(){let t=this.cellElRefs.currentMap;return this.props.cells.map(e=>t[e.key])}};rd.addStateEquality({segHeights:wt});function A_(n,t){if(!n.length)return[];let e=I_(t);return n.map(r=>({seg:r,isVisible:!0,isAbsolute:!0,absoluteTop:e[r.eventRange.instance.instanceId],marginTop:0}))}function I_(n){let t={};for(let e of n)for(let r of e)t[r.seg.eventRange.instance.instanceId]=r.absoluteTop;return t}var Eo=class extends et{constructor(){super(...arguments),this.splitBusinessHourSegs=$(Jc),this.splitBgEventSegs=$(Jc),this.splitFgEventSegs=$(Jc),this.splitDateSelectionSegs=$(Jc),this.splitEventDrag=$($w),this.splitEventResize=$($w),this.rowRefs=new Ct}render(){let{props:t,context:e}=this,r=t.cells.length,i=this.splitBusinessHourSegs(t.businessHourSegs,r),s=this.splitBgEventSegs(t.bgEventSegs,r),a=this.splitFgEventSegs(t.fgEventSegs,r),o=this.splitDateSelectionSegs(t.dateSelectionSegs,r),l=this.splitEventDrag(t.eventDrag,r),c=this.splitEventResize(t.eventResize,r),d=r>=7&&t.clientWidth?t.clientWidth/e.options.aspectRatio/6:null;return b(qt,{unit:"day"},(u,h)=>b(ve,null,t.cells.map((f,p)=>b(rd,{ref:this.rowRefs.createRef(p),key:f.length?f[0].date.toISOString():p,showDayNumbers:r>1,showWeekNumbers:t.showWeekNumbers,todayRange:h,dateProfile:t.dateProfile,cells:f,renderIntro:t.renderRowIntro,businessHourSegs:i[p],eventSelection:t.eventSelection,bgEventSegs:s[p].filter(P_),fgEventSegs:a[p],dateSelectionSegs:o[p],eventDrag:l[p],eventResize:c[p],dayMaxEvents:t.dayMaxEvents,dayMaxEventRows:t.dayMaxEventRows,clientWidth:t.clientWidth,clientHeight:t.clientHeight,cellMinHeight:d,forPrint:t.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){let t=this.rowRefs.currentMap[0].getCellEls()[0],e=t?t.closest(".fc-daygrid-body"):null;e&&(this.rootEl=e,this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new or(this.rootEl,this.rowRefs.collect().map(t=>t.getCellEls()[0]),!1,!0),this.colPositions=new or(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(t,e){let{colPositions:r,rowPositions:i}=this,s=r.leftToIndex(t),a=i.topToIndex(e);if(a!=null&&s!=null){let o=this.props.cells[a][s];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(a,s),allDay:!0},o.extraDateSpan),dayEl:this.getCellEl(a,s),rect:{left:r.lefts[s],right:r.rights[s],top:i.tops[a],bottom:i.bottoms[a]},layer:0}}return null}getCellEl(t,e){return this.rowRefs.currentMap[t].getCellEls()[e]}getCellRange(t,e){let r=this.props.cells[t][e].date,i=qe(r,1);return{start:r,end:i}}};function P_(n){return n.eventRange.def.allDay}var Wf=class extends et{constructor(){super(...arguments),this.elRef=Oe(),this.needsScrollReset=!1}render(){let{props:t}=this,{dayMaxEventRows:e,dayMaxEvents:r,expandRows:i}=t,s=r===!0||e===!0;s&&!i&&(s=!1,e=null,r=null);let a=["fc-daygrid-body",s?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",i?"":"fc-daygrid-body-natural"];return b("div",{ref:this.elRef,className:a.join(" "),style:{width:t.clientWidth,minWidth:t.tableMinWidth}},b("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:t.clientWidth,minWidth:t.tableMinWidth,height:i?t.clientHeight:""}},t.colGroupNode,b("tbody",{role:"presentation"},b(Eo,{dateProfile:t.dateProfile,cells:t.cells,renderRowIntro:t.renderRowIntro,showWeekNumbers:t.showWeekNumbers,clientWidth:t.clientWidth,clientHeight:t.clientHeight,businessHourSegs:t.businessHourSegs,bgEventSegs:t.bgEventSegs,fgEventSegs:t.fgEventSegs,dateSelectionSegs:t.dateSelectionSegs,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,dayMaxEvents:r,dayMaxEventRows:e,forPrint:t.forPrint,isHitComboAllowed:t.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(t){t.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){let t=N_(this.elRef.current,this.props.dateProfile);if(t){let e=t.closest(".fc-daygrid-body"),r=e.closest(".fc-scroller"),i=t.getBoundingClientRect().top-e.getBoundingClientRect().top;r.scrollTop=i?i+1:0}this.needsScrollReset=!1}}};function N_(n,t){let e;return t.currentRangeUnit.match(/year|month/)&&(e=n.querySelector(`[data-date="${Ms(t.currentDate)}-01"]`)),e||(e=n.querySelector(`[data-date="${so(t.currentDate)}"]`)),e}var ko=class extends Yn{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(t,e){return e.sliceRange(t)}},Do=class extends et{constructor(){super(...arguments),this.slicer=new ko,this.tableRef=Oe()}render(){let{props:t,context:e}=this;return b(Wf,Object.assign({ref:this.tableRef},this.slicer.sliceProps(t,t.dateProfile,t.nextDayThreshold,e,t.dayTableModel),{dateProfile:t.dateProfile,cells:t.dayTableModel.cells,colGroupNode:t.colGroupNode,tableMinWidth:t.tableMinWidth,renderRowIntro:t.renderRowIntro,dayMaxEvents:t.dayMaxEvents,dayMaxEventRows:t.dayMaxEventRows,showWeekNumbers:t.showWeekNumbers,expandRows:t.expandRows,headerAlignElRef:t.headerAlignElRef,clientWidth:t.clientWidth,clientHeight:t.clientHeight,forPrint:t.forPrint}))}},id=class extends Hf{constructor(){super(...arguments),this.buildDayTableModel=$(jf),this.headerRef=Oe(),this.tableRef=Oe()}render(){let{options:t,dateProfileGenerator:e}=this.context,{props:r}=this,i=this.buildDayTableModel(r.dateProfile,e),s=t.dayHeaders&&b(ri,{ref:this.headerRef,dateProfile:r.dateProfile,dates:i.headerDates,datesRepDistinctDays:i.rowCnt===1}),a=o=>b(Do,{ref:this.tableRef,dateProfile:r.dateProfile,dayTableModel:i,businessHours:r.businessHours,dateSelection:r.dateSelection,eventStore:r.eventStore,eventUiBases:r.eventUiBases,eventSelection:r.eventSelection,eventDrag:r.eventDrag,eventResize:r.eventResize,nextDayThreshold:t.nextDayThreshold,colGroupNode:o.tableColGroupNode,tableMinWidth:o.tableMinWidth,dayMaxEvents:t.dayMaxEvents,dayMaxEventRows:t.dayMaxEventRows,showWeekNumbers:t.weekNumbers,expandRows:!r.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:o.clientWidth,clientHeight:o.clientHeight,forPrint:r.forPrint});return t.dayMinWidth?this.renderHScrollLayout(s,a,i.colCnt,t.dayMinWidth):this.renderSimpleLayout(s,a)}};function jf(n,t){let e=new Bn(n.renderRange,t);return new Hn(e,/year|month|week/.test(n.currentRangeUnit))}var Bs=class extends Nn{buildRenderRange(t,e,r){let i=super.buildRenderRange(t,e,r),{props:s}=this;return $f({currentRange:i,snapToWeek:/^(year|month)$/.test(e),fixedWeekCount:s.fixedWeekCount,dateEnv:s.dateEnv})}};function $f(n){let{dateEnv:t,currentRange:e}=n,{start:r,end:i}=e,s;if(n.snapToWeek&&(r=t.startOfWeek(r),s=t.startOfWeek(i),s.valueOf()!==i.valueOf()&&(i=Oc(s,1))),n.fixedWeekCount){let a=t.startOfWeek(t.startOfMonth(qe(e.end,-1))),o=Math.ceil(qh(a,i));i=Oc(i,6-o)}return{start:r,end:i}}var O_=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';Li(O_);var Kw=xt({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:id,dateProfileGeneratorClass:Bs},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});var qf=class extends Qa{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(t){return t.allDay?["allDay"]:["timed"]}getKeysForEventDef(t){return t.allDay?ff(t)?["timed","allDay"]:["allDay"]:["timed"]}},R_=be({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function tb(n){let t=["fc-timegrid-slot","fc-timegrid-slot-label",n.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return b(Gt.Consumer,null,e=>{if(!n.isLabeled)return b("td",{className:t.join(" "),"data-time":n.isoTimeStr});let{dateEnv:r,options:i,viewApi:s}=e,a=i.slotLabelFormat==null?R_:Array.isArray(i.slotLabelFormat)?be(i.slotLabelFormat[0]):be(i.slotLabelFormat),o={level:0,time:n.time,date:r.toDate(n.date),view:s,text:r.format(n.date,a)};return b(Xe,{elTag:"td",elClasses:t,elAttrs:{"data-time":n.isoTimeStr},renderProps:o,generatorName:"slotLabelContent",customGenerator:i.slotLabelContent,defaultGenerator:L_,classNameGenerator:i.slotLabelClassNames,didMount:i.slotLabelDidMount,willUnmount:i.slotLabelWillUnmount},l=>b("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},b(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function L_(n){return n.text}var Gf=class extends ue{render(){return this.props.slatMetas.map(t=>b("tr",{key:t.key},b(tb,Object.assign({},t))))}},F_=be({week:"short"}),B_=5,Qf=class extends et{constructor(){super(...arguments),this.allDaySplitter=new qf,this.headerElRef=Oe(),this.rootElRef=Oe(),this.scrollerElRef=Oe(),this.state={slatCoords:null},this.handleScrollTopRequest=t=>{let e=this.scrollerElRef.current;e&&(e.scrollTop=t)},this.renderHeadAxis=(t,e="")=>{let{options:r}=this.context,{dateProfile:i}=this.props,s=i.renderRange,o=si(s.start,s.end)===1?qn(this.context,s.start,"week"):{};return r.weekNumbers&&t==="day"?b(To,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:s.start,defaultFormat:F_},l=>b("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:e}},b(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:o}))):b("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},b("div",{className:"fc-timegrid-axis-frame",style:{height:e}}))},this.renderTableRowAxis=t=>{let{options:e,viewApi:r}=this.context,i={text:e.allDayText,view:r};return b(Xe,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:i,generatorName:"allDayContent",customGenerator:e.allDayContent,defaultGenerator:H_,classNameGenerator:e.allDayClassNames,didMount:e.allDayDidMount,willUnmount:e.allDayWillUnmount},s=>b("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",t==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:t}},b(s,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=t=>{this.setState({slatCoords:t})}}renderSimpleLayout(t,e,r){let{context:i,props:s}=this,a=[],o=Gn(i.options);return t&&a.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:t}}),e&&(a.push({type:"body",key:"all-day",chunk:{content:e}}),a.push({type:"body",key:"all-day-divider",outerContent:b("tr",{role:"presentation",className:"fc-scrollgrid-section"},b("td",{className:"fc-timegrid-divider "+i.theme.getClass("tableCellShaded")}))})),a.push({type:"body",key:"body",liquid:!0,expandRows:Boolean(i.options.expandRows),chunk:{scrollerElRef:this.scrollerElRef,content:r}}),b(sr,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:i.viewSpec},b(Oi,{liquid:!s.isHeightAuto&&!s.forPrint,collapsibleWidth:s.forPrint,cols:[{width:"shrink"}],sections:a}))}renderHScrollLayout(t,e,r,i,s,a,o){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:c,props:d}=this,u=!d.forPrint&&Gn(c.options),h=!d.forPrint&&vo(c.options),f=[];t&&f.push({type:"header",key:"header",isSticky:u,syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>b("tr",{role:"presentation"},this.renderHeadAxis("day",m.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:t}]}),e&&(f.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>b("tr",{role:"presentation"},this.renderTableRowAxis(m.rowSyncHeights[0]))},{key:"cols",content:e}]}),f.push({key:"all-day-divider",type:"body",outerContent:b("tr",{role:"presentation",className:"fc-scrollgrid-section"},b("td",{colSpan:2,className:"fc-timegrid-divider "+c.theme.getClass("tableCellShaded")}))}));let p=c.options.nowIndicator;return f.push({type:"body",key:"body",liquid:!0,expandRows:Boolean(c.options.expandRows),chunks:[{key:"axis",content:m=>b("div",{className:"fc-timegrid-axis-chunk"},b("table",{"aria-hidden":!0,style:{height:m.expandRows?m.clientHeight:""}},m.tableColGroupNode,b("tbody",null,b(Gf,{slatMetas:a}))),b("div",{className:"fc-timegrid-now-indicator-container"},b(qt,{unit:p?"minute":"day"},g=>{let v=p&&o&&o.safeComputeTop(g);return typeof v=="number"?b(wo,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:v},isAxis:!0,date:g}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:r}]}),h&&f.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:Rs},{key:"cols",content:Rs}]}),b(sr,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:c.viewSpec},b(l,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:i,minWidth:s}]}],sections:f}))}getAllDayMaxEventProps(){let{dayMaxEvents:t,dayMaxEventRows:e}=this.context.options;return(t===!0||e===!0)&&(t=void 0,e=B_),{dayMaxEvents:t,dayMaxEventRows:e}}};function H_(n){return n.text}var Kf=class{constructor(t,e,r){this.positions=t,this.dateProfile=e,this.slotDuration=r}safeComputeTop(t){let{dateProfile:e}=this;if($t(e.currentRange,t)){let r=ke(t),i=t.valueOf()-r.valueOf();if(i>=Rt(e.slotMinTime)&&i<Rt(e.slotMaxTime))return this.computeTimeTop(J(i))}return null}computeDateTop(t,e){return e||(e=ke(t)),this.computeTimeTop(J(t.valueOf()-e.valueOf()))}computeTimeTop(t){let{positions:e,dateProfile:r}=this,i=e.els.length,s=(t.milliseconds-Rt(r.slotMinTime))/Rt(this.slotDuration),a,o;return s=Math.max(0,s),s=Math.min(i,s),a=Math.floor(s),a=Math.min(a,i-1),o=s-a,e.tops[a]+e.getHeight(a)*o}},Zf=class extends ue{render(){let{props:t,context:e}=this,{options:r}=e,{slatElRefs:i}=t;return b("tbody",null,t.slatMetas.map((s,a)=>{let o={time:s.time,date:e.dateEnv.toDate(s.date),view:e.viewApi};return b("tr",{key:s.key,ref:i.createRef(s.key)},t.axis&&b(tb,Object.assign({},s)),b(Xe,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!s.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":s.isoTimeStr},renderProps:o,generatorName:"slotLaneContent",customGenerator:r.slotLaneContent,classNameGenerator:r.slotLaneClassNames,didMount:r.slotLaneDidMount,willUnmount:r.slotLaneWillUnmount}))}))}},Jf=class extends ue{constructor(){super(...arguments),this.rootElRef=Oe(),this.slatElRefs=new Ct}render(){let{props:t,context:e}=this;return b("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},b("table",{"aria-hidden":!0,className:e.theme.getClass("table"),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:t.minHeight}},t.tableColGroupNode,b(Zf,{slatElRefs:this.slatElRefs,axis:t.axis,slatMetas:t.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:t,props:e}=this;e.onCoords&&e.clientWidth!==null&&this.rootElRef.current.offsetHeight&&e.onCoords(new Kf(new or(this.rootElRef.current,Y_(this.slatElRefs.currentMap,e.slatMetas),!1,!0),this.props.dateProfile,t.options.slotDuration))}};function Y_(n,t){return t.map(e=>n[e.key])}function So(n,t){let e=[],r;for(r=0;r<t;r+=1)e.push([]);if(n)for(r=0;r<n.length;r+=1)e[n[r].col].push(n[r]);return e}function Zw(n,t){let e=[];if(n){for(let r=0;r<t;r+=1)e[r]={affectedInstances:n.affectedInstances,isEvent:n.isEvent,segs:[]};for(let r of n.segs)e[r.col].segs.push(r)}else for(let r=0;r<t;r+=1)e[r]=null;return e}var Xf=class extends ue{render(){let{props:t}=this;return b(jn,{elClasses:["fc-timegrid-more-link"],elStyle:{top:t.top,bottom:t.bottom},allDayDate:null,moreCnt:t.hiddenSegs.length,allSegs:t.hiddenSegs,hiddenSegs:t.hiddenSegs,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,todayRange:t.todayRange,popoverContent:()=>rb(t.hiddenSegs,t),defaultGenerator:U_,forceTimed:!0},e=>b(e,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}};function U_(n){return n.shortText}function V_(n,t,e){let r=new Fn;t!=null&&(r.strictOrder=t),e!=null&&(r.maxStackCnt=e);let i=r.addSegs(n),s=Sf(i),a=W_(r);return a=q_(a,1),{segRects:G_(a),hiddenGroups:s}}function W_(n){let{entriesByLevel:t}=n,e=sp((r,i)=>r+":"+i,(r,i)=>{let s=z_(n,r,i),a=Jw(s,e),o=t[r][i];return[Object.assign(Object.assign({},o),{nextLevelNodes:a[0]}),o.thickness+a[1]]});return Jw(t.length?{level:0,lateralStart:0,lateralEnd:t[0].length}:null,e)[0]}function Jw(n,t){if(!n)return[[],0];let{level:e,lateralStart:r,lateralEnd:i}=n,s=r,a=[];for(;s<i;)a.push(t(e,s)),s+=1;return a.sort(j_),[a.map($_),a[0][1]]}function j_(n,t){return t[1]-n[1]}function $_(n){return n[0]}function z_(n,t,e){let{levelCoords:r,entriesByLevel:i}=n,s=i[t][e],a=r[t]+s.thickness,o=r.length,l=t;for(;l<o&&r[l]<a;l+=1);for(;l<o;l+=1){let c=i[l],d,u=Xa(c,s.span.start,Ja),h=u[0]+u[1],f=h;for(;(d=c[f])&&d.span.start<s.span.end;)f+=1;if(h<f)return{level:l,lateralStart:h,lateralEnd:f}}return null}function q_(n,t){let e=sp((r,i,s)=>Dr(r),(r,i,s)=>{let{nextLevelNodes:a,thickness:o}=r,l=o+s,c=o/l,d,u=[];if(!a.length)d=t;else for(let f of a)if(d===void 0){let p=e(f,i,l);d=p[0],u.push(p[1])}else{let p=e(f,d,0);u.push(p[1])}let h=(d-i)*c;return[d-h,Object.assign(Object.assign({},r),{thickness:h,nextLevelNodes:u})]});return n.map(r=>e(r,0,0)[1])}function G_(n){let t=[],e=sp((i,s,a)=>Dr(i),(i,s,a)=>{let o=Object.assign(Object.assign({},i),{levelCoord:s,stackDepth:a,stackForward:0});return t.push(o),o.stackForward=r(i.nextLevelNodes,s+i.thickness,a+1)+1});function r(i,s,a){let o=0;for(let l of i)o=Math.max(e(l,s,a),o);return o}return r(n,0,0),t}function sp(n,t){let e={};return(...r)=>{let i=n(...r);return i in e?e[i]:e[i]=t(...r)}}function Xw(n,t,e=null,r=0){let i=[];if(e)for(let s=0;s<n.length;s+=1){let a=n[s],o=e.computeDateTop(a.start,t),l=Math.max(o+(r||0),e.computeDateTop(a.end,t));i.push({start:Math.round(o),end:Math.round(l)})}return i}function Q_(n,t,e,r){let i=[],s=[];for(let c=0;c<n.length;c+=1){let d=t[c];d?i.push({index:c,thickness:1,span:d}):s.push(n[c])}let{segRects:a,hiddenGroups:o}=V_(i,e,r),l=[];for(let c of a)l.push({seg:n[c.index],rect:c});for(let c of s)l.push({seg:c,rect:null});return{segPlacements:l,hiddenGroups:o}}var K_=be({hour:"numeric",minute:"2-digit",meridiem:!1}),nd=class extends ue{render(){return b(Vn,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:K_}))}},ep=class extends ue{constructor(){super(...arguments),this.sortEventSegs=$(uo)}render(){let{props:t,context:e}=this,{options:r}=e,i=r.selectMirror,s=t.eventDrag&&t.eventDrag.segs||t.eventResize&&t.eventResize.segs||i&&t.dateSelectionSegs||[],a=t.eventDrag&&t.eventDrag.affectedInstances||t.eventResize&&t.eventResize.affectedInstances||{},o=this.sortEventSegs(t.fgEventSegs,r.eventOrder);return b(Ri,{elTag:"td",elRef:t.elRef,elClasses:["fc-timegrid-col",...t.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},t.extraDataAttrs),date:t.date,dateProfile:t.dateProfile,todayRange:t.todayRange,extraRenderProps:t.extraRenderProps},l=>b("div",{className:"fc-timegrid-col-frame"},b("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(t.businessHourSegs,"non-business"),this.renderFillSegs(t.bgEventSegs,"bg-event"),this.renderFillSegs(t.dateSelectionSegs,"highlight")),b("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(o,a,!1,!1,!1)),b("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(s,{},Boolean(t.eventDrag),Boolean(t.eventResize),Boolean(i),"mirror")),b("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(t.nowIndicatorSegs)),Ls(r)&&b(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(t,e,r,i,s,a){let{props:o}=this;return o.forPrint?rb(t,o):this.renderPositionedFgSegs(t,e,r,i,s,a)}renderPositionedFgSegs(t,e,r,i,s,a){let{eventMaxStack:o,eventShortHeight:l,eventOrderStrict:c,eventMinHeight:d}=this.context.options,{date:u,slatCoords:h,eventSelection:f,todayRange:p,nowDate:m}=this.props,g=r||i||s,v=Xw(t,u,h,d),{segPlacements:T,hiddenGroups:k}=Q_(t,v,c,o);return b(ve,null,this.renderHiddenGroups(k,t),T.map(D=>{let{seg:M,rect:E}=D,C=M.eventRange.instance.instanceId,S=g||Boolean(!e[C]&&E),O=zf(E&&E.span),F=!g&&E?this.computeSegHStyle(E):{left:0,right:0},P=Boolean(E)&&E.stackForward>0,x=Boolean(E)&&E.span.end-E.span.start<l;return b("div",{className:"fc-timegrid-event-harness"+(P?" fc-timegrid-event-harness-inset":""),key:a||C,style:Object.assign(Object.assign({visibility:S?"":"hidden"},O),F)},b(nd,Object.assign({seg:M,isDragging:r,isResizing:i,isDateSelecting:s,isSelected:C===f,isShort:x},lr(M,p,m))))}))}renderHiddenGroups(t,e){let{extraDateSpan:r,dateProfile:i,todayRange:s,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c}=this.props;return b(ve,null,t.map(d=>{let u=zf(d.span),h=Z_(d.entries,e);return b(Xf,{key:Rc(Gc(h)),hiddenSegs:h,top:u.top,bottom:u.bottom,extraDateSpan:r,dateProfile:i,todayRange:s,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c})}))}renderFillSegs(t,e){let{props:r,context:i}=this,a=Xw(t,r.date,r.slatCoords,i.options.eventMinHeight).map((o,l)=>{let c=t[l];return b("div",{key:ho(c.eventRange),className:"fc-timegrid-bg-harness",style:zf(o)},e==="bg-event"?b(Wn,Object.assign({seg:c},lr(c,r.todayRange,r.nowDate))):bo(e))});return b(ve,null,a)}renderNowIndicator(t){let{slatCoords:e,date:r}=this.props;return e?t.map((i,s)=>b(wo,{key:s,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:e.computeDateTop(i.start,r)},isAxis:!1,date:r})):null}computeSegHStyle(t){let{isRtl:e,options:r}=this.context,i=r.slotEventOverlap,s=t.levelCoord,a=t.levelCoord+t.thickness,o,l;i&&(a=Math.min(1,s+(a-s)*2)),e?(o=1-a,l=s):(o=s,l=1-a);let c={zIndex:t.stackDepth+1,left:o*100+"%",right:l*100+"%"};return i&&!t.stackForward&&(c[e?"marginLeft":"marginRight"]=10*2),c}};function rb(n,{todayRange:t,nowDate:e,eventSelection:r,eventDrag:i,eventResize:s}){let a=(i?i.affectedInstances:null)||(s?s.affectedInstances:null)||{};return b(ve,null,n.map(o=>{let l=o.eventRange.instance.instanceId;return b("div",{key:l,style:{visibility:a[l]?"hidden":""}},b(nd,Object.assign({seg:o,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===r,isShort:!1},lr(o,t,e))))}))}function zf(n){return n?{top:n.start,bottom:-n.end}:{top:"",bottom:""}}function Z_(n,t){return n.map(e=>t[e.index])}var tp=class extends ue{constructor(){super(...arguments),this.splitFgEventSegs=$(So),this.splitBgEventSegs=$(So),this.splitBusinessHourSegs=$(So),this.splitNowIndicatorSegs=$(So),this.splitDateSelectionSegs=$(So),this.splitEventDrag=$(Zw),this.splitEventResize=$(Zw),this.rootElRef=Oe(),this.cellElRefs=new Ct}render(){let{props:t,context:e}=this,r=e.options.nowIndicator&&t.slatCoords&&t.slatCoords.safeComputeTop(t.nowDate),i=t.cells.length,s=this.splitFgEventSegs(t.fgEventSegs,i),a=this.splitBgEventSegs(t.bgEventSegs,i),o=this.splitBusinessHourSegs(t.businessHourSegs,i),l=this.splitNowIndicatorSegs(t.nowIndicatorSegs,i),c=this.splitDateSelectionSegs(t.dateSelectionSegs,i),d=this.splitEventDrag(t.eventDrag,i),u=this.splitEventResize(t.eventResize,i);return b("div",{className:"fc-timegrid-cols",ref:this.rootElRef},b("table",{role:"presentation",style:{minWidth:t.tableMinWidth,width:t.clientWidth}},t.tableColGroupNode,b("tbody",{role:"presentation"},b("tr",{role:"row"},t.axis&&b("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},b("div",{className:"fc-timegrid-col-frame"},b("div",{className:"fc-timegrid-now-indicator-container"},typeof r=="number"&&b(wo,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:r},isAxis:!0,date:t.nowDate})))),t.cells.map((h,f)=>b(ep,{key:h.key,elRef:this.cellElRefs.createRef(h.key),dateProfile:t.dateProfile,date:h.date,nowDate:t.nowDate,todayRange:t.todayRange,extraRenderProps:h.extraRenderProps,extraDataAttrs:h.extraDataAttrs,extraClassNames:h.extraClassNames,extraDateSpan:h.extraDateSpan,fgEventSegs:s[f],bgEventSegs:a[f],businessHourSegs:o[f],nowIndicatorSegs:l[f],dateSelectionSegs:c[f],eventDrag:d[f],eventResize:u[f],slatCoords:t.slatCoords,eventSelection:t.eventSelection,forPrint:t.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:t}=this;t.onColCoords&&t.clientWidth!==null&&t.onColCoords(new or(this.rootElRef.current,J_(this.cellElRefs.currentMap,t.cells),!0,!1))}};function J_(n,t){return t.map(e=>n[e.key])}var rp=class extends et{constructor(){super(...arguments),this.processSlotOptions=$(X_),this.state={slatCoords:null},this.handleRootEl=t=>{t?this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=t=>{let{onScrollTopRequest:e}=this.props,{slatCoords:r}=this.state;if(e&&r){if(t.time){let i=r.computeTimeTop(t.time);i=Math.ceil(i),i&&(i+=1),e(i)}return!0}return!1},this.handleColCoords=t=>{this.colCoords=t},this.handleSlatCoords=t=>{this.setState({slatCoords:t}),this.props.onSlatCoords&&this.props.onSlatCoords(t)}}render(){let{props:t,state:e}=this;return b("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:t.clientWidth,minWidth:t.tableMinWidth}},b(Jf,{axis:t.axis,dateProfile:t.dateProfile,slatMetas:t.slatMetas,clientWidth:t.clientWidth,minHeight:t.expandRows?t.clientHeight:"",tableMinWidth:t.tableMinWidth,tableColGroupNode:t.axis?t.tableColGroupNode:null,onCoords:this.handleSlatCoords}),b(tp,{cells:t.cells,axis:t.axis,dateProfile:t.dateProfile,businessHourSegs:t.businessHourSegs,bgEventSegs:t.bgEventSegs,fgEventSegs:t.fgEventSegs,dateSelectionSegs:t.dateSelectionSegs,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange,nowDate:t.nowDate,nowIndicatorSegs:t.nowIndicatorSegs,clientWidth:t.clientWidth,tableMinWidth:t.tableMinWidth,tableColGroupNode:t.tableColGroupNode,slatCoords:e.slatCoords,onColCoords:this.handleColCoords,forPrint:t.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(t){this.scrollResponder.update(t.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(t,e){let{dateEnv:r,options:i}=this.context,{colCoords:s}=this,{dateProfile:a}=this.props,{slatCoords:o}=this.state,{snapDuration:l,snapsPerSlot:c}=this.processSlotOptions(this.props.slotDuration,i.snapDuration),d=s.leftToIndex(t),u=o.positions.topToIndex(e);if(d!=null&&u!=null){let h=this.props.cells[d],f=o.positions.tops[u],p=o.positions.getHeight(u),m=(e-f)/p,g=Math.floor(m*c),v=u*c+g,T=this.props.cells[d].date,k=io(a.slotMinTime,zh(l,v)),D=r.add(T,k),M=r.add(D,l);return{dateProfile:a,dateSpan:Object.assign({range:{start:D,end:M},allDay:!1},h.extraDateSpan),dayEl:s.els[d],rect:{left:s.lefts[d],right:s.rights[d],top:f,bottom:f+p},layer:0}}return null}};function X_(n,t){let e=t||n,r=no(n,e);return r===null&&(e=n,r=1),{snapDuration:e,snapsPerSlot:r}}var ip=class extends Yn{sliceRange(t,e){let r=[];for(let i=0;i<e.length;i+=1){let s=Lt(t,e[i]);s&&r.push({start:s.start,end:s.end,isStart:s.start.valueOf()===t.start.valueOf(),isEnd:s.end.valueOf()===t.end.valueOf(),col:i})}return r}},np=class extends et{constructor(){super(...arguments),this.buildDayRanges=$(eM),this.slicer=new ip,this.timeColsRef=Oe()}render(){let{props:t,context:e}=this,{dateProfile:r,dayTableModel:i}=t,{nowIndicator:s,nextDayThreshold:a}=e.options,o=this.buildDayRanges(i,r,e.dateEnv);return b(qt,{unit:s?"minute":"day"},(l,c)=>b(rp,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(t,r,null,e,o),{forPrint:t.forPrint,axis:t.axis,dateProfile:r,slatMetas:t.slatMetas,slotDuration:t.slotDuration,cells:i.cells[0],tableColGroupNode:t.tableColGroupNode,tableMinWidth:t.tableMinWidth,clientWidth:t.clientWidth,clientHeight:t.clientHeight,expandRows:t.expandRows,nowDate:l,nowIndicatorSegs:s&&this.slicer.sliceNowDate(l,r,a,e,o),todayRange:c,onScrollTopRequest:t.onScrollTopRequest,onSlatCoords:t.onSlatCoords})))}};function eM(n,t,e){let r=[];for(let i of n.headerDates)r.push({start:e.add(i,t.slotMinTime),end:e.add(i,t.slotMaxTime)});return r}var eb=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function tM(n,t,e,r,i){let s=new Date(0),a=n,o=J(0),l=e||rM(r),c=[];for(;Rt(a)<Rt(t);){let d=i.add(s,a),u=no(o,l)!==null;c.push({date:d,time:a,key:d.toISOString(),isoTimeStr:Qh(d),isLabeled:u}),a=io(a,r),o=io(o,r)}return c}function rM(n){let t,e,r;for(t=eb.length-1;t>=0;t-=1)if(e=J(eb[t]),r=no(e,n),r!==null&&r>1)return e;return n}var sd=class extends Qf{constructor(){super(...arguments),this.buildTimeColsModel=$(iM),this.buildSlatMetas=$(tM)}render(){let{options:t,dateEnv:e,dateProfileGenerator:r}=this.context,{props:i}=this,{dateProfile:s}=i,a=this.buildTimeColsModel(s,r),o=this.allDaySplitter.splitProps(i),l=this.buildSlatMetas(s.slotMinTime,s.slotMaxTime,t.slotLabelInterval,t.slotDuration,e),{dayMinWidth:c}=t,d=!c,u=c,h=t.dayHeaders&&b(ri,{dates:a.headerDates,dateProfile:s,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),f=t.allDaySlot!==!1&&(m=>b(Do,Object.assign({},o.allDay,{dateProfile:s,dayTableModel:a,nextDayThreshold:t.nextDayThreshold,tableMinWidth:m.tableMinWidth,colGroupNode:m.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:m.clientWidth,clientHeight:m.clientHeight,forPrint:i.forPrint},this.getAllDayMaxEventProps()))),p=m=>b(np,Object.assign({},o.timed,{dayTableModel:a,dateProfile:s,axis:d,slotDuration:t.slotDuration,slatMetas:l,forPrint:i.forPrint,tableColGroupNode:m.tableColGroupNode,tableMinWidth:m.tableMinWidth,clientWidth:m.clientWidth,clientHeight:m.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:m.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return u?this.renderHScrollLayout(h,f,p,a.colCnt,c,l,this.state.slatCoords):this.renderSimpleLayout(h,f,p)}};function iM(n,t){let e=new Bn(n.renderRange,t);return new Hn(e,!1)}var nM='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';Li(nM);var sM={allDaySlot:Boolean},ib=xt({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:sM,views:{timeGrid:{component:sd,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});var ap=class extends et{constructor(){super(...arguments),this.buildDayTableModel=$(jf),this.slicer=new ko,this.state={labelId:ii()}}render(){let{props:t,state:e,context:r}=this,{dateProfile:i,forPrint:s}=t,{options:a}=r,o=this.buildDayTableModel(i,r.dateProfileGenerator),l=this.slicer.sliceProps(t,i,a.nextDayThreshold,r,o),c=t.tableWidth!=null?t.tableWidth/a.aspectRatio:null,d=o.cells.length,u=c!=null?c/d:null;return b("div",{ref:t.elRef,"data-date":t.isoDateStr,className:"fc-multimonth-month",style:{width:t.width},role:"grid","aria-labelledby":e.labelId},b("div",{className:"fc-multimonth-header",style:{marginBottom:u},role:"presentation"},b("div",{className:"fc-multimonth-title",id:e.labelId},r.dateEnv.format(t.dateProfile.currentRange.start,t.titleFormat)),b("table",{className:["fc-multimonth-header-table",r.theme.getClass("table")].join(" "),role:"presentation"},b("thead",{role:"rowgroup"},b(ri,{dateProfile:t.dateProfile,dates:o.headerDates,datesRepDistinctDays:!1})))),b("div",{className:["fc-multimonth-daygrid","fc-daygrid","fc-daygrid-body",!s&&"fc-daygrid-body-balanced",s&&"fc-daygrid-body-unbalanced",s&&"fc-daygrid-body-natural"].join(" "),style:{marginTop:-u}},b("table",{className:["fc-multimonth-daygrid-table",r.theme.getClass("table")].join(" "),style:{height:s?"":c},role:"presentation"},b("tbody",{role:"rowgroup"},b(Eo,Object.assign({},l,{dateProfile:i,cells:o.cells,eventSelection:t.eventSelection,dayMaxEvents:!s,dayMaxEventRows:!s,showWeekNumbers:a.weekNumbers,clientWidth:t.clientWidth,clientHeight:t.clientHeight,forPrint:s}))))))}},op=class extends et{constructor(){super(...arguments),this.splitDateProfileByMonth=$(oM),this.buildMonthFormat=$(dM),this.scrollElRef=Oe(),this.firstMonthElRef=Oe(),this.needsScrollReset=!1,this.handleSizing=t=>{t&&this.updateSize()}}render(){let{context:t,props:e,state:r}=this,{options:i}=t,{clientWidth:s,clientHeight:a}=r,o=r.monthHPadding||0,l=Math.min(s!=null?Math.floor(s/(i.multiMonthMinWidth+o)):1,i.multiMonthMaxColumns)||1,c=100/l+"%",d=s==null?null:s/l-o,u=s!=null&&l===1,h=this.splitDateProfileByMonth(t.dateProfileGenerator,e.dateProfile,t.dateEnv,u?!1:i.fixedWeekCount,i.showNonCurrentDates),f=this.buildMonthFormat(i.multiMonthTitleFormat,h),p=["fc-multimonth",u?"fc-multimonth-singlecol":"fc-multimonth-multicol",d!=null&&d<400?"fc-multimonth-compact":"",e.isHeightAuto?"":"fc-scroller"];return b(sr,{elRef:this.scrollElRef,elClasses:p,viewSpec:t.viewSpec},h.map((m,g)=>{let v=Ms(m.currentRange.start);return b(ap,Object.assign({},e,{key:v,isoDateStr:v,elRef:g===0?this.firstMonthElRef:void 0,titleFormat:f,dateProfile:m,width:c,tableWidth:d,clientWidth:s,clientHeight:a}))}))}componentDidMount(){this.updateSize(),this.context.addResizeHandler(this.handleSizing),this.requestScrollReset()}componentDidUpdate(t){wt(t,this.props)||this.handleSizing(!1),t.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}updateSize(){let t=this.scrollElRef.current,e=this.firstMonthElRef.current;t&&this.setState({clientWidth:t.clientWidth,clientHeight:t.clientHeight}),e&&t&&this.state.monthHPadding==null&&this.setState({monthHPadding:t.clientWidth-e.firstChild.offsetWidth})}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.state.monthHPadding!=null){let{currentDate:t}=this.props.dateProfile,e=this.scrollElRef.current,r=e.querySelector(`[data-date="${Ms(t)}"]`);e.scrollTop=r.getBoundingClientRect().top-this.firstMonthElRef.current.getBoundingClientRect().top,this.needsScrollReset=!1}}shouldComponentUpdate(){return!0}},aM=J(1,"month");function oM(n,t,e,r,i){let{start:s,end:a}=t.currentRange,o=s,l=[];for(;o.valueOf()<a.valueOf();){let c=e.add(o,aM),d={start:n.skipHiddenDays(o),end:n.skipHiddenDays(c,-1,!0)},u=$f({currentRange:d,snapToWeek:!0,fixedWeekCount:r,dateEnv:e});u={start:n.skipHiddenDays(u.start),end:n.skipHiddenDays(u.end,-1,!0)};let h=t.activeRange?Lt(t.activeRange,i?u:d):null;l.push({currentDate:t.currentDate,isValid:t.isValid,validRange:t.validRange,renderRange:u,activeRange:h,currentRange:d,currentRangeUnit:"month",isRangeAllDay:!0,dateIncrement:t.dateIncrement,slotMinTime:t.slotMaxTime,slotMaxTime:t.slotMinTime}),o=c}return l}var lM=be({year:"numeric",month:"long"}),cM=be({month:"long"});function dM(n,t){return n||(t[0].currentRange.start.getUTCFullYear()!==t[t.length-1].currentRange.start.getUTCFullYear()?lM:cM)}var uM={multiMonthTitleFormat:be,multiMonthMaxColumns:Number,multiMonthMinWidth:Number},hM=".fc .fc-multimonth{border:1px solid var(--fc-border-color);display:flex;flex-wrap:wrap;overflow-x:hidden;overflow-y:auto}.fc .fc-multimonth-title{font-size:1.2em;font-weight:700;padding:1em 0;text-align:center}.fc .fc-multimonth-daygrid{background:var(--fc-page-bg-color)}.fc .fc-multimonth-daygrid-table,.fc .fc-multimonth-header-table{table-layout:fixed;width:100%}.fc .fc-multimonth-daygrid-table{border-top-style:hidden!important}.fc .fc-multimonth-singlecol .fc-multimonth{position:relative}.fc .fc-multimonth-singlecol .fc-multimonth-header{background:var(--fc-page-bg-color);position:relative;top:0;z-index:2}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid{position:relative;z-index:1}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid-table,.fc .fc-multimonth-singlecol .fc-multimonth-header-table{border-left-style:hidden;border-right-style:hidden}.fc .fc-multimonth-singlecol .fc-multimonth-month:last-child .fc-multimonth-daygrid-table{border-bottom-style:hidden}.fc .fc-multimonth-multicol{line-height:1}.fc .fc-multimonth-multicol .fc-multimonth-month{padding:0 1.2em 1.2em}.fc .fc-multimonth-multicol .fc-daygrid-more-link{border:1px solid var(--fc-event-border-color);display:block;float:none;padding:1px}.fc .fc-multimonth-compact{line-height:1}.fc .fc-multimonth-compact .fc-multimonth-daygrid-table,.fc .fc-multimonth-compact .fc-multimonth-header-table{font-size:.9em}.fc-media-screen .fc-multimonth-singlecol .fc-multimonth-header{position:sticky}.fc-media-print .fc-multimonth{overflow:visible}";Li(hM);var nb=xt({name:"@fullcalendar/multimonth",initialView:"multiMonthYear",optionRefiners:uM,views:{multiMonth:{component:op,dateProfileGeneratorClass:Bs,multiMonthMinWidth:350,multiMonthMaxColumns:3},multiMonthYear:{type:"multiMonth",duration:{years:1},fixedWeekCount:!0,showNonCurrentDates:!1}}});Os.touchMouseIgnoreWait=500;var lp=0,ad=0,cp=!1,od=class{constructor(t){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=e=>{if(!this.shouldIgnoreMouse()&&fM(e)&&this.tryStart(e)){let r=this.createEventFromMouse(e,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=e=>{let r=this.createEventFromMouse(e);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleMouseUp=e=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(e)),this.cleanup()},this.handleTouchStart=e=>{if(this.tryStart(e)){this.isTouchDragging=!0;let r=this.createEventFromTouch(e,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r);let i=e.target;this.shouldIgnoreMove||i.addEventListener("touchmove",this.handleTouchMove),i.addEventListener("touchend",this.handleTouchEnd),i.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=e=>{let r=this.createEventFromTouch(e);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleTouchEnd=e=>{if(this.isDragging){let r=e.target;r.removeEventListener("touchmove",this.handleTouchMove),r.removeEventListener("touchend",this.handleTouchEnd),r.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(e)),this.cleanup(),this.isTouchDragging=!1,pM()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=e=>{if(!this.shouldIgnoreMove){let r=window.scrollX-this.prevScrollX+this.prevPageX,i=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:e,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:r,pageY:i,deltaX:r-this.origPageX,deltaY:i-this.origPageY})}},this.containerEl=t,this.emitter=new ti,t.addEventListener("mousedown",this.handleMouseDown),t.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),mM()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),gM()}tryStart(t){let e=this.querySubjectEl(t),r=t.target;return e&&(!this.handleSelector||ze(r,this.handleSelector))?(this.subjectEl=e,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){cp=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(t){return this.selector?ze(t.target,this.selector):this.containerEl}shouldIgnoreMouse(){return lp||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(cp=!0)}initScrollWatch(t){this.shouldWatchScroll&&(this.recordCoords(t),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(t){this.shouldWatchScroll&&(this.prevPageX=t.pageX,this.prevPageY=t.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(t,e){let r=0,i=0;return e?(this.origPageX=t.pageX,this.origPageY=t.pageY):(r=t.pageX-this.origPageX,i=t.pageY-this.origPageY),{origEvent:t,isTouch:!1,subjectEl:this.subjectEl,pageX:t.pageX,pageY:t.pageY,deltaX:r,deltaY:i}}createEventFromTouch(t,e){let r=t.touches,i,s,a=0,o=0;return r&&r.length?(i=r[0].pageX,s=r[0].pageY):(i=t.pageX,s=t.pageY),e?(this.origPageX=i,this.origPageY=s):(a=i-this.origPageX,o=s-this.origPageY),{origEvent:t,isTouch:!0,subjectEl:this.subjectEl,pageX:i,pageY:s,deltaX:a,deltaY:o}}};function fM(n){return n.button===0&&!n.ctrlKey}function pM(){lp+=1,setTimeout(()=>{lp-=1},Os.touchMouseIgnoreWait)}function mM(){ad+=1,ad===1&&window.addEventListener("touchmove",ab,{passive:!1})}function gM(){ad-=1,ad||window.removeEventListener("touchmove",ab,{passive:!1})}function ab(n){cp&&n.preventDefault()}var dp=class{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(t,e,r){this.sourceEl=t,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=e-window.scrollX,this.origScreenY=r-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(t,e){this.deltaX=t-window.scrollX-this.origScreenX,this.deltaY=e-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(t){t?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=t,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=t)}stop(t,e){let r=()=>{this.cleanup(),e()};t&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(r,this.revertDuration):setTimeout(r,0)}doRevertAnimation(t,e){let r=this.mirrorEl,i=this.sourceEl.getBoundingClientRect();r.style.transition="top "+e+"ms,left "+e+"ms",$n(r,{left:i.left,top:i.top}),Yh(r,()=>{r.style.transition="",t()})}cleanup(){this.mirrorEl&&(to(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&$n(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let t=this.sourceElRect,e=this.mirrorEl;return e||(e=this.mirrorEl=this.sourceEl.cloneNode(!0),e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.pointerEvents="none",e.classList.add("fc-event-dragging"),$n(e,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:t.right-t.left,height:t.bottom-t.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(e)),e}},ld=class extends Ln{constructor(t,e){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=t,this.doesListening=e,this.scrollTop=this.origScrollTop=t.getScrollTop(),this.scrollLeft=this.origScrollLeft=t.getScrollLeft(),this.scrollWidth=t.getScrollWidth(),this.scrollHeight=t.getScrollHeight(),this.clientWidth=t.getClientWidth(),this.clientHeight=t.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(t){this.scrollController.setScrollTop(t),this.doesListening||(this.scrollTop=Math.max(Math.min(t,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(t){this.scrollController.setScrollLeft(t),this.doesListening||(this.scrollLeft=Math.max(Math.min(t,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}},cd=class extends ld{constructor(t,e){super(new Ka(t),e)}getEventTarget(){return this.scrollController.el}computeClientRect(){return Df(this.scrollController.el)}},up=class extends ld{constructor(t){super(new Za,t)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}},sb=typeof performance=="function"?performance.now:Date.now,hp=class{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let t=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(t){let e=sb();this.handleSide(t,(e-this.msSinceRequest)/1e3),this.requestAnimation(e)}else this.isAnimating=!1}}}start(t,e,r){this.isEnabled&&(this.scrollCaches=this.buildCaches(r),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(t,e))}handleMove(t,e){if(this.isEnabled){let r=t-window.scrollX,i=e-window.scrollY,s=this.pointerScreenY===null?0:i-this.pointerScreenY,a=this.pointerScreenX===null?0:r-this.pointerScreenX;s<0?this.everMovedUp=!0:s>0&&(this.everMovedDown=!0),a<0?this.everMovedLeft=!0:a>0&&(this.everMovedRight=!0),this.pointerScreenX=r,this.pointerScreenY=i,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(sb()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let t of this.scrollCaches)t.destroy();this.scrollCaches=null}}requestAnimation(t){this.msSinceRequest=t,requestAnimationFrame(this.animate)}handleSide(t,e){let{scrollCache:r}=t,{edgeThreshold:i}=this,s=i-t.distance,a=s*s/(i*i)*this.maxVelocity*e,o=1;switch(t.name){case"left":o=-1;case"right":r.setScrollLeft(r.getScrollLeft()+a*o);break;case"top":o=-1;case"bottom":r.setScrollTop(r.getScrollTop()+a*o);break}}computeBestEdge(t,e){let{edgeThreshold:r}=this,i=null,s=this.scrollCaches||[];for(let a of s){let o=a.clientRect,l=t-o.left,c=o.right-t,d=e-o.top,u=o.bottom-e;l>=0&&c>=0&&d>=0&&u>=0&&(d<=r&&this.everMovedUp&&a.canScrollUp()&&(!i||i.distance>d)&&(i={scrollCache:a,name:"top",distance:d}),u<=r&&this.everMovedDown&&a.canScrollDown()&&(!i||i.distance>u)&&(i={scrollCache:a,name:"bottom",distance:u}),l<=r&&this.everMovedLeft&&a.canScrollLeft()&&(!i||i.distance>l)&&(i={scrollCache:a,name:"left",distance:l}),c<=r&&this.everMovedRight&&a.canScrollRight()&&(!i||i.distance>c)&&(i={scrollCache:a,name:"right",distance:c}))}return i}buildCaches(t){return this.queryScrollEls(t).map(e=>e===window?new up(!1):new cd(e,!1))}queryScrollEls(t){let e=[];for(let r of this.scrollQuery)typeof r=="object"?e.push(r):e.push(...Array.prototype.slice.call(t.getRootNode().querySelectorAll(r)));return e}},Bi=class extends eo{constructor(t,e){super(t),this.containerEl=t,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=i=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,Uh(document.body),Wh(document.body),i.isTouch||i.origEvent.preventDefault(),this.emitter.trigger("pointerdown",i),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(i.subjectEl,i.pageX,i.pageY),this.startDelay(i),this.minDistance||this.handleDistanceSurpassed(i)))},this.onPointerMove=i=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",i),!this.isDistanceSurpassed){let s=this.minDistance,a,{deltaX:o,deltaY:l}=i;a=o*o+l*l,a>=s*s&&this.handleDistanceSurpassed(i)}this.isDragging&&(i.origEvent.type!=="scroll"&&(this.mirror.handleMove(i.pageX,i.pageY),this.autoScroller.handleMove(i.pageX,i.pageY)),this.emitter.trigger("dragmove",i))}},this.onPointerUp=i=>{this.isInteracting&&(this.isInteracting=!1,Vh(document.body),jh(document.body),this.emitter.trigger("pointerup",i),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(i)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let r=this.pointer=new od(t);r.emitter.on("pointerdown",this.onPointerDown),r.emitter.on("pointermove",this.onPointerMove),r.emitter.on("pointerup",this.onPointerUp),e&&(r.selector=e),this.mirror=new dp,this.autoScroller=new hp}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(t){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(t)},this.delay):this.handleDelayEnd(t)}handleDelayEnd(t){this.isDelayEnded=!0,this.tryStartDrag(t)}handleDistanceSurpassed(t){this.isDistanceSurpassed=!0,this.tryStartDrag(t)}tryStartDrag(t){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(t.pageX,t.pageY,this.containerEl),this.emitter.trigger("dragstart",t),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(t){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,t))}stopDrag(t){this.isDragging=!1,this.emitter.trigger("dragend",t)}setIgnoreMove(t){this.pointer.shouldIgnoreMove=t}setMirrorIsVisible(t){this.mirror.setIsVisible(t)}setMirrorNeedsRevert(t){this.mirrorNeedsRevert=t}setAutoScrollEnabled(t){this.autoScroller.isEnabled=t}},fp=class{constructor(t){this.el=t,this.origRect=po(t),this.scrollCaches=qc(t).map(e=>new cd(e,!0))}destroy(){for(let t of this.scrollCaches)t.destroy()}computeLeft(){let t=this.origRect.left;for(let e of this.scrollCaches)t+=e.origScrollLeft-e.getScrollLeft();return t}computeTop(){let t=this.origRect.top;for(let e of this.scrollCaches)t+=e.origScrollTop-e.getScrollTop();return t}isWithinClipping(t,e){let r={left:t,top:e};for(let i of this.scrollCaches)if(!yM(i.getEventTarget())&&!wf(r,i.clientRect))return!1;return!0}};function yM(n){let t=n.tagName;return t==="HTML"||t==="BODY"}var Qn=class{constructor(t,e){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=r=>{let{dragging:i}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(r),this.initialHit||!this.requireInitial?(i.setIgnoreMove(!1),this.emitter.trigger("pointerdown",r)):i.setIgnoreMove(!0)},this.handleDragStart=r=>{this.emitter.trigger("dragstart",r),this.handleMove(r,!0)},this.handleDragMove=r=>{this.emitter.trigger("dragmove",r),this.handleMove(r)},this.handlePointerUp=r=>{this.releaseHits(),this.emitter.trigger("pointerup",r)},this.handleDragEnd=r=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,r),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",r)},this.droppableStore=e,t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragstart",this.handleDragStart),t.emitter.on("dragmove",this.handleDragMove),t.emitter.on("pointerup",this.handlePointerUp),t.emitter.on("dragend",this.handleDragEnd),this.dragging=t,this.emitter=new ti}processFirstCoord(t){let e={left:t.pageX,top:t.pageY},r=e,i=t.subjectEl,s;i instanceof HTMLElement&&(s=po(i),r=bf(r,s));let a=this.initialHit=this.queryHitForOffset(r.left,r.top);if(a){if(this.useSubjectCenter&&s){let o=$c(s,a.rect);o&&(r=Tf(o))}this.coordAdjust=Ef(r,e)}else this.coordAdjust={left:0,top:0}}handleMove(t,e){let r=this.queryHitForOffset(t.pageX+this.coordAdjust.left,t.pageY+this.coordAdjust.top);(e||!ud(this.movingHit,r))&&(this.movingHit=r,this.emitter.trigger("hitupdate",r,!1,t))}prepareHits(){this.offsetTrackers=zt(this.droppableStore,t=>(t.component.prepareHits(),new fp(t.el)))}releaseHits(){let{offsetTrackers:t}=this;for(let e in t)t[e].destroy();this.offsetTrackers={}}queryHitForOffset(t,e){let{droppableStore:r,offsetTrackers:i}=this,s=null;for(let a in r){let o=r[a].component,l=i[a];if(l&&l.isWithinClipping(t,e)){let c=l.computeLeft(),d=l.computeTop(),u=t-c,h=e-d,{origRect:f}=l,p=f.right-f.left,m=f.bottom-f.top;if(u>=0&&u<p&&h>=0&&h<m){let g=o.queryHit(u,h,p,m);g&&Is(g.dateProfile.activeRange,g.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(u+c-window.scrollX,h+d-window.scrollY)))&&(!s||g.layer>s.layer)&&(g.componentId=a,g.context=o.context,g.rect.left+=c,g.rect.right+=c,g.rect.top+=d,g.rect.bottom+=d,s=g)}}}return s}};function ud(n,t){return!n&&!t?!0:Boolean(n)!==Boolean(t)?!1:pf(n.dateSpan,t.dateSpan)}function wp(n,t){let e={};for(let r of t.pluginHooks.datePointTransforms)Object.assign(e,r(n,t));return Object.assign(e,vM(n,t.dateEnv)),e}function vM(n,t){return{date:t.toDate(n.range.start),dateStr:t.formatIso(n.range.start,{omitTime:n.allDay}),allDay:n.allDay}}var pp=class extends ar{constructor(t){super(t),this.handlePointerDown=r=>{let{dragging:i}=this,s=r.origEvent.target;i.setIgnoreMove(!this.component.isValidDateDownEl(s))},this.handleDragEnd=r=>{let{component:i}=this,{pointer:s}=this.dragging;if(!s.wasTouchScroll){let{initialHit:a,finalHit:o}=this.hitDragging;if(a&&o&&ud(a,o)){let{context:l}=i,c=Object.assign(Object.assign({},wp(a.dateSpan,l)),{dayEl:a.dayEl,jsEvent:r.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",c)}}},this.dragging=new Bi(t.el),this.dragging.autoScroller.isEnabled=!1;let e=this.hitDragging=new Qn(this.dragging,fo(t));e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},mp=class extends ar{constructor(t){super(t),this.dragSelection=null,this.handlePointerDown=a=>{let{component:o,dragging:l}=this,{options:c}=o.context,d=c.selectable&&o.isValidDateDownEl(a.origEvent.target);l.setIgnoreMove(!d),l.delay=a.isTouch?wM(o):null},this.handleDragStart=a=>{this.component.context.calendarApi.unselect(a)},this.handleHitUpdate=(a,o)=>{let{context:l}=this.component,c=null,d=!1;if(a){let u=this.hitDragging.initialHit;a.componentId===u.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(u,a)||(c=bM(u,a,l.pluginHooks.dateSelectionTransformers)),(!c||!Cf(c,a.dateProfile,l))&&(d=!0,c=null)}c?l.dispatch({type:"SELECT_DATES",selection:c}):o||l.dispatch({type:"UNSELECT_DATES"}),d?Cs():xs(),o||(this.dragSelection=c)},this.handlePointerUp=a=>{this.dragSelection&&(Vc(this.dragSelection,a,this.component.context),this.dragSelection=null)};let{component:e}=t,{options:r}=e.context,i=this.dragging=new Bi(t.el);i.touchScrollAllowed=!1,i.minDistance=r.selectMinDistance||0,i.autoScroller.isEnabled=r.dragScroll;let s=this.hitDragging=new Qn(this.dragging,fo(t));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}};function wM(n){let{options:t}=n.context,e=t.selectLongPressDelay;return e==null&&(e=t.longPressDelay),e}function bM(n,t,e){let r=n.dateSpan,i=t.dateSpan,s=[r.range.start,r.range.end,i.range.start,i.range.end];s.sort($h);let a={};for(let o of e){let l=o(n,t);if(l===!1)return null;l&&Object.assign(a,l)}return a.range={start:s[0],end:s[3]},a.allDay=r.allDay,a}var Kn=class extends ar{constructor(t){super(t),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=a=>{let o=a.origEvent.target,{component:l,dragging:c}=this,{mirror:d}=c,{options:u}=l.context,h=l.context;this.subjectEl=a.subjectEl;let f=this.subjectSeg=ai(a.subjectEl),m=(this.eventRange=f.eventRange).instance.instanceId;this.relevantEvents=lo(h.getCurrentData().eventStore,m),c.minDistance=a.isTouch?0:u.eventDragMinDistance,c.delay=a.isTouch&&m!==l.props.eventSelection?EM(l):null,u.fixedMirrorParent?d.parentNode=u.fixedMirrorParent:d.parentNode=ze(o,".fc"),d.revertDuration=u.dragRevertDuration;let g=l.isValidSegDownEl(o)&&!ze(o,".fc-event-resizer");c.setIgnoreMove(!g),this.isDragging=g&&a.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=a=>{let o=this.component.context,l=this.eventRange,c=l.instance.instanceId;a.isTouch?c!==this.component.props.eventSelection&&o.dispatch({type:"SELECT_EVENT",eventInstanceId:c}):o.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(o.calendarApi.unselect(a),o.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new De(o,l.def,l.instance),jsEvent:a.origEvent,view:o.viewApi}))},this.handleHitUpdate=(a,o)=>{if(!this.isDragging)return;let l=this.relevantEvents,c=this.hitDragging.initialHit,d=this.component.context,u=null,h=null,f=null,p=!1,m={affectedEvents:l,mutatedEvents:Ge(),isEvent:!0};if(a){u=a.context;let g=u.options;d===u||g.editable&&g.droppable?(h=TM(c,a,this.eventRange.instance.range.start,u.getCurrentData().pluginHooks.eventDragMutationMassagers),h&&(f=co(l,u.getCurrentData().eventUiBases,h,u),m.mutatedEvents=f,yo(m,a.dateProfile,u)||(p=!0,h=null,f=null,m.mutatedEvents=Ge()))):u=null}this.displayDrag(u,m),p?Cs():xs(),o||(d===u&&ud(c,a)&&(h=null),this.dragging.setMirrorNeedsRevert(!h),this.dragging.setMirrorIsVisible(!a||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=u,this.validMutation=h,this.mutatedRelevantEvents=f)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=a=>{if(this.isDragging){let o=this.component.context,l=o.viewApi,{receivingContext:c,validMutation:d}=this,u=this.eventRange.def,h=this.eventRange.instance,f=new De(o,u,h),p=this.relevantEvents,m=this.mutatedRelevantEvents,{finalHit:g}=this.hitDragging;if(this.clearDrag(),o.emitter.trigger("eventDragStop",{el:this.subjectEl,event:f,jsEvent:a.origEvent,view:l}),d){if(c===o){let v=new De(o,m.defs[u.defId],h?m.instances[h.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:m});let T={oldEvent:f,event:v,relatedEvents:xr(m,o,h),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:p})}},k={};for(let D of o.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(k,D(d,o));o.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},T),k),{el:a.subjectEl,delta:d.datesDelta,jsEvent:a.origEvent,view:l})),o.emitter.trigger("eventChange",T)}else if(c){let v={event:f,relatedEvents:xr(p,o,h),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:p})}};o.emitter.trigger("eventLeave",Object.assign(Object.assign({},v),{draggedEl:a.subjectEl,view:l})),o.dispatch({type:"REMOVE_EVENTS",eventStore:p}),o.emitter.trigger("eventRemove",v);let T=m.defs[u.defId],k=m.instances[h.instanceId],D=new De(c,T,k);c.dispatch({type:"MERGE_EVENTS",eventStore:m});let M={event:D,relatedEvents:xr(m,c,k),revert(){c.dispatch({type:"REMOVE_EVENTS",eventStore:m})}};c.emitter.trigger("eventAdd",M),a.isTouch&&c.dispatch({type:"SELECT_EVENT",eventInstanceId:h.instanceId}),c.emitter.trigger("drop",Object.assign(Object.assign({},wp(g.dateSpan,c)),{draggedEl:a.subjectEl,jsEvent:a.origEvent,view:g.context.viewApi})),c.emitter.trigger("eventReceive",Object.assign(Object.assign({},M),{draggedEl:a.subjectEl,view:g.context.viewApi}))}}else o.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:e}=this,{options:r}=e.context,i=this.dragging=new Bi(t.el);i.pointer.selector=Kn.SELECTOR,i.touchScrollAllowed=!1,i.autoScroller.isEnabled=r.dragScroll;let s=this.hitDragging=new Qn(this.dragging,zn);s.useSubjectCenter=t.useEventCenter,s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("pointerup",this.handlePointerUp),s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(t,e){let r=this.component.context,i=this.receivingContext;i&&i!==t&&(i===r?i.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:e.affectedEvents,mutatedEvents:Ge(),isEvent:!0}}):i.dispatch({type:"UNSET_EVENT_DRAG"})),t&&t.dispatch({type:"SET_EVENT_DRAG",state:e})}clearDrag(){let t=this.component.context,{receivingContext:e}=this;e&&e.dispatch({type:"UNSET_EVENT_DRAG"}),t!==e&&t.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}};Kn.SELECTOR=".fc-event-draggable, .fc-event-resizable";function TM(n,t,e,r){let i=n.dateSpan,s=t.dateSpan,a=i.range.start,o=s.range.start,l={};i.allDay!==s.allDay&&(l.allDay=s.allDay,l.hasEnd=t.context.options.allDayMaintainDuration,s.allDay?a=ke(e):a=e);let c=Ni(a,o,n.context.dateEnv,n.componentId===t.componentId?n.largeUnit:null);c.milliseconds&&(l.allDay=!1);let d={datesDelta:c,standardProps:l};for(let u of r)u(d,n,t);return d}function EM(n){let{options:t}=n.context,e=t.eventLongPressDelay;return e==null&&(e=t.longPressDelay),e}var gp=class extends ar{constructor(t){super(t),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=s=>{let{component:a}=this,o=this.querySegEl(s),l=ai(o),c=this.eventRange=l.eventRange;this.dragging.minDistance=a.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(s.origEvent.target)||s.isTouch&&this.component.props.eventSelection!==c.instance.instanceId)},this.handleDragStart=s=>{let{context:a}=this.component,o=this.eventRange;this.relevantEvents=lo(a.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(s);this.draggingSegEl=l,this.draggingSeg=ai(l),a.calendarApi.unselect(),a.emitter.trigger("eventResizeStart",{el:l,event:new De(a,o.def,o.instance),jsEvent:s.origEvent,view:a.viewApi})},this.handleHitUpdate=(s,a,o)=>{let{context:l}=this.component,c=this.relevantEvents,d=this.hitDragging.initialHit,u=this.eventRange.instance,h=null,f=null,p=!1,m={affectedEvents:c,mutatedEvents:Ge(),isEvent:!0};s&&(s.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,s)||(h=kM(d,s,o.subjectEl.classList.contains("fc-event-resizer-start"),u.range))),h&&(f=co(c,l.getCurrentData().eventUiBases,h,l),m.mutatedEvents=f,yo(m,s.dateProfile,l)||(p=!0,h=null,f=null,m.mutatedEvents=null)),f?l.dispatch({type:"SET_EVENT_RESIZE",state:m}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),p?Cs():xs(),a||(h&&ud(d,s)&&(h=null),this.validMutation=h,this.mutatedRelevantEvents=f)},this.handleDragEnd=s=>{let{context:a}=this.component,o=this.eventRange.def,l=this.eventRange.instance,c=new De(a,o,l),d=this.relevantEvents,u=this.mutatedRelevantEvents;if(a.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:c,jsEvent:s.origEvent,view:a.viewApi}),this.validMutation){let h=new De(a,u.defs[o.defId],l?u.instances[l.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:u});let f={oldEvent:c,event:h,relatedEvents:xr(u,a,l),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:d})}};a.emitter.trigger("eventResize",Object.assign(Object.assign({},f),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||J(0),endDelta:this.validMutation.endDelta||J(0),jsEvent:s.origEvent,view:a.viewApi})),a.emitter.trigger("eventChange",f)}else a.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:e}=t,r=this.dragging=new Bi(t.el);r.pointer.selector=".fc-event-resizer",r.touchScrollAllowed=!1,r.autoScroller.isEnabled=e.context.options.dragScroll;let i=this.hitDragging=new Qn(this.dragging,fo(t));i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(t){return ze(t.subjectEl,".fc-event")}};function kM(n,t,e,r){let i=n.context.dateEnv,s=n.dateSpan.range.start,a=t.dateSpan.range.start,o=Ni(s,a,i,n.largeUnit);if(e){if(i.add(r.start,o)<r.end)return{startDelta:o}}else if(i.add(r.end,o)>r.start)return{endDelta:o};return null}var yp=class{constructor(t){this.context=t,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=r=>{r.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=r=>{let i=this.context.options.unselectCancel,s=Nc(r.origEvent);this.matchesCancel=!!ze(s,i),this.matchesEvent=!!ze(s,Kn.SELECTOR)},this.onDocumentPointerUp=r=>{let{context:i}=this,{documentPointer:s}=this,a=i.getCurrentData();if(!s.wasTouchScroll){if(a.dateSelection&&!this.isRecentPointerDateSelect){let o=i.options.unselectAuto;o&&(!o||!this.matchesCancel)&&i.calendarApi.unselect(r)}a.eventSelection&&!this.matchesEvent&&i.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let e=this.documentPointer=new od(document);e.shouldIgnoreMove=!0,e.shouldWatchScroll=!1,e.emitter.on("pointerdown",this.onDocumentPointerDown),e.emitter.on("pointerup",this.onDocumentPointerUp),t.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}},DM={fixedMirrorParent:A},SM={dateClick:A,eventDragStart:A,eventDragStop:A,eventDrop:A,eventResizeStart:A,eventResizeStop:A,eventResize:A,drop:A,eventReceive:A,eventLeave:A},vp=class{constructor(t,e){this.receivingContext=null,this.droppableEvent=null,this.suppliedDragMeta=null,this.dragMeta=null,this.handleDragStart=i=>{this.dragMeta=this.buildDragMeta(i.subjectEl)},this.handleHitUpdate=(i,s,a)=>{let{dragging:o}=this.hitDragging,l=null,c=null,d=!1,u={affectedEvents:Ge(),mutatedEvents:Ge(),isEvent:this.dragMeta.create};i&&(l=i.context,this.canDropElOnCalendar(a.subjectEl,l)&&(c=CM(i.dateSpan,this.dragMeta,l),u.mutatedEvents=Rn(c),d=!yo(u,i.dateProfile,l),d&&(u.mutatedEvents=Ge(),c=null))),this.displayDrag(l,u),o.setMirrorIsVisible(s||!c||!document.querySelector(".fc-event-mirror")),d?Cs():xs(),s||(o.setMirrorNeedsRevert(!c),this.receivingContext=l,this.droppableEvent=c)},this.handleDragEnd=i=>{let{receivingContext:s,droppableEvent:a}=this;if(this.clearDrag(),s&&a){let o=this.hitDragging.finalHit,l=o.context.viewApi,c=this.dragMeta;if(s.emitter.trigger("drop",Object.assign(Object.assign({},wp(o.dateSpan,s)),{draggedEl:i.subjectEl,jsEvent:i.origEvent,view:l})),c.create){let d=Rn(a);s.dispatch({type:"MERGE_EVENTS",eventStore:d}),i.isTouch&&s.dispatch({type:"SELECT_EVENT",eventInstanceId:a.instance.instanceId}),s.emitter.trigger("eventReceive",{event:new De(s,a.def,a.instance),relatedEvents:[],revert(){s.dispatch({type:"REMOVE_EVENTS",eventStore:d})},draggedEl:i.subjectEl,view:l})}}this.receivingContext=null,this.droppableEvent=null};let r=this.hitDragging=new Qn(t,zn);r.requireInitial=!1,r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("dragend",this.handleDragEnd),this.suppliedDragMeta=e}buildDragMeta(t){return typeof this.suppliedDragMeta=="object"?go(this.suppliedDragMeta):typeof this.suppliedDragMeta=="function"?go(this.suppliedDragMeta(t)):xM(t)}displayDrag(t,e){let r=this.receivingContext;r&&r!==t&&r.dispatch({type:"UNSET_EVENT_DRAG"}),t&&t.dispatch({type:"SET_EVENT_DRAG",state:e})}clearDrag(){this.receivingContext&&this.receivingContext.dispatch({type:"UNSET_EVENT_DRAG"})}canDropElOnCalendar(t,e){let r=e.options.dropAccept;return typeof r=="function"?r.call(e.calendarApi,t):typeof r=="string"&&r?Boolean(Pc(t,r)):!0}};function CM(n,t,e){let r=Object.assign({},t.leftoverProps);for(let d of e.pluginHooks.externalDefTransforms)Object.assign(r,d(n,t));let{refined:i,extra:s}=oo(r,e),a=Ss(i,s,t.sourceId,n.allDay,e.options.forceEventDuration||Boolean(t.duration),e),o=n.range.start;n.allDay&&t.startTime&&(o=e.dateEnv.add(o,t.startTime));let l=t.duration?e.dateEnv.add(o,t.duration):za(n.allDay,o,e),c=Ps(a.defId,{start:o,end:l});return{def:a,instance:c}}function xM(n){let t=_M(n,"event"),e=t?JSON.parse(t):{create:!1};return go(e)}Os.dataAttrPrefix="";function _M(n,t){let e=Os.dataAttrPrefix,r=(e?e+"-":"")+t;return n.getAttribute("data-"+r)||""}var dd=class{constructor(t,e={}){this.handlePointerDown=i=>{let{dragging:s}=this,{minDistance:a,longPressDelay:o}=this.settings;s.minDistance=a!=null?a:i.isTouch?0:Cr.eventDragMinDistance,s.delay=i.isTouch?o!=null?o:Cr.longPressDelay:0},this.handleDragStart=i=>{i.isTouch&&this.dragging.delay&&i.subjectEl.classList.contains("fc-event")&&this.dragging.mirror.getMirrorEl().classList.add("fc-event-selected")},this.settings=e;let r=this.dragging=new Bi(t);r.touchScrollAllowed=!1,e.itemSelector!=null&&(r.pointer.selector=e.itemSelector),e.appendTo!=null&&(r.mirror.parentNode=e.appendTo),r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),new vp(r,e.eventData)}destroy(){this.dragging.destroy()}};var ob=xt({name:"@fullcalendar/interaction",componentInteractions:[pp,mp,Kn,gp],calendarInteractions:[yp],elementDraggingImpl:Bi,optionRefiners:DM,listenerRefiners:SM});var Ar=require("obsidian");var Pe=require("obsidian");hd();fd();var cb=require("obsidian"),pd=class{constructor(t){this.menu=new cb.Menu,this.options=t,this.buildMenu()}buildMenu(){this.getStatusOptions().forEach((e,r)=>{this.menu.addItem(i=>{let s=e.label;i.setIcon("circle"),e.value===this.options.currentValue&&(s=`\u2713 ${e.label}`),i.setTitle(s),i.onClick(async()=>{this.options.onSelect(e.value)})})})}getStatusOptions(){let t=this.options.plugin.settings.customStatuses,e=[];return t&&t.length>0&&[...t].sort((i,s)=>i.order-s.order).forEach(i=>{e.push({label:i.label,value:i.value,color:i.color})}),e}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}show(t){this.menu.showAtMouseEvent(t),setTimeout(()=>{this.applyColorStyling()},10)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4}),setTimeout(()=>{this.applyColorStyling()},10)}applyColorStyling(){let t=this.getStatusOptions(),e=document.querySelector(".menu");if(!e)return;let r=e.querySelectorAll(".menu-item");t.forEach((i,s)=>{let a=r[s];if(a&&i.color){let o=a.querySelector(".menu-item-icon");o&&(o.style.color=i.color)}})}};md();we();Pu();var Hs=class extends Pe.Modal{constructor(e,r){super(e);this.title="";this.details="";this.dueDate="";this.scheduledDate="";this.priority="normal";this.status="open";this.contexts="";this.projects="";this.tags="";this.timeEstimate=0;this.recurrenceRule="";this.selectedProjectFiles=[];this.isExpanded=!1;this.plugin=r}onOpen(){this.containerEl.addClass("tasknotes-plugin","minimalist-task-modal"),this.titleEl.textContent=this.getModalTitle(),this.initializeFormData().then(()=>{this.createModalContent(),this.focusTitleInput()})}createModalContent(){let{contentEl:e}=this;e.empty();let r=e.createDiv("minimalist-modal-container");this.createTitleInput(r),this.createActionBar(r),this.createDetailsSection(r),this.createActionButtons(r)}createTitleInput(e){let r=e.createDiv("title-input-container");this.titleInput=r.createEl("input",{type:"text",cls:"title-input",placeholder:"What needs to be done?"}),this.titleInput.value=this.title,this.titleInput.addEventListener("input",i=>{this.title=i.target.value}),this.titleInput.addEventListener("focus",()=>{this.isExpanded||this.expandModal()})}createActionBar(e){this.actionBar=e.createDiv("action-bar"),this.createActionIcon(this.actionBar,"calendar","Set due date",(r,i)=>{this.showDateContextMenu(i,"due")},"due-date"),this.createActionIcon(this.actionBar,"calendar-clock","Set scheduled date",(r,i)=>{this.showDateContextMenu(i,"scheduled")},"scheduled-date"),this.createActionIcon(this.actionBar,"dot-square","Set status",(r,i)=>{this.showStatusContextMenu(i)},"status"),this.createActionIcon(this.actionBar,"star","Set priority",(r,i)=>{this.showPriorityContextMenu(i)},"priority"),this.createActionIcon(this.actionBar,"refresh-ccw","Set recurrence",(r,i)=>{this.showRecurrenceContextMenu(i)},"recurrence"),this.updateIconStates()}createActionIcon(e,r,i,s,a){let o=e.createDiv("action-icon");o.setAttribute("aria-label",i),o.setAttribute("data-initial-tooltip",i),a&&o.setAttribute("data-type",a);let l=o.createSpan("icon");return(0,Pe.setIcon)(l,r),o.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),s(o,c)}),o}createDetailsSection(e){this.detailsContainer=e.createDiv("details-container"),this.isExpanded||(this.detailsContainer.style.display="none");let r=this.detailsContainer.createDiv("detail-label");if(r.textContent="Title",this.titleInput=this.detailsContainer.createEl("input",{type:"text",cls:"title-input-detailed",placeholder:"Task title..."}),this.titleInput.value=this.title,this.titleInput.addEventListener("input",i=>{this.title=i.target.value}),this.getModalTitle()!=="Edit task"){let i=this.detailsContainer.createDiv("detail-label");i.textContent="Details",this.detailsInput=this.detailsContainer.createEl("textarea",{cls:"details-input",placeholder:"Add more details..."}),this.detailsInput.value=this.details,this.detailsInput.addEventListener("input",s=>{this.details=s.target.value})}this.createAdditionalFields(this.detailsContainer)}createAdditionalFields(e){new Pe.Setting(e).setName("Projects").addButton(r=>{r.setButtonText("Add Project").setTooltip("Select a project note using fuzzy search").onClick(()=>{new os(this.app,this.plugin,s=>{this.addProject(s)}).open()}),r.buttonEl.addClasses(["tn-btn","tn-btn--ghost"])}),this.projectsList=e.createDiv({cls:"task-projects-list"}),new Pe.Setting(e).setName("Contexts").addText(r=>{r.setPlaceholder("context1, context2").setValue(this.contexts).onChange(i=>{this.contexts=i}),this.contextsInput=r.inputEl,new Tp(this.app,r.inputEl,this.plugin)}),new Pe.Setting(e).setName("Tags").addText(r=>{r.setPlaceholder("tag1, tag2").setValue(this.tags).onChange(i=>{this.tags=i}),this.tagsInput=r.inputEl,new Ep(this.app,r.inputEl,this.plugin)}),new Pe.Setting(e).setName("Time estimate (minutes)").addText(r=>{r.setPlaceholder("30").setValue(this.timeEstimate.toString()).onChange(i=>{this.timeEstimate=parseInt(i)||0})})}createActionButtons(e){let r=e.createDiv("button-container");this.getModalTitle()==="Edit task"&&(r.createEl("button",{cls:"open-note-button",text:"Open note"}).addEventListener("click",async()=>{await this.openTaskNote()}),r.createDiv("button-spacer")),r.createEl("button",{cls:"save-button",text:"Save"}).addEventListener("click",async()=>{await this.handleSave(),this.close()}),r.createEl("button",{cls:"cancel-button",text:"Cancel"}).addEventListener("click",()=>{this.close()})}expandModal(){this.isExpanded||(this.isExpanded=!0,this.detailsContainer.style.display="block",this.containerEl.addClass("expanded"),this.detailsContainer.style.opacity="0",this.detailsContainer.style.transform="translateY(-10px)",setTimeout(()=>{this.detailsContainer.style.opacity="1",this.detailsContainer.style.transform="translateY(0)"},50))}showDateContextMenu(e,r){let i=r==="due"?this.dueDate:this.scheduledDate,s=r==="due"?"Set Due Date":"Set Scheduled Date";new oi({currentValue:i?Z(i):void 0,currentTime:i?It(i):void 0,title:s,onSelect:(o,l)=>{if(o){let c=l?yr(o,l):o;r==="due"?this.dueDate=c:this.scheduledDate=c}else r==="due"?this.dueDate="":this.scheduledDate="";this.updateDateIconState()}}).show(e)}showStatusContextMenu(e){new pd({currentValue:this.status,onSelect:i=>{this.status=i,this.updateStatusIconState()},plugin:this.plugin}).show(e)}showPriorityContextMenu(e){new Hi({currentValue:this.priority,onSelect:i=>{this.priority=i,this.updatePriorityIconState()},plugin:this.plugin}).show(e)}showRecurrenceContextMenu(e){new Yi({currentValue:this.recurrenceRule,onSelect:i=>{this.recurrenceRule=i||"",this.updateRecurrenceIconState()},app:this.app}).show(e)}updateDateIconState(){this.updateIconStates()}updateStatusIconState(){this.updateIconStates()}updatePriorityIconState(){this.updateIconStates()}updateRecurrenceIconState(){this.updateIconStates()}getDefaultStatus(){let e=this.plugin.settings.customStatuses;return e&&e.length>0?[...e].sort((i,s)=>i.order-s.order)[0].value:"open"}getDefaultPriority(){let e=this.plugin.settings.customPriorities;return e&&e.length>0?[...e].sort((i,s)=>i.weight-s.weight)[0].value:"normal"}getRecurrenceDisplayText(){if(!this.recurrenceRule)return"";let e=this.recurrenceRule;if(e.includes("FREQ=DAILY"))return"Daily";if(e.includes("FREQ=WEEKLY")){if(e.includes("INTERVAL=2"))return"Every 2 weeks";if(e.includes("BYDAY=MO,TU,WE,TH,FR"))return"Weekdays";if(e.includes("BYDAY=")){let i=e.match(/BYDAY=([A-Z]{2})/);return i?`Weekly on ${{SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"}[i[1]]||i[1]}`:"Weekly"}else return"Weekly"}else if(e.includes("FREQ=MONTHLY")){if(e.includes("INTERVAL=3"))return"Every 3 months";if(e.includes("BYMONTHDAY=")){let i=e.match(/BYMONTHDAY=(\d+)/);return i?`Monthly on the ${this.getOrdinal(parseInt(i[1]))}`:"Monthly"}else return e.includes("BYDAY=")?"Monthly (by weekday)":"Monthly"}else if(e.includes("FREQ=YEARLY")){if(e.includes("BYMONTH=")&&e.includes("BYMONTHDAY=")){let i=e.match(/BYMONTH=(\d+)/),s=e.match(/BYMONTHDAY=(\d+)/);if(i&&s){let o=["","January","February","March","April","May","June","July","August","September","October","November","December"][parseInt(i[1])],l=this.getOrdinal(parseInt(s[1]));return`Yearly on ${o} ${l}`}}return"Yearly"}let r="";if(e.includes("COUNT=")){let i=e.match(/COUNT=(\d+)/);i&&(r=` (${i[1]} times)`)}else if(e.includes("UNTIL=")){let i=e.match(/UNTIL=(\d{8})/);if(i){let s=i[1];r=` (until ${`${s.slice(0,4)}-${s.slice(4,6)}-${s.slice(6,8)}`})`}}return"Custom"+r}getOrdinal(e){let r=["th","st","nd","rd"],i=e%100;return e+(r[(i-20)%10]||r[i]||r[0])}updateIconStates(){if(!this.actionBar)return;let e=this.actionBar.querySelector('[data-type="due-date"]');e&&(this.dueDate?(e.classList.add("has-value"),(0,Pe.setTooltip)(e,`Due: ${this.dueDate}`,{placement:"top"})):(e.classList.remove("has-value"),(0,Pe.setTooltip)(e,"Set due date",{placement:"top"})));let r=this.actionBar.querySelector('[data-type="scheduled-date"]');r&&(this.scheduledDate?(r.classList.add("has-value"),(0,Pe.setTooltip)(r,`Scheduled: ${this.scheduledDate}`,{placement:"top"})):(r.classList.remove("has-value"),(0,Pe.setTooltip)(r,"Set scheduled date",{placement:"top"})));let i=this.actionBar.querySelector('[data-type="status"]');if(i){let o=this.plugin.settings.customStatuses.find(d=>d.value===this.status),l=o?o.label:this.status;this.status&&o&&o.value!==this.getDefaultStatus()?(i.classList.add("has-value"),(0,Pe.setTooltip)(i,`Status: ${l}`,{placement:"top"})):(i.classList.remove("has-value"),(0,Pe.setTooltip)(i,"Set status",{placement:"top"}));let c=i.querySelector(".icon");c&&o&&o.color?c.style.color=o.color:c&&(c.style.color="")}let s=this.actionBar.querySelector('[data-type="priority"]');if(s){let o=this.plugin.settings.customPriorities.find(d=>d.value===this.priority),l=o?o.label:this.priority;this.priority&&o&&o.value!==this.getDefaultPriority()?(s.classList.add("has-value"),(0,Pe.setTooltip)(s,`Priority: ${l}`,{placement:"top"})):(s.classList.remove("has-value"),(0,Pe.setTooltip)(s,"Set priority",{placement:"top"}));let c=s.querySelector(".icon");c&&o&&o.color?c.style.color=o.color:c&&(c.style.color="")}let a=this.actionBar.querySelector('[data-type="recurrence"]');a&&(this.recurrenceRule&&this.recurrenceRule.trim()?(a.classList.add("has-value"),(0,Pe.setTooltip)(a,`Recurrence: ${this.getRecurrenceDisplayText()}`,{placement:"top"})):(a.classList.remove("has-value"),(0,Pe.setTooltip)(a,"Set recurrence",{placement:"top"})))}focusTitleInput(){setTimeout(()=>{this.titleInput.focus(),this.titleInput.select()},100)}addProject(e){this.selectedProjectFiles.some(r=>r.path===e.path)||(this.selectedProjectFiles.push(e),this.updateProjectsFromFiles(),this.renderProjectsList())}removeProject(e){this.selectedProjectFiles=this.selectedProjectFiles.filter(r=>r.path!==e.path),this.updateProjectsFromFiles(),this.renderProjectsList()}updateProjectsFromFiles(){let e=this.app.workspace.getActiveFile(),r=(e==null?void 0:e.path)||"";this.projects=this.selectedProjectFiles.map(i=>`[[${this.app.metadataCache.fileToLinktext(i,r,!0)}]]`).join(", ")}initializeProjectsFromStrings(e){this.selectedProjectFiles=[];for(let r of e){if(!r||typeof r!="string"||r.trim()==="")continue;let i=r.match(/^\[\[([^\]]+)\]\]$/);if(i){let s=i[1],a=this.app.metadataCache.getFirstLinkpathDest(s,"");a&&this.selectedProjectFiles.push(a)}else{let a=this.app.vault.getMarkdownFiles().find(o=>o.basename===r||o.name===r+".md");a&&this.selectedProjectFiles.push(a)}}this.updateProjectsFromFiles()}renderProjectsList(){this.projectsList&&(this.projectsList.empty(),this.selectedProjectFiles.length!==0&&this.selectedProjectFiles.forEach(e=>{let r=this.projectsList.createDiv({cls:"task-project-item"}),i=r.createDiv({cls:"task-project-info"}),s=i.createSpan({cls:"task-project-name"});if(s.textContent=e.name,e.path!==e.name){let o=i.createDiv({cls:"task-project-path"});o.textContent=e.path}let a=r.createEl("button",{cls:"task-project-remove",text:"\xD7"});(0,Pe.setTooltip)(a,"Remove project",{placement:"top"}),a.addEventListener("click",()=>{this.removeProject(e)})}))}validateForm(){return this.title.trim().length>0}},Tp=class extends Pe.AbstractInputSuggest{constructor(e,r,i){super(e,r);this.plugin=i,this.input=r}async getSuggestions(e){let r=this.input.value.split(",").map(a=>a.trim()),i=r[r.length-1];return i?this.plugin.cacheManager.getAllContexts().filter(a=>a&&typeof a=="string").filter(a=>a.toLowerCase().includes(i.toLowerCase())&&!r.slice(0,-1).includes(a)).slice(0,10).map(a=>({value:a,display:a,type:"context",toString(){return this.value}})):[]}renderSuggestion(e,r){r.textContent=e.display}selectSuggestion(e){let r=this.input.value.split(",").map(i=>i.trim());r[r.length-1]=e.value,this.input.value=r.join(", ")+", ",this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}},Ep=class extends Pe.AbstractInputSuggest{constructor(e,r,i){super(e,r);this.plugin=i,this.input=r}async getSuggestions(e){let r=this.input.value.split(",").map(a=>a.trim()),i=r[r.length-1];return i?this.plugin.cacheManager.getAllTags().filter(a=>a&&typeof a=="string").filter(a=>a.toLowerCase().includes(i.toLowerCase())&&!r.slice(0,-1).includes(a)).slice(0,10).map(a=>({value:a,display:a,type:"tag",toString(){return this.value}})):[]}renderSuggestion(e,r){r.textContent=e.display}selectSuggestion(e){let r=this.input.value.split(",").map(i=>i.trim());r[r.length-1]=e.value,this.input.value=r.join(", ")+", ",this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}};we();je();var kp=require("obsidian");function Ys(n,t){if(!n||!t)throw new Error("Invalid context or settings provided");if(!n.title||typeof n.title!="string")throw new Error("Context must have a valid title");if(n.title.trim().length===0)throw new Error("Title cannot be empty");if(n.title.length>200)throw new Error("Title too long for filename generation");let e=n.date||new Date;if(!(e instanceof Date)||isNaN(e.getTime()))throw new Error("Invalid date provided in context");if(t.storeTitleInFilename)return Zn(n.title);try{switch(t.taskFilenameFormat){case"title":return Zn(n.title);case"zettel":return xo(e);case"timestamp":return MM(e);case"custom":return AM(n,t.customFilenameTemplate,e);default:return xo(e)}}catch(r){return console.error("Error generating filename:",r),xo(e)}}function xo(n){let t=I(n,"yyMMdd"),e=new Date(n);e.setHours(0,0,0,0);let i=Math.floor((n.getTime()-e.getTime())/1e3).toString(36);return`${t}${i}`}function MM(n){return I(n,"yyyy-MM-dd-HHmmss")}function AM(n,t,e){if(!n||!t||!e)throw new Error("Invalid inputs for custom filename generation");if(typeof t!="string"||t.trim().length===0)throw new Error("Template must be a non-empty string");if(!(e instanceof Date)||isNaN(e.getTime()))throw new Error("Invalid date for filename generation");try{let r=Zn(n.title),i=n.priority&&["low","normal","medium","high"].includes(n.priority)?n.priority:"normal",s=n.status&&["open","in-progress","done","scheduled"].includes(n.status)?n.status:"open",a={title:r,date:I(e,"yyyy-MM-dd"),time:I(e,"HHmmss"),priority:i,status:s,timestamp:I(e,"yyyy-MM-dd-HHmmss"),dateTime:I(e,"yyyy-MM-dd-HHmm"),year:I(e,"yyyy"),month:I(e,"MM"),day:I(e,"dd"),hour:I(e,"HH"),minute:I(e,"mm"),second:I(e,"ss"),dueDate:n.dueDate||"",scheduledDate:n.scheduledDate||""},o=t;if(t.length>500)throw new Error("Template too long");return Object.entries(a).forEach(([l,c])=>{try{let d=new RegExp(`\\{${l}\\}`,"g");o=o.replace(d,c)}catch(d){console.warn(`Error replacing template variable ${l}:`,d)}}),o=o.replace(/\{[^}]+\}/g,""),o.trim()||(o=r||xo(e)),Zn(o)}catch(r){return console.error("Error generating custom filename:",r),Zn(n.title)||xo(e)}}function Zn(n){if(!n||typeof n!="string")return"untitled";try{let t=n.trim().replace(/\s+/g," ").replace(/[<>:"/\\|?*]/g,"").replace(/./g,r=>{let i=r.charCodeAt(0);return i<=31||i>=127&&i<=159?"":r}).replace(/^\.+|\.+$/g,"").substring(0,100).trim();return(!t||t.length===0)&&(t="untitled"),["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"].includes(t.toUpperCase())&&(t=`task-${t}`),t}catch(t){return console.error("Error sanitizing filename:",t),"untitled"}}async function _o(n,t,e){if(!n||typeof n!="string")throw new Error("Base filename must be a non-empty string");if(typeof t!="string")throw new Error("Folder path must be a string");if(!e)throw new Error("Vault must be provided");let r=Zn(n);if(!r)throw new Error("Base filename cannot be sanitized to a valid name");let i=t.replace(/\.\./g,"").trim();try{let s=(0,kp.normalizePath)(`${i}/${r}.md`);if(s.length>260)throw new Error("Generated path too long");if(!e.getAbstractFileByPath(s))return r;for(let l=2;l<=999;l++){let c=`${r}-${l}`,d=(0,kp.normalizePath)(`${i}/${c}.md`);if(d.length>260)break;if(!e.getAbstractFileByPath(d))return c}let a=Date.now().toString(36),o=`${r.substring(0,50)}-${a}`;return Zn(o)}catch(s){return console.error("Error generating unique filename:",s),`task-${Date.now().toString(36)}`}}at();Gp();we();var Qp=class extends Ar.AbstractInputSuggest{constructor(e,r,i){super(e,r);this.currentTrigger=null;this.plugin=i,this.textarea=r}async getSuggestions(e){let r=this.textarea.selectionStart,i=this.textarea.value.slice(0,r),s=i.lastIndexOf("@"),a=i.lastIndexOf("#"),o=i.lastIndexOf("+"),l=-1,c=null;if(s>=a&&s>=o&&s!==-1?(l=s,c="@"):a>=o&&a!==-1?(l=a,c="#"):o!==-1&&(l=o,c="+"),l===-1||l>0&&/\w/.test(i[l-1]))return this.currentTrigger=null,[];let d=i.slice(l+1);if(d.includes(" ")||d.includes(`
`))return this.currentTrigger=null,[];if(this.currentTrigger=c,c==="@")return this.plugin.cacheManager.getAllContexts().filter(h=>h&&typeof h=="string").filter(h=>h.toLowerCase().includes(d.toLowerCase())).slice(0,10).map(h=>({value:h,display:h,type:"context",toString(){return this.value}}));if(c==="#")return this.plugin.cacheManager.getAllTags().filter(h=>h&&typeof h=="string").filter(h=>h.toLowerCase().includes(d.toLowerCase())).slice(0,10).map(h=>({value:h,display:h,type:"tag",toString(){return this.value}}));if(c==="+"){let u=this.plugin.app.vault.getMarkdownFiles(),h=d.toLowerCase();return u.map(p=>{var v;let m=this.plugin.app.metadataCache.getFileCache(p),g="";return m!=null&&m.frontmatter&&(g=this.plugin.fieldMapper.mapFromFrontmatter(m.frontmatter,p.path,this.plugin.settings.storeTitleInFilename).title||""),{file:p,basename:p.basename,title:g,aliases:((v=m==null?void 0:m.frontmatter)==null?void 0:v.aliases)||[]}}).filter(p=>p.basename.toLowerCase().includes(h)||p.title&&p.title.toLowerCase().includes(h)?!0:Array.isArray(p.aliases)?p.aliases.some(m=>typeof m=="string"&&m.toLowerCase().includes(h)):!1).map(p=>{let m=p.basename,g=[];if(p.title&&p.title!==p.basename&&g.push(`title: ${p.title}`),Array.isArray(p.aliases)&&p.aliases.length>0){let v=p.aliases.filter(T=>typeof T=="string");v.length>0&&g.push(`aliases: ${v.join(", ")}`)}return g.length>0&&(m+=` [${g.join(" | ")}]`),{basename:p.basename,displayName:m,type:"project",toString(){return this.basename}}}).slice(0,20)}return[]}renderSuggestion(e,r){let i=r.createSpan("nlp-suggest-icon");i.textContent=this.currentTrigger||"";let s=r.createSpan("nlp-suggest-text");e.type==="project"?s.textContent=e.displayName:s.textContent=e.display}selectSuggestion(e){if(!this.currentTrigger)return;let r=this.textarea.selectionStart,i=this.textarea.value.slice(0,r),s=this.textarea.value.slice(r),a=this.currentTrigger==="@"?i.lastIndexOf("@"):this.currentTrigger==="#"?i.lastIndexOf("#"):i.lastIndexOf("+");if(a===-1)return;let o=e.type==="project"?e.basename:e.value,l=i.slice(0,a),c=this.currentTrigger+o;this.currentTrigger==="+"&&(c="+[["+o+"]]");let d=l+c+" "+s;this.textarea.value=d;let u=l.length+c.length+1;this.textarea.setSelectionRange(u,u),this.textarea.dispatchEvent(new Event("input",{bubbles:!0})),this.textarea.focus()}},Ks=class extends Hs{constructor(e,r,i={}){super(e,r);this.options=i,this.nlParser=new Qs(r.settings.customStatuses,r.settings.customPriorities,r.settings.nlpDefaultToScheduled)}getModalTitle(){return"Create task"}createModalContent(){let{contentEl:e}=this;e.empty();let r=e.createDiv("minimalist-modal-container");this.plugin.settings.enableNaturalLanguageInput?this.createNaturalLanguageInput(r):this.createTitleInput(r),this.createActionBar(r),this.createDetailsSection(r),(this.options.prePopulatedValues&&this.options.prePopulatedValues.projects||this.selectedProjectFiles.length>0)&&this.renderProjectsList(),this.createActionButtons(r)}createNaturalLanguageInput(e){let r=e.createDiv("nl-input-container");this.nlInput=r.createEl("textarea",{cls:"nl-input",attr:{placeholder:`Buy groceries tomorrow at 3pm @home #errands

Add details here...`,rows:"3"}}),this.nlPreviewContainer=r.createDiv("nl-preview-container"),this.nlInput.addEventListener("input",()=>{let i=this.nlInput.value.trim();i?this.updateNaturalLanguagePreview(i):this.clearNaturalLanguagePreview()}),this.nlInput.addEventListener("keydown",i=>{let s=this.nlInput.value.trim();s&&(i.key==="Enter"&&(i.ctrlKey||i.metaKey)?(i.preventDefault(),this.handleSave()):i.key==="Tab"&&i.shiftKey&&(i.preventDefault(),this.parseAndFillForm(s)))}),this.nlpSuggest=new Qp(this.app,this.nlInput,this.plugin),setTimeout(()=>{this.nlInput.focus()},100)}updateNaturalLanguagePreview(e){if(!this.nlPreviewContainer)return;let r=this.nlParser.parseInput(e),i=this.nlParser.getPreviewData(r);i.length>0&&r.title?(this.nlPreviewContainer.empty(),this.nlPreviewContainer.style.display="block",i.forEach(s=>{let a=this.nlPreviewContainer.createDiv("nl-preview-item");a.textContent=s.text})):this.clearNaturalLanguagePreview()}clearNaturalLanguagePreview(){this.nlPreviewContainer&&(this.nlPreviewContainer.empty(),this.nlPreviewContainer.style.display="none")}createActionBar(e){if(this.actionBar=e.createDiv("action-bar"),this.plugin.settings.enableNaturalLanguageInput){this.createActionIcon(this.actionBar,"wand","Fill form from natural language",(i,s)=>{var o;let a=(o=this.nlInput)==null?void 0:o.value.trim();a&&this.parseAndFillForm(a)}),this.createActionIcon(this.actionBar,this.isExpanded?"chevron-up":"chevron-down",this.isExpanded?"Hide detailed options":"Show detailed options",(i,s)=>{this.toggleDetailedForm();let a=i.querySelector(".icon");a&&(0,Ar.setIcon)(a,this.isExpanded?"chevron-up":"chevron-down"),(0,Ar.setTooltip)(i,this.isExpanded?"Hide detailed options":"Show detailed options",{placement:"top"})});let r=this.actionBar.createDiv("action-separator");r.style.width="1px",r.style.height="24px",r.style.backgroundColor="var(--background-modifier-border)",r.style.margin="0 var(--size-4-2)"}this.createActionIcon(this.actionBar,"calendar","Set due date",(r,i)=>{this.showDateContextMenu(i,"due")},"due-date"),this.createActionIcon(this.actionBar,"calendar-clock","Set scheduled date",(r,i)=>{this.showDateContextMenu(i,"scheduled")},"scheduled-date"),this.createActionIcon(this.actionBar,"dot-square","Set status",(r,i)=>{this.showStatusContextMenu(i)},"status"),this.createActionIcon(this.actionBar,"star","Set priority",(r,i)=>{this.showPriorityContextMenu(i)},"priority"),this.createActionIcon(this.actionBar,"refresh-ccw","Set recurrence",(r,i)=>{this.showRecurrenceContextMenu(i)},"recurrence"),this.updateIconStates()}parseAndFillForm(e){let r=this.nlParser.parseInput(e);this.applyParsedData(r),this.isExpanded||this.expandModal()}applyParsedData(e){e.title&&(this.title=e.title),e.status&&(this.status=e.status),e.priority&&(this.priority=e.priority),e.dueDate&&(this.dueDate=e.dueTime?yr(e.dueDate,e.dueTime):e.dueDate),e.scheduledDate&&(this.scheduledDate=e.scheduledTime?yr(e.scheduledDate,e.scheduledTime):e.scheduledDate),e.contexts&&e.contexts.length>0&&(this.contexts=e.contexts.join(", ")),e.tags&&e.tags.length>0&&(this.tags=e.tags.join(", ")),e.details&&(this.details=e.details),e.recurrence&&(this.recurrenceRule=e.recurrence),this.titleInput&&(this.titleInput.value=this.title),this.detailsInput&&(this.detailsInput.value=this.details),this.contextsInput&&(this.contextsInput.value=this.contexts),this.tagsInput&&(this.tagsInput.value=this.tags),e.projects&&e.projects.length>0&&(this.initializeProjectsFromStrings(e.projects),this.renderProjectsList()),this.updateIconStates()}toggleDetailedForm(){this.isExpanded?(this.isExpanded=!1,this.detailsContainer.style.display="none",this.containerEl.removeClass("expanded")):this.expandModal()}async initializeFormData(){this.priority=this.plugin.settings.defaultTaskPriority,this.status=this.plugin.settings.defaultTaskStatus;let e=this.plugin.settings.taskCreationDefaults;if(this.dueDate=ws(e.defaultDueDate),this.scheduledDate=ws(e.defaultScheduledDate),this.contexts=e.defaultContexts||"",this.tags=e.defaultTags||"",e.defaultProjects){let r=e.defaultProjects.split(",").map(i=>i.trim()).filter(i=>i.length>0);r.length>0&&this.initializeProjectsFromStrings(r)}e.defaultTimeEstimate&&e.defaultTimeEstimate>0&&(this.timeEstimate=e.defaultTimeEstimate),this.options.prePopulatedValues&&this.applyPrePopulatedValues(this.options.prePopulatedValues)}applyPrePopulatedValues(e){e.title!==void 0&&(this.title=e.title),e.due!==void 0&&(this.dueDate=e.due),e.scheduled!==void 0&&(this.scheduledDate=e.scheduled),e.priority!==void 0&&(this.priority=e.priority),e.status!==void 0&&(this.status=e.status),e.contexts!==void 0&&(this.contexts=e.contexts.join(", ")),e.projects!==void 0&&(e.projects.filter(i=>i&&typeof i=="string"&&i.trim()!=="").length>0&&this.initializeProjectsFromStrings(e.projects),this.renderProjectsList()),e.tags!==void 0&&(this.tags=e.tags.filter(r=>r!==this.plugin.settings.taskTag).join(", ")),e.timeEstimate!==void 0&&(this.timeEstimate=e.timeEstimate),e.recurrence!==void 0&&typeof e.recurrence=="string"&&(this.recurrenceRule=e.recurrence)}async handleSave(){if(this.plugin.settings.enableNaturalLanguageInput&&this.nlInput){let e=this.nlInput.value.trim();if(e&&!this.title.trim()){let r=this.nlParser.parseInput(e);this.applyParsedData(r)}}if(!this.validateForm()){new Ar.Notice("Please enter a task title");return}try{let e=this.buildTaskData(),r=await this.plugin.taskService.createTask(e);new Ar.Notice(`Task "${r.taskInfo.title}" created successfully`),this.options.onTaskCreated&&this.options.onTaskCreated(r.taskInfo),this.close()}catch(e){console.error("Failed to create task:",e),new Ar.Notice("Failed to create task: "+e.message)}}buildTaskData(){let e=ce(),r=this.contexts.split(",").map(o=>o.trim()).filter(o=>o.length>0),i=this.projects.split(",").map(o=>o.trim()).filter(o=>o.length>0),s=this.tags.split(",").map(o=>o.trim()).filter(o=>o.length>0);this.plugin.settings.taskTag&&!s.includes(this.plugin.settings.taskTag)&&s.push(this.plugin.settings.taskTag);let a={title:this.title.trim(),due:this.dueDate||void 0,scheduled:this.scheduledDate||void 0,priority:this.priority,status:this.status,contexts:r.length>0?r:void 0,projects:i.length>0?i:void 0,tags:s.length>0?s:void 0,timeEstimate:this.timeEstimate>0?this.timeEstimate:void 0,recurrence:this.recurrenceRule||void 0,creationContext:"manual-creation",dateCreated:e,dateModified:e};return this.details.trim()&&(a.details=this.details.trim()),a}generateFilename(e){let r={title:e.title||"",status:e.status||"open",priority:e.priority||"normal",dueDate:e.due,scheduledDate:e.scheduled};return Ys(r,this.plugin.settings)}createTitleInput(e){this.plugin.settings.enableNaturalLanguageInput||super.createTitleInput(e)}};var hr=require("obsidian");we();we();je();at();var Zi=class extends Hs{constructor(e,r,i){super(e,r);this.completedInstancesChanges=new Set;this.calendarWrapper=null;this.isExpanded=!0;this.task=i.task,this.options=i}getModalTitle(){return"Edit task"}async initializeFormData(){this.title=this.task.title,this.dueDate=this.task.due||"",this.scheduledDate=this.task.scheduled||"",this.priority=this.task.priority,this.status=this.task.status,this.contexts=this.task.contexts?this.task.contexts.join(", "):"",this.task.projects&&this.task.projects.length>0?this.task.projects.filter(r=>r&&typeof r=="string"&&r.trim()!=="").length>0?this.initializeProjectsFromStrings(this.task.projects):(this.projects="",this.selectedProjectFiles=[]):(this.projects="",this.selectedProjectFiles=[]),this.tags=this.task.tags?this.task.tags.filter(e=>e!==this.plugin.settings.taskTag).join(", "):"",this.timeEstimate=this.task.timeEstimate||0,this.task.recurrence?typeof this.task.recurrence=="string"?this.recurrenceRule=this.task.recurrence:typeof this.task.recurrence=="object"&&this.task.recurrence.frequency&&(this.recurrenceRule=this.convertLegacyRecurrenceToString(this.task.recurrence)):this.recurrenceRule=""}convertLegacyRecurrenceToString(e){if(!e.frequency)return"";let r=e.frequency;return e.frequency==="weekly"&&e.days_of_week&&(r+=` on ${e.days_of_week.join(", ")}`),e.frequency==="monthly"&&e.day_of_month&&(r+=` on day ${e.day_of_month}`),r}async onOpen(){this.completedInstancesChanges.clear(),await this.refreshTaskData(),this.containerEl.addClass("tasknotes-plugin","minimalist-task-modal"),this.titleEl.textContent=this.getModalTitle(),this.initializeFormData().then(()=>{this.createModalContent(),this.renderProjectsList(),this.updateIconStates(),this.focusTitleInput()})}async refreshTaskData(){try{let e=this.app.vault.getAbstractFileByPath(this.task.path);if(!e||!(e instanceof hr.TFile)){console.warn("Could not find file for task:",this.task.path);return}let r=await this.app.vault.read(e),i=Oy(this.app,r,this.task.path,e,this.plugin.fieldMapper,this.plugin.settings.storeTitleInFilename);i&&(this.task=i,this.options.task=i)}catch(e){console.warn("Could not refresh task data:",e)}}createModalContent(){let{contentEl:e}=this;e.empty();let r=e.createDiv("minimalist-modal-container");this.createActionBar(r),this.createDetailsSection(r),this.createCompletionsCalendarSection(r),this.createMetadataSection(r),this.createActionButtons(r)}createCompletionsCalendarSection(e){if(this.task.recurrence){let r=e.createDiv("completions-calendar-container"),i=r.createDiv("detail-label");i.textContent="Completions";let s=r.createDiv("completions-calendar-content");this.createRecurringCalendar(s)}}createMetadataSection(e){this.metadataContainer=e.createDiv("metadata-container");let r=this.metadataContainer.createDiv("detail-label");r.textContent="Task Information";let i=this.metadataContainer.createDiv("metadata-content"),s=Na(this.task.timeEntries||[]);if(s>0){let a=i.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Total tracked time: ",a.createSpan("metadata-value").textContent=Zl(s)}if(this.task.dateCreated){let a=i.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Created: ",a.createSpan("metadata-value").textContent=Lu(this.task.dateCreated)}if(this.task.dateModified){let a=i.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Modified: ",a.createSpan("metadata-value").textContent=Lu(this.task.dateModified)}if(this.task.path){let a=i.createDiv("metadata-item");a.createSpan("metadata-key").textContent="File: ",a.createSpan("metadata-value").textContent=this.task.path}}createRecurringCalendar(e){this.calendarWrapper=e.createDiv("recurring-calendar");let i=new Date;if(this.task.complete_instances&&this.task.complete_instances.length>0){let s=this.task.complete_instances.filter(a=>a&&typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a.trim())).map(a=>yt(a).getTime()).filter(a=>!isNaN(a));s.length>0&&(i=new Date(Math.max(...s)))}this.renderCalendarMonth(this.calendarWrapper,i)}renderCalendarMonth(e,r){e.empty();let i=e.createDiv("recurring-calendar__header"),s=i.createEl("button",{cls:"recurring-calendar__nav",text:"\u2039"}),a=i.createSpan("recurring-calendar__month");a.textContent=I(r,"MMM yyyy");let o=i.createEl("button",{cls:"recurring-calendar__nav",text:"\u203A"}),l=e.createDiv("recurring-calendar__grid"),c=Bu(r),d=Hu(r),u=this.plugin.settings.calendarViewSettings.firstDay||0,h=Fu(c,u),f=Lg(d,u),p=Rg(h,f),m=Bu(r);m.setUTCMonth(m.getUTCMonth()-1);let g=Hu(r);g.setUTCMonth(g.getUTCMonth()+1);let v=Jl(this.task,m,g),T=new Set(v.map(D=>Te(D))),k=new Set(this.task.complete_instances||[]);this.completedInstancesChanges.forEach(D=>{k.has(D)?k.delete(D):k.add(D)}),p.forEach(D=>{let M=Te(D),E=Sl(D,r),C=T.has(M),S=k.has(M),O=l.createDiv("recurring-calendar__day");O.textContent=I(D,"d"),E||O.addClass("recurring-calendar__day--faded"),O.addClass("recurring-calendar__day--clickable"),C&&O.addClass("recurring-calendar__day--recurring"),S&&O.addClass("recurring-calendar__day--completed"),O.addEventListener("click",()=>{this.toggleCompletedInstance(M),this.renderCalendarMonth(e,r)})}),s.addEventListener("click",()=>{let D=new Date(r);D.setMonth(D.getMonth()-1),this.renderCalendarMonth(e,D)}),o.addEventListener("click",()=>{let D=new Date(r);D.setMonth(D.getMonth()+1),this.renderCalendarMonth(e,D)})}toggleCompletedInstance(e){this.completedInstancesChanges.has(e)?this.completedInstancesChanges.delete(e):this.completedInstancesChanges.add(e)}async handleSave(){if(!this.validateForm()){new hr.Notice("Please enter a task title");return}try{let e=this.getChanges();if(Object.keys(e).length===0){new hr.Notice("No changes to save"),this.close();return}let r=await this.plugin.taskService.updateTask(this.task,e);new hr.Notice(`Task "${r.title}" updated successfully`),this.options.onTaskUpdated&&this.options.onTaskUpdated(r)}catch(e){console.error("Failed to update task:",e),new hr.Notice("Failed to update task: "+e.message)}}getChanges(){let e={};this.title.trim()!==this.task.title&&(e.title=this.title.trim()),this.dueDate!==(this.task.due||"")&&(e.due=this.dueDate||void 0),this.scheduledDate!==(this.task.scheduled||"")&&(e.scheduled=this.scheduledDate||void 0),this.priority!==this.task.priority&&(e.priority=this.priority),this.status!==this.task.status&&(e.status=this.status);let r=this.contexts.split(",").map(h=>h.trim()).filter(h=>h.length>0),i=this.task.contexts||[];JSON.stringify(r.sort())!==JSON.stringify(i.sort())&&(e.contexts=r.length>0?r:void 0);let s=this.projects.split(",").map(h=>h.trim()).filter(h=>h.length>0),a=this.task.projects||[];JSON.stringify(s.sort())!==JSON.stringify(a.sort())&&(e.projects=s);let o=this.tags.split(",").map(h=>h.trim()).filter(h=>h.length>0);this.plugin.settings.taskTag&&!o.includes(this.plugin.settings.taskTag)&&o.push(this.plugin.settings.taskTag);let l=this.task.tags||[];JSON.stringify(o.sort())!==JSON.stringify(l.sort())&&(e.tags=o.length>0?o:void 0);let c=this.timeEstimate>0?this.timeEstimate:void 0,d=this.task.timeEstimate;c!==d&&(e.timeEstimate=c);let u=typeof this.task.recurrence=="string"?this.task.recurrence:"";if(this.recurrenceRule!==u&&(e.recurrence=this.recurrenceRule||void 0),this.completedInstancesChanges.size>0){let h=new Set(this.task.complete_instances||[]);this.completedInstancesChanges.forEach(f=>{h.has(f)?h.delete(f):h.add(f)}),e.complete_instances=Array.from(h)}return Object.keys(e).length>0&&(e.dateModified=ce()),e}async openTaskNote(){try{let e=this.app.vault.getAbstractFileByPath(this.task.path);if(!e){new hr.Notice(`Could not find task file: ${this.task.path}`);return}await this.app.workspace.getLeaf(!0).openFile(e),this.close()}catch(e){console.error("Failed to open task note:",e),new hr.Notice("Failed to open task note")}}async archiveTask(){try{let e=await this.plugin.taskService.toggleArchive(this.task);this.task=e,this.options.onTaskUpdated&&this.options.onTaskUpdated(e);let r=e.archived?"archived":"unarchived";new hr.Notice(`Task ${r} successfully`),this.close()}catch(e){console.error("Failed to archive task:",e),new hr.Notice("Failed to archive task")}}createActionButtons(e){let r=e.createDiv("button-container");r.createEl("button",{cls:"open-note-button",text:"Open note"}).addEventListener("click",async()=>{await this.openTaskNote()}),r.createEl("button",{cls:"archive-button",text:this.task.archived?"Unarchive":"Archive"}).addEventListener("click",async()=>{await this.archiveTask()}),r.createDiv("button-spacer"),r.createEl("button",{cls:"save-button",text:"Save"}).addEventListener("click",async()=>{await this.handleSave(),this.close()}),r.createEl("button",{cls:"cancel-button",text:"Cancel"}).addEventListener("click",()=>{this.close()})}};var Ir=require("obsidian");je();we();at();var xd=class extends Ir.FuzzySuggestModal{constructor(e,r,i,s){super(e);this.plugin=r,this.onScheduleTask=i,this.defaultScheduleOptions=s,this.setPlaceholder("Type to search for an unscheduled task..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to schedule task"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText("Schedule Task"),this.titleEl.setAttribute("id","unscheduled-tasks-selector-title"),this.containerEl.setAttribute("aria-labelledby","unscheduled-tasks-selector-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),this.containerEl.addClass("unscheduled-tasks-selector-modal"),this.loadUnscheduledTasks()}async loadUnscheduledTasks(){try{let e=this.plugin.cacheManager.getAllTaskPaths(),r=Array.from(e).map(s=>this.plugin.cacheManager.getTaskInfo(s)),i=(await Promise.all(r)).filter(s=>s!==null);this.tasks=i.filter(s=>!s.archived&&!this.plugin.statusManager.isCompletedStatus(s.status)&&!s.scheduled)}catch(e){console.error("Error loading unscheduled tasks:",e),this.tasks=[]}}getItems(){return this.tasks.sort((e,r)=>{var o,l;if(e.due&&!r.due)return-1;if(!e.due&&r.due)return 1;if(e.due&&r.due){let c=e.due.localeCompare(r.due);if(c!==0)return c}let i={high:0,normal:1,low:2},s=(o=i[e.priority])!=null?o:1,a=(l=i[r.priority])!=null?l:1;return s!==a?s-a:e.title.localeCompare(r.title)})}getItemText(e){return e.title}renderSuggestion(e,r){let i=e.item;r.empty(),r.addClass("unscheduled-tasks-selector__suggestion");let s=r.createDiv({cls:"unscheduled-tasks-selector__content"}),a=s.createDiv({cls:"unscheduled-tasks-selector__title"});this.renderHighlightedText(a,e,i.title);let o=s.createDiv({cls:"unscheduled-tasks-selector__meta"});if(i.priority&&o.createSpan({text:i.priority.toUpperCase(),cls:`unscheduled-tasks-selector__priority priority-${(i.priority||"normal").toLowerCase()}`}),i.due){let d=o.createSpan({cls:"unscheduled-tasks-selector__due"}),u=dt(i.due)?I(he(i.due),"MMM d, h:mm a"):I(he(i.due),"MMM d");if(us(Z(i.due))){d.addClass("overdue");let h=d.createSpan();(0,Ir.setIcon)(h,"alert-triangle"),d.createSpan({text:` Overdue: ${u}`})}else if(ki(Z(i.due))){d.addClass("due-today");let h=d.createSpan();(0,Ir.setIcon)(h,"calendar"),d.createSpan({text:` Due today: ${u}`})}else d.setText(`Due: ${u}`)}if(i.timeEstimate&&o.createSpan({text:`~${i.timeEstimate}min`,cls:"unscheduled-tasks-selector__time-estimate"}),i.contexts&&i.contexts.length>0){let d=o.createSpan({cls:"unscheduled-tasks-selector__contexts"});d.textContent=`@${i.contexts.join(", @")}`}let l=Ot(i.projects||[]);if(l.length>0){let d=o.createSpan({cls:"unscheduled-tasks-selector__projects"});j0(d,l,this.plugin)}let c=s.createDiv({cls:"unscheduled-tasks-selector__schedule-icon"});(0,Ir.setIcon)(c,"calendar-plus")}renderHighlightedText(e,r,i){e.empty();let s=r.match.matches;if(!s||s.length===0){e.textContent=i;return}let a=0;for(let o of s)o[0]>a&&e.appendText(i.slice(a,o[0])),e.createEl("mark",{text:i.slice(o[0],o[1]+1)}),a=o[1]+1;a<i.length&&e.appendText(i.slice(a))}onChooseItem(e,r){this.onScheduleTask(e,this.defaultScheduleOptions)}onNoSuggestion(){this.resultContainerEl.createDiv({cls:"unscheduled-tasks-selector__no-results"}).setText("No unscheduled tasks found. All tasks are either scheduled, completed, or archived.")}};function W0(n){return n.startsWith("[[")&&n.endsWith("]]")}function j0(n,t,e){n.innerHTML="",t.forEach((r,i)=>{if(i>0){let a=document.createTextNode(", ");n.appendChild(a)}let s=document.createTextNode("+");if(n.appendChild(s),W0(r)){let a=r.slice(2,-2);n.createEl("a",{cls:"unscheduled-tasks-selector__project-link internal-link",text:a,attr:{"data-href":a}}).addEventListener("click",async l=>{l.preventDefault(),l.stopPropagation();let c=e.app.metadataCache.getFirstLinkpathDest(a,"");c instanceof Ir.TFile?await e.app.workspace.getLeaf(!1).openFile(c):new Ir.Notice(`Note "${a}" not found`)})}else{let a=document.createTextNode(r);n.appendChild(a)}})}var Re=require("obsidian");at();var Ji=Ve(Yt()),_d=class extends Re.Modal{constructor(e,r,i){super(e);this.selectedAttachments=[];this.plugin=r,this.options=i}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("timeblock-creation-modal"),new Re.Setting(e).setName("Create timeblock").setHeading();let r=e.createDiv({cls:"timeblock-date-display"});r.createEl("strong",{text:"Date: "});let i=new Date(this.options.date+"T00:00:00");r.createSpan({text:i.toLocaleDateString()}),new Re.Setting(e).setName("Title").setDesc("Title for your timeblock").addText(c=>{this.titleInput=c.inputEl,c.setPlaceholder("e.g., Deep work session").setValue(this.options.prefilledTitle||"").onChange(()=>this.validateForm()),window.setTimeout(()=>this.titleInput.focus(),100)});let s=e.createDiv({cls:"timeblock-time-container"});new Re.Setting(s).setName("Start time").setDesc("When the timeblock starts").addText(c=>{this.startTimeInput=c.inputEl,c.setPlaceholder("09:00").setValue(this.options.startTime||"").onChange(()=>this.validateForm()),this.startTimeInput.type="time"}),new Re.Setting(s).setName("End time").setDesc("When the timeblock ends").addText(c=>{this.endTimeInput=c.inputEl,c.setPlaceholder("11:00").setValue(this.options.endTime||"").onChange(()=>this.validateForm()),this.endTimeInput.type="time"}),new Re.Setting(e).setName("Description").setDesc("Optional description for the timeblock").addTextArea(c=>{this.descriptionInput=c.inputEl,c.setPlaceholder("Focus on new features, no interruptions").setValue(""),this.descriptionInput.rows=3}),new Re.Setting(e).setName("Color").setDesc("Optional color for the timeblock").addText(c=>{this.colorInput=c.inputEl,c.setPlaceholder("#3b82f6").setValue("#6366f1"),this.colorInput.type="color"}),new Re.Setting(e).setName("Attachments").setDesc("Files or notes to link to this timeblock").addButton(c=>{c.setButtonText("Add Attachment").setTooltip("Select a file or note using fuzzy search").onClick(()=>{new Ts(this.app,this.plugin,u=>{this.addAttachment(u)}).open()})}),this.attachmentsList=e.createDiv({cls:"timeblock-attachments-list"}),this.renderAttachmentsList();let a=e.createDiv({cls:"timeblock-modal-buttons"});a.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),a.createEl("button",{text:"Create timeblock",cls:"mod-cta timeblock-create-button"}).addEventListener("click",()=>this.handleSubmit()),this.validateForm()}validateForm(){var o,l,c;let e=this.contentEl.querySelector(".timeblock-create-button");if(!e)return;let r=(o=this.titleInput)==null?void 0:o.value.trim(),i=(l=this.startTimeInput)==null?void 0:l.value,s=(c=this.endTimeInput)==null?void 0:c.value,a=!!(r&&i&&s);if(a&&i&&s){let[d,u]=i.split(":").map(Number),[h,f]=s.split(":").map(Number),p=d*60+u;h*60+f<=p&&(a=!1)}e.disabled=!a,e.style.opacity=a?"1":"0.5"}async handleSubmit(){try{let e=this.titleInput.value.trim(),r=this.startTimeInput.value,i=this.endTimeInput.value,s=this.descriptionInput.value.trim(),a=this.colorInput.value;if(!e||!r||!i){new Re.Notice("Please fill in all required fields");return}let o=this.selectedAttachments.map(c=>`[[${c.path}]]`),l={id:Ly(),title:e,startTime:r,endTime:i};s&&(l.description=s),a&&(l.color=a),o.length>0&&(l.attachments=o),await this.saveTimeblockToDailyNote(l),this.plugin.emitter.trigger("data-changed"),new Re.Notice(`Timeblock "${e}" created successfully`),this.close()}catch(e){console.error("Error creating timeblock:",e),new Re.Notice("Failed to create timeblock. Check console for details.")}}async saveTimeblockToDailyNote(e){if(!(0,Ji.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let r=window.moment(this.options.date),i=(0,Ji.getAllDailyNotes)(),s=(0,Ji.getDailyNote)(r,i);s||(s=await(0,Ji.createDailyNote)(r));let a=await this.app.vault.read(s),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let h=a.substring(3,u);l=a.substring(u+3);try{o=(0,Re.parseYaml)(h)||{}}catch(f){console.error("Error parsing existing frontmatter:",f),o={}}}}o.timeblocks||(o.timeblocks=[]),o.timeblocks.push(e);let d=`---
${(0,Re.stringifyYaml)(o)}---${l}`;await this.app.vault.modify(s,d)}addAttachment(e){if(this.selectedAttachments.some(r=>r.path===e.path)){new Re.Notice(`"${e.name}" is already attached`);return}this.selectedAttachments.push(e),this.renderAttachmentsList(),new Re.Notice(`Added "${e.name}" as attachment`)}removeAttachment(e){this.selectedAttachments=this.selectedAttachments.filter(r=>r.path!==e.path),this.renderAttachmentsList(),new Re.Notice(`Removed "${e.name}" from attachments`)}renderAttachmentsList(){if(this.attachmentsList.empty(),this.selectedAttachments.length===0){let e=this.attachmentsList.createDiv({cls:"timeblock-attachments-empty"});e.textContent="No attachments added yet";return}this.selectedAttachments.forEach(e=>{let r=this.attachmentsList.createDiv({cls:"timeblock-attachment-item"}),i=r.createDiv({cls:"timeblock-attachment-info"}),s=i.createSpan({cls:"timeblock-attachment-name"});if(s.textContent=e.name,e.path!==e.name){let o=i.createDiv({cls:"timeblock-attachment-path"});o.textContent=e.path}let a=r.createEl("button",{cls:"timeblock-attachment-remove",text:"\xD7"});(0,Re.setTooltip)(a,"Remove attachment",{placement:"top"}),a.addEventListener("click",()=>{this.removeAttachment(e)})})}onClose(){let{contentEl:e}=this;e.empty()}};var K=require("obsidian");var Pr=class{constructor(){this.events={}}on(t,e){return this.events[t]||(this.events[t]=[]),this.events[t].push(e),()=>{this.events[t]=this.events[t].filter(r=>r!==e)}}emit(t,...e){this.events[t]&&this.events[t].forEach(r=>{r(...e)})}removeAllListeners(t){t?delete this.events[t]:this.events={}}};we();var mt=class extends Error{constructor(e,r,i){super(e);this.field=r;this.nodeId=i;this.name="FilterValidationError"}},Xi=class extends Error{constructor(e,r){super(e);this.nodeId=r;this.name="FilterEvaluationError"}},me=class{static generateId(){return`filter_${Date.now()}_${++this.idCounter}`}static deepCloneFilterQuery(t){return JSON.parse(JSON.stringify(t))}static validateFilterNode(t,e=!0){if(!t||typeof t!="object")throw new mt("Filter node must be an object");if(!("id"in t)||!t.id||typeof t.id!="string")throw new mt("Filter node must have a valid string ID",void 0,"id"in t?String(t.id):"unknown");if(t.type==="condition")this.validateCondition(t,e);else if(t.type==="group")this.validateGroup(t,e);else throw new mt(`Unknown filter node type: ${t.type}`,void 0,t.id)}static validateCondition(t,e=!0){if(typeof t.property!="string")throw new mt("Condition must have a valid property","property",t.id);if(e&&t.property==="")throw new mt("Property must be selected","property",t.id);if(t.property==="")return;if(!t.operator||typeof t.operator!="string")throw new mt("Condition must have a valid operator","operator",t.id);if(!this.getValidOperatorsForProperty(t.property).includes(t.operator))throw new mt(`Operator '${t.operator}' is not valid for property '${t.property}'`,"operator",t.id);if(e&&this.operatorRequiresValue(t.operator)&&(t.value===null||t.value===void 0||t.value===""))throw new mt(`Operator '${t.operator}' requires a value`,"value",t.id)}static validateGroup(t,e=!0){if(!t.conjunction||!["and","or"].includes(t.conjunction))throw new mt("Group must have a valid conjunction (and/or)","conjunction",t.id);if(!Array.isArray(t.children))throw new mt("Group must have a children array","children",t.id);t.children.forEach((r,i)=>{try{this.validateFilterNode(r,e)}catch(s){throw s instanceof mt?new mt(`Child ${i}: ${s.message}`,s.field,t.id):s}})}static getValidOperatorsForProperty(t){return{"":[],title:["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],status:["is","is-not","is-empty","is-not-empty"],priority:["is","is-not","is-empty","is-not-empty"],tags:["contains","does-not-contain","is-empty","is-not-empty"],contexts:["contains","does-not-contain","is-empty","is-not-empty"],projects:["contains","does-not-contain","is-empty","is-not-empty"],due:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],scheduled:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],completedDate:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],"file.ctime":["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],"file.mtime":["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],archived:["is-checked","is-not-checked"],timeEstimate:["is","is-not","is-greater-than","is-less-than"],recurrence:["is-empty","is-not-empty"],"status.isCompleted":["is-checked","is-not-checked"]}[t]||[]}static isFilterNodeComplete(t){try{return this.validateFilterNode(t,!0),!0}catch(e){return!1}}static operatorRequiresValue(t){return!["is-empty","is-not-empty","is-checked","is-not-checked"].includes(t)}static getTaskPropertyValue(t,e){switch(e){case"title":return t.title;case"status":return t.status;case"priority":return t.priority;case"tags":return t.tags||[];case"contexts":return t.contexts||[];case"projects":return t.projects||[];case"due":return t.due;case"scheduled":return t.scheduled;case"completedDate":return t.completedDate;case"file.ctime":return t.dateCreated;case"file.mtime":return t.dateModified;case"archived":return t.archived;case"timeEstimate":return t.timeEstimate;case"recurrence":return t.recurrence;case"status.isCompleted":return;default:throw new Xi(`Unknown property: ${e}`)}}static applyOperator(t,e,r,i,s){try{switch(e){case"is":return this.isEqual(t,r,s);case"is-not":return!this.isEqual(t,r,s);case"contains":return this.contains(t,r);case"does-not-contain":return!this.contains(t,r);case"is-before":return this.isBefore(t,r);case"is-after":return this.isAfter(t,r);case"is-on-or-before":return this.isOnOrBefore(t,r);case"is-on-or-after":return this.isOnOrAfter(t,r);case"is-empty":return this.isEmpty(t);case"is-not-empty":return!this.isEmpty(t);case"is-checked":return t===!0;case"is-not-checked":return t!==!0;case"is-greater-than":return this.isGreaterThan(t,r);case"is-less-than":return this.isLessThan(t,r);default:throw new Xi(`Unknown operator: ${e}`,i)}}catch(a){throw a instanceof Xi?a:new Xi(`Error applying operator '${e}': ${a.message}`,i)}}static isEqual(t,e,r){return r&&this.isDateProperty(r)&&typeof t=="string"&&typeof e=="string"&&(t||Yu(e))?this.isEqualDate(t,e):Array.isArray(t)?Array.isArray(e)?t.some(i=>e.includes(i)):t.includes(e):Array.isArray(e)?e.includes(t):t===e}static contains(t,e){return Array.isArray(t)?Array.isArray(e)?e.some(r=>t.includes(r)):t.includes(e):typeof t=="string"?Array.isArray(e)?e.some(r=>typeof r=="string"&&t.toLowerCase().includes(r.toLowerCase())):typeof e=="string"&&t.toLowerCase().includes(e.toLowerCase()):!1}static isBefore(t,e){if(!t||!e)return!1;try{let r=hs(e);return Di(t,r)}catch(r){return!1}}static isAfter(t,e){if(!t||!e)return!1;try{let r=hs(e);return Di(r,t)}catch(r){return!1}}static isOnOrBefore(t,e){if(!t||!e)return!1;try{let r=hs(e);return Di(t,r)||Ze(Z(t),Z(r))}catch(r){return!1}}static isOnOrAfter(t,e){if(!t||!e)return!1;try{let r=hs(e);return Di(r,t)||Ze(Z(t),Z(r))}catch(r){return!1}}static isDateProperty(t){return["due","scheduled","completedDate","file.ctime","file.mtime"].includes(t)}static isEqualDate(t,e){try{let r=hs(e);return Ze(Z(t),Z(r))}catch(r){return!1}}static isEmpty(t){return t==null?!0:typeof t=="string"?t.trim()==="":Array.isArray(t)?t.length===0?!0:t.every(e=>{if(typeof e!="string")return!1;let r=e.trim();return r.length===0||r==='""'||r==="''"}):!1}static isGreaterThan(t,e){let r=typeof t=="number"?t:parseFloat(t),i=typeof e=="number"?e:parseFloat(e);return isNaN(r)||isNaN(i)?!1:r>i}static isLessThan(t,e){let r=typeof t=="number"?t:parseFloat(t),i=typeof e=="number"?e:parseFloat(e);return isNaN(r)||isNaN(i)?!1:r<i}};me.idCounter=0;Au();we();var Md=class{constructor(t){this.dragState=null;this.onReorder=t}setupDragAndDrop(t,e){this.initializeDragState(),t.addEventListener("dragstart",r=>this.handleDragStart(r,t,e)),t.addEventListener("dragend",()=>this.handleDragEnd(t)),t.addEventListener("dragover",r=>this.handleDragOver(r,t)),t.addEventListener("drop",r=>this.handleDrop(r,e))}setupGlobalHandlers(t){t.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation()}),t.addEventListener("drop",e=>{var s;if(e.preventDefault(),e.stopPropagation(),!((s=this.dragState)!=null&&s.draggedElement)||this.dragState.dropHandled)return;this.dragState.dropHandled=!0;let r=this.dragState.draggedIndex,i=this.calculateDropPosition();r!==i&&this.onReorder(r,i)})}initializeDragState(){this.dragState||(this.dragState={draggedElement:null,placeholder:null,draggedIndex:-1,dropHandled:!1})}handleDragStart(t,e,r){this.dragState&&(this.dragState.draggedElement=e,this.dragState.draggedIndex=r,this.dragState.dropHandled=!1,e.classList.add("filter-bar__view-item-container--dragging"),this.dragState.placeholder=e.cloneNode(!0),this.dragState.placeholder.classList.add("filter-bar__view-item-container--placeholder"),this.dragState.placeholder.classList.remove("filter-bar__view-item-container--dragging"),t.dataTransfer&&(t.dataTransfer.setData("text/plain",r.toString()),t.dataTransfer.effectAllowed="move"))}handleDragEnd(t){var e;this.dragState&&(t.classList.remove("filter-bar__view-item-container--dragging"),(e=this.dragState.placeholder)!=null&&e.parentNode&&this.dragState.placeholder.parentNode.removeChild(this.dragState.placeholder),this.resetDragState())}handleDragOver(t,e){var a;if(t.preventDefault(),!((a=this.dragState)!=null&&a.draggedElement)||this.dragState.draggedElement===e)return;let r=e.getBoundingClientRect(),s=t.clientY-r.top<r.height/2;e.parentNode&&this.dragState.placeholder&&(s?e.parentNode.insertBefore(this.dragState.placeholder,e):e.parentNode.insertBefore(this.dragState.placeholder,e.nextSibling))}handleDrop(t,e){var s,a;if(t.preventDefault(),!((s=this.dragState)!=null&&s.draggedElement)||this.dragState.dropHandled)return;this.dragState.dropHandled=!0;let r=this.dragState.draggedIndex,i=(a=this.calculateDropPosition())!=null?a:e;r!==i&&this.onReorder(r,i)}calculateDropPosition(){var r,i;if(!((i=(r=this.dragState)==null?void 0:r.placeholder)!=null&&i.parentNode))return-1;let t=this.dragState.placeholder.parentNode,e=0;for(let s of t.children){if(s===this.dragState.placeholder)break;s.classList.contains("filter-bar__view-item-container")&&!s.classList.contains("filter-bar__view-item-container--placeholder")&&e++}return e>this.dragState.draggedIndex&&e--,e}resetDragState(){this.dragState&&(this.dragState.draggedElement=null,this.dragState.placeholder=null,this.dragState.draggedIndex=-1,this.dragState.dropHandled=!1)}};var Kp=class extends K.Modal{constructor(e,r){super(e);this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Save view"});let r=new K.TextComponent(e).setPlaceholder("Enter view name...").onChange(s=>{this.name=s});r.inputEl.style.width="100%";let i=e.createDiv({cls:"modal-button-container"});new K.ButtonComponent(i).setButtonText("Save").setCta().onClick(()=>{this.name&&(this.onSubmit(this.name),this.close())})}onClose(){this.contentEl.empty()}},Xt=class extends Pr{constructor(e,r,i,s){super();this.savedViews=[];this.activeSavedView=null;this.isLoadingSavedView=!1;this.isUserTyping=!1;this.viewOptionsConfig=null;this.ignoreNextClick=!1;this.sectionStates={filterBox:!1,filters:!0,display:!0,viewOptions:!1};this.app=e,this.container=r,this.currentQuery=me.deepCloneFilterQuery(i),this.filterOptions=s,this.dragDropHandler=new Md((a,o)=>{this.emit("reorderViews",a,o)}),this.ensureValidFilterQuery(),this.debouncedEmitQueryChange=(0,K.debounce)(()=>{!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.emit("queryChange",me.deepCloneFilterQuery(this.currentQuery))},300),this.debouncedHandleSearchInput=(0,K.debounce)(()=>{this.handleSearchInput()},800),this.render(),this.updateUI(),this.setupClickOutsideHandlers()}ensureValidFilterQuery(){var e,r,i;if(!this.currentQuery||typeof this.currentQuery!="object"||this.currentQuery.type!=="group"||!Array.isArray(this.currentQuery.children)||typeof this.currentQuery.conjunction!="string"){let s=(e=this.currentQuery)!=null&&e.sortKey&&typeof this.currentQuery.sortKey=="string"?this.currentQuery.sortKey:"due",a=(r=this.currentQuery)!=null&&r.sortDirection&&typeof this.currentQuery.sortDirection=="string"?this.currentQuery.sortDirection:"asc",o=(i=this.currentQuery)!=null&&i.groupKey&&typeof this.currentQuery.groupKey=="string"?this.currentQuery.groupKey:"none";this.currentQuery={type:"group",id:me.generateId(),conjunction:"and",children:[],sortKey:s,sortDirection:a,groupKey:o}}}updateQuery(e){this.currentQuery=me.deepCloneFilterQuery(e),this.ensureValidFilterQuery(),!this.isLoadingSavedView&&this.activeSavedView&&this.clearActiveSavedView(),this.updateUI()}handleSearchInput(){var e;try{let r=((e=this.searchInput)==null?void 0:e.getValue().trim())||"";this.removeSearchConditions(),r&&this.addSearchConditionWithGrouping(r),this.updateFilterBuilder(),this.emit("queryChange",me.deepCloneFilterQuery(this.currentQuery)),setTimeout(()=>{this.isUserTyping=!1},1e3)}catch(r){console.error("Error handling search input:",r)}}removeSearchConditions(){if(!Array.isArray(this.currentQuery.children)){this.currentQuery.children=[];return}let e=this.currentQuery.children.findIndex(r=>r.type==="condition"&&r.property==="title"&&r.operator==="contains"&&r.id.startsWith("search_"));if(e!==-1&&(this.currentQuery.children.splice(e,1),this.currentQuery.children.length===1&&this.currentQuery.children[0].type==="group")){let r=this.currentQuery.children[0];this.currentQuery.children=r.children,this.currentQuery.conjunction=r.conjunction}}addSearchConditionWithGrouping(e){Array.isArray(this.currentQuery.children)||(this.currentQuery.children=[]);let r={type:"condition",id:`search_${me.generateId()}`,property:"title",operator:"contains",value:e},i=this.currentQuery.children.filter(s=>!(s.type==="condition"&&s.property==="title"&&s.operator==="contains"&&s.id.startsWith("search_")));if(i.length===0)this.currentQuery.children=[r];else{let s={type:"group",id:me.generateId(),conjunction:this.currentQuery.conjunction,children:i};this.currentQuery.children=[r,s],this.currentQuery.conjunction="and"}}updateSavedViews(e){this.savedViews=e,this.renderViewSelectorDropdown()}getCurrentQuery(){return me.deepCloneFilterQuery(this.currentQuery)}clearActiveSavedView(){this.activeSavedView=null}render(){try{this.container.empty(),this.container.addClass("advanced-filter-bar"),this.renderTopControls()}catch(e){console.error("Error rendering FilterBar:",e),this.renderFallbackUI()}}renderFallbackUI(){try{if(this.container.children.length===0){this.container.addClass("advanced-filter-bar");let e=this.container.createDiv({cls:"filter-bar-error"});e.textContent="Filter bar temporarily unavailable"}}catch(e){console.error("Error rendering fallback FilterBar UI:",e)}}renderTopControls(){let e=this.container.createDiv("filter-bar__top-controls");new K.ButtonComponent(e).setIcon("list-filter").setTooltip("Toggle filter").setClass("filter-bar__filter-toggle").onClick(()=>{this.toggleMainFilterBox()}),this.searchInput=new K.TextComponent(e).setPlaceholder("Search tasks..."),this.searchInput.inputEl.addClass("filter-bar__search-input"),(0,K.setTooltip)(this.searchInput.inputEl,"Search task titles",{placement:"top"}),this.searchInput.onChange(()=>{this.isUserTyping=!0,this.debouncedHandleSearchInput()}),this.viewSelectorButton=new K.ButtonComponent(e).setButtonText("Views").setClass("filter-bar__templates-button").setTooltip("Saved filter views").onClick(()=>{this.toggleViewSelectorDropdown()}),this.renderMainFilterBox(e),this.viewSelectorDropdown=e.createDiv({cls:"filter-bar__view-selector-dropdown filter-bar__view-selector-dropdown--hidden"}),this.renderViewSelectorDropdown()}renderMainFilterBox(e){this.mainFilterBox=e.createDiv("filter-bar__main-box"),this.sectionStates.filterBox||this.mainFilterBox.addClass("filter-bar__main-box--collapsed"),this.renderFilterBuilder(this.mainFilterBox),this.renderDisplaySection(this.mainFilterBox),this.renderViewOptions(this.mainFilterBox)}setupClickOutsideHandlers(){this.abortController=new AbortController;let{signal:e}=this.abortController;document.addEventListener("click",r=>{this.handleDocumentClick(r)},{signal:e,passive:!0}),document.addEventListener("keydown",r=>{this.handleKeyDown(r)},{signal:e})}ignoreNextClickOutside(){this.ignoreNextClick=!0,this.ignoreClickTimeout&&window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=window.setTimeout(()=>{this.ignoreNextClick=!1,this.ignoreClickTimeout=void 0},100)}handleKeyDown(e){var r;if(e.key==="Escape"){if(this.sectionStates.filterBox){this.sectionStates.filterBox=!1,this.updateFilterBoxState(),e.preventDefault();return}this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(r=this.viewSelectorButton)!=null&&r.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"),e.preventDefault())}}handleDocumentClick(e){var i;if(this.ignoreNextClick){this.ignoreNextClick=!1;return}let r=e.target;if(r){if(this.sectionStates.filterBox&&this.mainFilterBox&&this.container){let s=this.container.querySelector(".filter-bar__filter-toggle"),a=this.container.contains(r),o=s&&s.contains(r);!a&&!o&&(this.sectionStates.filterBox=!1,this.updateFilterBoxState())}this.viewSelectorDropdown&&((i=this.viewSelectorButton)!=null&&i.buttonEl)&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&!this.viewSelectorButton.buttonEl.contains(r)&&!this.viewSelectorDropdown.contains(r)&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}}toggleMainFilterBox(){this.sectionStates.filterBox=!this.sectionStates.filterBox,this.updateFilterBoxState()}updateFilterBoxState(){let e=this.container.querySelector(".filter-bar__main-box"),r=this.container.querySelector(".filter-bar__filter-toggle");e&&e.classList.toggle("filter-bar__main-box--collapsed",!this.sectionStates.filterBox),r&&r.classList.toggle("filter-bar__filter-toggle--active",this.sectionStates.filterBox)}async deleteView(e){await wn(this.app,{title:"Delete View",message:`Are you sure you want to delete the view "${e.name}"?`,isDestructive:!0})&&this.emit("deleteView",e.id)}renderViewSelectorDropdown(){if(this.viewSelectorDropdown)if(this.viewSelectorDropdown.empty(),this.savedViews.length===0)this.viewSelectorDropdown.createDiv({text:"No saved views",cls:"filter-bar__view-empty-message"});else{let e=this.viewSelectorDropdown.createDiv("filter-bar__view-section"),r=e.createDiv({text:"Saved views",cls:"filter-bar__view-section-header"});(0,K.setTooltip)(r,"Your saved filter configurations",{placement:"top"}),this.savedViews.forEach((i,s)=>{let a=e.createDiv({cls:"filter-bar__view-item-container"});a.draggable=!0,a.setAttribute("data-view-index",s.toString());let o=a.createDiv({cls:"filter-bar__view-drag-handle"});(0,K.setTooltip)(o,"Drag to reorder views",{placement:"top"}),new K.ButtonComponent(a).setButtonText(i.name).setClass("filter-bar__view-item").setTooltip(`Load saved view: ${i.name}`).onClick(()=>{this.loadSavedView(i)}),new K.ButtonComponent(a).setIcon("trash-2").setClass("filter-bar__view-delete").setTooltip("Delete view").onClick(async()=>{await wn(this.app,{title:"Delete View",message:`Are you sure you want to delete the view "${i.name}"?`,isDestructive:!0})&&this.emit("deleteView",i.id)}),this.dragDropHandler.setupDragAndDrop(a,s)}),this.dragDropHandler.setupGlobalHandlers(e)}}renderFilterBuilder(e){let r=e.createDiv("filter-bar__section"),i=r.createDiv("filter-bar__section-header"),s=i.createDiv("filter-bar__section-header-main");s.createSpan({text:"Filter",cls:"filter-bar__section-title"}),(0,K.setTooltip)(s,"Click to expand/collapse filter conditions",{placement:"top"}),this.activeSavedView&&s.createSpan({text:`(${this.activeSavedView.name})`,cls:"filter-bar__active-view-name"});let a=i.createDiv("filter-bar__section-header-actions");new K.ButtonComponent(a).setIcon("save").setTooltip("Save current filter as view").setClass("filter-bar__save-button").onClick(()=>{this.showSaveViewDialog()});let o=r.createDiv("filter-bar__section-content");this.sectionStates.filters||o.addClass("filter-bar__section-content--collapsed"),this.filterBuilder=o.createDiv("filter-bar__filter-builder"),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),s.addEventListener("click",()=>{this.toggleSection("filters",i,o)})}renderFilterGroup(e,r,i,s,a){if(!r||typeof r!="object"){console.error("FilterBar: Invalid group object provided to renderFilterGroup");return}Array.isArray(r.children)||(r.children=[]);let o=e.createDiv("filter-bar__group"),l=o.createDiv("filter-bar__group-header"),c=l.createDiv("filter-bar__conjunction");(0,K.setTooltip)(c,"Choose whether ALL or ANY of the conditions must match",{placement:"top"}),new K.DropdownComponent(c).addOption("and","All").addOption("or","Any").setValue(r.conjunction||"and").onChange(h=>{r.conjunction=h,this.updateUI(),this.emitQueryChange()}),c.createSpan({text:"of the following are true:",cls:"filter-bar__conjunction-text"}),i>0&&s&&a!==void 0&&new K.ButtonComponent(l).setIcon("trash-2").setClass("filter-bar__delete-button").setTooltip("Delete filter group").onClick(()=>{this.removeFilterGroup(s,a)});let d=o.createDiv("filter-bar__children");r.children.forEach((h,f)=>{this.renderFilterNode(d,h,r,f,i+1)});let u=o.createDiv("filter-bar__group-actions");new K.ButtonComponent(u).setIcon("plus").setButtonText("Add filter").setClass("filter-bar__action-button").setClass("filter-bar__add-filter").setTooltip("Add a new filter condition").onClick(()=>{this.addFilterCondition(r)}),new K.ButtonComponent(u).setIcon("plus-circle").setButtonText("Add filter group").setClass("filter-bar__action-button").setClass("filter-bar__add-group").setTooltip("Add a nested filter group").onClick(()=>{this.addFilterGroup(r)})}renderFilterNode(e,r,i,s,a){r.type==="condition"?this.renderFilterCondition(e,r,i,s,a):r.type==="group"&&this.renderFilterGroup(e,r,a,i,s)}renderFilterCondition(e,r,i,s,a){let o=e.createDiv("filter-bar__condition");o.createSpan({text:s===0?"where":i.conjunction,cls:"filter-bar__condition-prefix"});let l=Object.fromEntries([["","Select..."],...ba.map(h=>[h.id,h.label])]),c=new K.DropdownComponent(o).addOptions(l).setValue(r.property);(0,K.setTooltip)(c.selectEl,"Choose which task property to filter by",{placement:"top"}),c.onChange(h=>{if(r.property=h,h!==""){let f=ba.find(p=>p.id===h);if(f&&f.supportedOperators.length>0){let p=f.supportedOperators[0];r.operator=p;let m=Rl.find(g=>g.id===p);r.value=m!=null&&m.requiresValue?"":null}}this.updateUI(),this.emitQueryChange()});let d=new K.DropdownComponent(o);this.updateOperatorOptions(d,r.property),d.setValue(r.operator),(0,K.setTooltip)(d.selectEl,"Choose how to compare the property value",{placement:"top"}),d.onChange(h=>{r.operator=h,this.updateUI(),this.emitQueryChange()});let u=o.createDiv("filter-bar__value-container");this.renderValueInput(u,r),new K.ButtonComponent(o).setIcon("trash-2").setClass("filter-bar__delete-button").setTooltip("Delete condition").onClick(()=>{this.removeFilterCondition(i,s)})}updateOperatorOptions(e,r){e.selectEl.empty();let i=ba.find(s=>s.id===r);i&&i.supportedOperators.forEach(s=>{let a=Rl.find(o=>o.id===s);a&&e.addOption(a.id,a.label)})}renderValueInput(e,r){e.empty();let i=ba.find(a=>a.id===r.property),s=Rl.find(a=>a.id===r.operator);if(!(!i||!s||!s.requiresValue))switch(i.valueInputType){case"text":this.renderTextInput(e,r);break;case"select":this.renderSelectInput(e,r,i);break;case"date":this.renderDateInput(e,r);break;case"number":this.renderNumberInput(e,r);break}}renderTextInput(e,r){let i=new K.TextComponent(e).setValue(String(r.value||"")).onChange(s=>{r.value=s||null,this.debouncedEmitQueryChange()});(0,K.setTooltip)(i.inputEl,"Enter the value to filter by",{placement:"top"})}renderSelectInput(e,r,i){let s=new K.DropdownComponent(e).addOption("","Select...");switch(i.id){case"status":this.filterOptions.statuses.forEach(a=>{s.addOption(a.value,a.label)});break;case"priority":this.filterOptions.priorities.forEach(a=>{s.addOption(a.value,a.label)});break;case"tags":this.filterOptions.tags.forEach(a=>{s.addOption(a,a)});break;case"contexts":this.filterOptions.contexts.forEach(a=>{s.addOption(a,a)});break;case"projects":this.filterOptions.projects.forEach(a=>{s.addOption(a,a)});break}if((0,K.setTooltip)(s.selectEl,`Select a ${i.label.toLowerCase()} to filter by`,{placement:"top"}),i.id==="projects"){let a=String(r.value||"");if(a.startsWith("[[")&&a.endsWith("]]")){let o=a.substring(2,a.length-2);s.setValue(o)}else s.setValue(a)}else s.setValue(String(r.value||""));s.onChange(a=>{i.id==="projects"&&a?r.value=`[[${a}]]`:r.value=a||null,this.emitQueryChange()})}renderDateInput(e,r){let i=e.createDiv("filter-date-input-container"),s=new K.TextComponent(i).setValue(String(r.value||"")).onChange(o=>{r.value=o||null,this.updateDateInputValidation(s,o);let l=(o||"").trim();(l===""||Uu(l))&&this.emitQueryChange()});s.setPlaceholder("today, 2024-12-25, next week..."),s.inputEl.addClass("filter-date-text-input"),(0,K.setTooltip)(s.inputEl,"Enter a date using natural language or ISO format",{placement:"top"}),this.updateDateInputValidation(s,String(r.value||""));let a=i.createEl("button",{cls:"filter-date-help-button",text:"?"});(0,K.setTooltip)(a,"Show natural language date examples",{placement:"top"}),a.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),this.showNaturalLanguageDateHelp(a)})}updateDateInputValidation(e,r){let i=e.inputEl;i.removeClass("is-valid","is-invalid","is-empty");let s=r.trim();s===""?i.addClass("is-empty"):Uu(s)?i.addClass("is-valid"):i.addClass("is-invalid")}showNaturalLanguageDateHelp(e){document.querySelectorAll(".filter-date-help-tooltip").forEach(l=>l.remove());let r=document.body.createDiv("filter-date-help-tooltip");r.createEl("h4",{text:"Natural Language Dates"});let i=r.createEl("ul");["today","tomorrow","yesterday","next week","last week","in 3 days","2 days ago","in 1 week","2 weeks ago","2024-12-25","2024-12-25T14:30:00"].forEach(l=>{i.createEl("li",{text:l})});let a=e.getBoundingClientRect();r.style.position="absolute",r.style.top=`${a.bottom+5}px`,r.style.left=`${a.left}px`,r.style.zIndex="1000";let o=()=>{r.remove(),document.removeEventListener("click",o)};setTimeout(()=>{document.addEventListener("click",o)},100)}renderNumberInput(e,r){let i=new K.TextComponent(e).setValue(String(r.value||"")).onChange(s=>{r.value=s?parseFloat(s):null,this.debouncedEmitQueryChange()});i.inputEl.type="number",(0,K.setTooltip)(i.inputEl,"Enter a numeric value to filter by",{placement:"top"})}renderDisplaySection(e){let r=e.createDiv("filter-bar__section"),i=r.createDiv("filter-bar__section-header"),s=i.createDiv("filter-bar__section-header-main");s.createSpan({text:"Display & Organization",cls:"filter-bar__section-title"}),(0,K.setTooltip)(s,"Click to expand/collapse sorting and grouping options",{placement:"top"});let a=r.createDiv("filter-bar__section-content");this.sectionStates.display||a.addClass("filter-bar__section-content--collapsed"),this.displaySection=a;let o=this.displaySection.createDiv("filter-bar__display-controls"),l=o.createDiv("filter-bar__sort-container");l.createSpan({text:"Sort by:",cls:"filter-bar__label"});let c=new K.DropdownComponent(l).addOptions({due:"Due Date",scheduled:"Scheduled Date",priority:"Priority",title:"Title",dateCreated:"Created Date"}).setValue(this.currentQuery.sortKey||"due").onChange(h=>{this.currentQuery.sortKey=h,this.emitQueryChange()});(0,K.setTooltip)(c.selectEl,"Choose how to sort tasks",{placement:"top"}),new K.ButtonComponent(l).setClass("filter-bar__sort-direction").setTooltip("Toggle sort direction").onClick(()=>{this.currentQuery.sortDirection=this.currentQuery.sortDirection==="asc"?"desc":"asc",this.updateSortDirectionButton(),this.emitQueryChange()});let d=o.createDiv("filter-bar__group-container");d.createSpan({text:"Group by:",cls:"filter-bar__label"});let u=new K.DropdownComponent(d).addOptions({none:"None",status:"Status",priority:"Priority",context:"Context",project:"Project",due:"Due Date",scheduled:"Scheduled Date"}).setValue(this.currentQuery.groupKey||"none").onChange(h=>{this.currentQuery.groupKey=h,this.emitQueryChange()});(0,K.setTooltip)(u.selectEl,"Group tasks by a common property",{placement:"top"}),this.updateSortDirectionButton(),s.addEventListener("click",()=>{this.toggleSection("display",i,a)})}removeFilterGroup(e,r){e.children.splice(r,1),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete(),this.emitQueryChange()}renderViewOptions(e){let r=e.createDiv("filter-bar__section");this.viewOptionsContainer=r.createDiv("filter-bar__view-options-container"),this.populateViewOptions()}setViewOptions(e){this.viewOptionsConfig=e,this.populateViewOptions()}populateViewOptions(){if(!this.viewOptionsContainer)return;this.viewOptionsContainer.empty();let e=this.viewOptionsConfig;if(!e||e.length===0){this.viewOptionsContainer.addClass("filter-bar__section--hidden");return}this.viewOptionsContainer.removeClass("filter-bar__section--hidden");let r=this.viewOptionsContainer.createDiv("filter-bar__section-header"),i=r.createDiv("filter-bar__section-header-main");i.createSpan({text:"View Options",cls:"filter-bar__section-title"}),(0,K.setTooltip)(i,"Click to expand/collapse view-specific options",{placement:"top"});let s=this.viewOptionsContainer.createDiv("filter-bar__section-content");this.sectionStates.viewOptions||s.addClass("filter-bar__section-content--collapsed"),e.forEach(a=>{let l=s.createDiv("filter-bar__view-option").createEl("label",{cls:"filter-bar__view-option-label"}),c=l.createEl("input",{type:"checkbox",cls:"filter-bar__view-option-checkbox"});c.checked=a.value,(0,K.setTooltip)(c,`Toggle ${a.label.toLowerCase()}`,{placement:"top"}),l.createSpan({text:a.label,cls:"filter-bar__view-option-text"}),c.addEventListener("change",()=>{a.onChange(c.checked)})}),i.addEventListener("click",()=>{this.toggleSection("viewOptions",r,s)})}addFilterCondition(e){let r={type:"condition",id:me.generateId(),property:"",operator:"contains",value:""};e.children.push(r),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete()}addFilterGroup(e){let r={type:"group",id:me.generateId(),conjunction:"and",children:[]};e.children.push(r),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete()}removeFilterCondition(e,r){e.children.splice(r,1),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete(),this.emitQueryChange()}updateSortDirectionButton(){let e=this.container.querySelector(".filter-bar__sort-direction");e&&(e.textContent=this.currentQuery.sortDirection==="asc"?"\u2191":"\u2193",e.removeAttribute("title"))}toggleViewSelectorDropdown(){if(!this.viewSelectorDropdown||!this.viewSelectorButton)return;let e=this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden");this.viewSelectorDropdown.classList.toggle("filter-bar__view-selector-dropdown--hidden",!e),e?this.viewSelectorButton.buttonEl.classList.add("filter-bar__templates-button--active"):this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active")}toggleSection(e,r,i){this.sectionStates[e]=!this.sectionStates[e];let s=this.sectionStates[e];r.classList.toggle("filter-bar__section-header--collapsed",!s),i.classList.toggle("filter-bar__section-content--collapsed",!s)}showSaveViewDialog(){new Kp(this.app,e=>{let r=this.getCurrentViewOptions();this.emit("saveView",{name:e,query:this.currentQuery,viewOptions:r}),this.toggleViewSelectorDropdown()}).open()}getCurrentViewOptions(){if(!this.viewOptionsConfig||this.viewOptionsConfig.length===0)return;let e={};return this.viewOptionsConfig.forEach(r=>{e[r.id]=r.value}),e}loadSavedView(e){this.isLoadingSavedView=!0,this.currentQuery=me.deepCloneFilterQuery(e.query),this.activeSavedView=e,this.render(),this.emitQueryChange(),e.viewOptions&&this.emit("loadViewOptions",e.viewOptions),this.toggleViewSelectorDropdown(),this.isLoadingSavedView=!1}updateUI(){this.syncSearchInput(),this.render()}updateFilterBuilder(){var e,r;try{if(this.filterBuilder&&this.filterBuilder.isConnected){let i=(e=this.searchInput)==null?void 0:e.getValue(),s=((r=this.searchInput)==null?void 0:r.inputEl)===document.activeElement;this.filterBuilder.empty(),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),this.searchInput&&i!==void 0&&(this.searchInput.setValue(i),s&&this.searchInput.inputEl.focus()),this.updateFilterBoxState()}}catch(i){console.error("Error updating filter builder:",i)}}updateFilterBuilderComplete(){var e,r;try{if(this.filterBuilder&&this.filterBuilder.isConnected){let i=(e=this.searchInput)==null?void 0:e.getValue(),s=((r=this.searchInput)==null?void 0:r.inputEl)===document.activeElement;this.filterBuilder.empty(),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0);let a=this.container.querySelector(".filter-bar__display-section");a&&(a.empty(),this.renderDisplaySection(a)),this.searchInput&&i!==void 0&&(this.searchInput.setValue(i),s&&this.searchInput.inputEl.focus()),this.updateFilterBoxState()}}catch(i){console.error("Error updating filter builder completely:",i),this.render()}}syncSearchInput(){if(!this.searchInput||this.isUserTyping)return;if(!this.currentQuery||!Array.isArray(this.currentQuery.children)){this.searchInput.setValue("");return}let e=this.currentQuery.children.find(r=>r.type==="condition"&&r.property==="title"&&r.operator==="contains"&&r.id.startsWith("search_"));this.searchInput.setValue(String((e==null?void 0:e.value)||""))}emitQueryChange(){!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.emitQueryChangeIfComplete()}emitQueryChangeIfComplete(){this.isQueryMeaningful(this.currentQuery)&&this.emit("queryChange",me.deepCloneFilterQuery(this.currentQuery))}isQueryMeaningful(e){return e.children.length===0?!0:this.hasCompleteConditions(e)}hasCompleteConditions(e){for(let r of e.children)if(r.type==="condition"){if(me.isFilterNodeComplete(r))return!0}else if(r.type==="group"&&this.hasCompleteConditions(r))return!0;return!1}updateFilterOptions(e){this.filterOptions=e,this.updateUI()}getCurrentFilterOptions(){return this.filterOptions}async forceRefreshOptions(e){let r=await e.getFilterOptions();this.updateFilterOptions(r)}destroy(){try{this.container&&this.container.isConnected&&this.container.empty(),this.removeAllListeners(),this.abortController&&(this.abortController.abort(),this.abortController=void 0),this.ignoreClickTimeout&&(window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=void 0)}catch(e){console.error("Error destroying FilterBar:",e);try{this.removeAllListeners(),this.abortController&&(this.abortController.abort(),this.abortController=void 0),this.ignoreClickTimeout&&(window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=void 0)}catch(r){console.error("Error during FilterBar cleanup fallback:",r)}}}};ui();we();at();var Id=class extends le.ItemView{constructor(e,r){super(e);this.calendar=null;this.listeners=[];this.functionListeners=[];this.resizeObserver=null;this.resizeTimeout=null;this.filterBar=null;this.headerCollapsed=!0;this.plugin=r,this.showScheduled=this.plugin.settings.calendarViewSettings.defaultShowScheduled,this.showDue=this.plugin.settings.calendarViewSettings.defaultShowDue,this.showTimeEntries=this.plugin.settings.calendarViewSettings.defaultShowTimeEntries,this.showRecurring=this.plugin.settings.calendarViewSettings.defaultShowRecurring,this.showICSEvents=this.plugin.settings.calendarViewSettings.defaultShowICSEvents,this.showTimeblocks=this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"}}getViewType(){return Ur}getDisplayText(){return"Advanced Calendar"}getIcon(){return"calendar-range"}async onOpen(){var s,a,o;await this.plugin.onReady(),await this.plugin.waitForMigration();let e=this.plugin.viewStateManager.getFilterState(Ur);e?this.currentQuery=e:this.plugin.filterService&&(this.currentQuery=this.plugin.filterService.createDefaultQuery());let r=this.plugin.viewStateManager.getViewPreferences(Ur);r&&(this.showScheduled=r.showScheduled,this.showDue=r.showDue,this.showTimeEntries=r.showTimeEntries,this.showRecurring=r.showRecurring,this.showICSEvents=(s=r.showICSEvents)!=null?s:this.plugin.settings.calendarViewSettings.defaultShowICSEvents,this.showTimeblocks=(a=r.showTimeblocks)!=null?a:this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.headerCollapsed=(o=r.headerCollapsed)!=null?o:!0);let i=async()=>{let l=this.contentEl;l.empty(),l.addClass("tasknotes-plugin"),l.addClass("advanced-calendar-view"),await this.renderView(),this.registerEvents(),await this.initializeCalendar()};await i(),this.contentEl.onWindowMigrated(i)}async renderView(){let{contentEl:e}=this;e.empty();let r=e.createDiv({cls:"advanced-calendar-view__container"});await this.createHeader(r),r.createDiv({cls:"advanced-calendar-view__calendar-container",attr:{id:"advanced-calendar"}})}async createHeader(e){let r=e.createDiv({cls:"advanced-calendar-view__header"}),s=r.createDiv({cls:"advanced-calendar-view__mobile-toggle"}).createEl("button",{text:this.headerCollapsed?"Show filters":"Hide filters",cls:"advanced-calendar-view__collapse-btn"});s.addEventListener("click",()=>{this.headerCollapsed=!this.headerCollapsed,s.textContent=this.headerCollapsed?"Show filters":"Hide filters",this.saveViewPreferences(),this.updateHeaderVisibility()});let o=r.createDiv({cls:`advanced-calendar-view__main-row ${this.headerCollapsed?"collapsed":"expanded"}`}).createDiv({cls:"filter-bar-container"});await this.waitForCacheReady();let l=await this.plugin.filterService.getFilterOptions();this.filterBar=new Xt(this.app,o,this.currentQuery,l);let c=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(c),this.filterBar.on("saveView",({name:d,query:u,viewOptions:h})=>{this.plugin.viewStateManager.saveView(d,u,h)}),this.filterBar.on("deleteView",d=>{this.plugin.viewStateManager.deleteView(d)}),this.filterBar.on("loadViewOptions",d=>{this.applyViewOptions(d)}),this.plugin.viewStateManager.on("saved-views-changed",d=>{var u;(u=this.filterBar)==null||u.updateSavedViews(d)}),this.filterBar.on("reorderViews",(d,u)=>{this.plugin.viewStateManager.reorderSavedViews(d,u)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async d=>{this.currentQuery=d,await this.plugin.viewStateManager.setFilterState(Ur,d),this.refreshEvents()}),this.setupViewOptions()}updateHeaderVisibility(){let e=this.contentEl.querySelector(".advanced-calendar-view__main-row");e&&(e.className=`advanced-calendar-view__main-row ${this.headerCollapsed?"collapsed":"expanded"}`),this.calendar&&this.calendar.setOption("headerToolbar",this.getHeaderToolbarConfig())}setupViewOptions(){if(!this.filterBar)return;let e=[{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents,onChange:r=>{this.showICSEvents=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"timeEntries",label:"Time entries",value:this.showTimeEntries,onChange:r=>{this.showTimeEntries=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"timeblocks",label:"Timeblocks",value:this.showTimeblocks,onChange:r=>{this.showTimeblocks=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"scheduled",label:"Scheduled dates",value:this.showScheduled,onChange:r=>{this.showScheduled=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"due",label:"Due dates",value:this.showDue,onChange:r=>{this.showDue=r,this.saveViewPreferences(),this.refreshEvents()}}];if(!this.plugin.settings.calendarViewSettings.enableTimeblocking){let r=e.findIndex(i=>i.id==="timeblocks");r!==-1&&e.splice(r,1)}this.filterBar.setViewOptions(e)}getViewOptionsConfig(){let e=[{id:"scheduled",label:"Scheduled tasks",value:this.showScheduled},{id:"due",label:"Due dates",value:this.showDue},{id:"timeEntries",label:"Time entries",value:this.showTimeEntries},{id:"recurring",label:"Recurring tasks",value:this.showRecurring},{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents}];return this.plugin.settings.calendarViewSettings.enableTimeblocking&&e.push({id:"timeblocks",label:"Timeblocks",value:this.showTimeblocks}),e}onViewOptionChange(e,r){switch(e){case"scheduled":this.showScheduled=r;break;case"due":this.showDue=r;break;case"timeEntries":this.showTimeEntries=r;break;case"recurring":this.showRecurring=r;break;case"icsEvents":this.showICSEvents=r;break;case"timeblocks":this.showTimeblocks=r;break}this.saveViewPreferences(),this.refreshEvents(),this.setupViewOptions()}getHeaderToolbarConfig(){if(this.headerCollapsed&&window.innerWidth<=768)return!1;let e=this.contentEl.querySelector(".advanced-calendar-view__calendar-container"),s={left:"prev,next today",center:(e?e.getBoundingClientRect().width:window.innerWidth)<=600?"":"title",right:"refreshICS multiMonthYear,dayGridMonth,timeGridWeek,timeGridCustom,timeGridDay"};return console.log("Header toolbar config:",s),s}getCustomButtons(){let e={refreshICS:{text:"Refresh",hint:"Refresh Calendar Subscriptions",click:()=>{console.log("Refresh ICS button clicked!"),this.handleRefreshClick()}}};return console.log("Custom buttons:",e),e}async handleRefreshClick(){if(!this.plugin.icsSubscriptionService){new le.Notice("ICS subscription service not available");return}try{await this.plugin.icsSubscriptionService.refreshAllSubscriptions(),new le.Notice("All calendar subscriptions refreshed successfully"),this.refreshEvents()}catch(e){console.error("Error refreshing subscriptions:",e),new le.Notice("Failed to refresh some calendar subscriptions")}}openScheduleTasksModal(){new xd(this.app,this.plugin,(r,i)=>{r&&this.scheduleTask(r,i)}).open()}async scheduleTask(e,r){try{let i;r!=null&&r.date?r.allDay?i=I(r.date,"yyyy-MM-dd"):r.time?i=I(r.date,"yyyy-MM-dd")+"T"+r.time:i=I(r.date,"yyyy-MM-dd")+"T09:00":i=I(new Date,"yyyy-MM-dd")+"T09:00",await this.plugin.taskService.updateProperty(e,"scheduled",i)}catch(i){console.error("Error scheduling task:",i)}}async initializeCalendar(){let e=this.contentEl.querySelector("#advanced-calendar");if(!e){console.error("Calendar element not found");return}let r=this.plugin.settings.calendarViewSettings;this.updateTodayHighlight();let i=this.getCustomButtons(),s=this.getHeaderToolbarConfig();console.log("Initializing calendar with customButtons:",i),console.log("Initializing calendar with headerToolbar:",s),this.calendar=new Zc(e,{plugins:[Kw,ib,nb,ob],initialView:r.defaultView,headerToolbar:s,customButtons:i,views:{timeGridCustom:{type:"timeGrid",duration:{days:r.customDayCount||3},buttonText:`${r.customDayCount||3} days`}},height:"100%",editable:!0,droppable:!0,selectable:!0,selectMirror:r.selectMirror,locale:this.getUserLocale(),firstDay:r.firstDay,weekNumbers:r.weekNumbers,weekends:r.showWeekends,nowIndicator:r.nowIndicator,navLinks:!0,navLinkDayClick:this.handleDateTitleClick.bind(this),slotMinTime:r.slotMinTime,slotMaxTime:r.slotMaxTime,scrollTime:r.scrollTime,slotDuration:r.slotDuration,slotLabelInterval:this.getSlotLabelInterval(r.slotDuration),eventTimeFormat:this.getTimeFormat(r.timeFormat),slotLabelFormat:this.getTimeFormat(r.timeFormat),select:this.handleDateSelect.bind(this),eventClick:this.handleEventClick.bind(this),eventDrop:this.handleEventDrop.bind(this),eventResize:this.handleEventResize.bind(this),drop:this.handleExternalDrop.bind(this),eventReceive:this.handleEventReceive.bind(this),eventDidMount:this.handleEventDidMount.bind(this),events:this.getCalendarEvents.bind(this)}),requestAnimationFrame(()=>{this.calendar&&(this.calendar.render(),this.setupResizeHandling(),this.refreshEvents())})}saveViewPreferences(){let e={showScheduled:this.showScheduled,showDue:this.showDue,showTimeEntries:this.showTimeEntries,showRecurring:this.showRecurring,showICSEvents:this.showICSEvents,showTimeblocks:this.showTimeblocks,headerCollapsed:this.headerCollapsed};this.plugin.viewStateManager.setViewPreferences(Ur,e)}applyViewOptions(e){e.hasOwnProperty("showScheduled")&&(this.showScheduled=e.showScheduled),e.hasOwnProperty("showDue")&&(this.showDue=e.showDue),e.hasOwnProperty("showTimeEntries")&&(this.showTimeEntries=e.showTimeEntries),e.hasOwnProperty("showRecurring")&&(this.showRecurring=e.showRecurring),e.hasOwnProperty("showICSEvents")&&(this.showICSEvents=e.showICSEvents),e.hasOwnProperty("showTimeblocks")&&(this.showTimeblocks=e.showTimeblocks),this.setupViewOptions(),this.refreshEvents()}setupResizeHandling(){if(!this.calendar)return;this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.functionListeners.forEach(a=>a()),this.functionListeners=[],this.listeners.forEach(a=>this.plugin.emitter.offref(a)),this.listeners=[];let e=this.contentEl.ownerDocument.defaultView||window,r=()=>{this.resizeTimeout&&e.clearTimeout(this.resizeTimeout),this.resizeTimeout=e.setTimeout(()=>{this.calendar&&(this.calendar.updateSize(),this.updateHeaderVisibility())},150)};if(e.ResizeObserver){this.resizeObserver=new e.ResizeObserver(r);let a=this.contentEl.querySelector(".advanced-calendar-view__calendar-container");a&&this.resizeObserver.observe(a)}let i=this.plugin.app.workspace.on("layout-change",r);this.listeners.push(i),e.addEventListener("resize",r),this.functionListeners.push(()=>e.removeEventListener("resize",r));let s=this.plugin.app.workspace.on("active-leaf-change",a=>{a===this.leaf&&setTimeout(r,100)});this.listeners.push(s)}getSlotLabelInterval(e){switch(e){case"00:15:00":return"01:00:00";case"00:30:00":return"01:00:00";case"01:00:00":return"01:00:00";default:return"01:00:00"}}getUserLocale(){if(navigator.language)return navigator.language;if(navigator.languages&&navigator.languages.length>0)return navigator.languages[0];let e=navigator.userLanguage||navigator.browserLanguage;return e||"en"}getTimeFormat(e){return e==="12"?{hour:"numeric",minute:"2-digit",omitZeroMinute:!0,hour12:!0}:{hour:"2-digit",minute:"2-digit",hour12:!1}}async getCalendarEvents(){var r;let e=[];try{let i=await this.plugin.filterService.getGroupedTasks(this.currentQuery),s=[];for(let u of i.values())s.push(...u);let a=(r=this.calendar)==null?void 0:r.view,o=(a==null?void 0:a.activeStart)||We(new Date),l=(a==null?void 0:a.activeEnd)||pn(new Date),{utcStart:c,utcEnd:d}=Og(o,l);for(let u of s){if(u.recurrence){if(!u.scheduled)continue;if(this.showRecurring){let h=this.generateRecurringTaskInstances(u,c,d);e.push(...h)}}else{let h=!!u.scheduled,f=!!u.due;if(!h&&!f)continue;if(this.showScheduled&&h){let p=this.createScheduledEvent(u);p&&e.push(p)}if(this.showDue&&f){let p=this.createDueEvent(u);p&&e.push(p)}}if(this.showTimeEntries&&u.timeEntries){let h=this.createTimeEntryEvents(u);e.push(...h)}}if(this.showICSEvents&&this.plugin.icsSubscriptionService){let u=this.plugin.icsSubscriptionService.getAllEvents();for(let h of u){let f=this.createICSEvent(h);f&&e.push(f)}}}catch(i){console.error("Error getting calendar events:",i)}if(this.showTimeblocks&&this.plugin.settings.calendarViewSettings.enableTimeblocking)try{let i=await this.getTimeblockEvents();e.push(...i)}catch(i){console.error("Error getting timeblock events:",i)}return e}createScheduledEvent(e){if(!e.scheduled)return null;let r=dt(e.scheduled),i=e.scheduled,s;if(r&&e.timeEstimate){let c=he(i),d=new Date(c.getTime()+e.timeEstimate*60*1e3);s=I(d,"yyyy-MM-dd'T'HH:mm")}let a=this.plugin.priorityManager.getPriorityConfig(e.priority),o=(a==null?void 0:a.color)||"var(--color-accent)",l=this.plugin.statusManager.isCompletedStatus(e.status);return{id:`scheduled-${e.path}`,title:e.title,start:i,end:s,allDay:!r,backgroundColor:"transparent",borderColor:o,textColor:o,editable:!0,extendedProps:{taskInfo:e,eventType:"scheduled",isCompleted:l}}}createDueEvent(e){if(!e.due)return null;let r=dt(e.due),i=e.due,s;if(r){let d=he(i),u=new Date(d.getTime()+30*60*1e3);s=I(u,"yyyy-MM-dd'T'HH:mm")}let a=this.plugin.priorityManager.getPriorityConfig(e.priority),o=(a==null?void 0:a.color)||"var(--color-orange)",l=this.hexToRgba(o,.15),c=this.plugin.statusManager.isCompletedStatus(e.status);return{id:`due-${e.path}`,title:`DUE: ${e.title}`,start:i,end:s,allDay:!r,backgroundColor:l,borderColor:o,textColor:o,editable:!1,extendedProps:{taskInfo:e,eventType:"due",isCompleted:c}}}hexToRgba(e,r){e=e.replace("#","");let i=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),a=parseInt(e.substring(4,6),16);return`rgba(${i}, ${s}, ${a}, ${r})`}createTimeEntryEvents(e){if(!e.timeEntries)return[];let r=this.plugin.statusManager.isCompletedStatus(e.status);return e.timeEntries.filter(i=>i.endTime).map((i,s)=>({id:`timeentry-${e.path}-${s}`,title:e.title,start:i.startTime,end:i.endTime,allDay:!1,backgroundColor:"var(--color-base-50)",borderColor:"var(--color-base-40)",textColor:"var(--text-on-accent)",editable:!1,extendedProps:{taskInfo:e,eventType:"timeEntry",isCompleted:r,timeEntryIndex:s}}))}createICSEvent(e){try{let r=this.plugin.icsSubscriptionService.getSubscriptions().find(a=>a.id===e.subscriptionId);if(!r||!r.enabled)return null;let i=this.hexToRgba(r.color,.2),s=r.color;return{id:e.id,title:e.title,start:e.start,end:e.end,allDay:e.allDay,backgroundColor:i,borderColor:s,textColor:s,editable:!1,extendedProps:{icsEvent:e,eventType:"ics",subscriptionName:r.name}}}catch(r){return console.error("Error creating ICS event:",r),null}}generateRecurringTaskInstances(e,r,i){if(!e.recurrence||!e.scheduled)return[];let s=[],a=dt(e.scheduled),o=this.getRecurringTime(e),l=Jl(e,r,i);for(let c of l){let d=Te(c),u=a?`${d}T${o}`:d,h=this.createRecurringEvent(e,u,d,o);h&&s.push(h)}return s}getRecurringTime(e){return e.scheduled&&It(e.scheduled)||"09:00"}createRecurringEvent(e,r,i,s){var h;let a=dt(r),o;if(a&&e.timeEstimate){let f=he(r),p=new Date(f.getTime()+e.timeEstimate*60*1e3);o=I(p,"yyyy-MM-dd'T'HH:mm")}let l=this.plugin.priorityManager.getPriorityConfig(e.priority),c=(l==null?void 0:l.color)||"var(--color-accent)",d=((h=e.complete_instances)==null?void 0:h.includes(i))||!1,u=d?"rgba(0,0,0,0.3)":"transparent";return{id:`recurring-${e.path}-${i}`,title:e.title,start:r,end:o,allDay:!a,backgroundColor:u,borderColor:c,textColor:c,editable:!0,extendedProps:{taskInfo:e,eventType:"recurring",isCompleted:d,isRecurringInstance:!0,instanceDate:i,recurringTemplateTime:s}}}handleDateSelect(e){var l;let{start:r,end:i,allDay:s,jsEvent:a}=e;this.plugin.settings.calendarViewSettings.enableTimeblocking&&this.showTimeblocks&&a&&a.shiftKey?this.handleTimeblockCreation(r,i,s):this.handleTaskCreation(r,i,s),(l=this.calendar)==null||l.unselect()}parseSlotDurationToMinutes(e){let r=e.split(":"),i=parseInt(r[0],10),s=parseInt(r[1],10);return i*60+s}handleTaskCreation(e,r,i){let s=i?I(e,"yyyy-MM-dd"):I(e,"yyyy-MM-dd'T'HH:mm"),a=Math.round((r.getTime()-e.getTime())/(1e3*60)),o=this.plugin.settings.calendarViewSettings.slotDuration,l=this.parseSlotDurationToMinutes(o),c=!i&&a>l,d={scheduled:s};i||c&&(d.timeEstimate=a),new Ks(this.app,this.plugin,{prePopulatedValues:d}).open()}handleTimeblockCreation(e,r,i){if(i){new le.Notice("Timeblocks must have specific times. Please select a time range in week or day view.");return}let s=I(e,"yyyy-MM-dd"),a=I(e,"HH:mm"),o=I(r,"HH:mm");new _d(this.app,this.plugin,{date:s,startTime:a,endTime:o}).open()}async handleDateTitleClick(e){try{if(!(0,fr.appHasDailyNotesPluginLoaded)()){new le.Notice("Daily Notes core plugin is not enabled. Please enable it in Settings > Core plugins.");return}let r=window.moment(e),i=(0,fr.getAllDailyNotes)(),s=(0,fr.getDailyNote)(r,i);if(!s)try{s=await(0,fr.createDailyNote)(r)}catch(a){let o=a instanceof Error?a.message:String(a);console.error("Failed to create daily note:",a),new le.Notice(`Failed to create daily note: ${o}`);return}s&&await this.app.workspace.getLeaf(!1).openFile(s)}catch(r){let i=r instanceof Error?r.message:String(r);console.error("Failed to navigate to daily note:",r),new le.Notice(`Failed to navigate to daily note: ${i}`)}}async getTimeblockEvents(){var r;let e=[];try{if(!(0,fr.appHasDailyNotesPluginLoaded)())return e;let i=(r=this.calendar)==null?void 0:r.view;if(!i)return e;let s=i.activeStart,a=i.activeEnd,o=(0,fr.getAllDailyNotes)(),l=new Date(s);for(;l<=a;){let c=I(l,"yyyy-MM-dd"),d=window.moment(l),u=(0,fr.getDailyNote)(d,o);if(u)try{let h=await this.app.vault.read(u),f=oh(h,u.path);for(let p of f){let m=Ry(p,c);e.push(m)}}catch(h){console.error(`Error reading daily note ${u.path}:`,h)}l.setDate(l.getDate()+1)}}catch(i){console.error("Error getting timeblock events:",i)}return e}handleEventClick(e){let{taskInfo:r,icsEvent:i,timeblock:s,eventType:a,subscriptionName:o}=e.event.extendedProps,l=e.jsEvent;if(a==="timeEntry"){r&&l.button===0&&!l.ctrlKey&&!l.metaKey&&new Zi(this.app,this.plugin,{task:r}).open();return}if(a==="timeblock"){this.showTimeblockInfo(s,e.event.start);return}if(a==="ics"){this.showICSEventInfo(i,o);return}l.ctrlKey||l.metaKey?this.app.vault.getAbstractFileByPath(r.path)instanceof le.TFile&&this.app.workspace.openLinkText(r.path,"",!0):l.button===0&&new Zi(this.app,this.plugin,{task:r}).open()}async handleEventDrop(e){let{taskInfo:r,timeblock:i,eventType:s,isRecurringInstance:a,originalDate:o}=e.event.extendedProps;if(s==="timeEntry"||s==="ics"){e.revert();return}if(s==="timeblock"){await this.handleTimeblockDrop(e,i,o);return}try{let l=e.event.start,c=e.event.allDay;if(a){let d=Z(r.scheduled),u;if(c)u=d,new le.Notice("Updated recurring task to all-day. This affects all future instances.");else{let h=I(l,"HH:mm");u=`${d}T${h}`,new le.Notice(`Updated recurring task time to ${h}. This affects all future instances.`)}await this.plugin.taskService.updateProperty(r,"scheduled",u)}else{let d;c?d=I(l,"yyyy-MM-dd"):d=I(l,"yyyy-MM-dd'T'HH:mm");let u=s==="scheduled"?"scheduled":"due";await this.plugin.taskService.updateProperty(r,u,d)}}catch(l){console.error("Error updating task date:",l),e.revert()}}async handleTimeblockDrop(e,r,i){try{let s=e.event.start,a=e.event.end,o=I(s,"yyyy-MM-dd"),l=I(s,"HH:mm"),c=I(a,"HH:mm");await lh(this.app,r.id,i,o,l,c),this.refreshEvents(),i!==o?new le.Notice(`Moved timeblock "${r.title}" to ${o}`):new le.Notice(`Updated timeblock "${r.title}" time`)}catch(s){console.error("Error moving timeblock:",s),new le.Notice(`Failed to move timeblock: ${s.message}`),e.revert()}}async handleEventResize(e){let{taskInfo:r,timeblock:i,eventType:s,originalDate:a}=e.event.extendedProps;if(s==="timeblock"){await this.handleTimeblockResize(e,i,a);return}if(s!=="scheduled"&&s!=="recurring"){e.revert();return}try{let o=e.event.start,l=e.event.end;if(o&&l){let c=Math.round((l.getTime()-o.getTime())/6e4);await this.plugin.taskService.updateProperty(r,"timeEstimate",c)}}catch(o){console.error("Error updating task duration:",o),e.revert()}}async handleTimeblockResize(e,r,i){try{let s=e.event.start,a=e.event.end;if(!s||!a){e.revert();return}let o=I(s,"HH:mm"),l=I(a,"HH:mm"),[c,d]=o.split(":").map(Number),[u,h]=l.split(":").map(Number),f=c*60+d;if(u*60+h<=f){new le.Notice("End time must be after start time"),e.revert();return}await lh(this.app,r.id,i,i,o,l),this.refreshEvents(),new le.Notice(`Updated timeblock "${r.title}" duration`)}catch(s){console.error("Error resizing timeblock:",s),new le.Notice(`Failed to resize timeblock: ${s.message}`),e.revert()}}async handleExternalDrop(e){try{let r;if(e.dataTransfer&&(r=e.dataTransfer.getData("text/plain")||e.dataTransfer.getData("application/x-task-path")),!r&&e.draggedEl&&(r=e.draggedEl.dataset.taskPath),!r){console.warn("No task path found in drop data",e);return}let i=await this.plugin.cacheManager.getTaskInfo(r);if(!i){console.warn("Task not found:",r);return}let s=e.date;if(!s){console.warn("No drop date provided");return}let a;e.allDay?a=I(s,"yyyy-MM-dd"):a=I(s,"yyyy-MM-dd'T'HH:mm"),await this.plugin.taskService.updateProperty(i,"scheduled",a),new le.Notice(`Task "${i.title}" scheduled for ${I(s,e.allDay?"MMM d, yyyy":"MMM d, yyyy h:mm a")}`),e.draggedEl&&e.draggedEl.remove(),this.refreshEvents()}catch(r){console.error("Error handling external drop:",r),new le.Notice("Failed to schedule task"),e.draggedEl&&e.draggedEl.remove()}}handleEventReceive(e){e.event.remove()}handleEventDidMount(e){var u;if(!e.event.extendedProps)return;let{taskInfo:r,icsEvent:i,timeblock:s,eventType:a,isCompleted:o,isRecurringInstance:l,instanceDate:c,subscriptionName:d}=e.event.extendedProps;if(e.el.setAttribute("data-event-type",a||"unknown"),a==="ics"){e.el.style.borderStyle="solid",e.el.style.borderWidth="2px",e.el.setAttribute("data-ics-event","true"),e.el.setAttribute("data-subscription",d||"Unknown"),e.el.classList.add("fc-ics-event"),(0,le.setTooltip)(e.el,`${(i==null?void 0:i.title)||"Event"} (from ${d||"Calendar subscription"})`,{placement:"top"}),e.el.addEventListener("contextmenu",h=>{h.preventDefault(),h.stopPropagation(),this.showICSEventContextMenu(h,i,d)});return}if(a==="timeblock"){e.el.setAttribute("data-timeblock-id",(s==null?void 0:s.id)||""),e.el.style.borderStyle="solid",e.el.style.borderWidth="2px",e.el.classList.add("fc-timeblock-event"),e.event.setProp&&e.event.setProp("editable",!0);let h=((u=s==null?void 0:s.attachments)==null?void 0:u.length)||0,f=`${(s==null?void 0:s.title)||"Timeblock"}${s!=null&&s.description?` - ${s.description}`:""}${h>0?` (${h} attachment${h>1?"s":""})`:""}`;(0,le.setTooltip)(e.el,f,{placement:"top"});return}if(!(!r||!r.path)){if(e.el.setAttribute("data-task-path",r.path),e.el.classList.add("fc-task-event"),r.tags&&r.tags.length>0&&r.tags.forEach(h=>{let f=h.replace(/[^a-zA-Z0-9-_]/g,"");f&&e.el.classList.add(`fc-tag-${f}`)}),e.event.setProp)switch(a){case"scheduled":case"recurring":e.event.setProp("editable",!0);break;case"due":case"timeEntry":e.event.setProp("editable",!1);break;default:e.event.setProp("editable",!0)}if(l&&(e.el.style.borderStyle="dashed",e.el.style.borderWidth="2px",e.el.setAttribute("data-recurring","true"),e.el.classList.add("fc-recurring-event"),o&&(e.el.style.opacity="0.6")),o){let h=e.el.querySelector(".fc-event-title, .fc-event-title-container");h?h.style.textDecoration="line-through":e.el.style.textDecoration="line-through",e.el.classList.add("fc-completed-event")}r&&(a!=="ics"&&e.el.addEventListener("mouseover",h=>{this.plugin.app.vault.getAbstractFileByPath(r.path)&&this.plugin.app.workspace.trigger("hover-link",{event:h,source:"tasknotes-advanced-calendar",hoverParent:e.el,targetEl:e.el,linktext:r.path,sourcePath:r.path})}),e.el.addEventListener("contextmenu",h=>{if(h.preventDefault(),h.stopPropagation(),a==="timeEntry"){let{timeEntryIndex:f}=e.event.extendedProps;this.showTimeEntryContextMenu(h,r,f)}else{let f=l&&c?he(c+"T00:00:00Z"):e.event.start||new Date;al(h,r.path,this.plugin,f)}}))}}registerEvents(){this.listeners.forEach(o=>this.plugin.emitter.offref(o)),this.listeners=[],this.functionListeners.forEach(o=>o()),this.functionListeners=[];let e=this.plugin.emitter.on(it,async()=>{if(this.refreshEvents(),this.filterBar){console.log("AdvancedCalendarView: Updating FilterBar options due to data change");let o=await this.plugin.filterService.getFilterOptions();console.log("AdvancedCalendarView: Got updated options with projects count:",o.projects.length),this.filterBar.updateFilterOptions(o)}});this.listeners.push(e);let r=this.plugin.emitter.on(xe,async()=>{if(this.refreshEvents(),this.filterBar){let o=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(o)}});this.listeners.push(r);let i=this.plugin.filterService.on("data-changed",()=>{this.refreshEvents()});if(this.functionListeners.push(i),this.plugin.icsSubscriptionService){let o=this.plugin.icsSubscriptionService.on("data-changed",()=>{this.refreshEvents()});this.functionListeners.push(o)}let s=this.plugin.emitter.on(Ag,o=>{this.showTimeblocks=o&&this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.refreshEvents(),this.setupViewOptions()});this.listeners.push(s);let a=this.plugin.emitter.on("settings-changed",()=>{this.updateTodayHighlight(),this.updateCustomViewConfiguration()});this.listeners.push(a)}updateCustomViewConfiguration(){if(!this.calendar)return;let e=this.plugin.settings.calendarViewSettings;this.calendar.setOption("views",{timeGridCustom:{type:"timeGrid",duration:{days:e.customDayCount||3},buttonText:`${e.customDayCount||3} days`}}),this.calendar.setOption("headerToolbar",this.getHeaderToolbarConfig())}async refreshEvents(){this.calendar&&this.calendar.refetchEvents()}async onClose(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.functionListeners.forEach(e=>e()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.calendar&&(this.calendar.destroy(),this.calendar=null),this.contentEl.empty()}showICSEventInfo(e,r){new nc(this.app,this.plugin,e,r).open()}showTimeblockInfo(e,r){new sc(this.app,this.plugin,e,r).open()}showICSEventContextMenu(e,r,i){let s=new le.Menu;s.addItem(a=>a.setTitle("Show details").setIcon("info").onClick(()=>{this.showICSEventInfo(r,i)})),s.addItem(a=>a.setTitle("Copy title").setIcon("copy").onClick(async()=>{try{await navigator.clipboard.writeText(r.title),new le.Notice("Event title copied to clipboard")}catch(o){new le.Notice("Failed to copy to clipboard")}})),r.url&&s.addItem(a=>a.setTitle("Copy URL").setIcon("link").onClick(async()=>{try{await navigator.clipboard.writeText(r.url),new le.Notice("Event URL copied to clipboard")}catch(o){new le.Notice("Failed to copy to clipboard")}})),s.showAtMouseEvent(e)}showTimeEntryContextMenu(e,r,i){let s=new le.Menu;s.addItem(a=>a.setTitle("Open task").setIcon("edit").onClick(()=>{new Zi(this.app,this.plugin,{task:r}).open()})),s.addSeparator(),s.addItem(a=>a.setTitle("Delete time entry").setIcon("trash").onClick(async()=>{var o;try{let l=(o=r.timeEntries)==null?void 0:o[i];if(!l){new le.Notice("Time entry not found");return}let c="";if(l.startTime&&l.endTime){let u=new Date(l.startTime),f=new Date(l.endTime).getTime()-u.getTime(),p=Math.round(f/(1e3*60)),m=Math.floor(p/60),g=p%60;m>0?c=` (${m}h ${g}m)`:c=` (${g}m)`}await new Promise(u=>{let h=new le.Modal(this.app);h.setTitle("Delete Time Entry"),h.setContent(`Are you sure you want to delete this time entry${c}? This action cannot be undone.`);let f=h.contentEl.createDiv({cls:"modal-button-container"});f.style.display="flex",f.style.justifyContent="flex-end",f.style.gap="8px",f.style.marginTop="20px";let p=f.createEl("button",{text:"Cancel"}),m=f.createEl("button",{text:"Delete",cls:"mod-warning"});p.onclick=()=>{h.close(),u(!1)},m.onclick=()=>{h.close(),u(!0)},h.open()})&&(await this.plugin.taskService.deleteTimeEntry(r,i),new le.Notice("Time entry deleted"),this.refreshEvents())}catch(l){console.error("Error deleting time entry:",l),new le.Notice("Failed to delete time entry")}})),s.showAtMouseEvent(e)}updateTodayHighlight(){let e=this.contentEl.querySelector(".advanced-calendar-view__calendar-container");if(!e)return;this.plugin.settings.calendarViewSettings.showTodayHighlight?e.removeClass("hide-today-highlight"):e.addClass("hide-today-highlight")}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(e=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),e()})})}};var en=require("obsidian");ui();var ol=class extends en.ItemView{constructor(e,r){super(e);this.taskListContainer=null;this.loadingIndicator=null;this.isTasksLoading=!1;this.filterBar=null;this.taskElements=new Map;this.listeners=[];this.functionListeners=[];this.plugin=r,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"},this.registerEvents()}getViewType(){return bi}getDisplayText(){return"Tasks"}getIcon(){return"check-square"}registerEvents(){this.listeners.forEach(s=>this.plugin.emitter.offref(s)),this.listeners=[],this.functionListeners.forEach(s=>s()),this.functionListeners=[];let e=this.plugin.emitter.on(it,async()=>{if(this.refresh(),this.filterBar){let s=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(s)}});this.listeners.push(e);let r=this.plugin.emitter.on(xe,async({path:s,originalTask:a,updatedTask:o})=>{if(!s||!o){console.error("EVENT_TASK_UPDATED received invalid data:",{path:s,originalTask:a,updatedTask:o});return}let l=this.taskElements.get(s);if(l)try{Nr(l,o,this.plugin,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1}),l.classList.add("task-updated"),setTimeout(()=>{l.classList.remove("task-updated")},1e3)}catch(c){console.error("Error updating task card:",c),this.refreshTasks()}else this.refreshTasks();if(this.filterBar){let c=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(c)}});this.listeners.push(r);let i=this.plugin.filterService.on("data-changed",()=>{this.refreshTasks()});this.functionListeners.push(i)}async onOpen(){try{await this.plugin.onReady(),await this.plugin.waitForMigration(),this.currentQuery=this.plugin.filterService.createDefaultQuery();let e=this.plugin.viewStateManager.getFilterState(bi);e&&(this.currentQuery=e),await this.refresh()}catch(e){console.error("TaskListView: Error during onOpen:",e),this.fallbackToPolling()}}async fallbackToPolling(){this.contentEl.empty(),this.contentEl.createDiv({cls:"task-list-view__loading"}).createSpan({text:"Initializing..."});let r=0,i=50,s=async()=>{r++,this.plugin.cacheManager&&this.plugin.cacheManager.isInitialized()?await this.refresh():r<i?setTimeout(s,100):(console.warn("TaskListView: Cache initialization timeout, attempting to load anyway"),await this.refresh())};s()}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.functionListeners.forEach(e=>e()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.contentEl.empty()}async refresh(e=!1){return Qr.measure("task-list-refresh",async()=>{e&&this.taskElements.clear(),this.contentEl.empty(),this.taskElements.clear(),await this.render()})}async render(){let e=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container task-list-view-container"});this.createHeader(e),await this.createTasksContent(e)}createHeader(e){e.createDiv({cls:"detail-view-header task-list-header"})}async createTasksContent(e){let r=e.createDiv({cls:"filter-bar-container"});await this.waitForCacheReady(),this.currentQuery=this.plugin.filterService.createDefaultQuery();let i=this.plugin.viewStateManager.getFilterState(bi);i&&(this.currentQuery=i);let s=await this.plugin.filterService.getFilterOptions();this.filterBar=new Xt(this.app,r,this.currentQuery,s);let a=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(a),this.filterBar.on("saveView",({name:l,query:c,viewOptions:d})=>{console.log("TaskListView: Received saveView event:",l,c,d);let u=this.plugin.viewStateManager.saveView(l,c,d);console.log("TaskListView: Saved view result:",u)}),this.filterBar.on("deleteView",l=>{console.log("TaskListView: Received deleteView event:",l),this.plugin.viewStateManager.deleteView(l)}),this.plugin.viewStateManager.on("saved-views-changed",l=>{var c;console.log("TaskListView: Received saved-views-changed event:",l),(c=this.filterBar)==null||c.updateSavedViews(l)}),this.filterBar.on("reorderViews",(l,c)=>{this.plugin.viewStateManager.reorderSavedViews(l,c)}),this.filterBar.on("queryChange",async l=>{this.currentQuery=l,this.plugin.viewStateManager.setFilterState(bi,l),await this.refreshTasks()});let o=e.createDiv({cls:"task-list"});this.loadingIndicator=o.createDiv({cls:"loading-indicator"}),this.loadingIndicator.createDiv({cls:"loading-spinner"}),this.loadingIndicator.createDiv({cls:"loading-text",text:"Loading tasks..."}),this.loadingIndicator.addClass("is-hidden"),this.taskListContainer=o,this.isTasksLoading=!0,this.updateLoadingState(),await this.refreshTasks(),this.isTasksLoading=!1,this.updateLoadingState()}async refreshTasks(){var e;if(this.taskListContainer)try{this.isTasksLoading=!0,this.updateLoadingState();let r=await this.plugin.filterService.getGroupedTasks(this.currentQuery);this.renderTaskItems(this.taskListContainer,r)}catch(r){let i=r instanceof Error?r.message:String(r);console.error("TaskListView: Error refreshing tasks:",{error:i,stack:r instanceof Error?r.stack:void 0,query:this.currentQuery,cacheInitialized:((e=this.plugin.cacheManager)==null?void 0:e.isInitialized())||!1}),this.taskListContainer.empty();let s=this.taskListContainer.createDiv({cls:"error-container"});s.createEl("p",{text:"Error loading tasks. Please try refreshing.",cls:"error-message"}),s.createEl("button",{text:"Retry",cls:"mod-cta"}).addEventListener("click",()=>{this.refreshTasks()})}finally{this.isTasksLoading=!1,this.updateLoadingState()}}renderTaskItems(e,r){if(Array.from(r.values()).reduce((s,a)=>s+a.length,0)===0){e.empty(),this.taskElements.clear(),e.createEl("p",{text:"No tasks found for the selected filters."});return}if(this.currentQuery.groupKey==="none"&&r.has("all")){let s=r.get("all")||[];this.renderTaskListWithReconciler(e,s)}else this.renderGroupedTasksWithReconciler(e,r)}renderTaskListWithReconciler(e,r){this.plugin.domReconciler.updateList(e,r,i=>i.path,i=>this.createTaskCardForReconciler(i),(i,s)=>this.updateTaskCardForReconciler(i,s)),this.taskElements.clear(),Array.from(e.children).forEach(i=>{let s=i.dataset.key;s&&this.taskElements.set(s,i)})}renderGroupedTasksWithReconciler(e,r){let i=e.scrollTop,s=new Map;Array.from(e.children).forEach(a=>{let o=a.dataset.group;o&&s.set(o,a)}),e.empty(),this.taskElements.clear(),r.forEach((a,o)=>{if(a.length===0)return;let l=e.createDiv({cls:"task-section task-group"});if(l.setAttribute("data-group",o),!(this.currentQuery.groupKey==="none"&&o==="all")){let d=l.createEl("h3",{cls:"task-group-header task-list-view__group-header"});this.currentQuery.groupKey==="project"&&this.isWikilinkProject(o)?this.createClickableProjectHeader(d,o):d.textContent=this.formatGroupName(o)}let c=l.createDiv({cls:"tasks-container task-cards"});this.plugin.domReconciler.updateList(c,a,d=>d.path,d=>this.createTaskCardForReconciler(d),(d,u)=>this.updateTaskCardForReconciler(d,u)),Array.from(c.children).forEach(d=>{let u=d.dataset.key;u&&this.taskElements.set(u,d)})}),e.scrollTop=i}createTaskCardForReconciler(e){let r=Bt(e,this.plugin,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1});return r.dataset.key=e.path,this.addDragHandlers(r,e),r}updateTaskCardForReconciler(e,r){Nr(e,r,this.plugin,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1})}addDragHandlers(e,r){this.plugin.dragDropManager.makeTaskCardDraggable(e,r.path)}createSVGIcon(e,r,i,s){let a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("viewBox",e),a.setAttribute("width",r.toString()),a.setAttribute("height",i.toString());let o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("fill","currentColor"),o.setAttribute("d",s),a.appendChild(o),a}formatGroupName(e){let r=this.plugin.priorityManager.getPriorityConfig(e);if(r)return`${r.label} priority`;let i=this.plugin.statusManager.getStatusConfig(e);if(i)return i.label;switch(e){case"all":return"All tasks";case"no-status":return"No status assigned";default:return e}}updateLoadingState(){this.loadingIndicator&&(this.isTasksLoading?this.loadingIndicator.removeClass("is-hidden"):this.loadingIndicator.addClass("is-hidden"))}openTask(e){let r=this.app.vault.getAbstractFileByPath(e);r instanceof en.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(e=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),e()})})}isWikilinkProject(e){return e.startsWith("[[")&&e.endsWith("]]")}createClickableProjectHeader(e,r){if(this.isWikilinkProject(r)){let i=r.slice(2,-2),s=e.createEl("a",{cls:"internal-link task-list-view__project-link",text:i});this.registerDomEvent(s,"click",async o=>{o.preventDefault(),o.stopPropagation();let l=this.plugin.app.metadataCache.getFirstLinkpathDest(i,"");l instanceof en.TFile?await this.plugin.app.workspace.getLeaf(!1).openFile(l):new en.Notice(`Note "${i}" not found`)});let a=this.plugin.app.metadataCache.getFirstLinkpathDest(i,"");a instanceof en.TFile&&this.addHoverPreview(s,a.path)}else e.textContent=this.formatGroupName(r)}addHoverPreview(e,r){e.addEventListener("mouseover",i=>{this.app.vault.getAbstractFileByPath(r)&&this.app.workspace.trigger("hover-link",{event:i,source:"tasknotes-tasklistview",hoverParent:this,targetEl:e,linktext:r,sourcePath:r})})}};var Or=require("obsidian");we();var zT=require("obsidian");we();var em=Ve(Yt()),qT={showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:3,showDailyNoteBadge:!0};function Pd(n,t,e={}){let r={...qT,...e},i=document.createElement("div"),s=!1;try{let l=(0,em.getAllDailyNotes)();s=Object.values(l).some(c=>c.path===n.path)}catch(l){s=!1}let a=["note-card"];s&&a.push("note-card--daily-note"),a.push("note-card--compact","note-card--shadow-light"),i.className=a.join(" "),i.dataset.notePath=n.path,r.showDailyNoteBadge&&s&&i.createSpan({cls:"note-card__badge",text:"Daily",attr:{title:"Daily note"}});let o=i.createDiv({cls:"note-card__content"});if(o.createDiv({cls:"note-card__title",text:n.title}),r.showTags&&n.tags&&n.tags.length>0){o.createEl("div",{cls:"note-card__divider"});let c=n.tags.slice(0,r.maxTags).map(d=>`#${d}`).join(" ");n.tags.length>r.maxTags&&(c+=` +${n.tags.length-r.maxTags}`),o.createEl("div",{cls:"note-card__tags-text",text:c})}if(r.showCreatedDate&&n.createdDate){let l=n.createdDate.indexOf("T")>0?Ea(n.createdDate,"MMM d, yyyy h:mm a"):n.createdDate;o.createDiv({cls:"note-card__metadata",text:`Created: ${l}`,attr:{title:`Created: ${l}`}})}return r.showPath&&o.createDiv({cls:"note-card__metadata",text:n.path,attr:{title:`Path: ${n.path}`}}),i.addEventListener("click",()=>{let l=t.app.vault.getAbstractFileByPath(n.path);l instanceof zT.TFile&&t.app.workspace.getLeaf(!1).openFile(l)}),i.addEventListener("mouseover",l=>{t.app.vault.getAbstractFileByPath(n.path)&&t.app.workspace.trigger("hover-link",{event:l,source:"tasknotes-note-card",hoverParent:i,targetEl:i,linktext:n.path,sourcePath:n.path})}),i}function GT(n,t,e,r={}){let i={...qT,...r},s=!1;try{let u=(0,em.getAllDailyNotes)();s=Object.values(u).some(h=>h.path===t.path)}catch(u){s=!1}let a=["note-card"];s&&a.push("note-card--daily-note"),a.push("note-card--compact","note-card--shadow-light"),n.className=a.join(" ");let o=n.querySelector(".note-card__title");o&&(o.textContent=t.title);let l=n.querySelector(".note-card__metadata");if(l&&i.showCreatedDate&&t.createdDate){let u=t.createdDate.indexOf("T")>0?Ea(t.createdDate,"MMM d, yyyy h:mm a"):t.createdDate;l.textContent=`Created: ${u}`}let c=n.querySelector(".note-card__metadata");c&&i.showPath&&(c.textContent=t.path);let d=n.querySelector(".note-card__tags-text");if(d&&i.showTags&&t.tags&&t.tags.length>0){let h=t.tags.slice(0,i.maxTags).map(f=>`#${f}`).join(" ");t.tags.length>i.maxTags&&(h+=` +${t.tags.length-i.maxTags}`),d.textContent=h}n.classList.add("note-card--updated"),window.setTimeout(()=>{n.classList.remove("note-card--updated")},1e3)}var Nd=class extends Or.ItemView{constructor(e,r){super(e);this.loadingIndicator=null;this.isNotesLoading=!1;this.listeners=[];this.plugin=r,this.registerEvents()}getViewType(){return ya}getDisplayText(){return"Notes"}getIcon(){return"file-text"}registerEvents(){this.listeners.forEach(i=>this.plugin.emitter.offref(i)),this.listeners=[];let e=this.plugin.emitter.on(Ei,()=>{this.refresh(!0)});this.listeners.push(e);let r=this.plugin.emitter.on(it,()=>{this.refresh()});this.listeners.push(r)}async onOpen(){await this.plugin.onReady(),await this.refresh()}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.contentEl.empty()}async refresh(e=!1){let r=this.contentEl.querySelector(".notes-view"),i=0;if(r&&!e){let s=r.querySelector(".notes-view__list");s&&(i=s.scrollTop)}if(this.contentEl.empty(),await this.render(e),i>0){let s=this.contentEl.querySelector(".notes-view__list");s&&(s.scrollTop=i)}}async render(e=!1){let r=this.contentEl.createDiv({cls:"tasknotes-plugin notes-view"});this.createHeader(r),await this.createNotesContent(r,e)}createHeader(e){let r=e.createDiv({cls:"notes-view__header"}),i=Ea(this.plugin.selectedDate.toISOString(),"EEEE, MMMM d, yyyy"),s=r.createDiv();new Or.Setting(s).setName("Notes").setHeading(),s.createEl("div",{text:i,cls:"notes-view__date"});let o=r.createDiv({cls:"notes-view__actions"}).createEl("button",{text:"Refresh",cls:"notes-view__refresh-button",attr:{"aria-label":"Refresh notes list",title:"Refresh notes list"}});o.addEventListener("click",async()=>{if(o.classList.contains("is-loading"))return;o.classList.add("is-loading"),o.disabled=!0;let l=o.textContent;o.textContent="Refreshing...";try{await this.refresh(!0)}finally{o.classList.remove("is-loading"),o.disabled=!1,o.textContent=l}})}async createNotesContent(e,r=!1){let i=e.createDiv({cls:"notes-view__list"});this.loadingIndicator=i.createDiv({cls:"notes-view__loading is-hidden"}),this.loadingIndicator.createSpan({text:"Loading notes..."}),this.isNotesLoading=!0,this.updateLoadingState();let s=await this.getNotesForView(r);if(this.isNotesLoading=!1,this.updateLoadingState(),s.length===0){let a=i.createDiv({cls:"notes-view__empty"}),o=a.createDiv({cls:"notes-view__empty-icon"});(0,Or.setIcon)(o,"file-text"),this.plugin.settings.disableNoteIndexing?(new Or.Setting(a).setName("Note indexing disabled").setHeading(),a.createEl("p",{text:"Note indexing has been disabled in settings for better performance. To view notes, enable note indexing in Settings > TaskNotes > General > Performance settings and restart the plugin.",cls:"notes-view__empty-description"})):(new Or.Setting(a).setName("No notes found").setHeading(),a.createEl("p",{text:"No notes found for the selected date. Try selecting a different date in the Mini Calendar view or create some notes.",cls:"notes-view__empty-description"}))}else{let a=i.createDiv({cls:"notes-view__container"});this.renderNotesWithReconciler(a,s)}}renderNotesWithReconciler(e,r){this.plugin.domReconciler.updateList(e,r,i=>i.path,i=>this.createNoteCardForReconciler(i),(i,s)=>this.updateNoteCardForReconciler(i,s))}createNoteCardForReconciler(e){let r=Pd(e,this.plugin,{showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:5,showDailyNoteBadge:!0});return r.dataset.key=e.path,r}updateNoteCardForReconciler(e,r){GT(e,r,this.plugin,{showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:5,showDailyNoteBadge:!0})}updateLoadingState(){var e,r;this.loadingIndicator&&(this.isNotesLoading?(e=this.loadingIndicator)==null||e.classList.remove("is-hidden"):(r=this.loadingIndicator)==null||r.classList.add("is-hidden"))}async getNotesForView(e=!1){try{return this.isNotesLoading=!0,this.updateLoadingState(),this.plugin.settings.disableNoteIndexing?[]:(await this.plugin.cacheManager.getNotesForDate(this.plugin.selectedDate)).sort((a,o)=>a.title.localeCompare(o.title))}finally{this.isNotesLoading=!1,this.updateLoadingState()}}openNote(e){let r=this.app.vault.getAbstractFileByPath(e);r instanceof Or.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}};var Xn=require("obsidian");je();we();ui();var QT=require("obsidian");at();je();we();var tn=class extends Pr{constructor(e,r,i,s){super();this.plugin=s;this.indexQueryCache=new Map;this.cacheTimeout=3e4;this.cacheTimers=new Map;this.filterOptionsCache=null;this.filterOptionsCacheTimestamp=0;this.filterOptionsCacheTTL=3e5;this.filterOptionsComputeCount=0;this.filterOptionsCacheHits=0;this.cacheManager=e,this.statusManager=r,this.priorityManager=i}async getGroupedTasks(e,r){try{me.validateFilterNode(e,!1);let i=this.getIndexOptimizedTaskPaths(e),a=(await this.pathsToTaskInfos(Array.from(i))).filter(l=>this.evaluateFilterNode(e,l,r)),o=this.sortTasks(a,e.sortKey||"due",e.sortDirection||"asc");return this.groupTasks(o,e.groupKey||"none",r)}catch(i){if(i instanceof mt||i instanceof Xi)return console.error("Filter error:",i.message,{nodeId:i.nodeId,field:i.field}),new Map;throw i}}getIndexOptimizedTaskPaths(e){let r=this.analyzeQueryOptimizationSafety(e);if(!r.canOptimize)return this.cacheManager.getAllTaskPaths();if(r.strategy==="intersect"){let i=this.getPathsForIndexableCondition(r.conditions[0]);for(let s=1;s<r.conditions.length;s++){let a=this.getPathsForIndexableCondition(r.conditions[s]);i=this.intersectPathSets(i,a)}return i}else if(r.strategy==="single")return this.getPathsForIndexableCondition(r.conditions[0]);return this.cacheManager.getAllTaskPaths()}analyzeQueryOptimizationSafety(e){let r=this.findIndexableConditions(e);return r.length===0?{canOptimize:!1,conditions:[],reason:"No indexable conditions found"}:this.isSimpleQuery(e,r)?{canOptimize:!0,strategy:r.length===1?"single":"intersect",conditions:r}:{canOptimize:!1,conditions:r,reason:"Complex query structure with OR conditions - optimization not safe"}}isSimpleQuery(e,r){return r.length===0||this.hasIndexableConditionInOrGroup(e,r)?!1:r.length===1||e.type==="group"&&e.conjunction==="and"&&e.children.filter(s=>s.type==="condition"&&this.isIndexableCondition(s)).length===r.length}hasIndexableConditionInOrGroup(e,r){return this.checkNodeForOrWithIndexable(e,r)}checkNodeForOrWithIndexable(e,r){if(e.type==="condition")return!1;if(e.type==="group"){if(e.conjunction==="or"&&e.children.some(s=>s.type==="condition"&&r.includes(s)))return!0;for(let i of e.children)if(this.checkNodeForOrWithIndexable(i,r))return!0}return!1}findIndexableConditions(e){let r=[];if(e.type==="condition")this.isIndexableCondition(e)&&r.push(e);else if(e.type==="group")for(let i of e.children)r.push(...this.findIndexableConditions(i));return r}isIndexableCondition(e){let{property:r,operator:i,value:s}=e;return!!(r==="status"&&i==="is"&&s||r==="due"&&(i==="is"||i==="is-before"||i==="is-after")&&s||r==="scheduled"&&(i==="is"||i==="is-before"||i==="is-after")&&s)}getCachedIndexResult(e,r){let i=this.indexQueryCache.get(e);if(i)return new Set(i);let s=r();this.indexQueryCache.set(e,new Set(s));let a=this.cacheTimers.get(e);a&&clearTimeout(a);let o=setTimeout(()=>{this.indexQueryCache.delete(e),this.cacheTimers.delete(e)},this.cacheTimeout);return this.cacheTimers.set(e,o),s}clearIndexQueryCache(){for(let e of this.cacheTimers.values())clearTimeout(e);this.indexQueryCache.clear(),this.cacheTimers.clear()}getCacheStats(){return{entryCount:this.indexQueryCache.size,cacheKeys:Array.from(this.indexQueryCache.keys()),timeoutMs:this.cacheTimeout}}getPathsForIndexableCondition(e){let{property:r,operator:i,value:s}=e,a=`${r}:${i}:${s}`;return this.getCachedIndexResult(a,()=>r==="status"&&i==="is"&&s&&typeof s=="string"?new Set(this.cacheManager.getTaskPathsByStatus(s)):(r==="due"||r==="scheduled")&&i==="is"&&s&&typeof s=="string"?new Set(this.cacheManager.getTasksForDate(s)):(r==="due"||r==="scheduled")&&(i==="is-before"||i==="is-after")&&s&&typeof s=="string"?this.getTaskPathsForDateRange(r,i,s):this.cacheManager.getAllTaskPaths())}getTaskPathsForDateRange(e,r,i){return this.cacheManager.getAllTaskPaths()}intersectPathSets(e,r){let i=new Set;for(let s of e)r.has(s)&&i.add(s);return i}async pathsToTaskInfos(e){let r=[];for(let s=0;s<e.length;s+=50){let a=e.slice(s,s+50),o=await Promise.all(a.map(l=>this.cacheManager.getCachedTaskInfo(l)));for(let l of o)l&&r.push(l)}return r}evaluateFilterNode(e,r,i){return e.type==="condition"?this.evaluateCondition(e,r,i):e.type==="group"?this.evaluateGroup(e,r,i):!0}evaluateGroup(e,r,i){if(e.children.length===0)return!0;let s=e.children.filter(a=>a.type==="condition"?me.isFilterNodeComplete(a):!0);return s.length===0?!0:e.conjunction==="and"?s.every(a=>this.evaluateFilterNode(a,r,i)):e.conjunction==="or"?s.some(a=>this.evaluateFilterNode(a,r,i)):!0}evaluateCondition(e,r,i){let{property:s,operator:a,value:o}=e,l=me.getTaskPropertyValue(r,s);if(s==="status.isCompleted"){let c=Gr(r,i||new Date);l=this.statusManager.isCompletedStatus(c)}return me.applyOperator(l,a,o,e.id,s)}async getTaskPathsInDateRange(e,r){let i=new Set,s=new Date(e),a=new Date(r);for(let d=new Date(s);d<=a;d.setDate(d.getDate()+1)){let u=I(d,"yyyy-MM-dd");this.cacheManager.getTaskPathsByDate(u).forEach(f=>i.add(f))}let o=this.cacheManager.getAllTaskPaths(),l=50,c=Array.from(o);for(let d=0;d<c.length;d+=l){let u=c.slice(d,d+l),h=await Promise.all(u.map(f=>this.cacheManager.getCachedTaskInfo(f)));for(let f of h)if(f&&f.recurrence&&!f.due){for(let p=new Date(s);p<=a;p.setDate(p.getDate()+1))if(Ra(f,p)){i.add(f.path);break}}}return i}getOverdueTaskPaths(){return this.cacheManager.getOverdueTaskPaths()}combineTaskPathSets(e){let r=new Set;return e.forEach(i=>{i.forEach(s=>r.add(s))}),r}isDateInRange(e,r,i){try{let s=Z(e),a=Z(r),o=Z(i),l=ds(s),c=ds(a),d=ds(o);return l>=c&&l<=d}catch(s){return console.error("Error checking date range:",{dateString:e,startDateString:r,endDateString:i,error:s}),!1}}isSameDayAs(e,r){try{let i=new Date(e);i.setHours(0,0,0,0);let s=ds(r);return i.getTime()===s.getTime()}catch(i){return console.error("Error comparing date object with date string:",{dateObj:e,dateString:r,error:i}),!1}}sortTasks(e,r,i){return e.sort((s,a)=>{let o=0;switch(r){case"due":o=this.compareDates(s.due,a.due);break;case"scheduled":o=this.compareDates(s.scheduled,a.scheduled);break;case"priority":o=this.comparePriorities(s.priority,a.priority);break;case"title":o=s.title.localeCompare(a.title);break;case"dateCreated":o=this.compareDates(s.dateCreated,a.dateCreated)}return o===0&&(o=this.applyFallbackSorting(s,a,r)),i==="desc"?-o:o})}compareDates(e,r){if(!e&&!r)return 0;if(!e)return 1;if(!r)return-1;try{return Di(e,r)?-1:Di(r,e)?1:0}catch(i){return console.error("Error comparing dates time-aware:",{dateA:e,dateB:r,error:i}),e.localeCompare(r)}}comparePriorities(e,r){let i=this.priorityManager.getPriorityWeight(e);return this.priorityManager.getPriorityWeight(r)-i}applyFallbackSorting(e,r,i){let a=["scheduled","due","priority","title"].filter(o=>o!==i);for(let o of a){let l=0;switch(o){case"scheduled":l=this.compareDates(e.scheduled,r.scheduled);break;case"due":l=this.compareDates(e.due,r.due);break;case"priority":l=this.comparePriorities(e.priority,r.priority);break;case"title":l=e.title.localeCompare(r.title);break}if(l!==0)return l}return 0}groupTasks(e,r,i){if(r==="none")return new Map([["all",e]]);let s=new Map;for(let a of e)if(r==="project"){let o=Ot(a.projects||[]);if(o.length>0)for(let l of o)s.has(l)||s.set(l,[]),s.get(l).push(a);else{let l="No Project";s.has(l)||s.set(l,[]),s.get(l).push(a)}}else{let o;switch(r){case"status":o=a.status||"no-status";break;case"priority":o=a.priority||"unknown";break;case"context":o=a.contexts&&a.contexts.length>0?a.contexts[0]:"none";break;case"due":o=this.getDueDateGroup(a,i);break;case"scheduled":o=this.getScheduledDateGroup(a,i);break;default:o="unknown"}s.has(o)||s.set(o,[]),s.get(o).push(a)}return this.sortGroups(s,r)}getDueDateGroup(e,r){var o,l,c;let i=r||new Date;i.setHours(0,0,0,0);let s=this.statusManager.isCompletedStatus(e.status),a=(c=(l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.hideCompletedFromOverdue)!=null?c:!0;if(e.recurrence)if(Ra(e,i)){let d=I(i,"yyyy-MM-dd");return this.getDateGroupFromDateStringWithTask(d,s,a)}else return e.due?this.getDateGroupFromDateStringWithTask(e.due,s,a):"No due date";return e.due?this.getDateGroupFromDateStringWithTask(e.due,s,a):"No due date"}getDateGroupFromDateString(e){let r=$e();if(Ut(e))return"Overdue";let i=Z(e);if(Ze(i,r))return"Today";try{let s=new Date;s.setDate(s.getDate()+1);let a=I(s,"yyyy-MM-dd");if(Ze(i,a))return"Tomorrow";let o=new Date;o.setDate(o.getDate()+7);let l=I(o,"yyyy-MM-dd");return gr(i,l)||Ze(i,l)?"This week":"Later"}catch(s){return console.error(`Error categorizing date ${e}:`,s),"Invalid Date"}}getDueDateGroupFromDate(e){return this.getDateGroupFromDateString(e)}getDueDateGroupForTask(e){var s,a,o;if(!e.due)return"No due date";let r=this.statusManager.isCompletedStatus(e.status),i=(o=(a=(s=this.plugin)==null?void 0:s.settings)==null?void 0:a.hideCompletedFromOverdue)!=null?o:!0;return this.getDateGroupFromDateStringWithTask(e.due,r,i)}getDateGroupFromDateStringWithTask(e,r,i){let s=$e();if(Ut(e,r,i))return"Overdue";let a=Z(e);if(Ze(a,s))return"Today";try{let o=new Date;o.setDate(o.getDate()+1);let l=I(o,"yyyy-MM-dd");if(Ze(a,l))return"Tomorrow";let c=new Date;c.setDate(c.getDate()+7);let d=I(c,"yyyy-MM-dd");return gr(a,d)||Ze(a,d)?"This week":"Later"}catch(o){return console.error(`Error categorizing date ${e}:`,o),"Invalid Date"}}getScheduledDateGroup(e,r){var a,o,l;if(!e.scheduled)return"No scheduled date";let i=this.statusManager.isCompletedStatus(e.status),s=(l=(o=(a=this.plugin)==null?void 0:a.settings)==null?void 0:o.hideCompletedFromOverdue)!=null?l:!0;return this.getScheduledDateGroupForTask(e.scheduled,i,s)}getScheduledDateGroupForTask(e,r,i){let s=$e();if(Ut(e,r,i))return"Past scheduled";let a=Z(e);if(Ze(a,s))return"Today";try{let o=new Date;o.setDate(o.getDate()+1);let l=I(o,"yyyy-MM-dd");if(Ze(a,l))return"Tomorrow";let c=new Date;c.setDate(c.getDate()+7);let d=I(c,"yyyy-MM-dd");return gr(a,d)||Ze(a,d)?"This week":"Later"}catch(o){return console.error(`Error categorizing scheduled date ${e}:`,o),"Invalid Date"}}getScheduledDateGroupFromDate(e){let r=$e();if(Ut(e))return"Past scheduled";let i=Z(e);if(Ze(i,r))return"Today";try{let s=new Date;s.setDate(s.getDate()+1);let a=I(s,"yyyy-MM-dd");if(Ze(i,a))return"Tomorrow";let o=new Date;o.setDate(o.getDate()+7);let l=I(o,"yyyy-MM-dd");return gr(i,l)||Ze(i,l)?"This week":"Later"}catch(s){return console.error(`Error categorizing scheduled date ${e}:`,s),"Invalid Date"}}sortGroups(e,r){let i=new Map,s;switch(r){case"priority":s=Array.from(e.keys()).sort((a,o)=>{let l=this.priorityManager.getPriorityWeight(a);return this.priorityManager.getPriorityWeight(o)-l});break;case"status":s=Array.from(e.keys()).sort((a,o)=>{let l=this.statusManager.getStatusOrder(a),c=this.statusManager.getStatusOrder(o);return l-c});break;case"due":{let a=["Overdue","Today","Tomorrow","This week","Later","No due date"];s=Array.from(e.keys()).sort((o,l)=>{let c=a.indexOf(o),d=a.indexOf(l);return c-d});break}case"scheduled":{let a=["Past scheduled","Today","Tomorrow","This week","Later","No scheduled date"];s=Array.from(e.keys()).sort((o,l)=>{let c=a.indexOf(o),d=a.indexOf(l);return c-d});break}case"project":s=Array.from(e.keys()).sort((a,o)=>a==="No Project"?1:o==="No Project"?-1:a.localeCompare(o));break;default:s=Array.from(e.keys()).sort()}for(let a of s)i.set(a,e.get(a));return i}async getFilterOptions(){let e=Date.now();if(this.filterOptionsCache&&e-this.filterOptionsCacheTimestamp<this.filterOptionsCacheTTL)return this.filterOptionsCacheHits++,this.filterOptionsCache;let r={statuses:this.statusManager.getAllStatuses(),priorities:this.priorityManager.getAllPriorities(),contexts:this.cacheManager.getAllContexts(),projects:this.cacheManager.getAllProjects(),tags:this.cacheManager.getAllTags()};return this.filterOptionsComputeCount++,this.filterOptionsCache=r,this.filterOptionsCacheTimestamp=e,r}checkAndInvalidateFilterOptionsCache(){if(!this.filterOptionsCache)return;Date.now()-this.filterOptionsCacheTimestamp>3e4&&this.invalidateFilterOptionsCache()}invalidateFilterOptionsCache(){this.filterOptionsCache&&(this.filterOptionsCache=null)}getFilterOptionsCacheStats(){let e=Date.now(),r=this.filterOptionsCache?e-this.filterOptionsCacheTimestamp:0,i=this.filterOptionsCache?Math.max(0,this.filterOptionsCacheTTL-r):0,s=this.filterOptionsCacheHits+this.filterOptionsComputeCount,a=s>0?(this.filterOptionsCacheHits/s*100).toFixed(1)+"%":"0%";return{cacheHits:this.filterOptionsCacheHits,computeCount:this.filterOptionsComputeCount,hitRate:a,isCurrentlyCached:!!this.filterOptionsCache,cacheAge:r,ttlRemaining:i}}createDefaultQuery(){return{type:"group",id:me.generateId(),conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"}}addQuickToggleCondition(e,r,i){let s=JSON.parse(JSON.stringify(e));if(this.removeQuickToggleCondition(s,r),!i){let a;switch(r){case"showCompleted":a={type:"condition",id:me.generateId(),property:"status.isCompleted",operator:"is-not-checked",value:null};break;case"showArchived":a={type:"condition",id:me.generateId(),property:"archived",operator:"is-not-checked",value:null};break;case"showRecurrent":a={type:"condition",id:me.generateId(),property:"recurrence",operator:"is-empty",value:null};break}s.children.push(a)}return s}removeQuickToggleCondition(e,r){let i;switch(r){case"showCompleted":i="status.isCompleted";break;case"showArchived":i="archived";break;case"showRecurrent":i="recurrence";break}e.children=e.children.filter(s=>s.type==="condition"?s.property!==i:!0)}normalizeQuery(e){let r=this.createDefaultQuery();return{...r,...e,type:"group",id:e.id||r.id,conjunction:e.conjunction||r.conjunction,children:e.children||r.children,sortKey:e.sortKey||r.sortKey,sortDirection:e.sortDirection||r.sortDirection,groupKey:e.groupKey||r.groupKey}}initialize(){this.cacheManager.on("file-updated",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-added",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-deleted",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-renamed",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("indexes-built",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")})}cleanup(){this.clearIndexQueryCache(),this.invalidateFilterOptionsCache(),this.removeAllListeners()}static createDateRangeFromDates(e){if(e.length===0)throw new Error("No dates provided");let r=e[0],i=e[e.length-1];return{start:I(r,"yyyy-MM-dd"),end:I(i,"yyyy-MM-dd")}}static shouldIncludeOverdueForRange(e,r){if(!r)return!1;let i=new Date,s=I(i,"yyyy-MM-dd");return e.some(a=>I(a,"yyyy-MM-dd")===s)}async getTasksForDate(e,r,i=!1){let s=I(e,"yyyy-MM-dd"),a=ds(s),o=ki(s),l=this.cacheManager.getAllTaskPaths(),u=(await this.pathsToTaskInfos(Array.from(l))).filter(h=>this.evaluateFilterNode(r,h)).filter(h=>{var f,p,m;if(h.recurrence){let g=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()));return Ra(h,g)}if(h.due&&Z(h.due)===s||h.scheduled&&Z(h.scheduled)===s)return!0;if(i&&o){let g=this.statusManager.isCompletedStatus(h.status),v=(m=(p=(f=this.plugin)==null?void 0:f.settings)==null?void 0:p.hideCompletedFromOverdue)!=null?m:!0;if(h.due&&Z(h.due)!==s&&Ut(h.due,g,v)||h.scheduled&&Z(h.scheduled)!==s&&Ut(h.scheduled,g,v))return!0}return!1});return this.sortTasks(u,r.sortKey||"due",r.sortDirection||"asc")}async getAgendaData(e,r,i=!1){let s=[];for(let a of e){let o=await this.getTasksForDate(a,r,i&&is(a));s.push({date:new Date(a),tasks:o})}return s}async getFlatAgendaData(e,r,i=!1){let s=await this.getAgendaData(e,r,i),a=[];for(let o of s)for(let l of o.tasks)a.push({...l,agendaDate:o.date});return a}extractProjectNamesFromTaskValue(e,r){if(!e||e.trim()===""||e==='""')return[];let i=e.replace(/^"(.*)"$/,"$1");if(i.startsWith("[[")&&i.endsWith("]]")){let s=i.slice(2,-2),a=(0,QT.parseLinktext)(s),o=this.cacheManager.getApp().metadataCache.getFirstLinkpathDest(a.path,r);if(o)return[o.basename];{let l=a.subpath||(a.path.includes("/")?a.path.split("/").pop():a.path);return l?[l]:[]}}else return[i]}};var ll=class extends Xn.ItemView{constructor(e,r){super(e);this.daysToShow=7;this.groupByDate=!0;this.showOverdueOnToday=!0;this.showNotes=!0;this.filterBar=null;this.listeners=[];this.functionListeners=[];this.plugin=r,this.startDate=new Date(r.selectedDate),this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"scheduled",sortDirection:"asc",groupKey:"none"},this.registerEvents()}registerEvents(){this.listeners.forEach(a=>this.plugin.emitter.offref(a)),this.listeners=[],this.functionListeners.forEach(a=>a()),this.functionListeners=[];let e=this.plugin.emitter.on(it,async()=>{if(this.refresh(),this.filterBar){let a=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(a)}});this.listeners.push(e);let r=this.plugin.emitter.on(Ei,a=>{this.startDate=new Date(a),this.updatePeriodDisplay(),this.refresh()});this.listeners.push(r);let i=this.plugin.emitter.on(xe,async({path:a,originalTask:o,updatedTask:l})=>{if(this.refresh(),this.filterBar){let c=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(c)}});this.listeners.push(i);let s=this.plugin.filterService.on("data-changed",()=>{this.refresh()});this.functionListeners.push(s)}getViewType(){return Ti}getDisplayText(){return"Agenda"}getIcon(){return"calendar-clock"}async onOpen(){await this.plugin.onReady(),await this.plugin.waitForMigration();let e=this.plugin.viewStateManager.getFilterState(Ti);e&&(this.currentQuery=e);let r=this.contentEl;r.empty();let i=r.createDiv({cls:"tasknotes-plugin agenda-view"});this.showLoadingIndicator(),await this.renderView(i),this.hideLoadingIndicator()}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.functionListeners.forEach(e=>e()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.contentEl.empty()}async renderView(e){e.empty(),await this.createAgendaControls(e),await this.renderAgendaContent(e)}async createAgendaControls(e){let r=e.createDiv({cls:"agenda-view__controls"}),s=r.createDiv({cls:"agenda-view__header"}).createDiv({cls:"agenda-view__header-content"}),a=s.createDiv({cls:"agenda-view__nav-section"}),o=a.createEl("button",{cls:"agenda-view__nav-button agenda-view__nav-button--prev",text:"\u2039",attr:{"aria-label":"Previous period",title:"Previous period"}}),l=a.createEl("button",{cls:"agenda-view__nav-button agenda-view__nav-button--next",text:"\u203A",attr:{"aria-label":"Next period",title:"Next period"}});s.createDiv({cls:"agenda-view__title-section"}).createDiv({cls:"agenda-view__period-title",text:this.getCurrentPeriodText()});let d=s.createDiv({cls:"agenda-view__actions-section"});o.addEventListener("click",()=>{this.navigateToPreviousPeriod()}),l.addEventListener("click",()=>{this.navigateToNextPeriod()}),d.createEl("button",{text:"Today",cls:"agenda-view__today-button",attr:{"aria-label":"Go to today",title:"Go to today"}}).addEventListener("click",()=>{this.startDate=new Date,this.plugin.setSelectedDate(new Date),this.updatePeriodDisplay(),this.refresh()});let h=r.createDiv({cls:"agenda-view__filter-container"});await this.waitForCacheReady(),this.currentQuery=this.plugin.filterService.createDefaultQuery(),this.currentQuery.sortKey="scheduled",this.currentQuery.sortDirection="asc",this.currentQuery.groupKey="none";let f=this.plugin.viewStateManager.getFilterState(Ti);f&&(this.currentQuery=f);let p=await this.plugin.filterService.getFilterOptions();this.filterBar=new Xt(this.app,h,this.currentQuery,p);let m=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(m),this.filterBar.on("saveView",({name:g,query:v,viewOptions:T})=>{this.plugin.viewStateManager.saveView(g,v,T)}),this.filterBar.on("deleteView",g=>{this.plugin.viewStateManager.deleteView(g)}),this.filterBar.on("loadViewOptions",g=>{this.applyViewOptions(g)}),this.plugin.viewStateManager.on("saved-views-changed",g=>{var v;(v=this.filterBar)==null||v.updateSavedViews(g)}),this.filterBar.on("reorderViews",(g,v)=>{this.plugin.viewStateManager.reorderSavedViews(g,v)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async g=>{this.currentQuery=g;let v=g;await this.plugin.viewStateManager.setFilterState(Ti,v),this.refresh()}),this.setupViewOptions()}setupViewOptions(){if(!this.filterBar)return;let e=[{id:"showOverdueOnToday",label:"Show overdue on today",value:this.showOverdueOnToday,onChange:r=>{this.showOverdueOnToday=r,this.refresh()}},{id:"showNotes",label:"Show notes",value:this.showNotes,onChange:r=>{this.showNotes=r,this.refresh()}}];this.filterBar.setViewOptions(e)}applyViewOptions(e){e.hasOwnProperty("showOverdueOnToday")&&(this.showOverdueOnToday=e.showOverdueOnToday),e.hasOwnProperty("showNotes")&&(this.showNotes=e.showNotes),this.setupViewOptions(),this.refresh()}renderPeriodSelector(e){let r=e.createEl("select",{cls:"agenda-view__period-select"});[{value:"7",text:"7 days"},{value:"14",text:"14 days"},{value:"30",text:"30 days"},{value:"week",text:"This week"}].forEach(s=>{let a=r.createEl("option",{value:s.value,text:s.text});(s.value==="7"&&this.daysToShow===7||s.value==="week"&&this.daysToShow===-1)&&(a.selected=!0)}),r.addEventListener("change",()=>{let s=r.value;s==="week"?this.daysToShow=-1:this.daysToShow=parseInt(s),this.refresh()})}getDateRange(){let e=this.getAgendaDates();return tn.createDateRangeFromDates(e)}async addNotesToAgendaData(e){if(this.plugin.settings.disableNoteIndexing||!this.showNotes)return e.map(i=>({...i,notes:[]}));let r=e.map(async i=>{let s=await this.plugin.cacheManager.getNotesForDate(i.date);return{...i,notes:s}});return Promise.all(r)}async renderAgendaContent(e){let r=e.querySelector(".agenda-view__content");r||(r=e.createDiv({cls:"agenda-view__content"}));try{let i=this.getAgendaDates(),s=[];for(let o of i){let l=await this.plugin.filterService.getTasksForDate(o,this.currentQuery,this.showOverdueOnToday);s.push({date:o,tasks:l})}let a=await this.addNotesToAgendaData(s);this.groupByDate?this.renderGroupedAgendaWithReconciler(r,a):this.renderFlatAgendaWithReconciler(r,a)}catch(i){console.error("Error rendering agenda content:",i),r.empty(),r.createDiv({cls:"agenda-view__error"}).createSpan({text:"Error loading agenda. Please try refreshing."})}}renderGroupedAgendaWithReconciler(e,r){let i=[],s=!1;if(r.forEach(a=>{let o=Te(a.date);if(a.tasks.length>0||a.notes.length>0){s=!0;let c=o;i.push({type:"day-header",item:a,date:a.date,dayKey:c}),a.tasks.forEach(d=>{i.push({type:"task",item:d,date:a.date,dayKey:c})}),a.notes.forEach(d=>{i.push({type:"note",item:d,date:a.date,dayKey:c})})}}),!s){e.empty();let a=e.createDiv({cls:"agenda-view__empty"});new Xn.Setting(a).setName("No items scheduled").setHeading(),a.createEl("p",{text:"No items scheduled for this period.",cls:"agenda-view__empty-description"});let o=a.createEl("p",{cls:"agenda-view__empty-tip"});o.createEl("span",{text:"Tip: "}),o.appendChild(document.createTextNode("Create tasks with due or scheduled dates, or add notes to see them here."));return}this.plugin.domReconciler.updateList(e,i,a=>`${a.type}-${a.dayKey}-${a.type==="day-header"?a.dayKey:a.item.path||a.item.id||"unknown"}`,a=>this.createAgendaItemElement(a),(a,o)=>this.updateAgendaItemElement(a,o))}renderFlatAgendaWithReconciler(e,r){let i=[];if(r.forEach(s=>{s.tasks.forEach(a=>{i.push({type:"task",item:a,date:s.date})}),s.notes.forEach(a=>{i.push({type:"note",item:a,date:s.date})})}),i.length===0){e.empty();let s=e.createDiv({cls:"agenda-view__empty"});new Xn.Setting(s).setName("No items found").setHeading(),s.createEl("p",{text:"No items found for the selected period.",cls:"agenda-view__empty-description"});return}i.sort((s,a)=>s.date.getTime()-a.date.getTime()),this.plugin.domReconciler.updateList(e,i,s=>`${s.type}-${s.item.path||s.item.id||"unknown"}`,s=>this.createFlatAgendaItemElement(s),(s,a)=>this.updateFlatAgendaItemElement(s,a))}createAgendaItemElement(e){if(e.type==="day-header"){let r=document.createElement("div");r.className="agenda-view__day-header";let i=r.createDiv({cls:"agenda-view__day-header-text"}),s=I(e.date,"EEEE"),a=I(e.date,"MMMM d");is(e.date)?(i.createSpan({cls:"agenda-view__day-name agenda-view__day-name--today",text:"Today"}),i.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${a}`})):(i.createSpan({cls:"agenda-view__day-name",text:s}),i.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${a}`}));let o=e.item.tasks.length+e.item.notes.length;return r.createDiv({cls:"agenda-view__item-count",text:`${o}`}),r}else return e.type==="task"?this.createTaskItemElement(e.item,e.date):this.createNoteItemElement(e.item,e.date)}updateAgendaItemElement(e,r){if(r.type==="day-header"){let i=e.querySelector(".agenda-view__item-count");if(i){let s=r.item.tasks.length+r.item.notes.length;i.textContent=`${s}`}}else r.type==="task"&&Nr(e,r.item,this.plugin,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}createFlatAgendaItemElement(e){return e.type==="task"?this.createTaskItemElement(e.item,e.date):this.createNoteItemElement(e.item,e.date)}updateFlatAgendaItemElement(e,r){r.type==="task"&&Nr(e,r.item,this.plugin,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}createTaskItemElement(e,r){let i=Bt(e,this.plugin,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r});return this.plugin.statusManager.isCompletedStatus(e.status)&&i.classList.add("done"),this.addDragHandlers(i,e),i}createNoteItemElement(e,r){let i=Pd(e,this.plugin,{showCreatedDate:!1,showTags:!0,showPath:!1,maxTags:3,showDailyNoteBadge:!1});return!this.groupByDate&&r&&i.createSpan({cls:"agenda-view__note-date",text:I(r,"MMM d")}),i}addDragHandlers(e,r){this.plugin.dragDropManager.makeTaskCardDraggable(e,r.path)}addHoverPreview(e,r){e.addEventListener("mouseover",i=>{this.app.vault.getAbstractFileByPath(r)&&this.app.workspace.trigger("hover-link",{event:i,source:"tasknotes-agenda",hoverParent:this,targetEl:e,linktext:r,sourcePath:r})})}openFile(e){let r=this.app.vault.getAbstractFileByPath(e);r instanceof Xn.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}getAgendaDates(){let e=[];if(this.daysToShow===-1){let i={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},s=fn(this.startDate,i),a=mn(this.startDate,i),o=s;for(;o<=a;){let l=new Date(o.getFullYear(),o.getMonth(),o.getDate());e.push(l),o=gt(o,1)}}else for(let r=0;r<this.daysToShow;r++){let i=gt(this.startDate,r),s=new Date(i.getFullYear(),i.getMonth(),i.getDate());e.push(s)}return e}navigateToPreviousPeriod(){this.daysToShow===-1?this.startDate=gt(this.startDate,-7):this.startDate=gt(this.startDate,-this.daysToShow),this.updatePeriodDisplay(),this.refresh()}navigateToNextPeriod(){this.daysToShow===-1?this.startDate=gt(this.startDate,7):this.startDate=gt(this.startDate,this.daysToShow),this.updatePeriodDisplay(),this.refresh()}updatePeriodDisplay(){let e=this.contentEl.querySelector(".agenda-view__period-title");e&&(e.textContent=this.getCurrentPeriodText())}getCurrentPeriodText(){let e=this.getAgendaDates();if(e.length===0)return"";let r=e[0],i=e[e.length-1];return Lr(r,i)?I(r,"EEEE, MMMM d, yyyy"):`${I(r,"MMM d")} - ${I(i,"MMM d, yyyy")}`}showLoadingIndicator(){let e=this.contentEl.querySelector(".agenda-view");if(!e||e.querySelector(".agenda-view__loading"))return;let r=document.createElement("div");r.className="agenda-view__loading",r.textContent="Loading agenda...",e.prepend(r)}hideLoadingIndicator(){let e=this.contentEl.querySelector(".agenda-view__loading");e&&e.remove()}async refresh(){let e=this.contentEl.querySelector(".agenda-view");e&&(this.setupViewOptions(),await this.renderAgendaContent(e))}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(e=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),e()})})}};var rn=require("obsidian");var Js=require("obsidian");we();at();var Zs=class extends Js.FuzzySuggestModal{constructor(e,r,i,s){super(e);this.plugin=r,this.tasks=i,this.onChooseTask=s,this.setPlaceholder("Type to search for a task..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText("Select Task"),this.titleEl.setAttribute("id","task-selector-title"),this.containerEl.setAttribute("aria-labelledby","task-selector-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true")}getItems(){return this.tasks.filter(e=>!e.archived).sort((e,r)=>{var c,d;let i=this.plugin.statusManager.isCompletedStatus(e.status),s=this.plugin.statusManager.isCompletedStatus(r.status);if(i!==s)return i?1:-1;if(e.due&&!r.due)return-1;if(!e.due&&r.due)return 1;if(e.due&&r.due){let u=e.due.localeCompare(r.due);if(u!==0)return u}let a={high:0,normal:1,low:2},o=(c=a[e.priority])!=null?c:1,l=(d=a[r.priority])!=null?d:1;return o!==l?o-l:e.title.localeCompare(r.title)})}getItemText(e){let r=e.title;e.due&&(r+=` ${e.due}`),e.priority!=="normal"&&(r+=` ${e.priority}`),e.contexts&&e.contexts.length>0&&(r+=` ${e.contexts.join(" ")}`);let i=Ot(e.projects||[]);return i.length>0&&(r+=` ${i.join(" ")}`),r}renderSuggestion(e,r){let i=e.item,s=r.createDiv({cls:"task-selector-modal__suggestion"}),a=s.createDiv({cls:"task-selector-modal__title"}),o=i.priority!=="normal"?`task-selector-modal__task-title--${i.priority}-priority`:"";a.createSpan({cls:`task-selector-modal__task-title ${o}`,text:i.title});let l=s.createDiv({cls:"task-selector-modal__meta"});if(i.due){let d=us(i.due),u=ki(i.due),h=i.due,f="task-selector-modal__due-date";d?(h=`Overdue (${i.due})`,f+=" task-selector-modal__due-date--overdue"):u&&(h="Due today",f+=" task-selector-modal__due-date--today"),l.createSpan({cls:f,text:h})}if(i.contexts&&i.contexts.length>0){let d=l.createSpan({cls:"task-selector-modal__contexts"});i.contexts.forEach((u,h)=>{h>0&&d.createSpan({text:", "}),d.createSpan({cls:"task-selector-modal__context-tag",text:`${u}`})})}let c=Ot(i.projects||[]);if(c.length>0){let d=l.createSpan({cls:"task-selector-modal__projects"});c.forEach((u,h)=>{h>0&&d.createSpan({text:", "});let f=document.createTextNode("+");if(d.appendChild(f),z0(u)){let p=u.slice(2,-2);d.createEl("a",{cls:"task-selector-modal__project-link internal-link",text:p,attr:{"data-href":p}}).addEventListener("click",async g=>{g.preventDefault(),g.stopPropagation();let v=this.plugin.app.metadataCache.getFirstLinkpathDest(p,"");v instanceof Js.TFile?(await this.plugin.app.workspace.getLeaf(!1).openFile(v),this.close()):new Js.Notice(`Note "${p}" not found`)})}else d.createSpan({cls:"task-selector-modal__project-tag",text:u})})}if(i.status!=="open"){let d=this.plugin.statusManager.getStatusConfig(i.status);l.createSpan({cls:"task-selector-modal__status",text:d?d.label:i.status})}}onChooseItem(e,r){this.onChooseTask(e)}onClose(){super.onClose()}};function z0(n){return n.startsWith("[[")&&n.endsWith("]]")}ui();var Od=class extends rn.ItemView{constructor(e,r){super(e);this.timerDisplay=null;this.statusDisplay=null;this.progressCircle=null;this.progressContainer=null;this.startButton=null;this.pauseButton=null;this.stopButton=null;this.taskDisplay=null;this.statsDisplay=null;this.taskSelectButton=null;this.taskClearButton=null;this.currentSelectedTask=null;this.taskCardContainer=null;this.addTimeButton=null;this.subtractTimeButton=null;this.skipBreakButton=null;this.statElements={pomodoros:null};this.listeners=[];this.plugin=r,this.registerEvents()}getViewType(){return va}getDisplayText(){return"Pomodoro"}getIcon(){return"clock"}registerEvents(){this.listeners.forEach(o=>this.plugin.emitter.offref(o)),this.listeners=[];let e=this.plugin.emitter.on(Pl,({session:o,task:l})=>{this.updateDisplay(o,l)});this.listeners.push(e);let r=this.plugin.emitter.on(Nl,({session:o,nextType:l})=>{this.onPomodoroComplete(o,l)});this.listeners.push(r);let i=this.plugin.emitter.on(Ol,({session:o})=>{this.updateDisplay()});this.listeners.push(i);let s=this.plugin.emitter.on(nr,({timeRemaining:o,session:l})=>{this.updateTimer(o),this.updateDisplay(l)});this.listeners.push(s);let a=this.plugin.emitter.on(xe,async({path:o,originalTask:l,updatedTask:c})=>{if(!o||!c)return;if(this.currentSelectedTask&&(this.currentSelectedTask.path===o||l&&this.currentSelectedTask.path===l.path)){this.currentSelectedTask=c,this.updateTaskCardDisplay(c);let u=this.plugin.pomodoroService.getState();u.currentSession&&l&&l.path!==c.path&&u.currentSession.taskPath===l.path&&await this.plugin.pomodoroService.assignTaskToCurrentSession(c)}});this.listeners.push(a)}async onOpen(){await this.plugin.onReady(),await this.render()}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.timerDisplay=null,this.statusDisplay=null,this.progressCircle=null,this.progressContainer=null,this.startButton=null,this.pauseButton=null,this.stopButton=null,this.taskDisplay=null,this.statsDisplay=null,this.taskSelectButton=null,this.taskClearButton=null,this.currentSelectedTask=null,this.taskCardContainer=null,this.statElements={pomodoros:null},this.contentEl.empty()}async render(){let e=this.contentEl.createDiv({cls:"tasknotes-plugin pomodoro-view"});this.statusDisplay=e.createDiv({cls:"pomodoro-view__status",text:"Focus"});let r=e.createDiv({cls:"pomodoro-view__timer-section"});this.progressContainer=r.createDiv({cls:"pomodoro-view__progress-container"});let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("class","pomodoro-view__progress-svg"),i.setAttribute("width","300"),i.setAttribute("height","300"),i.setAttribute("viewBox","0 0 300 300"),this.progressContainer.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx","150"),s.setAttributeNS(null,"cy","150"),s.setAttributeNS(null,"r","140"),s.setAttributeNS(null,"fill","none"),s.setAttributeNS(null,"stroke","var(--tn-border-color)"),s.setAttributeNS(null,"stroke-width","2"),i.appendChild(s),this.progressCircle=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.progressCircle.setAttributeNS(null,"cx","150"),this.progressCircle.setAttributeNS(null,"cy","150"),this.progressCircle.setAttributeNS(null,"r","140"),this.progressCircle.setAttributeNS(null,"fill","none"),this.progressCircle.setAttributeNS(null,"stroke","var(--tn-interactive-accent)"),this.progressCircle.setAttributeNS(null,"stroke-width","4"),this.progressCircle.setAttributeNS(null,"stroke-linecap","round");let a=140,o=2*Math.PI*a;this.progressCircle.setAttributeNS(null,"stroke-dasharray",o.toString()),this.progressCircle.setAttributeNS(null,"stroke-dashoffset",o.toString()),this.progressCircle.addClass("pomodoro-view__progress-circle"),i.appendChild(this.progressCircle);let l=this.progressContainer.createDiv({cls:"pomodoro-view__timer-overlay"}),d=`${this.plugin.settings.pomodoroWorkDuration.toString().padStart(2,"0")}:00`;this.timerDisplay=l.createDiv({cls:"pomodoro-view__timer-display",text:d});let u=l.createDiv({cls:"pomodoro-view__time-controls"});this.subtractTimeButton=u.createEl("button",{cls:"pomodoro-view__time-adjust-button pomodoro-view__subtract-time",text:"-"}),this.addTimeButton=u.createEl("button",{cls:"pomodoro-view__time-adjust-button pomodoro-view__add-time",text:"+"}),this.taskDisplay=e.createDiv({cls:"pomodoro-view__task-display"});let h=e.createDiv({cls:"pomodoro-view__task-selector"}),f=h.createDiv({cls:"pomodoro-view__task-buttons"});this.taskSelectButton=f.createEl("button",{cls:"pomodoro-view__task-select-button",text:"Choose task..."}),this.taskClearButton=f.createEl("button",{cls:"pomodoro-view__task-clear-button pomodoro-view__task-clear-button--hidden",text:"Clear task"}),this.taskCardContainer=h.createDiv({cls:"pomodoro-view__task-card-container"});let p=e.createDiv({cls:"pomodoro-view__control-section"}),m=p.createDiv({cls:"pomodoro-view__primary-controls"});this.startButton=m.createEl("button",{text:"Start",cls:"pomodoro-view__start-button"}),this.pauseButton=m.createEl("button",{text:"Pause",cls:"pomodoro-view__pause-button"}),this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton=m.createEl("button",{text:"Stop",cls:"pomodoro-view__stop-button"}),this.stopButton.addClass("pomodoro-view__stop-button--hidden"),this.skipBreakButton=p.createEl("button",{cls:"pomodoro-view__skip-break-button",text:"Skip break"}),this.skipBreakButton.addClass("pomodoro-view__skip-break-button--hidden");let g=e.createDiv({cls:"pomodoro-view__stats-section"});this.statsDisplay=g.createDiv({cls:"pomodoro-view__stats"});let v=this.statsDisplay.createDiv({cls:"pomodoro-view__stat pomodoro-view__stat--clickable"});this.statElements.pomodoros=v.createSpan({cls:"pomodoro-view__stat-value",text:"0"}),v.createSpan({cls:"pomodoro-view__stat-label",text:"completed today"}),this.registerDomEvent(v,"click",()=>{this.plugin.activatePomodoroStatsView()}),this.registerDomEvent(this.startButton,"click",async()=>{var k,D,M;if(!((k=this.startButton)!=null&&k.hasClass("is-loading"))){(D=this.startButton)==null||D.addClass("pomodoro-view__start-button--loading");try{let E=this.plugin.pomodoroService.getState();E.currentSession&&!E.isRunning?await this.plugin.pomodoroService.resumePomodoro():E.nextSessionType==="short-break"?await this.plugin.pomodoroService.startBreak(!1):E.nextSessionType==="long-break"?await this.plugin.pomodoroService.startBreak(!0):await this.plugin.pomodoroService.startPomodoro(this.currentSelectedTask||void 0)}finally{(M=this.startButton)==null||M.removeClass("pomodoro-view__start-button--loading")}}}),this.registerDomEvent(this.pauseButton,"click",()=>{this.plugin.pomodoroService.pausePomodoro()}),this.registerDomEvent(this.stopButton,"click",()=>{this.plugin.pomodoroService.stopPomodoro()}),this.registerDomEvent(this.skipBreakButton,"click",()=>{let k=this.plugin.pomodoroService.getState();k.currentSession?this.plugin.pomodoroService.stopPomodoro():(k.nextSessionType==="short-break"||k.nextSessionType==="long-break")&&this.plugin.pomodoroService.startPomodoro(this.currentSelectedTask||void 0)}),this.registerDomEvent(this.addTimeButton,"click",()=>{this.adjustSessionTime(60)}),this.registerDomEvent(this.subtractTimeButton,"click",()=>{this.adjustSessionTime(-60)}),this.registerDomEvent(this.taskSelectButton,"click",async()=>{await this.openTaskSelector()}),this.registerDomEvent(this.taskClearButton,"click",async()=>{await this.selectTask(null)}),this.restoreLastSelectedTask(),this.updateDisplay(),this.updateStats().catch(k=>{console.error("Failed to update initial stats:",k)});let T=this.plugin.pomodoroService.getState();this.updateTimer(T.timeRemaining)}async openTaskSelector(){try{let r=(await this.plugin.cacheManager.getAllTasks()).filter(s=>!s.archived);if(r.length===0){new rn.Notice("No unarchived tasks found. Create some tasks first.");return}new Zs(this.app,this.plugin,r,s=>{this.selectTask(s)}).open()}catch(e){console.error("Error opening task selector:",e),new rn.Notice("Failed to load tasks")}}async selectTask(e){this.currentSelectedTask=e,this.taskSelectButton&&(e?(this.taskSelectButton.textContent="Change task...",(0,rn.setTooltip)(this.taskSelectButton,"Select a different task",{placement:"top"}),this.taskSelectButton.removeClass("pomodoro-view__task-select-button--no-task")):(this.taskSelectButton.textContent="Choose task...",this.taskSelectButton.removeAttribute("title"),this.taskSelectButton.addClass("pomodoro-view__task-select-button--no-task"))),this.taskClearButton&&(e?this.taskClearButton.removeClass("pomodoro-view__task-clear-button--hidden"):this.taskClearButton.addClass("pomodoro-view__task-clear-button--hidden")),this.updateTaskCardDisplay(e),await this.plugin.pomodoroService.saveLastSelectedTask(e==null?void 0:e.path);let r=this.plugin.pomodoroService.getState();r.currentSession&&r.currentSession.type==="work"&&await this.plugin.pomodoroService.assignTaskToCurrentSession(e||void 0)}updateTaskCardDisplay(e){if(this.taskCardContainer)if(this.taskCardContainer.empty(),e){let r=Bt(e,this.plugin,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!0,showRecurringControls:!1,groupByDate:!1});this.taskCardContainer.appendChild(r),this.taskCardContainer.removeClass("pomodoro-view__task-card-container--empty")}else this.taskCardContainer.addClass("pomodoro-view__task-card-container--empty")}async restoreLastSelectedTask(){try{let e=await this.plugin.pomodoroService.getLastSelectedTaskPath();if(e){let r=await this.plugin.cacheManager.getTaskByPath(e);r&&!this.plugin.statusManager.isCompletedStatus(r.status)&&!r.archived&&await this.selectTask(r)}}catch(e){console.error("Error restoring last selected task:",e)}}async updateTaskButtonFromPath(e){try{let r=await this.plugin.cacheManager.getTaskInfo(e);if(r){this.currentSelectedTask=r,this.taskSelectButton&&(this.taskSelectButton.textContent="Change task...",(0,rn.setTooltip)(this.taskSelectButton,"Select a different task",{placement:"top"}),this.taskSelectButton.removeClass("pomodoro-no-task"),this.taskSelectButton.removeClass("pomodoro-view__task-select-button--no-task")),this.taskClearButton&&this.taskClearButton.removeClass("pomodoro-view__task-clear-button--hidden"),this.updateTaskCardDisplay(r);return}this.currentSelectedTask=null,this.taskSelectButton&&(this.taskSelectButton.textContent="Choose task...",this.taskSelectButton.removeAttribute("title"),this.taskSelectButton.addClass("pomodoro-view__task-select-button--no-task")),this.taskClearButton&&this.taskClearButton.addClass("pomodoro-view__task-clear-button--hidden"),this.updateTaskCardDisplay(null)}catch(r){console.error("Error updating task button from path:",r)}}updateDisplay(e,r){var s,a;let i=this.plugin.pomodoroService.getState();if(this.updateTimer(i.timeRemaining),this.updateProgress(i),this.statusDisplay)if(i.isRunning&&i.currentSession){let o=i.currentSession.type==="work"?"Working":i.currentSession.type==="short-break"?"Short break":"Long break";this.statusDisplay.textContent=o,this.statusDisplay.className=`pomodoro-status pomodoro-view__status pomodoro-status-${i.currentSession.type} pomodoro-view__status--${i.currentSession.type}`}else i.currentSession&&!i.isRunning?(this.statusDisplay.textContent="Paused",this.statusDisplay.className="pomodoro-status pomodoro-view__status pomodoro-status-paused pomodoro-view__status--paused"):(this.statusDisplay.textContent="Ready to start",this.statusDisplay.className="pomodoro-status pomodoro-view__status");if(this.taskDisplay){let o=(s=i.currentSession)==null?void 0:s.taskPath,l=this.taskDisplay.dataset.currentTaskPath;o!==l&&(this.taskDisplay.empty(),this.taskDisplay.dataset.currentTaskPath=o||"")}if(this.taskSelectButton&&(a=i.currentSession)!=null&&a.taskPath&&!this.currentSelectedTask&&this.updateTaskButtonFromPath(i.currentSession.taskPath),this.startButton&&this.pauseButton&&this.stopButton&&(i.isRunning?(this.startButton.addClass("pomodoro-view__start-button--hidden"),this.pauseButton.removeClass("pomodoro-view__pause-button--hidden"),this.stopButton.removeClass("pomodoro-view__stop-button--hidden")):i.currentSession?(this.startButton.removeClass("pomodoro-view__start-button--hidden"),this.startButton.textContent="Resume",this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton.removeClass("pomodoro-view__stop-button--hidden")):(this.startButton.removeClass("pomodoro-view__start-button--hidden"),i.nextSessionType==="short-break"?this.startButton.textContent="Start Short Break":i.nextSessionType==="long-break"?this.startButton.textContent="Start Long Break":this.startButton.textContent="Start",this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton.addClass("pomodoro-view__stop-button--hidden"))),this.skipBreakButton){let o=i.currentSession&&(i.currentSession.type==="short-break"||i.currentSession.type==="long-break"),l=!i.currentSession&&(i.nextSessionType==="short-break"||i.nextSessionType==="long-break");o||l?(this.skipBreakButton.removeClass("pomodoro-view__skip-break-button--hidden"),this.skipBreakButton.textContent="Skip break"):this.skipBreakButton.addClass("pomodoro-view__skip-break-button--hidden")}this.addTimeButton&&this.subtractTimeButton&&(this.addTimeButton.removeClass("pomodoro-view__time-adjust-button--hidden"),this.subtractTimeButton.removeClass("pomodoro-view__time-adjust-button--hidden")),this.updateStats().catch(o=>{console.error("Failed to update stats:",o)})}updateTimer(e){if(this.timerDisplay){let r=Math.max(0,Math.floor(e)),i=Math.floor(r/60),s=r%60;this.timerDisplay.textContent=`${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`,r<=60&&r>0?this.timerDisplay.addClass("pomodoro-view__timer-display--warning"):this.timerDisplay.removeClass("pomodoro-view__timer-display--warning")}}updateProgress(e){if(!this.progressCircle)return;let r=140,i=2*Math.PI*r;if(!e.currentSession){this.progressCircle.setAttributeNS(null,"stroke-dashoffset",i.toString()),this.progressCircle.removeClass("pomodoro-view__progress-circle--work"),this.progressCircle.removeClass("pomodoro-view__progress-circle--short-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--long-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--warning");return}let s=e.currentSession.activePeriods||[],a=0;for(let d of s)if(d.endTime){let u=new Date(d.startTime).getTime(),h=new Date(d.endTime).getTime();a+=Math.floor((h-u)/1e3)}else if(e.isRunning){let u=new Date(d.startTime).getTime(),h=Date.now();a+=Math.floor((h-u)/1e3)}let o=e.currentSession.plannedDuration*60,l=Math.max(0,Math.min(1,a/o)),c=i-l*i;this.progressCircle.setAttributeNS(null,"stroke-dashoffset",c.toString()),this.progressCircle.removeClass("pomodoro-view__progress-circle--work"),this.progressCircle.removeClass("pomodoro-view__progress-circle--short-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--long-break"),this.progressCircle.addClass(`pomodoro-view__progress-circle--${e.currentSession.type}`),e.timeRemaining<=60&&e.timeRemaining>0?this.progressCircle.addClass("pomodoro-view__progress-circle--warning"):this.progressCircle.removeClass("pomodoro-view__progress-circle--warning")}async updateStats(){try{let e=await this.plugin.pomodoroService.getTodayStats();this.statElements.pomodoros&&this.statElements.pomodoros.textContent!==e.pomodorosCompleted.toString()&&(this.statElements.pomodoros.textContent=e.pomodorosCompleted.toString())}catch(e){console.error("Failed to update stats:",e),this.statElements.pomodoros&&(this.statElements.pomodoros.textContent="0")}}adjustSessionTime(e){let r=this.plugin.pomodoroService.getState();if(r.currentSession)this.plugin.pomodoroService.adjustSessionTime(e);else{let s=Math.max(60,r.timeRemaining+e);this.plugin.pomodoroService.adjustPreparedTimer(s)}let i=this.plugin.pomodoroService.getState();this.updateTimer(i.timeRemaining),this.updateProgress(i)}onPomodoroComplete(e,r){if(this.updateDisplay(),this.statusDisplay)if(e.type==="work"){let i=r==="long-break";this.statusDisplay.textContent=`Great work! Time for a ${i?"long":"short"} break`}else this.statusDisplay.textContent="Break complete! Ready for the next pomodoro?"}};var hi=require("obsidian");je();we();function cl(n){if(n.activePeriods&&Array.isArray(n.activePeriods))return n.activePeriods.filter(t=>t.endTime).reduce((t,e)=>{let r=new Date(e.startTime),s=new Date(e.endTime).getTime()-r.getTime();return t+Math.round(s/(1e3*60))},0);if(n.duration!==void 0)return n.duration;if(n.startTime&&n.endTime){let t=new Date(n.startTime),r=new Date(n.endTime).getTime()-t.getTime();return Math.round(r/(1e3*60))}return 0}var KT=`
  let timerInterval;

  self.onmessage = function(e) {
    const { command, duration } = e.data;

    if (command === 'start') {
      if (timerInterval) {
        clearInterval(timerInterval);
      }

      let timeRemaining = duration;
      timerInterval = setInterval(() => {
        timeRemaining--;
        // Notificar al hilo principal cada segundo para actualizar la UI
        self.postMessage({ type: 'tick', timeRemaining: timeRemaining });

        if (timeRemaining <= 0) {
          self.postMessage({ type: 'done' });
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }, 1000);

    } else if (command === 'stop') {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }
  };
`;var Rd=class extends hi.ItemView{constructor(e,r){super(e);this.overviewStatsEl=null;this.todayStatsEl=null;this.weekStatsEl=null;this.recentSessionsEl=null;this.overallStatsEl=null;this.plugin=r}getViewType(){return wa}getDisplayText(){return"Pomodoro stats"}getIcon(){return"bar-chart"}calculateActualDuration(e){return e.filter(r=>r.endTime).reduce((r,i)=>{let s=new Date(i.startTime),o=(i.endTime?new Date(i.endTime):new Date).getTime()-s.getTime();return r+Math.round(o/(1e3*60))},0)}async onOpen(){await this.plugin.onReady(),await this.render()}async onClose(){this.contentEl.empty()}async render(){let e=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container pomodoro-stats-container pomodoro-stats-view"}),r=e.createDiv({cls:"pomodoro-stats-header pomodoro-stats-view__header"});new hi.Setting(r).setName("Pomodoro statistics").setHeading();let i=r.createEl("button",{cls:"pomodoro-stats-refresh-button pomodoro-stats-view__refresh-button",text:"Refresh"});this.registerDomEvent(i,"click",()=>{this.refreshStats()});let s=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new hi.Setting(s).setName("Overview").setHeading(),this.overviewStatsEl=s.createDiv({cls:"pomodoro-overview-grid pomodoro-stats-view__overview-grid"});let a=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new hi.Setting(a).setName("Today").setHeading(),this.todayStatsEl=a.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let o=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new hi.Setting(o).setName("This week").setHeading(),this.weekStatsEl=o.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let l=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new hi.Setting(l).setName("All time").setHeading(),this.overallStatsEl=l.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let c=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new hi.Setting(c).setName("Recent sessions").setHeading(),this.recentSessionsEl=c.createDiv({cls:"pomodoro-recent-sessions pomodoro-stats-view__recent-sessions"}),await this.refreshStats()}async refreshStats(){try{await Promise.all([this.updateOverviewStats(),this.updateTodayStats(),this.updateWeekStats(),this.updateOverallStats(),this.updateRecentSessions()])}catch(e){console.error("Failed to refresh stats:",e)}}async updateOverviewStats(){if(!this.overviewStatsEl)return;let e=await this.plugin.pomodoroService.getTodayStats(),r=await this.calculateOverallStatsFromHistory(),i=new Date,s=new Date(i);s.setDate(s.getDate()-1);let a=await this.calculateStatsForRange(s,s);this.renderOverviewStats(this.overviewStatsEl,e,r,a)}async updateTodayStats(){if(!this.todayStatsEl)return;let e=await this.plugin.pomodoroService.getTodayStats();this.renderStatsGrid(this.todayStatsEl,e)}async updateWeekStats(){if(!this.weekStatsEl)return;let e=new Date,i={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},s=fn(e,i),a=mn(e,i),o=await this.calculateStatsForRange(s,a);this.renderStatsGrid(this.weekStatsEl,o)}async updateOverallStats(){if(!this.overallStatsEl)return;let e=await this.plugin.pomodoroService.getSessionHistory(),r=this.calculateOverallStats(e);this.renderStatsGrid(this.overallStatsEl,r)}async calculateOverallStatsFromHistory(){let e=await this.plugin.pomodoroService.getSessionHistory();return this.calculateOverallStats(e)}async updateRecentSessions(){var i;if(!this.recentSessionsEl)return;let r=(await this.plugin.pomodoroService.getSessionHistory()).filter(s=>s.type==="work").slice(-10).reverse();if(this.recentSessionsEl.empty(),r.length===0){this.recentSessionsEl.createDiv({cls:"pomodoro-no-sessions pomodoro-stats-view__no-sessions",text:"No sessions recorded yet"});return}for(let s of r){let a=this.recentSessionsEl.createDiv({cls:"pomodoro-session-item pomodoro-stats-view__session-item"}),o=a.createSpan({cls:"session-date pomodoro-stats-view__session-date"});o.textContent=I(new Date(s.startTime),"MMM d, HH:mm");let l=a.createSpan({cls:"session-duration pomodoro-stats-view__session-duration"}),c=cl(s);l.textContent=`${c}min`;let d=a.createSpan({cls:"session-status pomodoro-stats-view__session-status"});if(d.textContent=s.completed?"Completed":"Interrupted",d.addClass(s.completed?"status-completed":"status-interrupted"),d.addClass(s.completed?"pomodoro-stats-view__session-status--completed":"pomodoro-stats-view__session-status--interrupted"),s.taskPath){let u=a.createSpan({cls:"session-task pomodoro-stats-view__session-task"}),h=((i=s.taskPath.split("/").pop())==null?void 0:i.replace(".md",""))||"";u.textContent=h}}}renderOverviewStats(e,r,i,s){e.empty();let a=v=>{if(v<60)return`${v}m`;let T=Math.floor(v/60),k=v%60;return k>0?`${T}h${k}m`:`${T}h`},o=r.pomodorosCompleted-s.pomodorosCompleted,l=r.totalMinutes-s.totalMinutes,c=e.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),d=c.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});if(d.textContent=r.pomodorosCompleted.toString(),c.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Today's Pomos"}),o!==0){let v=c.createDiv({cls:"overview-change pomodoro-stats-view__overview-change"});v.textContent=`${o>0?"+":""}${o} from yesterday`,v.addClass(o>0?"positive":"negative")}let u=e.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),h=u.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});h.textContent=i.pomodorosCompleted.toString(),u.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Total Pomos"});let f=e.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),p=f.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});if(p.textContent=a(r.totalMinutes),f.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Today's Focus"}),l!==0){let v=f.createDiv({cls:"overview-change pomodoro-stats-view__overview-change"});v.textContent=`${a(Math.abs(l))} ${l>0?"more":"less"} than yesterday`,v.addClass(l>0?"positive":"negative")}let m=e.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),g=m.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});g.textContent=a(i.totalMinutes),m.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Total Focus Duration"})}renderStatsGrid(e,r){e.empty();let i=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});i.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.pomodorosCompleted.toString()}),i.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Pomodoros"});let s=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});s.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.currentStreak.toString()}),s.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Streak"});let a=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});a.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.totalMinutes.toString()}),a.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Minutes"});let o=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});o.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.averageSessionLength.toString()}),o.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Avg Length"});let l=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});l.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:`${r.completionRate}%`}),l.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Completion"})}async calculateStatsForRange(e,r){let i=await this.plugin.pomodoroService.getSessionHistory(),s=We(e),a=We(r),o=i.filter(l=>{try{let c=Ru(l.startTime),d=We(c);return d>=s&&d<=a}catch(c){return console.error("Error parsing session timestamp for filtering:",{sessionStartTime:l.startTime,error:c}),!1}});return this.calculateStatsFromSessions(o)}calculateOverallStats(e){return this.calculateStatsFromSessions(e)}calculateStatsFromSessions(e){let r=e.filter(c=>c.type==="work"),i=r.filter(c=>c.completed),s=0;for(let c=r.length-1;c>=0&&r[c].completed;c--)s++;let a=i.reduce((c,d)=>c+cl(d),0),o=i.length>0?a/i.length:0,l=r.length>0?i.length/r.length*100:0;return{pomodorosCompleted:i.length,currentStreak:s,totalMinutes:a,averageSessionLength:Math.round(o),completionRate:Math.round(l)}}};var nn=require("obsidian");ui();var dl=class extends nn.ItemView{constructor(e,r){super(e);this.boardContainer=null;this.filterBar=null;this.taskElements=new Map;this.previousGroupKey=null;this.listeners=[];this.functionListeners=[];this.columnOrder=[];this.debouncedRefresh=(0,nn.debounce)(()=>{this.refresh()},150);this.plugin=r,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"priority",sortDirection:"desc",groupKey:"status"},this.previousGroupKey=this.currentQuery.groupKey||null,this.registerEvents()}getViewType(){return ir}getDisplayText(){return"Kanban"}getIcon(){return"layout-grid"}registerEvents(){this.listeners.forEach(s=>this.plugin.emitter.offref(s)),this.listeners=[],this.functionListeners.forEach(s=>s()),this.functionListeners=[];let e=this.plugin.emitter.on(it,async()=>{if(this.refresh(),this.filterBar){let s=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(s)}});this.listeners.push(e);let r=this.plugin.emitter.on(xe,async({path:s,originalTask:a,updatedTask:o})=>{if(!s||!o)return;let l=this.taskElements.get(s);if(l)try{Nr(l,o,this.plugin,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0}),l.classList.add("task-card--updated"),window.setTimeout(()=>{l.classList.remove("task-card--updated")},1e3)}catch(c){console.error("Error updating task card in kanban:",c),this.refresh()}else this.refresh();if(this.filterBar){let c=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(c)}});this.listeners.push(r);let i=this.plugin.filterService.on("data-changed",()=>{this.refresh()});this.functionListeners.push(i)}async onOpen(){await this.plugin.onReady(),await this.plugin.waitForMigration();let e=this.plugin.viewStateManager.getFilterState(ir);e&&(this.currentQuery=e,this.previousGroupKey=this.currentQuery.groupKey||null),this.loadColumnOrder(),this.contentEl.empty(),await this.render()}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.functionListeners.forEach(e=>e()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.contentEl.empty()}async refresh(){this.boardContainer?await this.loadAndRenderBoard():await this.render()}async render(){let e=this.contentEl;e.empty(),e.addClass("tasknotes-plugin","kanban-view"),await this.renderHeader(e),this.boardContainer=e.createDiv({cls:"kanban-view__board-container"}),await this.loadAndRenderBoard()}async renderHeader(e){let r=e.createDiv({cls:"kanban-view__header"}),i=r.createDiv({cls:"kanban-view__filter-container"});this.currentQuery=this.plugin.filterService.createDefaultQuery(),this.currentQuery.sortKey="priority",this.currentQuery.sortDirection="desc",this.currentQuery.groupKey="status";let s=this.plugin.viewStateManager.getFilterState(ir);s&&(this.currentQuery=s);let a=await this.plugin.filterService.getFilterOptions();this.filterBar=new Xt(this.app,i,this.currentQuery,a);let o=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(o),this.filterBar.on("saveView",({name:f,query:p,viewOptions:m})=>{this.plugin.viewStateManager.saveView(f,p,m)}),this.filterBar.on("deleteView",f=>{this.plugin.viewStateManager.deleteView(f)}),this.plugin.viewStateManager.on("saved-views-changed",f=>{var p;(p=this.filterBar)==null||p.updateSavedViews(f)}),this.filterBar.on("reorderViews",(f,p)=>{this.plugin.viewStateManager.reorderSavedViews(f,p)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async f=>{this.currentQuery=f,await this.plugin.viewStateManager.setFilterState(ir,f),this.loadAndRenderBoard()});let l=r.createDiv({cls:"kanban-view__actions"});l.createDiv({cls:"kanban-view__actions-left"}).createEl("button",{cls:"kanban-view__new-task-button",text:"New task"}).addEventListener("click",()=>{this.plugin.openTaskCreationModal()});let h=l.createDiv({cls:"kanban-view__actions-right"}).createDiv({cls:"kanban-view__stats"});this.updateBoardStats(h)}updateBoardStats(e,r){if(e.empty(),!r||r.length===0)return;let i=r.length,s=r.filter(a=>this.plugin.statusManager.isCompletedStatus(a.status)).length;if(i>0){let a=Math.round(s/i*100);e.createSpan({text:`${i} tasks \u2022 ${a}% complete`,cls:"kanban-view__stats-simple"})}}async loadAndRenderBoard(){if(!this.boardContainer)return;let e=this.currentQuery.groupKey||null;this.previousGroupKey!==null&&this.previousGroupKey!==e&&(this.boardContainer.empty(),this.columnOrder=[]),this.previousGroupKey=e;let r=null;this.boardContainer.children.length===0&&(r=this.boardContainer.createDiv({cls:"kanban-view__loading",text:"Loading board..."}));try{let i=await this.plugin.filterService.getGroupedTasks(this.currentQuery,this.plugin.selectedDate);r&&r.remove(),this.renderBoardFromGroupedTasksWithReconciler(i);let s=Array.from(i.values()).flat(),a=this.contentEl.querySelector(".kanban-view__stats");a&&this.updateBoardStats(a,s)}catch(i){console.error("Error loading Kanban board:",i),new nn.Notice("Failed to load Kanban board. See console for details."),r&&r.remove(),this.boardContainer.empty(),this.boardContainer.createDiv({cls:"kanban-view__error",text:"Error loading board."})}}renderBoardFromGroupedTasks(e){if(!this.boardContainer)return;this.boardContainer.empty(),this.taskElements.clear();let r=Array.from(e.keys()).sort();this.columnOrder.length===0&&(this.columnOrder=[...r],this.columnOrder.length>0&&this.saveColumnOrder()),this.renderBoardFromGroupedTasksWithOrder(e)}renderColumn(e,r,i){let s=e.createDiv({cls:"kanban-view__column"});s.dataset.columnId=r,r==="uncategorized"&&s.addClass("kanban-view__column--uncategorized");let a=s.createDiv({cls:"kanban-view__column-header"});a.draggable=!0,a.dataset.columnId=r,this.addColumnDragHandlers(a);let o=this.formatColumnTitle(r,this.currentQuery.groupKey||"none");a.createEl("div",{text:o,cls:"kanban-view__column-title"}),a.createEl("div",{text:`${i.length} tasks`,cls:"kanban-view__column-count"});let l=s.createDiv({cls:"kanban-view__column-body"});if(i.length===0){let d=l.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(d)}else i.forEach(d=>{let u=Bt(d,this.plugin,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});u.draggable=!0,this.addDragHandlers(u,d),l.appendChild(u),this.taskElements.set(d.path,u)});l.createEl("button",{cls:"kanban-view__add-card-button",text:"+ Add a card"}).addEventListener("click",()=>{this.openTaskCreationModalForColumn(r)}),this.addColumnDropHandlers(s)}addColumnDragHandlers(e){e.addEventListener("dragstart",r=>{if(r.dataTransfer){let i=e.dataset.columnId;i&&(r.dataTransfer.setData("text/plain",`column:${i}`),r.dataTransfer.effectAllowed="move")}e.classList.add("kanban-view__column-header--dragging")}),e.addEventListener("dragend",()=>{e.classList.remove("kanban-view__column-header--dragging")})}loadColumnOrder(){let e=this.plugin.viewStateManager.getViewPreferences(ir);e!=null&&e.columnOrder&&(this.columnOrder=[...e.columnOrder])}saveColumnOrder(){let e=this.plugin.viewStateManager.getViewPreferences(ir)||{};e.columnOrder=[...this.columnOrder],this.plugin.viewStateManager.setViewPreferences(ir,e)}async reorderColumns(e,r){var o;if(this.columnOrder.length===0){let l=(o=this.boardContainer)==null?void 0:o.querySelectorAll(".kanban-view__column");this.columnOrder=Array.from(l||[]).map(c=>c.dataset.columnId||"").filter(c=>c)}let i=this.columnOrder.indexOf(e),s=this.columnOrder.indexOf(r);if(i===-1||s===-1)return;let[a]=this.columnOrder.splice(i,1);this.columnOrder.splice(s,0,a),this.saveColumnOrder(),this.renderBoardWithOrder()}async renderBoardWithOrder(){if(this.boardContainer)try{let e=await this.plugin.filterService.getGroupedTasks(this.currentQuery,this.plugin.selectedDate);this.renderBoardFromGroupedTasksWithReconciler(e);let r=Array.from(e.values()).flat(),i=this.contentEl.querySelector(".kanban-view__stats");i&&this.updateBoardStats(i,r)}catch(e){console.error("Error reordering Kanban board:",e),this.refresh()}}renderBoardFromGroupedTasksWithOrder(e){if(!this.boardContainer)return;let r=this.boardContainer.querySelector(".kanban-view__board");r?r.empty():r=this.boardContainer.createDiv({cls:"kanban-view__board"}),this.taskElements.clear(),this.columnOrder.forEach(l=>{if(e.has(l)){let c=e.get(l)||[];this.renderColumn(r,l,c)}});let i=Array.from(e.keys()),s=i;if(this.currentQuery.groupKey==="status"){let l=this.plugin.statusManager.getAllStatuses().map(c=>c.value);s=[...new Set([...i,...l])]}let a=!1,o=this.columnOrder.length;this.columnOrder=this.columnOrder.filter(l=>s.includes(l)),this.columnOrder.length!==o&&(a=!0),s.forEach(l=>{if(!this.columnOrder.includes(l)){this.columnOrder.push(l),a=!0;let c=e.get(l)||[];this.renderColumn(r,l,c)}}),a&&this.saveColumnOrder()}addDragHandlers(e,r){e.addEventListener("dragstart",i=>{i.dataTransfer&&(i.dataTransfer.setData("text/plain",r.path),i.dataTransfer.effectAllowed="move"),window.setTimeout(()=>e.classList.add("task-card--dragging"),0)}),e.addEventListener("dragend",()=>{e.classList.remove("task-card--dragging")})}addColumnDropHandlers(e){e.addEventListener("dragover",r=>{var i;r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move",((i=this.boardContainer)==null?void 0:i.querySelector(".kanban-view__column-header--dragging"))?e.classList.add("kanban-view__column--column-drop-target"):e.classList.add("kanban-view__column--dragover"))}),e.addEventListener("dragleave",r=>{e.contains(r.relatedTarget)||(e.classList.remove("kanban-view__column--dragover"),e.classList.remove("kanban-view__column--column-drop-target"))}),e.addEventListener("drop",async r=>{var o,l;r.preventDefault(),r.stopPropagation(),(o=this.boardContainer)==null||o.querySelectorAll(".kanban-view__column--dragover, .kanban-view__column--column-drop-target").forEach(c=>{c.classList.remove("kanban-view__column--dragover","kanban-view__column--column-drop-target")});let i=(l=r.dataTransfer)==null?void 0:l.getData("text/plain");if(i!=null&&i.startsWith("column:")){let c=i.replace("column:",""),d=e.dataset.columnId;c&&d&&c!==d&&await this.reorderColumns(c,d);return}let s=i,a=e.dataset.columnId;if(!a){let c=r.target.closest(".kanban-view__column");a=(c==null?void 0:c.getAttribute("data-column-id"))||void 0}if(s&&a&&a!=="uncategorized"){let c=await this.plugin.cacheManager.getCachedTaskInfo(s);if(c)try{let d,u;switch(this.currentQuery.groupKey){case"status":d="status",u=a;break;case"priority":d="priority",u=a;break;case"context":d="contexts",u=[a];break;case"project":d="projects",u=a==="No Project"?[]:[a];break;default:throw new Error(`Unsupported groupBy: ${this.currentQuery.groupKey}`)}await this.plugin.updateTaskProperty(c,d,u,{silent:!0}),new nn.Notice(`Task moved to "${this.formatColumnTitle(a,this.currentQuery.groupKey)}"`)}catch(d){console.error("Failed to move task:",d),new nn.Notice("Failed to move task"),this.refresh()}}})}renderBoardFromGroupedTasksWithReconciler(e){if(!this.boardContainer)return;let r=this.boardContainer.querySelector(".kanban-view__board");r||(r=this.boardContainer.createDiv({cls:"kanban-view__board"}));let i=Array.from(e.keys()),s=i;if(this.currentQuery.groupKey==="status"){let d=this.plugin.statusManager.getAllStatuses().map(u=>u.value);s=[...new Set([...i,...d])]}s=s.sort(),this.columnOrder.length===0&&(this.columnOrder=[...s],this.columnOrder.length>0&&this.saveColumnOrder());let a=!1,o=this.columnOrder.length;this.columnOrder=this.columnOrder.filter(d=>s.includes(d)),this.columnOrder.length!==o&&(a=!0),s.forEach(d=>{this.columnOrder.includes(d)||(this.columnOrder.push(d),a=!0)}),a&&this.saveColumnOrder();let l=this.columnOrder.map(d=>({id:d,tasks:e.get(d)||[]}));this.plugin.domReconciler.updateList(r,l,d=>d.id,d=>this.createColumnElement(d.id,d.tasks),(d,u)=>this.updateColumnElement(d,u.id,u.tasks)),this.taskElements.clear(),r.querySelectorAll(".task-card[data-task-path]").forEach(d=>{let u=d.dataset.taskPath;u&&this.taskElements.set(u,d)})}createColumnElement(e,r){let i=document.createElement("div");i.className="kanban-view__column",i.dataset.columnId=e,e==="uncategorized"&&i.classList.add("kanban-view__column--uncategorized");let s=i.createDiv({cls:"kanban-view__column-header"});s.draggable=!0,s.dataset.columnId=e,this.addColumnDragHandlers(s);let a=this.formatColumnTitle(e,this.currentQuery.groupKey||"none");s.createEl("div",{text:a,cls:"kanban-view__column-title"}),s.createEl("div",{text:`${r.length} tasks`,cls:"kanban-view__column-count"});let o=i.createDiv({cls:"kanban-view__column-body"}),l=o.createDiv({cls:"kanban-view__tasks-container"});if(r.length===0){let d=l.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(d)}else this.plugin.domReconciler.updateList(l,r,d=>d.path,d=>this.createTaskCardElement(d),(d,u)=>this.updateTaskCardElement(d,u));return o.createEl("button",{cls:"kanban-view__add-card-button",text:"+ Add a card"}).addEventListener("click",()=>{this.openTaskCreationModalForColumn(e)}),this.addColumnDropHandlers(i),i}updateColumnElement(e,r,i){let s=e.querySelector(".kanban-view__column-count");s&&(s.textContent=`${i.length} tasks`);let a=e.querySelector(".kanban-view__column-body");if(a){let o=a.querySelector(".kanban-view__add-card-button"),l=a.querySelector(".kanban-view__tasks-container");if(l||(l=a.createDiv({cls:"kanban-view__tasks-container"}),o?a.insertBefore(l,o):a.appendChild(l)),i.length===0){l.empty();let c=l.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(c)}else{let c=l.querySelector(".kanban-view__column-empty");c&&c.remove(),this.plugin.domReconciler.updateList(l,i,d=>d.path,d=>this.createTaskCardElement(d),(d,u)=>this.updateTaskCardElement(d,u))}}}createTaskCardElement(e){let r=Bt(e,this.plugin,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});return r.draggable=!0,this.addDragHandlers(r,e),this.taskElements.set(e.path,r),r}updateTaskCardElement(e,r){Nr(e,r,this.plugin,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0}),this.taskElements.set(r.path,e)}formatColumnTitle(e,r){var i,s;switch(r){case"status":return((i=this.plugin.statusManager.getStatusConfig(e))==null?void 0:i.label)||e;case"priority":return((s=this.plugin.priorityManager.getPriorityConfig(e))==null?void 0:s.label)||e;case"context":return e==="uncategorized"?"Uncategorized":`@${e}`;case"project":return e==="No Project"?"No Project":`+${e}`;case"due":return e;case"none":default:return e}}openTaskCreationModalForColumn(e){let r={};switch(this.currentQuery.groupKey){case"status":e!=="uncategorized"&&(r.status=e);break;case"priority":e!=="uncategorized"&&(r.priority=e);break;case"context":e!=="uncategorized"&&(r.contexts=[e]);break;case"project":e!=="No Project"&&(r.projects=[e]);break}this.plugin.openTaskCreationModal(r)}};var pr=require("obsidian");je();var _t=Ve(Yt());we();var Ld=class{constructor(t){this.timerWorker=null;this.activeAudioContexts=new Set;this.cleanupTimeouts=new Set;this.plugin=t,this.state={isRunning:!1,timeRemaining:t.settings.pomodoroWorkDuration*60}}async initialize(){await this.loadState(),this.setupWorker(),this.state.isRunning&&this.state.currentSession&&this.resumeTimer()}setupWorker(){let t=new Blob([KT],{type:"application/javascript"}),e=URL.createObjectURL(t);this.timerWorker=new Worker(e),this.timerWorker.onmessage=r=>{r.data.type==="done"&&this.completePomodoro(),r.data.type==="tick"&&(this.state.timeRemaining=r.data.timeRemaining,this.plugin.emitter.trigger(nr,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}}async loadState(){try{let t=await this.plugin.loadData();if(t!=null&&t.pomodoroState){this.state=t.pomodoroState,this.state.timeRemaining=Math.max(0,this.state.timeRemaining||0);let e=I(new Date,"yyyy-MM-dd");if(t.lastPomodoroDate!==e&&this.state.currentSession&&(this.state.currentSession=void 0,this.state.isRunning=!1),this.state.currentSession){let i=new Date(this.state.currentSession.startTime).getTime();(Date.now()-i)/(1e3*60*60)>24&&(this.state.currentSession=void 0,this.state.isRunning=!1,this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60)}this.state.currentSession||(this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60)}}catch(t){console.error("Failed to load pomodoro state:",t),this.state={isRunning:!1,timeRemaining:this.plugin.settings.pomodoroWorkDuration*60}}}async saveState(){try{let t=await this.plugin.loadData()||{};t.pomodoroState=this.state,t.lastPomodoroDate=I(new Date,"yyyy-MM-dd"),await this.plugin.saveData(t)}catch(t){console.error("Failed to save pomodoro state:",t)}}async saveLastSelectedTask(t){try{let e=await this.plugin.loadData()||{};e.lastSelectedTaskPath=t,await this.plugin.saveData(e)}catch(e){console.error("Failed to save last selected task:",e)}}async getLastSelectedTaskPath(){try{let t=await this.plugin.loadData();return t==null?void 0:t.lastSelectedTaskPath}catch(t){console.error("Failed to load last selected task:",t);return}}async startPomodoro(t){var a;if(this.state.isRunning){new pr.Notice("A pomodoro is already running");return}if(this.state.currentSession&&!this.state.isRunning){new pr.Notice("Resume the current session instead of starting a new one");return}let e=Math.max(1,Math.min(120*60,this.state.timeRemaining)),r=e/60;console.log("Starting pomodoro with planned duration:",r,"minutes");let i=ce(),s={id:Date.now().toString(),taskPath:t==null?void 0:t.path,startTime:i,plannedDuration:r,type:"work",completed:!1,activePeriods:[{startTime:i}]};if(this.state.currentSession=s,this.state.isRunning=!0,this.state.timeRemaining=e,this.state.nextSessionType=void 0,await this.saveState(),this.startTimer(),t)try{await this.plugin.taskService.startTimeTracking(t)}catch(o){(a=o.message)!=null&&a.includes("Time tracking is already active")||console.error("Failed to start time tracking for Pomodoro:",o)}this.plugin.emitter.trigger(Pl,{session:s,task:t}),new Notification(`Pomodoro started${t?` for: ${t.title}`:""}`)}async startBreak(t=!1){if(this.state.isRunning){new pr.Notice("A timer is already running");return}if(this.state.currentSession&&!this.state.isRunning){new pr.Notice("Resume the current session instead of starting a new one");return}let e=t?Math.max(1,Math.min(60,this.plugin.settings.pomodoroLongBreakDuration)):Math.max(1,Math.min(30,this.plugin.settings.pomodoroShortBreakDuration)),r=ce(),i={id:Date.now().toString(),startTime:r,plannedDuration:e,type:t?"long-break":"short-break",completed:!1,activePeriods:[{startTime:r}]};this.state.currentSession=i,this.state.isRunning=!0,this.state.timeRemaining=i.plannedDuration*60,this.state.nextSessionType=void 0,await this.saveState(),this.startTimer(),new pr.Notice(`${t?"Long":"Short"} break started`)}async pausePomodoro(){if(this.state.isRunning){if(this.stopTimer(),this.state.isRunning=!1,this.state.currentSession&&this.state.currentSession.activePeriods.length>0){let t=this.state.currentSession.activePeriods[this.state.currentSession.activePeriods.length-1];t.endTime||(t.endTime=ce())}if(this.state.currentSession&&this.state.currentSession.taskPath)try{let t=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);t&&await this.plugin.taskService.stopTimeTracking(t)}catch(t){console.error("Failed to stop time tracking for Pomodoro pause:",t)}await this.saveState(),this.plugin.emitter.trigger(nr,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),new pr.Notice("Pomodoro paused")}}async resumePomodoro(){var t;if(!(this.state.isRunning||!this.state.currentSession)){if(this.state.isRunning=!0,this.state.currentSession&&this.state.currentSession.activePeriods.push({startTime:ce()}),await this.saveState(),this.startTimer(),this.state.currentSession&&this.state.currentSession.taskPath)try{let e=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);e&&await this.plugin.taskService.startTimeTracking(e)}catch(e){(t=e.message)!=null&&t.includes("Time tracking is already active")||console.error("Failed to start time tracking for Pomodoro resume:",e)}this.plugin.emitter.trigger(nr,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),new pr.Notice("Pomodoro resumed")}}async stopPomodoro(){if(!this.state.currentSession)return;let t=this.state.isRunning;if(this.stopTimer(),this.state.currentSession){if(this.state.currentSession.interrupted=!0,this.state.currentSession.endTime=ce(),this.state.currentSession.activePeriods.length>0){let e=this.state.currentSession.activePeriods[this.state.currentSession.activePeriods.length-1];e.endTime||(e.endTime=ce())}await this.addSessionToHistory(this.state.currentSession)}if(this.plugin.emitter.trigger(Ol,{session:this.state.currentSession}),this.state.currentSession&&this.state.currentSession.taskPath&&t)try{let e=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);e&&await this.plugin.taskService.stopTimeTracking(e)}catch(e){console.error("Failed to stop time tracking for Pomodoro interrupt:",e)}this.state.currentSession=void 0,this.state.isRunning=!1,this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60,await this.saveState(),this.plugin.emitter.trigger(nr,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),t&&new pr.Notice("Pomodoro stopped and reset")}startTimer(){this.timerWorker&&this.timerWorker.postMessage({command:"start",duration:this.state.timeRemaining})}stopTimer(){this.timerWorker&&this.timerWorker.postMessage({command:"stop"})}resumeTimer(){if(this.state.currentSession&&this.state.currentSession.startTime){let t=new Date(this.state.currentSession.startTime).getTime(),e=Date.now();if(t>e){this.stopPomodoro();return}let r=this.state.currentSession.plannedDuration*60;if(!this.state.isRunning&&this.state.timeRemaining>0)this.state.timeRemaining=Math.min(this.state.timeRemaining,r);else if(this.state.isRunning){let i=this.state.currentSession.activePeriods||[],s=0;for(let a of i){let o=new Date(a.startTime).getTime(),l=a.endTime?new Date(a.endTime).getTime():e;s+=Math.floor((l-o)/1e3)}this.state.timeRemaining=Math.max(0,r-s)}this.state.timeRemaining>0&&this.state.isRunning?this.startTimer():this.state.timeRemaining<=0&&this.completePomodoro()}}async completePomodoro(){if(this.stopTimer(),!this.state.currentSession)return;let t=this.state.currentSession;if(t.completed=!0,t.endTime=ce(),t.activePeriods.length>0){let r=t.activePeriods[t.activePeriods.length-1];r.endTime||(r.endTime=ce())}if(t.type==="work"&&this.state.isRunning&&t.taskPath)try{let r=await this.plugin.cacheManager.getTaskInfo(t.taskPath);r&&await this.plugin.taskService.stopTimeTracking(r)}catch(r){console.error("Failed to stop time tracking for Pomodoro completion:",r)}let e=!1;if(t.type==="work")try{e=((await this.getTodayStats()).pomodorosCompleted+1)%this.plugin.settings.pomodoroLongBreakInterval===0}catch(r){console.error("Failed to calculate break type:",r),e=!1}if(await this.addSessionToHistory(t),this.plugin.emitter.trigger(Nl,{session:t,nextType:t.type==="work"?e?"long-break":"short-break":"work"}),this.plugin.settings.pomodoroNotifications){let r=t.type==="work"?"\u{1F345} Pomodoro completed!":"\u2615 Break completed!",i=t.type==="work"?`Time for a ${e?"long break \u{1F4A4}":"short break \u2615"}`:"Ready for the next pomodoro?";new Notification(r,{body:i})}if(this.plugin.settings.pomodoroSoundEnabled&&this.playCompletionSound(),this.state.currentSession=void 0,this.state.isRunning=!1,t.type==="work"){let r=e?this.plugin.settings.pomodoroLongBreakDuration:this.plugin.settings.pomodoroShortBreakDuration;if(this.state.timeRemaining=r*60,this.state.nextSessionType=e?"long-break":"short-break",this.plugin.settings.pomodoroAutoStartBreaks){let i=setTimeout(()=>this.startBreak(e),1e3);this.cleanupTimeouts.add(i)}}else if(this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60,this.state.nextSessionType="work",this.plugin.settings.pomodoroAutoStartWork){let r=setTimeout(()=>this.startPomodoro(),1e3);this.cleanupTimeouts.add(r)}await this.saveState(),this.plugin.emitter.trigger(nr,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession})}playCompletionSound(){try{let t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),r=t.createGain();e.connect(r),r.connect(t.destination);let i=Math.max(0,Math.min(1,this.plugin.settings.pomodoroSoundVolume/100));r.gain.value=i*.3,e.frequency.value=800,e.type="sine",e.start(),e.stop(t.currentTime+.1),this.activeAudioContexts.add(t);let s=setTimeout(()=>{try{let o=t.createOscillator();o.connect(r),o.frequency.value=1e3,o.type="sine",o.start(),o.stop(t.currentTime+.1)}catch(o){console.error("Failed to play second beep:",o)}},150);this.cleanupTimeouts.add(s);let a=setTimeout(()=>{this.activeAudioContexts.delete(t),t.close().catch(()=>{})},300);this.cleanupTimeouts.add(a)}catch(t){console.error("Failed to play completion sound:",t)}}getState(){return{...this.state}}adjustSessionTime(t){if(this.state.currentSession){this.stopTimer(),this.state.timeRemaining=Math.max(1,this.state.timeRemaining+t);let e=this.state.currentSession.activePeriods||[],r=0;for(let s of e)if(s.endTime){let a=new Date(s.startTime).getTime(),o=new Date(s.endTime).getTime();r+=Math.floor((o-a)/1e3)}else if(this.state.isRunning){let a=new Date(s.startTime).getTime(),o=Date.now();r+=Math.floor((o-a)/1e3)}let i=r+this.state.timeRemaining;this.state.currentSession.plannedDuration=Math.ceil(i/60),this.saveState(),this.startTimer(),this.plugin.emitter.trigger(nr,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession})}}adjustPreparedTimer(t){this.state.currentSession||(this.stopTimer(),this.state.timeRemaining=Math.max(1,t),this.saveState(),console.log("Adjusted prepared timer to:",this.state.timeRemaining,"seconds"),this.plugin.emitter.trigger(nr,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}isRunning(){return this.state.isRunning}getCurrentSession(){return this.state.currentSession}getTimeRemaining(){return this.state.timeRemaining}async getPomodorosCompleted(){return(await this.getTodayStats()).pomodorosCompleted}async getCurrentStreak(){return(await this.getTodayStats()).currentStreak}async getTotalMinutesToday(){return(await this.getTodayStats()).totalMinutes}async assignTaskToCurrentSession(t){this.state.currentSession&&(this.state.currentSession.taskPath=t==null?void 0:t.path,await this.saveState(),this.plugin.emitter.trigger(nr,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}async getSessionHistory(){try{let t=[],e=await this.plugin.loadData(),r=(e==null?void 0:e.pomodoroHistory)||[];if(this.plugin.settings.pomodoroStorageLocation==="daily-notes"){let i=await this.loadHistoryFromDailyNotes();t=i,r.length>0&&(t=this.mergeHistories(r,i))}else t=r;return t.sort((i,s)=>new Date(i.startTime).getTime()-new Date(s.startTime).getTime())}catch(t){return console.error("Failed to load session history:",t),[]}}async saveSessionHistory(t){try{if(this.plugin.settings.pomodoroStorageLocation==="daily-notes")await this.saveHistoryToDailyNotes(t);else{let e=await this.plugin.loadData()||{};e.pomodoroHistory=t,await this.plugin.saveData(e)}}catch(e){console.error("Failed to save session history:",e)}}async addSessionToHistory(t){if(!t.endTime){console.warn("Cannot add session to history without end time");return}let e={id:t.id,startTime:t.startTime,endTime:t.endTime,plannedDuration:t.plannedDuration,type:t.type,taskPath:t.taskPath,completed:t.completed&&!t.interrupted,activePeriods:t.activePeriods.slice()};try{if(this.plugin.settings.pomodoroStorageLocation==="daily-notes")await this.addSingleSessionToDailyNote(e);else{let r=await this.getSessionHistory();r.push(e),await this.saveSessionHistory(r)}}catch(r){console.error("Failed to add session to history:",r)}}async getStatsForDate(t){let e=I(t,"yyyy-MM-dd"),s=(await this.getSessionHistory()).filter(u=>I(new Date(u.startTime),"yyyy-MM-dd")===e).filter(u=>u.type==="work"),a=s.filter(u=>u.completed),o=0;for(let u=s.length-1;u>=0&&s[u].completed;u--)o++;let l=a.reduce((u,h)=>u+cl(h),0),c=a.length>0?l/a.length:0,d=s.length>0?a.length/s.length*100:0;return{pomodorosCompleted:a.length,currentStreak:o,totalMinutes:l,averageSessionLength:Math.round(c),completionRate:Math.round(d)}}async getTodayStats(){return this.getStatsForDate(new Date)}cleanup(){this.stopTimer(),this.timerWorker&&(this.timerWorker.terminate(),this.timerWorker=null);for(let t of this.cleanupTimeouts)clearTimeout(t);this.cleanupTimeouts.clear();for(let t of this.activeAudioContexts)t.state!=="closed"&&t.close().catch(()=>{});this.activeAudioContexts.clear(),this.saveState()}async saveHistoryToDailyNotes(t){try{if(!(0,_t.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes core plugin is not enabled");let e=this.groupSessionsByDate(t);for(let[r,i]of e)await this.updateDailyNotePomodoros(r,i)}catch(e){throw console.error("Failed to save history to daily notes:",e),e}}async loadHistoryFromDailyNotes(){try{if(!(0,_t.appHasDailyNotesPluginLoaded)())return[];let t=[],e=(0,_t.getAllDailyNotes)(),r=this.plugin.fieldMapper.toUserField("pomodoros");for(let[,i]of Object.entries(e))try{let s=this.plugin.app.metadataCache.getFileCache(i),a=s==null?void 0:s.frontmatter;if(a&&a[r]){let o=a[r];Array.isArray(o)&&t.push(...o)}}catch(s){console.warn(`Failed to read pomodoro data from daily note ${i.path}:`,s)}return t}catch(t){return console.error("Failed to load history from daily notes:",t),[]}}groupSessionsByDate(t){let e=new Map;for(let r of t){let i=new Date(r.startTime),s=I(i,"yyyy-MM-dd");e.has(s)||e.set(s,[]),e.get(s).push(r)}return e}async addSingleSessionToDailyNote(t){try{let e=new Date(t.startTime),r=window.moment(e),i=(0,_t.getAllDailyNotes)(),s=(0,_t.getDailyNote)(r,i);s||(s=await(0,_t.createDailyNote)(r));let a=this.plugin.fieldMapper.toUserField("pomodoros");await this.plugin.app.fileManager.processFrontMatter(s,o=>{let l=o[a]||[];new Set(l.map(d=>d.id)).has(t.id)||(o[a]=[...l,t])})}catch(e){console.error("Failed to add session to daily note:",e)}}async updateDailyNotePomodoros(t,e){try{let r=new Date(t+"T12:00:00"),i=window.moment(r),s=(0,_t.getAllDailyNotes)(),a=(0,_t.getDailyNote)(i,s);a||(a=await(0,_t.createDailyNote)(i));let o=this.plugin.fieldMapper.toUserField("pomodoros");await this.plugin.app.fileManager.processFrontMatter(a,l=>{let c=l[o]||[],d=new Set(c.map(h=>h.id)),u=e.filter(h=>!d.has(h.id));u.length>0&&(l[o]=[...c,...u])})}catch(r){console.error(`Failed to update daily note for ${t}:`,r)}}mergeHistories(t,e){let r=[...e],i=new Set(e.map(s=>s.id));for(let s of t)i.has(s.id)||r.push(s);return r}async migrateTodailyNotes(){try{if(!(0,_t.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes core plugin must be enabled for migration");let t=await this.plugin.loadData(),e=(t==null?void 0:t.pomodoroHistory)||[];if(e.length===0)return;await this.saveHistoryToDailyNotes(e),t.pomodoroHistory=[],await this.plugin.saveData(t),new pr.Notice(`Successfully migrated ${e.length} pomodoro sessions to daily notes.`)}catch(t){throw console.error("Failed to migrate pomodoro data to daily notes:",t),new pr.Notice("Failed to migrate pomodoro data. Please try again or check the console for details."),t}}};at();var er=require("obsidian");we();at();var Fd=class extends er.Events{constructor(e,r,i="",s,a=!1,o=!1){super();this.tasksByDate=new Map;this.tasksByStatus=new Map;this.overdueTasks=new Set;this.initialized=!1;this.indexesBuilt=!1;this.eventListeners=[];this.app=e,this.taskTag=r,this.excludedFolders=i?i.split(",").map(l=>l.trim()):[],this.fieldMapper=s,this.disableNoteIndexing=a,this.storeTitleInFilename=o}initialize(){this.initialized||(this.setupNativeEventListeners(),this.initialized=!0,this.trigger("cache-initialized",{message:"Minimal native cache ready"}))}getApp(){return this.app}setupNativeEventListeners(){this.eventListeners.push(this.app.metadataCache.on("changed",(e,r,i)=>{e instanceof er.TFile&&e.extension==="md"&&this.isValidFile(e.path)&&this.handleFileChanged(e,i)})),this.eventListeners.push(this.app.metadataCache.on("deleted",(e,r)=>{e instanceof er.TFile&&e.extension==="md"&&this.handleFileDeleted(e.path)})),this.eventListeners.push(this.app.vault.on("rename",(e,r)=>{e instanceof er.TFile&&e.extension==="md"&&this.handleFileRenamed(e,r)}))}ensureIndexesBuilt(){this.indexesBuilt||(this.indexesBuilt=!0,window.setTimeout(()=>this.buildEssentialIndexes(),1))}async buildEssentialIndexes(){var e,r;try{let i=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path)),s=50;for(let a=0;a<i.length;a+=s){let o=i.slice(a,a+s);for(let l of o)try{let c=this.app.metadataCache.getFileCache(l);(r=(e=c==null?void 0:c.frontmatter)==null?void 0:e.tags)!=null&&r.includes(this.taskTag)&&await this.indexTaskFile(l,c.frontmatter)}catch(c){console.error(`Error indexing file ${l.path}:`,c)}await new Promise(l=>window.setTimeout(l,1))}this.trigger("indexes-built",{tasksByDate:this.tasksByDate.size,tasksByStatus:this.tasksByStatus.size,overdueTasks:this.overdueTasks.size})}catch(i){console.error("Error building essential indexes:",i)}}async indexTaskFile(e,r){if(this.fieldMapper)try{let i=this.extractTaskInfoFromNative(e.path,r);if(!i)return;this.updateDateIndex(e.path,i),this.updateStatusIndex(e.path,i.status),this.updateOverdueIndex(e.path,i)}catch(i){console.error(`Error indexing task ${e.path}:`,i)}}async getTaskInfo(e){let r=this.app.vault.getAbstractFileByPath(e);if(!(r instanceof er.TFile))return null;let i=this.app.metadataCache.getFileCache(r);return i!=null&&i.frontmatter?this.extractTaskInfoFromNative(e,i.frontmatter):null}async getAllTasks(){var i,s;let e=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path)),r=[];for(let a of e){let o=this.app.metadataCache.getFileCache(a);if((s=(i=o==null?void 0:o.frontmatter)==null?void 0:i.tags)!=null&&s.includes(this.taskTag)){let l=this.extractTaskInfoFromNative(a.path,o.frontmatter);l&&r.push(l)}}return r}getTasksForDate(e){this.ensureIndexesBuilt();let r=this.tasksByDate.get(e)||new Set;return Array.from(r)}getTaskPathsByStatus(e){this.ensureIndexesBuilt();let r=this.tasksByStatus.get(e)||new Set;return Array.from(r)}getOverdueTaskPaths(){return this.ensureIndexesBuilt(),new Set(this.overdueTasks)}async getCalendarData(e,r){var c;let i=new Map,s=new Map,a=new Set,o=this.app.vault.getMarkdownFiles().filter(d=>this.isValidFile(d.path));try{let{getAllDailyNotes:d}=Yt(),u=d();for(let[h]of Object.entries(u))a.add(h)}catch(d){}for(let d of o){let u=this.app.metadataCache.getFileCache(d);if(!(u!=null&&u.frontmatter))continue;let h=u.frontmatter;if(!((c=h.tags)==null?void 0:c.includes(this.taskTag))&&!this.disableNoteIndexing){let p=null;if(h.dateCreated||h.date){let m=h.dateCreated||h.date;try{let g=new Date(m);isNaN(g.getTime())||(p=g.toISOString().split("T")[0])}catch(g){}}if(!p){let g=d.basename.match(/(\d{4}-\d{2}-\d{2})/);g&&(p=g[1],a.add(p))}if(p){let m=s.get(p)||0;s.set(p,m+1)}}}let l=new Date(e,r+1,0).getDate();for(let d=1;d<=l;d++){let u=`${e}-${String(r+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`,h=this.getTasksForDate(u);if(h.length>0){let p=(await Promise.all(h.map(m=>this.getTaskInfo(m)))).filter(m=>m!==null);if(p.length>0){let m={count:p.length,hasDue:p.some(g=>g.due&&!g.scheduled),hasScheduled:p.some(g=>g.scheduled),hasCompleted:p.some(g=>g.status==="completed"||g.status==="done"),hasArchived:p.some(g=>g.archived),tasks:p};i.set(u,m)}}}return{tasks:i,notes:s,dailyNotes:a}}getAllTaskPaths(){var i,s;let e=new Set,r=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of r){let o=this.app.metadataCache.getFileCache(a);(s=(i=o==null?void 0:o.frontmatter)==null?void 0:i.tags)!=null&&s.includes(this.taskTag)&&e.add(a.path)}return e}getAllStatuses(){var e,r;if(this.ensureIndexesBuilt(),this.tasksByStatus.size===0&&this.indexesBuilt){console.debug("MinimalNativeCache: Indexes marked as built but tasksByStatus is empty, computing statuses synchronously");let i=new Set,s=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of s){let o=this.app.metadataCache.getFileCache(a);if((r=(e=o==null?void 0:o.frontmatter)==null?void 0:e.tags)!=null&&r.includes(this.taskTag)){let l=this.extractTaskInfoFromNative(a.path,o.frontmatter);l!=null&&l.status&&i.add(l.status)}}return Array.from(i).sort()}return Array.from(this.tasksByStatus.keys()).sort()}getAllPriorities(){var i,s;let e=new Set,r=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of r){let o=this.app.metadataCache.getFileCache(a);if((s=(i=o==null?void 0:o.frontmatter)==null?void 0:i.tags)!=null&&s.includes(this.taskTag)){let l=this.extractTaskInfoFromNative(a.path,o.frontmatter);l!=null&&l.priority&&e.add(l.priority)}}return Array.from(e).sort()}getAllTags(){var i,s;let e=new Set,r=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of r){let o=this.app.metadataCache.getFileCache(a);if((s=(i=o==null?void 0:o.frontmatter)==null?void 0:i.tags)!=null&&s.includes(this.taskTag)){let l=this.extractTaskInfoFromNative(a.path,o.frontmatter);l!=null&&l.tags&&Array.isArray(l.tags)&&l.tags.forEach(c=>e.add(c))}}return Array.from(e).sort()}getAllContexts(){var i,s;let e=new Set,r=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of r){let o=this.app.metadataCache.getFileCache(a);if((s=(i=o==null?void 0:o.frontmatter)==null?void 0:i.tags)!=null&&s.includes(this.taskTag)){let l=this.extractTaskInfoFromNative(a.path,o.frontmatter);l!=null&&l.contexts&&Array.isArray(l.contexts)&&l.contexts.forEach(c=>e.add(c))}}return Array.from(e).sort()}getAllProjects(){var i,s;let e=new Set,r=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of r){let o=this.app.metadataCache.getFileCache(a);if((s=(i=o==null?void 0:o.frontmatter)==null?void 0:i.tags)!=null&&s.includes(this.taskTag)){let l=this.extractTaskInfoFromNative(a.path,o.frontmatter),c=Ot((l==null?void 0:l.projects)||[]);c.length>0&&c.forEach(d=>{this.extractProjectNamesFromValue(d,a.path).forEach(h=>e.add(h))})}}return Array.from(e).sort()}getAllProjectsWithDetails(){var i,s;let e=new Map,r=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of r){let o=this.app.metadataCache.getFileCache(a);if((s=(i=o==null?void 0:o.frontmatter)==null?void 0:i.tags)!=null&&s.includes(this.taskTag)){let l=this.extractTaskInfoFromNative(a.path,o.frontmatter),c=Ot((l==null?void 0:l.projects)||[]);c.length>0&&c.forEach(d=>{this.extractProjectDetailsFromValue(d,a.path).forEach(h=>{let f=e.get(h.name);f?f.usageCount++:e.set(h.name,{...h,usageCount:1})})})}}return Array.from(e.values()).sort((a,o)=>a.name.localeCompare(o.name))}getAllProjectFiles(){return this.getAllProjectsWithDetails().filter(r=>r.isLinkedNote&&r.exists&&r.filePath).map(r=>({name:r.name,path:r.filePath,usageCount:r.usageCount}))}extractProjectNamesFromValue(e,r){var s;if(!e)return[];let i=[];if(e.startsWith("[[")&&e.endsWith("]]")){let a=e.slice(2,-2),l=(0,er.parseLinktext)(a).path,c;if(c=this.app.metadataCache.getFirstLinkpathDest(l,""),!c){let d=r.substring(0,r.lastIndexOf("/"));c=this.app.metadataCache.getFirstLinkpathDest(l,d)}if(c)i.push(c.basename);else{let d=((s=l.split("/").pop())==null?void 0:s.replace(/\.md$/,""))||l;i.push(d)}}else{let a=e.trim();a&&i.push(a)}return i}extractProjectDetailsFromValue(e,r){var s;if(!e)return[];let i=[];if(e.startsWith("[[")&&e.endsWith("]]")){let a=e.slice(2,-2),l=(0,er.parseLinktext)(a).path,c;if(c=this.app.metadataCache.getFirstLinkpathDest(l,""),!c){let d=r.substring(0,r.lastIndexOf("/"));c=this.app.metadataCache.getFirstLinkpathDest(l,d)}if(c)i.push({name:c.basename,isLinkedNote:!0,filePath:c.path,exists:!0});else{let d=((s=l.split("/").pop())==null?void 0:s.replace(/\.md$/,""))||l;i.push({name:d,isLinkedNote:!0,filePath:void 0,exists:!1})}}else{let a=e.trim();a&&i.push({name:a,isLinkedNote:!1,filePath:void 0,exists:!1})}return i}getCachedTaskInfoSync(e){var s;let r=this.app.vault.getAbstractFileByPath(e);if(!(r instanceof er.TFile))return null;let i=this.app.metadataCache.getFileCache(r);return!(i!=null&&i.frontmatter)||!((s=i.frontmatter.tags)!=null&&s.includes(this.taskTag))?null:this.extractTaskInfoFromNative(e,i.frontmatter)}async getCachedTaskInfo(e){return this.getTaskInfo(e)}async getTaskByPath(e){return this.getTaskInfo(e)}async getNotesForDate(e){var a;if(this.disableNoteIndexing)return[];let r=Z(e.toISOString()),i=[],s=this.app.vault.getMarkdownFiles().filter(o=>this.isValidFile(o.path));for(let o of s){let l=this.app.metadataCache.getFileCache(o);if(!(l!=null&&l.frontmatter))continue;let c=l.frontmatter;if((a=c.tags)==null?void 0:a.includes(this.taskTag))continue;let u=null;if(c.dateCreated||c.date){let h=c.dateCreated||c.date;if(typeof h=="string"&&h.trim()){let f=h.trim();if(f.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(f))console.debug("Skipping invalid time-only date in note frontmatter:",{path:o.path,dateValue:f});else try{let p=he(h);u=Z(p.toISOString())}catch(p){console.debug("Failed to parse date from note frontmatter:",{path:o.path,dateValue:h,error:p instanceof Error?p.message:String(p)})}}}if(!u){let f=o.basename.match(/(\d{4}-\d{2}-\d{2})/);if(f)try{let p=he(f[1]);u=Z(p.toISOString())}catch(p){}}if(u===r){let h=[];if(c.tags&&(Array.isArray(c.tags)?h=c.tags.filter(p=>typeof p=="string"):typeof c.tags=="string"&&(h=[c.tags])),l.tags){let p=l.tags.map(m=>m.tag.replace("#",""));h=[...new Set([...h,...p])]}let f={title:o.basename,tags:h,path:o.path,createdDate:u,lastModified:o.stat.mtime};i.push(f)}}return i}async getTaskInfoForDate(e){let r=e.toISOString().split("T")[0],i=this.getTasksForDate(r);return(await Promise.all(i.map(a=>this.getTaskInfo(a)))).filter(a=>a!==null)}getTaskPathsByDate(e){return new Set(this.getTasksForDate(e))}getTaskPathsByPriority(e){var s,a;let r=[],i=this.app.vault.getMarkdownFiles().filter(o=>this.isValidFile(o.path));for(let o of i){let l=this.app.metadataCache.getFileCache(o);if((a=(s=l==null?void 0:l.frontmatter)==null?void 0:s.tags)!=null&&a.includes(this.taskTag)){let c=this.extractTaskInfoFromNative(o.path,l.frontmatter);(c==null?void 0:c.priority)===e&&r.push(o.path)}}return r}async rebuildDailyNotesCache(e,r){}updateDateIndex(e,r){for(let i of this.tasksByDate.values())i.delete(e);if(r.due){let i=Z(r.due);this.tasksByDate.has(i)||this.tasksByDate.set(i,new Set),this.tasksByDate.get(i).add(e)}if(r.scheduled){let i=Z(r.scheduled);this.tasksByDate.has(i)||this.tasksByDate.set(i,new Set),this.tasksByDate.get(i).add(e)}}updateStatusIndex(e,r){for(let i of this.tasksByStatus.values())i.delete(e);this.tasksByStatus.has(r)||this.tasksByStatus.set(r,new Set),this.tasksByStatus.get(r).add(e)}updateOverdueIndex(e,r){if(this.overdueTasks.delete(e),!r.recurrence){let i=$e();r.due&&gr(r.due,i)?this.overdueTasks.add(e):!r.due&&r.scheduled&&gr(r.scheduled,i)&&this.overdueTasks.add(e)}}handleFileChanged(e,r){var s,a;if(!this.initialized)return;this.clearFileFromIndexes(e.path);let i=this.app.metadataCache.getFileCache(e);(a=(s=i==null?void 0:i.frontmatter)==null?void 0:s.tags)!=null&&a.includes(this.taskTag)&&this.indexTaskFile(e,i.frontmatter),this.trigger("file-updated",{path:e.path,file:e})}handleFileDeleted(e){this.initialized&&(this.clearFileFromIndexes(e),this.trigger("file-deleted",{path:e}))}handleFileRenamed(e,r){var s,a;if(!this.initialized)return;this.clearFileFromIndexes(r);let i=this.app.metadataCache.getFileCache(e);(a=(s=i==null?void 0:i.frontmatter)==null?void 0:s.tags)!=null&&a.includes(this.taskTag)&&this.indexTaskFile(e,i.frontmatter),this.trigger("file-renamed",{oldPath:r,newPath:e.path,file:e})}extractTaskInfoFromNative(e,r){if(!this.fieldMapper)return null;try{let i=this.fieldMapper.mapFromFrontmatter(r,e,this.storeTitleInFilename);return{title:i.title||"Untitled task",status:i.status||"open",priority:i.priority||"normal",due:i.due,scheduled:i.scheduled,path:e,archived:i.archived||!1,tags:Array.isArray(i.tags)?i.tags:[],contexts:Array.isArray(i.contexts)?i.contexts:[],projects:Array.isArray(i.projects)?i.projects:[],recurrence:i.recurrence,complete_instances:i.complete_instances,completedDate:i.completedDate,timeEstimate:i.timeEstimate,timeEntries:i.timeEntries,dateCreated:i.dateCreated,dateModified:i.dateModified}}catch(i){return console.error(`Error extracting task info from native metadata for ${e}:`,i),null}}isValidFile(e){return!this.excludedFolders.some(r=>e.startsWith(r))}clearFileFromIndexes(e){for(let r of this.tasksByDate.values())r.delete(e);for(let r of this.tasksByStatus.values())r.delete(e);this.overdueTasks.delete(e)}clearAllIndexes(){this.tasksByDate.clear(),this.tasksByStatus.clear(),this.overdueTasks.clear()}updateConfig(e,r,i,s=!1,a=!1){this.taskTag=e,this.excludedFolders=r?r.split(",").map(o=>o.trim()):[],this.fieldMapper=i,this.disableNoteIndexing=s,this.storeTitleInFilename=a,this.initialized&&(this.clearAllIndexes(),this.indexesBuilt=!1)}clearCacheEntry(e){var i,s;let r=this.app.vault.getAbstractFileByPath(e);if(r instanceof er.TFile){let a=this.app.metadataCache.getFileCache(r);(s=(i=a==null?void 0:a.frontmatter)==null?void 0:i.tags)!=null&&s.includes(this.taskTag)&&this.indexTaskFile(r,a.frontmatter)}}async clearAllCaches(){this.clearAllIndexes(),this.indexesBuilt=!1}updateTaskInfoInCache(e,r){this.indexesBuilt&&(this.clearFileFromIndexes(e),this.updateDateIndex(e,r),this.updateStatusIndex(e,r.status),this.updateOverdueIndex(e,r))}subscribe(e,r){return this.on(e,r),()=>this.off(e,r)}isInitialized(){return this.initialized}getStats(){return{indexSizes:{tasksByDate:this.tasksByDate.size,tasksByStatus:this.tasksByStatus.size,overdueTasks:this.overdueTasks.size},memoryFootprint:"Minimal - only essential indexes"}}destroy(){this.eventListeners.forEach(e=>{this.app.metadataCache.offref(e)}),this.eventListeners=[],this.clearAllIndexes(),this.initialized=!1,this.indexesBuilt=!1}};var Xs=class{constructor(){this.inFlightRequests=new Map;this.prefetchQueue=new Set;this.prefetchPromises=new Map;this.activeTimeouts=new Set}async execute(t,e,r=5e3){if(this.inFlightRequests.has(t))return this.inFlightRequests.get(t);let i=this.createRequest(t,e,r);return this.inFlightRequests.set(t,i),i}async createRequest(t,e,r){try{let i=await e(),s=setTimeout(()=>{this.inFlightRequests.delete(t),this.activeTimeouts.delete(s)},r);return this.activeTimeouts.add(s),i}catch(i){throw this.inFlightRequests.delete(t),i}}prefetch(t,e,r="low"){if(!(this.inFlightRequests.has(t)||this.prefetchPromises.has(t)))if(r==="high")this.executePrefetch(t,e);else if(this.prefetchQueue.add(t),"requestIdleCallback"in window)requestIdleCallback(()=>{this.processPrefetchQueue(t,e)});else{let i=setTimeout(()=>{this.processPrefetchQueue(t,e),this.activeTimeouts.delete(i)},50);this.activeTimeouts.add(i)}}async executePrefetch(t,e){try{let r=e();this.prefetchPromises.set(t,r),await r;let i=setTimeout(()=>{this.prefetchPromises.delete(t),this.activeTimeouts.delete(i)},3e4);this.activeTimeouts.add(i)}catch(r){this.prefetchPromises.delete(t)}}processPrefetchQueue(t,e){this.prefetchQueue.has(t)&&(this.prefetchQueue.delete(t),this.executePrefetch(t,e))}getPrefetchedData(t){return this.prefetchPromises.get(t)||null}cancel(t){this.inFlightRequests.delete(t),this.prefetchPromises.delete(t),this.prefetchQueue.delete(t)}cancelAll(){this.inFlightRequests.clear(),this.prefetchPromises.clear(),this.prefetchQueue.clear();for(let t of this.activeTimeouts)clearTimeout(t);this.activeTimeouts.clear()}getStats(){return{inFlightCount:this.inFlightRequests.size,prefetchCount:this.prefetchPromises.size,queuedCount:this.prefetchQueue.size}}},Bd=class{constructor(t){this.lastAccessTime=new Map;this.deduplicator=t}recordAccess(t,e,r){let i=this.getDateKey(t);this.lastAccessTime.set(i,Date.now()),this.prefetchAdjacentDates(t,e,r)}prefetchAdjacentDates(t,e,r){this.getAdjacentDates(t).forEach(({date:s,priority:a})=>{let o=`${e}-${this.getDateKey(s)}`;this.deduplicator.prefetch(o,()=>r(s),a)})}getAdjacentDates(t){let e=[],r=new Date(t);r.setDate(t.getDate()-1),e.push({date:r,priority:"high"});let i=new Date(t);i.setDate(t.getDate()+1),e.push({date:i,priority:"high"});for(let s=2;s<=7;s++){let a=new Date(t);a.setDate(t.getDate()-s),e.push({date:a,priority:"low"});let o=new Date(t);o.setDate(t.getDate()+s),e.push({date:o,priority:"low"})}return e}getDateKey(t){return t.toISOString().split("T")[0]}cleanup(){let t=Date.now(),e=24*60*60*1e3;for(let[r,i]of this.lastAccessTime)t-i>e&&this.lastAccessTime.delete(r)}};var ea=class{constructor(){this.updateQueue=[];this.isProcessing=!1;this.activeTimeouts=new Set}scheduleUpdate(t){this.updateQueue.push(t),this.isProcessing||(this.isProcessing=!0,requestAnimationFrame(()=>{this.processUpdates()}))}processUpdates(){let t=[...this.updateQueue];this.updateQueue=[];try{t.forEach(e=>{try{e()}catch(r){console.error("Error processing DOM update:",r)}})}finally{this.isProcessing=!1,this.updateQueue.length>0&&requestAnimationFrame(()=>{this.processUpdates()})}}updateAttributes(t,e){for(let[r,i]of Object.entries(e))i===null?t.removeAttribute(r):t.getAttribute(r)!==i&&t.setAttribute(r,i)}updateClasses(t,e){for(let[r,i]of Object.entries(e))i?t.classList.add(r):t.classList.remove(r)}updateTextContent(t,e){t.textContent!==e&&(t.textContent=e)}updateStyles(t,e){for(let[r,i]of Object.entries(e))i===null?t.style.removeProperty(r):t.style.setProperty(r,i)}preserveState(t){let e={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,focused:document.activeElement===t,selection:null};return(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)&&(e.selection={start:t.selectionStart||0,end:t.selectionEnd||0}),e}restoreState(t,e){t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft,e.focused&&t.focus(),e.selection&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)&&t.setSelectionRange(e.selection.start,e.selection.end)}animateUpdate(t,e,r=1500){t.classList.add(`task-${e}`);let i=setTimeout(()=>{t.classList.remove(`task-${e}`),this.activeTimeouts.delete(i)},r);this.activeTimeouts.add(i)}updateList(t,e,r,i,s){let a=new Map,o=new Set;Array.from(t.children).forEach(d=>{let u=d.dataset.key;u&&(a.set(u,d),o.add(u))});let l=new Set(e.map(r)),c=document.createDocumentFragment();e.forEach(d=>{let u=r(d),h=a.get(u);if(h)s&&s(h,d),c.appendChild(h);else{let f=i(d);f.dataset.key=u,c.appendChild(f)}}),o.forEach(d=>{if(!l.has(d)){let u=a.get(d);u&&u.parentNode&&u.remove()}}),t.replaceChildren(c)}createOptimisticUpdate(t,e,r){return e(t),{commit:()=>{},revert:()=>{r(t)}}}destroy(){this.updateQueue=[],this.isProcessing=!1;for(let t of this.activeTimeouts)clearTimeout(t);this.activeTimeouts.clear()}},Hd=class{constructor(){this.stateMap=new Map}saveState(t,e){let r=new ea;this.stateMap.set(t,r.preserveState(e))}restoreState(t,e){let r=this.stateMap.get(t);r&&new ea().restoreState(e,r)}clearState(t){t?this.stateMap.delete(t):this.stateMap.clear()}destroy(){this.stateMap.clear()}};sh();xu();_u();var ct=require("obsidian");we();at();je();var ZT=require("obsidian");function Yd(n,t){let e=q0(n),r=e.frontmatter?G0(e.frontmatter,t):{},i=Q0(e.body,t);return{frontmatter:r,body:i}}function q0(n){var e,r;let t=n.split(`
`);if(((e=t[0])==null?void 0:e.trim())==="---"){let i=-1;for(let s=1;s<t.length;s++)if(((r=t[s])==null?void 0:r.trim())==="---"){i=s;break}if(i>0){let a=t.slice(1,i).join(`
`),l=t.slice(i+1).join(`
`);return{frontmatter:a.trim()||null,body:l}}}return{frontmatter:null,body:n}}function G0(n,t){try{let e=K0(n,t),r=(0,ZT.parseYaml)(e);return typeof r!="object"||r===null?(console.warn("Template frontmatter did not parse to a valid object"),{}):r}catch(e){return console.error("Error processing template frontmatter:",e),{}}}function Q0(n,t){return Z0(n,t)}function K0(n,t){var d;let e=n,r=new Date,i=t.title||"",s=ul(i)?`"${es(i)}"`:i;e=e.replace(/\{\{title\}\}/g,s),e=e.replace(/\{\{priority\}\}/g,t.priority||""),e=e.replace(/\{\{status\}\}/g,t.status||"");let a=Array.isArray(t.contexts)?t.contexts.join(", "):"";e=e.replace(/\{\{contexts\}\}/g,a);let o=Array.isArray(t.tags)?t.tags.join(", "):"";e=e.replace(/\{\{tags\}\}/g,o),e=e.replace(/\{\{timeEstimate\}\}/g,((d=t.timeEstimate)==null?void 0:d.toString())||""),e=e.replace(/\{\{dueDate\}\}/g,t.dueDate||""),e=e.replace(/\{\{scheduledDate\}\}/g,t.scheduledDate||""),e=e.replace(/\{\{details\}\}/g,t.details||"");let l=t.parentNote||"",c=l?`"${es(l)}"`:"";if(e=e.replace(/\{\{parentNote\}\}/g,c),e=e.replace(/\{\{date\}\}/g,I(r,"yyyy-MM-dd")),e=e.replace(/\{\{time\}\}/g,I(r,"HH:mm")),"icsEventTitle"in t){let u=t,h=u.icsEventTitle||"",f=ul(h)?`"${es(h)}"`:h;e=e.replace(/\{\{icsEventTitle\}\}/g,f),e=e.replace(/\{\{icsEventStart\}\}/g,u.icsEventStart||""),e=e.replace(/\{\{icsEventEnd\}\}/g,u.icsEventEnd||"");let p=u.icsEventLocation||"",m=p&&ul(p)?`"${es(p)}"`:p;e=e.replace(/\{\{icsEventLocation\}\}/g,m);let g=u.icsEventDescription||"",v=g&&ul(g)?`"${es(g)}"`:g;e=e.replace(/\{\{icsEventDescription\}\}/g,v),e=e.replace(/\{\{icsEventUrl\}\}/g,u.icsEventUrl||"");let T=u.icsEventSubscription||"",k=T&&ul(T)?`"${es(T)}"`:T;e=e.replace(/\{\{icsEventSubscription\}\}/g,k);let D=u.icsEventId||"",M=D?`"${es(D)}"`:"";e=e.replace(/\{\{icsEventId\}\}/g,M)}return e}function ul(n){if(!n)return!1;let t=/[[\]{}:>|*&!%#`@,]/,e=/^[-?]/,r=/^\d+\.?\d*$/,i=/^(true|false|yes|no|on|off)$/i;return t.test(n)||e.test(n)||r.test(n)||i.test(n)}function es(n){return n?n.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):""}function Z0(n,t){var a;let e=n,r=new Date;e=e.replace(/\{\{title\}\}/g,t.title||""),e=e.replace(/\{\{priority\}\}/g,t.priority||""),e=e.replace(/\{\{status\}\}/g,t.status||"");let i=Array.isArray(t.contexts)?t.contexts.join(", "):"";e=e.replace(/\{\{contexts\}\}/g,i);let s=Array.isArray(t.tags)?t.tags.join(", "):"";if(e=e.replace(/\{\{tags\}\}/g,s),e=e.replace(/\{\{timeEstimate\}\}/g,((a=t.timeEstimate)==null?void 0:a.toString())||""),e=e.replace(/\{\{dueDate\}\}/g,t.dueDate||""),e=e.replace(/\{\{scheduledDate\}\}/g,t.scheduledDate||""),e=e.replace(/\{\{details\}\}/g,t.details||""),e=e.replace(/\{\{parentNote\}\}/g,t.parentNote||""),e=e.replace(/\{\{date\}\}/g,I(r,"yyyy-MM-dd")),e=e.replace(/\{\{time\}\}/g,I(r,"HH:mm")),"icsEventTitle"in t){let o=t;e=e.replace(/\{\{icsEventTitle\}\}/g,o.icsEventTitle||""),e=e.replace(/\{\{icsEventStart\}\}/g,o.icsEventStart||""),e=e.replace(/\{\{icsEventEnd\}\}/g,o.icsEventEnd||""),e=e.replace(/\{\{icsEventLocation\}\}/g,o.icsEventLocation||""),e=e.replace(/\{\{icsEventDescription\}\}/g,o.icsEventDescription||""),e=e.replace(/\{\{icsEventUrl\}\}/g,o.icsEventUrl||""),e=e.replace(/\{\{icsEventSubscription\}\}/g,o.icsEventSubscription||""),e=e.replace(/\{\{icsEventId\}\}/g,o.icsEventId||"")}return e}function JT(n,t){return{...t,...n}}var Ud=class{constructor(t){this.plugin=t}async createTask(t){var e;try{if(!t.title||!t.title.trim())throw new Error("Title is required");if(t.title.length>200)throw new Error("Title is too long (max 200 characters)");let r=t.title.trim(),i=t.priority||this.plugin.settings.defaultTaskPriority,s=t.status||this.plugin.settings.defaultTaskStatus,a=t.dateCreated||ce(),o=t.dateModified||ce(),l=t.contexts||[],c=t.projects||[],d=t.tags||[this.plugin.settings.taskTag];d.includes(this.plugin.settings.taskTag)||d.unshift(this.plugin.settings.taskTag);let u={title:r,priority:i,status:s,date:new Date,dueDate:t.due,scheduledDate:t.scheduled},h=Ys(u,this.plugin.settings),f="";if(t.creationContext==="inline-conversion"){let S=this.plugin.settings.inlineTaskConvertFolder||"";if(S.trim())if(S.includes("{{currentNotePath}}")){let O=this.plugin.app.workspace.getActiveFile(),F=((e=O==null?void 0:O.parent)==null?void 0:e.path)||"";f=S.replace(/\{\{currentNotePath\}\}/g,F)}else f=S;else f=this.plugin.settings.tasksFolder||""}else f=this.plugin.settings.tasksFolder||"";f&&await Kl(this.plugin.app.vault,f);let p=await _o(h,f,this.plugin.app.vault),m=f?`${f}/${p}.md`:`${p}.md`,g={title:r,status:s,priority:i,due:t.due||void 0,scheduled:t.scheduled||void 0,contexts:l.length>0?l:void 0,projects:c.length>0?c:void 0,timeEstimate:t.timeEstimate&&t.timeEstimate>0?t.timeEstimate:void 0,dateCreated:a,dateModified:o,recurrence:t.recurrence||void 0,icsEventId:t.icsEventId||void 0},v=this.plugin.fieldMapper.mapToFrontmatter(g,this.plugin.settings.taskTag,this.plugin.settings.storeTitleInFilename);v.tags=d;let T=await this.applyTemplate(t),k=JT(v,T.frontmatter),M=`---
${(0,ct.stringifyYaml)(k)}---

`;T.body&&T.body.trim()&&(M+=`${T.body.trim()}

`);let E=await this.plugin.app.vault.create(m,M),C={...g,...k,title:k.title||g.title||r,status:k.status||g.status||s,priority:k.priority||g.priority||i,path:E.path,tags:d,archived:!1};return this.plugin.cacheManager.updateTaskInfoInCache(E.path,C),this.plugin.emitter.trigger(xe,{path:E.path,updatedTask:C}),{file:E,taskInfo:C}}catch(r){let i=r instanceof Error?r.message:String(r);throw console.error("Error creating task:",{error:i,stack:r instanceof Error?r.stack:void 0,taskData:t}),new Error(`Failed to create task: ${i}`)}}async applyTemplate(t){var r,i,s,a;let e=this.plugin.settings.taskCreationDefaults;if(!e.useBodyTemplate||!((r=e.bodyTemplate)!=null&&r.trim()))return{frontmatter:{},body:((i=t.details)==null?void 0:i.trim())||""};try{let o=(0,ct.normalizePath)(e.bodyTemplate.trim());o.endsWith(".md")||(o+=".md");let l=this.plugin.app.vault.getAbstractFileByPath(o);if(l instanceof ct.TFile){let c=await this.plugin.app.vault.read(l),d={title:t.title||"",priority:t.priority||"",status:t.status||"",contexts:Array.isArray(t.contexts)?t.contexts:[],tags:Array.isArray(t.tags)?t.tags:[],timeEstimate:t.timeEstimate||0,dueDate:t.due||"",scheduledDate:t.scheduled||"",details:t.details||"",parentNote:t.parentNote||""};return Yd(c,d)}else return console.warn(`Task body template not found: ${o}`),new ct.Notice(`Task body template not found: ${o}`),{frontmatter:{},body:((s=t.details)==null?void 0:s.trim())||""}}catch(o){return console.error("Error reading task body template:",o),new ct.Notice(`Error reading task body template: ${e.bodyTemplate}`),{frontmatter:{},body:((a=t.details)==null?void 0:a.trim())||""}}}async toggleStatus(t){try{let r=this.plugin.statusManager.isCompletedStatus(t.status)?this.plugin.settings.defaultTaskStatus:this.plugin.statusManager.getCompletedStatuses()[0]||"done";return await this.updateProperty(t,"status",r)}catch(e){let r=e instanceof Error?e.message:String(e);throw console.error("Error toggling task status:",{error:r,stack:e instanceof Error?e.stack:void 0,taskPath:t.path,currentStatus:t.status}),new Error(`Failed to toggle task status: ${r}`)}}async updateProperty(t,e,r,i={}){try{let s=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(s instanceof ct.TFile))throw new Error(`Cannot find task file: ${t.path}`);let a=await this.plugin.cacheManager.getTaskInfo(t.path)||t,o={...a};o[e]=r,o.dateModified=ce(),e==="status"&&!a.recurrence&&(this.plugin.statusManager.isCompletedStatus(r)?o.completedDate=Ll():o.completedDate=void 0),await this.plugin.app.fileManager.processFrontMatter(s,l=>{let c=this.plugin.fieldMapper.toUserField(e);if(e==="status"){if(l[c]=r,!t.recurrence){let u=this.plugin.fieldMapper.toUserField("completedDate");this.plugin.statusManager.isCompletedStatus(r)?l[u]=Ll():l[u]&&delete l[u]}}else(e==="due"||e==="scheduled")&&!r?delete l[c]:l[c]=r;let d=this.plugin.fieldMapper.toUserField("dateModified");l[d]=o.dateModified});try{await this.plugin.cacheManager.updateTaskInfoInCache(t.path,o)}catch(l){console.error("Error updating task cache:",{error:l instanceof Error?l.message:String(l),taskPath:t.path})}try{this.plugin.emitter.trigger(xe,{path:t.path,originalTask:t,updatedTask:o})}catch(l){console.error("Error emitting task update event:",{error:l instanceof Error?l.message:String(l),taskPath:t.path})}return o}catch(s){let a=s instanceof Error?s.message:String(s);throw console.error("Error updating task property:",{error:a,stack:s instanceof Error?s.stack:void 0,taskPath:t.path,property:String(e),value:r}),new Error(`Failed to update task property: ${a}`)}}async toggleArchive(t){let e=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof ct.TFile))throw new Error(`Cannot find task file: ${t.path}`);let r=this.plugin.fieldMapper.getMapping().archiveTag,i=t.archived,s={...t};return s.archived=!i,s.dateModified=ce(),s.tags||(s.tags=[]),i?s.tags=s.tags.filter(a=>a!==r):s.tags.includes(r)||(s.tags=[...s.tags,r]),await this.plugin.app.fileManager.processFrontMatter(e,a=>{let o=this.plugin.fieldMapper.toUserField("dateModified");i?a.tags&&Array.isArray(a.tags)&&(a.tags=a.tags.filter(l=>l!==r),a.tags.length===0&&delete a.tags):(a.tags?Array.isArray(a.tags)||(a.tags=[a.tags]):a.tags=[],a.tags.includes(r)||a.tags.push(r)),a[o]=s.dateModified}),await this.plugin.cacheManager.updateTaskInfoInCache(t.path,s),this.plugin.emitter.trigger(xe,{path:t.path,originalTask:t,updatedTask:s}),s}async startTimeTracking(t){let e=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof ct.TFile))throw new Error(`Cannot find task file: ${t.path}`);if(this.plugin.getActiveTimeSession(t))throw new Error("Time tracking is already active for this task");let i={...t};i.dateModified=ce(),i.timeEntries||(i.timeEntries=[]);let s={startTime:ce(),description:"Work session"};return i.timeEntries=[...i.timeEntries,s],await this.plugin.app.fileManager.processFrontMatter(e,a=>{let o=this.plugin.fieldMapper.toUserField("timeEntries"),l=this.plugin.fieldMapper.toUserField("dateModified");a[o]||(a[o]=[]),a[o].push(s),a[l]=i.dateModified}),await this.plugin.cacheManager.updateTaskInfoInCache(t.path,i),this.plugin.emitter.trigger(xe,{path:t.path,originalTask:t,updatedTask:i}),i}async stopTimeTracking(t){let e=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof ct.TFile))throw new Error(`Cannot find task file: ${t.path}`);let r=this.plugin.getActiveTimeSession(t);if(!r)throw new Error("No active time tracking session for this task");let i={...t};if(i.dateModified=ce(),i.timeEntries&&Array.isArray(i.timeEntries)){let s=i.timeEntries.findIndex(a=>a.startTime===r.startTime&&!a.endTime);s!==-1&&(i.timeEntries=[...i.timeEntries],i.timeEntries[s]={...i.timeEntries[s],endTime:ce()})}return await this.plugin.app.fileManager.processFrontMatter(e,s=>{let a=this.plugin.fieldMapper.toUserField("timeEntries"),o=this.plugin.fieldMapper.toUserField("dateModified");if(s[a]&&Array.isArray(s[a])){let l=s[a].findIndex(c=>c.startTime===r.startTime&&!c.endTime);l!==-1&&(s[a][l].endTime=ce())}s[o]=i.dateModified}),await this.plugin.cacheManager.updateTaskInfoInCache(t.path,i),this.plugin.emitter.trigger(xe,{path:t.path,originalTask:t,updatedTask:i}),i}async updateTask(t,e){try{let r=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(r instanceof ct.TFile))throw new Error(`Cannot find task file: ${t.path}`);let i=this.plugin.settings.storeTitleInFilename&&e.title&&e.title!==t.title,s=t.path;if(i){let o=r.parent?r.parent.path:"",l=await _o(e.title,o,this.plugin.app.vault);s=o?`${o}/${l}.md`:`${l}.md`}await this.plugin.app.fileManager.processFrontMatter(r,o=>{let l={...t,...e,dateModified:ce()},c=this.plugin.fieldMapper.mapToFrontmatter(l,this.plugin.settings.taskTag,this.plugin.settings.storeTitleInFilename);Object.keys(c).forEach(d=>{c[d]!==void 0&&(o[d]=c[d])}),e.hasOwnProperty("due")&&e.due===void 0&&delete o[this.plugin.fieldMapper.toUserField("due")],e.hasOwnProperty("scheduled")&&e.scheduled===void 0&&delete o[this.plugin.fieldMapper.toUserField("scheduled")],e.hasOwnProperty("contexts")&&e.contexts===void 0&&delete o[this.plugin.fieldMapper.toUserField("contexts")],e.hasOwnProperty("timeEstimate")&&e.timeEstimate===void 0&&delete o[this.plugin.fieldMapper.toUserField("timeEstimate")],e.hasOwnProperty("completedDate")&&e.completedDate===void 0&&delete o[this.plugin.fieldMapper.toUserField("completedDate")],e.hasOwnProperty("recurrence")&&e.recurrence===void 0&&delete o[this.plugin.fieldMapper.toUserField("recurrence")],i&&delete o[this.plugin.fieldMapper.toUserField("title")],e.hasOwnProperty("tags")?o.tags=e.tags:t.tags&&(o.tags=t.tags)}),i&&await this.plugin.app.fileManager.renameFile(r,s);let a={...t,...e,path:s,dateModified:ce()};e.status!==void 0&&!t.recurrence&&(this.plugin.statusManager.isCompletedStatus(e.status)?t.completedDate||(a.completedDate=Ll()):a.completedDate=void 0),i&&this.plugin.cacheManager.clearCacheEntry(t.path);try{await this.plugin.cacheManager.updateTaskInfoInCache(s,a)}catch(o){console.error("Error updating task cache:",{error:o instanceof Error?o.message:String(o),taskPath:s})}try{this.plugin.emitter.trigger(xe,{path:s,originalTask:t,updatedTask:a})}catch(o){console.error("Error emitting task update event:",{error:o instanceof Error?o.message:String(o),taskPath:s})}return a}catch(r){let i=r instanceof Error?r.message:String(r);throw console.error("Error updating task:",{error:i,stack:r instanceof Error?r.stack:void 0,taskPath:t.path,updates:e}),new Error(`Failed to update task: ${i}`)}}async deleteTask(t){try{let e=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof ct.TFile))throw new Error(`Cannot find task file: ${t.path}`);await this.plugin.app.vault.delete(e),this.plugin.cacheManager.clearCacheEntry(t.path),this.plugin.emitter.trigger(Il,{path:t.path,deletedTask:t})}catch(e){let r=e instanceof Error?e.message:String(e);throw console.error("Error deleting task:",{error:r,stack:e instanceof Error?e.stack:void 0,taskPath:t.path}),new Error(`Failed to delete task: ${r}`)}}async toggleRecurringTaskComplete(t,e){let r=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(r instanceof ct.TFile))throw new Error(`Cannot find task file: ${t.path}`);let i=await this.plugin.cacheManager.getTaskInfo(t.path)||t;if(!i.recurrence)throw new Error("Task is not recurring");let s=e||this.plugin.selectedDate,a=Te(s),o=Array.isArray(i.complete_instances)?i.complete_instances:[],c=!o.includes(a),d={...i};return d.dateModified=ce(),c?o.includes(a)||(d.complete_instances=[...o,a]):d.complete_instances=o.filter(u=>u!==a),await this.plugin.app.fileManager.processFrontMatter(r,u=>{let h=this.plugin.fieldMapper.toUserField("completeInstances"),f=this.plugin.fieldMapper.toUserField("dateModified");u[h]||(u[h]=[]);let p=u[h];c?p.includes(a)||(u[h]=[...p,a]):u[h]=p.filter(m=>m!==a),u[f]=d.dateModified}),await this.plugin.cacheManager.updateTaskInfoInCache(i.path,d),this.plugin.emitter.trigger(xe,{path:i.path,originalTask:i,updatedTask:d}),d}async deleteTimeEntry(t,e){let r=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(r instanceof ct.TFile))throw new Error(`Cannot find task file: ${t.path}`);if(!t.timeEntries||!Array.isArray(t.timeEntries))throw new Error("Task has no time entries");if(e<0||e>=t.timeEntries.length)throw new Error("Invalid time entry index");let i={...t};return i.dateModified=ce(),i.timeEntries=t.timeEntries.filter((s,a)=>a!==e),await this.plugin.app.fileManager.processFrontMatter(r,s=>{let a=this.plugin.fieldMapper.toUserField("timeEntries"),o=this.plugin.fieldMapper.toUserField("dateModified");s[a]&&Array.isArray(s[a])&&(s[a]=s[a].filter((l,c)=>c!==e)),s[o]=i.dateModified}),await this.plugin.cacheManager.updateTaskInfoInCache(t.path,i),this.plugin.emitter.trigger(xe,{path:t.path,originalTask:t,updatedTask:i}),i}};var Vd=class extends Pr{constructor(e,r){super();this.filterState={};this.viewPreferences={};this.savedViews=[];this.storageKey="tasknotes-view-filter-state";this.preferencesStorageKey="tasknotes-view-preferences";this.savedViewsStorageKey="tasknotes-saved-views";this.app=e,this.plugin=r,this.loadFromStorage(),this.loadPreferencesFromStorage(),this.savedViews=[...this.plugin.settings.savedViews]}async initializeSavedViews(){await this.migrateAndLoadSavedViews()}getFilterState(e){let r=this.filterState[e];if(r){if(typeof r!="object"||r.type!=="group"||!Array.isArray(r.children)||typeof r.conjunction!="string"){console.warn(`ViewStateManager: Ignoring old format filter state for ${e}, will use default`),delete this.filterState[e],this.saveToStorage();return}return me.deepCloneFilterQuery(r)}}setFilterState(e,r){this.filterState[e]=me.deepCloneFilterQuery(r),this.saveToStorage(),this.emit("filter-state-changed",{viewType:e,query:me.deepCloneFilterQuery(r)})}clearFilterState(e){delete this.filterState[e],this.saveToStorage(),this.emit("filter-state-cleared",{viewType:e})}clearAllFilterStates(){this.filterState={},this.saveToStorage(),this.emit("all-filter-states-cleared")}getViewPreferences(e){return this.viewPreferences[e]}setViewPreferences(e,r){this.viewPreferences[e]={...r},this.savePreferencesToStorage(),this.emit("view-preferences-changed",{viewType:e,preferences:r})}clearViewPreferences(e){delete this.viewPreferences[e],this.savePreferencesToStorage(),this.emit("view-preferences-cleared",{viewType:e})}clearAllViewPreferences(){this.viewPreferences={},this.savePreferencesToStorage(),this.emit("all-view-preferences-cleared")}loadFromStorage(){try{let e=this.app.loadLocalStorage(this.storageKey);e&&(this.filterState=JSON.parse(e))}catch(e){console.warn("Failed to load view filter state from storage:",e),this.filterState={}}}saveToStorage(){try{this.app.saveLocalStorage(this.storageKey,JSON.stringify(this.filterState))}catch(e){console.warn("Failed to save view filter state to storage:",e)}}loadPreferencesFromStorage(){try{let e=this.app.loadLocalStorage(this.preferencesStorageKey);e&&(this.viewPreferences=JSON.parse(e))}catch(e){console.warn("Failed to load view preferences from storage:",e),this.viewPreferences={}}}savePreferencesToStorage(){try{this.app.saveLocalStorage(this.preferencesStorageKey,JSON.stringify(this.viewPreferences))}catch(e){console.warn("Failed to save view preferences to storage:",e)}}getAllFilterStates(){return{...this.filterState}}getSavedViews(){return this.savedViews.map(e=>({...e,query:me.deepCloneFilterQuery(e.query),viewOptions:e.viewOptions?{...e.viewOptions}:void 0}))}saveView(e,r,i){let s={id:this.generateId(),name:e,query:me.deepCloneFilterQuery(r),viewOptions:i?{...i}:void 0};return this.savedViews.push(s),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews()),s}updateView(e,r){let i=this.savedViews.findIndex(a=>a.id===e);if(i===-1)throw new Error(`Saved view with ID ${e} not found`);let s={...r};s.query&&(s.query=me.deepCloneFilterQuery(s.query)),s.viewOptions&&(s.viewOptions={...s.viewOptions}),this.savedViews[i]={...this.savedViews[i],...s},this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}deleteView(e){let r=this.savedViews.findIndex(i=>i.id===e);if(r===-1)throw new Error(`Saved view with ID ${e} not found`);this.savedViews.splice(r,1),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}getSavedView(e){let r=this.savedViews.find(i=>i.id===e);if(r)return{...r,query:me.deepCloneFilterQuery(r.query),viewOptions:r.viewOptions?{...r.viewOptions}:void 0}}clearAllSavedViews(){this.savedViews=[],this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}reorderSavedViews(e,r){if(e<0||e>=this.savedViews.length||r<0||r>this.savedViews.length||e===r)return;r=Math.min(r,this.savedViews.length-1);let[i]=this.savedViews.splice(e,1);this.savedViews.splice(r,0,i),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2,9)}async migrateAndLoadSavedViews(){try{this.savedViews=[...this.plugin.settings.savedViews];let e=this.app.loadLocalStorage(this.savedViewsStorageKey);if(e&&this.savedViews.length===0){console.log("TaskNotes: Migrating saved views from localStorage to plugin data...");let r=JSON.parse(e);this.savedViews=[...r],await this.saveSavedViewsToPluginData(),this.app.saveLocalStorage(this.savedViewsStorageKey,null),console.log(`TaskNotes: Successfully migrated ${r.length} saved views to plugin data.`)}}catch(e){console.warn("Failed to load/migrate saved views:",e),this.savedViews=[]}}async saveSavedViewsToPluginData(){try{this.plugin.settings.savedViews=[...this.savedViews],await this.plugin.saveSettings()}catch(e){console.warn("Failed to save saved views to plugin data:",e)}}needsMigration(){let r=!!this.app.loadLocalStorage(this.savedViewsStorageKey),i=this.plugin.settings.savedViews&&this.plugin.settings.savedViews.length>0;return r&&!i}async performMigration(){try{this.clearAllFilterStates(),await this.migrateAndLoadSavedViews(),this.emit("migration-complete")}catch(e){console.error("Error during ViewStateManager migration:",e),this.savedViews=[],await this.saveSavedViewsToPluginData()}}cleanup(){this.removeAllListeners()}};Wd();rm();var nm=class{constructor(t){this.plugin=t}createPostProcessor(){return(t,e)=>{if(!this.plugin.settings.enableTaskLinkOverlay)return;let r=t.querySelectorAll("a.internal-link");for(let i of Array.from(r))this.processWikilink(i,e.sourcePath)}}async processWikilink(t,e){try{let r=t.getAttribute("href");if(!r)return;let i=r;if(r.startsWith("app://")){let o=new URL(r);i=decodeURIComponent(o.pathname),i.startsWith("/")&&(i=i.substring(1))}let s=this.resolveLinkPath(i,e);if(!s)return;let a=this.getTaskInfo(s);if(!a)return;await this.replaceWithTaskWidget(t,a,i)}catch(r){console.debug("Error processing wikilink in reading mode:",r)}}resolveLinkPath(t,e){try{let r=t.replace(/\.\./g,"").trim();if(!r)return null;let i=this.plugin.app.metadataCache.getFirstLinkpathDest(r,e);return(i==null?void 0:i.path)||null}catch(r){return console.debug("Error resolving link path:",t,r),null}}getTaskInfo(t){try{if(!t||typeof t!="string"||t.trim().length===0)return null;let e=this.plugin.cacheManager;if(!e||!e.getCachedTaskInfoSync)return null;let r=e.getCachedTaskInfoSync(t);return r&&typeof r=="object"&&r.title?r:null}catch(e){return console.debug("Error getting task info for:",t,e),null}}async replaceWithTaskWidget(t,e,r){var i;try{let s=t.textContent||`[[${r}]]`,a,o=t.textContent||"";o!==r&&o!==e.title&&(a=o);let l=new sn(e,this.plugin,s,a),c=this.createReadingModeWidget(l,e,s,a);(i=t.parentNode)==null||i.replaceChild(c,t)}catch(s){console.error("Error replacing wikilink with task widget:",s)}}createReadingModeWidget(t,e,r,i){let s={},a=t.toDOM(s);return a.classList.add("task-inline-preview--reading-mode"),a}};function rE(n){return new nm(n).createPostProcessor()}var ia=require("@codemirror/view"),$d=require("@codemirror/state"),ts=require("obsidian");ui();var iE=require("obsidian"),ra=class{constructor(t){this.plugin=t}async getTasksLinkedToProject(t){try{let e=await this.plugin.cacheManager.getAllTasks(),r=t.basename,i=t.path;return e.filter(s=>!s.projects||s.projects.length===0?!1:s.projects.some(a=>{if(!a||typeof a!="string"||a.trim()==="")return!1;if(a.startsWith("[[")&&a.endsWith("]]")){let l=a.slice(2,-2).trim();if(!l)return!1;let c=this.plugin.app.metadataCache.getFirstLinkpathDest(l,"");return c&&c.path===t.path?!0:l===r||l===i}let o=String(a).trim();return o===r||o===i}))}catch(e){return console.error("Error getting tasks linked to project:",e),[]}}async isTaskUsedAsProject(t){try{let e=this.plugin.app.vault.getAbstractFileByPath(t);return e instanceof iE.TFile?(await this.getTasksLinkedToProject(e)).length>0:!1}catch(e){return console.error("Error checking if task is used as project:",e),!1}}sortTasks(t){return t.sort((e,r)=>{let i=this.plugin.statusManager.isCompletedStatus(e.status),s=this.plugin.statusManager.isCompletedStatus(r.status);if(i!==s)return i?1:-1;let a=this.plugin.priorityManager.getPriorityWeight(e.priority),o=this.plugin.priorityManager.getPriorityWeight(r.priority);return a!==o?o-a:e.due&&r.due?new Date(e.due).getTime()-new Date(r.due).getTime():e.due?-1:r.due?1:e.title.localeCompare(r.title)})}};var sm=$d.StateEffect.define(),am=class extends ia.WidgetType{constructor(e,r,i=0){super();this.plugin=e;this.tasks=r;this.version=i;this.groupedTasks=new Map;this.filterBar=null;this.savedViewsUnsubscribe=null;this.groupedTasks.set("all",[...r]),this.filterService=new tn(e.cacheManager,e.statusManager,e.priorityManager,e),this.currentQuery={type:"group",id:"root",conjunction:"and",children:[],sortKey:"priority",sortDirection:"desc",groupKey:"none"}}eq(e){return this.version===e.version&&this.tasks.length===e.tasks.length&&this.tasks.every((r,i)=>{let s=e.tasks[i];return r.title===s.title&&r.status===s.status&&r.priority===s.priority&&r.due===s.due&&r.scheduled===s.scheduled&&r.path===s.path&&JSON.stringify(r.contexts||[])===JSON.stringify(s.contexts||[])&&JSON.stringify(r.projects||[])===JSON.stringify(s.projects||[])&&JSON.stringify(r.tags||[])===JSON.stringify(s.tags||[])&&r.timeEstimate===s.timeEstimate&&r.recurrence===s.recurrence&&JSON.stringify(r.complete_instances||[])===JSON.stringify(s.complete_instances||[])})}destroy(){this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.savedViewsUnsubscribe&&(this.savedViewsUnsubscribe(),this.savedViewsUnsubscribe=null)}toDOM(e){let r=document.createElement("div");r.className="tasknotes-plugin project-note-subtasks project-subtasks-widget",r.setAttribute("contenteditable","false"),r.setAttribute("spellcheck","false"),r.setAttribute("data-widget-type","project-subtasks");let i=r.createEl("div",{cls:"project-note-subtasks__header"}),s=i.createEl("h3",{text:`Subtasks (${this.tasks.length})`,cls:"project-note-subtasks__title"});i.createEl("button",{text:"New",cls:"project-note-subtasks__new-btn"}).addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),this.createNewSubtask()});let o=r.createEl("div",{cls:"project-note-subtasks__content"});this.getCollapsedState()&&(s.classList.add("collapsed"),o.classList.add("collapsed")),s.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),s.classList.contains("collapsed")?(s.classList.remove("collapsed"),o.classList.remove("collapsed"),this.setCollapsedState(!1)):(s.classList.add("collapsed"),o.classList.add("collapsed"),this.setCollapsedState(!0))});let c=o.createEl("div",{cls:"project-note-subtasks__filter"}),d=o.createEl("div",{cls:"project-note-subtasks__list"});return this.initializeFilterBar(c).then(()=>{this.applyFiltersAndRender(d)}),this.renderTaskGroups(d),r}async initializeFilterBar(e){try{let r=await this.filterService.getFilterOptions();this.filterBar=new Xt(this.plugin.app,e,this.currentQuery,r);let i=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(i),this.filterBar.on("queryChange",s=>{this.currentQuery=s,this.applyFiltersAndRender()}),this.filterBar.on("saveView",s=>{this.plugin.viewStateManager.saveView(s.name,s.query,s.viewOptions)}),this.filterBar.on("deleteView",s=>{this.plugin.viewStateManager.deleteView(s)}),this.filterBar.on("reorderViews",(s,a)=>{this.plugin.viewStateManager.reorderSavedViews(s,a)}),this.savedViewsUnsubscribe=this.plugin.viewStateManager.on("saved-views-changed",s=>{this.filterBar&&this.filterBar.updateSavedViews(s)})}catch(r){console.error("Error initializing filter bar for subtasks:",r)}}async applyFiltersAndRender(e){try{let r=await this.filterService.getGroupedTasks(this.currentQuery),i=new Set(this.tasks.map(s=>s.path));this.groupedTasks.clear();for(let[s,a]of r){let o=a.filter(l=>i.has(l.path));o.length>0&&this.groupedTasks.set(s,o)}if(e)this.renderTaskGroups(e);else{let s=document.querySelector(".project-note-subtasks__list");s&&this.renderTaskGroups(s)}}catch(r){console.error("Error applying filters to subtasks:",r),this.groupedTasks.clear(),this.groupedTasks.set("all",[...this.tasks])}}renderTaskGroups(e){var s,a;e.empty();let r=0;for(let o of this.groupedTasks.values())r+=o.length;if(this.currentQuery.groupKey==="none"||this.groupedTasks.size<=1)(this.groupedTasks.size===1?Array.from(this.groupedTasks.values())[0]:this.groupedTasks.get("all")||[]).forEach(l=>{let c=Bt(l,this.plugin,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});c.classList.add("project-note-subtasks__task"),e.appendChild(c)});else for(let[o,l]of this.groupedTasks.entries()){if(l.length===0)continue;e.createEl("div",{cls:"project-note-subtasks__group-header"}).createEl("h4",{cls:"project-note-subtasks__group-title",text:this.getGroupDisplayName(o,l.length)});let d=e.createEl("div",{cls:"project-note-subtasks__group"});l.forEach(u=>{let h=Bt(u,this.plugin,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});h.classList.add("project-note-subtasks__task"),d.appendChild(h)})}let i=(a=(s=e.parentElement)==null?void 0:s.parentElement)==null?void 0:a.querySelector(".project-note-subtasks__title");i&&(i.textContent=`Subtasks (${r}${r!==this.tasks.length?` of ${this.tasks.length}`:""})`)}getGroupDisplayName(e,r){switch(e){case"none":case"all":return`All Tasks (${r})`;case"No Status":return`No Status (${r})`;case"No Priority":return`No Priority (${r})`;case"No Context":return`No Context (${r})`;case"No Project":return`No Project (${r})`;case"No Due Date":return`No Due Date (${r})`;case"No Scheduled Date":return`No Scheduled Date (${r})`;default:return`${e} (${r})`}}createNewSubtask(){let e=this.plugin.app.workspace.getActiveFile();if(!e)return;let r=`[[${e.basename}]]`;this.plugin.openTaskCreationModal({projects:[r]})}getCollapsedState(){try{return localStorage.getItem("tasknotes-project-subtasks-collapsed")==="true"}catch(e){return!1}}setCollapsedState(e){try{e?localStorage.setItem("tasknotes-project-subtasks-collapsed","true"):localStorage.removeItem("tasknotes-project-subtasks-collapsed")}catch(r){}}},om=class{constructor(t,e){this.plugin=e;this.cachedTasks=[];this.currentFile=null;this.eventListeners=[];this.version=0;this.view=t,this.projectService=new ra(e),this.decorations=this.buildDecorations(t),this.setupEventListeners(),this.loadTasksForCurrentFile(t)}update(t){this.view=t.view;let e=t.transactions.some(i=>i.effects.some(s=>s.is(sm)));(t.docChanged||t.viewportChanged||e)&&(this.decorations=this.buildDecorations(t.view));let r=this.getFileFromView(t.view);r!==this.currentFile&&(this.currentFile=r,this.loadTasksForCurrentFile(t.view))}destroy(){this.eventListeners.forEach(t=>{this.plugin.emitter.offref(t)}),this.eventListeners=[]}setupEventListeners(){let t=this.plugin.emitter.on(it,()=>{this.loadTasksForCurrentFile(this.view)}),e=this.plugin.emitter.on(xe,()=>{this.loadTasksForCurrentFile(this.view)}),r=this.plugin.emitter.on(Il,()=>{this.loadTasksForCurrentFile(this.view)}),i=this.plugin.emitter.on("settings-changed",()=>{this.loadTasksForCurrentFile(this.view)}),s=this.plugin.emitter.on("file-updated",l=>{this.loadTasksForCurrentFile(this.view)}),a=this.plugin.emitter.on("file-deleted",l=>{this.loadTasksForCurrentFile(this.view)}),o=this.plugin.emitter.on("file-renamed",l=>{this.loadTasksForCurrentFile(this.view)});this.eventListeners.push(t,e,r,i,s,a,o)}dispatchUpdate(){if(this.version++,this.view&&typeof this.view.dispatch=="function")try{this.view.dispatch({effects:[sm.of({forceUpdate:!0})]})}catch(t){console.error("Error dispatching project subtasks update:",t)}}async loadTasksForCurrentFile(t){let e=this.getFileFromView(t);if(e instanceof ts.TFile)try{let r=await this.projectService.getTasksLinkedToProject(e);(r.length!==this.cachedTasks.length||r.some((s,a)=>{let o=this.cachedTasks[a];return!o||s.title!==o.title||s.status!==o.status||s.priority!==o.priority||s.due!==o.due||s.path!==o.path}))&&(this.cachedTasks=r,this.dispatchUpdate())}catch(r){console.error("Error loading tasks for project note:",r)}else this.cachedTasks.length>0&&(this.cachedTasks=[],this.dispatchUpdate())}getFileFromView(t){let e=t.state.field(ts.editorInfoField,!1);return(e==null?void 0:e.file)||null}isTableCellEditor(t){try{let e=t.dom;if(e.closest("td, th")||e.closest(".cm-table-widget"))return!0;let s=t.state.field(ts.editorInfoField,!1);if(!(s!=null&&s.file)){let a=e.parentElement;for(;a&&a!==document.body;){if(a.tagName==="TABLE"||a.tagName==="TD"||a.tagName==="TH"||a.classList.contains("markdown-rendered"))return!0;a=a.parentElement}}return!1}catch(e){return console.debug("Error detecting table cell editor:",e),!1}}buildDecorations(t){let e=new $d.RangeSetBuilder;try{if(this.isTableCellEditor(t)||!this.plugin.settings.showProjectSubtasks||!t.state.field(ts.editorLivePreviewField)||this.cachedTasks.length===0)return e.finish();let r=t.state.doc;if(r.length===0)return e.finish();let i=this.findInsertionPosition(t,r);(i<0||i>r.length)&&(i=0);let s=ia.Decoration.widget({widget:new am(this.plugin,this.cachedTasks,this.version),side:1});e.add(i,i,s)}catch(r){console.error("Error building project note decorations:",r)}return e.finish()}findInsertionPosition(t,e){return e.lines===0?0:e.length}},iA={decorations:n=>n.decorations};function nE(n){return ia.ViewPlugin.fromClass(class extends om{constructor(t){super(t,n)}destroy(){super.destroy()}},iA)}function zd(n){if(!n||typeof n.dispatch!="function"){console.warn("Invalid EditorView passed to dispatchProjectSubtasksUpdate:",n);return}try{n.dispatch({effects:[sm.of({forceUpdate:!0})]})}catch(t){console.error("Error dispatching project subtasks update:",t)}}var qd=class{constructor(t){this.draggableInstances=new Map;this.plugin=t}makeTaskCardDraggable(t,e){if(this.draggableInstances.has(t))return;t.dataset.taskPath=e;let r=new dd(t);this.draggableInstances.set(t,r),t.style.cursor="grab",t.addEventListener("dragstart",i=>{t.classList.add("task-card--dragging"),i.dataTransfer&&(i.dataTransfer.setData("text/plain",e),i.dataTransfer.setData("application/x-task-path",e),i.dataTransfer.effectAllowed="copy")}),t.addEventListener("dragend",()=>{t.classList.remove("task-card--dragging")})}removeDraggable(t){let e=this.draggableInstances.get(t);e&&(e.destroy(),this.draggableInstances.delete(t))}destroy(){this.draggableInstances.forEach(t=>{t.destroy()}),this.draggableInstances.clear()}};we();var ln=require("obsidian"),cn=Ve(sE());var Gd=class extends Pr{constructor(e){super();this.subscriptions=[];this.cache=new Map;this.refreshTimers=new Map;this.fileWatchers=new Map;this.plugin=e}async initialize(){await this.loadSubscriptions(),this.subscriptions.forEach(e=>{e.enabled&&(e.type==="remote"?this.startRefreshTimer(e):e.type==="local"&&this.startFileWatcher(e))}),this.emit("data-changed")}async loadSubscriptions(){try{let e=await this.plugin.loadData();this.subscriptions=(e==null?void 0:e.icsSubscriptions)||[]}catch(e){console.error("Failed to load ICS subscriptions:",e),this.subscriptions=[]}}async saveSubscriptions(){try{let e=await this.plugin.loadData()||{};e.icsSubscriptions=this.subscriptions,await this.plugin.saveData(e)}catch(e){throw console.error("Failed to save ICS subscriptions:",e),e}}getSubscriptions(){return[...this.subscriptions]}async addSubscription(e){let r={...e,id:this.generateId()};return this.subscriptions.push(r),await this.saveSubscriptions(),r.enabled&&(r.type==="remote"?(this.startRefreshTimer(r),await this.fetchSubscription(r.id)):r.type==="local"&&(this.startFileWatcher(r),await this.fetchSubscription(r.id))),this.emit("data-changed"),r}async updateSubscription(e,r){let i=this.subscriptions.findIndex(o=>o.id===e);if(i===-1)throw new Error("Subscription not found");let s=this.subscriptions[i],a={...s,...r};this.subscriptions[i]=a,await this.saveSubscriptions(),this.stopRefreshTimer(e),this.stopFileWatcher(e),a.enabled&&(a.type==="remote"?this.startRefreshTimer(a):a.type==="local"&&this.startFileWatcher(a)),(r.url&&r.url!==s.url||r.filePath&&r.filePath!==s.filePath)&&this.cache.delete(e),this.emit("data-changed")}async removeSubscription(e){let r=this.subscriptions.findIndex(i=>i.id===e);if(r===-1)throw new Error("Subscription not found");this.subscriptions.splice(r,1),await this.saveSubscriptions(),this.stopRefreshTimer(e),this.stopFileWatcher(e),this.cache.delete(e),this.emit("data-changed")}async fetchSubscription(e){let r=this.subscriptions.find(i=>i.id===e);if(!(!r||!r.enabled))try{let i;if(r.type==="remote"){if(!r.url)throw new Error("Remote subscription missing URL");i=(await(0,ln.requestUrl)({url:r.url,method:"GET",headers:{Accept:"text/calendar,application/calendar+xml,text/plain","User-Agent":"TaskNotes-Plugin/1.0"}})).text}else if(r.type==="local"){if(!r.filePath)throw new Error("Local subscription missing file path");i=await this.readLocalICSFile(r.filePath)}else throw new Error("Unknown subscription type");let s=this.parseICS(i,r.id),a={subscriptionId:e,events:s,lastUpdated:new Date().toISOString(),expires:new Date(Date.now()+r.refreshInterval*60*1e3).toISOString()};this.cache.set(e,a),await this.updateSubscription(e,{lastFetched:new Date().toISOString(),lastError:void 0}),this.emit("data-changed")}catch(i){let s=i instanceof Error?i.message:String(i);await this.updateSubscription(e,{lastError:s}),r.type==="remote"?s.includes("404")?new ln.Notice(`Calendar "${r.name}" not found (404). Please check the ICS URL is correct and the calendar is publicly accessible.`):new ln.Notice(`Failed to fetch remote calendar "${r.name}": ${s}`):new ln.Notice(`Failed to read local calendar "${r.name}": ${s}`)}}parseICS(e,r){try{let i=cn.parse(e),a=new cn.Component(i).getAllSubcomponents("vevent"),o=[];return a.forEach(l=>{try{let c=new cn.Event(l),d=c.summary||"Untitled Event",u=c.description||void 0,h=c.location||void 0,f=c.startDate,p=c.endDate;if(!f)return;let m=f.isDate,g=f.toJSDate().toISOString(),v=p?p.toJSDate().toISOString():void 0,T=c.uid||`${r}-${o.length}`,k=`${r}-${T}`,D={id:k,subscriptionId:r,title:d,description:u,start:g,end:v,allDay:m,location:h,url:c.url||void 0};if(c.isRecurring()){let M=c.iterator(f),E=new cn.Time;E.fromJSDate(new Date(Date.now()+365*24*60*60*1e3));let C,S=0,O=100;for(;(C=M.next())&&S<O&&!(C.compare(E)>0);){let F=C.toJSDate().toISOString(),P=v;if(p&&f){let x=p.toJSDate().getTime()-f.toJSDate().getTime();P=new Date(C.toJSDate().getTime()+x).toISOString()}o.push({...D,id:`${k}-${S}`,start:F,end:P}),S++}}else o.push(D)}catch(c){console.warn("Failed to parse individual event:",c)}}),o}catch(i){throw console.error("Failed to parse ICS data:",i),new Error("Invalid ICS format")}}getAllEvents(){let e=[];return this.cache.forEach(r=>{new Date(r.expires)>new Date&&e.push(...r.events)}),e}getEventsForSubscription(e){let r=this.cache.get(e);return!r||new Date(r.expires)<=new Date?[]:[...r.events]}async refreshAllSubscriptions(){let e=this.subscriptions.filter(r=>r.enabled);for(let r of e)await this.fetchSubscription(r.id)}async readLocalICSFile(e){try{let r=this.plugin.app.vault.getAbstractFileByPath(e);if(!r||!(r instanceof ln.TFile))throw new Error(`File not found: ${e}`);if(r.extension!=="ics")throw new Error(`File is not an ICS file: ${e}`);return await this.plugin.app.vault.cachedRead(r)}catch(r){throw new Error(`Failed to read local ICS file "${e}": ${r instanceof Error?r.message:String(r)}`)}}startFileWatcher(e){if(!e.filePath)return;this.stopFileWatcher(e.id);let r=(c,d)=>{(c.path===e.filePath||d===e.filePath)&&setTimeout(()=>{this.fetchSubscription(e.id)},1e3)},i=this.plugin.app.vault.on("modify",r),s=this.plugin.app.vault.on("rename",r),a=this.plugin.app.vault.on("delete",c=>{c.path===e.filePath&&this.updateSubscription(e.id,{lastError:"Local ICS file was deleted"})});this.fileWatchers.set(e.id,()=>{this.plugin.app.vault.offref(i),this.plugin.app.vault.offref(s),this.plugin.app.vault.offref(a)});let o=e.refreshInterval*60*1e3,l=setInterval(()=>{this.fetchSubscription(e.id)},o);this.refreshTimers.set(e.id,l)}stopFileWatcher(e){let r=this.fileWatchers.get(e);r&&(r(),this.fileWatchers.delete(e))}async refreshSubscription(e){await this.fetchSubscription(e)}startRefreshTimer(e){this.stopRefreshTimer(e.id);let r=e.refreshInterval*60*1e3,i=setInterval(()=>{this.fetchSubscription(e.id)},r);this.refreshTimers.set(e.id,i)}stopRefreshTimer(e){let r=this.refreshTimers.get(e);r&&(clearInterval(r),this.refreshTimers.delete(e))}generateId(){return"ics_"+Math.random().toString(36).substring(2,11)+Date.now().toString(36)}destroy(){this.refreshTimers.forEach(e=>clearInterval(e)),this.refreshTimers.clear(),this.fileWatchers.forEach(e=>e()),this.fileWatchers.clear(),this.cache.clear(),this.removeAllListeners()}getLocalICSFiles(){return this.plugin.app.vault.getFiles().filter(e=>e.extension==="ics").sort((e,r)=>e.path.localeCompare(r.path))}};var fi=require("obsidian");je();we();at();var Qd=class{constructor(t){this.plugin=t}async createTaskFromICS(t,e){try{let r=this.plugin.icsSubscriptionService.getSubscriptions().find(a=>a.id===t.subscriptionId),i=(r==null?void 0:r.name)||"Unknown Calendar",s={title:(e==null?void 0:e.title)||t.title,status:(e==null?void 0:e.status)||this.plugin.settings.defaultTaskStatus,priority:(e==null?void 0:e.priority)||this.plugin.settings.defaultTaskPriority,due:(e==null?void 0:e.due)||void 0,scheduled:(e==null?void 0:e.scheduled)||(t.start?t.start:void 0),contexts:(e==null?void 0:e.contexts)||(t.location?[t.location]:void 0),projects:e==null?void 0:e.projects,tags:(e==null?void 0:e.tags)||[this.plugin.fieldMapper.toUserField("icsEventTag")],timeEstimate:(e==null?void 0:e.timeEstimate)||this.calculateEventDuration(t),details:(e==null?void 0:e.details)||this.buildICSEventDetails(t,i),icsEventId:[t.id],creationContext:"ics-event",dateCreated:ce(),dateModified:ce(),...e};return await this.plugin.taskService.createTask(s)}catch(r){let i=r instanceof Error?r.message:String(r);throw console.error("Error creating task from ICS event:",{error:i,icsEventId:t.id,icsEventTitle:t.title}),new Error(`Failed to create task from ICS event: ${i}`)}}async createNoteFromICS(t,e){var r;try{let i=this.plugin.icsSubscriptionService.getSubscriptions().find(k=>k.id===t.subscriptionId),s=(i==null?void 0:i.name)||"Unknown Calendar",a=(e==null?void 0:e.title)||`${t.title} - ${I(new Date(t.start),"PPP")}`,o=(e==null?void 0:e.folder)||((r=this.plugin.settings.icsIntegration)==null?void 0:r.defaultNoteFolder)||"",l={title:a,priority:"",status:"",date:new Date(t.start),dueDate:t.end,scheduledDate:t.start},c=Ys(l,this.plugin.settings),d=await _o(c,o,this.plugin.app.vault),u=o?`${o}/${d}.md`:`${d}.md`;o&&await Kl(this.plugin.app.vault,o);let h={title:a,priority:"",status:"",contexts:t.location?[t.location]:[],tags:[this.plugin.fieldMapper.toUserField("icsEventTag")],timeEstimate:0,dueDate:t.end||"",scheduledDate:t.start||"",details:t.description||"",parentNote:"",icsEventTitle:t.title,icsEventStart:t.start,icsEventEnd:t.end||"",icsEventLocation:t.location||"",icsEventDescription:t.description||"",icsEventUrl:t.url||"",icsEventSubscription:s,icsEventId:t.id},f={title:a,dateCreated:ce(),dateModified:ce(),tags:[this.plugin.fieldMapper.toUserField("icsEventTag")],[this.plugin.fieldMapper.toUserField("icsEventId")]:[t.id]},p=this.buildICSEventDetails(t,s);if(e!=null&&e.template)try{let k=(0,fi.normalizePath)(e.template.trim()),D=this.plugin.app.vault.getAbstractFileByPath(k.endsWith(".md")?k:`${k}.md`);if(D instanceof fi.TFile){let M=await this.plugin.app.vault.read(D),E=Yd(M,h);f={...f,...E.frontmatter},p=E.body||p}else console.warn(`ICS note template not found: ${k}`),new fi.Notice(`Template not found: ${k}`)}catch(k){console.error("Error processing ICS note template:",k),new fi.Notice(`Error processing template: ${e.template}`)}let g=`${Object.keys(f).length>0?`---
${Object.entries(f).map(([k,D])=>`${k}: ${this.formatYamlValue(D)}`).join(`
`)}
---

`:""}${p}`,v=await this.plugin.app.vault.create(u,g),T={title:a,path:v.path,tags:f.tags||[],createdDate:f.dateCreated,lastModified:Date.now()};return{file:v,noteInfo:T}}catch(i){let s=i instanceof Error?i.message:String(i);throw console.error("Error creating note from ICS event:",{error:s,icsEventId:t.id,icsEventTitle:t.title}),new Error(`Failed to create note from ICS event: ${s}`)}}async findRelatedNotes(t){try{let e=[],r=this.plugin.fieldMapper.toUserField("icsEventId"),i=await this.plugin.cacheManager.getAllTasks();for(let a of i)a.icsEventId&&a.icsEventId.includes(t.id)&&e.push(a);let s=this.plugin.app.vault.getMarkdownFiles();for(let a of s)try{let o=this.plugin.app.metadataCache.getFileCache(a),l=o==null?void 0:o.frontmatter,c=l==null?void 0:l[r],d=Array.isArray(c)?c.includes(t.id):c===t.id;if(l&&d){let u={title:l.title||a.basename,path:a.path,tags:l.tags||[],createdDate:l.dateCreated,lastModified:a.stat.mtime};e.push(u)}}catch(o){continue}return e}catch(e){return console.error("Error finding related notes for ICS event:",e),[]}}async linkNoteToICS(t,e){try{let r=this.plugin.app.vault.getAbstractFileByPath(t);if(!(r instanceof fi.TFile))throw new Error(`Cannot find note file: ${t}`);await this.plugin.app.fileManager.processFrontMatter(r,i=>{let s=this.plugin.fieldMapper.toUserField("icsEventId"),a=i[s];a?Array.isArray(a)||(a=[a]):a=[],a.includes(e.id)||a.push(e.id),i[s]=a,i.dateModified=ce()}),new fi.Notice(`Linked note to ICS event: ${e.title}`)}catch(r){let i=r instanceof Error?r.message:String(r);throw console.error("Error linking note to ICS event:",{error:i,notePath:t,icsEventId:e.id}),new Error(`Failed to link note to ICS event: ${i}`)}}buildICSEventDetails(t,e){let r=[];if(r.push(`# ${t.title}`),r.push(""),t.start){let i=new Date(t.start);r.push(`**Start:** ${I(i,"PPPp")}`)}if(t.end&&!t.allDay){let i=new Date(t.end);r.push(`**End:** ${I(i,"PPPp")}`)}return t.location&&r.push(`**Location:** ${t.location}`),r.push(`**Calendar:** ${e}`),t.description&&(r.push(""),r.push("## Description"),r.push(t.description)),t.url&&(r.push(""),r.push(`**Event URL:** ${t.url}`)),r.join(`
`)}formatYamlValue(t){return typeof t=="string"?t.includes(":")||t.includes("#")||t.includes("[")||t.includes("{")?`"${t.replace(/"/g,'\\"')}"`:t:Array.isArray(t)?`[${t.map(e=>typeof e=="string"?`"${e}"`:e).join(", ")}]`:String(t)}calculateEventDuration(t){if(!(!t.start||!t.end))try{let e=new Date(t.start).getTime(),r=new Date(t.end).getTime();if(isNaN(e)||isNaN(r))return;let i=r-e,s=Math.round(i/(1e3*60));return s>0&&s<1440?s:void 0}catch(e){console.warn("Error calculating event duration:",e);return}}};at();var Kd=class{constructor(t){this.migrationInProgress=!1;this.app=t}async needsMigration(){var e;let t=this.app.vault.getMarkdownFiles().filter(r=>{var i,s;return r.path.includes("task")||((s=(i=this.app.metadataCache.getFileCache(r))==null?void 0:i.frontmatter)==null?void 0:s.status)});for(let r of t){let i=(e=this.app.metadataCache.getFileCache(r))==null?void 0:e.frontmatter;if(i!=null&&i.recurrence&&typeof i.recurrence=="object")return!0}return!1}async getMigrationCount(){var r;let t=this.app.vault.getMarkdownFiles().filter(i=>{var s,a;return i.path.includes("task")||((a=(s=this.app.metadataCache.getFileCache(i))==null?void 0:s.frontmatter)==null?void 0:a.status)}),e=0;for(let i of t){let s=(r=this.app.metadataCache.getFileCache(i))==null?void 0:r.frontmatter;s!=null&&s.recurrence&&typeof s.recurrence=="object"&&e++}return e}async performMigration(t){if(this.migrationInProgress)throw new Error("Migration already in progress");this.migrationInProgress=!0;let e=[],r=0;try{let i=this.app.vault.getMarkdownFiles().filter(a=>{var l;let o=(l=this.app.metadataCache.getFileCache(a))==null?void 0:l.frontmatter;return(o==null?void 0:o.recurrence)&&typeof o.recurrence=="object"}),s=i.length;for(let a=0;a<i.length;a++){let o=i[a];t&&t(a+1,s,o.name),await this.migrateFile(o).then(()=>{r++}).catch(l=>{let c=`Failed to migrate ${o.path}: ${l instanceof Error?l.message:String(l)}`;e.push(c),console.error(c,l)}),a%10===0&&await new Promise(l=>setTimeout(l,50))}return{success:r,errors:e}}finally{this.migrationInProgress=!1}}async migrateFile(t){await this.app.fileManager.processFrontMatter(t,e=>{if(!(!e.recurrence||typeof e.recurrence!="object"))try{let r=ah(e.recurrence);e.recurrence=r}catch(r){throw new Error(`Failed to convert recurrence to rrule: ${r instanceof Error?r.message:String(r)}`)}})}isMigrationInProgress(){return this.migrationInProgress}};var Mt=require("obsidian"),cm=class extends Mt.Modal{constructor(e,r){super(e);this.migrationCount=0;this.migrationService=r}async onOpen(){let{contentEl:e}=this;if(e.empty(),this.migrationCount=await this.migrationService.getMigrationCount(),new Mt.Setting(e).setName("Recurrence system migration").setHeading(),e.createEl("p",{text:"TaskNotes has an updated, more powerful recurrence system based on the RFC 5545 standard. This migration will convert your existing recurring tasks to use the new format."}),e.createEl("p",{text:`Found ${this.migrationCount} task(s) that need migration.`}),this.migrationCount===0){e.createEl("p",{text:"No migration needed! All your tasks are already using the new recurrence format.",cls:"text-success"}),new Mt.Setting(e).addButton(f=>{f.setButtonText("Close").setCta().onClick(()=>this.close())});return}let r=e.createDiv("migration-warning");new Mt.Setting(r).setName("\u26A0\uFE0F Important notes").setHeading();let i=r.createEl("ul");i.createEl("li",{text:"We strongly recommend backing up your vault before proceeding."}),i.createEl("li",{text:"The migration will convert your recurrence objects to standardized rrule strings."}),i.createEl("li",{text:"You can continue using your tasks normally after migration."}),i.createEl("li",{text:"The migration is permanent - your legacy recurrence objects will be replaced."});let s=e.createDiv("migration-benefits");new Mt.Setting(s).setName("\u2728 What You Get").setHeading();let a=s.createEl("ul");a.createEl("li",{text:'More powerful recurrence patterns (e.g., "every other Tuesday", "last Friday of the month")'}),a.createEl("li",{text:"Better performance for calendar views"}),a.createEl("li",{text:"Improved compatibility with calendar standards"}),a.createEl("li",{text:"Enhanced natural language processing for task creation"});let o=e.createDiv("migration-progress");o.style.display="none",new Mt.Setting(o).setName("Migration progress").setHeading();let l=o.createEl("progress");l.max=this.migrationCount,l.value=0;let c=o.createEl("p",{text:"Preparing migration..."}),d=e.createDiv("migration-buttons");d.style.display="flex",d.style.gap="10px",d.style.marginTop="20px";let u=d.createEl("button",{text:"Cancel"});u.onclick=()=>this.close();let h=d.createEl("button",{text:`Migrate ${this.migrationCount} Task(s)`,cls:"mod-cta"});h.onclick=async()=>{h.disabled=!0,u.disabled=!0,o.style.display="block";try{let f=await this.migrationService.performMigration((p,m,g)=>{l.value=p,c.textContent=`Migrating ${p}/${m}: ${g}`});if(c.textContent=`Migration completed! ${f.success} files migrated successfully.`,f.errors.length>0){let p=o.createDiv("migration-errors");new Mt.Setting(p).setName("\u26A0\uFE0F Errors Encountered").setHeading();let m=p.createEl("ul");f.errors.forEach(g=>{m.createEl("li",{text:g})}),new Mt.Notice(`Migration completed with ${f.errors.length} errors. Check the migration modal for details.`,1e4)}else new Mt.Notice(`Migration completed successfully! ${f.success} tasks migrated.`,5e3);h.textContent="Migration Complete",u.textContent="Close",u.disabled=!1}catch(f){c.textContent=`Migration failed: ${f instanceof Error?f.message:String(f)}`,new Mt.Notice(`Migration failed: ${f instanceof Error?f.message:String(f)}`,1e4),h.disabled=!1,u.disabled=!1}}}onClose(){let{contentEl:e}=this;e.empty()}};function aE(n,t){let e=new Mt.Notice("",0),r=e.messageEl.createDiv();r.style.display="flex",r.style.flexDirection="column",r.style.gap="12px",r.style.padding="8px";let i=r.createSpan();i.textContent="TaskNotes has an updated recurrence system. Migrate your existing recurring tasks to continue using them.",i.style.lineHeight="1.4",i.style.marginBottom="4px";let s=r.createDiv();s.style.display="flex",s.style.gap="8px",s.style.justifyContent="flex-end",s.style.alignItems="center";let a=s.createEl("button",{text:"Migrate Now",cls:"mod-cta"}),o=s.createEl("button",{text:"Remind Later"});a.onclick=()=>{e.hide(),new cm(n,t).open()},o.onclick=()=>{e.hide()}}var dm=require("obsidian"),Zd=class{constructor(t){this.statusBarElement=null;this.updateTimeout=null;this.plugin=t,this.requestDeduplicator=new Xs}initialize(){this.plugin.settings.showTrackedTasksInStatusBar&&(this.statusBarElement=this.plugin.addStatusBarItem(),this.statusBarElement.addClass("tasknotes-status-bar"),this.statusBarElement.style.cursor="pointer",this.statusBarElement.addEventListener("click",()=>{this.handleStatusBarClick()}),this.updateStatusBar())}async updateStatusBar(){if(!(!this.statusBarElement||!this.plugin.settings.showTrackedTasksInStatusBar))try{let t=await this.requestDeduplicator.execute("update-status-bar",()=>this.getTrackedTasks());this.renderStatusBar(t)}catch(t){console.error("Error updating status bar:",t)}}async getTrackedTasks(){return(await this.plugin.cacheManager.getAllTasks()).filter(e=>e.archived?!1:this.plugin.getActiveTimeSession(e)!==null)}renderStatusBar(t){if(!this.statusBarElement)return;let e=t.length;if(e===0){this.statusBarElement.style.display="none";return}this.statusBarElement.style.display="",this.statusBarElement.empty(),this.statusBarElement.createEl("span",{cls:"tasknotes-status-icon",text:"\u23F1\uFE0F"});let r=this.statusBarElement.createEl("span",{cls:"tasknotes-status-text"});if(e===1){let i=t[0],s=i.title.length>30?i.title.substring(0,30)+"...":i.title;r.setText(`Tracking: ${s}`),(0,dm.setTooltip)(this.statusBarElement,`Currently tracking: ${i.title}`,{placement:"top"})}else{r.setText(`Tracking ${e} tasks`);let i=t.slice(0,5).map(a=>a.title).join(`
`),s=e>5?`${i}
... and ${e-5} more`:i;(0,dm.setTooltip)(this.statusBarElement,`Currently tracking:
${s}`,{placement:"top"})}}async handleStatusBarClick(){try{if((await this.getTrackedTasks()).length===0)return;await this.plugin.activateTasksView()}catch(t){console.error("Error handling status bar click:",t)}}requestUpdate(){this.updateTimeout&&window.clearTimeout(this.updateTimeout),this.updateTimeout=window.setTimeout(()=>{this.updateStatusBar()},100)}updateVisibility(){this.plugin.settings.showTrackedTasksInStatusBar?this.statusBarElement?this.updateStatusBar():this.initialize():this.hide()}hide(){this.statusBarElement&&(this.statusBarElement.style.display="none")}destroy(){this.updateTimeout&&(window.clearTimeout(this.updateTimeout),this.updateTimeout=null),this.requestDeduplicator&&this.requestDeduplicator.cancelAll(),this.statusBarElement=null}};var gl=class extends ee.Plugin{constructor(){super(...arguments);this.previousCacheSettings=null;this.previousTimeTrackingSettings=null;this.selectedDate=new Date;this.taskUpdateListenerForEditor=null;this.initializationComplete=!1;this.migrationComplete=!1;this.migrationPromise=null}async onload(){this.readyPromise=new Promise(e=>{this.resolveReady=e}),await this.loadSettings(),this.fieldMapper=new vs(this.settings.fieldMapping),this.statusManager=new wi(this.settings.customStatuses),this.priorityManager=new Hr(this.settings.customPriorities),this.requestDeduplicator=new Xs,this.predictivePrefetcher=new Bd(this.requestDeduplicator),this.domReconciler=new ea,this.uiStateManager=new Hd,this.cacheManager=new Fd(this.app,this.settings.taskTag,this.settings.excludedFolders,this.fieldMapper,this.settings.disableNoteIndexing,this.settings.storeTitleInFilename),this.emitter=this.cacheManager,this.taskService=new Ud(this),this.filterService=new tn(this.cacheManager,this.statusManager,this.priorityManager,this),this.viewStateManager=new Vd(this.app,this),this.projectSubtasksService=new ra(this),this.dragDropManager=new qd(this),this.migrationService=new Kd(this.app),this.statusBarService=new Zd(this),this.addRibbonIcon("calendar-days","Open mini calendar",async()=>{await this.activateCalendarView()}),this.addRibbonIcon("calendar","Open advanced calendar",async()=>{await this.activateAdvancedCalendarView()}),this.addRibbonIcon("check-square","Open task list",async()=>{await this.activateTasksView()}),this.addRibbonIcon("sticky-note","Open notes",async()=>{await this.activateNotesView()}),this.addRibbonIcon("list","Open agenda",async()=>{await this.activateAgendaView()}),this.addRibbonIcon("columns-3","Open kanban board",async()=>{await this.activateKanbanView()}),this.addRibbonIcon("timer","Open pomodoro",async()=>{await this.activatePomodoroView()}),this.addRibbonIcon("bar-chart-3","Open pomodoro stats",async()=>{await this.activatePomodoroStatsView()}),this.addRibbonIcon("plus","Create new task",()=>{this.openTaskCreationModal()}),this.addCommands(),this.addSettingTab(new Ml(this.app,this)),this.migrationPromise=this.performEarlyMigrationCheck(),this.app.workspace.onLayoutReady(()=>{this.initializeAfterLayoutReady()}),this.resolveReady()}async initializeAfterLayoutReady(){if(!this.initializationComplete){this.initializationComplete=!0;try{this.injectCustomStyles(),this.registerView(ls,e=>new La(e,this)),this.registerView(Ur,e=>new Id(e,this)),this.registerView(bi,e=>new ol(e,this)),this.registerView(ya,e=>new Nd(e,this)),this.registerView(Ti,e=>new ll(e,this)),this.registerView(va,e=>new Od(e,this)),this.registerView(wa,e=>new Rd(e,this)),this.registerView(ir,e=>new dl(e,this)),this.registerEditorExtension(tE(this)),this.registerEditorExtension(nE(this)),this.registerMarkdownPostProcessor(rE(this)),this.cacheManager.initialize(),this.filterService.initialize(),this.statusBarService.initialize(),this.initializeServicesLazily()}catch(e){console.error("Error during post-layout initialization:",e)}}}initializeServicesLazily(){setTimeout(async()=>{try{this.pomodoroService=new Ld(this),await this.pomodoroService.initialize(),this.icsSubscriptionService=new Gd(this),await this.icsSubscriptionService.initialize(),this.icsNoteService=new Qd(this);let{TaskLinkDetectionService:e}=await Promise.resolve().then(()=>(tm(),XT));this.taskLinkDetectionService=new e(this);let{InstantTaskConvertService:r}=await Promise.resolve().then(()=>(lE(),oE));this.instantTaskConvertService=new r(this,this.statusManager,this.priorityManager);let{createInstantConvertButtons:i}=await Promise.resolve().then(()=>(uE(),dE));this.registerEditorExtension(i(this)),this.taskUpdateListenerForEditor=this.emitter.on(xe,s=>{this.app.workspace.iterateRootLeaves(a=>{var o;if(a.view&&a.view.getViewType()==="markdown"){let l=a.view.editor;if(l&&l.cm){let c=(s==null?void 0:s.path)||((o=s==null?void 0:s.updatedTask)==null?void 0:o.path);an(l.cm,c),zd(l.cm)}}})}),this.registerEvent(this.app.workspace.on("active-leaf-change",s=>{setTimeout(()=>{if(s&&s.view&&s.view.getViewType()==="markdown"){let a=s.view.editor;a&&a.cm&&(an(a.cm),zd(a.cm))}},50)})),this.registerEvent(this.app.workspace.on("layout-change",()=>{setTimeout(()=>{let s=this.app.workspace.getActiveViewOfType(ee.MarkdownView);if(s){let a=s.editor;a&&a.cm&&(an(a.cm),zd(a.cm))}},100)})),this.setupStatusBarEventListeners(),this.setupTimeTrackingEventListeners(),await this.showMigrationPromptsIfNeeded()}catch(e){console.error("Error during lazy service initialization:",e)}},10)}async onReady(){if(!this.readyPromise)throw new Error("Plugin not yet initialized");await this.readyPromise}setupStatusBarEventListeners(){this.statusBarService&&(this.registerEvent(this.emitter.on(xe,()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on(it,()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.pomodoroService&&(this.registerEvent(this.emitter.on("pomodoro-start",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on("pomodoro-stop",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on("pomodoro-state-changed",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)}))))}setupTimeTrackingEventListeners(){if(this.settings.autoStopTimeTrackingOnComplete){let e=this.emitter.on(xe,async r=>{await this.handleAutoStopTimeTracking(r)});this.registerEvent(e)}this.updatePreviousTimeTrackingSettings()}async handleAutoStopTimeTracking(e){let{originalTask:r,updatedTask:i}=e;if(!r||!i)return;let s=this.statusManager.isCompletedStatus(r.status),a=this.statusManager.isCompletedStatus(i.status);if(!s&&a&&this.getActiveTimeSession(i))try{await this.stopTimeTracking(i),this.settings.autoStopTimeTrackingNotification&&new ee.Notice(`Auto-stopped time tracking for: ${i.title}`),console.log(`Auto-stopped time tracking for completed task: ${i.title}`)}catch(l){console.error("Error auto-stopping time tracking:",l)}}haveTimeTrackingSettingsChanged(){return this.previousTimeTrackingSettings?this.settings.autoStopTimeTrackingOnComplete!==this.previousTimeTrackingSettings.autoStopTimeTrackingOnComplete:!0}updatePreviousTimeTrackingSettings(){this.previousTimeTrackingSettings={autoStopTimeTrackingOnComplete:this.settings.autoStopTimeTrackingOnComplete}}async performEarlyMigrationCheck(){try{if(console.log("TaskNotes: Starting early migration check..."),await this.viewStateManager.initializeSavedViews(),this.viewStateManager.needsMigration()&&(console.log("TaskNotes: Performing view state migration..."),await this.viewStateManager.performMigration()),this.settings.recurrenceMigrated===!0){this.migrationComplete=!0;return}if(!await this.migrationService.needsMigration()){this.settings.recurrenceMigrated=!0,await this.saveSettings(),this.migrationComplete=!0;return}this.migrationComplete=!0,console.log("TaskNotes: Early migration check complete. Will show prompts after UI initialization.")}catch(e){console.error("Error during early migration check:",e),this.migrationComplete=!0}}async showMigrationPromptsIfNeeded(){try{if(this.settings.recurrenceMigrated===!0)return;await this.migrationService.needsMigration()&&setTimeout(()=>{aE(this.app,this.migrationService)},1e3)}catch(e){console.error("Error showing migration prompts:",e)}}async waitForMigration(){for(this.migrationPromise&&await this.migrationPromise;!this.migrationComplete;)await new Promise(e=>setTimeout(e,50))}setSelectedDate(e){this.selectedDate=e,this.emitter.trigger(Ei,e)}notifyDataChanged(e,r=!1,i=!0){e?(this.cacheManager.clearCacheEntry(e),this.taskLinkDetectionService&&this.taskLinkDetectionService.clearCacheForFile(e)):r&&(this.cacheManager.clearAllCaches(),this.taskLinkDetectionService&&this.taskLinkDetectionService.clearCache()),i&&requestAnimationFrame(()=>{this.emitter.trigger(it)})}onunload(){let e=Qr.getStats("cache-initialization");e&&e.count>0&&Qr.logSummary(),this.pomodoroService&&this.pomodoroService.cleanup(),this.filterService&&this.filterService.cleanup(),this.icsSubscriptionService&&this.icsSubscriptionService.destroy(),this.taskLinkDetectionService&&this.taskLinkDetectionService.cleanup(),this.dragDropManager&&this.dragDropManager.destroy(),this.viewStateManager&&this.viewStateManager.cleanup(),this.statusBarService&&this.statusBarService.destroy(),this.cacheManager&&this.cacheManager.destroy(),this.requestDeduplicator&&this.requestDeduplicator.cancelAll(),this.domReconciler&&this.domReconciler.destroy(),this.uiStateManager&&this.uiStateManager.destroy(),typeof Qr!="undefined"&&Qr.destroy(),this.taskUpdateListenerForEditor&&this.emitter.offref(this.taskUpdateListenerForEditor),this.emitter&&this.emitter.off,this.initializationComplete=!1}async loadSettings(){let e=await this.loadData();e&&"useNativeMetadataCache"in e&&delete e.useNativeMetadataCache,this.settings={...mr,...e,fieldMapping:{...mr.fieldMapping,...(e==null?void 0:e.fieldMapping)||{}},customStatuses:(e==null?void 0:e.customStatuses)||mr.customStatuses,customPriorities:(e==null?void 0:e.customPriorities)||mr.customPriorities,calendarViewSettings:{...mr.calendarViewSettings,...(e==null?void 0:e.calendarViewSettings)||{}}};let r=Object.keys(mr.fieldMapping).some(s=>{var a;return!((a=e==null?void 0:e.fieldMapping)!=null&&a[s])}),i=Object.keys(mr.calendarViewSettings).some(s=>{var a;return!((a=e==null?void 0:e.calendarViewSettings)!=null&&a[s])});(r||i)&&setTimeout(async()=>{try{let s=await this.loadData()||{},a=Object.keys(mr);for(let o of a)s[o]=this.settings[o];await this.saveData(s)}catch(s){console.error("Failed to save migrated settings:",s)}},100),this.updatePreviousCacheSettings()}async saveSettings(){let e=await this.loadData()||{},r=Object.keys(mr);for(let a of r)e[a]=this.settings[a];await this.saveData(e);let i=this.haveCacheSettingsChanged(),s=this.haveTimeTrackingSettingsChanged();this.fieldMapper&&this.fieldMapper.updateMapping(this.settings.fieldMapping),this.statusManager&&this.statusManager.updateStatuses(this.settings.customStatuses),this.priorityManager&&this.priorityManager.updatePriorities(this.settings.customPriorities),i&&(console.debug("Cache-related settings changed, updating cache configuration"),this.cacheManager.updateConfig(this.settings.taskTag,this.settings.excludedFolders,this.fieldMapper,this.settings.disableNoteIndexing,this.settings.storeTitleInFilename),this.updatePreviousCacheSettings()),this.injectCustomStyles(),s&&this.setupTimeTrackingEventListeners(),this.statusBarService&&this.statusBarService.updateVisibility(),this.notifyDataChanged(),this.emitter.trigger("settings-changed",this.settings)}addCommands(){this.addCommand({id:"open-calendar-view",name:"Open mini calendar view",callback:async()=>{await this.activateCalendarView()}}),this.addCommand({id:"open-advanced-calendar-view",name:"Open advanced calendar view",callback:async()=>{await this.activateAdvancedCalendarView()}}),this.addCommand({id:"open-tasks-view",name:"Open tasks view",callback:async()=>{await this.activateTasksView()}}),this.addCommand({id:"open-notes-view",name:"Open notes view",callback:async()=>{await this.activateNotesView()}}),this.addCommand({id:"open-agenda-view",name:"Open agenda view",callback:async()=>{await this.activateAgendaView()}}),this.addCommand({id:"open-pomodoro-view",name:"Open pomodoro timer",callback:async()=>{await this.activatePomodoroView()}}),this.addCommand({id:"open-kanban-view",name:"Open kanban board",callback:async()=>{await this.activateKanbanView()}}),this.addCommand({id:"open-pomodoro-stats",name:"Open pomodoro statistics",callback:async()=>{await this.activatePomodoroStatsView()}}),this.addCommand({id:"create-new-task",name:"Create new task",callback:()=>{this.openTaskCreationModal()}}),this.addCommand({id:"convert-to-tasknote",name:"Convert task to TaskNote",editorCallback:async e=>{await this.convertTaskToTaskNote(e)}}),this.addCommand({id:"batch-convert-all-tasks",name:"Convert all tasks in note",editorCallback:async e=>{await this.batchConvertAllTasks(e)}}),this.addCommand({id:"insert-tasknote-link",name:"Insert tasknote link",editorCallback:e=>{this.insertTaskNoteLink(e)}}),this.addCommand({id:"quick-actions-current-task",name:"Quick actions for current task",callback:async()=>{await this.openQuickActionsForCurrentTask()}}),this.addCommand({id:"go-to-today",name:"Go to today's note",callback:async()=>{await this.navigateToCurrentDailyNote()}}),this.addCommand({id:"start-pomodoro",name:"Start pomodoro timer",callback:async()=>{await this.pomodoroService.startPomodoro()}}),this.addCommand({id:"stop-pomodoro",name:"Stop pomodoro timer",callback:async()=>{await this.pomodoroService.stopPomodoro()}}),this.addCommand({id:"pause-pomodoro",name:"Pause/resume pomodoro timer",callback:async()=>{let e=this.pomodoroService.getState();e.isRunning?await this.pomodoroService.pausePomodoro():e.currentSession&&await this.pomodoroService.resumePomodoro()}}),this.addCommand({id:"refresh-cache",name:"Refresh cache",callback:async()=>{await this.refreshCache()}})}async activateView(e){let{workspace:r}=this.app,i=this.getLeafOfType(e);return i||(i=r.getLeaf("tab"),await i.setViewState({type:e,active:!0})),r.setActiveLeaf(i,{focus:!0}),r.revealLeaf(i),i}async activateCalendarView(){return this.activateView(ls)}async activateAdvancedCalendarView(){return this.activateView(Ur)}async activateTasksView(){return this.activateView(bi)}async activateNotesView(){return this.activateView(ya)}async activateAgendaView(){return this.activateView(Ti)}async activatePomodoroView(){return this.activateView(va)}async activatePomodoroStatsView(){return this.activateView(wa)}async activateKanbanView(){return this.activateView(ir)}getLeafOfType(e){let{workspace:r}=this.app,i=r.getLeavesOfType(e);for(let s of i)if(s.view&&s.view.getViewType()===e)return s;return i.length>0?i[0]:null}getCalendarLeaf(){return this.getLeafOfType(ls)}async navigateToCurrentDailyNote(){let e=new Date;await this.navigateToDailyNote(e)}async navigateToDailyNote(e){try{if(!(0,dn.appHasDailyNotesPluginLoaded)()){new ee.Notice("Daily Notes core plugin is not enabled. Please enable it in Settings > Core plugins.");return}let r=window.moment(e),i=(0,dn.getAllDailyNotes)(),s=(0,dn.getDailyNote)(r,i),a=!1;if(!s)try{s=await(0,dn.createDailyNote)(r),a=!0}catch(o){let l=o instanceof Error?o.message:String(o);console.error("Failed to create daily note:",o),new ee.Notice(`Failed to create daily note: ${l}`);return}s&&(await this.app.workspace.getLeaf(!1).openFile(s),a&&this.notifyDataChanged(s.path,!1,!0))}catch(r){let i=r instanceof Error?r.message:String(r);console.error("Failed to navigate to daily note:",r),new ee.Notice(`Failed to navigate to daily note: ${i}`)}}injectCustomStyles(){let e=document.getElementById("tasknotes-custom-styles");e&&e.remove();let r=this.statusManager.getStatusStyles(),i=this.priorityManager.getPriorityStyles(),s=document.createElement("style");s.id="tasknotes-custom-styles",s.textContent=`
		${r}
		${i}
	`,document.head.appendChild(s)}async updateTaskProperty(e,r,i,s={}){try{let a=await this.taskService.updateProperty(e,r,i,s);if(!s.silent)if(r==="status"){let o=typeof i=="string"?i:String(i),l=this.statusManager.getStatusConfig(o);new ee.Notice(`Task marked as '${(l==null?void 0:l.label)||o}'`)}else new ee.Notice(`Task ${r} updated`);return a}catch(a){throw console.error(`Failed to update task ${r}:`,a),new ee.Notice(`Failed to update task ${r}`),a}}async toggleRecurringTaskComplete(e,r){var i;try{let s=r||this.selectedDate,a=await this.taskService.toggleRecurringTaskComplete(e,r),o=I(s,"yyyy-MM-dd"),c=((i=a.complete_instances)==null?void 0:i.includes(o))?"completed":"marked incomplete";return new ee.Notice(`Recurring task ${c} for ${I(s,"MMM d")}`),a}catch(s){throw console.error("Failed to toggle recurring task completion:",s),new ee.Notice("Failed to update recurring task"),s}}async toggleTaskArchive(e){try{let r=await this.taskService.toggleArchive(e),i=r.archived?"archived":"unarchived";return new ee.Notice(`Task ${i}`),r}catch(r){throw console.error("Failed to toggle task archive:",r),new ee.Notice("Failed to update task archive status"),r}}async toggleTaskStatus(e){try{let r=await this.taskService.toggleStatus(e),i=this.statusManager.getStatusConfig(r.status);return new ee.Notice(`Task marked as '${(i==null?void 0:i.label)||r.status}'`),r}catch(r){throw console.error("Failed to toggle task status:",r),new ee.Notice("Failed to update task status"),r}}openTaskCreationModal(e){new Ks(this.app,this,{prePopulatedValues:e}).open()}async applyProjectSubtaskFilter(e){try{let r=this.app.vault.getAbstractFileByPath(e.path);if(!r){new ee.Notice("Project file not found");return}let i=this.app.workspace.getActiveViewOfType(ol)||this.app.workspace.getActiveViewOfType(dl)||this.app.workspace.getActiveViewOfType(ll);if(!i||!("filterBar"in i)){new ee.Notice("No compatible view active to apply filter");return}let s=i.filterBar;if(!s){new ee.Notice("Filter bar not available");return}this.addProjectCondition(s,r.basename),new ee.Notice(`Filtered to show subtasks of: ${e.title}`)}catch(r){console.error("Error applying project subtask filter:",r),new ee.Notice("Failed to apply project filter")}}addProjectCondition(e,r){this.removeProjectConditions(e);let i={type:"condition",id:`project_${this.generateFilterId()}`,property:"projects",operator:"contains",value:`[[${r}]]`};Array.isArray(e.currentQuery.children)||(e.currentQuery.children=[]),e.currentQuery.children.unshift(i),e.updateFilterBuilder(),e.emit("queryChange",e.currentQuery)}removeProjectConditions(e){if(!Array.isArray(e.currentQuery.children)){e.currentQuery.children=[];return}e.currentQuery.children=e.currentQuery.children.filter(r=>r.type==="condition"?!(r.property==="projects"&&r.operator==="contains"&&r.id.startsWith("project_")):!0)}generateFilterId(){return`filter-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async startTimeTracking(e,r){try{let i=await this.taskService.startTimeTracking(e);return new ee.Notice("Time tracking started"),this.statusBarService&&setTimeout(()=>{this.statusBarService.requestUpdate()},50),i}catch(i){throw console.error("Failed to start time tracking:",i),i.message==="Time tracking is already active for this task"?new ee.Notice("Time tracking is already active for this task"):new ee.Notice("Failed to start time tracking"),i}}async stopTimeTracking(e){try{let r=await this.taskService.stopTimeTracking(e);return new ee.Notice("Time tracking stopped"),this.statusBarService&&setTimeout(()=>{this.statusBarService.requestUpdate()},50),r}catch(r){throw console.error("Failed to stop time tracking:",r),r.message==="No active time tracking session for this task"?new ee.Notice("No active time tracking session for this task"):new ee.Notice("Failed to stop time tracking"),r}}getActiveTimeSession(e){return Ny(e.timeEntries||[])}isRecurringTaskCompleteForDate(e,r){if(!e.recurrence)return!1;let i=Te(r);return(Array.isArray(e.complete_instances)?e.complete_instances:[]).includes(i)}formatTime(e){return Zl(e)}async openTaskEditModal(e){new Zi(this.app,this,{task:e}).open()}async openDueDateModal(e){try{let{DueDateModal:r}=await Promise.resolve().then(()=>(fE(),hE));new r(this.app,e,this).open()}catch(r){console.error("Error loading DueDateModal:",r)}}async openScheduledDateModal(e){try{let{ScheduledDateModal:r}=await Promise.resolve().then(()=>(mE(),pE));new r(this.app,e,this).open()}catch(r){console.error("Error loading ScheduledDateModal:",r)}}async refreshCache(){try{let e=new ee.Notice("Refreshing TaskNotes cache...",0);await this.cacheManager.clearAllCaches(),this.notifyDataChanged(void 0,!0,!0),e.hide(),new ee.Notice("TaskNotes cache refreshed successfully")}catch(e){console.error("Error refreshing cache:",e),new ee.Notice("Failed to refresh cache. Please try again.")}}async convertTaskToTaskNote(e){try{let r=e.getCursor();if(!this.instantTaskConvertService){new ee.Notice("Task conversion service not available. Please try again.");return}await this.instantTaskConvertService.instantConvertTask(e,r.line)}catch(r){console.error("Error converting task:",r),new ee.Notice("Failed to convert task. Please try again.")}}async batchConvertAllTasks(e){try{if(!this.instantTaskConvertService){new ee.Notice("Task conversion service not available. Please try again.");return}await this.instantTaskConvertService.batchConvertAllTasks(e)}catch(r){console.error("Error batch converting tasks:",r),new ee.Notice("Failed to batch convert tasks. Please try again.")}}async insertTaskNoteLink(e){try{let i=(await this.cacheManager.getAllTasks()).filter(a=>!a.archived);new Zs(this.app,this,i,a=>{if(a){let o=this.app.vault.getAbstractFileByPath(a.path);if(o){let c=`[[${this.app.metadataCache.fileToLinktext(o,"")}|${a.title}]]`,d=e.getCursor();e.replaceRange(c,d);let u={line:d.line,ch:d.ch+c.length};e.setCursor(u)}else new ee.Notice("Failed to create link - file not found")}}).open()}catch(r){console.error("Error inserting tasknote link:",r),new ee.Notice("Failed to insert tasknote link")}}extractSelectionInfoForCommand(e,r){let i=e.getSelection();if(i&&i.trim()){let s=e.listSelections()[0],a=Math.min(s.anchor.line,s.head.line),o=Math.max(s.anchor.line,s.head.line),l=[];for(let h=a;h<=o;h++)l.push(e.getLine(h));let c=l[0],u=l.slice(1).join(`
`).trimEnd();return{taskLine:c,details:u,startLine:a,endLine:o,originalContent:l}}else{let s=e.getLine(r);return{taskLine:s,details:"",startLine:r,endLine:r,originalContent:[s]}}}async openQuickActionsForCurrentTask(){try{let e=this.app.workspace.getActiveFile();if(!e){new ee.Notice("No file is currently open");return}let r=await this.cacheManager.getTaskInfo(e.path);if(!r){new ee.Notice("Current file is not a TaskNote");return}let{TaskActionPaletteModal:i}=await Promise.resolve().then(()=>(yE(),gE));new i(this.app,r,this,this.selectedDate).open()}catch(e){console.error("Error opening quick actions:",e),new ee.Notice("Failed to open quick actions")}}haveCacheSettingsChanged(){if(!this.previousCacheSettings)return!0;let e={taskTag:this.settings.taskTag,excludedFolders:this.settings.excludedFolders,disableNoteIndexing:this.settings.disableNoteIndexing,storeTitleInFilename:this.settings.storeTitleInFilename,fieldMapping:this.settings.fieldMapping};return e.taskTag!==this.previousCacheSettings.taskTag||e.excludedFolders!==this.previousCacheSettings.excludedFolders||e.disableNoteIndexing!==this.previousCacheSettings.disableNoteIndexing||e.storeTitleInFilename!==this.previousCacheSettings.storeTitleInFilename||JSON.stringify(e.fieldMapping)!==JSON.stringify(this.previousCacheSettings.fieldMapping)}updatePreviousCacheSettings(){this.previousCacheSettings={taskTag:this.settings.taskTag,excludedFolders:this.settings.excludedFolders,disableNoteIndexing:this.settings.disableNoteIndexing,storeTitleInFilename:this.settings.storeTitleInFilename,fieldMapping:JSON.parse(JSON.stringify(this.settings.fieldMapping))}}};var aA=gl;

/* nosourcemap */