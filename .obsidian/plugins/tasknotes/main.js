/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var P_=Object.create;var wa=Object.defineProperty;var hv=Object.getOwnPropertyDescriptor;var N_=Object.getOwnPropertyNames;var R_=Object.getPrototypeOf,O_=Object.prototype.hasOwnProperty;var pv=s=>{throw TypeError(s)};var F_=(s,t,e)=>t in s?wa(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var v=(s,t)=>()=>(s&&(t=s(s=0)),t);var hd=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports),Ur=(s,t)=>{for(var e in t)wa(s,e,{get:t[e],enumerable:!0})},fv=(s,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of N_(t))!O_.call(s,i)&&i!==e&&wa(s,i,{get:()=>t[i],enumerable:!(r=hv(t,i))||r.enumerable});return s};var bt=(s,t,e)=>(e=s!=null?P_(R_(s)):{},fv(t||!s||!s.__esModule?wa(e,"default",{value:s,enumerable:!0}):e,s)),mv=s=>fv(wa({},"__esModule",{value:!0}),s),me=(s,t,e,r)=>{for(var i=r>1?void 0:r?hv(t,e):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(i=(r?a(t,e,i):a(i))||i);return r&&i&&wa(t,e,i),i};var P=(s,t,e)=>F_(s,typeof t!="symbol"?t+"":t,e),gv=(s,t,e)=>t.has(s)||pv("Cannot "+e);var xn=(s,t,e)=>(gv(s,t,"read from private field"),e?e.call(s):t.get(s)),pd=(s,t,e)=>t.has(s)?pv("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),fd=(s,t,e,r)=>(gv(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e);var L_,iH,md,yv,Cp,xp,H_,vv,sH,B_,U_,nH,Mp,Ta=v(()=>{L_=Math.pow(10,8)*24*60*60*1e3,iH=-L_,md=6048e5,yv=864e5,Cp=6e4,xp=36e5,H_=3600,vv=H_*24,sH=vv*7,B_=vv*365.2425,U_=B_/12,nH=U_*3,Mp=Symbol.for("constructDateFrom")});function Xe(s,t){return typeof s=="function"?s(t):s&&typeof s=="object"&&Mp in s?s[Mp](t):s instanceof Date?new s.constructor(t):new Date(t)}var $r=v(()=>{Ta()});function fe(s,t){return Xe(t||s,s)}var at=v(()=>{$r()});function sr(s,t,e){let r=fe(s,e==null?void 0:e.in);return isNaN(t)?Xe((e==null?void 0:e.in)||s,NaN):(t&&r.setDate(r.getDate()+t),r)}var Wo=v(()=>{$r();at()});function _p(s,t,e){let r=fe(s,e==null?void 0:e.in);if(isNaN(t))return Xe((e==null?void 0:e.in)||s,NaN);if(!t)return r;let i=r.getDate(),n=Xe((e==null?void 0:e.in)||s,r.getTime());n.setMonth(r.getMonth()+t+1,0);let a=n.getDate();return i>=a?n:(r.setFullYear(n.getFullYear(),n.getMonth(),i),r)}var Ap=v(()=>{$r();at()});function ba(s,t,e){let{years:r=0,months:i=0,weeks:n=0,days:a=0,hours:o=0,minutes:l=0,seconds:c=0}=t,d=fe(s,e==null?void 0:e.in),u=i||r?_p(d,i+r*12):d,h=a||n?sr(u,a+n*7):u,p=l+o*60,m=(c+p*60)*1e3;return Xe((e==null?void 0:e.in)||s,+h+m)}var wv=v(()=>{Wo();Ap();$r();at()});var Tv=v(()=>{});var bv=v(()=>{});var kv=v(()=>{});var Sv=v(()=>{});var Ev=v(()=>{});var Dv=v(()=>{});function Ci(){return $_}var $_,ka=v(()=>{$_={}});function Yt(s,t){var o,l,c,d,u,h,p,f;let e=Ci(),r=(f=(p=(d=(c=t==null?void 0:t.weekStartsOn)!=null?c:(l=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)!=null?d:e.weekStartsOn)!=null?p:(h=(u=e.locale)==null?void 0:u.options)==null?void 0:h.weekStartsOn)!=null?f:0,i=fe(s,t==null?void 0:t.in),n=i.getDay(),a=(n<r?7:0)+n-r;return i.setDate(i.getDate()-a),i.setHours(0,0,0,0),i}var Sa=v(()=>{ka();at()});function Mn(s,t){return Yt(s,{...t,weekStartsOn:1})}var Yo=v(()=>{Sa()});function gd(s,t){let e=fe(s,t==null?void 0:t.in),r=e.getFullYear(),i=Xe(e,0);i.setFullYear(r+1,0,4),i.setHours(0,0,0,0);let n=Mn(i),a=Xe(e,0);a.setFullYear(r,0,4),a.setHours(0,0,0,0);let o=Mn(a);return e.getTime()>=n.getTime()?r+1:e.getTime()>=o.getTime()?r:r-1}var yd=v(()=>{$r();Yo();at()});function Ip(s){let t=fe(s),e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),+s-+e}var Cv=v(()=>{at()});function vd(s,...t){let e=Xe.bind(null,s||t.find(r=>typeof r=="object"));return t.map(e)}var Pp=v(()=>{$r()});function Ot(s,t){let e=fe(s,t==null?void 0:t.in);return e.setHours(0,0,0,0),e}var wd=v(()=>{at()});function xv(s,t,e){let[r,i]=vd(e==null?void 0:e.in,s,t),n=Ot(r),a=Ot(i),o=+n-Ip(n),l=+a-Ip(a);return Math.round((o-l)/yv)}var Np=v(()=>{Cv();Pp();Ta();wd()});function Mv(s,t){let e=gd(s,t),r=Xe((t==null?void 0:t.in)||s,0);return r.setFullYear(e,0,4),r.setHours(0,0,0,0),Mn(r)}var Rp=v(()=>{$r();yd();Yo()});var _v=v(()=>{});var Av=v(()=>{});var Iv=v(()=>{});var Pv=v(()=>{});var Nv=v(()=>{});function Rv(s,t,e){return sr(s,t*7,e)}var Ov=v(()=>{Wo()});var Fv=v(()=>{});var Lv=v(()=>{});var Hv=v(()=>{});var Bv=v(()=>{});var Uv=v(()=>{});var $v=v(()=>{});var Vv=v(()=>{});var Wv=v(()=>{});var Yv=v(()=>{});var jv=v(()=>{});var zv=v(()=>{});function jo(s,t,e){let[r,i]=vd(e==null?void 0:e.in,s,t);return+Ot(r)==+Ot(i)}var qv=v(()=>{Pp();wd()});function Gv(s){return s instanceof Date||typeof s=="object"&&Object.prototype.toString.call(s)==="[object Date]"}var Op=v(()=>{});function nr(s){return!(!Gv(s)&&typeof s!="number"||isNaN(+fe(s)))}var Fp=v(()=>{Op();at()});var Qv=v(()=>{});var Kv=v(()=>{});var Zv=v(()=>{});var Jv=v(()=>{});var Xv=v(()=>{});var ew=v(()=>{});var tw=v(()=>{});var rw=v(()=>{});var iw=v(()=>{});var sw=v(()=>{});var nw=v(()=>{});var aw=v(()=>{});var ow=v(()=>{});var lw=v(()=>{});function cw(s,t){let e=fe(s,t==null?void 0:t.in);return e.setHours(23,59,59,999),e}var dw=v(()=>{at()});function Lp(s,t){let e=fe(s,t==null?void 0:t.in),r=e.getMonth();return e.setFullYear(e.getFullYear(),r+1,0),e.setHours(23,59,59,999),e}var uw=v(()=>{at()});var hw=v(()=>{});var pw=v(()=>{});var fw=v(()=>{});var mw=v(()=>{});var gw=v(()=>{});var yw=v(()=>{});var vw=v(()=>{});var ww=v(()=>{});var Tw=v(()=>{});var bw=v(()=>{});var kw=v(()=>{});var Sw=v(()=>{});var Ew=v(()=>{});var Dw=v(()=>{});function Hp(s,t){let e=fe(s,t==null?void 0:t.in);return e.setDate(1),e.setHours(0,0,0,0),e}var Cw=v(()=>{at()});var xw=v(()=>{});var Mw=v(()=>{});function Bp(s,t){let e=fe(s,t==null?void 0:t.in);return e.setFullYear(e.getFullYear(),0,1),e.setHours(0,0,0,0),e}var Up=v(()=>{at()});var _w=v(()=>{});var Aw=v(()=>{});var Iw=v(()=>{});var Pw=v(()=>{});function _n(s,t){var o,l,c,d,u,h,p,f;let e=Ci(),r=(f=(p=(d=(c=t==null?void 0:t.weekStartsOn)!=null?c:(l=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)!=null?d:e.weekStartsOn)!=null?p:(h=(u=e.locale)==null?void 0:u.options)==null?void 0:h.weekStartsOn)!=null?f:0,i=fe(s,t==null?void 0:t.in),n=i.getDay(),a=(n<r?-7:0)+6-(n-r);return i.setDate(i.getDate()+a),i.setHours(23,59,59,999),i}var Nw=v(()=>{ka();at()});var Rw=v(()=>{});var Ow=v(()=>{});var Fw=v(()=>{});var Lw=v(()=>{});var Hw=v(()=>{});var Bw=v(()=>{});var Uw=v(()=>{});var $w=v(()=>{});var V_,Vw,Ww=v(()=>{V_={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Vw=(s,t,e)=>{let r,i=V_[s];return typeof i=="string"?r=i:t===1?r=i.one:r=i.other.replace("{{count}}",t.toString()),e!=null&&e.addSuffix?e.comparison&&e.comparison>0?"in "+r:r+" ago":r}});function Td(s){return(t={})=>{let e=t.width?String(t.width):s.defaultWidth;return s.formats[e]||s.formats[s.defaultWidth]}}var Yw=v(()=>{});var W_,Y_,j_,jw,zw=v(()=>{Yw();W_={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Y_={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},j_={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},jw={date:Td({formats:W_,defaultWidth:"full"}),time:Td({formats:Y_,defaultWidth:"full"}),dateTime:Td({formats:j_,defaultWidth:"full"})}});var z_,qw,Gw=v(()=>{z_={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},qw=(s,t,e,r)=>z_[s]});function Ea(s){return(t,e)=>{let r=e!=null&&e.context?String(e.context):"standalone",i;if(r==="formatting"&&s.formattingValues){let a=s.defaultFormattingWidth||s.defaultWidth,o=e!=null&&e.width?String(e.width):a;i=s.formattingValues[o]||s.formattingValues[a]}else{let a=s.defaultWidth,o=e!=null&&e.width?String(e.width):s.defaultWidth;i=s.values[o]||s.values[a]}let n=s.argumentCallback?s.argumentCallback(t):t;return i[n]}}var Qw=v(()=>{});var q_,G_,Q_,K_,Z_,J_,X_,Kw,Zw=v(()=>{Qw();q_={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},G_={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Q_={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},K_={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Z_={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},J_={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},X_=(s,t)=>{let e=Number(s),r=e%100;if(r>20||r<10)switch(r%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"},Kw={ordinalNumber:X_,era:Ea({values:q_,defaultWidth:"wide"}),quarter:Ea({values:G_,defaultWidth:"wide",argumentCallback:s=>s-1}),month:Ea({values:Q_,defaultWidth:"wide"}),day:Ea({values:K_,defaultWidth:"wide"}),dayPeriod:Ea({values:Z_,defaultWidth:"wide",formattingValues:J_,defaultFormattingWidth:"wide"})}});function Da(s){return(t,e={})=>{let r=e.width,i=r&&s.matchPatterns[r]||s.matchPatterns[s.defaultMatchWidth],n=t.match(i);if(!n)return null;let a=n[0],o=r&&s.parsePatterns[r]||s.parsePatterns[s.defaultParseWidth],l=Array.isArray(o)?tA(o,u=>u.test(a)):eA(o,u=>u.test(a)),c;c=s.valueCallback?s.valueCallback(l):l,c=e.valueCallback?e.valueCallback(c):c;let d=t.slice(a.length);return{value:c,rest:d}}}function eA(s,t){for(let e in s)if(Object.prototype.hasOwnProperty.call(s,e)&&t(s[e]))return e}function tA(s,t){for(let e=0;e<s.length;e++)if(t(s[e]))return e}var Jw=v(()=>{});function Xw(s){return(t,e={})=>{let r=t.match(s.matchPattern);if(!r)return null;let i=r[0],n=t.match(s.parsePattern);if(!n)return null;let a=s.valueCallback?s.valueCallback(n[0]):n[0];a=e.valueCallback?e.valueCallback(a):a;let o=t.slice(i.length);return{value:a,rest:o}}}var eT=v(()=>{});var rA,iA,sA,nA,aA,oA,lA,cA,dA,uA,hA,pA,tT,rT=v(()=>{Jw();eT();rA=/^(\d+)(th|st|nd|rd)?/i,iA=/\d+/i,sA={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},nA={any:[/^b/i,/^(a|c)/i]},aA={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},oA={any:[/1/i,/2/i,/3/i,/4/i]},lA={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},cA={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},dA={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},uA={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},hA={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},pA={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},tT={ordinalNumber:Xw({matchPattern:rA,parsePattern:iA,valueCallback:s=>parseInt(s,10)}),era:Da({matchPatterns:sA,defaultMatchWidth:"wide",parsePatterns:nA,defaultParseWidth:"any"}),quarter:Da({matchPatterns:aA,defaultMatchWidth:"wide",parsePatterns:oA,defaultParseWidth:"any",valueCallback:s=>s+1}),month:Da({matchPatterns:lA,defaultMatchWidth:"wide",parsePatterns:cA,defaultParseWidth:"any"}),day:Da({matchPatterns:dA,defaultMatchWidth:"wide",parsePatterns:uA,defaultParseWidth:"any"}),dayPeriod:Da({matchPatterns:hA,defaultMatchWidth:"any",parsePatterns:pA,defaultParseWidth:"any"})}});var $p,iT=v(()=>{Ww();zw();Gw();Zw();rT();$p={code:"en-US",formatDistance:Vw,formatLong:jw,formatRelative:qw,localize:Kw,match:tT,options:{weekStartsOn:0,firstWeekContainsDate:1}}});var sT=v(()=>{iT()});function nT(s,t){let e=fe(s,t==null?void 0:t.in);return xv(e,Bp(e))+1}var Vp=v(()=>{Np();Up();at()});function aT(s,t){let e=fe(s,t==null?void 0:t.in),r=+Mn(e)-+Mv(e);return Math.round(r/md)+1}var Wp=v(()=>{Ta();Yo();Rp();at()});function bd(s,t){var d,u,h,p,f,m,g,y;let e=fe(s,t==null?void 0:t.in),r=e.getFullYear(),i=Ci(),n=(y=(g=(p=(h=t==null?void 0:t.firstWeekContainsDate)!=null?h:(u=(d=t==null?void 0:t.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)!=null?p:i.firstWeekContainsDate)!=null?g:(m=(f=i.locale)==null?void 0:f.options)==null?void 0:m.firstWeekContainsDate)!=null?y:1,a=Xe((t==null?void 0:t.in)||s,0);a.setFullYear(r+1,0,n),a.setHours(0,0,0,0);let o=Yt(a,t),l=Xe((t==null?void 0:t.in)||s,0);l.setFullYear(r,0,n),l.setHours(0,0,0,0);let c=Yt(l,t);return+e>=+o?r+1:+e>=+c?r:r-1}var kd=v(()=>{ka();$r();Sa();at()});function oT(s,t){var o,l,c,d,u,h,p,f;let e=Ci(),r=(f=(p=(d=(c=t==null?void 0:t.firstWeekContainsDate)!=null?c:(l=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:l.firstWeekContainsDate)!=null?d:e.firstWeekContainsDate)!=null?p:(h=(u=e.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)!=null?f:1,i=bd(s,t),n=Xe((t==null?void 0:t.in)||s,0);return n.setFullYear(i,0,r),n.setHours(0,0,0,0),Yt(n,t)}var Yp=v(()=>{ka();$r();kd();Sa()});function lT(s,t){let e=fe(s,t==null?void 0:t.in),r=+Yt(e,t)-+oT(e,t);return Math.round(r/md)+1}var jp=v(()=>{Ta();Sa();Yp();at()});function Oe(s,t){let e=s<0?"-":"",r=Math.abs(s).toString().padStart(t,"0");return e+r}var zp=v(()=>{});var Zi,cT=v(()=>{zp();Zi={y(s,t){let e=s.getFullYear(),r=e>0?e:1-e;return Oe(t==="yy"?r%100:r,t.length)},M(s,t){let e=s.getMonth();return t==="M"?String(e+1):Oe(e+1,2)},d(s,t){return Oe(s.getDate(),t.length)},a(s,t){let e=s.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return e.toUpperCase();case"aaa":return e;case"aaaaa":return e[0];case"aaaa":default:return e==="am"?"a.m.":"p.m."}},h(s,t){return Oe(s.getHours()%12||12,t.length)},H(s,t){return Oe(s.getHours(),t.length)},m(s,t){return Oe(s.getMinutes(),t.length)},s(s,t){return Oe(s.getSeconds(),t.length)},S(s,t){let e=t.length,r=s.getMilliseconds(),i=Math.trunc(r*Math.pow(10,e-3));return Oe(i,t.length)}}});function dT(s,t=""){let e=s>0?"-":"+",r=Math.abs(s),i=Math.trunc(r/60),n=r%60;return n===0?e+String(i):e+String(i)+t+Oe(n,2)}function uT(s,t){return s%60===0?(s>0?"-":"+")+Oe(Math.abs(s)/60,2):An(s,t)}function An(s,t=""){let e=s>0?"-":"+",r=Math.abs(s),i=Oe(Math.trunc(r/60),2),n=Oe(r%60,2);return e+i+t+n}var Ca,qp,hT=v(()=>{Vp();Wp();yd();jp();kd();zp();cT();Ca={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},qp={G:function(s,t,e){let r=s.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return e.era(r,{width:"abbreviated"});case"GGGGG":return e.era(r,{width:"narrow"});case"GGGG":default:return e.era(r,{width:"wide"})}},y:function(s,t,e){if(t==="yo"){let r=s.getFullYear(),i=r>0?r:1-r;return e.ordinalNumber(i,{unit:"year"})}return Zi.y(s,t)},Y:function(s,t,e,r){let i=bd(s,r),n=i>0?i:1-i;if(t==="YY"){let a=n%100;return Oe(a,2)}return t==="Yo"?e.ordinalNumber(n,{unit:"year"}):Oe(n,t.length)},R:function(s,t){let e=gd(s);return Oe(e,t.length)},u:function(s,t){let e=s.getFullYear();return Oe(e,t.length)},Q:function(s,t,e){let r=Math.ceil((s.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return Oe(r,2);case"Qo":return e.ordinalNumber(r,{unit:"quarter"});case"QQQ":return e.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return e.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return e.quarter(r,{width:"wide",context:"formatting"})}},q:function(s,t,e){let r=Math.ceil((s.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return Oe(r,2);case"qo":return e.ordinalNumber(r,{unit:"quarter"});case"qqq":return e.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return e.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return e.quarter(r,{width:"wide",context:"standalone"})}},M:function(s,t,e){let r=s.getMonth();switch(t){case"M":case"MM":return Zi.M(s,t);case"Mo":return e.ordinalNumber(r+1,{unit:"month"});case"MMM":return e.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return e.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return e.month(r,{width:"wide",context:"formatting"})}},L:function(s,t,e){let r=s.getMonth();switch(t){case"L":return String(r+1);case"LL":return Oe(r+1,2);case"Lo":return e.ordinalNumber(r+1,{unit:"month"});case"LLL":return e.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return e.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return e.month(r,{width:"wide",context:"standalone"})}},w:function(s,t,e,r){let i=lT(s,r);return t==="wo"?e.ordinalNumber(i,{unit:"week"}):Oe(i,t.length)},I:function(s,t,e){let r=aT(s);return t==="Io"?e.ordinalNumber(r,{unit:"week"}):Oe(r,t.length)},d:function(s,t,e){return t==="do"?e.ordinalNumber(s.getDate(),{unit:"date"}):Zi.d(s,t)},D:function(s,t,e){let r=nT(s);return t==="Do"?e.ordinalNumber(r,{unit:"dayOfYear"}):Oe(r,t.length)},E:function(s,t,e){let r=s.getDay();switch(t){case"E":case"EE":case"EEE":return e.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return e.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return e.day(r,{width:"short",context:"formatting"});case"EEEE":default:return e.day(r,{width:"wide",context:"formatting"})}},e:function(s,t,e,r){let i=s.getDay(),n=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(n);case"ee":return Oe(n,2);case"eo":return e.ordinalNumber(n,{unit:"day"});case"eee":return e.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return e.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return e.day(i,{width:"short",context:"formatting"});case"eeee":default:return e.day(i,{width:"wide",context:"formatting"})}},c:function(s,t,e,r){let i=s.getDay(),n=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(n);case"cc":return Oe(n,t.length);case"co":return e.ordinalNumber(n,{unit:"day"});case"ccc":return e.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return e.day(i,{width:"narrow",context:"standalone"});case"cccccc":return e.day(i,{width:"short",context:"standalone"});case"cccc":default:return e.day(i,{width:"wide",context:"standalone"})}},i:function(s,t,e){let r=s.getDay(),i=r===0?7:r;switch(t){case"i":return String(i);case"ii":return Oe(i,t.length);case"io":return e.ordinalNumber(i,{unit:"day"});case"iii":return e.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return e.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return e.day(r,{width:"short",context:"formatting"});case"iiii":default:return e.day(r,{width:"wide",context:"formatting"})}},a:function(s,t,e){let i=s.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return e.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return e.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(s,t,e){let r=s.getHours(),i;switch(r===12?i=Ca.noon:r===0?i=Ca.midnight:i=r/12>=1?"pm":"am",t){case"b":case"bb":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return e.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return e.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(s,t,e){let r=s.getHours(),i;switch(r>=17?i=Ca.evening:r>=12?i=Ca.afternoon:r>=4?i=Ca.morning:i=Ca.night,t){case"B":case"BB":case"BBB":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return e.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return e.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(s,t,e){if(t==="ho"){let r=s.getHours()%12;return r===0&&(r=12),e.ordinalNumber(r,{unit:"hour"})}return Zi.h(s,t)},H:function(s,t,e){return t==="Ho"?e.ordinalNumber(s.getHours(),{unit:"hour"}):Zi.H(s,t)},K:function(s,t,e){let r=s.getHours()%12;return t==="Ko"?e.ordinalNumber(r,{unit:"hour"}):Oe(r,t.length)},k:function(s,t,e){let r=s.getHours();return r===0&&(r=24),t==="ko"?e.ordinalNumber(r,{unit:"hour"}):Oe(r,t.length)},m:function(s,t,e){return t==="mo"?e.ordinalNumber(s.getMinutes(),{unit:"minute"}):Zi.m(s,t)},s:function(s,t,e){return t==="so"?e.ordinalNumber(s.getSeconds(),{unit:"second"}):Zi.s(s,t)},S:function(s,t){return Zi.S(s,t)},X:function(s,t,e){let r=s.getTimezoneOffset();if(r===0)return"Z";switch(t){case"X":return uT(r);case"XXXX":case"XX":return An(r);case"XXXXX":case"XXX":default:return An(r,":")}},x:function(s,t,e){let r=s.getTimezoneOffset();switch(t){case"x":return uT(r);case"xxxx":case"xx":return An(r);case"xxxxx":case"xxx":default:return An(r,":")}},O:function(s,t,e){let r=s.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+dT(r,":");case"OOOO":default:return"GMT"+An(r,":")}},z:function(s,t,e){let r=s.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+dT(r,":");case"zzzz":default:return"GMT"+An(r,":")}},t:function(s,t,e){let r=Math.trunc(+s/1e3);return Oe(r,t.length)},T:function(s,t,e){return Oe(+s,t.length)}}});var pT,fT,fA,mT,gT=v(()=>{pT=(s,t)=>{switch(s){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},fT=(s,t)=>{switch(s){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},fA=(s,t)=>{let e=s.match(/(P+)(p+)?/)||[],r=e[1],i=e[2];if(!i)return pT(s,t);let n;switch(r){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;case"PPPP":default:n=t.dateTime({width:"full"});break}return n.replace("{{date}}",pT(r,t)).replace("{{time}}",fT(i,t))},mT={p:fT,P:fA}});function yT(s){return mA.test(s)}function vT(s){return gA.test(s)}function wT(s,t,e){let r=vA(s,t,e);if(console.warn(r),yA.includes(s))throw new RangeError(r)}function vA(s,t,e){let r=s[0]==="Y"?"years":"days of the month";return`Use \`${s.toLowerCase()}\` instead of \`${s}\` (in \`${t}\`) for formatting ${r} to the input \`${e}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}var mA,gA,yA,TT=v(()=>{mA=/^D+$/,gA=/^Y+$/,yA=["D","DD","YY","YYYY"]});function C(s,t,e){var d,u,h,p,f,m,g,y,w,T,S,x,I,F,A,L,G,V;let r=Ci(),i=(u=(d=e==null?void 0:e.locale)!=null?d:r.locale)!=null?u:$p,n=(T=(w=(m=(f=e==null?void 0:e.firstWeekContainsDate)!=null?f:(p=(h=e==null?void 0:e.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)!=null?m:r.firstWeekContainsDate)!=null?w:(y=(g=r.locale)==null?void 0:g.options)==null?void 0:y.firstWeekContainsDate)!=null?T:1,a=(V=(G=(F=(I=e==null?void 0:e.weekStartsOn)!=null?I:(x=(S=e==null?void 0:e.locale)==null?void 0:S.options)==null?void 0:x.weekStartsOn)!=null?F:r.weekStartsOn)!=null?G:(L=(A=r.locale)==null?void 0:A.options)==null?void 0:L.weekStartsOn)!=null?V:0,o=fe(s,e==null?void 0:e.in);if(!nr(o))throw new RangeError("Invalid time value");let l=t.match(TA).map(k=>{let D=k[0];if(D==="p"||D==="P"){let _=mT[D];return _(k,i.formatLong)}return k}).join("").match(wA).map(k=>{if(k==="''")return{isToken:!1,value:"'"};let D=k[0];if(D==="'")return{isToken:!1,value:EA(k)};if(qp[D])return{isToken:!0,value:k};if(D.match(SA))throw new RangeError("Format string contains an unescaped latin alphabet character `"+D+"`");return{isToken:!1,value:k}});i.localize.preprocessor&&(l=i.localize.preprocessor(o,l));let c={firstWeekContainsDate:n,weekStartsOn:a,locale:i};return l.map(k=>{if(!k.isToken)return k.value;let D=k.value;(!(e!=null&&e.useAdditionalWeekYearTokens)&&vT(D)||!(e!=null&&e.useAdditionalDayOfYearTokens)&&yT(D))&&wT(D,t,String(s));let _=qp[D[0]];return _(o,D,i.localize,c)}).join("")}function EA(s){let t=s.match(bA);return t?t[1].replace(kA,"'"):s}var wA,TA,bA,kA,SA,bT=v(()=>{sT();ka();hT();gT();TT();Fp();at();wA=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,TA=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,bA=/^'([^]*?)'?$/,kA=/''/g,SA=/[a-zA-Z]/});var kT=v(()=>{});var ST=v(()=>{});var ET=v(()=>{});var DT=v(()=>{});var CT=v(()=>{});var xT=v(()=>{});var MT=v(()=>{});var _T=v(()=>{});var AT=v(()=>{});var IT=v(()=>{});var PT=v(()=>{});var NT=v(()=>{});var RT=v(()=>{});var OT=v(()=>{});var FT=v(()=>{});var LT=v(()=>{});var HT=v(()=>{});var BT=v(()=>{});var UT=v(()=>{});var $T=v(()=>{});var VT=v(()=>{});var WT=v(()=>{});var YT=v(()=>{});var jT=v(()=>{});var zT=v(()=>{});var qT=v(()=>{});var GT=v(()=>{});var QT=v(()=>{});var KT=v(()=>{});var ZT=v(()=>{});var JT=v(()=>{});var XT=v(()=>{});var eb=v(()=>{});var tb=v(()=>{});var rb=v(()=>{});var ib=v(()=>{});var sb=v(()=>{});var nb=v(()=>{});var ab=v(()=>{});var ob=v(()=>{});var lb=v(()=>{});function Sd(s,t){return+fe(s)<+fe(t)}var cb=v(()=>{at()});var db=v(()=>{});var ub=v(()=>{});var hb=v(()=>{});var pb=v(()=>{});var fb=v(()=>{});var mb=v(()=>{});var gb=v(()=>{});var yb=v(()=>{});var vb=v(()=>{});var wb=v(()=>{});var Tb=v(()=>{});var bb=v(()=>{});var kb=v(()=>{});var Sb=v(()=>{});var Eb=v(()=>{});var Db=v(()=>{});var Cb=v(()=>{});var xb=v(()=>{});var Mb=v(()=>{});var _b=v(()=>{});var Ab=v(()=>{});var Ib=v(()=>{});var Pb=v(()=>{});var Nb=v(()=>{});var Rb=v(()=>{});var Ob=v(()=>{});var Fb=v(()=>{});var Lb=v(()=>{});var Hb=v(()=>{});var Bb=v(()=>{});var Ub=v(()=>{});var $b=v(()=>{});var Vb=v(()=>{});var Wb=v(()=>{});var Yb=v(()=>{});var jb=v(()=>{});var zb=v(()=>{});var qb=v(()=>{});var Gb=v(()=>{});var Qb=v(()=>{});function xa(s,t,e){return sr(s,-t,e)}var Kb=v(()=>{Wo()});var Zb=v(()=>{});var Jb=v(()=>{});var Xb=v(()=>{});var ek=v(()=>{});var tk=v(()=>{});var rk=v(()=>{});var ik=v(()=>{});var sk=v(()=>{});var nk=v(()=>{});var ak=v(()=>{});var ok=v(()=>{});var lk=v(()=>{});var ck=v(()=>{});var dk=v(()=>{});var uk=v(()=>{});var hk=v(()=>{});var pk=v(()=>{});var fk=v(()=>{});var mk=v(()=>{});var gk=v(()=>{});var yk=v(()=>{});var vk=v(()=>{});var wk=v(()=>{});var Tk=v(()=>{});var bk=v(()=>{});function In(s,t){var c;let e=()=>Xe(t==null?void 0:t.in,NaN),r=(c=t==null?void 0:t.additionalDigits)!=null?c:2,i=MA(s),n;if(i.date){let d=_A(i.date,r);n=AA(d.restDateString,d.year)}if(!n||isNaN(+n))return e();let a=+n,o=0,l;if(i.time&&(o=IA(i.time),isNaN(o)))return e();if(i.timezone){if(l=PA(i.timezone),isNaN(l))return e()}else{let d=new Date(a+o),u=fe(0,t==null?void 0:t.in);return u.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),u}return fe(a+o+l,t==null?void 0:t.in)}function MA(s){let t={},e=s.split(Ed.dateTimeDelimiter),r;if(e.length>2)return t;if(/:/.test(e[0])?r=e[0]:(t.date=e[0],r=e[1],Ed.timeZoneDelimiter.test(t.date)&&(t.date=s.split(Ed.timeZoneDelimiter)[0],r=s.substr(t.date.length,s.length))),r){let i=Ed.timezone.exec(r);i?(t.time=r.replace(i[1],""),t.timezone=i[1]):t.time=r}return t}function _A(s,t){let e=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=s.match(e);if(!r)return{year:NaN,restDateString:""};let i=r[1]?parseInt(r[1]):null,n=r[2]?parseInt(r[2]):null;return{year:n===null?i:n*100,restDateString:s.slice((r[1]||r[2]).length)}}function AA(s,t){if(t===null)return new Date(NaN);let e=s.match(DA);if(!e)return new Date(NaN);let r=!!e[4],i=zo(e[1]),n=zo(e[2])-1,a=zo(e[3]),o=zo(e[4]),l=zo(e[5])-1;if(r)return LA(t,o,l)?NA(t,o,l):new Date(NaN);{let c=new Date(0);return!OA(t,n,a)||!FA(t,i)?new Date(NaN):(c.setUTCFullYear(t,n,Math.max(i,a)),c)}}function zo(s){return s?parseInt(s):1}function IA(s){let t=s.match(CA);if(!t)return NaN;let e=Gp(t[1]),r=Gp(t[2]),i=Gp(t[3]);return HA(e,r,i)?e*xp+r*Cp+i*1e3:NaN}function Gp(s){return s&&parseFloat(s.replace(",","."))||0}function PA(s){if(s==="Z")return 0;let t=s.match(xA);if(!t)return 0;let e=t[1]==="+"?-1:1,r=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return BA(r,i)?e*(r*xp+i*Cp):NaN}function NA(s,t,e){let r=new Date(0);r.setUTCFullYear(s,0,4);let i=r.getUTCDay()||7,n=(t-1)*7+e+1-i;return r.setUTCDate(r.getUTCDate()+n),r}function kk(s){return s%400===0||s%4===0&&s%100!==0}function OA(s,t,e){return t>=0&&t<=11&&e>=1&&e<=(RA[t]||(kk(s)?29:28))}function FA(s,t){return t>=1&&t<=(kk(s)?366:365)}function LA(s,t,e){return t>=1&&t<=53&&e>=0&&e<=6}function HA(s,t,e){return s===24?t===0&&e===0:e>=0&&e<60&&t>=0&&t<60&&s>=0&&s<25}function BA(s,t){return t>=0&&t<=59}var Ed,DA,CA,xA,RA,Sk=v(()=>{Ta();$r();at();Ed={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},DA=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,CA=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,xA=/^([+-])(\d{2})(?::?(\d{2}))?$/;RA=[31,null,31,30,31,30,31,31,30,31,30,31]});var Ek=v(()=>{});var Dk=v(()=>{});var Ck=v(()=>{});var xk=v(()=>{});var Mk=v(()=>{});var _k=v(()=>{});var Ak=v(()=>{});var Ik=v(()=>{});var Pk=v(()=>{});var Nk=v(()=>{});var Rk=v(()=>{});var Ok=v(()=>{});var Fk=v(()=>{});var Lk=v(()=>{});var Hk=v(()=>{});var Bk=v(()=>{});var Uk=v(()=>{});var $k=v(()=>{});var Vk=v(()=>{});var Wk=v(()=>{});var Yk=v(()=>{});var jk=v(()=>{});var zk=v(()=>{});var qk=v(()=>{});var Gk=v(()=>{});var Qk=v(()=>{});var Kk=v(()=>{});var Zk=v(()=>{});var Jk=v(()=>{});var Xk=v(()=>{});var eS=v(()=>{});var tS=v(()=>{});var rS=v(()=>{});var iS=v(()=>{});var sS=v(()=>{});var nS=v(()=>{});var aS=v(()=>{});var oS=v(()=>{});var lS=v(()=>{});var cS=v(()=>{});var dS=v(()=>{});var uS=v(()=>{});var hS=v(()=>{});var pS=v(()=>{});var fS=v(()=>{});var mS=v(()=>{});var ot=v(()=>{wv();Sv();Wo();Dv();Av();Ev();Iv();Ap();Pv();Nv();Ov();Fv();Lv();Uv();$v();Vv();Wv();Yv();$r();jv();zv();Qv();Np();Kv();Zv();Jv();ew();tw();rw();iw();sw();aw();ow();lw();pw();fw();mw();gw();yw();vw();ww();Tw();bw();Sw();Ew();Dw();xw();_w();Aw();dw();Iw();Pw();Rw();Ow();Fw();uw();Lw();Hw();Bw();Uw();Nw();Mw();$w();bT();kT();ST();ET();DT();CT();xT();MT();_T();AT();IT();PT();NT();RT();OT();Vp();FT();HT();BT();UT();$T();VT();Wp();yd();WT();YT();jT();zT();qT();Xv();GT();QT();KT();jp();ZT();kd();XT();eb();tb();rb();ib();sb();nb();ab();ob();lb();cb();Op();db();ub();hb();pb();fb();hw();LT();bb();kb();Sb();qv();Db();xb();Mb();Ab();Ib();Pb();Rb();Cb();Ob();Tv();bv();Fb();Lb();Hb();Bb();Ub();$b();Vb();Wb();Yb();jb();zb();qb();Fp();Gb();kv();Qb();Zb();Jb();ek();tk();JT();rk();Xb();ik();sk();Hv();nk();ak();ok();lk();Bv();ck();dk();uk();hk();pk();fk();mk();gk();yk();vk();wk();Tk();bk();Tb();Sk();Ek();Dk();Ck();xk();Mk();_k();Ak();Ik();Pk();Nk();Rk();Ok();Fk();Lk();Hk();Bk();$k();Vk();vb();Wk();Yk();jk();wb();yb();_v();zk();qk();Uk();Gk();Qk();gb();Kk();Zk();wd();Jk();Eb();Yo();Rp();_b();Cw();kw();Nb();Xk();eS();Sa();Yp();Up();tS();iS();sS();Kb();nS();nw();aS();oS();rS();lS();cS();dS();uS();at();mb();hS();pS();fS();mS()});var Vr=hd(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});var et=require("obsidian"),Qp="YYYY-MM-DD",Kp="gggg-[W]ww",gS="YYYY-MM",yS="YYYY-[Q]Q",vS="YYYY";function qo(s){var e,r;let t=window.app.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e[s])==null?void 0:r.enabled)}function Go(){var s,t,e,r;try{let{internalPlugins:i,plugins:n}=window.app;if(qo("daily")){let{format:c,folder:d,template:u}=((t=(s=n.getPlugin("periodic-notes"))==null?void 0:s.settings)==null?void 0:t.daily)||{};return{format:c||Qp,folder:(d==null?void 0:d.trim())||"",template:(u==null?void 0:u.trim())||""}}let{folder:a,format:o,template:l}=((r=(e=i.getPluginById("daily-notes"))==null?void 0:e.instance)==null?void 0:r.options)||{};return{format:o||Qp,folder:(a==null?void 0:a.trim())||"",template:(l==null?void 0:l.trim())||""}}catch(i){console.info("No custom daily note settings found!",i)}}function Qo(){var s,t,e,r,i,n,a;try{let o=window.app.plugins,l=(s=o.getPlugin("calendar"))==null?void 0:s.options,c=(e=(t=o.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.weekly;if(qo("weekly"))return{format:c.format||Kp,folder:((r=c.folder)==null?void 0:r.trim())||"",template:((i=c.template)==null?void 0:i.trim())||""};let d=l||{};return{format:d.weeklyNoteFormat||Kp,folder:((n=d.weeklyNoteFolder)==null?void 0:n.trim())||"",template:((a=d.weeklyNoteTemplate)==null?void 0:a.trim())||""}}catch(o){console.info("No custom weekly note settings found!",o)}}function Ko(){var t,e,r,i;let s=window.app.plugins;try{let n=qo("monthly")&&((e=(t=s.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.monthly)||{};return{format:n.format||gS,folder:((r=n.folder)==null?void 0:r.trim())||"",template:((i=n.template)==null?void 0:i.trim())||""}}catch(n){console.info("No custom monthly note settings found!",n)}}function Zo(){var t,e,r,i;let s=window.app.plugins;try{let n=qo("quarterly")&&((e=(t=s.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.quarterly)||{};return{format:n.format||yS,folder:((r=n.folder)==null?void 0:r.trim())||"",template:((i=n.template)==null?void 0:i.trim())||""}}catch(n){console.info("No custom quarterly note settings found!",n)}}function Jo(){var t,e,r,i;let s=window.app.plugins;try{let n=qo("yearly")&&((e=(t=s.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.yearly)||{};return{format:n.format||vS,folder:((r=n.folder)==null?void 0:r.trim())||"",template:((i=n.template)==null?void 0:i.trim())||""}}catch(n){console.info("No custom yearly note settings found!",n)}}function wS(...s){let t=[];for(let r=0,i=s.length;r<i;r++)t=t.concat(s[r].split("/"));let e=[];for(let r=0,i=t.length;r<i;r++){let n=t[r];!n||n==="."||e.push(n)}return t[0]===""&&e.unshift(""),e.join("/")}function UA(s){let t=s.substring(s.lastIndexOf("/")+1);return t.lastIndexOf(".")!=-1&&(t=t.substring(0,t.lastIndexOf("."))),t}async function $A(s){let t=s.replace(/\\/g,"/").split("/");if(t.pop(),t.length){let e=wS(...t);window.app.vault.getAbstractFileByPath(e)||await window.app.vault.createFolder(e)}}async function Xo(s,t){t.endsWith(".md")||(t+=".md");let e=et.normalizePath(wS(s,t));return await $A(e),e}async function Ma(s){let{metadataCache:t,vault:e}=window.app,r=et.normalizePath(s);if(r==="/")return Promise.resolve(["",null]);try{let i=t.getFirstLinkpathDest(r,""),n=await e.cachedRead(i),a=window.app.foldManager.load(i);return[n,a]}catch(i){return console.error(`Failed to read the daily note template '${r}'`,i),new et.Notice("Failed to read the daily note template"),["",null]}}function di(s,t="day"){let e=s.clone().startOf(t).format();return`${t}-${e}`}function TS(s){return s.replace(/\[[^\]]*\]/g,"")}function VA(s,t){if(t==="week"){let e=TS(s);return/w{1,2}/i.test(e)&&(/M{1,4}/.test(e)||/D{1,4}/.test(e))}return!1}function _a(s,t){return bS(s.basename,t)}function WA(s,t){return bS(UA(s),t)}function bS(s,t){let r={day:Go,week:Qo,month:Ko,quarter:Zo,year:Jo}[t]().format.split("/").pop(),i=window.moment(s,r,!0);if(!i.isValid())return null;if(VA(r,t)&&t==="week"){let n=TS(r);if(/w{1,2}/i.test(n))return window.moment(s,r.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return i}var Zp=class extends Error{};async function kS(s){let t=window.app,{vault:e}=t,r=window.moment,{template:i,format:n,folder:a}=Go(),[o,l]=await Ma(i),c=s.format(n),d=await Xo(a,c);try{let u=await e.create(d,o.replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,r().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(h,p,f,m,g,y)=>{let w=r(),T=s.clone().set({hour:w.get("hour"),minute:w.get("minute"),second:w.get("second")});return f&&T.add(parseInt(m,10),g),y?T.format(y.substring(1).trim()):T.format(n)}).replace(/{{\s*yesterday\s*}}/gi,s.clone().subtract(1,"day").format(n)).replace(/{{\s*tomorrow\s*}}/gi,s.clone().add(1,"d").format(n)));return t.foldManager.save(u,l),u}catch(u){console.error(`Failed to create file: '${d}'`,u),new et.Notice("Unable to create new file.")}}function YA(s,t){var e;return(e=t[di(s,"day")])!=null?e:null}function jA(){let{vault:s}=window.app,{folder:t}=Go(),e=s.getAbstractFileByPath(et.normalizePath(t));if(!e)throw new Zp("Failed to find daily notes folder");let r={};return et.Vault.recurseChildren(e,i=>{if(i instanceof et.TFile){let n=_a(i,"day");if(n){let a=di(n,"day");r[a]=i}}}),r}var Jp=class extends Error{};function zA(){let{moment:s}=window,t=s.localeData()._week.dow,e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;t;)e.push(e.shift()),t--;return e}function qA(s){return zA().indexOf(s.toLowerCase())}async function SS(s){let{vault:t}=window.app,{template:e,format:r,folder:i}=Qo(),[n,a]=await Ma(e),o=s.format(r),l=await Xo(i,o);try{let c=await t.create(l,n.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,p,f,m)=>{let g=window.moment(),y=s.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&y.add(parseInt(p,10),f),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*title\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(d,u,h)=>{let p=qA(u);return s.weekday(p).format(h.trim())}));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new et.Notice("Unable to create new file.")}}function GA(s,t){var e;return(e=t[di(s,"week")])!=null?e:null}function QA(){let s={};if(!DS())return s;let{vault:t}=window.app,{folder:e}=Qo(),r=t.getAbstractFileByPath(et.normalizePath(e));if(!r)throw new Jp("Failed to find weekly notes folder");return et.Vault.recurseChildren(r,i=>{if(i instanceof et.TFile){let n=_a(i,"week");if(n){let a=di(n,"week");s[a]=i}}}),s}var Xp=class extends Error{};async function ES(s){let{vault:t}=window.app,{template:e,format:r,folder:i}=Ko(),[n,a]=await Ma(e),o=s.format(r),l=await Xo(i,o);try{let c=await t.create(l,n.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,p,f,m)=>{let g=window.moment(),y=s.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&y.add(parseInt(p,10),f),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new et.Notice("Unable to create new file.")}}function KA(s,t){var e;return(e=t[di(s,"month")])!=null?e:null}function ZA(){let s={};if(!CS())return s;let{vault:t}=window.app,{folder:e}=Ko(),r=t.getAbstractFileByPath(et.normalizePath(e));if(!r)throw new Xp("Failed to find monthly notes folder");return et.Vault.recurseChildren(r,i=>{if(i instanceof et.TFile){let n=_a(i,"month");if(n){let a=di(n,"month");s[a]=i}}}),s}var ef=class extends Error{};async function JA(s){let{vault:t}=window.app,{template:e,format:r,folder:i}=Zo(),[n,a]=await Ma(e),o=s.format(r),l=await Xo(i,o);try{let c=await t.create(l,n.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,p,f,m)=>{let g=window.moment(),y=s.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&y.add(parseInt(p,10),f),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new et.Notice("Unable to create new file.")}}function XA(s,t){var e;return(e=t[di(s,"quarter")])!=null?e:null}function eI(){let s={};if(!xS())return s;let{vault:t}=window.app,{folder:e}=Zo(),r=t.getAbstractFileByPath(et.normalizePath(e));if(!r)throw new ef("Failed to find quarterly notes folder");return et.Vault.recurseChildren(r,i=>{if(i instanceof et.TFile){let n=_a(i,"quarter");if(n){let a=di(n,"quarter");s[a]=i}}}),s}var tf=class extends Error{};async function tI(s){let{vault:t}=window.app,{template:e,format:r,folder:i}=Jo(),[n,a]=await Ma(e),o=s.format(r),l=await Xo(i,o);try{let c=await t.create(l,n.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,p,f,m)=>{let g=window.moment(),y=s.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&y.add(parseInt(p,10),f),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new et.Notice("Unable to create new file.")}}function rI(s,t){var e;return(e=t[di(s,"year")])!=null?e:null}function iI(){let s={};if(!MS())return s;let{vault:t}=window.app,{folder:e}=Jo(),r=t.getAbstractFileByPath(et.normalizePath(e));if(!r)throw new tf("Failed to find yearly notes folder");return et.Vault.recurseChildren(r,i=>{if(i instanceof et.TFile){let n=_a(i,"year");if(n){let a=di(n,"year");s[a]=i}}}),s}function sI(){var r,i;let{app:s}=window,t=s.internalPlugins.plugins["daily-notes"];if(t&&t.enabled)return!0;let e=s.plugins.getPlugin("periodic-notes");return e&&((i=(r=e.settings)==null?void 0:r.daily)==null?void 0:i.enabled)}function DS(){var e,r;let{app:s}=window;if(s.plugins.getPlugin("calendar"))return!0;let t=s.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e.weekly)==null?void 0:r.enabled)}function CS(){var e,r;let{app:s}=window,t=s.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e.monthly)==null?void 0:r.enabled)}function xS(){var e,r;let{app:s}=window,t=s.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e.quarterly)==null?void 0:r.enabled)}function MS(){var e,r;let{app:s}=window,t=s.plugins.getPlugin("periodic-notes");return t&&((r=(e=t.settings)==null?void 0:e.yearly)==null?void 0:r.enabled)}function nI(s){let t={day:Go,week:Qo,month:Ko,quarter:Zo,year:Jo}[s];return t()}function aI(s,t){return{day:kS,month:ES,week:SS}[s](t)}ye.DEFAULT_DAILY_NOTE_FORMAT=Qp;ye.DEFAULT_MONTHLY_NOTE_FORMAT=gS;ye.DEFAULT_QUARTERLY_NOTE_FORMAT=yS;ye.DEFAULT_WEEKLY_NOTE_FORMAT=Kp;ye.DEFAULT_YEARLY_NOTE_FORMAT=vS;ye.appHasDailyNotesPluginLoaded=sI;ye.appHasMonthlyNotesPluginLoaded=CS;ye.appHasQuarterlyNotesPluginLoaded=xS;ye.appHasWeeklyNotesPluginLoaded=DS;ye.appHasYearlyNotesPluginLoaded=MS;ye.createDailyNote=kS;ye.createMonthlyNote=ES;ye.createPeriodicNote=aI;ye.createQuarterlyNote=JA;ye.createWeeklyNote=SS;ye.createYearlyNote=tI;ye.getAllDailyNotes=jA;ye.getAllMonthlyNotes=ZA;ye.getAllQuarterlyNotes=eI;ye.getAllWeeklyNotes=QA;ye.getAllYearlyNotes=iI;ye.getDailyNote=YA;ye.getDailyNoteSettings=Go;ye.getDateFromFile=_a;ye.getDateFromPath=WA;ye.getDateUID=di;ye.getMonthlyNote=KA;ye.getMonthlyNoteSettings=Ko;ye.getPeriodicNoteSettings=nI;ye.getQuarterlyNote=XA;ye.getQuarterlyNoteSettings=Zo;ye.getTemplateInfo=Ma;ye.getWeeklyNote=GA;ye.getWeeklyNoteSettings=Qo;ye.getYearlyNote=rI;ye.getYearlyNoteSettings=Jo});var el,oI,lI,cI,dI,uI,xr,Dd=v(()=>{el={title:"title",status:"status",priority:"priority",due:"due",scheduled:"scheduled",contexts:"contexts",projects:"projects",timeEstimate:"timeEstimate",completedDate:"completedDate",dateCreated:"dateCreated",dateModified:"dateModified",recurrence:"recurrence",archiveTag:"archived",timeEntries:"timeEntries",completeInstances:"complete_instances",pomodoros:"pomodoros",icsEventId:"icsEventId",icsEventTag:"ics_event",reminders:"reminders"},oI=[{id:"none",value:"none",label:"None",color:"#cccccc",isCompleted:!1,order:0},{id:"open",value:"open",label:"Open",color:"#808080",isCompleted:!1,order:1},{id:"in-progress",value:"in-progress",label:"In progress",color:"#0066cc",isCompleted:!1,order:2},{id:"done",value:"done",label:"Done",color:"#00aa00",isCompleted:!0,order:3}],lI=[{id:"none",value:"none",label:"None",color:"#cccccc",weight:0},{id:"low",value:"low",label:"Low",color:"#00aa00",weight:1},{id:"normal",value:"normal",label:"Normal",color:"#ffaa00",weight:2},{id:"high",value:"high",label:"High",color:"#ff0000",weight:3}],cI={defaultContexts:"",defaultTags:"",defaultProjects:"",useParentNoteAsProject:!1,defaultTimeEstimate:0,defaultRecurrence:"none",defaultDueDate:"none",defaultScheduledDate:"today",bodyTemplate:"",useBodyTemplate:!1,defaultReminders:[]},dI={defaultView:"dayGridMonth",customDayCount:3,slotDuration:"00:30:00",slotMinTime:"00:00:00",slotMaxTime:"24:00:00",scrollTime:"08:00:00",firstDay:1,timeFormat:"24",showWeekends:!0,locale:"",defaultShowScheduled:!0,defaultShowDue:!0,defaultShowDueWhenScheduled:!0,defaultShowTimeEntries:!1,defaultShowRecurring:!0,defaultShowICSEvents:!0,enableTimeblocking:!1,defaultShowTimeblocks:!0,nowIndicator:!0,selectMirror:!0,weekNumbers:!1,showTodayHighlight:!0},uI={defaultNoteTemplate:"",defaultNoteFolder:"",icsNoteFilenameFormat:"title",customICSNoteFilenameTemplate:"{title}"},xr={tasksFolder:"TaskNotes/Tasks",moveArchivedTasks:!1,archiveFolder:"TaskNotes/Archive",taskTag:"task",taskIdentificationMethod:"tag",taskPropertyName:"",taskPropertyValue:"",excludedFolders:"",defaultTaskPriority:"normal",defaultTaskStatus:"open",taskOrgFiltersCollapsed:!1,taskFilenameFormat:"zettel",storeTitleInFilename:!0,customFilenameTemplate:"{title}",taskCreationDefaults:cI,calendarViewSettings:dI,pomodoroWorkDuration:25,pomodoroShortBreakDuration:5,pomodoroLongBreakDuration:15,pomodoroLongBreakInterval:4,pomodoroAutoStartBreaks:!0,pomodoroAutoStartWork:!1,pomodoroNotifications:!0,pomodoroSoundEnabled:!0,pomodoroSoundVolume:50,pomodoroStorageLocation:"plugin",enableTaskLinkOverlay:!0,enableInstantTaskConvert:!0,useDefaultsOnInstantConvert:!0,enableNaturalLanguageInput:!0,nlpDefaultToScheduled:!0,statusSuggestionTrigger:"*",singleClickAction:"edit",doubleClickAction:"openNote",inlineTaskConvertFolder:"{{currentNotePath}}",disableNoteIndexing:!1,suggestionDebounceMs:0,fieldMapping:el,customStatuses:oI,customPriorities:lI,recurrenceMigrated:!1,showTrackedTasksInStatusBar:!1,autoStopTimeTrackingOnComplete:!0,autoStopTimeTrackingNotification:!1,showProjectSubtasks:!0,showExpandableSubtasks:!0,projectSubtasksPosition:"bottom",subtaskChevronPosition:"right",viewsButtonAlignment:"right",hideCompletedFromOverdue:!0,icsIntegration:uI,savedViews:[],enableNotifications:!0,notificationType:"system",enableAPI:!1,apiPort:8080,apiAuthToken:"",webhooks:[],userFields:[],defaultVisibleProperties:["status","priority","due","scheduled","projects","contexts","tags"],maintainDueDateOffsetInRecurring:!1}});var Rs,Cd=v(()=>{Rs=class s{constructor(t){this.statuses=t}getNextStatus(t){var n;let e=this.getStatusesByOrder(),r=e.findIndex(a=>a.value===t);if(r===-1)return((n=e[0])==null?void 0:n.value)||"open";let i=(r+1)%e.length;return e[i].value}getStatusConfig(t){return this.statuses.find(e=>e.value===t)}getCompletedStatuses(){return this.statuses.filter(t=>t.isCompleted).map(t=>t.value)}getOpenStatuses(){return this.statuses.filter(t=>!t.isCompleted).map(t=>t.value)}getStatusesByOrder(){return[...this.statuses].sort((t,e)=>t.order-e.order)}isCompletedStatus(t){let e=this.getStatusConfig(t);return(e==null?void 0:e.isCompleted)||!1}getStatusOrder(t){let e=this.getStatusConfig(t);return(e==null?void 0:e.order)||0}getStatusStyles(){let t=[];for(let e of this.statuses){let r=`--status-${e.value.replace(/[^a-zA-Z0-9-]/g,"-")}-color`;t.push(`${r}: ${e.color};`)}return`:root { ${t.join(" ")} }`}getAllStatuses(){return[...this.statuses]}getNonCompletionStatuses(){return this.statuses.filter(t=>!t.isCompleted)}updateStatuses(t){this.statuses=t}static validateStatuses(t){let e=[];t.length<2&&e.push("At least 2 statuses are required"),t.some(l=>l.isCompleted)||e.push("At least one status must be marked as completed");let i=t.map(l=>l.value),n=new Set(i);i.length!==n.size&&e.push("Status values must be unique");let a=t.map(l=>l.id),o=new Set(a);a.length!==o.size&&e.push("Status IDs must be unique");for(let l of t){if(!l.value||l.value.trim()===""){e.push("Status values cannot be empty");break}if(!l.label||l.label.trim()===""){e.push("Status labels cannot be empty");break}if(!l.color||!l.color.match(/^#[0-9a-fA-F]{6}$/)){e.push("Status colors must be valid hex colors (#rrggbb)");break}}return{valid:e.length===0,errors:e}}static generateStatusId(t){let e=new Set(t.map(n=>n.id)),r=1,i=`status-${r}`;for(;e.has(i);)r++,i=`status-${r}`;return i}static createDefaultStatus(t){let e=s.generateStatusId(t),r=Math.max(...t.map(i=>i.order),0)+1;return{id:e,value:"new-status",label:"New status",color:"#808080",isCompleted:!1,order:r}}}});async function ui(s,t){return new rf(s,t).show()}var xd,rf,Md=v(()=>{xd=require("obsidian"),rf=class extends xd.Modal{constructor(t,e){super(t),this.options={confirmText:"Confirm",cancelText:"Cancel",isDestructive:!1,...e}}show(){return new Promise(t=>{this.resolve=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),new xd.Setting(t).setName(this.options.title).setHeading(),t.createEl("p",{text:this.options.message});let e=t.createEl("div",{cls:"modal-button-container"});e.style.display="flex",e.style.gap="10px",e.style.justifyContent="flex-end",e.style.marginTop="20px";let r=e.createEl("button",{text:this.options.cancelText});r.addEventListener("click",()=>{this.resolve(!1),this.close()});let i=e.createEl("button",{text:this.options.confirmText,cls:this.options.isDestructive?"mod-warning":"mod-cta"});this.options.isDestructive&&(i.style.backgroundColor="var(--color-red)",i.style.color="white"),i.addEventListener("click",()=>{this.resolve(!0),this.close()}),r.focus()}onClose(){let{contentEl:t}=this;t.empty(),this.resolve&&this.resolve(!1)}}});function hi(s){if(s==null)return[];let t=[],e="",r=0,i=null;for(let a=0;a<s.length;a++){let o=s[a],l=s[a+1];if(!i&&o==="["&&l==="["){r++,e+="[[",a++;continue}if(!i&&o==="]"&&l==="]"&&r>0){r--,e+="]]",a++;continue}if(!r&&(o==='"'||o==="'")){i===null?i=o:i===o&&(i=null),e+=o;continue}if(o===","&&r===0&&i===null){let c=e.trim();c&&t.push(c),e="";continue}e+=o}let n=e.trim();return n&&t.push(n),t}var Pa=v(()=>{});function Yr(s){if(!s){let e=new Error("Date string cannot be empty");throw console.error("Date parsing error:",{dateString:s,error:e.message}),e}let t=s.trim();try{let e=t.match(/^(\d{4}-\d{2}-\d{2})\s+(Mon|Tue|Wed|Thu|Fri|Sat|Sun|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)$/i);if(e){let r=e[1];return Yr(r)}if(t.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(t)){let r=new Error(`Invalid date format - time without date: ${s}`);throw console.warn("Date parsing error - incomplete time format:",{original:s,trimmed:t,error:r.message}),r}if(/^\d{4}-W\d{2}$/.test(t)){let[r,i]=t.split("-W"),n=parseInt(r,10),a=parseInt(i,10);if(isNaN(n)||isNaN(a)){let u=new Error(`Invalid numeric values in ISO week format: ${s}`);throw console.warn("Date parsing error - invalid ISO week numbers:",{original:s,year:r,week:i,yearNum:n,weekNum:a}),u}if(a<1||a>53){let u=new Error(`Invalid week number in ISO week format: ${s} (week must be 1-53)`);throw console.warn("Date parsing error - week number out of range:",{original:s,weekNum:a,error:u.message}),u}let o=new Date(n,0,4),l=o.getDay(),c=new Date(o);c.setDate(o.getDate()-(l===0?6:l-1));let d=new Date(c);if(d.setDate(c.getDate()+(a-1)*7),!nr(d)){let u=new Error(`Failed to calculate date from ISO week format: ${s}`);throw console.error("Date parsing error - ISO week calculation failed:",{original:s,yearNum:n,weekNum:a,jan4:o.toISOString(),targetWeekMonday:d.toString()}),u}return d}if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}(:\d{2})?/.test(t)){let r=t.replace(" ","T"),i=In(r);if(!nr(i)){let n=new Error(`Invalid space-separated datetime: ${s}`);throw console.warn("Date parsing error - space-separated datetime invalid:",{original:s,converted:r,error:n.message}),n}return i}if(t.includes("T")||t.includes("Z")||t.match(/[+-]\d{2}:\d{2}$/)){let r=In(t);if(!nr(r)){let i=new Error(`Invalid timezone-aware date: ${s}`);throw console.warn("Date parsing error - timezone-aware format invalid:",{original:s,trimmed:t,error:i.message}),i}return r}else{let r=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!r){let l=new Error(`Invalid date-only string: ${s} (expected format: yyyy-MM-dd)`);throw console.warn("Date parsing error - date-only format invalid:",{original:s,trimmed:t,expectedFormat:"yyyy-MM-dd",error:l.message}),l}let[,i,n,a]=r,o=new Date(parseInt(i,10),parseInt(n,10)-1,parseInt(a,10));if(!nr(o)||o.getFullYear()!==parseInt(i,10)||o.getMonth()!==parseInt(n,10)-1||o.getDate()!==parseInt(a,10)){let l=new Error(`Invalid date values: ${s}`);throw console.warn("Date parsing error - invalid date values:",{original:s,year:i,month:n,day:a,error:l.message}),l}return o}}catch(e){if(e instanceof Error&&e.message.includes("Invalid date"))throw e;let r=new Error(`Unexpected error parsing date "${s}": ${e instanceof Error?e.message:String(e)}`);throw console.error("Unexpected date parsing error:",{original:s,trimmed:t,error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),r}}function Ae(s){if(!s){let e=new Error("Date string cannot be empty");throw console.error("Date parsing error:",{dateString:s,error:e.message}),e}let t=s.trim();try{let e=t.match(/^(\d{4}-\d{2}-\d{2})\s+(Mon|Tue|Wed|Thu|Fri|Sat|Sun|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)$/i);if(e){let i=e[1];return Ae(i)}let r=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r){let[,i,n,a]=r,o=parseInt(i,10),l=parseInt(n,10),c=parseInt(a,10);if(l<1||l>12)throw new Error(`Invalid month in date: ${s}`);if(c<1||c>31)throw new Error(`Invalid day in date: ${s}`);let d=new Date(Date.UTC(o,l-1,c));if(d.getUTCFullYear()!==o||d.getUTCMonth()!==l-1||d.getUTCDate()!==c)throw new Error(`Invalid date values: ${s}`);return d}return _t(t)}catch(e){let r=new Error(`Failed to parse date to UTC: ${t}`);throw console.error("Date parsing error:",{dateString:s,trimmed:t,error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),r}}function At(s,t){try{let e=ue(s),r=ue(t),i=Ae(e),n=Ae(r);return i.getTime()===n.getTime()}catch(e){return console.error("Error comparing dates:",{date1:s,date2:t,error:e}),!1}}function xi(s,t){try{let e=ue(s),r=ue(t),i=Ae(e),n=Ae(r);return i.getTime()<n.getTime()}catch(e){return console.error("Error comparing dates for before:",{date1:s,date2:t,error:e}),!1}}function St(){return C(new Date,"yyyy-MM-dd")}function Ue(){let s=new Date;return new Date(s.getFullYear(),s.getMonth(),s.getDate())}function Oa(s){if(!s)throw new Error("Date string cannot be empty");let e=s.trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(e){let[,r,i,n]=e,a=new Date(parseInt(r,10),parseInt(i,10)-1,parseInt(n,10));if(!nr(a)||a.getFullYear()!==parseInt(r,10)||a.getMonth()!==parseInt(i,10)-1||a.getDate()!==parseInt(n,10))throw new Error(`Invalid date values: ${s}`);return a}return Yr(s)}function of(s,t,e){return new Date(s,t,e)}function al(s,t,e){return new Date(Date.UTC(s,t,e))}function Pn(s){let t=s.getUTCFullYear(),e=s.getUTCMonth(),r=s.getUTCDate();return new Date(t,e,r)}function PS(s){if(!s||s.trim()==="")return!0;try{return Yr(s),!0}catch(t){return!1}}function Ra(s,t){try{let e=Yr(s),r=sr(e,t);return C(r,"yyyy-MM-dd")}catch(e){throw console.error("Error adding days to date string:",{dateString:s,days:t,error:e}),e}}function NS(s,t){try{let e=Yr(s),r=Rv(e,t);return C(r,"yyyy-MM-dd")}catch(e){throw console.error("Error adding weeks to date string:",{dateString:s,weeks:t,error:e}),e}}function Fd(s){try{return Ae(s)}catch(t){throw console.error("Error getting start of day for date string:",{dateString:s,error:t}),t}}function Fs(s){if(!s)return!1;try{let t=Oa(s),e=Ue();return jo(t,e)}catch(t){return console.error("Error checking if date is today:",{dateString:s,error:t}),!1}}function Fa(s){return xi(s,St())}function _r(s,t="MMM d, yyyy"){try{let e=Yr(s);return C(e,t)}catch(e){return console.error("Error formatting date for display:",{dateString:s,error:e}),s}}function ke(){let s=new Date,t=-s.getTimezoneOffset(),e=t>=0?"+":"-",r=p=>String(Math.abs(p)).padStart(2,"0"),i=r(Math.floor(Math.abs(t)/60)),n=r(Math.abs(t)%60),a=s.getFullYear(),o=r(s.getMonth()+1),l=r(s.getDate()),c=r(s.getHours()),d=r(s.getMinutes()),u=r(s.getSeconds()),h=String(s.getMilliseconds()).padStart(3,"0");return`${a}-${o}-${l}T${c}:${d}:${u}.${h}${e}${i}:${n}`}function Ld(){return ae(new Date)}function lf(s){try{if(!s)throw new Error("Timestamp string cannot be empty");let t=In(s);if(!nr(t))throw new Error(`Invalid timestamp: ${s}`);return t}catch(t){throw console.error("Error parsing timestamp:",{timestampString:s,error:t}),t}}function cf(s,t="MMM d, yyyy h:mm a"){if(!s)return s;try{let e=lf(s);return nr(e)?C(e,t):s}catch(e){return console.error("Error formatting timestamp for display:",{timestampString:s,error:e}),s}}function ft(s){return s?/T\d{2}:\d{2}/.test(s):!1}function ue(s){if(!s)return"";try{if(/^\d{4}-\d{2}-\d{2}$/.test(s))return s;let t=s.indexOf("T");if(t>-1)return s.substring(0,t);let e=Ae(s);return ae(e)}catch(t){return console.error("Error extracting date part:",{dateString:s,error:t}),s}}function jt(s){if(!s||!ft(s))return null;try{let t=Yr(s);return C(t,"HH:mm")}catch(t){return console.error("Error extracting time part:",{dateString:s,error:t}),null}}function ar(s,t){if(!s)return"";if(!t)return s;try{let e=s.match(/^(\d{4}-\d{2}-\d{2})$/);if(e)return/^\d{2}:\d{2}$/.test(t)?`${e[1]}T${t}`:(console.warn("Invalid time format, expected HH:mm:",t),s);let r=ue(s);return!r||!/^\d{4}-\d{2}-\d{2}$/.test(r)?(console.warn("Invalid date part from dateString:",{dateString:s,datePart:r}),s):/^\d{2}:\d{2}$/.test(t)?`${r}T${t}`:(console.warn("Invalid time format, expected HH:mm:",t),s)}catch(e){return console.error("Error combining date and time:",{dateString:s,timeString:t,error:e}),s}}function zt(s,t={}){if(!s)return"";let{dateFormat:e="MMM d, yyyy",timeFormat:r="h:mm a",showTime:i=!0}=t;try{let n=Yr(s);return ft(s)&&i?!e||e.trim()===""?C(n,r):C(n,`${e} ${r}`):!e||e.trim()===""?"":C(n,e)}catch(n){return console.error("Error formatting datetime for display:",{dateString:s,error:n}),s}}function Ls(s,t){try{let e=Ae(s),r=Ae(t),i=e,n=r;if(ft(s)){let a=jt(s);if(a){let[o,l]=a.split(":").map(Number);i=new Date(e),i.setUTCHours(o,l,0,0)}}if(ft(t)){let a=jt(t);if(a){let[o,l]=a.split(":").map(Number);n=new Date(r),n.setUTCHours(o,l,0,0)}}return ft(s)&&!ft(t)?(n=new Date(r),n.setUTCHours(23,59,59,999)):!ft(s)&&ft(t)&&(i=new Date(e),i.setUTCHours(23,59,59,999)),i.getTime()<n.getTime()}catch(e){return console.error("Error comparing dates time-aware:",{date1:s,date2:t,error:e}),!1}}function Mi(s,t,e){if(!s||e&&t)return!1;try{let r=new Date,i=Ae(s);if(ft(s))return Sd(i,r);{let n=Ot(new Date);return Sd(i,n)}}catch(r){return console.error("Error checking overdue status:",{dateString:s,error:r}),!1}}function df(s){if(!s)return!1;try{let t=ft(s)?Yr(s):Oa(s);return jo(t,new Date)}catch(t){return console.error("Error checking if today:",{dateString:s,error:t}),!1}}function Hd(s,t){if(!s||s.trim()==="")return!0;try{if(!PS(s))return!1;if(t&&t.trim()!==""){if(!/^\d{2}:\d{2}$/.test(t))return!1;let e=ar(s,t);return PS(e)}return!0}catch(e){return!1}}function RS(s){return Array.isArray(s)?s.filter(t=>{if(typeof t!="string"||!t.trim())return!1;let e=t.trim();if(e.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(e)||!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;try{return Yr(e),!0}catch(r){return console.warn("Invalid complete_instances entry (date parsing failed):",t,r),!1}}).map(t=>t.trim()):[]}function Mr(s){try{let t=s.match(/^(\d{4})-(\d{2})-(\d{2})/);if(!t)throw new Error(`Invalid date format for RRULE: ${s}`);let[,e,r,i]=t,n=parseInt(e,10),a=parseInt(r,10),o=parseInt(i,10);if(a<1||a>12)throw new Error(`Invalid month in date: ${s}`);if(o<1||o>31)throw new Error(`Invalid day in date: ${s}`);let l=new Date(Date.UTC(n,a-1,o));if(l.getUTCFullYear()!==n||l.getUTCMonth()!==a-1||l.getUTCDate()!==o)throw new Error(`Invalid date values: ${s}`);return l}catch(t){throw console.error("Error creating UTC date for RRULE:",{dateString:s,error:t}),t}}function dt(s){let t=s.getFullYear(),e=s.getMonth(),r=s.getDate();return new Date(Date.UTC(t,e,r,0,0,0,0))}function ol(s){try{let t=Ue(),e=dt(t);return s.getUTCFullYear()===e.getUTCFullYear()&&s.getUTCMonth()===e.getUTCMonth()&&s.getUTCDate()===e.getUTCDate()}catch(t){return console.error("Error in isTodayUTC:",t),!1}}function OS(s,t){try{let e=C(s,"yyyy-MM-dd"),r=C(t,"yyyy-MM-dd"),i=Mr(e),n=Mr(r);return{utcStart:i,utcEnd:n}}catch(e){throw console.error("Error normalizing calendar boundaries to UTC:",{startDate:s,endDate:t,error:e}),e}}function FS(s){try{let t=s.getUTCFullYear(),e=String(s.getUTCMonth()+1).padStart(2,"0"),r=String(s.getUTCDate()).padStart(2,"0");return`${t}-${e}-${r}`}catch(t){return console.error("Error formatting date as UTC string:",{date:s,error:t}),s.toISOString().split("T")[0]}}function ae(s){try{if(!s||!(s instanceof Date)||isNaN(s.getTime()))return console.warn("formatDateForStorage received invalid date:",s),"";let t=s.getUTCFullYear(),e=String(s.getUTCMonth()+1).padStart(2,"0"),r=String(s.getUTCDate()).padStart(2,"0");return`${t}-${e}-${r}`}catch(t){return console.error("Error formatting date for storage:",{date:s,error:t}),""}}function LS(s,t){let e=[],r=ae(s),i=ae(t),n=Mr(r),a=Mr(i);for(;n<=a;)e.push(new Date(n)),n.setUTCDate(n.getUTCDate()+1);return e}function uf(s,t=1){let e=Mr(ae(s)),i=(e.getUTCDay()-t+7)%7,n=new Date(e);return n.setUTCDate(n.getUTCDate()-i),n}function HS(s,t=1){let e=uf(s,t),r=new Date(e);return r.setUTCDate(r.getUTCDate()+6),r}function hf(s){let t=Mr(ae(s));return new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),1))}function pf(s){let t=Mr(ae(s));return new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth()+1,0))}function ff(s){if(!s||typeof s!="string")return!1;let t=s.toLowerCase().trim().replace(/\s+/g," ");return t in af?!0:[/^in\s+(\d+)\s+(days?)$/,/^(\d+)\s+(days?)\s+ago$/,/^in\s+(\d+)\s+(weeks?)$/,/^(\d+)\s+(weeks?)\s+ago$/].some(r=>r.test(t))}function mf(s){if(typeof s!="string")return!1;let t=s.trim();if(t===""||ff(t))return!0;try{let e=Yr(t);return nr(e)}catch(e){return!1}}function La(s){if(!s||typeof s!="string")return s;let t=s.toLowerCase().trim().replace(/\s+/g," ");if(t in af)try{return af[t]()}catch(e){return console.error("Error resolving natural language date:",{value:s,error:e}),s}try{let e=t.match(/^in\s+(\d+)\s+(days?)$/);if(e){let r=parseInt(e[1],10);return Ra(St(),r)}if(e=t.match(/^(\d+)\s+(days?)\s+ago$/),e){let r=parseInt(e[1],10);return Ra(St(),-r)}if(e=t.match(/^in\s+(\d+)\s+(weeks?)$/),e){let r=parseInt(e[1],10);return NS(St(),r)}if(e=t.match(/^(\d+)\s+(weeks?)\s+ago$/),e){let r=parseInt(e[1],10);return NS(St(),-r)}}catch(e){console.error("Error parsing relative natural language date:",{value:s,error:e})}return s}var _t,af,Se=v(()=>{ot();_t=Yr;af={today:()=>St(),tomorrow:()=>Ra(St(),1),yesterday:()=>Ra(St(),-1),"next week":()=>Ra(St(),7),"last week":()=>Ra(St(),-7)}});var ll,mt,Nn=v(()=>{ll=["MO","TU","WE","TH","FR","SA","SU"],mt=(function(){function s(t,e){if(e===0)throw new Error("Can't create weekday with n == 0");this.weekday=t,this.n=e}return s.fromStr=function(t){return new s(ll.indexOf(t))},s.prototype.nth=function(t){return this.n===t?this:new s(this.weekday,t)},s.prototype.equals=function(t){return this.weekday===t.weekday&&this.n===t.n},s.prototype.toString=function(){var t=ll[this.weekday];return this.n&&(t=(this.n>0?"+":"")+String(this.n)+t),t},s.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},s})()});function Rn(s,t,e){e===void 0&&(e=" ");var r=String(s);return t=t>>0,r.length>t?String(r):(t=t-r.length,t>e.length&&(e+=Ee(e,t/e.length)),e.slice(0,t)+String(r))}var Ge,Ar,gf,Lt,jr,Ee,BS,US,qt,Bd,Ir,ut,Ce,or=v(()=>{Nn();Ge=function(s){return s!=null},Ar=function(s){return typeof s=="number"},gf=function(s){return typeof s=="string"&&ll.includes(s)},Lt=Array.isArray,jr=function(s,t){t===void 0&&(t=s),arguments.length===1&&(t=s,s=0);for(var e=[],r=s;r<t;r++)e.push(r);return e},Ee=function(s,t){var e=0,r=[];if(Lt(s))for(;e<t;e++)r[e]=[].concat(s);else for(;e<t;e++)r[e]=s;return r},BS=function(s){return Lt(s)?s:[s]};US=function(s,t,e){var r=s.split(t);return e?r.slice(0,e).concat([r.slice(e).join(t)]):r},qt=function(s,t){var e=s%t;return e*t<0?e+t:e},Bd=function(s,t){return{div:Math.floor(s/t),mod:qt(s,t)}},Ir=function(s){return!Ge(s)||s.length===0},ut=function(s){return!Ir(s)},Ce=function(s,t){return ut(s)&&s.indexOf(t)!==-1}});var _i,hI,VS,Ud,WS,pI,Ha,yf,On,fI,cl,$d,mI,es,vf,Vd,Wd,wf,ts,Ba,dl,$S,YS,Gt=v(()=>{or();_i=function(s,t,e,r,i,n){return r===void 0&&(r=0),i===void 0&&(i=0),n===void 0&&(n=0),new Date(Date.UTC(s,t-1,e,r,i,n))},hI=[31,28,31,30,31,30,31,31,30,31,30,31],VS=1e3*60*60*24,Ud=9999,WS=_i(1970,1,1),pI=[6,0,1,2,3,4,5],Ha=function(s){return s%4===0&&s%100!==0||s%400===0},yf=function(s){return s instanceof Date},On=function(s){return yf(s)&&!isNaN(s.getTime())},fI=function(s,t){var e=s.getTime(),r=t.getTime(),i=e-r;return Math.round(i/VS)},cl=function(s){return fI(s,WS)},$d=function(s){return new Date(WS.getTime()+s*VS)},mI=function(s){var t=s.getUTCMonth();return t===1&&Ha(s.getUTCFullYear())?29:hI[t]},es=function(s){return pI[s.getUTCDay()]},vf=function(s,t){var e=_i(s,t+1,1);return[es(e),mI(e)]},Vd=function(s,t){return t=t||s,new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))},Wd=function(s){var t=new Date(s.getTime());return t},wf=function(s){for(var t=[],e=0;e<s.length;e++)t.push(Wd(s[e]));return t},ts=function(s){s.sort(function(t,e){return t.getTime()-e.getTime()})},Ba=function(s,t){t===void 0&&(t=!0);var e=new Date(s);return[Rn(e.getUTCFullYear().toString(),4,"0"),Rn(e.getUTCMonth()+1,2,"0"),Rn(e.getUTCDate(),2,"0"),"T",Rn(e.getUTCHours(),2,"0"),Rn(e.getUTCMinutes(),2,"0"),Rn(e.getUTCSeconds(),2,"0"),t?"Z":""].join("")},dl=function(s){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,e=t.exec(s);if(!e)throw new Error("Invalid UNTIL value: ".concat(s));return new Date(Date.UTC(parseInt(e[1],10),parseInt(e[2],10)-1,parseInt(e[3],10),parseInt(e[5],10)||0,parseInt(e[6],10)||0,parseInt(e[7],10)||0))},$S=function(s,t){var e=s.toLocaleString("sv-SE",{timeZone:t});return e.replace(" ","T")+"Z"},YS=function(s,t){var e=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date($S(s,e)),i=new Date($S(s,t!=null?t:"UTC")),n=i.getTime()-r.getTime();return new Date(s.getTime()-n)}});var gI,rs,Yd=v(()=>{gI=(function(){function s(t,e){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=t,this.args=e,t==="between"?(this.maxDate=e.inc?e.before:new Date(e.before.getTime()-1),this.minDate=e.inc?e.after:new Date(e.after.getTime()+1)):t==="before"?this.maxDate=e.inc?e.dt:new Date(e.dt.getTime()-1):t==="after"&&(this.minDate=e.inc?e.dt:new Date(e.dt.getTime()+1))}return s.prototype.accept=function(t){++this.total;var e=this.minDate&&t<this.minDate,r=this.maxDate&&t>this.maxDate;if(this.method==="between"){if(e)return!0;if(r)return!1}else if(this.method==="before"){if(r)return!1}else if(this.method==="after")return e?!0:(this.add(t),!1);return this.add(t)},s.prototype.add=function(t){return this._result.push(t),!0},s.prototype.getValue=function(){var t=this._result;switch(this.method){case"all":case"between":return t;case"before":case"after":default:return t.length?t[t.length-1]:null}},s.prototype.clone=function(){return new s(this.method,this.args)},s})(),rs=gI});function Ua(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Tf(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function z(s,t,e){if(e||arguments.length===2)for(var r=0,i=t.length,n;r<i;r++)(n||!(r in t))&&(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return s.concat(n||Array.prototype.slice.call(t))}var Tf,Ht,is=v(()=>{Tf=function(s,t){return Tf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},Tf(s,t)};Ht=function(){return Ht=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},Ht.apply(this,arguments)}});var yI,bf,jS=v(()=>{is();Yd();yI=(function(s){Ua(t,s);function t(e,r,i){var n=s.call(this,e,r)||this;return n.iterator=i,n}return t.prototype.add=function(e){return this.iterator(e,this._result.length)?(this._result.push(e),!0):!1},t})(rs),bf=yI});var vI,Fn,jd=v(()=>{vI={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},Fn=vI});var zS,wI,TI,bI,Ai,qS=v(()=>{jd();zr();or();zS=function(s,t){return s.indexOf(t)!==-1},wI=function(s){return s.toString()},TI=function(s,t,e){return"".concat(t," ").concat(e,", ").concat(s)},bI=(function(){function s(t,e,r,i){if(e===void 0&&(e=wI),r===void 0&&(r=Fn),i===void 0&&(i=TI),this.text=[],this.language=r||Fn,this.gettext=e,this.dateFormatter=i,this.rrule=t,this.options=t.options,this.origOptions=t.origOptions,this.origOptions.bymonthday){var n=[].concat(this.options.bymonthday),a=[].concat(this.options.bynmonthday);n.sort(function(d,u){return d-u}),a.sort(function(d,u){return u-d}),this.bymonthday=n.concat(a),this.bymonthday.length||(this.bymonthday=null)}if(Ge(this.origOptions.byweekday)){var o=Lt(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],l=String(o);this.byweekday={allWeeks:o.filter(function(d){return!d.n}),someWeeks:o.filter(function(d){return!!d.n}),isWeekdays:l.indexOf("MO")!==-1&&l.indexOf("TU")!==-1&&l.indexOf("WE")!==-1&&l.indexOf("TH")!==-1&&l.indexOf("FR")!==-1&&l.indexOf("SA")===-1&&l.indexOf("SU")===-1,isEveryDay:l.indexOf("MO")!==-1&&l.indexOf("TU")!==-1&&l.indexOf("WE")!==-1&&l.indexOf("TH")!==-1&&l.indexOf("FR")!==-1&&l.indexOf("SA")!==-1&&l.indexOf("SU")!==-1};var c=function(d,u){return d.weekday-u.weekday};this.byweekday.allWeeks.sort(c),this.byweekday.someWeeks.sort(c),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return s.isFullyConvertible=function(t){var e=!0;if(!(t.options.freq in s.IMPLEMENTED)||t.origOptions.until&&t.origOptions.count)return!1;for(var r in t.origOptions){if(zS(["dtstart","tzid","wkst","freq"],r))return!0;if(!zS(s.IMPLEMENTED[t.options.freq],r))return!1}return e},s.prototype.isFullyConvertible=function(){return s.isFullyConvertible(this.rrule)},s.prototype.toString=function(){var t=this.gettext;if(!(this.options.freq in s.IMPLEMENTED))return t("RRule error: Unable to fully convert this rrule to text");if(this.text=[t("every")],this[q.FREQUENCIES[this.options.freq]](),this.options.until){this.add(t("until"));var e=this.options.until;this.add(this.dateFormatter(e.getUTCFullYear(),this.language.monthNames[e.getUTCMonth()],e.getUTCDate()))}else this.options.count&&this.add(t("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?t("times"):t("time"));return this.isFullyConvertible()||this.add(t("(~ approximate)")),this.text.join("")},s.prototype.HOURLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("hours"):t("hour"))},s.prototype.MINUTELY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("minutes"):t("minute"))},s.prototype.DAILY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(this.plural(this.options.interval)?t("days"):t("day")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},s.prototype.WEEKLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?t("weeks"):t("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(t("on")).add(t("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?t("days"):t("day")):(this.options.interval===1&&this.add(t("week")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},s.prototype.MONTHLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(t("months")),this.plural(this.options.interval)&&this.add(t("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("months"):t("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(t("on")).add(t("weekdays")):this.byweekday&&this._byweekday()},s.prototype.YEARLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(t("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("years"):t("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(t("on the")).add(this.list(this.options.byyearday,this.nth,t("and"))).add(t("day")),this.options.byweekno&&this.add(t("in")).add(this.plural(this.options.byweekno.length)?t("weeks"):t("week")).add(this.list(this.options.byweekno,void 0,t("and")))},s.prototype._bymonthday=function(){var t=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,t("or"))).add(t("the")).add(this.list(this.bymonthday,this.nth,t("or"))):this.add(t("on the")).add(this.list(this.bymonthday,this.nth,t("and")))},s.prototype._byweekday=function(){var t=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(t("and")),this.add(t("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,t("and"))))},s.prototype._byhour=function(){var t=this.gettext;this.add(t("at")).add(this.list(this.origOptions.byhour,void 0,t("and")))},s.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},s.prototype.nth=function(t){t=parseInt(t.toString(),10);var e,r=this.gettext;if(t===-1)return r("last");var i=Math.abs(t);switch(i){case 1:case 21:case 31:e=i+r("st");break;case 2:case 22:e=i+r("nd");break;case 3:case 23:e=i+r("rd");break;default:e=i+r("th")}return t<0?e+" "+r("last"):e},s.prototype.monthtext=function(t){return this.language.monthNames[t-1]},s.prototype.weekdaytext=function(t){var e=Ar(t)?(t+1)%7:t.getJsWeekday();return(t.n?this.nth(t.n)+" ":"")+this.language.dayNames[e]},s.prototype.plural=function(t){return t%100!==1},s.prototype.add=function(t){return this.text.push(" "),this.text.push(t),this},s.prototype.list=function(t,e,r,i){var n=this;i===void 0&&(i=","),Lt(t)||(t=[t]);var a=function(l,c,d){for(var u="",h=0;h<l.length;h++)h!==0&&(h===l.length-1?u+=" "+d+" ":u+=c+" "),u+=l[h];return u};e=e||function(l){return l.toString()};var o=function(l){return e&&e.call(n,l)};return r?a(t.map(o),i,r):t.map(o).join(i+" ")},s})(),Ai=bI});function ul(s,t){t===void 0&&(t=Fn);var e={},r=new kI(t.tokens);if(!r.start(s))return null;return i(),e;function i(){r.expect("every");var h=r.acceptNumber();if(h&&(e.interval=parseInt(h[0],10)),r.isDone())throw new Error("Unexpected end");switch(r.symbol){case"day(s)":e.freq=q.DAILY,r.nextSymbol()&&(a(),u());break;case"weekday(s)":e.freq=q.WEEKLY,e.byweekday=[q.MO,q.TU,q.WE,q.TH,q.FR],r.nextSymbol(),a(),u();break;case"week(s)":e.freq=q.WEEKLY,r.nextSymbol()&&(n(),a(),u());break;case"hour(s)":e.freq=q.HOURLY,r.nextSymbol()&&(n(),u());break;case"minute(s)":e.freq=q.MINUTELY,r.nextSymbol()&&(n(),u());break;case"month(s)":e.freq=q.MONTHLY,r.nextSymbol()&&(n(),u());break;case"year(s)":e.freq=q.YEARLY,r.nextSymbol()&&(n(),u());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":e.freq=q.WEEKLY;var p=r.symbol.substr(0,2).toUpperCase();if(e.byweekday=[q[p]],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var f=l();if(!f)throw new Error("Unexpected symbol "+r.symbol+", expected weekday");e.byweekday.push(q[f]),r.nextSymbol()}a(),d(),u();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(e.freq=q.YEARLY,e.bymonth=[o()],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var m=o();if(!m)throw new Error("Unexpected symbol "+r.symbol+", expected month");e.bymonth.push(m),r.nextSymbol()}n(),u();break;default:throw new Error("Unknown symbol")}}function n(){var h=r.accept("on"),p=r.accept("the");if(h||p)do{var f=c(),m=l(),g=o();if(f)m?(r.nextSymbol(),e.byweekday||(e.byweekday=[]),e.byweekday.push(q[m].nth(f))):(e.bymonthday||(e.bymonthday=[]),e.bymonthday.push(f),r.accept("day(s)"));else if(m)r.nextSymbol(),e.byweekday||(e.byweekday=[]),e.byweekday.push(q[m]);else if(r.symbol==="weekday(s)")r.nextSymbol(),e.byweekday||(e.byweekday=[q.MO,q.TU,q.WE,q.TH,q.FR]);else if(r.symbol==="week(s)"){r.nextSymbol();var y=r.acceptNumber();if(!y)throw new Error("Unexpected symbol "+r.symbol+", expected week number");for(e.byweekno=[parseInt(y[0],10)];r.accept("comma");){if(y=r.acceptNumber(),!y)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");e.byweekno.push(parseInt(y[0],10))}}else if(g)r.nextSymbol(),e.bymonth||(e.bymonth=[]),e.bymonth.push(g);else return}while(r.accept("comma")||r.accept("the")||r.accept("on"))}function a(){var h=r.accept("at");if(h)do{var p=r.acceptNumber();if(!p)throw new Error("Unexpected symbol "+r.symbol+", expected hour");for(e.byhour=[parseInt(p[0],10)];r.accept("comma");){if(p=r.acceptNumber(),!p)throw new Error("Unexpected symbol "+r.symbol+"; expected hour");e.byhour.push(parseInt(p[0],10))}}while(r.accept("comma")||r.accept("at"))}function o(){switch(r.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function l(){switch(r.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return r.symbol.substr(0,2).toUpperCase();default:return!1}}function c(){switch(r.symbol){case"last":return r.nextSymbol(),-1;case"first":return r.nextSymbol(),1;case"second":return r.nextSymbol(),r.accept("last")?-2:2;case"third":return r.nextSymbol(),r.accept("last")?-3:3;case"nth":var h=parseInt(r.value[1],10);if(h<-366||h>366)throw new Error("Nth out of range: "+h);return r.nextSymbol(),r.accept("last")?-h:h;default:return!1}}function d(){r.accept("on"),r.accept("the");var h=c();if(h)for(e.bymonthday=[h],r.nextSymbol();r.accept("comma");){if(h=c(),!h)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");e.bymonthday.push(h),r.nextSymbol()}}function u(){if(r.symbol==="until"){var h=Date.parse(r.text);if(!h)throw new Error("Cannot parse until date:"+r.text);e.until=new Date(h)}else r.accept("for")&&(e.count=parseInt(r.value[0],10),r.expect("number"))}}var kI,GS=v(()=>{jd();zr();kI=(function(){function s(t){this.done=!0,this.rules=t}return s.prototype.start=function(t){return this.text=t,this.done=!1,this.nextSymbol()},s.prototype.isDone=function(){return this.done&&this.symbol===null},s.prototype.nextSymbol=function(){var t,e;this.symbol=null,this.value=null;do{if(this.done)return!1;var r=void 0;t=null;for(var i in this.rules){r=this.rules[i];var n=r.exec(this.text);n&&(t===null||n[0].length>t[0].length)&&(t=n,e=i)}if(t!=null&&(this.text=this.text.substr(t[0].length),this.text===""&&(this.done=!0)),t==null){this.done=!0,this.symbol=null,this.value=null;return}}while(e==="SKIP");return this.symbol=e,this.value=t,!0},s.prototype.accept=function(t){if(this.symbol===t){if(this.value){var e=this.value;return this.nextSymbol(),e}return this.nextSymbol(),!0}return!1},s.prototype.acceptNumber=function(){return this.accept("number")},s.prototype.expect=function(t){if(this.accept(t))return!0;throw new Error("expected "+t+" but found "+this.symbol)},s})()});function hl(s){return s<ve.HOURLY}var ve,ss=v(()=>{(function(s){s[s.YEARLY=0]="YEARLY",s[s.MONTHLY=1]="MONTHLY",s[s.WEEKLY=2]="WEEKLY",s[s.DAILY=3]="DAILY",s[s.HOURLY=4]="HOURLY",s[s.MINUTELY=5]="MINUTELY",s[s.SECONDLY=6]="SECONDLY"})(ve||(ve={}))});var QS,$a,KS,ZS,JS=v(()=>{qS();GS();zr();ss();jd();QS=function(s,t){return t===void 0&&(t=Fn),new q(ul(s,t)||void 0)},$a=["count","until","interval","byweekday","bymonthday","bymonth"];Ai.IMPLEMENTED=[];Ai.IMPLEMENTED[ve.HOURLY]=$a;Ai.IMPLEMENTED[ve.MINUTELY]=$a;Ai.IMPLEMENTED[ve.DAILY]=["byhour"].concat($a);Ai.IMPLEMENTED[ve.WEEKLY]=$a;Ai.IMPLEMENTED[ve.MONTHLY]=$a;Ai.IMPLEMENTED[ve.YEARLY]=["byweekno","byyearday"].concat($a);KS=function(s,t,e,r){return new Ai(s,t,e,r).toString()},ZS=Ai.isFullyConvertible});var Va,XS,zd=v(()=>{is();ss();or();Gt();Va=(function(){function s(t,e,r,i){this.hour=t,this.minute=e,this.second=r,this.millisecond=i||0}return s.prototype.getHours=function(){return this.hour},s.prototype.getMinutes=function(){return this.minute},s.prototype.getSeconds=function(){return this.second},s.prototype.getMilliseconds=function(){return this.millisecond},s.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},s})(),XS=(function(s){Ua(t,s);function t(e,r,i,n,a,o,l){var c=s.call(this,n,a,o,l)||this;return c.year=e,c.month=r,c.day=i,c}return t.fromDate=function(e){return new this(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.valueOf()%1e3)},t.prototype.getWeekday=function(){return es(new Date(this.getTime()))},t.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},t.prototype.getDay=function(){return this.day},t.prototype.getMonth=function(){return this.month},t.prototype.getYear=function(){return this.year},t.prototype.addYears=function(e){this.year+=e},t.prototype.addMonths=function(e){if(this.month+=e,this.month>12){var r=Math.floor(this.month/12),i=qt(this.month,12);this.month=i,this.year+=r,this.month===0&&(this.month=12,--this.year)}},t.prototype.addWeekly=function(e,r){r>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-r))+e*7:this.day+=-(this.getWeekday()-r)+e*7,this.fixDay()},t.prototype.addDaily=function(e){this.day+=e,this.fixDay()},t.prototype.addHours=function(e,r,i){for(r&&(this.hour+=Math.floor((23-this.hour)/e)*e);;){this.hour+=e;var n=Bd(this.hour,24),a=n.div,o=n.mod;if(a&&(this.hour=o,this.addDaily(a)),Ir(i)||Ce(i,this.hour))break}},t.prototype.addMinutes=function(e,r,i,n){for(r&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/e)*e);;){this.minute+=e;var a=Bd(this.minute,60),o=a.div,l=a.mod;if(o&&(this.minute=l,this.addHours(o,!1,i)),(Ir(i)||Ce(i,this.hour))&&(Ir(n)||Ce(n,this.minute)))break}},t.prototype.addSeconds=function(e,r,i,n,a){for(r&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/e)*e);;){this.second+=e;var o=Bd(this.second,60),l=o.div,c=o.mod;if(l&&(this.second=c,this.addMinutes(l,!1,i,n)),(Ir(i)||Ce(i,this.hour))&&(Ir(n)||Ce(n,this.minute))&&(Ir(a)||Ce(a,this.second)))break}},t.prototype.fixDay=function(){if(!(this.day<=28)){var e=vf(this.year,this.month-1)[1];if(!(this.day<=e))for(;this.day>e;){if(this.day-=e,++this.month,this.month===13&&(this.month=1,++this.year,this.year>Ud))return;e=vf(this.year,this.month-1)[1]}}},t.prototype.add=function(e,r){var i=e.freq,n=e.interval,a=e.wkst,o=e.byhour,l=e.byminute,c=e.bysecond;switch(i){case ve.YEARLY:return this.addYears(n);case ve.MONTHLY:return this.addMonths(n);case ve.WEEKLY:return this.addWeekly(n,a);case ve.DAILY:return this.addDaily(n);case ve.HOURLY:return this.addHours(n,r,o);case ve.MINUTELY:return this.addMinutes(n,r,o,l);case ve.SECONDLY:return this.addSeconds(n,r,o,l,c)}},t})(Va)});function kf(s){for(var t=[],e=Object.keys(s),r=0,i=e;r<i.length;r++){var n=i[r];Ce(rE,n)||t.push(n),yf(s[n])&&!On(s[n])&&t.push(n)}if(t.length)throw new Error("Invalid options: "+t.join(", "));return Ht({},s)}function eE(s){var t=Ht(Ht({},pl),kf(s));if(Ge(t.byeaster)&&(t.freq=q.YEARLY),!(Ge(t.freq)&&q.FREQUENCIES[t.freq]))throw new Error("Invalid frequency: ".concat(t.freq," ").concat(s.freq));if(t.dtstart||(t.dtstart=new Date(new Date().setMilliseconds(0))),Ge(t.wkst)?Ar(t.wkst)||(t.wkst=t.wkst.weekday):t.wkst=q.MO.weekday,Ge(t.bysetpos)){Ar(t.bysetpos)&&(t.bysetpos=[t.bysetpos]);for(var e=0;e<t.bysetpos.length;e++){var r=t.bysetpos[e];if(r===0||!(r>=-366&&r<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(t.byweekno||ut(t.byweekno)||ut(t.byyearday)||t.bymonthday||ut(t.bymonthday)||Ge(t.byweekday)||Ge(t.byeaster)))switch(t.freq){case q.YEARLY:t.bymonth||(t.bymonth=t.dtstart.getUTCMonth()+1),t.bymonthday=t.dtstart.getUTCDate();break;case q.MONTHLY:t.bymonthday=t.dtstart.getUTCDate();break;case q.WEEKLY:t.byweekday=[es(t.dtstart)];break}if(Ge(t.bymonth)&&!Lt(t.bymonth)&&(t.bymonth=[t.bymonth]),Ge(t.byyearday)&&!Lt(t.byyearday)&&Ar(t.byyearday)&&(t.byyearday=[t.byyearday]),!Ge(t.bymonthday))t.bymonthday=[],t.bynmonthday=[];else if(Lt(t.bymonthday)){for(var i=[],n=[],e=0;e<t.bymonthday.length;e++){var r=t.bymonthday[e];r>0?i.push(r):r<0&&n.push(r)}t.bymonthday=i,t.bynmonthday=n}else t.bymonthday<0?(t.bynmonthday=[t.bymonthday],t.bymonthday=[]):(t.bynmonthday=[],t.bymonthday=[t.bymonthday]);if(Ge(t.byweekno)&&!Lt(t.byweekno)&&(t.byweekno=[t.byweekno]),!Ge(t.byweekday))t.bynweekday=null;else if(Ar(t.byweekday))t.byweekday=[t.byweekday],t.bynweekday=null;else if(gf(t.byweekday))t.byweekday=[mt.fromStr(t.byweekday).weekday],t.bynweekday=null;else if(t.byweekday instanceof mt)!t.byweekday.n||t.freq>q.MONTHLY?(t.byweekday=[t.byweekday.weekday],t.bynweekday=null):(t.bynweekday=[[t.byweekday.weekday,t.byweekday.n]],t.byweekday=null);else{for(var a=[],o=[],e=0;e<t.byweekday.length;e++){var l=t.byweekday[e];if(Ar(l)){a.push(l);continue}else if(gf(l)){a.push(mt.fromStr(l).weekday);continue}!l.n||t.freq>q.MONTHLY?a.push(l.weekday):o.push([l.weekday,l.n])}t.byweekday=ut(a)?a:null,t.bynweekday=ut(o)?o:null}return Ge(t.byhour)?Ar(t.byhour)&&(t.byhour=[t.byhour]):t.byhour=t.freq<q.HOURLY?[t.dtstart.getUTCHours()]:null,Ge(t.byminute)?Ar(t.byminute)&&(t.byminute=[t.byminute]):t.byminute=t.freq<q.MINUTELY?[t.dtstart.getUTCMinutes()]:null,Ge(t.bysecond)?Ar(t.bysecond)&&(t.bysecond=[t.bysecond]):t.bysecond=t.freq<q.SECONDLY?[t.dtstart.getUTCSeconds()]:null,{parsedOptions:t}}function tE(s){var t=s.dtstart.getTime()%1e3;if(!hl(s.freq))return[];var e=[];return s.byhour.forEach(function(r){s.byminute.forEach(function(i){s.bysecond.forEach(function(n){e.push(new Va(r,i,n,t))})})}),e}var Sf=v(()=>{is();ss();or();zr();Gt();Nn();zd()});function ml(s){var t=s.split(`
`).map(SI).filter(function(e){return e!==null});return Ht(Ht({},t[0]),t[1])}function fl(s){var t={},e=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(s);if(!e)return t;var r=e[1],i=e[2];return r&&(t.tzid=r),t.dtstart=dl(i),t}function SI(s){if(s=s.replace(/^\s+|\s+$/,""),!s.length)return null;var t=/^([A-Z]+?)[:;]/.exec(s.toUpperCase());if(!t)return iE(s);var e=t[1];switch(e.toUpperCase()){case"RRULE":case"EXRULE":return iE(s);case"DTSTART":return fl(s);default:throw new Error("Unsupported RFC prop ".concat(e," in ").concat(s))}}function iE(s){var t=s.replace(/^RRULE:/i,""),e=fl(t),r=s.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return r.forEach(function(i){var n=i.split("="),a=n[0],o=n[1];switch(a.toUpperCase()){case"FREQ":e.freq=ve[o.toUpperCase()];break;case"WKST":e.wkst=qr[o.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var l=EI(o),c=a.toLowerCase();e[c]=l;break;case"BYWEEKDAY":case"BYDAY":e.byweekday=DI(o);break;case"DTSTART":case"TZID":var d=fl(s);e.tzid=d.tzid,e.dtstart=d.dtstart;break;case"UNTIL":e.until=dl(o);break;case"BYEASTER":e.byeaster=Number(o);break;default:throw new Error("Unknown RRULE property '"+a+"'")}}),e}function EI(s){if(s.indexOf(",")!==-1){var t=s.split(",");return t.map(sE)}return sE(s)}function sE(s){return/^[+-]?\d+$/.test(s)?Number(s):s}function DI(s){var t=s.split(",");return t.map(function(e){if(e.length===2)return qr[e];var r=e.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!r||r.length<3)throw new SyntaxError("Invalid weekday string: ".concat(e));var i=Number(r[1]),n=r[2],a=qr[n].weekday;return new mt(a,i)})}var Ef=v(()=>{is();ss();Nn();Gt();zr()});var Ln,qd=v(()=>{Gt();Ln=(function(){function s(t,e){if(isNaN(t.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=t,this.tzid=e}return Object.defineProperty(s.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),s.prototype.toString=function(){var t=Ba(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(t):";TZID=".concat(this.tzid,":").concat(t)},s.prototype.getTime=function(){return this.date.getTime()},s.prototype.rezonedDate=function(){return this.isUTC?this.date:YS(this.date,this.tzid)},s})()});function gl(s){for(var t=[],e="",r=Object.keys(s),i=Object.keys(pl),n=0;n<r.length;n++)if(r[n]!=="tzid"&&Ce(i,r[n])){var a=r[n].toUpperCase(),o=s[r[n]],l="";if(!(!Ge(o)||Lt(o)&&!o.length)){switch(a){case"FREQ":l=q.FREQUENCIES[s.freq];break;case"WKST":Ar(o)?l=new mt(o).toString():l=o.toString();break;case"BYWEEKDAY":a="BYDAY",l=BS(o).map(function(p){return p instanceof mt?p:Lt(p)?new mt(p[0],p[1]):new mt(p)}).toString();break;case"DTSTART":e=CI(o,s.tzid);break;case"UNTIL":l=Ba(o,!s.tzid);break;default:if(Lt(o)){for(var c=[],d=0;d<o.length;d++)c[d]=String(o[d]);l=c.toString()}else l=String(o)}l&&t.push([a,l])}}var u=t.map(function(p){var f=p[0],m=p[1];return"".concat(f,"=").concat(m.toString())}).join(";"),h="";return u!==""&&(h="RRULE:".concat(u)),[e,h].filter(function(p){return!!p}).join(`
`)}function CI(s,t){return s?"DTSTART"+new Ln(new Date(s),t).toString():""}var Df=v(()=>{zr();or();Nn();Gt();qd()});function xI(s,t){return Array.isArray(s)?!Array.isArray(t)||s.length!==t.length?!1:s.every(function(e,r){return e.getTime()===t[r].getTime()}):s instanceof Date?t instanceof Date&&s.getTime()===t.getTime():s===t}var nE,aE=v(()=>{Yd();Gt();or();nE=(function(){function s(){this.all=!1,this.before=[],this.after=[],this.between=[]}return s.prototype._cacheAdd=function(t,e,r){e&&(e=e instanceof Date?Wd(e):wf(e)),t==="all"?this.all=e:(r._value=e,this[t].push(r))},s.prototype._cacheGet=function(t,e){var r=!1,i=e?Object.keys(e):[],n=function(d){for(var u=0;u<i.length;u++){var h=i[u];if(!xI(e[h],d[h]))return!0}return!1},a=this[t];if(t==="all")r=this.all;else if(Lt(a))for(var o=0;o<a.length;o++){var l=a[o];if(!(i.length&&n(l))){r=l._value;break}}if(!r&&this.all){for(var c=new rs(t,e),o=0;o<this.all.length&&c.accept(this.all[o]);o++);r=c.getValue(),this._cacheAdd(t,r,e)}return Lt(r)?wf(r):r instanceof Date?Wd(r):r},s})()});var oE,lE,MI,_I,Hs,Qt,cE,dE,AI,II,Bs,Kt,uE,hE,pE,fE,Cf,mE=v(()=>{is();or();oE=z(z(z(z(z(z(z(z(z(z(z(z(z([],Ee(1,31),!0),Ee(2,28),!0),Ee(3,31),!0),Ee(4,30),!0),Ee(5,31),!0),Ee(6,30),!0),Ee(7,31),!0),Ee(8,31),!0),Ee(9,30),!0),Ee(10,31),!0),Ee(11,30),!0),Ee(12,31),!0),Ee(1,7),!0),lE=z(z(z(z(z(z(z(z(z(z(z(z(z([],Ee(1,31),!0),Ee(2,29),!0),Ee(3,31),!0),Ee(4,30),!0),Ee(5,31),!0),Ee(6,30),!0),Ee(7,31),!0),Ee(8,31),!0),Ee(9,30),!0),Ee(10,31),!0),Ee(11,30),!0),Ee(12,31),!0),Ee(1,7),!0),MI=jr(1,29),_I=jr(1,30),Hs=jr(1,31),Qt=jr(1,32),cE=z(z(z(z(z(z(z(z(z(z(z(z(z([],Qt,!0),_I,!0),Qt,!0),Hs,!0),Qt,!0),Hs,!0),Qt,!0),Qt,!0),Hs,!0),Qt,!0),Hs,!0),Qt,!0),Qt.slice(0,7),!0),dE=z(z(z(z(z(z(z(z(z(z(z(z(z([],Qt,!0),MI,!0),Qt,!0),Hs,!0),Qt,!0),Hs,!0),Qt,!0),Qt,!0),Hs,!0),Qt,!0),Hs,!0),Qt,!0),Qt.slice(0,7),!0),AI=jr(-28,0),II=jr(-29,0),Bs=jr(-30,0),Kt=jr(-31,0),uE=z(z(z(z(z(z(z(z(z(z(z(z(z([],Kt,!0),II,!0),Kt,!0),Bs,!0),Kt,!0),Bs,!0),Kt,!0),Kt,!0),Bs,!0),Kt,!0),Bs,!0),Kt,!0),Kt.slice(0,7),!0),hE=z(z(z(z(z(z(z(z(z(z(z(z(z([],Kt,!0),AI,!0),Kt,!0),Bs,!0),Kt,!0),Bs,!0),Kt,!0),Kt,!0),Bs,!0),Kt,!0),Bs,!0),Kt,!0),Kt.slice(0,7),!0),pE=[0,31,60,91,121,152,182,213,244,274,305,335,366],fE=[0,31,59,90,120,151,181,212,243,273,304,334,365],Cf=(function(){for(var s=[],t=0;t<55;t++)s=s.concat(jr(7));return s})()});function gE(s,t){var e=_i(s,1,1),r=Ha(s)?366:365,i=Ha(s+1)?366:365,n=cl(e),a=es(e),o=Ht(Ht({yearlen:r,nextyearlen:i,yearordinal:n,yearweekday:a},PI(s)),{wnomask:null});if(Ir(t.byweekno))return o;o.wnomask=Ee(0,r+7);var l,c,d=l=qt(7-a+t.wkst,7);d>=4?(d=0,c=o.yearlen+qt(a-t.wkst,7)):c=r-d;for(var u=Math.floor(c/7),h=qt(c,7),p=Math.floor(u+h/4),f=0;f<t.byweekno.length;f++){var m=t.byweekno[f];if(m<0&&(m+=p+1),m>0&&m<=p){var g=void 0;m>1?(g=d+(m-1)*7,d!==l&&(g-=7-l)):g=d;for(var y=0;y<7&&(o.wnomask[g]=1,g++,o.wdaymask[g]!==t.wkst);y++);}}if(Ce(t.byweekno,1)){var g=d+p*7;if(d!==l&&(g-=7-l),g<r)for(var f=0;f<7&&(o.wnomask[g]=1,g+=1,o.wdaymask[g]!==t.wkst);f++);}if(d){var w=void 0;if(Ce(t.byweekno,-1))w=-1;else{var T=es(_i(s-1,1,1)),S=qt(7-T.valueOf()+t.wkst,7),x=Ha(s-1)?366:365,I=void 0;S>=4?(S=0,I=x+qt(T-t.wkst,7)):I=r-d,w=Math.floor(52+qt(I,7)/4)}if(Ce(t.byweekno,w))for(var g=0;g<d;g++)o.wnomask[g]=1}return o}function PI(s){var t=Ha(s)?366:365,e=_i(s,1,1),r=es(e);return t===365?{mmask:oE,mdaymask:dE,nmdaymask:hE,wdaymask:Cf.slice(r),mrange:fE}:{mmask:lE,mdaymask:cE,nmdaymask:uE,wdaymask:Cf.slice(r),mrange:pE}}var yE=v(()=>{is();Gt();or();mE()});function vE(s,t,e,r,i,n){var a={lastyear:s,lastmonth:t,nwdaymask:[]},o=[];if(n.freq===q.YEARLY)if(Ir(n.bymonth))o=[[0,e]];else for(var l=0;l<n.bymonth.length;l++)t=n.bymonth[l],o.push(r.slice(t-1,t+1));else n.freq===q.MONTHLY&&(o=[r.slice(t-1,t+1)]);if(Ir(o))return a;a.nwdaymask=Ee(0,e);for(var l=0;l<o.length;l++)for(var c=o[l],d=c[0],u=c[1]-1,h=0;h<n.bynweekday.length;h++){var p=void 0,f=n.bynweekday[h],m=f[0],g=f[1];g<0?(p=u+(g+1)*7,p-=qt(i[p]-m,7)):(p=d+(g-1)*7,p+=qt(7-i[p]+m,7)),d<=p&&p<=u&&(a.nwdaymask[p]=1)}return a}var wE=v(()=>{zr();or()});function TE(s,t){t===void 0&&(t=0);var e=s%19,r=Math.floor(s/100),i=s%100,n=Math.floor(r/4),a=r%4,o=Math.floor((r+8)/25),l=Math.floor((r-o+1)/3),c=Math.floor(19*e+r-n-l+15)%30,d=Math.floor(i/4),u=i%4,h=Math.floor(32+2*a+2*d-c-u)%7,p=Math.floor((e+11*c+22*h)/451),f=Math.floor((c+h-7*p+114)/31),m=(c+h-7*p+114)%31+1,g=Date.UTC(s,f-1,m+t),y=Date.UTC(s,0,1);return[Math.ceil((g-y)/(1e3*60*60*24))]}var bE=v(()=>{});var NI,kE,SE=v(()=>{or();ss();yE();wE();bE();zd();Gt();NI=(function(){function s(t){this.options=t}return s.prototype.rebuild=function(t,e){var r=this.options;if(t!==this.lastyear&&(this.yearinfo=gE(t,r)),ut(r.bynweekday)&&(e!==this.lastmonth||t!==this.lastyear)){var i=this.yearinfo,n=i.yearlen,a=i.mrange,o=i.wdaymask;this.monthinfo=vE(t,e,n,a,o,r)}Ge(r.byeaster)&&(this.eastermask=TE(t,r.byeaster))},Object.defineProperty(s.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),s.prototype.ydayset=function(){return[jr(this.yearlen),0,this.yearlen]},s.prototype.mdayset=function(t,e){for(var r=this.mrange[e-1],i=this.mrange[e],n=Ee(null,this.yearlen),a=r;a<i;a++)n[a]=a;return[n,r,i]},s.prototype.wdayset=function(t,e,r){for(var i=Ee(null,this.yearlen+7),n=cl(_i(t,e,r))-this.yearordinal,a=n,o=0;o<7&&(i[n]=n,++n,this.wdaymask[n]!==this.options.wkst);o++);return[i,a,n]},s.prototype.ddayset=function(t,e,r){var i=Ee(null,this.yearlen),n=cl(_i(t,e,r))-this.yearordinal;return i[n]=n,[i,n,n+1]},s.prototype.htimeset=function(t,e,r,i){var n=this,a=[];return this.options.byminute.forEach(function(o){a=a.concat(n.mtimeset(t,o,r,i))}),ts(a),a},s.prototype.mtimeset=function(t,e,r,i){var n=this.options.bysecond.map(function(a){return new Va(t,e,a,i)});return ts(n),n},s.prototype.stimeset=function(t,e,r,i){return[new Va(t,e,r,i)]},s.prototype.getdayset=function(t){switch(t){case ve.YEARLY:return this.ydayset.bind(this);case ve.MONTHLY:return this.mdayset.bind(this);case ve.WEEKLY:return this.wdayset.bind(this);case ve.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},s.prototype.gettimeset=function(t){switch(t){case ve.HOURLY:return this.htimeset.bind(this);case ve.MINUTELY:return this.mtimeset.bind(this);case ve.SECONDLY:return this.stimeset.bind(this)}},s})(),kE=NI});function EE(s,t,e,r,i,n){for(var a=[],o=0;o<s.length;o++){var l=void 0,c=void 0,d=s[o];d<0?(l=Math.floor(d/t.length),c=qt(d,t.length)):(l=Math.floor((d-1)/t.length),c=qt(d-1,t.length));for(var u=[],h=e;h<r;h++){var p=n[h];Ge(p)&&u.push(p)}var f=void 0;l<0?f=u.slice(l)[0]:f=u[l];var m=t[c],g=$d(i.yearordinal+f),y=Vd(g,m);Ce(a,y)||a.push(y)}return ts(a),a}var DE=v(()=>{Gt();or()});function Gd(s,t){var e=t.dtstart,r=t.freq,i=t.interval,n=t.until,a=t.bysetpos,o=t.count;if(o===0||i===0)return ns(s);var l=XS.fromDate(e),c=new kE(t);c.rebuild(l.year,l.month);for(var d=FI(c,l,t);;){var u=c.getdayset(r)(l.year,l.month,l.day),h=u[0],p=u[1],f=u[2],m=OI(h,p,f,c,t);if(ut(a))for(var g=EE(a,d,p,f,c,h),y=0;y<g.length;y++){var w=g[y];if(n&&w>n)return ns(s);if(w>=e){var T=CE(w,t);if(!s.accept(T)||o&&(--o,!o))return ns(s)}}else for(var y=p;y<f;y++){var S=h[y];if(Ge(S))for(var x=$d(c.yearordinal+S),I=0;I<d.length;I++){var F=d[I],w=Vd(x,F);if(n&&w>n)return ns(s);if(w>=e){var T=CE(w,t);if(!s.accept(T)||o&&(--o,!o))return ns(s)}}}if(t.interval===0||(l.add(t,m),l.year>Ud))return ns(s);hl(r)||(d=c.gettimeset(r)(l.hour,l.minute,l.second,0)),c.rebuild(l.year,l.month)}}function RI(s,t,e){var r=e.bymonth,i=e.byweekno,n=e.byweekday,a=e.byeaster,o=e.bymonthday,l=e.bynmonthday,c=e.byyearday;return ut(r)&&!Ce(r,s.mmask[t])||ut(i)&&!s.wnomask[t]||ut(n)&&!Ce(n,s.wdaymask[t])||ut(s.nwdaymask)&&!s.nwdaymask[t]||a!==null&&!Ce(s.eastermask,t)||(ut(o)||ut(l))&&!Ce(o,s.mdaymask[t])&&!Ce(l,s.nmdaymask[t])||ut(c)&&(t<s.yearlen&&!Ce(c,t+1)&&!Ce(c,-s.yearlen+t)||t>=s.yearlen&&!Ce(c,t+1-s.yearlen)&&!Ce(c,-s.nextyearlen+t-s.yearlen))}function CE(s,t){return new Ln(s,t.tzid).rezonedDate()}function ns(s){return s.getValue()}function OI(s,t,e,r,i){for(var n=!1,a=t;a<e;a++){var o=s[a];n=RI(r,o,i),n&&(s[o]=null)}return n}function FI(s,t,e){var r=e.freq,i=e.byhour,n=e.byminute,a=e.bysecond;return hl(r)?tE(e):r>=q.HOURLY&&ut(i)&&!Ce(i,t.hour)||r>=q.MINUTELY&&ut(n)&&!Ce(n,t.minute)||r>=q.SECONDLY&&ut(a)&&!Ce(a,t.second)?[]:s.gettimeset(r)(t.hour,t.minute,t.second,t.millisecond)}var xf=v(()=>{ss();Gt();SE();zr();Sf();or();qd();DE();zd()});var qr,pl,rE,q,zr=v(()=>{Gt();Yd();jS();JS();ss();Sf();Ef();Df();aE();Nn();xf();qr={MO:new mt(0),TU:new mt(1),WE:new mt(2),TH:new mt(3),FR:new mt(4),SA:new mt(5),SU:new mt(6)},pl={freq:ve.YEARLY,dtstart:null,interval:1,wkst:qr.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},rE=Object.keys(pl),q=(function(){function s(t,e){t===void 0&&(t={}),e===void 0&&(e=!1),this._cache=e?null:new nE,this.origOptions=kf(t);var r=eE(t).parsedOptions;this.options=r}return s.parseText=function(t,e){return ul(t,e)},s.fromText=function(t,e){return QS(t,e)},s.fromString=function(t){return new s(s.parseString(t)||void 0)},s.prototype._iter=function(t){return Gd(t,this.options)},s.prototype._cacheGet=function(t,e){return this._cache?this._cache._cacheGet(t,e):!1},s.prototype._cacheAdd=function(t,e,r){if(this._cache)return this._cache._cacheAdd(t,e,r)},s.prototype.all=function(t){if(t)return this._iter(new bf("all",{},t));var e=this._cacheGet("all");return e===!1&&(e=this._iter(new rs("all",{})),this._cacheAdd("all",e)),e},s.prototype.between=function(t,e,r,i){if(r===void 0&&(r=!1),!On(t)||!On(e))throw new Error("Invalid date passed in to RRule.between");var n={before:e,after:t,inc:r};if(i)return this._iter(new bf("between",n,i));var a=this._cacheGet("between",n);return a===!1&&(a=this._iter(new rs("between",n)),this._cacheAdd("between",a,n)),a},s.prototype.before=function(t,e){if(e===void 0&&(e=!1),!On(t))throw new Error("Invalid date passed in to RRule.before");var r={dt:t,inc:e},i=this._cacheGet("before",r);return i===!1&&(i=this._iter(new rs("before",r)),this._cacheAdd("before",i,r)),i},s.prototype.after=function(t,e){if(e===void 0&&(e=!1),!On(t))throw new Error("Invalid date passed in to RRule.after");var r={dt:t,inc:e},i=this._cacheGet("after",r);return i===!1&&(i=this._iter(new rs("after",r)),this._cacheAdd("after",i,r)),i},s.prototype.count=function(){return this.all().length},s.prototype.toString=function(){return gl(this.origOptions)},s.prototype.toText=function(t,e,r){return KS(this,t,e,r)},s.prototype.isFullyConvertibleToText=function(){return ZS(this)},s.prototype.clone=function(){return new s(this.origOptions)},s.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],s.YEARLY=ve.YEARLY,s.MONTHLY=ve.MONTHLY,s.WEEKLY=ve.WEEKLY,s.DAILY=ve.DAILY,s.HOURLY=ve.HOURLY,s.MINUTELY=ve.MINUTELY,s.SECONDLY=ve.SECONDLY,s.MO=qr.MO,s.TU=qr.TU,s.WE=qr.WE,s.TH=qr.TH,s.FR=qr.FR,s.SA=qr.SA,s.SU=qr.SU,s.parseString=ml,s.optionsToString=gl,s})()});function xE(s,t,e,r,i,n){var a={},o=s.accept;function l(h,p){e.forEach(function(f){f.between(h,p,!0).forEach(function(m){a[Number(m)]=!0})})}i.forEach(function(h){var p=new Ln(h,n).rezonedDate();a[Number(p)]=!0}),s.accept=function(h){var p=Number(h);return isNaN(p)?o.call(this,h):!a[p]&&(l(new Date(p-1),new Date(p+1)),!a[p])?(a[p]=!0,o.call(this,h)):!0},s.method==="between"&&(l(s.args.after,s.args.before),s.accept=function(h){var p=Number(h);return a[p]?!0:(a[p]=!0,o.call(this,h))});for(var c=0;c<r.length;c++){var d=new Ln(r[c],n).rezonedDate();if(!s.accept(new Date(d.getTime())))break}t.forEach(function(h){Gd(s,h.options)});var u=s._result;switch(ts(u),s.method){case"all":case"between":return u;case"before":return u.length&&u[u.length-1]||null;case"after":default:return u.length&&u[0]||null}}var ME=v(()=>{qd();xf();Gt()});function LI(s,t){var e=[],r=[],i=[],n=[],a=fl(s),o=a.dtstart,l=a.tzid,c=VI(s,t.unfold);return c.forEach(function(d){var u;if(d){var h=$I(d),p=h.name,f=h.parms,m=h.value;switch(p.toUpperCase()){case"RRULE":if(f.length)throw new Error("unsupported RRULE parm: ".concat(f.join(",")));e.push(ml(d));break;case"RDATE":var g=(u=/RDATE(?:;TZID=([^:=]+))?/i.exec(d))!==null&&u!==void 0?u:[],y=g[1];y&&!l&&(l=y),r=r.concat(AE(m,f));break;case"EXRULE":if(f.length)throw new Error("unsupported EXRULE parm: ".concat(f.join(",")));i.push(ml(m));break;case"EXDATE":n=n.concat(AE(m,f));break;case"DTSTART":break;default:throw new Error("unsupported property: "+p)}}}),{dtstart:o,tzid:l,rrulevals:e,rdatevals:r,exrulevals:i,exdatevals:n}}function HI(s,t){var e=LI(s,t),r=e.rrulevals,i=e.rdatevals,n=e.exrulevals,a=e.exdatevals,o=e.dtstart,l=e.tzid,c=t.cache===!1;if(t.compatible&&(t.forceset=!0,t.unfold=!0),t.forceset||r.length>1||i.length||n.length||a.length){var d=new Af(c);return d.dtstart(o),d.tzid(l||void 0),r.forEach(function(h){d.rrule(new q(Mf(h,o,l),c))}),i.forEach(function(h){d.rdate(h)}),n.forEach(function(h){d.exrule(new q(Mf(h,o,l),c))}),a.forEach(function(h){d.exdate(h)}),t.compatible&&t.dtstart&&d.rdate(o),d}var u=r[0]||{};return new q(Mf(u,u.dtstart||t.dtstart||o,u.tzid||t.tzid||l),c)}function Qd(s,t){return t===void 0&&(t={}),HI(s,BI(t))}function Mf(s,t,e){return Ht(Ht({},s),{dtstart:t,tzid:e})}function BI(s){var t=[],e=Object.keys(s),r=Object.keys(_E);if(e.forEach(function(i){Ce(r,i)||t.push(i)}),t.length)throw new Error("Invalid options: "+t.join(", "));return Ht(Ht({},_E),s)}function UI(s){if(s.indexOf(":")===-1)return{name:"RRULE",value:s};var t=US(s,":",1),e=t[0],r=t[1];return{name:e,value:r}}function $I(s){var t=UI(s),e=t.name,r=t.value,i=e.split(";");if(!i)throw new Error("empty property name");return{name:i[0].toUpperCase(),parms:i.slice(1),value:r}}function VI(s,t){if(t===void 0&&(t=!1),s=s&&s.trim(),!s)throw new Error("Invalid empty string");if(!t)return s.split(/\s/);for(var e=s.split(`
`),r=0;r<e.length;){var i=e[r]=e[r].replace(/\s+$/g,"");i?r>0&&i[0]===" "?(e[r-1]+=i.slice(1),e.splice(r,1)):r+=1:e.splice(r,1)}return e}function WI(s){s.forEach(function(t){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(t))throw new Error("unsupported RDATE/EXDATE parm: "+t)})}function AE(s,t){return WI(t),s.split(",").map(function(e){return dl(e)})}var _E,_f=v(()=>{is();zr();If();Gt();or();Ef();_E={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null}});function IE(s){var t=this;return function(e){if(e!==void 0&&(t["_".concat(s)]=e),t["_".concat(s)]!==void 0)return t["_".concat(s)];for(var r=0;r<t._rrule.length;r++){var i=t._rrule[r].origOptions[s];if(i)return i}}}function PE(s,t){if(!(s instanceof q))throw new TypeError(String(s)+" is not RRule instance");Ce(t.map(String),String(s))||t.push(s)}function NE(s,t){if(!(s instanceof Date))throw new TypeError(String(s)+" is not Date instance");Ce(t.map(Number),Number(s))||(t.push(s),ts(t))}function RE(s,t,e){var r=!e||e.toUpperCase()==="UTC",i=r?"".concat(s,":"):"".concat(s,";TZID=").concat(e,":"),n=t.map(function(a){return Ba(a.valueOf(),r)}).join(",");return"".concat(i).concat(n)}var Af,If=v(()=>{is();zr();Gt();or();ME();_f();Df();Af=(function(s){Ua(t,s);function t(e){e===void 0&&(e=!1);var r=s.call(this,{},e)||this;return r.dtstart=IE.apply(r,["dtstart"]),r.tzid=IE.apply(r,["tzid"]),r._rrule=[],r._rdate=[],r._exrule=[],r._exdate=[],r}return t.prototype._iter=function(e){return xE(e,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},t.prototype.rrule=function(e){PE(e,this._rrule)},t.prototype.exrule=function(e){PE(e,this._exrule)},t.prototype.rdate=function(e){NE(e,this._rdate)},t.prototype.exdate=function(e){NE(e,this._exdate)},t.prototype.rrules=function(){return this._rrule.map(function(e){return Qd(e.toString())})},t.prototype.exrules=function(){return this._exrule.map(function(e){return Qd(e.toString())})},t.prototype.rdates=function(){return this._rdate.map(function(e){return new Date(e.getTime())})},t.prototype.exdates=function(){return this._exdate.map(function(e){return new Date(e.getTime())})},t.prototype.valueOf=function(){var e=[];return!this._rrule.length&&this._dtstart&&(e=e.concat(gl({dtstart:this._dtstart}))),this._rrule.forEach(function(r){e=e.concat(r.toString().split(`
`))}),this._exrule.forEach(function(r){e=e.concat(r.toString().split(`
`).map(function(i){return i.replace(/^RRULE:/,"EXRULE:")}).filter(function(i){return!/^DTSTART/.test(i)}))}),this._rdate.length&&e.push(RE("RDATE",this._rdate,this.tzid())),this._exdate.length&&e.push(RE("EXDATE",this._exdate,this.tzid())),e},t.prototype.toString=function(){return this.valueOf().join(`
`)},t.prototype.clone=function(){var e=new t(!!this._cache);return this._rrule.forEach(function(r){return e.rrule(r.clone())}),this._exrule.forEach(function(r){return e.exrule(r.clone())}),this._rdate.forEach(function(r){return e.rdate(new Date(r.getTime()))}),this._exdate.forEach(function(r){return e.exdate(new Date(r.getTime()))}),e},t})(q)});var Pf=v(()=>{zr();If();_f();ss();Nn();Gt()});var Wa,Nf=v(()=>{Se();Wa=class{constructor(t){this.mapping=t}toUserField(t){return this.mapping[t]}normalizeTitle(t){if(typeof t=="string")return t;if(Array.isArray(t))return t.map(e=>String(e)).join(", ");if(t!=null)return typeof t=="object"?"":String(t)}mapFromFrontmatter(t,e,r){var n;if(!t)return{};let i={path:e};if(t[this.mapping.title]!==void 0){let a=t[this.mapping.title],o=this.normalizeTitle(a);o!==void 0&&(i.title=o)}else if(r){let a=(n=e.split("/").pop())==null?void 0:n.replace(".md","");a&&(i.title=a)}if(t[this.mapping.status]!==void 0){let a=t[this.mapping.status];typeof a=="boolean"?i.status=a?"true":"false":i.status=a}if(t[this.mapping.priority]!==void 0&&(i.priority=t[this.mapping.priority]),t[this.mapping.due]!==void 0&&(i.due=t[this.mapping.due]),t[this.mapping.scheduled]!==void 0&&(i.scheduled=t[this.mapping.scheduled]),t[this.mapping.contexts]!==void 0){let a=t[this.mapping.contexts];i.contexts=Array.isArray(a)?a:[a]}if(t[this.mapping.projects]!==void 0){let a=t[this.mapping.projects];i.projects=Array.isArray(a)?a:[a]}if(t[this.mapping.timeEstimate]!==void 0&&(i.timeEstimate=t[this.mapping.timeEstimate]),t[this.mapping.completedDate]!==void 0&&(i.completedDate=t[this.mapping.completedDate]),t[this.mapping.recurrence]!==void 0&&(i.recurrence=t[this.mapping.recurrence]),t[this.mapping.dateCreated]!==void 0&&(i.dateCreated=t[this.mapping.dateCreated]),t[this.mapping.dateModified]!==void 0&&(i.dateModified=t[this.mapping.dateModified]),t[this.mapping.timeEntries]!==void 0){let a=t[this.mapping.timeEntries];i.timeEntries=Array.isArray(a)?a:[]}if(t[this.mapping.completeInstances]!==void 0&&(i.complete_instances=RS(t[this.mapping.completeInstances])),t[this.mapping.icsEventId]!==void 0){let a=t[this.mapping.icsEventId];i.icsEventId=Array.isArray(a)?a:[a]}if(t[this.mapping.reminders]!==void 0){let a=t[this.mapping.reminders];i.reminders=Array.isArray(a)?a:[a]}return t.tags&&Array.isArray(t.tags)&&(i.tags=t.tags,i.archived=t.tags.includes(this.mapping.archiveTag)),t.timeEntries!==void 0&&(i.timeEntries=Array.isArray(t.timeEntries)?t.timeEntries:[]),i}mapToFrontmatter(t,e,r){let i={};if(t.title!==void 0&&(i[this.mapping.title]=t.title),r&&delete i[this.mapping.title],t.status!==void 0){let a=t.status.toLowerCase(),o=a==="true"||a==="false"?a==="true":t.status;i[this.mapping.status]=o}t.priority!==void 0&&(i[this.mapping.priority]=t.priority),t.due!==void 0&&(i[this.mapping.due]=t.due),t.scheduled!==void 0&&(i[this.mapping.scheduled]=t.scheduled),t.contexts!==void 0&&(i[this.mapping.contexts]=t.contexts),t.projects!==void 0&&(i[this.mapping.projects]=t.projects),t.timeEstimate!==void 0&&(i[this.mapping.timeEstimate]=t.timeEstimate),t.completedDate!==void 0&&(i[this.mapping.completedDate]=t.completedDate),t.recurrence!==void 0&&(i[this.mapping.recurrence]=t.recurrence),t.dateCreated!==void 0&&(i[this.mapping.dateCreated]=t.dateCreated),t.dateModified!==void 0&&(i[this.mapping.dateModified]=t.dateModified),t.timeEntries!==void 0&&(i[this.mapping.timeEntries]=t.timeEntries),t.complete_instances!==void 0&&(i[this.mapping.completeInstances]=t.complete_instances),t.icsEventId!==void 0&&t.icsEventId.length>0&&(i[this.mapping.icsEventId]=t.icsEventId),t.reminders!==void 0&&t.reminders.length>0&&(i[this.mapping.reminders]=t.reminders);let n=t.tags?[...t.tags]:[];return e&&!n.includes(e)&&n.push(e),t.archived===!0&&!n.includes(this.mapping.archiveTag)?n.push(this.mapping.archiveTag):t.archived===!1&&(n=n.filter(a=>a!==this.mapping.archiveTag)),n.length>0&&(i.tags=n),t.timeEntries!==void 0&&(i.timeEntries=t.timeEntries),i}updateMapping(t){this.mapping=t}getMapping(){return{...this.mapping}}static validateMapping(t){let e=[],r=Object.keys(t);for(let a of r)(!t[a]||t[a].trim()==="")&&e.push(`Field "${a}" cannot be empty`);let i=Object.values(t),n=new Set(i);return i.length!==n.size&&e.push("Field mappings must have unique property names"),{valid:e.length===0,errors:e}}}});function Kd(s){if(!s.startsWith("---"))return{};let t=s.indexOf("---",3);if(t===-1)return{};let e=s.substring(3,t);try{return(0,Hn.parseYaml)(e)||{}}catch(r){return console.error("Error parsing frontmatter:",r),{}}}async function Ya(s,t){try{let r=(0,Hn.normalizePath)(t).split("/").filter(n=>n.length>0),i="";for(let n of r)i=i?`${i}/${n}`:n,s.getAbstractFileByPath(i)||await s.createFolder(i)}catch(e){let r=e instanceof Error?e.message:String(e),i=e instanceof Error?e.stack:void 0;console.error("Error creating folder structure:",{error:r,stack:i,folderPath:t,normalizedPath:(0,Hn.normalizePath)(t)});let n=new Error(`Failed to create folder "${t}": ${r}`);throw i&&(n.stack=i),n}}function YI(s,t){try{let e=new Date(s),r=new Date(t);if(isNaN(e.getTime())||isNaN(r.getTime()))return console.error("Invalid timestamps for duration calculation:",{startTime:s,endTime:t}),0;if(r<=e)return console.error("End time is not after start time:",{startTime:s,endTime:t}),0;let i=r.getTime()-e.getTime(),n=Math.round(i/(1e3*60));return Math.max(0,n)}catch(e){return console.error("Error calculating duration:",e,{startTime:s,endTime:t}),0}}function pr(s){return!s||!Array.isArray(s)?0:s.reduce((t,e)=>{if(!e.startTime||!e.endTime)return t;let r=YI(e.startTime,e.endTime);return t+r},0)}function OE(s){return!s||!Array.isArray(s)?null:s.find(t=>t.startTime&&!t.endTime)||null}function Zd(s){if(!s||s===0||isNaN(s))return"0m";let t=Math.floor(s/60),e=s%60;return t===0?`${e}m`:e===0?`${t}h`:`${t}h ${e}m`}function Gr(s){if(s==="none")return"";let t=new Date,e;switch(s){case"today":e=t;break;case"tomorrow":e=new Date(t),e.setDate(t.getDate()+1);break;case"next-week":e=new Date(t),e.setDate(t.getDate()+7);break;default:return""}return C(e,"yyyy-MM-dd")}function yl(s,t){return s.getUTCFullYear()===t.getUTCFullYear()&&s.getUTCMonth()===t.getUTCMonth()&&s.getUTCDate()===t.getUTCDate()}function FE(s,t,e,r,i,n){var c;let a=s.metadataCache.getFileCache(r),o=a==null?void 0:a.frontmatter;if(o)if(i){let d=i.mapFromFrontmatter(o,e,n);return{title:d.title||"Untitled task",status:d.status||"open",priority:d.priority||"normal",due:d.due,scheduled:d.scheduled,path:e,archived:d.archived||!1,tags:d.tags||[],contexts:d.contexts||[],projects:d.projects||[],recurrence:d.recurrence,complete_instances:d.complete_instances,completedDate:d.completedDate,timeEstimate:d.timeEstimate,timeEntries:d.timeEntries,dateCreated:d.dateCreated,dateModified:d.dateModified,reminders:d.reminders}}else{let u=new Wa(el).mapFromFrontmatter(o,e,n);return{title:u.title||"Untitled task",status:u.status||"open",priority:u.priority||"normal",due:u.due,scheduled:u.scheduled,path:e,archived:u.archived||!1,tags:u.tags||[],contexts:u.contexts||[],projects:u.projects||[],recurrence:u.recurrence,complete_instances:u.complete_instances,completedDate:u.completedDate,timeEstimate:u.timeEstimate,timeEntries:u.timeEntries,dateCreated:u.dateCreated,dateModified:u.dateModified,reminders:u.reminders}}return{title:((c=e.split("/").pop())==null?void 0:c.replace(".md",""))||"Untitled",status:"open",priority:"normal",path:e,archived:!1,reminders:[]}}function vl(s,t){if(!s.recurrence)return!0;if(typeof s.recurrence=="string")try{let l,c=s.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(c){let m=c[1];if(m.length===8){let g=parseInt(m.slice(0,4)),y=parseInt(m.slice(4,6))-1,w=parseInt(m.slice(6,8));l=new Date(Date.UTC(g,y,w,0,0,0,0))}else{let g=parseInt(m.slice(0,4)),y=parseInt(m.slice(4,6))-1,w=parseInt(m.slice(6,8)),T=parseInt(m.slice(9,11))||0,S=parseInt(m.slice(11,13))||0,x=parseInt(m.slice(13,15))||0;l=new Date(Date.UTC(g,y,w,T,S,x,0))}}else if(s.scheduled)l=Mr(s.scheduled);else if(s.dateCreated)l=Mr(s.dateCreated);else return!1;let d=s.recurrence.replace(/DTSTART:[^;]+;?/,""),u=q.parseString(d);u.dtstart=l;let h=new q(u),p=Mr(FS(t));return h.between(p,new Date(p.getTime()+1440*60*1e3-1),!0).length>0}catch(l){return console.error("Error evaluating rrule:",l,{task:s.title,recurrence:s.recurrence}),!0}let e=s.recurrence.frequency,r=Ae(ae(t)),i=r.getUTCDay(),n=r.getUTCDate(),a=r.getUTCMonth()+1,o=["sun","mon","tue","wed","thu","fri","sat"];switch(e){case"daily":return!0;case"weekly":return(s.recurrence.days_of_week||[]).includes(o[i]);case"monthly":return n===s.recurrence.day_of_month;case"yearly":{if(s.recurrence.month_of_year&&s.recurrence.day_of_month)return n===s.recurrence.day_of_month&&a===s.recurrence.month_of_year;if(s.due)try{let l=Ae(s.due);return l.getUTCDate()===n&&l.getUTCMonth()===r.getUTCMonth()}catch(l){return console.error(`Error parsing due date ${s.due}:`,l),!1}return!1}default:return!1}}function Ii(s,t){if(!s.recurrence)return s.status||"open";let e=ae(t);return(Array.isArray(s.complete_instances)?s.complete_instances:[]).includes(e)?"done":"open"}function wl(s,t,e){if(!s.recurrence)return[];if(typeof s.recurrence=="string")try{let n,a=s.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(a){let h=a[1];if(h.length===8){let p=parseInt(h.slice(0,4)),f=parseInt(h.slice(4,6))-1,m=parseInt(h.slice(6,8));n=new Date(Date.UTC(p,f,m,0,0,0,0))}else{let p=parseInt(h.slice(0,4)),f=parseInt(h.slice(4,6))-1,m=parseInt(h.slice(6,8)),g=parseInt(h.slice(9,11))||0,y=parseInt(h.slice(11,13))||0,w=parseInt(h.slice(13,15))||0;n=new Date(Date.UTC(p,f,m,g,y,w,0))}}else if(s.scheduled)n=Mr(s.scheduled);else if(s.dateCreated)n=Mr(s.dateCreated);else return[];let o=s.recurrence.replace(/DTSTART:[^;]+;?/,""),l=q.parseString(o);l.dtstart=n;let c=new q(l),d=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0)),u=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999));return c.between(d,u,!0)}catch(n){console.error("Error generating recurring instances:",n,{task:s.title,recurrence:s.recurrence})}let r=[],i=new Date(t);for(;i<=e;)vl(s,i)&&r.push(new Date(i)),i.setUTCDate(i.getUTCDate()+1);return r}function jI(s){if(!s.recurrence)return null;try{let t=St(),e=Ae(t),r=new Date(e.getTime()+365*24*60*60*1e3),i=wl(s,e,r),n=new Set(s.complete_instances||[]);for(let a of i){let o=ae(a);if(!n.has(o))return a}return null}catch(t){return console.error("Error calculating next uncompleted occurrence:",t,{task:s.title}),null}}function Tl(s,t=!0){let e=jI(s),r=null,i=null,n=null;if(e){if(t)try{let a=s.scheduled?Ae(s.scheduled):null,o=s.due?Ae(s.due):null;if(a&&o){let l=o.getTime()-a.getTime();e&&(n=new Date(e.getTime()+l))}}catch(a){console.error("Error calculating next due date with offset:",a)}if(s.scheduled&&s.scheduled.includes("T")){let a=s.scheduled.split("T")[1];r=`${ae(e)}T${a}`}else r=ae(e);if(n&&s.due&&s.due.includes("T")){let a=s.due.split("T")[1];i=`${ae(n)}T${a}`}else n&&(i=ae(n))}return{scheduled:r,due:i}}function Rf(s){if(!s||!s.frequency)throw new Error("Invalid recurrence object");try{let t={};switch(s.frequency){case"daily":t.freq=q.DAILY;break;case"weekly":if(t.freq=q.WEEKLY,s.days_of_week&&Array.isArray(s.days_of_week)){let r={sun:q.SU,mon:q.MO,tue:q.TU,wed:q.WE,thu:q.TH,fri:q.FR,sat:q.SA};t.byweekday=s.days_of_week.map(i=>r[i.toLowerCase()]).filter(Boolean)}break;case"monthly":t.freq=q.MONTHLY,s.day_of_month&&(t.bymonthday=[s.day_of_month]);break;case"yearly":t.freq=q.YEARLY,s.month_of_year&&(t.bymonth=[s.month_of_year]),s.day_of_month&&(t.bymonthday=[s.day_of_month]);break;default:throw new Error(`Unsupported frequency: ${s.frequency}`)}return new q(t).toString()}catch(t){throw console.error("Error converting legacy recurrence to rrule:",t,{recurrence:s}),t}}function ja(s){if(!s)return"";try{if(typeof s=="string"&&s.includes("FREQ=")){let t=s.replace(/DTSTART:[^;]+;?/,"");return q.fromString(t).toText()}if(typeof s=="object"&&s.frequency){let t=Rf(s);return q.fromString(t).toText()}return"rrule"}catch(t){return console.error("Error converting recurrence to display text:",t,{recurrence:s}),"rrule"}}function zI(s){if(!s||typeof s!="object"||!s.id||typeof s.id!="string"||!s.title||typeof s.title!="string"||!s.startTime||typeof s.startTime!="string"||!s.endTime||typeof s.endTime!="string")return!1;let t=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;if(!t.test(s.startTime)||!t.test(s.endTime))return!1;let[e,r]=s.startTime.split(":").map(Number),[i,n]=s.endTime.split(":").map(Number),a=e*60+r;if(i*60+n<=a||s.attachments&&!Array.isArray(s.attachments))return!1;if(s.attachments){for(let l of s.attachments)if(typeof l!="string"||!l.trim())return!1}return!(s.color&&typeof s.color!="string"||s.description&&typeof s.description!="string")}function Of(s,t){try{let e=Kd(s);if(!e||!e.timeblocks||!Array.isArray(e.timeblocks))return[];let r=[];for(let i of e.timeblocks)zI(i)?r.push(i):console.warn(`Invalid timeblock in ${t}:`,i);return r}catch(e){return console.error(`Error extracting timeblocks from ${t}:`,e),[]}}function LE(s,t){let e=`${t}T${s.startTime}:00`,r=`${t}T${s.endTime}:00`;return{id:`timeblock-${s.id}`,title:s.title,start:e,end:r,allDay:!1,backgroundColor:s.color||"#6366f1",borderColor:s.color||"#4f46e5",editable:!0,eventType:"timeblock",extendedProps:{type:"timeblock",eventType:"timeblock",timeblock:s,originalDate:t,description:s.description,attachments:s.attachments||[]}}}function HE(){return`tb-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}async function Ff(s,t,e,r,i,n){let{getDailyNote:a,getAllDailyNotes:o,appHasDailyNotesPluginLoaded:l}=await Promise.resolve().then(()=>bt(Vr()));if(!l())throw new Error("Daily Notes plugin is not enabled");let c=o(),d=window.moment(e),u=a(d,c);if(!u)throw new Error(`Daily note for ${e} not found`);let h=await s.vault.read(u),p=Of(h,u.path),f=p.findIndex(y=>y.id===t);if(f===-1)throw new Error(`Timeblock ${t} not found`);let m=p[f];if(e===r){await qI(s,u,t,i,n);return}await GI(s,u,t);let g={...m,startTime:i,endTime:n};await QI(s,r,g)}async function qI(s,t,e,r,i){let n=await s.vault.read(t),a=Kd(n)||{};if(!a.timeblocks||!Array.isArray(a.timeblocks))throw new Error("No timeblocks found in frontmatter");let o=a.timeblocks.findIndex(l=>l.id===e);if(o===-1)throw new Error(`Timeblock ${e} not found`);a.timeblocks[o].startTime=r,a.timeblocks[o].endTime=i,await Lf(s,t,a,n)}async function GI(s,t,e){let r=await s.vault.read(t),i=Kd(r)||{};!i.timeblocks||!Array.isArray(i.timeblocks)||(i.timeblocks=i.timeblocks.filter(n=>n.id!==e),await Lf(s,t,i,r))}async function QI(s,t,e){let{createDailyNote:r,getDailyNote:i,getAllDailyNotes:n}=await Promise.resolve().then(()=>bt(Vr())),a=window.moment(t),o=n(),l=i(a,o);if(!l&&(l=await r(a),!l))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let c=await s.vault.read(l),d=Kd(c)||{};d.timeblocks||(d.timeblocks=[]),d.timeblocks.push(e),await Lf(s,l,d,c)}async function Lf(s,t,e,r){let i=r;if(r.startsWith("---")){let o=r.indexOf("---",3);o!==-1&&(i=r.substring(o+3))}let a=`---
${(0,Hn.stringifyYaml)(e)}---${i}`;await s.vault.modify(t,a)}function fr(s){return!s||!Array.isArray(s)?[]:s.filter(t=>{if(typeof t!="string")return!1;let e=t.trim();return!(e.length===0||e==='""'||e==="''")})}function bl(s){if(!s.recurrence||typeof s.recurrence!="string")return null;if(s.recurrence.includes("DTSTART:"))return s.recurrence;let t;if(s.scheduled)t=s.scheduled;else if(s.dateCreated)t=s.dateCreated;else return null;try{let e;if(ft(t)){let r=_t(t),i=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0"),o=String(r.getHours()).padStart(2,"0"),l=String(r.getMinutes()).padStart(2,"0"),c=String(r.getSeconds()).padStart(2,"0");e=`${i}${n}${a}T${o}${l}${c}Z`}else{let r=Ae(t),i=r.getUTCFullYear(),n=String(r.getUTCMonth()+1).padStart(2,"0"),a=String(r.getUTCDate()).padStart(2,"0");e=`${i}${n}${a}`}return`DTSTART:${e};${s.recurrence}`}catch(e){return console.error("Error parsing date for DTSTART:",e,{sourceDateString:t}),null}}function BE(s,t,e){if(!s.recurrence||typeof s.recurrence!="string")return null;if(s.recurrence.includes("DTSTART:"))return s.recurrence;let r;if(s.scheduled)r=s.scheduled;else if(s.dateCreated)r=s.dateCreated;else return null;try{let i;if(e){let n=Ae(r),a=n.getUTCFullYear(),o=String(n.getUTCMonth()+1).padStart(2,"0"),l=String(n.getUTCDate()).padStart(2,"0");i=`${a}${o}${l}`}else{let n=Ae(r),a=n.getUTCFullYear(),o=String(n.getUTCMonth()+1).padStart(2,"0"),l=String(n.getUTCDate()).padStart(2,"0"),c=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");i=`${a}${o}${l}T${c}${d}00Z`}return`DTSTART:${i};${s.recurrence}`}catch(i){return console.error("Error parsing date for DTSTART with dragged time:",i,{sourceDateString:r,draggedStart:t,allDay:e}),null}}function Us(s){return!s||typeof s!="string"?"":s.split(",").map(t=>{let e=t.trim();return e.startsWith("#")?e.slice(1):e}).filter(t=>t.length>0).join(", ")}var Hn,ht=v(()=>{Hn=require("obsidian");ot();Pf();Nf();Dd();Se()});var eu,gr,tu=v(()=>{eu=require("obsidian"),gr=class{static async execute(t,e={}){let{fallback:r,errorMessage:i="An error occurred",showNotice:n=!0,logError:a=!0}=e;try{return await t()}catch(o){if(a&&console.error(i,o),n){let l=o instanceof Error?o.message:String(o);new eu.Notice(`${i}: ${l}`)}return r}}static async executeWithRetry(t,e={}){let{maxRetries:r=3,retryDelay:i=1e3,errorMessage:n="Operation failed",showNotice:a=!0}=e,o;for(let l=0;l<=r;l++)try{return await t()}catch(c){if(o=c instanceof Error?c:new Error(String(c)),l<r){await new Promise(d=>setTimeout(d,i));continue}console.error(`${n} after ${r+1} attempts:`,o),a&&new eu.Notice(`${n}: ${o.message}`);return}}static async executeWithValidation(t,e,r={}){let{showNotice:i=!0}=r;for(let n of e)if(!n.condition){i&&new eu.Notice(n.message);return}return this.execute(t,r)}}});var os,Ga,Bf=v(()=>{os=require("obsidian");ot();tu();Ga=class extends os.Modal{constructor(e,r,i){super(e);this.title="";this.folder="";this.template="";this.useTemplate=!1;this.plugin=r,this.options=i,this.title=this.generateDefaultTitle(),this.folder=this.getDefaultFolder(),this.template=this.getDefaultTemplate()}onOpen(){this.containerEl.addClass("tasknotes-plugin","ics-note-creation-modal"),this.createModalContent()}onClose(){this.contentEl.empty()}createModalContent(){let{contentEl:e}=this;e.empty(),e.createDiv("modal-header").createEl("h2",{text:"Create from ICS Event"});let i=e.createDiv("ics-event-preview");this.createEventPreview(i),new os.Setting(e).setName("Title").setDesc("Title for the new content").addText(l=>{this.titleInput=l.inputEl,l.setValue(this.title).onChange(c=>{this.title=c,this.updatePreview()})}),new os.Setting(e).setName("Folder").setDesc("Destination folder (leave empty for vault root)").addText(l=>{this.folderInput=l.inputEl,l.setValue(this.folder).setPlaceholder("folder/subfolder").onChange(c=>{this.folder=c,this.updatePreview()})}),this.templateContainer=e.createDiv("template-settings"),this.createTemplateSettings(),this.previewContainer=e.createDiv("content-preview"),this.updatePreview();let n=e.createDiv("modal-button-container"),a=n.createEl("button",{text:"Create",cls:"mod-cta"});a.onclick=l=>{l.preventDefault(),l.stopPropagation(),console.log("Create button clicked"),this.handleCreate()};let o=n.createEl("button",{text:"Cancel"});o.onclick=l=>{l.preventDefault(),l.stopPropagation(),console.log("Cancel button clicked"),this.close()},setTimeout(()=>{var l;return(l=this.titleInput)==null?void 0:l.focus()},100)}createEventPreview(e){let{icsEvent:r,subscriptionName:i}=this.options;e.createEl("h3",{text:r.title});let n=e.createDiv("event-details");if(r.start){let o=new Date(r.start),l=n.createDiv();l.createEl("strong",{text:"Start: "}),l.appendText(C(o,"PPPp"))}if(r.end&&!r.allDay){let o=new Date(r.end),l=n.createDiv();l.createEl("strong",{text:"End: "}),l.appendText(C(o,"PPPp"))}if(r.location){let o=n.createDiv();o.createEl("strong",{text:"Location: "}),o.appendText(r.location)}let a=n.createDiv();a.createEl("strong",{text:"Calendar: "}),a.appendText(i)}createTemplateSettings(){this.templateContainer.empty(),new os.Setting(this.templateContainer).setName("Use Template").setDesc("Apply a template when creating the content").addToggle(e=>{e.setValue(this.useTemplate).onChange(r=>{this.useTemplate=r,this.updateTemplateInput(),this.updatePreview()})}),this.useTemplate&&new os.Setting(this.templateContainer).setName("Template Path").setDesc("Path to the template file").addText(e=>{this.templateInput=e.inputEl,e.setValue(this.template).setPlaceholder("templates/ics-note-template.md").onChange(r=>{this.template=r,this.updatePreview()})})}updateDefaultsForContentType(){var e,r;this.folder=((e=this.plugin.settings.icsIntegration)==null?void 0:e.defaultNoteFolder)||"",this.template=((r=this.plugin.settings.icsIntegration)==null?void 0:r.defaultNoteTemplate)||"",this.folderInput&&(this.folderInput.value=this.folder),this.templateInput&&(this.templateInput.value=this.template)}updateTemplateInput(){this.createTemplateSettings()}updatePreview(){if(!this.previewContainer)return;this.previewContainer.empty(),this.previewContainer.createEl("h4",{text:"Summary"});let e=this.previewContainer.createDiv("preview-details"),r=e.createDiv();r.createEl("strong",{text:"Type: "}),r.appendText("Note");let i=e.createDiv();i.createEl("strong",{text:"Title: "}),i.appendText(this.title||"Untitled");let n=e.createDiv();if(n.createEl("strong",{text:"Folder: "}),n.appendText(this.folder||"Vault root"),this.useTemplate&&this.template){let c=e.createDiv();c.createEl("strong",{text:"Template: "}),c.appendText(this.template)}else{let c=e.createDiv();c.createEl("strong",{text:"Template: "}),c.appendText("Default format")}let a=this.previewContainer.createDiv("template-variables");a.createEl("h5",{text:"Available Template Variables"});let o=["{{title}}","{{icsEventTitle}}","{{icsEventStart}}","{{icsEventEnd}}","{{icsEventLocation}}","{{icsEventDescription}}","{{icsEventUrl}}","{{icsEventSubscription}}","{{icsEventId}}","{{date}}","{{time}}"],l=a.createDiv("variables-list");o.forEach(c=>{l.createSpan({text:c,cls:"template-variable"})})}generateDefaultTitle(){let{icsEvent:e}=this.options,r=new Date(e.start);return`${e.title} - ${C(r,"PPP")}`}getDefaultFolder(){var e;return((e=this.plugin.settings.icsIntegration)==null?void 0:e.defaultNoteFolder)||""}getDefaultTemplate(){var e;return((e=this.plugin.settings.icsIntegration)==null?void 0:e.defaultNoteTemplate)||""}async handleCreate(){await gr.executeWithValidation(async()=>{var i,n;let{icsEvent:e}=this.options,r=await this.plugin.icsNoteService.createNoteFromICS(e,{title:this.title,folder:this.folder||void 0,template:this.useTemplate&&this.template?this.template:void 0});new os.Notice(`Note created: ${this.title}`),(n=(i=this.options).onContentCreated)==null||n.call(i,r.file,r.noteInfo),this.close()},[{condition:!!this.title.trim(),message:"Title is required"}],{errorMessage:"Failed to create note from ICS event"})}}});var ls,Qa,Uf=v(()=>{ls=require("obsidian"),Qa=class extends ls.FuzzySuggestModal{constructor(t,e,r){super(t),this.plugin=e,this.onChoose=r,this.setPlaceholder("Type to search for notes to link..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles().filter(t=>t instanceof ls.TFile&&t.extension==="md"&&!t.path.includes(".trash"))}getItemText(t){let e=`${t.name} ${t.path}`;if(t instanceof ls.TFile){let r=this.app.metadataCache.getFileCache(t);if(r!=null&&r.frontmatter){let i=(0,ls.parseFrontMatterAliases)(r.frontmatter);i&&i.length>0&&(e+=` ${i.join(" ")}`)}}return e}renderSuggestion(t,e){let r=t.item;e.empty();let i=e.createDiv({cls:"ics-note-link-suggestion"}),n=i.createSpan({cls:"note-link-name"});if(n.textContent=r.name,r instanceof ls.TFile){let a=this.app.metadataCache.getFileCache(r);if(a!=null&&a.frontmatter){let o=this.plugin.fieldMapper.toUserField("title"),l=a.frontmatter[o];if(l){let c=i.createDiv({cls:"note-link-title"});c.textContent=l}else{let c=(0,ls.parseFrontMatterAliases)(a.frontmatter);if(c&&c.length>0){let d=i.createDiv({cls:"note-link-aliases"});d.textContent=c.join(", ")}}}}if(r.path!==r.name){let a=i.createDiv({cls:"note-link-path"});a.textContent=r.path}}onChooseItem(t,e){this.onChoose(t)}}});var UE={};Ur(UE,{ICSEventInfoModal:()=>Bn});var Qe,Bn,ru=v(()=>{Qe=require("obsidian");Bf();Uf();tu();Bn=class extends Qe.Modal{constructor(e,r,i,n){super(e);this.relatedNotes=[];this.plugin=r,this.icsEvent=i,this.subscriptionName=n}async onOpen(){await this.renderContent()}async renderContent(){let{contentEl:e}=this;e.empty(),await this.loadRelatedNotes(),new Qe.Setting(e).setName("Calendar Event").setHeading(),new Qe.Setting(e).setName("Title").setDesc(this.icsEvent.title||"Untitled Event"),this.subscriptionName&&new Qe.Setting(e).setName("Calendar").setDesc(this.subscriptionName);let r=new Date(this.icsEvent.start),i=r.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(!this.icsEvent.allDay&&(i+=` at ${r.toLocaleTimeString()}`,this.icsEvent.end)){let n=new Date(this.icsEvent.end);i+=` - ${n.toLocaleTimeString()}`}new Qe.Setting(e).setName("Date & Time").setDesc(i),this.icsEvent.location&&new Qe.Setting(e).setName("Location").setDesc(this.icsEvent.location),this.icsEvent.description&&new Qe.Setting(e).setName("Description").setDesc(this.icsEvent.description),this.icsEvent.url&&new Qe.Setting(e).setName("URL").setDesc(this.icsEvent.url),new Qe.Setting(e).setName("Related Notes & Tasks").setHeading(),this.relatedNotes.length===0?new Qe.Setting(e).setDesc("No related notes or tasks found for this event."):this.relatedNotes.forEach(n=>{let a=this.isTaskNote(n);new Qe.Setting(e).setName(n.title).setDesc(`Type: ${a?"Task":"Note"}`).addButton(o=>{o.setButtonText("Open").onClick(async()=>{await this.safeOpenFile(n.path),this.close()})})}),new Qe.Setting(e).setName("Actions").setHeading(),new Qe.Setting(e).setName("Create from Event").setDesc("Create a new note or task from this calendar event").addButton(n=>{n.setButtonText("Create Note").onClick(()=>{console.log("Create Note clicked"),this.openCreationModal()})}).addButton(n=>{n.setButtonText("Create Task").onClick(async()=>{console.log("Create Task clicked"),await this.createTaskDirectly()})}),new Qe.Setting(e).setName("Link Existing").setDesc("Link an existing note to this calendar event").addButton(n=>{n.setButtonText("Link Note").onClick(()=>{console.log("Link Note clicked"),this.linkExistingNote()})}).addButton(n=>{n.setButtonText("Refresh").onClick(()=>{console.log("Refresh clicked"),this.refreshRelatedNotes()})})}async loadRelatedNotes(){let e=await gr.execute(()=>this.plugin.icsNoteService.findRelatedNotes(this.icsEvent),{fallback:[],errorMessage:"Failed to load related notes",showNotice:!1});this.relatedNotes=e||[]}openCreationModal(){console.log("Opening note creation modal");try{new Ga(this.app,this.plugin,{icsEvent:this.icsEvent,subscriptionName:this.subscriptionName||"Unknown Calendar",onContentCreated:async(r,i)=>{new Qe.Notice("Note created successfully"),this.refreshRelatedNotes(),await this.safeOpenFile(r.path)}}).open()}catch(e){console.error("Error opening creation modal:",e),new Qe.Notice("Failed to open creation modal")}}async linkExistingNote(){console.log("Link existing note button clicked"),await gr.execute(async()=>{new Qa(this.app,this.plugin,async r=>{await gr.execute(async()=>{await this.plugin.icsNoteService.linkNoteToICS(r.path,this.icsEvent),new Qe.Notice(`Linked note "${r.name}" to ICS event`),this.refreshRelatedNotes()},{errorMessage:"Failed to link note"})}).open()},{errorMessage:"Failed to open note selection"})}async createTaskDirectly(){await gr.execute(async()=>{let e=await this.plugin.icsNoteService.createTaskFromICS(this.icsEvent);new Qe.Notice(`Task created: ${e.taskInfo.title}`),await this.safeOpenFile(e.file.path),this.refreshRelatedNotes()},{errorMessage:"Failed to create task from ICS event"})}async refreshRelatedNotes(){await gr.execute(async()=>{await this.loadRelatedNotes(),await this.renderContent(),new Qe.Notice("Related notes refreshed")},{errorMessage:"Failed to refresh related notes"})}isTaskNote(e){var i;let r=this.plugin.settings.taskTag;return((i=e.tags)==null?void 0:i.includes(r))||!1}async safeOpenFile(e){try{let r=this.app.vault.getAbstractFileByPath(e);r instanceof Qe.TFile?await this.app.workspace.getLeaf().openFile(r):(new Qe.Notice("File not found or invalid"),console.error("Invalid file path or file not found:",e))}catch(r){console.error("Error opening file:",r),new Qe.Notice("Failed to open file")}}onClose(){let{contentEl:e}=this;e.empty()}}});var Je,cs,iu=v(()=>{Je=require("obsidian");Se();cs=class extends Je.Modal{constructor(e,r,i,n){super(e);this.selectedType="relative";this.relativeAnchor="due";this.relativeOffset=15;this.relativeUnit="minutes";this.relativeDirection="before";this.absoluteDate="";this.absoluteTime="";this.description="";this.plugin=r,this.task=i,this.reminders=i.reminders?[...i.reminders]:[],this.originalReminders=i.reminders?[...i.reminders]:[],this.onSave=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-plugin"),e.addClass("tasknotes-reminder-modal"),e.createDiv({cls:"reminder-modal__loading"}).createEl("div",{text:"Loading reminders..."}),this.initializeWithFreshData().catch(i=>{console.error("Failed to initialize reminder modal:",i),e.empty(),e.addClass("tasknotes-plugin"),e.addClass("tasknotes-reminder-modal"),e.createDiv({cls:"reminder-modal__error",text:"Failed to load task data. Please try again."})})}async initializeWithFreshData(){let{contentEl:e}=this;if(this.task.path&&this.task.path.trim()!==""){let a=await this.plugin.cacheManager.getTaskInfo(this.task.path);a?(this.task=a,this.reminders=a.reminders?[...a.reminders]:[],this.originalReminders=a.reminders?[...a.reminders]:[]):(this.reminders=this.task.reminders?[...this.task.reminders]:[],this.originalReminders=this.task.reminders?[...this.task.reminders]:[])}else this.reminders=this.task.reminders?[...this.task.reminders]:[],this.originalReminders=this.task.reminders?[...this.task.reminders]:[];e.empty(),e.addClass("tasknotes-plugin"),e.addClass("tasknotes-reminder-modal");let r=e.createDiv({cls:"reminder-modal__header"});r.createEl("h2",{text:"Task Reminders"}),r.createDiv({cls:"reminder-modal__task-title",text:this.task.title});let i=this.getTaskContextInfo();if(i){let a=r.createDiv({cls:"reminder-modal__task-dates"});a.textContent=i}let n=e.createDiv({cls:"reminder-modal__content"});this.renderExistingReminders(n),this.renderAddReminderForm(n),this.renderActionButtons(e),this.setupKeyboardHandlers(),this.updateSaveButtonState()}renderActionButtons(e){let r=e.createDiv({cls:"reminder-modal__actions"});this.saveBtn=r.createEl("button",{text:"Save Changes",cls:"mod-cta reminder-modal__save-btn"}),this.saveBtn.disabled=!0,this.saveBtn.onclick=async()=>{await this.save()};let i=r.createEl("button",{text:"Cancel",cls:"reminder-modal__cancel-btn"});i.onclick=()=>{this.cancel()}}getTaskContextInfo(){let e=[];return this.task.due&&e.push(`Due: ${_r(this.task.due)}`),this.task.scheduled&&e.push(`Scheduled: ${_r(this.task.scheduled)}`),e.length>0?e.join(" \u2022 "):null}setupKeyboardHandlers(){let e=async r=>{r.key==="Enter"&&(r.ctrlKey||r.metaKey)&&!this.saveBtn.disabled?(r.preventDefault(),await this.save()):r.key==="Escape"&&(r.preventDefault(),this.cancel())};this.contentEl.addEventListener("keydown",e),this.onClose=()=>{this.contentEl.removeEventListener("keydown",e);let{contentEl:r}=this;r.empty()}}updateSaveButtonState(){if(!this.saveBtn)return;let e=this.remindersHaveChanged();this.saveBtn.disabled=!e,this.saveBtn.textContent=e?"Save Changes":"No Changes"}renderExistingReminders(e){let r=e.createDiv({cls:"reminder-modal__section"}),i=r.createDiv({cls:"reminder-modal__section-header"});if(i.createEl("h3",{text:"Current Reminders"}),this.reminders.length>0&&i.createSpan({cls:"reminder-modal__reminder-count",text:`(${this.reminders.length})`}),this.reminders.length===0){let a=r.createDiv({cls:"reminder-modal__empty-state"});(0,Je.setIcon)(a.createDiv({cls:"reminder-modal__empty-icon"}),"bell-off"),a.createEl("div",{cls:"reminder-modal__empty-text",text:"No reminders set"});return}let n=r.createDiv({cls:"reminder-modal__reminder-list"});this.reminders.forEach((a,o)=>{let l=n.createDiv({cls:"reminder-modal__reminder-card"}),c=l.createDiv({cls:"reminder-modal__reminder-icon"}),d=a.type==="absolute"?"calendar-clock":"timer";(0,Je.setIcon)(c,d);let u=l.createDiv({cls:"reminder-modal__reminder-content"}),h=u.createDiv({cls:"reminder-modal__reminder-primary"});if(h.textContent=this.formatReminderDisplayText(a),a.description){let m=u.createDiv({cls:"reminder-modal__reminder-description"});m.textContent=`"${a.description}"`}let f=l.createDiv({cls:"reminder-modal__reminder-actions"}).createEl("button",{cls:"reminder-modal__action-btn reminder-modal__remove-btn"});(0,Je.setIcon)(f,"trash-2"),(0,Je.setTooltip)(f,"Delete this reminder"),f.onclick=async m=>{m.stopPropagation(),await this.removeReminder(o)}})}formatReminderDisplayText(e){if(e.type==="absolute"){if(e.absoluteTime)try{let r=new Date(e.absoluteTime);return`${r.toLocaleDateString()} at ${r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch(r){return`At ${e.absoluteTime}`}return"Absolute reminder"}else{let r=e.relatedTo==="due"?"due date":"scheduled date";return`${this.formatOffset(e.offset||"")} ${r}`}}renderQuickActions(e){if(!(this.task.due||this.task.scheduled))return;let n=e.createDiv({cls:"reminder-modal__quick-actions"}).createDiv({cls:"reminder-modal__quick-buttons"});[{label:"5m",fullLabel:"5 minutes before",offset:"-PT5M",icon:"clock"},{label:"15m",fullLabel:"15 minutes before",offset:"-PT15M",icon:"clock"},{label:"1h",fullLabel:"1 hour before",offset:"-PT1H",icon:"clock"},{label:"1d",fullLabel:"1 day before",offset:"-P1D",icon:"calendar"}].forEach(({label:o,fullLabel:l,offset:c,icon:d})=>{let u=this.task.due?"due":"scheduled",h=n.createEl("button",{cls:"reminder-modal__quick-btn"}),p=h.createSpan({cls:"reminder-modal__quick-btn-icon"});(0,Je.setIcon)(p,d),h.createSpan({cls:"reminder-modal__quick-btn-label",text:o}),(0,Je.setTooltip)(h,`Add reminder ${l} ${u} date`),h.onclick=async()=>{await this.addQuickReminder(u,c,l)}})}async addQuickReminder(e,r,i){let n={id:`rem_${Date.now()}`,type:"relative",relatedTo:e,offset:r,description:i};await this.addReminder(n),new Je.Notice(`Added reminder: ${i}`)}renderAddReminderForm(e){let r=e.createDiv({cls:"reminder-modal__section"});r.createDiv({cls:"reminder-modal__section-header"}).createEl("h3",{text:"Add New Reminder"}),this.renderQuickActions(r);let n=r.createDiv({cls:"reminder-modal__form"}),a=n.createDiv({cls:"reminder-modal__type-selector"}),o=a.createEl("button",{cls:"reminder-modal__type-tab reminder-modal__type-tab--active",text:"Relative",attr:{"data-type":"relative"}}),l=a.createEl("button",{cls:"reminder-modal__type-tab",text:"Absolute",attr:{"data-type":"absolute"}});o.classList.toggle("reminder-modal__type-tab--active",this.selectedType==="relative"),l.classList.toggle("reminder-modal__type-tab--active",this.selectedType==="absolute");let c=f=>{this.selectedType=f,o.classList.toggle("reminder-modal__type-tab--active",f==="relative"),l.classList.toggle("reminder-modal__type-tab--active",f==="absolute"),this.updateFormVisibility(n,this.selectedType)};o.onclick=()=>c("relative"),l.onclick=()=>c("absolute");let d=n.createDiv({cls:"relative-fields"});new Je.Setting(d).setName("Time").addText(f=>{f.setPlaceholder("15").setValue(String(this.relativeOffset)).onChange(m=>{this.relativeOffset=parseInt(m)||0})}).addDropdown(f=>{f.addOption("minutes","minutes").addOption("hours","hours").addOption("days","days").setValue(this.relativeUnit).onChange(m=>{this.relativeUnit=m})}),new Je.Setting(d).setName("Direction").addDropdown(f=>{f.addOption("before","Before").addOption("after","After").setValue(this.relativeDirection).onChange(m=>{this.relativeDirection=m})}),new Je.Setting(d).setName("Relative to").addDropdown(f=>{let m={};this.task.due&&(m.due=`Due date (${_r(this.task.due)})`),this.task.scheduled&&(m.scheduled=`Scheduled date (${_r(this.task.scheduled)})`),Object.keys(m).length===0?(m.none="No dates available",f.setDisabled(!0)):(Object.entries(m).forEach(([g,y])=>{f.addOption(g,y)}),f.setValue(this.relativeAnchor)),f.onChange(g=>{this.relativeAnchor=g})});let u=n.createDiv({cls:"absolute-fields"});new Je.Setting(u).setName("Date").addText(f=>{f.setPlaceholder("YYYY-MM-DD").setValue(this.absoluteDate).onChange(m=>{this.absoluteDate=m}),f.inputEl.type="date"}),new Je.Setting(u).setName("Time").addText(f=>{f.setPlaceholder("HH:MM").setValue(this.absoluteTime).onChange(m=>{this.absoluteTime=m}),f.inputEl.type="time"}),new Je.Setting(n).setName("Description (optional)").addText(f=>{f.setPlaceholder("Custom reminder message").setValue(this.description).onChange(m=>{this.description=m})});let h=n.createEl("button",{cls:"reminder-add-btn"}),p=h.createSpan({cls:"reminder-add-btn-icon"});(0,Je.setIcon)(p,"plus"),h.createSpan({cls:"reminder-add-btn-text",text:"Add Reminder"}),h.onclick=async()=>{h.disabled=!0,h.classList.add("reminder-add-btn--loading");try{let f=this.createReminder(this.selectedType,this.relativeAnchor,this.relativeOffset,this.relativeUnit,this.relativeDirection,this.absoluteDate,this.absoluteTime,this.description);f&&(await this.addReminder(f),this.selectedType==="relative"?(this.relativeOffset=15,this.relativeUnit="minutes",this.description=""):(this.absoluteDate="",this.absoluteTime="",this.description=""),this.resetFormInputs(n))}catch(f){console.error("Error adding reminder:",f),new Je.Notice("Failed to add reminder. Please check your inputs.")}finally{h.disabled=!1,h.classList.remove("reminder-add-btn--loading")}},this.updateFormVisibility(n,this.selectedType)}updateFormVisibility(e,r){let i=e.querySelector(".relative-fields"),n=e.querySelector(".absolute-fields");r==="relative"?(i.style.display="block",n.style.display="none"):(i.style.display="none",n.style.display="block")}createReminder(e,r,i,n,a,o,l,c){let d=`rem_${Date.now()}`;if(e==="relative"){if(!(r==="due"?this.task.due:this.task.scheduled))return new Je.Notice(`Cannot create reminder: Task has no ${r} date`),null;let h="PT";return n==="days"?h=`P${i}D`:n==="hours"?h=`PT${i}H`:h=`PT${i}M`,a==="before"&&(h="-"+h),{id:d,type:"relative",relatedTo:r,offset:h,description:c||void 0}}else{if(!o||!l)return new Je.Notice("Please specify both date and time for absolute reminder"),null;let u=`${o}T${l}:00`;return{id:d,type:"absolute",absoluteTime:u,description:c||void 0}}}formatReminderTiming(e){if(e.type==="absolute")return"Absolute reminder";{let r=e.relatedTo==="due"?"due date":"scheduled date";return`${this.formatOffset(e.offset||"")} ${r}`}}formatReminderDetails(e){if(e.type==="absolute")return`At ${_r(e.absoluteTime||"")}`;{let r=e.relatedTo==="due"?this.task.due:this.task.scheduled;return r?`When ${e.relatedTo} date is ${_r(r)}`:`Relative to ${e.relatedTo} date (not set)`}}formatReminderDescription(e){if(e.description)return e.description;if(e.type==="absolute")return`At ${_r(e.absoluteTime||"")}`;{let r=e.relatedTo==="due"?"due date":"scheduled date";return`${this.formatOffset(e.offset||"")} ${r}`}}formatOffset(e){let r=e.startsWith("-"),n=(r?e.substring(1):e).match(/P(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?)?/);if(!n)return e;let[,a,o,l]=n,c=[];if(a&&c.push(`${a} day${a!=="1"?"s":""}`),o&&c.push(`${o} hour${o!=="1"?"s":""}`),l&&c.push(`${l} minute${l!=="1"?"s":""}`),c.length===0)return"At time of";let d=c.join(" ");return r?`${d} before`:`${d} after`}async addReminder(e){this.reminders.push(e),this.refreshRemindersListOnly(),this.task.path&&this.plugin.emitter.trigger("reminder-preview-changed",{taskPath:this.task.path,currentReminders:[...this.reminders],action:"added",reminder:e})}async removeReminder(e){let r=this.reminders[e];this.reminders.splice(e,1),this.refreshRemindersListOnly(),this.task.path&&r&&this.plugin.emitter.trigger("reminder-preview-changed",{taskPath:this.task.path,currentReminders:[...this.reminders],action:"removed",reminder:r})}async refresh(){await this.initializeWithFreshData()}refreshRemindersListOnly(){let e=this.contentEl.querySelector(".reminder-modal__content");if(e){let r=e.querySelector(".reminder-modal__section");r&&r.remove();let i=document.createElement("div");this.renderExistingReminders(i);let n=i.firstChild;n&&e.insertBefore(n,e.firstChild)}this.updateSaveButtonState()}resetFormInputs(e){let r=e.querySelector('input[placeholder="15"]');r&&(r.value=String(this.relativeOffset));let i=e.querySelector('input[placeholder="Custom reminder message"]');i&&(i.value=this.description);let n=e.querySelector('input[type="date"]');n&&(n.value=this.absoluteDate);let a=e.querySelector('input[type="time"]');a&&(a.value=this.absoluteTime);let o=e.querySelector('.setting-item:has(input[placeholder="15"]) select');o&&(o.value=this.relativeUnit);let l=e.querySelector(".setting-item:nth-child(2) select");l&&(l.value=this.relativeDirection);let c=e.querySelector(".setting-item:nth-child(3) select");c&&(c.value=this.relativeAnchor)}async save(){var e;this.saveBtn.disabled=!0,this.saveBtn.textContent="Saving...";try{this.task.path&&this.task.path.trim()!==""&&((e=this.plugin.notificationService)==null||e.clearProcessedRemindersForTask(this.task.path));let r=this.remindersHaveChanged();this.onSave(this.reminders),r&&this.task.path&&this.plugin.emitter.trigger("reminder-changed",{taskPath:this.task.path,oldReminders:this.originalReminders,newReminders:[...this.reminders]}),this.close()}catch(r){console.error("Failed to save reminders:",r),new Je.Notice("Failed to save reminders. Please try again."),this.saveBtn.disabled=!1,this.saveBtn.textContent="Save Changes"}}cancel(){this.remindersHaveChanged()&&this.task.path&&this.plugin.emitter.trigger("reminder-preview-changed",{taskPath:this.task.path,currentReminders:[...this.originalReminders],action:"cancelled"}),this.close()}remindersHaveChanged(){return this.reminders.length!==this.originalReminders.length?!0:!this.reminders.every((e,r)=>{let i=this.originalReminders[r];return i?e.id===i.id&&e.type===i.type&&e.relatedTo===i.relatedTo&&e.offset===i.offset&&e.absoluteTime===i.absoluteTime&&e.description===i.description:!1})}onClose(){let{contentEl:e}=this;e.empty()}}});var su,Un,$E=v(()=>{ot();su=require("obsidian"),Un=class{static generateCalendarURL(t){let{type:e,task:r,useScheduledAsDue:i=!0}=t;switch(e){case"google":return this.generateGoogleCalendarURL(r,i);case"outlook":return this.generateOutlookCalendarURL(r,i);case"yahoo":return this.generateYahooCalendarURL(r,i);case"ics":return this.generateICSDownloadURL(r);default:throw new Error(`Unsupported calendar type: ${e}`)}}static openCalendarURL(t){try{let e=this.generateCalendarURL(t);window.open(e,"_blank")}catch(e){console.error("Failed to generate calendar URL:",e),new su.Notice("Failed to generate calendar link")}}static generateGoogleCalendarURL(t,e){let r="https://calendar.google.com/calendar/render",i=new URLSearchParams;i.append("action","TEMPLATE"),i.append("text",t.title);let n=this.formatGoogleDates(t,e);n&&i.append("dates",n);let a=this.buildDescription(t);return a&&i.append("details",a),t.contexts&&t.contexts.length>0&&i.append("location",t.contexts.join(", ")),`${r}?${i.toString()}`}static generateOutlookCalendarURL(t,e){let r="https://outlook.live.com/calendar/0/deeplink/compose",i=new URLSearchParams;i.append("subject",t.title);let{startISO:n,endISO:a}=this.getTaskDateRange(t,e);n&&i.append("startdt",n),a&&i.append("enddt",a);let o=this.buildDescription(t);return o&&i.append("body",o),t.contexts&&t.contexts.length>0&&i.append("location",t.contexts.join(", ")),i.append("path","/calendar/action/compose"),i.append("rru","addevent"),`${r}?${i.toString()}`}static generateYahooCalendarURL(t,e){let r="https://calendar.yahoo.com/",i=new URLSearchParams;i.append("v","60"),i.append("title",t.title);let{startYahoo:n,endYahoo:a}=this.getYahooDateFormat(t,e);n&&i.append("st",n),a&&i.append("et",a);let o=this.buildDescription(t);return o&&i.append("desc",o),t.contexts&&t.contexts.length>0&&i.append("in_loc",t.contexts.join(", ")),`${r}?${i.toString()}`}static generateICSDownloadURL(t){let e=this.generateICSContent(t);return`data:text/calendar;charset=utf8,${encodeURIComponent(e)}`}static generateICSContent(t){let e=`${t.path.replace(/[^a-zA-Z0-9]/g,"-")}-${Date.now()}@tasknotes`,r=new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),i=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//TaskNotes//Task Export//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${e}`,`DTSTAMP:${r}`];i.push(`SUMMARY:${this.escapeICSText(t.title)}`);let{startICS:n,endICS:a}=this.getICSDateFormat(t);n&&i.push(`DTSTART:${n}`),a&&i.push(`DTEND:${a}`);let o=this.buildDescription(t);if(o&&i.push(`DESCRIPTION:${this.escapeICSText(o)}`),t.contexts&&t.contexts.length>0&&i.push(`LOCATION:${this.escapeICSText(t.contexts.join(", "))}`),t.tags&&t.tags.length>0&&i.push(`CATEGORIES:${t.tags.map(l=>this.escapeICSText(l)).join(",")}`),t.priority){let c={highest:"1",high:"3",medium:"5",low:"7",lowest:"9"}[t.priority]||"5";i.push(`PRIORITY:${c}`)}if(t.status){let c={done:"COMPLETED","in-progress":"IN-PROCESS",todo:"NEEDS-ACTION",cancelled:"CANCELLED"}[t.status]||"NEEDS-ACTION";i.push(`STATUS:${c}`)}return i.push("END:VEVENT"),i.push("END:VCALENDAR"),i.join(`\r
`)}static buildDescription(t){let e=[],r=[];return t.priority&&r.push(`Priority: ${t.priority}`),t.status&&r.push(`Status: ${t.status}`),t.projects&&t.projects.length>0&&r.push(`Projects: ${t.projects.join(", ")}`),t.tags&&t.tags.length>0&&r.push(`Tags: ${t.tags.join(", ")}`),t.contexts&&t.contexts.length>0&&r.push(`Contexts: ${t.contexts.join(", ")}`),t.timeEstimate&&r.push(`Estimated time: ${t.timeEstimate} minutes`),r.length>0&&e.push(...r),e.length>0&&e.push(""),e.push(`Exported from TaskNotes: ${t.path}`),e.join(`
`)}static formatGoogleDates(t,e){let{startICS:r,endICS:i}=this.getICSDateFormat(t,e);if(!r)return null;if(i)return`${r}/${i}`;let n=this.parseICSDate(r),a=new Date(n.getTime()+3600*1e3),o=this.formatDateToICS(a);return`${r}/${o}`}static getTaskDateRange(t,e){let r=null,i=null;if(t.scheduled)try{r=this.parseTaskDate(t.scheduled).toISOString()}catch(n){console.warn("Invalid scheduled date:",t.scheduled)}if(t.due)try{i=this.parseTaskDate(t.due).toISOString()}catch(n){console.warn("Invalid due date:",t.due)}else if(e&&r){let n=new Date(r);i=new Date(n.getTime()+3600*1e3).toISOString()}return{startISO:r,endISO:i}}static getYahooDateFormat(t,e){let{startISO:r,endISO:i}=this.getTaskDateRange(t,e),n=a=>{let o=new Date(a);return C(o,"yyyyMMdd'T'HHmmss")};return{startYahoo:r?n(r):null,endYahoo:i?n(i):null}}static getICSDateFormat(t,e=!0){let{startISO:r,endISO:i}=this.getTaskDateRange(t,e),n=a=>{let o=new Date(a);return this.formatDateToICS(o)};return{startICS:r?n(r):null,endICS:i?n(i):null}}static formatDateToICS(t){return t.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")}static parseICSDate(t){let e=t.substr(0,4),r=t.substr(4,2),i=t.substr(6,2),n=t.substr(9,2),a=t.substr(11,2),o=t.substr(13,2);return new Date(`${e}-${r}-${i}T${n}:${a}:${o}Z`)}static parseTaskDate(t){return t.includes("T")?In(t):In(`${t}T00:00:00`)}static escapeICSText(t){return t.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n").replace(/\r/g,"")}static downloadICSFile(t){try{let e=this.generateICSContent(t),r=new Blob([e],{type:"text/calendar"}),i=URL.createObjectURL(r),n=`${t.title.replace(/[^a-zA-Z0-9]/g,"-")}.ics`,a=document.createElement("a");a.href=i,a.download=n,a.click(),URL.revokeObjectURL(i),new su.Notice(`Downloaded ${n}`)}catch(e){console.error("Failed to download ICS file:",e),new su.Notice("Failed to download calendar file")}}}});async function VE(s,t){return new $f(s,t).show()}var kl,$f,WE=v(()=>{kl=require("obsidian"),$f=class extends kl.Modal{constructor(t,e){super(t),this.options={confirmText:"Confirm",cancelText:"Cancel",...e}}show(){return new Promise(t=>{this.resolve=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty(),new kl.Setting(t).setName(this.options.title).setHeading(),new kl.Setting(t).addText(n=>{this.inputEl=n.inputEl,n.setPlaceholder(this.options.placeholder||"").setValue(this.options.initialValue||"").onChange(()=>{}),setTimeout(()=>{this.inputEl.focus(),this.inputEl.select()},100)});let e=t.createEl("div",{cls:"modal-button-container"});e.style.display="flex",e.style.gap="10px",e.style.justifyContent="flex-end",e.style.marginTop="20px";let r=e.createEl("button",{text:this.options.cancelText});r.addEventListener("click",()=>{this.resolve(null),this.close()});let i=e.createEl("button",{text:this.options.confirmText,cls:"mod-cta"});i.addEventListener("click",()=>{let n=this.inputEl.value.trim();this.resolve(n||null),this.close()}),this.inputEl.addEventListener("keydown",n=>{n.key==="Enter"?(n.preventDefault(),i.click()):n.key==="Escape"&&(n.preventDefault(),r.click())})}onClose(){let{contentEl:t}=this;t.empty(),this.resolve&&this.resolve(null)}}});var Sl,yr,Za=v(()=>{Sl=require("obsidian"),yr=class{constructor(t){this.menu=new Sl.Menu,this.options=t,this.buildMenu()}buildMenu(){this.options.title&&(this.menu.addItem(n=>{n.setTitle(this.options.title),n.setIcon("calendar"),n.setDisabled(!0)}),this.menu.addSeparator());let t=this.getDateOptions(),e=t.filter(n=>n.label.startsWith("+")||n.label.startsWith("-"));e.length>0&&(e.forEach(n=>{this.menu.addItem(a=>{let o=n.label;n.icon&&a.setIcon(n.icon),a.setTitle(o),a.onClick(async()=>{this.options.onSelect(n.value,null)})})}),this.menu.addSeparator()),t.filter(n=>!n.label.startsWith("+")&&!n.label.startsWith("-")&&!["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(n.label)).forEach(n=>{this.menu.addItem(a=>{let o=n.label;n.icon&&a.setIcon(n.icon),n.value&&n.value===this.options.currentValue&&(o=`\u2713 ${n.label}`),a.setTitle(o),a.onClick(async()=>{this.options.onSelect(n.value,null)})})});let i=t.filter(n=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(n.label));i.length>0&&(this.menu.addSeparator(),this.menu.addItem(n=>{n.setTitle("Weekdays"),n.setIcon("calendar");let a=n.setSubmenu();i.forEach(o=>{a.addItem(l=>{let c=o.label;o.value&&o.value===this.options.currentValue&&(c=`\u2713 ${o.label}`),l.setTitle(c),l.setIcon("calendar"),l.onClick(async()=>{this.options.onSelect(o.value,null)})})})})),this.menu.addSeparator(),this.menu.addItem(n=>{n.setTitle("Pick date & time..."),n.setIcon("calendar"),n.onClick(async()=>{this.showDateTimePicker()})}),this.options.currentValue&&this.menu.addItem(n=>{n.setTitle("Clear date"),n.setIcon("x"),n.onClick(async()=>{this.options.onSelect(null,null)})})}getDateOptions(){let t=window.moment(),e=[];if(this.options.currentValue){let o=window.moment(this.options.currentValue);e.push({label:"+1 day",value:o.clone().add(1,"day").format("YYYY-MM-DD"),icon:"plus"}),e.push({label:"-1 day",value:o.clone().subtract(1,"day").format("YYYY-MM-DD"),icon:"minus"}),e.push({label:"+1 week",value:o.clone().add(1,"week").format("YYYY-MM-DD"),icon:"plus-circle"}),e.push({label:"-1 week",value:o.clone().subtract(1,"week").format("YYYY-MM-DD"),icon:"minus-circle"})}e.push({label:"Today",value:t.format("YYYY-MM-DD"),icon:"calendar-check",isToday:!0}),e.push({label:"Tomorrow",value:t.clone().add(1,"day").format("YYYY-MM-DD"),icon:"calendar-plus"}),[{name:"Monday",day:1},{name:"Tuesday",day:2},{name:"Wednesday",day:3},{name:"Thursday",day:4},{name:"Friday",day:5},{name:"Saturday",day:6},{name:"Sunday",day:0}].forEach(o=>{let l=t.clone().day(o.day);l.isSameOrBefore(t,"day")&&(l=l.add(1,"week")),e.push({label:o.name,value:l.format("YYYY-MM-DD"),icon:"calendar"})});let i=t.clone().day(6);(i.isBefore(t)||i.isSame(t,"day"))&&i.add(1,"week"),e.push({label:"This weekend",value:i.format("YYYY-MM-DD"),icon:"calendar-days"});let n=t.clone().day(1).add(1,"week");e.push({label:"Next week",value:n.format("YYYY-MM-DD"),icon:"calendar-plus"});let a=t.clone().add(1,"month").startOf("month");return e.push({label:"Next month",value:a.format("YYYY-MM-DD"),icon:"calendar-range"}),e}show(t){this.menu.showAtMouseEvent(t)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4})}showDateTimePicker(){let t=this.createModal(),e=this.createHeader(),r=this.createDateSection(),i=this.createTimeSection(),n=this.createButtonSection();t.appendChild(e),t.appendChild(r.container),t.appendChild(i.container),t.appendChild(n.container),document.body.appendChild(t),this.setupModalEventHandlers(t,r.input,i.input,n.selectButton),setTimeout(()=>{r.input.focus()},100)}createModal(){let t=document.createElement("div");return t.className="date-picker-modal",t}createHeader(){let t=document.createElement("div");t.className="date-picker-modal__header";let e=document.createElement("div");e.className="date-picker-modal__header-icon",(0,Sl.setIcon)(e,"calendar");let r=document.createElement("h3");return r.className="date-picker-modal__header-title",r.textContent="Set date & time",t.appendChild(e),t.appendChild(r),t}createDateSection(){var n;let t=document.createElement("div");t.className="date-picker-modal__section";let e=this.createInputLabel("calendar","Date"),r=this.createInputContainer(),i=this.createDateInput();return(n=this.options.currentValue)!=null&&n.trim()&&(i.value=this.options.currentValue),r.appendChild(i),t.appendChild(e),t.appendChild(r),{container:t,input:i}}createTimeSection(){var n;let t=document.createElement("div");t.className="date-picker-modal__section date-picker-modal__section--buttons";let e=this.createInputLabel("clock","Time (optional)"),r=this.createInputContainer(),i=this.createTimeInput();return(n=this.options.currentTime)!=null&&n.trim()&&(i.value=this.options.currentTime),r.appendChild(i),t.appendChild(e),t.appendChild(r),{container:t,input:i}}createInputLabel(t,e){let r=document.createElement("label");r.className="date-picker-modal__label";let i=document.createElement("div");i.className="date-picker-modal__label-icon",(0,Sl.setIcon)(i,t==="calendar"?"calendar":"clock");let n=document.createElement("span");return n.textContent=e,r.appendChild(i),r.appendChild(n),r}createInputContainer(){let t=document.createElement("div");return t.className="date-picker-modal__input-container",t}createDateInput(){let t=document.createElement("input");return t.type="date",t.className="date-picker-modal__input",this.addPickerClickHandler(t),t}createTimeInput(){let t=document.createElement("input");return t.type="time",t.className="date-picker-modal__input",this.addPickerClickHandler(t),t}addPickerClickHandler(t){t.addEventListener("click",()=>{if("showPicker"in t&&typeof t.showPicker=="function")try{t.showPicker()}catch(e){t.focus()}else t.focus()})}createButtonSection(){let t=document.createElement("div");t.className="date-picker-modal__buttons";let e=this.createButton("Cancel",!1),r=this.createButton("Select",!0);return t.appendChild(e),t.appendChild(r),{container:t,selectButton:r}}createButton(t,e){let r=document.createElement("button");return r.textContent=t,r.className=e?"date-picker-modal__button date-picker-modal__button--primary":"date-picker-modal__button date-picker-modal__button--secondary",r}setupModalEventHandlers(t,e,r,i){i.addEventListener("click",()=>{e.value&&this.options.onSelect(e.value,r.value||null),document.body.removeChild(t)}),t.querySelector(".date-picker-modal__button--secondary").addEventListener("click",()=>{document.body.removeChild(t)});let a=c=>{c.key==="Escape"&&(document.body.removeChild(t),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a);let o=c=>{c.key==="Enter"&&(c.preventDefault(),i.click())};e.addEventListener("keydown",o),r.addEventListener("keydown",o);let l=c=>{t.contains(c.target)||(document.body.removeChild(t),document.removeEventListener("click",l),document.removeEventListener("keydown",a))};setTimeout(()=>{document.addEventListener("click",l)},100)}}});var Pr,Pi,Vf,El=v(()=>{Pr=require("obsidian"),Pi=class{constructor(t){this.menu=new Pr.Menu,this.options=t,this.buildMenu()}buildMenu(){this.getRecurrenceOptions().forEach(e=>{this.menu.addItem(r=>{let i=e.label;e.icon&&r.setIcon(e.icon),e.value===this.options.currentValue&&(i=`\u2713 ${e.label}`),r.setTitle(i),r.onClick(async()=>{this.options.onSelect(e.value)})})}),this.menu.addSeparator(),this.menu.addItem(e=>{e.setTitle("Custom recurrence..."),e.setIcon("settings"),e.onClick(async()=>{this.showCustomRecurrenceModal()})}),this.options.currentValue&&this.menu.addItem(e=>{e.setTitle("Clear recurrence"),e.setIcon("x"),e.onClick(async()=>{this.options.onSelect(null)})})}getRecurrenceOptions(){let t=[],e=new Date,r=["SU","MO","TU","WE","TH","FR","SA"],i=["January","February","March","April","May","June","July","August","September","October","November","December"],n=r[e.getDay()],a=e.getDate(),o=e.getMonth()+1,l=i[e.getMonth()],c=e.toLocaleDateString("en-US",{weekday:"long"}),d=this.formatDateForDTSTART(e);if(this.options.currentValue){let u=this.options.currentValue.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(u&&u[1].includes("T")){let h=u[1].split("T")[1];d=`${d}T${h}`}}return t.push({label:"Daily",value:`DTSTART:${d};FREQ=DAILY;INTERVAL=1`,icon:"calendar-days"}),t.push({label:`Weekly on ${c}`,value:`DTSTART:${d};FREQ=WEEKLY;INTERVAL=1;BYDAY=${n}`,icon:"calendar"}),t.push({label:`Every 2 weeks on ${c}`,value:`DTSTART:${d};FREQ=WEEKLY;INTERVAL=2;BYDAY=${n}`,icon:"calendar"}),t.push({label:`Monthly on the ${this.getOrdinal(a)}`,value:`DTSTART:${d};FREQ=MONTHLY;INTERVAL=1;BYMONTHDAY=${a}`,icon:"calendar-range"}),t.push({label:`Every 3 months on the ${this.getOrdinal(a)}`,value:`DTSTART:${d};FREQ=MONTHLY;INTERVAL=3;BYMONTHDAY=${a}`,icon:"calendar-range"}),t.push({label:`Yearly on ${l} ${this.getOrdinal(a)}`,value:`DTSTART:${d};FREQ=YEARLY;INTERVAL=1;BYMONTH=${o};BYMONTHDAY=${a}`,icon:"calendar-clock"}),t.push({label:"Weekdays only",value:`DTSTART:${d};FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR`,icon:"briefcase"}),t}formatDateForDTSTART(t){let e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}${r}${i}`}getOrdinal(t){let e=["th","st","nd","rd"],r=t%100;return t+(e[(r-20)%10]||e[r]||e[0])}showCustomRecurrenceModal(){new Vf(this.options.app,this.options.currentValue||"",t=>{t&&this.options.onSelect(t)}).open()}show(t){this.menu.showAtMouseEvent(t)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4})}},Vf=class extends Pr.Modal{constructor(e,r,i){super(e);this.frequency="DAILY";this.interval=1;this.byDay=[];this.byMonthDay=[];this.byMonth=[];this.until="";this.endType="never";this.dtstart="";this.dtstartTime="";this.currentValue=r,this.onSubmit=i,this.parseCurrentValue()}parseCurrentValue(){if(!this.currentValue){this.dtstart=this.formatTodayForInput();return}let e=this.currentValue.split(";");for(let r of e){let[i,n]=r.split("=");switch(i){case"DTSTART":if(n.length>=8){if(this.dtstart=`${n.slice(0,4)}-${n.slice(4,6)}-${n.slice(6,8)}`,n.length>8&&n.includes("T")){let a=n.slice(9);a.length>=4&&(this.dtstartTime=`${a.slice(0,2)}:${a.slice(2,4)}`)}}else{let a=new Date(n);isNaN(a.getTime())?this.dtstart=this.formatTodayForInput():this.dtstart=n}break;case"FREQ":this.frequency=n;break;case"INTERVAL":this.interval=parseInt(n)||1;break;case"BYDAY":{let a=n.split(","),o=[];for(let l of a){let c=l.match(/^(-?\d+)([A-Z]{2})$/);c?(this.bySetPos=parseInt(c[1]),o.push(c[2])):o.push(l)}this.byDay=o;break}case"BYMONTHDAY":this.byMonthDay=n.split(",").map(a=>parseInt(a));break;case"BYMONTH":this.byMonth=n.split(",").map(a=>parseInt(a));break;case"BYSETPOS":this.bySetPos=parseInt(n);break;case"COUNT":this.count=parseInt(n),this.endType="count";break;case"UNTIL":n.length===8?this.until=`${n.slice(0,4)}-${n.slice(4,6)}-${n.slice(6,8)}`:this.until=n,this.endType="until";break}}}formatTodayForInput(){let e=new Date,r=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${r}-${i}-${n}`}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Custom Recurrence"}),new Pr.Setting(e).setName("Start date").setDesc("The date when the recurrence pattern begins").addText(Z=>{Z.inputEl.type="date",Z.setValue(this.dtstart).onChange(se=>{this.dtstart=se})}),new Pr.Setting(e).setName("Start time").setDesc("The time when recurring instances should appear (optional)").addText(Z=>{Z.inputEl.type="time",Z.setValue(this.dtstartTime).onChange(se=>{this.dtstartTime=se})}),new Pr.Setting(e).setName("Frequency").addDropdown(Z=>{Z.addOption("DAILY","Daily").addOption("WEEKLY","Weekly").addOption("MONTHLY","Monthly").addOption("YEARLY","Yearly").setValue(this.frequency).onChange(se=>{this.frequency=se,this.updateFrequencySpecificVisibility()})}),new Pr.Setting(e).setName("Interval").setDesc("Every X days/weeks/months/years").addText(Z=>{Z.setValue(this.interval.toString()).onChange(se=>{this.interval=parseInt(se)||1})});let r=new Pr.Setting(e).setName("Days of week").setDesc("Select specific days (for weekly recurrence)"),i=r.controlEl.createDiv("days-container");[{key:"MO",label:"Mon"},{key:"TU",label:"Tue"},{key:"WE",label:"Wed"},{key:"TH",label:"Thu"},{key:"FR",label:"Fri"},{key:"SA",label:"Sat"},{key:"SU",label:"Sun"}].forEach(Z=>{let se=i.createEl("label",{cls:"day-checkbox"});se.style.display="inline-block",se.style.marginRight="8px";let nt=se.createEl("input",{type:"checkbox"});nt.checked=this.byDay.includes(Z.key),nt.addEventListener("change",()=>{nt.checked?this.byDay.includes(Z.key)||this.byDay.push(Z.key):this.byDay=this.byDay.filter(Mt=>Mt!==Z.key)}),se.createSpan({text:` ${Z.label}`})});let a=new Pr.Setting(e).setName("Monthly recurrence").setDesc("Choose how to repeat monthly"),o=a.controlEl.createDiv("monthly-options"),l=o.createEl("label",{cls:"radio-option"});l.style.display="block",l.style.marginBottom="8px";let c=l.createEl("input",{type:"radio",value:"bydate"});c.name="monthly-type",c.checked=this.byMonthDay.length>0||this.byDay.length===0&&this.bySetPos===void 0,l.createSpan({text:" On day "});let d=l.createEl("select");d.style.marginLeft="4px",d.style.marginRight="4px";for(let Z=1;Z<=31;Z++){let se=d.createEl("option",{value:Z.toString(),text:Z.toString()});(this.byMonthDay.length>0&&this.byMonthDay[0]===Z||this.byMonthDay.length===0&&Z===new Date().getDate())&&(se.selected=!0)}l.createSpan({text:" of each month"});let u=o.createEl("label",{cls:"radio-option"});u.style.display="block",u.style.marginBottom="8px";let h=u.createEl("input",{type:"radio",value:"byday"});h.name="monthly-type",h.checked=this.byDay.length>0&&this.bySetPos!==void 0,u.createSpan({text:" On the "});let p=u.createEl("select");p.style.marginLeft="4px",p.style.marginRight="4px";let f=[{value:"1",text:"first"},{value:"2",text:"second"},{value:"3",text:"third"},{value:"4",text:"fourth"},{value:"-1",text:"last"}];f.forEach(Z=>{let se=p.createEl("option",{value:Z.value,text:Z.text});(this.bySetPos===parseInt(Z.value)||!this.bySetPos&&Z.value==="1")&&(se.selected=!0)});let m=u.createEl("select");m.style.marginLeft="4px",m.style.marginRight="4px";let g=[{value:"MO",text:"Monday"},{value:"TU",text:"Tuesday"},{value:"WE",text:"Wednesday"},{value:"TH",text:"Thursday"},{value:"FR",text:"Friday"},{value:"SA",text:"Saturday"},{value:"SU",text:"Sunday"}],w=["SU","MO","TU","WE","TH","FR","SA"][new Date().getDay()];g.forEach(Z=>{let se=m.createEl("option",{value:Z.value,text:Z.text});(this.byDay.length>0&&this.byDay[0]===Z.value||this.byDay.length===0&&Z.value===w)&&(se.selected=!0)}),u.createSpan({text:" of each month"});let T=new Pr.Setting(e).setName("Yearly recurrence").setDesc("Choose how to repeat yearly"),S=T.controlEl.createDiv("yearly-options"),x=S.createEl("label",{cls:"radio-option"});x.style.display="block",x.style.marginBottom="8px";let I=x.createEl("input",{type:"radio",value:"bydate"});I.name="yearly-type",I.checked=this.byMonthDay.length>0||this.byDay.length===0&&this.bySetPos===void 0,x.createSpan({text:" On "});let F=x.createEl("select");F.style.marginLeft="4px",F.style.marginRight="4px";let A=["January","February","March","April","May","June","July","August","September","October","November","December"];A.forEach((Z,se)=>{let nt=F.createEl("option",{value:(se+1).toString(),text:Z});(this.byMonth.length>0&&this.byMonth[0]===se+1||this.byMonth.length===0&&se+1===new Date().getMonth()+1)&&(nt.selected=!0)});let L=x.createEl("select");L.style.marginLeft="4px",L.style.marginRight="4px";for(let Z=1;Z<=31;Z++){let se=L.createEl("option",{value:Z.toString(),text:Z.toString()});(this.byMonthDay.length>0&&this.byMonthDay[0]===Z||this.byMonthDay.length===0&&Z===new Date().getDate())&&(se.selected=!0)}x.createSpan({text:" each year"});let G=S.createEl("label",{cls:"radio-option"});G.style.display="block",G.style.marginBottom="8px";let V=G.createEl("input",{type:"radio",value:"byday"});V.name="yearly-type",V.checked=this.byDay.length>0&&this.bySetPos!==void 0,G.createSpan({text:" On the "});let k=G.createEl("select");k.style.marginLeft="4px",k.style.marginRight="4px",f.forEach(Z=>{let se=k.createEl("option",{value:Z.value,text:Z.text});(this.bySetPos===parseInt(Z.value)||!this.bySetPos&&Z.value==="1")&&(se.selected=!0)});let D=G.createEl("select");D.style.marginLeft="4px",D.style.marginRight="4px",g.forEach(Z=>{let se=D.createEl("option",{value:Z.value,text:Z.text});(this.byDay.length>0&&this.byDay[0]===Z.value||this.byDay.length===0&&Z.value===w)&&(se.selected=!0)});let _=G.createEl("select");_.style.marginLeft="4px",_.style.marginRight="4px",A.forEach((Z,se)=>{let nt=_.createEl("option",{value:(se+1).toString(),text:Z});(this.byMonth.length>0&&this.byMonth[0]===se+1||this.byMonth.length===0&&se+1===new Date().getMonth()+1)&&(nt.selected=!0)}),G.createSpan({text:" each year"}),new Pr.Setting(e).setName("End condition").setDesc("Choose when the recurrence should end");let $=e.createDiv("end-condition-container"),U=$.createEl("label",{cls:"radio-option"});U.style.display="block",U.style.marginBottom="8px";let R=U.createEl("input",{type:"radio",value:"never"});R.name="end-type",R.checked=this.endType==="never",U.createSpan({text:" Never ends"});let H=$.createEl("label",{cls:"radio-option"});H.style.display="block",H.style.marginBottom="8px";let j=H.createEl("input",{type:"radio",value:"count"});j.name="end-type",j.checked=this.endType==="count",H.createSpan({text:" End after "});let re=H.createEl("input",{type:"number",placeholder:"10"});re.style.width="60px",re.style.marginLeft="4px",re.style.marginRight="4px",re.value=this.count?this.count.toString():"",H.createSpan({text:" occurrences"});let he=$.createEl("label",{cls:"radio-option"});he.style.display="block",he.style.marginBottom="8px";let W=he.createEl("input",{type:"radio",value:"until"});W.name="end-type",W.checked=this.endType==="until",he.createSpan({text:" End on "});let Re=he.createEl("input",{type:"date"});Re.style.marginLeft="4px",Re.value=this.until?this.until.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"):"",R.addEventListener("change",()=>{R.checked&&(this.endType="never")}),j.addEventListener("change",()=>{j.checked&&(this.endType="count")}),W.addEventListener("change",()=>{W.checked&&(this.endType="until")}),re.addEventListener("input",()=>{this.count=parseInt(re.value)||void 0,re.value&&(j.checked=!0,this.endType="count")}),Re.addEventListener("input",()=>{this.until=Re.value?Re.value.replace(/-/g,""):"",Re.value&&(W.checked=!0,this.endType="until")}),this.updateFrequencySpecificVisibility=()=>{r.settingEl.style.display=this.frequency==="WEEKLY"?"flex":"none",a.settingEl.style.display=this.frequency==="MONTHLY"?"flex":"none",T.settingEl.style.display=this.frequency==="YEARLY"?"flex":"none"},this.updateFrequencySpecificVisibility();let ir=e.createDiv("button-container");ir.style.display="flex",ir.style.justifyContent="flex-end",ir.style.gap="8px",ir.style.marginTop="16px",ir.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),ir.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",()=>{let Z=c.checked?"bydate":"byday",se=I.checked?"bydate":"byday";this.frequency==="MONTHLY"?Z==="bydate"?(this.byMonthDay=[parseInt(d.value)],this.byDay=[],this.bySetPos=void 0):(this.byMonthDay=[],this.byDay=[m.value],this.bySetPos=parseInt(p.value)):this.frequency==="YEARLY"&&(se==="bydate"?(this.byMonth=[parseInt(F.value)],this.byMonthDay=[parseInt(L.value)],this.byDay=[],this.bySetPos=void 0):(this.byMonth=[parseInt(_.value)],this.byMonthDay=[],this.byDay=[D.value],this.bySetPos=parseInt(k.value)));let nt=this.buildRRule(Z,se);this.onSubmit(nt),this.close()})}updateFrequencySpecificVisibility(){}buildRRule(e,r){let i=[];if(this.dtstart){let n=this.dtstart.replace(/-/g,"");if(this.dtstartTime){let a=this.dtstartTime.replace(":","")+"00Z";n=`${n}T${a}`}i.push(`DTSTART:${n}`)}switch(i.push(`FREQ=${this.frequency}`),this.interval>1&&i.push(`INTERVAL=${this.interval}`),this.frequency){case"WEEKLY":this.byDay.length>0&&i.push(`BYDAY=${this.byDay.join(",")}`);break;case"MONTHLY":if(e==="bydate"){let n=this.byMonthDay.length>0?this.byMonthDay[0]:new Date().getDate();i.push(`BYMONTHDAY=${n}`)}else if(e==="byday"&&this.byDay.length>0){let n=this.bySetPos||1;i.push(`BYDAY=${n}${this.byDay[0]}`)}break;case"YEARLY":if(r==="bydate"){let n=this.byMonth.length>0?this.byMonth[0]:new Date().getMonth()+1,a=this.byMonthDay.length>0?this.byMonthDay[0]:new Date().getDate();i.push(`BYMONTH=${n}`),i.push(`BYMONTHDAY=${a}`)}else if(r==="byday"){let n=this.byMonth.length>0?this.byMonth[0]:new Date().getMonth()+1;if(i.push(`BYMONTH=${n}`),this.byDay.length>0){let a=this.bySetPos||1;i.push(`BYDAY=${a}${this.byDay[0]}`)}}break}switch(this.endType){case"count":this.count&&this.count>0&&i.push(`COUNT=${this.count}`);break;case"until":if(this.until){let n=this.until.replace(/-/g,"");i.push(`UNTIL=${n}`)}break}return i.join(";")}onClose(){let{contentEl:e}=this;e.empty()}}});var Ze,Ja,Wf=v(()=>{Ze=require("obsidian");Se();iu();$E();Md();WE();Za();El();Ja=class{constructor(t){this.menu=new Ze.Menu,this.options=t,this.buildMenu()}buildMenu(){var r;let{task:t,plugin:e}=this.options;if(this.menu.addItem(i=>{i.setTitle("Status"),i.setIcon("circle");let n=i.setSubmenu();this.addStatusOptions(n,t,e)}),t.recurrence){this.menu.addSeparator();let i=ae(this.options.targetDate),n=((r=t.complete_instances)==null?void 0:r.includes(i))||!1;this.menu.addItem(a=>{a.setTitle(n?"Mark incomplete for this date":"Mark complete for this date"),a.setIcon(n?"x":"check"),a.onClick(async()=>{var o,l;try{await e.toggleRecurringTaskComplete(t,this.options.targetDate),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error toggling recurring task completion:",{error:d,taskPath:t.path}),new Ze.Notice(`Failed to toggle recurring task completion: ${d}`)}})})}this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Priority"),i.setIcon("star");let n=i.setSubmenu();this.addPriorityOptions(n,t,e)}),this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Due date"),i.setIcon("calendar");let n=i.setSubmenu();this.addDateOptions(n,t.due,async a=>{var o,l;try{await e.updateTaskProperty(t,"due",a||void 0),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error updating task due date:",{error:d,taskPath:t.path}),new Ze.Notice(`Failed to update task due date: ${d}`)}},()=>{e.openDueDateModal(t)})}),this.menu.addItem(i=>{i.setTitle("Scheduled date"),i.setIcon("calendar-clock");let n=i.setSubmenu();this.addDateOptions(n,t.scheduled,async a=>{var o,l;try{await e.updateTaskProperty(t,"scheduled",a||void 0),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error updating task scheduled date:",{error:d,taskPath:t.path}),new Ze.Notice(`Failed to update task scheduled date: ${d}`)}},()=>{e.openScheduledDateModal(t)})}),this.menu.addItem(i=>{i.setTitle("Reminders"),i.setIcon("bell");let n=i.setSubmenu();this.addQuickRemindersSection(n,t,e,"due","Remind before due..."),this.addQuickRemindersSection(n,t,e,"scheduled","Remind before scheduled..."),n.addSeparator(),n.addItem(a=>{a.setTitle("Manage All Reminders..."),a.setIcon("settings"),a.onClick(()=>{new cs(e.app,e,t,async l=>{var c,d;try{await e.updateTaskProperty(t,"reminders",l.length>0?l:void 0),(d=(c=this.options).onUpdate)==null||d.call(c)}catch(u){console.error("Error updating reminders:",u),new Ze.Notice("Failed to update reminders")}}).open()})}),t.reminders&&t.reminders.length>0&&n.addItem(a=>{a.setTitle("Clear All Reminders"),a.setIcon("trash"),a.onClick(async()=>{var o,l;try{await e.updateTaskProperty(t,"reminders",void 0),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){console.error("Error clearing reminders:",c),new Ze.Notice("Failed to clear reminders")}})})}),this.menu.addSeparator(),this.menu.addItem(i=>{let n=e.getActiveTimeSession(t);i.setTitle(n?"Stop time tracking":"Start time tracking"),i.setIcon(n?"pause":"play"),i.onClick(async()=>{var o,l;e.getActiveTimeSession(t)?await e.stopTimeTracking(t):await e.startTimeTracking(t),(l=(o=this.options).onUpdate)==null||l.call(o)})}),this.menu.addItem(i=>{i.setTitle(t.archived?"Unarchive":"Archive"),i.setIcon(t.archived?"archive-restore":"archive"),i.onClick(async()=>{var n,a;try{await e.toggleTaskArchive(t),(a=(n=this.options).onUpdate)==null||a.call(n)}catch(o){let l=o instanceof Error?o.message:String(o);console.error("Error toggling task archive:",{error:l,taskPath:t.path}),new Ze.Notice(`Failed to toggle task archive: ${l}`)}})}),this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Open note"),i.setIcon("file-text"),i.onClick(()=>{let n=e.app.vault.getAbstractFileByPath(t.path);n instanceof Ze.TFile&&e.app.workspace.getLeaf(!1).openFile(n)})}),this.menu.addItem(i=>{i.setTitle("Copy task title"),i.setIcon("copy"),i.onClick(async()=>{try{await navigator.clipboard.writeText(t.title),new Ze.Notice("Task title copied to clipboard")}catch(n){new Ze.Notice("Failed to copy to clipboard")}})}),this.menu.addItem(i=>{i.setTitle("Note actions"),i.setIcon("file-text");let n=i.setSubmenu(),a=e.app.vault.getAbstractFileByPath(t.path);if(a instanceof Ze.TFile){try{e.app.workspace.trigger("file-menu",n,a,"file-explorer")}catch(o){console.debug("Native file menu not available, using fallback")}n.addItem(o=>{o.setTitle("Rename"),o.setIcon("pencil"),o.onClick(async()=>{try{let l=a.basename,c=await VE(e.app,{title:"Rename File",placeholder:"Enter new name",initialValue:l});if(c&&c.trim()!==""&&c!==l){let d=a.extension,u=c.endsWith(`.${d}`)?c:`${c}.${d}`,h=a.parent?`${a.parent.path}/${u}`:u;await e.app.vault.rename(a,h),new Ze.Notice(`Renamed to "${u}"`),this.options.onUpdate&&this.options.onUpdate()}}catch(l){console.error("Error renaming file:",l),new Ze.Notice("Failed to rename file")}})}),n.addItem(o=>{o.setTitle("Delete"),o.setIcon("trash"),o.onClick(async()=>{await ui(e.app,{title:"Delete File",message:`Are you sure you want to delete "${a.name}"?`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})&&e.app.vault.trash(a,!0)})}),n.addSeparator(),n.addItem(o=>{o.setTitle("Copy path"),o.setIcon("copy"),o.onClick(async()=>{try{await navigator.clipboard.writeText(a.path),new Ze.Notice("File path copied to clipboard")}catch(l){new Ze.Notice("Failed to copy file path")}})}),n.addItem(o=>{o.setTitle("Copy Obsidian URL"),o.setIcon("link"),o.onClick(async()=>{try{let l=`obsidian://open?vault=${encodeURIComponent(e.app.vault.getName())}&file=${encodeURIComponent(a.path)}`;await navigator.clipboard.writeText(l),new Ze.Notice("Obsidian URL copied to clipboard")}catch(l){new Ze.Notice("Failed to copy Obsidian URL")}})}),n.addSeparator(),n.addItem(o=>{o.setTitle("Show in file explorer"),o.setIcon("folder-open"),o.onClick(()=>{e.app.workspace.getLeaf().setViewState({type:"file-explorer",state:{}}).then(()=>{let l=e.app.workspace.getLeavesOfType("file-explorer")[0];l!=null&&l.view&&"revealInFolder"in l.view&&l.view.revealInFolder(a)})})})}}),this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Add to calendar"),i.setIcon("calendar-plus");let n=i.setSubmenu();n.addItem(a=>{a.setTitle("Google Calendar"),a.setIcon("external-link"),a.onClick(()=>{Un.openCalendarURL({type:"google",task:t,useScheduledAsDue:!0})})}),n.addItem(a=>{a.setTitle("Outlook Calendar"),a.setIcon("external-link"),a.onClick(()=>{Un.openCalendarURL({type:"outlook",task:t,useScheduledAsDue:!0})})}),n.addItem(a=>{a.setTitle("Yahoo Calendar"),a.setIcon("external-link"),a.onClick(()=>{Un.openCalendarURL({type:"yahoo",task:t,useScheduledAsDue:!0})})}),n.addSeparator(),n.addItem(a=>{a.setTitle("Download .ics file"),a.setIcon("download"),a.onClick(()=>{Un.downloadICSFile(t)})})}),this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Recurrence"),i.setIcon("refresh-ccw");let n=i.setSubmenu(),a=typeof t.recurrence=="string"?t.recurrence:void 0;this.addRecurrenceOptions(n,a,async o=>{var l,c;try{await e.updateTaskProperty(t,"recurrence",o||void 0),(c=(l=this.options).onUpdate)==null||c.call(l)}catch(d){let u=d instanceof Error?d.message:String(d);console.error("Error updating task recurrence:",{error:u,taskPath:t.path}),new Ze.Notice(`Failed to update task recurrence: ${u}`)}},e)}),this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Create subtask"),i.setIcon("plus"),i.onClick(()=>{let n=e.app.vault.getAbstractFileByPath(t.path);if(n instanceof Ze.TFile){let a=`[[${n.basename}]]`;e.openTaskCreationModal({projects:[a]})}})}),setTimeout(()=>{this.updateMainMenuIconColors(t,e)},10)}updateMainMenuIconColors(t,e){let r=document.querySelector(".menu");if(!r)return;r.querySelectorAll(".menu-item").forEach(n=>{let a=n.querySelector(".menu-item-title"),o=n.querySelector(".menu-item-icon");if(a&&o){let l=a.textContent;if(l==="Status"){let c=e.settings.customStatuses.find(d=>d.value===t.status);c&&c.color&&(o.style.color=c.color)}else if(l==="Priority"){let c=e.settings.customPriorities.find(d=>d.value===t.priority);c&&c.color&&(o.style.color=c.color)}}})}addStatusOptions(t,e,r){this.getStatusOptions(e,r).forEach((n,a)=>{t.addItem(o=>{let l=n.label;o.setIcon("circle"),n.value===e.status&&(l=`\u2713 ${n.label}`),o.setTitle(l),o.onClick(async()=>{var c,d;try{await r.updateTaskProperty(e,"status",n.value),(d=(c=this.options).onUpdate)==null||d.call(c)}catch(u){let h=u instanceof Error?u.message:String(u);console.error("Error updating task status:",{error:h,taskPath:e.path}),new Ze.Notice(`Failed to update task status: ${h}`)}}),n.color&&setTimeout(()=>{let c=o.dom||o.domEl;if(c){let d=c.querySelector(".menu-item-icon");d&&(d.style.color=n.color)}},10)})})}addPriorityOptions(t,e,r){r.priorityManager.getPrioritiesByWeight().forEach(n=>{t.addItem(a=>{let o=n.label;a.setIcon("star"),n.value===e.priority&&(o=`\u2713 ${n.label}`),a.setTitle(o),a.onClick(async()=>{var l,c;try{await r.updateTaskProperty(e,"priority",n.value),(c=(l=this.options).onUpdate)==null||c.call(l)}catch(d){let u=d instanceof Error?d.message:String(d);console.error("Error updating task priority:",{error:u,taskPath:e.path}),new Ze.Notice(`Failed to update task priority: ${u}`)}}),n.color&&setTimeout(()=>{let l=a.dom||a.domEl;if(l){let c=l.querySelector(".menu-item-icon");c&&(c.style.color=n.color)}},10)})})}addDateOptions(t,e,r,i){let a=new yr({currentValue:e,onSelect:d=>{r(d)},onCustomDate:i}).getDateOptions(),o=a.filter(d=>d.label.startsWith("+")||d.label.startsWith("-"));o.length>0&&(o.forEach(d=>{t.addItem(u=>{u.setTitle(d.label),d.icon&&u.setIcon(d.icon),u.onClick(()=>{r(d.value)})})}),t.addSeparator()),a.filter(d=>!d.label.startsWith("+")&&!d.label.startsWith("-")&&!["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(d.label)).forEach(d=>{t.addItem(u=>{let h=d.value===e;u.setTitle(h?`\u2713 ${d.label}`:d.label),d.icon&&u.setIcon(d.icon),u.onClick(()=>{r(d.value)})})});let c=a.filter(d=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(d.label));c.length>0&&(t.addSeparator(),t.addItem(d=>{d.setTitle("Weekdays"),d.setIcon("calendar");let u=d.setSubmenu();c.forEach(h=>{u.addItem(p=>{let f=h.value===e;p.setTitle(f?`\u2713 ${h.label}`:h.label),p.setIcon("calendar"),p.onClick(()=>{r(h.value)})})})})),t.addSeparator(),t.addItem(d=>{d.setTitle("Pick date & time..."),d.setIcon("calendar"),d.onClick(()=>{i()})}),e&&t.addItem(d=>{d.setTitle("Clear date"),d.setIcon("x"),d.onClick(()=>{r(null)})})}addRecurrenceOptions(t,e,r,i){let n=new Date,a=["SU","MO","TU","WE","TH","FR","SA"],o=["January","February","March","April","May","June","July","August","September","October","November","December"],l=a[n.getDay()],c=n.getDate(),d=n.getMonth()+1,u=o[n.getMonth()],h=n.toLocaleDateString("en-US",{weekday:"long"}),p=y=>{let w=y.getFullYear(),T=String(y.getMonth()+1).padStart(2,"0"),S=String(y.getDate()).padStart(2,"0");return`${w}${T}${S}`},f=y=>{let w=["th","st","nd","rd"],T=y%100;return y+(w[(T-20)%10]||w[T]||w[0])},m=p(n);[{label:"Daily",value:`DTSTART:${m};FREQ=DAILY;INTERVAL=1`,icon:"calendar-days"},{label:`Weekly on ${h}`,value:`DTSTART:${m};FREQ=WEEKLY;INTERVAL=1;BYDAY=${l}`,icon:"calendar"},{label:`Every 2 weeks on ${h}`,value:`DTSTART:${m};FREQ=WEEKLY;INTERVAL=2;BYDAY=${l}`,icon:"calendar"},{label:`Monthly on the ${f(c)}`,value:`DTSTART:${m};FREQ=MONTHLY;INTERVAL=1;BYMONTHDAY=${c}`,icon:"calendar-range"},{label:`Every 3 months on the ${f(c)}`,value:`DTSTART:${m};FREQ=MONTHLY;INTERVAL=3;BYMONTHDAY=${c}`,icon:"calendar-range"},{label:`Yearly on ${u} ${f(c)}`,value:`DTSTART:${m};FREQ=YEARLY;INTERVAL=1;BYMONTH=${d};BYMONTHDAY=${c}`,icon:"calendar-clock"},{label:"Weekdays only",value:`DTSTART:${m};FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR`,icon:"briefcase"}].forEach(y=>{t.addItem(w=>{let T=y.value===e;w.setTitle(T?`\u2713 ${y.label}`:y.label),w.setIcon(y.icon),w.onClick(()=>{r(y.value)})})}),t.addSeparator(),t.addItem(y=>{y.setTitle("Custom recurrence..."),y.setIcon("settings"),y.onClick(()=>{new Pi({currentValue:typeof e=="string"?e:void 0,onSelect:r,app:i.app}).showCustomRecurrenceModal()})}),e&&t.addItem(y=>{y.setTitle("Clear recurrence"),y.setIcon("x"),y.onClick(()=>{r(null)})})}getStatusOptions(t,e){let r=e.settings.customStatuses,i=[];if(r&&r.length>0){let n=[...r].sort((o,l)=>o.order-l.order);(t.recurrence?n.filter(o=>o.value!=="completed"):n).forEach(o=>{i.push({label:o.label,value:o.value,color:o.color})})}return i}addQuickRemindersSection(t,e,r,i,n){if(!(i==="due"?e.due:e.scheduled)){t.addItem(o=>{o.setTitle(n),o.setIcon("bell"),o.setDisabled(!0)});return}t.addItem(o=>{o.setTitle(n),o.setIcon("bell");let l=o.setSubmenu();[{label:"At time of event",offset:"PT0M"},{label:"5 minutes before",offset:"-PT5M"},{label:"15 minutes before",offset:"-PT15M"},{label:"1 hour before",offset:"-PT1H"},{label:"1 day before",offset:"-P1D"}].forEach(d=>{l.addItem(u=>{u.setTitle(d.label),u.onClick(async()=>{await this.addQuickReminder(e,r,i,d.offset,d.label)})})})})}async addQuickReminder(t,e,r,i,n){var l,c;let a={id:`rem_${Date.now()}`,type:"relative",relatedTo:r,offset:i,description:n},o=[...t.reminders||[],a];try{await e.updateTaskProperty(t,"reminders",o),(c=(l=this.options).onUpdate)==null||c.call(l)}catch(d){console.error("Error adding reminder:",d),new Ze.Notice("Failed to add reminder")}}show(t){this.menu.showAtMouseEvent(t)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4})}}});var mx,ws,hh=v(()=>{mx=require("obsidian"),ws=class{constructor(t){this.menu=new mx.Menu,this.options=t,this.buildMenu()}buildMenu(){let t=this.options.plugin.settings.customPriorities;this.sortedPriorities=[...t].sort((e,r)=>r.weight-e.weight),this.sortedPriorities.forEach(e=>{this.menu.addItem(r=>{let i=e.label;r.setIcon("star"),e.value===this.options.currentValue&&(i=`\u2713 ${e.label}`),r.setTitle(i),r.onClick(async()=>{this.options.onSelect(e.value)})})})}show(t){this.menu.showAtMouseEvent(t),setTimeout(()=>{this.applyColorStyling()},10)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4}),setTimeout(()=>{this.applyColorStyling()},10)}applyColorStyling(){let t=document.querySelector(".menu");if(!t)return;let e=t.querySelectorAll(".menu-item");this.sortedPriorities.forEach((r,i)=>{let n=e[i];if(n&&r.color){let a=n.querySelector(".menu-item-icon");a&&(a.style.color=r.color)}})}}});function fh(s,t){if(!s||!t)return 0;let e=s.toLowerCase().split(" ").filter(Boolean),r=t.toLowerCase(),i=0,n=0;for(let a=0;a<e.length;a++){let o=e[a],l=r.indexOf(o,i);if(l===-1)return 0;n+=Math.max(0,100-l),r.startsWith(o,l)&&(n+=10),a>0&&l===i&&(n+=5),i=l+o.length}return n}var yx=v(()=>{});var Xg={};Ur(Xg,{FileSuggestHelper:()=>RF});var vx,RF,ey=v(()=>{vx=require("obsidian");yx();RF={async suggest(s,t,e=20){var n,a;let r=async()=>{let o=s.app.vault.getMarkdownFiles(),l=[];for(let u of o){let h=s.app.metadataCache.getFileCache(u),p=u.basename,f="";if(h!=null&&h.frontmatter){let y=s.fieldMapper.mapFromFrontmatter(h.frontmatter,u.path,s.settings.storeTitleInFilename);f=typeof y.title=="string"?y.title:""}let m=h!=null&&h.frontmatter?(0,vx.parseFrontMatterAliases)(h.frontmatter)||[]:[],g=0;if(g=Math.max(g,fh(t,p)+15),f&&(g=Math.max(g,fh(t,f)+5)),Array.isArray(m))for(let y of m)typeof y=="string"&&(g=Math.max(g,fh(t,y)));if(g>0){let y=[];f&&f!==p&&y.push(`title: ${f}`);let w=Array.isArray(m)?m.filter(S=>typeof S=="string"):[];w.length&&y.push(`aliases: ${w.join(", ")}`);let T=y.length?`${p} [${y.join(" | ")}]`:p;l.push({insertText:p,displayText:T,score:g})}}l.sort((u,h)=>h.score-u.score);let c=[],d=new Set;for(let u of l)if(!d.has(u.insertText)&&(c.push(u),d.add(u.insertText),c.length>=e))break;return c},i=(a=(n=s.settings)==null?void 0:n.suggestionDebounceMs)!=null?a:0;return i?new Promise(o=>{let l=s;l.__fileSuggestTimer&&clearTimeout(l.__fileSuggestTimer),l.__fileSuggestTimer=setTimeout(async()=>{let c=await r();o(c)},i)}):r()}}});var kx=hd((sy,ny)=>{(function(s,t){typeof sy=="object"&&typeof ny!="undefined"?ny.exports=t():typeof define=="function"&&define.amd?define(t):(s=typeof globalThis!="undefined"?globalThis:s||self).dayjs_plugin_quarterOfYear=t()})(sy,(function(){"use strict";var s="month",t="quarter";return function(e,r){var i=r.prototype;i.quarter=function(o){return this.$utils().u(o)?Math.ceil((this.month()+1)/3):this.month(this.month()%3+3*(o-1))};var n=i.add;i.add=function(o,l){return o=Number(o),this.$utils().p(l)===t?this.add(3*o,s):n.bind(this)(o,l)};var a=i.startOf;i.startOf=function(o,l){var c=this.$utils(),d=!!c.u(l)||l;if(c.p(o)===t){var u=this.quarter()-1;return d?this.month(3*u).startOf(s).startOf("day"):this.month(3*u+2).endOf(s).endOf("day")}return a.bind(this)(o,l)}}}))});var tn=hd((ay,oy)=>{(function(s,t){typeof ay=="object"&&typeof oy!="undefined"?oy.exports=t():typeof define=="function"&&define.amd?define(t):(s=typeof globalThis!="undefined"?globalThis:s||self).dayjs=t()})(ay,(function(){"use strict";var s=1e3,t=6e4,e=36e5,r="millisecond",i="second",n="minute",a="hour",o="day",l="week",c="month",d="quarter",u="year",h="date",p="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(k){var D=["th","st","nd","rd"],_=k%100;return"["+k+(D[(_-20)%10]||D[_]||D[0])+"]"}},y=function(k,D,_){var $=String(k);return!$||$.length>=D?k:""+Array(D+1-$.length).join(_)+k},w={s:y,z:function(k){var D=-k.utcOffset(),_=Math.abs(D),$=Math.floor(_/60),U=_%60;return(D<=0?"+":"-")+y($,2,"0")+":"+y(U,2,"0")},m:function k(D,_){if(D.date()<_.date())return-k(_,D);var $=12*(_.year()-D.year())+(_.month()-D.month()),U=D.clone().add($,c),R=_-U<0,H=D.clone().add($+(R?-1:1),c);return+(-($+(_-U)/(R?U-H:H-U))||0)},a:function(k){return k<0?Math.ceil(k)||0:Math.floor(k)},p:function(k){return{M:c,y:u,w:l,d:o,D:h,h:a,m:n,s:i,ms:r,Q:d}[k]||String(k||"").toLowerCase().replace(/s$/,"")},u:function(k){return k===void 0}},T="en",S={};S[T]=g;var x="$isDayjsObject",I=function(k){return k instanceof G||!(!k||!k[x])},F=function k(D,_,$){var U;if(!D)return T;if(typeof D=="string"){var R=D.toLowerCase();S[R]&&(U=R),_&&(S[R]=_,U=R);var H=D.split("-");if(!U&&H.length>1)return k(H[0])}else{var j=D.name;S[j]=D,U=j}return!$&&U&&(T=U),U||!$&&T},A=function(k,D){if(I(k))return k.clone();var _=typeof D=="object"?D:{};return _.date=k,_.args=arguments,new G(_)},L=w;L.l=F,L.i=I,L.w=function(k,D){return A(k,{locale:D.$L,utc:D.$u,x:D.$x,$offset:D.$offset})};var G=(function(){function k(_){this.$L=F(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[x]=!0}var D=k.prototype;return D.parse=function(_){this.$d=(function($){var U=$.date,R=$.utc;if(U===null)return new Date(NaN);if(L.u(U))return new Date;if(U instanceof Date)return new Date(U);if(typeof U=="string"&&!/Z$/i.test(U)){var H=U.match(f);if(H){var j=H[2]-1||0,re=(H[7]||"0").substring(0,3);return R?new Date(Date.UTC(H[1],j,H[3]||1,H[4]||0,H[5]||0,H[6]||0,re)):new Date(H[1],j,H[3]||1,H[4]||0,H[5]||0,H[6]||0,re)}}return new Date(U)})(_),this.init()},D.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},D.$utils=function(){return L},D.isValid=function(){return this.$d.toString()!==p},D.isSame=function(_,$){var U=A(_);return this.startOf($)<=U&&U<=this.endOf($)},D.isAfter=function(_,$){return A(_)<this.startOf($)},D.isBefore=function(_,$){return this.endOf($)<A(_)},D.$g=function(_,$,U){return L.u(_)?this[$]:this.set(U,_)},D.unix=function(){return Math.floor(this.valueOf()/1e3)},D.valueOf=function(){return this.$d.getTime()},D.startOf=function(_,$){var U=this,R=!!L.u($)||$,H=L.p(_),j=function(Z,se){var nt=L.w(U.$u?Date.UTC(U.$y,se,Z):new Date(U.$y,se,Z),U);return R?nt:nt.endOf(o)},re=function(Z,se){return L.w(U.toDate()[Z].apply(U.toDate("s"),(R?[0,0,0,0]:[23,59,59,999]).slice(se)),U)},he=this.$W,W=this.$M,Re=this.$D,ir="set"+(this.$u?"UTC":"");switch(H){case u:return R?j(1,0):j(31,11);case c:return R?j(1,W):j(0,W+1);case l:var Be=this.$locale().weekStart||0,Ns=(he<Be?he+7:he)-Be;return j(R?Re-Ns:Re+(6-Ns),W);case o:case h:return re(ir+"Hours",0);case a:return re(ir+"Minutes",1);case n:return re(ir+"Seconds",2);case i:return re(ir+"Milliseconds",3);default:return this.clone()}},D.endOf=function(_){return this.startOf(_,!1)},D.$set=function(_,$){var U,R=L.p(_),H="set"+(this.$u?"UTC":""),j=(U={},U[o]=H+"Date",U[h]=H+"Date",U[c]=H+"Month",U[u]=H+"FullYear",U[a]=H+"Hours",U[n]=H+"Minutes",U[i]=H+"Seconds",U[r]=H+"Milliseconds",U)[R],re=R===o?this.$D+($-this.$W):$;if(R===c||R===u){var he=this.clone().set(h,1);he.$d[j](re),he.init(),this.$d=he.set(h,Math.min(this.$D,he.daysInMonth())).$d}else j&&this.$d[j](re);return this.init(),this},D.set=function(_,$){return this.clone().$set(_,$)},D.get=function(_){return this[L.p(_)]()},D.add=function(_,$){var U,R=this;_=Number(_);var H=L.p($),j=function(W){var Re=A(R);return L.w(Re.date(Re.date()+Math.round(W*_)),R)};if(H===c)return this.set(c,this.$M+_);if(H===u)return this.set(u,this.$y+_);if(H===o)return j(1);if(H===l)return j(7);var re=(U={},U[n]=t,U[a]=e,U[i]=s,U)[H]||1,he=this.$d.getTime()+_*re;return L.w(he,this)},D.subtract=function(_,$){return this.add(-1*_,$)},D.format=function(_){var $=this,U=this.$locale();if(!this.isValid())return U.invalidDate||p;var R=_||"YYYY-MM-DDTHH:mm:ssZ",H=L.z(this),j=this.$H,re=this.$m,he=this.$M,W=U.weekdays,Re=U.months,ir=U.meridiem,Be=function(se,nt,Mt,Cn){return se&&(se[nt]||se($,R))||Mt[nt].slice(0,Cn)},Ns=function(se){return L.s(j%12||12,se,"0")},Z=ir||function(se,nt,Mt){var Cn=se<12?"AM":"PM";return Mt?Cn.toLowerCase():Cn};return R.replace(m,(function(se,nt){return nt||(function(Mt){switch(Mt){case"YY":return String($.$y).slice(-2);case"YYYY":return L.s($.$y,4,"0");case"M":return he+1;case"MM":return L.s(he+1,2,"0");case"MMM":return Be(U.monthsShort,he,Re,3);case"MMMM":return Be(Re,he);case"D":return $.$D;case"DD":return L.s($.$D,2,"0");case"d":return String($.$W);case"dd":return Be(U.weekdaysMin,$.$W,W,2);case"ddd":return Be(U.weekdaysShort,$.$W,W,3);case"dddd":return W[$.$W];case"H":return String(j);case"HH":return L.s(j,2,"0");case"h":return Ns(1);case"hh":return Ns(2);case"a":return Z(j,re,!0);case"A":return Z(j,re,!1);case"m":return String(re);case"mm":return L.s(re,2,"0");case"s":return String($.$s);case"ss":return L.s($.$s,2,"0");case"SSS":return L.s($.$ms,3,"0");case"Z":return H}return null})(se)||H.replace(":","")}))},D.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},D.diff=function(_,$,U){var R,H=this,j=L.p($),re=A(_),he=(re.utcOffset()-this.utcOffset())*t,W=this-re,Re=function(){return L.m(H,re)};switch(j){case u:R=Re()/12;break;case c:R=Re();break;case d:R=Re()/3;break;case l:R=(W-he)/6048e5;break;case o:R=(W-he)/864e5;break;case a:R=W/e;break;case n:R=W/t;break;case i:R=W/s;break;default:R=W}return U?R:L.a(R)},D.daysInMonth=function(){return this.endOf(c).$D},D.$locale=function(){return S[this.$L]},D.locale=function(_,$){if(!_)return this.$L;var U=this.clone(),R=F(_,$,!0);return R&&(U.$L=R),U},D.clone=function(){return L.w(this.$d,this)},D.toDate=function(){return new Date(this.valueOf())},D.toJSON=function(){return this.isValid()?this.toISOString():null},D.toISOString=function(){return this.$d.toISOString()},D.toString=function(){return this.$d.toUTCString()},k})(),V=G.prototype;return A.prototype=V,[["$ms",r],["$s",i],["$m",n],["$H",a],["$W",o],["$M",c],["$y",u],["$D",h]].forEach((function(k){V[k[1]]=function(D){return this.$g(D,k[0],k[1])}})),A.extend=function(k,D){return k.$i||(k(D,G,A),k.$i=!0),A},A.locale=F,A.isDayjs=I,A.unix=function(k){return A(1e3*k)},A.en=S[T],A.Ls=S,A.p={},A}))});var ge,qe,Fr,$i=v(()=>{(function(s){s[s.AM=0]="AM",s[s.PM=1]="PM"})(ge||(ge={}));(function(s){s[s.SUNDAY=0]="SUNDAY",s[s.MONDAY=1]="MONDAY",s[s.TUESDAY=2]="TUESDAY",s[s.WEDNESDAY=3]="WEDNESDAY",s[s.THURSDAY=4]="THURSDAY",s[s.FRIDAY=5]="FRIDAY",s[s.SATURDAY=6]="SATURDAY"})(qe||(qe={}));(function(s){s[s.JANUARY=1]="JANUARY",s[s.FEBRUARY=2]="FEBRUARY",s[s.MARCH=3]="MARCH",s[s.APRIL=4]="APRIL",s[s.MAY=5]="MAY",s[s.JUNE=6]="JUNE",s[s.JULY=7]="JULY",s[s.AUGUST=8]="AUGUST",s[s.SEPTEMBER=9]="SEPTEMBER",s[s.OCTOBER=10]="OCTOBER",s[s.NOVEMBER=11]="NOVEMBER",s[s.DECEMBER=12]="DECEMBER"})(Fr||(Fr={}))});function Sx(s,t){s.assign("day",t.getDate()),s.assign("month",t.getMonth()+1),s.assign("year",t.getFullYear())}function Ex(s,t){s.assign("hour",t.getHours()),s.assign("minute",t.getMinutes()),s.assign("second",t.getSeconds()),s.assign("millisecond",t.getMilliseconds()),s.assign("meridiem",t.getHours()<12?ge.AM:ge.PM)}function yh(s,t){s.imply("day",t.getDate()),s.imply("month",t.getMonth()+1),s.imply("year",t.getFullYear())}function Dx(s,t){s.imply("hour",t.getHours()),s.imply("minute",t.getMinutes()),s.imply("second",t.getSeconds()),s.imply("millisecond",t.getMilliseconds()),s.imply("meridiem",t.getHours()<12?ge.AM:ge.PM)}var ly=v(()=>{$i()});function rn(s,t,e,r,i=0){let n=0,a=0;for(;a<r;)n++,new Date(s,t-1,n).getDay()===e&&a++;return new Date(s,t-1,n,i)}function Cx(s,t,e,r=0){let i=e===0?7:e,n=new Date(s,t-1+1,1,12),a=n.getDay()===0?7:n.getDay(),o;return a===i?o=7:a<i?o=7+a-i:o=a-i,n.setDate(n.getDate()-o),new Date(s,t-1,n.getDate(),r)}function vh(s,t,e={}){var i;if(s==null)return null;if(typeof s=="number")return s;let r=(i=e[s])!=null?i:FF[s];return r==null?null:typeof r=="number"?r:t==null?null:(0,cy.default)(t).isAfter(r.dstStart(t.getFullYear()))&&!(0,cy.default)(t).isAfter(r.dstEnd(t.getFullYear()))?r.timezoneOffsetDuringDst:r.timezoneOffsetNonDst}var cy,FF,dy=v(()=>{cy=bt(tn(),1);$i();FF={ACDT:630,ACST:570,ADT:-180,AEDT:660,AEST:600,AFT:270,AKDT:-480,AKST:-540,ALMT:360,AMST:-180,AMT:-240,ANAST:720,ANAT:720,AQTT:300,ART:-180,AST:-240,AWDT:540,AWST:480,AZOST:0,AZOT:-60,AZST:300,AZT:240,BNT:480,BOT:-240,BRST:-120,BRT:-180,BST:60,BTT:360,CAST:480,CAT:120,CCT:390,CDT:-300,CEST:120,CET:{timezoneOffsetDuringDst:120,timezoneOffsetNonDst:60,dstStart:s=>Cx(s,Fr.MARCH,qe.SUNDAY,2),dstEnd:s=>Cx(s,Fr.OCTOBER,qe.SUNDAY,3)},CHADT:825,CHAST:765,CKT:-600,CLST:-180,CLT:-240,COT:-300,CST:-360,CT:{timezoneOffsetDuringDst:-300,timezoneOffsetNonDst:-360,dstStart:s=>rn(s,Fr.MARCH,qe.SUNDAY,2,2),dstEnd:s=>rn(s,Fr.NOVEMBER,qe.SUNDAY,1,2)},CVT:-60,CXT:420,ChST:600,DAVT:420,EASST:-300,EAST:-360,EAT:180,ECT:-300,EDT:-240,EEST:180,EET:120,EGST:0,EGT:-60,EST:-300,ET:{timezoneOffsetDuringDst:-240,timezoneOffsetNonDst:-300,dstStart:s=>rn(s,Fr.MARCH,qe.SUNDAY,2,2),dstEnd:s=>rn(s,Fr.NOVEMBER,qe.SUNDAY,1,2)},FJST:780,FJT:720,FKST:-180,FKT:-240,FNT:-120,GALT:-360,GAMT:-540,GET:240,GFT:-180,GILT:720,GMT:0,GST:240,GYT:-240,HAA:-180,HAC:-300,HADT:-540,HAE:-240,HAP:-420,HAR:-360,HAST:-600,HAT:-90,HAY:-480,HKT:480,HLV:-210,HNA:-240,HNC:-360,HNE:-300,HNP:-480,HNR:-420,HNT:-150,HNY:-540,HOVT:420,ICT:420,IDT:180,IOT:360,IRDT:270,IRKST:540,IRKT:540,IRST:210,IST:330,JST:540,KGT:360,KRAST:480,KRAT:480,KST:540,KUYT:240,LHDT:660,LHST:630,LINT:840,MAGST:720,MAGT:720,MART:-510,MAWT:300,MDT:-360,MESZ:120,MEZ:60,MHT:720,MMT:390,MSD:240,MSK:180,MST:-420,MT:{timezoneOffsetDuringDst:-360,timezoneOffsetNonDst:-420,dstStart:s=>rn(s,Fr.MARCH,qe.SUNDAY,2,2),dstEnd:s=>rn(s,Fr.NOVEMBER,qe.SUNDAY,1,2)},MUT:240,MVT:300,MYT:480,NCT:660,NDT:-90,NFT:690,NOVST:420,NOVT:360,NPT:345,NST:-150,NUT:-660,NZDT:780,NZST:720,OMSST:420,OMST:420,PDT:-420,PET:-300,PETST:720,PETT:720,PGT:600,PHOT:780,PHT:480,PKT:300,PMDT:-120,PMST:-180,PONT:660,PST:-480,PT:{timezoneOffsetDuringDst:-420,timezoneOffsetNonDst:-480,dstStart:s=>rn(s,Fr.MARCH,qe.SUNDAY,2,2),dstEnd:s=>rn(s,Fr.NOVEMBER,qe.SUNDAY,1,2)},PWT:540,PYST:-180,PYT:-240,RET:240,SAMT:240,SAST:120,SBT:660,SCT:240,SGT:480,SRT:-180,SST:-660,TAHT:-600,TFT:300,TJT:300,TKT:780,TLT:540,TMT:300,TVT:720,ULAT:480,UTC:0,UYST:-120,UYT:-180,UZT:300,VET:-210,VLAST:660,VLAT:660,VUT:660,WAST:120,WAT:60,WEST:60,WESZ:60,WET:0,WEZ:0,WFT:720,WGST:-120,WGT:-180,WIB:420,WIT:540,WITA:480,WST:780,WT:0,YAKST:600,YAKT:600,YAPT:600,YEKST:360,YEKT:360}});function xx(s,t){var r,i,n,a,o,l,c;let e=new Date(s);if(t.y&&(t.year=t.y,delete t.y),t.mo&&(t.month=t.mo,delete t.mo),t.M&&(t.month=t.M,delete t.M),t.w&&(t.week=t.w,delete t.w),t.d&&(t.day=t.d,delete t.d),t.h&&(t.hour=t.h,delete t.h),t.m&&(t.minute=t.m,delete t.m),t.s&&(t.second=t.s,delete t.s),t.ms&&(t.millisecond=t.ms,delete t.ms),"year"in t){let d=Math.floor(t.year);e.setFullYear(e.getFullYear()+d);let u=t.year-d;u>0&&(t.month=(r=t==null?void 0:t.month)!=null?r:0,t.month+=u*12)}if("quarter"in t){let d=Math.floor(t.quarter);e.setMonth(e.getMonth()+d*3)}if("month"in t){let d=Math.floor(t.month);e.setMonth(e.getMonth()+d);let u=t.month-d;u>0&&(t.week=(i=t==null?void 0:t.week)!=null?i:0,t.week+=u*4)}if("week"in t){let d=Math.floor(t.week);e.setDate(e.getDate()+d*7);let u=t.week-d;u>0&&(t.day=(n=t==null?void 0:t.day)!=null?n:0,t.day+=Math.round(u*7))}if("day"in t){let d=Math.floor(t.day);e.setDate(e.getDate()+d);let u=t.day-d;u>0&&(t.hour=(a=t==null?void 0:t.hour)!=null?a:0,t.hour+=Math.round(u*24))}if("hour"in t){let d=Math.floor(t.hour);e.setHours(e.getHours()+d);let u=t.hour-d;u>0&&(t.minute=(o=t==null?void 0:t.minute)!=null?o:0,t.minute+=Math.round(u*60))}if("minute"in t){let d=Math.floor(t.minute);e.setMinutes(e.getMinutes()+d);let u=t.minute-d;u>0&&(t.second=(l=t==null?void 0:t.second)!=null?l:0,t.second+=Math.round(u*60))}if("second"in t){let d=Math.floor(t.second);e.setSeconds(e.getSeconds()+d);let u=t.second-d;u>0&&(t.millisecond=(c=t==null?void 0:t.millisecond)!=null?c:0,t.millisecond+=Math.round(u*1e3))}if("millisecond"in t){let d=Math.floor(t.millisecond);e.setMilliseconds(e.getMilliseconds()+d)}return e}function To(s){let t={};for(let e in s)t[e]=-s[e];return t}var fc=v(()=>{});var Mx,uy,sn,xe,Ts,Ti=v(()=>{Mx=bt(kx(),1),uy=bt(tn(),1);ly();dy();fc();uy.default.extend(Mx.default);sn=class s{constructor(t,e){P(this,"instant");P(this,"timezoneOffset");this.instant=t!=null?t:new Date,this.timezoneOffset=e!=null?e:null}static fromDate(t){return new s(t)}static fromInput(t,e){var n;if(t instanceof Date)return s.fromDate(t);let r=(n=t==null?void 0:t.instant)!=null?n:new Date,i=vh(t==null?void 0:t.timezone,r,e);return new s(r,i)}getDateWithAdjustedTimezone(){let t=new Date(this.instant);return this.timezoneOffset!==null&&t.setMinutes(t.getMinutes()-this.getSystemTimezoneAdjustmentMinute(this.instant)),t}getSystemTimezoneAdjustmentMinute(t,e){var n;(!t||t.getTime()<0)&&(t=new Date);let r=-t.getTimezoneOffset(),i=(n=e!=null?e:this.timezoneOffset)!=null?n:r;return r-i}getTimezoneOffset(){var t;return(t=this.timezoneOffset)!=null?t:-this.instant.getTimezoneOffset()}},xe=class s{constructor(t,e){P(this,"knownValues");P(this,"impliedValues");P(this,"reference");P(this,"_tags",new Set);if(this.reference=t,this.knownValues={},this.impliedValues={},e)for(let i in e)this.knownValues[i]=e[i];let r=t.getDateWithAdjustedTimezone();this.imply("day",r.getDate()),this.imply("month",r.getMonth()+1),this.imply("year",r.getFullYear()),this.imply("hour",12),this.imply("minute",0),this.imply("second",0),this.imply("millisecond",0)}get(t){return t in this.knownValues?this.knownValues[t]:t in this.impliedValues?this.impliedValues[t]:null}isCertain(t){return t in this.knownValues}getCertainComponents(){return Object.keys(this.knownValues)}imply(t,e){return t in this.knownValues?this:(this.impliedValues[t]=e,this)}assign(t,e){return this.knownValues[t]=e,delete this.impliedValues[t],this}delete(t){delete this.knownValues[t],delete this.impliedValues[t]}clone(){let t=new s(this.reference);t.knownValues={},t.impliedValues={};for(let e in this.knownValues)t.knownValues[e]=this.knownValues[e];for(let e in this.impliedValues)t.impliedValues[e]=this.impliedValues[e];return t}isOnlyDate(){return!this.isCertain("hour")&&!this.isCertain("minute")&&!this.isCertain("second")}isOnlyTime(){return!this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")&&!this.isCertain("year")}isOnlyWeekdayComponent(){return this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")}isDateWithUnknownYear(){return this.isCertain("month")&&!this.isCertain("year")}isValidDate(){let t=this.dateWithoutTimezoneAdjustment();return!(t.getFullYear()!==this.get("year")||t.getMonth()!==this.get("month")-1||t.getDate()!==this.get("day")||this.get("hour")!=null&&t.getHours()!=this.get("hour")||this.get("minute")!=null&&t.getMinutes()!=this.get("minute"))}toString(){return`[ParsingComponents {
            tags: ${JSON.stringify(Array.from(this._tags).sort())}, 
            knownValues: ${JSON.stringify(this.knownValues)}, 
            impliedValues: ${JSON.stringify(this.impliedValues)}}, 
            reference: ${JSON.stringify(this.reference)}]`}dayjs(){return(0,uy.default)(this.dateWithoutTimezoneAdjustment())}date(){let t=this.dateWithoutTimezoneAdjustment(),e=this.reference.getSystemTimezoneAdjustmentMinute(t,this.get("timezoneOffset"));return new Date(t.getTime()+e*6e4)}addTag(t){return this._tags.add(t),this}addTags(t){for(let e of t)this._tags.add(e);return this}tags(){return new Set(this._tags)}dateWithoutTimezoneAdjustment(){let t=new Date(this.get("year"),this.get("month")-1,this.get("day"),this.get("hour"),this.get("minute"),this.get("second"),this.get("millisecond"));return t.setFullYear(this.get("year")),t}static createRelativeFromReference(t,e){let r=xx(t.getDateWithAdjustedTimezone(),e),i=new s(t);return i.addTag("result/relativeDate"),e.hour||e.minute||e.second?(i.addTag("result/relativeDateAndTime"),Ex(i,r),Sx(i,r),i.assign("timezoneOffset",t.getTimezoneOffset())):(Dx(i,r),i.imply("timezoneOffset",t.getTimezoneOffset()),e.day?(i.assign("day",r.getDate()),i.assign("month",r.getMonth()+1),i.assign("year",r.getFullYear()),i.assign("weekday",r.getDay())):e.week?(i.assign("day",r.getDate()),i.assign("month",r.getMonth()+1),i.assign("year",r.getFullYear()),i.imply("weekday",r.getDay())):(i.imply("day",r.getDate()),e.month?(i.assign("month",r.getMonth()+1),i.assign("year",r.getFullYear())):(i.imply("month",r.getMonth()+1),e.year?i.assign("year",r.getFullYear()):i.imply("year",r.getFullYear())))),i}},Ts=class s{constructor(t,e,r,i,n){P(this,"refDate");P(this,"index");P(this,"text");P(this,"reference");P(this,"start");P(this,"end");this.reference=t,this.refDate=t.instant,this.index=e,this.text=r,this.start=i||new xe(t),this.end=n}clone(){let t=new s(this.reference,this.index,this.text);return t.start=this.start?this.start.clone():null,t.end=this.end?this.end.clone():null,t}date(){return this.start.date()}addTag(t){return this.start.addTag(t),this.end&&this.end.addTag(t),this}addTags(t){return this.start.addTags(t),this.end&&this.end.addTags(t),this}tags(){let t=new Set(this.start.tags());if(this.end)for(let e of this.end.tags())t.add(e);return t}toString(){let t=Array.from(this.tags()).sort();return`[ParsingResult {index: ${this.index}, text: '${this.text}', tags: ${JSON.stringify(t)} ...}]`}}});function hy(s,t,e="\\s{0,5},?\\s{0,5}"){let r=t.replace(/\((?!\?)/g,"(?:");return`${s}${r}(?:${e}${r}){0,10}`}function LF(s){let t;return s instanceof Array?t=[...s]:s instanceof Map?t=Array.from(s.keys()):t=Object.keys(s),t}function $t(s){return`(?:${LF(s).sort((e,r)=>r.length-e.length).join("|").replace(/\./g,"\\.")})`}var nn=v(()=>{});function wh(s){return s<100&&(s>50?s=s+1900:s=s+2e3),s}function an(s,t,e){let r=(0,_x.default)(s),i=r;i=i.month(e-1),i=i.date(t),i=i.year(r.year());let n=i.add(1,"y"),a=i.add(-1,"y");return Math.abs(n.diff(r))<Math.abs(i.diff(r))?i=n:Math.abs(a.diff(r))<Math.abs(i.diff(r))&&(i=a),i.year()}var _x,bo=v(()=>{_x=bt(tn(),1)});function HF(s){let t=s.toLowerCase();return py[t]!==void 0?py[t]:t==="a"||t==="an"||t=="the"?1:t.match(/few/)?3:t.match(/half/)?.5:t.match(/couple/)?2:t.match(/several/)?7:parseFloat(t)}function So(s){let t=s.toLowerCase();return fy[t]!==void 0?fy[t]:(t=t.replace(/(?:st|nd|rd|th)$/i,""),parseInt(t))}function ln(s){if(/BE/i.test(s))return s=s.replace(/BE/i,""),parseInt(s)-543;if(/BCE?/i.test(s))return s=s.replace(/BCE?/i,""),-parseInt(s);if(/(AD|CE)/i.test(s))return s=s.replace(/(AD|CE)/i,""),parseInt(s);let t=parseInt(s);return wh(t)}function ei(s){let t={},e=s,r=Ax.exec(e);for(;r;)UF(t,r),e=e.substring(r[0].length).trim(),r=Ax.exec(e);return Object.keys(t).length==0?null:t}function UF(s,t){if(t[0].match(/^[a-zA-Z]+$/))return;let e=HF(t[1]),r=mc[t[2].toLowerCase()];s[r]=e}var Th,my,Xr,py,fy,Ix,mc,Px,ko,on,Nx,Ax,BF,Rx,bs,cn,Ct=v(()=>{nn();bo();Th={sunday:0,sun:0,"sun.":0,monday:1,mon:1,"mon.":1,tuesday:2,tue:2,"tue.":2,wednesday:3,wed:3,"wed.":3,thursday:4,thurs:4,"thurs.":4,thur:4,"thur.":4,thu:4,"thu.":4,friday:5,fri:5,"fri.":5,saturday:6,sat:6,"sat.":6},my={january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12},Xr={...my,jan:1,"jan.":1,feb:2,"feb.":2,mar:3,"mar.":3,apr:4,"apr.":4,jun:6,"jun.":6,jul:7,"jul.":7,aug:8,"aug.":8,sep:9,"sep.":9,sept:9,"sept.":9,oct:10,"oct.":10,nov:11,"nov.":11,dec:12,"dec.":12},py={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12},fy={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,twentieth:20,"twenty first":21,"twenty-first":21,"twenty second":22,"twenty-second":22,"twenty third":23,"twenty-third":23,"twenty fourth":24,"twenty-fourth":24,"twenty fifth":25,"twenty-fifth":25,"twenty sixth":26,"twenty-sixth":26,"twenty seventh":27,"twenty-seventh":27,"twenty eighth":28,"twenty-eighth":28,"twenty ninth":29,"twenty-ninth":29,thirtieth:30,"thirty first":31,"thirty-first":31},Ix={second:"second",seconds:"second",minute:"minute",minutes:"minute",hour:"hour",hours:"hour",day:"d",days:"d",week:"week",weeks:"week",month:"month",months:"month",quarter:"quarter",quarters:"quarter",year:"year",years:"year"},mc={s:"second",sec:"second",second:"second",seconds:"second",m:"minute",min:"minute",mins:"minute",minute:"minute",minutes:"minute",h:"hour",hr:"hour",hrs:"hour",hour:"hour",hours:"hour",d:"d",day:"d",days:"d",w:"w",week:"week",weeks:"week",mo:"month",mon:"month",mos:"month",month:"month",months:"month",qtr:"quarter",quarter:"quarter",quarters:"quarter",y:"year",yr:"year",year:"year",years:"year",...Ix},Px=`(?:${$t(py)}|[0-9]+|[0-9]+\\.[0-9]+|half(?:\\s{0,2}an?)?|an?\\b(?:\\s{0,2}few)?|few|several|the|a?\\s{0,2}couple\\s{0,2}(?:of)?)`;ko=`(?:${$t(fy)}|[0-9]{1,2}(?:st|nd|rd|th)?)`;on="(?:[1-9][0-9]{0,3}\\s{0,2}(?:BE|AD|BC|BCE|CE)|[1-2][0-9]{3}|[5-9][0-9]|2[0-5])";Nx=`(${Px})\\s{0,3}(${$t(mc)})`,Ax=new RegExp(Nx,"i"),BF=`(${Px})\\s{0,3}(${$t(Ix)})`,Rx="\\s{0,5},?(?:\\s*and)?\\s{0,5}",bs=hy("(?:(?:about|around)\\s{0,3})?",Nx,Rx),cn=hy("(?:(?:about|around)\\s{0,3})?",BF,Rx)});var We,lr=v(()=>{We=class{constructor(){P(this,"cachedInnerPattern",null);P(this,"cachedPattern",null)}innerPatternHasChange(t,e){return this.innerPattern(t)!==e}patternLeftBoundary(){return"(\\W|^)"}pattern(t){return this.cachedInnerPattern&&!this.innerPatternHasChange(t,this.cachedInnerPattern)?this.cachedPattern:(this.cachedInnerPattern=this.innerPattern(t),this.cachedPattern=new RegExp(`${this.patternLeftBoundary()}${this.cachedInnerPattern.source}`,this.cachedInnerPattern.flags),this.cachedPattern)}extract(t,e){var i;let r=(i=e[1])!=null?i:"";e.index=e.index+r.length,e[0]=e[0].substring(r.length);for(let n=2;n<e.length;n++)e[n-1]=e[n];return this.innerExtract(t,e)}}});var $F,VF,WF,gc,Ox=v(()=>{Ct();Ti();lr();$F=new RegExp(`(?:(?:within|in|for)\\s*)?(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${bs})(?=\\W|$)`,"i"),VF=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${bs})(?=\\W|$)`,"i"),WF=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${cn})(?=\\W|$)`,"i"),gc=class extends We{constructor(e){super();P(this,"strictMode");this.strictMode=e}innerPattern(e){return this.strictMode?WF:e.option.forwardDate?$F:VF}innerExtract(e,r){if(r[0].match(/^for\s*the\s*\w+/))return null;let i=ei(r[1]);return i?(e.debug(()=>{console.log(i),console.log(xe.createRelativeFromReference(e.reference,i))}),xe.createRelativeFromReference(e.reference,i)):null}}});var YF,Fx,Lx,jF,Hx,yc,Bx=v(()=>{bo();Ct();Ct();Ct();nn();lr();YF=new RegExp(`(?:on\\s{0,3})?(${ko})(?:\\s{0,3}(?:to|\\-|\\\u2013|until|through|till)?\\s{0,3}(${ko}))?(?:-|/|\\s{0,3}(?:of)?\\s{0,3})(${$t(Xr)})(?:(?:-|/|,?\\s{0,3})(${on}(?!\\w)))?(?=\\W|$)`,"i"),Fx=1,Lx=2,jF=3,Hx=4,yc=class extends We{innerPattern(){return YF}innerExtract(t,e){let r=t.createParsingResult(e.index,e[0]),i=Xr[e[jF].toLowerCase()],n=So(e[Fx]);if(n>31)return e.index=e.index+e[Fx].length,null;if(r.start.assign("month",i),r.start.assign("day",n),e[Hx]){let a=ln(e[Hx]);r.start.assign("year",a)}else{let a=an(t.refDate,n,i);r.start.imply("year",a)}if(e[Lx]){let a=So(e[Lx]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var zF,qF,Ux,gy,yy,vc,$x=v(()=>{bo();Ct();Ct();Ct();nn();lr();zF=new RegExp(`(${$t(Xr)})(?:-|/|\\s*,?\\s*)(${ko})(?!\\s*(?:am|pm))\\s*(?:(?:to|\\-)\\s*(${ko})\\s*)?(?:(?:-|/|\\s*,\\s*|\\s+)(${on}))?(?=\\W|$)(?!\\:\\d)`,"i"),qF=1,Ux=2,gy=3,yy=4,vc=class extends We{constructor(e){super();P(this,"shouldSkipYearLikeDate");this.shouldSkipYearLikeDate=e}innerPattern(){return zF}innerExtract(e,r){let i=Xr[r[qF].toLowerCase()],n=So(r[Ux]);if(n>31||this.shouldSkipYearLikeDate&&!r[gy]&&!r[yy]&&r[Ux].match(/^2[0-5]$/))return null;let a=e.createParsingComponents({day:n,month:i}).addTag("parser/ENMonthNameMiddleEndianParser");if(r[yy]){let c=ln(r[yy]);a.assign("year",c)}else{let c=an(e.refDate,n,i);a.imply("year",c)}if(!r[gy])return a;let o=So(r[gy]),l=e.createParsingResult(r.index,r[0]);return l.start=a,l.end=a.clone(),l.end.assign("day",o),l}}});var GF,QF,KF,Vx,wc,Wx=v(()=>{Ct();bo();nn();Ct();lr();GF=new RegExp(`((?:in)\\s*)?(${$t(Xr)})\\s*(?:(?:,|-|of)?\\s*(${on})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`,"i"),QF=1,KF=2,Vx=3,wc=class extends We{innerPattern(){return GF}innerExtract(t,e){let r=e[KF].toLowerCase();if(e[0].length<=3&&!my[r])return null;let i=t.createParsingResult(e.index+(e[QF]||"").length,e.index+e[0].length);i.start.imply("day",1),i.start.addTag("parser/ENMonthNameParser");let n=Xr[r];if(i.start.assign("month",n),e[Vx]){let a=ln(e[Vx]);i.start.assign("year",a)}else{let a=an(t.refDate,1,n);i.start.imply("year",a)}return i}}});var ZF,JF,XF,Yx,eL,Tc,jx=v(()=>{Ct();nn();lr();ZF=new RegExp(`([0-9]{4})[-\\.\\/\\s](?:(${$t(Xr)})|([0-9]{1,2}))[-\\.\\/\\s]([0-9]{1,2})(?=\\W|$)`,"i"),JF=1,XF=2,Yx=3,eL=4,Tc=class extends We{constructor(e){super();P(this,"strictMonthDateOrder");this.strictMonthDateOrder=e}innerPattern(){return ZF}innerExtract(e,r){let i=parseInt(r[JF]),n=parseInt(r[eL]),a=r[Yx]?parseInt(r[Yx]):Xr[r[XF].toLowerCase()];if(a<1||a>12){if(this.strictMonthDateOrder)return null;n>=1&&n<=12&&([a,n]=[n,a])}return n<1||n>31?null:{day:n,month:a,year:i}}}});var tL,rL,iL,bc,zx=v(()=>{lr();tL=new RegExp("([0-9]|0[1-9]|1[012])/([0-9]{4})","i"),rL=1,iL=2,bc=class extends We{innerPattern(){return tL}innerExtract(t,e){let r=parseInt(e[iL]),i=parseInt(e[rL]);return t.createParsingComponents().imply("day",1).assign("month",i).assign("year",r)}}});function sL(s,t,e,r){return new RegExp(`${s}${t}(\\d{1,4})(?:(?:\\.|:|\uFF1A)(\\d{1,2})(?:(?::|\uFF1A)(\\d{2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${e}`,r)}function nL(s,t){return new RegExp(`^(${s})(\\d{1,4})(?:(?:\\.|\\:|\\\uFF1A)(\\d{1,2})(?:(?:\\.|\\:|\\\uFF1A)(\\d{1,2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${t}`,"i")}var qx,Eo,bh,kh,kc,Sh,Gx=v(()=>{$i();qx=2,Eo=3,bh=4,kh=5,kc=6,Sh=class{constructor(t=!1){P(this,"strictMode");P(this,"cachedPrimaryPrefix",null);P(this,"cachedPrimarySuffix",null);P(this,"cachedPrimaryTimePattern",null);P(this,"cachedFollowingPhase",null);P(this,"cachedFollowingSuffix",null);P(this,"cachedFollowingTimePatten",null);this.strictMode=t}patternFlags(){return"i"}primaryPatternLeftBoundary(){return"(^|\\s|T|\\b)"}primarySuffix(){return"(?!/)(?=\\W|$)"}followingSuffix(){return"(?!/)(?=\\W|$)"}pattern(t){return this.getPrimaryTimePatternThroughCache()}extract(t,e){let r=this.extractPrimaryTimeComponents(t,e);if(!r)return e[0].match(/^\d{4}/)?(e.index+=4,null):(e.index+=e[0].length,null);let i=e.index+e[1].length,n=e[0].substring(e[1].length),a=t.createParsingResult(i,n,r);e.index+=e[0].length;let o=t.text.substring(e.index),c=this.getFollowingTimePatternThroughCache().exec(o);return n.match(/^\d{3,4}/)&&c&&(c[0].match(/^\s*([+-])\s*\d{2,4}$/)||c[0].match(/^\s*([+-])\s*\d{2}\W\d{2}/))?null:!c||c[0].match(/^\s*([+-])\s*\d{3,4}$/)?this.checkAndReturnWithoutFollowingPattern(a):(a.end=this.extractFollowingTimeComponents(t,c,a),a.end&&(a.text+=c[0]),this.checkAndReturnWithFollowingPattern(a))}extractPrimaryTimeComponents(t,e,r=!1){let i=t.createParsingComponents(),n=0,a=null,o=parseInt(e[qx]);if(o>100){if(this.strictMode||e[Eo]!=null)return null;n=o%100,o=Math.floor(o/100)}if(o>24)return null;if(e[Eo]!=null){if(e[Eo].length==1&&!e[kc])return null;n=parseInt(e[Eo])}if(n>=60)return null;if(o>12&&(a=ge.PM),e[kc]!=null){if(o>12)return null;let l=e[kc][0].toLowerCase();l=="a"&&(a=ge.AM,o==12&&(o=0)),l=="p"&&(a=ge.PM,o!=12&&(o+=12))}if(i.assign("hour",o),i.assign("minute",n),a!==null?i.assign("meridiem",a):o<12?i.imply("meridiem",ge.AM):i.imply("meridiem",ge.PM),e[kh]!=null){let l=parseInt(e[kh].substring(0,3));if(l>=1e3)return null;i.assign("millisecond",l)}if(e[bh]!=null){let l=parseInt(e[bh]);if(l>=60)return null;i.assign("second",l)}return i}extractFollowingTimeComponents(t,e,r){let i=t.createParsingComponents();if(e[kh]!=null){let l=parseInt(e[kh].substring(0,3));if(l>=1e3)return null;i.assign("millisecond",l)}if(e[bh]!=null){let l=parseInt(e[bh]);if(l>=60)return null;i.assign("second",l)}let n=parseInt(e[qx]),a=0,o=-1;if(e[Eo]!=null?a=parseInt(e[Eo]):n>100&&(a=n%100,n=Math.floor(n/100)),a>=60||n>24)return null;if(n>=12&&(o=ge.PM),e[kc]!=null){if(n>12)return null;let l=e[kc][0].toLowerCase();l=="a"&&(o=ge.AM,n==12&&(n=0,i.isCertain("day")||i.imply("day",i.get("day")+1))),l=="p"&&(o=ge.PM,n!=12&&(n+=12)),r.start.isCertain("meridiem")||(o==ge.AM?(r.start.imply("meridiem",ge.AM),r.start.get("hour")==12&&r.start.assign("hour",0)):(r.start.imply("meridiem",ge.PM),r.start.get("hour")!=12&&r.start.assign("hour",r.start.get("hour")+12)))}return i.assign("hour",n),i.assign("minute",a),o>=0?i.assign("meridiem",o):r.start.isCertain("meridiem")&&r.start.get("hour")>12?r.start.get("hour")-12>n?i.imply("meridiem",ge.AM):n<=12&&(i.assign("hour",n+12),i.assign("meridiem",ge.PM)):n>12?i.imply("meridiem",ge.PM):n<=12&&i.imply("meridiem",ge.AM),i.date().getTime()<r.start.date().getTime()&&i.imply("day",i.get("day")+1),i}checkAndReturnWithoutFollowingPattern(t){if(t.text.match(/^\d$/)||t.text.match(/^\d\d\d+$/)||t.text.match(/\d[apAP]$/))return null;let e=t.text.match(/[^\d:.](\d[\d.]+)$/);if(e){let r=e[1];if(this.strictMode||r.includes(".")&&!r.match(/\d(\.\d{2})+$/)||parseInt(r)>24)return null}return t}checkAndReturnWithFollowingPattern(t){if(t.text.match(/^\d+-\d+$/))return null;let e=t.text.match(/[^\d:.](\d[\d.]+)\s*-\s*(\d[\d.]+)$/);if(e){if(this.strictMode)return null;let r=e[1],i=e[2];if(i.includes(".")&&!i.match(/\d(\.\d{2})+$/))return null;let n=parseInt(i),a=parseInt(r);if(n>24||a>24)return null}return t}getPrimaryTimePatternThroughCache(){let t=this.primaryPrefix(),e=this.primarySuffix();return this.cachedPrimaryPrefix===t&&this.cachedPrimarySuffix===e?this.cachedPrimaryTimePattern:(this.cachedPrimaryTimePattern=sL(this.primaryPatternLeftBoundary(),t,e,this.patternFlags()),this.cachedPrimaryPrefix=t,this.cachedPrimarySuffix=e,this.cachedPrimaryTimePattern)}getFollowingTimePatternThroughCache(){let t=this.followingPhase(),e=this.followingSuffix();return this.cachedFollowingPhase===t&&this.cachedFollowingSuffix===e?this.cachedFollowingTimePatten:(this.cachedFollowingTimePatten=nL(t,e),this.cachedFollowingPhase=t,this.cachedFollowingSuffix=e,this.cachedFollowingTimePatten)}}});var Sc,Qx=v(()=>{$i();Gx();Sc=class extends Sh{constructor(t){super(t)}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|to|until|through|till|\\?)\\s*"}primaryPrefix(){return"(?:(?:at|from)\\s*)??"}primarySuffix(){return"(?:\\s*(?:o\\W*clock|at\\s*night|in\\s*the\\s*(?:morning|afternoon)))?(?!/)(?=\\W|$)"}extractPrimaryTimeComponents(t,e){let r=super.extractPrimaryTimeComponents(t,e);if(!r)return r;if(e[0].endsWith("night")){let i=r.get("hour");i>=6&&i<12?(r.assign("hour",r.get("hour")+12),r.assign("meridiem",ge.PM)):i<6&&r.assign("meridiem",ge.AM)}if(e[0].endsWith("afternoon")){r.assign("meridiem",ge.PM);let i=r.get("hour");i>=0&&i<=6&&r.assign("hour",r.get("hour")+12)}return e[0].endsWith("morning")&&(r.assign("meridiem",ge.AM),r.get("hour")<12&&r.assign("hour",r.get("hour"))),r.addTag("parser/ENTimeExpressionParser")}extractFollowingTimeComponents(t,e,r){let i=super.extractFollowingTimeComponents(t,e,r);return i&&i.addTag("parser/ENTimeExpressionParser"),i}}});var aL,oL,Ec,Kx=v(()=>{Ct();Ti();lr();fc();aL=new RegExp(`(${bs})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),oL=new RegExp(`(${cn})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),Ec=class extends We{constructor(e){super();P(this,"strictMode");this.strictMode=e}innerPattern(){return this.strictMode?oL:aL}innerExtract(e,r){let i=ei(r[1]);return i?xe.createRelativeFromReference(e.reference,To(i)):null}}});var lL,cL,dL,Dc,Zx=v(()=>{Ct();Ti();lr();lL=new RegExp(`(${bs})\\s{0,5}(?:later|after|from now|henceforth|forward|out)(?=(?:\\W|$))`,"i"),cL=new RegExp(`(${cn})\\s{0,5}(later|after|from now)(?=\\W|$)`,"i"),dL=1,Dc=class extends We{constructor(e){super();P(this,"strictMode");this.strictMode=e}innerPattern(){return this.strictMode?cL:lL}innerExtract(e,r){let i=ei(r[dL]);return i?xe.createRelativeFromReference(e.reference,i):null}}});var Do,ti,dn=v(()=>{Do=class{refine(t,e){return e.filter(r=>this.isValid(t,r))}},ti=class{refine(t,e){if(e.length<2)return e;let r=[],i=e[0],n=null;for(let a=1;a<e.length;a++){n=e[a];let o=t.text.substring(i.index+i.text.length,n.index);if(!this.shouldMergeResults(o,i,n,t))r.push(i),i=n;else{let l=i,c=n,d=this.mergeResults(o,l,c,t);t.debug(()=>{console.log(`${this.constructor.name} merged ${l} and ${c} into ${d}`)}),i=d}}return i!=null&&r.push(i),r}}});var Cc,Jx=v(()=>{dn();Cc=class extends ti{shouldMergeResults(t,e,r){return!e.end&&!r.end&&t.match(this.patternBetween())!=null}mergeResults(t,e,r){if(!e.start.isOnlyWeekdayComponent()&&!r.start.isOnlyWeekdayComponent()&&(r.start.getCertainComponents().forEach(n=>{e.start.isCertain(n)||e.start.imply(n,r.start.get(n))}),e.start.getCertainComponents().forEach(n=>{r.start.isCertain(n)||r.start.imply(n,e.start.get(n))})),e.start.date().getTime()>r.start.date().getTime()){let n=e.start.dayjs(),a=r.start.dayjs();r.start.isOnlyWeekdayComponent()&&a.add(7,"days").isAfter(n)?(a=a.add(7,"days"),r.start.imply("day",a.date()),r.start.imply("month",a.month()+1),r.start.imply("year",a.year())):e.start.isOnlyWeekdayComponent()&&n.add(-7,"days").isBefore(a)?(n=n.add(-7,"days"),e.start.imply("day",n.date()),e.start.imply("month",n.month()+1),e.start.imply("year",n.year())):r.start.isDateWithUnknownYear()&&a.add(1,"years").isAfter(n)?(a=a.add(1,"years"),r.start.imply("year",a.year())):e.start.isDateWithUnknownYear()&&n.add(-1,"years").isBefore(a)?(n=n.add(-1,"years"),e.start.imply("year",n.year())):[r,e]=[e,r]}let i=e.clone();return i.start=e.start,i.end=r.start,i.index=Math.min(e.index,r.index),e.index<r.index?i.text=e.text+t+r.text:i.text=r.text+t+e.text,i}}});var xc,Xx=v(()=>{Jx();xc=class extends Cc{patternBetween(){return/^\s*(to|-||until|through|till)\s*$/i}}});function e0(s,t){t=t.add(1,"day"),vy(s,t),Eh(s,t)}function ks(s,t){s.assign("day",t.date()),s.assign("month",t.month()+1),s.assign("year",t.year())}function t0(s,t){s.assign("hour",t.hour()),s.assign("minute",t.minute()),s.assign("second",t.second()),s.assign("millisecond",t.millisecond()),s.get("hour")<12?s.assign("meridiem",ge.AM):s.assign("meridiem",ge.PM)}function vy(s,t){s.imply("day",t.date()),s.imply("month",t.month()+1),s.imply("year",t.year())}function Eh(s,t){s.imply("hour",t.hour()),s.imply("minute",t.minute()),s.imply("second",t.second()),s.imply("millisecond",t.millisecond())}var Dh=v(()=>{$i()});function wy(s,t){let e=s.clone(),r=s.start,i=t.start;if(e.start=r0(r,i),s.end!=null||t.end!=null){let n=s.end==null?s.start:s.end,a=t.end==null?t.start:t.end,o=r0(n,a);if(s.end==null&&o.date().getTime()<e.start.date().getTime()){let l=o.dayjs().add(1,"day");o.isCertain("day")?ks(o,l):vy(o,l)}e.end=o}return e}function r0(s,t){let e=s.clone();return t.isCertain("hour")?(e.assign("hour",t.get("hour")),e.assign("minute",t.get("minute")),t.isCertain("second")?(e.assign("second",t.get("second")),t.isCertain("millisecond")?e.assign("millisecond",t.get("millisecond")):e.imply("millisecond",t.get("millisecond"))):(e.imply("second",t.get("second")),e.imply("millisecond",t.get("millisecond")))):(e.imply("hour",t.get("hour")),e.imply("minute",t.get("minute")),e.imply("second",t.get("second")),e.imply("millisecond",t.get("millisecond"))),t.isCertain("timezoneOffset")&&e.assign("timezoneOffset",t.get("timezoneOffset")),t.isCertain("meridiem")?e.assign("meridiem",t.get("meridiem")):t.get("meridiem")!=null&&e.get("meridiem")==null&&e.imply("meridiem",t.get("meridiem")),e.get("meridiem")==ge.PM&&e.get("hour")<12&&(t.isCertain("hour")?e.assign("hour",e.get("hour")+12):e.imply("hour",e.get("hour")+12)),e.addTags(s.tags()),e.addTags(t.tags()),e}var i0=v(()=>{$i();Dh()});var Mc,s0=v(()=>{dn();i0();Mc=class extends ti{shouldMergeResults(t,e,r){return(e.start.isOnlyDate()&&r.start.isOnlyTime()||r.start.isOnlyDate()&&e.start.isOnlyTime())&&t.match(this.patternBetween())!=null}mergeResults(t,e,r){let i=e.start.isOnlyDate()?wy(e,r):wy(r,e);return i.index=e.index,i.text=e.text+t+r.text,i}}});var Co,n0=v(()=>{s0();Co=class extends Mc{patternBetween(){return new RegExp("^\\s*(T|at|after|before|on|of|,|-|\\.|\u2219|:)?\\s*$")}}});var uL,_c,a0=v(()=>{dy();uL=new RegExp("^\\s*,?\\s*\\(?([A-Z]{2,4})\\)?(?=\\W|$)","i"),_c=class{constructor(t){P(this,"timezoneOverrides");this.timezoneOverrides=t}refine(t,e){var i;let r=(i=t.option.timezones)!=null?i:{};return e.forEach(n=>{var p,f;let a=t.text.substring(n.index+n.text.length),o=uL.exec(a);if(!o)return;let l=o[1].toUpperCase(),c=(f=(p=n.start.date())!=null?p:n.refDate)!=null?f:new Date,d={...this.timezoneOverrides,...r},u=vh(l,c,d);if(u==null)return;t.debug(()=>{console.log(`Extracting timezone: '${l}' into: ${u} for: ${n.start}`)});let h=n.start.get("timezoneOffset");h!==null&&u!=h&&(n.start.isCertain("timezoneOffset")||l!=o[1])||n.start.isOnlyDate()&&l!=o[1]||(n.text+=o[0],n.start.isCertain("timezoneOffset")||n.start.assign("timezoneOffset",u),n.end!=null&&!n.end.isCertain("timezoneOffset")&&n.end.assign("timezoneOffset",u))}),e}}});var hL,pL,fL,mL,Ac,o0=v(()=>{hL=new RegExp("^\\s*(?:\\(?(?:GMT|UTC)\\s?)?([+-])(\\d{1,2})(?::?(\\d{2}))?\\)?","i"),pL=1,fL=2,mL=3,Ac=class{refine(t,e){return e.forEach(function(r){if(r.start.isCertain("timezoneOffset"))return;let i=t.text.substring(r.index+r.text.length),n=hL.exec(i);if(!n)return;t.debug(()=>{console.log(`Extracting timezone: '${n[0]}' into : ${r}`)});let a=parseInt(n[fL]),o=parseInt(n[mL]||"0"),l=a*60+o;l>840||(n[pL]==="-"&&(l=-l),r.end!=null&&r.end.assign("timezoneOffset",l),r.start.assign("timezoneOffset",l),r.text+=n[0])}),e}}});var un,Ty=v(()=>{un=class{refine(t,e){if(e.length<2)return e;let r=[],i=e[0];for(let n=1;n<e.length;n++){let a=e[n];if(a.index>=i.index+i.text.length){r.push(i),i=a;continue}let o=null,l=null;a.text.length>i.text.length?(o=a,l=i):(o=i,l=a),t.debug(()=>{console.log(`${this.constructor.name} remove ${l} by ${o}`)}),i=o}return i!=null&&r.push(i),r}}});var l0,Ic,c0=v(()=>{l0=bt(tn(),1);ly();Ic=class{refine(t,e){return t.option.forwardDate&&e.forEach(r=>{let i=(0,l0.default)(t.reference.getDateWithAdjustedTimezone());if(r.start.isOnlyTime()&&t.reference.instant>r.start.date()){let n=t.reference.getDateWithAdjustedTimezone(),a=new Date(n);a.setDate(a.getDate()+1),yh(r.start,a),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} time from the ref date (${n}) to the following day (${a})`)}),r.end&&r.end.isOnlyTime()&&(yh(r.end,a),r.start.date()>r.end.date()&&(a.setDate(a.getDate()+1),yh(r.end,a)))}if(r.start.isOnlyWeekdayComponent()&&i.isAfter(r.start.dayjs())&&(i.day()>=r.start.get("weekday")?i=i.day(r.start.get("weekday")+7):i=i.day(r.start.get("weekday")),r.start.imply("day",i.date()),r.start.imply("month",i.month()+1),r.start.imply("year",i.year()),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} weekday (${r.start})`)}),r.end&&r.end.isOnlyWeekdayComponent()&&(i.day()>r.end.get("weekday")?i=i.day(r.end.get("weekday")+7):i=i.day(r.end.get("weekday")),r.end.imply("day",i.date()),r.end.imply("month",i.month()+1),r.end.imply("year",i.year()),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} weekday (${r.end})`)}))),r.start.isDateWithUnknownYear()&&i.isAfter(r.start.dayjs()))for(let n=0;n<3&&i.isAfter(r.start.dayjs());n++)r.start.imply("year",r.start.get("year")+1),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} year (${r.start})`)}),r.end&&!r.end.isCertain("year")&&(r.end.imply("year",r.end.get("year")+1),t.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} month (${r.start})`)}))}),e}}});var Pc,d0=v(()=>{dn();Pc=class extends Do{constructor(e){super();P(this,"strictMode");this.strictMode=e}isValid(e,r){return r.text.replace(" ","").match(/^\d*(\.\d*)?$/)?(e.debug(()=>{console.log(`Removing unlikely result '${r.text}'`)}),!1):r.start.isValidDate()?r.end&&!r.end.isValidDate()?(e.debug(()=>{console.log(`Removing invalid result: ${r} (${r.end})`)}),!1):this.strictMode?this.isStrictModeValid(e,r):!0:(e.debug(()=>{console.log(`Removing invalid result: ${r} (${r.start})`)}),!1)}isStrictModeValid(e,r){return r.start.isOnlyWeekdayComponent()?(e.debug(()=>{console.log(`(Strict) Removing weekday only component: ${r} (${r.end})`)}),!1):!0}}});var gL,yL,vL,wL,u0,TL,h0,p0,bL,f0,m0,Nc,g0=v(()=>{lr();gL=new RegExp("([0-9]{4})\\-([0-9]{1,2})\\-([0-9]{1,2})(?:T([0-9]{1,2}):([0-9]{1,2})(?::([0-9]{1,2})(?:\\.(\\d{1,4}))?)?(Z|([+-]\\d{2}):?(\\d{2})?)?)?(?=\\W|$)","i"),yL=1,vL=2,wL=3,u0=4,TL=5,h0=6,p0=7,bL=8,f0=9,m0=10,Nc=class extends We{innerPattern(){return gL}innerExtract(t,e){let r=t.createParsingComponents({year:parseInt(e[yL]),month:parseInt(e[vL]),day:parseInt(e[wL])});if(e[u0]!=null&&(r.assign("hour",parseInt(e[u0])),r.assign("minute",parseInt(e[TL])),e[h0]!=null&&r.assign("second",parseInt(e[h0])),e[p0]!=null&&r.assign("millisecond",parseInt(e[p0])),e[bL]!=null)){let i=0;if(e[f0]){let n=parseInt(e[f0]),a=0;e[m0]!=null&&(a=parseInt(e[m0])),i=n*60,i<0?i-=a:i+=a}r.assign("timezoneOffset",i)}return r.addTag("parser/ISOFormatParser")}}});var Rc,y0=v(()=>{dn();Rc=class extends ti{mergeResults(t,e,r){let i=r.clone();return i.index=e.index,i.text=e.text+t+i.text,i.start.assign("weekday",e.start.get("weekday")),i.end&&i.end.assign("weekday",e.start.get("weekday")),i}shouldMergeResults(t,e,r){return e.start.isOnlyWeekdayComponent()&&!e.start.isCertain("hour")&&r.start.isCertain("day")&&t.match(/^,?\s*$/)!=null}}});function v0(s,t=!1){return s.parsers.unshift(new Nc),s.refiners.unshift(new Rc),s.refiners.unshift(new Ac),s.refiners.unshift(new un),s.refiners.push(new _c),s.refiners.push(new un),s.refiners.push(new Ic),s.refiners.push(new Pc(t)),s}var w0=v(()=>{a0();o0();Ty();c0();d0();g0();y0()});function T0(s){let t=(0,xo.default)(s.getDateWithAdjustedTimezone()),e=new xe(s,{});return ks(e,t),t0(e,t),e.assign("timezoneOffset",s.getTimezoneOffset()),e.addTag("casualReference/now"),e}function b0(s){let t=(0,xo.default)(s.getDateWithAdjustedTimezone()),e=new xe(s,{});return ks(e,t),Eh(e,t),e.addTag("casualReference/today"),e}function k0(s){return kL(s,1).addTag("casualReference/yesterday")}function kL(s,t){return Ch(s,-t)}function S0(s){return Ch(s,1).addTag("casualReference/tomorrow")}function Ch(s,t){let e=(0,xo.default)(s.getDateWithAdjustedTimezone()),r=new xe(s,{});return e=e.add(t,"day"),ks(r,e),Eh(r,e),r}function E0(s,t=22){let e=(0,xo.default)(s.getDateWithAdjustedTimezone()),r=new xe(s,{});return ks(r,e),r.imply("hour",t),r.imply("meridiem",ge.PM),r.addTag("casualReference/tonight"),r}function D0(s,t=20){let e=new xe(s,{});return e.imply("meridiem",ge.PM),e.imply("hour",t),e.addTag("casualReference/evening"),e}function C0(s){let t=new xe(s,{}),e=(0,xo.default)(s.getDateWithAdjustedTimezone());return e.hour()>2&&e0(t,e),t.assign("hour",0),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/midnight"),t}function x0(s,t=6){let e=new xe(s,{});return e.imply("meridiem",ge.AM),e.imply("hour",t),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/morning"),e}function M0(s,t=15){let e=new xe(s,{});return e.imply("meridiem",ge.PM),e.imply("hour",t),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/afternoon"),e}function _0(s){let t=new xe(s,{});return t.imply("meridiem",ge.AM),t.assign("hour",12),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/noon"),t}var xo,by=v(()=>{Ti();xo=bt(tn(),1);Dh();$i()});var I0,SL,Oc,P0=v(()=>{I0=bt(tn(),1);lr();Dh();by();SL=/(now|today|tonight|tomorrow|overmorrow|tmr|tmrw|yesterday|last\s*night)(?=\W|$)/i,Oc=class extends We{innerPattern(t){return SL}innerExtract(t,e){let r=(0,I0.default)(t.refDate),i=e[0].toLowerCase(),n=t.createParsingComponents();switch(i){case"now":n=T0(t.reference);break;case"today":n=b0(t.reference);break;case"yesterday":n=k0(t.reference);break;case"tomorrow":case"tmr":case"tmrw":n=S0(t.reference);break;case"tonight":n=E0(t.reference);break;case"overmorrow":n=Ch(t.reference,2);break;default:i.match(/last\s*night/)&&(r.hour()>6&&(r=r.add(-1,"day")),ks(n,r),n.imply("hour",0));break}return n.addTag("parser/ENCasualDateParser"),n}}});var EL,Fc,N0=v(()=>{lr();by();EL=/(?:this)?\s{0,3}(morning|afternoon|evening|night|midnight|midday|noon)(?=\W|$)/i,Fc=class extends We{innerPattern(){return EL}innerExtract(t,e){let r=null;switch(e[1].toLowerCase()){case"afternoon":r=M0(t.reference);break;case"evening":case"night":r=D0(t.reference);break;case"midnight":r=C0(t.reference);break;case"morning":r=x0(t.reference);break;case"noon":case"midday":r=_0(t.reference);break}return r&&r.addTag("parser/ENCasualTimeParser"),r}}});function R0(s){let t={};for(let e in s)t[e]=-s[e];return t}function O0(s,t){let e=s.clone(),r=s.dayjs();for(let i in t)r=r.add(t[i],i);return("day"in t||"d"in t||"week"in t||"month"in t||"year"in t)&&(e.imply("day",r.date()),e.imply("month",r.month()+1),e.imply("year",r.year())),("second"in t||"minute"in t||"hour"in t)&&(e.imply("second",r.second()),e.imply("minute",r.minute()),e.imply("hour",r.hour())),e}var ky=v(()=>{});function F0(s,t,e){let r=s.getDateWithAdjustedTimezone(),i=DL(r,t,e),n=new xe(s);return n=O0(n,{day:i}),n.assign("weekday",t),n}function DL(s,t,e){let r=s.getDay();switch(e){case"this":return xh(s,t);case"last":return L0(s,t);case"next":return r==qe.SUNDAY?t==qe.SUNDAY?7:t:r==qe.SATURDAY?t==qe.SATURDAY?7:t==qe.SUNDAY?8:1+t:t<r&&t!=qe.SUNDAY?xh(s,t):xh(s,t)+7}return CL(s,t)}function CL(s,t){let e=L0(s,t),r=xh(s,t);return r<-e?r:e}function xh(s,t){let e=s.getDay(),r=t-e;return r<0&&(r+=7),r}function L0(s,t){let e=s.getDay(),r=t-e;return r>=0&&(r-=7),r}var H0=v(()=>{$i();Ti();ky()});var xL,ML,_L,AL,Lc,B0=v(()=>{Ct();nn();lr();H0();$i();xL=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:on\\s*?)?(?:(this|last|past|next)\\s*)?(${$t(Th)}|weekend|weekday)(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(this|last|past|next)\\s*week)?(?=\\W|$)`,"i"),ML=1,_L=2,AL=3,Lc=class extends We{innerPattern(){return xL}innerExtract(t,e){let r=e[ML],i=e[AL],n=r||i;n=n||"",n=n.toLowerCase();let a=null;n=="last"||n=="past"?a="last":n=="next"?a="next":n=="this"&&(a="this");let o=e[_L].toLowerCase(),l;if(Th[o]!==void 0)l=Th[o];else if(o=="weekend")l=a=="last"?qe.SUNDAY:qe.SATURDAY;else if(o=="weekday"){let c=t.reference.getDateWithAdjustedTimezone().getDay();c==qe.SUNDAY||c==qe.SATURDAY?l=a=="last"?qe.FRIDAY:qe.MONDAY:(l=c-1,l=a=="last"?l-1:l+1,l=l%5+1)}else return null;return F0(t.reference,l,a)}}});var U0,IL,PL,NL,Hc,$0=v(()=>{Ct();Ti();U0=bt(tn(),1);lr();nn();IL=new RegExp(`(this|last|past|next|after\\s*this)\\s*(${$t(mc)})(?=\\s*)(?=\\W|$)`,"i"),PL=1,NL=2,Hc=class extends We{innerPattern(){return IL}innerExtract(t,e){let r=e[PL].toLowerCase(),i=e[NL].toLowerCase(),n=mc[i];if(r=="next"||r.startsWith("after")){let l={};return l[n]=1,xe.createRelativeFromReference(t.reference,l)}if(r=="last"||r=="past"){let l={};return l[n]=-1,xe.createRelativeFromReference(t.reference,l)}let a=t.createParsingComponents(),o=(0,U0.default)(t.reference.instant);return i.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):i.match(/month/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):i.match(/year/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var RL,OL,FL,V0,W0,Sy,Bc,Y0=v(()=>{bo();RL=new RegExp("([^\\d]|^)([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}|[0-9]{2}))?(\\W|$)","i"),OL=1,FL=5,V0=2,W0=3,Sy=4,Bc=class{constructor(t){P(this,"groupNumberMonth");P(this,"groupNumberDay");this.groupNumberMonth=t?W0:V0,this.groupNumberDay=t?V0:W0}pattern(){return RL}extract(t,e){let r=e.index+e[OL].length,i=e.index+e[0].length-e[FL].length;if(r>0&&t.text.substring(0,r).match("\\d/?$")||i<t.text.length&&t.text.substring(i).match("^/?\\d"))return;let n=t.text.substring(r,i);if(n.match(/^\d\.\d$/)||n.match(/^\d\.\d{1,2}\.\d{1,2}\s*$/)||!e[Sy]&&n.indexOf("/")<0)return;let a=t.createParsingResult(r,n),o=parseInt(e[this.groupNumberMonth]),l=parseInt(e[this.groupNumberDay]);if((o<1||o>12)&&o>12)if(l>=1&&l<=12&&o<=31)[l,o]=[o,l];else return null;if(l<1||l>31)return null;if(a.start.assign("day",l),a.start.assign("month",o),e[Sy]){let c=parseInt(e[Sy]),d=wh(c);a.start.assign("year",d)}else{let c=an(t.refDate,l,o);a.start.imply("year",c)}return a.addTag("parser/SlashDateFormatParser")}}});var LL,HL,Uc,j0=v(()=>{Ct();Ti();lr();fc();LL=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${bs})(?=\\W|$)`,"i"),HL=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${cn})(?=\\W|$)`,"i"),Uc=class extends We{constructor(e=!0){super();P(this,"allowAbbreviations");this.allowAbbreviations=e}innerPattern(){return this.allowAbbreviations?LL:HL}innerExtract(e,r){let i=r[1].toLowerCase(),n=ei(r[2]);if(!n)return null;switch(i){case"last":case"past":case"-":n=To(n);break}return xe.createRelativeFromReference(e.reference,n)}}});function BL(s){return s.text.match(/^[+-]/i)!=null}function z0(s){return s.text.match(/^-/i)!=null}var $c,q0=v(()=>{dn();Ti();Ct();ky();$c=class extends ti{shouldMergeResults(t,e,r){return t.match(/^\s*$/i)?BL(r)||z0(r):!1}mergeResults(t,e,r,i){let n=ei(r.text);z0(r)&&(n=R0(n));let a=xe.createRelativeFromReference(sn.fromDate(e.start.date()),n);return new Ts(e.reference,e.index,`${e.text}${t}${r.text}`,a)}}});function G0(s){return s.text.match(/\s+(before|from)$/i)!=null}function UL(s){return s.text.match(/\s+(after|since)$/i)!=null}var Vc,Q0=v(()=>{dn();Ti();Ct();fc();Vc=class extends ti{patternBetween(){return/^\s*$/i}shouldMergeResults(t,e,r){return!t.match(this.patternBetween())||!G0(e)&&!UL(e)?!1:!!r.start.get("day")&&!!r.start.get("month")&&!!r.start.get("year")}mergeResults(t,e,r){let i=ei(e.text);G0(e)&&(i=To(i));let n=xe.createRelativeFromReference(sn.fromDate(r.start.date()),i);return new Ts(r.reference,e.index,`${e.text}${t}${r.text}`,n)}}});var $L,VL,Wc,K0=v(()=>{Ct();$L=new RegExp(`^\\s*(${on})`,"i"),VL=1,Wc=class{refine(t,e){return e.forEach(function(r){if(!r.start.isDateWithUnknownYear())return;let i=t.text.substring(r.index+r.text.length),n=$L.exec(i);if(!n||n[0].trim().length<=3)return;t.debug(()=>{console.log(`Extracting year: '${n[0]}' into : ${r}`)});let a=ln(n[VL]);r.end!=null&&r.end.assign("year",a),r.start.assign("year",a),r.text+=n[0]}),e}}});var Yc,Z0=v(()=>{dn();Yc=class extends Do{constructor(){super()}isValid(t,e){let r=e.text.trim();return r===t.text.trim()?!0:r.toLowerCase()==="may"&&!t.text.substring(0,e.index).trim().match(/\b(in)$/i)?(t.debug(()=>{console.log(`Removing unlikely result: ${e}`)}),!1):r.toLowerCase().endsWith("the second")?(t.text.substring(e.index+e.text.length).trim().length>0&&t.debug(()=>{console.log(`Removing unlikely result: ${e}`)}),!1):!0}}});var la,Ey=v(()=>{Ox();Bx();$x();Wx();jx();zx();Qx();Kx();Zx();Xx();n0();w0();P0();N0();B0();$0();Y0();j0();q0();Q0();Ty();K0();Z0();la=class{createCasualConfiguration(t=!1){let e=this.createConfiguration(!1,t);return e.parsers.push(new Oc),e.parsers.push(new Fc),e.parsers.push(new wc),e.parsers.push(new Hc),e.parsers.push(new Uc),e.refiners.push(new Yc),e}createConfiguration(t=!0,e=!1){let r=v0({parsers:[new Bc(e),new gc(t),new yc,new vc(e),new Lc,new bc,new Sc(t),new Ec(t),new Dc(t)],refiners:[new Co]},t);return r.parsers.unshift(new Tc(t)),r.refiners.unshift(new Vc),r.refiners.unshift(new $c),r.refiners.unshift(new un),r.refiners.push(new Co),r.refiners.push(new Wc),r.refiners.push(new xc),r}}});var Mo,Dy,J0=v(()=>{Ti();Ey();Mo=class s{constructor(t){P(this,"parsers");P(this,"refiners");P(this,"defaultConfig",new la);t=t||this.defaultConfig.createCasualConfiguration(),this.parsers=[...t.parsers],this.refiners=[...t.refiners]}clone(){return new s({parsers:[...this.parsers],refiners:[...this.refiners]})}parseDate(t,e,r){let i=this.parse(t,e,r);return i.length>0?i[0].start.date():null}parse(t,e,r){let i=new Dy(t,e,r),n=[];return this.parsers.forEach(a=>{let o=s.executeParser(i,a);n=n.concat(o)}),n.sort((a,o)=>a.index-o.index),this.refiners.forEach(function(a){n=a.refine(i,n)}),n}static executeParser(t,e){let r=[],i=e.pattern(t),n=t.text,a=t.text,o=i.exec(a);for(;o;){let l=o.index+n.length-a.length;o.index=l;let c=e.extract(t,o);if(!c){a=n.substring(o.index+1),o=i.exec(a);continue}let d=null;c instanceof Ts?d=c:c instanceof xe?(d=t.createParsingResult(o.index,o[0]),d.start=c):d=t.createParsingResult(o.index,o[0],c);let u=d.index,h=d.text;t.debug(()=>console.log(`${e.constructor.name} extracted (at index=${u}) '${h}'`)),r.push(d),a=n.substring(u+h.length),o=i.exec(a)}return r}},Dy=class{constructor(t,e,r){P(this,"text");P(this,"option");P(this,"reference");P(this,"refDate");this.text=t,this.option=r!=null?r:{},this.reference=sn.fromInput(e,this.option.timezones),this.refDate=this.reference.instant}createParsingComponents(t){return t instanceof xe?t:new xe(this.reference,t)}createParsingResult(t,e,r,i){let n=typeof e=="string"?e:this.text.substring(t,e),a=r?this.createParsingComponents(r):null,o=i?this.createParsingComponents(i):null;return new Ts(this.reference,t,n,a,o)}debug(t){this.option.debug&&(this.option.debug instanceof Function?this.option.debug(t):this.option.debug.debug(t))}}});var Cy,X0,WL,h8,eM=v(()=>{J0();Ey();Cy=new la,X0=new Mo(Cy.createCasualConfiguration(!1)),WL=new Mo(Cy.createConfiguration(!0,!1)),h8=new Mo(Cy.createCasualConfiguration(!0))});function xy(s,t,e){return jL.parse(s,t,e)}var jL,tM=v(()=>{eM();jL=X0});var Vi,jc=v(()=>{ot();tM();Pf();Vi=class{constructor(t=[],e=[],r=!0){this.isValidDateString=t=>/^\d{4}-\d{2}-\d{2}$/.test(t);this.isValidTimeString=t=>/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(t);this.escapeRegex=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.cleanupWhitespace=t=>t.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").trim();this.defaultToScheduled=r,this.statusConfigs=t,this.priorityPatterns=this.buildPriorityPatterns(e),this.statusPatterns=this.buildFallbackStatusPatterns()}parseInput(t){let e={title:"",tags:[],contexts:[],projects:[]},[r,i]=this.extractTitleAndDetails(t);i&&(e.details=i);let n=r;return n=this.extractTags(n,e),n=this.extractContexts(n,e),n=this.extractProjects(n,e),n=this.extractPriority(n,e),n=this.extractStatus(n,e),n=this.extractExplicitDates(n,e),n=this.extractRecurrence(n,e),n=this.extractTimeEstimate(n,e),n=this.parseDatesAndTimes(n,e),e.title=n.trim(),this.validateAndCleanupResult(e)}extractTitleAndDetails(t){let e=t.trim(),r=e.indexOf(`
`);if(r!==-1){let i=e.substring(0,r).trim(),n=e.substring(r+1).trim();return[i,n]}return[e,void 0]}extractTags(t,e){let r=t.match(/#[\w/]+/g);return r?(e.tags.push(...r.map(i=>i.substring(1))),this.cleanupWhitespace(t.replace(/#[\w/]+/g,""))):t}extractContexts(t,e){let r=t.match(/@\w+/g);return r?(e.contexts.push(...r.map(i=>i.substring(1))),this.cleanupWhitespace(t.replace(/@\w+/g,""))):t}extractProjects(t,e){let r=t,i=r.match(/\+\[\[.*?\]\]/g);i&&(e.projects.push(...i.map(a=>a.slice(1))),r=this.cleanupWhitespace(r.replace(/\+\[\[.*?\]\]/g,"")));let n=r.match(/\+[\w/-]+/g);return n&&(e.projects.push(...n.map(a=>a.substring(1))),r=this.cleanupWhitespace(r.replace(/\+[\w/-]+/g,""))),r}buildPriorityPatterns(t){return t.length>0?t.flatMap(e=>[{regex:new RegExp(`\\b${this.escapeRegex(e.value)}\\b`,"i"),value:e.value},{regex:new RegExp(`\\b${this.escapeRegex(e.label)}\\b`,"i"),value:e.value}]):[{regex:/\b(urgent|critical|highest)\b/i,value:"urgent"},{regex:/\b(high)\b/i,value:"high"},{regex:/\b(important)\b/i,value:"high"},{regex:/\b(medium|normal)\b/i,value:"normal"},{regex:/\b(low|minor)\b/i,value:"low"}]}extractPriority(t,e){let r=null;for(let i of this.priorityPatterns){let n=t.match(i.regex);n&&n.index!==void 0&&(!r||n.index<r.index)&&(r={pattern:i,index:n.index})}return r?(e.priority=r.pattern.value,this.cleanupWhitespace(t.replace(r.pattern.regex,""))):t}buildFallbackStatusPatterns(){return[{regex:/\b(todo|to do|open)\b/i,value:"open"},{regex:/\b(in progress|in-progress|doing)\b/i,value:"in-progress"},{regex:/\b(done|completed|finished)\b/i,value:"done"},{regex:/\b(cancelled|canceled)\b/i,value:"cancelled"},{regex:/\b(waiting|blocked|on hold)\b/i,value:"waiting"}]}extractStatus(t,e){if(this.statusConfigs.length>0){let r=[...this.statusConfigs].sort((i,n)=>n.label.length-i.label.length);for(let i of r){let n=[i.label,i.value];for(let a of n){if(!a||a.trim()==="")continue;let o=this.findStatusMatch(t,a);if(o)return e.status=i.value,this.cleanupWhitespace(t.replace(o.fullMatch,""))}}}for(let r of this.statusPatterns)if(r.regex.test(t))return e.status=r.value,this.cleanupWhitespace(t.replace(r.regex,""));return t}findStatusMatch(t,e){if(!e||e.trim()==="")return null;let r=t.toLowerCase(),i=e.toLowerCase(),n=0;for(;;){let a=r.indexOf(i,n);if(a===-1)break;let o=a>0?t[a-1]:" ",l=a+e.length,c=l<t.length?t[l]:" ",d=/\s/.test(o)||a===0,u=/\s/.test(c)||l===t.length;if(d&&u)return{fullMatch:t.substring(a,l),startIndex:a};n=a+1}return null}extractExplicitDates(t,e){let r=t,i=[{type:"due",regex:/\b(due\s+(?:on\s+)?|deadline\s+(?:on\s+)?|must\s+be\s+done\s+(?:by\s+)?)/i},{type:"scheduled",regex:/\b(scheduled\s+(?:for\s+)?|start\s+(?:on\s+)?|begin\s+(?:on\s+)?|work\s+on\s+)/i}];for(let n of i){let a=r.match(n.regex);if(a){let o=a.index+a[0].length,l=r.substring(o),c=this.parseChronoFromPosition(l);if(c.success){n.type==="due"?(e.dueDate=c.date,c.time&&(e.dueTime=c.time)):(e.scheduledDate=c.date,c.time&&(e.scheduledTime=c.time)),r=r.replace(n.regex,""),c.matchedText&&(r=r.replace(c.matchedText,"")),r=this.cleanupWhitespace(r);break}}}return r}parseChronoFromPosition(t){try{let e=xy(t,new Date,{forwardDate:!0});if(e.length>0){let r=e[0];if(r.index<=3){let i=r.start.date();if(nr(i)){let n={success:!0,date:C(i,"yyyy-MM-dd"),matchedText:r.text};return r.start.isCertain("hour")&&(n.time=C(i,"HH:mm")),n}}}}catch(e){console.debug("Error parsing date with chrono:",e)}return{success:!1}}extractRecurrence(t,e){let r=[{regex:/\bevery\s+(first|second|third|fourth|last)\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)\b/i,handler:i=>{let n=i[1].toLowerCase(),o=i[2].toLowerCase().toUpperCase().substring(0,2),l={first:1,second:2,third:3,fourth:4,last:-1}[n]||1;return`FREQ=MONTHLY;BYDAY=${o};BYSETPOS=${l}`}},{regex:/\bevery\s+(\d+)\s+(days?|weeks?|months?|years?)\b/i,handler:i=>{let n=parseInt(i[1]),a=i[2].replace(/s$/,"").toLowerCase();return`FREQ=${{day:"DAILY",week:"WEEKLY",month:"MONTHLY",year:"YEARLY"}[a]};INTERVAL=${n}`}},{regex:/\bevery\s+other\s+(day|week|month|year)\b/i,handler:i=>{let n=i[1].toLowerCase();return`FREQ=${{day:"DAILY",week:"WEEKLY",month:"MONTHLY",year:"YEARLY"}[n]};INTERVAL=2`}},{regex:/\bevery\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)\b/i,handler:i=>`FREQ=WEEKLY;BYDAY=${i[1].toUpperCase().substring(0,2)}`},{regex:/\b(mondays|tuesdays|wednesdays|thursdays|fridays|saturdays|sundays)\b/i,handler:i=>`FREQ=WEEKLY;BYDAY=${i[1].replace(/s$/,"").toUpperCase().substring(0,2)}`},{regex:/\b(daily|every day)\b/i,handler:()=>"FREQ=DAILY"},{regex:/\b(weekly|every week)\b/i,handler:()=>"FREQ=WEEKLY"},{regex:/\b(monthly|every month)\b/i,handler:()=>"FREQ=MONTHLY"},{regex:/\b(yearly|annually|every year)\b/i,handler:()=>"FREQ=YEARLY"}];for(let i of r){let n=t.match(i.regex);if(n){let a=i.handler(n);if(this.isValidRRuleString(a))return e.recurrence=a,this.cleanupWhitespace(t.replace(i.regex,""))}}return t}isValidRRuleString(t){if(t.includes("BYDAY=undefined")||t.includes("BYDAY=;")||t.includes("BYDAY=")){let e=t.match(/BYDAY=([^;]*)/);if(e&&(!e[1]||e[1]==="undefined"||e[1].trim()===""))return!1}return!!t.includes("FREQ=")}extractTimeEstimate(t,e){let r=[{regex:/\b(\d+)h\s*(\d+)m\b/i,handler:a=>parseInt(a[1])*60+parseInt(a[2])},{regex:/\b(\d+)\s*(?:hr|hrs|hour|hours|h)\b/i,handler:a=>parseInt(a[1])*60},{regex:/\b(\d+)\s*(?:min|mins|minute|minutes|m)\b/i,handler:a=>parseInt(a[1])}],i=t,n=0;for(let a of r){let o=i.match(a.regex);o&&(n+=a.handler(o),i=this.cleanupWhitespace(i.replace(a.regex,"")))}return n>0&&(e.estimate=n),i}parseDatesAndTimes(t,e){var i,n;let r=t;try{let a=xy(t,new Date,{forwardDate:!0});if(a.length===0)return t;let o=a[0],l=o.text,c=o.start.date(),d=(i=o.end)==null?void 0:i.date(),u=/due|by|deadline/i.test(o.text),h=/scheduled|from|start|on/i.test(o.text);if(d&&nr(d)&&d.getTime()!==c.getTime())e.scheduledDate=C(c,"yyyy-MM-dd"),o.start.isCertain("hour")&&(e.scheduledTime=C(c,"HH:mm")),e.dueDate=C(d,"yyyy-MM-dd"),(n=o.end)!=null&&n.isCertain("hour")&&(e.dueTime=C(d,"HH:mm"));else if(nr(c)){let p=C(c,"yyyy-MM-dd"),f=o.start.isCertain("hour")?C(c,"HH:mm"):void 0;u&&!h?(e.dueDate=p,e.dueTime=f):h&&!u||this.defaultToScheduled?(e.scheduledDate=p,e.scheduledTime=f):(e.dueDate=p,e.dueTime=f)}r=this.cleanupWhitespace(r.replace(l,""))}catch(a){console.debug("Chrono-node parsing failed:",a)}return r}validateAndCleanupResult(t){return t.title.trim()||(t.title="Untitled Task"),t.tags=[...new Set(t.tags.filter(Boolean))],t.contexts=[...new Set(t.contexts.filter(Boolean))],t.projects=[...new Set(t.projects.filter(Boolean))],t.dueDate&&!this.isValidDateString(t.dueDate)&&delete t.dueDate,t.scheduledDate&&!this.isValidDateString(t.scheduledDate)&&delete t.scheduledDate,t.dueTime&&!this.isValidTimeString(t.dueTime)&&delete t.dueTime,t.scheduledTime&&!this.isValidTimeString(t.scheduledTime)&&delete t.scheduledTime,t}getPreviewData(t){let e=[];if(t.title&&e.push({icon:"edit-3",text:`"${t.title}"`}),t.details&&e.push({icon:"file-text",text:`Details: "${t.details.substring(0,50)}${t.details.length>50?"...":""}"`}),t.dueDate){let r=t.dueTime?`${t.dueDate} at ${t.dueTime}`:t.dueDate;e.push({icon:"calendar",text:`Due: ${r}`})}if(t.scheduledDate){let r=t.scheduledTime?`${t.scheduledDate} at ${t.scheduledTime}`:t.scheduledDate;e.push({icon:"calendar-clock",text:`Scheduled: ${r}`})}if(t.priority&&e.push({icon:"alert-triangle",text:`Priority: ${t.priority}`}),t.status&&e.push({icon:"activity",text:`Status: ${t.status}`}),t.contexts&&t.contexts.length>0&&e.push({icon:"map-pin",text:`Contexts: ${t.contexts.map(r=>"@"+r).join(", ")}`}),t.projects&&t.projects.length>0){let r=t.projects.map(i=>i.includes(" ")||i.includes("-")||i.match(/[A-Z]/)?`+[[${i}]]`:`+${i}`).join(", ");e.push({icon:"folder",text:`Projects: ${r}`})}if(t.tags&&t.tags.length>0&&e.push({icon:"tag",text:`Tags: ${t.tags.map(r=>"#"+r).join(", ")}`}),t.recurrence){let r="Invalid recurrence";try{t.recurrence.includes("FREQ=")&&this.isValidRRuleString(t.recurrence)&&(r=q.fromString(t.recurrence).toText())}catch(i){console.debug("Error parsing rrule for preview:",i)}e.push({icon:"repeat",text:`Recurrence: ${r}`})}return t.estimate&&e.push({icon:"clock",text:`Estimate: ${t.estimate} min`}),e}getPreviewText(t){return this.getPreviewData(t).map(e=>e.text).join(" \u2022 ")}}});var qc={};Ur(qc,{convertDefaultRemindersToReminders:()=>qL,hasAnyUserFieldsEnabled:()=>rM,isUserFieldConfigComplete:()=>iM,isUserFieldEnabled:()=>GL});function qL(s,t){return s.map(e=>{let r={id:`rem_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e.type,description:e.description};if(e.type==="relative"){if(e.relatedTo&&e.offset&&e.unit&&e.direction){let i="PT";e.unit==="days"?i=`P${e.offset}D`:e.unit==="hours"?i=`PT${e.offset}H`:i=`PT${e.offset}M`,e.direction==="before"&&(i="-"+i),r.relatedTo=e.relatedTo,r.offset=i}}else e.type==="absolute"&&e.absoluteDate&&e.absoluteTime&&(r.absoluteTime=`${e.absoluteDate}T${e.absoluteTime}:00`);return r}).filter(e=>e.type==="relative"?e.relatedTo&&e.offset:!!e.absoluteTime)}function rM(s){let t=s.userFields;return!t||t.length===0?!1:t.some(e=>!!(e&&e.displayName&&e.key&&e.type))}function iM(s){return!s||!s.enabled?!1:!!(s.displayName&&s.key&&s.type)}function GL(s){return s.userFields&&s.userFields.length>0?rM(s):iM(s.userField)}var Gc=v(()=>{});function Rh(s){let{task:t,plugin:e,excludeSelector:r,onSingleClick:i,onDoubleClick:n,contextMenuHandler:a}=s,o=null,l=()=>{let m=e.app.vault.getAbstractFileByPath(t.path);m instanceof aM.TFile&&e.app.workspace.getLeaf(!1).openFile(m)},c=async()=>{await e.openTaskEditModal(t)},d=async m=>{if(i){await i(m);return}if(m.ctrlKey||m.metaKey){l();return}let g=e.settings.singleClickAction;g==="edit"?await c():g==="openNote"&&l()},u=async m=>{if(n){await n(m);return}let g=e.settings.doubleClickAction;g==="edit"?await c():g==="openNote"&&l()};return{clickHandler:async m=>{if(!(r&&m.target.closest(r))){if(e.settings.doubleClickAction==="none"){await d(m);return}o?(clearTimeout(o),o=null,await u(m)):o=setTimeout(()=>{o=null,d(m)},250)}},dblclickHandler:async m=>{},contextmenuHandler:async m=>{m.preventDefault(),a&&await a(m)},cleanup:()=>{o&&(clearTimeout(o),o=null)}}}function Oh(s,t){return e=>{t.app.vault.getAbstractFileByPath(s.path)&&t.app.workspace.trigger("hover-link",{event:e,source:"tasknotes-task-card",hoverParent:e.currentTarget,targetEl:e.currentTarget,linktext:s.path,sourcePath:s.path})}}var aM,Ay=v(()=>{aM=require("obsidian")});var Ny={};Ur(Ny,{DEFAULT_TASK_CARD_OPTIONS:()=>Py,cleanupTaskCard:()=>l1,createTaskCard:()=>er,refreshParentTaskSubtasks:()=>da,showDeleteConfirmationModal:()=>n1,showTaskContextMenu:()=>Fh,updateTaskCard:()=>ii});function dM(s,t,e,r){s.addEventListener("click",i=>{i.stopPropagation();let n=r==="due"?t.due:t.scheduled;new yr({currentValue:ue(n||""),currentTime:jt(n||""),onSelect:async(o,l)=>{try{let c;o?l?c=`${o}T${l}`:c=o:c=void 0,await e.updateTaskProperty(t,r,c)}catch(c){console.error(`Error updating ${r} date:`,c),new ce.Notice(`Failed to update ${r} date`)}}}).show(i)})}function uM(){return["due","scheduled","projects","contexts","tags"]}function ZL(s,t,e){try{return t in oM?oM[t](s):t.startsWith("user:")?JL(s,t,e):null}catch(r){return console.warn(`TaskCard: Error getting property ${t}:`,r),null}}function JL(s,t,e){var a;let r=t.slice(5),i=(a=e.settings.userFields)==null?void 0:a.find(o=>o.id===r);if(!(i!=null&&i.key))return null;let n=s[i.key];return n===void 0&&(n=XL(s.path,i.key,e)),n}function XL(s,t,e){try{let r=e.app.metadataCache.getCache(s);return r!=null&&r.frontmatter?r.frontmatter[t]:void 0}catch(r){console.warn(`TaskCard: Error accessing frontmatter for ${s}:`,r);return}}function hM(s,t,e,r){let i=ZL(e,t,r);if(!e1(i))return null;let n=s.createEl("span",{cls:`task-card__metadata-property task-card__metadata-property--${t.replace(":","-")}`});try{return t in lM?lM[t](n,i,e,r):t.startsWith("user:")&&t1(n,t,i,r),n}catch(a){return console.warn(`TaskCard: Error rendering property ${t}:`,a),n.textContent=`${t}: (error)`,n}}function e1(s){return s!=null&&!(Array.isArray(s)&&s.length===0)&&!(typeof s=="string"&&s.trim()==="")}function cM(s){return s.flat(2).filter(t=>t!=null&&typeof t=="string"&&t.trim()!=="")}function t1(s,t,e,r){var l;let i=t.slice(5),n=(l=r.settings.userFields)==null?void 0:l.find(c=>c.id===i);if(!n){s.textContent=`${i}: (not found)`;return}let a=r1(e,n),o=n.displayName||i;s.textContent=a.trim()!==""?`${o}: ${a}`:`${o}: (empty)`}function r1(s,t){if(s==null)return"";try{switch(t.type){case"text":case"number":return String(s);case"date":return zt(String(s),{dateFormat:"MMM d, yyyy",timeFormat:"",showTime:!1});case"boolean":return s?"\u2713":"\u2717";case"list":return Array.isArray(s)?s.flat(2).join(", "):String(s);default:return String(s)}}catch(e){return console.warn("TaskCard: Error formatting user property value:",e),String(s)}}function i1(s,t,e,r){let i=df(t),n=Mi(t),a="";if(i){let o=zt(t,{dateFormat:"",timeFormat:"h:mm a",showTime:!0});a=o.trim()===""?"Due: Today":`Due: Today at ${o}`}else n?a=`Due: ${zt(t,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})} (overdue)`:a=`Due: ${zt(t,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})}`;s.textContent=a,s.classList.add("task-card__metadata-date","task-card__metadata-date--due"),dM(s,e,r,"due")}function s1(s,t,e,r){let i=df(t),n=Mi(t),a="";if(i){let o=zt(t,{dateFormat:"",timeFormat:"h:mm a",showTime:!0});a=o.trim()===""?"Scheduled: Today":`Scheduled: Today at ${o}`}else n?a=`Scheduled: ${zt(t,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})} (past)`:a=`Scheduled: ${zt(t,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})}`;s.textContent=a,s.classList.add("task-card__metadata-date","task-card__metadata-date--scheduled"),dM(s,e,r,"scheduled")}function pM(s,t){if(t.length>0){for(let e=1;e<t.length;e++){let r=s.createEl("span",{cls:"task-card__metadata-separator",text:" \u2022 "});t[e].insertAdjacentElement("beforebegin",r)}s.style.display=""}else s.style.display="none"}function er(s,t,e,r={}){var U;let i={...Py,...r},n=i.targetDate||t.selectedDate||new Date,a=s.recurrence?Ii(s,n):s.status,o=document.createElement("div");o._taskPath=s.path;let l=t.getActiveTimeSession(s)!==null,c=t.statusManager.isCompletedStatus(a),d=!!s.recurrence,u=["task-card"];c&&u.push("task-card--completed"),s.archived&&u.push("task-card--archived"),l&&u.push("task-card--actively-tracked"),d&&u.push("task-card--recurring"),i.showCheckbox&&u.push("task-card--checkbox-enabled"),s.priority&&u.push(`task-card--priority-${s.priority}`),a&&u.push(`task-card--status-${a}`),((U=t.settings)==null?void 0:U.subtaskChevronPosition)==="left"&&u.push("task-card--chevron-left"),fr(s.projects||[]).length>0&&u.push("task-card--has-projects"),o.className=u.join(" "),o.dataset.taskPath=s.path,o.dataset.key=s.path,o.dataset.status=a;let p=o.createEl("div",{cls:"task-card__main-row"}),f=t.priorityManager.getPriorityConfig(s.priority);f&&o.style.setProperty("--priority-color",f.color);let m=t.statusManager.getStatusConfig(a);if(m&&o.style.setProperty("--current-status-color",m.color),i.showCheckbox){let R=p.createEl("input",{type:"checkbox",cls:"task-card__checkbox"});R.checked=t.statusManager.isCompletedStatus(a),R.addEventListener("click",async H=>{H.stopPropagation();try{s.recurrence?await t.toggleRecurringTaskComplete(s,n):await t.toggleTaskStatus(s)}catch(j){let re=j instanceof Error?j.message:String(j);console.error("Error in task checkbox handler:",{error:re,taskPath:s.path}),new ce.Notice(`Failed to toggle task status: ${re}`)}})}let g=null;(!e||e.includes("status"))&&(g=p.createEl("span",{cls:"task-card__status-dot"}),m&&(g.style.borderColor=m.color)),g&&g.addEventListener("click",async R=>{R.stopPropagation();try{if(s.recurrence){let H=await t.toggleRecurringTaskComplete(s,n),j=Ii(H,n),re=t.statusManager.getStatusConfig(j),he=t.statusManager.isCompletedStatus(j);re&&(g.style.borderColor=re.color);let W=["task-card"];he&&W.push("task-card--completed"),s.archived&&W.push("task-card--archived"),t.getActiveTimeSession(s)&&W.push("task-card--actively-tracked"),s.recurrence&&W.push("task-card--recurring"),s.priority&&W.push(`task-card--priority-${s.priority}`),j&&W.push(`task-card--status-${j}`),o.className=W.join(" "),o.dataset.status=j;let Re=o.querySelector(".task-card__title");Re&&Re.classList.toggle("completed",he)}else{let H=await t.cacheManager.getTaskInfo(s.path);if(!H){new ce.Notice("Task not found");return}let j=H.status||"open",re=t.statusManager.getNextStatus(j);await t.updateTaskProperty(H,"status",re)}}catch(H){let j=H instanceof Error?H.message:String(H);console.error("Error cycling task status:",{error:j,taskPath:s.path}),new ce.Notice(`Failed to update task status: ${j}`)}});let w=!e||e.includes("priority");if(s.priority&&f&&w){let R=p.createEl("span",{cls:"task-card__priority-dot",attr:{"aria-label":`Priority: ${f.label}`}});R.style.borderColor=f.color,R.addEventListener("click",H=>{H.stopPropagation(),new ws({currentValue:s.priority,onSelect:async re=>{try{await t.updateTaskProperty(s,"priority",re)}catch(he){console.error("Error updating priority:",he),new ce.Notice("Failed to update priority")}},plugin:t}).show(H)})}if(s.recurrence){let R=p.createEl("div",{cls:"task-card__recurring-indicator",attr:{"aria-label":`Recurring: ${ja(s.recurrence)} (click to change)`}});(0,ce.setTooltip)(R,`Recurring: ${ja(s.recurrence)} (click to change)`,{placement:"top"}),(0,ce.setIcon)(R,"rotate-ccw"),R.addEventListener("click",H=>{H.stopPropagation(),new Pi({currentValue:typeof s.recurrence=="string"?s.recurrence:void 0,onSelect:async re=>{try{await t.updateTaskProperty(s,"recurrence",re||void 0)}catch(he){console.error("Error updating recurrence:",he),new ce.Notice("Failed to update recurrence")}},app:t.app}).show(H)})}if(s.reminders&&s.reminders.length>0){let R=p.createEl("div",{cls:"task-card__reminder-indicator",attr:{"aria-label":`${s.reminders.length} reminder${s.reminders.length>1?"s":""} set (click to manage)`}}),H=s.reminders.length,j=H===1?"1 reminder set (click to manage)":`${H} reminders set (click to manage)`;(0,ce.setTooltip)(R,j,{placement:"top"}),(0,ce.setIcon)(R,"bell"),R.addEventListener("click",re=>{re.stopPropagation(),new cs(t.app,t,s,async W=>{try{await t.updateTaskProperty(s,"reminders",W.length>0?W:void 0)}catch(Re){console.error("Error updating reminders:",Re),new ce.Notice("Failed to update reminders")}}).open()})}let T=p.createEl("div",{cls:"task-card__project-indicator-placeholder",attr:{style:"display: none;"}}),S=p.createEl("div",{cls:"task-card__chevron-placeholder",attr:{style:"display: none;"}});t.projectSubtasksService.isTaskUsedAsProject(s.path).then(R=>{var H,j;if(R){if(T.className="task-card__project-indicator",T.removeAttribute("style"),T.setAttribute("aria-label","This task is used as a project (click to filter subtasks)"),(0,ce.setTooltip)(T,"This task is used as a project (click to filter subtasks)",{placement:"top"}),(0,ce.setIcon)(T,"folder"),T.addEventListener("click",async re=>{re.stopPropagation();try{await t.applyProjectSubtaskFilter(s)}catch(he){console.error("Error filtering project subtasks:",he),new ce.Notice("Failed to filter project subtasks")}}),(H=t.settings)!=null&&H.showExpandableSubtasks){S.className="task-card__chevron",S.removeAttribute("style");let re=((j=t.expandedProjectsService)==null?void 0:j.isExpanded(s.path))||!1;re&&S.classList.add("task-card__chevron--expanded"),S.setAttribute("aria-label",re?"Collapse subtasks":"Expand subtasks"),(0,ce.setTooltip)(S,re?"Collapse subtasks":"Expand subtasks",{placement:"top"}),(0,ce.setIcon)(S,"chevron-right"),S.addEventListener("click",async he=>{he.stopPropagation();try{if(!t.expandedProjectsService){console.error("ExpandedProjectsService not initialized"),new ce.Notice("Service not available. Please try reloading the plugin.");return}let W=t.expandedProjectsService.toggle(s.path);S.classList.toggle("task-card__chevron--expanded",W),S.setAttribute("aria-label",W?"Collapse subtasks":"Expand subtasks"),(0,ce.setTooltip)(S,W?"Collapse subtasks":"Expand subtasks",{placement:"top"}),await Qc(o,s,t,W)}catch(W){console.error("Error toggling subtasks:",W),new ce.Notice("Failed to toggle subtasks")}}),re&&Qc(o,s,t,!0).catch(he=>{console.error("Error showing initial subtasks:",he)})}}else T.remove(),S.remove()}).catch(R=>{console.error("Error checking if task is used as project:",R),T.remove(),S.remove()});let x=p.createEl("div",{cls:"task-card__content"}),I=p.createEl("div",{cls:"task-card__context-menu",attr:{"aria-label":"Task options"}});(0,ce.setIcon)(I,"ellipsis-vertical"),(0,ce.setTooltip)(I,"Task options",{placement:"top"}),I.addEventListener("click",async R=>{R.stopPropagation(),R.preventDefault(),await Fh(R,s.path,t,n)});let F=x.createEl("div",{cls:"task-card__title",text:s.title});t.statusManager.isCompletedStatus(a)&&F.classList.add("completed");let A=x.createEl("div",{cls:"task-card__metadata"}),L=[],G=e||t.settings.defaultVisibleProperties||uM();for(let R of G){if(R==="status"||R==="priority")continue;let H=hM(A,R,s,t);H&&L.push(H)}let V=pr(s.timeEntries||[]),k=G.includes("timeEstimate"),D=G.includes("totalTrackedTime");if(!k&&!D&&(s.timeEstimate||V>0)){let R=[];V>0&&R.push(`${t.formatTime(V)} spent`),s.timeEstimate&&R.push(`${t.formatTime(s.timeEstimate)} estimated`);let H=A.createEl("span",{cls:"task-card__metadata-property task-card__metadata-property--time"});H.textContent=R.join(", "),L.push(H)}pM(A,L);let{clickHandler:_,dblclickHandler:$}=Rh({task:s,plugin:t,excludeSelector:".task-card__checkbox",contextMenuHandler:async R=>{let H=o.dataset.taskPath;H&&await Fh(R,H,t,n)}});return o.addEventListener("click",_),o.addEventListener("dblclick",$),o.addEventListener("contextmenu",async R=>{R.preventDefault(),R.stopPropagation();let H=o.dataset.taskPath;H&&await Fh(R,H,t,n)}),o.addEventListener("mouseover",Oh(s,t)),o}async function Fh(s,t,e,r){try{let i=await e.cacheManager.getTaskInfo(t);if(!i){console.error(`No task found for path: ${t}`);return}new Ja({task:i,plugin:e,targetDate:r,onUpdate:()=>{e.app.workspace.trigger("tasknotes:refresh-views")}}).show(s)}catch(i){let n=i instanceof Error?i.message:String(i);console.error("Error creating context menu:",{error:n,taskPath:t}),new ce.Notice(`Failed to create context menu: ${n}`)}}function ii(s,t,e,r,i={}){var G;let a={...Py,...i}.targetDate||e.selectedDate||new Date,o=t.recurrence?Ii(t,a):t.status,l=e.getActiveTimeSession(t)!==null,c=e.statusManager.isCompletedStatus(o),d=!!t.recurrence,u=["task-card"];c&&u.push("task-card--completed"),t.archived&&u.push("task-card--archived"),l&&u.push("task-card--actively-tracked"),d&&u.push("task-card--recurring"),t.priority&&u.push(`task-card--priority-${t.priority}`),o&&u.push(`task-card--status-${o}`),((G=e.settings)==null?void 0:G.subtaskChevronPosition)==="left"&&u.push("task-card--chevron-left"),s.className=u.join(" "),s.dataset.status=o;let h=s.querySelector(".task-card__main-row"),p=e.priorityManager.getPriorityConfig(t.priority);p&&s.style.setProperty("--priority-color",p.color);let f=e.statusManager.getStatusConfig(o);f&&s.style.setProperty("--current-status-color",f.color);let m=s.querySelector(".task-card__checkbox");m&&(m.checked=e.statusManager.isCompletedStatus(o));let g=!r||r.includes("status"),y=s.querySelector(".task-card__status-dot");if(g){if(y)f&&(y.style.borderColor=f.color);else if(h){let V=h.createEl("span",{cls:"task-card__status-dot"});f&&(V.style.borderColor=f.color),V.addEventListener("click",async D=>{D.stopPropagation();try{if(t.recurrence){let _=await e.toggleRecurringTaskComplete(t,a),$=Ii(_,a),U=e.statusManager.getStatusConfig($),R=e.statusManager.isCompletedStatus($);U&&(V.style.borderColor=U.color);let H=["task-card"];R&&H.push("task-card--completed"),t.archived&&H.push("task-card--archived"),e.getActiveTimeSession(t)&&H.push("task-card--actively-tracked"),t.recurrence&&H.push("task-card--recurring"),t.priority&&H.push(`task-card--priority-${t.priority}`),$&&H.push(`task-card--status-${$}`),s.className=H.join(" "),s.dataset.status=$;let j=s.querySelector(".task-card__title");j&&j.classList.toggle("completed",R)}else{let _=await e.cacheManager.getTaskInfo(t.path);if(!_){new ce.Notice("Task not found");return}let $=_.status||"open",U=e.statusManager.getNextStatus($);await e.updateTaskProperty(_,"status",U)}}catch(_){let $=_ instanceof Error?_.message:String(_);console.error("Error cycling task status:",{error:$,taskPath:t.path}),new ce.Notice(`Failed to update task status: ${$}`)}});let k=s.querySelector(".task-card__checkbox");k?k.insertAdjacentElement("afterend",V):h.insertBefore(V,h.firstChild)}}else y&&y.remove();let w=!r||r.includes("priority"),T=s.querySelector(".task-card__priority-dot");if(w&&t.priority&&p)if(!T&&h){let V=h.createEl("span",{cls:"task-card__priority-dot",attr:{"aria-label":`Priority: ${p.label}`}});V.style.borderColor=p.color,V.addEventListener("click",_=>{_.stopPropagation(),new ws({currentValue:t.priority,onSelect:async U=>{try{await e.updateTaskProperty(t,"priority",U)}catch(R){console.error("Error updating priority:",R),new ce.Notice("Failed to update priority")}},plugin:e}).show(_)});let k=s.querySelector(".task-card__status-dot"),D=s.querySelector(".task-card__checkbox");k?k.insertAdjacentElement("afterend",V):D?D.insertAdjacentElement("afterend",V):h.insertBefore(V,h.firstChild)}else T&&(T.style.borderColor=p.color,T.setAttribute("aria-label",`Priority: ${p.label}`));else T&&T.remove();let S=s.querySelector(".task-card__recurring-indicator");if(t.recurrence&&!S){let V=h.createEl("span",{cls:"task-card__recurring-indicator",attr:{"aria-label":`Recurring: ${ja(t.recurrence)}`}});(0,ce.setIcon)(V,"rotate-ccw"),y==null||y.insertAdjacentElement("afterend",V)}else if(!t.recurrence&&S)S.remove();else if(t.recurrence&&S){let V=ja(t.recurrence);S.setAttribute("aria-label",`Recurring: ${V}`)}let x=s.querySelector(".task-card__reminder-indicator");if(t.reminders&&t.reminders.length>0&&!x){let V=h.createEl("div",{cls:"task-card__reminder-indicator",attr:{"aria-label":`${t.reminders.length} reminder${t.reminders.length>1?"s":""} set (click to manage)`}}),k=t.reminders.length,D=k===1?"1 reminder set (click to manage)":`${k} reminders set (click to manage)`;(0,ce.setTooltip)(V,D,{placement:"top"}),(0,ce.setIcon)(V,"bell"),V.addEventListener("click",$=>{$.stopPropagation(),new cs(e.app,e,t,async R=>{try{await e.updateTaskProperty(t,"reminders",R.length>0?R:void 0)}catch(H){console.error("Error updating reminders:",H),new ce.Notice("Failed to update reminders")}}).open()});let _=S||y;_==null||_.insertAdjacentElement("afterend",V)}else if((!t.reminders||t.reminders.length===0)&&x)x.remove();else if(t.reminders&&t.reminders.length>0&&x){let V=t.reminders.length,k=V===1?"1 reminder set (click to manage)":`${V} reminders set (click to manage)`;x.setAttribute("aria-label",`${V} reminder${V>1?"s":""} set (click to manage)`),(0,ce.setTooltip)(x,k,{placement:"top"})}let I=s.querySelector(".task-card__project-indicator"),F=s.querySelector(".task-card__project-indicator-placeholder");e.projectSubtasksService.isTaskUsedAsProject(t.path).then(V=>{var _,$,U;if(V&&!I&&!F){let R=h.createEl("div",{cls:"task-card__project-indicator",attr:{"aria-label":"This task is used as a project (click to filter subtasks)",title:"This task is used as a project (click to filter subtasks)"}});(0,ce.setIcon)(R,"folder"),R.addEventListener("click",async j=>{j.stopPropagation();try{await e.applyProjectSubtaskFilter(t)}catch(re){console.error("Error filtering project subtasks:",re),new ce.Notice("Failed to filter project subtasks")}});let H=s.querySelector(".task-card__recurring-indicator")||s.querySelector(".task-card__priority-dot")||s.querySelector(".task-card__status-dot");H==null||H.insertAdjacentElement("afterend",R)}else!V&&(I||F)&&(I==null||I.remove(),F==null||F.remove());let k=s.querySelector(".task-card__chevron"),D=s.querySelector(".task-card__chevron-placeholder");if(V&&((_=e.settings)!=null&&_.showExpandableSubtasks)&&!k&&!D){let R=h.createEl("div",{cls:"task-card__chevron",attr:{"aria-label":"Expand subtasks",title:"Expand subtasks"}}),H=(($=e.expandedProjectsService)==null?void 0:$.isExpanded(t.path))||!1;H?(R.classList.add("task-card__chevron--expanded"),R.setAttribute("aria-label","Collapse subtasks"),(0,ce.setTooltip)(R,"Collapse subtasks",{placement:"top"})):(0,ce.setTooltip)(R,"Expand subtasks",{placement:"top"}),(0,ce.setIcon)(R,"chevron-right"),R.addEventListener("click",async re=>{re.stopPropagation();try{if(!e.expandedProjectsService){console.error("ExpandedProjectsService not initialized in update"),new ce.Notice("Service not available. Please try reloading the plugin.");return}let he=e.expandedProjectsService.toggle(t.path);R.classList.toggle("task-card__chevron--expanded",he),R.setAttribute("aria-label",he?"Collapse subtasks":"Expand subtasks"),(0,ce.setTooltip)(R,he?"Collapse subtasks":"Expand subtasks",{placement:"top"}),await Qc(s,t,e,he)}catch(he){console.error("Error toggling subtasks:",he),new ce.Notice("Failed to toggle subtasks")}});let j=s.querySelector(".task-card__project-indicator");j==null||j.insertAdjacentElement("afterend",R),H&&(R.classList.add("task-card__chevron--expanded"),R.setAttribute("aria-label","Collapse subtasks"),(0,ce.setTooltip)(R,"Collapse subtasks",{placement:"top"}),Qc(s,t,e,!0).catch(re=>{console.error("Error showing initial subtasks in update:",re)}))}else if((!V||!((U=e.settings)!=null&&U.showExpandableSubtasks))&&(k||D)){k==null||k.remove(),D==null||D.remove();let R=s.querySelector(".task-card__subtasks");if(R){let H=R._clickHandler;H&&(R.removeEventListener("click",H),delete R._clickHandler),R.remove()}}}).catch(V=>{console.error("Error checking if task is used as project in update:",V)});let A=s.querySelector(".task-card__title");A&&(A.textContent=t.title,A.classList.toggle("completed",e.statusManager.isCompletedStatus(o)));let L=s.querySelector(".task-card__metadata");if(L){L.innerHTML="";let V=[],k=r||e.settings.defaultVisibleProperties||uM();for(let U of k){if(U==="status"||U==="priority")continue;let R=hM(L,U,t,e);R&&V.push(R)}let D=pr(t.timeEntries||[]),_=k.includes("timeEstimate"),$=k.includes("totalTrackedTime");if(!_&&!$&&(t.timeEstimate||D>0)){let U=[];D>0&&U.push(`${e.formatTime(D)} spent`),t.timeEstimate&&U.push(`${e.formatTime(t.timeEstimate)} estimated`);let R=L.createEl("span",{cls:"task-card__metadata-property task-card__metadata-property--time"});R.textContent=U.join(", "),V.push(R)}pM(L,V)}}async function n1(s,t){return new Promise((e,r)=>{new Iy(t.app,s,t,async()=>{try{await t.taskService.deleteTask(s),e()}catch(n){r(n)}}).open()})}function a1(s){return!!(s&&s.startsWith("[[")&&s.endsWith("]]"))}function o1(s,t,e){s.innerHTML="",t.flat(2).filter(i=>i!=null&&typeof i=="string").forEach((i,n)=>{if(n>0){let o=document.createTextNode(", ");s.appendChild(o)}let a=document.createTextNode("+");if(s.appendChild(a),a1(i)){let o=i.slice(2,-2),l=o,c=o;if(o.includes("|")){let u=o.split("|");l=u[0],c=u[1]}let d=s.createEl("a",{cls:"task-card__project-link internal-link",text:c,attr:{"data-href":l,role:"button",tabindex:"0"}});d.addEventListener("click",async u=>{u.preventDefault(),u.stopPropagation();try{let h=e.app.metadataCache.getFirstLinkpathDest(l,"");h instanceof ce.TFile?await e.app.workspace.getLeaf(!1).openFile(h):new ce.Notice(`Note "${c}" not found`)}catch(h){console.error("Error opening project link:",h),new ce.Notice(`Failed to open note "${c}"`)}}),d.addEventListener("keydown",u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),d.click())}),d.addEventListener("mouseover",u=>{let h=e.app.metadataCache.getFirstLinkpathDest(l,"");h instanceof ce.TFile&&e.app.workspace.trigger("hover-link",{event:u,source:"tasknotes-project-link",hoverParent:s,targetEl:d,linktext:l,sourcePath:h.path})})}else{let o=document.createTextNode(i);s.appendChild(o)}})}function l1(s){let t=s.querySelector(".task-card__subtasks");if(t){let e=t._clickHandler;e&&(t.removeEventListener("click",e),delete t._clickHandler)}}async function Qc(s,t,e,r){try{let i=s.querySelector(".task-card__subtasks");if(r){if(!i){i=document.createElement("div"),i.className="task-card__subtasks";let a=o=>{o.stopPropagation()};i.addEventListener("click",a),i._clickHandler=a,s.appendChild(i)}for(;i.firstChild;)i.removeChild(i.firstChild);let n=i.createEl("div",{cls:"task-card__subtasks-loading",text:"Loading subtasks..."});try{let a=e.app.vault.getAbstractFileByPath(t.path);if(!(a instanceof ce.TFile))throw new Error("Task file not found");if(!e.projectSubtasksService)throw new Error("projectSubtasksService not initialized");let o=await e.projectSubtasksService.getTasksLinkedToProject(a);if(n.remove(),o.length===0){i.createEl("div",{cls:"task-card__subtasks-loading",text:"No subtasks found"});return}let l=e.projectSubtasksService.sortTasks(o),d=(u=>{var f;let h=[],p=u.closest(".task-card");for(;p;){let m=p._taskPath;m&&h.unshift(m),p=(f=p.parentElement)==null?void 0:f.closest(".task-card")}return h})(s);for(let u of l){if(d.includes(u.path)){console.warn("Circular reference detected in task chain:",{subtask:u.path,parentChain:d,cycle:[...d,u.path]});continue}let h=er(u,e,void 0,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});h.classList.add("task-card--subtask"),i.appendChild(h)}}catch(a){console.error("Error loading subtasks:",a),n.textContent="Failed to load subtasks"}}else if(i){let n=i._clickHandler;n&&(i.removeEventListener("click",n),delete i._clickHandler),i.remove()}}catch(i){throw console.error("Error in toggleSubtasks:",i),i}}async function da(s,t,e){if(!s||!s.projects||s.projects.length===0)return;let r=0,i=10;for(;r<i;){try{let a=await t.cacheManager.getTaskInfo(s.path);if(a&&a.dateModified===s.dateModified)break}catch(a){}await new Promise(a=>setTimeout(a,10)),r++}let n=e.querySelectorAll(".task-card__chevron--expanded");for(let a of n){let o=a.closest(".task-card");if(!o)continue;let l=o.dataset.taskPath;if(!l)continue;let c=t.app.vault.getAbstractFileByPath(l);if(!(c instanceof ce.TFile))continue;let d=c.basename;if(s.projects.flat(2).some(h=>{if(h&&typeof h=="string"&&h.startsWith("[[")&&h.endsWith("]]")){let p=h.slice(2,-2).trim(),f=t.app.metadataCache.getFirstLinkpathDest(p,"");return p===d||f&&f.path===l}return h===d||h===l})&&o.querySelector(".task-card__subtasks"))try{let p=await t.cacheManager.getTaskInfo(l);p&&await Qc(o,p,t,!0)}catch(p){console.error("Error refreshing parent task subtasks:",p)}}}var ce,Py,oM,lM,Iy,Ss=v(()=>{ce=require("obsidian");Wf();ht();Se();Za();hh();El();Ay();iu();Py={showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1};oM={due:s=>s.due,scheduled:s=>s.scheduled,projects:s=>s.projects,contexts:s=>s.contexts,tags:s=>s.tags,timeEstimate:s=>s.timeEstimate,totalTrackedTime:s=>s.totalTrackedTime,recurrence:s=>s.recurrence,completedDate:s=>s.completedDate,"file.ctime":s=>s.dateCreated,"file.mtime":s=>s.dateModified};lM={due:(s,t,e,r)=>{typeof t=="string"&&i1(s,t,e,r)},scheduled:(s,t,e,r)=>{typeof t=="string"&&s1(s,t,e,r)},projects:(s,t,e,r)=>{Array.isArray(t)&&o1(s,t,r)},contexts:(s,t)=>{if(Array.isArray(t)){let e=cM(t);s.textContent=`@${e.join(", @")}`}},tags:(s,t)=>{if(Array.isArray(t)){let e=cM(t);s.textContent=`#${e.join(" #")}`}},timeEstimate:(s,t,e,r)=>{typeof t=="number"&&(s.textContent=`${r.formatTime(t)} estimated`)},totalTrackedTime:(s,t,e,r)=>{typeof t=="number"&&(s.textContent=`${r.formatTime(t)} tracked`)},recurrence:(s,t)=>{typeof t=="string"&&(s.textContent=`Recurring: ${ja(t)}`)},completedDate:(s,t)=>{typeof t=="string"&&(s.textContent=`Completed: ${zt(t,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!1})}`)},"file.ctime":(s,t)=>{typeof t=="string"&&(s.textContent=`Created: ${zt(t,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!1})}`)},"file.mtime":(s,t)=>{typeof t=="string"&&(s.textContent=`Modified: ${zt(t,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!1})}`)}};Iy=class extends ce.Modal{constructor(t,e,r,i){super(t),this.task=e,this.plugin=r,this.onConfirm=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Delete Task"});let e=t.createEl("p");e.appendText('Are you sure you want to delete the task "'),e.createEl("strong",{text:this.task.title}),e.appendText('"?'),t.createEl("p",{cls:"mod-warning",text:"This action cannot be undone. The task file will be permanently deleted."});let r=t.createEl("div",{cls:"modal-button-container"});r.style.display="flex",r.style.gap="10px",r.style.justifyContent="flex-end",r.style.marginTop="20px";let i=r.createEl("button",{text:"Cancel"});i.addEventListener("click",()=>{this.close()});let n=r.createEl("button",{text:"Delete",cls:"mod-warning"});n.style.backgroundColor="var(--color-red)",n.style.color="white",n.addEventListener("click",async()=>{try{await this.onConfirm(),this.close(),new ce.Notice("Task deleted successfully")}catch(a){let o=a instanceof Error?a.message:String(a);new ce.Notice(`Failed to delete task: ${o}`),console.error("Error in delete confirmation:",a)}}),i.focus()}onClose(){let{contentEl:t}=this;t.empty()}}});var EM={};Ur(EM,{TaskLinkDetectionService:()=>td});var ha,td,Oy=v(()=>{ha=require("obsidian"),td=class{constructor(t){this.linkCache=new Map;this.plugin=t}async detectTaskLink(t,e,r="wikilink"){let i=r==="wikilink"?this.parseWikilink(t):this.parseMarkdownLink(t);if(!i)return{isValidTaskLink:!1};let{linkPath:n,displayText:a}=i,o=`${e}:${n}`,l=this.linkCache.get(o);if(l){let h=this.plugin.app.vault.getAbstractFileByPath(n);if(h instanceof ha.TFile&&h.stat.mtime===l.lastModified)return l.result}let c=this.resolveLinkPath(n,e);if(!c){let h={isValidTaskLink:!1};return this.cacheResult(o,h,0),h}let d=this.plugin.app.vault.getAbstractFileByPath(c);if(!(d instanceof ha.TFile)){let h={isValidTaskLink:!1};return this.cacheResult(o,h,0),h}try{let h=await this.plugin.cacheManager.getTaskInfo(c);if(h){let p={isValidTaskLink:!0,taskPath:c,taskInfo:h,displayText:a};return this.cacheResult(o,p,d.stat.mtime),p}}catch(h){console.debug("TaskLinkDetectionService: Error checking task info for link:",c,h)}let u={isValidTaskLink:!1};return this.cacheResult(o,u,d.stat.mtime),u}parseWikilink(t){let e=t.slice(2,-2).trim();if(!e)return null;let r=e.indexOf("|");if(r!==-1){let n=e.slice(0,r).trim(),a=e.slice(r+1).trim();return!n||!a?null:{linkPath:(0,ha.parseLinktext)(n).path,displayText:a}}let i=(0,ha.parseLinktext)(e);return{linkPath:i.path,displayText:i.subpath||void 0}}parseMarkdownLink(t){let e=t.match(/^\[([^\]]*)\]\(([^)]+)\)$/);if(!e)return null;let r=e[1].trim(),i=e[2].trim();if(!i)return null;try{i=decodeURIComponent(i)}catch(a){console.debug("TaskLinkDetectionService: Failed to decode URI component:",i,a)}let n=(0,ha.parseLinktext)(i);return{linkPath:n.path,displayText:r||n.subpath||void 0}}resolveLinkPath(t,e){try{let r=this.plugin.app.metadataCache.getFirstLinkpathDest(t,e);return(r==null?void 0:r.path)||null}catch(r){return console.debug("Error resolving link path:",t,r),null}}cacheResult(t,e,r){if(this.linkCache.set(t,{result:e,lastModified:r}),this.linkCache.size>1e3){let i=this.linkCache.keys().next().value;this.linkCache.delete(i)}}clearCacheForFile(t){for(let[e]of this.linkCache)e.includes(t)&&this.linkCache.delete(e)}clearCache(){this.linkCache.clear()}findWikilinks(t){let e=[],r=/\[\[([^\]]+)\]\]/g,i;for(;(i=r.exec(t))!==null;)e.push({match:i[0],start:i.index,end:i.index+i[0].length,type:"wikilink"});let n=/\[([^\]]*)\]\(([^)]+)\)/g;for(r.lastIndex=0;(i=n.exec(t))!==null;)e.push({match:i[0],start:i.index,end:i.index+i[0].length,type:"markdown"});return e.sort((a,o)=>a.start-o.start)}cleanup(){this.linkCache.clear()}}});var DM,Nt,No,Fy=v(()=>{DM=require("@codemirror/view"),Nt=require("obsidian");Se();ht();Kh();Za();hh();El();Ay();No=class s extends DM.WidgetType{constructor(t,e,r,i){super(),this.taskInfo=t,this.plugin=e,this.originalText=r,this.displayText=i}toDOM(t){let e=document.createElement("span"),r=this.plugin.selectedDate||(()=>{let h=new Date;return new Date(Date.UTC(h.getFullYear(),h.getMonth(),h.getDate()))})(),i=this.taskInfo.recurrence?Ii(this.taskInfo,r):this.taskInfo.status,n=["tasknotes-plugin","task-inline-preview"];this.taskInfo.priority&&n.push(`task-inline-preview--priority-${this.taskInfo.priority}`),this.plugin.statusManager.isCompletedStatus(i)&&n.push("task-inline-preview--completed"),e.className=n.join(" ");let a=this.plugin.statusManager.getStatusConfig(i),o=e.createEl("span",{cls:"task-inline-preview__status-dot"});if((0,Nt.setTooltip)(o,`Status: ${a?a.label:i}`,{placement:"top"}),a&&(o.style.borderColor=a.color,this.plugin.statusManager.isCompletedStatus(i)?o.style.backgroundColor=a.color:o.style.backgroundColor="transparent"),o.addEventListener("click",async h=>{h.stopPropagation(),h.preventDefault();try{if(this.taskInfo.recurrence){let p=await this.plugin.toggleRecurringTaskComplete(this.taskInfo,r),f=Ii(p,r),m=this.plugin.statusManager.getStatusConfig(f),g=this.plugin.statusManager.isCompletedStatus(f);m&&(o.style.borderColor=m.color,g?o.style.backgroundColor=m.color:o.style.backgroundColor="transparent"),g?e.classList.add("task-inline-preview--completed"):e.classList.remove("task-inline-preview--completed"),this.taskInfo=p}else{let p=await this.plugin.cacheManager.getTaskInfo(this.taskInfo.path);if(!p)return;let f=p.status||"open",m=this.plugin.statusManager.getNextStatus(f);await this.plugin.updateTaskProperty(p,"status",m),this.taskInfo.status=m;let g=this.plugin.statusManager.getStatusConfig(m);g&&(o.style.borderColor=g.color),this.plugin.statusManager.isCompletedStatus(m)?(e.classList.add("task-inline-preview--completed"),g&&(o.style.backgroundColor=g.color)):(e.classList.remove("task-inline-preview--completed"),o.style.backgroundColor="transparent")}setTimeout(()=>{t&&typeof t.dispatch=="function"&&vn(t,this.taskInfo.path)},50)}catch(p){console.error("Error cycling task status in inline widget:",p)}}),this.taskInfo.priority){let h=this.plugin.priorityManager.getPriorityConfig(this.taskInfo.priority);if(h){let p=e.createEl("span",{cls:"task-inline-preview__priority-dot task-card__priority-dot"});(0,Nt.setTooltip)(p,`Priority: ${h.label} (click to change)`,{placement:"top"}),p.style.backgroundColor=h.color,p.addEventListener("click",f=>{f.stopPropagation(),f.preventDefault(),new ws({currentValue:this.taskInfo.priority,onSelect:async g=>{try{await this.plugin.updateTaskProperty(this.taskInfo,"priority",g),this.taskInfo.priority=g;let y=this.plugin.priorityManager.getPriorityConfig(g);y&&(p.style.backgroundColor=y.color,(0,Nt.setTooltip)(p,`Priority: ${y.label} (click to change)`,{placement:"top"}))}catch(y){console.error("Error updating priority:",y),new Nt.Notice("Failed to update priority")}},plugin:this.plugin}).show(f)})}}let l=this.taskInfo.title.length>80?this.taskInfo.title.slice(0,77)+"...":this.taskInfo.title;if(e.createEl("span",{cls:"task-inline-preview__title",text:l}),this.taskInfo.due){let h=zt(this.taskInfo.due,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0}),p=zt(this.taskInfo.due,{dateFormat:"MMM d, yyyy",timeFormat:"h:mm a",showTime:!0}),f=e.createEl("span",{cls:"task-inline-preview__date task-inline-preview__date--due task-card__metadata-date task-card__metadata-date--due"});(0,Nt.setTooltip)(f,`Due: ${p} (click to change)`,{placement:"top"});let m=f.createEl("span",{cls:"task-inline-preview__date-icon"});(0,Nt.setIcon)(m,"calendar"),f.appendText(h),f.addEventListener("click",g=>{g.stopPropagation(),g.preventDefault(),new yr({currentValue:ue(this.taskInfo.due||""),currentTime:jt(this.taskInfo.due||""),onSelect:async(w,T)=>{try{let S;w?T?S=`${w}T${T}`:S=w:S=void 0,await this.plugin.updateTaskProperty(this.taskInfo,"due",S),this.taskInfo.due=S}catch(S){console.error("Error updating due date:",S),new Nt.Notice("Failed to update due date")}}}).show(g)})}if(this.taskInfo.scheduled&&(!this.taskInfo.due||this.taskInfo.scheduled!==this.taskInfo.due)){let h=zt(this.taskInfo.scheduled,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0}),p=zt(this.taskInfo.scheduled,{dateFormat:"MMM d, yyyy",timeFormat:"h:mm a",showTime:!0}),f=e.createEl("span",{cls:"task-inline-preview__date task-inline-preview__date--scheduled task-card__metadata-date task-card__metadata-date--scheduled"});(0,Nt.setTooltip)(f,`Scheduled: ${p} (click to change)`,{placement:"top"});let m=f.createEl("span",{cls:"task-inline-preview__date-icon"});(0,Nt.setIcon)(m,"clock"),f.appendText(h),f.addEventListener("click",g=>{g.stopPropagation(),g.preventDefault(),new yr({currentValue:ue(this.taskInfo.scheduled||""),currentTime:jt(this.taskInfo.scheduled||""),onSelect:async(w,T)=>{try{let S;w?T?S=`${w}T${T}`:S=w:S=void 0,await this.plugin.updateTaskProperty(this.taskInfo,"scheduled",S),this.taskInfo.scheduled=S}catch(S){console.error("Error updating scheduled date:",S),new Nt.Notice("Failed to update scheduled date")}}}).show(g)})}if(this.taskInfo.recurrence){let h=e.createEl("span",{cls:"task-inline-preview__recurring-indicator",attr:{"aria-label":"Recurring task (click to change)"}});(0,Nt.setTooltip)(h,"Recurring task (click to change)",{placement:"top"}),(0,Nt.setIcon)(h,"rotate-ccw"),h.addEventListener("click",p=>{p.stopPropagation(),p.preventDefault(),new Pi({currentValue:typeof this.taskInfo.recurrence=="string"?this.taskInfo.recurrence:void 0,onSelect:async m=>{try{await this.plugin.updateTaskProperty(this.taskInfo,"recurrence",m||void 0),this.taskInfo.recurrence=m||void 0}catch(g){console.error("Error updating recurrence:",g),new Nt.Notice("Failed to update recurrence")}},app:this.plugin.app}).show(p)})}let c=e.createEl("span",{cls:"task-inline-preview__pencil",text:""});(0,Nt.setTooltip)(c,"Task options",{placement:"top"}),(0,Nt.setIcon)(c,"ellipsis-vertical"),e.dataset.taskPath=this.taskInfo.path,e.dataset.originalText=this.originalText,this.addDragHandlers(e),c.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.showTaskContextMenu(h,e)});let{clickHandler:d,dblclickHandler:u}=Rh({task:this.taskInfo,plugin:this.plugin,excludeSelector:".task-inline-preview__pencil"});return e.addEventListener("click",async h=>{h.preventDefault(),h.stopPropagation(),await d(h)}),e.addEventListener("dblclick",async h=>{h.preventDefault(),h.stopPropagation(),await u(h)}),e.addEventListener("contextmenu",async h=>{h.preventDefault(),h.stopPropagation(),await this.showTaskContextMenu(h,e)}),e.addEventListener("mouseover",Oh(this.taskInfo,this.plugin)),e}addDragHandlers(t){this.plugin.dragDropManager.makeTaskCardDraggable(t,this.taskInfo.path)}async showTaskContextMenu(t,e){try{let{showTaskContextMenu:r}=await Promise.resolve().then(()=>(Ss(),Ny)),i=this.plugin.selectedDate||(()=>{let n=new Date;return new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate()))})();await r(t,this.taskInfo.path,this.plugin,i)}catch(r){console.error(`Error showing context menu for task ${this.taskInfo.path}:`,r),await this.plugin.openTaskEditModal(this.taskInfo)}}eq(t){return t instanceof s?this.taskInfo.path===t.taskInfo.path&&this.taskInfo.status===t.taskInfo.status&&this.taskInfo.title===t.taskInfo.title&&this.taskInfo.priority===t.taskInfo.priority&&this.taskInfo.archived===t.taskInfo.archived&&this.taskInfo.due===t.taskInfo.due&&this.taskInfo.scheduled===t.taskInfo.scheduled&&this.taskInfo.recurrence===t.taskInfo.recurrence&&JSON.stringify(this.taskInfo.complete_instances)===JSON.stringify(t.taskInfo.complete_instances)&&this.taskInfo.dateModified===t.taskInfo.dateModified:!1}ignoreEvent(){return!1}get estimatedHeight(){return-1}get block(){return!1}}});function m1(s){let t=new Map;return qi.ViewPlugin.fromClass(class{constructor(e){this.decorations=this.buildDecorations(e)}update(e){var i,n;if(!((i=s==null?void 0:s.settings)!=null&&i.enableTaskLinkOverlay)){this.decorations=qi.Decoration.none;return}try{if(!e.state.field(Ds.editorLivePreviewField)){this.decorations=qi.Decoration.none;return}}catch(a){this.decorations=qi.Decoration.none;return}let r=e.transactions.some(a=>a.effects.some(o=>o.is(Ly)));if(e.docChanged||e.selectionSet||r){if(r){let a=(n=e.transactions.flatMap(o=>o.effects).find(o=>o.is(Ly)))==null?void 0:n.value;if(a!=null&&a.taskPath)for(let[o]of t.entries())o.includes(a.taskPath)&&t.delete(o);else t.clear()}this.decorations=this.buildDecorations(e.view)}}buildDecorations(e){var r;try{return(r=s==null?void 0:s.settings)!=null&&r.enableTaskLinkOverlay?e.state.field(Ds.editorLivePreviewField)?g1(e.state,s,t):qi.Decoration.none:qi.Decoration.none}catch(i){return console.error("Error building task link decorations:",i),qi.Decoration.none}}},{decorations:e=>e.decorations})}function g1(s,t,e){var l,c;let r=new Zh.RangeSetBuilder;if(!s||!t||!e)return r.finish();let i=s.doc;if(!i||!t.app||!t.app.workspace)return r.finish();let n=t.taskLinkDetectionService||new td(t),a=t.app.workspace.getActiveViewOfType(Ds.MarkdownView);if(!a)return r.finish();let o=(l=a.file)==null?void 0:l.path;if(!o||typeof o!="string"||o.length===0)return r.finish();try{let d=i.toString();if(typeof d!="string"||d.length>1e5)return r.finish();let u=(c=s.selection)==null?void 0:c.main.head,h=n.findWikilinks(d);if(!Array.isArray(h))return r.finish();for(let p of h)try{if(!p||typeof p.match!="string"||typeof p.start!="number"||typeof p.end!="number"||p.start<0||p.end<=p.start||p.start>=d.length||p.end>d.length)continue;let f=p.type==="wikilink"?y1(p.match):v1(p.match);if(!f)continue;let{linkPath:m}=f;if(!m||typeof m!="string"||m.trim().length===0)continue;let g=w1(m,o,t);if(!g)continue;let y=T1(g,t);if(y){if(!y.title||typeof y.title!="string"||u!==void 0&&u>=p.start&&u<p.end)continue;let w=`${g}-${p.start}-${p.end}`,T=new No(y,t,p.match,f.displayText),S=e.get(w);(!S||!S.eq(T))&&e.set(w,T);let x=qi.Decoration.replace({widget:e.get(w),inclusive:!0});r.add(p.start,p.end,x)}}catch(f){continue}}catch(d){console.error("Error in buildTaskLinkDecorations:",d)}return r.finish()}function y1(s){if(!s||typeof s!="string"||s.length<4||!s.startsWith("[[")||!s.endsWith("]]"))return null;let t=s.slice(2,-2).trim();if(!t||t.length===0||t.length>500)return null;let e=t.indexOf("|");if(e!==-1){let i=t.slice(0,e).trim(),n=t.slice(e+1).trim();if(!i||!n)return null;let a=(0,Ds.parseLinktext)(i);return a.path?{linkPath:a.path,displayText:n}:null}let r=(0,Ds.parseLinktext)(t);return r.path?{linkPath:r.path,displayText:r.subpath||void 0}:null}function v1(s){if(!s||typeof s!="string")return null;let t=s.match(/^\[([^\]]*)\]\(([^)]+)\)$/);if(!t)return null;let e=t[1].trim(),r=t[2].trim();if(!r||r.length===0||r.length>500)return null;try{r=decodeURIComponent(r)}catch(n){}let i=(0,Ds.parseLinktext)(r);return i.path?{linkPath:i.path,displayText:e||i.subpath||void 0}:null}function w1(s,t,e){if(!s||typeof s!="string"||s.trim().length===0||!t||typeof t!="string"||!e||!e.app||!e.app.metadataCache)return null;try{let r=s.replace(/\.\./g,"").trim();if(!r)return null;let i=e.app.metadataCache.getFirstLinkpathDest(r,t);return!i||!i.path||typeof i.path!="string"?null:i.path}catch(r){return null}}function T1(s,t){if(!s||typeof s!="string"||s.trim().length===0||!t)return null;try{let e=/[<>:"|?*]/,r=s.split("").some(a=>{let o=a.charCodeAt(0);return o<=31||o===127});if(e.test(s)||r)return null;let i=t.cacheManager;if(!i||!i.getCachedTaskInfoSync)return null;let n=i.getCachedTaskInfoSync(s);return n&&typeof n=="object"&&n.title?n:null}catch(e){return null}}function CM(s){return m1(s)}function vn(s,t){if(!s||typeof s.dispatch!="function"){console.warn("Invalid EditorView passed to dispatchTaskUpdate:",s);return}try{s.dispatch({effects:[Ly.of({taskPath:t})]})}catch(e){console.error("Error dispatching task update:",e)}}var Zh,qi,Ds,Ly,Kh=v(()=>{Zh=require("@codemirror/state"),qi=require("@codemirror/view"),Ds=require("obsidian");Oy();Fy();Ly=Zh.StateEffect.define()});var qM=hd(()=>{var zM;(function(s){(function(t){var e=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:o(),r=i(s);typeof e.Reflect!="undefined"&&(r=i(e.Reflect,r)),t(r,e),typeof e.Reflect=="undefined"&&(e.Reflect=s);function i(l,c){return function(d,u){Object.defineProperty(l,d,{configurable:!0,writable:!0,value:u}),c&&c(d,u)}}function n(){try{return Function("return this;")()}catch(l){}}function a(){try{return(0,eval)("(function() { return this; })()")}catch(l){}}function o(){return n()||a()}})(function(t,e){var r=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",n=i&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",a=i&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",l={__proto__:[]}instanceof Array,c=!o&&!l,d={create:o?function(){return Dp(Object.create(null))}:l?function(){return Dp({__proto__:null})}:function(){return Dp({})},has:c?function(M,O){return r.call(M,O)}:function(M,O){return O in M},get:c?function(M,O){return r.call(M,O)?M[O]:void 0}:function(M,O){return M[O]}},u=Object.getPrototypeOf(Function),h=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:x_(),p=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:M_(),f=typeof WeakMap=="function"?WeakMap:__(),m=i?Symbol.for("@reflect-metadata:registry"):void 0,g=E_(),y=D_(g);function w(M,O,B,Y){if(W(B)){if(!Cn(M))throw new TypeError;if(!nv(O))throw new TypeError;return k(M,O)}else{if(!Cn(M))throw new TypeError;if(!Be(O))throw new TypeError;if(!Be(Y)&&!W(Y)&&!Re(Y))throw new TypeError;return Re(Y)&&(Y=void 0),B=Mt(B),D(M,O,B,Y)}}t("decorate",w);function T(M,O){function B(Y,le){if(!Be(Y))throw new TypeError;if(!W(le)&&!k_(le))throw new TypeError;H(M,O,Y,le)}return B}t("metadata",T);function S(M,O,B,Y){if(!Be(B))throw new TypeError;return W(Y)||(Y=Mt(Y)),H(M,O,B,Y)}t("defineMetadata",S);function x(M,O,B){if(!Be(O))throw new TypeError;return W(B)||(B=Mt(B)),_(M,O,B)}t("hasMetadata",x);function I(M,O,B){if(!Be(O))throw new TypeError;return W(B)||(B=Mt(B)),$(M,O,B)}t("hasOwnMetadata",I);function F(M,O,B){if(!Be(O))throw new TypeError;return W(B)||(B=Mt(B)),U(M,O,B)}t("getMetadata",F);function A(M,O,B){if(!Be(O))throw new TypeError;return W(B)||(B=Mt(B)),R(M,O,B)}t("getOwnMetadata",A);function L(M,O){if(!Be(M))throw new TypeError;return W(O)||(O=Mt(O)),j(M,O)}t("getMetadataKeys",L);function G(M,O){if(!Be(M))throw new TypeError;return W(O)||(O=Mt(O)),re(M,O)}t("getOwnMetadataKeys",G);function V(M,O,B){if(!Be(O))throw new TypeError;if(W(B)||(B=Mt(B)),!Be(O))throw new TypeError;W(B)||(B=Mt(B));var Y=Vo(O,B,!1);return W(Y)?!1:Y.OrdinaryDeleteMetadata(M,O,B)}t("deleteMetadata",V);function k(M,O){for(var B=M.length-1;B>=0;--B){var Y=M[B],le=Y(O);if(!W(le)&&!Re(le)){if(!nv(le))throw new TypeError;O=le}}return O}function D(M,O,B,Y){for(var le=M.length-1;le>=0;--le){var lt=M[le],Tt=lt(O,B,Y);if(!W(Tt)&&!Re(Tt)){if(!Be(Tt))throw new TypeError;Y=Tt}}return Y}function _(M,O,B){var Y=$(M,O,B);if(Y)return!0;var le=Ep(O);return Re(le)?!1:_(M,le,B)}function $(M,O,B){var Y=Vo(O,B,!1);return W(Y)?!1:se(Y.OrdinaryHasOwnMetadata(M,O,B))}function U(M,O,B){var Y=$(M,O,B);if(Y)return R(M,O,B);var le=Ep(O);if(!Re(le))return U(M,le,B)}function R(M,O,B){var Y=Vo(O,B,!1);if(!W(Y))return Y.OrdinaryGetOwnMetadata(M,O,B)}function H(M,O,B,Y){var le=Vo(B,Y,!0);le.OrdinaryDefineOwnMetadata(M,O,B,Y)}function j(M,O){var B=re(M,O),Y=Ep(M);if(Y===null)return B;var le=j(Y,O);if(le.length<=0)return B;if(B.length<=0)return le;for(var lt=new p,Tt=[],Te=0,Q=B;Te<Q.length;Te++){var J=Q[Te],ee=lt.has(J);ee||(lt.add(J),Tt.push(J))}for(var ie=0,be=le;ie<be.length;ie++){var J=be[ie],ee=lt.has(J);ee||(lt.add(J),Tt.push(J))}return Tt}function re(M,O){var B=Vo(M,O,!1);return B?B.OrdinaryOwnMetadataKeys(M,O):[]}function he(M){if(M===null)return 1;switch(typeof M){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return M===null?1:6;default:return 6}}function W(M){return M===void 0}function Re(M){return M===null}function ir(M){return typeof M=="symbol"}function Be(M){return typeof M=="object"?M!==null:typeof M=="function"}function Ns(M,O){switch(he(M)){case 0:return M;case 1:return M;case 2:return M;case 3:return M;case 4:return M;case 5:return M}var B=O===3?"string":O===5?"number":"default",Y=av(M,n);if(Y!==void 0){var le=Y.call(M,B);if(Be(le))throw new TypeError;return le}return Z(M,B==="default"?"number":B)}function Z(M,O){if(O==="string"){var B=M.toString;if(va(B)){var Y=B.call(M);if(!Be(Y))return Y}var le=M.valueOf;if(va(le)){var Y=le.call(M);if(!Be(Y))return Y}}else{var le=M.valueOf;if(va(le)){var Y=le.call(M);if(!Be(Y))return Y}var lt=M.toString;if(va(lt)){var Y=lt.call(M);if(!Be(Y))return Y}}throw new TypeError}function se(M){return!!M}function nt(M){return""+M}function Mt(M){var O=Ns(M,3);return ir(O)?O:nt(O)}function Cn(M){return Array.isArray?Array.isArray(M):M instanceof Object?M instanceof Array:Object.prototype.toString.call(M)==="[object Array]"}function va(M){return typeof M=="function"}function nv(M){return typeof M=="function"}function k_(M){switch(he(M)){case 3:return!0;case 4:return!0;default:return!1}}function Sp(M,O){return M===O||M!==M&&O!==O}function av(M,O){var B=M[O];if(B!=null){if(!va(B))throw new TypeError;return B}}function ov(M){var O=av(M,a);if(!va(O))throw new TypeError;var B=O.call(M);if(!Be(B))throw new TypeError;return B}function lv(M){return M.value}function cv(M){var O=M.next();return O.done?!1:O}function dv(M){var O=M.return;O&&O.call(M)}function Ep(M){var O=Object.getPrototypeOf(M);if(typeof M!="function"||M===u||O!==u)return O;var B=M.prototype,Y=B&&Object.getPrototypeOf(B);if(Y==null||Y===Object.prototype)return O;var le=Y.constructor;return typeof le!="function"||le===M?O:le}function S_(){var M;!W(m)&&typeof e.Reflect!="undefined"&&!(m in e.Reflect)&&typeof e.Reflect.defineMetadata=="function"&&(M=C_(e.Reflect));var O,B,Y,le=new f,lt={registerProvider:Tt,getProvider:Q,setProvider:ee};return lt;function Tt(ie){if(!Object.isExtensible(lt))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case M===ie:break;case W(O):O=ie;break;case O===ie:break;case W(B):B=ie;break;case B===ie:break;default:Y===void 0&&(Y=new p),Y.add(ie);break}}function Te(ie,be){if(!W(O)){if(O.isProviderFor(ie,be))return O;if(!W(B)){if(B.isProviderFor(ie,be))return O;if(!W(Y))for(var Ke=ov(Y);;){var ct=cv(Ke);if(!ct)return;var ci=lv(ct);if(ci.isProviderFor(ie,be))return dv(Ke),ci}}}if(!W(M)&&M.isProviderFor(ie,be))return M}function Q(ie,be){var Ke=le.get(ie),ct;return W(Ke)||(ct=Ke.get(be)),W(ct)&&(ct=Te(ie,be),W(ct)||(W(Ke)&&(Ke=new h,le.set(ie,Ke)),Ke.set(be,ct))),ct}function J(ie){if(W(ie))throw new TypeError;return O===ie||B===ie||!W(Y)&&Y.has(ie)}function ee(ie,be,Ke){if(!J(Ke))throw new Error("Metadata provider not registered.");var ct=Q(ie,be);if(ct!==Ke){if(!W(ct))return!1;var ci=le.get(ie);W(ci)&&(ci=new h,le.set(ie,ci)),ci.set(be,Ke)}return!0}}function E_(){var M;return!W(m)&&Be(e.Reflect)&&Object.isExtensible(e.Reflect)&&(M=e.Reflect[m]),W(M)&&(M=S_()),!W(m)&&Be(e.Reflect)&&Object.isExtensible(e.Reflect)&&Object.defineProperty(e.Reflect,m,{enumerable:!1,configurable:!1,writable:!1,value:M}),M}function D_(M){var O=new f,B={isProviderFor:function(J,ee){var ie=O.get(J);return W(ie)?!1:ie.has(ee)},OrdinaryDefineOwnMetadata:Tt,OrdinaryHasOwnMetadata:le,OrdinaryGetOwnMetadata:lt,OrdinaryOwnMetadataKeys:Te,OrdinaryDeleteMetadata:Q};return g.registerProvider(B),B;function Y(J,ee,ie){var be=O.get(J),Ke=!1;if(W(be)){if(!ie)return;be=new h,O.set(J,be),Ke=!0}var ct=be.get(ee);if(W(ct)){if(!ie)return;if(ct=new h,be.set(ee,ct),!M.setProvider(J,ee,B))throw be.delete(ee),Ke&&O.delete(J),new Error("Wrong provider for target.")}return ct}function le(J,ee,ie){var be=Y(ee,ie,!1);return W(be)?!1:se(be.has(J))}function lt(J,ee,ie){var be=Y(ee,ie,!1);if(!W(be))return be.get(J)}function Tt(J,ee,ie,be){var Ke=Y(ie,be,!0);Ke.set(J,ee)}function Te(J,ee){var ie=[],be=Y(J,ee,!1);if(W(be))return ie;for(var Ke=be.keys(),ct=ov(Ke),ci=0;;){var uv=cv(ct);if(!uv)return ie.length=ci,ie;var A_=lv(uv);try{ie[ci]=A_}catch(I_){try{dv(ct)}finally{throw I_}}ci++}}function Q(J,ee,ie){var be=Y(ee,ie,!1);if(W(be)||!be.delete(J))return!1;if(be.size===0){var Ke=O.get(ee);W(Ke)||(Ke.delete(ie),Ke.size===0&&O.delete(Ke))}return!0}}function C_(M){var O=M.defineMetadata,B=M.hasOwnMetadata,Y=M.getOwnMetadata,le=M.getOwnMetadataKeys,lt=M.deleteMetadata,Tt=new f,Te={isProviderFor:function(Q,J){var ee=Tt.get(Q);return!W(ee)&&ee.has(J)?!0:le(Q,J).length?(W(ee)&&(ee=new p,Tt.set(Q,ee)),ee.add(J),!0):!1},OrdinaryDefineOwnMetadata:O,OrdinaryHasOwnMetadata:B,OrdinaryGetOwnMetadata:Y,OrdinaryOwnMetadataKeys:le,OrdinaryDeleteMetadata:lt};return Te}function Vo(M,O,B){var Y=g.getProvider(M,O);if(!W(Y))return Y;if(B){if(g.setProvider(M,O,y))return y;throw new Error("Illegal state.")}}function x_(){var M={},O=[],B=(function(){function Te(Q,J,ee){this._index=0,this._keys=Q,this._values=J,this._selector=ee}return Te.prototype["@@iterator"]=function(){return this},Te.prototype[a]=function(){return this},Te.prototype.next=function(){var Q=this._index;if(Q>=0&&Q<this._keys.length){var J=this._selector(this._keys[Q],this._values[Q]);return Q+1>=this._keys.length?(this._index=-1,this._keys=O,this._values=O):this._index++,{value:J,done:!1}}return{value:void 0,done:!0}},Te.prototype.throw=function(Q){throw this._index>=0&&(this._index=-1,this._keys=O,this._values=O),Q},Te.prototype.return=function(Q){return this._index>=0&&(this._index=-1,this._keys=O,this._values=O),{value:Q,done:!0}},Te})(),Y=(function(){function Te(){this._keys=[],this._values=[],this._cacheKey=M,this._cacheIndex=-2}return Object.defineProperty(Te.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Te.prototype.has=function(Q){return this._find(Q,!1)>=0},Te.prototype.get=function(Q){var J=this._find(Q,!1);return J>=0?this._values[J]:void 0},Te.prototype.set=function(Q,J){var ee=this._find(Q,!0);return this._values[ee]=J,this},Te.prototype.delete=function(Q){var J=this._find(Q,!1);if(J>=0){for(var ee=this._keys.length,ie=J+1;ie<ee;ie++)this._keys[ie-1]=this._keys[ie],this._values[ie-1]=this._values[ie];return this._keys.length--,this._values.length--,Sp(Q,this._cacheKey)&&(this._cacheKey=M,this._cacheIndex=-2),!0}return!1},Te.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=M,this._cacheIndex=-2},Te.prototype.keys=function(){return new B(this._keys,this._values,le)},Te.prototype.values=function(){return new B(this._keys,this._values,lt)},Te.prototype.entries=function(){return new B(this._keys,this._values,Tt)},Te.prototype["@@iterator"]=function(){return this.entries()},Te.prototype[a]=function(){return this.entries()},Te.prototype._find=function(Q,J){if(!Sp(this._cacheKey,Q)){this._cacheIndex=-1;for(var ee=0;ee<this._keys.length;ee++)if(Sp(this._keys[ee],Q)){this._cacheIndex=ee;break}}return this._cacheIndex<0&&J&&(this._cacheIndex=this._keys.length,this._keys.push(Q),this._values.push(void 0)),this._cacheIndex},Te})();return Y;function le(Te,Q){return Te}function lt(Te,Q){return Q}function Tt(Te,Q){return[Te,Q]}}function M_(){var M=(function(){function O(){this._map=new h}return Object.defineProperty(O.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),O.prototype.has=function(B){return this._map.has(B)},O.prototype.add=function(B){return this._map.set(B,B),this},O.prototype.delete=function(B){return this._map.delete(B)},O.prototype.clear=function(){this._map.clear()},O.prototype.keys=function(){return this._map.keys()},O.prototype.values=function(){return this._map.keys()},O.prototype.entries=function(){return this._map.entries()},O.prototype["@@iterator"]=function(){return this.keys()},O.prototype[a]=function(){return this.keys()},O})();return M}function __(){var M=16,O=d.create(),B=Y();return(function(){function Q(){this._key=Y()}return Q.prototype.has=function(J){var ee=le(J,!1);return ee!==void 0?d.has(ee,this._key):!1},Q.prototype.get=function(J){var ee=le(J,!1);return ee!==void 0?d.get(ee,this._key):void 0},Q.prototype.set=function(J,ee){var ie=le(J,!0);return ie[this._key]=ee,this},Q.prototype.delete=function(J){var ee=le(J,!1);return ee!==void 0?delete ee[this._key]:!1},Q.prototype.clear=function(){this._key=Y()},Q})();function Y(){var Q;do Q="@@WeakMap@@"+Te();while(d.has(O,Q));return O[Q]=!0,Q}function le(Q,J){if(!r.call(Q,B)){if(!J)return;Object.defineProperty(Q,B,{value:d.create()})}return Q[B]}function lt(Q,J){for(var ee=0;ee<J;++ee)Q[ee]=Math.random()*255|0;return Q}function Tt(Q){if(typeof Uint8Array=="function"){var J=new Uint8Array(Q);return typeof crypto!="undefined"?crypto.getRandomValues(J):typeof msCrypto!="undefined"?msCrypto.getRandomValues(J):lt(J,Q),J}return lt(new Array(Q),Q)}function Te(){var Q=Tt(M);Q[6]=Q[6]&79|64,Q[8]=Q[8]&191|128;for(var J="",ee=0;ee<M;++ee){var ie=Q[ee];(ee===4||ee===6||ee===8)&&(J+="-"),ie<16&&(J+="0"),J+=ie.toString(16).toLowerCase()}return J}}function Dp(M){return M.__=void 0,delete M.__,M}})})(zM||(zM={}))});function GM(s){return Reflect.hasMetadata(Zy,s)||Reflect.defineMetadata(Zy,[],s),s}function vp(s,t){return function(e,r,i){Reflect.defineMetadata(K1,{method:s.toLowerCase(),path:t,handler:r},e,r);let n=Reflect.getMetadata("routes",e.constructor)||[];n.push({method:s.toLowerCase(),path:t,handler:r}),Reflect.defineMetadata("routes",n,e.constructor)}}function vt(s){return vp("GET",s)}function wt(s){return vp("POST",s)}function QM(s){return vp("PUT",s)}function wp(s){return vp("DELETE",s)}function KM(s){let t=Reflect.getMetadata(Zy,s.constructor)||[],e={openapi:"3.0.0",info:{title:"TaskNotes API",version:"1.0.0",description:"RESTful API for managing tasks, time tracking, and automation in TaskNotes",contact:{name:"TaskNotes",url:"https://github.com/your-repo/tasknotes"}},servers:[{url:"http://localhost:8080",description:"Local development server"}],security:[{bearerAuth:[]}],paths:{},components:{securitySchemes:{bearerAuth:{type:"http",scheme:"bearer",bearerFormat:"JWT",description:"Optional bearer token for API authentication"}},schemas:Z1()}};for(let r of t)e.paths[r.path]||(e.paths[r.path]={}),e.paths[r.path][r.method]=r.operation;return e}function Z1(){return{APIResponse:{type:"object",properties:{success:{type:"boolean",description:"Whether the request was successful"},data:{description:"Response data (varies by endpoint)"},error:{type:"string",description:"Error message (present when success is false)"},message:{type:"string",description:"Optional success message"}},required:["success"]},Task:{type:"object",properties:{id:{type:"string",description:"Unique task identifier (file path)"},title:{type:"string",description:"Task title",maxLength:200},status:{type:"string",description:"Current task status",enum:["todo","open","completed","in-progress","cancelled"]},priority:{type:"string",description:"Task priority level",enum:["low","normal","medium","high","urgent"]},due:{type:"string",format:"date-time",description:"Due date and time (ISO 8601 format)",nullable:!0},scheduled:{type:"string",format:"date-time",description:"Scheduled date and time (ISO 8601 format)",nullable:!0},path:{type:"string",description:"File path of the task"},archived:{type:"boolean",description:"Whether the task is archived"},tags:{type:"array",items:{type:"string"},description:"Task tags"},contexts:{type:"array",items:{type:"string"},description:"Task contexts (GTD-style)"},projects:{type:"array",items:{type:"string"},description:"Associated projects"},timeEstimate:{type:"integer",minimum:0,description:"Estimated time in minutes",nullable:!0},details:{type:"string",description:"Additional task details/description",nullable:!0},dateCreated:{type:"string",format:"date-time",description:"Task creation timestamp"},dateModified:{type:"string",format:"date-time",description:"Last modification timestamp"}},required:["id","title","status","path"]},TaskCreationData:{type:"object",properties:{title:{type:"string",description:"Task title",maxLength:200},status:{type:"string",description:"Initial task status",enum:["todo","open","in-progress"]},priority:{type:"string",description:"Task priority level",enum:["low","normal","medium","high","urgent"]},due:{type:"string",format:"date-time",description:"Due date and time (ISO 8601 format)"},scheduled:{type:"string",format:"date-time",description:"Scheduled date and time (ISO 8601 format)"},tags:{type:"array",items:{type:"string"},description:"Task tags"},contexts:{type:"array",items:{type:"string"},description:"Task contexts"},projects:{type:"array",items:{type:"string"},description:"Associated projects"},details:{type:"string",description:"Task details/description"},timeEstimate:{type:"integer",minimum:0,description:"Estimated time in minutes"}},required:["title"]},TaskStats:{type:"object",properties:{total:{type:"integer",description:"Total number of tasks"},completed:{type:"integer",description:"Number of completed tasks"},active:{type:"integer",description:"Number of active (non-completed, non-archived) tasks"},overdue:{type:"integer",description:"Number of overdue tasks"},archived:{type:"integer",description:"Number of archived tasks"},withTimeTracking:{type:"integer",description:"Number of tasks with time tracking entries"}},required:["total","completed","active","overdue","archived","withTimeTracking"]},WebhookConfig:{type:"object",properties:{id:{type:"string",description:"Unique webhook identifier"},url:{type:"string",format:"uri",description:"Webhook endpoint URL"},events:{type:"array",items:{type:"string",enum:["task.created","task.updated","task.deleted","task.completed","task.archived","task.unarchived","time.started","time.stopped","pomodoro.started","pomodoro.completed","pomodoro.interrupted","recurring.instance.completed","reminder.triggered"]},description:"Events to subscribe to",minItems:1},active:{type:"boolean",description:"Whether the webhook is active"},transformFile:{type:"string",description:"Optional transform file path for payload customization"},corsHeaders:{type:"boolean",description:"Whether to include custom headers (disable for strict CORS services)"}},required:["url","events"]},PomodoroSession:{type:"object",properties:{id:{type:"string",description:"Unique session identifier"},type:{type:"string",enum:["work","short-break","long-break"],description:"Type of pomodoro session"},duration:{type:"integer",description:"Session duration in seconds"},startTime:{type:"string",format:"date-time",description:"Session start timestamp"},endTime:{type:"string",format:"date-time",description:"Session end timestamp",nullable:!0},task:{$ref:"#/components/schemas/Task",nullable:!0,description:"Associated task (if any)"}},required:["id","type","duration","startTime"]},PomodoroState:{type:"object",properties:{isRunning:{type:"boolean",description:"Whether a pomodoro session is currently running"},timeRemaining:{type:"integer",description:"Time remaining in current session (seconds)"},currentSession:{$ref:"#/components/schemas/PomodoroSession",nullable:!0,description:"Current active session (if any)"},nextSessionType:{type:"string",enum:["work","short-break","long-break"],nullable:!0,description:"Suggested next session type"},totalPomodoros:{type:"integer",description:"Total completed pomodoros (all time)"},currentStreak:{type:"integer",description:"Current consecutive pomodoro streak"},totalMinutesToday:{type:"integer",description:"Total focused minutes today"}},required:["isRunning","timeRemaining"]},PomodoroSessionHistory:{type:"object",properties:{id:{type:"string",description:"Session identifier"},type:{type:"string",enum:["work","short-break","long-break"]},startTime:{type:"string",format:"date-time"},endTime:{type:"string",format:"date-time"},duration:{type:"integer",description:"Actual session duration in seconds"},completed:{type:"boolean",description:"Whether the session was completed (not interrupted)"},taskPath:{type:"string",nullable:!0,description:"Associated task file path"},taskTitle:{type:"string",nullable:!0,description:"Associated task title"}},required:["id","type","startTime","endTime","duration","completed"]},PomodoroStats:{type:"object",properties:{totalSessions:{type:"integer",description:"Total number of sessions"},completedSessions:{type:"integer",description:"Number of completed sessions"},interruptedSessions:{type:"integer",description:"Number of interrupted sessions"},totalFocusTime:{type:"integer",description:"Total focused time in minutes"},workSessions:{type:"integer",description:"Number of work sessions"},breakSessions:{type:"integer",description:"Number of break sessions"},longestStreak:{type:"integer",description:"Longest consecutive completed sessions"},averageSessionLength:{type:"number",description:"Average session length in minutes"}},required:["totalSessions","completedSessions","interruptedSessions","totalFocusTime"]},TimeEntry:{type:"object",properties:{startTime:{type:"string",format:"date-time",description:"ISO timestamp when time tracking started"},endTime:{type:"string",format:"date-time",nullable:!0,description:"ISO timestamp when time tracking ended (null if still running)"},description:{type:"string",nullable:!0,description:"Optional description of work being tracked"},duration:{type:"integer",minimum:0,description:"Duration in minutes (calculated or manually set)"},isActive:{type:"boolean",description:"Whether this time entry is currently active"}},required:["startTime","duration","isActive"]},ActiveTimeSession:{type:"object",properties:{task:{type:"object",properties:{id:{type:"string",description:"Task identifier (file path)"},title:{type:"string",description:"Task title"},status:{type:"string",description:"Task status"},priority:{type:"string",description:"Task priority"},tags:{type:"array",items:{type:"string"},description:"Task tags"},projects:{type:"array",items:{type:"string"},description:"Associated projects"}},required:["id","title","status"]},session:{type:"object",properties:{startTime:{type:"string",format:"date-time",description:"When the session started"},description:{type:"string",nullable:!0,description:"Session description"},elapsedMinutes:{type:"integer",minimum:0,description:"Minutes elapsed since session started"}},required:["startTime","elapsedMinutes"]},elapsedMinutes:{type:"integer",minimum:0,description:"Total elapsed minutes for this session"}},required:["task","session","elapsedMinutes"]},TimeSummary:{type:"object",properties:{period:{type:"string",enum:["today","week","month","all","custom"],description:"Time period for the summary"},dateRange:{type:"object",properties:{from:{type:"string",format:"date-time",description:"Start date of the summary period"},to:{type:"string",format:"date-time",description:"End date of the summary period"}},required:["from","to"]},summary:{type:"object",properties:{totalMinutes:{type:"integer",minimum:0,description:"Total tracked time in minutes"},totalHours:{type:"number",minimum:0,description:"Total tracked time in hours (rounded to 2 decimals)"},tasksWithTime:{type:"integer",minimum:0,description:"Number of tasks with time tracking data"},activeTasks:{type:"integer",minimum:0,description:"Number of tasks with active time tracking"},completedTasks:{type:"integer",minimum:0,description:"Number of completed tasks with time tracking"}},required:["totalMinutes","totalHours","tasksWithTime","activeTasks","completedTasks"]},topTasks:{type:"array",items:{type:"object",properties:{task:{type:"string",description:"Task identifier"},title:{type:"string",description:"Task title"},minutes:{type:"integer",minimum:0,description:"Total minutes tracked for this task"}},required:["task","title","minutes"]},description:"Top 10 tasks by time tracked"},topProjects:{type:"array",items:{type:"object",properties:{project:{type:"string",description:"Project name"},minutes:{type:"integer",minimum:0,description:"Total minutes tracked for this project"}},required:["project","minutes"]},description:"Top 10 projects by time tracked"},topTags:{type:"array",items:{type:"object",properties:{tag:{type:"string",description:"Tag name"},minutes:{type:"integer",minimum:0,description:"Total minutes tracked for this tag"}},required:["tag","minutes"]},description:"Top 10 tags by time tracked"}},required:["period","dateRange","summary","topTasks","topProjects","topTags"]},TaskTimeData:{type:"object",properties:{task:{type:"object",properties:{id:{type:"string",description:"Task identifier (file path)"},title:{type:"string",description:"Task title"},status:{type:"string",description:"Task status"},priority:{type:"string",description:"Task priority"}},required:["id","title","status"]},summary:{type:"object",properties:{totalMinutes:{type:"integer",minimum:0,description:"Total time tracked for this task in minutes"},totalHours:{type:"number",minimum:0,description:"Total time tracked for this task in hours"},totalSessions:{type:"integer",minimum:0,description:"Total number of time tracking sessions"},completedSessions:{type:"integer",minimum:0,description:"Number of completed sessions"},activeSessions:{type:"integer",minimum:0,maximum:1,description:"Number of active sessions (0 or 1)"},averageSessionMinutes:{type:"number",minimum:0,description:"Average session length in minutes"}},required:["totalMinutes","totalHours","totalSessions","completedSessions","activeSessions","averageSessionMinutes"]},activeSession:{type:"object",nullable:!0,properties:{startTime:{type:"string",format:"date-time",description:"When the active session started"},description:{type:"string",nullable:!0,description:"Description of the active session"},elapsedMinutes:{type:"integer",minimum:0,description:"Minutes elapsed since session started"}},required:["startTime","elapsedMinutes"]},timeEntries:{type:"array",items:{$ref:"#/components/schemas/TimeEntry"},description:"All time entries for this task"}},required:["task","summary","timeEntries"]},Error:{type:"object",properties:{success:{type:"boolean",enum:[!1]},error:{type:"string",description:"Error message describing what went wrong"}},required:["success","error"]}}}function ZM(s){return Reflect.getMetadata("routes",s)||[]}var Kte,Zte,Zy,K1,Sn=v(()=>{Kte=bt(qM()),Zte=Symbol("openapi:operation"),Zy=Symbol("openapi:endpoints"),K1=Symbol("route")});var JM,Tp,XM=v(()=>{JM=require("url");Sn();Tp=class{constructor(){this.routes=[]}compilePattern(t){let e=[],r=t.replace(/:([a-zA-Z_][a-zA-Z0-9_]*)/g,(n,a)=>(e.push(a),"([^/]+)"));return{regex:new RegExp(`^${r}$`),paramNames:e}}register(t,e,r){let{regex:i,paramNames:n}=this.compilePattern(e);this.routes.push({method:t,pattern:e,handler:r,regex:i,paramNames:n})}get(t,e){this.register("GET",t,e)}post(t,e){this.register("POST",t,e)}put(t,e){this.register("PUT",t,e)}delete(t,e){this.register("DELETE",t,e)}options(t,e){this.register("OPTIONS",t,e)}async route(t,e){let i=(0,JM.parse)(t.url||"",!0).pathname||"",n=t.method;for(let a of this.routes)if(a.method===n){let o=i.match(a.regex);if(o){let l={};for(let c=0;c<a.paramNames.length;c++){let d=a.paramNames[c],u=o[c+1];u&&(l[d]=decodeURIComponent(u))}return await a.handler(t,e,l),!0}}return!1}registerController(t){let e=ZM(t.constructor);for(let r of e){let i=t[r.handler];typeof i=="function"&&this.register(r.method.toUpperCase(),r.path,i.bind(t))}}getRoutes(){return this.routes}}});var oi,Uo=v(()=>{oi=class{sendResponse(t,e,r){t.statusCode=e,t.setHeader("Content-Type","application/json"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),t.end(JSON.stringify(r))}successResponse(t,e){return{success:!0,data:t,message:e}}errorResponse(t){return{success:!1,error:t}}async parseRequestBody(t){return new Promise((e,r)=>{let i="";t.on("data",n=>{i+=n.toString()}),t.on("end",()=>{try{e(i?JSON.parse(i):{})}catch(n){r(new Error("Invalid JSON"))}}),t.on("error",r)})}}});var e_,ur,t_=v(()=>{e_=require("url");Uo();Sn();ht();ur=class extends oi{constructor(e,r,i,n,a,o){super();this.plugin=e;this.taskService=r;this.filterService=i;this.cacheManager=n;this.statusManager=a;this.webhookNotifier=o}async getTasks(e,r){try{let n=(0,e_.parse)(e.url||"",!0).query;if(["status","priority","project","tag","overdue","completed","archived","due_before","due_after","sort"].some(f=>n[f])){this.sendResponse(r,400,this.errorResponse("For filtering tasks, please use POST /api/tasks/query which supports advanced filtering capabilities. GET /api/tasks is for basic listing only. See API documentation for details."));return}let l=await this.cacheManager.getAllTasks(),c=0,d=50;n.offset&&(c=parseInt(n.offset,10),(isNaN(c)||c<0)&&(c=0)),n.limit&&(d=parseInt(n.limit,10),(isNaN(d)||d<1)&&(d=50),d>200&&(d=200));let u=l.slice(c,c+d),h=this.plugin.app.vault.adapter,p=null;try{"basePath"in h&&typeof h.basePath=="string"?p=h.basePath:"path"in h&&typeof h.path=="string"&&(p=h.path)}catch(f){}this.sendResponse(r,200,this.successResponse({tasks:u,pagination:{total:l.length,offset:c,limit:d,hasMore:c+d<l.length},vault:{name:this.plugin.app.vault.getName(),path:p},note:"For filtering and advanced queries, use POST /api/tasks/query"}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async createTask(e,r){try{let i=await this.parseRequestBody(e);if(!i.title||!i.title.trim()){this.sendResponse(r,400,this.errorResponse("Title is required"));return}await this.applyTaskCreationDefaults(i);let n=await this.taskService.createTask(i);await this.webhookNotifier.triggerWebhook("task.created",{task:n.taskInfo}),this.sendResponse(r,201,this.successResponse(n.taskInfo))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async getTask(e,r,i){try{let n=i==null?void 0:i.id;if(!n){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(n);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}this.sendResponse(r,200,this.successResponse(a))}catch(n){this.sendResponse(r,500,this.errorResponse(n.message))}}async updateTask(e,r,i){try{let n=i==null?void 0:i.id;if(!n){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.parseRequestBody(e),o=await this.cacheManager.getTaskInfo(n);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=await this.taskService.updateTask(o,a);await this.webhookNotifier.triggerWebhook("task.updated",{task:l,previous:o}),this.sendResponse(r,200,this.successResponse(l))}catch(n){this.sendResponse(r,400,this.errorResponse(n.message))}}async deleteTask(e,r,i){try{let n=i==null?void 0:i.id;if(!n){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(n);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}await this.taskService.deleteTask(a),await this.webhookNotifier.triggerWebhook("task.deleted",{task:a}),this.sendResponse(r,200,this.successResponse({message:"Task deleted successfully"}))}catch(n){this.sendResponse(r,500,this.errorResponse(n.message))}}async toggleStatus(e,r,i){try{let n=i==null?void 0:i.id;if(!n){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(n);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let o=await this.taskService.toggleStatus(a),l=this.statusManager.isCompletedStatus(a.status),c=this.statusManager.isCompletedStatus(o.status);!l&&c?await this.webhookNotifier.triggerWebhook("task.completed",{task:o}):await this.webhookNotifier.triggerWebhook("task.updated",{task:o,previous:a}),this.sendResponse(r,200,this.successResponse(o))}catch(n){this.sendResponse(r,400,this.errorResponse(n.message))}}async toggleArchive(e,r,i){try{let n=i==null?void 0:i.id;if(!n){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(n);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let o=await this.taskService.toggleArchive(a);o.archived?await this.webhookNotifier.triggerWebhook("task.archived",{task:o}):await this.webhookNotifier.triggerWebhook("task.unarchived",{task:o}),this.sendResponse(r,200,this.successResponse(o))}catch(n){this.sendResponse(r,400,this.errorResponse(n.message))}}async completeRecurringInstance(e,r,i){try{let n=i==null?void 0:i.id;if(!n){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let{date:a}=await this.parseRequestBody(e),o=await this.cacheManager.getTaskInfo(n);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=a?new Date(a):void 0,c=await this.taskService.toggleRecurringTaskComplete(o,l);this.sendResponse(r,200,this.successResponse(c))}catch(n){this.sendResponse(r,400,this.errorResponse(n.message))}}async queryTasks(e,r){try{let i=await this.parseRequestBody(e),n=await this.filterService.getGroupedTasks(i),a=[];for(let d of n.values())a.push(...d);let o=await this.cacheManager.getAllTasks(),l=this.plugin.app.vault.adapter,c=null;try{"basePath"in l&&typeof l.basePath=="string"?c=l.basePath:"path"in l&&typeof l.path=="string"&&(c=l.path)}catch(d){}this.sendResponse(r,200,this.successResponse({tasks:a,total:o.length,filtered:a.length,vault:{name:this.plugin.app.vault.getName(),path:c}}))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async getFilterOptions(e,r){try{let i=await this.filterService.getFilterOptions();this.sendResponse(r,200,this.successResponse(i))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async getStats(e,r){try{let i=await this.cacheManager.getAllTasks(),n={total:i.length,completed:i.filter(a=>this.statusManager.isCompletedStatus(a.status)).length,active:i.filter(a=>!this.statusManager.isCompletedStatus(a.status)&&!a.archived).length,overdue:i.filter(a=>this.statusManager.isCompletedStatus(a.status)||a.archived?!1:a.due&&new Date(a.due)<new Date).length,archived:i.filter(a=>a.archived).length,withTimeTracking:i.filter(a=>a.timeEntries&&a.timeEntries.length>0).length};this.sendResponse(r,200,this.successResponse(n))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async applyTaskCreationDefaults(e){let r=this.plugin.settings.taskCreationDefaults;if(!e.scheduled&&r.defaultScheduledDate!=="none"&&(e.scheduled=Gr(r.defaultScheduledDate)),!e.due&&r.defaultDueDate!=="none"&&(e.due=Gr(r.defaultDueDate)),!e.contexts&&r.defaultContexts&&(e.contexts=r.defaultContexts.split(",").map(i=>i.trim()).filter(i=>i)),!e.projects&&r.defaultProjects&&(e.projects=r.defaultProjects.split(",").map(i=>i.trim()).filter(i=>i)),!e.timeEstimate&&r.defaultTimeEstimate>0&&(e.timeEstimate=r.defaultTimeEstimate),!e.tags&&r.defaultTags&&(e.tags=r.defaultTags.split(",").map(i=>i.trim()).filter(i=>i)),!e.recurrence&&r.defaultRecurrence&&r.defaultRecurrence!=="none"&&(e.recurrence={frequency:r.defaultRecurrence}),!e.reminders&&r.defaultReminders&&r.defaultReminders.length>0){let{convertDefaultRemindersToReminders:i}=await Promise.resolve().then(()=>(Gc(),qc));e.reminders=i(r.defaultReminders)}}};me([vt("/api/tasks")],ur.prototype,"getTasks",1),me([wt("/api/tasks")],ur.prototype,"createTask",1),me([vt("/api/tasks/:id")],ur.prototype,"getTask",1),me([QM("/api/tasks/:id")],ur.prototype,"updateTask",1),me([wp("/api/tasks/:id")],ur.prototype,"deleteTask",1),me([wt("/api/tasks/:id/toggle-status")],ur.prototype,"toggleStatus",1),me([wt("/api/tasks/:id/archive")],ur.prototype,"toggleArchive",1),me([wt("/api/tasks/:id/complete-instance")],ur.prototype,"completeRecurringInstance",1),me([wt("/api/tasks/query")],ur.prototype,"queryTasks",1),me([vt("/api/filter-options")],ur.prototype,"getFilterOptions",1),me([vt("/api/stats")],ur.prototype,"getStats",1)});var r_,Ki,i_=v(()=>{r_=require("url");Uo();Sn();Ki=class extends oi{constructor(e,r,i,n,a){super();this.plugin=e;this.taskService=r;this.cacheManager=i;this.statusManager=n;this.webhookNotifier=a}async startTimeTracking(e,r,i){var n;try{let a=i==null?void 0:i.id;if(!a){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let o=await this.cacheManager.getTaskInfo(a);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=await this.taskService.startTimeTracking(o);await this.webhookNotifier.triggerWebhook("time.started",{task:l,session:(n=l.timeEntries)==null?void 0:n[l.timeEntries.length-1]}),this.sendResponse(r,200,this.successResponse(l))}catch(a){this.sendResponse(r,400,this.errorResponse(a.message))}}async stopTimeTracking(e,r,i){var n;try{let a=i==null?void 0:i.id;if(!a){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let o=await this.cacheManager.getTaskInfo(a);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=await this.taskService.stopTimeTracking(o);await this.webhookNotifier.triggerWebhook("time.stopped",{task:l,session:(n=l.timeEntries)==null?void 0:n[l.timeEntries.length-1]}),this.sendResponse(r,200,this.successResponse(l))}catch(a){this.sendResponse(r,400,this.errorResponse(a.message))}}async startTimeTrackingWithDescription(e,r,i){var n;try{let a=i==null?void 0:i.id;if(!a){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let o=await this.cacheManager.getTaskInfo(a);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let c=(await this.parseRequestBody(e)).description||"",d=await this.taskService.startTimeTracking(o);if(c&&d.timeEntries&&d.timeEntries.length>0){let u=d.timeEntries[d.timeEntries.length-1];u&&!u.endTime&&(u.description=c,await this.taskService.updateTask(d,{timeEntries:d.timeEntries}))}await this.webhookNotifier.triggerWebhook("time.started",{task:d,session:(n=d.timeEntries)==null?void 0:n[d.timeEntries.length-1]}),this.sendResponse(r,200,this.successResponse({task:d,message:c?`Time tracking started with description: ${c}`:"Time tracking started"}))}catch(a){this.sendResponse(r,400,this.errorResponse(a.message))}}async getActiveTimeSessions(e,r){try{let i=await this.cacheManager.getAllTasks(),n=[];for(let a of i){let o=this.plugin.getActiveTimeSession(a);if(o){let l=new Date(o.startTime),c=Math.floor((Date.now()-l.getTime())/(1e3*60));n.push({task:{id:a.path,title:a.title,status:a.status,priority:a.priority,tags:a.tags||[],projects:a.projects||[]},session:{startTime:o.startTime,description:o.description,elapsedMinutes:c},elapsedMinutes:c})}}this.sendResponse(r,200,this.successResponse({activeSessions:n,totalActiveSessions:n.length,totalElapsedMinutes:n.reduce((a,o)=>a+o.elapsedMinutes,0)}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async getTimeSummary(e,r){try{let n=(0,r_.parse)(e.url||"",!0).query,a=await this.cacheManager.getAllTasks(),o=n.period||"today",l=n.from?new Date(n.from):null,c=n.to?new Date(n.to):null,d,u=new Date;switch(o){case"today":d=new Date,d.setHours(0,0,0,0);break;case"week":d=new Date,d.setDate(d.getDate()-d.getDay()),d.setHours(0,0,0,0);break;case"month":d=new Date,d.setDate(1),d.setHours(0,0,0,0);break;case"all":d=new Date(0);break;default:l?(d=l,c&&(u=c)):(d=new Date,d.setHours(0,0,0,0))}let h=0,p=0,f=0,m=[],g=new Map,y=new Map;for(let x of a){if(!x.timeEntries||x.timeEntries.length===0)continue;let I=0,F=!1;for(let A of x.timeEntries){let L=new Date(A.startTime),G=A.endTime?new Date(A.endTime):new Date;if(L>=d&&L<=u)if(A.duration)I+=A.duration;else if(A.endTime){let V=G.getTime()-L.getTime();I+=Math.floor(V/(1e3*60))}else{let V=Math.floor((Date.now()-L.getTime())/6e4);I+=V,F=!0}}if(I>0){if(h+=I,m.push({task:x.path,title:x.title,minutes:I}),F?f++:this.statusManager.isCompletedStatus(x.status)&&p++,x.projects)for(let A of x.projects){let L=g.get(A)||0;g.set(A,L+I)}if(x.tags)for(let A of x.tags){let L=y.get(A)||0;y.set(A,L+I)}}}m.sort((x,I)=>I.minutes-x.minutes);let w=m.slice(0,10),T=Array.from(g.entries()).sort((x,I)=>I[1]-x[1]).slice(0,10).map(([x,I])=>({project:x,minutes:I})),S=Array.from(y.entries()).sort((x,I)=>I[1]-x[1]).slice(0,10).map(([x,I])=>({tag:x,minutes:I}));this.sendResponse(r,200,this.successResponse({period:o,dateRange:{from:d.toISOString(),to:u.toISOString()},summary:{totalMinutes:h,totalHours:Math.round(h/60*100)/100,tasksWithTime:m.length,activeTasks:f,completedTasks:p},topTasks:w,topProjects:T,topTags:S}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async getTaskTimeData(e,r,i){try{let n=i==null?void 0:i.id;if(!n){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(n);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let o=a.timeEntries||[],l=this.plugin.getActiveTimeSession(a),c=this.calculateTotalTimeSpent(o),d=o.filter(f=>f.endTime).length,u=l?1:0,h=o.filter(f=>f.endTime&&f.duration),p=h.length>0?Math.round(h.reduce((f,m)=>f+(m.duration||0),0)/h.length*100)/100:0;this.sendResponse(r,200,this.successResponse({task:{id:a.path,title:a.title,status:a.status,priority:a.priority},summary:{totalMinutes:c,totalHours:Math.round(c/60*100)/100,totalSessions:o.length,completedSessions:d,activeSessions:u,averageSessionMinutes:p},activeSession:l?{startTime:l.startTime,description:l.description,elapsedMinutes:Math.floor((Date.now()-new Date(l.startTime).getTime())/(1e3*60))}:null,timeEntries:o.map(f=>({startTime:f.startTime,endTime:f.endTime||null,description:f.description||null,duration:f.duration||(f.endTime?Math.floor((new Date(f.endTime).getTime()-new Date(f.startTime).getTime())/(1e3*60)):Math.floor((Date.now()-new Date(f.startTime).getTime())/(1e3*60))),isActive:!f.endTime}))}))}catch(n){this.sendResponse(r,500,this.errorResponse(n.message))}}calculateTotalTimeSpent(e){return!e||e.length===0?0:e.reduce((r,i)=>{if(i.duration)return r+i.duration;if(i.endTime){let n=new Date(i.endTime).getTime()-new Date(i.startTime).getTime();return r+Math.floor(n/(1e3*60))}else{let n=Date.now()-new Date(i.startTime).getTime();return r+Math.floor(n/(1e3*60))}},0)}};me([wt("/api/tasks/:id/time/start")],Ki.prototype,"startTimeTracking",1),me([wt("/api/tasks/:id/time/stop")],Ki.prototype,"stopTimeTracking",1),me([wt("/api/tasks/:id/time/start-with-description")],Ki.prototype,"startTimeTrackingWithDescription",1),me([vt("/api/time/active")],Ki.prototype,"getActiveTimeSessions",1),me([vt("/api/time/summary")],Ki.prototype,"getTimeSummary",1),me([vt("/api/tasks/:id/time")],Ki.prototype,"getTaskTimeData",1)});var Jy,Di,s_=v(()=>{Jy=require("url");Uo();Sn();Di=class extends oi{constructor(e,r){super();this.plugin=e;this.cacheManager=r}async startPomodoro(e,r){try{let i=await this.parseRequestBody(e),n;if(i.taskId){let c=await this.cacheManager.getTaskInfo(i.taskId);if(!c){this.sendResponse(r,404,this.errorResponse("Task not found"));return}n=c}if(this.plugin.pomodoroService.getState().isRunning){this.sendResponse(r,400,this.errorResponse("Pomodoro session is already running. Stop or pause the current session first."));return}let o=i.duration?parseInt(i.duration):void 0;await this.plugin.pomodoroService.startPomodoro(n,o);let l=this.plugin.pomodoroService.getState();this.sendResponse(r,200,this.successResponse({session:l.currentSession,task:n||null,message:"Pomodoro session started"}))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async stopPomodoro(e,r){try{if(!this.plugin.pomodoroService.getState().currentSession){this.sendResponse(r,400,this.errorResponse("No active pomodoro session to stop"));return}await this.plugin.pomodoroService.stopPomodoro(),this.sendResponse(r,200,this.successResponse({message:"Pomodoro session stopped and reset"}))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async pausePomodoro(e,r){try{let i=this.plugin.pomodoroService.getState();if(!i.isRunning||!i.currentSession){this.sendResponse(r,400,this.errorResponse("No running pomodoro session to pause"));return}await this.plugin.pomodoroService.pausePomodoro();let n=this.plugin.pomodoroService.getState();this.sendResponse(r,200,this.successResponse({timeRemaining:n.timeRemaining,message:"Pomodoro session paused"}))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async resumePomodoro(e,r){try{let i=this.plugin.pomodoroService.getState();if(i.isRunning){this.sendResponse(r,400,this.errorResponse("Pomodoro session is already running"));return}if(!i.currentSession){this.sendResponse(r,400,this.errorResponse("No paused session to resume"));return}await this.plugin.pomodoroService.resumePomodoro();let n=this.plugin.pomodoroService.getState();this.sendResponse(r,200,this.successResponse({timeRemaining:n.timeRemaining,message:"Pomodoro session resumed"}))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async getPomodoroStatus(e,r){try{let n={...this.plugin.pomodoroService.getState(),totalPomodoros:await this.plugin.pomodoroService.getPomodorosCompleted(),currentStreak:await this.plugin.pomodoroService.getCurrentStreak(),totalMinutesToday:await this.plugin.pomodoroService.getTotalMinutesToday()};this.sendResponse(r,200,this.successResponse(n))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async getPomodoroSessions(e,r){try{let n=(0,Jy.parse)(e.url||"",!0).query,a=await this.plugin.pomodoroService.getSessionHistory();if(n.date&&typeof n.date=="string"){let l=n.date;a=a.filter(c=>new Date(c.startTime).toISOString().split("T")[0]===l)}let o=a.length;if(n.limit&&typeof n.limit=="string"){let l=parseInt(n.limit);l>0&&(a=a.slice(-l))}this.sendResponse(r,200,this.successResponse({sessions:a,total:o}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async getPomodoroStats(e,r){try{let n=(0,Jy.parse)(e.url||"",!0).query,a;if(n.date&&typeof n.date=="string"){let o=new Date(n.date);a=await this.plugin.pomodoroService.getStatsForDate(o)}else a=await this.plugin.pomodoroService.getTodayStats();this.sendResponse(r,200,this.successResponse(a))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}};me([wt("/api/pomodoro/start")],Di.prototype,"startPomodoro",1),me([wt("/api/pomodoro/stop")],Di.prototype,"stopPomodoro",1),me([wt("/api/pomodoro/pause")],Di.prototype,"pausePomodoro",1),me([wt("/api/pomodoro/resume")],Di.prototype,"resumePomodoro",1),me([vt("/api/pomodoro/status")],Di.prototype,"getPomodoroStatus",1),me([vt("/api/pomodoro/sessions")],Di.prototype,"getPomodoroSessions",1),me([vt("/api/pomodoro/stats")],Di.prototype,"getPomodoroStats",1)});var Ps,n_=v(()=>{Uo();ht();Sn();Ps=class extends oi{constructor(e,r,i,n,a){super();this.plugin=e;this.taskService=r;this.nlParser=i;this.webhookNotifier=n;this.httpAPIService=a}async healthCheck(e,r){let i=this.plugin.app.vault.getName(),n=this.plugin.app.vault.adapter,a=null;try{"basePath"in n&&typeof n.basePath=="string"?a=n.basePath:"path"in n&&typeof n.path=="string"&&(a=n.path)}catch(o){}this.sendResponse(r,200,this.successResponse({status:"ok",timestamp:new Date().toISOString(),vault:{name:i,path:a}}))}async handleNLPParse(e,r){try{let i=await this.parseRequestBody(e);if(!i.text||typeof i.text!="string"){this.sendResponse(r,400,this.errorResponse("Text field is required and must be a string"));return}let n=this.nlParser.parseInput(i.text),a={title:n.title,details:n.details,priority:n.priority,status:n.status||this.getDefaultStatus(),tags:n.tags,contexts:n.contexts,projects:n.projects,recurrence:n.recurrence,timeEstimate:n.estimate};n.dueDate&&(a.due=n.dueDate,n.dueTime&&(a.due=`${n.dueDate} ${n.dueTime}`)),n.scheduledDate&&(a.scheduled=n.scheduledDate,n.scheduledTime&&(a.scheduled=`${n.scheduledDate} ${n.scheduledTime}`)),this.sendResponse(r,200,this.successResponse({parsed:n,taskData:a}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async handleNLPCreate(e,r){try{let i=await this.parseRequestBody(e);if(!i.text||typeof i.text!="string"){this.sendResponse(r,400,this.errorResponse("Text field is required and must be a string"));return}let n=this.nlParser.parseInput(i.text),a={title:n.title,details:n.details,priority:n.priority,status:n.status||this.getDefaultStatus(),tags:n.tags,contexts:n.contexts,projects:n.projects,recurrence:n.recurrence,timeEstimate:n.estimate,creationContext:"api"};n.dueDate&&(a.due=n.dueDate,n.dueTime&&(a.due=`${n.dueDate} ${n.dueTime}`)),n.scheduledDate&&(a.scheduled=n.scheduledDate,n.scheduledTime&&(a.scheduled=`${n.scheduledDate} ${n.scheduledTime}`)),await this.applyTaskCreationDefaults(a);let o=await this.taskService.createTask(a);await this.webhookNotifier.triggerWebhook("task.created",{task:o.taskInfo,source:"nlp",originalText:i.text}),this.sendResponse(r,201,this.successResponse({task:o.taskInfo,parsed:n}))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async handleOpenAPISpec(e,r){try{let i=KM(this.httpAPIService||this);i.servers=[{url:`http://localhost:${this.plugin.settings.apiPort}`,description:"TaskNotes API Server"}],r.statusCode=200,r.setHeader("Content-Type","application/json"),r.setHeader("Access-Control-Allow-Origin","*"),r.end(JSON.stringify(i,null,2))}catch(i){console.error("OpenAPI spec generation error:",i),this.sendResponse(r,500,this.errorResponse("Failed to generate API specification"))}}async handleSwaggerUI(e,r){try{let i=this.generateSwaggerUIHTML();r.statusCode=200,r.setHeader("Content-Type","text/html"),r.setHeader("Access-Control-Allow-Origin","*"),r.end(i)}catch(i){console.error("Swagger UI generation error:",i),this.sendResponse(r,500,this.errorResponse("Failed to generate API documentation"))}}async applyTaskCreationDefaults(e){let r=this.plugin.settings.taskCreationDefaults;if(!e.scheduled&&r.defaultScheduledDate!=="none"&&(e.scheduled=Gr(r.defaultScheduledDate)),!e.due&&r.defaultDueDate!=="none"&&(e.due=Gr(r.defaultDueDate)),!e.contexts&&r.defaultContexts&&(e.contexts=r.defaultContexts.split(",").map(i=>i.trim()).filter(i=>i)),!e.projects&&r.defaultProjects&&(e.projects=r.defaultProjects.split(",").map(i=>i.trim()).filter(i=>i)),!e.timeEstimate&&r.defaultTimeEstimate>0&&(e.timeEstimate=r.defaultTimeEstimate),!e.tags&&r.defaultTags&&(e.tags=r.defaultTags.split(",").map(i=>i.trim()).filter(i=>i)),!e.recurrence&&r.defaultRecurrence&&r.defaultRecurrence!=="none"&&(e.recurrence={frequency:r.defaultRecurrence}),!e.reminders&&r.defaultReminders&&r.defaultReminders.length>0){let{convertDefaultRemindersToReminders:i}=await Promise.resolve().then(()=>(Gc(),qc));e.reminders=i(r.defaultReminders)}}getDefaultStatus(){let e=this.plugin.settings.customStatuses;return e&&e.length>0?[...e].sort((i,n)=>i.order-n.order)[0].value:"open"}generateSwaggerUIHTML(){return`<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TaskNotes API Documentation</title>
	<link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui.css" />
	<style>
		body { margin: 0; }
		.swagger-ui .topbar { display: none; }
		.swagger-ui .info .title { color: #663399; }
	</style>
</head>
<body>
	<div id="swagger-ui"></div>
	<script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"><\/script>
	<script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-standalone-preset.js"><\/script>
	<script>
		SwaggerUIBundle({
			url: 'http://localhost:${this.plugin.settings.apiPort}/api/docs',
			dom_id: '#swagger-ui',
			deepLinking: true,
			presets: [
				SwaggerUIBundle.presets.apis,
				SwaggerUIStandalonePreset
			],
			plugins: [
				SwaggerUIBundle.plugins.DownloadUrl
			],
			layout: "StandaloneLayout",
			tryItOutEnabled: true,
			displayRequestDuration: true,
			docExpansion: 'list',
			filter: true,
			validatorUrl: null
		});
	<\/script>
</body>
</html>`}};me([vt("/api/health")],Ps.prototype,"healthCheck",1),me([wt("/api/nlp/parse")],Ps.prototype,"handleNLPParse",1),me([wt("/api/nlp/create")],Ps.prototype,"handleNLPCreate",1),me([vt("/api/docs")],Ps.prototype,"handleOpenAPISpec",1),me([vt("/api/docs/ui")],Ps.prototype,"handleSwaggerUI",1)});var bp,En,a_=v(()=>{Uo();bp=require("crypto");Sn();En=class extends oi{constructor(e){super();this.plugin=e;this.webhooks=new Map;this.webhookDeliveryQueue=[];this.loadWebhooks()}async registerWebhook(e,r){try{let i=await this.parseRequestBody(e);if(!i.url||typeof i.url!="string"){this.sendResponse(r,400,this.errorResponse("URL is required and must be a string"));return}if(!i.events||!Array.isArray(i.events)||i.events.length===0){this.sendResponse(r,400,this.errorResponse("Events array is required and must not be empty"));return}let n=i.id||this.generateWebhookId(),a=i.secret||this.generateWebhookSecret(),o={id:n,url:i.url,events:i.events,secret:a,active:i.active!==!1,createdAt:new Date().toISOString(),failureCount:0,successCount:0,transformFile:i.transformFile||void 0,corsHeaders:i.corsHeaders!==!1};this.webhooks.set(n,o),await this.saveWebhooks(),this.sendResponse(r,201,this.successResponse({webhook:o,message:"Webhook registered successfully. Save the secret for signature validation."}))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async listWebhooks(e,r){try{let i=Array.from(this.webhooks.values()).map(n=>({...n,secret:void 0}));this.sendResponse(r,200,this.successResponse({webhooks:i,total:i.length}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async deleteWebhook(e,r,i){try{let n=i==null?void 0:i.id;if(!n){this.sendResponse(r,400,this.errorResponse("Webhook ID is required"));return}if(!this.webhooks.has(n)){this.sendResponse(r,404,this.errorResponse("Webhook not found"));return}this.webhooks.delete(n),await this.saveWebhooks(),this.sendResponse(r,200,this.successResponse({message:"Webhook deleted successfully"}))}catch(n){this.sendResponse(r,500,this.errorResponse(n.message))}}async getWebhookDeliveries(e,r){try{let i=this.webhookDeliveryQueue.slice(-100);this.sendResponse(r,200,this.successResponse({deliveries:i,total:i.length}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async triggerWebhook(e,r){setImmediate(()=>{this.processWebhookTrigger(e,r).catch(i=>{console.error("Webhook processing error:",i)})})}async processWebhookTrigger(e,r){let i=Array.from(this.webhooks.values()).filter(l=>l.active&&l.events.includes(e));if(i.length===0)return;let n=this.plugin.app.vault.adapter,a=null;try{"basePath"in n&&typeof n.basePath=="string"?a=n.basePath:"path"in n&&typeof n.path=="string"&&(a=n.path)}catch(l){}let o={event:e,timestamp:new Date().toISOString(),vault:{name:this.plugin.app.vault.getName(),path:a},data:r};for(let l of i){let c=o;if(l.transformFile)try{c=await this.applyTransformation(l.transformFile,o)}catch(u){console.error(`Transform error for ${l.transformFile}:`,u)}let d={id:this.generateDeliveryId(),webhookId:l.id,event:e,payload:c,status:"pending",attempts:0};this.webhookDeliveryQueue.push(d),this.deliverWebhook(l,d)}this.webhookDeliveryQueue.length>100&&(this.webhookDeliveryQueue=this.webhookDeliveryQueue.slice(-100))}async deliverWebhook(e,r,i=0){try{r.attempts++,r.lastAttempt=new Date().toISOString();let a=this.generateSignature(r.payload,e.secret),o={"Content-Type":"application/json"};e.corsHeaders!==!1&&(o["X-TaskNotes-Event"]=r.event,o["X-TaskNotes-Signature"]=a,o["X-TaskNotes-Delivery-ID"]=r.id);let l=await fetch(e.url,{method:"POST",headers:o,body:JSON.stringify(r.payload)});if(r.responseStatus=l.status,l.ok)r.status="success",e.successCount++,e.lastTriggered=new Date().toISOString();else throw new Error(`HTTP ${l.status}: ${l.statusText}`)}catch(a){if(r.error=a.message,e.failureCount++,i<3){let o=Math.pow(2,i)*1e3;setTimeout(()=>{this.deliverWebhook(e,r,i+1)},o)}else r.status="failed",e.failureCount>10&&(e.active=!1,console.warn(`Webhook ${e.id} disabled after ${e.failureCount} failures`))}await this.saveWebhooks()}generateSignature(e,r){let i=(0,bp.createHmac)("sha256",r);return i.update(JSON.stringify(e)),i.digest("hex")}generateWebhookId(){return`wh_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}generateWebhookSecret(){return(0,bp.createHash)("sha256").update(Date.now().toString()+Math.random().toString()).digest("hex")}generateDeliveryId(){return`del_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}async saveWebhooks(){let e=Array.from(this.webhooks.values());this.plugin.settings.webhooks=e,await this.plugin.saveSettings()}loadWebhooks(){if(this.plugin.settings.webhooks){this.webhooks.clear();for(let e of this.plugin.settings.webhooks)this.webhooks.set(e.id,e)}}async applyTransformation(e,r){try{return e.endsWith(".js")?await this.applyJSTransformation(e,r):e.endsWith(".json")?await this.applyJSONTransformation(e,r):r}catch(i){throw console.error(`Transformation failed for ${e}:`,i),i}}async applyJSTransformation(e,r){try{let i=await this.plugin.app.vault.adapter.read(e);return new Function("payload",`
				${i}
				if (typeof transform === 'function') {
					return transform(payload);
				} else {
					throw new Error('Transform file must export a transform function');
				}
			`)(r)}catch(i){throw console.error("JS transformation error:",i),i}}async applyJSONTransformation(e,r){try{let i=await this.plugin.app.vault.adapter.read(e),n=JSON.parse(i),a=n[r.event]||n.default;if(!a)throw new Error(`No template found for event ${r.event} and no default template`);return this.interpolateTemplate(a,r)}catch(i){throw console.error("JSON transformation error:",i),i}}interpolateTemplate(e,r){if(typeof e=="string")return e.replace(/\$\{([^}]+)\}/g,(i,n)=>this.getNestedValue(r,n)||i);if(Array.isArray(e))return e.map(i=>this.interpolateTemplate(i,r));if(e&&typeof e=="object"){let i={};for(let[n,a]of Object.entries(e))i[n]=this.interpolateTemplate(a,r);return i}else return e}getNestedValue(e,r){return r.split(".").reduce((i,n)=>i&&i[n]!==void 0?i[n]:void 0,e)}};me([wt("/api/webhooks")],En.prototype,"registerWebhook",1),me([vt("/api/webhooks")],En.prototype,"listWebhooks",1),me([wp("/api/webhooks/:id")],En.prototype,"deleteWebhook",1),me([vt("/api/webhooks/deliveries")],En.prototype,"getWebhookDeliveries",1)});var c_={};Ur(c_,{HTTPAPIService:()=>ld});var o_,l_,ld,d_=v(()=>{o_=require("http"),l_=require("url");jc();Cd();Sn();XM();t_();i_();s_();n_();a_();ld=class{constructor(t,e,r,i){this.plugin=t;let n=new Vi(t.settings.customStatuses,t.settings.customPriorities,t.settings.nlpDefaultToScheduled),a=new Rs(t.settings.customStatuses);this.webhookController=new En(t),this.tasksController=new ur(t,e,r,i,a,this.webhookController),this.timeTrackingController=new Ki(t,e,i,a,this.webhookController),this.pomodoroController=new Di(t,i),this.systemController=new Ps(t,e,n,this.webhookController,this),this.router=new Tp,this.setupRoutes()}setupRoutes(){this.router.registerController(this.tasksController),this.router.registerController(this.timeTrackingController),this.router.registerController(this.pomodoroController),this.router.registerController(this.systemController),this.router.registerController(this.webhookController)}async handleCORSPreflight(t,e){e.statusCode=200,e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),e.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),e.end()}authenticate(t){let e=this.plugin.settings.apiAuthToken;if(!e)return!0;let r=t.headers.authorization;return!r||!r.startsWith("Bearer ")?!1:r.substring(7)===e}sendResponse(t,e,r){t.statusCode=e,t.setHeader("Content-Type","application/json"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),t.end(JSON.stringify(r))}successResponse(t,e){return{success:!0,data:t,message:e}}errorResponse(t){return{success:!1,error:t}}async handleRequest(t,e){try{if(t.method==="OPTIONS"){await this.handleCORSPreflight(t,e);return}if(((0,l_.parse)(t.url||"",!0).pathname||"").startsWith("/api/")&&!this.authenticate(t)){this.sendResponse(e,401,this.errorResponse("Authentication required"));return}await this.router.route(t,e)||this.sendResponse(e,404,this.errorResponse("Not found"))}catch(r){console.error("API Error:",r),this.sendResponse(e,500,this.errorResponse("Internal server error"))}}async triggerWebhook(t,e){await this.webhookController.triggerWebhook(t,e)}async start(){return new Promise((t,e)=>{try{this.server=(0,o_.createServer)((r,i)=>{this.handleRequest(r,i).catch(n=>{console.error("Request handling error:",n),this.sendResponse(i,500,this.errorResponse("Internal server error"))})}),this.server.listen(this.plugin.settings.apiPort,()=>{console.log(`TaskNotes API server started on port ${this.plugin.settings.apiPort}`),t()}),this.server.on("error",r=>{console.error("API server error:",r),e(r)})}catch(r){e(r)}})}async stop(){return new Promise(t=>{this.server?this.server.close(()=>{console.log("TaskNotes API server stopped"),t()}):t()})}isRunning(){return!!this.server&&this.server.listening}getPort(){return this.plugin.settings.apiPort}};ld=me([GM],ld)});var hr,Xy=v(()=>{Se();hr=class{static parseTaskLine(t){if(typeof t!="string")return{isTaskLine:!1,originalText:"",error:"Invalid input: line must be a string"};if(t.length>2e3)return{isTaskLine:!1,originalText:t,error:"Line too long to process safely"};let r=t.trim().match(this.CHECKBOX_PATTERN);if(!r)return{isTaskLine:!1,originalText:t};try{let[,,i,,n]=r;if(typeof i!="string"||typeof n!="string")return{isTaskLine:!0,originalText:t,error:"Invalid checkbox format"};let a=i.toLowerCase()==="x",o=this.parseTaskContent(n,a);return!o||!o.title||o.title.trim().length===0?{isTaskLine:!0,originalText:t,error:"Task must have a title"}:{isTaskLine:!0,originalText:t,parsedData:o}}catch(i){return{isTaskLine:!0,originalText:t,error:`Failed to parse task: ${i instanceof Error?i.message:"Unknown error"}`}}}static parseTaskContent(t,e){if(typeof t!="string")throw new Error("Content must be a string");if(t.length>1e3)throw new Error("Content too long to process safely");let r=t;try{let i=this.extractDate(r,this.EMOJI_PATTERNS.DUE_DATE),n=this.extractDate(r,this.EMOJI_PATTERNS.SCHEDULED_DATE),a=this.extractDate(r,this.EMOJI_PATTERNS.START_DATE),o=this.extractDate(r,this.EMOJI_PATTERNS.CREATED_DATE),l=this.extractDate(r,this.EMOJI_PATTERNS.DONE_DATE),c=this.extractPriority(r),{recurrence:d,recurrenceData:u}=this.extractRecurrence(r),h=this.extractTags(r),p=this.extractCleanTitle(r);if(!p||p.trim().length===0)throw new Error("Title cannot be empty after parsing");let f;if(e||l)f="done";else if(a)try{!Fa(a)&&!Fs(a)?f="scheduled":f="open"}catch(m){}return{title:p.trim(),status:f,priority:c,dueDate:i,scheduledDate:n,startDate:a,createdDate:o,doneDate:l,recurrence:d,recurrenceData:u,tags:h.length>0?h:void 0,projects:void 0,isCompleted:e}}catch(i){throw new Error(`Failed to parse task content: ${i instanceof Error?i.message:"Unknown error"}`)}}static extractDate(t,e){if(!(typeof t!="string"||!e))try{let i=new RegExp(e.source,"g").exec(t);if(i&&i[1]){let n=i[1].trim();if(!/^\d{4}-\d{2}-\d{2}$/.test(n))return;try{let a=Ae(n);if(isNaN(a.getTime()))return;let o=a.getUTCFullYear();return o<1900||o>2100?void 0:ae(a)}catch(a){return}}}catch(r){console.debug("Error extracting date:",r)}}static extractPriority(t){if(new RegExp(this.EMOJI_PATTERNS.HIGH_PRIORITY.source).test(t))return"high";if(new RegExp(this.EMOJI_PATTERNS.MEDIUM_PRIORITY.source).test(t))return"medium";if(new RegExp(this.EMOJI_PATTERNS.LOW_PRIORITY.source).test(t))return"low"}static extractRecurrence(t){let r=new RegExp(this.EMOJI_PATTERNS.RECURRENCE.source,"g").exec(t);if(!r||!r[1])return{};let i=r[1].trim();if(i.includes("every day"))return{recurrence:"daily",recurrenceData:{frequency:"daily"}};if(i.includes("every week"))return{recurrence:"weekly",recurrenceData:{frequency:"weekly"}};if(i.includes("every month"))return{recurrence:"monthly",recurrenceData:{frequency:"monthly"}};if(i.includes("every year"))return{recurrence:"yearly",recurrenceData:{frequency:"yearly"}};let n=i.match(/every\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)/i);return n?{recurrence:"weekly",recurrenceData:{frequency:"weekly",days_of_week:[n[1].toLowerCase().substring(0,3)]}}:{recurrence:"custom",recurrenceData:{frequency:"custom",raw:i}}}static extractTags(t){if(typeof t!="string")return[];try{let e=new RegExp(this.TAG_PATTERN.source,"g"),r=[],i;for(;(i=e.exec(t))!==null;)if(i[0]){let n=i[0].substring(1);n&&!r.includes(n)&&r.push(n)}return r}catch(e){return console.debug("Error extracting tags:",e),[]}}static extractCleanTitle(t){if(typeof t!="string")return"";try{let e=t;Object.values(this.EMOJI_PATTERNS).forEach(i=>{try{let n=new RegExp(i.source,"g");e=e.replace(n,"")}catch(n){console.debug("Error applying emoji pattern:",n)}});try{let i=new RegExp(this.TAG_PATTERN.source,"g");e=e.replace(i,"")}catch(i){console.debug("Error removing tags from title:",i)}let r=e.replace(/\s+/g," ").trim();return r.length===0?"Untitled Task":r}catch(e){return console.debug("Error extracting clean title:",e),"Untitled Task"}}static isTasksPluginFormat(t){if(typeof t!="string"||t.length>1e3)return!1;try{let e=t.trim();return this.CHECKBOX_PATTERN.test(e)?Object.values(this.EMOJI_PATTERNS).some(n=>{try{return new RegExp(n.source).test(e)}catch(a){return!1}}):!1}catch(e){return console.debug("Error validating Tasks plugin format:",e),!1}}static getSummary(t){let e=[];return e.push(`Title: "${t.title}"`),e.push(`Status: ${t.status}`),e.push(`Priority: ${t.priority}`),t.dueDate&&e.push(`Due: ${t.dueDate}`),t.startDate&&e.push(`Start: ${t.startDate}`),t.scheduledDate&&e.push(`Scheduled: ${t.scheduledDate}`),t.createdDate&&e.push(`Created: ${t.createdDate}`),t.doneDate&&e.push(`Done: ${t.doneDate}`),t.recurrence&&e.push(`Recurrence: ${t.recurrence}`),t.tags&&t.tags.length>0&&e.push(`Tags: ${t.tags.map(r=>"#"+r).join(", ")}`),t.projects&&t.projects.length>0&&e.push(`Projects: ${t.projects.map(r=>r.includes(" ")?`+[[${r}]]`:`+${r}`).join(", ")}`),e.join(" | ")}};hr.EMOJI_PATTERNS={DUE_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,SCHEDULED_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,START_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,CREATED_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,DONE_DATE:/\s*(\d{4}-\d{2}-\d{2})/g,HIGH_PRIORITY://g,MEDIUM_PRIORITY://g,LOW_PRIORITY://g,RECURRENCE:/\s*([^#]+?)(?=\s*[#]|$)/gu},hr.TAG_PATTERN=/#[\w/]+/g,hr.CHECKBOX_PATTERN=/^(\s*(?:[-*+]|\d+\.)\s+\[)([ xX])(\]\s+)(.*)/});var u_={};Ur(u_,{InstantTaskConvertService:()=>ev});var rr,ev,h_=v(()=>{rr=require("obsidian");Xy();jc();Se();ht();Kh();Pa();ev=class{constructor(t,e,r){this.plugin=t,this.statusManager=e,this.priorityManager=r,this.nlParser=new Vi(t.settings.customStatuses,t.settings.customPriorities,t.settings.nlpDefaultToScheduled)}async batchConvertAllTasks(t){try{let e=this.findAllCheckboxTasks(t);if(e.length===0){new rr.Notice("No checkbox tasks found in the current note.");return}new rr.Notice(`Converting ${e.length} task${e.length===1?"":"s"}...`);let r=await this.batchConvertTasksOptimized(t,e);if(r.failures.length===0)new rr.Notice(`\u2705 Successfully converted ${r.successCount} task${r.successCount===1?"":"s"} to TaskNotes!`);else{let i=`Converted ${r.successCount} task${r.successCount===1?"":"s"}.`;r.failures.length>0&&(i+=` ${r.failures.length} failed.`),new rr.Notice(i),console.warn("Batch conversion failures:",r.failures)}}catch(e){console.error("Error during batch task conversion:",e),new rr.Notice("Failed to perform batch conversion. Please try again.")}}async batchConvertTasksOptimized(t,e){let r=[],i=[],n=e.map(async o=>{try{let l=await this.parseTaskForBatch(o.line);if(!l)throw new Error("Failed to parse task");let c=await this.createTaskFile(l),d=this.generateLinkText(o.line,c);return{lineNumber:o.lineNumber,line:o.line,file:c,linkText:d}}catch(l){return r.push({lineNumber:o.lineNumber+1,error:l instanceof Error?l.message:String(l)}),null}}),a=await Promise.all(n);for(let o of a)o&&i.push(o);return i.length>0&&this.replaceAllTaskLines(t,i),{successCount:i.length,failures:r}}async instantConvertTask(t,e){try{let r=this.validateInputParameters(t,e);if(!r.isValid){new rr.Notice(r.error||"Invalid input parameters.");return}let i=this.extractSelectionInfo(t,e),n=i.taskLine,a=i.details,o,l=hr.parseTaskLine(n);if(l.isTaskLine){if(l.error||!l.parsedData){new rr.Notice(`Error parsing task: ${l.error||"No data extracted"}`);return}if(!this.hasUsefulMetadata(l.parsedData)&&this.plugin.settings.enableNaturalLanguageInput){let m=this.tryNLPFallback(n,a||"");m?o=m:o=l.parsedData}else o=l.parsedData}else{let f=this.extractLineContentAsTitle(n);if(!f.trim()){new rr.Notice("Current line is empty or contains no valid content.");return}if(this.plugin.settings.enableNaturalLanguageInput){let m=this.tryNLPFallback(f,a||"");m?o=m:o={title:f,isCompleted:!1}}else o={title:f,isCompleted:!1}}let c=this.validateTaskData(o);if(!c.isValid){new rr.Notice(c.error||"Invalid task data.");return}let d=await this.createTaskFile(o,a),u=await this.replaceOriginalTaskLines(t,i,d,o.title);if(!u.success){new rr.Notice(u.error||"Failed to replace task line.");try{await this.plugin.app.vault.delete(d)}catch(f){console.warn("Failed to clean up created file after replacement failure:",f)}return}let h=this.sanitizeTitle(o.title),p=d.basename;p.startsWith("task-")&&p!==h?new rr.Notice(`Task converted: "${o.title}" (filename shortened due to length)`):new rr.Notice(`Task converted: ${o.title}`),await this.refreshTaskLinkOverlays(t,d)}catch(r){console.error("Error during instant task conversion:",r),r.message.includes("file already exists")?new rr.Notice("A file with this name already exists. Please try again or rename the task."):r.message.includes("invalid characters")?new rr.Notice("Task title contains invalid characters for filename."):new rr.Notice("Failed to convert task. Please try again.")}}extractSelectionInfo(t,e){let r=t.getSelection();if(r&&r.trim()){let n=t.listSelections()[0],a=Math.min(n.anchor.line,n.head.line),o=Math.max(n.anchor.line,n.head.line);if(e>=a&&e<=o){let l=[];for(let h=a;h<=o;h++)l.push(t.getLine(h));let c=l[0],u=l.slice(1).join(`
`).trimEnd();return{taskLine:c,details:u,startLine:a,endLine:o,originalContent:l}}}let i=t.getLine(e);return{taskLine:i,details:"",startLine:e,endLine:e,originalContent:[i]}}validateInputParameters(t,e){if(!t)return{isValid:!1,error:"Editor is not available."};let r=t.lineCount();if(e<0||e>=r)return{isValid:!1,error:`Line number ${e} is out of bounds (0-${r-1}).`};let i=t.getLine(e);return i==null?{isValid:!1,error:`Cannot read line ${e}.`}:{isValid:!0}}validateTaskData(t){if(!t.title||t.title.trim().length===0)return{isValid:!1,error:"Task title cannot be empty."};let e=/[<>:"/\\|?*]/,r=t.title.split("").some(n=>{let a=n.charCodeAt(0);return a<=31||a===127});if(e.test(t.title)||r)return{isValid:!1,error:"Task title contains invalid characters for file operations."};let i=["dueDate","scheduledDate","startDate","createdDate","doneDate"];for(let n of i){let a=t[n];if(a&&!this.isValidDateFormat(a))return{isValid:!1,error:`Invalid date format in ${n}: ${a}`}}return{isValid:!0}}isValidDateFormat(t){if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;try{let r=Ae(t);return ae(r)===t}catch(r){return!1}}async createTaskFile(t,e=""){var G,V;let r=this.sanitizeTitle(t.title)||"Untitled Task",i=this.plugin.app.workspace.getActiveFile(),n=i?this.plugin.app.fileManager.generateMarkdownLink(i,i.path):"",a=this.sanitizeDate(t.dueDate),o=this.sanitizeDate(t.scheduledDate),l=((G=t.dueTime)==null?void 0:G.trim())||void 0,c=((V=t.scheduledTime)==null?void 0:V.trim())||void 0,d,u,h,p,f=[],m=[this.plugin.settings.taskTag],g,y,w=t.tags||[],T=t.contexts||[],S=t.projects||[];if(this.plugin.settings.useDefaultsOnInstantConvert){let k=this.plugin.settings.taskCreationDefaults;if(d=(t.priority?this.sanitizePriority(t.priority):"")||this.plugin.settings.defaultTaskPriority,u=(t.status?this.sanitizeStatus(t.status):"")||this.plugin.settings.defaultTaskStatus,a?h=l?ar(a,l):a:k.defaultDueDate!=="none"&&(h=Gr(k.defaultDueDate)),o?p=c?ar(o,c):o:k.defaultScheduledDate!=="none"&&(p=Gr(k.defaultScheduledDate)),f=[],T.length>0&&f.push(...T),k.defaultContexts){let D=k.defaultContexts.split(",").map(_=>_.trim()).filter(_=>_);f.push(...D)}if(f=[...new Set(f)],m=[this.plugin.settings.taskTag],w.length>0&&m.push(...w),k.defaultTags){let D=k.defaultTags.split(",").map(_=>_.trim()).filter(_=>_);m.push(...D)}m=[...new Set(m)],k.defaultTimeEstimate&&k.defaultTimeEstimate>0&&(g=k.defaultTimeEstimate),k.defaultRecurrence&&k.defaultRecurrence!=="none"&&(y={frequency:k.defaultRecurrence})}else d=(t.priority?this.sanitizePriority(t.priority):"")||"none",u=(t.status?this.sanitizeStatus(t.status):"")||"none",h=a?l?ar(a,l):a:void 0,p=o?c?ar(o,c):o:void 0,f=[],T.length>0&&f.push(...T),m=[this.plugin.settings.taskTag],w.length>0&&m.push(...w),m=[...new Set(m)];let x=[];if(this.plugin.settings.useDefaultsOnInstantConvert){let k=this.plugin.settings.taskCreationDefaults;if(k.defaultProjects){let D=hi(k.defaultProjects);x.push(...D)}k.useParentNoteAsProject&&i&&x.push(n)}S.length>0&&x.push(...S);let I=[...new Set(x)],F;if(this.plugin.settings.useDefaultsOnInstantConvert){let k=this.plugin.settings.taskCreationDefaults;if(k.defaultReminders&&k.defaultReminders.length>0){let{convertDefaultRemindersToReminders:D}=await Promise.resolve().then(()=>(Gc(),qc));F=D(k.defaultReminders)}}let A={title:r,status:u,priority:d,due:h,scheduled:p,contexts:f.length>0?f:void 0,projects:I.length>0?I:void 0,tags:m,timeEstimate:g,recurrence:y,reminders:F,details:e,parentNote:n,creationContext:"inline-conversion",dateCreated:ke(),dateModified:ke()},{file:L}=await this.plugin.taskService.createTask(A);return L}sanitizeTitle(t){return t?t.trim().substring(0,200):""}sanitizePriority(t){return this.priorityManager.getAllPriorities().map(r=>r&&typeof r=="object"?r.value:r).filter(r=>r!=null).includes(t)?t:""}sanitizeStatus(t){return this.statusManager.getAllStatuses().map(r=>r&&typeof r=="object"?r.value:r).filter(r=>r!=null).includes(t)?t:""}sanitizeDate(t){return!t||!this.isValidDateFormat(t)?"":t}async replaceOriginalTaskLines(t,e,r,i){var n;try{if(!t||!r)return{success:!1,error:"Invalid editor or file reference."};let{startLine:a,endLine:o,originalContent:l}=e,c=t.lineCount();if(a<0||o>=c)return{success:!1,error:`Line range ${a}-${o} is no longer valid (current line count: ${c}).`};for(let S=0;S<l.length;S++)if(t.getLine(a+S)!==l[S])return{success:!1,error:"Content has changed since parsing. Please try again."};let d=hr.parseTaskLine(l[0]),u=d.isTaskLine;if(u&&!d.isTaskLine)return{success:!1,error:"First line is no longer a valid task."};if(!u&&!this.extractLineContentAsTitle(l[0]).trim())return{success:!1,error:"First line no longer contains valid content."};let h=((n=l[0].match(/^(\s*)/))==null?void 0:n[1])||"",p="";if(u){let S=l[0].match(/^\s*((?:[-*+]|\d+\.)\s+)\[/);p=(S==null?void 0:S[1])||"- "}else{let S=l[0].match(/^\s*([-*+]\s+)/),x=l[0].match(/^\s*(\d+\.\s+)/),I=l[0].match(/^\s*(>\s*)/);S?p=S[1]:x?p=x[1]:I?p=I[1]:p="- "}let f=this.plugin.app.workspace.getActiveFile(),m=(f==null?void 0:f.path)||"",g=this.plugin.app.fileManager.generateMarkdownLink(r,m),y=`${h}${p}${g}`;if(y.length>500)return{success:!1,error:"Generated link text is too long."};let w={line:a,ch:0},T={line:o,ch:t.getLine(o).length};return t.replaceRange(y,w,T),{success:!0}}catch(a){return console.error("Error replacing task lines:",a),{success:!1,error:`Failed to replace lines: ${a.message}`}}}async refreshTaskLinkOverlays(t,e){try{await this.forceMetadataCacheUpdate(e),setTimeout(()=>{try{let r=t.cm;if(r){let i=t.getCursor();vn(r,e.path),setTimeout(()=>{try{t.setCursor(i)}catch(n){console.debug("Error restoring cursor position:",n)}},10)}}catch(r){console.debug("Error dispatching task update for overlays:",r)}},100)}catch(r){console.debug("Error refreshing task link overlays:",r)}}async forceMetadataCacheUpdate(t){try{await this.plugin.app.vault.cachedRead(t),this.plugin.app.metadataCache.getFileCache(t)===null&&setTimeout(async()=>{try{await this.plugin.app.vault.cachedRead(t)}catch(e){console.debug("Error in delayed cache update:",e)}},10)}catch(e){console.debug("Error forcing metadata cache update:",e)}}hasUsefulMetadata(t){return!!(t.dueDate||t.scheduledDate||t.startDate||t.priority||t.status||t.recurrence||t.createdDate||t.doneDate||t.tags&&t.tags.length>0||t.projects&&t.projects.length>0)}tryNLPFallback(t,e){var r;try{let i=this.extractTaskContent(t);if(!i.trim())return null;let n=e.trim().length>0?`${i}
${e}`:i,a=this.nlParser.parseInput(n);return(r=a.title)!=null&&r.trim()?{title:a.title.trim(),isCompleted:a.isCompleted||!1,status:a.status,priority:a.priority,dueDate:a.dueDate,scheduledDate:a.scheduledDate,dueTime:a.dueTime,scheduledTime:a.scheduledTime,recurrence:a.recurrence,tags:a.tags&&a.tags.length>0?a.tags:void 0,projects:a.projects&&a.projects.length>0?this.resolveProjectLinks(a.projects):void 0,contexts:a.contexts&&a.contexts.length>0?a.contexts:void 0,startDate:void 0,createdDate:void 0,doneDate:void 0,recurrenceData:void 0}:null}catch(i){return console.debug("NLP fallback parsing failed:",i),null}}resolveProjectLinks(t){var e,r,i;try{if(!((r=(e=this.plugin.app)==null?void 0:e.workspace)!=null&&r.getActiveFile)||!((i=this.plugin.app)!=null&&i.metadataCache))return t;let n=this.plugin.app.workspace.getActiveFile(),a=(n==null?void 0:n.path)||"";return t.map(o=>{let l=o.match(/^\[\[([^\]]+)\]\]$/);if(l){let c=l[1],d=c;c.includes("|")&&(d=c.split("|")[0]);try{let u=this.plugin.app.metadataCache.getFirstLinkpathDest(d,a);if(u)return`[[${this.plugin.app.metadataCache.fileToLinktext(u,a,!0)}]]`}catch(u){console.debug("Error resolving project link:",u)}return o}return o})}catch(n){return console.debug("Error in resolveProjectLinks:",n),t}}extractTaskContent(t){return t.replace(/^\s*(?:[-*+]|\d+\.)\s*\[[ xX]\]\s*/,"").trim()}extractLineContentAsTitle(t){let e=t.trim();for(e=e.replace(/^\s*[-*+]\s+/,""),e=e.replace(/^\s*\d+\.\s+/,"");e.match(/^\s*>\s*/);)e=e.replace(/^\s*>\s*/,"");return e=e.replace(/^\s*#+\s+/,""),e.match(/^\s*(-{3,}|={3,})\s*$/)?"":e.trim()}findAllCheckboxTasks(t){let e=[],r=t.lineCount();for(let i=0;i<r;i++){let n=t.getLine(i);if(hr.parseTaskLine(n).isTaskLine){e.push({lineNumber:i,line:n});continue}if(n.trim().includes("[ ]")||n.trim().includes("[x]")||n.trim().includes("[X]")){let o=n.trim();for(;o.match(/^\s*>\s*/);)o=o.replace(/^\s*>\s*/,"");hr.parseTaskLine(o).isTaskLine&&e.push({lineNumber:i,line:n})}}return e}async parseTaskForBatch(t){try{let e=hr.parseTaskLine(t);if(e.isTaskLine){if(e.error||!e.parsedData)return null;if(!this.hasUsefulMetadata(e.parsedData)&&this.plugin.settings.enableNaturalLanguageInput){let i=this.tryNLPFallback(t,"");if(i)return i}return e.parsedData}else{let r=this.extractLineContentAsTitle(t);if(!r.trim())return null;if(this.plugin.settings.enableNaturalLanguageInput){let i=this.tryNLPFallback(r,"");if(i)return i}return{title:r,isCompleted:!1}}}catch(e){return console.warn("Error parsing task for batch:",e),null}}generateLinkText(t,e){var d;let r=((d=t.match(/^(\s*)/))==null?void 0:d[1])||"",n=hr.parseTaskLine(t).isTaskLine,a="";if(n){let u=t.match(/^\s*((?:[-*+]|\d+\.)\s+)\[/);a=(u==null?void 0:u[1])||"- "}else{let u=t.match(/^\s*([-*+]\s+)/),h=t.match(/^\s*(\d+\.\s+)/),p=t.match(/^\s*(>\s*)/);u?a=u[1]:h?a=h[1]:p?a=p[1]:a="- "}let o=this.plugin.app.workspace.getActiveFile(),l=(o==null?void 0:o.path)||"",c=this.plugin.app.fileManager.generateMarkdownLink(e,l);return`${r}${a}${c}`}replaceAllTaskLines(t,e){let r=e.sort((i,n)=>n.lineNumber-i.lineNumber);for(let i of r){let n=t.getLine(i.lineNumber).length;t.replaceRange(i.linkText,{line:i.lineNumber,ch:0},{line:i.lineNumber,ch:n})}}}});var f_={};Ur(f_,{createInstantConvertButtons:()=>X1,createInstantConvertField:()=>p_});function p_(s){return kp.StateField.define({create(){return li.Decoration.none},update(t,e){if(!s||!e)return li.Decoration.none;if(!s.settings||!s.settings.enableInstantTaskConvert)return li.Decoration.none;if(!e.state)return console.warn("Invalid transaction state in instant convert field update"),li.Decoration.none;try{return!e.docChanged&&t!==li.Decoration.none?t.map(e.changes):J1(e.state,s)}catch(r){return console.error("Error updating instant convert decorations:",r),li.Decoration.none}},provide(t){return li.EditorView.decorations.from(t)}})}function J1(s,t){let e=new kp.RangeSetBuilder,r=s.doc;if(!r||!t)return console.warn("Invalid state or plugin for building convert button decorations"),e.finish();if(typeof r.lines!="number"||r.lines<0)return console.warn("Invalid document lines count:",r.lines),e.finish();for(let i=0;i<r.lines;i++)try{let n=r.line(i+1);if(!n||typeof n.text!="string")continue;let a=n.text;if(a.length>1e3)continue;let o=hr.parseTaskLine(a);if(o.isTaskLine&&o.parsedData){if(!o.parsedData.title||o.parsedData.title.trim().length===0||typeof n.to!="number"||n.to<0)continue;let l=new tv(t,i),c=li.Decoration.widget({widget:l,side:1});e.add(n.to,n.to,c)}}catch(n){console.debug("Error processing line",i,":",n);continue}return e.finish()}function X1(s){return p_(s)}var kp,li,$o,tv,m_=v(()=>{kp=require("@codemirror/state"),li=require("@codemirror/view"),$o=require("obsidian");Xy();tv=class s extends li.WidgetType{constructor(t,e){super(),this.plugin=t,this.lineNumber=e}toDOM(t){let e=document.createElement("span");e.className="tasknotes-plugin";let r=e.createEl("button",{cls:"instant-convert-button",attr:{"aria-label":"Convert to TaskNote"}});(0,$o.setTooltip)(r,"Convert to TaskNote",{placement:"top"});let i=r.createEl("span",{cls:"instant-convert-button__icon"});return(0,$o.setIcon)(i,"file-plus"),r.addEventListener("mousedown",async n=>{n.preventDefault(),n.stopPropagation();try{if(!this.validateButtonClick())return;let a=this.plugin.app.workspace.getActiveViewOfType($o.MarkdownView);if(!a){console.warn("No active markdown view available for task conversion");return}let o=a.editor;if(!this.validateEditorState(o))return;this.plugin.instantTaskConvertService&&o&&await this.plugin.instantTaskConvertService.instantConvertTask(o,this.lineNumber)}catch(a){console.error("Error in convert button click handler:",a)}}),e}eq(t){return t instanceof s&&t.plugin===this.plugin&&t.lineNumber===this.lineNumber}get estimatedHeight(){return-1}ignoreEvent(){return!1}validateButtonClick(){return this.plugin?this.plugin.settings.enableInstantTaskConvert?typeof this.lineNumber!="number"||this.lineNumber<0?(console.warn("Invalid line number for task conversion:",this.lineNumber),!1):!0:(console.warn("Instant task conversion is disabled"),!1):(console.warn("Plugin not available for task conversion"),!1)}validateEditorState(t){if(!t)return console.warn("Editor not available for task conversion"),!1;let e=t.lineCount();if(this.lineNumber>=e)return console.warn(`Line number ${this.lineNumber} is out of bounds (total lines: ${e})`),!1;try{let r=t.getLine(this.lineNumber);return r?hr.parseTaskLine(r).isTaskLine?!0:(console.warn(`Line ${this.lineNumber} is no longer a task`),!1):(console.warn(`Cannot read line ${this.lineNumber}`),!1)}catch(r){return console.warn("Error validating line content:",r),!1}}}});var g_={};Ur(g_,{DueDateModal:()=>rv});var cd,rv,y_=v(()=>{cd=require("obsidian");ot();Se();rv=class extends cd.Modal{constructor(t,e,r){super(t),this.task=e,this.plugin=r}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("tasknotes-plugin"),this.titleEl.setText("Set due date"),this.titleEl.setAttribute("id","due-date-modal-title"),this.containerEl.setAttribute("aria-labelledby","due-date-modal-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),t.createEl("p",{text:`Task: ${this.task.title}`,cls:"due-date-modal__task-title"});let r=new cd.Setting(t).setName("Due date & time").setDesc("Enter due date and optional time (leave time empty for date-only)").controlEl.createDiv({cls:"modal-form__datetime-container"});this.dueDateInput=r.createEl("input",{type:"date",cls:"modal-form__input modal-form__input--date",attr:{"aria-label":"Due date for task",placeholder:"YYYY-MM-DD"}}),this.dueDateInput.value=ue(this.task.due||""),this.dueTimeInput=r.createEl("input",{type:"time",cls:"modal-form__input modal-form__input--time",attr:{"aria-label":"Due time for task (optional)",placeholder:"HH:MM"}}),this.dueTimeInput.value=jt(this.task.due||"")||"",this.dueDateInput.addEventListener("keydown",f=>{f.key==="Enter"?this.save():f.key==="Escape"&&this.close()}),this.dueTimeInput.addEventListener("keydown",f=>{f.key==="Enter"?this.save():f.key==="Escape"&&this.close()}),setTimeout(()=>this.dueDateInput.focus(),100);let i=t.createDiv({cls:"modal-form__group"});new cd.Setting(i).setName("Quick options").setHeading();let n=i.createDiv({cls:"modal-form__quick-actions"});n.createEl("button",{text:"Today",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to today"}}).addEventListener("click",()=>{this.dueDateInput.value=C(new Date,"yyyy-MM-dd")}),n.createEl("button",{text:"Tomorrow",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to tomorrow"}}).addEventListener("click",()=>{this.dueDateInput.value=C(ba(new Date,{days:1}),"yyyy-MM-dd")}),n.createEl("button",{text:"Next week",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to next week"}}).addEventListener("click",()=>{this.dueDateInput.value=C(ba(new Date,{weeks:1}),"yyyy-MM-dd")}),n.createEl("button",{text:"Now",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date and time to now"}}).addEventListener("click",()=>{let f=new Date;this.dueDateInput.value=C(f,"yyyy-MM-dd"),this.dueTimeInput.value=C(f,"HH:mm")}),n.createEl("button",{text:"Clear",cls:"modal-form__button modal-form__button--quick-date modal-form__button--quick-date--clear",attr:{"aria-label":"Clear due date"}}).addEventListener("click",()=>{this.dueDateInput.value="",this.dueTimeInput.value=""});let u=t.createDiv({cls:"modal-form__buttons"});u.createEl("button",{text:"Save",cls:"modal-form__button modal-form__button--primary"}).addEventListener("click",()=>this.save()),u.createEl("button",{text:"Cancel",cls:"modal-form__button modal-form__button--secondary"}).addEventListener("click",()=>this.close())}async save(){let t=this.dueDateInput.value.trim(),e=this.dueTimeInput.value.trim(),r;if(t?e?r=ar(t,e):r=t:r=void 0,!Hd(t,e)){let i=this.contentEl.createEl("div",{text:"Please enter a valid date and time format",cls:"modal-form__error",attr:{role:"alert","aria-live":"assertive"}});this.dueDateInput.setAttribute("aria-invalid","true"),this.dueDateInput.setAttribute("aria-describedby","due-date-error"),i.setAttribute("id","due-date-error"),setTimeout(()=>{i.remove(),this.dueDateInput.removeAttribute("aria-invalid"),this.dueDateInput.removeAttribute("aria-describedby")},3e3);return}try{await this.plugin.taskService.updateProperty(this.task,"due",r),this.close()}catch(i){console.error("Failed to update due date:",i);let n=this.contentEl.createEl("div",{text:"Failed to update due date. Please try again.",cls:"modal-form__error"});setTimeout(()=>n.remove(),3e3)}}onClose(){let{contentEl:t}=this;t.empty()}}});var v_={};Ur(v_,{ScheduledDateModal:()=>iv});var dd,iv,w_=v(()=>{dd=require("obsidian");ot();Se();iv=class extends dd.Modal{constructor(t,e,r){super(t),this.task=e,this.plugin=r}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("tasknotes-plugin"),this.titleEl.setText("Set scheduled date"),this.titleEl.setAttribute("id","scheduled-date-modal-title"),this.containerEl.setAttribute("aria-labelledby","scheduled-date-modal-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),t.createEl("p",{text:`Task: ${this.task.title}`,cls:"scheduled-date-modal__task-title"});let r=new dd.Setting(t).setName("Scheduled Date & Time").setDesc("Enter scheduled date and optional time (leave time empty for date-only)").controlEl.createDiv({cls:"modal-form__datetime-container"});this.scheduledDateInput=r.createEl("input",{type:"date",cls:"modal-form__input modal-form__input--date",attr:{"aria-label":"Scheduled date for task",placeholder:"YYYY-MM-DD"}}),this.scheduledDateInput.value=ue(this.task.scheduled||""),this.scheduledTimeInput=r.createEl("input",{type:"time",cls:"modal-form__input modal-form__input--time",attr:{"aria-label":"Scheduled time for task (optional)",placeholder:"HH:MM"}}),this.scheduledTimeInput.value=jt(this.task.scheduled||"")||"",this.scheduledDateInput.addEventListener("keydown",f=>{f.key==="Enter"?this.save():f.key==="Escape"&&this.close()}),this.scheduledTimeInput.addEventListener("keydown",f=>{f.key==="Enter"?this.save():f.key==="Escape"&&this.close()}),window.setTimeout(()=>this.scheduledDateInput.focus(),100);let i=t.createDiv({cls:"modal-form__group"});new dd.Setting(i).setName("Quick options").setHeading();let n=i.createDiv({cls:"modal-form__quick-actions"});n.createEl("button",{text:"Today",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to today"}}).addEventListener("click",()=>{this.scheduledDateInput.value=C(new Date,"yyyy-MM-dd")}),n.createEl("button",{text:"Tomorrow",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to tomorrow"}}).addEventListener("click",()=>{this.scheduledDateInput.value=C(ba(new Date,{days:1}),"yyyy-MM-dd")}),n.createEl("button",{text:"Next week",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to next week"}}).addEventListener("click",()=>{this.scheduledDateInput.value=C(ba(new Date,{weeks:1}),"yyyy-MM-dd")}),n.createEl("button",{text:"Now",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date and time to now"}}).addEventListener("click",()=>{let f=new Date;this.scheduledDateInput.value=C(f,"yyyy-MM-dd"),this.scheduledTimeInput.value=C(f,"HH:mm")}),n.createEl("button",{text:"Clear",cls:"modal-form__button modal-form__button--quick-date modal-form__button--quick-date--clear",attr:{"aria-label":"Clear scheduled date"}}).addEventListener("click",()=>{this.scheduledDateInput.value="",this.scheduledTimeInput.value=""});let u=t.createDiv({cls:"modal-form__buttons"});u.createEl("button",{text:"Save",cls:"modal-form__button modal-form__button--primary"}).addEventListener("click",()=>this.save()),u.createEl("button",{text:"Cancel",cls:"modal-form__button modal-form__button--secondary"}).addEventListener("click",()=>this.close())}async save(){let t=this.scheduledDateInput.value.trim(),e=this.scheduledTimeInput.value.trim(),r;if(t?e?r=ar(t,e):r=t:r=void 0,!Hd(t,e)){let i=this.contentEl.createEl("div",{text:"Please enter a valid date and time format",cls:"modal-form__error",attr:{role:"alert","aria-live":"assertive"}});this.scheduledDateInput.setAttribute("aria-invalid","true"),this.scheduledDateInput.setAttribute("aria-describedby","scheduled-date-error"),i.setAttribute("id","scheduled-date-error"),window.setTimeout(()=>{i.remove(),this.scheduledDateInput.removeAttribute("aria-invalid"),this.scheduledDateInput.removeAttribute("aria-describedby")},3e3);return}try{await this.plugin.taskService.updateProperty(this.task,"scheduled",r),this.close()}catch(i){console.error("Failed to update scheduled date:",i);let n=this.contentEl.createEl("div",{text:"Failed to update scheduled date. Please try again.",cls:"modal-form__error"});window.setTimeout(()=>n.remove(),3e3)}}onClose(){let{contentEl:t}=this;t.empty()}}});var T_={};Ur(T_,{TaskActionPaletteModal:()=>sv});var xt,sv,b_=v(()=>{xt=require("obsidian"),sv=class extends xt.FuzzySuggestModal{constructor(t,e,r,i){super(t),this.task=e,this.plugin=r,this.targetDate=i,this.actions=this.buildActionsList(),this.setPlaceholder("Type to search for an action..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to execute"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText(`Quick actions: ${e.title}`),this.titleEl.setAttribute("id","task-action-palette-title"),this.containerEl.setAttribute("aria-labelledby","task-action-palette-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),this.containerEl.addClass("task-action-palette-modal")}buildActionsList(){let t=[];(this.task.recurrence?this.plugin.statusManager.getNonCompletionStatuses():this.plugin.statusManager.getAllStatuses()).forEach(i=>{let n=this.task.status===i.value;t.push({id:`status-${i.value}`,title:`Change status to "${i.label}"`,description:`Set task status to ${i.label}`,icon:n?"check":"circle",category:"status",keywords:["status",i.value,i.label,"change","set"],isApplicable:()=>!n,execute:async a=>{await this.plugin.updateTaskProperty(a,"status",i.value),new xt.Notice(`Status changed to ${i.label}`)}})}),this.plugin.priorityManager.getAllPriorities().forEach(i=>{let n=this.task.priority===i.value;t.push({id:`priority-${i.value}`,title:`Set priority to "${i.label}"`,description:`Change task priority to ${i.label}`,icon:n?"check":"flag",category:"priority",keywords:["priority",i.value,i.label,"change","set"],isApplicable:()=>!n,execute:async a=>{await this.plugin.updateTaskProperty(a,"priority",i.value),new xt.Notice(`Priority changed to ${i.label}`)}})}),t.push({id:"set-due-date",title:"Set due date",description:"Set or change the task due date",icon:"calendar",category:"dates",keywords:["due","date","deadline","set","change"],isApplicable:()=>!0,execute:async i=>{this.plugin.openDueDateModal(i)}},{id:"set-scheduled-date",title:"Set scheduled date",description:"Set or change when the task is scheduled",icon:"calendar-clock",category:"dates",keywords:["scheduled","date","schedule","set","change"],isApplicable:()=>!0,execute:async i=>{this.plugin.openScheduledDateModal(i)}},{id:"clear-due-date",title:"Clear due date",description:"Remove the due date from this task",icon:"calendar-x",category:"dates",keywords:["clear","remove","due","date"],isApplicable:i=>!!i.due,execute:async i=>{await this.plugin.updateTaskProperty(i,"due",void 0),new xt.Notice("Due date cleared")}},{id:"clear-scheduled-date",title:"Clear scheduled date",description:"Remove the scheduled date from this task",icon:"calendar-x",category:"dates",keywords:["clear","remove","scheduled","date"],isApplicable:i=>!!i.scheduled,execute:async i=>{await this.plugin.updateTaskProperty(i,"scheduled",void 0),new xt.Notice("Scheduled date cleared")}});let r=this.plugin.getActiveTimeSession(this.task);return t.push({id:"toggle-time-tracking",title:r?"Stop time tracking":"Start time tracking",description:r?"Stop tracking time for this task":"Start tracking time for this task",icon:r?"pause":"play",category:"tracking",keywords:["time","tracking","timer",r?"stop":"start"],isApplicable:()=>!0,execute:async i=>{this.plugin.getActiveTimeSession(i)?(await this.plugin.stopTimeTracking(i),new xt.Notice("Time tracking stopped")):(await this.plugin.startTimeTracking(i),new xt.Notice("Time tracking started"))}}),t.push({id:"toggle-archive",title:this.task.archived?"Unarchive task":"Archive task",description:this.task.archived?"Move task back to active tasks":"Archive this task",icon:this.task.archived?"archive-restore":"archive",category:"organization",keywords:["archive",this.task.archived?"unarchive":"archive","organize"],isApplicable:()=>!0,execute:async i=>{await this.plugin.toggleTaskArchive(i),new xt.Notice(i.archived?"Task unarchived":"Task archived")}}),this.task.recurrence&&t.push({id:"complete-recurring-instance",title:"Complete this occurrence",description:"Mark this specific instance of the recurring task as complete",icon:"check-circle",category:"status",keywords:["complete","done","finish","recurring","instance","occurrence"],isApplicable:(i,n,a)=>!n.statusManager.isCompletedStatus(i.status),execute:async(i,n,a)=>{await n.toggleRecurringTaskComplete(i,a),new xt.Notice("Recurring task instance completed")}}),t.push({id:"edit-task",title:"Edit task details",description:"Open the full task editor",icon:"edit",category:"other",keywords:["edit","modify","details","properties"],isApplicable:()=>!0,execute:async i=>{await this.plugin.openTaskEditModal(i)}},{id:"open-task-file",title:"Open task file",description:"Open the task file in the editor",icon:"file-text",category:"other",keywords:["open","file","editor","edit"],isApplicable:()=>!0,execute:async i=>{let n=this.plugin.app.vault.getAbstractFileByPath(i.path);n&&await this.plugin.app.workspace.getLeaf(!0).openFile(n)}},{id:"copy-task-title",title:"Copy task title",description:"Copy the task title to clipboard",icon:"copy",category:"other",keywords:["copy","clipboard","title"],isApplicable:()=>!0,execute:async i=>{try{await navigator.clipboard.writeText(i.title),new xt.Notice("Task title copied to clipboard")}catch(n){new xt.Notice("Failed to copy to clipboard")}}},{id:"copy-task-link",title:"Copy task link",description:"Copy a wikilink to this task",icon:"link",category:"other",keywords:["copy","link","wikilink","reference"],isApplicable:()=>!0,execute:async i=>{try{let n=this.plugin.app.vault.getAbstractFileByPath(i.path);if(n){let a=this.plugin.app.metadataCache.fileToLinktext(n,"");await navigator.clipboard.writeText(`[[${a}]]`),new xt.Notice("Task link copied to clipboard")}}catch(n){new xt.Notice("Failed to copy to clipboard")}}},{id:"delete-task",title:"Delete task",description:"Permanently delete this task",icon:"trash",category:"other",keywords:["delete","remove","trash"],isApplicable:()=>!0,execute:async i=>{this.close();let{showDeleteConfirmationModal:n}=await Promise.resolve().then(()=>(Ss(),Ny));await n(i,this.plugin)}}),t}getItems(){return this.actions.filter(t=>t.isApplicable(this.task,this.plugin,this.targetDate)).sort((t,e)=>{var a,o;let r={status:0,priority:1,dates:2,tracking:3,organization:4,other:5},i=(a=r[t.category])!=null?a:999,n=(o=r[e.category])!=null?o:999;return i!==n?i-n:t.title.localeCompare(e.title)})}getItemText(t){return[t.title,t.description,t.category,...t.keywords].join(" ")}renderSuggestion(t,e){let r=t.item,i=e.createDiv({cls:"task-action-palette__suggestion"}),n=i.createDiv({cls:"task-action-palette__icon"});(0,xt.setIcon)(n,r.icon);let a=i.createDiv({cls:"task-action-palette__content"});a.createDiv({cls:"task-action-palette__title",text:r.title}),a.createDiv({cls:"task-action-palette__description",text:r.description}),i.createDiv({cls:"task-action-palette__badge"}).createSpan({cls:`task-action-palette__category task-action-palette__category--${r.category}`,text:r.category})}async onChooseItem(t,e){try{let r=await this.plugin.cacheManager.getTaskInfo(this.task.path);if(!r){new xt.Notice("Task not found");return}await t.execute(r,this.plugin,this.targetDate)}catch(r){let i=r instanceof Error?r.message:String(r);console.error("Error executing action:",{error:i,actionId:t.id,taskPath:this.task.path}),new xt.Notice(`Failed to execute action: ${i}`)}}}});var tH={};Ur(tH,{default:()=>eH});module.exports=mv(tH);var de=require("obsidian");ot();var Dn=bt(Vr());Dd();var E=require("obsidian");Dd();Cd();var Aa=class s{constructor(t){this.priorities=t}getPriorityConfig(t){return this.priorities.find(e=>e.value===t)}getPrioritiesByWeight(){return[...this.priorities].sort((t,e)=>e.weight-t.weight)}getPrioritiesByWeightAsc(){return[...this.priorities].sort((t,e)=>t.weight-e.weight)}getNextPriority(t){var n;let e=this.getPrioritiesByWeightAsc(),r=e.findIndex(a=>a.value===t);if(r===-1)return((n=e[0])==null?void 0:n.value)||"normal";let i=(r+1)%e.length;return e[i].value}comparePriorities(t,e){let r=this.getPriorityConfig(t),i=this.getPriorityConfig(e),n=(r==null?void 0:r.weight)||0;return((i==null?void 0:i.weight)||0)-n}getPriorityStyles(){let t=[];for(let e of this.priorities){let r=`--priority-${e.value.replace(/[^a-zA-Z0-9-]/g,"-")}-color`;t.push(`${r}: ${e.color};`)}return`:root { ${t.join(" ")} }`}getAllPriorities(){return[...this.priorities]}updatePriorities(t){this.priorities=t}getHighestPriority(){var e;return(e=this.getPrioritiesByWeight()[0])==null?void 0:e.value}getLowestPriority(){var e;return(e=this.getPrioritiesByWeightAsc()[0])==null?void 0:e.value}getPriorityWeight(t){let e=this.getPriorityConfig(t);return(e==null?void 0:e.weight)||0}isHigherPriority(t,e){return this.comparePriorities(t,e)>0}static validatePriorities(t){let e=[];t.length<1&&e.push("At least 1 priority is required");let r=t.map(c=>c.value),i=new Set(r);r.length!==i.size&&e.push("Priority values must be unique");let n=t.map(c=>c.id),a=new Set(n);n.length!==a.size&&e.push("Priority IDs must be unique");let o=t.map(c=>c.weight),l=new Set(o);o.length!==l.size&&e.push("Priority weights must be unique");for(let c of t){if(!c.value||c.value.trim()===""){e.push("Priority values cannot be empty");break}if(!c.label||c.label.trim()===""){e.push("Priority labels cannot be empty");break}if(!c.color||!c.color.match(/^#[0-9a-fA-F]{6}$/)){e.push("Priority colors must be valid hex colors (#rrggbb)");break}if(typeof c.weight!="number"||c.weight<0){e.push("Priority weights must be non-negative numbers");break}}return{valid:e.length===0,errors:e}}static generatePriorityId(t){let e=new Set(t.map(n=>n.id)),r=1,i=`priority-${r}`;for(;e.has(i);)r++,i=`priority-${r}`;return i}static generatePriorityWeight(t){let e=t.map(r=>r.weight);return e.length===0?1:Math.max(...e)+1}static createDefaultPriority(t){let e=s.generatePriorityId(t),r=s.generatePriorityWeight(t);return{id:e,value:"new-priority",label:"New priority",color:"#808080",weight:r}}};Md();var _d=require("obsidian"),sf=class extends _d.Modal{constructor(t,e){super(t),this.hasExistingData=e}show(){return new Promise(t=>{this.resolve=t,this.open()})}onOpen(){let{contentEl:t}=this;t.empty();let e=this.hasExistingData?"Migrate pomodoro data?":"Switch to daily notes storage?";new _d.Setting(t).setName(e).setHeading();let r=this.hasExistingData?"This will migrate your existing pomodoro session data to daily notes frontmatter. The data will be grouped by date and stored in each daily note.":"Pomodoro session data will be stored in daily notes frontmatter instead of the plugin data file.",n=t.createEl("p").createEl("strong");n.textContent=r,t.createEl("br"),t.createEl("p",{text:"What this means:"});let a=t.createEl("ul");["Daily Notes core plugin must remain enabled","Data will be stored in your daily notes frontmatter",this.hasExistingData?"Existing plugin data will be migrated and then cleared":"Future sessions will be saved to daily notes","This provides better data longevity with your notes"].forEach(h=>{let p=a.createEl("li");p.textContent=`\u2022 ${h}`}),t.createEl("br");let l=t.createEl("p");if(this.hasExistingData){let h=l.createEl("strong");h.textContent="\u26A0\uFE0F Make sure you have backups if needed. This change cannot be automatically undone."}else l.textContent="You can switch back to plugin storage at any time in the future.";let c=t.createEl("div",{cls:"modal-button-container"});c.style.display="flex",c.style.gap="10px",c.style.justifyContent="flex-end",c.style.marginTop="20px",c.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.resolve(!1),this.close()});let u=c.createEl("button",{text:this.hasExistingData?"Migrate data":"Switch storage",cls:"mod-cta"});u.addEventListener("click",()=>{this.resolve(!0),this.close()}),window.setTimeout(()=>{u.focus()},50)}onClose(){let{contentEl:t}=this;t.empty(),this.resolve&&this.resolve(!1)}};async function _S(s,t){return new sf(s,t).show()}var Ji=require("obsidian"),Ia=class extends Ji.FuzzySuggestModal{constructor(t,e,r){super(t),this.plugin=e,this.onChoose=r,this.setPlaceholder("Type to search for project notes..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles().filter(t=>t instanceof Ji.TFile&&t.extension==="md"&&!t.path.includes(".trash"))}getItemText(t){let e=`${t.name} ${t.path}`;if(t instanceof Ji.TFile){let r=this.app.metadataCache.getFileCache(t);if(r!=null&&r.frontmatter){let i=(0,Ji.parseFrontMatterAliases)(r.frontmatter);i&&i.length>0&&(e+=` ${i.join(" ")}`)}}return e}renderSuggestion(t,e){let r=t.item;e.empty();let i=e.createDiv({cls:"project-suggestion"}),n=i.createSpan({cls:"project-name"});if(n.textContent=r.name,r instanceof Ji.TFile){let a=this.app.metadataCache.getFileCache(r);if(a!=null&&a.frontmatter){let o=this.plugin.fieldMapper.toUserField("title"),l=a.frontmatter[o];if(l){let c=i.createDiv({cls:"project-title"});c.textContent=l}else{let c=(0,Ji.parseFrontMatterAliases)(a.frontmatter);if(c&&c.length>0){let d=i.createDiv({cls:"project-aliases"});d.textContent=c.join(", ")}}}}if(r.path!==r.name){let a=i.createDiv({cls:"project-path"});a.textContent=r.path}}onChooseItem(t,e){this.onChoose(t)}};Pa();var Ad=class extends E.PluginSettingTab{constructor(e,r){super(e,r);this.activeTab="task-defaults";this.tabContents={};this.selectedDefaultProjectFiles=[];this.plugin=r}display(){let{containerEl:e}=this;e.empty(),e.addClass("tasknotes-settings"),e.addClass("tasknotes-plugin"),e.addClass("settings-view");let r=e.createDiv("settings-tab-nav settings-view__tab-nav"),i=[{id:"task-defaults",name:"Task defaults"},{id:"general",name:"Inline tasks"},{id:"calendar",name:"Calendar"},{id:"field-mapping",name:"Field mapping"},{id:"statuses",name:"Statuses"},{id:"priorities",name:"Priorities"},{id:"pomodoro",name:"Pomodoro"},{id:"notifications",name:"Notifications"},{id:"api",name:"HTTP API"},{id:"misc",name:"Misc"}],n=E.Platform.isMobile?i.filter(o=>o.id!=="api"):i;E.Platform.isMobile&&this.activeTab==="api"&&(this.activeTab="general"),n.forEach(o=>{let l=this.activeTab===o.id,c=r.createEl("button",{text:o.name,cls:l?"settings-tab-button settings-view__tab-button active settings-view__tab-button--active":"settings-tab-button settings-view__tab-button",attr:{role:"tab","aria-selected":l.toString(),"aria-controls":`settings-tab-${o.id}`,id:`tab-button-${o.id}`,tabindex:l?"0":"-1"}});c.addEventListener("click",()=>{this.switchTab(o.id)}),c.addEventListener("keydown",d=>{if(d.key==="ArrowLeft"||d.key==="ArrowRight"){d.preventDefault();let u=n.findIndex(f=>f.id===o.id),h=d.key==="ArrowRight"?(u+1)%n.length:(u-1+n.length)%n.length,p=n[h].id;this.switchTab(p)}})});let a=e.createDiv("settings-tab-contents settings-view__tab-contents");n.forEach(o=>{let l=a.createDiv("settings-tab-content settings-view__tab-content");l.setAttribute("role","tabpanel"),l.setAttribute("id",`settings-tab-${o.id}`),l.setAttribute("aria-labelledby",`tab-button-${o.id}`),this.activeTab===o.id&&(l.addClass("active"),l.addClass("settings-view__tab-content--active")),this.tabContents[o.id]=l}),this.renderActiveTab()}switchTab(e){this.activeTab=e,this.display(),window.setTimeout(()=>{let r=this.containerEl.querySelector(`#tab-button-${e}`);r&&r.focus()},50)}renderActiveTab(){switch(Object.values(this.tabContents).forEach(e=>e.empty()),this.activeTab){case"general":this.renderGeneralTab();break;case"task-defaults":this.renderTaskDefaultsTab();break;case"calendar":this.renderCalendarTab();break;case"field-mapping":this.renderFieldMappingTab();break;case"statuses":this.renderStatusesTab();break;case"priorities":this.renderPrioritiesTab();break;case"pomodoro":this.renderPomodoroTab();break;case"notifications":this.renderNotificationsTab();break;case"api":this.renderAPITab();break;case"misc":this.renderMiscTab();break}}renderGeneralTab(){let e=this.tabContents.general;new E.Setting(e).setName("Inline tasks").setHeading(),e.createEl("p",{text:"Configure how TaskNotes integrates with your editor and existing Markdown tasks.",cls:"settings-help-note"}),new E.Setting(e).setName("Task link overlay").setDesc("Replace wikilinks to task files with interactive task cards in both live preview and reading modes").addToggle(n=>(n.toggleEl.setAttribute("aria-label","Enable task link overlay in live preview and reading modes"),n.setValue(this.plugin.settings.enableTaskLinkOverlay).onChange(async a=>{this.plugin.settings.enableTaskLinkOverlay=a,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Instant task convert").setDesc("Show a convert button next to checkbox tasks for instant conversion to TaskNotes").addToggle(n=>(n.toggleEl.setAttribute("aria-label","Enable instant task conversion buttons"),n.setValue(this.plugin.settings.enableInstantTaskConvert).onChange(async a=>{this.plugin.settings.enableInstantTaskConvert=a,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Use task defaults on instant convert").setDesc("Apply your configured task creation defaults when converting checkbox tasks to TaskNotes (contexts, tags, dates, folder, etc.)").addToggle(n=>(n.toggleEl.setAttribute("aria-label","Apply task creation defaults during instant conversion"),n.setValue(this.plugin.settings.useDefaultsOnInstantConvert).onChange(async a=>{this.plugin.settings.useDefaultsOnInstantConvert=a,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Inline task folder").setDesc("Folder for converted inline tasks. Use {{currentNotePath}} to place tasks in the same folder as the note.").addText(n=>(n.inputEl.setAttribute("aria-label","Folder for inline task conversion"),n.setPlaceholder("{{currentNotePath}}").setValue(this.plugin.settings.inlineTaskConvertFolder).onChange(async a=>{this.plugin.settings.inlineTaskConvertFolder=a,await this.plugin.saveSettings()})));let r=e.createDiv("settings-help-section");r.createEl("h4",{text:"How inline task features work:"});let i=r.createEl("ul");i.createEl("li",{text:"Task link overlay: When you link to a task file like [[My Task]], it shows an interactive task card instead of a plain link"}),i.createEl("li",{text:'Instant task convert: Shows a "Convert to TaskNote" button next to standard Markdown checkboxes like - [ ] My task'}),r.createEl("p",{text:"These features help bridge regular Markdown tasks with the full TaskNotes system.",cls:"settings-help-note"})}renderTaskDefaultsTab(){let e=this.tabContents["task-defaults"];new E.Setting(e).setName("Task organization").setHeading(),new E.Setting(e).setName("Default tasks folder").setDesc("Default folder for new tasks (tasks are identified by tag, not folder)").addText(u=>(u.inputEl.setAttribute("aria-label","Default tasks folder path"),u.setPlaceholder("TaskNotes/Tasks").setValue(this.plugin.settings.tasksFolder).onChange(async h=>{this.plugin.settings.tasksFolder=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Move archived tasks to folder").setDesc("Automatically move tasks to a configured folder when archived").addToggle(u=>(u.toggleEl.setAttribute("aria-label","Move archived tasks to folder"),u.setValue(this.plugin.settings.moveArchivedTasks).onChange(async h=>{this.plugin.settings.moveArchivedTasks=h,await this.plugin.saveSettings(),this.renderActiveTab()}))),this.plugin.settings.moveArchivedTasks&&new E.Setting(e).setName("Archive folder").setDesc("Folder to move tasks to when archived").addText(u=>(u.inputEl.setAttribute("aria-label","Archive folder path"),u.setPlaceholder("TaskNotes/Archive").setValue(this.plugin.settings.archiveFolder).onChange(async h=>{this.plugin.settings.archiveFolder=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Identify tasks by").setDesc("Choose whether to identify tasks by tag or by a frontmatter property").addDropdown(u=>{u.addOption("tag","Tag").addOption("property","Property").setValue(this.plugin.settings.taskIdentificationMethod).onChange(async h=>{this.plugin.settings.taskIdentificationMethod=h,await this.plugin.saveSettings(),this.renderActiveTab()})}),this.plugin.settings.taskIdentificationMethod==="tag"?new E.Setting(e).setName("Task tag").setDesc("Tag that identifies notes as tasks (without #)").addText(u=>(u.inputEl.setAttribute("aria-label","Task identification tag"),u.setPlaceholder("task").setValue(this.plugin.settings.taskTag).onChange(async h=>{this.plugin.settings.taskTag=h,await this.plugin.saveSettings()}))):(new E.Setting(e).setName("Task property name").setDesc('The frontmatter property name (e.g., "category")').addText(u=>u.setPlaceholder("category").setValue(this.plugin.settings.taskPropertyName).onChange(async h=>{this.plugin.settings.taskPropertyName=h,await this.plugin.saveSettings()})),new E.Setting(e).setName("Task property value").setDesc('The value that identifies a task (e.g., "[[Tasks]]")').addText(u=>u.setPlaceholder("[[Tasks]]").setValue(this.plugin.settings.taskPropertyValue).onChange(async h=>{this.plugin.settings.taskPropertyValue=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Excluded folders").setDesc("Comma-separated list of folder paths to exclude from Notes tab").addText(u=>(u.inputEl.setAttribute("aria-label","Comma-separated list of folders to exclude"),u.setPlaceholder("Templates,Archive").setValue(this.plugin.settings.excludedFolders).onChange(async h=>{this.plugin.settings.excludedFolders=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Task filenames").setHeading(),new E.Setting(e).setName("Store title exclusively in filename").setDesc("When disabled, the task's title will be stored in the note frontmatter. You will be able to define custom templates for the filename of the task, but these will not be updated by the TaskNotes plugin after task creation. Moving the title into the frontmatter is a significant storage change and care must be taken when mixing tasks with their titles in the filename, and those with their titles in the frontmatter. Toggling this option will not affect existing tasks; it will affect tasks on creation and edit.").addToggle(u=>(u.toggleEl.setAttribute("aria-label","Store title exclusively in filename"),u.setValue(this.plugin.settings.storeTitleInFilename).onChange(async h=>{this.plugin.settings.storeTitleInFilename=h,await this.plugin.saveSettings(),this.renderActiveTab()}))),this.plugin.settings.storeTitleInFilename||(new E.Setting(e).setName("Filename format").setDesc("How task filenames should be generated").addDropdown(u=>(u.selectEl.setAttribute("aria-label","Task filename generation format"),u.addOption("title","Task title").addOption("zettel","Zettelkasten format (YYMMDD + base36 seconds since midnight)").addOption("timestamp","Full timestamp (YYYY-MM-DD-HHMMSS)").addOption("custom","Custom template").setValue(this.plugin.settings.taskFilenameFormat).onChange(async h=>{this.plugin.settings.taskFilenameFormat=h,await this.plugin.saveSettings(),this.renderActiveTab()}))),this.plugin.settings.taskFilenameFormat==="custom"&&(new E.Setting(e).setName("Custom filename template").setDesc("Template for custom filenames. Available variables: {title}, {titleLower}, {titleUpper}, {titleSnake}, {titleKebab}, {titleCamel}, {titlePascal}, {date}, {shortDate}, {time}, {time12}, {time24}, {timestamp}, {dateTime}, {year}, {month}, {monthName}, {monthNameShort}, {day}, {dayName}, {dayNameShort}, {hour}, {hour12}, {minute}, {second}, {milliseconds}, {ms}, {ampm}, {week}, {quarter}, {unix}, {unixMs}, {timezone}, {timezoneShort}, {utcOffset}, {utcOffsetShort}, {utcZ}, {zettel}, {nano}, {priority}, {priorityShort}, {status}, {statusShort}, {dueDate}, {scheduledDate}").addText(u=>(u.inputEl.setAttribute("aria-label","Custom filename template with variables"),u.setPlaceholder("{date}-{title}-{dueDate}").setValue(this.plugin.settings.customFilenameTemplate).onChange(async h=>{this.plugin.settings.customFilenameTemplate=h,await this.plugin.saveSettings()}))),e.createEl("p",{text:"Note: {dueDate} and {scheduledDate} are in YYYY-MM-DD format and will be empty if not set.",cls:"settings-help-note"}))),new E.Setting(e).setName("Basic defaults").setHeading(),new E.Setting(e).setName("Enable natural language task input").setDesc('Show a smart input field in task creation modal that can parse natural language like "Buy groceries tomorrow 3pm high priority @home #errands"').addToggle(u=>(u.toggleEl.setAttribute("aria-label","Enable natural language task input"),u.setValue(this.plugin.settings.enableNaturalLanguageInput).onChange(async h=>{this.plugin.settings.enableNaturalLanguageInput=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Default date type for natural language input").setDesc('When dates are mentioned without "due" or "scheduled" keywords (e.g., "task friday"), default to scheduled date. When disabled, defaults to due date.').addToggle(u=>(u.toggleEl.setAttribute("aria-label","Default to scheduled date for natural language input"),u.setValue(this.plugin.settings.nlpDefaultToScheduled).onChange(async h=>{this.plugin.settings.nlpDefaultToScheduled=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Default task status").setDesc("Default status for new tasks").addDropdown(u=>(u.selectEl.setAttribute("aria-label","Default status for new tasks"),this.plugin.settings.customStatuses.forEach(h=>{u.addOption(h.value,h.label)}),u.setValue(this.plugin.settings.defaultTaskStatus).onChange(async h=>{this.plugin.settings.defaultTaskStatus=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Default task priority").setDesc("Default priority for new tasks").addDropdown(u=>(u.selectEl.setAttribute("aria-label","Default priority for new tasks"),this.plugin.settings.customPriorities.forEach(h=>{u.addOption(h.value,h.label)}),u.setValue(this.plugin.settings.defaultTaskPriority).onChange(async h=>{this.plugin.settings.defaultTaskPriority=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Default contexts").setDesc("Default contexts for new tasks (comma-separated)").addText(u=>(u.inputEl.setAttribute("aria-label","Default contexts for new tasks"),u.setPlaceholder("work, personal").setValue(this.plugin.settings.taskCreationDefaults.defaultContexts).onChange(async h=>{this.plugin.settings.taskCreationDefaults.defaultContexts=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Default tags").setDesc("Default tags for new tasks (comma-separated)").addText(u=>(u.inputEl.setAttribute("aria-label","Default tags for new tasks"),u.setPlaceholder("project, urgent").setValue(this.plugin.settings.taskCreationDefaults.defaultTags).onChange(async h=>{this.plugin.settings.taskCreationDefaults.defaultTags=h,await this.plugin.saveSettings()})));let r=new E.Setting(e).setName("Default projects").setDesc("Default projects for new tasks");this.initializeDefaultProjectsFromSettings();let i=r.settingEl.createDiv("default-projects-container"),n=i.createDiv("default-projects-list");i.createEl("button",{cls:"default-project-add-btn",text:"+ Add project"}).addEventListener("click",()=>{new Ia(this.app,this.plugin,u=>{this.addDefaultProject(u),this.renderDefaultProjectsList(n),this.updateDefaultProjectsInSettings()}).open()}),this.renderDefaultProjectsList(n),new E.Setting(e).setName("Use parent note as project").setDesc("During instant task conversion, automatically add the parent note as a project").addToggle(u=>(u.toggleEl.setAttribute("aria-label","Use parent note as project for instant conversion"),u.setValue(this.plugin.settings.taskCreationDefaults.useParentNoteAsProject).onChange(async h=>{this.plugin.settings.taskCreationDefaults.useParentNoteAsProject=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Default time estimate").setDesc("Default time estimate for new tasks in minutes (0 = no default)").addText(u=>(u.inputEl.setAttribute("aria-label","Default time estimate in minutes"),u.setPlaceholder("0").setValue(this.plugin.settings.taskCreationDefaults.defaultTimeEstimate.toString()).onChange(async h=>{let p=parseInt(h)||0;this.plugin.settings.taskCreationDefaults.defaultTimeEstimate=p,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Default recurrence").setDesc("Default recurrence pattern for new tasks").addDropdown(u=>(u.selectEl.setAttribute("aria-label","Default recurrence pattern"),u.addOption("none","None").addOption("daily","Daily").addOption("weekly","Weekly").addOption("monthly","Monthly").addOption("yearly","Yearly").setValue(this.plugin.settings.taskCreationDefaults.defaultRecurrence).onChange(async h=>{this.plugin.settings.taskCreationDefaults.defaultRecurrence=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Date defaults").setHeading(),new E.Setting(e).setName("Default due date").setDesc("Default due date for new tasks").addDropdown(u=>(u.selectEl.setAttribute("aria-label","Default due date for new tasks"),u.addOption("none","None").addOption("today","Today").addOption("tomorrow","Tomorrow").addOption("next-week","Next week").setValue(this.plugin.settings.taskCreationDefaults.defaultDueDate).onChange(async h=>{this.plugin.settings.taskCreationDefaults.defaultDueDate=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Default scheduled date").setDesc("Default scheduled date for new tasks").addDropdown(u=>(u.selectEl.setAttribute("aria-label","Default scheduled date for new tasks"),u.addOption("none","None").addOption("today","Today").addOption("tomorrow","Tomorrow").addOption("next-week","Next week").setValue(this.plugin.settings.taskCreationDefaults.defaultScheduledDate).onChange(async h=>{this.plugin.settings.taskCreationDefaults.defaultScheduledDate=h,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Body template").setHeading(),new E.Setting(e).setName("Use body template").setDesc("Pre-fill task details with content from a template file").addToggle(u=>(u.toggleEl.setAttribute("aria-label","Enable body template for new tasks"),u.setValue(this.plugin.settings.taskCreationDefaults.useBodyTemplate).onChange(async h=>{this.plugin.settings.taskCreationDefaults.useBodyTemplate=h,await this.plugin.saveSettings(),this.renderActiveTab()}))),this.plugin.settings.taskCreationDefaults.useBodyTemplate&&new E.Setting(e).setName("Body template file").setDesc("Path to template file for task body content. Supports template variables like {{title}}, {{date}}, {{time}}, {{priority}}, {{status}}, etc.").addText(u=>(u.inputEl.setAttribute("aria-label","Path to body template file"),u.setPlaceholder("Templates/Task Template.md").setValue(this.plugin.settings.taskCreationDefaults.bodyTemplate).onChange(async h=>{this.plugin.settings.taskCreationDefaults.bodyTemplate=h,await this.plugin.saveSettings()})));let o=e.createDiv("settings-help-section");o.createEl("h4",{text:"Template variables:"});let l=o.createEl("ul");l.createEl("li",{text:"{{title}} - Task title"}),l.createEl("li",{text:"{{details}} - User-provided details from modal"}),l.createEl("li",{text:"{{date}} - Current date (YYYY-MM-DD)"}),l.createEl("li",{text:"{{time}} - Current time (HH:MM)"}),l.createEl("li",{text:"{{priority}} - Task priority"}),l.createEl("li",{text:"{{status}} - Task status"}),l.createEl("li",{text:"{{contexts}} - Task contexts"}),l.createEl("li",{text:"{{tags}} - Task tags"}),l.createEl("li",{text:"{{timeEstimate}} - Time estimate in minutes"}),l.createEl("li",{text:"{{dueDate}} - Task due date"}),l.createEl("li",{text:"{{scheduledDate}} - Task scheduled date"}),l.createEl("li",{text:"{{parentNote}} - Parent note as a properly formatted markdown link"}),o.createEl("p",{text:`Template is applied when the task is created with all final values from the form. Use {{details}} to include user content from the Details field.
{{parentNote}} will resolve to a quoted markdown link (e.g., "[[Note Name]]") for the note where the task was created. For project organization, use it as a YAML list item: "project:\\n  - {{parentNote}}". Variables use the same format as daily note templates.`,cls:"settings-help-note"}),new E.Setting(e).setName("Reminder defaults").setHeading();let c=e.createDiv("reminder-defaults-section");c.createEl("p",{text:"Configure default reminders that will be automatically added to new tasks. These can be relative to due or scheduled dates.",cls:"settings-help-note"});let d=c.createDiv("reminder-defaults-list");this.renderDefaultRemindersList(d),this.renderAddDefaultReminderForm(c),new E.Setting(e).setName("Task display defaults").setHeading(),this.renderDefaultVisiblePropertiesSettings(e)}renderDefaultVisiblePropertiesSettings(e){let r=[{id:"status",name:"Status dot",category:"core"},{id:"priority",name:"Priority dot",category:"core"},{id:"due",name:"Due date",category:"core"},{id:"scheduled",name:"Scheduled date",category:"core"},{id:"timeEstimate",name:"Time estimate",category:"core"},{id:"recurrence",name:"Recurrence",category:"core"},{id:"completedDate",name:"Completed date",category:"core"},{id:"projects",name:"Projects",category:"organization"},{id:"contexts",name:"Contexts",category:"organization"},{id:"tags",name:"Tags",category:"organization"}];new E.Setting(e).setName("Default visible properties").setDesc("Choose which properties appear on task cards by default. You can temporarily change these in each view and save custom combinations to saved views.").setClass("setting-item-default-properties");let i=e.createDiv("default-properties-container"),n=r.filter(c=>c.category==="core"),a=r.filter(c=>c.category==="organization");this.createPropertiesSection(i,"Core properties",n),this.createPropertiesSection(i,"Organization",a);let o=this.plugin.settings.userFields||[];if(o.length>0){let c=o.map(d=>({id:`user:${d.id}`,name:d.displayName,category:"user"}));this.createPropertiesSection(i,"Custom properties",c)}let l=e.createDiv({cls:"settings-help-note"});l.textContent="Note: Status and priority dots are automatically included for backward compatibility with existing views."}createPropertiesSection(e,r,i){let n=e.createDiv("properties-section"),a=n.createDiv("properties-section-header");a.textContent=r;let o=n.createDiv("properties-grid"),l=this.plugin.settings.defaultVisibleProperties||[];i.forEach(c=>{let d=o.createDiv("property-item"),u=d.createEl("input",{type:"checkbox",attr:{"aria-label":`Show ${c.name}`}});u.checked=l.includes(c.id),u.addEventListener("change",async()=>{let p=[...l];u.checked?p.includes(c.id)||p.push(c.id):p=p.filter(f=>f!==c.id),this.plugin.settings.defaultVisibleProperties=p,await this.plugin.saveSettings()});let h=d.createEl("label");h.textContent=c.name,h.addEventListener("click",()=>{u.checked=!u.checked,u.dispatchEvent(new Event("change"))})})}renderCalendarTab(){var V;let e=this.tabContents.calendar;new E.Setting(e).setName("Calendar view settings").setHeading(),new E.Setting(e).setName("Default view").setDesc("Initial view when opening the Advanced Calendar").addDropdown(k=>(k.selectEl.setAttribute("aria-label","Default calendar view"),k.addOption("dayGridMonth","Month").addOption("timeGridWeek","Week").addOption("timeGridDay","Day").addOption("timeGridCustom","Custom Days").addOption("multiMonthYear","Year").setValue(this.plugin.settings.calendarViewSettings.defaultView).onChange(async D=>{this.plugin.settings.calendarViewSettings.defaultView=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Custom view day count").setDesc("Number of days to show in the custom view (2-10 days)").addSlider(k=>(k.sliderEl.setAttribute("aria-label","Number of days in custom view"),k.setLimits(2,10,1).setValue(this.plugin.settings.calendarViewSettings.customDayCount).setDynamicTooltip().onChange(async D=>{this.plugin.settings.calendarViewSettings.customDayCount=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("First day of week").setDesc("Which day should be the first column in week and month views").addDropdown(k=>(k.selectEl.setAttribute("aria-label","First day of week"),k.addOption("0","Sunday").addOption("1","Monday").addOption("2","Tuesday").addOption("3","Wednesday").addOption("4","Thursday").addOption("5","Friday").addOption("6","Saturday").setValue(this.plugin.settings.calendarViewSettings.firstDay.toString()).onChange(async D=>{this.plugin.settings.calendarViewSettings.firstDay=parseInt(D),await this.plugin.saveSettings()}))),new E.Setting(e).setName("Show weekends").setDesc("Display Saturday and Sunday in calendar views").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show weekends in calendar"),k.setValue(this.plugin.settings.calendarViewSettings.showWeekends).onChange(async D=>{this.plugin.settings.calendarViewSettings.showWeekends=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Calendar locale").setDesc('Calendar locale for date formatting and calendar system (e.g., "en", "fa" for Farsi/Persian, "de" for German). Leave empty to auto-detect from browser.').addText(k=>(k.inputEl.setAttribute("aria-label","Calendar locale"),k.setPlaceholder("Auto-detect").setValue(this.plugin.settings.calendarViewSettings.locale).onChange(async D=>{this.plugin.settings.calendarViewSettings.locale=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Show week numbers").setDesc("Display week numbers on the left side of calendar views").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show week numbers"),k.setValue(this.plugin.settings.calendarViewSettings.weekNumbers).onChange(async D=>{this.plugin.settings.calendarViewSettings.weekNumbers=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Time settings").setHeading(),new E.Setting(e).setName("Time format").setDesc("Display times in 12-hour or 24-hour format").addDropdown(k=>(k.selectEl.setAttribute("aria-label","Time format"),k.addOption("12","12-hour (9:00 AM)").addOption("24","24-hour (09:00)").setValue(this.plugin.settings.calendarViewSettings.timeFormat).onChange(async D=>{this.plugin.settings.calendarViewSettings.timeFormat=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Time slot duration").setDesc("Duration of each time slot in week and day views").addDropdown(k=>(k.selectEl.setAttribute("aria-label","Time slot duration"),k.addOption("00:15:00","15 minutes").addOption("00:30:00","30 minutes").addOption("01:00:00","1 hour").setValue(this.plugin.settings.calendarViewSettings.slotDuration).onChange(async D=>{this.plugin.settings.calendarViewSettings.slotDuration=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Day start time").setDesc("First time slot to display in day/week views").addText(k=>(k.inputEl.setAttribute("aria-label","Day start time (HH:MM:SS format)"),k.setPlaceholder("00:00:00").setValue(this.plugin.settings.calendarViewSettings.slotMinTime).onChange(async D=>{/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/.test(D)&&(this.plugin.settings.calendarViewSettings.slotMinTime=D,await this.plugin.saveSettings())}))),new E.Setting(e).setName("Day end time").setDesc("Last time slot to display in day/week views").addText(k=>(k.inputEl.setAttribute("aria-label","Day end time (HH:MM:SS format)"),k.setPlaceholder("24:00:00").setValue(this.plugin.settings.calendarViewSettings.slotMaxTime).onChange(async D=>{/^([0-1]?[0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9]$/.test(D)&&(this.plugin.settings.calendarViewSettings.slotMaxTime=D,await this.plugin.saveSettings())}))),new E.Setting(e).setName("Initial scroll time").setDesc("Time to scroll to when opening day/week views").addText(k=>(k.inputEl.setAttribute("aria-label","Initial scroll time (HH:MM:SS format)"),k.setPlaceholder("08:00:00").setValue(this.plugin.settings.calendarViewSettings.scrollTime).onChange(async D=>{/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/.test(D)&&(this.plugin.settings.calendarViewSettings.scrollTime=D,await this.plugin.saveSettings())}))),new E.Setting(e).setName("Default event visibility").setHeading(),e.createEl("p",{text:"Configure which event types are visible by default when opening the Advanced Calendar. Users can still toggle these on/off in the calendar view.",cls:"settings-help-note"}),new E.Setting(e).setName("Show scheduled tasks").setDesc("Display tasks with scheduled dates by default").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show scheduled tasks by default"),k.setValue(this.plugin.settings.calendarViewSettings.defaultShowScheduled).onChange(async D=>{this.plugin.settings.calendarViewSettings.defaultShowScheduled=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Show due dates").setDesc("Display task due dates by default").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show due dates by default"),k.setValue(this.plugin.settings.calendarViewSettings.defaultShowDue).onChange(async D=>{this.plugin.settings.calendarViewSettings.defaultShowDue=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Show due dates when scheduled").setDesc("Display due dates even for tasks that already have scheduled dates").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show due dates when scheduled dates exist"),k.setValue(this.plugin.settings.calendarViewSettings.defaultShowDueWhenScheduled).onChange(async D=>{this.plugin.settings.calendarViewSettings.defaultShowDueWhenScheduled=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Show time entries").setDesc("Display completed time tracking entries by default").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show time entries by default"),k.setValue(this.plugin.settings.calendarViewSettings.defaultShowTimeEntries).onChange(async D=>{this.plugin.settings.calendarViewSettings.defaultShowTimeEntries=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Show recurring tasks").setDesc("Display recurring task instances by default").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show recurring tasks by default"),k.setValue(this.plugin.settings.calendarViewSettings.defaultShowRecurring).onChange(async D=>{this.plugin.settings.calendarViewSettings.defaultShowRecurring=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Show ICS events").setDesc("Display events from ICS subscriptions by default").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show ICS events by default"),k.setValue(this.plugin.settings.calendarViewSettings.defaultShowICSEvents).onChange(async D=>{this.plugin.settings.calendarViewSettings.defaultShowICSEvents=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Timeblocking").setHeading(),new E.Setting(e).setName("Enable timeblocking").setDesc("Enable timeblock functionality for lightweight scheduling in daily notes").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Enable timeblocking feature"),k.setValue(this.plugin.settings.calendarViewSettings.enableTimeblocking).onChange(async D=>{this.plugin.settings.calendarViewSettings.enableTimeblocking=D,await this.plugin.saveSettings(),this.plugin.emitter.trigger("timeblocking-toggled",D)}))),new E.Setting(e).setName("Show timeblocks").setDesc("Display timeblocks from daily notes by default").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show timeblocks by default"),k.setValue(this.plugin.settings.calendarViewSettings.defaultShowTimeblocks).setDisabled(!this.plugin.settings.calendarViewSettings.enableTimeblocking).onChange(async D=>{this.plugin.settings.calendarViewSettings.defaultShowTimeblocks=D,await this.plugin.saveSettings()}))),e.createEl("p",{text:'Timeblocks are defined in daily note frontmatter using the "timeblocks" field. Each timeblock can have a title, start time, end time, and optional attachments as markdown links to tasks or notes.',cls:"settings-help-note"}),e.createEl("p",{text:"\u{1F4A1} Tip: In the calendar view, hold Shift + drag to create timeblocks \u2022 Drag to move \u2022 Resize edges to adjust duration",cls:"settings-help-note"}),new E.Setting(e).setName("Calendar behavior").setHeading(),new E.Setting(e).setName("Current time indicator").setDesc("Show a line indicating the current time in week and day views").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Show current time indicator"),k.setValue(this.plugin.settings.calendarViewSettings.nowIndicator).onChange(async D=>{this.plugin.settings.calendarViewSettings.nowIndicator=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Selection mirror").setDesc("Show a visual preview while dragging to select time ranges").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Enable selection mirror"),k.setValue(this.plugin.settings.calendarViewSettings.selectMirror).onChange(async D=>{this.plugin.settings.calendarViewSettings.selectMirror=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Highlight today").setDesc("Highlight the current date with a background color in calendar views").addToggle(k=>(k.toggleEl.setAttribute("aria-label","Highlight today"),k.setValue(this.plugin.settings.calendarViewSettings.showTodayHighlight).onChange(async D=>{this.plugin.settings.calendarViewSettings.showTodayHighlight=D,await this.plugin.saveSettings()}))),new E.Setting(e).setName("Calendar subscriptions").setHeading(),e.createEl("p",{text:"Subscribe to external calendar feeds (ICS/iCal format) to display events alongside your tasks.",cls:"settings-help-note"});let r=e.createDiv("settings-list settings-view__list");this.renderSubscriptionList(r),new E.Setting(e).setName("Add calendar subscription").setDesc("Subscribe to an external calendar feed or add a local ICS file");let i=e.createDiv("ics-add-subscription-form"),n=i.createDiv("ics-form-row");n.createEl("label",{text:"Source type:",cls:"ics-form-label"});let a=n.createEl("select",{cls:"ics-form-select"});a.createEl("option",{value:"remote",text:"Remote URL"}),a.createEl("option",{value:"local",text:"Local file"});let o=i.createDiv("ics-form-row");o.createEl("label",{text:"Name:",cls:"ics-form-label"});let l=o.createEl("input",{type:"text",placeholder:"My Calendar",cls:"ics-form-input"}),c=i.createDiv("ics-form-row");c.createEl("label",{text:"ICS URL:",cls:"ics-form-label"});let d=c.createEl("input",{type:"url",placeholder:"https://example.com/calendar.ics",cls:"ics-form-input"}),u=i.createDiv("ics-form-row ics-form-row-hidden");u.createEl("label",{text:"ICS file:",cls:"ics-form-label"});let h=u.createEl("select",{cls:"ics-form-select"}),p=()=>{var D;h.empty(),h.createEl("option",{value:"",text:"Select an ICS file..."});let k=((D=this.plugin.icsSubscriptionService)==null?void 0:D.getLocalICSFiles())||[];k.forEach(_=>{h.createEl("option",{value:_.path,text:_.path})}),k.length===0&&h.createEl("option",{value:"",text:"No .ics files found in vault",attr:{disabled:"true"}})};p(),a.addEventListener("change",()=>{let k=a.value==="remote";c.style.display=k?"flex":"none",u.style.display=k?"none":"flex",k||p()});let f=i.createDiv("ics-form-row ics-form-row-multi"),m=f.createDiv("ics-form-group");m.createEl("label",{text:"Color:",cls:"ics-form-label"});let g=m.createEl("input",{type:"color",value:"#3788d8",cls:"ics-form-color"}),y=f.createDiv("ics-form-group");y.createEl("label",{text:"Refresh (min):",cls:"ics-form-label"});let w=y.createEl("input",{type:"number",value:"60",cls:"ics-form-number"});w.setAttribute("min","15"),w.setAttribute("max","1440"),w.setAttribute("step","15");let S=f.createDiv("ics-form-group").createEl("label",{cls:"ics-form-checkbox-label"}),x=S.createEl("input",{type:"checkbox",cls:"ics-form-checkbox"});x.checked=!0,S.createSpan({text:" Enabled"});let F=i.createDiv("ics-form-row").createEl("button",{text:"Add Subscription",cls:"ics-form-button mod-cta"});F.addEventListener("click",async()=>{let k=l.value.trim(),D=a.value,_=d.value.trim(),$=h.value.trim(),U=g.value,R=parseInt(w.value),H=x.checked;if(!k){new E.Notice("Name is required");return}if(D==="remote"&&!_){new E.Notice("URL is required for remote subscriptions");return}if(D==="local"&&!$){new E.Notice("Please select a local ICS file");return}if(R<15||R>1440){new E.Notice("Refresh interval must be between 15 and 1440 minutes");return}try{F.textContent="Adding...",F.disabled=!0;let j={name:k,type:D,color:U,refreshInterval:R,enabled:H,...D==="remote"?{url:_}:{filePath:$}};await this.plugin.icsSubscriptionService.addSubscription(j),new E.Notice(`Added ${D} subscription "${k}"`),l.value="",d.value="",h.value="",g.value="#3788d8",w.value="60",x.checked=!0,a.value="remote",c.style.display="flex",u.style.display="none",this.renderActiveTab()}catch(j){console.error("Error adding subscription:",j),new E.Notice("Failed to add subscription")}finally{F.textContent="Add Subscription",F.disabled=!1}}),new E.Setting(e).setName("Refresh all subscriptions").setDesc("Manually refresh all enabled calendar subscriptions").addButton(k=>k.setButtonText("Refresh all").onClick(async()=>{if(this.plugin.icsSubscriptionService){k.setButtonText("Refreshing..."),k.setDisabled(!0);try{await this.plugin.icsSubscriptionService.refreshAllSubscriptions(),new E.Notice("All calendar subscriptions refreshed successfully")}catch(D){console.error("Error refreshing subscriptions:",D),new E.Notice("Failed to refresh some calendar subscriptions")}finally{k.setButtonText("Refresh all"),k.setDisabled(!1)}}}));let A=e.createDiv("settings-help-section");A.createEl("h4",{text:"Calendar sources:"}),A.createEl("h5",{text:"Remote calendar URLs:"});let L=A.createEl("ul");L.createEl("li",{text:"Google Calendar: Settings \u2192 Calendar settings \u2192 Integrate calendar \u2192 Secret address in iCal format"}),L.createEl("li",{text:"Outlook/Office 365: Calendar settings \u2192 Share calendar \u2192 Publish a calendar \u2192 ICS format"}),L.createEl("li",{text:'Other services: Look for "Calendar subscription", "ICS feed", "iCal URL", or "Webcal" options'}),A.createEl("h5",{text:"Local ICS files:"});let G=A.createEl("ul");G.createEl("li",{text:"Place .ics files anywhere in your vault"}),G.createEl("li",{text:"Export from Apple Calendar: File \u2192 Export \u2192 Export as .ics file"}),G.createEl("li",{text:"Export from Google Calendar: Settings \u2192 Export \u2192 Download your data"}),G.createEl("li",{text:"Files are automatically watched for changes and refreshed"}),A.createEl("p",{text:'Important: For Google Calendar remote URLs, you must use the "Secret address" (private URL) from your calendar settings. The calendar must be set to "Make available to public" for the secret URL to work.',cls:"settings-help-note"}),A.createEl("p",{text:"Note: Only read-only access is supported. You cannot edit calendar events from within TaskNotes.",cls:"settings-help-note"}),new E.Setting(e).setName("Content creation from events").setHeading(),new E.Setting(e).setName("Default note template").setDesc("Template file for notes created from ICS events (leave empty for default format)").addText(k=>{var D;return k.setValue(((D=this.plugin.settings.icsIntegration)==null?void 0:D.defaultNoteTemplate)||"").setPlaceholder("templates/ics-note-template.md").onChange(async _=>{this.plugin.settings.icsIntegration||(this.plugin.settings.icsIntegration={defaultNoteTemplate:"",defaultNoteFolder:"",icsNoteFilenameFormat:"title",customICSNoteFilenameTemplate:"{title}"}),this.plugin.settings.icsIntegration.defaultNoteTemplate=_,await this.plugin.saveSettings()})}),new E.Setting(e).setName("Default note folder").setDesc("Folder for notes created from ICS events (leave empty for vault root)").addText(k=>{var D;return k.setValue(((D=this.plugin.settings.icsIntegration)==null?void 0:D.defaultNoteFolder)||"").setPlaceholder("Notes/Calendar Events").onChange(async _=>{this.plugin.settings.icsIntegration||(this.plugin.settings.icsIntegration={defaultNoteTemplate:"",defaultNoteFolder:"",icsNoteFilenameFormat:"title",customICSNoteFilenameTemplate:"{title}"}),this.plugin.settings.icsIntegration.defaultNoteFolder=_,await this.plugin.saveSettings()})}),new E.Setting(e).setName("Filename format for calendar event notes").setHeading(),new E.Setting(e).setName("Filename format").setDesc("How to name notes created from calendar events").addDropdown(k=>{var D;return k.addOptions({title:"Event title",zettel:"Zettelkasten (YYMMDD + time)",timestamp:"Timestamp (YYYY-MM-DD-HHMMSS)",custom:"Custom template"}).setValue(((D=this.plugin.settings.icsIntegration)==null?void 0:D.icsNoteFilenameFormat)||"title").onChange(async _=>{this.plugin.settings.icsIntegration||(this.plugin.settings.icsIntegration={defaultNoteTemplate:"",defaultNoteFolder:"",icsNoteFilenameFormat:"title",customICSNoteFilenameTemplate:"{title}"}),this.plugin.settings.icsIntegration.icsNoteFilenameFormat=_,await this.plugin.saveSettings(),this.display()})}),((V=this.plugin.settings.icsIntegration)==null?void 0:V.icsNoteFilenameFormat)==="custom"&&new E.Setting(e).setName("Custom filename template for ICS notes").setDesc("Template for custom filename format. Available variables: {title} (event title), {icsEventTitleWithDate} (event title + date), {icsEventLocation}, {icsEventDescription}, {date}, {time}, {timestamp}, etc.").addText(k=>{var D;return k.inputEl.setAttribute("aria-label","Custom ICS note filename template with variables"),k.setValue(((D=this.plugin.settings.icsIntegration)==null?void 0:D.customICSNoteFilenameTemplate)||"{title}").onChange(async _=>{this.plugin.settings.icsIntegration||(this.plugin.settings.icsIntegration={defaultNoteTemplate:"",defaultNoteFolder:"",icsNoteFilenameFormat:"title",customICSNoteFilenameTemplate:"{title}"}),this.plugin.settings.icsIntegration.customICSNoteFilenameTemplate=_,await this.plugin.saveSettings()})})}renderNotificationsTab(){let e=this.tabContents.notifications;new E.Setting(e).setName("Notifications").setHeading(),e.createEl("p",{text:"Configure task reminder notifications.",cls:"settings-help-note"}),new E.Setting(e).setName("Enable reminders").setDesc("Enable the task reminder system. When disabled, no reminder notifications will be shown.").addToggle(o=>o.setValue(this.plugin.settings.enableNotifications).onChange(async l=>{this.plugin.settings.enableNotifications=l,await this.plugin.saveSettings()})),new E.Setting(e).setName("Notification type").setDesc("Choose how reminder notifications are displayed.").addDropdown(o=>o.addOption("system","System notifications").addOption("in-app","In-app notices").setValue(this.plugin.settings.notificationType).onChange(async l=>{this.plugin.settings.notificationType=l,await this.plugin.saveSettings()}));let i=e.createDiv({cls:"setting-item-description"}).createDiv(),n=i.createDiv();n.createEl("strong",{text:"System notifications:"}),n.appendText(" Use your operating system's native notification system. Requires permission and works even when Obsidian is minimized.");let a=i.createDiv();a.createEl("strong",{text:"In-app notices:"}),a.appendText(" Show notifications as temporary popups within Obsidian only.")}renderAPITab(){let e=this.tabContents.api;if(E.Platform.isMobile){let f=e.createDiv({cls:"setting-item-description"}).createDiv({attr:{style:"text-align: center; padding: 2rem; color: var(--text-muted);"}});f.createEl("h3",{text:"HTTP API not available on mobile"}),f.createEl("p",{text:"The HTTP API feature requires Node.js capabilities that are only available on desktop platforms."}),f.createEl("p",{text:"This tab will be available when using TaskNotes on desktop."});return}e.createEl("h2",{text:"HTTP API Settings"});let r=e.createDiv({cls:"setting-item-description"});r.createEl("p",{text:"Enable HTTP API server to allow external tools and scripts to interact with your TaskNotes data."});let i=r.createEl("p");i.createEl("strong",{text:"Note:"}),i.appendText(" This feature is only available on desktop. Restart Obsidian after changing API settings."),new E.Setting(e).setName("Enable HTTP API").setDesc("Enable HTTP API server for external tool integration.").addToggle(p=>p.setValue(this.plugin.settings.enableAPI).onChange(async f=>{this.plugin.settings.enableAPI=f,await this.plugin.saveSettings(),f?new E.Notice("API enabled. Restart Obsidian to start the server."):new E.Notice("API disabled. Restart Obsidian to stop the server.")})),new E.Setting(e).setName("API Port").setDesc("Port for the HTTP API server (default: 8080)").addText(p=>p.setPlaceholder("8080").setValue(this.plugin.settings.apiPort.toString()).onChange(async f=>{let m=parseInt(f)||8080;if(m<1024||m>65535){new E.Notice("Port must be between 1024 and 65535");return}this.plugin.settings.apiPort=m,await this.plugin.saveSettings()})),new E.Setting(e).setName("API Authentication Token").setDesc("Optional token for API authentication. Leave empty to disable authentication.").addText(p=>p.setPlaceholder("Optional authentication token").setValue(this.plugin.settings.apiAuthToken).onChange(async f=>{this.plugin.settings.apiAuthToken=f,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Webhook Settings"});let n=e.createDiv({cls:"setting-item-description"});n.createEl("p",{text:"Webhooks send real-time notifications to external services when TaskNotes events occur."}),n.createEl("p",{text:"Configure webhooks to integrate with automation tools, sync services, or custom applications."}),this.renderWebhookList(e),new E.Setting(e).setName("Add Webhook").setDesc("Register a new webhook endpoint").addButton(p=>p.setButtonText("Add Webhook").setTooltip("Add a new webhook endpoint").onClick(()=>{this.showWebhookModal()})),e.createEl("h3",{text:"API Documentation"});let a=e.createDiv({cls:"setting-item-description"});a.createEl("h4",{text:"Available Endpoints:"});let o=a.createEl("ul",{attr:{style:"margin-left: 1rem;"}});[{method:"GET",path:"/api/health",desc:"Health check"},{method:"GET",path:"/api/tasks",desc:"List tasks with optional filters"},{method:"POST",path:"/api/tasks",desc:"Create new task"},{method:"GET",path:"/api/tasks/{id}",desc:"Get specific task"},{method:"PUT",path:"/api/tasks/{id}",desc:"Update task"},{method:"DELETE",path:"/api/tasks/{id}",desc:"Delete task"},{method:"POST",path:"/api/tasks/{id}/time/start",desc:"Start time tracking"},{method:"POST",path:"/api/tasks/{id}/time/stop",desc:"Stop time tracking"},{method:"POST",path:"/api/tasks/{id}/toggle-status",desc:"Toggle completion"},{method:"POST",path:"/api/tasks/{id}/archive",desc:"Toggle archive"},{method:"POST",path:"/api/tasks/query",desc:"Advanced filtering"},{method:"GET",path:"/api/filter-options",desc:"Available filters"},{method:"GET",path:"/api/stats",desc:"Task statistics"}].forEach(p=>{let f=o.createEl("li");f.createEl("code",{text:`${p.method} ${p.path}`}),f.appendText(` - ${p.desc}`)}),a.createEl("h4",{text:"Usage Examples:"}),a.createEl("p").createEl("strong",{text:"Basic request:"}),a.createEl("pre").createEl("code",{text:`curl http://localhost:${this.plugin.settings.apiPort}/api/tasks`}),a.createEl("p").createEl("strong",{text:"With authentication:"}),a.createEl("pre").createEl("code",{text:`curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:${this.plugin.settings.apiPort}/api/tasks`}),a.createEl("p").createEl("strong",{text:"Create task:"}),a.createEl("pre").createEl("code",{text:`curl -X POST http://localhost:${this.plugin.settings.apiPort}/api/tasks \\
  -H "Content-Type: application/json" \\
  -d '{"title": "New task", "priority": "High"}'`}),a.createEl("p").createEl("strong",{text:"Filter tasks:"}),a.createEl("pre").createEl("code",{text:`curl "http://localhost:${this.plugin.settings.apiPort}/api/tasks?status=open&priority=High"`})}renderMiscTab(){let e=this.tabContents.misc;new E.Setting(e).setName("Miscellaneous settings").setHeading(),e.createEl("p",{text:"Configure various plugin features and display options.",cls:"settings-help-note"}),new E.Setting(e).setName("Show tracked tasks in status bar").setDesc("Display currently tracked tasks (with active time tracking) in the status bar at the bottom of the app").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Show tracked tasks in status bar"),r.setValue(this.plugin.settings.showTrackedTasksInStatusBar).onChange(async i=>{this.plugin.settings.showTrackedTasksInStatusBar=i,await this.plugin.saveSettings(),this.plugin.statusBarService&&this.plugin.statusBarService.updateVisibility()}))),new E.Setting(e).setName("Show project subtasks widget").setDesc("Display a collapsible widget showing all tasks that reference the current note as a project").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Show project subtasks widget"),r.setValue(this.plugin.settings.showProjectSubtasks).onChange(async i=>{this.plugin.settings.showProjectSubtasks=i,await this.plugin.saveSettings(),this.plugin.notifyDataChanged()}))),new E.Setting(e).setName("Project subtasks widget position").setDesc("Choose where the subtasks widget appears in project notes").addDropdown(r=>{r.addOption("top","Top of note").addOption("bottom","Bottom of note").setValue(this.plugin.settings.projectSubtasksPosition||"bottom").onChange(async i=>{this.plugin.settings.projectSubtasksPosition=i,await this.plugin.saveSettings(),this.plugin.notifyDataChanged()})}),new E.Setting(e).setName("Show expandable subtasks in task cards").setDesc("Add a chevron icon to project task cards that allows expanding to view subtasks inline").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Show expandable subtasks in task cards"),r.setValue(this.plugin.settings.showExpandableSubtasks).onChange(async i=>{this.plugin.settings.showExpandableSubtasks=i,await this.plugin.saveSettings(),this.plugin.notifyDataChanged()}))),new E.Setting(e).setName("Subtask chevron position").setDesc("Choose where the expand/collapse chevron appears on task cards").addDropdown(r=>(r.selectEl.setAttribute("aria-label","Subtask chevron position on task cards"),r.addOption("right","Right (default)").addOption("left","Left (match group chevrons)").setValue(this.plugin.settings.subtaskChevronPosition||"right").onChange(async i=>{this.plugin.settings.subtaskChevronPosition=i,await this.plugin.saveSettings(),this.plugin.notifyDataChanged()}))),new E.Setting(e).setName("Status suggestion trigger").setDesc("Type this pattern before a status to see suggestions in the task creation input. Leave empty to disable. Avoid @, #, + which are reserved.").addText(r=>{r.setPlaceholder("*").setValue(this.plugin.settings.statusSuggestionTrigger||"").onChange(async i=>{let n=i.trim();if(["@","#","+"].includes(n)){new E.Notice("This trigger conflicts with existing triggers (@, #, +). Please choose another.");return}if(n.length>3){new E.Notice("Please use a short trigger (max 3 characters).");return}this.plugin.settings.statusSuggestionTrigger=n,await this.plugin.saveSettings()})}),new E.Setting(e).setName("Hide completed tasks from overdue").setDesc("When enabled, completed tasks will not appear as overdue in the agenda view, even if their due/scheduled date has passed").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Hide completed tasks from overdue status"),r.setValue(this.plugin.settings.hideCompletedFromOverdue).onChange(async i=>{this.plugin.settings.hideCompletedFromOverdue=i,await this.plugin.saveSettings(),this.plugin.notifyDataChanged()}))),new E.Setting(e).setName("Views button alignment").setDesc('Choose the position of the "Views" button in the filter toolbar').addDropdown(r=>{r.addOption("right","Right (Default)").addOption("left","Left").setValue(this.plugin.settings.viewsButtonAlignment||"right").onChange(async i=>{this.plugin.settings.viewsButtonAlignment=i,await this.plugin.saveSettings(),this.plugin.notifyDataChanged()})}),new E.Setting(e).setName("Disable note indexing").setDesc("Disable indexing and caching of non-task notes to improve performance in large vaults. Note: This will disable the Notes view and notes display in the Agenda view. Requires plugin restart to take effect.").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Disable note indexing for better performance"),r.setValue(this.plugin.settings.disableNoteIndexing).onChange(async i=>{this.plugin.settings.disableNoteIndexing=i,await this.plugin.saveSettings(),new E.Notice("Note indexing setting changed. Please restart Obsidian or reload the plugin for changes to take effect.")}))),new E.Setting(e).setName("Debounce inline suggestions (ms)").setDesc("Optional delay before running inline file suggestions (useful for large vaults). Set 0 to disable.").addText(r=>{var i;return r.setPlaceholder("0 (disabled)").setValue(String((i=this.plugin.settings.suggestionDebounceMs)!=null?i:0)).onChange(async n=>{let a=parseInt(n,10);isNaN(a)||a<0||(this.plugin.settings.suggestionDebounceMs=a,await this.plugin.saveSettings())})}),new E.Setting(e).setName("Single-click action").setDesc("What happens when you single-click a task card").addDropdown(r=>{r.addOption("edit","Edit task").addOption("openNote","Open note").setValue(this.plugin.settings.singleClickAction).onChange(async i=>{this.plugin.settings.singleClickAction=i,await this.plugin.saveSettings()})}),new E.Setting(e).setName("Double-click action").setDesc("What happens when you double-click a task card").addDropdown(r=>{r.addOption("openNote","Open note").addOption("edit","Edit task").addOption("none","None").setValue(this.plugin.settings.doubleClickAction).onChange(async i=>{this.plugin.settings.doubleClickAction=i,await this.plugin.saveSettings()})}),new E.Setting(e).setName("Maintain due date offset in recurring tasks").setDesc("When completing a recurring task, move the due date by the same offset as the scheduled date to preserve the time separation between them").addToggle(r=>(r.toggleEl.setAttribute("aria-label","Maintain due date offset in recurring tasks"),r.setValue(this.plugin.settings.maintainDueDateOffsetInRecurring).onChange(async i=>{this.plugin.settings.maintainDueDateOffsetInRecurring=i,await this.plugin.saveSettings()})))}renderFieldMappingTab(){let e=this.tabContents["field-mapping"],r=e.createDiv("settings-warning settings-view__warning"),i=r.createEl("strong",{cls:"settings-view__warning-icon"});(0,E.setIcon)(i,"alert-triangle"),i.createSpan({text:" Warning:"}),r.createSpan({text:" TaskNotes will read AND write using these property names. Changing these after creating tasks may cause inconsistencies."}),new E.Setting(e).setName("Field mapping").setHeading(),e.createEl("p",{text:"Configure which frontmatter properties TaskNotes should use for each field.",cls:"settings-help-note"});let n=e.createEl("table",{cls:"settings-table settings-view__table"}),a=n.createEl("tr");if(a.createEl("th",{cls:"settings-view__table-header",text:"TaskNotes field"}),a.createEl("th",{cls:"settings-view__table-header",text:"Your property name"}),[["title","Title"],["status","Status"],["priority","Priority"],["due","Due date"],["scheduled","Scheduled date"],["contexts","Contexts"],["projects","Projects"],["timeEstimate","Time estimate"],["completedDate","Completed date"],["dateCreated","Created date"],["dateModified","Modified date"],["recurrence","Recurrence"],["archiveTag","Archive tag"],["icsEventId","ICS Event ID"],["icsEventTag","ICS Event Tag"]].forEach(([d,u])=>{let h=n.createEl("tr",{cls:"settings-view__table-row"}),p=h.createEl("td",{cls:"settings-view__table-cell"});p.textContent=u;let m=h.createEl("td",{cls:"settings-view__table-cell"}).createEl("input",{type:"text",value:this.plugin.settings.fieldMapping[d],cls:"settings-view__table-input",attr:{"aria-label":`Property name for ${u}`,id:`field-mapping-${d}`}});m.addEventListener("change",async()=>{try{this.plugin.settings.fieldMapping[d]=m.value,await this.plugin.saveSettings()}catch(g){console.error(`Error updating field mapping for ${d}:`,g),new E.Notice(`Failed to update field mapping for ${u}. Please try again.`)}})}),new E.Setting(e).setName("Reset to defaults").setDesc("Reset all field mappings to default values").addButton(d=>d.setButtonText("Reset").setWarning().onClick(async()=>{this.plugin.settings.fieldMapping={...el},await this.plugin.saveSettings(),this.renderActiveTab()})),new E.Setting(e).setName("User Fields (optional)").setHeading(),e.createEl("p",{text:"Define one or more custom frontmatter properties to appear as type-aware filter options across views. Each row: Display Name, Property Name, Type.",cls:"settings-help-note"}),Array.isArray(this.plugin.settings.userFields)||(this.plugin.settings.userFields=[]),this.plugin.settings.userField&&this.plugin.settings.userField.enabled){let d=this.plugin.settings.userField,u=(d.displayName||d.key||"field").toLowerCase().replace(/[^a-z0-9_-]/g,"-");this.plugin.settings.userFields.find(h=>h.id===u||h.key===d.key)||this.plugin.settings.userFields.push({id:u,displayName:d.displayName||"",key:d.key||"",type:d.type||"text"})}let l=e.createDiv("settings-headers-row settings-view__list-headers user-fields");l.createEl("span",{text:"Display Name",cls:"settings-column-header settings-view__column-header"}),l.createEl("span",{text:"Property Name",cls:"settings-column-header settings-view__column-header"}),l.createEl("span",{text:"Type",cls:"settings-column-header settings-view__column-header"}),l.createDiv("settings-header-spacer settings-view__header-spacer");let c=e.createDiv("settings-list settings-view__list");c.addClass("user-fields"),this.renderUserFieldsList(c),new E.Setting(e).setName("Add new user field").setDesc("Create a new custom property for filtering").addButton(d=>d.setButtonText("Add field").onClick(async()=>{var f,m;let u=`fld_${Date.now()}`;this.plugin.settings.userFields.push({id:u,key:"",displayName:"",type:"text"}),await this.plugin.saveSettings(),(f=this.plugin.filterService)==null||f.refreshFilterOptions();let h=await this.plugin.filterService.getFilterOptions(),p=["tasknotes-task-list-view","tasknotes-agenda-view","tasknotes-kanban-view","tasknotes-advanced-calendar-view"];for(let g of p)for(let y of this.app.workspace.getLeavesOfType(g)){let w=y.view;(m=w==null?void 0:w.filterBar)!=null&&m.updateFilterOptions&&w.filterBar.updateFilterOptions(h)}this.renderActiveTab()}))}renderUserFieldsList(e){e.empty(),(this.plugin.settings.userFields||[]).forEach((i,n)=>{let a=e.createDiv("settings-item-row settings-view__item-row user-fields"),o=a.createEl("input",{type:"text",value:i.displayName||"",cls:"settings-input name-input settings-view__input settings-view__input--label",attr:{placeholder:"Effort","aria-label":`Display name for ${i.displayName||"user field"}`,id:`user-field-name-${i.id}`}}),l=a.createEl("input",{type:"text",value:i.key||"",cls:"settings-input key-input settings-view__input settings-view__input--value",attr:{placeholder:"effort","aria-label":`Property name for ${i.displayName||"user field"}`,id:`user-field-key-${i.id}`}}),c=a.createEl("select",{cls:"settings-input type-select settings-view__input settings-view__input--select",attr:{"aria-label":`Type for ${i.displayName||"user field"}`,id:`user-field-type-${i.id}`}});[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"boolean",label:"Boolean"},{value:"list",label:"List"}].forEach(f=>{let m=c.createEl("option",{value:f.value,text:f.label});i.type===f.value&&(m.selected=!0)});let u=a.createEl("button",{text:"Delete",cls:"settings-delete-button settings-view__delete-button"}),h=async()=>{try{i.key=l.value.trim(),i.displayName=o.value,i.type=c.value,i.id||(i.id=(i.displayName||i.key||"field").toLowerCase().replace(/[^a-z0-9_-]/g,"-")),await this.plugin.saveSettings()}catch(f){console.error("Error updating user field configuration:",f),new E.Notice("Failed to update user field configuration. Please try again.")}};l.addEventListener("change",h),o.addEventListener("change",h),c.addEventListener("change",h);let p=async()=>{var g,y;(g=this.plugin.filterService)==null||g.refreshFilterOptions();let f=await this.plugin.filterService.getFilterOptions(),m=["tasknotes-task-list-view","tasknotes-agenda-view","tasknotes-kanban-view","tasknotes-advanced-calendar-view"];for(let w of m)for(let T of this.app.workspace.getLeavesOfType(w)){let S=T.view;(y=S==null?void 0:S.filterBar)!=null&&y.updateFilterOptions&&S.filterBar.updateFilterOptions(f)}};l.addEventListener("change",p),o.addEventListener("change",p),c.addEventListener("change",p),u.addEventListener("click",async()=>{var m,g;if(await ui(this.app,{title:"Delete User Field",message:`Are you sure you want to delete the user field "${i.displayName||i.key}"?

This action cannot be undone and may affect existing filters.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})){let y=this.plugin.settings.userFields.findIndex(w=>w.id===i.id);if(y!==-1){this.plugin.settings.userFields.splice(y,1),await this.plugin.saveSettings(),(m=this.plugin.filterService)==null||m.refreshFilterOptions();let w=await this.plugin.filterService.getFilterOptions(),T=["tasknotes-task-list-view","tasknotes-agenda-view","tasknotes-kanban-view","tasknotes-advanced-calendar-view"];for(let S of T)for(let x of this.app.workspace.getLeavesOfType(S)){let I=x.view;(g=I==null?void 0:I.filterBar)!=null&&g.updateFilterOptions&&I.filterBar.updateFilterOptions(w)}this.renderActiveTab()}}})})}renderStatusesTab(){let e=this.tabContents.statuses;new E.Setting(e).setName("Task statuses").setHeading(),e.createEl("p",{text:"Customize the status options available for your tasks. These statuses control the task lifecycle and determine when tasks are considered complete.",cls:"settings-help-note"});let r=e.createDiv("settings-help-section");r.createEl("h4",{text:"How statuses work:"});let i=r.createEl("ul");i.createEl("li",{text:'Value: The internal identifier stored in your task files (e.g., "in-progress")'}),i.createEl("li",{text:'Label: The display name shown in the interface (e.g., "In Progress")'}),i.createEl("li",{text:"Color: Visual indicator color for the status dot and badges"}),i.createEl("li",{text:"Completed: When checked, tasks with this status are considered finished and may be filtered differently"}),r.createEl("p",{text:"The order below determines the sequence when cycling through statuses by clicking on task status badges.",cls:"settings-help-note"});let n=e.createDiv("settings-headers-row settings-view__list-headers");n.createDiv("settings-header-spacer settings-view__header-spacer"),n.createDiv("settings-header-spacer settings-view__header-spacer"),n.createEl("span",{text:"Value",cls:"settings-column-header settings-view__column-header"}),n.createEl("span",{text:"Display Label",cls:"settings-column-header settings-view__column-header"}),n.createEl("span",{text:"Color",cls:"settings-column-header settings-view__column-header"}),n.createEl("span",{text:"Mark as Completed",cls:"settings-column-header settings-view__column-header"}),n.createDiv("settings-header-spacer settings-view__header-spacer");let a=e.createDiv("settings-list settings-view__list");this.renderStatusList(a),new E.Setting(e).setName("Add new status").setDesc("Create a new status option for your tasks").addButton(o=>o.setButtonText("Add status").onClick(async()=>{let l=Rs.createDefaultStatus(this.plugin.settings.customStatuses);this.plugin.settings.customStatuses.push(l),await this.plugin.saveSettings(),this.renderActiveTab()})),e.createEl("p",{text:'Note: You must have at least 2 statuses, and at least one status must be marked as "Completed".',cls:"settings-validation-note"})}renderStatusList(e){e.empty(),[...this.plugin.settings.customStatuses].sort((i,n)=>i.order-n.order).forEach((i,n)=>{let a=e.createDiv("settings-item-row settings-view__item-row");a.setAttribute("draggable","true"),a.setAttribute("data-status-id",i.id);let o=a.createDiv("settings-drag-handle");o.textContent="\u2630",(0,E.setTooltip)(o,"Drag to reorder",{placement:"top"});let l=a.createDiv("settings-color-indicator settings-view__color-indicator");l.style.setProperty("--indicator-color",i.color);let c=a.createEl("input",{type:"text",value:i.value,cls:"settings-input value-input settings-view__input settings-view__input--value",attr:{"aria-label":`Status value for ${i.label}`,id:`status-value-${i.id}`}}),d=a.createEl("input",{type:"text",value:i.label,cls:"settings-input label-input settings-view__input settings-view__input--label",attr:{"aria-label":`Display label for ${i.label} status`,id:`status-label-${i.id}`}}),u=a.createEl("input",{type:"color",value:i.color,cls:"settings-input color-input settings-view__input settings-view__input--color",attr:{"aria-label":`Color for ${i.label} status`,id:`status-color-${i.id}`}}),h=a.createEl("label",{cls:"settings-checkbox-label settings-view__checkbox-label",attr:{for:`status-completed-${i.id}`}}),p=h.createEl("input",{type:"checkbox",cls:"settings-view__checkbox",attr:{id:`status-completed-${i.id}`,"aria-label":`Mark ${i.label} as completed status`}});p.checked=i.isCompleted,h.createSpan({text:"Completed"});let f=a.createEl("button",{text:"Delete",cls:"settings-delete-button settings-view__delete-button"}),m=async()=>{try{i.value=c.value,i.label=d.value,i.color=u.value,i.isCompleted=p.checked,await this.plugin.saveSettings(),l.style.setProperty("--indicator-color",i.color)}catch(g){console.error("Error updating status configuration:",g),new E.Notice("Failed to update status configuration. Please try again.")}};c.addEventListener("change",m),d.addEventListener("change",m),u.addEventListener("change",m),p.addEventListener("change",m),f.addEventListener("click",async()=>{if(this.plugin.settings.customStatuses.length<=2){new E.Notice("You must have at least 2 statuses");return}if(await ui(this.app,{title:"Delete Status",message:`Are you sure you want to delete the status "${i.label}"?

This action cannot be undone and may affect existing tasks.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})){let y=this.plugin.settings.customStatuses.findIndex(w=>w.id===i.id);y!==-1&&(this.plugin.settings.customStatuses.splice(y,1),await this.plugin.saveSettings(),this.renderActiveTab())}}),a.addEventListener("dragstart",g=>{g.dataTransfer.setData("text/plain",i.id),a.classList.add("dragging")}),a.addEventListener("dragend",()=>{a.classList.remove("dragging")}),a.addEventListener("dragover",g=>{g.preventDefault();let y=e.querySelector(".dragging");if(y&&y!==a){let w=a.getBoundingClientRect(),T=w.top+w.height/2;g.clientY<T?(a.classList.add("drag-over-top"),a.classList.remove("drag-over-bottom")):(a.classList.add("drag-over-bottom"),a.classList.remove("drag-over-top"))}}),a.addEventListener("dragleave",()=>{a.classList.remove("drag-over-top","drag-over-bottom")}),a.addEventListener("drop",async g=>{g.preventDefault(),a.classList.remove("drag-over-top","drag-over-bottom");let y=g.dataTransfer.getData("text/plain"),w=i.id;y!==w&&await this.reorderStatus(y,w,g.clientY<a.getBoundingClientRect().top+a.getBoundingClientRect().height/2)})})}async reorderStatus(e,r,i){let n=[...this.plugin.settings.customStatuses],a=n.findIndex(d=>d.id===e),o=n.findIndex(d=>d.id===r);if(a===-1||o===-1)return;let[l]=n.splice(a,1),c=o;a<o&&c--,i||c++,n.splice(c,0,l),n.forEach((d,u)=>{d.order=u}),this.plugin.settings.customStatuses=n,await this.plugin.saveSettings(),this.renderActiveTab()}renderPrioritiesTab(){let e=this.tabContents.priorities;new E.Setting(e).setName("Task priorities").setHeading(),e.createEl("p",{text:"Customize the priority levels available for your tasks. Priority weights determine sorting order and visual hierarchy in your task views.",cls:"settings-help-note"});let r=e.createDiv("settings-help-section");r.createEl("h4",{text:"How priorities work:"});let i=r.createEl("ul");i.createEl("li",{text:'Value: The internal identifier stored in your task files (e.g., "high")'}),i.createEl("li",{text:'Display Label: The display name shown in the interface (e.g., "High Priority")'}),i.createEl("li",{text:"Color: Visual indicator color for the priority dot and badges"}),i.createEl("li",{text:"Weight: Numeric value for sorting (higher weights appear first in lists)"}),r.createEl("p",{text:"Tasks are automatically sorted by priority weight in descending order (highest weight first). Weights can be any positive number.",cls:"settings-help-note"});let n=e.createDiv("settings-headers-row settings-view__list-headers");n.createDiv("settings-header-spacer settings-view__header-spacer"),n.createEl("span",{text:"Value",cls:"settings-column-header settings-view__column-header"}),n.createEl("span",{text:"Display Label",cls:"settings-column-header settings-view__column-header"}),n.createEl("span",{text:"Color",cls:"settings-column-header settings-view__column-header"}),n.createEl("span",{text:"Weight",cls:"settings-column-header settings-view__column-header"}),n.createDiv("settings-header-spacer settings-view__header-spacer");let a=e.createDiv("settings-list settings-view__list");this.renderPriorityList(a),new E.Setting(e).setName("Add new priority").setDesc("Create a new priority level for your tasks").addButton(o=>o.setButtonText("Add priority").onClick(async()=>{let l=Aa.createDefaultPriority(this.plugin.settings.customPriorities);this.plugin.settings.customPriorities.push(l),await this.plugin.saveSettings(),this.renderActiveTab()})),e.createEl("p",{text:"Note: You must have at least 1 priority. Higher weights take precedence in sorting and visual hierarchy.",cls:"settings-validation-note"})}renderPriorityList(e){e.empty(),[...this.plugin.settings.customPriorities].sort((i,n)=>n.weight-i.weight).forEach((i,n)=>{let a=e.createDiv("settings-item-row settings-view__item-row"),o=a.createDiv("settings-color-indicator settings-view__color-indicator");o.style.setProperty("--indicator-color",i.color);let l=a.createEl("input",{type:"text",value:i.value,cls:"settings-input value-input settings-view__input settings-view__input--value",attr:{"aria-label":`Priority value for ${i.label}`,id:`priority-value-${i.id}`}}),c=a.createEl("input",{type:"text",value:i.label,cls:"settings-input label-input settings-view__input settings-view__input--label",attr:{"aria-label":`Display label for ${i.label} priority`,id:`priority-label-${i.id}`}}),d=a.createEl("input",{type:"color",value:i.color,cls:"settings-input color-input settings-view__input settings-view__input--color",attr:{"aria-label":`Color for ${i.label} priority`,id:`priority-color-${i.id}`}}),u=a.createEl("input",{type:"number",value:i.weight.toString(),cls:"settings-input weight-input settings-view__input settings-view__input--weight",attr:{min:"0",step:"1","aria-label":`Weight for ${i.label} priority`,id:`priority-weight-${i.id}`}}),h=a.createEl("button",{text:"Delete",cls:"settings-delete-button settings-view__delete-button"}),p=async()=>{try{i.value=l.value,i.label=c.value,i.color=d.value;let f=parseInt(u.value);if(isNaN(f)||f<0){new E.Notice("Priority weight must be a valid positive number.");return}i.weight=f,await this.plugin.saveSettings(),o.style.setProperty("--indicator-color",i.color)}catch(f){console.error("Error updating priority configuration:",f),new E.Notice("Failed to update priority configuration. Please try again.")}};l.addEventListener("change",p),c.addEventListener("change",p),d.addEventListener("change",p),u.addEventListener("change",p),h.addEventListener("click",async()=>{if(this.plugin.settings.customPriorities.length<=1){new E.Notice("You must have at least 1 priority");return}if(await ui(this.app,{title:"Delete Priority",message:`Are you sure you want to delete the priority "${i.label}"?

This action cannot be undone and may affect existing tasks.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})){let m=this.plugin.settings.customPriorities.findIndex(g=>g.id===i.id);m!==-1&&(this.plugin.settings.customPriorities.splice(m,1),await this.plugin.saveSettings(),this.renderActiveTab())}})})}renderPomodoroTab(){let e=this.tabContents.pomodoro;new E.Setting(e).setName("Work duration").setDesc("Duration of work intervals in minutes").addText(r=>r.setPlaceholder("25").setValue(this.plugin.settings.pomodoroWorkDuration.toString()).onChange(async i=>{try{let n=parseInt(i);if(isNaN(n)||n<=0){new E.Notice("Work duration must be a positive number.");return}this.plugin.settings.pomodoroWorkDuration=n,await this.plugin.saveSettings()}catch(n){console.error("Error updating pomodoro work duration:",n),new E.Notice("Failed to update work duration setting.")}})),new E.Setting(e).setName("Short break duration").setDesc("Duration of short breaks in minutes").addText(r=>r.setPlaceholder("5").setValue(this.plugin.settings.pomodoroShortBreakDuration.toString()).onChange(async i=>{try{let n=parseInt(i);if(isNaN(n)||n<=0){new E.Notice("Short break duration must be a positive number.");return}this.plugin.settings.pomodoroShortBreakDuration=n,await this.plugin.saveSettings()}catch(n){console.error("Error updating pomodoro short break duration:",n),new E.Notice("Failed to update short break duration setting.")}})),new E.Setting(e).setName("Long break duration").setDesc("Duration of long breaks in minutes").addText(r=>r.setPlaceholder("15").setValue(this.plugin.settings.pomodoroLongBreakDuration.toString()).onChange(async i=>{try{let n=parseInt(i);if(isNaN(n)||n<=0){new E.Notice("Long break duration must be a positive number.");return}this.plugin.settings.pomodoroLongBreakDuration=n,await this.plugin.saveSettings()}catch(n){console.error("Error updating pomodoro long break duration:",n),new E.Notice("Failed to update long break duration setting.")}})),new E.Setting(e).setName("Long break interval").setDesc("Take a long break after this many pomodoros").addText(r=>r.setPlaceholder("4").setValue(this.plugin.settings.pomodoroLongBreakInterval.toString()).onChange(async i=>{try{let n=parseInt(i);if(isNaN(n)||n<=0){new E.Notice("Long break interval must be a positive number.");return}this.plugin.settings.pomodoroLongBreakInterval=n,await this.plugin.saveSettings()}catch(n){console.error("Error updating pomodoro long break interval:",n),new E.Notice("Failed to update long break interval setting.")}})),new E.Setting(e).setName("Auto-start breaks").setDesc("Automatically start break timer after work session").addToggle(r=>r.setValue(this.plugin.settings.pomodoroAutoStartBreaks).onChange(async i=>{this.plugin.settings.pomodoroAutoStartBreaks=i,await this.plugin.saveSettings()})),new E.Setting(e).setName("Auto-start work").setDesc("Automatically start work timer after break").addToggle(r=>r.setValue(this.plugin.settings.pomodoroAutoStartWork).onChange(async i=>{this.plugin.settings.pomodoroAutoStartWork=i,await this.plugin.saveSettings()})),new E.Setting(e).setName("Enable notifications").setDesc("Show notifications when pomodoro sessions complete").addToggle(r=>r.setValue(this.plugin.settings.pomodoroNotifications).onChange(async i=>{this.plugin.settings.pomodoroNotifications=i,await this.plugin.saveSettings()})),new E.Setting(e).setName("Enable sound").setDesc("Play sound when pomodoro sessions complete").addToggle(r=>r.setValue(this.plugin.settings.pomodoroSoundEnabled).onChange(async i=>{this.plugin.settings.pomodoroSoundEnabled=i,await this.plugin.saveSettings()})),new E.Setting(e).setName("Sound volume").setDesc("Volume for completion sounds (0-100)").addSlider(r=>r.setLimits(0,100,5).setValue(this.plugin.settings.pomodoroSoundVolume).setDynamicTooltip().onChange(async i=>{try{this.plugin.settings.pomodoroSoundVolume=i,await this.plugin.saveSettings()}catch(n){console.error("Error updating pomodoro sound volume:",n),new E.Notice("Failed to update sound volume setting.")}})),new E.Setting(e).setName("Data storage location").setDesc("Choose where to store pomodoro session data. Daily notes provides better data longevity as the data stays with your notes, but requires the Daily Notes core plugin to be enabled.").addDropdown(r=>r.addOption("plugin","Plugin data file (default)").addOption("daily-notes","Daily notes frontmatter").setValue(this.plugin.settings.pomodoroStorageLocation).onChange(async i=>{try{if(i==="daily-notes"){let{appHasDailyNotesPluginLoaded:n}=await Promise.resolve().then(()=>bt(Vr()));if(!n()){new E.Notice("Daily Notes core plugin must be enabled to use this storage option. Please enable it in Settings > Core plugins and try again."),r.setValue("plugin");return}let a=await this.plugin.loadData(),o=(a==null?void 0:a.pomodoroHistory)&&Array.isArray(a.pomodoroHistory)&&a.pomodoroHistory.length>0;if(!await _S(this.app,o)){r.setValue("plugin");return}}this.plugin.settings.pomodoroStorageLocation=i,await this.plugin.saveSettings(),i==="daily-notes"&&await this.plugin.pomodoroService.migrateTodailyNotes()}catch(n){console.error("Error updating pomodoro storage location:",n),new E.Notice("Failed to update storage location setting."),r.setValue("plugin")}})),new E.Setting(e).setName("Auto-stop time tracking on completion").setDesc("Automatically stop time tracking when a task is marked as completed").addToggle(r=>r.setValue(this.plugin.settings.autoStopTimeTrackingOnComplete).onChange(async i=>{this.plugin.settings.autoStopTimeTrackingOnComplete=i,await this.plugin.saveSettings()})),new E.Setting(e).setName("Show auto-stop notifications").setDesc("Show a notice when time tracking is automatically stopped").addToggle(r=>r.setValue(this.plugin.settings.autoStopTimeTrackingNotification).onChange(async i=>{this.plugin.settings.autoStopTimeTrackingNotification=i,await this.plugin.saveSettings()}))}renderSubscriptionList(e){if(e.empty(),!this.plugin.icsSubscriptionService){e.createEl("p",{text:"ICS Subscription service not available",cls:"settings-help-note"});return}let r=this.plugin.icsSubscriptionService.getSubscriptions();if(r.length===0){e.createEl("p",{text:"No calendar subscriptions configured",cls:"settings-help-note"});return}r.forEach(i=>{let n=e.createDiv("settings-item-row ics-subscription-row"),a=n.createDiv("settings-status-indicator");i.enabled?(a.addClass("enabled"),(0,E.setTooltip)(a,i.lastError?`Error: ${i.lastError}`:"Active",{placement:"top"}),i.lastError&&a.addClass("error")):(a.addClass("disabled"),(0,E.setTooltip)(a,"Disabled",{placement:"top"}));let o=n.createDiv("ics-subscription-info");o.createEl("div",{cls:"ics-subscription-name",text:i.name}).createEl("span",{cls:`ics-subscription-type-badge ${i.type}`,text:i.type==="remote"?"URL":"FILE"});let c=i.type==="remote"?i.url:i.filePath;o.createEl("div",{cls:"ics-subscription-url",text:c||"Unknown source"});let d=o.createEl("div",{cls:"ics-subscription-meta"}),u=`Refresh: ${i.refreshInterval}min`,h=i.lastFetched?` \u2022 Last: ${new Date(i.lastFetched).toLocaleString()}`:"";d.textContent=u+h,i.lastError&&o.createEl("div",{cls:"ics-subscription-error",text:`Error: ${i.lastError}`});let p=n.createDiv("ics-subscription-actions");p.createEl("button",{text:i.enabled?"Disable":"Enable",cls:`ics-subscription-toggle ${i.enabled?"enabled":"disabled"}`}).addEventListener("click",async()=>{try{await this.plugin.icsSubscriptionService.updateSubscription(i.id,{enabled:!i.enabled}),this.renderActiveTab()}catch(w){console.error("Error toggling subscription:",w),new E.Notice("Failed to update subscription")}});let m=p.createEl("button",{text:"Refresh",cls:"ics-subscription-refresh"});m.addEventListener("click",async()=>{if(!i.enabled){new E.Notice("Enable the subscription first");return}m.textContent="Refreshing...",m.disabled=!0;try{await this.plugin.icsSubscriptionService.refreshSubscription(i.id),new E.Notice(`Refreshed "${i.name}"`),this.renderActiveTab()}catch(w){console.error("Error refreshing subscription:",w),new E.Notice("Failed to refresh subscription")}finally{m.textContent="Refresh",m.disabled=!1}}),p.createEl("button",{text:"Edit",cls:"ics-subscription-edit"}).addEventListener("click",()=>{this.showInlineEditForm(i,n)}),p.createEl("button",{text:"Delete",cls:"ics-subscription-delete"}).addEventListener("click",async()=>{if(await ui(this.app,{title:"Delete Subscription",message:`Are you sure you want to delete the subscription "${i.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0}))try{await this.plugin.icsSubscriptionService.removeSubscription(i.id),new E.Notice(`Deleted subscription "${i.name}"`),this.renderActiveTab()}catch(T){console.error("Error deleting subscription:",T),new E.Notice("Failed to delete subscription")}})})}showInlineEditForm(e,r){let i=Array.from(r.children);r.empty(),r.addClass("ics-subscription-editing");let n=r.createDiv("ics-edit-form"),a=n.createDiv("ics-edit-row");a.createEl("label",{text:"Name:",cls:"ics-edit-label"});let o=a.createEl("input",{type:"text",value:e.name,cls:"ics-edit-input"}),l=n.createDiv("ics-edit-row");l.createEl("label",{text:"URL:",cls:"ics-edit-label"});let c=l.createEl("input",{type:"url",value:e.url,cls:"ics-edit-input"}),d=n.createDiv("ics-edit-row ics-edit-settings"),u=d.createDiv("ics-edit-group");u.createEl("label",{text:"Color:",cls:"ics-edit-label"});let h=u.createEl("input",{type:"color",value:e.color,cls:"ics-edit-color"}),p=d.createDiv("ics-edit-group");p.createEl("label",{text:"Refresh (min):",cls:"ics-edit-label"});let f=p.createEl("input",{type:"number",value:e.refreshInterval.toString(),cls:"ics-edit-number"});f.setAttribute("min","15"),f.setAttribute("max","1440"),f.setAttribute("step","15");let g=d.createDiv("ics-edit-group").createEl("label",{cls:"ics-edit-checkbox-label"}),y=g.createEl("input",{type:"checkbox",cls:"ics-edit-checkbox"});y.checked=e.enabled,g.createSpan({text:" Enabled"});let w=n.createDiv("ics-edit-row ics-edit-buttons"),T=w.createEl("button",{text:"Save",cls:"ics-edit-button mod-cta"}),S=w.createEl("button",{text:"Cancel",cls:"ics-edit-button"});T.addEventListener("click",async()=>{let x=o.value.trim(),I=c.value.trim(),F=h.value,A=parseInt(f.value),L=y.checked;if(!x||!I){new E.Notice("Name and URL are required");return}if(A<15||A>1440){new E.Notice("Refresh interval must be between 15 and 1440 minutes");return}try{T.textContent="Saving...",T.disabled=!0,await this.plugin.icsSubscriptionService.updateSubscription(e.id,{name:x,url:I,color:F,refreshInterval:A,enabled:L}),new E.Notice(`Updated subscription "${x}"`),this.renderActiveTab()}catch(G){console.error("Error updating subscription:",G),new E.Notice("Failed to update subscription")}}),S.addEventListener("click",()=>{r.empty(),r.removeClass("ics-subscription-editing"),i.forEach(x=>r.appendChild(x)),this.renderActiveTab()}),window.setTimeout(()=>o.focus(),50)}initializeDefaultProjectsFromSettings(){let e=this.plugin.settings.taskCreationDefaults.defaultProjects;if(!e){this.selectedDefaultProjectFiles=[];return}let r=hi(e);this.selectedDefaultProjectFiles=[];for(let i of r){let n=i.match(/^\[\[([^\]]+)\]\]$/);if(n){let a=n[1],o=this.app.metadataCache.getFirstLinkpathDest(a,"");o&&this.selectedDefaultProjectFiles.push(o)}else{let o=this.app.vault.getMarkdownFiles().find(l=>l.basename===i||l.name===i+".md");o&&this.selectedDefaultProjectFiles.push(o)}}}addDefaultProject(e){this.selectedDefaultProjectFiles.some(i=>i.path===e.path)||this.selectedDefaultProjectFiles.push(e)}removeDefaultProject(e){this.selectedDefaultProjectFiles=this.selectedDefaultProjectFiles.filter(r=>r.path!==e.path)}renderDefaultProjectsList(e){if(e.empty(),this.selectedDefaultProjectFiles.length===0){let r=e.createDiv({cls:"default-projects-empty"});r.textContent="No default projects selected";return}this.selectedDefaultProjectFiles.forEach(r=>{let i=e.createDiv({cls:"default-project-item"}),n=i.createDiv({cls:"default-project-info"}),a=n.createSpan({cls:"default-project-name"});if(a.textContent=r.name,r.path!==r.name){let l=n.createDiv({cls:"default-project-path"});l.textContent=r.path}let o=i.createEl("button",{cls:"default-project-remove",text:"\xD7"});(0,E.setTooltip)(o,"Remove project",{placement:"top"}),o.addEventListener("click",()=>{this.removeDefaultProject(r),this.renderDefaultProjectsList(e),this.updateDefaultProjectsInSettings()})})}updateDefaultProjectsInSettings(){let e=this.app.workspace.getActiveFile(),r=(e==null?void 0:e.path)||"",i=this.selectedDefaultProjectFiles.map(n=>`[[${this.app.metadataCache.fileToLinktext(n,r,!0)}]]`);this.plugin.settings.taskCreationDefaults.defaultProjects=i.join(", "),this.plugin.saveSettings()}renderDefaultRemindersList(e){e.empty();let r=this.plugin.settings.taskCreationDefaults.defaultReminders||[];if(r.length===0){let n=e.createDiv({cls:"reminder-defaults-empty"});(0,E.setIcon)(n.createDiv({cls:"reminder-defaults-empty-icon"}),"bell-off"),n.createEl("div",{cls:"reminder-defaults-empty-text",text:"No default reminders configured"});return}let i=e.createDiv({cls:"reminder-defaults-items"});r.forEach((n,a)=>{let o=i.createDiv({cls:"reminder-defaults-card"}),l=o.createDiv({cls:"reminder-defaults-icon"}),c=n.type==="absolute"?"calendar-clock":"timer";(0,E.setIcon)(l,c);let d=o.createDiv({cls:"reminder-defaults-content"}),u=d.createDiv({cls:"reminder-defaults-primary"});if(u.textContent=this.formatDefaultReminderText(n),n.description){let f=d.createDiv({cls:"reminder-defaults-description"});f.textContent=`"${n.description}"`}let p=o.createDiv({cls:"reminder-defaults-actions"}).createEl("button",{cls:"reminder-defaults-remove-btn"});(0,E.setIcon)(p,"trash-2"),(0,E.setTooltip)(p,"Delete this default reminder"),p.onclick=async()=>{await this.removeDefaultReminder(a)}})}renderAddDefaultReminderForm(e){let r=e.createDiv({cls:"reminder-defaults-form"});r.createEl("h4",{text:"Add Default Reminder",cls:"reminder-defaults-form-header"});let i=r.createDiv({cls:"reminder-defaults-type-selector"}),n=i.createEl("button",{cls:"reminder-defaults-type-tab reminder-defaults-type-tab--active",text:"Relative",attr:{"data-type":"relative"}}),a=i.createEl("button",{cls:"reminder-defaults-type-tab",text:"Absolute",attr:{"data-type":"absolute"}}),o="relative",l="due",c=15,d="minutes",u="before",h="",p="",f="",m=x=>{o=x,n.classList.toggle("reminder-defaults-type-tab--active",x==="relative"),a.classList.toggle("reminder-defaults-type-tab--active",x==="absolute"),S()};n.onclick=()=>m("relative"),a.onclick=()=>m("absolute");let g=r.createDiv({cls:"reminder-defaults-relative-fields"});new E.Setting(g).setName("Time").addText(x=>{x.setPlaceholder("15").setValue(String(c)).onChange(I=>{c=parseInt(I)||0})}).addDropdown(x=>{x.addOption("minutes","minutes").addOption("hours","hours").addOption("days","days").setValue(d).onChange(I=>{d=I})}),new E.Setting(g).setName("Direction").addDropdown(x=>{x.addOption("before","Before").addOption("after","After").setValue(u).onChange(I=>{u=I})}),new E.Setting(g).setName("Relative to").addDropdown(x=>{x.addOption("due","Due date").addOption("scheduled","Scheduled date").setValue(l).onChange(I=>{l=I})});let y=r.createDiv({cls:"reminder-defaults-absolute-fields"});new E.Setting(y).setName("Date").addText(x=>{x.setPlaceholder("YYYY-MM-DD").setValue(h).onChange(I=>{h=I}),x.inputEl.type="date"}),new E.Setting(y).setName("Time").addText(x=>{x.setPlaceholder("HH:MM").setValue(p).onChange(I=>{p=I}),x.inputEl.type="time"}),new E.Setting(r).setName("Description (optional)").addText(x=>{x.setPlaceholder("Custom reminder message").setValue(f).onChange(I=>{f=I})});let w=r.createEl("button",{cls:"reminder-defaults-add-btn"}),T=w.createSpan({cls:"reminder-defaults-add-icon"});(0,E.setIcon)(T,"plus"),w.createSpan({cls:"reminder-defaults-add-text",text:"Add Default Reminder"}),w.onclick=async()=>{try{let x=this.createDefaultReminder(o,l,c,d,u,h,p,f);x&&(await this.addDefaultReminder(x),o==="relative"?(c=15,d="minutes",f=""):(h="",p="",f=""),this.resetDefaultReminderForm(r))}catch(x){console.error("Error adding default reminder:",x),new E.Notice("Failed to add default reminder. Please check your inputs.")}};let S=()=>{g.style.display=o==="relative"?"block":"none",y.style.display=o==="absolute"?"block":"none"};S()}formatDefaultReminderText(e){if(e.type==="absolute")return e.absoluteDate&&e.absoluteTime?`${e.absoluteDate} at ${e.absoluteTime}`:"Absolute reminder";{let r=e.relatedTo==="due"?"due date":"scheduled date";return`${this.formatDefaultReminderOffset(e)} ${r}`}}formatDefaultReminderOffset(e){if(!e.offset||!e.unit)return"At time of";let r=e.direction==="before"?"before":"after",i=e.offset===1?e.unit.slice(0,-1):e.unit;return`${e.offset} ${i} ${r}`}createDefaultReminder(e,r,i,n,a,o,l,c){let d=`def_rem_${Date.now()}`;return e==="relative"?{id:d,type:"relative",relatedTo:r,offset:i,unit:n,direction:a,description:c||void 0}:!o||!l?(new E.Notice("Please specify both date and time for absolute reminder"),null):{id:d,type:"absolute",absoluteDate:o,absoluteTime:l,description:c||void 0}}async addDefaultReminder(e){this.plugin.settings.taskCreationDefaults.defaultReminders||(this.plugin.settings.taskCreationDefaults.defaultReminders=[]),this.plugin.settings.taskCreationDefaults.defaultReminders.push(e),await this.plugin.saveSettings();let r=document.querySelector(".reminder-defaults-list");r&&this.renderDefaultRemindersList(r),new E.Notice("Default reminder added successfully")}async removeDefaultReminder(e){if(!this.plugin.settings.taskCreationDefaults.defaultReminders)return;this.plugin.settings.taskCreationDefaults.defaultReminders.splice(e,1),await this.plugin.saveSettings();let r=document.querySelector(".reminder-defaults-list");r&&this.renderDefaultRemindersList(r),new E.Notice("Default reminder removed")}resetDefaultReminderForm(e){e.querySelectorAll("input, select").forEach(n=>{n.type==="text"||n.type==="date"||n.type==="time"?n.value="":n.tagName==="SELECT"&&(n.selectedIndex=0)});let i=e.querySelector('input[placeholder="15"]');i&&(i.value="15")}renderWebhookList(e){let r=e.createDiv({cls:"tasknotes-webhooks-container"});if(!this.plugin.settings.webhooks||this.plugin.settings.webhooks.length===0){let i=r.createDiv({cls:"tasknotes-webhooks-empty-state"}),n=i.createSpan({cls:"tasknotes-webhooks-empty-icon"});(0,E.setIcon)(n,"webhook"),i.createSpan({text:"No webhooks configured. Add a webhook to receive real-time notifications.",cls:"tasknotes-webhooks-empty-text"});return}this.plugin.settings.webhooks.forEach((i,n)=>{let a=r.createDiv({cls:"tasknotes-webhook-card"}),o=a.createDiv({cls:"tasknotes-webhook-header"}),l=o.createDiv({cls:"tasknotes-webhook-url-section"}),c=l.createSpan({cls:"tasknotes-webhook-url-icon"});(0,E.setIcon)(c,"link"),l.createSpan({text:i.url,cls:"tasknotes-webhook-url"});let u=o.createDiv({cls:"tasknotes-webhook-status-section"}).createSpan({cls:`tasknotes-webhook-status-indicator ${i.active?"active":"inactive"}`}),h=u.createSpan({cls:"tasknotes-webhook-status-icon"});(0,E.setIcon)(h,i.active?"circle-check":"circle-x"),u.createSpan({text:i.active?"Active":"Inactive",cls:"tasknotes-webhook-status-text"});let p=a.createDiv({cls:"tasknotes-webhook-content"}),f=p.createDiv({cls:"tasknotes-webhook-detail-row"}),m=f.createSpan({cls:"tasknotes-webhook-detail-icon"});if((0,E.setIcon)(m,"zap"),f.createSpan({text:"Events:",cls:"tasknotes-webhook-detail-label"}),f.createSpan({text:i.events.join(", "),cls:"tasknotes-webhook-detail-value"}),i.transformFile){let k=p.createDiv({cls:"tasknotes-webhook-detail-row"}),D=k.createSpan({cls:"tasknotes-webhook-detail-icon"});(0,E.setIcon)(D,"file-code"),k.createSpan({text:"Transform:",cls:"tasknotes-webhook-detail-label"}),k.createSpan({text:i.transformFile,cls:"tasknotes-webhook-detail-value"})}if(i.corsHeaders===!1){let k=p.createDiv({cls:"tasknotes-webhook-detail-row warning"}),D=k.createSpan({cls:"tasknotes-webhook-detail-icon"});(0,E.setIcon)(D,"alert-triangle"),k.createSpan({text:"Custom headers disabled",cls:"tasknotes-webhook-detail-warning"})}let g=p.createDiv({cls:"tasknotes-webhook-detail-row"}),y=g.createSpan({cls:"tasknotes-webhook-detail-icon"});(0,E.setIcon)(y,"bar-chart-3"),g.createSpan({text:"Statistics:",cls:"tasknotes-webhook-detail-label"});let w=g.createSpan({cls:"tasknotes-webhook-stats"}),T=w.createSpan({cls:"tasknotes-webhook-stat-success"}),S=T.createSpan({cls:"tasknotes-webhook-stat-icon"});(0,E.setIcon)(S,"check"),T.createSpan({text:`${i.successCount||0}`});let x=w.createSpan({cls:"tasknotes-webhook-stat-failure"}),I=x.createSpan({cls:"tasknotes-webhook-stat-icon"});(0,E.setIcon)(I,"x"),x.createSpan({text:`${i.failureCount||0}`});let F=a.createDiv({cls:"tasknotes-webhook-actions"}),A=F.createEl("button",{cls:`tasknotes-webhook-action-btn ${i.active?"disable":"enable"}`,attr:{"aria-label":i.active?"Disable webhook":"Enable webhook"}}),L=A.createSpan({cls:"tasknotes-webhook-action-icon"});(0,E.setIcon)(L,i.active?"pause":"play"),A.createSpan({text:i.active?"Disable":"Enable",cls:"tasknotes-webhook-action-text"}),(0,E.setTooltip)(A,i.active?"Disable this webhook":"Enable this webhook"),A.onclick=async()=>{i.active=!i.active,await this.plugin.saveSettings(),this.display(),new E.Notice(`Webhook ${i.active?"enabled":"disabled"}`)};let G=F.createEl("button",{cls:"tasknotes-webhook-action-btn delete",attr:{"aria-label":"Delete webhook"}}),V=G.createSpan({cls:"tasknotes-webhook-action-icon"});(0,E.setIcon)(V,"trash-2"),G.createSpan({text:"Delete",cls:"tasknotes-webhook-action-text"}),(0,E.setTooltip)(G,"Delete this webhook"),G.onclick=async()=>{await ui(this.app,{title:"Delete Webhook",message:`Are you sure you want to delete this webhook?

URL: ${i.url}

This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})&&(this.plugin.settings.webhooks.splice(n,1),await this.plugin.saveSettings(),this.display(),new E.Notice("Webhook deleted"))}})}showWebhookModal(){new nf(this.app,async r=>{let i={id:`wh_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,url:r.url||"",events:r.events||[],secret:this.generateWebhookSecret(),active:!0,createdAt:new Date().toISOString(),failureCount:0,successCount:0,transformFile:r.transformFile,corsHeaders:r.corsHeaders};this.plugin.settings.webhooks||(this.plugin.settings.webhooks=[]),this.plugin.settings.webhooks.push(i),await this.plugin.saveSettings(),this.display();let a=new E.Notice("",8e3).noticeEl.createDiv({cls:"tasknotes-webhook-secret-notice"}),o=a.createDiv({cls:"tasknotes-webhook-secret-title"}),l=o.createSpan();(0,E.setIcon)(l,"check-circle"),o.createSpan({text:"Webhook added successfully!"});let c=a.createDiv({cls:"tasknotes-webhook-secret-content"});c.createSpan({text:"Secret: "}),c.createEl("code",{text:`${i.secret.substring(0,16)}...`,cls:"tasknotes-webhook-secret-code"}),c.createSpan({text:" (copy from webhook settings)"})}).open()}generateWebhookSecret(){return Array.from(crypto.getRandomValues(new Uint8Array(32))).map(e=>e.toString(16).padStart(2,"0")).join("")}},nf=class extends E.Modal{constructor(e,r){super(e);this.url="";this.selectedEvents=[];this.transformFile="";this.corsHeaders=!0;this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-webhook-modal");let r=e.createDiv({cls:"tasknotes-webhook-modal-header"}),i=r.createSpan({cls:"tasknotes-webhook-modal-icon"});(0,E.setIcon)(i,"webhook"),r.createEl("h2",{text:"Add Webhook",cls:"tasknotes-webhook-modal-title"});let n=e.createDiv({cls:"tasknotes-webhook-modal-section"});new E.Setting(n).setName("Webhook URL").setDesc("The endpoint where webhook payloads will be sent").addText(_=>(_.inputEl.setAttribute("aria-label","Webhook URL"),_.setPlaceholder("https://your-service.com/webhook").setValue(this.url).onChange($=>{this.url=$})));let a=e.createDiv({cls:"tasknotes-webhook-modal-section"}),o=a.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),l=o.createSpan();(0,E.setIcon)(l,"zap"),o.createEl("h3",{text:"Events to subscribe to"});let c=a.createDiv({cls:"tasknotes-webhook-events-list"});[{id:"task.created",label:"Task Created",desc:"When new tasks are created"},{id:"task.updated",label:"Task Updated",desc:"When tasks are modified"},{id:"task.completed",label:"Task Completed",desc:"When tasks are marked complete"},{id:"task.deleted",label:"Task Deleted",desc:"When tasks are deleted"},{id:"task.archived",label:"Task Archived",desc:"When tasks are archived"},{id:"task.unarchived",label:"Task Unarchived",desc:"When tasks are unarchived"},{id:"time.started",label:"Time Started",desc:"When time tracking starts"},{id:"time.stopped",label:"Time Stopped",desc:"When time tracking stops"},{id:"pomodoro.started",label:"Pomodoro Started",desc:"When pomodoro sessions begin"},{id:"pomodoro.completed",label:"Pomodoro Completed",desc:"When pomodoro sessions finish"},{id:"pomodoro.interrupted",label:"Pomodoro Interrupted",desc:"When pomodoro sessions are stopped"},{id:"recurring.instance.completed",label:"Recurring Instance Completed",desc:"When recurring task instances complete"},{id:"reminder.triggered",label:"Reminder Triggered",desc:"When task reminders activate"}].forEach(_=>{new E.Setting(c).setName(_.label).setDesc(_.desc).addToggle($=>($.toggleEl.setAttribute("aria-label",`Subscribe to ${_.label} events`),$.setValue(this.selectedEvents.includes(_.id)).onChange(U=>{if(U)this.selectedEvents.push(_.id);else{let R=this.selectedEvents.indexOf(_.id);R>-1&&this.selectedEvents.splice(R,1)}})))});let u=e.createDiv({cls:"tasknotes-webhook-modal-section"}),h=u.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),p=h.createSpan();(0,E.setIcon)(p,"file-code"),h.createEl("h3",{text:"Transform Configuration (Optional)"}),new E.Setting(u).setName("Transform File").setDesc("Path to a .js or .json file in your vault that transforms webhook payloads").addText(_=>(_.inputEl.setAttribute("aria-label","Transform file path"),_.setPlaceholder("discord-transform.js").setValue(this.transformFile).onChange($=>{this.transformFile=$})));let f=u.createDiv({cls:"tasknotes-webhook-transform-help"}),m=f.createDiv({cls:"tasknotes-webhook-help-header"}),g=m.createSpan();(0,E.setIcon)(g,"info"),m.createSpan({text:"Transform files allow you to customize webhook payloads:"});let y=f.createEl("ul",{cls:"tasknotes-webhook-help-list"}),w=y.createEl("li");w.createEl("strong",{text:".js files:"}),w.appendText(" Custom JavaScript transforms");let T=y.createEl("li");T.createEl("strong",{text:".json files:"}),T.appendText(" Templates with "),T.createEl("code",{text:"${data.task.title}"});let S=y.createEl("li");S.createEl("strong",{text:"Leave empty:"}),S.appendText(" Send raw data");let x=f.createDiv({cls:"tasknotes-webhook-help-example"});x.createEl("strong",{text:"Example:"}),x.appendText(" "),x.createEl("code",{text:"discord-transform.js"});let I=e.createDiv({cls:"tasknotes-webhook-modal-section"}),F=I.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),A=F.createSpan();(0,E.setIcon)(A,"settings"),F.createEl("h3",{text:"Headers Configuration"}),new E.Setting(I).setName("Include custom headers").setDesc("Include TaskNotes headers (event type, signature, delivery ID). Turn off for Discord, Slack, and other services with strict CORS policies.").addToggle(_=>(_.toggleEl.setAttribute("aria-label","Include custom headers"),_.setValue(this.corsHeaders).onChange($=>{this.corsHeaders=$})));let L=e.createDiv({cls:"tasknotes-webhook-modal-buttons"}),G=L.createEl("button",{text:"Cancel",cls:"tasknotes-webhook-modal-btn cancel",attr:{"aria-label":"Cancel webhook creation"}}),V=G.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,E.setIcon)(V,"x"),G.onclick=()=>this.close();let k=L.createEl("button",{text:"Add Webhook",cls:"tasknotes-webhook-modal-btn save mod-cta",attr:{"aria-label":"Create webhook"}}),D=k.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,E.setIcon)(D,"plus"),k.onclick=()=>{if(!this.url.trim()){new E.Notice("Webhook URL is required");return}if(this.selectedEvents.length===0){new E.Notice("Please select at least one event");return}this.onSubmit({url:this.url.trim(),events:this.selectedEvents,transformFile:this.transformFile.trim()||void 0,corsHeaders:this.corsHeaders}),this.close()}}onClose(){let{contentEl:e}=this;e.empty()}};var Na="tasknotes-mini-calendar-view",Xi="tasknotes-advanced-calendar-view",Wr="tasknotes-task-list-view",tl="tasknotes-notes-view",kt="tasknotes-agenda-view",rl="tasknotes-pomodoro-view",il="tasknotes-pomodoro-stats-view",sl="tasknotes-stats-view",pi="tasknotes-kanban-view",AS="tasknotes-subtask-widget-view",Os="date-selected";var Ft="data-changed",Fe="task-updated",Id="task-deleted",Pd="pomodoro-start",Nd="pomodoro-complete",Rd="pomodoro-interrupt",fi="pomodoro-tick",IS="timeblocking-toggled";var mi="date-changed",nl=[{id:"title",label:"Title",category:"text",supportedOperators:["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"text"},{id:"path",label:"Path",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"status",label:"Status",category:"select",supportedOperators:["is","is-not","is-empty","is-not-empty"],valueInputType:"select"},{id:"priority",label:"Priority",category:"select",supportedOperators:["is","is-not","is-empty","is-not-empty"],valueInputType:"select"},{id:"tags",label:"Tags",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"contexts",label:"Contexts",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"projects",label:"Projects",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"due",label:"Due Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"scheduled",label:"Scheduled Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"completedDate",label:"Completed Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"file.ctime",label:"Created Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"file.mtime",label:"Modified Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"archived",label:"Archived",category:"boolean",supportedOperators:["is-checked","is-not-checked"],valueInputType:"none"},{id:"timeEstimate",label:"Time Estimate",category:"numeric",supportedOperators:["is","is-not","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal"],valueInputType:"number"},{id:"recurrence",label:"Recurrence",category:"special",supportedOperators:["is-empty","is-not-empty"],valueInputType:"none"},{id:"status.isCompleted",label:"Completed",category:"boolean",supportedOperators:["is-checked","is-not-checked"],valueInputType:"none"}],Od=[{id:"is",label:"is",requiresValue:!0},{id:"is-not",label:"is not",requiresValue:!0},{id:"contains",label:"contains",requiresValue:!0},{id:"does-not-contain",label:"does not contain",requiresValue:!0},{id:"is-before",label:"is before",requiresValue:!0},{id:"is-after",label:"is after",requiresValue:!0},{id:"is-on-or-before",label:"is on or before",requiresValue:!0},{id:"is-on-or-after",label:"is on or after",requiresValue:!0},{id:"is-empty",label:"is empty",requiresValue:!1},{id:"is-not-empty",label:"is not empty",requiresValue:!1},{id:"is-checked",label:"is checked",requiresValue:!1},{id:"is-not-checked",label:"is not checked",requiresValue:!1},{id:"is-greater-than",label:"is greater than",requiresValue:!0},{id:"is-less-than",label:"is less than",requiresValue:!0},{id:"is-greater-than-or-equal",label:"is equal or greater than",requiresValue:!0},{id:"is-less-than-or-equal",label:"is equal or less than",requiresValue:!0}];var mr=require("obsidian");ot();Se();var Xd=bt(Vr());ht();var za=require("obsidian"),$s=class $s{constructor(){this.metrics=new Map;this.markers=new Map;this.enabled=!0;this.mutationObservers=new Set;this.performanceObservers=new Set}static getInstance(){return $s.instance||($s.instance=new $s),$s.instance}startTimer(t){this.enabled&&this.markers.set(t,performance.now())}endTimer(t){if(!this.enabled)return 0;let e=this.markers.get(t);if(e===void 0)return t.includes("-measure-")||console.warn(`No start marker found for operation: ${t}`),0;let r=performance.now()-e;return this.recordMetric(t,r),this.markers.delete(t),r}async measure(t,e){if(!this.enabled)return e();let r=performance.now();try{return await e()}finally{let i=performance.now()-r;this.recordMetric(t,i)}}measureSync(t,e){if(!this.enabled)return e();let r=performance.now();try{return e()}finally{let i=performance.now()-r;this.recordMetric(t,i)}}recordMetric(t,e){if(!this.enabled)return;this.metrics.has(t)||this.metrics.set(t,[]);let r=this.metrics.get(t);r.push(e),r.length>50&&r.splice(0,r.length-50)}getStats(t){let e=this.metrics.get(t);if(!e||e.length===0)return null;let r=[...e].sort((a,o)=>a-o),i=r.length,n=r.reduce((a,o)=>a+o,0);return{count:i,average:n/i,min:r[0],max:r[i-1],median:r[Math.floor(i/2)],p95:r[Math.floor(i*.95)]}}getAllStats(){let t={};for(let[e]of this.metrics)t[e]=this.getStats(e);return t}logSummary(){if(!this.enabled)return;console.group("[Performance Summary]");let t=this.getAllStats();["cache-file-read","task-list-render","calendar-render","task-update","file-index","dom-update"].forEach(r=>{let i=t[r];i&&console.log(`${r}:`,{average:`${i.average.toFixed(2)}ms`,p95:`${i.p95.toFixed(2)}ms`,count:i.count})}),console.groupEnd()}monitorDOMMutations(t){if(!this.enabled)return()=>{};let e=0,r=performance.now(),i=new MutationObserver(n=>{e+=n.length;let a=performance.now()-r;e>100&&a<1e3&&console.warn(`High DOM mutation rate: ${e} mutations in ${a.toFixed(2)}ms`)});return i.observe(t,{childList:!0,subtree:!0,attributes:!0}),this.mutationObservers.add(i),()=>{i.disconnect(),this.mutationObservers.delete(i),this.recordMetric("dom-mutations",e)}}recordMemoryUsage(t){if(!this.enabled||!("memory"in performance))return;let e=performance.memory,r={used:e.usedJSHeapSize/1024/1024,total:e.totalJSHeapSize/1024/1024,limit:e.jsHeapSizeLimit/1024/1024},i=t?`memory-${t}`:"memory-usage";this.recordMetric(i,r.used),r.used>100&&console.warn(`High memory usage: ${r.used.toFixed(2)}MB`)}trackLongTasks(){if(!this.enabled||!("PerformanceObserver"in window))return()=>{};let t=new PerformanceObserver(e=>{for(let r of e.getEntries())r.duration>50&&(console.warn(`Long task detected: ${r.duration.toFixed(2)}ms`),this.recordMetric("long-task",r.duration))});try{t.observe({entryTypes:["longtask"]}),this.performanceObservers.add(t)}catch(e){console.warn("Long task monitoring not supported")}return()=>{t.disconnect(),this.performanceObservers.delete(t)}}mark(t){if(this.enabled)try{performance.mark(`tasknotes-${t}`)}catch(e){}}measureBetweenMarks(t,e,r){if(this.enabled)try{performance.measure(`tasknotes-${r}`,`tasknotes-${t}`,`tasknotes-${e}`)}catch(i){}}clear(){this.metrics.clear(),this.markers.clear()}destroy(){for(let t of this.mutationObservers)t.disconnect();this.mutationObservers.clear();for(let t of this.performanceObservers)t.disconnect();this.performanceObservers.clear(),this.clear(),$s.instance=null}setEnabled(t){this.enabled=t,t||this.clear()}exportData(){let t={timestamp:new Date().toISOString(),stats:this.getAllStats(),platform:{isDesktop:za.Platform.isDesktop,isMobile:za.Platform.isMobile,isWin:za.Platform.isWin,isMacOS:za.Platform.isMacOS,isLinux:za.Platform.isLinux},memoryInfo:"memory"in performance?performance.memory:null};return JSON.stringify(t,null,2)}};$s.instance=null;var Hf=$s;var as=Hf.getInstance();Se();var qa=class qa extends mr.ItemView{constructor(e,r){super(e);this.colorizeMode="tasks";this.listeners=[];this.monthCalculationCache=new Map;this.debouncedRefresh=null;this.currentCacheKey="";this.calendarDayElements=null;this.elementToDateMap=new Map;this.plugin=r;let i=this.plugin.selectedDate;this.displayedMonth=i.getUTCMonth(),this.displayedYear=i.getUTCFullYear(),this.registerEvents()}registerEvents(){this.listeners.forEach(n=>this.plugin.emitter.offref(n)),this.listeners=[];let e=this.plugin.emitter.on(Ft,()=>{this.refresh()});this.listeners.push(e);let r=this.plugin.emitter.on(Os,n=>{this.displayedMonth!==n.getUTCMonth()||this.displayedYear!==n.getUTCFullYear()?(this.displayedMonth=n.getUTCMonth(),this.displayedYear=n.getUTCFullYear(),this.clearMonthCalculationCache(),this.colorizeMode==="daily"&&this.plugin.cacheManager.rebuildDailyNotesCache(n.getUTCFullYear(),n.getUTCMonth()),this.refresh()):(this.updateSelectedDate(n),this.updateMonthDisplay())});this.listeners.push(r);let i=this.plugin.emitter.on(Fe,({path:n,originalTask:a,updatedTask:o})=>{if(!n||!o){console.error("EVENT_TASK_UPDATED received invalid data:",{path:n,originalTask:a,updatedTask:o});return}this.handleTaskUpdate(a,o)});this.listeners.push(i)}getViewType(){return Na}getDisplayText(){return"Mini Calendar"}getIcon(){return"calendar-days"}async onOpen(){await this.plugin.onReady();let e=this.contentEl;e.empty();let r=e.createDiv({cls:"tasknotes-plugin mini-calendar-view"});this.showLoadingIndicator(),this.renderView(r),await this.refresh(),this.registerKeyboardNavigation()}renderView(e){e.empty(),this.createCalendarControls(e),this.createCalendarGrid(e),this.colorizeCalendar()}colorizeCalendar(){switch(this.colorizeMode){case"tasks":this.colorizeCalendarForTasks();break;case"notes":this.colorizeCalendarForNotes();break;case"daily":this.colorizeCalendarForDailyNotes();break}}async navigateToPreviousPeriod(){let e=new Date(this.plugin.selectedDate),r=new Date(e.getTime());r.setUTCMonth(e.getUTCMonth()-1),this.plugin.setSelectedDate(r)}async navigateToNextPeriod(){let e=new Date(this.plugin.selectedDate),r=new Date(e.getTime());r.setUTCMonth(e.getUTCMonth()+1),this.plugin.setSelectedDate(r)}async navigateToToday(){let e=Ue(),r=dt(e);this.plugin.setSelectedDate(r)}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.monthCalculationCache.clear(),this.elementToDateMap.clear(),this.calendarDayElements=null,this.currentCacheKey="",this.contentEl.empty()}registerKeyboardNavigation(){this.registerDomEvent(document,"keydown",async e=>{if(!this.isThisViewActive())return;let r=new Date(this.plugin.selectedDate),i;switch(e.key){case"ArrowLeft":i=new Date(r),i.setUTCDate(r.getUTCDate()-1);break;case"ArrowRight":i=new Date(r),i.setUTCDate(r.getUTCDate()+1);break;case"ArrowUp":i=new Date(r),i.setUTCDate(r.getUTCDate()-7);break;case"ArrowDown":i=new Date(r),i.setUTCDate(r.getUTCDate()+7);break;case"Enter":e.preventDefault(),this.plugin.navigateToDailyNote(r);return;default:return}i&&(e.preventDefault(),this.plugin.setSelectedDate(i))})}isThisViewActive(){return this.app.workspace.getActiveViewOfType(qa)===this}navigateDate(e,r){let i=new Date(this.plugin.selectedDate),n=new Date(i);n.setUTCDate(i.getUTCDate()+r*7+e),this.plugin.setSelectedDate(n)}async refresh(){this.showLoadingIndicator();try{let e=this.contentEl.querySelector(".mini-calendar-view");e||(e=this.contentEl.createDiv({cls:"tasknotes-plugin mini-calendar-view"})),this.renderView(e)}finally{this.hideLoadingIndicator()}}updateSelectedDate(e){let r=this.contentEl.querySelectorAll(".mini-calendar-view__day");r.forEach(i=>{i.classList.remove("mini-calendar-view__day--selected"),i.setAttribute("aria-selected","false"),i.setAttribute("tabindex","-1")}),r.forEach(i=>{let n=i;(n.getAttribute("aria-label")||"").includes(C(e,"EEEE, MMMM d, yyyy"))&&(n.classList.add("mini-calendar-view__day--selected"),n.setAttribute("aria-selected","true"),n.setAttribute("tabindex","0"),n.focus())}),this.plugin.selectedDate=e}updateMonthDisplay(){let e=this.contentEl.querySelector(".mini-calendar-view__month-display");e&&(e.textContent=C(this.plugin.selectedDate,"MMMM yyyy"))}showLoadingIndicator(){let e=this.contentEl.querySelector(".mini-calendar-view")||this.contentEl;if(e.querySelector(".cache-loading-indicator"))return;let r=document.createElement("div");r.className="cache-loading-indicator",r.textContent="Loading calendar data...",e.prepend(r)}hideLoadingIndicator(){let e=this.contentEl.querySelector(".cache-loading-indicator");e&&e.remove()}createCalendarControls(e){let i=e.createDiv({cls:"mini-calendar-view__controls"}).createDiv({cls:"mini-calendar-view__header"}),n=i.createEl("select",{cls:"mini-calendar-view__view-selector",attr:{title:"Change view","aria-label":"Change calendar view"}});[{value:"tasks",text:"Tasks"},{value:"notes",text:"Notes"},{value:"daily",text:"Daily notes"}].forEach(u=>{let h=n.createEl("option",{value:u.value,text:u.text});u.value===this.colorizeMode&&(h.selected=!0)}),n.addEventListener("change",async()=>{let u=n.value;this.showLoadingIndicator();try{await this.setColorizeMode(u)}finally{this.hideLoadingIndicator()}});let o=i.createDiv({cls:"mini-calendar-view__navigation"});o.createEl("button",{text:"\u2039",cls:"mini-calendar-view__nav-button mini-calendar-view__nav-button--prev",attr:{"aria-label":"Previous month",title:"Previous month"}}).addEventListener("click",()=>{this.navigateToPreviousPeriod()}),o.createDiv({cls:"mini-calendar-view__month-display",text:C(this.plugin.selectedDate,"MMMM yyyy")}),o.createEl("button",{text:"\u203A",cls:"mini-calendar-view__nav-button mini-calendar-view__nav-button--next",attr:{"aria-label":"Next month",title:"Next month"}}).addEventListener("click",()=>{this.navigateToNextPeriod()}),i.createEl("button",{text:"Today",cls:"mini-calendar-view__today-button",attr:{"aria-label":"Go to today",title:"Go to today"}}).addEventListener("click",()=>{this.navigateToToday()})}async setColorizeMode(e){if(this.colorizeMode!==e){if(this.colorizeMode=e,e==="daily"){let r=this.plugin.selectedDate.getUTCFullYear(),i=this.plugin.selectedDate.getUTCMonth();await this.plugin.cacheManager.rebuildDailyNotesCache(r,i)}this.colorizeCalendar()}}createCalendarGrid(e){let r=e.createDiv({cls:"mini-calendar-view__grid-container"}),i=this.plugin.selectedDate,n=i.getUTCMonth(),a=i.getUTCFullYear(),o=new Date(Date.UTC(a,n,1)),l=new Date(Date.UTC(a,n+1,0)),c=this.plugin.settings.calendarViewSettings.firstDay||0,d=(o.getUTCDay()-c+7)%7,u=r.createDiv({cls:"mini-calendar-view__grid",attr:{role:"grid","aria-label":`Calendar for ${C(this.plugin.selectedDate,"MMMM yyyy")}`,id:"calendar-grid"}}),h=u.createDiv({cls:"mini-calendar-view__grid-header",attr:{role:"row"}}),p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];[...p.slice(c),...p.slice(0,c)].forEach((F,A)=>{h.createDiv({text:F,cls:"mini-calendar-view__day-header",attr:{role:"columnheader","aria-label":F}})});let m=d,g=42,y=l.getUTCDate(),w=g-y-m,T=new Date(Date.UTC(a,n,0)).getUTCDate(),S=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}});for(let F=0;F<m;F++){let A=T-m+F+1,L=new Date(Date.UTC(a,n-1,A)),G=yl(L,i),V=S.createDiv({cls:`mini-calendar-view__day mini-calendar-view__day--outside-month${G?" mini-calendar-view__day--selected":""}`,text:A.toString(),attr:{role:"gridcell",tabindex:G?"0":"-1","aria-label":C(L,"EEEE, MMMM d, yyyy"),"aria-selected":G?"true":"false"}});V.addEventListener("click",()=>{this.plugin.setSelectedDate(L)}),V.addEventListener("mouseover",k=>{this.showDayPreview(k,L,V)}),V.addEventListener("keydown",k=>{(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),this.plugin.setSelectedDate(L))}),this.addDropHandlers(V,L)}let x=Ue(),I=dt(x);for(let F=1;F<=y;F++){(F+m-1)%7===0&&F>1&&(S=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}}));let A=new Date(Date.UTC(a,n,F)),L=yl(A,I),G=yl(A,i),V="mini-calendar-view__day";L&&(V+=" mini-calendar-view__day--today"),G&&(V+=" mini-calendar-view__day--selected");let k=S.createDiv({cls:V,text:F.toString(),attr:{role:"gridcell",tabindex:G?"0":"-1","aria-label":C(A,"EEEE, MMMM d, yyyy")+(L?" (Today)":""),"aria-selected":G?"true":"false","aria-current":L?"date":null}});k.addEventListener("click",()=>{this.plugin.setSelectedDate(A)}),k.addEventListener("mouseover",D=>{this.showDayPreview(D,A,k)}),k.addEventListener("keydown",D=>{(D.key==="Enter"||D.key===" ")&&(D.preventDefault(),this.plugin.setSelectedDate(A))}),this.addDropHandlers(k,A)}for(let F=1;F<=w;F++){(F+m+y-1)%7===0&&F>1&&(S=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}}));let A=new Date(Date.UTC(a,n+1,F)),L=yl(A,i),G=S.createDiv({cls:`mini-calendar-view__day mini-calendar-view__day--outside-month${L?" mini-calendar-view__day--selected":""}`,text:F.toString(),attr:{role:"gridcell",tabindex:L?"0":"-1","aria-label":C(A,"EEEE, MMMM d, yyyy"),"aria-selected":L?"true":"false"}});G.addEventListener("click",()=>{this.plugin.setSelectedDate(A)}),G.addEventListener("mouseover",V=>{this.showDayPreview(V,A,G)}),G.addEventListener("keydown",V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),this.plugin.setSelectedDate(A))}),this.addDropHandlers(G,A)}}clearCalendarColorization(){this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(r=>{r.querySelectorAll(".note-indicator, .task-indicator, .daily-note-indicator").forEach(i=>i.remove()),r.classList.remove("mini-calendar-view__day--has-notes-few","mini-calendar-view__day--has-notes-some","mini-calendar-view__day--has-notes-many","mini-calendar-view__day--has-tasks","mini-calendar-view__day--has-completed-tasks","mini-calendar-view__day--has-archived-tasks","mini-calendar-view__day--has-scheduled-tasks","mini-calendar-view__day--has-daily-note")})}async colorizeCalendarForNotes(){return as.measure("calendar-colorize-notes",async()=>{this.clearCalendarColorization();let e=this.plugin.selectedDate.getFullYear(),r=this.plugin.selectedDate.getMonth(),i;try{i=await this.plugin.cacheManager.getCalendarData(e,r)}catch(o){console.warn("Failed to get calendar data from unified cache manager:",o),i=await this.plugin.cacheManager.getCalendarData(e,r)}let n=i.notes;this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(o=>{let l=o.innerText.trim();if(l){let c=this.plugin.selectedDate.getUTCFullYear(),d=this.plugin.selectedDate.getUTCMonth(),u=parseInt(l);if(isNaN(u))return;let h=d;o.classList.contains("mini-calendar-view__day--outside-month")&&(u>15?h=d===0?11:d-1:h=d===11?0:d+1);let p=al(c,h,u),f=ae(p),m=n.get(f)||0;if(m>0){let g=document.createElement("div");g.className="note-indicator";let y="";m>=5?(y="many-notes",o.classList.add("mini-calendar-view__day--has-notes-many")):m>=2?(y="some-notes",o.classList.add("mini-calendar-view__day--has-notes-some")):(y="few-notes",o.classList.add("mini-calendar-view__day--has-notes-few")),g.classList.add(y),g.setAttribute("aria-label",`${m} note${m>1?"s":""}`),(0,mr.setTooltip)(g,`${m} note${m>1?"s":""}`,{placement:"top"}),o.appendChild(g)}}})})}async colorizeCalendarForTasks(){this.clearCalendarColorization();let e=this.plugin.selectedDate.getUTCFullYear(),r=this.plugin.selectedDate.getUTCMonth(),n=(await this.plugin.cacheManager.getCalendarData(e,r)).tasks;this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(o=>{let l=o.innerText.trim();if(l){let c=this.plugin.selectedDate.getUTCFullYear(),d=this.plugin.selectedDate.getUTCMonth(),u=parseInt(l);if(isNaN(u))return;let h=`${c}-${d}-${u}-${o.classList.contains("mini-calendar-view__day--outside-month")}`,p=this.monthCalculationCache.get(h);if(!p){let g=d;o.classList.contains("mini-calendar-view__day--outside-month")&&(u>15?g=d===0?11:d-1:g=d===11?0:d+1);let y=al(c,g,u),w=ae(y);p={actualMonth:g,dateObj:y,dateKey:w},this.monthCalculationCache.set(h,p)}let{dateKey:f}=p,m=n.get(f);if(m&&(m.hasDue||m.hasScheduled)){let g=document.createElement("div");g.className="task-indicator";let y="";m.hasArchived?(o.classList.add("mini-calendar-view__day--has-archived-tasks"),g.classList.add("archived-tasks"),y="Archived"):m.hasCompleted?(o.classList.add("mini-calendar-view__day--has-completed-tasks"),g.classList.add("completed-tasks"),y="Completed"):m.hasDue?(o.classList.add("mini-calendar-view__day--has-tasks"),g.classList.add("due-tasks"),y="Due"):m.hasScheduled&&(o.classList.add("mini-calendar-view__day--has-scheduled-tasks"),g.classList.add("scheduled-tasks"),y="Scheduled"),g.setAttribute("aria-label",`${y} tasks (${m.count})`),(0,mr.setTooltip)(g,`${y} tasks (${m.count})`,{placement:"top"}),o.appendChild(g)}}})}async colorizeCalendarForDailyNotes(){this.clearCalendarColorization();let e=this.plugin.selectedDate.getUTCFullYear(),r=this.plugin.selectedDate.getUTCMonth(),i;qa.dailyNotesInitialized?i=(await this.plugin.cacheManager.getCalendarData(e,r)).dailyNotes:(await this.plugin.cacheManager.rebuildDailyNotesCache(e,r),qa.dailyNotesInitialized=!0,i=(await this.plugin.cacheManager.getCalendarData(e,r)).dailyNotes),this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(a=>{let o=a.innerText.trim();if(o){let l=this.plugin.selectedDate.getUTCFullYear(),c=this.plugin.selectedDate.getUTCMonth(),d=parseInt(o);if(isNaN(d))return;let u=`${l}-${c}-${d}-${a.classList.contains("mini-calendar-view__day--outside-month")}`,h=this.monthCalculationCache.get(u);if(!h){let f=c;a.classList.contains("mini-calendar-view__day--outside-month")&&(d>15?f=c===0?11:c-1:f=c===11?0:c+1);let m=al(l,f,d),g=ae(m);h={actualMonth:f,dateObj:m,dateKey:g},this.monthCalculationCache.set(u,h)}let p=h.dateKey;if(i.has(p)){let f=document.createElement("div");f.className="daily-note-indicator",a.classList.add("mini-calendar-view__day--has-daily-note"),f.setAttribute("aria-label","Daily note exists"),(0,mr.setTooltip)(f,"Daily note exists",{placement:"top"}),a.appendChild(f)}}})}handleTaskUpdate(e,r){if(this.colorizeMode!=="tasks")return;let i=new Set;e!=null&&e.due&&i.add(ue(e.due)),r.due&&i.add(ue(r.due)),e!=null&&e.scheduled&&i.add(ue(e.scheduled)),r.scheduled&&i.add(ue(r.scheduled)),i.size!==0&&this.updateCalendarCellsForDates(Array.from(i))}async updateCalendarCellsForDates(e){if(e.length===0)return;let r=this.plugin.selectedDate.getUTCFullYear(),i=this.plugin.selectedDate.getUTCMonth(),a=(await this.plugin.cacheManager.getCalendarData(r,i)).tasks,o=`${r}-${i}`;(this.currentCacheKey!==o||!this.calendarDayElements)&&(this.calendarDayElements=this.contentEl.querySelectorAll(".mini-calendar-view__day"),this.currentCacheKey=o,this.buildElementToDateMap(r,i));let l=new Set(e),c=[];for(let[d,u]of this.elementToDateMap)l.has(u.dateKey)&&c.push({element:d,dateKey:u.dateKey});requestAnimationFrame(()=>{c.forEach(({element:d,dateKey:u})=>{this.updateSingleCalendarCell(d,u,a)})})}updateSingleCalendarCell(e,r,i){e.querySelectorAll(".task-indicator").forEach(a=>a.remove()),e.classList.remove("has-tasks","has-scheduled-tasks","has-completed-tasks","has-archived-tasks");let n=i.get(r);if(n&&(n.hasDue||n.hasScheduled)){let a=document.createElement("div");a.className="task-indicator";let o="";n.hasArchived?(e.classList.add("has-archived-tasks"),a.classList.add("archived-tasks"),o="Archived"):n.hasCompleted?(e.classList.add("has-completed-tasks"),a.classList.add("completed-tasks"),o="Completed"):n.hasDue?(e.classList.add("has-tasks"),a.classList.add("due-tasks"),o="Due"):n.hasScheduled&&(e.classList.add("has-scheduled-tasks"),a.classList.add("scheduled-tasks"),o="Scheduled"),a.setAttribute("aria-label",`${o} tasks (${n.count})`),(0,mr.setTooltip)(a,`${o} tasks (${n.count})`,{placement:"top"}),e.appendChild(a)}}getCellDate(e,r,i,n){let a=n;e.classList.contains("outside-month")&&(r>15?a=n===0?11:n-1:a=n===11?0:n+1);try{return al(i,a,r)}catch(o){return console.error("Error creating date:",o),null}}buildElementToDateMap(e,r){this.elementToDateMap.clear(),this.calendarDayElements&&this.calendarDayElements.forEach(i=>{let n=i,a=n.innerText.trim();if(!a||isNaN(parseInt(a)))return;let o=parseInt(a),l=this.getCellDate(n,o,e,r);if(l){let c=ae(l);this.elementToDateMap.set(i,{date:o,dateKey:c})}})}clearMonthCalculationCache(){let e=`${this.plugin.selectedDate.getUTCFullYear()}-${this.plugin.selectedDate.getUTCMonth()}`;for(let[r]of this.monthCalculationCache)r.startsWith(e)||this.monthCalculationCache.delete(r)}initializeDebouncedRefresh(){this.debouncedRefresh||(this.debouncedRefresh=(0,mr.debounce)(()=>{this.refresh()},150))}getViewStartDate(){return of(this.plugin.selectedDate.getUTCFullYear(),this.plugin.selectedDate.getUTCMonth(),1)}getViewEndDate(){return of(this.plugin.selectedDate.getUTCFullYear(),this.plugin.selectedDate.getUTCMonth()+1,0)}showDayPreview(e,r,i){let n=this.getDailyNotePath(r);if(!n)return;let a=this.app.vault.getAbstractFileByPath(n);a&&a instanceof mr.TFile&&this.app.workspace.trigger("hover-link",{event:e,source:"tasknotes-calendar",hoverParent:this,targetEl:i,linktext:n,sourcePath:n})}getDailyNotePath(e){try{let r=window.moment(e),i=(0,Xd.getAllDailyNotes)(),n=(0,Xd.getDailyNote)(r,i);return n?n.path:null}catch(r){return null}}addDropHandlers(e,r){e.addEventListener("dragover",i=>{i.preventDefault(),i.dataTransfer.dropEffect="move",e.classList.add("mini-calendar-view__day--dragover")}),e.addEventListener("dragleave",i=>{e.contains(i.relatedTarget)||e.classList.remove("mini-calendar-view__day--dragover")}),e.addEventListener("drop",async i=>{var n,a;i.preventDefault(),i.stopPropagation(),e.classList.remove("mini-calendar-view__day--dragover");try{let o=((n=i.dataTransfer)==null?void 0:n.getData("text/plain"))||((a=i.dataTransfer)==null?void 0:a.getData("application/x-task-path"));if(!o){console.warn("No task path found in drop data");return}let l=await this.plugin.cacheManager.getTaskInfo(o);if(!l){console.warn("Task not found:",o);return}let c=ae(r);await this.plugin.taskService.updateProperty(l,"due",c),new mr.Notice(`Task "${l.title}" due date set to ${C(r,"MMM d, yyyy")}`),this.refresh()}catch(o){console.error("Error handling task drop on mini calendar:",o),new mr.Notice("Failed to update task due date")}})}};qa.dailyNotesInitialized=!1;var Jd=qa;var Me=require("obsidian");ru();var Bt=require("obsidian");ru();Bf();Uf();tu();var Ka=class{constructor(t){this.menu=new Bt.Menu,this.options=t,this.buildMenu()}buildMenu(){let{icsEvent:t,plugin:e,subscriptionName:r}=this.options;this.menu.addItem(i=>i.setTitle("Show details").setIcon("info").onClick(()=>{new Bn(e.app,e,t,r).open()})),this.menu.addSeparator(),this.menu.addItem(i=>i.setTitle("Create task from event").setIcon("check-circle").onClick(async()=>{await this.createTaskFromEvent()})),this.menu.addItem(i=>i.setTitle("Create note from event").setIcon("file-plus").onClick(()=>{this.createNoteFromEvent()})),this.menu.addItem(i=>i.setTitle("Link existing note").setIcon("link").onClick(()=>{this.linkExistingNote()})),this.menu.addSeparator(),this.menu.addItem(i=>i.setTitle("Copy title").setIcon("copy").onClick(async()=>{try{await navigator.clipboard.writeText(t.title),new Bt.Notice("Event title copied to clipboard")}catch(n){new Bt.Notice("Failed to copy to clipboard")}})),t.location&&this.menu.addItem(i=>i.setTitle("Copy location").setIcon("map-pin").onClick(async()=>{try{await navigator.clipboard.writeText(t.location),new Bt.Notice("Location copied to clipboard")}catch(n){new Bt.Notice("Failed to copy to clipboard")}})),t.url&&this.menu.addItem(i=>i.setTitle("Copy URL").setIcon("external-link").onClick(async()=>{try{await navigator.clipboard.writeText(t.url),new Bt.Notice("Event URL copied to clipboard")}catch(n){new Bt.Notice("Failed to copy to clipboard")}})),this.menu.addItem(i=>i.setTitle("Copy as markdown").setIcon("file-text").onClick(async()=>{let n=this.formatEventAsMarkdown();try{await navigator.clipboard.writeText(n),new Bt.Notice("Event details copied as markdown")}catch(a){new Bt.Notice("Failed to copy to clipboard")}}))}async createTaskFromEvent(){await gr.execute(async()=>{let t=await this.options.plugin.icsNoteService.createTaskFromICS(this.options.icsEvent);new Bt.Notice(`Task created: ${t.taskInfo.title}`);let e=this.options.plugin.app.vault.getAbstractFileByPath(t.file.path);e instanceof Bt.TFile&&await this.options.plugin.app.workspace.getLeaf().openFile(e),this.options.onUpdate&&this.options.onUpdate()},{errorMessage:"Failed to create task from event"})}createNoteFromEvent(){try{new Ga(this.options.plugin.app,this.options.plugin,{icsEvent:this.options.icsEvent,subscriptionName:this.options.subscriptionName||"Unknown Calendar",onContentCreated:async e=>{new Bt.Notice("Note created successfully"),await this.options.plugin.app.workspace.getLeaf().openFile(e),this.options.onUpdate&&this.options.onUpdate()}}).open()}catch(t){console.error("Error opening creation modal:",t),new Bt.Notice("Failed to open creation modal")}}async linkExistingNote(){await gr.execute(async()=>{new Qa(this.options.plugin.app,this.options.plugin,async e=>{await gr.execute(async()=>{await this.options.plugin.icsNoteService.linkNoteToICS(e.path,this.options.icsEvent),new Bt.Notice(`Linked note "${e.name}" to event`),this.options.onUpdate&&this.options.onUpdate()},{errorMessage:"Failed to link note"})}).open()},{errorMessage:"Failed to open note selection"})}formatEventAsMarkdown(){let{icsEvent:t,subscriptionName:e}=this.options,r=[];r.push(`## ${t.title||"Untitled Event"}`),r.push(""),e&&r.push(`**Calendar:** ${e}`);let i=new Date(t.start),n=i.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(!t.allDay&&(n+=` at ${i.toLocaleTimeString()}`,t.end)){let a=new Date(t.end);n+=` - ${a.toLocaleTimeString()}`}return r.push(`**Date & Time:** ${n}`),t.location&&r.push(`**Location:** ${t.location}`),t.description&&(r.push(""),r.push("### Description"),r.push(t.description)),t.url&&(r.push(""),r.push(`**URL:** ${t.url}`)),r.join(`
`)}show(t){this.menu.showAtMouseEvent(t)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4})}};Wf();var $e=require("obsidian");var Vs=require("obsidian"),Xa=class extends Vs.FuzzySuggestModal{constructor(t,e,r){super(t),this.plugin=e,this.onChoose=r,this.setPlaceholder("Type to search for files and notes..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles()}getItemText(t){let e=`${t.name} ${t.path}`;if(t instanceof Vs.TFile){let r=this.app.metadataCache.getFileCache(t);if(r!=null&&r.frontmatter){let i=(0,Vs.parseFrontMatterAliases)(r.frontmatter);i&&i.length>0&&(e+=` ${i.join(" ")}`)}}return e}renderSuggestion(t,e){let r=t.item;e.empty();let i=e.createDiv({cls:"attachment-suggestion"}),n=i.createSpan({cls:"attachment-name"});if(n.textContent=r.name,r instanceof Vs.TFile){let a=this.app.metadataCache.getFileCache(r);if(a!=null&&a.frontmatter){let o=this.plugin.fieldMapper.toUserField("title"),l=a.frontmatter[o];if(l){let c=i.createDiv({cls:"attachment-title"});c.textContent=l}else{let c=(0,Vs.parseFrontMatterAliases)(a.frontmatter);if(c&&c.length>0){let d=i.createDiv({cls:"attachment-aliases"});d.textContent=c.join(", ")}}}}if(r.path!==r.name){let a=i.createDiv({cls:"attachment-path"});a.textContent=r.path}}onChooseItem(t,e){this.onChoose(t)}};var ds=bt(Vr()),nu=class extends $e.Modal{constructor(e,r,i,n){super(e);this.selectedAttachments=[];this.plugin=r,this.timeblock={...i},this.originalTimeblock=i,this.eventDate=n}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("timeblock-info-modal"),new $e.Setting(e).setName("Edit Timeblock").setHeading();let r=e.createDiv({cls:"timeblock-date-display"});r.createEl("strong",{text:"Date & Time: "});let i=`${this.eventDate.toLocaleDateString()} from ${this.timeblock.startTime} to ${this.timeblock.endTime}`;r.createSpan({text:i}),new $e.Setting(e).setName("Title").setDesc("Title for your timeblock").addText(d=>{this.titleInput=d.inputEl,d.setPlaceholder("e.g., Deep work session").setValue(this.timeblock.title||"").onChange(()=>this.validateForm())}),new $e.Setting(e).setName("Description").setDesc("Optional description for the timeblock").addTextArea(d=>{this.descriptionInput=d.inputEl,d.setPlaceholder("Focus on new features, no interruptions").setValue(this.timeblock.description||""),this.descriptionInput.rows=3}),new $e.Setting(e).setName("Color").setDesc("Optional color for the timeblock").addText(d=>{this.colorInput=d.inputEl,d.setPlaceholder("#3b82f6").setValue(this.timeblock.color||"#6366f1"),this.colorInput.type="color"}),new $e.Setting(e).setName("Attachments").setDesc("Files or notes linked to this timeblock").addButton(d=>{d.setButtonText("Add Attachment").setTooltip("Select a file or note using fuzzy search").onClick(()=>{new Xa(this.app,this.plugin,h=>{this.addAttachment(h)}).open()})}),this.attachmentsList=e.createDiv({cls:"timeblock-attachments-list"}),await this.initializeAttachments(),this.renderAttachmentsList();let n=e.createDiv({cls:"timeblock-modal-buttons"});n.style.display="flex",n.style.justifyContent="space-between",n.style.alignItems="center",n.style.marginTop="20px",n.createEl("button",{text:"Delete Timeblock",cls:"mod-warning timeblock-delete-button"}).addEventListener("click",()=>this.handleDelete());let o=n.createDiv({cls:"timeblock-modal-buttons-right"});o.style.display="flex",o.style.gap="8px",o.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),o.createEl("button",{text:"Save Changes",cls:"mod-cta timeblock-save-button"}).addEventListener("click",()=>this.handleSave()),this.validateForm(),window.setTimeout(()=>this.titleInput.focus(),50)}validateForm(){var n;let e=this.contentEl.querySelector(".timeblock-save-button");if(!e)return;let i=!!((n=this.titleInput)==null?void 0:n.value.trim());e.disabled=!i,e.style.opacity=i?"1":"0.5"}async initializeAttachments(){if(this.timeblock.attachments)for(let e of this.timeblock.attachments){let r=e.replace(/^\[\[|\]\]$/g,""),i=this.app.vault.getAbstractFileByPath(r);i&&this.selectedAttachments.push(i)}}addAttachment(e){if(this.selectedAttachments.some(r=>r.path===e.path)){new $e.Notice(`"${e.name}" is already attached`);return}this.selectedAttachments.push(e),this.renderAttachmentsList(),new $e.Notice(`Added "${e.name}" as attachment`)}removeAttachment(e){this.selectedAttachments=this.selectedAttachments.filter(r=>r.path!==e.path),this.renderAttachmentsList(),new $e.Notice(`Removed "${e.name}" from attachments`)}openAttachment(e){e instanceof $e.TFile?this.app.workspace.getLeaf(!1).openFile(e):new $e.Notice(`Cannot open "${e.name}" - file type not supported`)}renderAttachmentsList(){if(this.attachmentsList.empty(),this.selectedAttachments.length===0){let e=this.attachmentsList.createDiv({cls:"timeblock-attachments-empty"});e.textContent="No attachments";return}this.selectedAttachments.forEach(e=>{let r=this.attachmentsList.createDiv({cls:"timeblock-attachment-item"}),i=r.createDiv({cls:"timeblock-attachment-info"});i.style.cursor="pointer",(0,$e.setTooltip)(i,"Click to open",{placement:"top"}),i.addEventListener("click",()=>this.openAttachment(e));let n=i.createSpan({cls:"timeblock-attachment-name"});if(n.textContent=e.name,e.path!==e.name){let o=i.createDiv({cls:"timeblock-attachment-path"});o.textContent=e.path}let a=r.createEl("button",{cls:"timeblock-attachment-remove",text:"\xD7"});(0,$e.setTooltip)(a,"Remove attachment",{placement:"top"}),a.addEventListener("click",o=>{o.stopPropagation(),this.removeAttachment(e)})})}async handleSave(){try{let e=this.titleInput.value.trim();if(!e){new $e.Notice("Please enter a title for the timeblock");return}this.timeblock.title=e,this.timeblock.description=this.descriptionInput.value.trim()||void 0,this.timeblock.color=this.colorInput.value||void 0;let r=this.selectedAttachments.map(i=>`[[${i.path}]]`);this.timeblock.attachments=r.length>0?r:void 0,await this.updateTimeblockInDailyNote(),this.plugin.emitter.trigger("data-changed"),new $e.Notice(`Timeblock "${e}" updated successfully`),this.close()}catch(e){console.error("Error updating timeblock:",e),new $e.Notice("Failed to update timeblock. Check console for details.")}}async updateTimeblockInDailyNote(){if(!(0,ds.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let e=this.eventDate.toISOString().split("T")[0],r=window.moment(e),i=(0,ds.getAllDailyNotes)(),n=(0,ds.getDailyNote)(r,i);if(!n)throw new Error("Daily note not found");let a=await this.app.vault.read(n),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let h=a.substring(3,u);l=a.substring(u+3);try{o=(0,$e.parseYaml)(h)||{}}catch(p){console.error("Error parsing existing frontmatter:",p),o={}}}}if(o.timeblocks&&Array.isArray(o.timeblocks)){let u=o.timeblocks.findIndex(h=>h.id===this.originalTimeblock.id||h.title===this.originalTimeblock.title&&h.startTime===this.originalTimeblock.startTime&&h.endTime===this.originalTimeblock.endTime);if(u>=0)o.timeblocks[u]=this.timeblock;else throw new Error("Timeblock not found in daily note")}else throw new Error("No timeblocks found in daily note");let d=`---
${(0,$e.stringifyYaml)(o)}---${l}`;await this.app.vault.modify(n,d)}async handleDelete(){if(await this.showDeleteConfirmation())try{await this.deleteTimeblockFromDailyNote(),this.plugin.emitter.trigger("data-changed"),new $e.Notice(`Timeblock "${this.timeblock.title}" deleted successfully`),this.close()}catch(r){console.error("Error deleting timeblock:",r),new $e.Notice("Failed to delete timeblock. Check console for details.")}}async showDeleteConfirmation(){return new Promise(e=>{let r=new $e.Modal(this.app);r.titleEl.setText("Delete Timeblock");let i=r.contentEl;i.createEl("p",{text:`Are you sure you want to delete the timeblock "${this.timeblock.title}"?`}),i.createEl("p",{text:"This action cannot be undone.",cls:"mod-warning"});let n=i.createDiv({cls:"modal-button-container"});n.style.display="flex",n.style.justifyContent="flex-end",n.style.gap="8px",n.style.marginTop="20px";let a=n.createEl("button",{text:"Cancel"});a.addEventListener("click",()=>{r.close(),e(!1)}),n.createEl("button",{text:"Delete",cls:"mod-warning"}).addEventListener("click",()=>{r.close(),e(!0)}),r.open(),setTimeout(()=>a.focus(),50)})}async deleteTimeblockFromDailyNote(){if(!(0,ds.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let e=this.eventDate.toISOString().split("T")[0],r=window.moment(e),i=(0,ds.getAllDailyNotes)(),n=(0,ds.getDailyNote)(r,i);if(!n)throw new Error("Daily note not found");let a=await this.app.vault.read(n),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let h=a.substring(3,u);l=a.substring(u+3);try{o=(0,$e.parseYaml)(h)||{}}catch(p){console.error("Error parsing existing frontmatter:",p),o={}}}}if(o.timeblocks&&Array.isArray(o.timeblocks)){let u=o.timeblocks.findIndex(h=>h.id===this.originalTimeblock.id||h.title===this.originalTimeblock.title&&h.startTime===this.originalTimeblock.startTime&&h.endTime===this.originalTimeblock.endTime);if(u>=0)o.timeblocks.splice(u,1),o.timeblocks.length===0&&delete o.timeblocks;else throw new Error("Timeblock not found in daily note")}else throw new Error("No timeblocks found in daily note");let c=Object.keys(o).length>0?(0,$e.stringifyYaml)(o):"",d=c?`---
${c}---${l}`:l.trim();await this.app.vault.modify(n,d)}onClose(){let{contentEl:e}=this;e.empty()}};ot();var du,oe,GE,jf,eo,$n,YE,QE,KE,ou={},ZE=[],KI=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function Ws(s,t){for(var e in t)s[e]=t[e];return s}function JE(s){var t=s.parentNode;t&&t.removeChild(s)}function b(s,t,e){var r,i,n,a={};for(n in t)n=="key"?r=t[n]:n=="ref"?i=t[n]:a[n]=t[n];if(arguments.length>2&&(a.children=arguments.length>3?du.call(arguments,2):e),typeof s=="function"&&s.defaultProps!=null)for(n in s.defaultProps)a[n]===void 0&&(a[n]=s.defaultProps[n]);return au(s,a,r,i,null)}function au(s,t,e,r,i){var n={type:s,props:t,key:e,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i==null?++GE:i};return i==null&&oe.vnode!=null&&oe.vnode(n),n}function tt(){return{current:null}}function Ne(s){return s.children}function ZI(s,t,e,r,i){var n;for(n in e)n==="children"||n==="key"||n in t||lu(s,n,null,e[n],r);for(n in t)i&&typeof t[n]!="function"||n==="children"||n==="key"||n==="value"||n==="checked"||e[n]===t[n]||lu(s,n,t[n],e[n],r)}function jE(s,t,e){t[0]==="-"?s.setProperty(t,e==null?"":e):s[t]=e==null?"":typeof e!="number"||KI.test(t)?e:e+"px"}function lu(s,t,e,r,i){var n;e:if(t==="style")if(typeof e=="string")s.style.cssText=e;else{if(typeof r=="string"&&(s.style.cssText=r=""),r)for(t in r)e&&t in e||jE(s.style,t,"");if(e)for(t in e)r&&e[t]===r[t]||jE(s.style,t,e[t])}else if(t[0]==="o"&&t[1]==="n")n=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in s?t.toLowerCase().slice(2):t.slice(2),s.l||(s.l={}),s.l[t+n]=e,e?r||s.addEventListener(t,n?qE:zE,n):s.removeEventListener(t,n?qE:zE,n);else if(t!=="dangerouslySetInnerHTML"){if(i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!=="width"&&t!=="height"&&t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t in s)try{s[t]=e==null?"":e;break e}catch(a){}typeof e=="function"||(e==null||e===!1&&t.indexOf("-")==-1?s.removeAttribute(t):s.setAttribute(t,e))}}function zE(s){eo=!0;try{return this.l[s.type+!1](oe.event?oe.event(s):s)}finally{eo=!1}}function qE(s){eo=!0;try{return this.l[s.type+!0](oe.event?oe.event(s):s)}finally{eo=!1}}function Ut(s,t){this.props=s,this.context=t}function Dl(s,t){if(t==null)return s.__?Dl(s.__,s.__.__k.indexOf(s)+1):null;for(var e;t<s.__k.length;t++)if((e=s.__k[t])!=null&&e.__e!=null)return e.__e;return typeof s.type=="function"?Dl(s):null}function XE(s){var t,e;if((s=s.__)!=null&&s.__c!=null){for(s.__e=s.__c.base=null,t=0;t<s.__k.length;t++)if((e=s.__k[t])!=null&&e.__e!=null){s.__e=s.__c.base=e.__e;break}return XE(s)}}function JI(s){eo?setTimeout(s):QE(s)}function Yf(s){(!s.__d&&(s.__d=!0)&&$n.push(s)&&!cu.__r++||YE!==oe.debounceRendering)&&((YE=oe.debounceRendering)||JI)(cu)}function cu(){var s,t,e,r,i,n,a,o;for($n.sort(function(l,c){return l.__v.__b-c.__v.__b});s=$n.shift();)s.__d&&(t=$n.length,r=void 0,i=void 0,a=(n=(e=s).__v).__e,(o=e.__P)&&(r=[],(i=Ws({},n)).__v=n.__v+1,zf(o,n,i,e.__n,o.ownerSVGElement!==void 0,n.__h!=null?[a]:null,r,a==null?Dl(n):a,n.__h),sD(r,n),n.__e!=a&&XE(n)),$n.length>t&&$n.sort(function(l,c){return l.__v.__b-c.__v.__b}));cu.__r=0}function eD(s,t,e,r,i,n,a,o,l,c){var d,u,h,p,f,m,g,y=r&&r.__k||ZE,w=y.length;for(e.__k=[],d=0;d<t.length;d++)if((p=e.__k[d]=(p=t[d])==null||typeof p=="boolean"?null:typeof p=="string"||typeof p=="number"||typeof p=="bigint"?au(null,p,null,null,p):Array.isArray(p)?au(Ne,{children:p},null,null,null):p.__b>0?au(p.type,p.props,p.key,p.ref?p.ref:null,p.__v):p)!=null){if(p.__=e,p.__b=e.__b+1,(h=y[d])===null||h&&p.key==h.key&&p.type===h.type)y[d]=void 0;else for(u=0;u<w;u++){if((h=y[u])&&p.key==h.key&&p.type===h.type){y[u]=void 0;break}h=null}zf(s,p,h=h||ou,i,n,a,o,l,c),f=p.__e,(u=p.ref)&&h.ref!=u&&(g||(g=[]),h.ref&&g.push(h.ref,null,p),g.push(u,p.__c||f,p)),f!=null?(m==null&&(m=f),typeof p.type=="function"&&p.__k===h.__k?p.__d=l=tD(p,l,s):l=rD(s,p,h,y,f,l),typeof e.type=="function"&&(e.__d=l)):l&&h.__e==l&&l.parentNode!=s&&(l=Dl(h))}for(e.__e=m,d=w;d--;)y[d]!=null&&(typeof e.type=="function"&&y[d].__e!=null&&y[d].__e==e.__d&&(e.__d=iD(r).nextSibling),aD(y[d],y[d]));if(g)for(d=0;d<g.length;d++)nD(g[d],g[++d],g[++d])}function tD(s,t,e){for(var r,i=s.__k,n=0;i&&n<i.length;n++)(r=i[n])&&(r.__=s,t=typeof r.type=="function"?tD(r,t,e):rD(e,r,r,i,r.__e,t));return t}function Cl(s,t){return t=t||[],s==null||typeof s=="boolean"||(Array.isArray(s)?s.some(function(e){Cl(e,t)}):t.push(s)),t}function rD(s,t,e,r,i,n){var a,o,l;if(t.__d!==void 0)a=t.__d,t.__d=void 0;else if(e==null||i!=n||i.parentNode==null)e:if(n==null||n.parentNode!==s)s.appendChild(i),a=null;else{for(o=n,l=0;(o=o.nextSibling)&&l<r.length;l+=1)if(o==i)break e;s.insertBefore(i,n),a=n}return a!==void 0?a:i.nextSibling}function iD(s){var t,e,r;if(s.type==null||typeof s.type=="string")return s.__e;if(s.__k){for(t=s.__k.length-1;t>=0;t--)if((e=s.__k[t])&&(r=iD(e)))return r}return null}function zf(s,t,e,r,i,n,a,o,l){var c,d,u,h,p,f,m,g,y,w,T,S,x,I,F,A=t.type;if(t.constructor!==void 0)return null;e.__h!=null&&(l=e.__h,o=t.__e=e.__e,t.__h=null,n=[o]),(c=oe.__b)&&c(t);try{e:if(typeof A=="function"){if(g=t.props,y=(c=A.contextType)&&r[c.__c],w=c?y?y.props.value:c.__:r,e.__c?m=(d=t.__c=e.__c).__=d.__E:("prototype"in A&&A.prototype.render?t.__c=d=new A(g,w):(t.__c=d=new Ut(g,w),d.constructor=A,d.render=eP),y&&y.sub(d),d.props=g,d.state||(d.state={}),d.context=w,d.__n=r,u=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),A.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=Ws({},d.__s)),Ws(d.__s,A.getDerivedStateFromProps(g,d.__s))),h=d.props,p=d.state,d.__v=t,u)A.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(A.getDerivedStateFromProps==null&&g!==h&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(g,w),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(g,d.__s,w)===!1||t.__v===e.__v){for(t.__v!==e.__v&&(d.props=g,d.state=d.__s,d.__d=!1),t.__e=e.__e,t.__k=e.__k,t.__k.forEach(function(L){L&&(L.__=t)}),T=0;T<d._sb.length;T++)d.__h.push(d._sb[T]);d._sb=[],d.__h.length&&a.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(g,d.__s,w),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(h,p,f)})}if(d.context=w,d.props=g,d.__P=s,S=oe.__r,x=0,"prototype"in A&&A.prototype.render){for(d.state=d.__s,d.__d=!1,S&&S(t),c=d.render(d.props,d.state,d.context),I=0;I<d._sb.length;I++)d.__h.push(d._sb[I]);d._sb=[]}else do d.__d=!1,S&&S(t),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++x<25);d.state=d.__s,d.getChildContext!=null&&(r=Ws(Ws({},r),d.getChildContext())),u||d.getSnapshotBeforeUpdate==null||(f=d.getSnapshotBeforeUpdate(h,p)),F=c!=null&&c.type===Ne&&c.key==null?c.props.children:c,eD(s,Array.isArray(F)?F:[F],t,e,r,i,n,a,o,l),d.base=t.__e,t.__h=null,d.__h.length&&a.push(d),m&&(d.__E=d.__=null),d.__e=!1}else n==null&&t.__v===e.__v?(t.__k=e.__k,t.__e=e.__e):t.__e=XI(e.__e,t,e,r,i,n,a,l);(c=oe.diffed)&&c(t)}catch(L){t.__v=null,(l||n!=null)&&(t.__e=o,t.__h=!!l,n[n.indexOf(o)]=null),oe.__e(L,t,e)}}function sD(s,t){oe.__c&&oe.__c(t,s),s.some(function(e){try{s=e.__h,e.__h=[],s.some(function(r){r.call(e)})}catch(r){oe.__e(r,e.__v)}})}function XI(s,t,e,r,i,n,a,o){var l,c,d,u=e.props,h=t.props,p=t.type,f=0;if(p==="svg"&&(i=!0),n!=null){for(;f<n.length;f++)if((l=n[f])&&"setAttribute"in l==!!p&&(p?l.localName===p:l.nodeType===3)){s=l,n[f]=null;break}}if(s==null){if(p===null)return document.createTextNode(h);s=i?document.createElementNS("http://www.w3.org/2000/svg",p):document.createElement(p,h.is&&h),n=null,o=!1}if(p===null)u===h||o&&s.data===h||(s.data=h);else{if(n=n&&du.call(s.childNodes),c=(u=e.props||ou).dangerouslySetInnerHTML,d=h.dangerouslySetInnerHTML,!o){if(n!=null)for(u={},f=0;f<s.attributes.length;f++)u[s.attributes[f].name]=s.attributes[f].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===s.innerHTML)||(s.innerHTML=d&&d.__html||""))}if(ZI(s,h,u,i,o),d)t.__k=[];else if(f=t.props.children,eD(s,Array.isArray(f)?f:[f],t,e,r,i&&p!=="foreignObject",n,a,n?n[0]:e.__k&&Dl(e,0),o),n!=null)for(f=n.length;f--;)n[f]!=null&&JE(n[f]);o||("value"in h&&(f=h.value)!==void 0&&(f!==s.value||p==="progress"&&!f||p==="option"&&f!==u.value)&&lu(s,"value",f,u.value,!1),"checked"in h&&(f=h.checked)!==void 0&&f!==s.checked&&lu(s,"checked",f,u.checked,!1))}return s}function nD(s,t,e){try{typeof s=="function"?s(t):s.current=t}catch(r){oe.__e(r,e)}}function aD(s,t,e){var r,i;if(oe.unmount&&oe.unmount(s),(r=s.ref)&&(r.current&&r.current!==s.__e||nD(r,null,t)),(r=s.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(n){oe.__e(n,t)}r.base=r.__P=null,s.__c=void 0}if(r=s.__k)for(i=0;i<r.length;i++)r[i]&&aD(r[i],t,e||typeof s.type!="function");e||s.__e==null||JE(s.__e),s.__=s.__e=s.__d=void 0}function eP(s,t,e){return this.constructor(s,e)}function Ys(s,t,e){var r,i,n;oe.__&&oe.__(s,t),i=(r=typeof e=="function")?null:e&&e.__k||t.__k,n=[],zf(t,s=(!r&&e||t).__k=b(Ne,null,[s]),i||ou,ou,t.ownerSVGElement!==void 0,!r&&e?[e]:i?null:t.firstChild?du.call(t.childNodes):null,n,!r&&e?e:i?i.__e:t.firstChild,r),sD(n,s)}function uu(s,t){var e={__c:t="__cC"+KE++,__:s,Consumer:function(r,i){return r.children(i)},Provider:function(r){var i,n;return this.getChildContext||(i=[],(n={})[t]=this,this.getChildContext=function(){return n},this.shouldComponentUpdate=function(a){this.props.value!==a.value&&i.some(function(o){o.__e=!0,Yf(o)})},this.sub=function(a){i.push(a);var o=a.componentWillUnmount;a.componentWillUnmount=function(){i.splice(i.indexOf(a),1),o&&o.call(a)}}),r.children}};return e.Provider.__=e.Consumer.contextType=e}du=ZE.slice,oe={__e:function(s,t,e,r){for(var i,n,a;t=t.__;)if((i=t.__c)&&!i.__)try{if((n=i.constructor)&&n.getDerivedStateFromError!=null&&(i.setState(n.getDerivedStateFromError(s)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(s,r||{}),a=i.__d),a)return i.__E=i}catch(o){s=o}throw s}},GE=0,jf=function(s){return s!=null&&s.constructor===void 0},eo=!1,Ut.prototype.setState=function(s,t){var e;e=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Ws({},this.state),typeof s=="function"&&(s=s(Ws({},e),this.props)),s&&Ws(e,s),s!=null&&this.__v&&(t&&this._sb.push(t),Yf(this))},Ut.prototype.forceUpdate=function(s){this.__v&&(this.__e=!0,s&&this.__h.push(s),Yf(this))},Ut.prototype.render=Ne,$n=[],QE=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,cu.__r=0,KE=0;var rP,Ni,qf,oD;var fD=[],Gf=[],lD=oe.__b,cD=oe.__r,dD=oe.diffed,uD=oe.__c,hD=oe.unmount;function iP(){for(var s;s=fD.shift();)if(s.__P&&s.__H)try{s.__H.__h.forEach(hu),s.__H.__h.forEach(Qf),s.__H.__h=[]}catch(t){s.__H.__h=[],oe.__e(t,s.__v)}}oe.__b=function(s){Ni=null,lD&&lD(s)},oe.__r=function(s){cD&&cD(s),rP=0;var t=(Ni=s.__c).__H;t&&(qf===Ni?(t.__h=[],Ni.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.__V=Gf,e.__N=e.i=void 0})):(t.__h.forEach(hu),t.__h.forEach(Qf),t.__h=[])),qf=Ni},oe.diffed=function(s){dD&&dD(s);var t=s.__c;t&&t.__H&&(t.__H.__h.length&&(fD.push(t)!==1&&oD===oe.requestAnimationFrame||((oD=oe.requestAnimationFrame)||sP)(iP)),t.__H.__.forEach(function(e){e.i&&(e.__H=e.i),e.__V!==Gf&&(e.__=e.__V),e.i=void 0,e.__V=Gf})),qf=Ni=null},oe.__c=function(s,t){t.some(function(e){try{e.__h.forEach(hu),e.__h=e.__h.filter(function(r){return!r.__||Qf(r)})}catch(r){t.some(function(i){i.__h&&(i.__h=[])}),t=[],oe.__e(r,e.__v)}}),uD&&uD(s,t)},oe.unmount=function(s){hD&&hD(s);var t,e=s.__c;e&&e.__H&&(e.__H.__.forEach(function(r){try{hu(r)}catch(i){t=i}}),e.__H=void 0,t&&oe.__e(t,e.__v))};var pD=typeof requestAnimationFrame=="function";function sP(s){var t,e=function(){clearTimeout(r),pD&&cancelAnimationFrame(t),setTimeout(s)},r=setTimeout(e,100);pD&&(t=requestAnimationFrame(e))}function hu(s){var t=Ni,e=s.__c;typeof e=="function"&&(s.__c=void 0,e()),Ni=t}function Qf(s){var t=Ni;s.__c=s.__(),Ni=t}function nP(s,t){for(var e in t)s[e]=t[e];return s}function mD(s,t){for(var e in s)if(e!=="__source"&&!(e in t))return!0;for(var r in t)if(r!=="__source"&&s[r]!==t[r])return!0;return!1}function gD(s){this.props=s}(gD.prototype=new Ut).isPureReactComponent=!0,gD.prototype.shouldComponentUpdate=function(s,t){return mD(this.props,s)||mD(this.state,t)};var yD=oe.__b;oe.__b=function(s){s.type&&s.type.__f&&s.ref&&(s.props.ref=s.ref,s.ref=null),yD&&yD(s)};var RQ=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var aP=oe.__e;oe.__e=function(s,t,e,r){if(s.then){for(var i,n=t;n=n.__;)if((i=n.__c)&&i.__c)return t.__e==null&&(t.__e=e.__e,t.__k=e.__k),i.__c(s,t)}aP(s,t,e,r)};var vD=oe.unmount;function ED(s,t,e){return s&&(s.__c&&s.__c.__H&&(s.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),s.__c.__H=null),(s=nP({},s)).__c!=null&&(s.__c.__P===e&&(s.__c.__P=t),s.__c=null),s.__k=s.__k&&s.__k.map(function(r){return ED(r,t,e)})),s}function DD(s,t,e){return s&&(s.__v=null,s.__k=s.__k&&s.__k.map(function(r){return DD(r,t,e)}),s.__c&&s.__c.__P===t&&(s.__e&&e.insertBefore(s.__e,s.__d),s.__c.__e=!0,s.__c.__P=e)),s}function Kf(){this.__u=0,this.t=null,this.__b=null}function CD(s){var t=s.__.__c;return t&&t.__a&&t.__a(s)}function pu(){this.u=null,this.o=null}oe.unmount=function(s){var t=s.__c;t&&t.__R&&t.__R(),t&&s.__h===!0&&(s.type=null),vD&&vD(s)},(Kf.prototype=new Ut).__c=function(s,t){var e=t.__c,r=this;r.t==null&&(r.t=[]),r.t.push(e);var i=CD(r.__v),n=!1,a=function(){n||(n=!0,e.__R=null,i?i(o):o())};e.__R=a;var o=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=DD(c,c.__c.__P,c.__c.__O)}var d;for(r.setState({__a:r.__b=null});d=r.t.pop();)d.forceUpdate()}},l=t.__h===!0;r.__u++||l||r.setState({__a:r.__b=r.__v.__k[0]}),s.then(a,a)},Kf.prototype.componentWillUnmount=function(){this.t=[]},Kf.prototype.render=function(s,t){if(this.__b){if(this.__v.__k){var e=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=ED(this.__b,e,r.__O=r.__P)}this.__b=null}var i=t.__a&&b(Ne,null,s.fallback);return i&&(i.__h=null),[b(Ne,null,t.__a?null:s.children),i]};var wD=function(s,t,e){if(++e[1]===e[0]&&s.o.delete(t),s.props.revealOrder&&(s.props.revealOrder[0]!=="t"||!s.o.size))for(e=s.u;e;){for(;e.length>3;)e.pop()();if(e[1]<e[0])break;s.u=e=e[2]}};function oP(s){return this.getChildContext=function(){return s.context},s.children}function lP(s){var t=this,e=s.i;t.componentWillUnmount=function(){Ys(null,t.l),t.l=null,t.i=null},t.i&&t.i!==e&&t.componentWillUnmount(),s.__v?(t.l||(t.i=e,t.l={nodeType:1,parentNode:e,childNodes:[],appendChild:function(r){this.childNodes.push(r),t.i.appendChild(r)},insertBefore:function(r,i){this.childNodes.push(r),t.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),t.i.removeChild(r)}}),Ys(b(oP,{context:t.context},s.__v),t.l)):t.l&&t.componentWillUnmount()}function xD(s,t){var e=b(lP,{__v:s,i:t});return e.containerInfo=t,e}(pu.prototype=new Ut).__a=function(s){var t=this,e=CD(t.__v),r=t.o.get(s);return r[0]++,function(i){var n=function(){t.props.revealOrder?(r.push(i),wD(t,s,r)):i()};e?e(n):n()}},pu.prototype.render=function(s){this.u=null,this.o=new Map;var t=Cl(s.children);s.revealOrder&&s.revealOrder[0]==="b"&&t.reverse();for(var e=t.length;e--;)this.o.set(t[e],this.u=[1,0,this.u]);return s.children},pu.prototype.componentDidUpdate=pu.prototype.componentDidMount=function(){var s=this;this.o.forEach(function(t,e){wD(s,e,t)})};var cP=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,dP=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,uP=typeof document!="undefined",hP=function(s){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(s)};Ut.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(s){Object.defineProperty(Ut.prototype,s,{configurable:!0,get:function(){return this["UNSAFE_"+s]},set:function(t){Object.defineProperty(this,s,{configurable:!0,writable:!0,value:t})}})});var TD=oe.event;function pP(){}function fP(){return this.cancelBubble}function mP(){return this.defaultPrevented}oe.event=function(s){return TD&&(s=TD(s)),s.persist=pP,s.isPropagationStopped=fP,s.isDefaultPrevented=mP,s.nativeEvent=s};var gP,bD={configurable:!0,get:function(){return this.class}},kD=oe.vnode;oe.vnode=function(s){var t=s.type,e=s.props,r=e;if(typeof t=="string"){var i=t.indexOf("-")===-1;for(var n in r={},e){var a=e[n];uP&&n==="children"&&t==="noscript"||n==="value"&&"defaultValue"in e&&a==null||(n==="defaultValue"&&"value"in e&&e.value==null?n="value":n==="download"&&a===!0?a="":/ondoubleclick/i.test(n)?n="ondblclick":/^onchange(textarea|input)/i.test(n+t)&&!hP(e.type)?n="oninput":/^onfocus$/i.test(n)?n="onfocusin":/^onblur$/i.test(n)?n="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(n)?n=n.toLowerCase():i&&dP.test(n)?n=n.replace(/[A-Z0-9]/g,"-$&").toLowerCase():a===null&&(a=void 0),/^oninput$/i.test(n)&&(n=n.toLowerCase(),r[n]&&(n="oninputCapture")),r[n]=a)}t=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=Cl(e.children).forEach(function(o){o.props.selected=r.value.indexOf(o.props.value)!=-1})),t=="select"&&r.defaultValue!=null&&(r.value=Cl(e.children).forEach(function(o){o.props.selected=r.multiple?r.defaultValue.indexOf(o.props.value)!=-1:r.defaultValue==o.props.value})),s.props=r,e.class!=e.className&&(bD.enumerable="className"in e,e.className!=null&&(r.class=e.className),Object.defineProperty(r,"className",bD))}s.$$typeof=cP,kD&&kD(s)};var SD=oe.__r;oe.__r=function(s){SD&&SD(s),gP=s.__c};var $D=[],om=new Map;function Js(s){$D.push(s),om.forEach(t=>{YD(t,s)})}function VD(s){s.isConnected&&s.getRootNode&&WD(s.getRootNode())}function WD(s){let t=om.get(s);if(!t||!t.isConnected){if(t=s.querySelector("style[data-fullcalendar]"),!t){t=document.createElement("style"),t.setAttribute("data-fullcalendar","");let e=vP();e&&(t.nonce=e);let r=s===document?document.head:s,i=s===document?r.querySelector("script,link[rel=stylesheet],link[as=style],style"):r.firstChild;r.insertBefore(t,i)}om.set(s,t),yP(t)}}function yP(s){for(let t of $D)YD(s,t)}function YD(s,t){let{sheet:e}=s,r=e.cssRules.length;t.split("}").forEach((i,n)=>{i=i.trim(),i&&e.insertRule(i+"}",r+n)})}var Zf;function vP(){return Zf===void 0&&(Zf=wP()),Zf}function wP(){let s=document.querySelector('meta[name="csp-nonce"]');if(s&&s.hasAttribute("content"))return s.getAttribute("content");let t=document.querySelector("script[nonce]");return t&&t.nonce||""}typeof document!="undefined"&&WD(document);var TP=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';Js(TP);var Yn=class{constructor(t){this.drainedOption=t,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(t){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),t==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),t))}pause(t=""){let{pauseDepths:e}=this;e[t]=(e[t]||0)+1,this.clearTimeout()}resume(t="",e){let{pauseDepths:r}=this;t in r&&(e?delete r[t]:(r[t]-=1,r[t]<=0&&delete r[t]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}};function Vl(s){s.parentNode&&s.parentNode.removeChild(s)}function Et(s,t){if(s.closest)return s.closest(t);if(!document.documentElement.contains(s))return null;do{if(Pu(s,t))return s;s=s.parentElement||s.parentNode}while(s!==null&&s.nodeType===1);return null}function Pu(s,t){return(s.matches||s.matchesSelector||s.msMatchesSelector).call(s,t)}function jD(s,t){let e=s instanceof HTMLElement?[s]:s,r=[];for(let i=0;i<e.length;i+=1){let n=e[i].querySelectorAll(t);for(let a=0;a<n.length;a+=1)r.push(n[a])}return r}var bP=/(top|left|right|bottom|width|height)$/i;function ra(s,t){for(let e in t)ym(s,e,t[e])}function ym(s,t,e){e==null?s.style[t]="":typeof e=="number"&&bP.test(t)?s.style[t]=`${e}px`:s.style[t]=e}function Nu(s){var t,e;return(e=(t=s.composedPath)===null||t===void 0?void 0:t.call(s)[0])!==null&&e!==void 0?e:s.target}var MD=0;function ms(){return MD+=1,"fc-dom-"+MD}function Wl(s){s.preventDefault()}function kP(s,t){return e=>{let r=Et(e.target,s);r&&t.call(r,e,r)}}function vm(s,t,e,r){let i=kP(e,r);return s.addEventListener(t,i),()=>{s.removeEventListener(t,i)}}function zD(s,t,e,r){let i;return vm(s,"mouseover",t,(n,a)=>{if(a!==i){i=a,e(n,a);let o=l=>{i=null,r(l,a),a.removeEventListener("mouseleave",o)};a.addEventListener("mouseleave",o)}})}var _D=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function wm(s,t){let e=r=>{t(r),_D.forEach(i=>{s.removeEventListener(i,e)})};_D.forEach(r=>{s.addEventListener(r,e)})}function qD(s){return Object.assign({onClick:s},GD(s))}function GD(s){return{tabIndex:0,onKeyDown(t){(t.key==="Enter"||t.key===" ")&&(s(t),t.preventDefault())}}}var AD=0;function gs(){return AD+=1,String(AD)}function so(){document.body.classList.add("fc-not-allowed")}function no(){document.body.classList.remove("fc-not-allowed")}function Tm(s){s.style.userSelect="none",s.style.webkitUserSelect="none",s.addEventListener("selectstart",Wl)}function bm(s){s.style.userSelect="",s.style.webkitUserSelect="",s.removeEventListener("selectstart",Wl)}function km(s){s.addEventListener("contextmenu",Wl)}function Sm(s){s.removeEventListener("contextmenu",Wl)}function QD(s){let t=[],e=[],r,i;for(typeof s=="string"?e=s.split(/\s*,\s*/):typeof s=="function"?e=[s]:Array.isArray(s)&&(e=s),r=0;r<e.length;r+=1)i=e[r],typeof i=="string"?t.push(i.charAt(0)==="-"?{field:i.substring(1),order:-1}:{field:i,order:1}):typeof i=="function"&&t.push({func:i});return t}function KD(s,t,e){let r,i;for(r=0;r<e.length;r+=1)if(i=SP(s,t,e[r]),i)return i;return 0}function SP(s,t,e){return e.func?e.func(s,t):ZD(s[e.field],t[e.field])*(e.order||1)}function ZD(s,t){return!s&&!t?0:t==null?-1:s==null?1:typeof s=="string"||typeof t=="string"?String(s).localeCompare(String(t)):s-t}function Wn(s,t){let e=String(s);return"000".substr(0,t-e.length)+e}function ao(s,t,e){return typeof s=="function"?s(...t):typeof s=="string"?t.reduce((r,i,n)=>r.replace("$"+n,i||""),s):e}function Em(s,t){return s-t}function xl(s){return s%1===0}function EP(s){let t=s.querySelector(".fc-scrollgrid-shrink-frame"),e=s.querySelector(".fc-scrollgrid-shrink-cushion");if(!t)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!e)throw new Error("needs fc-scrollgrid-shrink-cushion className");return s.getBoundingClientRect().width-t.getBoundingClientRect().width+e.getBoundingClientRect().width}var ID=["years","months","days","milliseconds"],DP=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function pe(s,t){return typeof s=="string"?CP(s):typeof s=="object"&&s?PD(s):typeof s=="number"?PD({[t||"milliseconds"]:s}):null}function CP(s){let t=DP.exec(s);if(t){let e=t[1]?-1:1;return{years:0,months:0,days:e*(t[2]?parseInt(t[2],10):0),milliseconds:e*((t[3]?parseInt(t[3],10):0)*60*60*1e3+(t[4]?parseInt(t[4],10):0)*60*1e3+(t[5]?parseInt(t[5],10):0)*1e3+(t[6]?parseInt(t[6],10):0))}}return null}function PD(s){let t={years:s.years||s.year||0,months:s.months||s.month||0,days:s.days||s.day||0,milliseconds:(s.hours||s.hour||0)*60*60*1e3+(s.minutes||s.minute||0)*60*1e3+(s.seconds||s.second||0)*1e3+(s.milliseconds||s.millisecond||s.ms||0)},e=s.weeks||s.week;return e&&(t.days+=e*7,t.specifiedWeeks=!0),t}function xP(s,t){return s.years===t.years&&s.months===t.months&&s.days===t.days&&s.milliseconds===t.milliseconds}function Yl(s,t){return{years:s.years+t.years,months:s.months+t.months,days:s.days+t.days,milliseconds:s.milliseconds+t.milliseconds}}function JD(s,t){return{years:s.years-t.years,months:s.months-t.months,days:s.days-t.days,milliseconds:s.milliseconds-t.milliseconds}}function Dm(s,t){return{years:s.years*t,months:s.months*t,days:s.days*t,milliseconds:s.milliseconds*t}}function MP(s){return to(s)/365}function _P(s){return to(s)/30}function to(s){return Nr(s)/864e5}function Nr(s){return s.years*(365*864e5)+s.months*(30*864e5)+s.days*864e5+s.milliseconds}function jl(s,t){let e=null;for(let r=0;r<ID.length;r+=1){let i=ID[r];if(t[i]){let n=s[i]/t[i];if(!xl(n)||e!==null&&e!==n)return null;e=n}else if(s[i])return null}return e}function Ml(s){let t=s.milliseconds;if(t){if(t%1e3!==0)return{unit:"millisecond",value:t};if(t%(1e3*60)!==0)return{unit:"second",value:t/1e3};if(t%(1e3*60*60)!==0)return{unit:"minute",value:t/(1e3*60)};if(t)return{unit:"hour",value:t/(1e3*60*60)}}return s.days?s.specifiedWeeks&&s.days%7===0?{unit:"week",value:s.days/7}:{unit:"day",value:s.days}:s.months?{unit:"month",value:s.months}:s.years?{unit:"year",value:s.years}:{unit:"millisecond",value:0}}function Li(s,t,e){if(s===t)return!0;let r=s.length,i;if(r!==t.length)return!1;for(i=0;i<r;i+=1)if(!(e?e(s[i],t[i]):s[i]===t[i]))return!1;return!0}var AP=["sun","mon","tue","wed","thu","fri","sat"];function Ru(s,t){let e=zs(s);return e[2]+=t*7,vr(e)}function pt(s,t){let e=zs(s);return e[2]+=t,vr(e)}function Ri(s,t){let e=zs(s);return e[6]+=t,vr(e)}function Cm(s,t){return ys(s,t)/7}function ys(s,t){return(t.valueOf()-s.valueOf())/(1e3*60*60*24)}function IP(s,t){return(t.valueOf()-s.valueOf())/(1e3*60*60)}function PP(s,t){return(t.valueOf()-s.valueOf())/(1e3*60)}function NP(s,t){return(t.valueOf()-s.valueOf())/1e3}function XD(s,t){let e=Ve(s),r=Ve(t);return{years:0,months:0,days:Math.round(ys(e,r)),milliseconds:t.valueOf()-r.valueOf()-(s.valueOf()-e.valueOf())}}function eC(s,t){let e=ro(s,t);return e!==null&&e%7===0?e/7:null}function ro(s,t){return qs(s)===qs(t)?Math.round(ys(s,t)):null}function Ve(s){return vr([s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()])}function RP(s){return vr([s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours()])}function OP(s){return vr([s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes()])}function FP(s){return vr([s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds()])}function LP(s,t,e){let r=s.getUTCFullYear(),i=Jf(s,r,t,e);if(i<1)return Jf(s,r-1,t,e);let n=Jf(s,r+1,t,e);return n>=1?Math.min(i,n):i}function Jf(s,t,e,r){let i=vr([t,0,1+HP(t,e,r)]),n=Ve(s),a=Math.round(ys(i,n));return Math.floor(a/7)+1}function HP(s,t,e){let r=7+t-e;return-((7+vr([s,0,r]).getUTCDay()-t)%7)+r-1}function ND(s){return[s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()]}function RD(s){return new Date(s[0],s[1]||0,s[2]==null?1:s[2],s[3]||0,s[4]||0,s[5]||0)}function zs(s){return[s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()]}function vr(s){return s.length===1&&(s=s.concat([0])),new Date(Date.UTC(...s))}function xm(s){return!isNaN(s.valueOf())}function qs(s){return s.getUTCHours()*1e3*60*60+s.getUTCMinutes()*1e3*60+s.getUTCSeconds()*1e3+s.getUTCMilliseconds()}function Ou(s,t,e=!1){let r=s.toISOString();return r=r.replace(".000",""),e&&(r=r.replace("T00:00:00Z","")),r.length>10&&(t==null?r=r.replace("Z",""):t!==0&&(r=r.replace("Z",_m(t,!0)))),r}function zl(s){return s.toISOString().replace(/T.*$/,"")}function oo(s){return s.toISOString().match(/^\d{4}-\d{2}/)[0]}function Mm(s){return Wn(s.getUTCHours(),2)+":"+Wn(s.getUTCMinutes(),2)+":"+Wn(s.getUTCSeconds(),2)}function _m(s,t=!1){let e=s<0?"-":"+",r=Math.abs(s),i=Math.floor(r/60),n=Math.round(r%60);return t?`${e+Wn(i,2)}:${Wn(n,2)}`:`GMT${e}${i}${n?`:${Wn(n,2)}`:""}`}function ne(s,t,e){let r,i;return function(...n){if(!r)i=s.apply(this,n);else if(!Li(r,n)){e&&e(i);let a=s.apply(this,n);(!t||!t(a,i))&&(i=a)}return r=n,i}}function lo(s,t,e){let r,i;return n=>{if(!r)i=s.call(this,n);else if(!Zt(r,n)){e&&e(i);let a=s.call(this,n);(!t||!t(a,i))&&(i=a)}return r=n,i}}var Xf={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},bu={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},fu=/\s*([ap])\.?m\.?/i,BP=/,/g,UP=/\s+/g,$P=/\u200e/g,VP=/UTC|GMT/,lm=class{constructor(t){let e={},r={},i=9;for(let n in t)n in Xf?(r[n]=t[n],Xf[n]<9&&(i=Math.min(Xf[n],i))):(e[n]=t[n],n in bu&&(i=Math.min(bu[n],i)));this.standardDateProps=e,this.extendedSettings=r,this.smallestUnitNum=i,this.buildFormattingFunc=ne(OD)}format(t,e){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,e)(t)}formatRange(t,e,r,i){let{standardDateProps:n,extendedSettings:a}=this,o=GP(t.marker,e.marker,r.calendarSystem);if(!o)return this.format(t,r);let l=o;l>1&&(n.year==="numeric"||n.year==="2-digit")&&(n.month==="numeric"||n.month==="2-digit")&&(n.day==="numeric"||n.day==="2-digit")&&(l=1);let c=this.format(t,r),d=this.format(e,r);if(c===d)return c;let u=QP(n,l),h=OD(u,a,r),p=h(t),f=h(e),m=KP(c,p,d,f),g=a.separator||i||r.defaultSeparator||"";return m?m.before+p+g+f+m.after:c+g+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}};function OD(s,t,e){let r=Object.keys(s).length;return r===1&&s.timeZoneName==="short"?i=>_m(i.timeZoneOffset):r===0&&t.week?i=>qP(e.computeWeekNumber(i.marker),e.weekText,e.weekTextLong,e.locale,t.week):WP(s,t,e)}function WP(s,t,e){s=Object.assign({},s),t=Object.assign({},t),YP(s,t),s.timeZone="UTC";let r=new Intl.DateTimeFormat(e.locale.codes,s),i;if(t.omitZeroMinute){let n=Object.assign({},s);delete n.minute,i=new Intl.DateTimeFormat(e.locale.codes,n)}return n=>{let{marker:a}=n,o;i&&!a.getUTCMinutes()?o=i:o=r;let l=o.format(a);return jP(l,n,s,t,e)}}function YP(s,t){s.timeZoneName&&(s.hour||(s.hour="2-digit"),s.minute||(s.minute="2-digit")),s.timeZoneName==="long"&&(s.timeZoneName="short"),t.omitZeroMinute&&(s.second||s.millisecond)&&delete t.omitZeroMinute}function jP(s,t,e,r,i){return s=s.replace($P,""),e.timeZoneName==="short"&&(s=zP(s,i.timeZone==="UTC"||t.timeZoneOffset==null?"UTC":_m(t.timeZoneOffset))),r.omitCommas&&(s=s.replace(BP,"").trim()),r.omitZeroMinute&&(s=s.replace(":00","")),r.meridiem===!1?s=s.replace(fu,"").trim():r.meridiem==="narrow"?s=s.replace(fu,(n,a)=>a.toLocaleLowerCase()):r.meridiem==="short"?s=s.replace(fu,(n,a)=>`${a.toLocaleLowerCase()}m`):r.meridiem==="lowercase"&&(s=s.replace(fu,n=>n.toLocaleLowerCase())),s=s.replace(UP," "),s=s.trim(),s}function zP(s,t){let e=!1;return s=s.replace(VP,()=>(e=!0,t)),e||(s+=` ${t}`),s}function qP(s,t,e,r,i){let n=[];return i==="long"?n.push(e):(i==="short"||i==="narrow")&&n.push(t),(i==="long"||i==="short")&&n.push(" "),n.push(r.simpleNumberFormat.format(s)),r.options.direction==="rtl"&&n.reverse(),n.join("")}function GP(s,t,e){return e.getMarkerYear(s)!==e.getMarkerYear(t)?5:e.getMarkerMonth(s)!==e.getMarkerMonth(t)?4:e.getMarkerDay(s)!==e.getMarkerDay(t)?2:qs(s)!==qs(t)?1:0}function QP(s,t){let e={};for(let r in s)(!(r in bu)||bu[r]<=t)&&(e[r]=s[r]);return e}function KP(s,t,e,r){let i=0;for(;i<s.length;){let n=s.indexOf(t,i);if(n===-1)break;let a=s.substr(0,n);i=n+t.length;let o=s.substr(i),l=0;for(;l<e.length;){let c=e.indexOf(r,l);if(c===-1)break;let d=e.substr(0,c);l=c+r.length;let u=e.substr(l);if(a===d&&o===u)return{before:a,after:o}}}return null}function FD(s,t){let e=t.markerToArray(s.marker);return{marker:s.marker,timeZoneOffset:s.timeZoneOffset,array:e,year:e[0],month:e[1],day:e[2],hour:e[3],minute:e[4],second:e[5],millisecond:e[6]}}function ku(s,t,e,r){let i=FD(s,e.calendarSystem),n=t?FD(t,e.calendarSystem):null;return{date:i,start:i,end:n,timeZone:e.timeZone,localeCodes:e.locale.codes,defaultSeparator:r||e.defaultSeparator}}var cm=class{constructor(t){this.cmdStr=t}format(t,e,r){return e.cmdFormatter(this.cmdStr,ku(t,null,e,r))}formatRange(t,e,r,i){return r.cmdFormatter(this.cmdStr,ku(t,e,r,i))}},dm=class{constructor(t){this.func=t}format(t,e,r){return this.func(ku(t,null,e,r))}formatRange(t,e,r,i){return this.func(ku(t,e,r,i))}};function Le(s){return typeof s=="object"&&s?new lm(s):typeof s=="string"?new cm(s):typeof s=="function"?new dm(s):null}var Am={navLinkDayClick:N,navLinkWeekClick:N,duration:pe,bootstrapFontAwesome:N,buttonIcons:N,customButtons:N,defaultAllDayEventDuration:pe,defaultTimedEventDuration:pe,nextDayThreshold:pe,scrollTime:pe,scrollTimeReset:Boolean,slotMinTime:pe,slotMaxTime:pe,dayPopoverFormat:Le,slotDuration:pe,snapDuration:pe,headerToolbar:N,footerToolbar:N,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:Le,dayHeaderClassNames:N,dayHeaderContent:N,dayHeaderDidMount:N,dayHeaderWillUnmount:N,dayCellClassNames:N,dayCellContent:N,dayCellDidMount:N,dayCellWillUnmount:N,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:N,weekNumbers:Boolean,weekNumberClassNames:N,weekNumberContent:N,weekNumberDidMount:N,weekNumberWillUnmount:N,editable:Boolean,viewClassNames:N,viewDidMount:N,viewWillUnmount:N,nowIndicator:Boolean,nowIndicatorSnap:N,nowIndicatorClassNames:N,nowIndicatorContent:N,nowIndicatorDidMount:N,nowIndicatorWillUnmount:N,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:N,locale:N,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:N,eventOrder:QD,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:N,contentHeight:N,direction:String,weekNumberFormat:Le,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:N,initialDate:N,now:N,eventDataTransform:N,stickyHeaderDates:N,stickyFooterScrollbar:N,viewHeight:N,defaultAllDay:Boolean,eventSourceFailure:N,eventSourceSuccess:N,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:N,eventConstraint:N,eventAllow:N,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:N,eventContent:N,eventDidMount:N,eventWillUnmount:N,selectConstraint:N,selectOverlap:N,selectAllow:N,droppable:Boolean,unselectCancel:String,slotLabelFormat:N,slotLaneClassNames:N,slotLaneContent:N,slotLaneDidMount:N,slotLaneWillUnmount:N,slotLabelClassNames:N,slotLabelContent:N,slotLabelDidMount:N,slotLabelWillUnmount:N,dayMaxEvents:N,dayMaxEventRows:N,dayMinWidth:Number,slotLabelInterval:pe,allDayText:String,allDayClassNames:N,allDayContent:N,allDayDidMount:N,allDayWillUnmount:N,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:Le,rerenderDelay:Number,moreLinkText:N,moreLinkHint:N,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:N,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:pe,hiddenDays:N,fixedWeekCount:Boolean,validRange:N,visibleRange:N,titleFormat:N,eventInteractive:Boolean,noEventsText:String,viewHint:N,navLinkHint:N,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:N,moreLinkClassNames:N,moreLinkContent:N,moreLinkDidMount:N,moreLinkWillUnmount:N,monthStartFormat:Le,handleCustomRendering:N,customRenderingMetaMap:N,customRenderingReplaces:Boolean},Hi={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},Im={datesSet:N,eventsSet:N,eventAdd:N,eventChange:N,eventRemove:N,windowResize:N,eventClick:N,eventMouseEnter:N,eventMouseLeave:N,select:N,unselect:N,loading:N,_unmount:N,_beforeprint:N,_afterprint:N,_noEventDrop:N,_noEventResize:N,_resize:N,_scrollRequest:N},Pm={buttonText:N,buttonHints:N,views:N,plugins:N,initialEvents:N,events:N,eventSources:N},Xs={headerToolbar:Vn,footerToolbar:Vn,buttonText:Vn,buttonHints:Vn,buttonIcons:Vn,dateIncrement:Vn,plugins:mu,events:mu,eventSources:mu,resources:mu};function Vn(s,t){return typeof s=="object"&&typeof t=="object"&&s&&t?Zt(s,t):s===t}function mu(s,t){return Array.isArray(s)&&Array.isArray(t)?Li(s,t):s===t}var tC={type:String,component:N,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:N,usesMinMaxTime:Boolean,classNames:N,content:N,didMount:N,willUnmount:N};function Fu(s){return Lu(s,Xs)}function ql(s,t){let e={},r={};for(let i in t)i in s&&(e[i]=t[i](s[i]));for(let i in s)i in t||(r[i]=s[i]);return{refined:e,extra:r}}function N(s){return s}var{hasOwnProperty:Su}=Object.prototype;function Lu(s,t){let e={};if(t){for(let r in t)if(t[r]===Vn){let i=[];for(let n=s.length-1;n>=0;n-=1){let a=s[n][r];if(typeof a=="object"&&a)i.unshift(a);else if(a!==void 0){e[r]=a;break}}i.length&&(e[r]=Lu(i))}}for(let r=s.length-1;r>=0;r-=1){let i=s[r];for(let n in i)n in e||(e[n]=i[n])}return e}function us(s,t){let e={};for(let r in s)t(s[r],r)&&(e[r]=s[r]);return e}function Kr(s,t){let e={};for(let r in s)e[r]=t(s[r],r);return e}function Nm(s){let t={};for(let e of s)t[e]=!0;return t}function Hu(s){let t=[];for(let e in s)t.push(s[e]);return t}function Zt(s,t){if(s===t)return!0;for(let e in s)if(Su.call(s,e)&&!(e in t))return!1;for(let e in t)if(Su.call(t,e)&&s[e]!==t[e])return!1;return!0}var ZP=/^on[A-Z]/;function JP(s,t){let e=XP(s,t);for(let r of e)if(!ZP.test(r))return!1;return!0}function XP(s,t){let e=[];for(let r in s)Su.call(s,r)&&(r in t||e.push(r));for(let r in t)Su.call(t,r)&&s[r]!==t[r]&&e.push(r);return e}function wu(s,t,e={}){if(s===t)return!0;for(let r in t)if(!(r in s&&eN(s[r],t[r],e[r])))return!1;for(let r in s)if(!(r in t))return!1;return!0}function eN(s,t,e){return s===t||e===!0?!0:e?e(s,t):!1}function rC(s,t=0,e,r=1){let i=[];e==null&&(e=Object.keys(s).length);for(let n=t;n<e;n+=r){let a=s[n];a!==void 0&&i.push(a)}return i}var iC={};function tN(s,t){iC[s]=t}function rN(s){return new iC[s]}var um=class{getMarkerYear(t){return t.getUTCFullYear()}getMarkerMonth(t){return t.getUTCMonth()}getMarkerDay(t){return t.getUTCDate()}arrayToMarker(t){return vr(t)}markerToArray(t){return zs(t)}};tN("gregory",um);var iN=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function sC(s){let t=iN.exec(s);if(t){let e=new Date(Date.UTC(Number(t[1]),t[3]?Number(t[3])-1:0,Number(t[5]||1),Number(t[7]||0),Number(t[8]||0),Number(t[10]||0),t[12]?+`0.${t[12]}`*1e3:0));if(xm(e)){let r=null;return t[13]&&(r=(t[15]==="-"?-1:1)*(Number(t[16]||0)*60+Number(t[18]||0))),{marker:e,isTimeUnspecified:!t[6],timeZoneOffset:r}}}return null}var _l=class{constructor(t){let e=this.timeZone=t.timeZone,r=e!=="local"&&e!=="UTC";t.namedTimeZoneImpl&&r&&(this.namedTimeZoneImpl=new t.namedTimeZoneImpl(e)),this.canComputeOffset=!!(!r||this.namedTimeZoneImpl),this.calendarSystem=rN(t.calendarSystem),this.locale=t.locale,this.weekDow=t.locale.week.dow,this.weekDoy=t.locale.week.doy,t.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof t.firstDay=="number"&&(this.weekDow=t.firstDay),typeof t.weekNumberCalculation=="function"&&(this.weekNumberFunc=t.weekNumberCalculation),this.weekText=t.weekText!=null?t.weekText:t.locale.options.weekText,this.weekTextLong=(t.weekTextLong!=null?t.weekTextLong:t.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=t.cmdFormatter,this.defaultSeparator=t.defaultSeparator}createMarker(t){let e=this.createMarkerMeta(t);return e===null?null:e.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):vr(ND(new Date))}createMarkerMeta(t){if(typeof t=="string")return this.parse(t);let e=null;return typeof t=="number"?e=this.timestampToMarker(t):t instanceof Date?(t=t.valueOf(),isNaN(t)||(e=this.timestampToMarker(t))):Array.isArray(t)&&(e=vr(t)),e===null||!xm(e)?null:{marker:e,isTimeUnspecified:!1,forcedTzo:null}}parse(t){let e=sC(t);if(e===null)return null;let{marker:r}=e,i=null;return e.timeZoneOffset!==null&&(this.canComputeOffset?r=this.timestampToMarker(r.valueOf()-e.timeZoneOffset*60*1e3):i=e.timeZoneOffset),{marker:r,isTimeUnspecified:e.isTimeUnspecified,forcedTzo:i}}getYear(t){return this.calendarSystem.getMarkerYear(t)}getMonth(t){return this.calendarSystem.getMarkerMonth(t)}getDay(t){return this.calendarSystem.getMarkerDay(t)}add(t,e){let r=this.calendarSystem.markerToArray(t);return r[0]+=e.years,r[1]+=e.months,r[2]+=e.days,r[6]+=e.milliseconds,this.calendarSystem.arrayToMarker(r)}subtract(t,e){let r=this.calendarSystem.markerToArray(t);return r[0]-=e.years,r[1]-=e.months,r[2]-=e.days,r[6]-=e.milliseconds,this.calendarSystem.arrayToMarker(r)}addYears(t,e){let r=this.calendarSystem.markerToArray(t);return r[0]+=e,this.calendarSystem.arrayToMarker(r)}addMonths(t,e){let r=this.calendarSystem.markerToArray(t);return r[1]+=e,this.calendarSystem.arrayToMarker(r)}diffWholeYears(t,e){let{calendarSystem:r}=this;return qs(t)===qs(e)&&r.getMarkerDay(t)===r.getMarkerDay(e)&&r.getMarkerMonth(t)===r.getMarkerMonth(e)?r.getMarkerYear(e)-r.getMarkerYear(t):null}diffWholeMonths(t,e){let{calendarSystem:r}=this;return qs(t)===qs(e)&&r.getMarkerDay(t)===r.getMarkerDay(e)?r.getMarkerMonth(e)-r.getMarkerMonth(t)+(r.getMarkerYear(e)-r.getMarkerYear(t))*12:null}greatestWholeUnit(t,e){let r=this.diffWholeYears(t,e);return r!==null?{unit:"year",value:r}:(r=this.diffWholeMonths(t,e),r!==null?{unit:"month",value:r}:(r=eC(t,e),r!==null?{unit:"week",value:r}:(r=ro(t,e),r!==null?{unit:"day",value:r}:(r=IP(t,e),xl(r)?{unit:"hour",value:r}:(r=PP(t,e),xl(r)?{unit:"minute",value:r}:(r=NP(t,e),xl(r)?{unit:"second",value:r}:{unit:"millisecond",value:e.valueOf()-t.valueOf()}))))))}countDurationsBetween(t,e,r){let i;return r.years&&(i=this.diffWholeYears(t,e),i!==null)?i/MP(r):r.months&&(i=this.diffWholeMonths(t,e),i!==null)?i/_P(r):r.days&&(i=ro(t,e),i!==null)?i/to(r):(e.valueOf()-t.valueOf())/Nr(r)}startOf(t,e){return e==="year"?this.startOfYear(t):e==="month"?this.startOfMonth(t):e==="week"?this.startOfWeek(t):e==="day"?Ve(t):e==="hour"?RP(t):e==="minute"?OP(t):e==="second"?FP(t):null}startOfYear(t){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(t)])}startOfMonth(t){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(t),this.calendarSystem.getMarkerMonth(t)])}startOfWeek(t){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(t),this.calendarSystem.getMarkerMonth(t),t.getUTCDate()-(t.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(t){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(t)):LP(t,this.weekDow,this.weekDoy)}format(t,e,r={}){return e.format({marker:t,timeZoneOffset:r.forcedTzo!=null?r.forcedTzo:this.offsetForMarker(t)},this)}formatRange(t,e,r,i={}){return i.isEndExclusive&&(e=Ri(e,-1)),r.formatRange({marker:t,timeZoneOffset:i.forcedStartTzo!=null?i.forcedStartTzo:this.offsetForMarker(t)},{marker:e,timeZoneOffset:i.forcedEndTzo!=null?i.forcedEndTzo:this.offsetForMarker(e)},this,i.defaultSeparator)}formatIso(t,e={}){let r=null;return e.omitTimeZoneOffset||(e.forcedTzo!=null?r=e.forcedTzo:r=this.offsetForMarker(t)),Ou(t,r,e.omitTime)}timestampToMarker(t){return this.timeZone==="local"?vr(ND(new Date(t))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(t):vr(this.namedTimeZoneImpl.timestampToArray(t))}offsetForMarker(t){return this.timeZone==="local"?-RD(zs(t)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(zs(t)):null}toDate(t,e){return this.timeZone==="local"?RD(zs(t)):this.timeZone==="UTC"?new Date(t.valueOf()):this.namedTimeZoneImpl?new Date(t.valueOf()-this.namedTimeZoneImpl.offsetForArray(zs(t))*1e3*60):new Date(t.valueOf()-(e||0))}},hs=class{constructor(t){this.iconOverrideOption&&this.setIconOverride(t[this.iconOverrideOption])}setIconOverride(t){let e,r;if(typeof t=="object"&&t){e=Object.assign({},this.iconClasses);for(r in t)e[r]=this.applyIconOverridePrefix(t[r]);this.iconClasses=e}else t===!1&&(this.iconClasses={})}applyIconOverridePrefix(t){let e=this.iconOverridePrefix;return e&&t.indexOf(e)!==0&&(t=e+t),t}getClass(t){return this.classes[t]||""}getIconClass(t,e){let r;return e&&this.rtlIconClasses?r=this.rtlIconClasses[t]||this.iconClasses[t]:r=this.iconClasses[t],r?`${this.baseIconClass} ${r}`:""}getCustomButtonIconClass(t){let e;return this.iconOverrideCustomButtonOption&&(e=t[this.iconOverrideCustomButtonOption],e)?`${this.baseIconClass} ${this.applyIconOverridePrefix(e)}`:""}};hs.prototype.classes={};hs.prototype.iconClasses={};hs.prototype.baseIconClass="";hs.prototype.iconOverridePrefix="";function Al(s){s();let t=oe.debounceRendering,e=[];function r(i){e.push(i)}for(oe.debounceRendering=r,Ys(b(hm,{}),document.createElement("div"));e.length;)e.shift()();oe.debounceRendering=t}var hm=class extends Ut{render(){return b("div",{})}componentDidMount(){this.setState({})}};function nC(s){let t=uu(s),e=t.Provider;return t.Provider=function(){let r=!this.getChildContext,i=e.apply(this,arguments);if(r){let n=[];this.shouldComponentUpdate=a=>{this.props.value!==a.value&&n.forEach(o=>{o.context=a.value,o.forceUpdate()})},this.sub=a=>{n.push(a);let o=a.componentWillUnmount;a.componentWillUnmount=()=>{n.splice(n.indexOf(a),1),o&&o.call(a)}}}return i},t}var Eu=class{constructor(t,e,r,i){this.execFunc=t,this.emitter=e,this.scrollTime=r,this.scrollTimeReset=i,this.handleScrollRequest=n=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},n),this.drain()},e.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(t){t&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}},Jr=nC({});function aC(s,t,e,r,i,n,a,o,l,c,d,u,h,p){return{dateEnv:i,nowManager:n,options:e,pluginHooks:o,emitter:d,dispatch:l,getCurrentData:c,calendarApi:u,viewSpec:s,viewApi:t,dateProfileGenerator:r,theme:a,isRtl:e.direction==="rtl",addResizeHandler(f){d.on("_resize",f)},removeResizeHandler(f){d.off("_resize",f)},createScrollResponder(f){return new Eu(f,d,pe(e.scrollTime),e.scrollTimeReset)},registerInteractiveComponent:h,unregisterInteractiveComponent:p}}var Oi=class extends Ut{shouldComponentUpdate(t,e){return!wu(this.props,t,this.propEquality)||!wu(this.state,e,this.stateEquality)}safeSetState(t){wu(this.state,Object.assign(Object.assign({},this.state),t),this.stateEquality)||this.setState(t)}};Oi.addPropsEquality=sN;Oi.addStateEquality=nN;Oi.contextType=Jr;Oi.prototype.propEquality={};Oi.prototype.stateEquality={};var De=class extends Oi{};De.contextType=Jr;function sN(s){let t=Object.create(this.prototype.propEquality);Object.assign(t,s),this.prototype.propEquality=t}function nN(s){let t=Object.create(this.prototype.stateEquality);Object.assign(t,s),this.prototype.stateEquality=t}function Or(s,t){typeof s=="function"?s(t):s&&(s.current=t)}var Il=class extends De{constructor(){super(...arguments),this.id=gs(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=t=>{let{options:e}=this.context,{generatorName:r}=this.props;(!e.customRenderingReplaces||!pm(r,e))&&this.updateElRef(t)},this.updateElRef=t=>{this.props.elRef&&Or(this.props.elRef,t)}}render(){let{props:t,context:e}=this,{options:r}=e,{customGenerator:i,defaultGenerator:n,renderProps:a}=t,o=Rm(t,[],this.handleEl),l=!1,c,d=[],u;if(i!=null){let h=typeof i=="function"?i(a,b):i;if(h===!0)l=!0;else{let p=h&&typeof h=="object";p&&"html"in h?o.dangerouslySetInnerHTML={__html:h.html}:p&&"domNodes"in h?d=Array.prototype.slice.call(h.domNodes):(p?jf(h):typeof h!="function")?c=h:u=h}}else l=!pm(t.generatorName,r);return l&&n&&(c=n(a)),this.queuedDomNodes=d,this.currentGeneratorMeta=u,b(t.elTag,o,c)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(t){var e;let{props:r,context:i}=this,{handleCustomRendering:n,customRenderingMetaMap:a}=i.options;if(n){let o=(e=this.currentGeneratorMeta)!==null&&e!==void 0?e:a==null?void 0:a[r.generatorName];o&&n(Object.assign(Object.assign({id:this.id,isActive:t,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:o},r),{elClasses:(r.elClasses||[]).filter(aN)}))}}applyQueueudDomNodes(){let{queuedDomNodes:t,currentDomNodes:e}=this,r=this.base;if(!Li(t,e)){e.forEach(Vl);for(let i of t)r.appendChild(i);this.currentDomNodes=t}}};Il.addPropsEquality({elClasses:Li,elStyle:Zt,elAttrs:JP,renderProps:Zt});function pm(s,t){var e;return!!(t.handleCustomRendering&&s&&(!((e=t.customRenderingMetaMap)===null||e===void 0)&&e[s]))}function Rm(s,t,e){let r=Object.assign(Object.assign({},s.elAttrs),{ref:e});return(s.elClasses||t)&&(r.className=(s.elClasses||[]).concat(t||[]).concat(r.className||[]).filter(Boolean).join(" ")),s.elStyle&&(r.style=s.elStyle),r}function aN(s){return!!s}var Om=nC(0),It=class extends Ut{constructor(){super(...arguments),this.InnerContent=oN.bind(void 0,this),this.handleEl=t=>{this.el=t,this.props.elRef&&(Or(this.props.elRef,t),t&&this.didMountMisfire&&this.componentDidMount())}}render(){let{props:t}=this,e=lN(t.classNameGenerator,t.renderProps);if(t.children){let r=Rm(t,e,this.handleEl),i=t.children(this.InnerContent,t.renderProps,r);return t.elTag?b(t.elTag,r,i):i}else return b(Il,Object.assign(Object.assign({},t),{elRef:this.handleEl,elTag:t.elTag||"div",elClasses:(t.elClasses||[]).concat(e),renderId:this.context}))}componentDidMount(){var t,e;this.el?(e=(t=this.props).didMount)===null||e===void 0||e.call(t,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var t,e;(e=(t=this.props).willUnmount)===null||e===void 0||e.call(t,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}};It.contextType=Om;function oN(s,t){let e=s.props;return b(Il,Object.assign({renderProps:e.renderProps,generatorName:e.generatorName,customGenerator:e.customGenerator,defaultGenerator:e.defaultGenerator,renderId:s.context},t))}function lN(s,t){let e=typeof s=="function"?s(t):s||[];return typeof e=="string"?[e]:e}var gi=class extends De{render(){let{props:t,context:e}=this,{options:r}=e,i={view:e.viewApi};return b(It,{elRef:t.elRef,elTag:t.elTag||"div",elAttrs:t.elAttrs,elClasses:[...Fm(t.viewSpec),...t.elClasses||[]],elStyle:t.elStyle,renderProps:i,classNameGenerator:r.viewClassNames,generatorName:void 0,didMount:r.viewDidMount,willUnmount:r.viewWillUnmount},()=>t.children)}};function Fm(s){return[`fc-${s.type}-view`,"fc-view"]}function cN(s,t){let e=null,r=null;return s.start&&(e=t.createMarker(s.start)),s.end&&(r=t.createMarker(s.end)),!e&&!r||e&&r&&r<e?null:{start:e,end:r}}function LD(s,t){let e=[],{start:r}=t,i,n;for(s.sort(dN),i=0;i<s.length;i+=1)n=s[i],n.start>r&&e.push({start:r,end:n.start}),n.end>r&&(r=n.end);return r<t.end&&e.push({start:r,end:t.end}),e}function dN(s,t){return s.start.valueOf()-t.start.valueOf()}function Rr(s,t){let{start:e,end:r}=s,i=null;return t.start!==null&&(e===null?e=t.start:e=new Date(Math.max(e.valueOf(),t.start.valueOf()))),t.end!=null&&(r===null?r=t.end:r=new Date(Math.min(r.valueOf(),t.end.valueOf()))),(e===null||r===null||e<r)&&(i={start:e,end:r}),i}function oC(s,t){return(s.start===null?null:s.start.valueOf())===(t.start===null?null:t.start.valueOf())&&(s.end===null?null:s.end.valueOf())===(t.end===null?null:t.end.valueOf())}function Bu(s,t){return(s.end===null||t.start===null||s.end>t.start)&&(s.start===null||t.end===null||s.start<t.end)}function co(s,t){return(s.start===null||t.start!==null&&t.start>=s.start)&&(s.end===null||t.end!==null&&t.end<=s.end)}function Qr(s,t){return(s.start===null||t>=s.start)&&(s.end===null||t<s.end)}function uN(s,t){return t.start!=null&&s<t.start?t.start:t.end!=null&&s>=t.end?new Date(t.end.valueOf()-1):s}function lC(s){let t=Math.floor(ys(s.start,s.end))||1,e=Ve(s.start),r=pt(e,t);return{start:e,end:r}}function Lm(s,t=pe(0)){let e=null,r=null;if(s.end){r=Ve(s.end);let i=s.end.valueOf()-r.valueOf();i&&i>=Nr(t)&&(r=pt(r,1))}return s.start&&(e=Ve(s.start),r&&r<=e&&(r=pt(e,1))),{start:e,end:r}}function Gs(s,t,e,r){return r==="year"?pe(e.diffWholeYears(s,t),"year"):r==="month"?pe(e.diffWholeMonths(s,t),"month"):XD(s,t)}var jn=class{constructor(t){this.props=t,this.initHiddenDays()}buildPrev(t,e,r){let{dateEnv:i}=this.props,n=i.subtract(i.startOf(e,t.currentRangeUnit),t.dateIncrement);return this.build(n,-1,r)}buildNext(t,e,r){let{dateEnv:i}=this.props,n=i.add(i.startOf(e,t.currentRangeUnit),t.dateIncrement);return this.build(n,1,r)}build(t,e,r=!0){let{props:i}=this,n,a,o,l,c,d;return n=this.buildValidRange(),n=this.trimHiddenDays(n),r&&(t=uN(t,n)),a=this.buildCurrentRangeInfo(t,e),o=/^(year|month|week|day)$/.test(a.unit),l=this.buildRenderRange(this.trimHiddenDays(a.range),a.unit,o),l=this.trimHiddenDays(l),c=l,i.showNonCurrentDates||(c=Rr(c,a.range)),c=this.adjustActiveRange(c),c=Rr(c,n),d=Bu(a.range,n),Qr(l,t)||(t=l.start),{currentDate:t,validRange:n,currentRange:a.range,currentRangeUnit:a.unit,isRangeAllDay:o,activeRange:c,renderRange:l,slotMinTime:i.slotMinTime,slotMaxTime:i.slotMaxTime,isValid:d,dateIncrement:this.buildDateIncrement(a.duration)}}buildValidRange(){let t=this.props.validRangeInput,e=typeof t=="function"?t.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):t;return this.refineRange(e)||{start:null,end:null}}buildCurrentRangeInfo(t,e){let{props:r}=this,i=null,n=null,a=null,o;return r.duration?(i=r.duration,n=r.durationUnit,a=this.buildRangeFromDuration(t,e,i,n)):(o=this.props.dayCount)?(n="day",a=this.buildRangeFromDayCount(t,e,o)):(a=this.buildCustomVisibleRange(t))?n=r.dateEnv.greatestWholeUnit(a.start,a.end).unit:(i=this.getFallbackDuration(),n=Ml(i).unit,a=this.buildRangeFromDuration(t,e,i,n)),{duration:i,unit:n,range:a}}getFallbackDuration(){return pe({day:1})}adjustActiveRange(t){let{dateEnv:e,usesMinMaxTime:r,slotMinTime:i,slotMaxTime:n}=this.props,{start:a,end:o}=t;return r&&(to(i)<0&&(a=Ve(a),a=e.add(a,i)),to(n)>1&&(o=Ve(o),o=pt(o,-1),o=e.add(o,n))),{start:a,end:o}}buildRangeFromDuration(t,e,r,i){let{dateEnv:n,dateAlignment:a}=this.props,o,l,c;if(!a){let{dateIncrement:u}=this.props;u&&Nr(u)<Nr(r)?a=Ml(u).unit:a=i}to(r)<=1&&this.isHiddenDay(o)&&(o=this.skipHiddenDays(o,e),o=Ve(o));function d(){o=n.startOf(t,a),l=n.add(o,r),c={start:o,end:l}}return d(),this.trimHiddenDays(c)||(t=this.skipHiddenDays(t,e),d()),c}buildRangeFromDayCount(t,e,r){let{dateEnv:i,dateAlignment:n}=this.props,a=0,o=t,l;n&&(o=i.startOf(o,n)),o=Ve(o),o=this.skipHiddenDays(o,e),l=o;do l=pt(l,1),this.isHiddenDay(l)||(a+=1);while(a<r);return{start:o,end:l}}buildCustomVisibleRange(t){let{props:e}=this,r=e.visibleRangeInput,i=typeof r=="function"?r.call(e.calendarApi,e.dateEnv.toDate(t)):r,n=this.refineRange(i);return n&&(n.start==null||n.end==null)?null:n}buildRenderRange(t,e,r){return t}buildDateIncrement(t){let{dateIncrement:e}=this.props,r;return e||((r=this.props.dateAlignment)?pe(1,r):t||pe({days:1}))}refineRange(t){if(t){let e=cN(t,this.props.dateEnv);return e&&(e=Lm(e)),e}return null}initHiddenDays(){let t=this.props.hiddenDays||[],e=[],r=0,i;for(this.props.weekends===!1&&t.push(0,6),i=0;i<7;i+=1)(e[i]=t.indexOf(i)!==-1)||(r+=1);if(!r)throw new Error("invalid hiddenDays");this.isHiddenDayHash=e}trimHiddenDays(t){let{start:e,end:r}=t;return e&&(e=this.skipHiddenDays(e)),r&&(r=this.skipHiddenDays(r,-1,!0)),e==null||r==null||e<r?{start:e,end:r}:null}isHiddenDay(t){return t instanceof Date&&(t=t.getUTCDay()),this.isHiddenDayHash[t]}skipHiddenDays(t,e=1,r=!1){for(;this.isHiddenDayHash[(t.getUTCDay()+(r?e:0)+7)%7];)t=pt(t,e);return t}};function uo(s,t,e,r){return{instanceId:gs(),defId:s,range:t,forcedStartTzo:e==null?null:e,forcedEndTzo:r==null?null:r}}function hN(s,t,e,r){for(let i=0;i<r.length;i+=1){let n=r[i].parse(s,e);if(n){let{allDay:a}=s;return a==null&&(a=t,a==null&&(a=n.allDayGuess,a==null&&(a=!1))),{allDay:a,duration:n.duration,typeData:n.typeData,typeId:i}}}return null}function zn(s,t,e){let{dateEnv:r,pluginHooks:i,options:n}=e,{defs:a,instances:o}=s;o=us(o,l=>!a[l.defId].recurringDef);for(let l in a){let c=a[l];if(c.recurringDef){let{duration:d}=c.recurringDef;d||(d=c.allDay?n.defaultAllDayEventDuration:n.defaultTimedEventDuration);let u=pN(c,d,t,r,i.recurringTypes);for(let h of u){let p=uo(l,{start:h,end:r.add(h,d)});o[p.instanceId]=p}}}return{defs:a,instances:o}}function pN(s,t,e,r,i){let a=i[s.recurringDef.typeId].expand(s.recurringDef.typeData,{start:r.subtract(e.start,t),end:e.end},r);return s.allDay&&(a=a.map(Ve)),a}var Tu={id:String,groupId:String,title:String,url:String,interactive:Boolean},cC={start:N,end:N,date:N,allDay:Boolean},fN=Object.assign(Object.assign(Object.assign({},Tu),cC),{extendedProps:N});function dC(s,t,e,r,i=Hm(e),n,a){let{refined:o,extra:l}=Gl(s,e,i),c=gN(t,e),d=hN(o,c,e.dateEnv,e.pluginHooks.recurringTypes);if(d){let h=io(o,l,t?t.sourceId:"",d.allDay,!!d.duration,e,n);return h.recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:h,instance:null}}let u=mN(o,c,e,r);if(u){let h=io(o,l,t?t.sourceId:"",u.allDay,u.hasEnd,e,n),p=uo(h.defId,u.range,u.forcedStartTzo,u.forcedEndTzo);return a&&h.publicId&&a[h.publicId]&&(p.instanceId=a[h.publicId]),{def:h,instance:p}}return null}function Gl(s,t,e=Hm(t)){return ql(s,e)}function Hm(s){return Object.assign(Object.assign(Object.assign({},Du),fN),s.pluginHooks.eventRefiners)}function io(s,t,e,r,i,n,a){let o={title:s.title||"",groupId:s.groupId||"",publicId:s.id||"",url:s.url||"",recurringDef:null,defId:(a&&s.id?a[s.id]:"")||gs(),sourceId:e,allDay:r,hasEnd:i,interactive:s.interactive,ui:ho(s,n),extendedProps:Object.assign(Object.assign({},s.extendedProps||{}),t)};for(let l of n.pluginHooks.eventDefMemberAdders)Object.assign(o,l(s));return Object.freeze(o.ui.classNames),Object.freeze(o.extendedProps),o}function mN(s,t,e,r){let{allDay:i}=s,n,a=null,o=!1,l,c=null,d=s.start!=null?s.start:s.date;if(n=e.dateEnv.createMarkerMeta(d),n)a=n.marker;else if(!r)return null;return s.end!=null&&(l=e.dateEnv.createMarkerMeta(s.end)),i==null&&(t!=null?i=t:i=(!n||n.isTimeUnspecified)&&(!l||l.isTimeUnspecified)),i&&a&&(a=Ve(a)),l&&(c=l.marker,i&&(c=Ve(c)),a&&c<=a&&(c=null)),c?o=!0:r||(o=e.options.forceEventDuration||!1,c=e.dateEnv.add(a,i?e.options.defaultAllDayEventDuration:e.options.defaultTimedEventDuration)),{allDay:i,hasEnd:o,range:{start:a,end:c},forcedStartTzo:n?n.forcedTzo:null,forcedEndTzo:l?l.forcedTzo:null}}function gN(s,t){let e=null;return s&&(e=s.defaultAllDay),e==null&&(e=t.options.defaultAllDay),e}function Pl(s,t,e,r,i,n){let a=Dt(),o=Hm(e);for(let l of s){let c=dC(l,t,e,r,o,i,n);c&&qn(c,a)}return a}function qn(s,t=Dt()){return t.defs[s.def.defId]=s.def,s.instance&&(t.instances[s.instance.instanceId]=s.instance),t}function Ql(s,t){let e=s.instances[t];if(e){let r=s.defs[e.defId],i=$u(s,n=>yN(r,n));return i.defs[r.defId]=r,i.instances[e.instanceId]=e,i}return Dt()}function yN(s,t){return!!(s.groupId&&s.groupId===t.groupId)}function Dt(){return{defs:{},instances:{}}}function Uu(s,t){return{defs:Object.assign(Object.assign({},s.defs),t.defs),instances:Object.assign(Object.assign({},s.instances),t.instances)}}function $u(s,t){let e=us(s.defs,t),r=us(s.instances,i=>e[i.defId]);return{defs:e,instances:r}}function vN(s,t){let{defs:e,instances:r}=s,i={},n={};for(let a in e)t.defs[a]||(i[a]=e[a]);for(let a in r)!t.instances[a]&&i[r[a].defId]&&(n[a]=r[a]);return{defs:i,instances:n}}function wN(s,t){return Array.isArray(s)?Pl(s,null,t,!0):typeof s=="object"&&s?Pl([s],null,t,!0):s!=null?String(s):null}function fm(s){return Array.isArray(s)?s:typeof s=="string"?s.split(/\s+/):[]}var Du={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:N,overlap:N,allow:N,className:fm,classNames:fm,color:String,backgroundColor:String,borderColor:String,textColor:String},TN={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function ho(s,t){let e=wN(s.constraint,t);return{display:s.display||null,startEditable:s.startEditable!=null?s.startEditable:s.editable,durationEditable:s.durationEditable!=null?s.durationEditable:s.editable,constraints:e!=null?[e]:[],overlap:s.overlap!=null?s.overlap:null,allows:s.allow!=null?[s.allow]:[],backgroundColor:s.backgroundColor||s.color||"",borderColor:s.borderColor||s.color||"",textColor:s.textColor||"",classNames:(s.className||[]).concat(s.classNames||[])}}function Bm(s){return s.reduce(bN,TN)}function bN(s,t){return{display:t.display!=null?t.display:s.display,startEditable:t.startEditable!=null?t.startEditable:s.startEditable,durationEditable:t.durationEditable!=null?t.durationEditable:s.durationEditable,constraints:s.constraints.concat(t.constraints),overlap:typeof t.overlap=="boolean"?t.overlap:s.overlap,allows:s.allows.concat(t.allows),backgroundColor:t.backgroundColor||s.backgroundColor,borderColor:t.borderColor||s.borderColor,textColor:t.textColor||s.textColor,classNames:s.classNames.concat(t.classNames)}}var kN={id:String,defaultAllDay:Boolean,url:String,format:String,events:N,eventDataTransform:N,success:N,failure:N};function Um(s,t,e=$m(t)){let r;if(typeof s=="string"?r={url:s}:typeof s=="function"||Array.isArray(s)?r={events:s}:typeof s=="object"&&s&&(r=s),r){let{refined:i,extra:n}=ql(r,e),a=SN(i,t);if(a)return{_raw:s,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:i.defaultAllDay,eventDataTransform:i.eventDataTransform,success:i.success,failure:i.failure,publicId:i.id||"",sourceId:gs(),sourceDefId:a.sourceDefId,meta:a.meta,ui:ho(i,t),extendedProps:n}}return null}function $m(s){return Object.assign(Object.assign(Object.assign({},Du),kN),s.pluginHooks.eventSourceRefiners)}function SN(s,t){let e=t.pluginHooks.eventSourceDefs;for(let r=e.length-1;r>=0;r-=1){let n=e[r].parseMeta(s);if(n)return{sourceDefId:r,meta:n}}return null}function uC(s,t,e,r,i){switch(t.type){case"RECEIVE_EVENTS":return EN(s,e[t.sourceId],t.fetchId,t.fetchRange,t.rawEvents,i);case"RESET_RAW_EVENTS":return DN(s,e[t.sourceId],t.rawEvents,r.activeRange,i);case"ADD_EVENTS":return CN(s,t.eventStore,r?r.activeRange:null,i);case"RESET_EVENTS":return t.eventStore;case"MERGE_EVENTS":return Uu(s,t.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return r?zn(s,r.activeRange,i):s;case"REMOVE_EVENTS":return vN(s,t.eventStore);case"REMOVE_EVENT_SOURCE":return pC(s,t.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return $u(s,n=>!n.sourceId);case"REMOVE_ALL_EVENTS":return Dt();default:return s}}function EN(s,t,e,r,i,n){if(t&&e===t.latestFetchId){let a=Pl(hC(i,t,n),t,n);return r&&(a=zn(a,r,n)),Uu(pC(s,t.sourceId),a)}return s}function DN(s,t,e,r,i){let{defIdMap:n,instanceIdMap:a}=MN(s),o=Pl(hC(e,t,i),t,i,!1,n,a);return zn(o,r,i)}function hC(s,t,e){let r=e.options.eventDataTransform,i=t?t.eventDataTransform:null;return i&&(s=HD(s,i)),r&&(s=HD(s,r)),s}function HD(s,t){let e;if(!t)e=s;else{e=[];for(let r of s){let i=t(r);i?e.push(i):i==null&&e.push(r)}}return e}function CN(s,t,e,r){return e&&(t=zn(t,e,r)),Uu(s,t)}function Vm(s,t,e){let{defs:r}=s,i=Kr(s.instances,n=>r[n.defId].allDay?n:Object.assign(Object.assign({},n),{range:{start:e.createMarker(t.toDate(n.range.start,n.forcedStartTzo)),end:e.createMarker(t.toDate(n.range.end,n.forcedEndTzo))},forcedStartTzo:e.canComputeOffset?null:n.forcedStartTzo,forcedEndTzo:e.canComputeOffset?null:n.forcedEndTzo}));return{defs:r,instances:i}}function pC(s,t){return $u(s,e=>e.sourceId!==t)}function xN(s,t){return{defs:s.defs,instances:us(s.instances,e=>!t[e.instanceId])}}function MN(s){let{defs:t,instances:e}=s,r={},i={};for(let n in t){let a=t[n],{publicId:o}=a;o&&(r[o]=n)}for(let n in e){let a=e[n],o=t[a.defId],{publicId:l}=o;l&&(i[l]=n)}return{defIdMap:r,instanceIdMap:i}}var ps=class{constructor(){this.handlers={},this.thisContext=null}setThisContext(t){this.thisContext=t}setOptions(t){this.options=t}on(t,e){_N(this.handlers,t,e)}off(t,e){AN(this.handlers,t,e)}trigger(t,...e){let r=this.handlers[t]||[],i=this.options&&this.options[t],n=[].concat(i||[],r);for(let a of n)a.apply(this.thisContext,e)}hasHandlers(t){return!!(this.handlers[t]&&this.handlers[t].length||this.options&&this.options[t])}};function _N(s,t,e){(s[t]||(s[t]=[])).push(e)}function AN(s,t,e){e?s[t]&&(s[t]=s[t].filter(r=>r!==e)):delete s[t]}var IN={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function Wm(s,t){return Pl(PN(s),null,t)}function PN(s){let t;return s===!0?t=[{}]:Array.isArray(s)?t=s.filter(e=>e.daysOfWeek):typeof s=="object"&&s?t=[s]:t=[],t=t.map(e=>Object.assign(Object.assign({},IN),e)),t}function Vu(s,t,e){e.emitter.trigger("select",Object.assign(Object.assign({},Ym(s,e)),{jsEvent:t?t.origEvent:null,view:e.viewApi||e.calendarApi.view}))}function NN(s,t){t.emitter.trigger("unselect",{jsEvent:s?s.origEvent:null,view:t.viewApi||t.calendarApi.view})}function Ym(s,t){let e={};for(let r of t.pluginHooks.dateSpanTransforms)Object.assign(e,r(s,t));return Object.assign(e,jN(s,t.dateEnv)),e}function Nl(s,t,e){let{dateEnv:r,options:i}=e,n=t;return s?(n=Ve(n),n=r.add(n,i.defaultAllDayEventDuration)):n=r.add(n,i.defaultTimedEventDuration),n}function Kl(s,t,e,r){let i=xu(s.defs,t),n=Dt();for(let a in s.defs){let o=s.defs[a];n.defs[a]=RN(o,i[a],e,r)}for(let a in s.instances){let o=s.instances[a],l=n.defs[o.defId];n.instances[a]=ON(o,l,i[o.defId],e,r)}return n}function RN(s,t,e,r){let i=e.standardProps||{};i.hasEnd==null&&t.durationEditable&&(e.startDelta||e.endDelta)&&(i.hasEnd=!0);let n=Object.assign(Object.assign(Object.assign({},s),i),{ui:Object.assign(Object.assign({},s.ui),i.ui)});e.extendedProps&&(n.extendedProps=Object.assign(Object.assign({},n.extendedProps),e.extendedProps));for(let a of r.pluginHooks.eventDefMutationAppliers)a(n,e,r);return!n.hasEnd&&r.options.forceEventDuration&&(n.hasEnd=!0),n}function ON(s,t,e,r,i){let{dateEnv:n}=i,a=r.standardProps&&r.standardProps.allDay===!0,o=r.standardProps&&r.standardProps.hasEnd===!1,l=Object.assign({},s);return a&&(l.range=lC(l.range)),r.datesDelta&&e.startEditable&&(l.range={start:n.add(l.range.start,r.datesDelta),end:n.add(l.range.end,r.datesDelta)}),r.startDelta&&e.durationEditable&&(l.range={start:n.add(l.range.start,r.startDelta),end:l.range.end}),r.endDelta&&e.durationEditable&&(l.range={start:l.range.start,end:n.add(l.range.end,r.endDelta)}),o&&(l.range={start:l.range.start,end:Nl(t.allDay,l.range.start,i)}),t.allDay&&(l.range={start:Ve(l.range.start),end:Ve(l.range.end)}),l.range.end<l.range.start&&(l.range.end=Nl(t.allDay,l.range.start,i)),l}var js=class{constructor(t,e){this.context=t,this.internalEventSource=e}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}},ze=class s{constructor(t,e,r){this._context=t,this._def=e,this._instance=r||null}setProp(t,e){if(t in cC)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(t==="id")e=Tu[t](e),this.mutate({standardProps:{publicId:e}});else if(t in Tu)e=Tu[t](e),this.mutate({standardProps:{[t]:e}});else if(t in Du){let r=Du[t](e);t==="color"?r={backgroundColor:e,borderColor:e}:t==="editable"?r={startEditable:e,durationEditable:e}:r={[t]:e},this.mutate({standardProps:{ui:r}})}else console.warn(`Could not set prop '${t}'. Use setExtendedProp instead.`)}setExtendedProp(t,e){this.mutate({extendedProps:{[t]:e}})}setStart(t,e={}){let{dateEnv:r}=this._context,i=r.createMarker(t);if(i&&this._instance){let n=this._instance.range,a=Gs(n.start,i,r,e.granularity);e.maintainDuration?this.mutate({datesDelta:a}):this.mutate({startDelta:a})}}setEnd(t,e={}){let{dateEnv:r}=this._context,i;if(!(t!=null&&(i=r.createMarker(t),!i))&&this._instance)if(i){let n=Gs(this._instance.range.end,i,r,e.granularity);this.mutate({endDelta:n})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(t,e,r={}){let{dateEnv:i}=this._context,n={allDay:r.allDay},a=i.createMarker(t),o;if(a&&!(e!=null&&(o=i.createMarker(e),!o))&&this._instance){let l=this._instance.range;r.allDay===!0&&(l=lC(l));let c=Gs(l.start,a,i,r.granularity);if(o){let d=Gs(l.end,o,i,r.granularity);xP(c,d)?this.mutate({datesDelta:c,standardProps:n}):this.mutate({startDelta:c,endDelta:d,standardProps:n})}else n.hasEnd=!1,this.mutate({datesDelta:c,standardProps:n})}}moveStart(t){let e=pe(t);e&&this.mutate({startDelta:e})}moveEnd(t){let e=pe(t);e&&this.mutate({endDelta:e})}moveDates(t){let e=pe(t);e&&this.mutate({datesDelta:e})}setAllDay(t,e={}){let r={allDay:t},{maintainDuration:i}=e;i==null&&(i=this._context.options.allDayMaintainDuration),this._def.allDay!==t&&(r.hasEnd=i),this.mutate({standardProps:r})}formatRange(t){let{dateEnv:e}=this._context,r=this._instance,i=Le(t);return this._def.hasEnd?e.formatRange(r.range.start,r.range.end,i,{forcedStartTzo:r.forcedStartTzo,forcedEndTzo:r.forcedEndTzo}):e.format(r.range.start,i,{forcedTzo:r.forcedStartTzo})}mutate(t){let e=this._instance;if(e){let r=this._def,i=this._context,{eventStore:n}=i.getCurrentData(),a=Ql(n,e.instanceId);a=Kl(a,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},t,i);let l=new s(i,r,e);this._def=a.defs[r.defId],this._instance=a.instances[e.instanceId],i.dispatch({type:"MERGE_EVENTS",eventStore:a}),i.emitter.trigger("eventChange",{oldEvent:l,event:this,relatedEvents:Bi(a,i,e),revert(){i.dispatch({type:"RESET_EVENTS",eventStore:n})}})}}remove(){let t=this._context,e=fC(this);t.dispatch({type:"REMOVE_EVENTS",eventStore:e}),t.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){t.dispatch({type:"MERGE_EVENTS",eventStore:e})}})}get source(){let{sourceId:t}=this._def;return t?new js(this._context,this._context.getCurrentData().eventSources[t]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let t=this._instance;return t?this._context.dateEnv.formatIso(t.range.start,{omitTime:this._def.allDay,forcedTzo:t.forcedStartTzo}):""}get endStr(){let t=this._instance;return t&&this._def.hasEnd?this._context.dateEnv.formatIso(t.range.end,{omitTime:this._def.allDay,forcedTzo:t.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(t={}){let e=this._def,{ui:r}=e,{startStr:i,endStr:n}=this,a={allDay:e.allDay};return e.title&&(a.title=e.title),i&&(a.start=i),n&&(a.end=n),e.publicId&&(a.id=e.publicId),e.groupId&&(a.groupId=e.groupId),e.url&&(a.url=e.url),r.display&&r.display!=="auto"&&(a.display=r.display),t.collapseColor&&r.backgroundColor&&r.backgroundColor===r.borderColor?a.color=r.backgroundColor:(r.backgroundColor&&(a.backgroundColor=r.backgroundColor),r.borderColor&&(a.borderColor=r.borderColor)),r.textColor&&(a.textColor=r.textColor),r.classNames.length&&(a.classNames=r.classNames),Object.keys(e.extendedProps).length&&(t.collapseExtendedProps?Object.assign(a,e.extendedProps):a.extendedProps=e.extendedProps),a}toJSON(){return this.toPlainObject()}};function fC(s){let t=s._def,e=s._instance;return{defs:{[t.defId]:t},instances:e?{[e.instanceId]:e}:{}}}function Bi(s,t,e){let{defs:r,instances:i}=s,n=[],a=e?e.instanceId:"";for(let o in i){let l=i[o],c=r[l.defId];l.instanceId!==a&&n.push(new ze(t,c,l))}return n}function Cu(s,t,e,r){let i={},n={},a={},o=[],l=[],c=xu(s.defs,t);for(let d in s.defs){let u=s.defs[d];c[u.defId].display==="inverse-background"&&(u.groupId?(i[u.groupId]=[],a[u.groupId]||(a[u.groupId]=u)):n[d]=[])}for(let d in s.instances){let u=s.instances[d],h=s.defs[u.defId],p=c[h.defId],f=u.range,m=!h.allDay&&r?Lm(f,r):f,g=Rr(m,e);g&&(p.display==="inverse-background"?h.groupId?i[h.groupId].push(g):n[u.defId].push(g):p.display!=="none"&&(p.display==="background"?o:l).push({def:h,ui:p,instance:u,range:g,isStart:m.start&&m.start.valueOf()===g.start.valueOf(),isEnd:m.end&&m.end.valueOf()===g.end.valueOf()}))}for(let d in i){let u=i[d],h=LD(u,e);for(let p of h){let f=a[d],m=c[f.defId];o.push({def:f,ui:m,instance:null,range:p,isStart:!1,isEnd:!1})}}for(let d in n){let u=n[d],h=LD(u,e);for(let p of h)o.push({def:s.defs[d],ui:c[d],instance:null,range:p,isStart:!1,isEnd:!1})}return{bg:o,fg:l}}function jm(s){return s.ui.display==="background"||s.ui.display==="inverse-background"}function BD(s,t){s.fcSeg=t}function vs(s){return s.fcSeg||s.parentNode.fcSeg||null}function xu(s,t){return Kr(s,e=>mC(e,t))}function mC(s,t){let e=[];return t[""]&&e.push(t[""]),t[s.defId]&&e.push(t[s.defId]),e.push(s.ui),Bm(e)}function Zl(s,t){let e=s.map(FN);return e.sort((r,i)=>KD(r,i,t)),e.map(r=>r._seg)}function FN(s){let{eventRange:t}=s,e=t.def,r=t.instance?t.instance.range:t.range,i=r.start?r.start.valueOf():0,n=r.end?r.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},e.extendedProps),e),{id:e.publicId,start:i,end:n,duration:n-i,allDay:Number(e.allDay),_seg:s})}function LN(s,t){let{pluginHooks:e}=t,r=e.isDraggableTransformers,{def:i,ui:n}=s.eventRange,a=n.startEditable;for(let o of r)a=o(a,i,n,t);return a}function HN(s,t){return s.isStart&&s.eventRange.ui.durationEditable&&t.options.eventResizableFromStart}function BN(s,t){return s.isEnd&&s.eventRange.ui.durationEditable}function Wu(s,t,e,r,i,n,a){let{dateEnv:o,options:l}=e,{displayEventTime:c,displayEventEnd:d}=l,u=s.eventRange.def,h=s.eventRange.instance;c==null&&(c=r!==!1),d==null&&(d=i!==!1);let p=h.range.start,f=h.range.end,m=n||s.start||s.eventRange.range.start,g=a||s.end||s.eventRange.range.end,y=Ve(p).valueOf()===Ve(m).valueOf(),w=Ve(Ri(f,-1)).valueOf()===Ve(Ri(g,-1)).valueOf();return c&&!u.allDay&&(y||w)?(m=y?p:m,g=w?f:g,d&&u.hasEnd?o.formatRange(m,g,t,{forcedStartTzo:n?null:h.forcedStartTzo,forcedEndTzo:a?null:h.forcedEndTzo}):o.format(m,t,{forcedTzo:n?null:h.forcedStartTzo})):""}function wi(s,t,e){let r=s.eventRange.range;return{isPast:r.end<=(e||t.start),isFuture:r.start>=(e||t.end),isToday:t&&Qr(t,r.start)}}function UN(s){let t=["fc-event"];return s.isMirror&&t.push("fc-event-mirror"),s.isDraggable&&t.push("fc-event-draggable"),(s.isStartResizable||s.isEndResizable)&&t.push("fc-event-resizable"),s.isDragging&&t.push("fc-event-dragging"),s.isResizing&&t.push("fc-event-resizing"),s.isSelected&&t.push("fc-event-selected"),s.isStart&&t.push("fc-event-start"),s.isEnd&&t.push("fc-event-end"),s.isPast&&t.push("fc-event-past"),s.isToday&&t.push("fc-event-today"),s.isFuture&&t.push("fc-event-future"),t}function Jl(s){return s.instance?s.instance.instanceId:`${s.def.defId}:${s.range.start.toISOString()}`}function Yu(s,t){let{def:e,instance:r}=s.eventRange,{url:i}=e;if(i)return{href:i};let{emitter:n,options:a}=t,{eventInteractive:o}=a;return o==null&&(o=e.interactive,o==null&&(o=!!n.hasHandlers("eventClick"))),o?GD(l=>{n.trigger("eventClick",{el:l.target,event:new ze(t,e,r),jsEvent:l,view:t.viewApi})}):{}}var $N={start:N,end:N,allDay:Boolean};function VN(s,t,e){let r=WN(s,t),{range:i}=r;if(!i.start)return null;if(!i.end){if(e==null)return null;i.end=t.add(i.start,e)}return r}function WN(s,t){let{refined:e,extra:r}=ql(s,$N),i=e.start?t.createMarkerMeta(e.start):null,n=e.end?t.createMarkerMeta(e.end):null,{allDay:a}=e;return a==null&&(a=i&&i.isTimeUnspecified&&(!n||n.isTimeUnspecified)),Object.assign({range:{start:i?i.marker:null,end:n?n.marker:null},allDay:a},r)}function zm(s,t){return oC(s.range,t.range)&&s.allDay===t.allDay&&YN(s,t)}function YN(s,t){for(let e in t)if(e!=="range"&&e!=="allDay"&&s[e]!==t[e])return!1;for(let e in s)if(!(e in t))return!1;return!0}function jN(s,t){return Object.assign(Object.assign({},gC(s.range,t,s.allDay)),{allDay:s.allDay})}function qm(s,t,e){return Object.assign(Object.assign({},gC(s,t,e)),{timeZone:t.timeZone})}function gC(s,t,e){return{start:t.toDate(s.start),end:t.toDate(s.end),startStr:t.formatIso(s.start,{omitTime:e}),endStr:t.formatIso(s.end,{omitTime:e})}}function zN(s,t,e){let r=Gl({editable:!1},e),i=io(r.refined,r.extra,"",s.allDay,!0,e);return{def:i,ui:mC(i,t),instance:uo(i.defId,s.range),range:s.range,isStart:!0,isEnd:!0}}function Gm(s,t,e){let r=!1,i=function(o){r||(r=!0,t(o))},n=function(o){r||(r=!0,e(o))},a=s(i,n);a&&typeof a.then=="function"&&a.then(i,n)}var Mu=class extends Error{constructor(t,e){super(t),this.response=e}};function Qm(s,t,e){s=s.toUpperCase();let r={method:s};return s==="GET"?t+=(t.indexOf("?")===-1?"?":"&")+new URLSearchParams(e):(r.body=new URLSearchParams(e),r.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(t,r).then(i=>{if(i.ok)return i.json().then(n=>[n,i],()=>{throw new Mu("Failure parsing JSON",i)});throw new Mu("Request failed",i)})}var em;function Km(){return em==null&&(em=qN()),em}function qN(){if(typeof document=="undefined")return!0;let s=document.createElement("div");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.innerHTML="<table><tr><td><div></div></td></tr></table>",s.querySelector("table").style.height="100px",s.querySelector("div").style.height="100%",document.body.appendChild(s);let e=s.querySelector("div").offsetHeight>0;return document.body.removeChild(s),e}var Rl=class extends De{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{Al(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{Al(()=>{this.setState({forPrint:!1})})}}render(){let{props:t}=this,{options:e}=t,{forPrint:r}=this.state,i=r||e.height==="auto"||e.contentHeight==="auto",n=!i&&e.height!=null?e.height:"",a=["fc",r?"fc-media-print":"fc-media-screen",`fc-direction-${e.direction}`,t.theme.getClass("root")];return Km()||a.push("fc-liquid-hack"),t.children(a,n,i,r)}componentDidMount(){let{emitter:t}=this.props;t.on("_beforeprint",this.handleBeforePrint),t.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:t}=this.props;t.off("_beforeprint",this.handleBeforePrint),t.off("_afterprint",this.handleAfterPrint)}},yi=class{constructor(t){this.component=t.component,this.isHitComboAllowed=t.isHitComboAllowed||null}destroy(){}};function yC(s,t){return{component:s,el:t.el,useEventCenter:t.useEventCenter!=null?t.useEventCenter:!0,isHitComboAllowed:t.isHitComboAllowed||null}}function Xl(s){return{[s.component.uid]:s}}var ia={},Zr=class extends Ut{constructor(t,e){super(t,e),this.handleRefresh=()=>{let r=this.computeTiming();r.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(r.state),this.clearTimeout(),this.setTimeout(r.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:t,state:e}=this;return t.children(e.nowDate,e.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(t){t.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:t,context:e}=this,r=e.nowManager.getDateMarker(),{nowIndicatorSnap:i}=e.options;i==="auto"&&(i=/year|month|week|day/.test(t.unit)||(t.unitValue||1)===1);let n,a;return i?(n=e.dateEnv.startOf(r,t.unit),a=e.dateEnv.add(n,pe(1,t.unit)).valueOf()-r.valueOf()):(n=r,a=1e3*60),a=Math.min(1e3*60*60*24,a),{state:{nowDate:n,todayRange:GN(n)},waitMs:a}}setTimeout(t=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{let e=this.computeTiming();this.setState(e.state,()=>{this.setTimeout(e.waitMs)})},t)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};Zr.contextType=Jr;function GN(s){let t=Ve(s),e=pt(t,1);return{start:t,end:e}}var Ol=class{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(t){this.currentDataManager.dispatch(t)}get view(){return this.getCurrentData().viewApi}batchRendering(t){t()}updateSize(){this.trigger("_resize",!0)}setOption(t,e){this.dispatch({type:"SET_OPTION",optionName:t,rawOptionValue:e})}getOption(t){return this.currentDataManager.currentCalendarOptionsInput[t]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(t,e){let{currentDataManager:r}=this;r.currentCalendarOptionsRefiners[t]?r.emitter.on(t,e):console.warn(`Unknown listener name '${t}'`)}off(t,e){this.currentDataManager.emitter.off(t,e)}trigger(t,...e){this.currentDataManager.emitter.trigger(t,...e)}changeView(t,e){this.batchRendering(()=>{if(this.unselect(),e)if(e.start&&e.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:t}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:e});else{let{dateEnv:r}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:t,dateMarker:r.createMarker(e)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:t})})}zoomTo(t,e){let r=this.getCurrentData(),i;e=e||"day",i=r.viewSpecs[e]||this.getUnitViewSpec(e),this.unselect(),i?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:i.type,dateMarker:t}):this.dispatch({type:"CHANGE_DATE",dateMarker:t})}getUnitViewSpec(t){let{viewSpecs:e,toolbarConfig:r}=this.getCurrentData(),i=[].concat(r.header?r.header.viewsWithButtons:[],r.footer?r.footer.viewsWithButtons:[]),n,a;for(let o in e)i.push(o);for(n=0;n<i.length;n+=1)if(a=e[i[n]],a&&a.singleUnit===t)return a;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.addYears(t.currentDate,-1)})}nextYear(){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.addYears(t.currentDate,1)})}today(){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.nowManager.getDateMarker()})}gotoDate(t){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.createMarker(t)})}incrementDate(t){let e=this.getCurrentData(),r=pe(t);r&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.add(e.currentDate,r)}))}getDate(){let t=this.getCurrentData();return t.dateEnv.toDate(t.currentDate)}formatDate(t,e){let{dateEnv:r}=this.getCurrentData();return r.format(r.createMarker(t),Le(e))}formatRange(t,e,r){let{dateEnv:i}=this.getCurrentData();return i.formatRange(i.createMarker(t),i.createMarker(e),Le(r),r)}formatIso(t,e){let{dateEnv:r}=this.getCurrentData();return r.formatIso(r.createMarker(t),{omitTime:e})}select(t,e){let r;e==null?t.start!=null?r=t:r={start:t,end:null}:r={start:t,end:e};let i=this.getCurrentData(),n=VN(r,i.dateEnv,pe({days:1}));n&&(this.dispatch({type:"SELECT_DATES",selection:n}),Vu(n,null,i))}unselect(t){let e=this.getCurrentData();e.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),NN(t,e))}addEvent(t,e){if(t instanceof ze){let a=t._def,o=t._instance;return this.getCurrentData().eventStore.defs[a.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:qn({def:a,instance:o})}),this.triggerEventAdd(t)),t}let r=this.getCurrentData(),i;if(e instanceof js)i=e.internalEventSource;else if(typeof e=="boolean")e&&([i]=Hu(r.eventSources));else if(e!=null){let a=this.getEventSourceById(e);if(!a)return console.warn(`Could not find an event source with ID "${e}"`),null;i=a.internalEventSource}let n=dC(t,i,r,!1);if(n){let a=new ze(r,n.def,n.def.recurringDef?null:n.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:qn(n)}),this.triggerEventAdd(a),a}return null}triggerEventAdd(t){let{emitter:e}=this.getCurrentData();e.trigger("eventAdd",{event:t,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:fC(t)})}})}getEventById(t){let e=this.getCurrentData(),{defs:r,instances:i}=e.eventStore;t=String(t);for(let n in r){let a=r[n];if(a.publicId===t){if(a.recurringDef)return new ze(e,a,null);for(let o in i){let l=i[o];if(l.defId===a.defId)return new ze(e,a,l)}}}return null}getEvents(){let t=this.getCurrentData();return Bi(t.eventStore,t)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let t=this.getCurrentData(),e=t.eventSources,r=[];for(let i in e)r.push(new js(t,e[i]));return r}getEventSourceById(t){let e=this.getCurrentData(),r=e.eventSources;t=String(t);for(let i in r)if(r[i].publicId===t)return new js(e,r[i]);return null}addEventSource(t){let e=this.getCurrentData();if(t instanceof js)return e.eventSources[t.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[t.internalEventSource]}),t;let r=Um(t,e);return r?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[r]}),new js(e,r)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(t){let e=pe(t);e&&this.trigger("_scrollRequest",{time:e})}};function Zm(s,t){return s.left>=t.left&&s.left<t.right&&s.top>=t.top&&s.top<t.bottom}function ju(s,t){let e={left:Math.max(s.left,t.left),right:Math.min(s.right,t.right),top:Math.max(s.top,t.top),bottom:Math.min(s.bottom,t.bottom)};return e.left<e.right&&e.top<e.bottom?e:!1}function Jm(s,t){return{left:Math.min(Math.max(s.left,t.left),t.right),top:Math.min(Math.max(s.top,t.top),t.bottom)}}function Xm(s){return{left:(s.left+s.right)/2,top:(s.top+s.bottom)/2}}function eg(s,t){return{left:s.left-t.left,top:s.top-t.top}}var tm=Dt(),Fl=class{constructor(){this.getKeysForEventDefs=ne(this._getKeysForEventDefs),this.splitDateSelection=ne(this._splitDateSpan),this.splitEventStore=ne(this._splitEventStore),this.splitIndividualUi=ne(this._splitIndividualUi),this.splitEventDrag=ne(this._splitInteraction),this.splitEventResize=ne(this._splitInteraction),this.eventUiBuilders={}}splitProps(t){let e=this.getKeyInfo(t),r=this.getKeysForEventDefs(t.eventStore),i=this.splitDateSelection(t.dateSelection),n=this.splitIndividualUi(t.eventUiBases,r),a=this.splitEventStore(t.eventStore,r),o=this.splitEventDrag(t.eventDrag),l=this.splitEventResize(t.eventResize),c={};this.eventUiBuilders=Kr(e,(d,u)=>this.eventUiBuilders[u]||ne(QN));for(let d in e){let u=e[d],h=a[d]||tm,p=this.eventUiBuilders[d];c[d]={businessHours:u.businessHours||t.businessHours,dateSelection:i[d]||null,eventStore:h,eventUiBases:p(t.eventUiBases[""],u.ui,n[d]),eventSelection:h.instances[t.eventSelection]?t.eventSelection:"",eventDrag:o[d]||null,eventResize:l[d]||null}}return c}_splitDateSpan(t){let e={};if(t){let r=this.getKeysForDateSpan(t);for(let i of r)e[i]=t}return e}_getKeysForEventDefs(t){return Kr(t.defs,e=>this.getKeysForEventDef(e))}_splitEventStore(t,e){let{defs:r,instances:i}=t,n={};for(let a in r)for(let o of e[a])n[o]||(n[o]=Dt()),n[o].defs[a]=r[a];for(let a in i){let o=i[a];for(let l of e[o.defId])n[l]&&(n[l].instances[a]=o)}return n}_splitIndividualUi(t,e){let r={};for(let i in t)if(i)for(let n of e[i])r[n]||(r[n]={}),r[n][i]=t[i];return r}_splitInteraction(t){let e={};if(t){let r=this._splitEventStore(t.affectedEvents,this._getKeysForEventDefs(t.affectedEvents)),i=this._getKeysForEventDefs(t.mutatedEvents),n=this._splitEventStore(t.mutatedEvents,i),a=o=>{e[o]||(e[o]={affectedEvents:r[o]||tm,mutatedEvents:n[o]||tm,isEvent:t.isEvent})};for(let o in r)a(o);for(let o in n)a(o)}return e}};function QN(s,t,e){let r=[];s&&r.push(s),t&&r.push(t);let i={"":Bm(r)};return e&&Object.assign(i,e),i}function tg(s,t,e,r){return{dow:s.getUTCDay(),isDisabled:!!(r&&(!r.activeRange||!Qr(r.activeRange,s))),isOther:!!(r&&!Qr(r.currentRange,s)),isToday:!!(t&&Qr(t,s)),isPast:!!(e?s<e:t&&s<t.start),isFuture:!!(e?s>e:t&&s>=t.end)}}function zu(s,t){let e=["fc-day",`fc-day-${AP[s.dow]}`];return s.isDisabled?e.push("fc-day-disabled"):(s.isToday&&(e.push("fc-day-today"),e.push(t.getClass("today"))),s.isPast&&e.push("fc-day-past"),s.isFuture&&e.push("fc-day-future"),s.isOther&&e.push("fc-day-other")),e}var KN=Le({year:"numeric",month:"long",day:"numeric"}),ZN=Le({week:"long"});function sa(s,t,e="day",r=!0){let{dateEnv:i,options:n,calendarApi:a}=s,o=i.format(t,e==="week"?ZN:KN);if(n.navLinks){let l=i.toDate(t),c=d=>{let u=e==="day"?n.navLinkDayClick:e==="week"?n.navLinkWeekClick:null;typeof u=="function"?u.call(a,i.toDate(t),d):(typeof u=="string"&&(e=u),a.zoomTo(t,e))};return Object.assign({title:ao(n.navLinkHint,[o,l],o),"data-navlink":""},r?qD(c):{onClick:c})}return{"aria-label":o}}var rm=null;function vC(){return rm===null&&(rm=JN()),rm}function JN(){let s=document.createElement("div");ra(s,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),s.innerHTML="<div></div>",document.body.appendChild(s);let e=s.firstChild.getBoundingClientRect().left>s.getBoundingClientRect().left;return Vl(s),e}var im;function wC(){return im||(im=XN()),im}function XN(){let s=document.createElement("div");s.style.overflow="scroll",s.style.position="absolute",s.style.top="-9999px",s.style.left="-9999px",document.body.appendChild(s);let t=TC(s);return document.body.removeChild(s),t}function TC(s){return{x:s.offsetHeight-s.clientHeight,y:s.offsetWidth-s.clientWidth}}function bC(s,t=!1){let e=window.getComputedStyle(s),r=parseInt(e.borderLeftWidth,10)||0,i=parseInt(e.borderRightWidth,10)||0,n=parseInt(e.borderTopWidth,10)||0,a=parseInt(e.borderBottomWidth,10)||0,o=TC(s),l=o.y-r-i,c=o.x-n-a,d={borderLeft:r,borderRight:i,borderTop:n,borderBottom:a,scrollbarBottom:c,scrollbarLeft:0,scrollbarRight:0};return vC()&&e.direction==="rtl"?d.scrollbarLeft=l:d.scrollbarRight=l,t&&(d.paddingLeft=parseInt(e.paddingLeft,10)||0,d.paddingRight=parseInt(e.paddingRight,10)||0,d.paddingTop=parseInt(e.paddingTop,10)||0,d.paddingBottom=parseInt(e.paddingBottom,10)||0),d}function rg(s,t=!1,e){let r=e?s.getBoundingClientRect():ec(s),i=bC(s,t),n={left:r.left+i.borderLeft+i.scrollbarLeft,right:r.right-i.borderRight-i.scrollbarRight,top:r.top+i.borderTop,bottom:r.bottom-i.borderBottom-i.scrollbarBottom};return t&&(n.left+=i.paddingLeft,n.right-=i.paddingRight,n.top+=i.paddingTop,n.bottom-=i.paddingBottom),n}function ec(s){let t=s.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY,right:t.right+window.scrollX,bottom:t.bottom+window.scrollY}}function eR(s){let t=qu(s),e=s.getBoundingClientRect();for(let r of t){let i=ju(e,r.getBoundingClientRect());if(i)e=i;else return null}return e}function qu(s){let t=[];for(;s instanceof HTMLElement;){let e=window.getComputedStyle(s);if(e.position==="fixed")break;/(auto|scroll)/.test(e.overflow+e.overflowY+e.overflowX)&&t.push(s),s=s.parentNode}return t}var vi=class{constructor(t,e,r,i){this.els=e;let n=this.originClientRect=t.getBoundingClientRect();r&&this.buildElHorizontals(n.left),i&&this.buildElVerticals(n.top)}buildElHorizontals(t){let e=[],r=[];for(let i of this.els){let n=i.getBoundingClientRect();e.push(n.left-t),r.push(n.right-t)}this.lefts=e,this.rights=r}buildElVerticals(t){let e=[],r=[];for(let i of this.els){let n=i.getBoundingClientRect();e.push(n.top-t),r.push(n.bottom-t)}this.tops=e,this.bottoms=r}leftToIndex(t){let{lefts:e,rights:r}=this,i=e.length,n;for(n=0;n<i;n+=1)if(t>=e[n]&&t<r[n])return n}topToIndex(t){let{tops:e,bottoms:r}=this,i=e.length,n;for(n=0;n<i;n+=1)if(t>=e[n]&&t<r[n])return n}getWidth(t){return this.rights[t]-this.lefts[t]}getHeight(t){return this.bottoms[t]-this.tops[t]}similarTo(t){return gu(this.tops||[],t.tops||[])&&gu(this.bottoms||[],t.bottoms||[])&&gu(this.lefts||[],t.lefts||[])&&gu(this.rights||[],t.rights||[])}};function gu(s,t){let e=s.length;if(e!==t.length)return!1;for(let r=0;r<e;r++)if(Math.round(s[r])!==Math.round(t[r]))return!1;return!0}var Gn=class{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}},Ll=class extends Gn{constructor(t){super(),this.el=t}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(t){this.el.scrollTop=t}setScrollLeft(t){this.el.scrollLeft=t}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}},Hl=class extends Gn{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(t){window.scroll(window.scrollX,t)}setScrollLeft(t){window.scroll(t,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}},Pt=class extends De{constructor(){super(...arguments),this.uid=gs()}prepareHits(){}queryHit(t,e,r,i){return null}isValidSegDownEl(t){return!this.props.eventDrag&&!this.props.eventResize&&!Et(t,".fc-event-mirror")}isValidDateDownEl(t){return!Et(t,".fc-event:not(.fc-bg-event)")&&!Et(t,".fc-more-link")&&!Et(t,"a[data-navlink]")&&!Et(t,".fc-popover")}};var Qn=class{constructor(t=e=>e.thickness||1){this.getEntryThickness=t,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(t){let e=[];for(let r of t)this.insertEntry(r,e);return e}insertEntry(t,e){let r=this.findInsertion(t);this.isInsertionValid(r,t)?this.insertEntryAt(t,r):this.handleInvalidInsertion(r,t,e)}isInsertionValid(t,e){return(this.maxCoord===-1||t.levelCoord+this.getEntryThickness(e)<=this.maxCoord)&&(this.maxStackCnt===-1||t.stackCnt<this.maxStackCnt)}handleInvalidInsertion(t,e,r){if(this.allowReslicing&&t.touchingEntry){let i=Object.assign(Object.assign({},e),{span:tc(e.span,t.touchingEntry.span)});r.push(i),this.splitEntry(e,t.touchingEntry,r)}else r.push(e)}splitEntry(t,e,r){let i=t.span,n=e.span;i.start<n.start&&this.insertEntry({index:t.index,thickness:t.thickness,span:{start:i.start,end:n.start}},r),i.end>n.end&&this.insertEntry({index:t.index,thickness:t.thickness,span:{start:n.end,end:i.end}},r)}insertEntryAt(t,e){let{entriesByLevel:r,levelCoords:i}=this;e.lateral===-1?(sm(i,e.level,e.levelCoord),sm(r,e.level,[t])):sm(r[e.level],e.lateral,t),this.stackCnts[Fi(t)]=e.stackCnt}findInsertion(t){let{levelCoords:e,entriesByLevel:r,strictOrder:i,stackCnts:n}=this,a=e.length,o=0,l=-1,c=-1,d=null,u=0;for(let f=0;f<a;f+=1){let m=e[f];if(!i&&m>=o+this.getEntryThickness(t))break;let g=r[f],y,w=Ul(g,t.span.start,Bl),T=w[0]+w[1];for(;(y=g[T])&&y.span.start<t.span.end;){let S=m+this.getEntryThickness(y);S>o&&(o=S,d=y,l=f,c=T),S===o&&(u=Math.max(u,n[Fi(y)]+1)),T+=1}}let h=0;if(d)for(h=l+1;h<a&&e[h]<o;)h+=1;let p=-1;return h<a&&e[h]===o&&(p=Ul(r[h],t.span.end,Bl)[0]),{touchingLevel:l,touchingLateral:c,touchingEntry:d,stackCnt:u,levelCoord:o,level:h,lateral:p}}toRects(){let{entriesByLevel:t,levelCoords:e}=this,r=t.length,i=[];for(let n=0;n<r;n+=1){let a=t[n],o=e[n];for(let l of a)i.push(Object.assign(Object.assign({},l),{thickness:this.getEntryThickness(l),levelCoord:o}))}return i}};function Bl(s){return s.span.end}function Fi(s){return s.index+":"+s.span.start}function ig(s){let t=[];for(let e of s){let r=[],i={span:e.span,entries:[e]};for(let n of t)tc(n.span,i.span)?i={entries:n.entries.concat(i.entries),span:tR(n.span,i.span)}:r.push(n);r.push(i),t=r}return t}function tR(s,t){return{start:Math.min(s.start,t.start),end:Math.max(s.end,t.end)}}function tc(s,t){let e=Math.max(s.start,t.start),r=Math.min(s.end,t.end);return e<r?{start:e,end:r}:null}function sm(s,t,e){s.splice(t,0,e)}function Ul(s,t,e){let r=0,i=s.length;if(!i||t<e(s[r]))return[0,0];if(t>e(s[i-1]))return[i,0];for(;r<i;){let n=Math.floor(r+(i-r)/2),a=e(s[n]);if(t<a)i=n;else if(t>a)r=n+1;else return[n,1]}return[r,0]}var $l=class{constructor(t,e){this.emitter=new ps}destroy(){}setMirrorIsVisible(t){}setMirrorNeedsRevert(t){}setAutoScrollEnabled(t){}},po={},rR={startTime:pe,duration:pe,create:Boolean,sourceId:String};function rc(s){let{refined:t,extra:e}=ql(s,rR);return{startTime:t.startTime||null,duration:t.duration||null,create:t.create!=null?t.create:!0,sourceId:t.sourceId,leftoverProps:e}}function kC(s,t){return!s||t>10?Le({weekday:"short"}):t>1?Le({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):Le({weekday:"long"})}var SC="fc-col-header-cell";function EC(s){return s.text}var _u=class extends De{render(){let{dateEnv:t,options:e,theme:r,viewApi:i}=this.context,{props:n}=this,{date:a,dateProfile:o}=n,l=tg(a,n.todayRange,null,o),c=[SC].concat(zu(l,r)),d=t.format(a,n.dayHeaderFormat),u=!l.isDisabled&&n.colCnt>1?sa(this.context,a):{},h=t.toDate(a);t.namedTimeZoneImpl&&(h=Ri(h,36e5));let p=Object.assign(Object.assign(Object.assign({date:h,view:i},n.extraRenderProps),{text:d}),l);return b(It,{elTag:"th",elClasses:c,elAttrs:Object.assign({role:"columnheader",colSpan:n.colSpan,"data-date":l.isDisabled?void 0:zl(a)},n.extraDataAttrs),renderProps:p,generatorName:"dayHeaderContent",customGenerator:e.dayHeaderContent,defaultGenerator:EC,classNameGenerator:e.dayHeaderClassNames,didMount:e.dayHeaderDidMount,willUnmount:e.dayHeaderWillUnmount},f=>b("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&b(f,{elTag:"a",elAttrs:u,elClasses:["fc-col-header-cell-cushion",n.isSticky&&"fc-sticky"]})))}},iR=Le({weekday:"long"}),Au=class extends De{render(){let{props:t}=this,{dateEnv:e,theme:r,viewApi:i,options:n}=this.context,a=pt(new Date(2592e5),t.dow),o={dow:t.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=e.format(a,t.dayHeaderFormat),c=Object.assign(Object.assign(Object.assign(Object.assign({date:a},o),{view:i}),t.extraRenderProps),{text:l});return b(It,{elTag:"th",elClasses:[SC,...zu(o,r),...t.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:t.colSpan},t.extraDataAttrs),renderProps:c,generatorName:"dayHeaderContent",customGenerator:n.dayHeaderContent,defaultGenerator:EC,classNameGenerator:n.dayHeaderClassNames,didMount:n.dayHeaderDidMount,willUnmount:n.dayHeaderWillUnmount},d=>b("div",{className:"fc-scrollgrid-sync-inner"},b(d,{elTag:"a",elClasses:["fc-col-header-cell-cushion",t.isSticky&&"fc-sticky"],elAttrs:{"aria-label":e.format(a,iR)}})))}},fs=class extends De{constructor(){super(...arguments),this.createDayHeaderFormatter=ne(sR)}render(){let{context:t}=this,{dates:e,dateProfile:r,datesRepDistinctDays:i,renderIntro:n}=this.props,a=this.createDayHeaderFormatter(t.options.dayHeaderFormat,i,e.length);return b(Zr,{unit:"day"},(o,l)=>b("tr",{role:"row"},n&&n("day"),e.map(c=>i?b(_u,{key:c.toISOString(),date:c,dateProfile:r,todayRange:l,colCnt:e.length,dayHeaderFormat:a}):b(Au,{key:c.getUTCDay(),dow:c.getUTCDay(),dayHeaderFormat:a}))))}};function sR(s,t,e){return s||kC(t,e)}var Kn=class{constructor(t,e){let r=t.start,{end:i}=t,n=[],a=[],o=-1;for(;r<i;)e.isHiddenDay(r)?n.push(o+.5):(o+=1,n.push(o),a.push(r)),r=pt(r,1);this.dates=a,this.indices=n,this.cnt=a.length}sliceRange(t){let e=this.getDateDayIndex(t.start),r=this.getDateDayIndex(pt(t.end,-1)),i=Math.max(0,e),n=Math.min(this.cnt-1,r);return i=Math.ceil(i),n=Math.floor(n),i<=n?{firstIndex:i,lastIndex:n,isStart:e===i,isEnd:r===n}:null}getDateDayIndex(t){let{indices:e}=this,r=Math.floor(ys(this.dates[0],t));return r<0?e[0]-1:r>=e.length?e[e.length-1]+1:e[r]}},Zn=class{constructor(t,e){let{dates:r}=t,i,n,a;if(e){for(n=r[0].getUTCDay(),i=1;i<r.length&&r[i].getUTCDay()!==n;i+=1);a=Math.ceil(r.length/i)}else a=1,i=r.length;this.rowCnt=a,this.colCnt=i,this.daySeries=t,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let t=[];for(let e=0;e<this.rowCnt;e+=1){let r=[];for(let i=0;i<this.colCnt;i+=1)r.push(this.buildCell(e,i));t.push(r)}return t}buildCell(t,e){let r=this.daySeries.dates[t*this.colCnt+e];return{key:r.toISOString(),date:r}}buildHeaderDates(){let t=[];for(let e=0;e<this.colCnt;e+=1)t.push(this.cells[0][e].date);return t}sliceRange(t){let{colCnt:e}=this,r=this.daySeries.sliceRange(t),i=[];if(r){let{firstIndex:n,lastIndex:a}=r,o=n;for(;o<=a;){let l=Math.floor(o/e),c=Math.min((l+1)*e,a+1);i.push({row:l,firstCol:o%e,lastCol:(c-1)%e,isStart:r.isStart&&o===n,isEnd:r.isEnd&&c-1===a}),o=c}}return i}},Jn=class{constructor(){this.sliceBusinessHours=ne(this._sliceBusinessHours),this.sliceDateSelection=ne(this._sliceDateSpan),this.sliceEventStore=ne(this._sliceEventStore),this.sliceEventDrag=ne(this._sliceInteraction),this.sliceEventResize=ne(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(t,e,r,i,...n){let{eventUiBases:a}=t,o=this.sliceEventStore(t.eventStore,a,e,r,...n);return{dateSelectionSegs:this.sliceDateSelection(t.dateSelection,e,r,a,i,...n),businessHourSegs:this.sliceBusinessHours(t.businessHours,e,r,i,...n),fgEventSegs:o.fg,bgEventSegs:o.bg,eventDrag:this.sliceEventDrag(t.eventDrag,a,e,r,...n),eventResize:this.sliceEventResize(t.eventResize,a,e,r,...n),eventSelection:t.eventSelection}}sliceNowDate(t,e,r,i,...n){return this._sliceDateSpan({range:{start:t,end:Ri(t,1)},allDay:!1},e,r,{},i,...n)}_sliceBusinessHours(t,e,r,i,...n){return t?this._sliceEventStore(zn(t,yu(e,!!r),i),{},e,r,...n).bg:[]}_sliceEventStore(t,e,r,i,...n){if(t){let a=Cu(t,e,yu(r,!!i),i);return{bg:this.sliceEventRanges(a.bg,n),fg:this.sliceEventRanges(a.fg,n)}}return{bg:[],fg:[]}}_sliceInteraction(t,e,r,i,...n){if(!t)return null;let a=Cu(t.mutatedEvents,e,yu(r,!!i),i);return{segs:this.sliceEventRanges(a.fg,n),affectedInstances:t.affectedEvents.instances,isEvent:t.isEvent}}_sliceDateSpan(t,e,r,i,n,...a){if(!t)return[];let o=yu(e,!!r),l=Rr(t.range,o);if(l){t=Object.assign(Object.assign({},t),{range:l});let c=zN(t,i,n),d=this.sliceRange(t.range,...a);for(let u of d)u.eventRange=c;return d}return[]}sliceEventRanges(t,e){let r=[];for(let i of t)r.push(...this.sliceEventRange(i,e));return r}sliceEventRange(t,e){let r=t.range;this.forceDayIfListItem&&t.ui.display==="list-item"&&(r={start:r.start,end:pt(r.start,1)});let i=this.sliceRange(r,...e);for(let n of i)n.eventRange=t,n.isStart=t.isStart&&n.isStart,n.isEnd=t.isEnd&&n.isEnd;return i}};function yu(s,t){let e=s.activeRange;return t?e:{start:Ri(e.start,s.slotMinTime.milliseconds),end:Ri(e.end,s.slotMaxTime.milliseconds-864e5)}}function ic(s,t,e){let{instances:r}=s.mutatedEvents;for(let i in r)if(!co(t.validRange,r[i].range))return!1;return DC({eventDrag:s},e)}function sg(s,t,e){return co(t.validRange,s.range)?DC({dateSelection:s},e):!1}function DC(s,t){let e=t.getCurrentData(),r=Object.assign({businessHours:e.businessHours,dateSelection:"",eventStore:e.eventStore,eventUiBases:e.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},s);return(t.pluginHooks.isPropsValid||CC)(r,t)}function CC(s,t,e={},r){return!(s.eventDrag&&!nR(s,t,e,r)||s.dateSelection&&!aR(s,t,e,r))}function nR(s,t,e,r){let i=t.getCurrentData(),n=s.eventDrag,a=n.mutatedEvents,o=a.defs,l=a.instances,c=xu(o,n.isEvent?s.eventUiBases:{"":i.selectionConfig});r&&(c=Kr(c,r));let d=xN(s.eventStore,n.affectedEvents.instances),u=d.defs,h=d.instances,p=xu(u,s.eventUiBases);for(let f in l){let m=l[f],g=m.range,y=c[m.defId],w=o[m.defId];if(!xC(y.constraints,g,d,s.businessHours,t))return!1;let{eventOverlap:T}=t.options,S=typeof T=="function"?T:null;for(let I in h){let F=h[I];if(Bu(g,F.range)&&(p[F.defId].overlap===!1&&n.isEvent||y.overlap===!1||S&&!S(new ze(t,u[F.defId],F),new ze(t,w,m))))return!1}let x=i.eventStore;for(let I of y.allows){let F=Object.assign(Object.assign({},e),{range:m.range,allDay:w.allDay}),A=x.defs[w.defId],L=x.instances[f],G;if(A?G=new ze(t,A,L):G=new ze(t,w),!I(Ym(F,t),G))return!1}}return!0}function aR(s,t,e,r){let i=s.eventStore,n=i.defs,a=i.instances,o=s.dateSelection,l=o.range,{selectionConfig:c}=t.getCurrentData();if(r&&(c=r(c)),!xC(c.constraints,l,i,s.businessHours,t))return!1;let{selectOverlap:d}=t.options,u=typeof d=="function"?d:null;for(let h in a){let p=a[h];if(Bu(l,p.range)&&(c.overlap===!1||u&&!u(new ze(t,n[p.defId],p),null)))return!1}for(let h of c.allows){let p=Object.assign(Object.assign({},e),o);if(!h(Ym(p,t),null))return!1}return!0}function xC(s,t,e,r,i){for(let n of s)if(!lR(oR(n,t,e,r,i),t))return!1;return!0}function oR(s,t,e,r,i){return s==="businessHours"?nm(zn(r,t,i)):typeof s=="string"?nm($u(e,n=>n.groupId===s)):typeof s=="object"&&s?nm(zn(s,t,i)):[]}function nm(s){let{instances:t}=s,e=[];for(let r in t)e.push(t[r].range);return e}function lR(s,t){for(let e of s)if(co(e,t))return!0;return!1}var vu=/^(visible|hidden)$/,Iu=class extends De{constructor(){super(...arguments),this.handleEl=t=>{this.el=t,Or(this.props.elRef,t)}}render(){let{props:t}=this,{liquid:e,liquidIsAbsolute:r}=t,i=e&&r,n=["fc-scroller"];return e&&(r?n.push("fc-scroller-liquid-absolute"):n.push("fc-scroller-liquid")),b("div",{ref:this.handleEl,className:n.join(" "),style:{overflowX:t.overflowX,overflowY:t.overflowY,left:i&&-(t.overcomeLeft||0)||"",right:i&&-(t.overcomeRight||0)||"",bottom:i&&-(t.overcomeBottom||0)||"",marginLeft:!i&&-(t.overcomeLeft||0)||"",marginRight:!i&&-(t.overcomeRight||0)||"",marginBottom:!i&&-(t.overcomeBottom||0)||"",maxHeight:t.maxHeight||""}},t.children)}needsXScrolling(){if(vu.test(this.props.overflowX))return!1;let{el:t}=this,e=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:r}=t;for(let i=0;i<r.length;i+=1)if(r[i].getBoundingClientRect().width>e)return!0;return!1}needsYScrolling(){if(vu.test(this.props.overflowY))return!1;let{el:t}=this,e=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:r}=t;for(let i=0;i<r.length;i+=1)if(r[i].getBoundingClientRect().height>e)return!0;return!1}getXScrollbarWidth(){return vu.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return vu.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}},wr=class{constructor(t){this.masterCallback=t,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(e,r)=>{let{depths:i,currentMap:n}=this,a=!1,o=!1;e!==null?(a=r in n,n[r]=e,i[r]=(i[r]||0)+1,o=!0):(i[r]-=1,i[r]||(delete n[r],delete this.callbackMap[r],a=!0)),this.masterCallback&&(a&&this.masterCallback(null,String(r)),o&&this.masterCallback(e,String(r)))}}createRef(t){let e=this.callbackMap[t];return e||(e=this.callbackMap[t]=r=>{this.handleValue(r,String(t))}),e}collect(t,e,r){return rC(this.currentMap,t,e,r)}getAll(){return Hu(this.currentMap)}};function MC(s){let t=jD(s,".fc-scrollgrid-shrink"),e=0;for(let r of t)e=Math.max(e,EP(r));return Math.ceil(e)}function ng(s,t){return s.liquid&&t.liquid}function _C(s,t){return t.maxHeight!=null||ng(s,t)}function AC(s,t,e,r){let{expandRows:i}=e;return typeof t.content=="function"?t.content(e):b("table",{role:"presentation",className:[t.tableClassName,s.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:i?e.clientHeight:""}},e.tableColGroupNode,b(r?"thead":"tbody",{role:"presentation"},typeof t.rowContent=="function"?t.rowContent(e):t.rowContent))}function IC(s,t){return Li(s,t,Zt)}function PC(s,t){let e=[];for(let r of s){let i=r.span||1;for(let n=0;n<i;n+=1)e.push(b("col",{style:{width:r.width==="shrink"?NC(t):r.width||"",minWidth:r.minWidth||""}}))}return b("colgroup",{},...e)}function NC(s){return s==null?4:s}function RC(s){for(let t of s)if(t.width==="shrink")return!0;return!1}function OC(s,t){let e=["fc-scrollgrid",t.theme.getClass("table")];return s&&e.push("fc-scrollgrid-liquid"),e}function FC(s,t){let e=["fc-scrollgrid-section",`fc-scrollgrid-section-${s.type}`,s.className];return t&&s.liquid&&s.maxHeight==null&&e.push("fc-scrollgrid-section-liquid"),s.isSticky&&e.push("fc-scrollgrid-section-sticky"),e}function fo(s){return b("div",{className:"fc-scrollgrid-sticky-shim",style:{width:s.clientWidth,minWidth:s.tableMinWidth}})}function na(s){let{stickyHeaderDates:t}=s;return(t==null||t==="auto")&&(t=s.height==="auto"||s.viewHeight==="auto"),t}function sc(s){let{stickyFooterScrollbar:t}=s;return(t==null||t==="auto")&&(t=s.height==="auto"||s.viewHeight==="auto"),t}var Qs=class extends De{constructor(){super(...arguments),this.processCols=ne(t=>t,IC),this.renderMicroColGroup=ne(PC),this.scrollerRefs=new wr,this.scrollerElRefs=new wr(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:t,state:e,context:r}=this,i=t.sections||[],n=this.processCols(t.cols),a=this.renderMicroColGroup(n,e.shrinkWidth),o=OC(t.liquid,r);t.collapsibleWidth&&o.push("fc-scrollgrid-collapsible");let l=i.length,c=0,d,u=[],h=[],p=[];for(;c<l&&(d=i[c]).type==="header";)u.push(this.renderSection(d,a,!0)),c+=1;for(;c<l&&(d=i[c]).type==="body";)h.push(this.renderSection(d,a,!1)),c+=1;for(;c<l&&(d=i[c]).type==="footer";)p.push(this.renderSection(d,a,!0)),c+=1;let f=!Km(),m={role:"rowgroup"};return b("table",{role:"grid",className:o.join(" "),style:{height:t.height}},!!(!f&&u.length)&&b("thead",m,...u),!!(!f&&h.length)&&b("tbody",m,...h),!!(!f&&p.length)&&b("tfoot",m,...p),f&&b("tbody",m,...u,...h,...p))}renderSection(t,e,r){return"outerContent"in t?b(Ne,{key:t.key},t.outerContent):b("tr",{key:t.key,role:"presentation",className:FC(t,this.props.liquid).join(" ")},this.renderChunkTd(t,e,t.chunk,r))}renderChunkTd(t,e,r,i){if("outerContent"in r)return r.outerContent;let{props:n}=this,{forceYScrollbars:a,scrollerClientWidths:o,scrollerClientHeights:l}=this.state,c=_C(n,t),d=ng(n,t),u=n.liquid?a?"scroll":c?"auto":"hidden":"visible",h=t.key,p=AC(t,r,{tableColGroupNode:e,tableMinWidth:"",clientWidth:!n.collapsibleWidth&&o[h]!==void 0?o[h]:null,clientHeight:l[h]!==void 0?l[h]:null,expandRows:t.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},i);return b(i?"th":"td",{ref:r.elRef,role:"presentation"},b("div",{className:`fc-scroller-harness${d?" fc-scroller-harness-liquid":""}`},b(Iu,{ref:this.scrollerRefs.createRef(h),elRef:this.scrollerElRefs.createRef(h),overflowY:u,overflowX:n.liquid?"hidden":"visible",maxHeight:t.maxHeight,liquid:d,liquidIsAbsolute:!0},p)))}_handleScrollerEl(t,e){let r=cR(this.props.sections,e);r&&Or(r.chunk.scrollerElRef,t)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return RC(this.props.cols)?MC(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let t=wC(),{scrollerRefs:e,scrollerElRefs:r}=this,i=!1,n={},a={};for(let o in e.currentMap){let l=e.currentMap[o];if(l&&l.needsYScrolling()){i=!0;break}}for(let o of this.props.sections){let l=o.key,c=r.currentMap[l];if(c){let d=c.parentNode;n[l]=Math.floor(d.getBoundingClientRect().width-(i?t.y:0)),a[l]=Math.floor(d.getBoundingClientRect().height)}}return{forceYScrollbars:i,scrollerClientWidths:n,scrollerClientHeights:a}}};Qs.addStateEquality({scrollerClientWidths:Zt,scrollerClientHeights:Zt});function cR(s,t){for(let e of s)if(e.key===t)return e;return null}var Xn=class extends De{constructor(){super(...arguments),this.buildPublicEvent=ne((t,e,r)=>new ze(t,e,r)),this.handleEl=t=>{this.el=t,Or(this.props.elRef,t),t&&BD(t,this.props.seg)}}render(){let{props:t,context:e}=this,{options:r}=e,{seg:i}=t,{eventRange:n}=i,{ui:a}=n,o={event:this.buildPublicEvent(e,n.def,n.instance),view:e.viewApi,timeText:t.timeText,textColor:a.textColor,backgroundColor:a.backgroundColor,borderColor:a.borderColor,isDraggable:!t.disableDragging&&LN(i,e),isStartResizable:!t.disableResizing&&HN(i,e),isEndResizable:!t.disableResizing&&BN(i),isMirror:!!(t.isDragging||t.isResizing||t.isDateSelecting),isStart:!!i.isStart,isEnd:!!i.isEnd,isPast:!!t.isPast,isFuture:!!t.isFuture,isToday:!!t.isToday,isSelected:!!t.isSelected,isDragging:!!t.isDragging,isResizing:!!t.isResizing};return b(It,{elRef:this.handleEl,elTag:t.elTag,elAttrs:t.elAttrs,elClasses:[...UN(o),...i.eventRange.ui.classNames,...t.elClasses||[]],elStyle:t.elStyle,renderProps:o,generatorName:"eventContent",customGenerator:r.eventContent,defaultGenerator:t.defaultGenerator,classNameGenerator:r.eventClassNames,didMount:r.eventDidMount,willUnmount:r.eventWillUnmount},t.children)}componentDidUpdate(t){this.el&&this.props.seg!==t.seg&&BD(this.el,this.props.seg)}},Ks=class extends De{render(){let{props:t,context:e}=this,{options:r}=e,{seg:i}=t,{ui:n}=i.eventRange,a=r.eventTimeFormat||t.defaultTimeFormat,o=Wu(i,a,e,t.defaultDisplayEventTime,t.defaultDisplayEventEnd);return b(Xn,Object.assign({},t,{elTag:"a",elStyle:{borderColor:n.borderColor,backgroundColor:n.backgroundColor},elAttrs:Yu(i,e),defaultGenerator:dR,timeText:o}),(l,c)=>b(Ne,null,b(l,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:c.textColor}}),!!c.isStartResizable&&b("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!c.isEndResizable&&b("div",{className:"fc-event-resizer fc-event-resizer-end"})))}};Ks.addPropsEquality({seg:Zt});function dR(s){return b("div",{className:"fc-event-main-frame"},s.timeText&&b("div",{className:"fc-event-time"},s.timeText),b("div",{className:"fc-event-title-container"},b("div",{className:"fc-event-title fc-sticky"},s.event.title||b(Ne,null,"\xA0"))))}var nc=s=>b(Jr.Consumer,null,t=>{let{options:e}=t,r={isAxis:s.isAxis,date:t.dateEnv.toDate(s.date),view:t.viewApi};return b(It,{elRef:s.elRef,elTag:s.elTag||"div",elAttrs:s.elAttrs,elClasses:s.elClasses,elStyle:s.elStyle,renderProps:r,generatorName:"nowIndicatorContent",customGenerator:e.nowIndicatorContent,classNameGenerator:e.nowIndicatorClassNames,didMount:e.nowIndicatorDidMount,willUnmount:e.nowIndicatorWillUnmount},s.children)}),uR=Le({day:"numeric"}),Zs=class extends De{constructor(){super(...arguments),this.refineRenderProps=lo(hR)}render(){let{props:t,context:e}=this,{options:r}=e,i=this.refineRenderProps({date:t.date,dateProfile:t.dateProfile,todayRange:t.todayRange,isMonthStart:t.isMonthStart||!1,showDayNumber:t.showDayNumber,extraRenderProps:t.extraRenderProps,viewApi:e.viewApi,dateEnv:e.dateEnv,monthStartFormat:r.monthStartFormat});return b(It,{elRef:t.elRef,elTag:t.elTag,elAttrs:Object.assign(Object.assign({},t.elAttrs),i.isDisabled?{}:{"data-date":zl(t.date)}),elClasses:[...zu(i,e.theme),...t.elClasses||[]],elStyle:t.elStyle,renderProps:i,generatorName:"dayCellContent",customGenerator:r.dayCellContent,defaultGenerator:t.defaultGenerator,classNameGenerator:i.isDisabled?void 0:r.dayCellClassNames,didMount:r.dayCellDidMount,willUnmount:r.dayCellWillUnmount},t.children)}};function mo(s){return!!(s.dayCellContent||pm("dayCellContent",s))}function hR(s){let{date:t,dateEnv:e,dateProfile:r,isMonthStart:i}=s,n=tg(t,s.todayRange,null,r),a=s.showDayNumber?e.format(t,i?s.monthStartFormat:uR):"";return Object.assign(Object.assign(Object.assign({date:e.toDate(t),view:s.viewApi},n),{isMonthStart:i,dayNumberText:a}),s.extraRenderProps)}var ea=class extends De{render(){let{props:t}=this,{seg:e}=t;return b(Xn,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:e.eventRange.ui.backgroundColor},defaultGenerator:pR,seg:e,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:t.isPast,isFuture:t.isFuture,isToday:t.isToday,disableDragging:!0,disableResizing:!0})}};function pR(s){let{title:t}=s.event;return t&&b("div",{className:"fc-event-title"},s.event.title)}function ac(s){return b("div",{className:`fc-${s}`})}var oc=s=>b(Jr.Consumer,null,t=>{let{dateEnv:e,options:r}=t,{date:i}=s,n=r.weekNumberFormat||s.defaultFormat,a=e.computeWeekNumber(i),o=e.format(i,n),l={num:a,text:o,date:i};return b(It,{elRef:s.elRef,elTag:s.elTag,elAttrs:s.elAttrs,elClasses:s.elClasses,elStyle:s.elStyle,renderProps:l,generatorName:"weekNumberContent",customGenerator:r.weekNumberContent,defaultGenerator:fR,classNameGenerator:r.weekNumberClassNames,didMount:r.weekNumberDidMount,willUnmount:r.weekNumberWillUnmount},s.children)});function fR(s){return s.text}var am=10,mm=class extends De{constructor(){super(...arguments),this.state={titleId:ms()},this.handleRootEl=t=>{this.rootEl=t,this.props.elRef&&Or(this.props.elRef,t)},this.handleDocumentMouseDown=t=>{let e=Nu(t);this.rootEl.contains(e)||this.handleCloseClick()},this.handleDocumentKeyDown=t=>{t.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:t}=this.props;t&&t()}}render(){let{theme:t,options:e}=this.context,{props:r,state:i}=this,n=["fc-popover",t.getClass("popover")].concat(r.extraClassNames||[]);return xD(b("div",Object.assign({},r.extraAttrs,{id:r.id,className:n.join(" "),"aria-labelledby":i.titleId,ref:this.handleRootEl}),b("div",{className:"fc-popover-header "+t.getClass("popoverHeader")},b("span",{className:"fc-popover-title",id:i.titleId},r.title),b("span",{className:"fc-popover-close "+t.getIconClass("close"),title:e.closeHint,onClick:this.handleCloseClick})),b("div",{className:"fc-popover-body "+t.getClass("popoverContent")},r.children)),r.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:t}=this.context,{alignmentEl:e,alignGridTop:r}=this.props,{rootEl:i}=this,n=eR(e);if(n){let a=i.getBoundingClientRect(),o=r?Et(e,".fc-scrollgrid").getBoundingClientRect().top:n.top,l=t?n.right-a.width:n.left;o=Math.max(o,am),l=Math.min(l,document.documentElement.clientWidth-am-a.width),l=Math.max(l,am);let c=i.offsetParent.getBoundingClientRect();ra(i,{top:o-c.top,left:l-c.left})}}},gm=class extends Pt{constructor(){super(...arguments),this.handleRootEl=t=>{this.rootEl=t,t?this.context.registerInteractiveComponent(this,{el:t,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:t,dateEnv:e}=this.context,{props:r}=this,{startDate:i,todayRange:n,dateProfile:a}=r,o=e.format(i,t.dayPopoverFormat);return b(Zs,{elRef:this.handleRootEl,date:i,dateProfile:a,todayRange:n},(l,c,d)=>b(mm,{elRef:d.ref,id:r.id,title:o,extraClassNames:["fc-more-popover"].concat(d.className||[]),extraAttrs:d,parentEl:r.parentEl,alignmentEl:r.alignmentEl,alignGridTop:r.alignGridTop,onClose:r.onClose},mo(t)&&b(l,{elTag:"div",elClasses:["fc-more-popover-misc"]}),r.children))}queryHit(t,e,r,i){let{rootEl:n,props:a}=this;return t>=0&&t<r&&e>=0&&e<i?{dateProfile:a.dateProfile,dateSpan:Object.assign({allDay:!a.forceTimed,range:{start:a.startDate,end:a.endDate}},a.extraDateSpan),dayEl:n,rect:{left:0,top:0,right:r,bottom:i},layer:1}:null}},ta=class extends De{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:ms()},this.handleLinkEl=t=>{this.linkEl=t,this.props.elRef&&Or(this.props.elRef,t)},this.handleClick=t=>{let{props:e,context:r}=this,{moreLinkClick:i}=r.options,n=UD(e).start;function a(o){let{def:l,instance:c,range:d}=o.eventRange;return{event:new ze(r,l,c),start:r.dateEnv.toDate(d.start),end:r.dateEnv.toDate(d.end),isStart:o.isStart,isEnd:o.isEnd}}typeof i=="function"&&(i=i({date:n,allDay:!!e.allDayDate,allSegs:e.allSegs.map(a),hiddenSegs:e.hiddenSegs.map(a),jsEvent:t,view:r.viewApi})),!i||i==="popover"?this.setState({isPopoverOpen:!0}):typeof i=="string"&&r.calendarApi.zoomTo(n,i)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:t,state:e}=this;return b(Jr.Consumer,null,r=>{let{viewApi:i,options:n,calendarApi:a}=r,{moreLinkText:o}=n,{moreCnt:l}=t,c=UD(t),d=typeof o=="function"?o.call(a,l):`+${l} ${o}`,u=ao(n.moreLinkHint,[l],d),h={num:l,shortText:`+${l}`,text:d,view:i};return b(Ne,null,!!t.moreCnt&&b(It,{elTag:t.elTag||"a",elRef:this.handleLinkEl,elClasses:[...t.elClasses||[],"fc-more-link"],elStyle:t.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},t.elAttrs),qD(this.handleClick)),{title:u,"aria-expanded":e.isPopoverOpen,"aria-controls":e.isPopoverOpen?e.popoverId:""}),renderProps:h,generatorName:"moreLinkContent",customGenerator:n.moreLinkContent,defaultGenerator:t.defaultGenerator||mR,classNameGenerator:n.moreLinkClassNames,didMount:n.moreLinkDidMount,willUnmount:n.moreLinkWillUnmount},t.children),e.isPopoverOpen&&b(gm,{id:e.popoverId,startDate:c.start,endDate:c.end,dateProfile:t.dateProfile,todayRange:t.todayRange,extraDateSpan:t.extraDateSpan,parentEl:this.parentEl,alignmentEl:t.alignmentElRef?t.alignmentElRef.current:this.linkEl,alignGridTop:t.alignGridTop,forceTimed:t.forceTimed,onClose:this.handlePopoverClose},t.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=Et(this.linkEl,".fc-view-harness"))}};function mR(s){return s.text}function UD(s){if(s.allDayDate)return{start:s.allDayDate,end:pt(s.allDayDate,1)};let{hiddenSegs:t}=s;return{start:Gu(t),end:yR(t)}}function Gu(s){return s.reduce(gR).eventRange.range.start}function gR(s,t){return s.eventRange.range.start<t.eventRange.range.start?s:t}function yR(s){return s.reduce(vR).eventRange.range.end}function vR(s,t){return s.eventRange.range.end>t.eventRange.range.end?s:t}var wR=[],WC={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},YC=Object.assign(Object.assign({},WC),{buttonHints:{prev:"Previous $0",next:"Next $0",today(s,t){return t==="day"?"Today":`This ${s}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(s){return`Show ${s} more event${s===1?"":"s"}`}});function TR(s){let t=s.length>0?s[0].code:"en",e=wR.concat(s),r={en:YC};for(let i of e)r[i.code]=i;return{map:r,defaultCode:t}}function jC(s,t){return typeof s=="object"&&!Array.isArray(s)?zC(s.code,[s.code],s):bR(s,t)}function bR(s,t){let e=[].concat(s||[]),r=kR(e,t)||YC;return zC(s,e,r)}function kR(s,t){for(let e=0;e<s.length;e+=1){let r=s[e].toLocaleLowerCase().split("-");for(let i=r.length;i>0;i-=1){let n=r.slice(0,i).join("-");if(t[n])return t[n]}}return null}function zC(s,t,e){let r=Lu([WC,e],["buttonText"]);delete r.code;let{week:i}=r;return delete r.week,{codeArg:s,codes:t,week:i,simpleNumberFormat:new Intl.NumberFormat(s),options:r}}function Tr(s){return{id:gs(),name:s.name,premiumReleaseDate:s.premiumReleaseDate?new Date(s.premiumReleaseDate):void 0,deps:s.deps||[],reducers:s.reducers||[],isLoadingFuncs:s.isLoadingFuncs||[],contextInit:[].concat(s.contextInit||[]),eventRefiners:s.eventRefiners||{},eventDefMemberAdders:s.eventDefMemberAdders||[],eventSourceRefiners:s.eventSourceRefiners||{},isDraggableTransformers:s.isDraggableTransformers||[],eventDragMutationMassagers:s.eventDragMutationMassagers||[],eventDefMutationAppliers:s.eventDefMutationAppliers||[],dateSelectionTransformers:s.dateSelectionTransformers||[],datePointTransforms:s.datePointTransforms||[],dateSpanTransforms:s.dateSpanTransforms||[],views:s.views||{},viewPropsTransformers:s.viewPropsTransformers||[],isPropsValid:s.isPropsValid||null,externalDefTransforms:s.externalDefTransforms||[],viewContainerAppends:s.viewContainerAppends||[],eventDropTransformers:s.eventDropTransformers||[],componentInteractions:s.componentInteractions||[],calendarInteractions:s.calendarInteractions||[],themeClasses:s.themeClasses||{},eventSourceDefs:s.eventSourceDefs||[],cmdFormatter:s.cmdFormatter,recurringTypes:s.recurringTypes||[],namedTimeZonedImpl:s.namedTimeZonedImpl,initialView:s.initialView||"",elementDraggingImpl:s.elementDraggingImpl,optionChangeHandlers:s.optionChangeHandlers||{},scrollGridImpl:s.scrollGridImpl||null,listenerRefiners:s.listenerRefiners||{},optionRefiners:s.optionRefiners||{},propSetHandlers:s.propSetHandlers||{}}}function SR(s,t){let e={},r={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function i(n){for(let a of n){let o=a.name,l=e[o];l===void 0?(e[o]=a.id,i(a.deps),r=DR(r,a)):l!==a.id&&console.warn(`Duplicate plugin '${o}'`)}}return s&&i(s),i(t),r}function ER(){let s=[],t=[],e;return(r,i)=>((!e||!Li(r,s)||!Li(i,t))&&(e=SR(r,i)),s=r,t=i,e)}function DR(s,t){return{premiumReleaseDate:CR(s.premiumReleaseDate,t.premiumReleaseDate),reducers:s.reducers.concat(t.reducers),isLoadingFuncs:s.isLoadingFuncs.concat(t.isLoadingFuncs),contextInit:s.contextInit.concat(t.contextInit),eventRefiners:Object.assign(Object.assign({},s.eventRefiners),t.eventRefiners),eventDefMemberAdders:s.eventDefMemberAdders.concat(t.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},s.eventSourceRefiners),t.eventSourceRefiners),isDraggableTransformers:s.isDraggableTransformers.concat(t.isDraggableTransformers),eventDragMutationMassagers:s.eventDragMutationMassagers.concat(t.eventDragMutationMassagers),eventDefMutationAppliers:s.eventDefMutationAppliers.concat(t.eventDefMutationAppliers),dateSelectionTransformers:s.dateSelectionTransformers.concat(t.dateSelectionTransformers),datePointTransforms:s.datePointTransforms.concat(t.datePointTransforms),dateSpanTransforms:s.dateSpanTransforms.concat(t.dateSpanTransforms),views:Object.assign(Object.assign({},s.views),t.views),viewPropsTransformers:s.viewPropsTransformers.concat(t.viewPropsTransformers),isPropsValid:t.isPropsValid||s.isPropsValid,externalDefTransforms:s.externalDefTransforms.concat(t.externalDefTransforms),viewContainerAppends:s.viewContainerAppends.concat(t.viewContainerAppends),eventDropTransformers:s.eventDropTransformers.concat(t.eventDropTransformers),calendarInteractions:s.calendarInteractions.concat(t.calendarInteractions),componentInteractions:s.componentInteractions.concat(t.componentInteractions),themeClasses:Object.assign(Object.assign({},s.themeClasses),t.themeClasses),eventSourceDefs:s.eventSourceDefs.concat(t.eventSourceDefs),cmdFormatter:t.cmdFormatter||s.cmdFormatter,recurringTypes:s.recurringTypes.concat(t.recurringTypes),namedTimeZonedImpl:t.namedTimeZonedImpl||s.namedTimeZonedImpl,initialView:s.initialView||t.initialView,elementDraggingImpl:s.elementDraggingImpl||t.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},s.optionChangeHandlers),t.optionChangeHandlers),scrollGridImpl:t.scrollGridImpl||s.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},s.listenerRefiners),t.listenerRefiners),optionRefiners:Object.assign(Object.assign({},s.optionRefiners),t.optionRefiners),propSetHandlers:Object.assign(Object.assign({},s.propSetHandlers),t.propSetHandlers)}}function CR(s,t){return s===void 0?t:t===void 0?s:new Date(Math.max(s.valueOf(),t.valueOf()))}var Ui=class extends hs{};Ui.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};Ui.prototype.baseIconClass="fc-icon";Ui.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};Ui.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};Ui.prototype.iconOverrideOption="buttonIcons";Ui.prototype.iconOverrideCustomButtonOption="icon";Ui.prototype.iconOverridePrefix="fc-icon-";function xR(s,t){let e={},r;for(r in s)og(r,e,s,t);for(r in t)og(r,e,s,t);return e}function og(s,t,e,r){if(t[s])return t[s];let i=MR(s,t,e,r);return i&&(t[s]=i),i}function MR(s,t,e,r){let i=e[s],n=r[s],a=d=>i&&i[d]!==null?i[d]:n&&n[d]!==null?n[d]:null,o=a("component"),l=a("superType"),c=null;if(l){if(l===s)throw new Error("Can't have a custom view type that references itself");c=og(l,t,e,r)}return!o&&c&&(o=c.component),o?{type:s,component:o,defaults:Object.assign(Object.assign({},c?c.defaults:{}),i?i.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),n?n.rawOptions:{})}:null}function LC(s){return Kr(s,_R)}function _R(s){let t=typeof s=="function"?{component:s}:s,{component:e}=t;return t.content?e=HC(t):e&&!(e.prototype instanceof De)&&(e=HC(Object.assign(Object.assign({},t),{content:e}))),{superType:t.type,component:e,rawOptions:t}}function HC(s){return t=>b(Jr.Consumer,null,e=>b(It,{elTag:"div",elClasses:Fm(e.viewSpec),renderProps:Object.assign(Object.assign({},t),{nextDayThreshold:e.options.nextDayThreshold}),generatorName:void 0,customGenerator:s.content,classNameGenerator:s.classNames,didMount:s.didMount,willUnmount:s.willUnmount}))}function AR(s,t,e,r){let i=LC(s),n=LC(t.views),a=xR(i,n);return Kr(a,o=>IR(o,n,t,e,r))}function IR(s,t,e,r,i){let n=s.overrides.duration||s.defaults.duration||r.duration||e.duration,a=null,o="",l="",c={};if(n&&(a=PR(n),a)){let h=Ml(a);o=h.unit,h.value===1&&(l=o,c=t[o]?t[o].rawOptions:{})}let d=h=>{let p=h.buttonText||{},f=s.defaults.buttonTextKey;return f!=null&&p[f]!=null?p[f]:p[s.type]!=null?p[s.type]:p[l]!=null?p[l]:null},u=h=>{let p=h.buttonHints||{},f=s.defaults.buttonTextKey;return f!=null&&p[f]!=null?p[f]:p[s.type]!=null?p[s.type]:p[l]!=null?p[l]:null};return{type:s.type,component:s.component,duration:a,durationUnit:o,singleUnit:l,optionDefaults:s.defaults,optionOverrides:Object.assign(Object.assign({},c),s.overrides),buttonTextOverride:d(r)||d(e)||s.overrides.buttonText,buttonTextDefault:d(i)||s.defaults.buttonText||d(Hi)||s.type,buttonTitleOverride:u(r)||u(e)||s.overrides.buttonHint,buttonTitleDefault:u(i)||s.defaults.buttonHint||u(Hi)}}var BC={};function PR(s){let t=JSON.stringify(s),e=BC[t];return e===void 0&&(e=pe(s),BC[t]=e),e}function NR(s,t){switch(t.type){case"CHANGE_VIEW_TYPE":s=t.viewType}return s}function RR(s,t){switch(t.type){case"CHANGE_DATE":return t.dateMarker;default:return s}}function OR(s,t,e){let r=s.initialDate;return r!=null?t.createMarker(r):e.getDateMarker()}function FR(s,t){switch(t.type){case"SET_OPTION":return Object.assign(Object.assign({},s),{[t.optionName]:t.rawOptionValue});default:return s}}function LR(s,t,e,r){let i;switch(t.type){case"CHANGE_VIEW_TYPE":return r.build(t.dateMarker||e);case"CHANGE_DATE":return r.build(t.dateMarker);case"PREV":if(i=r.buildPrev(s,e),i.isValid)return i;break;case"NEXT":if(i=r.buildNext(s,e),i.isValid)return i;break}return s}function HR(s,t,e){let r=t?t.activeRange:null;return GC({},jR(s,e),r,e)}function BR(s,t,e,r){let i=e?e.activeRange:null;switch(t.type){case"ADD_EVENT_SOURCES":return GC(s,t.sources,i,r);case"REMOVE_EVENT_SOURCE":return $R(s,t.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return e?QC(s,i,r):s;case"FETCH_EVENT_SOURCES":return gg(s,t.sourceIds?Nm(t.sourceIds):KC(s,r),i,t.isRefetch||!1,r);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return YR(s,t.sourceId,t.fetchId,t.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return s}}function UR(s,t,e){let r=t?t.activeRange:null;return gg(s,KC(s,e),r,!0,e)}function qC(s){for(let t in s)if(s[t].isFetching)return!0;return!1}function GC(s,t,e,r){let i={};for(let n of t)i[n.sourceId]=n;return e&&(i=QC(i,e,r)),Object.assign(Object.assign({},s),i)}function $R(s,t){return us(s,e=>e.sourceId!==t)}function QC(s,t,e){return gg(s,us(s,r=>VR(r,t,e)),t,!1,e)}function VR(s,t,e){return ZC(s,e)?!e.options.lazyFetching||!s.fetchRange||s.isFetching||t.start<s.fetchRange.start||t.end>s.fetchRange.end:!s.latestFetchId}function gg(s,t,e,r,i){let n={};for(let a in s){let o=s[a];t[a]?n[a]=WR(o,e,r,i):n[a]=o}return n}function WR(s,t,e,r){let{options:i,calendarApi:n}=r,a=r.pluginHooks.eventSourceDefs[s.sourceDefId],o=gs();return a.fetch({eventSource:s,range:t,isRefetch:e,context:r},l=>{let{rawEvents:c}=l;i.eventSourceSuccess&&(c=i.eventSourceSuccess.call(n,c,l.response)||c),s.success&&(c=s.success.call(n,c,l.response)||c),r.dispatch({type:"RECEIVE_EVENTS",sourceId:s.sourceId,fetchId:o,fetchRange:t,rawEvents:c})},l=>{let c=!1;i.eventSourceFailure&&(i.eventSourceFailure.call(n,l),c=!0),s.failure&&(s.failure(l),c=!0),c||console.warn(l.message,l),r.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:s.sourceId,fetchId:o,fetchRange:t,error:l})}),Object.assign(Object.assign({},s),{isFetching:!0,latestFetchId:o})}function YR(s,t,e,r){let i=s[t];return i&&e===i.latestFetchId?Object.assign(Object.assign({},s),{[t]:Object.assign(Object.assign({},i),{isFetching:!1,fetchRange:r})}):s}function KC(s,t){return us(s,e=>ZC(e,t))}function jR(s,t){let e=$m(t),r=[].concat(s.eventSources||[]),i=[];s.initialEvents&&r.unshift(s.initialEvents),s.events&&r.unshift(s.events);for(let n of r){let a=Um(n,t,e);a&&i.push(a)}return i}function ZC(s,t){return!t.pluginHooks.eventSourceDefs[s.sourceDefId].ignoreRange}function zR(s,t){switch(t.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return t.selection;default:return s}}function qR(s,t){switch(t.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return t.eventInstanceId;default:return s}}function GR(s,t){let e;switch(t.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return e=t.state,{affectedEvents:e.affectedEvents,mutatedEvents:e.mutatedEvents,isEvent:e.isEvent};default:return s}}function QR(s,t){let e;switch(t.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return e=t.state,{affectedEvents:e.affectedEvents,mutatedEvents:e.mutatedEvents,isEvent:e.isEvent};default:return s}}function KR(s,t,e,r,i){let n=s.headerToolbar?UC(s.headerToolbar,s,t,e,r,i):null,a=s.footerToolbar?UC(s.footerToolbar,s,t,e,r,i):null;return{header:n,footer:a}}function UC(s,t,e,r,i,n){let a={},o=[],l=!1;for(let c in s){let d=s[c],u=ZR(d,t,e,r,i,n);a[c]=u.widgets,o.push(...u.viewsWithButtons),l=l||u.hasTitle}return{sectionWidgets:a,viewsWithButtons:o,hasTitle:l}}function ZR(s,t,e,r,i,n){let a=t.direction==="rtl",o=t.customButtons||{},l=e.buttonText||{},c=t.buttonText||{},d=e.buttonHints||{},u=t.buttonHints||{},h=s?s.split(" "):[],p=[],f=!1;return{widgets:h.map(g=>g.split(",").map(y=>{if(y==="title")return f=!0,{buttonName:y};let w,T,S,x,I,F;if(w=o[y])S=A=>{w.click&&w.click.call(A.target,A,A.target)},(x=r.getCustomButtonIconClass(w))||(x=r.getIconClass(y,a))||(I=w.text),F=w.hint||w.text;else if(T=i[y]){p.push(y),S=()=>{n.changeView(y)},(I=T.buttonTextOverride)||(x=r.getIconClass(y,a))||(I=T.buttonTextDefault);let A=T.buttonTextOverride||T.buttonTextDefault;F=ao(T.buttonTitleOverride||T.buttonTitleDefault||t.viewHint,[A,y],A)}else if(n[y])if(S=()=>{n[y]()},(I=l[y])||(x=r.getIconClass(y,a))||(I=c[y]),y==="prevYear"||y==="nextYear"){let A=y==="prevYear"?"prev":"next";F=ao(d[A]||u[A],[c.year||"year","year"],c[y])}else F=A=>ao(d[y]||u[y],[c[A]||A,A],c[y]);return{buttonName:y,buttonClick:S,buttonIcon:x,buttonText:I,buttonHint:F}})),viewsWithButtons:p,hasTitle:f}}var lg=class{constructor(t,e,r){this.type=t,this.getCurrentData=e,this.dateEnv=r}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(t){return this.getCurrentData().options[t]}},JR={ignoreRange:!0,parseMeta(s){return Array.isArray(s.events)?s.events:null},fetch(s,t){t({rawEvents:s.eventSource.meta})}},XR=Tr({name:"array-event-source",eventSourceDefs:[JR]}),eO={parseMeta(s){return typeof s.events=="function"?s.events:null},fetch(s,t,e){let{dateEnv:r}=s.context,i=s.eventSource.meta;Gm(i.bind(null,qm(s.range,r)),n=>t({rawEvents:n}),e)}},tO=Tr({name:"func-event-source",eventSourceDefs:[eO]}),rO={method:String,extraParams:N,startParam:String,endParam:String,timeZoneParam:String},iO={parseMeta(s){return s.url&&(s.format==="json"||!s.format)?{url:s.url,format:"json",method:(s.method||"GET").toUpperCase(),extraParams:s.extraParams,startParam:s.startParam,endParam:s.endParam,timeZoneParam:s.timeZoneParam}:null},fetch(s,t,e){let{meta:r}=s.eventSource,i=nO(r,s.range,s.context);Qm(r.method,r.url,i).then(([n,a])=>{t({rawEvents:n,response:a})},e)}},sO=Tr({name:"json-event-source",eventSourceRefiners:rO,eventSourceDefs:[iO]});function nO(s,t,e){let{dateEnv:r,options:i}=e,n,a,o,l,c={};return n=s.startParam,n==null&&(n=i.startParam),a=s.endParam,a==null&&(a=i.endParam),o=s.timeZoneParam,o==null&&(o=i.timeZoneParam),typeof s.extraParams=="function"?l=s.extraParams():l=s.extraParams||{},Object.assign(c,l),c[n]=r.formatIso(t.start),c[a]=r.formatIso(t.end),r.timeZone!=="local"&&(c[o]=r.timeZone),c}var aO={daysOfWeek:N,startTime:pe,endTime:pe,duration:pe,startRecur:N,endRecur:N},oO={parse(s,t){if(s.daysOfWeek||s.startTime||s.endTime||s.startRecur||s.endRecur){let e={daysOfWeek:s.daysOfWeek||null,startTime:s.startTime||null,endTime:s.endTime||null,startRecur:s.startRecur?t.createMarker(s.startRecur):null,endRecur:s.endRecur?t.createMarker(s.endRecur):null,dateEnv:t},r;return s.duration&&(r=s.duration),!r&&s.startTime&&s.endTime&&(r=JD(s.endTime,s.startTime)),{allDayGuess:!s.startTime&&!s.endTime,duration:r,typeData:e}}return null},expand(s,t,e){let r=Rr(t,{start:s.startRecur,end:s.endRecur});return r?cO(s.daysOfWeek,s.startTime,s.dateEnv,e,r):[]}},lO=Tr({name:"simple-recurring-event",recurringTypes:[oO],eventRefiners:aO});function cO(s,t,e,r,i){let n=s?Nm(s):null,a=Ve(i.start),o=i.end,l=[];for(t&&(t.milliseconds<0?o=pt(o,1):t.milliseconds>=1e3*60*60*24&&(a=pt(a,-1)));a<o;){let c;(!n||n[a.getUTCDay()])&&(t?c=r.add(a,t):c=a,l.push(r.createMarker(e.toDate(c)))),a=pt(a,1)}return l}var dO=Tr({name:"change-handler",optionChangeHandlers:{events(s,t){$C([s],t)},eventSources:$C}});function $C(s,t){let e=Hu(t.getCurrentData().eventSources);if(e.length===1&&s.length===1&&Array.isArray(e[0]._raw)&&Array.isArray(s[0])){t.dispatch({type:"RESET_RAW_EVENTS",sourceId:e[0].sourceId,rawEvents:s[0]});return}let r=[];for(let i of s){let n=!1;for(let a=0;a<e.length;a+=1)if(e[a]._raw===i){e.splice(a,1),n=!0;break}n||r.push(i)}for(let i of e)t.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:i.sourceId});for(let i of r)t.calendarApi.addEventSource(i)}function uO(s,t){t.emitter.trigger("datesSet",Object.assign(Object.assign({},qm(s.activeRange,t.dateEnv)),{view:t.viewApi}))}function hO(s,t){let{emitter:e}=t;e.hasHandlers("eventsSet")&&e.trigger("eventsSet",Bi(s,t))}var pO=[XR,tO,sO,lO,dO,Tr({name:"misc",isLoadingFuncs:[s=>qC(s.eventSources)],propSetHandlers:{dateProfile:uO,eventStore:hO}})],cg=class{constructor(t,e){this.runTaskOption=t,this.drainedOption=e,this.queue=[],this.delayedRunner=new Yn(this.drain.bind(this))}request(t,e){this.queue.push(t),this.delayedRunner.request(e)}pause(t){this.delayedRunner.pause(t)}resume(t,e){this.delayedRunner.resume(t,e)}drain(){let{queue:t}=this;for(;t.length;){let e=[],r;for(;r=t.shift();)this.runTask(r),e.push(r);this.drained(e)}}runTask(t){this.runTaskOption&&this.runTaskOption(t)}drained(t){this.drainedOption&&this.drainedOption(t)}};function fO(s,t,e){let r;return/^(year|month)$/.test(s.currentRangeUnit)?r=s.currentRange:r=s.activeRange,e.formatRange(r.start,r.end,Le(t.titleFormat||mO(s)),{isEndExclusive:s.isRangeAllDay,defaultSeparator:t.titleRangeSeparator})}function mO(s){let{currentRangeUnit:t}=s;if(t==="year")return{year:"numeric"};if(t==="month")return{year:"numeric",month:"long"};let e=ro(s.currentRange.start,s.currentRange.end);return e!==null&&e>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var Qu=class{constructor(){this.resetListeners=new Set}handleInput(t,e){let r=this.dateEnv;if(t!==r&&(typeof e=="function"?this.nowFn=e:r||(this.nowAnchorDate=t.toDate(e?t.createMarker(e):t.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=t,r))for(let i of this.resetListeners.values())i()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(t){this.resetListeners.add(t)}removeResetListener(t){this.resetListeners.delete(t)}},dg=class{constructor(t){this.computeCurrentViewData=ne(this._computeCurrentViewData),this.organizeRawLocales=ne(TR),this.buildLocale=ne(jC),this.buildPluginHooks=ER(),this.buildDateEnv=ne(gO),this.buildTheme=ne(yO),this.parseToolbars=ne(KR),this.buildViewSpecs=ne(AR),this.buildDateProfileGenerator=lo(vO),this.buildViewApi=ne(wO),this.buildViewUiProps=lo(kO),this.buildEventUiBySource=ne(TO,Zt),this.buildEventUiBases=ne(bO),this.parseContextBusinessHours=lo(SO),this.buildTitle=ne(fO),this.nowManager=new Qu,this.emitter=new ps,this.actionRunner=new cg(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=h=>{this.actionRunner.request(h)},this.props=t,this.actionRunner.pause(),this.nowManager=new Qu;let e={},r=this.computeOptionsData(t.optionOverrides,e,t.calendarApi),i=r.calendarOptions.initialView||r.pluginHooks.initialView,n=this.computeCurrentViewData(i,r,t.optionOverrides,e);t.calendarApi.currentDataManager=this,this.emitter.setThisContext(t.calendarApi),this.emitter.setOptions(n.options);let a={nowManager:this.nowManager,dateEnv:r.dateEnv,options:r.calendarOptions,pluginHooks:r.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},o=OR(r.calendarOptions,r.dateEnv,this.nowManager),l=n.dateProfileGenerator.build(o);Qr(l.activeRange,o)||(o=l.currentRange.start);for(let h of r.pluginHooks.contextInit)h(a);let c=HR(r.calendarOptions,l,a),d={dynamicOptionOverrides:e,currentViewType:i,currentDate:o,dateProfile:l,businessHours:this.parseContextBusinessHours(a),eventSources:c,eventUiBases:{},eventStore:Dt(),renderableEventStore:Dt(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(a).selectionConfig},u=Object.assign(Object.assign({},a),d);for(let h of r.pluginHooks.reducers)Object.assign(d,h(null,null,u));ag(d,a)&&this.emitter.trigger("loading",!0),this.state=d,this.updateData(),this.actionRunner.resume()}resetOptions(t,e){let{props:r}=this;e===void 0?r.optionOverrides=t:(r.optionOverrides=Object.assign(Object.assign({},r.optionOverrides||{}),t),this.optionsForRefining.push(...e)),(e===void 0||e.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(t){let{props:e,state:r,emitter:i}=this,n=FR(r.dynamicOptionOverrides,t),a=this.computeOptionsData(e.optionOverrides,n,e.calendarApi),o=NR(r.currentViewType,t),l=this.computeCurrentViewData(o,a,e.optionOverrides,n);e.calendarApi.currentDataManager=this,i.setThisContext(e.calendarApi),i.setOptions(l.options);let c={nowManager:this.nowManager,dateEnv:a.dateEnv,options:a.calendarOptions,pluginHooks:a.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:i,getCurrentData:this.getCurrentData},{currentDate:d,dateProfile:u}=r;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(u=l.dateProfileGenerator.build(d)),d=RR(d,t),u=LR(u,t,d,l.dateProfileGenerator),(t.type==="PREV"||t.type==="NEXT"||!Qr(u.currentRange,d))&&(d=u.currentRange.start);let h=BR(r.eventSources,t,u,c),p=uC(r.eventStore,t,h,u,c),m=qC(h)&&!l.options.progressiveEventRendering&&r.renderableEventStore||p,{eventUiSingleBase:g,selectionConfig:y}=this.buildViewUiProps(c),w=this.buildEventUiBySource(h),T=this.buildEventUiBases(m.defs,g,w),S={dynamicOptionOverrides:n,currentViewType:o,currentDate:d,dateProfile:u,eventSources:h,eventStore:p,renderableEventStore:m,selectionConfig:y,eventUiBases:T,businessHours:this.parseContextBusinessHours(c),dateSelection:zR(r.dateSelection,t),eventSelection:qR(r.eventSelection,t),eventDrag:GR(r.eventDrag,t),eventResize:QR(r.eventResize,t)},x=Object.assign(Object.assign({},c),S);for(let A of a.pluginHooks.reducers)Object.assign(S,A(r,t,x));let I=ag(r,c),F=ag(S,c);!I&&F?i.trigger("loading",!0):I&&!F&&i.trigger("loading",!1),this.state=S,e.onAction&&e.onAction(t)}updateData(){let{props:t,state:e}=this,r=this.data,i=this.computeOptionsData(t.optionOverrides,e.dynamicOptionOverrides,t.calendarApi),n=this.computeCurrentViewData(e.currentViewType,i,t.optionOverrides,e.dynamicOptionOverrides),a=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(e.dateProfile,n.options,i.dateEnv),calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},i),n),e),o=i.pluginHooks.optionChangeHandlers,l=r&&r.calendarOptions,c=i.calendarOptions;if(l&&l!==c){l.timeZone!==c.timeZone&&(e.eventSources=a.eventSources=UR(a.eventSources,e.dateProfile,a),e.eventStore=a.eventStore=Vm(a.eventStore,r.dateEnv,a.dateEnv),e.renderableEventStore=a.renderableEventStore=Vm(a.renderableEventStore,r.dateEnv,a.dateEnv));for(let d in o)(this.optionsForHandling.indexOf(d)!==-1||l[d]!==c[d])&&o[d](c[d],a)}this.optionsForHandling=[],t.onData&&t.onData(a)}computeOptionsData(t,e,r){if(!this.optionsForRefining.length&&t===this.stableOptionOverrides&&e===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:i,pluginHooks:n,localeDefaults:a,availableLocaleData:o,extra:l}=this.processRawCalendarOptions(t,e);VC(l);let c=this.buildDateEnv(i.timeZone,i.locale,i.weekNumberCalculation,i.firstDay,i.weekText,n,o,i.defaultRangeSeparator),d=this.buildViewSpecs(n.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,a),u=this.buildTheme(i,n),h=this.parseToolbars(i,this.stableOptionOverrides,u,d,r);return this.stableCalendarOptionsData={calendarOptions:i,pluginHooks:n,dateEnv:c,viewSpecs:d,theme:u,toolbarConfig:h,localeDefaults:a,availableRawLocales:o.map}}processRawCalendarOptions(t,e){let{locales:r,locale:i}=Fu([Hi,t,e]),n=this.organizeRawLocales(r),a=n.map,o=this.buildLocale(i||n.defaultCode,a).options,l=this.buildPluginHooks(t.plugins||[],pO),c=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Am),Im),Pm),l.listenerRefiners),l.optionRefiners),d={},u=Fu([Hi,o,t,e]),h={},p=this.currentCalendarOptionsInput,f=this.currentCalendarOptionsRefined,m=!1;for(let g in u)this.optionsForRefining.indexOf(g)===-1&&(u[g]===p[g]||Xs[g]&&g in p&&Xs[g](p[g],u[g]))?h[g]=f[g]:c[g]?(h[g]=c[g](u[g]),m=!0):d[g]=p[g];return m&&(this.currentCalendarOptionsInput=u,this.currentCalendarOptionsRefined=h,this.stableOptionOverrides=t,this.stableDynamicOptionOverrides=e),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:n,localeDefaults:o,extra:d}}_computeCurrentViewData(t,e,r,i){let n=e.viewSpecs[t];if(!n)throw new Error(`viewType "${t}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:a,extra:o}=this.processRawViewOptions(n,e.pluginHooks,e.localeDefaults,r,i);VC(o),this.nowManager.handleInput(e.dateEnv,a.now);let l=this.buildDateProfileGenerator({dateProfileGeneratorClass:n.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:n.duration,durationUnit:n.durationUnit,usesMinMaxTime:n.optionDefaults.usesMinMaxTime,dateEnv:e.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:a.slotMinTime,slotMaxTime:a.slotMaxTime,showNonCurrentDates:a.showNonCurrentDates,dayCount:a.dayCount,dateAlignment:a.dateAlignment,dateIncrement:a.dateIncrement,hiddenDays:a.hiddenDays,weekends:a.weekends,validRangeInput:a.validRange,visibleRangeInput:a.visibleRange,fixedWeekCount:a.fixedWeekCount}),c=this.buildViewApi(t,this.getCurrentData,e.dateEnv);return{viewSpec:n,options:a,dateProfileGenerator:l,viewApi:c}}processRawViewOptions(t,e,r,i,n){let a=Fu([Hi,t.optionDefaults,r,i,t.optionOverrides,n]),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Am),Im),Pm),tC),e.listenerRefiners),e.optionRefiners),l={},c=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,u=!1,h={};for(let p in a)a[p]===c[p]||Xs[p]&&Xs[p](a[p],c[p])?l[p]=d[p]:(a[p]===this.currentCalendarOptionsInput[p]||Xs[p]&&Xs[p](a[p],this.currentCalendarOptionsInput[p])?p in this.currentCalendarOptionsRefined&&(l[p]=this.currentCalendarOptionsRefined[p]):o[p]?l[p]=o[p](a[p]):h[p]=a[p],u=!0);return u&&(this.currentViewOptionsInput=a,this.currentViewOptionsRefined=l),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:h}}};function gO(s,t,e,r,i,n,a,o){let l=jC(t||a.defaultCode,a.map);return new _l({calendarSystem:"gregory",timeZone:s,namedTimeZoneImpl:n.namedTimeZonedImpl,locale:l,weekNumberCalculation:e,firstDay:r,weekText:i,cmdFormatter:n.cmdFormatter,defaultSeparator:o})}function yO(s,t){let e=t.themeClasses[s.themeSystem]||Ui;return new e(s)}function vO(s){let t=s.dateProfileGeneratorClass||jn;return new t(s)}function wO(s,t,e){return new lg(s,t,e)}function TO(s){return Kr(s,t=>t.ui)}function bO(s,t,e){let r={"":t};for(let i in s){let n=s[i];n.sourceId&&e[n.sourceId]&&(r[i]=e[n.sourceId])}return r}function kO(s){let{options:t}=s;return{eventUiSingleBase:ho({display:t.eventDisplay,editable:t.editable,startEditable:t.eventStartEditable,durationEditable:t.eventDurationEditable,constraint:t.eventConstraint,overlap:typeof t.eventOverlap=="boolean"?t.eventOverlap:void 0,allow:t.eventAllow,backgroundColor:t.eventBackgroundColor,borderColor:t.eventBorderColor,textColor:t.eventTextColor,color:t.eventColor},s),selectionConfig:ho({constraint:t.selectConstraint,overlap:typeof t.selectOverlap=="boolean"?t.selectOverlap:void 0,allow:t.selectAllow},s)}}function ag(s,t){for(let e of t.pluginHooks.isLoadingFuncs)if(e(s))return!0;return!1}function SO(s){return Wm(s.options.businessHours,s)}function VC(s,t){for(let e in s)console.warn(`Unknown option '${e}'`+(t?` for view '${t}'`:""))}var ug=class extends De{render(){let t=this.props.widgetGroups.map(e=>this.renderWidgetGroup(e));return b("div",{className:"fc-toolbar-chunk"},...t)}renderWidgetGroup(t){let{props:e}=this,{theme:r}=this.context,i=[],n=!0;for(let a of t){let{buttonName:o,buttonClick:l,buttonText:c,buttonIcon:d,buttonHint:u}=a;if(o==="title")n=!1,i.push(b("h2",{className:"fc-toolbar-title",id:e.titleId},e.title));else{let h=o===e.activeButton,p=!e.isTodayEnabled&&o==="today"||!e.isPrevEnabled&&o==="prev"||!e.isNextEnabled&&o==="next",f=[`fc-${o}-button`,r.getClass("button")];h&&f.push(r.getClass("buttonActive")),i.push(b("button",{type:"button",title:typeof u=="function"?u(e.navUnit):u,disabled:p,"aria-pressed":h,className:f.join(" "),onClick:l},c||(d?b("span",{className:d,role:"img"}):"")))}}if(i.length>1){let a=n&&r.getClass("buttonGroup")||"";return b("div",{className:a},...i)}return i[0]}},Ku=class extends De{render(){let{model:t,extraClassName:e}=this.props,r=!1,i,n,a=t.sectionWidgets,o=a.center;return a.left?(r=!0,i=a.left):i=a.start,a.right?(r=!0,n=a.right):n=a.end,b("div",{className:[e||"","fc-toolbar",r?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",i||[]),this.renderSection("center",o||[]),this.renderSection("end",n||[]))}renderSection(t,e){let{props:r}=this;return b(ug,{key:t,widgetGroups:e,title:r.title,navUnit:r.navUnit,activeButton:r.activeButton,isTodayEnabled:r.isTodayEnabled,isPrevEnabled:r.isPrevEnabled,isNextEnabled:r.isNextEnabled,titleId:r.titleId})}},hg=class extends De{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=t=>{this.el=t,Or(this.props.elRef,t),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:t,state:e}=this,{aspectRatio:r}=t,i=["fc-view-harness",r||t.liquid||t.height?"fc-view-harness-active":"fc-view-harness-passive"],n="",a="";return r?e.availableWidth!==null?n=e.availableWidth/r:a=`${1/r*100}%`:n=t.height||"",b("div",{"aria-labelledby":t.labeledById,ref:this.handleEl,className:i.join(" "),style:{height:n,paddingBottom:a}},t.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}},pg=class extends yi{constructor(t){super(t),this.handleSegClick=(e,r)=>{let{component:i}=this,{context:n}=i,a=vs(r);if(a&&i.isValidSegDownEl(e.target)){let o=Et(e.target,".fc-event-forced-url"),l=o?o.querySelector("a[href]").href:"";n.emitter.trigger("eventClick",{el:r,event:new ze(i.context,a.eventRange.def,a.eventRange.instance),jsEvent:e,view:n.viewApi}),l&&!e.defaultPrevented&&(window.location.href=l)}},this.destroy=vm(t.el,"click",".fc-event",this.handleSegClick)}},fg=class extends yi{constructor(t){super(t),this.handleEventElRemove=e=>{e===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(e,r)=>{vs(r)&&(this.currentSegEl=r,this.triggerEvent("eventMouseEnter",e,r))},this.handleSegLeave=(e,r)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",e,r))},this.removeHoverListeners=zD(t.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(t,e,r){let{component:i}=this,{context:n}=i,a=vs(r);(!e||i.isValidSegDownEl(e.target))&&n.emitter.trigger(t,{el:r,event:new ze(n,a.eventRange.def,a.eventRange.instance),jsEvent:e,view:n.viewApi})}},mg=class extends Oi{constructor(){super(...arguments),this.buildViewContext=ne(aC),this.buildViewPropTransformers=ne(DO),this.buildToolbarProps=ne(EO),this.headerRef=tt(),this.footerRef=tt(),this.interactionsStore={},this.state={viewLabelId:ms()},this.registerInteractiveComponent=(t,e)=>{let r=yC(t,e),a=[pg,fg].concat(this.props.pluginHooks.componentInteractions).map(o=>new o(r));this.interactionsStore[t.uid]=a,ia[t.uid]=r},this.unregisterInteractiveComponent=t=>{let e=this.interactionsStore[t.uid];if(e){for(let r of e)r.destroy();delete this.interactionsStore[t.uid]}delete ia[t.uid]},this.resizeRunner=new Yn(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=t=>{let{options:e}=this.props;e.handleWindowResize&&t.target===window&&this.resizeRunner.request(e.windowResizeDelay)}}render(){let{props:t}=this,{toolbarConfig:e,options:r}=t,i=!1,n="",a;t.isHeightAuto||t.forPrint?n="":r.height!=null?i=!0:r.contentHeight!=null?n=r.contentHeight:a=Math.max(r.aspectRatio,.5);let o=this.buildViewContext(t.viewSpec,t.viewApi,t.options,t.dateProfileGenerator,t.dateEnv,t.nowManager,t.theme,t.pluginHooks,t.dispatch,t.getCurrentData,t.emitter,t.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=e.header&&e.header.hasTitle?this.state.viewLabelId:void 0;return b(Jr.Provider,{value:o},b(Zr,{unit:"day"},c=>{let d=this.buildToolbarProps(t.viewSpec,t.dateProfile,t.dateProfileGenerator,t.currentDate,c,t.viewTitle);return b(Ne,null,e.header&&b(Ku,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:e.header,titleId:l},d)),b(hg,{liquid:i,height:n,aspectRatio:a,labeledById:l},this.renderView(t),this.buildAppendContent()),e.footer&&b(Ku,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:e.footer,titleId:""},d)))}))}componentDidMount(){let{props:t}=this;this.calendarInteractions=t.pluginHooks.calendarInteractions.map(r=>new r(t)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:e}=t.pluginHooks;for(let r in e)e[r](t[r],t)}componentDidUpdate(t){let{props:e}=this,{propSetHandlers:r}=e.pluginHooks;for(let i in r)e[i]!==t[i]&&r[i](e[i],e)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let t of this.calendarInteractions)t.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:t}=this,e=t.pluginHooks.viewContainerAppends.map(r=>r(t));return b(Ne,{},...e)}renderView(t){let{pluginHooks:e}=t,{viewSpec:r}=t,i={dateProfile:t.dateProfile,businessHours:t.businessHours,eventStore:t.renderableEventStore,eventUiBases:t.eventUiBases,dateSelection:t.dateSelection,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,isHeightAuto:t.isHeightAuto,forPrint:t.forPrint},n=this.buildViewPropTransformers(e.viewPropsTransformers);for(let o of n)Object.assign(i,o.transform(i,t));let a=r.component;return b(a,Object.assign({},i))}};function EO(s,t,e,r,i,n){let a=e.build(i,void 0,!1),o=e.buildPrev(t,r,!1),l=e.buildNext(t,r,!1);return{title:n,activeButton:s.type,navUnit:s.singleUnit,isTodayEnabled:a.isValid&&!Qr(t.currentRange,i),isPrevEnabled:o.isValid,isNextEnabled:l.isValid}}function DO(s){return s.map(t=>new t)}var Zu=class extends Ol{constructor(t,e={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=r=>{switch(r.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=r=>{this.currentData=r,this.renderRunner.request(r.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:r}=this;Al(()=>{Ys(b(Rl,{options:r.calendarOptions,theme:r.theme,emitter:r.emitter},(i,n,a,o)=>(this.setClassNames(i),this.setHeight(n),b(Om.Provider,{value:this.customContentRenderId},b(mg,Object.assign({isHeightAuto:a,forPrint:o},r))))),this.el)})}else this.isRendered&&(this.isRendered=!1,Ys(null,this.el),this.setClassNames([]),this.setHeight(""))},VD(t),this.el=t,this.renderRunner=new Yn(this.handleRenderRequest),new dg({optionOverrides:e,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let t=this.isRendering;t?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),t&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){Al(()=>{super.updateSize()})}batchRendering(t){this.renderRunner.pause("batchRendering"),t(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(t,e){this.currentDataManager.resetOptions(t,e)}setClassNames(t){if(!Li(t,this.currentClassNames)){let{classList:e}=this.el;for(let r of this.currentClassNames)e.remove(r);for(let r of t)e.add(r);this.currentClassNames=t}}setHeight(t){ym(this.el,"height",t)}};var ki=bt(Vr());var yg=class extends Pt{constructor(){super(...arguments),this.headerElRef=tt()}renderSimpleLayout(t,e){let{props:r,context:i}=this,n=[],a=na(i.options);return t&&n.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:t}}),n.push({type:"body",key:"body",liquid:!0,chunk:{content:e}}),b(gi,{elClasses:["fc-daygrid"],viewSpec:i.viewSpec},b(Qs,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[],sections:n}))}renderHScrollLayout(t,e,r,i){let n=this.context.pluginHooks.scrollGridImpl;if(!n)throw new Error("No ScrollGrid implementation");let{props:a,context:o}=this,l=!a.forPrint&&na(o.options),c=!a.forPrint&&sc(o.options),d=[];return t&&d.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:t}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:e}]}),c&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:fo}]}),b(gi,{elClasses:["fc-daygrid"],viewSpec:o.viewSpec},b(n,{liquid:!a.isHeightAuto&&!a.forPrint,forPrint:a.forPrint,collapsibleWidth:a.forPrint,colGroups:[{cols:[{span:r,minWidth:i}]}],sections:d}))}};function Xu(s,t){let e=[];for(let r=0;r<t;r+=1)e[r]=[];for(let r of s)e[r.row].push(r);return e}function Ju(s,t){let e=[];for(let r=0;r<t;r+=1)e[r]=[];for(let r of s)e[r.firstCol].push(r);return e}function JC(s,t){let e=[];if(s){for(let r=0;r<t;r+=1)e[r]={affectedInstances:s.affectedInstances,isEvent:s.isEvent,segs:[]};for(let r of s.segs)e[r.row].segs.push(r)}else for(let r=0;r<t;r+=1)e[r]=null;return e}var XC=Le({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function ex(s){let{display:t}=s.eventRange.ui;return t==="list-item"||t==="auto"&&!s.eventRange.def.allDay&&s.firstCol===s.lastCol&&s.isStart&&s.isEnd}var eh=class extends De{render(){let{props:t}=this;return b(Ks,Object.assign({},t,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:XC,defaultDisplayEventEnd:t.defaultDisplayEventEnd,disableResizing:!t.seg.eventRange.def.allDay}))}},th=class extends De{render(){let{props:t,context:e}=this,{options:r}=e,{seg:i}=t,n=r.eventTimeFormat||XC,a=Wu(i,n,e,!0,t.defaultDisplayEventEnd);return b(Xn,Object.assign({},t,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:Yu(t.seg,e),defaultGenerator:CO,timeText:a,isResizing:!1,isDateSelecting:!1}))}};function CO(s){return b(Ne,null,b("div",{className:"fc-daygrid-event-dot",style:{borderColor:s.borderColor||s.backgroundColor}}),s.timeText&&b("div",{className:"fc-event-time"},s.timeText),b("div",{className:"fc-event-title"},s.event.title||b(Ne,null,"\xA0")))}var vg=class extends De{constructor(){super(...arguments),this.compileSegs=ne(xO)}render(){let{props:t}=this,{allSegs:e,invisibleSegs:r}=this.compileSegs(t.singlePlacements);return b(ta,{elClasses:["fc-daygrid-more-link"],dateProfile:t.dateProfile,todayRange:t.todayRange,allDayDate:t.allDayDate,moreCnt:t.moreCnt,allSegs:e,hiddenSegs:r,alignmentElRef:t.alignmentElRef,alignGridTop:t.alignGridTop,extraDateSpan:t.extraDateSpan,popoverContent:()=>{let i=(t.eventDrag?t.eventDrag.affectedInstances:null)||(t.eventResize?t.eventResize.affectedInstances:null)||{};return b(Ne,null,e.map(n=>{let a=n.eventRange.instance.instanceId;return b("div",{className:"fc-daygrid-event-harness",key:a,style:{visibility:i[a]?"hidden":""}},ex(n)?b(th,Object.assign({seg:n,isDragging:!1,isSelected:a===t.eventSelection,defaultDisplayEventEnd:!1},wi(n,t.todayRange))):b(eh,Object.assign({seg:n,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:a===t.eventSelection,defaultDisplayEventEnd:!1},wi(n,t.todayRange))))}))}})}};function xO(s){let t=[],e=[];for(let r of s)t.push(r.seg),r.isVisible||e.push(r.seg);return{allSegs:t,invisibleSegs:e}}var MO=Le({week:"narrow"}),wg=class extends Pt{constructor(){super(...arguments),this.rootElRef=tt(),this.state={dayNumberId:ms()},this.handleRootEl=t=>{Or(this.rootElRef,t),Or(this.props.elRef,t)}}render(){let{context:t,props:e,state:r,rootElRef:i}=this,{options:n,dateEnv:a}=t,{date:o,dateProfile:l}=e,c=e.showDayNumber&&AO(o,l.currentRange,a);return b(Zs,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...e.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},e.extraDataAttrs),e.showDayNumber?{"aria-labelledby":r.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:_O,date:o,dateProfile:l,todayRange:e.todayRange,showDayNumber:e.showDayNumber,isMonthStart:c,extraRenderProps:e.extraRenderProps},(d,u)=>b("div",{ref:e.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:e.minHeight}},e.showWeekNumber&&b(oc,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:sa(t,o,"week"),date:o,defaultFormat:MO}),!u.isDisabled&&(e.showDayNumber||mo(n)||e.forceDayTop)?b("div",{className:"fc-daygrid-day-top"},b(d,{elTag:"a",elClasses:["fc-daygrid-day-number",c&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},sa(t,o)),{id:r.dayNumberId})})):e.showDayNumber?b("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},b("a",{className:"fc-daygrid-day-number"},"\xA0")):void 0,b("div",{className:"fc-daygrid-day-events",ref:e.fgContentElRef},e.fgContent,b("div",{className:"fc-daygrid-day-bottom",style:{marginTop:e.moreMarginTop}},b(vg,{allDayDate:o,singlePlacements:e.singlePlacements,moreCnt:e.moreCnt,alignmentElRef:i,alignGridTop:!e.showDayNumber,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange}))),b("div",{className:"fc-daygrid-day-bg"},e.bgContent)))}};function _O(s){return s.dayNumberText||b(Ne,null,"\xA0")}function AO(s,t,e){let{start:r,end:i}=t,n=Ri(i,-1),a=e.getYear(r),o=e.getMonth(r),l=e.getYear(n),c=e.getMonth(n);return!(a===l&&o===c)&&(s.valueOf()===r.valueOf()||e.getDay(s)===1&&s.valueOf()<i.valueOf())}function tx(s){return s.eventRange.instance.instanceId+":"+s.firstCol}function rx(s){return tx(s)+":"+s.lastCol}function IO(s,t,e,r,i,n,a){let o=new Tg(y=>{let w=s[y.index].eventRange.instance.instanceId+":"+y.span.start+":"+(y.span.end-1);return i[w]||1});o.allowReslicing=!0,o.strictOrder=r,t===!0||e===!0?(o.maxCoord=n,o.hiddenConsumes=!0):typeof t=="number"?o.maxStackCnt=t:typeof e=="number"&&(o.maxStackCnt=e,o.hiddenConsumes=!0);let l=[],c=[];for(let y=0;y<s.length;y+=1){let w=s[y],T=rx(w);i[T]!=null?l.push({index:y,span:{start:w.firstCol,end:w.lastCol+1}}):c.push(w)}let d=o.addSegs(l),u=o.toRects(),{singleColPlacements:h,multiColPlacements:p,leftoverMargins:f}=PO(u,s,a),m=[],g=[];for(let y of c){p[y.firstCol].push({seg:y,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let w=y.firstCol;w<=y.lastCol;w+=1)h[w].push({seg:go(y,w,w+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let y=0;y<a.length;y+=1)m.push(0);for(let y of d){let w=s[y.index],T=y.span;p[T.start].push({seg:go(w,T.start,T.end,a),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let S=T.start;S<T.end;S+=1)m[S]+=1,h[S].push({seg:go(w,S,S+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let y=0;y<a.length;y+=1)g.push(f[y]);return{singleColPlacements:h,multiColPlacements:p,moreCnts:m,moreMarginTops:g}}function PO(s,t,e){let r=NO(s,e.length),i=[],n=[],a=[];for(let o=0;o<e.length;o+=1){let l=r[o],c=[],d=0,u=0;for(let p of l){let f=t[p.index];c.push({seg:go(f,o,o+1,e),isVisible:!0,isAbsolute:!1,absoluteTop:p.levelCoord,marginTop:p.levelCoord-d}),d=p.levelCoord+p.thickness}let h=[];d=0,u=0;for(let p of l){let f=t[p.index],m=p.span.end-p.span.start>1,g=p.span.start===o;u+=p.levelCoord-d,d=p.levelCoord+p.thickness,m?(u+=p.thickness,g&&h.push({seg:go(f,p.span.start,p.span.end,e),isVisible:!0,isAbsolute:!0,absoluteTop:p.levelCoord,marginTop:0})):g&&(h.push({seg:go(f,p.span.start,p.span.end,e),isVisible:!0,isAbsolute:!1,absoluteTop:p.levelCoord,marginTop:u}),u=0)}i.push(c),n.push(h),a.push(u)}return{singleColPlacements:i,multiColPlacements:n,leftoverMargins:a}}function NO(s,t){let e=[];for(let r=0;r<t;r+=1)e.push([]);for(let r of s)for(let i=r.span.start;i<r.span.end;i+=1)e[i].push(r);return e}function go(s,t,e,r){if(s.firstCol===t&&s.lastCol===e-1)return s;let i=s.eventRange,n=i.range,a=Rr(n,{start:r[t].date,end:pt(r[e-1].date,1)});return Object.assign(Object.assign({},s),{firstCol:t,lastCol:e-1,eventRange:{def:i.def,ui:Object.assign(Object.assign({},i.ui),{durationEditable:!1}),instance:i.instance,range:a},isStart:s.isStart&&a.start.valueOf()===n.start.valueOf(),isEnd:s.isEnd&&a.end.valueOf()===n.end.valueOf()})}var Tg=class extends Qn{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(t){let e=super.addSegs(t),{entriesByLevel:r}=this,i=n=>!this.forceHidden[Fi(n)];for(let n=0;n<r.length;n+=1)r[n]=r[n].filter(i);return e}handleInvalidInsertion(t,e,r){let{entriesByLevel:i,forceHidden:n}=this,{touchingEntry:a,touchingLevel:o,touchingLateral:l}=t;if(this.hiddenConsumes&&a){let c=Fi(a);if(!n[c])if(this.allowReslicing){let d=Object.assign(Object.assign({},a),{span:tc(a.span,e.span)}),u=Fi(d);n[u]=!0,i[o][l]=d,r.push(d),this.splitEntry(a,e,r)}else n[c]=!0,r.push(a)}super.handleInvalidInsertion(t,e,r)}},rh=class extends Pt{constructor(){super(...arguments),this.cellElRefs=new wr,this.frameElRefs=new wr,this.fgElRefs=new wr,this.segHarnessRefs=new wr,this.rootElRef=tt(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=t=>{t&&this.updateSizing(!0)}}render(){let{props:t,state:e,context:r}=this,{options:i}=r,n=t.cells.length,a=Ju(t.businessHourSegs,n),o=Ju(t.bgEventSegs,n),l=Ju(this.getHighlightSegs(),n),c=Ju(this.getMirrorSegs(),n),{singleColPlacements:d,multiColPlacements:u,moreCnts:h,moreMarginTops:p}=IO(Zl(t.fgEventSegs,i.eventOrder),t.dayMaxEvents,t.dayMaxEventRows,i.eventOrderStrict,e.segHeights,e.maxContentHeight,t.cells),f=t.eventDrag&&t.eventDrag.affectedInstances||t.eventResize&&t.eventResize.affectedInstances||{};return b("tr",{ref:this.rootElRef,role:"row"},t.renderIntro&&t.renderIntro(),t.cells.map((m,g)=>{let y=this.renderFgSegs(g,t.forPrint?d[g]:u[g],t.todayRange,f),w=this.renderFgSegs(g,RO(c[g],u),t.todayRange,{},!!t.eventDrag,!!t.eventResize,!1);return b(wg,{key:m.key,elRef:this.cellElRefs.createRef(m.key),innerElRef:this.frameElRefs.createRef(m.key),dateProfile:t.dateProfile,date:m.date,showDayNumber:t.showDayNumbers,showWeekNumber:t.showWeekNumbers&&g===0,forceDayTop:t.showWeekNumbers,todayRange:t.todayRange,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,extraRenderProps:m.extraRenderProps,extraDataAttrs:m.extraDataAttrs,extraClassNames:m.extraClassNames,extraDateSpan:m.extraDateSpan,moreCnt:h[g],moreMarginTop:p[g],singlePlacements:d[g],fgContentElRef:this.fgElRefs.createRef(m.key),fgContent:b(Ne,null,b(Ne,null,y),b(Ne,null,w)),bgContent:b(Ne,null,this.renderFillSegs(l[g],"highlight"),this.renderFillSegs(a[g],"non-business"),this.renderFillSegs(o[g],"bg-event")),minHeight:t.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(t,e){let r=this.props;this.updateSizing(!Zt(t,r))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:t}=this;return t.eventDrag&&t.eventDrag.segs.length?t.eventDrag.segs:t.eventResize&&t.eventResize.segs.length?t.eventResize.segs:t.dateSelectionSegs}getMirrorSegs(){let{props:t}=this;return t.eventResize&&t.eventResize.segs.length?t.eventResize.segs:[]}renderFgSegs(t,e,r,i,n,a,o){let{context:l}=this,{eventSelection:c}=this.props,{framePositions:d}=this.state,u=this.props.cells.length===1,h=n||a||o,p=[];if(d)for(let f of e){let{seg:m}=f,{instanceId:g}=m.eventRange.instance,y=f.isVisible&&!i[g],w=f.isAbsolute,T="",S="";w&&(l.isRtl?(S=0,T=d.lefts[m.lastCol]-d.lefts[m.firstCol]):(T=0,S=d.rights[m.firstCol]-d.rights[m.lastCol])),p.push(b("div",{className:"fc-daygrid-event-harness"+(w?" fc-daygrid-event-harness-abs":""),key:tx(m),ref:h?null:this.segHarnessRefs.createRef(rx(m)),style:{visibility:y?"":"hidden",marginTop:w?"":f.marginTop,top:w?f.absoluteTop:"",left:T,right:S}},ex(m)?b(th,Object.assign({seg:m,isDragging:n,isSelected:g===c,defaultDisplayEventEnd:u},wi(m,r))):b(eh,Object.assign({seg:m,isDragging:n,isResizing:a,isDateSelecting:o,isSelected:g===c,defaultDisplayEventEnd:u},wi(m,r)))))}return p}renderFillSegs(t,e){let{isRtl:r}=this.context,{todayRange:i}=this.props,{framePositions:n}=this.state,a=[];if(n)for(let o of t){let l=r?{right:0,left:n.lefts[o.lastCol]-n.lefts[o.firstCol]}:{left:0,right:n.rights[o.firstCol]-n.rights[o.lastCol]};a.push(b("div",{key:Jl(o.eventRange),className:"fc-daygrid-bg-harness",style:l},e==="bg-event"?b(ea,Object.assign({seg:o},wi(o,i))):ac(e)))}return b(Ne,{},...a)}updateSizing(t){let{props:e,state:r,frameElRefs:i}=this;if(!e.forPrint&&e.clientWidth!==null){if(t){let l=e.cells.map(c=>i.currentMap[c.key]);if(l.length){let c=this.rootElRef.current,d=new vi(c,l,!0,!1);(!r.framePositions||!r.framePositions.similarTo(d))&&this.setState({framePositions:new vi(c,l,!0,!1)})}}let n=this.state.segHeights,a=this.querySegHeights(),o=e.dayMaxEvents===!0||e.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},n),a),maxContentHeight:o?this.computeMaxContentHeight():null})}}querySegHeights(){let t=this.segHarnessRefs.currentMap,e={};for(let r in t){let i=Math.round(t[r].getBoundingClientRect().height);e[r]=Math.max(e[r]||0,i)}return e}computeMaxContentHeight(){let t=this.props.cells[0].key,e=this.cellElRefs.currentMap[t],r=this.fgElRefs.currentMap[t];return e.getBoundingClientRect().bottom-r.getBoundingClientRect().top}getCellEls(){let t=this.cellElRefs.currentMap;return this.props.cells.map(e=>t[e.key])}};rh.addStateEquality({segHeights:Zt});function RO(s,t){if(!s.length)return[];let e=OO(t);return s.map(r=>({seg:r,isVisible:!0,isAbsolute:!0,absoluteTop:e[r.eventRange.instance.instanceId],marginTop:0}))}function OO(s){let t={};for(let e of s)for(let r of e)t[r.seg.eventRange.instance.instanceId]=r.absoluteTop;return t}var lc=class extends Pt{constructor(){super(...arguments),this.splitBusinessHourSegs=ne(Xu),this.splitBgEventSegs=ne(FO),this.splitFgEventSegs=ne(Xu),this.splitDateSelectionSegs=ne(Xu),this.splitEventDrag=ne(JC),this.splitEventResize=ne(JC),this.rowRefs=new wr}render(){let{props:t,context:e}=this,r=t.cells.length,i=this.splitBusinessHourSegs(t.businessHourSegs,r),n=this.splitBgEventSegs(t.bgEventSegs,r),a=this.splitFgEventSegs(t.fgEventSegs,r),o=this.splitDateSelectionSegs(t.dateSelectionSegs,r),l=this.splitEventDrag(t.eventDrag,r),c=this.splitEventResize(t.eventResize,r),d=r>=7&&t.clientWidth?t.clientWidth/e.options.aspectRatio/6:null;return b(Zr,{unit:"day"},(u,h)=>b(Ne,null,t.cells.map((p,f)=>b(rh,{ref:this.rowRefs.createRef(f),key:p.length?p[0].date.toISOString():f,showDayNumbers:r>1,showWeekNumbers:t.showWeekNumbers,todayRange:h,dateProfile:t.dateProfile,cells:p,renderIntro:t.renderRowIntro,businessHourSegs:i[f],eventSelection:t.eventSelection,bgEventSegs:n[f],fgEventSegs:a[f],dateSelectionSegs:o[f],eventDrag:l[f],eventResize:c[f],dayMaxEvents:t.dayMaxEvents,dayMaxEventRows:t.dayMaxEventRows,clientWidth:t.clientWidth,clientHeight:t.clientHeight,cellMinHeight:d,forPrint:t.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){let t=this.rowRefs.currentMap[0].getCellEls()[0],e=t?t.closest(".fc-daygrid-body"):null;e&&(this.rootEl=e,this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new vi(this.rootEl,this.rowRefs.collect().map(t=>t.getCellEls()[0]),!1,!0),this.colPositions=new vi(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(t,e){let{colPositions:r,rowPositions:i}=this,n=r.leftToIndex(t),a=i.topToIndex(e);if(a!=null&&n!=null){let o=this.props.cells[a][n];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(a,n),allDay:!0},o.extraDateSpan),dayEl:this.getCellEl(a,n),rect:{left:r.lefts[n],right:r.rights[n],top:i.tops[a],bottom:i.bottoms[a]},layer:0}}return null}getCellEl(t,e){return this.rowRefs.currentMap[t].getCellEls()[e]}getCellRange(t,e){let r=this.props.cells[t][e].date,i=pt(r,1);return{start:r,end:i}}};function FO(s,t){return Xu(s.filter(LO),t)}function LO(s){return s.eventRange.def.allDay}var bg=class extends Pt{constructor(){super(...arguments),this.elRef=tt(),this.needsScrollReset=!1}render(){let{props:t}=this,{dayMaxEventRows:e,dayMaxEvents:r,expandRows:i}=t,n=r===!0||e===!0;n&&!i&&(n=!1,e=null,r=null);let a=["fc-daygrid-body",n?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",i?"":"fc-daygrid-body-natural"];return b("div",{ref:this.elRef,className:a.join(" "),style:{width:t.clientWidth,minWidth:t.tableMinWidth}},b("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:t.clientWidth,minWidth:t.tableMinWidth,height:i?t.clientHeight:""}},t.colGroupNode,b("tbody",{role:"presentation"},b(lc,{dateProfile:t.dateProfile,cells:t.cells,renderRowIntro:t.renderRowIntro,showWeekNumbers:t.showWeekNumbers,clientWidth:t.clientWidth,clientHeight:t.clientHeight,businessHourSegs:t.businessHourSegs,bgEventSegs:t.bgEventSegs,fgEventSegs:t.fgEventSegs,dateSelectionSegs:t.dateSelectionSegs,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,dayMaxEvents:r,dayMaxEventRows:e,forPrint:t.forPrint,isHitComboAllowed:t.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(t){t.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){let t=HO(this.elRef.current,this.props.dateProfile);if(t){let e=t.closest(".fc-daygrid-body"),r=e.closest(".fc-scroller"),i=t.getBoundingClientRect().top-e.getBoundingClientRect().top;r.scrollTop=i?i+1:0}this.needsScrollReset=!1}}};function HO(s,t){let e;return t.currentRangeUnit.match(/year|month/)&&(e=s.querySelector(`[data-date="${oo(t.currentDate)}-01"]`)),e||(e=s.querySelector(`[data-date="${zl(t.currentDate)}"]`)),e}var cc=class extends Jn{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(t,e){return e.sliceRange(t)}},dc=class extends Pt{constructor(){super(...arguments),this.slicer=new cc,this.tableRef=tt()}render(){let{props:t,context:e}=this;return b(bg,Object.assign({ref:this.tableRef},this.slicer.sliceProps(t,t.dateProfile,t.nextDayThreshold,e,t.dayTableModel),{dateProfile:t.dateProfile,cells:t.dayTableModel.cells,colGroupNode:t.colGroupNode,tableMinWidth:t.tableMinWidth,renderRowIntro:t.renderRowIntro,dayMaxEvents:t.dayMaxEvents,dayMaxEventRows:t.dayMaxEventRows,showWeekNumbers:t.showWeekNumbers,expandRows:t.expandRows,headerAlignElRef:t.headerAlignElRef,clientWidth:t.clientWidth,clientHeight:t.clientHeight,forPrint:t.forPrint}))}},ih=class extends yg{constructor(){super(...arguments),this.buildDayTableModel=ne(kg),this.headerRef=tt(),this.tableRef=tt()}render(){let{options:t,dateProfileGenerator:e}=this.context,{props:r}=this,i=this.buildDayTableModel(r.dateProfile,e),n=t.dayHeaders&&b(fs,{ref:this.headerRef,dateProfile:r.dateProfile,dates:i.headerDates,datesRepDistinctDays:i.rowCnt===1}),a=o=>b(dc,{ref:this.tableRef,dateProfile:r.dateProfile,dayTableModel:i,businessHours:r.businessHours,dateSelection:r.dateSelection,eventStore:r.eventStore,eventUiBases:r.eventUiBases,eventSelection:r.eventSelection,eventDrag:r.eventDrag,eventResize:r.eventResize,nextDayThreshold:t.nextDayThreshold,colGroupNode:o.tableColGroupNode,tableMinWidth:o.tableMinWidth,dayMaxEvents:t.dayMaxEvents,dayMaxEventRows:t.dayMaxEventRows,showWeekNumbers:t.weekNumbers,expandRows:!r.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:o.clientWidth,clientHeight:o.clientHeight,forPrint:r.forPrint});return t.dayMinWidth?this.renderHScrollLayout(n,a,i.colCnt,t.dayMinWidth):this.renderSimpleLayout(n,a)}};function kg(s,t){let e=new Kn(s.renderRange,t);return new Zn(e,/year|month|week/.test(s.currentRangeUnit))}var yo=class extends jn{buildRenderRange(t,e,r){let i=super.buildRenderRange(t,e,r),{props:n}=this;return Sg({currentRange:i,snapToWeek:/^(year|month)$/.test(e),fixedWeekCount:n.fixedWeekCount,dateEnv:n.dateEnv})}};function Sg(s){let{dateEnv:t,currentRange:e}=s,{start:r,end:i}=e,n;if(s.snapToWeek&&(r=t.startOfWeek(r),n=t.startOfWeek(i),n.valueOf()!==i.valueOf()&&(i=Ru(n,1))),s.fixedWeekCount){let a=t.startOfWeek(t.startOfMonth(pt(e.end,-1))),o=Math.ceil(Cm(a,i));i=Ru(i,6-o)}return{start:r,end:i}}var BO=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';Js(BO);var ix=Tr({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:ih,dateProfileGeneratorClass:yo},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});var Dg=class extends Fl{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(t){return t.allDay?["allDay"]:["timed"]}getKeysForEventDef(t){return t.allDay?jm(t)?["timed","allDay"]:["allDay"]:["timed"]}},UO=Le({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function lx(s){let t=["fc-timegrid-slot","fc-timegrid-slot-label",s.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return b(Jr.Consumer,null,e=>{if(!s.isLabeled)return b("td",{className:t.join(" "),"data-time":s.isoTimeStr});let{dateEnv:r,options:i,viewApi:n}=e,a=i.slotLabelFormat==null?UO:Array.isArray(i.slotLabelFormat)?Le(i.slotLabelFormat[0]):Le(i.slotLabelFormat),o={level:0,time:s.time,date:r.toDate(s.date),view:n,text:r.format(s.date,a)};return b(It,{elTag:"td",elClasses:t,elAttrs:{"data-time":s.isoTimeStr},renderProps:o,generatorName:"slotLabelContent",customGenerator:i.slotLabelContent,defaultGenerator:$O,classNameGenerator:i.slotLabelClassNames,didMount:i.slotLabelDidMount,willUnmount:i.slotLabelWillUnmount},l=>b("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},b(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function $O(s){return s.text}var Cg=class extends De{render(){return this.props.slatMetas.map(t=>b("tr",{key:t.key},b(lx,Object.assign({},t))))}},VO=Le({week:"short"}),WO=5,xg=class extends Pt{constructor(){super(...arguments),this.allDaySplitter=new Dg,this.headerElRef=tt(),this.rootElRef=tt(),this.scrollerElRef=tt(),this.state={slatCoords:null},this.handleScrollTopRequest=t=>{let e=this.scrollerElRef.current;e&&(e.scrollTop=t)},this.renderHeadAxis=(t,e="")=>{let{options:r}=this.context,{dateProfile:i}=this.props,n=i.renderRange,o=ys(n.start,n.end)===1?sa(this.context,n.start,"week"):{};return r.weekNumbers&&t==="day"?b(oc,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:n.start,defaultFormat:VO},l=>b("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:e}},b(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:o}))):b("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},b("div",{className:"fc-timegrid-axis-frame",style:{height:e}}))},this.renderTableRowAxis=t=>{let{options:e,viewApi:r}=this.context,i={text:e.allDayText,view:r};return b(It,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:i,generatorName:"allDayContent",customGenerator:e.allDayContent,defaultGenerator:YO,classNameGenerator:e.allDayClassNames,didMount:e.allDayDidMount,willUnmount:e.allDayWillUnmount},n=>b("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",t==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:t}},b(n,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=t=>{this.setState({slatCoords:t})}}renderSimpleLayout(t,e,r){let{context:i,props:n}=this,a=[],o=na(i.options);return t&&a.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:t}}),e&&(a.push({type:"body",key:"all-day",chunk:{content:e}}),a.push({type:"body",key:"all-day-divider",outerContent:b("tr",{role:"presentation",className:"fc-scrollgrid-section"},b("td",{className:"fc-timegrid-divider "+i.theme.getClass("tableCellShaded")}))})),a.push({type:"body",key:"body",liquid:!0,expandRows:!!i.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:r}}),b(gi,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:i.viewSpec},b(Qs,{liquid:!n.isHeightAuto&&!n.forPrint,collapsibleWidth:n.forPrint,cols:[{width:"shrink"}],sections:a}))}renderHScrollLayout(t,e,r,i,n,a,o){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:c,props:d}=this,u=!d.forPrint&&na(c.options),h=!d.forPrint&&sc(c.options),p=[];t&&p.push({type:"header",key:"header",isSticky:u,syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>b("tr",{role:"presentation"},this.renderHeadAxis("day",m.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:t}]}),e&&(p.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>b("tr",{role:"presentation"},this.renderTableRowAxis(m.rowSyncHeights[0]))},{key:"cols",content:e}]}),p.push({key:"all-day-divider",type:"body",outerContent:b("tr",{role:"presentation",className:"fc-scrollgrid-section"},b("td",{colSpan:2,className:"fc-timegrid-divider "+c.theme.getClass("tableCellShaded")}))}));let f=c.options.nowIndicator;return p.push({type:"body",key:"body",liquid:!0,expandRows:!!c.options.expandRows,chunks:[{key:"axis",content:m=>b("div",{className:"fc-timegrid-axis-chunk"},b("table",{"aria-hidden":!0,style:{height:m.expandRows?m.clientHeight:""}},m.tableColGroupNode,b("tbody",null,b(Cg,{slatMetas:a}))),b("div",{className:"fc-timegrid-now-indicator-container"},b(Zr,{unit:f?"minute":"day"},g=>{let y=f&&o&&o.safeComputeTop(g);return typeof y=="number"?b(nc,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:y},isAxis:!0,date:g}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:r}]}),h&&p.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:fo},{key:"cols",content:fo}]}),b(gi,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:c.viewSpec},b(l,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:i,minWidth:n}]}],sections:p}))}getAllDayMaxEventProps(){let{dayMaxEvents:t,dayMaxEventRows:e}=this.context.options;return(t===!0||e===!0)&&(t=void 0,e=WO),{dayMaxEvents:t,dayMaxEventRows:e}}};function YO(s){return s.text}var Mg=class{constructor(t,e,r){this.positions=t,this.dateProfile=e,this.slotDuration=r}safeComputeTop(t){let{dateProfile:e}=this;if(Qr(e.currentRange,t)){let r=Ve(t),i=t.valueOf()-r.valueOf();if(i>=Nr(e.slotMinTime)&&i<Nr(e.slotMaxTime))return this.computeTimeTop(pe(i))}return null}computeDateTop(t,e){return e||(e=Ve(t)),this.computeTimeTop(pe(t.valueOf()-e.valueOf()))}computeTimeTop(t){let{positions:e,dateProfile:r}=this,i=e.els.length,n=(t.milliseconds-Nr(r.slotMinTime))/Nr(this.slotDuration),a,o;return n=Math.max(0,n),n=Math.min(i,n),a=Math.floor(n),a=Math.min(a,i-1),o=n-a,e.tops[a]+e.getHeight(a)*o}},_g=class extends De{render(){let{props:t,context:e}=this,{options:r}=e,{slatElRefs:i}=t;return b("tbody",null,t.slatMetas.map((n,a)=>{let o={time:n.time,date:e.dateEnv.toDate(n.date),view:e.viewApi};return b("tr",{key:n.key,ref:i.createRef(n.key)},t.axis&&b(lx,Object.assign({},n)),b(It,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!n.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":n.isoTimeStr},renderProps:o,generatorName:"slotLaneContent",customGenerator:r.slotLaneContent,classNameGenerator:r.slotLaneClassNames,didMount:r.slotLaneDidMount,willUnmount:r.slotLaneWillUnmount}))}))}},Ag=class extends De{constructor(){super(...arguments),this.rootElRef=tt(),this.slatElRefs=new wr}render(){let{props:t,context:e}=this;return b("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},b("table",{"aria-hidden":!0,className:e.theme.getClass("table"),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:t.minHeight}},t.tableColGroupNode,b(_g,{slatElRefs:this.slatElRefs,axis:t.axis,slatMetas:t.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:t,props:e}=this;e.onCoords&&e.clientWidth!==null&&this.rootElRef.current.offsetHeight&&e.onCoords(new Mg(new vi(this.rootElRef.current,jO(this.slatElRefs.currentMap,e.slatMetas),!1,!0),this.props.dateProfile,t.options.slotDuration))}};function jO(s,t){return t.map(e=>s[e.key])}function uc(s,t){let e=[],r;for(r=0;r<t;r+=1)e.push([]);if(s)for(r=0;r<s.length;r+=1)e[s[r].col].push(s[r]);return e}function sx(s,t){let e=[];if(s){for(let r=0;r<t;r+=1)e[r]={affectedInstances:s.affectedInstances,isEvent:s.isEvent,segs:[]};for(let r of s.segs)e[r.col].segs.push(r)}else for(let r=0;r<t;r+=1)e[r]=null;return e}var Ig=class extends De{render(){let{props:t}=this;return b(ta,{elClasses:["fc-timegrid-more-link"],elStyle:{top:t.top,bottom:t.bottom},allDayDate:null,moreCnt:t.hiddenSegs.length,allSegs:t.hiddenSegs,hiddenSegs:t.hiddenSegs,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,todayRange:t.todayRange,popoverContent:()=>cx(t.hiddenSegs,t),defaultGenerator:zO,forceTimed:!0},e=>b(e,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}};function zO(s){return s.shortText}function qO(s,t,e){let r=new Qn;t!=null&&(r.strictOrder=t),e!=null&&(r.maxStackCnt=e);let i=r.addSegs(s),n=ig(i),a=GO(r);return a=JO(a,1),{segRects:XO(a),hiddenGroups:n}}function GO(s){let{entriesByLevel:t}=s,e=Lg((r,i)=>r+":"+i,(r,i)=>{let n=ZO(s,r,i),a=nx(n,e),o=t[r][i];return[Object.assign(Object.assign({},o),{nextLevelNodes:a[0]}),o.thickness+a[1]]});return nx(t.length?{level:0,lateralStart:0,lateralEnd:t[0].length}:null,e)[0]}function nx(s,t){if(!s)return[[],0];let{level:e,lateralStart:r,lateralEnd:i}=s,n=r,a=[];for(;n<i;)a.push(t(e,n)),n+=1;return a.sort(QO),[a.map(KO),a[0][1]]}function QO(s,t){return t[1]-s[1]}function KO(s){return s[0]}function ZO(s,t,e){let{levelCoords:r,entriesByLevel:i}=s,n=i[t][e],a=r[t]+n.thickness,o=r.length,l=t;for(;l<o&&r[l]<a;l+=1);for(;l<o;l+=1){let c=i[l],d,u=Ul(c,n.span.start,Bl),h=u[0]+u[1],p=h;for(;(d=c[p])&&d.span.start<n.span.end;)p+=1;if(h<p)return{level:l,lateralStart:h,lateralEnd:p}}return null}function JO(s,t){let e=Lg((r,i,n)=>Fi(r),(r,i,n)=>{let{nextLevelNodes:a,thickness:o}=r,l=o+n,c=o/l,d,u=[];if(!a.length)d=t;else for(let p of a)if(d===void 0){let f=e(p,i,l);d=f[0],u.push(f[1])}else{let f=e(p,d,0);u.push(f[1])}let h=(d-i)*c;return[d-h,Object.assign(Object.assign({},r),{thickness:h,nextLevelNodes:u})]});return s.map(r=>e(r,0,0)[1])}function XO(s){let t=[],e=Lg((i,n,a)=>Fi(i),(i,n,a)=>{let o=Object.assign(Object.assign({},i),{levelCoord:n,stackDepth:a,stackForward:0});return t.push(o),o.stackForward=r(i.nextLevelNodes,n+i.thickness,a+1)+1});function r(i,n,a){let o=0;for(let l of i)o=Math.max(e(l,n,a),o);return o}return r(s,0,0),t}function Lg(s,t){let e={};return(...r)=>{let i=s(...r);return i in e?e[i]:e[i]=t(...r)}}function ax(s,t,e=null,r=0){let i=[];if(e)for(let n=0;n<s.length;n+=1){let a=s[n],o=e.computeDateTop(a.start,t),l=Math.max(o+(r||0),e.computeDateTop(a.end,t));i.push({start:Math.round(o),end:Math.round(l)})}return i}function eF(s,t,e,r){let i=[],n=[];for(let c=0;c<s.length;c+=1){let d=t[c];d?i.push({index:c,thickness:1,span:d}):n.push(s[c])}let{segRects:a,hiddenGroups:o}=qO(i,e,r),l=[];for(let c of a)l.push({seg:s[c.index],rect:c});for(let c of n)l.push({seg:c,rect:null});return{segPlacements:l,hiddenGroups:o}}var tF=Le({hour:"numeric",minute:"2-digit",meridiem:!1}),sh=class extends De{render(){return b(Ks,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:tF}))}},Pg=class extends De{constructor(){super(...arguments),this.sortEventSegs=ne(Zl)}render(){let{props:t,context:e}=this,{options:r}=e,i=r.selectMirror,n=t.eventDrag&&t.eventDrag.segs||t.eventResize&&t.eventResize.segs||i&&t.dateSelectionSegs||[],a=t.eventDrag&&t.eventDrag.affectedInstances||t.eventResize&&t.eventResize.affectedInstances||{},o=this.sortEventSegs(t.fgEventSegs,r.eventOrder);return b(Zs,{elTag:"td",elRef:t.elRef,elClasses:["fc-timegrid-col",...t.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},t.extraDataAttrs),date:t.date,dateProfile:t.dateProfile,todayRange:t.todayRange,extraRenderProps:t.extraRenderProps},l=>b("div",{className:"fc-timegrid-col-frame"},b("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(t.businessHourSegs,"non-business"),this.renderFillSegs(t.bgEventSegs,"bg-event"),this.renderFillSegs(t.dateSelectionSegs,"highlight")),b("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(o,a,!1,!1,!1)),b("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(n,{},!!t.eventDrag,!!t.eventResize,!!i,"mirror")),b("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(t.nowIndicatorSegs)),mo(r)&&b(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(t,e,r,i,n,a){let{props:o}=this;return o.forPrint?cx(t,o):this.renderPositionedFgSegs(t,e,r,i,n,a)}renderPositionedFgSegs(t,e,r,i,n,a){let{eventMaxStack:o,eventShortHeight:l,eventOrderStrict:c,eventMinHeight:d}=this.context.options,{date:u,slatCoords:h,eventSelection:p,todayRange:f,nowDate:m}=this.props,g=r||i||n,y=ax(t,u,h,d),{segPlacements:w,hiddenGroups:T}=eF(t,y,c,o);return b(Ne,null,this.renderHiddenGroups(T,t),w.map(S=>{let{seg:x,rect:I}=S,F=x.eventRange.instance.instanceId,A=g||!!(!e[F]&&I),L=Eg(I&&I.span),G=!g&&I?this.computeSegHStyle(I):{left:0,right:0},V=!!I&&I.stackForward>0,k=!!I&&I.span.end-I.span.start<l;return b("div",{className:"fc-timegrid-event-harness"+(V?" fc-timegrid-event-harness-inset":""),key:a||F,style:Object.assign(Object.assign({visibility:A?"":"hidden"},L),G)},b(sh,Object.assign({seg:x,isDragging:r,isResizing:i,isDateSelecting:n,isSelected:F===p,isShort:k},wi(x,f,m))))}))}renderHiddenGroups(t,e){let{extraDateSpan:r,dateProfile:i,todayRange:n,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c}=this.props;return b(Ne,null,t.map(d=>{let u=Eg(d.span),h=rF(d.entries,e);return b(Ig,{key:Ou(Gu(h)),hiddenSegs:h,top:u.top,bottom:u.bottom,extraDateSpan:r,dateProfile:i,todayRange:n,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c})}))}renderFillSegs(t,e){let{props:r,context:i}=this,a=ax(t,r.date,r.slatCoords,i.options.eventMinHeight).map((o,l)=>{let c=t[l];return b("div",{key:Jl(c.eventRange),className:"fc-timegrid-bg-harness",style:Eg(o)},e==="bg-event"?b(ea,Object.assign({seg:c},wi(c,r.todayRange,r.nowDate))):ac(e))});return b(Ne,null,a)}renderNowIndicator(t){let{slatCoords:e,date:r}=this.props;return e?t.map((i,n)=>b(nc,{key:n,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:e.computeDateTop(i.start,r)},isAxis:!1,date:r})):null}computeSegHStyle(t){let{isRtl:e,options:r}=this.context,i=r.slotEventOverlap,n=t.levelCoord,a=t.levelCoord+t.thickness,o,l;i&&(a=Math.min(1,n+(a-n)*2)),e?(o=1-a,l=n):(o=n,l=1-a);let c={zIndex:t.stackDepth+1,left:o*100+"%",right:l*100+"%"};return i&&!t.stackForward&&(c[e?"marginLeft":"marginRight"]=20),c}};function cx(s,{todayRange:t,nowDate:e,eventSelection:r,eventDrag:i,eventResize:n}){let a=(i?i.affectedInstances:null)||(n?n.affectedInstances:null)||{};return b(Ne,null,s.map(o=>{let l=o.eventRange.instance.instanceId;return b("div",{key:l,style:{visibility:a[l]?"hidden":""}},b(sh,Object.assign({seg:o,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===r,isShort:!1},wi(o,t,e))))}))}function Eg(s){return s?{top:s.start,bottom:-s.end}:{top:"",bottom:""}}function rF(s,t){return s.map(e=>t[e.index])}var Ng=class extends De{constructor(){super(...arguments),this.splitFgEventSegs=ne(uc),this.splitBgEventSegs=ne(uc),this.splitBusinessHourSegs=ne(uc),this.splitNowIndicatorSegs=ne(uc),this.splitDateSelectionSegs=ne(uc),this.splitEventDrag=ne(sx),this.splitEventResize=ne(sx),this.rootElRef=tt(),this.cellElRefs=new wr}render(){let{props:t,context:e}=this,r=e.options.nowIndicator&&t.slatCoords&&t.slatCoords.safeComputeTop(t.nowDate),i=t.cells.length,n=this.splitFgEventSegs(t.fgEventSegs,i),a=this.splitBgEventSegs(t.bgEventSegs,i),o=this.splitBusinessHourSegs(t.businessHourSegs,i),l=this.splitNowIndicatorSegs(t.nowIndicatorSegs,i),c=this.splitDateSelectionSegs(t.dateSelectionSegs,i),d=this.splitEventDrag(t.eventDrag,i),u=this.splitEventResize(t.eventResize,i);return b("div",{className:"fc-timegrid-cols",ref:this.rootElRef},b("table",{role:"presentation",style:{minWidth:t.tableMinWidth,width:t.clientWidth}},t.tableColGroupNode,b("tbody",{role:"presentation"},b("tr",{role:"row"},t.axis&&b("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},b("div",{className:"fc-timegrid-col-frame"},b("div",{className:"fc-timegrid-now-indicator-container"},typeof r=="number"&&b(nc,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:r},isAxis:!0,date:t.nowDate})))),t.cells.map((h,p)=>b(Pg,{key:h.key,elRef:this.cellElRefs.createRef(h.key),dateProfile:t.dateProfile,date:h.date,nowDate:t.nowDate,todayRange:t.todayRange,extraRenderProps:h.extraRenderProps,extraDataAttrs:h.extraDataAttrs,extraClassNames:h.extraClassNames,extraDateSpan:h.extraDateSpan,fgEventSegs:n[p],bgEventSegs:a[p],businessHourSegs:o[p],nowIndicatorSegs:l[p],dateSelectionSegs:c[p],eventDrag:d[p],eventResize:u[p],slatCoords:t.slatCoords,eventSelection:t.eventSelection,forPrint:t.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:t}=this;t.onColCoords&&t.clientWidth!==null&&t.onColCoords(new vi(this.rootElRef.current,iF(this.cellElRefs.currentMap,t.cells),!0,!1))}};function iF(s,t){return t.map(e=>s[e.key])}var Rg=class extends Pt{constructor(){super(...arguments),this.processSlotOptions=ne(sF),this.state={slatCoords:null},this.handleRootEl=t=>{t?this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=t=>{let{onScrollTopRequest:e}=this.props,{slatCoords:r}=this.state;if(e&&r){if(t.time){let i=r.computeTimeTop(t.time);i=Math.ceil(i),i&&(i+=1),e(i)}return!0}return!1},this.handleColCoords=t=>{this.colCoords=t},this.handleSlatCoords=t=>{this.setState({slatCoords:t}),this.props.onSlatCoords&&this.props.onSlatCoords(t)}}render(){let{props:t,state:e}=this;return b("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:t.clientWidth,minWidth:t.tableMinWidth}},b(Ag,{axis:t.axis,dateProfile:t.dateProfile,slatMetas:t.slatMetas,clientWidth:t.clientWidth,minHeight:t.expandRows?t.clientHeight:"",tableMinWidth:t.tableMinWidth,tableColGroupNode:t.axis?t.tableColGroupNode:null,onCoords:this.handleSlatCoords}),b(Ng,{cells:t.cells,axis:t.axis,dateProfile:t.dateProfile,businessHourSegs:t.businessHourSegs,bgEventSegs:t.bgEventSegs,fgEventSegs:t.fgEventSegs,dateSelectionSegs:t.dateSelectionSegs,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange,nowDate:t.nowDate,nowIndicatorSegs:t.nowIndicatorSegs,clientWidth:t.clientWidth,tableMinWidth:t.tableMinWidth,tableColGroupNode:t.tableColGroupNode,slatCoords:e.slatCoords,onColCoords:this.handleColCoords,forPrint:t.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(t){this.scrollResponder.update(t.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(t,e){let{dateEnv:r,options:i}=this.context,{colCoords:n}=this,{dateProfile:a}=this.props,{slatCoords:o}=this.state,{snapDuration:l,snapsPerSlot:c}=this.processSlotOptions(this.props.slotDuration,i.snapDuration),d=n.leftToIndex(t),u=o.positions.topToIndex(e);if(d!=null&&u!=null){let h=this.props.cells[d],p=o.positions.tops[u],f=o.positions.getHeight(u),m=(e-p)/f,g=Math.floor(m*c),y=u*c+g,w=this.props.cells[d].date,T=Yl(a.slotMinTime,Dm(l,y)),S=r.add(w,T),x=r.add(S,l);return{dateProfile:a,dateSpan:Object.assign({range:{start:S,end:x},allDay:!1},h.extraDateSpan),dayEl:n.els[d],rect:{left:n.lefts[d],right:n.rights[d],top:p,bottom:p+f},layer:0}}return null}};function sF(s,t){let e=t||s,r=jl(s,e);return r===null&&(e=s,r=1),{snapDuration:e,snapsPerSlot:r}}var Og=class extends Jn{sliceRange(t,e){let r=[];for(let i=0;i<e.length;i+=1){let n=Rr(t,e[i]);n&&r.push({start:n.start,end:n.end,isStart:n.start.valueOf()===t.start.valueOf(),isEnd:n.end.valueOf()===t.end.valueOf(),col:i})}return r}},Fg=class extends Pt{constructor(){super(...arguments),this.buildDayRanges=ne(nF),this.slicer=new Og,this.timeColsRef=tt()}render(){let{props:t,context:e}=this,{dateProfile:r,dayTableModel:i}=t,{nowIndicator:n,nextDayThreshold:a}=e.options,o=this.buildDayRanges(i,r,e.dateEnv);return b(Zr,{unit:n?"minute":"day"},(l,c)=>b(Rg,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(t,r,null,e,o),{forPrint:t.forPrint,axis:t.axis,dateProfile:r,slatMetas:t.slatMetas,slotDuration:t.slotDuration,cells:i.cells[0],tableColGroupNode:t.tableColGroupNode,tableMinWidth:t.tableMinWidth,clientWidth:t.clientWidth,clientHeight:t.clientHeight,expandRows:t.expandRows,nowDate:l,nowIndicatorSegs:n&&this.slicer.sliceNowDate(l,r,a,e,o),todayRange:c,onScrollTopRequest:t.onScrollTopRequest,onSlatCoords:t.onSlatCoords})))}};function nF(s,t,e){let r=[];for(let i of s.headerDates)r.push({start:e.add(i,t.slotMinTime),end:e.add(i,t.slotMaxTime)});return r}var ox=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function aF(s,t,e,r,i){let n=new Date(0),a=s,o=pe(0),l=e||oF(r),c=[];for(;Nr(a)<Nr(t);){let d=i.add(n,a),u=jl(o,l)!==null;c.push({date:d,time:a,key:d.toISOString(),isoTimeStr:Mm(d),isLabeled:u}),a=Yl(a,r),o=Yl(o,r)}return c}function oF(s){let t,e,r;for(t=ox.length-1;t>=0;t-=1)if(e=pe(ox[t]),r=jl(e,s),r!==null&&r>1)return e;return s}var nh=class extends xg{constructor(){super(...arguments),this.buildTimeColsModel=ne(lF),this.buildSlatMetas=ne(aF)}render(){let{options:t,dateEnv:e,dateProfileGenerator:r}=this.context,{props:i}=this,{dateProfile:n}=i,a=this.buildTimeColsModel(n,r),o=this.allDaySplitter.splitProps(i),l=this.buildSlatMetas(n.slotMinTime,n.slotMaxTime,t.slotLabelInterval,t.slotDuration,e),{dayMinWidth:c}=t,d=!c,u=c,h=t.dayHeaders&&b(fs,{dates:a.headerDates,dateProfile:n,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),p=t.allDaySlot!==!1&&(m=>b(dc,Object.assign({},o.allDay,{dateProfile:n,dayTableModel:a,nextDayThreshold:t.nextDayThreshold,tableMinWidth:m.tableMinWidth,colGroupNode:m.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:m.clientWidth,clientHeight:m.clientHeight,forPrint:i.forPrint},this.getAllDayMaxEventProps()))),f=m=>b(Fg,Object.assign({},o.timed,{dayTableModel:a,dateProfile:n,axis:d,slotDuration:t.slotDuration,slatMetas:l,forPrint:i.forPrint,tableColGroupNode:m.tableColGroupNode,tableMinWidth:m.tableMinWidth,clientWidth:m.clientWidth,clientHeight:m.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:m.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return u?this.renderHScrollLayout(h,p,f,a.colCnt,c,l,this.state.slatCoords):this.renderSimpleLayout(h,p,f)}};function lF(s,t){let e=new Kn(s.renderRange,t);return new Zn(e,!1)}var cF='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';Js(cF);var dF={allDaySlot:Boolean},dx=Tr({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:dF,views:{timeGrid:{component:nh,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});var Hg=class extends Pt{constructor(){super(...arguments),this.buildDayTableModel=ne(kg),this.slicer=new cc,this.state={labelId:ms()}}render(){let{props:t,state:e,context:r}=this,{dateProfile:i,forPrint:n}=t,{options:a}=r,o=this.buildDayTableModel(i,r.dateProfileGenerator),l=this.slicer.sliceProps(t,i,a.nextDayThreshold,r,o),c=t.tableWidth!=null?t.tableWidth/a.aspectRatio:null,d=o.cells.length,u=c!=null?c/d:null;return b("div",{ref:t.elRef,"data-date":t.isoDateStr,className:"fc-multimonth-month",style:{width:t.width},role:"grid","aria-labelledby":e.labelId},b("div",{className:"fc-multimonth-header",style:{marginBottom:u},role:"presentation"},b("div",{className:"fc-multimonth-title",id:e.labelId},r.dateEnv.format(t.dateProfile.currentRange.start,t.titleFormat)),b("table",{className:["fc-multimonth-header-table",r.theme.getClass("table")].join(" "),role:"presentation"},b("thead",{role:"rowgroup"},b(fs,{dateProfile:t.dateProfile,dates:o.headerDates,datesRepDistinctDays:!1})))),b("div",{className:["fc-multimonth-daygrid","fc-daygrid","fc-daygrid-body",!n&&"fc-daygrid-body-balanced",n&&"fc-daygrid-body-unbalanced",n&&"fc-daygrid-body-natural"].join(" "),style:{marginTop:-u}},b("table",{className:["fc-multimonth-daygrid-table",r.theme.getClass("table")].join(" "),style:{height:n?"":c},role:"presentation"},b("tbody",{role:"rowgroup"},b(lc,Object.assign({},l,{dateProfile:i,cells:o.cells,eventSelection:t.eventSelection,dayMaxEvents:!n,dayMaxEventRows:!n,showWeekNumbers:a.weekNumbers,clientWidth:t.clientWidth,clientHeight:t.clientHeight,forPrint:n}))))))}},Bg=class extends Pt{constructor(){super(...arguments),this.splitDateProfileByMonth=ne(hF),this.buildMonthFormat=ne(mF),this.scrollElRef=tt(),this.firstMonthElRef=tt(),this.needsScrollReset=!1,this.handleSizing=t=>{t&&this.updateSize()}}render(){let{context:t,props:e,state:r}=this,{options:i}=t,{clientWidth:n,clientHeight:a}=r,o=r.monthHPadding||0,l=Math.min(n!=null?Math.floor(n/(i.multiMonthMinWidth+o)):1,i.multiMonthMaxColumns)||1,c=100/l+"%",d=n==null?null:n/l-o,u=n!=null&&l===1,h=this.splitDateProfileByMonth(t.dateProfileGenerator,e.dateProfile,t.dateEnv,u?!1:i.fixedWeekCount,i.showNonCurrentDates),p=this.buildMonthFormat(i.multiMonthTitleFormat,h),f=["fc-multimonth",u?"fc-multimonth-singlecol":"fc-multimonth-multicol",d!=null&&d<400?"fc-multimonth-compact":"",e.isHeightAuto?"":"fc-scroller"];return b(gi,{elRef:this.scrollElRef,elClasses:f,viewSpec:t.viewSpec},h.map((m,g)=>{let y=oo(m.currentRange.start);return b(Hg,Object.assign({},e,{key:y,isoDateStr:y,elRef:g===0?this.firstMonthElRef:void 0,titleFormat:p,dateProfile:m,width:c,tableWidth:d,clientWidth:n,clientHeight:a}))}))}componentDidMount(){this.updateSize(),this.context.addResizeHandler(this.handleSizing),this.requestScrollReset()}componentDidUpdate(t){Zt(t,this.props)||this.handleSizing(!1),t.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}updateSize(){let t=this.scrollElRef.current,e=this.firstMonthElRef.current;t&&this.setState({clientWidth:t.clientWidth,clientHeight:t.clientHeight}),e&&t&&this.state.monthHPadding==null&&this.setState({monthHPadding:t.clientWidth-e.firstChild.offsetWidth})}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.state.monthHPadding!=null){let{currentDate:t}=this.props.dateProfile,e=this.scrollElRef.current,r=e.querySelector(`[data-date="${oo(t)}"]`);e.scrollTop=r.getBoundingClientRect().top-this.firstMonthElRef.current.getBoundingClientRect().top,this.needsScrollReset=!1}}shouldComponentUpdate(){return!0}},uF=pe(1,"month");function hF(s,t,e,r,i){let{start:n,end:a}=t.currentRange,o=n,l=[];for(;o.valueOf()<a.valueOf();){let c=e.add(o,uF),d={start:s.skipHiddenDays(o),end:s.skipHiddenDays(c,-1,!0)},u=Sg({currentRange:d,snapToWeek:!0,fixedWeekCount:r,dateEnv:e});u={start:s.skipHiddenDays(u.start),end:s.skipHiddenDays(u.end,-1,!0)};let h=t.activeRange?Rr(t.activeRange,i?u:d):null;l.push({currentDate:t.currentDate,isValid:t.isValid,validRange:t.validRange,renderRange:u,activeRange:h,currentRange:d,currentRangeUnit:"month",isRangeAllDay:!0,dateIncrement:t.dateIncrement,slotMinTime:t.slotMaxTime,slotMaxTime:t.slotMinTime}),o=c}return l}var pF=Le({year:"numeric",month:"long"}),fF=Le({month:"long"});function mF(s,t){return s||(t[0].currentRange.start.getUTCFullYear()!==t[t.length-1].currentRange.start.getUTCFullYear()?pF:fF)}var gF={multiMonthTitleFormat:Le,multiMonthMaxColumns:Number,multiMonthMinWidth:Number},yF=".fc .fc-multimonth{border:1px solid var(--fc-border-color);display:flex;flex-wrap:wrap;overflow-x:hidden;overflow-y:auto}.fc .fc-multimonth-title{font-size:1.2em;font-weight:700;padding:1em 0;text-align:center}.fc .fc-multimonth-daygrid{background:var(--fc-page-bg-color)}.fc .fc-multimonth-daygrid-table,.fc .fc-multimonth-header-table{table-layout:fixed;width:100%}.fc .fc-multimonth-daygrid-table{border-top-style:hidden!important}.fc .fc-multimonth-singlecol .fc-multimonth{position:relative}.fc .fc-multimonth-singlecol .fc-multimonth-header{background:var(--fc-page-bg-color);position:relative;top:0;z-index:2}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid{position:relative;z-index:1}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid-table,.fc .fc-multimonth-singlecol .fc-multimonth-header-table{border-left-style:hidden;border-right-style:hidden}.fc .fc-multimonth-singlecol .fc-multimonth-month:last-child .fc-multimonth-daygrid-table{border-bottom-style:hidden}.fc .fc-multimonth-multicol{line-height:1}.fc .fc-multimonth-multicol .fc-multimonth-month{padding:0 1.2em 1.2em}.fc .fc-multimonth-multicol .fc-daygrid-more-link{border:1px solid var(--fc-event-border-color);display:block;float:none;padding:1px}.fc .fc-multimonth-compact{line-height:1}.fc .fc-multimonth-compact .fc-multimonth-daygrid-table,.fc .fc-multimonth-compact .fc-multimonth-header-table{font-size:.9em}.fc-media-screen .fc-multimonth-singlecol .fc-multimonth-header{position:sticky}.fc-media-print .fc-multimonth{overflow:visible}";Js(yF);var ux=Tr({name:"@fullcalendar/multimonth",initialView:"multiMonthYear",optionRefiners:gF,views:{multiMonth:{component:Bg,dateProfileGeneratorClass:yo,multiMonthMinWidth:350,multiMonthMaxColumns:3},multiMonthYear:{type:"multiMonth",duration:{years:1},fixedWeekCount:!0,showNonCurrentDates:!1}}});po.touchMouseIgnoreWait=500;var Ug=0,ah=0,$g=!1,oh=class{constructor(t){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=e=>{if(!this.shouldIgnoreMouse()&&vF(e)&&this.tryStart(e)){let r=this.createEventFromMouse(e,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=e=>{let r=this.createEventFromMouse(e);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleMouseUp=e=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(e)),this.cleanup()},this.handleTouchStart=e=>{if(this.tryStart(e)){this.isTouchDragging=!0;let r=this.createEventFromTouch(e,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r);let i=e.target;this.shouldIgnoreMove||i.addEventListener("touchmove",this.handleTouchMove),i.addEventListener("touchend",this.handleTouchEnd),i.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=e=>{let r=this.createEventFromTouch(e);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleTouchEnd=e=>{if(this.isDragging){let r=e.target;r.removeEventListener("touchmove",this.handleTouchMove),r.removeEventListener("touchend",this.handleTouchEnd),r.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(e)),this.cleanup(),this.isTouchDragging=!1,wF()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=e=>{if(!this.shouldIgnoreMove){let r=window.scrollX-this.prevScrollX+this.prevPageX,i=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:e,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:r,pageY:i,deltaX:r-this.origPageX,deltaY:i-this.origPageY})}},this.containerEl=t,this.emitter=new ps,t.addEventListener("mousedown",this.handleMouseDown),t.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),TF()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),bF()}tryStart(t){let e=this.querySubjectEl(t),r=t.target;return e&&(!this.handleSelector||Et(r,this.handleSelector))?(this.subjectEl=e,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){$g=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(t){return this.selector?Et(t.target,this.selector):this.containerEl}shouldIgnoreMouse(){return Ug||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&($g=!0)}initScrollWatch(t){this.shouldWatchScroll&&(this.recordCoords(t),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(t){this.shouldWatchScroll&&(this.prevPageX=t.pageX,this.prevPageY=t.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(t,e){let r=0,i=0;return e?(this.origPageX=t.pageX,this.origPageY=t.pageY):(r=t.pageX-this.origPageX,i=t.pageY-this.origPageY),{origEvent:t,isTouch:!1,subjectEl:this.subjectEl,pageX:t.pageX,pageY:t.pageY,deltaX:r,deltaY:i}}createEventFromTouch(t,e){let r=t.touches,i,n,a=0,o=0;return r&&r.length?(i=r[0].pageX,n=r[0].pageY):(i=t.pageX,n=t.pageY),e?(this.origPageX=i,this.origPageY=n):(a=i-this.origPageX,o=n-this.origPageY),{origEvent:t,isTouch:!0,subjectEl:this.subjectEl,pageX:i,pageY:n,deltaX:a,deltaY:o}}};function vF(s){return s.button===0&&!s.ctrlKey}function wF(){Ug+=1,setTimeout(()=>{Ug-=1},po.touchMouseIgnoreWait)}function TF(){ah+=1,ah===1&&window.addEventListener("touchmove",px,{passive:!1})}function bF(){ah-=1,ah||window.removeEventListener("touchmove",px,{passive:!1})}function px(s){$g&&s.preventDefault()}var Vg=class{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(t,e,r){this.sourceEl=t,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=e-window.scrollX,this.origScreenY=r-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(t,e){this.deltaX=t-window.scrollX-this.origScreenX,this.deltaY=e-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(t){t?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=t,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=t)}stop(t,e){let r=()=>{this.cleanup(),e()};t&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(r,this.revertDuration):setTimeout(r,0)}doRevertAnimation(t,e){let r=this.mirrorEl,i=this.sourceEl.getBoundingClientRect();r.style.transition="top "+e+"ms,left "+e+"ms",ra(r,{left:i.left,top:i.top}),wm(r,()=>{r.style.transition="",t()})}cleanup(){this.mirrorEl&&(Vl(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&ra(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let t=this.sourceElRect,e=this.mirrorEl;return e||(e=this.mirrorEl=this.sourceEl.cloneNode(!0),e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.pointerEvents="none",e.classList.add("fc-event-dragging"),ra(e,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:t.right-t.left,height:t.bottom-t.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(e)),e}},lh=class extends Gn{constructor(t,e){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=t,this.doesListening=e,this.scrollTop=this.origScrollTop=t.getScrollTop(),this.scrollLeft=this.origScrollLeft=t.getScrollLeft(),this.scrollWidth=t.getScrollWidth(),this.scrollHeight=t.getScrollHeight(),this.clientWidth=t.getClientWidth(),this.clientHeight=t.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(t){this.scrollController.setScrollTop(t),this.doesListening||(this.scrollTop=Math.max(Math.min(t,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(t){this.scrollController.setScrollLeft(t),this.doesListening||(this.scrollLeft=Math.max(Math.min(t,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}},ch=class extends lh{constructor(t,e){super(new Ll(t),e)}getEventTarget(){return this.scrollController.el}computeClientRect(){return rg(this.scrollController.el)}},Wg=class extends lh{constructor(t){super(new Hl,t)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}},hx=typeof performance=="function"?performance.now:Date.now,Yg=class{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let t=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(t){let e=hx();this.handleSide(t,(e-this.msSinceRequest)/1e3),this.requestAnimation(e)}else this.isAnimating=!1}}}start(t,e,r){this.isEnabled&&(this.scrollCaches=this.buildCaches(r),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(t,e))}handleMove(t,e){if(this.isEnabled){let r=t-window.scrollX,i=e-window.scrollY,n=this.pointerScreenY===null?0:i-this.pointerScreenY,a=this.pointerScreenX===null?0:r-this.pointerScreenX;n<0?this.everMovedUp=!0:n>0&&(this.everMovedDown=!0),a<0?this.everMovedLeft=!0:a>0&&(this.everMovedRight=!0),this.pointerScreenX=r,this.pointerScreenY=i,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(hx()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let t of this.scrollCaches)t.destroy();this.scrollCaches=null}}requestAnimation(t){this.msSinceRequest=t,requestAnimationFrame(this.animate)}handleSide(t,e){let{scrollCache:r}=t,{edgeThreshold:i}=this,n=i-t.distance,a=n*n/(i*i)*this.maxVelocity*e,o=1;switch(t.name){case"left":o=-1;case"right":r.setScrollLeft(r.getScrollLeft()+a*o);break;case"top":o=-1;case"bottom":r.setScrollTop(r.getScrollTop()+a*o);break}}computeBestEdge(t,e){let{edgeThreshold:r}=this,i=null,n=this.scrollCaches||[];for(let a of n){let o=a.clientRect,l=t-o.left,c=o.right-t,d=e-o.top,u=o.bottom-e;l>=0&&c>=0&&d>=0&&u>=0&&(d<=r&&this.everMovedUp&&a.canScrollUp()&&(!i||i.distance>d)&&(i={scrollCache:a,name:"top",distance:d}),u<=r&&this.everMovedDown&&a.canScrollDown()&&(!i||i.distance>u)&&(i={scrollCache:a,name:"bottom",distance:u}),l<=r&&this.everMovedLeft&&a.canScrollLeft()&&(!i||i.distance>l)&&(i={scrollCache:a,name:"left",distance:l}),c<=r&&this.everMovedRight&&a.canScrollRight()&&(!i||i.distance>c)&&(i={scrollCache:a,name:"right",distance:c}))}return i}buildCaches(t){return this.queryScrollEls(t).map(e=>e===window?new Wg(!1):new ch(e,!1))}queryScrollEls(t){let e=[];for(let r of this.scrollQuery)typeof r=="object"?e.push(r):e.push(...Array.prototype.slice.call(t.getRootNode().querySelectorAll(r)));return e}},en=class extends $l{constructor(t,e){super(t),this.containerEl=t,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=i=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,Tm(document.body),km(document.body),i.isTouch||i.origEvent.preventDefault(),this.emitter.trigger("pointerdown",i),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(i.subjectEl,i.pageX,i.pageY),this.startDelay(i),this.minDistance||this.handleDistanceSurpassed(i)))},this.onPointerMove=i=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",i),!this.isDistanceSurpassed){let n=this.minDistance,a,{deltaX:o,deltaY:l}=i;a=o*o+l*l,a>=n*n&&this.handleDistanceSurpassed(i)}this.isDragging&&(i.origEvent.type!=="scroll"&&(this.mirror.handleMove(i.pageX,i.pageY),this.autoScroller.handleMove(i.pageX,i.pageY)),this.emitter.trigger("dragmove",i))}},this.onPointerUp=i=>{this.isInteracting&&(this.isInteracting=!1,bm(document.body),Sm(document.body),this.emitter.trigger("pointerup",i),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(i)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let r=this.pointer=new oh(t);r.emitter.on("pointerdown",this.onPointerDown),r.emitter.on("pointermove",this.onPointerMove),r.emitter.on("pointerup",this.onPointerUp),e&&(r.selector=e),this.mirror=new Vg,this.autoScroller=new Yg}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(t){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(t)},this.delay):this.handleDelayEnd(t)}handleDelayEnd(t){this.isDelayEnded=!0,this.tryStartDrag(t)}handleDistanceSurpassed(t){this.isDistanceSurpassed=!0,this.tryStartDrag(t)}tryStartDrag(t){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(t.pageX,t.pageY,this.containerEl),this.emitter.trigger("dragstart",t),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(t){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,t))}stopDrag(t){this.isDragging=!1,this.emitter.trigger("dragend",t)}setIgnoreMove(t){this.pointer.shouldIgnoreMove=t}setMirrorIsVisible(t){this.mirror.setIsVisible(t)}setMirrorNeedsRevert(t){this.mirrorNeedsRevert=t}setAutoScrollEnabled(t){this.autoScroller.isEnabled=t}},jg=class{constructor(t){this.el=t,this.origRect=ec(t),this.scrollCaches=qu(t).map(e=>new ch(e,!0))}destroy(){for(let t of this.scrollCaches)t.destroy()}computeLeft(){let t=this.origRect.left;for(let e of this.scrollCaches)t+=e.origScrollLeft-e.getScrollLeft();return t}computeTop(){let t=this.origRect.top;for(let e of this.scrollCaches)t+=e.origScrollTop-e.getScrollTop();return t}isWithinClipping(t,e){let r={left:t,top:e};for(let i of this.scrollCaches)if(!kF(i.getEventTarget())&&!Zm(r,i.clientRect))return!1;return!0}};function kF(s){let t=s.tagName;return t==="HTML"||t==="BODY"}var aa=class{constructor(t,e){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=r=>{let{dragging:i}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(r),this.initialHit||!this.requireInitial?(i.setIgnoreMove(!1),this.emitter.trigger("pointerdown",r)):i.setIgnoreMove(!0)},this.handleDragStart=r=>{this.emitter.trigger("dragstart",r),this.handleMove(r,!0)},this.handleDragMove=r=>{this.emitter.trigger("dragmove",r),this.handleMove(r)},this.handlePointerUp=r=>{this.releaseHits(),this.emitter.trigger("pointerup",r)},this.handleDragEnd=r=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,r),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",r)},this.droppableStore=e,t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragstart",this.handleDragStart),t.emitter.on("dragmove",this.handleDragMove),t.emitter.on("pointerup",this.handlePointerUp),t.emitter.on("dragend",this.handleDragEnd),this.dragging=t,this.emitter=new ps}processFirstCoord(t){let e={left:t.pageX,top:t.pageY},r=e,i=t.subjectEl,n;i instanceof HTMLElement&&(n=ec(i),r=Jm(r,n));let a=this.initialHit=this.queryHitForOffset(r.left,r.top);if(a){if(this.useSubjectCenter&&n){let o=ju(n,a.rect);o&&(r=Xm(o))}this.coordAdjust=eg(r,e)}else this.coordAdjust={left:0,top:0}}handleMove(t,e){let r=this.queryHitForOffset(t.pageX+this.coordAdjust.left,t.pageY+this.coordAdjust.top);(e||!uh(this.movingHit,r))&&(this.movingHit=r,this.emitter.trigger("hitupdate",r,!1,t))}prepareHits(){this.offsetTrackers=Kr(this.droppableStore,t=>(t.component.prepareHits(),new jg(t.el)))}releaseHits(){let{offsetTrackers:t}=this;for(let e in t)t[e].destroy();this.offsetTrackers={}}queryHitForOffset(t,e){let{droppableStore:r,offsetTrackers:i}=this,n=null;for(let a in r){let o=r[a].component,l=i[a];if(l&&l.isWithinClipping(t,e)){let c=l.computeLeft(),d=l.computeTop(),u=t-c,h=e-d,{origRect:p}=l,f=p.right-p.left,m=p.bottom-p.top;if(u>=0&&u<f&&h>=0&&h<m){let g=o.queryHit(u,h,f,m);g&&co(g.dateProfile.activeRange,g.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(u+c-window.scrollX,h+d-window.scrollY)))&&(!n||g.layer>n.layer)&&(g.componentId=a,g.context=o.context,g.rect.left+=c,g.rect.right+=c,g.rect.top+=d,g.rect.bottom+=d,n=g)}}}return n}};function uh(s,t){return!s&&!t?!0:!!s!=!!t?!1:zm(s.dateSpan,t.dateSpan)}function Zg(s,t){let e={};for(let r of t.pluginHooks.datePointTransforms)Object.assign(e,r(s,t));return Object.assign(e,SF(s,t.dateEnv)),e}function SF(s,t){return{date:t.toDate(s.range.start),dateStr:t.formatIso(s.range.start,{omitTime:s.allDay}),allDay:s.allDay}}var zg=class extends yi{constructor(t){super(t),this.handlePointerDown=r=>{let{dragging:i}=this,n=r.origEvent.target;i.setIgnoreMove(!this.component.isValidDateDownEl(n))},this.handleDragEnd=r=>{let{component:i}=this,{pointer:n}=this.dragging;if(!n.wasTouchScroll){let{initialHit:a,finalHit:o}=this.hitDragging;if(a&&o&&uh(a,o)){let{context:l}=i,c=Object.assign(Object.assign({},Zg(a.dateSpan,l)),{dayEl:a.dayEl,jsEvent:r.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",c)}}},this.dragging=new en(t.el),this.dragging.autoScroller.isEnabled=!1;let e=this.hitDragging=new aa(this.dragging,Xl(t));e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},qg=class extends yi{constructor(t){super(t),this.dragSelection=null,this.handlePointerDown=a=>{let{component:o,dragging:l}=this,{options:c}=o.context,d=c.selectable&&o.isValidDateDownEl(a.origEvent.target);l.setIgnoreMove(!d),l.delay=a.isTouch?EF(o):null},this.handleDragStart=a=>{this.component.context.calendarApi.unselect(a)},this.handleHitUpdate=(a,o)=>{let{context:l}=this.component,c=null,d=!1;if(a){let u=this.hitDragging.initialHit;a.componentId===u.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(u,a)||(c=DF(u,a,l.pluginHooks.dateSelectionTransformers)),(!c||!sg(c,a.dateProfile,l))&&(d=!0,c=null)}c?l.dispatch({type:"SELECT_DATES",selection:c}):o||l.dispatch({type:"UNSELECT_DATES"}),d?so():no(),o||(this.dragSelection=c)},this.handlePointerUp=a=>{this.dragSelection&&(Vu(this.dragSelection,a,this.component.context),this.dragSelection=null)};let{component:e}=t,{options:r}=e.context,i=this.dragging=new en(t.el);i.touchScrollAllowed=!1,i.minDistance=r.selectMinDistance||0,i.autoScroller.isEnabled=r.dragScroll;let n=this.hitDragging=new aa(this.dragging,Xl(t));n.emitter.on("pointerdown",this.handlePointerDown),n.emitter.on("dragstart",this.handleDragStart),n.emitter.on("hitupdate",this.handleHitUpdate),n.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}};function EF(s){let{options:t}=s.context,e=t.selectLongPressDelay;return e==null&&(e=t.longPressDelay),e}function DF(s,t,e){let r=s.dateSpan,i=t.dateSpan,n=[r.range.start,r.range.end,i.range.start,i.range.end];n.sort(Em);let a={};for(let o of e){let l=o(s,t);if(l===!1)return null;l&&Object.assign(a,l)}return a.range={start:n[0],end:n[3]},a.allDay=r.allDay,a}var hc=class s extends yi{constructor(t){super(t),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=a=>{let o=a.origEvent.target,{component:l,dragging:c}=this,{mirror:d}=c,{options:u}=l.context,h=l.context;this.subjectEl=a.subjectEl;let p=this.subjectSeg=vs(a.subjectEl),m=(this.eventRange=p.eventRange).instance.instanceId;this.relevantEvents=Ql(h.getCurrentData().eventStore,m),c.minDistance=a.isTouch?0:u.eventDragMinDistance,c.delay=a.isTouch&&m!==l.props.eventSelection?xF(l):null,u.fixedMirrorParent?d.parentNode=u.fixedMirrorParent:d.parentNode=Et(o,".fc"),d.revertDuration=u.dragRevertDuration;let g=l.isValidSegDownEl(o)&&!Et(o,".fc-event-resizer");c.setIgnoreMove(!g),this.isDragging=g&&a.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=a=>{let o=this.component.context,l=this.eventRange,c=l.instance.instanceId;a.isTouch?c!==this.component.props.eventSelection&&o.dispatch({type:"SELECT_EVENT",eventInstanceId:c}):o.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(o.calendarApi.unselect(a),o.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new ze(o,l.def,l.instance),jsEvent:a.origEvent,view:o.viewApi}))},this.handleHitUpdate=(a,o)=>{if(!this.isDragging)return;let l=this.relevantEvents,c=this.hitDragging.initialHit,d=this.component.context,u=null,h=null,p=null,f=!1,m={affectedEvents:l,mutatedEvents:Dt(),isEvent:!0};if(a){u=a.context;let g=u.options;d===u||g.editable&&g.droppable?(h=CF(c,a,this.eventRange.instance.range.start,u.getCurrentData().pluginHooks.eventDragMutationMassagers),h&&(p=Kl(l,u.getCurrentData().eventUiBases,h,u),m.mutatedEvents=p,ic(m,a.dateProfile,u)||(f=!0,h=null,p=null,m.mutatedEvents=Dt()))):u=null}this.displayDrag(u,m),f?so():no(),o||(d===u&&uh(c,a)&&(h=null),this.dragging.setMirrorNeedsRevert(!h),this.dragging.setMirrorIsVisible(!a||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=u,this.validMutation=h,this.mutatedRelevantEvents=p)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=a=>{if(this.isDragging){let o=this.component.context,l=o.viewApi,{receivingContext:c,validMutation:d}=this,u=this.eventRange.def,h=this.eventRange.instance,p=new ze(o,u,h),f=this.relevantEvents,m=this.mutatedRelevantEvents,{finalHit:g}=this.hitDragging;if(this.clearDrag(),o.emitter.trigger("eventDragStop",{el:this.subjectEl,event:p,jsEvent:a.origEvent,view:l}),d){if(c===o){let y=new ze(o,m.defs[u.defId],h?m.instances[h.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:m});let w={oldEvent:p,event:y,relatedEvents:Bi(m,o,h),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:f})}},T={};for(let S of o.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(T,S(d,o));o.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},w),T),{el:a.subjectEl,delta:d.datesDelta,jsEvent:a.origEvent,view:l})),o.emitter.trigger("eventChange",w)}else if(c){let y={event:p,relatedEvents:Bi(f,o,h),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:f})}};o.emitter.trigger("eventLeave",Object.assign(Object.assign({},y),{draggedEl:a.subjectEl,view:l})),o.dispatch({type:"REMOVE_EVENTS",eventStore:f}),o.emitter.trigger("eventRemove",y);let w=m.defs[u.defId],T=m.instances[h.instanceId],S=new ze(c,w,T);c.dispatch({type:"MERGE_EVENTS",eventStore:m});let x={event:S,relatedEvents:Bi(m,c,T),revert(){c.dispatch({type:"REMOVE_EVENTS",eventStore:m})}};c.emitter.trigger("eventAdd",x),a.isTouch&&c.dispatch({type:"SELECT_EVENT",eventInstanceId:h.instanceId}),c.emitter.trigger("drop",Object.assign(Object.assign({},Zg(g.dateSpan,c)),{draggedEl:a.subjectEl,jsEvent:a.origEvent,view:g.context.viewApi})),c.emitter.trigger("eventReceive",Object.assign(Object.assign({},x),{draggedEl:a.subjectEl,view:g.context.viewApi}))}}else o.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:e}=this,{options:r}=e.context,i=this.dragging=new en(t.el);i.pointer.selector=s.SELECTOR,i.touchScrollAllowed=!1,i.autoScroller.isEnabled=r.dragScroll;let n=this.hitDragging=new aa(this.dragging,ia);n.useSubjectCenter=t.useEventCenter,n.emitter.on("pointerdown",this.handlePointerDown),n.emitter.on("dragstart",this.handleDragStart),n.emitter.on("hitupdate",this.handleHitUpdate),n.emitter.on("pointerup",this.handlePointerUp),n.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(t,e){let r=this.component.context,i=this.receivingContext;i&&i!==t&&(i===r?i.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:e.affectedEvents,mutatedEvents:Dt(),isEvent:!0}}):i.dispatch({type:"UNSET_EVENT_DRAG"})),t&&t.dispatch({type:"SET_EVENT_DRAG",state:e})}clearDrag(){let t=this.component.context,{receivingContext:e}=this;e&&e.dispatch({type:"UNSET_EVENT_DRAG"}),t!==e&&t.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}};hc.SELECTOR=".fc-event-draggable, .fc-event-resizable";function CF(s,t,e,r){let i=s.dateSpan,n=t.dateSpan,a=i.range.start,o=n.range.start,l={};i.allDay!==n.allDay&&(l.allDay=n.allDay,l.hasEnd=t.context.options.allDayMaintainDuration,n.allDay?a=Ve(e):a=e);let c=Gs(a,o,s.context.dateEnv,s.componentId===t.componentId?s.largeUnit:null);c.milliseconds&&(l.allDay=!1);let d={datesDelta:c,standardProps:l};for(let u of r)u(d,s,t);return d}function xF(s){let{options:t}=s.context,e=t.eventLongPressDelay;return e==null&&(e=t.longPressDelay),e}var Gg=class extends yi{constructor(t){super(t),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=n=>{let{component:a}=this,o=this.querySegEl(n),l=vs(o),c=this.eventRange=l.eventRange;this.dragging.minDistance=a.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(n.origEvent.target)||n.isTouch&&this.component.props.eventSelection!==c.instance.instanceId)},this.handleDragStart=n=>{let{context:a}=this.component,o=this.eventRange;this.relevantEvents=Ql(a.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(n);this.draggingSegEl=l,this.draggingSeg=vs(l),a.calendarApi.unselect(),a.emitter.trigger("eventResizeStart",{el:l,event:new ze(a,o.def,o.instance),jsEvent:n.origEvent,view:a.viewApi})},this.handleHitUpdate=(n,a,o)=>{let{context:l}=this.component,c=this.relevantEvents,d=this.hitDragging.initialHit,u=this.eventRange.instance,h=null,p=null,f=!1,m={affectedEvents:c,mutatedEvents:Dt(),isEvent:!0};n&&(n.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,n)||(h=MF(d,n,o.subjectEl.classList.contains("fc-event-resizer-start"),u.range))),h&&(p=Kl(c,l.getCurrentData().eventUiBases,h,l),m.mutatedEvents=p,ic(m,n.dateProfile,l)||(f=!0,h=null,p=null,m.mutatedEvents=null)),p?l.dispatch({type:"SET_EVENT_RESIZE",state:m}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),f?so():no(),a||(h&&uh(d,n)&&(h=null),this.validMutation=h,this.mutatedRelevantEvents=p)},this.handleDragEnd=n=>{let{context:a}=this.component,o=this.eventRange.def,l=this.eventRange.instance,c=new ze(a,o,l),d=this.relevantEvents,u=this.mutatedRelevantEvents;if(a.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:c,jsEvent:n.origEvent,view:a.viewApi}),this.validMutation){let h=new ze(a,u.defs[o.defId],l?u.instances[l.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:u});let p={oldEvent:c,event:h,relatedEvents:Bi(u,a,l),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:d})}};a.emitter.trigger("eventResize",Object.assign(Object.assign({},p),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||pe(0),endDelta:this.validMutation.endDelta||pe(0),jsEvent:n.origEvent,view:a.viewApi})),a.emitter.trigger("eventChange",p)}else a.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:e}=t,r=this.dragging=new en(t.el);r.pointer.selector=".fc-event-resizer",r.touchScrollAllowed=!1,r.autoScroller.isEnabled=e.context.options.dragScroll;let i=this.hitDragging=new aa(this.dragging,Xl(t));i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(t){return Et(t.subjectEl,".fc-event")}};function MF(s,t,e,r){let i=s.context.dateEnv,n=s.dateSpan.range.start,a=t.dateSpan.range.start,o=Gs(n,a,i,s.largeUnit);if(e){if(i.add(r.start,o)<r.end)return{startDelta:o}}else if(i.add(r.end,o)>r.start)return{endDelta:o};return null}var Qg=class{constructor(t){this.context=t,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=r=>{r.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=r=>{let i=this.context.options.unselectCancel,n=Nu(r.origEvent);this.matchesCancel=!!Et(n,i),this.matchesEvent=!!Et(n,hc.SELECTOR)},this.onDocumentPointerUp=r=>{let{context:i}=this,{documentPointer:n}=this,a=i.getCurrentData();if(!n.wasTouchScroll){if(a.dateSelection&&!this.isRecentPointerDateSelect){let o=i.options.unselectAuto;o&&(!o||!this.matchesCancel)&&i.calendarApi.unselect(r)}a.eventSelection&&!this.matchesEvent&&i.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let e=this.documentPointer=new oh(document);e.shouldIgnoreMove=!0,e.shouldWatchScroll=!1,e.emitter.on("pointerdown",this.onDocumentPointerDown),e.emitter.on("pointerup",this.onDocumentPointerUp),t.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}},_F={fixedMirrorParent:N},AF={dateClick:N,eventDragStart:N,eventDragStop:N,eventDrop:N,eventResizeStart:N,eventResizeStop:N,eventResize:N,drop:N,eventReceive:N,eventLeave:N},Kg=class{constructor(t,e){this.receivingContext=null,this.droppableEvent=null,this.suppliedDragMeta=null,this.dragMeta=null,this.handleDragStart=i=>{this.dragMeta=this.buildDragMeta(i.subjectEl)},this.handleHitUpdate=(i,n,a)=>{let{dragging:o}=this.hitDragging,l=null,c=null,d=!1,u={affectedEvents:Dt(),mutatedEvents:Dt(),isEvent:this.dragMeta.create};i&&(l=i.context,this.canDropElOnCalendar(a.subjectEl,l)&&(c=IF(i.dateSpan,this.dragMeta,l),u.mutatedEvents=qn(c),d=!ic(u,i.dateProfile,l),d&&(u.mutatedEvents=Dt(),c=null))),this.displayDrag(l,u),o.setMirrorIsVisible(n||!c||!document.querySelector(".fc-event-mirror")),d?so():no(),n||(o.setMirrorNeedsRevert(!c),this.receivingContext=l,this.droppableEvent=c)},this.handleDragEnd=i=>{let{receivingContext:n,droppableEvent:a}=this;if(this.clearDrag(),n&&a){let o=this.hitDragging.finalHit,l=o.context.viewApi,c=this.dragMeta;if(n.emitter.trigger("drop",Object.assign(Object.assign({},Zg(o.dateSpan,n)),{draggedEl:i.subjectEl,jsEvent:i.origEvent,view:l})),c.create){let d=qn(a);n.dispatch({type:"MERGE_EVENTS",eventStore:d}),i.isTouch&&n.dispatch({type:"SELECT_EVENT",eventInstanceId:a.instance.instanceId}),n.emitter.trigger("eventReceive",{event:new ze(n,a.def,a.instance),relatedEvents:[],revert(){n.dispatch({type:"REMOVE_EVENTS",eventStore:d})},draggedEl:i.subjectEl,view:l})}}this.receivingContext=null,this.droppableEvent=null};let r=this.hitDragging=new aa(t,ia);r.requireInitial=!1,r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("dragend",this.handleDragEnd),this.suppliedDragMeta=e}buildDragMeta(t){return typeof this.suppliedDragMeta=="object"?rc(this.suppliedDragMeta):typeof this.suppliedDragMeta=="function"?rc(this.suppliedDragMeta(t)):PF(t)}displayDrag(t,e){let r=this.receivingContext;r&&r!==t&&r.dispatch({type:"UNSET_EVENT_DRAG"}),t&&t.dispatch({type:"SET_EVENT_DRAG",state:e})}clearDrag(){this.receivingContext&&this.receivingContext.dispatch({type:"UNSET_EVENT_DRAG"})}canDropElOnCalendar(t,e){let r=e.options.dropAccept;return typeof r=="function"?r.call(e.calendarApi,t):typeof r=="string"&&r?!!Pu(t,r):!0}};function IF(s,t,e){let r=Object.assign({},t.leftoverProps);for(let d of e.pluginHooks.externalDefTransforms)Object.assign(r,d(s,t));let{refined:i,extra:n}=Gl(r,e),a=io(i,n,t.sourceId,s.allDay,e.options.forceEventDuration||!!t.duration,e),o=s.range.start;s.allDay&&t.startTime&&(o=e.dateEnv.add(o,t.startTime));let l=t.duration?e.dateEnv.add(o,t.duration):Nl(s.allDay,o,e),c=uo(a.defId,{start:o,end:l});return{def:a,instance:c}}function PF(s){let t=NF(s,"event"),e=t?JSON.parse(t):{create:!1};return rc(e)}po.dataAttrPrefix="";function NF(s,t){let e=po.dataAttrPrefix,r=(e?e+"-":"")+t;return s.getAttribute("data-"+r)||""}var dh=class{constructor(t,e={}){this.handlePointerDown=i=>{let{dragging:n}=this,{minDistance:a,longPressDelay:o}=this.settings;n.minDistance=a!=null?a:i.isTouch?0:Hi.eventDragMinDistance,n.delay=i.isTouch?o!=null?o:Hi.longPressDelay:0},this.handleDragStart=i=>{i.isTouch&&this.dragging.delay&&i.subjectEl.classList.contains("fc-event")&&this.dragging.mirror.getMirrorEl().classList.add("fc-event-selected")},this.settings=e;let r=this.dragging=new en(t);r.touchScrollAllowed=!1,e.itemSelector!=null&&(r.pointer.selector=e.itemSelector),e.appendTo!=null&&(r.mirror.parentNode=e.appendTo),r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),new Kg(r,e.eventData)}destroy(){this.dragging.destroy()}};var fx=Tr({name:"@fullcalendar/interaction",componentInteractions:[zg,qg,hc,Gg],calendarInteractions:[Qg],elementDraggingImpl:en,optionRefiners:_F,listenerRefiners:AF});var bi=require("obsidian");var _e=require("obsidian");Za();hh();var gx=require("obsidian"),ph=class{constructor(t){this.menu=new gx.Menu,this.options=t,this.buildMenu()}buildMenu(){this.getStatusOptions().forEach((e,r)=>{this.menu.addItem(i=>{let n=e.label;i.setIcon("circle"),e.value===this.options.currentValue&&(n=`\u2713 ${e.label}`),i.setTitle(n),i.onClick(async()=>{this.options.onSelect(e.value)})})})}getStatusOptions(){let t=this.options.plugin.settings.customStatuses,e=[];return t&&t.length>0&&[...t].sort((i,n)=>i.order-n.order).forEach(i=>{e.push({label:i.label,value:i.value,color:i.color})}),e}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}show(t){this.menu.showAtMouseEvent(t),setTimeout(()=>{this.applyColorStyling()},10)}showAtElement(t){this.menu.showAtPosition({x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom+4}),setTimeout(()=>{this.applyColorStyling()},10)}applyColorStyling(){let t=this.getStatusOptions(),e=document.querySelector(".menu");if(!e)return;let r=e.querySelectorAll(".menu-item");t.forEach((i,n)=>{let a=r[n];if(a&&i.color){let o=a.querySelector(".menu-item-icon");o&&(o.style.color=i.color)}})}};El();var Jg=require("obsidian");iu();var vo=class{constructor(t,e,r,i){this.plugin=t,this.task=e,this.triggerElement=r,this.onUpdate=i}show(t){let e=new Jg.Menu;this.addQuickRemindersSection(e,"due","Remind before due..."),this.addQuickRemindersSection(e,"scheduled","Remind before scheduled..."),e.addSeparator(),e.addItem(r=>{r.setTitle("Manage All Reminders...").setIcon("settings").onClick(()=>{this.openReminderModal()})}),this.task.reminders&&this.task.reminders.length>0&&e.addItem(r=>{r.setTitle("Clear All Reminders").setIcon("trash").onClick(async()=>{await this.clearAllReminders()})}),t?e.showAtMouseEvent(t):e.showAtMouseEvent(new MouseEvent("contextmenu"))}addQuickRemindersSection(t,e,r){if(!(e==="due"?this.task.due:this.task.scheduled)){t.addItem(n=>{n.setTitle(r).setIcon("bell").setDisabled(!0)});return}t.addItem(n=>{n.setTitle(r).setIcon("bell").onClick(a=>{this.showQuickReminderSubmenu(e,a instanceof MouseEvent?a:void 0)})})}showQuickReminderSubmenu(t,e){let r=new Jg.Menu;[{label:"At time of event",offset:"PT0M"},{label:"5 minutes before",offset:"-PT5M"},{label:"15 minutes before",offset:"-PT15M"},{label:"1 hour before",offset:"-PT1H"},{label:"1 day before",offset:"-P1D"}].forEach(n=>{r.addItem(a=>{a.setTitle(n.label).onClick(async()=>{await this.addQuickReminder(t,n.offset,n.label)})})}),e?r.showAtMouseEvent(e):r.showAtMouseEvent(new MouseEvent("contextmenu"))}async addQuickReminder(t,e,r){let i={id:`rem_${Date.now()}`,type:"relative",relatedTo:t,offset:e,description:r},n=[...this.task.reminders||[],i];await this.saveReminders(n)}async clearAllReminders(){await this.saveReminders([])}async saveReminders(t){let e;if(this.task.path&&this.task.path.trim()!==""){let r=await this.plugin.cacheManager.getTaskInfo(this.task.path);r?(e={...r,reminders:t},await this.plugin.taskService.updateProperty(e,"reminders",t)):e={...this.task,reminders:t}}else e={...this.task,reminders:t};this.onUpdate(e)}openReminderModal(){new cs(this.plugin.app,this.plugin,this.task,async e=>{await this.saveReminders(e)}).open()}};Se();ht();var wo=class extends _e.Modal{constructor(e,r){super(e);this.title="";this.details="";this.dueDate="";this.scheduledDate="";this.priority="normal";this.status="open";this.contexts="";this.projects="";this.tags="";this.timeEstimate=0;this.recurrenceRule="";this.reminders=[];this.userFields={};this.selectedProjectFiles=[];this.isExpanded=!1;this.plugin=r}onOpen(){this.containerEl.addClass("tasknotes-plugin","minimalist-task-modal"),this.titleEl.setText(this.getModalTitle());let e=this.titleEl.createSpan("modal-header-icon");(0,_e.setIcon)(e,"tasknotes-simple"),this.titleEl.insertBefore(e,this.titleEl.firstChild),this.initializeFormData().then(()=>{this.createModalContent(),this.focusTitleInput()})}createModalContent(){let{contentEl:e}=this;e.empty();let r=e.createDiv("minimalist-modal-container");this.createTitleInput(r),this.createActionBar(r),this.createDetailsSection(r),this.createActionButtons(r)}createTitleInput(e){let r=e.createDiv("title-input-container");this.titleInput=r.createEl("input",{type:"text",cls:"title-input",placeholder:"What needs to be done?"}),this.titleInput.value=this.title,this.titleInput.addEventListener("input",i=>{this.title=i.target.value})}createActionBar(e){this.actionBar=e.createDiv("action-bar"),this.createActionIcon(this.actionBar,"calendar","Set due date",(r,i)=>{this.showDateContextMenu(i,"due")},"due-date"),this.createActionIcon(this.actionBar,"calendar-clock","Set scheduled date",(r,i)=>{this.showDateContextMenu(i,"scheduled")},"scheduled-date"),this.createActionIcon(this.actionBar,"dot-square","Set status",(r,i)=>{this.showStatusContextMenu(i)},"status"),this.createActionIcon(this.actionBar,"star","Set priority",(r,i)=>{this.showPriorityContextMenu(i)},"priority"),this.createActionIcon(this.actionBar,"refresh-ccw","Set recurrence",(r,i)=>{this.showRecurrenceContextMenu(i)},"recurrence"),this.createActionIcon(this.actionBar,"bell","Set reminders",(r,i)=>{this.showReminderContextMenu(i)},"reminders"),this.updateIconStates()}createActionIcon(e,r,i,n,a){let o=e.createDiv("action-icon");o.setAttribute("aria-label",i),o.setAttribute("data-initial-tooltip",i),a&&o.setAttribute("data-type",a);let l=o.createSpan("icon");return(0,_e.setIcon)(l,r),o.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),n(o,c)}),o}createDetailsSection(e){this.detailsContainer=e.createDiv("details-container"),this.isExpanded||(this.detailsContainer.style.display="none");let r=this.getModalTitle()==="Edit task",i=this.getModalTitle()==="Create task"&&this.plugin.settings.enableNaturalLanguageInput;if(r||i){let n=this.detailsContainer.createDiv("detail-label");n.textContent="Title";let a=this.detailsContainer.createEl("input",{type:"text",cls:"title-input-detailed",placeholder:"Task title..."});a.value=this.title,a.addEventListener("input",o=>{this.title=o.target.value}),i&&!this.titleInput&&(this.titleInput=a)}if(this.getModalTitle()!=="Edit task"){let n=this.detailsContainer.createDiv("detail-label");n.textContent="Details",this.detailsInput=this.detailsContainer.createEl("textarea",{cls:"details-input",placeholder:"Add more details..."}),this.detailsInput.value=this.details,this.detailsInput.addEventListener("input",a=>{this.details=a.target.value})}this.createAdditionalFields(this.detailsContainer)}createAdditionalFields(e){new _e.Setting(e).setName("Projects").addButton(r=>{r.setButtonText("Add Project").setTooltip("Select a project note using fuzzy search").onClick(()=>{new Ia(this.app,this.plugin,n=>{this.addProject(n)}).open()}),r.buttonEl.addClasses(["tn-btn","tn-btn--ghost"])}),this.projectsList=e.createDiv({cls:"task-projects-list"}),new _e.Setting(e).setName("Contexts").addText(r=>{r.setPlaceholder("context1, context2").setValue(this.contexts).onChange(i=>{this.contexts=i}),this.contextsInput=r.inputEl,new ty(this.app,r.inputEl,this.plugin)}),new _e.Setting(e).setName("Tags").addText(r=>{r.setPlaceholder("tag1, tag2").setValue(this.tags).onChange(i=>{this.tags=Us(i)}),this.tagsInput=r.inputEl,new ry(this.app,r.inputEl,this.plugin)}),new _e.Setting(e).setName("Time estimate (minutes)").addText(r=>{r.setPlaceholder("30").setValue(this.timeEstimate.toString()).onChange(i=>{this.timeEstimate=parseInt(i)||0})}),this.createUserFields(e)}createUserFields(e){var i;let r=((i=this.plugin.settings)==null?void 0:i.userFields)||[];r.length>0&&e.createDiv({cls:"user-fields-separator"}).createDiv({text:"Custom Fields",cls:"detail-label-section"});for(let n of r){if(!n||!n.key||!n.displayName)continue;let a=this.userFields[n.key]||"";switch(n.type){case"boolean":new _e.Setting(e).setName(n.displayName).addToggle(o=>{o.setValue(a===!0||a==="true").onChange(l=>{this.userFields[n.key]=l})});break;case"number":new _e.Setting(e).setName(n.displayName).addText(o=>{o.setPlaceholder("0").setValue(a?String(a):"").onChange(l=>{let c=parseFloat(l);this.userFields[n.key]=isNaN(c)?null:c})});break;case"date":new _e.Setting(e).setName(n.displayName).addText(o=>{o.setPlaceholder("YYYY-MM-DD").setValue(a?String(a):"").onChange(d=>{this.userFields[n.key]=d||null});let l=o.inputEl.parentElement;l&&l.addClass("tn-date-control");let c=l==null?void 0:l.createEl("button",{cls:"user-field-date-picker-btn"});c&&(c.setAttribute("aria-label",`Pick ${n.displayName.toLowerCase()} date`),(0,_e.setIcon)(c,"calendar"),c.addEventListener("click",d=>{d.preventDefault(),new yr({currentValue:o.getValue()||void 0,onSelect:h=>{o.setValue(h||""),this.userFields[n.key]=h||null}}).showAtElement(c)}))});break;case"list":new _e.Setting(e).setName(n.displayName).addText(o=>{var d;let l=Array.isArray(a)?a.join(", "):a?String(a):"";o.setPlaceholder("item1, item2, item3").setValue(l).onChange(u=>{u.trim()?this.userFields[n.key]=u.split(",").map(h=>h.trim()).filter(h=>h):this.userFields[n.key]=null}),new mh(this.app,o.inputEl,this.plugin,n);let c=e.querySelector(".user-field-link-preview");c&&((d=c.detach)==null||d.call(c))});break;case"text":default:new _e.Setting(e).setName(n.displayName).addText(o=>{o.setPlaceholder(`Enter ${n.displayName.toLowerCase()}...`).setValue(a?String(a):"").onChange(l=>{this.userFields[n.key]=l||null}),new mh(this.app,o.inputEl,this.plugin,n)});break}}}createActionButtons(e){let r=e.createDiv("button-container");this.getModalTitle()==="Edit task"&&(r.createEl("button",{cls:"open-note-button",text:"Open note"}).addEventListener("click",async()=>{await this.openTaskNote()}),r.createDiv("button-spacer")),r.createEl("button",{cls:"save-button",text:"Save"}).addEventListener("click",async()=>{await this.handleSave(),this.close()}),r.createEl("button",{cls:"cancel-button",text:"Cancel"}).addEventListener("click",()=>{this.close()})}expandModal(){this.isExpanded||(this.isExpanded=!0,this.detailsContainer.style.display="block",this.containerEl.addClass("expanded"),this.detailsContainer.style.opacity="0",this.detailsContainer.style.transform="translateY(-10px)",setTimeout(()=>{this.detailsContainer.style.opacity="1",this.detailsContainer.style.transform="translateY(0)"},50))}showDateContextMenu(e,r){let i=r==="due"?this.dueDate:this.scheduledDate,n=r==="due"?"Set Due Date":"Set Scheduled Date";new yr({currentValue:i?ue(i):void 0,currentTime:i?jt(i):void 0,title:n,onSelect:(o,l)=>{if(o){let c=l?ar(o,l):o;r==="due"?this.dueDate=c:this.scheduledDate=c}else r==="due"?this.dueDate="":this.scheduledDate="";this.updateDateIconState()}}).show(e)}showStatusContextMenu(e){new ph({currentValue:this.status,onSelect:i=>{this.status=i,this.updateStatusIconState()},plugin:this.plugin}).show(e)}showPriorityContextMenu(e){new ws({currentValue:this.priority,onSelect:i=>{this.priority=i,this.updatePriorityIconState()},plugin:this.plugin}).show(e)}showRecurrenceContextMenu(e){new Pi({currentValue:this.recurrenceRule,onSelect:i=>{this.recurrenceRule=i||"",this.updateRecurrenceIconState()},app:this.app}).show(e)}showReminderContextMenu(e){let r={title:this.title,status:this.status,priority:this.priority,due:this.dueDate,scheduled:this.scheduledDate,path:"",archived:!1,reminders:this.reminders};new vo(this.plugin,r,e.target,n=>{this.reminders=n.reminders||[],this.updateReminderIconState()}).show(e)}updateDateIconState(){this.updateIconStates()}updateStatusIconState(){this.updateIconStates()}updatePriorityIconState(){this.updateIconStates()}updateRecurrenceIconState(){this.updateIconStates()}updateReminderIconState(){this.updateIconStates()}getDefaultStatus(){let e=this.plugin.settings.customStatuses;return e&&e.length>0?[...e].sort((i,n)=>i.order-n.order)[0].value:"open"}getDefaultPriority(){let e=this.plugin.settings.customPriorities;return e&&e.length>0?[...e].sort((i,n)=>i.weight-n.weight)[0].value:"normal"}getRecurrenceDisplayText(){if(!this.recurrenceRule)return"";let e=this.recurrenceRule;if(e.includes("FREQ=DAILY"))return"Daily";if(e.includes("FREQ=WEEKLY")){if(e.includes("INTERVAL=2"))return"Every 2 weeks";if(e.includes("BYDAY=MO,TU,WE,TH,FR"))return"Weekdays";if(e.includes("BYDAY=")){let i=e.match(/BYDAY=([A-Z]{2})/);return i?`Weekly on ${{SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"}[i[1]]||i[1]}`:"Weekly"}else return"Weekly"}else if(e.includes("FREQ=MONTHLY")){if(e.includes("INTERVAL=3"))return"Every 3 months";if(e.includes("BYMONTHDAY=")){let i=e.match(/BYMONTHDAY=(\d+)/);return i?`Monthly on the ${this.getOrdinal(parseInt(i[1]))}`:"Monthly"}else return e.includes("BYDAY=")?"Monthly (by weekday)":"Monthly"}else if(e.includes("FREQ=YEARLY")){if(e.includes("BYMONTH=")&&e.includes("BYMONTHDAY=")){let i=e.match(/BYMONTH=(\d+)/),n=e.match(/BYMONTHDAY=(\d+)/);if(i&&n){let o=["","January","February","March","April","May","June","July","August","September","October","November","December"][parseInt(i[1])],l=this.getOrdinal(parseInt(n[1]));return`Yearly on ${o} ${l}`}}return"Yearly"}let r="";if(e.includes("COUNT=")){let i=e.match(/COUNT=(\d+)/);i&&(r=` (${i[1]} times)`)}else if(e.includes("UNTIL=")){let i=e.match(/UNTIL=(\d{8})/);if(i){let n=i[1];r=` (until ${`${n.slice(0,4)}-${n.slice(4,6)}-${n.slice(6,8)}`})`}}return"Custom"+r}getOrdinal(e){let r=["th","st","nd","rd"],i=e%100;return e+(r[(i-20)%10]||r[i]||r[0])}updateIconStates(){if(!this.actionBar)return;let e=this.actionBar.querySelector('[data-type="due-date"]');e&&(this.dueDate?(e.classList.add("has-value"),(0,_e.setTooltip)(e,`Due: ${this.dueDate}`,{placement:"top"})):(e.classList.remove("has-value"),(0,_e.setTooltip)(e,"Set due date",{placement:"top"})));let r=this.actionBar.querySelector('[data-type="scheduled-date"]');r&&(this.scheduledDate?(r.classList.add("has-value"),(0,_e.setTooltip)(r,`Scheduled: ${this.scheduledDate}`,{placement:"top"})):(r.classList.remove("has-value"),(0,_e.setTooltip)(r,"Set scheduled date",{placement:"top"})));let i=this.actionBar.querySelector('[data-type="status"]');if(i){let l=this.plugin.settings.customStatuses.find(u=>u.value===this.status),c=l?l.label:this.status;this.status&&l&&l.value!==this.getDefaultStatus()?(i.classList.add("has-value"),(0,_e.setTooltip)(i,`Status: ${c}`,{placement:"top"})):(i.classList.remove("has-value"),(0,_e.setTooltip)(i,"Set status",{placement:"top"}));let d=i.querySelector(".icon");d&&l&&l.color?d.style.color=l.color:d&&(d.style.color="")}let n=this.actionBar.querySelector('[data-type="priority"]');if(n){let l=this.plugin.settings.customPriorities.find(u=>u.value===this.priority),c=l?l.label:this.priority;this.priority&&l&&l.value!==this.getDefaultPriority()?(n.classList.add("has-value"),(0,_e.setTooltip)(n,`Priority: ${c}`,{placement:"top"})):(n.classList.remove("has-value"),(0,_e.setTooltip)(n,"Set priority",{placement:"top"}));let d=n.querySelector(".icon");d&&l&&l.color?d.style.color=l.color:d&&(d.style.color="")}let a=this.actionBar.querySelector('[data-type="recurrence"]');a&&(this.recurrenceRule&&this.recurrenceRule.trim()?(a.classList.add("has-value"),(0,_e.setTooltip)(a,`Recurrence: ${this.getRecurrenceDisplayText()}`,{placement:"top"})):(a.classList.remove("has-value"),(0,_e.setTooltip)(a,"Set recurrence",{placement:"top"})));let o=this.actionBar.querySelector('[data-type="reminders"]');if(o)if(this.reminders&&this.reminders.length>0){o.classList.add("has-value");let l=this.reminders.length,c=l===1?"1 reminder set":`${l} reminders set`;(0,_e.setTooltip)(o,c,{placement:"top"})}else o.classList.remove("has-value"),(0,_e.setTooltip)(o,"Set reminders",{placement:"top"})}focusTitleInput(){setTimeout(()=>{this.titleInput.focus(),this.titleInput.select()},100)}addProject(e){this.selectedProjectFiles.some(r=>r.path===e.path)||(this.selectedProjectFiles.push(e),this.updateProjectsFromFiles(),this.renderProjectsList())}removeProject(e){this.selectedProjectFiles=this.selectedProjectFiles.filter(r=>r.path!==e.path),this.updateProjectsFromFiles(),this.renderProjectsList()}updateProjectsFromFiles(){let e=this.app.workspace.getActiveFile(),r=(e==null?void 0:e.path)||"";this.projects=this.selectedProjectFiles.map(i=>`[[${this.app.metadataCache.fileToLinktext(i,r,!0)}]]`).join(", ")}initializeProjectsFromStrings(e){this.selectedProjectFiles=[];for(let r of e){if(!r||typeof r!="string"||r.trim()==="")continue;let i=r.match(/^\[\[([^\]]+)\]\]$/);if(i){let n=i[1],a=this.app.metadataCache.getFirstLinkpathDest(n,"");a&&this.selectedProjectFiles.push(a)}else{let a=this.app.vault.getMarkdownFiles().find(o=>o.basename===r||o.name===r+".md");a&&this.selectedProjectFiles.push(a)}}this.updateProjectsFromFiles()}renderProjectsList(){this.projectsList&&(this.projectsList.empty(),this.selectedProjectFiles.length!==0&&this.selectedProjectFiles.forEach(e=>{let r=this.projectsList.createDiv({cls:"task-project-item"}),i=r.createDiv({cls:"task-project-info"}),n=i.createSpan({cls:"task-project-name"});if(n.textContent=e.name,e.path!==e.name){let o=i.createDiv({cls:"task-project-path"});o.textContent=e.path}let a=r.createEl("button",{cls:"task-project-remove",text:"\xD7"});(0,_e.setTooltip)(a,"Remove project",{placement:"top"}),a.addEventListener("click",()=>{this.removeProject(e)})}))}validateForm(){return this.title.trim().length>0}},ty=class extends _e.AbstractInputSuggest{constructor(t,e,r){super(t,e),this.plugin=r,this.input=e}async getSuggestions(t){let e=this.input.value.split(",").map(n=>n.trim()),r=e[e.length-1];return r?this.plugin.cacheManager.getAllContexts().filter(n=>n&&typeof n=="string").filter(n=>n.toLowerCase().includes(r.toLowerCase())&&!e.slice(0,-1).includes(n)).slice(0,10).map(n=>({value:n,display:n,type:"context",toString(){return this.value}})):[]}renderSuggestion(t,e){e.textContent=t.display}selectSuggestion(t){let e=this.input.value.split(",").map(r=>r.trim());e[e.length-1]=t.value,this.input.value=e.join(", ")+", ",this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}},ry=class extends _e.AbstractInputSuggest{constructor(t,e,r){super(t,e),this.plugin=r,this.input=e}async getSuggestions(t){let e=this.input.value.split(",").map(n=>n.trim()),r=e[e.length-1];return r?this.plugin.cacheManager.getAllTags().filter(n=>n&&typeof n=="string").filter(n=>n.toLowerCase().includes(r.toLowerCase())&&!e.slice(0,-1).includes(n)).slice(0,10).map(n=>({value:n,display:n,type:"tag",toString(){return this.value}})):[]}renderSuggestion(t,e){e.textContent=t.display}selectSuggestion(t){let e=this.input.value.split(",").map(r=>r.trim());e[e.length-1]=t.value,this.input.value=e.join(", ")+", ",this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}},mh=class extends _e.AbstractInputSuggest{constructor(t,e,r,i){super(t,e),this.plugin=r,this.input=e,this.fieldConfig=i}async getSuggestions(t){let e=this.fieldConfig.type==="list",r="",i=[];if(e?(i=this.input.value.split(",").map(o=>o.trim()),r=i[i.length-1]||""):r=this.input.value.trim(),!r)return[];let n=r.match(/\[\[([^\]]*)$/);if(n){let o=n[1]||"",{FileSuggestHelper:l}=await Promise.resolve().then(()=>(ey(),Xg));return(await l.suggest(this.plugin,o)).map(d=>({value:d.insertText,display:d.displayText,type:"user-field",fieldKey:this.fieldConfig.key,toString(){return this.value}}))}return(await this.getExistingUserFieldValues(this.fieldConfig.key)).filter(o=>o&&typeof o=="string").filter(o=>o.toLowerCase().includes(r.toLowerCase())&&(!e||!i.slice(0,-1).includes(o))).slice(0,10).map(o=>({value:o,display:o,type:"user-field",fieldKey:this.fieldConfig.key,toString(){return this.value}}))}async getExistingUserFieldValues(t){var i,n;let e=async()=>{try{let a=this.plugin.app.vault.getMarkdownFiles(),o=new Set;for(let l of a)try{let c=this.plugin.app.metadataCache.getFileCache(l),d=c==null?void 0:c.frontmatter;if(d&&d[t]!==void 0){let u=d[t];Array.isArray(u)?u.forEach(h=>{typeof h=="string"&&h.trim()&&o.add(h.trim())}):typeof u=="string"&&u.trim()?o.add(u.trim()):(typeof u=="number"||typeof u=="boolean")&&o.add(u.toString())}if(o.size>=200)break}catch(c){continue}return Array.from(o).sort()}catch(a){return console.error("Error getting user field values:",a),[]}},r=(n=(i=this.plugin.settings)==null?void 0:i.suggestionDebounceMs)!=null?n:0;return r?new Promise(a=>{let o=this.plugin;o.__userFieldSuggestTimer&&clearTimeout(o.__userFieldSuggestTimer),o.__userFieldSuggestTimer=setTimeout(async()=>{let l=await e();a(l)},r)}):e()}renderSuggestion(t,e){e.textContent=t.display}selectSuggestion(t){var r;if(this.fieldConfig.type==="list"){let i=this.input.value.split(","),n=(r=i.pop())!=null?r:"",a=i.join(","),o=n.trim(),l=/\[\[/.test(o)?o.replace(/\[\[[^\]]*$/,`[[${t.value}]]`):t.value,c=(a?a+", ":"")+l;this.input.value=c.endsWith(",")?c+" ":c+", "}else{let i=this.input.value,n=i.replace(/\[\[[^\]]*$/,`[[${t.value}]]`);this.input.value=n===i?t.value:n}this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}};Se();ot();var iy=require("obsidian");function wx(s,t){if(!s||!t)throw new Error("Invalid context or settings provided");if(!s.title||typeof s.title!="string")throw new Error("Context must have a valid title");if(s.title.trim().length===0)throw new Error("Title cannot be empty");let e=s.date||new Date;if(!(e instanceof Date)||isNaN(e.getTime()))throw new Error("Invalid date provided in context");try{let r=t.icsIntegration;if(r)switch(r.icsNoteFilenameFormat){case"title":return Jt(s.title);case"zettel":return oa(e);case"timestamp":return Tx(e);case"custom":{let i={icsEventTitle:s.icsEventTitle?Jt(s.icsEventTitle):Jt(s.title),icsEventLocation:s.icsEventLocation?Jt(s.icsEventLocation):"",icsEventDescription:s.icsEventDescription?Jt(s.icsEventDescription.substring(0,50)):"",icsEventTitleWithDate:Jt(`${s.icsEventTitle||s.title} - ${C(e,"PPP")}`)};return bx(s,r.customICSNoteFilenameTemplate,e,i)}default:return Jt(s.title)}return Jt(s.title)}catch(r){return console.error("Error generating ICS note filename:",r),Jt(s.title)}}function gh(s,t){if(!s||!t)throw new Error("Invalid context or settings provided");if(!s.title||typeof s.title!="string")throw new Error("Context must have a valid title");if(s.title.trim().length===0)throw new Error("Title cannot be empty");let e=s.date||new Date;if(!(e instanceof Date)||isNaN(e.getTime()))throw new Error("Invalid date provided in context");if(t.storeTitleInFilename)return Jt(s.title);try{switch(t.taskFilenameFormat){case"title":return Jt(s.title);case"zettel":return oa(e);case"timestamp":return Tx(e);case"custom":return bx(s,t.customFilenameTemplate,e);default:return oa(e)}}catch(r){return console.error("Error generating filename:",r),oa(e)}}function oa(s){let t=C(s,"yyMMdd"),e=new Date(s);e.setHours(0,0,0,0);let i=Math.floor((s.getTime()-e.getTime())/1e3).toString(36);return`${t}${i}`}function Tx(s){return C(s,"yyyy-MM-dd-HHmmss")}function bx(s,t,e,r){if(!s||!t||!e)throw new Error("Invalid inputs for custom filename generation");if(typeof t!="string"||t.trim().length===0)throw new Error("Template must be a non-empty string");if(!(e instanceof Date)||isNaN(e.getTime()))throw new Error("Invalid date for filename generation");try{let i=Jt(s.title),n=s.priority&&["low","normal","medium","high"].includes(s.priority)?s.priority:"normal",a=s.status&&["open","in-progress","done","scheduled"].includes(s.status)?s.status:"open",o={title:i,date:C(e,"yyyy-MM-dd"),time:C(e,"HHmmss"),priority:n,status:a,timestamp:C(e,"yyyy-MM-dd-HHmmss"),dateTime:C(e,"yyyy-MM-dd-HHmm"),year:C(e,"yyyy"),month:C(e,"MM"),day:C(e,"dd"),hour:C(e,"HH"),minute:C(e,"mm"),second:C(e,"ss"),dueDate:s.dueDate||"",scheduledDate:s.scheduledDate||"",shortDate:C(e,"yyMMdd"),monthName:C(e,"MMMM"),monthNameShort:C(e,"MMM"),dayName:C(e,"EEEE"),dayNameShort:C(e,"EEE"),week:C(e,"ww"),quarter:C(e,"q"),time12:C(e,"hh:mm a"),time24:C(e,"HH:mm"),hourPadded:C(e,"HH"),hour12:C(e,"hh"),ampm:C(e,"a"),unix:Math.floor(e.getTime()/1e3).toString(),unixMs:e.getTime().toString(),milliseconds:C(e,"SSS"),ms:C(e,"SSS"),timezone:C(e,"xxx"),timezoneShort:C(e,"xx"),utcOffset:C(e,"xxx"),utcOffsetShort:C(e,"xx"),utcZ:"Z",priorityShort:n.substring(0,1).toUpperCase(),statusShort:a.substring(0,1).toUpperCase(),titleLower:i.toLowerCase(),titleUpper:i.toUpperCase(),titleSnake:i.toLowerCase().replace(/\s+/g,"_"),titleKebab:i.toLowerCase().replace(/\s+/g,"-"),titleCamel:i.replace(/(?:^\w|[A-Z]|\b\w)/g,(c,d)=>d===0?c.toLowerCase():c.toUpperCase()).replace(/\s+/g,""),titlePascal:i.replace(/(?:^\w|[A-Z]|\b\w)/g,c=>c.toUpperCase()).replace(/\s+/g,""),zettel:oa(e),nano:Date.now().toString()+Math.random().toString(36).substring(2,7),...r||{}},l=t;if(t.length>500)throw new Error("Template too long");return Object.entries(o).forEach(([c,d])=>{try{let u=new RegExp(`\\{${c}\\}`,"g");l=l.replace(u,d)}catch(u){console.warn(`Error replacing template variable ${c}:`,u)}}),l=l.replace(/\{[^}]+\}/g,""),l.trim()||(l=i||oa(e)),Jt(l)}catch(i){return console.error("Error generating custom filename:",i),Jt(s.title)||oa(e)}}function Jt(s){if(!s||typeof s!="string")return"untitled";try{let t=s.trim().replace(/\s+/g," ").replace(/[<>:"/\\|?*]/g,"").replace(/./g,r=>{let i=r.charCodeAt(0);return i<=31||i>=127&&i<=159?"":r}).replace(/^\.+|\.+$/g,"").trim();return(!t||t.length===0)&&(t="untitled"),["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"].includes(t.toUpperCase())&&(t=`task-${t}`),t}catch(t){return console.error("Error sanitizing filename:",t),"untitled"}}async function pc(s,t,e){if(!s||typeof s!="string")throw new Error("Base filename must be a non-empty string");if(typeof t!="string")throw new Error("Folder path must be a string");if(!e)throw new Error("Vault must be provided");let r=Jt(s);if(!r)throw new Error("Base filename cannot be sanitized to a valid name");let i=t.replace(/\.\./g,"").trim();try{let n=(0,iy.normalizePath)(`${i}/${r}.md`);if(n.length>260)throw new Error("Generated path too long");if(!e.getAbstractFileByPath(n))return r;for(let l=2;l<=999;l++){let c=`${r}-${l}`,d=(0,iy.normalizePath)(`${i}/${c}.md`);if(d.length>260)break;if(!e.getAbstractFileByPath(d))return c}let a=Date.now().toString(36),o=`${r.substring(0,50)}-${a}`;return Jt(o)}catch(n){return console.error("Error generating unique filename:",n),`task-${Date.now().toString(36)}`}}ht();jc();jc();var zc=class{constructor(t,e,r){this.nlpParser=new Vi(t,e,r)}extractTaskDataFromInput(t){return this.nlpParser.parseInput(t)}getStatusSuggestions(t,e,r=10){let i=t.toLowerCase();return e.filter(n=>n&&typeof n.value=="string"&&typeof n.label=="string").filter(n=>n.value.trim()!==""&&n.label.trim()!=="").filter(n=>n.value.toLowerCase().includes(i)||n.label.toLowerCase().includes(i)).slice(0,r).map(n=>({value:n.value,label:n.label,display:n.label,type:"status",toString(){return this.value}}))}hasStatusTrigger(t,e,r){return e.trim()?t.slice(0,r).lastIndexOf(e)!==-1:!1}extractQueryAfterTrigger(t,e,r){if(!e.trim())return"";let i=t.slice(0,r),n=i.lastIndexOf(e);if(n===-1)return"";let a=n+e.length,l=i.slice(a).match(/^[^\s@#+]*/);return l?l[0]:""}applyStatusSelection(t,e,r,i){if(!e.trim())return{newText:t,newCursorPos:r};let n=t.slice(0,r),a=t.slice(r),o=n.lastIndexOf(e);if(o===-1)return{newText:t,newCursorPos:r};let l=t.slice(0,o),c=i.label,d=l+c+a,u=o+c.length;return{newText:d,newCursorPos:u}}isValidStatusContext(t,e){return!((t.slice(0,e).match(/"/g)||[]).length%2===1)}};Se();Pa();var My=class extends bi.AbstractInputSuggest{constructor(e,r,i){super(e,r);this.currentTrigger=null;this.plugin=i,this.textarea=r}async getSuggestions(e){let r=this.textarea.selectionStart,i=this.textarea.value.slice(0,r),n=i.lastIndexOf("@"),a=i.lastIndexOf("#"),o=i.lastIndexOf("+"),l=(this.plugin.settings.statusSuggestionTrigger||"").trim(),c=l?i.lastIndexOf(l):-1,d=-1,u=null,h=g=>{if(g===-1)return!1;if(g===0)return!0;let y=i[g-1];return!/\w/.test(y)},p=[{type:"@",index:n},{type:"#",index:a},{type:"+",index:o},{type:"status",index:c}].filter(g=>h(g.index));if(p.length===0)return this.currentTrigger=null,[];p.sort((g,y)=>y.index-g.index),d=p[0].index,u=p[0].type;let f=u==="status"?(l==null?void 0:l.length)||0:1,m=i.slice(d+f);if(u==="+"&&/^\[\[[^\]]*\]\]/.test(m))return this.currentTrigger=null,[];if((u==="@"||u==="#"||u==="status")&&(m.includes(" ")||m.includes(`
`)))return this.currentTrigger=null,[];if(this.currentTrigger=u,u==="@")return this.plugin.cacheManager.getAllContexts().filter(y=>y&&typeof y=="string").filter(y=>y.toLowerCase().includes(m.toLowerCase())).slice(0,10).map(y=>({value:y,display:y,type:"context",toString(){return this.value}}));if(u==="status")return new zc(this.plugin.settings.customStatuses,this.plugin.settings.customPriorities,this.plugin.settings.nlpDefaultToScheduled).getStatusSuggestions(m,this.plugin.settings.customStatuses||[],10);if(u==="#")return this.plugin.cacheManager.getAllTags().filter(y=>y&&typeof y=="string").filter(y=>y.toLowerCase().includes(m.toLowerCase())).slice(0,10).map(y=>({value:y,display:y,type:"tag",toString(){return this.value}}));if(u==="+"){let{FileSuggestHelper:g}=await Promise.resolve().then(()=>(ey(),Xg));return(await g.suggest(this.plugin,m)).map(w=>({basename:w.insertText,displayName:w.displayText,type:"project",toString(){return this.basename}}))}return[]}renderSuggestion(e,r){let i=r.createSpan("nlp-suggest-icon");i.textContent=this.currentTrigger==="status"?this.plugin.settings.statusSuggestionTrigger||"":this.currentTrigger||"";let n=r.createSpan("nlp-suggest-text");e.type==="project"?n.textContent=e.displayName:(e.type,n.textContent=e.display)}selectSuggestion(e){if(!this.currentTrigger)return;let r=this.textarea.selectionStart,i=this.textarea.value.slice(0,r),n=this.textarea.value.slice(r),a=-1,o=(this.plugin.settings.statusSuggestionTrigger||"").trim();if(this.currentTrigger==="@"?a=i.lastIndexOf("@"):this.currentTrigger==="#"?a=i.lastIndexOf("#"):this.currentTrigger==="+"?a=i.lastIndexOf("+"):this.currentTrigger==="status"&&o&&(a=i.lastIndexOf(o)),a===-1)return;let l=e.type==="project"?e.basename:e.value,c=i.slice(0,a),d="";this.currentTrigger==="+"?d="+[["+l+"]]":this.currentTrigger==="status"?d=e.type==="status"?e.label:l:d=this.currentTrigger+l;let u=c+d+(d?" ":"")+n;this.textarea.value=u;let h=c.length+d.length+(d?1:0);this.textarea.setSelectionRange(h,h),this.textarea.dispatchEvent(new Event("input",{bubbles:!0})),this.textarea.focus()}},ca=class extends wo{constructor(t,e,r={},i){super(t,e),this.options=r,this.nlParser=new Vi(e.settings.customStatuses,e.settings.customPriorities,e.settings.nlpDefaultToScheduled),this.statusSuggestionService=i||new zc(e.settings.customStatuses,e.settings.customPriorities,e.settings.nlpDefaultToScheduled)}getModalTitle(){return"Create task"}createModalContent(){let{contentEl:t}=this;t.empty();let e=t.createDiv("minimalist-modal-container");this.plugin.settings.enableNaturalLanguageInput?this.createNaturalLanguageInput(e):(this.createTitleInput(e),this.isExpanded=!0,this.containerEl.addClass("expanded")),this.createActionBar(e),this.createDetailsSection(e),(this.options.prePopulatedValues&&this.options.prePopulatedValues.projects||this.selectedProjectFiles.length>0)&&this.renderProjectsList(),this.createActionButtons(e)}createNaturalLanguageInput(t){let e=t.createDiv("nl-input-container");this.nlInput=e.createEl("textarea",{cls:"nl-input",attr:{placeholder:`Buy groceries tomorrow at 3pm @home #errands

Add details here...`,rows:"3"}}),this.nlPreviewContainer=e.createDiv("nl-preview-container"),this.nlInput.addEventListener("input",()=>{let r=this.nlInput.value.trim();r?this.updateNaturalLanguagePreview(r):this.clearNaturalLanguagePreview()}),this.nlInput.addEventListener("keydown",r=>{let i=this.nlInput.value.trim();i&&(r.key==="Enter"&&(r.ctrlKey||r.metaKey)?(r.preventDefault(),this.handleSave()):r.key==="Tab"&&r.shiftKey&&(r.preventDefault(),this.parseAndFillForm(i)))}),this.nlpSuggest=new My(this.app,this.nlInput,this.plugin),setTimeout(()=>{this.nlInput.focus()},100)}updateNaturalLanguagePreview(t){if(!this.nlPreviewContainer)return;let e=this.nlParser.parseInput(t),r=this.nlParser.getPreviewData(e);r.length>0&&e.title?(this.nlPreviewContainer.empty(),this.nlPreviewContainer.style.display="block",r.forEach(i=>{let n=this.nlPreviewContainer.createDiv("nl-preview-item");n.textContent=i.text})):this.clearNaturalLanguagePreview()}clearNaturalLanguagePreview(){this.nlPreviewContainer&&(this.nlPreviewContainer.empty(),this.nlPreviewContainer.style.display="none")}createActionBar(t){if(this.actionBar=t.createDiv("action-bar"),this.plugin.settings.enableNaturalLanguageInput){this.createActionIcon(this.actionBar,"wand","Fill form from natural language",(r,i)=>{var a;let n=(a=this.nlInput)==null?void 0:a.value.trim();n&&this.parseAndFillForm(n)}),this.createActionIcon(this.actionBar,this.isExpanded?"chevron-up":"chevron-down",this.isExpanded?"Hide detailed options":"Show detailed options",(r,i)=>{this.toggleDetailedForm();let n=r.querySelector(".icon");n&&(0,bi.setIcon)(n,this.isExpanded?"chevron-up":"chevron-down"),(0,bi.setTooltip)(r,this.isExpanded?"Hide detailed options":"Show detailed options",{placement:"top"})});let e=this.actionBar.createDiv("action-separator");e.style.width="1px",e.style.height="24px",e.style.backgroundColor="var(--background-modifier-border)",e.style.margin="0 var(--size-4-2)"}this.createActionIcon(this.actionBar,"calendar","Set due date",(e,r)=>{this.showDateContextMenu(r,"due")},"due-date"),this.createActionIcon(this.actionBar,"calendar-clock","Set scheduled date",(e,r)=>{this.showDateContextMenu(r,"scheduled")},"scheduled-date"),this.createActionIcon(this.actionBar,"dot-square","Set status",(e,r)=>{this.showStatusContextMenu(r)},"status"),this.createActionIcon(this.actionBar,"star","Set priority",(e,r)=>{this.showPriorityContextMenu(r)},"priority"),this.createActionIcon(this.actionBar,"refresh-ccw","Set recurrence",(e,r)=>{this.showRecurrenceContextMenu(r)},"recurrence"),this.createActionIcon(this.actionBar,"bell","Set reminders",(e,r)=>{this.showReminderContextMenu(r)},"reminders"),this.updateIconStates()}parseAndFillForm(t){let e=this.statusSuggestionService.extractTaskDataFromInput(t);this.applyParsedData(e),this.isExpanded||this.expandModal()}applyParsedData(t){t.title&&(this.title=t.title),t.status&&(this.status=t.status),t.priority&&(this.priority=t.priority),t.dueDate&&(this.dueDate=t.dueTime?ar(t.dueDate,t.dueTime):t.dueDate),t.scheduledDate&&(this.scheduledDate=t.scheduledTime?ar(t.scheduledDate,t.scheduledTime):t.scheduledDate),t.contexts&&t.contexts.length>0&&(this.contexts=t.contexts.join(", ")),t.tags&&t.tags.length>0&&(this.tags=Us(t.tags.join(", "))),t.details&&(this.details=t.details),t.recurrence&&(this.recurrenceRule=t.recurrence),this.titleInput&&(this.titleInput.value=this.title),this.detailsInput&&(this.detailsInput.value=this.details),this.contextsInput&&(this.contextsInput.value=this.contexts),this.tagsInput&&(this.tagsInput.value=this.tags),t.projects&&t.projects.length>0&&(this.initializeProjectsFromStrings(t.projects),this.renderProjectsList()),this.updateIconStates()}toggleDetailedForm(){this.isExpanded?(this.isExpanded=!1,this.detailsContainer.style.display="none",this.containerEl.removeClass("expanded")):this.expandModal()}async initializeFormData(){this.priority=this.plugin.settings.defaultTaskPriority,this.status=this.plugin.settings.defaultTaskStatus;let t=this.plugin.settings.taskCreationDefaults;if(this.dueDate=Gr(t.defaultDueDate),this.scheduledDate=Gr(t.defaultScheduledDate),this.contexts=t.defaultContexts||"",this.tags=t.defaultTags||"",t.defaultProjects){let e=hi(t.defaultProjects);e.length>0&&this.initializeProjectsFromStrings(e)}if(t.defaultTimeEstimate&&t.defaultTimeEstimate>0&&(this.timeEstimate=t.defaultTimeEstimate),t.defaultReminders&&t.defaultReminders.length>0){let{convertDefaultRemindersToReminders:e}=await Promise.resolve().then(()=>(Gc(),qc));this.reminders=e(t.defaultReminders)}this.options.prePopulatedValues&&this.applyPrePopulatedValues(this.options.prePopulatedValues)}applyPrePopulatedValues(t){t.title!==void 0&&(this.title=t.title),t.due!==void 0&&(this.dueDate=t.due),t.scheduled!==void 0&&(this.scheduledDate=t.scheduled),t.priority!==void 0&&(this.priority=t.priority),t.status!==void 0&&(this.status=t.status),t.contexts!==void 0&&(this.contexts=t.contexts.join(", ")),t.projects!==void 0&&(t.projects.filter(r=>r&&typeof r=="string"&&r.trim()!=="").length>0&&this.initializeProjectsFromStrings(t.projects),this.renderProjectsList()),t.tags!==void 0&&(this.tags=Us(t.tags.filter(e=>e!==this.plugin.settings.taskTag).join(", "))),t.timeEstimate!==void 0&&(this.timeEstimate=t.timeEstimate),t.recurrence!==void 0&&typeof t.recurrence=="string"&&(this.recurrenceRule=t.recurrence)}async handleSave(){if(this.plugin.settings.enableNaturalLanguageInput&&this.nlInput){let t=this.nlInput.value.trim();if(t&&!this.title.trim()){let e=this.statusSuggestionService.extractTaskDataFromInput(t);this.applyParsedData(e)}}if(!this.validateForm()){new bi.Notice("Please enter a task title");return}try{let t=this.buildTaskData(),e=await this.plugin.taskService.createTask(t),r=e.taskInfo.title.replace(/[<>:"/\\|?*]/g,"").trim(),i=e.file.basename;i.startsWith("task-")&&i!==r?new bi.Notice(`Task "${e.taskInfo.title}" created successfully (filename shortened due to length)`):new bi.Notice(`Task "${e.taskInfo.title}" created successfully`),this.options.onTaskCreated&&this.options.onTaskCreated(e.taskInfo),this.close()}catch(t){console.error("Failed to create task:",t),new bi.Notice("Failed to create task: "+t.message)}}buildTaskData(){let t=ke(),e=this.contexts.split(",").map(a=>a.trim()).filter(a=>a.length>0),r=hi(this.projects),i=Us(this.tags).split(",").map(a=>a.trim()).filter(a=>a.length>0);this.plugin.settings.taskTag&&!i.includes(this.plugin.settings.taskTag)&&i.push(this.plugin.settings.taskTag);let n={title:this.title.trim(),due:this.dueDate||void 0,scheduled:this.scheduledDate||void 0,priority:this.priority,status:this.status,contexts:e.length>0?e:void 0,projects:r.length>0?r:void 0,tags:i.length>0?i:void 0,timeEstimate:this.timeEstimate>0?this.timeEstimate:void 0,recurrence:this.recurrenceRule||void 0,reminders:this.reminders.length>0?this.reminders:void 0,creationContext:"manual-creation",dateCreated:t,dateModified:t,customFrontmatter:this.buildCustomFrontmatter()};return this.details.trim()&&(n.details=this.details.trim()),n}buildCustomFrontmatter(){let t={};for(let[e,r]of Object.entries(this.userFields))r!=null&&r!==""&&(t[e]=r);return t}generateFilename(t){let e={title:t.title||"",status:t.status||"open",priority:t.priority||"normal",dueDate:t.due,scheduledDate:t.scheduled};return gh(e,this.plugin.settings)}createTitleInput(t){this.plugin.settings.enableNaturalLanguageInput||super.createTitleInput(t)}};var cr=require("obsidian");Se();Se();ot();ht();Pa();var hn=class extends wo{constructor(e,r,i){super(e,r);this.completedInstancesChanges=new Set;this.calendarWrapper=null;this.isExpanded=!0;this.task=i.task,this.options=i}getModalTitle(){return"Edit task"}async initializeFormData(){this.title=this.task.title,this.dueDate=this.task.due||"",this.scheduledDate=this.task.scheduled||"",this.priority=this.task.priority,this.status=this.task.status,this.contexts=this.task.contexts?this.task.contexts.join(", "):"",this.task.projects&&this.task.projects.length>0?this.task.projects.filter(r=>r&&typeof r=="string"&&r.trim()!=="").length>0?this.initializeProjectsFromStrings(this.task.projects):(this.projects="",this.selectedProjectFiles=[]):(this.projects="",this.selectedProjectFiles=[]),this.tags=this.task.tags?Us(this.task.tags.filter(e=>e!==this.plugin.settings.taskTag).join(", ")):"",this.timeEstimate=this.task.timeEstimate||0,this.task.recurrence?typeof this.task.recurrence=="string"?this.recurrenceRule=this.task.recurrence:typeof this.task.recurrence=="object"&&this.task.recurrence.frequency&&(this.recurrenceRule=this.convertLegacyRecurrenceToString(this.task.recurrence)):this.recurrenceRule="",this.reminders=this.task.reminders?[...this.task.reminders]:[],await this.initializeUserFields()}async initializeUserFields(){var e;try{let r=this.app.vault.getAbstractFileByPath(this.task.path);if(!r||!(r instanceof cr.TFile))return;let i=this.app.metadataCache.getFileCache(r),n=i==null?void 0:i.frontmatter;if(!n)return;let a=((e=this.plugin.settings)==null?void 0:e.userFields)||[];for(let o of a){if(!o||!o.key)continue;let l=n[o.key];l!==void 0&&(this.userFields[o.key]=l)}}catch(r){console.error("Error initializing user fields:",r)}}convertLegacyRecurrenceToString(e){if(!e.frequency)return"";let r=e.frequency;return e.frequency==="weekly"&&e.days_of_week&&(r+=` on ${e.days_of_week.join(", ")}`),e.frequency==="monthly"&&e.day_of_month&&(r+=` on day ${e.day_of_month}`),r}showReminderContextMenu(e){let r={...this.task,title:this.title,due:this.dueDate,scheduled:this.scheduledDate,reminders:this.reminders};new vo(this.plugin,r,e.target,n=>{this.reminders=n.reminders||[],this.updateReminderIconState()}).show(e)}async onOpen(){this.completedInstancesChanges.clear(),await this.refreshTaskData(),this.containerEl.addClass("tasknotes-plugin","minimalist-task-modal"),this.titleEl.setText(this.getModalTitle());let e=this.titleEl.createSpan("modal-header-icon");(0,cr.setIcon)(e,"tasknotes-simple"),this.titleEl.insertBefore(e,this.titleEl.firstChild),this.initializeFormData().then(()=>{this.createModalContent(),this.renderProjectsList(),this.updateIconStates(),this.focusTitleInput()})}async refreshTaskData(){try{let e=this.app.vault.getAbstractFileByPath(this.task.path);if(!e||!(e instanceof cr.TFile)){console.warn("Could not find file for task:",this.task.path);return}let r=await this.app.vault.read(e),i=FE(this.app,r,this.task.path,e,this.plugin.fieldMapper,this.plugin.settings.storeTitleInFilename);i&&(this.task=i,this.options.task=i)}catch(e){console.warn("Could not refresh task data:",e)}}createModalContent(){let{contentEl:e}=this;e.empty();let r=e.createDiv("minimalist-modal-container");this.createActionBar(r),this.createDetailsSection(r),this.createCompletionsCalendarSection(r),this.createMetadataSection(r),this.createActionButtons(r)}createCompletionsCalendarSection(e){if(this.task.recurrence){let r=e.createDiv("completions-calendar-container"),i=r.createDiv("detail-label");i.textContent="Completions";let n=r.createDiv("completions-calendar-content");this.createRecurringCalendar(n)}}createMetadataSection(e){this.metadataContainer=e.createDiv("metadata-container");let r=this.metadataContainer.createDiv("detail-label");r.textContent="Task Information";let i=this.metadataContainer.createDiv("metadata-content"),n=pr(this.task.timeEntries||[]);if(n>0){let a=i.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Total tracked time: ",a.createSpan("metadata-value").textContent=Zd(n)}if(this.task.dateCreated){let a=i.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Created: ",a.createSpan("metadata-value").textContent=cf(this.task.dateCreated)}if(this.task.dateModified){let a=i.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Modified: ",a.createSpan("metadata-value").textContent=cf(this.task.dateModified)}if(this.task.path){let a=i.createDiv("metadata-item");a.createSpan("metadata-key").textContent="File: ",a.createSpan("metadata-value").textContent=this.task.path}}createRecurringCalendar(e){this.calendarWrapper=e.createDiv("recurring-calendar");let i=Ue();if(this.task.complete_instances&&this.task.complete_instances.length>0){let n=this.task.complete_instances.filter(a=>a&&typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a.trim())).map(a=>Oa(a).getTime()).filter(a=>!isNaN(a));n.length>0&&(i=new Date(Math.max(...n)))}this.renderCalendarMonth(this.calendarWrapper,i)}renderCalendarMonth(e,r){e.empty();let i=e.createDiv("recurring-calendar__header"),n=i.createEl("button",{cls:"recurring-calendar__nav",text:"\u2039"}),a=i.createSpan("recurring-calendar__month");a.textContent=C(r,"MMM yyyy");let o=i.createEl("button",{cls:"recurring-calendar__nav",text:"\u203A"}),l=e.createDiv("recurring-calendar__grid"),c=hf(r),d=pf(r),u=this.plugin.settings.calendarViewSettings.firstDay||0,h=uf(c,u),p=HS(d,u),f=LS(h,p),m=hf(r);m.setUTCMonth(m.getUTCMonth()-1);let g=pf(r);g.setUTCMonth(g.getUTCMonth()+1);let y=wl(this.task,m,g),w=new Set(y.map(S=>ae(S))),T=new Set(this.task.complete_instances||[]);this.completedInstancesChanges.forEach(S=>{T.has(S)?T.delete(S):T.add(S)}),f.forEach(S=>{let x=ae(S),I=S.getUTCMonth()===r.getUTCMonth(),F=w.has(x),A=T.has(x),L=l.createDiv("recurring-calendar__day");L.textContent=String(S.getUTCDate()),I||L.addClass("recurring-calendar__day--faded"),L.addClass("recurring-calendar__day--clickable"),F&&L.addClass("recurring-calendar__day--recurring"),A&&L.addClass("recurring-calendar__day--completed"),L.addEventListener("click",()=>{this.toggleCompletedInstance(x),this.renderCalendarMonth(e,r)})}),n.addEventListener("click",()=>{let S=new Date(r);S.setUTCMonth(S.getUTCMonth()-1),this.renderCalendarMonth(e,S)}),o.addEventListener("click",()=>{let S=new Date(r);S.setUTCMonth(S.getUTCMonth()+1),this.renderCalendarMonth(e,S)})}toggleCompletedInstance(e){this.completedInstancesChanges.has(e)?this.completedInstancesChanges.delete(e):this.completedInstancesChanges.add(e)}async handleSave(){if(!this.validateForm()){new cr.Notice("Please enter a task title");return}try{let e=this.getChanges();if(Object.keys(e).length===0){new cr.Notice("No changes to save"),this.close();return}let r=await this.plugin.taskService.updateTask(this.task,e);new cr.Notice(`Task "${r.title}" updated successfully`),this.options.onTaskUpdated&&this.options.onTaskUpdated(r)}catch(e){console.error("Failed to update task:",e),new cr.Notice("Failed to update task: "+e.message)}}getChanges(){let e={};this.title.trim()!==this.task.title&&(e.title=this.title.trim()),this.dueDate!==(this.task.due||"")&&(e.due=this.dueDate||void 0),this.scheduledDate!==(this.task.scheduled||"")&&(e.scheduled=this.scheduledDate||void 0),this.priority!==this.task.priority&&(e.priority=this.priority),this.status!==this.task.status&&(e.status=this.status);let r=this.contexts.split(",").map(m=>m.trim()).filter(m=>m.length>0),i=this.task.contexts||[];JSON.stringify(r.sort())!==JSON.stringify(i.sort())&&(e.contexts=r.length>0?r:void 0);let n=hi(this.projects),a=this.task.projects||[];JSON.stringify(n.sort())!==JSON.stringify(a.sort())&&(e.projects=n);let o=this.tags.split(",").map(m=>m.trim()).filter(m=>m.length>0);this.plugin.settings.taskTag&&!o.includes(this.plugin.settings.taskTag)&&o.push(this.plugin.settings.taskTag);let l=this.task.tags||[];JSON.stringify(o.sort())!==JSON.stringify(l.sort())&&(e.tags=o.length>0?o:void 0);let c=this.timeEstimate>0?this.timeEstimate:void 0,d=this.task.timeEstimate;c!==d&&(e.timeEstimate=c);let u=typeof this.task.recurrence=="string"?this.task.recurrence:"";this.recurrenceRule!==u&&(e.recurrence=this.recurrenceRule||void 0);let h=this.task.reminders||[],p=this.reminders||[];if(JSON.stringify(p)!==JSON.stringify(h)&&(e.reminders=p.length>0?p:void 0),this.completedInstancesChanges.size>0){let m=new Set(this.task.complete_instances||[]);if(this.completedInstancesChanges.forEach(g=>{m.has(g)?m.delete(g):m.add(g)}),e.complete_instances=Array.from(m),this.task.recurrence){let g={...this.task,...e},y=Tl(g,this.plugin.settings.maintainDueDateOffsetInRecurring);y.scheduled&&(e.scheduled=y.scheduled),y.due&&(e.due=y.due)}}let f=this.getUserFieldChanges();return Object.keys(f).length>0&&(e.customFrontmatter=f),Object.keys(e).length>0&&(e.dateModified=ke()),e}getUserFieldChanges(){var r;let e={};try{let i=this.app.vault.getAbstractFileByPath(this.task.path);if(!i||!(i instanceof cr.TFile))return e;let n=this.app.metadataCache.getFileCache(i),a=(n==null?void 0:n.frontmatter)||{},o=((r=this.plugin.settings)==null?void 0:r.userFields)||[];for(let l of o){if(!l||!l.key)continue;let c=this.userFields[l.key],d=a[l.key];this.isDifferent(c,d)&&(e[l.key]=c==null||c===""?null:c)}}catch(i){console.error("Error comparing user fields:",i)}return e}isDifferent(e,r){let i=o=>o==null||o===""?null:o,n=i(e),a=i(r);return Array.isArray(n)||Array.isArray(a)?JSON.stringify(n)!==JSON.stringify(a):n!==a}async openTaskNote(){try{let e=this.app.vault.getAbstractFileByPath(this.task.path);if(!e){new cr.Notice(`Could not find task file: ${this.task.path}`);return}await this.app.workspace.getLeaf(!0).openFile(e),this.close()}catch(e){console.error("Failed to open task note:",e),new cr.Notice("Failed to open task note")}}async archiveTask(){try{let e=await this.plugin.taskService.toggleArchive(this.task);this.task=e,this.options.onTaskUpdated&&this.options.onTaskUpdated(e);let r=e.archived?"archived":"unarchived";new cr.Notice(`Task ${r} successfully`),this.close()}catch(e){console.error("Failed to archive task:",e),new cr.Notice("Failed to archive task")}}createActionButtons(e){let r=e.createDiv("button-container");r.createEl("button",{cls:"open-note-button",text:"Open note"}).addEventListener("click",async()=>{await this.openTaskNote()}),r.createEl("button",{cls:"archive-button",text:this.task.archived?"Unarchive":"Archive"}).addEventListener("click",async()=>{await this.archiveTask()}),r.createDiv("button-spacer"),r.createEl("button",{cls:"save-button",text:"Save"}).addEventListener("click",async()=>{await this.handleSave(),this.close()}),r.createEl("button",{cls:"cancel-button",text:"Cancel"}).addEventListener("click",()=>{this.close()})}};var Wi=require("obsidian");ot();Se();ht();var Mh=class extends Wi.FuzzySuggestModal{constructor(t,e,r,i){super(t),this.plugin=e,this.onScheduleTask=r,this.defaultScheduleOptions=i,this.setPlaceholder("Type to search for an unscheduled task..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to schedule task"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText("Schedule Task"),this.titleEl.setAttribute("id","unscheduled-tasks-selector-title"),this.containerEl.setAttribute("aria-labelledby","unscheduled-tasks-selector-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),this.containerEl.addClass("unscheduled-tasks-selector-modal"),this.loadUnscheduledTasks()}async loadUnscheduledTasks(){try{let t=this.plugin.cacheManager.getAllTaskPaths(),e=Array.from(t).map(i=>this.plugin.cacheManager.getTaskInfo(i)),r=(await Promise.all(e)).filter(i=>i!==null);this.tasks=r.filter(i=>!i.archived&&!this.plugin.statusManager.isCompletedStatus(i.status)&&!i.scheduled)}catch(t){console.error("Error loading unscheduled tasks:",t),this.tasks=[]}}getItems(){return this.tasks.sort((t,e)=>{var a,o;if(t.due&&!e.due)return-1;if(!t.due&&e.due)return 1;if(t.due&&e.due){let l=t.due.localeCompare(e.due);if(l!==0)return l}let r={high:0,normal:1,low:2},i=(a=r[t.priority])!=null?a:1,n=(o=r[e.priority])!=null?o:1;return i!==n?i-n:t.title.localeCompare(e.title)})}getItemText(t){return t.title}renderSuggestion(t,e){let r=t.item;e.empty(),e.addClass("unscheduled-tasks-selector__suggestion");let i=e.createDiv({cls:"unscheduled-tasks-selector__content"}),n=i.createDiv({cls:"unscheduled-tasks-selector__title"});this.renderHighlightedText(n,t,r.title);let a=i.createDiv({cls:"unscheduled-tasks-selector__meta"});if(r.priority&&a.createSpan({text:r.priority.toUpperCase(),cls:`unscheduled-tasks-selector__priority priority-${(r.priority||"normal").toLowerCase()}`}),r.due){let c=a.createSpan({cls:"unscheduled-tasks-selector__due"}),d=ft(r.due)?C(_t(r.due),"MMM d, h:mm a"):C(_t(r.due),"MMM d");if(Fa(ue(r.due))){c.addClass("overdue");let u=c.createSpan();(0,Wi.setIcon)(u,"alert-triangle"),c.createSpan({text:` Overdue: ${d}`})}else if(Fs(ue(r.due))){c.addClass("due-today");let u=c.createSpan();(0,Wi.setIcon)(u,"calendar"),c.createSpan({text:` Due today: ${d}`})}else c.setText(`Due: ${d}`)}if(r.timeEstimate&&a.createSpan({text:`~${r.timeEstimate}min`,cls:"unscheduled-tasks-selector__time-estimate"}),r.contexts&&r.contexts.length>0){let c=a.createSpan({cls:"unscheduled-tasks-selector__contexts"});c.textContent=`@${r.contexts.join(", @")}`}let o=fr(r.projects||[]);if(o.length>0){let c=a.createSpan({cls:"unscheduled-tasks-selector__projects"});KL(c,o,this.plugin)}let l=i.createDiv({cls:"unscheduled-tasks-selector__schedule-icon"});(0,Wi.setIcon)(l,"calendar-plus")}renderHighlightedText(t,e,r){t.empty();let i=e.match.matches;if(!i||i.length===0){t.textContent=r;return}let n=0;for(let a of i)a[0]>n&&t.appendText(r.slice(n,a[0])),t.createEl("mark",{text:r.slice(a[0],a[1]+1)}),n=a[1]+1;n<r.length&&t.appendText(r.slice(n))}onChooseItem(t,e){this.onScheduleTask(t,this.defaultScheduleOptions)}onNoSuggestion(){this.resultContainerEl.createDiv({cls:"unscheduled-tasks-selector__no-results"}).setText("No unscheduled tasks found. All tasks are either scheduled, completed, or archived.")}};function QL(s){return!!(s&&typeof s=="string"&&s.startsWith("[[")&&s.endsWith("]]"))}function KL(s,t,e){s.innerHTML="",t.forEach((r,i)=>{if(i>0){let a=document.createTextNode(", ");s.appendChild(a)}let n=document.createTextNode("+");if(s.appendChild(n),QL(r)){let a=r.slice(2,-2);s.createEl("a",{cls:"unscheduled-tasks-selector__project-link internal-link",text:a,attr:{"data-href":a}}).addEventListener("click",async l=>{l.preventDefault(),l.stopPropagation();let c=e.app.metadataCache.getFirstLinkpathDest(a,"");c instanceof Wi.TFile?await e.app.workspace.getLeaf(!1).openFile(c):new Wi.Notice(`Note "${a}" not found`)})}else{let a=document.createTextNode(r);s.appendChild(a)}})}var rt=require("obsidian");ht();Se();var pn=bt(Vr()),_h=class extends rt.Modal{constructor(e,r,i){super(e);this.selectedAttachments=[];this.plugin=r,this.options=i}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("timeblock-creation-modal"),new rt.Setting(e).setName("Create timeblock").setHeading();let r=e.createDiv({cls:"timeblock-date-display"});r.createEl("strong",{text:"Date: "});let i=Oa(this.options.date);r.createSpan({text:i.toLocaleDateString()}),new rt.Setting(e).setName("Title").setDesc("Title for your timeblock").addText(c=>{this.titleInput=c.inputEl,c.setPlaceholder("e.g., Deep work session").setValue(this.options.prefilledTitle||"").onChange(()=>this.validateForm()),window.setTimeout(()=>this.titleInput.focus(),100)});let n=e.createDiv({cls:"timeblock-time-container"});new rt.Setting(n).setName("Start time").setDesc("When the timeblock starts").addText(c=>{this.startTimeInput=c.inputEl,c.setPlaceholder("09:00").setValue(this.options.startTime||"").onChange(()=>this.validateForm()),this.startTimeInput.type="time"}),new rt.Setting(n).setName("End time").setDesc("When the timeblock ends").addText(c=>{this.endTimeInput=c.inputEl,c.setPlaceholder("11:00").setValue(this.options.endTime||"").onChange(()=>this.validateForm()),this.endTimeInput.type="time"}),new rt.Setting(e).setName("Description").setDesc("Optional description for the timeblock").addTextArea(c=>{this.descriptionInput=c.inputEl,c.setPlaceholder("Focus on new features, no interruptions").setValue(""),this.descriptionInput.rows=3}),new rt.Setting(e).setName("Color").setDesc("Optional color for the timeblock").addText(c=>{this.colorInput=c.inputEl,c.setPlaceholder("#3b82f6").setValue("#6366f1"),this.colorInput.type="color"}),new rt.Setting(e).setName("Attachments").setDesc("Files or notes to link to this timeblock").addButton(c=>{c.setButtonText("Add Attachment").setTooltip("Select a file or note using fuzzy search").onClick(()=>{new Xa(this.app,this.plugin,u=>{this.addAttachment(u)}).open()})}),this.attachmentsList=e.createDiv({cls:"timeblock-attachments-list"}),this.renderAttachmentsList();let a=e.createDiv({cls:"timeblock-modal-buttons"});a.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),a.createEl("button",{text:"Create timeblock",cls:"mod-cta timeblock-create-button"}).addEventListener("click",()=>this.handleSubmit()),this.validateForm()}validateForm(){var o,l,c;let e=this.contentEl.querySelector(".timeblock-create-button");if(!e)return;let r=(o=this.titleInput)==null?void 0:o.value.trim(),i=(l=this.startTimeInput)==null?void 0:l.value,n=(c=this.endTimeInput)==null?void 0:c.value,a=!!(r&&i&&n);if(a&&i&&n){let[d,u]=i.split(":").map(Number),[h,p]=n.split(":").map(Number),f=d*60+u;h*60+p<=f&&(a=!1)}e.disabled=!a,e.style.opacity=a?"1":"0.5"}async handleSubmit(){try{let e=this.titleInput.value.trim(),r=this.startTimeInput.value,i=this.endTimeInput.value,n=this.descriptionInput.value.trim(),a=this.colorInput.value;if(!e||!r||!i){new rt.Notice("Please fill in all required fields");return}let o=this.selectedAttachments.map(c=>`[[${c.path}]]`),l={id:HE(),title:e,startTime:r,endTime:i};n&&(l.description=n),a&&(l.color=a),o.length>0&&(l.attachments=o),await this.saveTimeblockToDailyNote(l),this.plugin.emitter.trigger("data-changed"),new rt.Notice(`Timeblock "${e}" created successfully`),this.close()}catch(e){console.error("Error creating timeblock:",e),new rt.Notice("Failed to create timeblock. Check console for details.")}}async saveTimeblockToDailyNote(e){if(!(0,pn.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let r=window.moment(this.options.date),i=(0,pn.getAllDailyNotes)(),n=(0,pn.getDailyNote)(r,i);if(!n&&(n=await(0,pn.createDailyNote)(r),!n))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let a=await this.app.vault.read(n),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let h=a.substring(3,u);l=a.substring(u+3);try{o=(0,rt.parseYaml)(h)||{}}catch(p){console.error("Error parsing existing frontmatter:",p),o={}}}}o.timeblocks||(o.timeblocks=[]),o.timeblocks.push(e);let d=`---
${(0,rt.stringifyYaml)(o)}---${l}`;await this.app.vault.modify(n,d)}addAttachment(e){if(this.selectedAttachments.some(r=>r.path===e.path)){new rt.Notice(`"${e.name}" is already attached`);return}this.selectedAttachments.push(e),this.renderAttachmentsList(),new rt.Notice(`Added "${e.name}" as attachment`)}removeAttachment(e){this.selectedAttachments=this.selectedAttachments.filter(r=>r.path!==e.path),this.renderAttachmentsList(),new rt.Notice(`Removed "${e.name}" from attachments`)}renderAttachmentsList(){if(this.attachmentsList.empty(),this.selectedAttachments.length===0){let e=this.attachmentsList.createDiv({cls:"timeblock-attachments-empty"});e.textContent="No attachments added yet";return}this.selectedAttachments.forEach(e=>{let r=this.attachmentsList.createDiv({cls:"timeblock-attachment-item"}),i=r.createDiv({cls:"timeblock-attachment-info"}),n=i.createSpan({cls:"timeblock-attachment-name"});if(n.textContent=e.name,e.path!==e.name){let o=i.createDiv({cls:"timeblock-attachment-path"});o.textContent=e.path}let a=r.createEl("button",{cls:"timeblock-attachment-remove",text:"\xD7"});(0,rt.setTooltip)(a,"Remove attachment",{placement:"top"}),a.addEventListener("click",()=>{this.removeAttachment(e)})})}onClose(){let{contentEl:e}=this;e.empty()}};var X=require("obsidian");var Ah=class{constructor(t){this.dragState=null;this.onReorder=t}setupDragAndDrop(t,e){this.initializeDragState(),t.addEventListener("dragstart",r=>this.handleDragStart(r,t,e)),t.addEventListener("dragend",()=>this.handleDragEnd(t)),t.addEventListener("dragover",r=>this.handleDragOver(r,t)),t.addEventListener("drop",r=>this.handleDrop(r,e))}setupGlobalHandlers(t){t.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation()}),t.addEventListener("drop",e=>{var n;if(e.preventDefault(),e.stopPropagation(),!((n=this.dragState)!=null&&n.draggedElement)||this.dragState.dropHandled)return;this.dragState.dropHandled=!0;let r=this.dragState.draggedIndex,i=this.calculateDropPosition();r!==i&&this.onReorder(r,i)})}initializeDragState(){this.dragState||(this.dragState={draggedElement:null,placeholder:null,draggedIndex:-1,dropHandled:!1})}handleDragStart(t,e,r){this.dragState&&(this.dragState.draggedElement=e,this.dragState.draggedIndex=r,this.dragState.dropHandled=!1,e.classList.add("filter-bar__view-item-container--dragging"),this.dragState.placeholder=e.cloneNode(!0),this.dragState.placeholder.classList.add("filter-bar__view-item-container--placeholder"),this.dragState.placeholder.classList.remove("filter-bar__view-item-container--dragging"),t.dataTransfer&&(t.dataTransfer.setData("text/plain",r.toString()),t.dataTransfer.effectAllowed="move"))}handleDragEnd(t){var e;this.dragState&&(t.classList.remove("filter-bar__view-item-container--dragging"),(e=this.dragState.placeholder)!=null&&e.parentNode&&this.dragState.placeholder.parentNode.removeChild(this.dragState.placeholder),this.resetDragState())}handleDragOver(t,e){var a;if(t.preventDefault(),!((a=this.dragState)!=null&&a.draggedElement)||this.dragState.draggedElement===e)return;let r=e.getBoundingClientRect(),n=t.clientY-r.top<r.height/2;e.parentNode&&this.dragState.placeholder&&(n?e.parentNode.insertBefore(this.dragState.placeholder,e):e.parentNode.insertBefore(this.dragState.placeholder,e.nextSibling))}handleDrop(t,e){var n,a;if(t.preventDefault(),!((n=this.dragState)!=null&&n.draggedElement)||this.dragState.dropHandled)return;this.dragState.dropHandled=!0;let r=this.dragState.draggedIndex,i=(a=this.calculateDropPosition())!=null?a:e;r!==i&&this.onReorder(r,i)}calculateDropPosition(){var r,i;if(!((i=(r=this.dragState)==null?void 0:r.placeholder)!=null&&i.parentNode))return-1;let t=this.dragState.placeholder.parentNode,e=0;for(let n of t.children){if(n===this.dragState.placeholder)break;n.classList.contains("filter-bar__view-item-container")&&!n.classList.contains("filter-bar__view-item-container--placeholder")&&e++}return e>this.dragState.draggedIndex&&e--,e}resetDragState(){this.dragState&&(this.dragState.draggedElement=null,this.dragState.placeholder=null,this.dragState.draggedIndex=-1,this.dragState.dropHandled=!1)}};var Yi=class{constructor(){this.events={}}on(t,e){return this.events[t]||(this.events[t]=[]),this.events[t].push(e),()=>{this.events[t]=this.events[t].filter(r=>r!==e)}}emit(t,...e){this.events[t]&&this.events[t].forEach(r=>{r(...e)})}removeAllListeners(t){t?delete this.events[t]:this.events={}}};Se();var Xt=class extends Error{constructor(e,r,i){super(e);this.field=r;this.nodeId=i;this.name="FilterValidationError"}},fn=class extends Error{constructor(e,r){super(e);this.nodeId=r;this.name="FilterEvaluationError"}},we=class{static generateId(){return`filter_${Date.now()}_${++this.idCounter}`}static deepCloneFilterQuery(t){return JSON.parse(JSON.stringify(t))}static validateFilterNode(t,e=!0){if(!t||typeof t!="object")throw new Xt("Filter node must be an object");if(!("id"in t)||!t.id||typeof t.id!="string")throw new Xt("Filter node must have a valid string ID",void 0,"id"in t?String(t.id):"unknown");if(t.type==="condition")this.validateCondition(t,e);else if(t.type==="group")this.validateGroup(t,e);else throw new Xt(`Unknown filter node type: ${t.type}`,void 0,t.id)}static validateCondition(t,e=!0){if(typeof t.property!="string")throw new Xt("Condition must have a valid property","property",t.id);if(e&&t.property==="")throw new Xt("Property must be selected","property",t.id);if(t.property==="")return;if(!t.operator||typeof t.operator!="string")throw new Xt("Condition must have a valid operator","operator",t.id);if(!this.getValidOperatorsForProperty(t.property).includes(t.operator))throw new Xt(`Operator '${t.operator}' is not valid for property '${t.property}'`,"operator",t.id);if(e&&this.operatorRequiresValue(t.operator)&&(t.value===null||t.value===void 0||t.value===""))throw new Xt(`Operator '${t.operator}' requires a value`,"value",t.id)}static validateGroup(t,e=!0){if(!t.conjunction||!["and","or"].includes(t.conjunction))throw new Xt("Group must have a valid conjunction (and/or)","conjunction",t.id);if(!Array.isArray(t.children))throw new Xt("Group must have a children array","children",t.id);t.children.forEach((r,i)=>{try{this.validateFilterNode(r,e)}catch(n){throw n instanceof Xt?new Xt(`Child ${i}: ${n.message}`,n.field,t.id):n}})}static getValidOperatorsForProperty(t){return typeof t=="string"&&t.startsWith("user:")?["is","is-not","contains","does-not-contain","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty","is-checked","is-not-checked","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal"]:{"":[],title:["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],path:["contains","does-not-contain","is-empty","is-not-empty"],status:["is","is-not","is-empty","is-not-empty"],priority:["is","is-not","is-empty","is-not-empty"],tags:["contains","does-not-contain","is-empty","is-not-empty"],contexts:["contains","does-not-contain","is-empty","is-not-empty"],projects:["contains","does-not-contain","is-empty","is-not-empty"],due:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],scheduled:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],completedDate:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],"file.ctime":["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],"file.mtime":["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],archived:["is-checked","is-not-checked"],timeEstimate:["is","is-not","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal"],recurrence:["is-empty","is-not-empty"],"status.isCompleted":["is-checked","is-not-checked"]}[t]||[]}static isFilterNodeComplete(t){try{return this.validateFilterNode(t,!0),!0}catch(e){return!1}}static operatorRequiresValue(t){return!["is-empty","is-not-empty","is-checked","is-not-checked"].includes(t)}static getTaskPropertyValue(t,e){switch(e){case"title":return t.title;case"path":return t.path;case"status":return t.status;case"priority":return t.priority;case"tags":return t.tags||[];case"contexts":return t.contexts||[];case"projects":return t.projects||[];case"due":return t.due;case"scheduled":return t.scheduled;case"completedDate":return t.completedDate;case"file.ctime":return t.dateCreated;case"file.mtime":return t.dateModified;case"archived":return t.archived;case"timeEstimate":return t.timeEstimate;case"recurrence":return t.recurrence;case"status.isCompleted":return;default:throw new fn(`Unknown property: ${e}`)}}static applyOperator(t,e,r,i,n){try{switch(e){case"is":return this.isEqual(t,r,n);case"is-not":return!this.isEqual(t,r,n);case"contains":return this.contains(t,r);case"does-not-contain":return!this.contains(t,r);case"is-before":return this.isBefore(t,r);case"is-after":return this.isAfter(t,r);case"is-on-or-before":return this.isOnOrBefore(t,r);case"is-on-or-after":return this.isOnOrAfter(t,r);case"is-empty":return this.isEmpty(t);case"is-not-empty":return!this.isEmpty(t);case"is-checked":return t===!0;case"is-not-checked":return t!==!0;case"is-greater-than":return this.isGreaterThan(t,r);case"is-less-than":return this.isLessThan(t,r);case"is-greater-than-or-equal":return this.isGreaterThanOrEqual(t,r);case"is-less-than-or-equal":return this.isLessThanOrEqual(t,r);default:throw new fn(`Unknown operator: ${e}`,i)}}catch(a){throw a instanceof fn?a:new fn(`Error applying operator '${e}': ${a.message}`,i)}}static isEqual(t,e,r){return r&&this.isDateProperty(r)&&typeof t=="string"&&typeof e=="string"&&(t||ff(e))?this.isEqualDate(t,e):Array.isArray(t)?Array.isArray(e)?t.some(i=>e.includes(i)):t.includes(e):Array.isArray(e)?e.includes(t):t===e}static contains(t,e){if(Array.isArray(t)){if(Array.isArray(e))return e.some(r=>t.some(i=>typeof i=="string"&&typeof r=="string"&&i.toLowerCase().includes(r.toLowerCase())));{let r=typeof e=="string"?e.toLowerCase():String(e!=null?e:"").toLowerCase();return t.some(i=>typeof i=="string"&&i.toLowerCase().includes(r))}}else if(typeof t=="string")return Array.isArray(e)?e.some(r=>typeof r=="string"&&t.toLowerCase().includes(r.toLowerCase())):typeof e=="string"&&t.toLowerCase().includes(e.toLowerCase());return!1}static isBefore(t,e){if(!t||!e)return!1;try{let r=La(e);return Ls(t,r)}catch(r){return!1}}static isAfter(t,e){if(!t||!e)return!1;try{let r=La(e);return Ls(r,t)}catch(r){return!1}}static isOnOrBefore(t,e){if(!t||!e)return!1;try{let r=La(e);return Ls(t,r)||At(ue(t),ue(r))}catch(r){return!1}}static isOnOrAfter(t,e){if(!t||!e)return!1;try{let r=La(e);return Ls(r,t)||At(ue(t),ue(r))}catch(r){return!1}}static isDateProperty(t){return["due","scheduled","completedDate","file.ctime","file.mtime"].includes(t)}static isEqualDate(t,e){try{let r=La(e);return At(ue(t),ue(r))}catch(r){return!1}}static isEmpty(t){return t==null?!0:typeof t=="string"?t.trim()==="":Array.isArray(t)?t.length===0?!0:t.every(e=>{if(typeof e!="string")return!1;let r=e.trim();return r.length===0||r==='""'||r==="''"}):!1}static isGreaterThan(t,e){let r=typeof t=="number"?t:parseFloat(t),i=typeof e=="number"?e:parseFloat(e);return isNaN(r)||isNaN(i)?!1:r>i}static isLessThan(t,e){let r=typeof t=="number"?t:parseFloat(t),i=typeof e=="number"?e:parseFloat(e);return isNaN(r)||isNaN(i)?!1:r<i}static isGreaterThanOrEqual(t,e){let r=typeof t=="number"?t:parseFloat(t),i=typeof e=="number"?e:parseFloat(e);return isNaN(r)||isNaN(i)?!1:r>=i}static isLessThanOrEqual(t,e){let r=typeof t=="number"?t:parseFloat(t),i=typeof e=="number"?e:parseFloat(e);return isNaN(r)||isNaN(i)?!1:r<=i}};we.idCounter=0;Se();Md();Za();var nM=require("obsidian"),Ih=null,sM=null,Ph=class{constructor(t,e,r){this.currentProperties=t;this.plugin=e;this.onUpdate=r}show(t){try{let e=new nM.Menu,r=this.getCachedProperties(),i=this.groupProperties(r);this.addPropertyGroup(e,"CORE PROPERTIES",i.core),this.addPropertyGroup(e,"ORGANIZATION",i.organization),i.user.length>0&&this.addPropertyGroup(e,"CUSTOM PROPERTIES",i.user),this.showMenu(e,t)}catch(e){console.error("PropertyVisibilityDropdown: Error showing menu:",e),this.plugin.app.workspace.trigger("notice","Failed to show properties menu")}}showMenu(t,e){t.showAtMouseEvent?t.showAtMouseEvent(e):t.showAtPosition?t.showAtPosition({x:e.clientX,y:e.clientY}):console.error("PropertyVisibilityDropdown: No menu show method available")}getCachedProperties(){return Ih&&sM===this.plugin||(Ih=this.computeAvailableProperties(),sM=this.plugin),Ih}groupProperties(t){let e={core:[],organization:[],user:[]};for(let r of t)e[r.category].push(r);return e}computeAvailableProperties(){let t=[];return t.push({id:"status",name:"Status Dot",category:"core"},{id:"priority",name:"Priority Dot",category:"core"},{id:"due",name:"Due Date",category:"core"},{id:"scheduled",name:"Scheduled Date",category:"core"},{id:"timeEstimate",name:"Time Estimate",category:"core"},{id:"totalTrackedTime",name:"Total Tracked Time",category:"core"},{id:"recurrence",name:"Recurrence",category:"core"},{id:"completedDate",name:"Completed Date",category:"core"},{id:"file.ctime",name:"Created Date",category:"core"},{id:"file.mtime",name:"Modified Date",category:"core"}),t.push({id:"projects",name:"Projects",category:"organization"},{id:"contexts",name:"Contexts",category:"organization"},{id:"tags",name:"Tags",category:"organization"}),this.addUserProperties(t),t}addUserProperties(t){try{let e=this.plugin.settings.userFields||[];for(let r of e)r.id&&r.displayName&&t.push({id:`user:${r.id}`,name:r.displayName,category:"user"})}catch(e){console.warn("PropertyVisibilityDropdown: Error loading user properties:",e)}}addPropertyGroup(t,e,r){if(r.length===0)return;t.addSeparator(),t.addItem(n=>{n.setTitle(e),n.setDisabled(!0)});let i=new Set(this.currentProperties);for(let n of r){let a=i.has(n.id);t.addItem(o=>{o.setTitle(n.name),o.setIcon(a?"check-square":"square"),o.onClick(()=>{this.toggleProperty(n.id)})})}}toggleProperty(t){try{let e=new Set(this.currentProperties);e.has(t)?e.delete(t):e.add(t);let r=Array.from(e);this.onUpdate(r)}catch(e){console.error("PropertyVisibilityDropdown: Error toggling property:",e)}}};var _y=class extends X.Modal{constructor(t,e){super(t),this.onSubmit=e}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:"Save view"});let e=new X.TextComponent(t).setPlaceholder("Enter view name...").onChange(i=>{this.name=i});e.inputEl.style.width="100%";let r=t.createDiv({cls:"modal-button-container"});new X.ButtonComponent(r).setButtonText("Save").setCta().onClick(()=>{this.name&&(this.onSubmit(this.name),this.close())})}onClose(){this.contentEl.empty()}},ri=class extends Yi{constructor(e,r,i,n,a,o="right",l){var c,d;super();this.savedViews=[];this.activeSavedView=null;this.isLoadingSavedView=!1;this.isSettingSavedView=!1;this.temporaryVisibleProperties=null;this.viewsButtonAlignment="right";this.isUserTyping=!1;this.viewOptionsConfig=null;this.ignoreNextClick=!1;this.sectionStates={filterBox:!1,filters:!0,display:!0,viewOptions:!1};this.enableGroupExpandCollapse=!0;this.forceShowExpandCollapse=!1;this.app=e,this.plugin=r,this.container=i,this.currentQuery=we.deepCloneFilterQuery(n),this.filterOptions=a,this.viewsButtonAlignment=o,this.enableGroupExpandCollapse=(c=l==null?void 0:l.enableGroupExpandCollapse)!=null?c:!0,this.forceShowExpandCollapse=(d=l==null?void 0:l.forceShowExpandCollapse)!=null?d:!1,this.viewType=l==null?void 0:l.viewType,this.dragDropHandler=new Ah((u,h)=>{this.emit("reorderViews",u,h)}),this.ensureValidFilterQuery(),this.debouncedEmitQueryChange=(0,X.debounce)(()=>{!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.emit("queryChange",we.deepCloneFilterQuery(this.currentQuery)),this.updateFilterToggleBadge()},300),this.debouncedHandleSearchInput=(0,X.debounce)(()=>{this.handleSearchInput()},800),this.render(),this.updateUI(),this.setupClickOutsideHandlers()}ensureValidFilterQuery(){var e,r,i;if(!this.currentQuery||typeof this.currentQuery!="object"||this.currentQuery.type!=="group"||!Array.isArray(this.currentQuery.children)||typeof this.currentQuery.conjunction!="string"){let n=(e=this.currentQuery)!=null&&e.sortKey&&typeof this.currentQuery.sortKey=="string"?this.currentQuery.sortKey:"due",a=(r=this.currentQuery)!=null&&r.sortDirection&&typeof this.currentQuery.sortDirection=="string"?this.currentQuery.sortDirection:"asc",o=(i=this.currentQuery)!=null&&i.groupKey&&typeof this.currentQuery.groupKey=="string"?this.currentQuery.groupKey:"none";this.currentQuery={type:"group",id:we.generateId(),conjunction:"and",children:[],sortKey:n,sortDirection:a,groupKey:o}}}updateQuery(e){this.currentQuery=we.deepCloneFilterQuery(e),this.ensureValidFilterQuery(),this.detectActiveSavedView(),this.updateUI()}handleSearchInput(){var e;try{let r=((e=this.searchInput)==null?void 0:e.getValue().trim())||"";this.removeSearchConditions(),r&&this.addSearchConditionWithGrouping(r),this.updateFilterBuilder(),this.emitQueryChange(),setTimeout(()=>{this.isUserTyping=!1},1e3)}catch(r){console.error("Error handling search input:",r)}}removeSearchConditions(){if(!Array.isArray(this.currentQuery.children)){this.currentQuery.children=[];return}let e=this.currentQuery.children.findIndex(r=>r.type==="condition"&&r.property==="title"&&r.operator==="contains"&&r.id.startsWith("search_"));if(e!==-1&&(this.currentQuery.children.splice(e,1),this.currentQuery.children.length===1&&this.currentQuery.children[0].type==="group")){let r=this.currentQuery.children[0];this.currentQuery.children=r.children,this.currentQuery.conjunction=r.conjunction}}addSearchConditionWithGrouping(e){Array.isArray(this.currentQuery.children)||(this.currentQuery.children=[]);let r={type:"condition",id:`search_${we.generateId()}`,property:"title",operator:"contains",value:e},i=this.currentQuery.children.filter(n=>!(n.type==="condition"&&n.property==="title"&&n.operator==="contains"&&n.id.startsWith("search_")));if(i.length===0)this.currentQuery.children=[r];else{let n={type:"group",id:we.generateId(),conjunction:this.currentQuery.conjunction,children:i};this.currentQuery.children=[r,n],this.currentQuery.conjunction="and"}}updateSavedViews(e){this.savedViews=e,this.renderViewSelectorDropdown(),this.detectActiveSavedView()}detectActiveSavedView(){var r;if(this.isLoadingSavedView||this.isSettingSavedView)return;let e=null;for(let i=this.savedViews.length-1;i>=0;i--){let n=this.savedViews[i];if(this.queriesMatch(this.currentQuery,n.query)){e=n;break}}if(e&&((r=this.activeSavedView)==null?void 0:r.id)!==e.id){if(this.activeSavedView=e,this.temporaryVisibleProperties&&e.visibleProperties){let i=new Set(this.temporaryVisibleProperties),n=new Set(e.visibleProperties);i.size===n.size&&[...i].every(a=>n.has(a))&&(this.temporaryVisibleProperties=null)}this.updateViewSelectorButtonState(),this.emit("activeSavedViewChanged",e)}else!e&&this.activeSavedView&&(this.activeSavedView=null,this.updateViewSelectorButtonState(),this.emit("activeSavedViewChanged",null))}queriesMatch(e,r){let i=n=>{let a=we.deepCloneFilterQuery(n);return delete a.sortKey,delete a.sortDirection,delete a.groupKey,a};try{let n=i(e),a=i(r);return JSON.stringify(n)===JSON.stringify(a)}catch(n){return console.warn("Error comparing queries:",n),!1}}getCurrentQuery(){return we.deepCloneFilterQuery(this.currentQuery)}clearActiveSavedView(){this.activeSavedView=null,this.updateViewSelectorButtonState()}render(){try{this.container.empty(),this.container.addClass("advanced-filter-bar"),this.renderTopControls()}catch(e){console.error("Error rendering FilterBar:",e),this.renderFallbackUI()}}renderFallbackUI(){try{if(this.container.children.length===0){this.container.addClass("advanced-filter-bar");let e=this.container.createDiv({cls:"filter-bar-error"});e.textContent="Filter bar temporarily unavailable"}}catch(e){console.error("Error rendering fallback FilterBar UI:",e)}}renderTopControls(){let e=this.container.createDiv("filter-bar__top-controls"),r=()=>{this.viewSelectorButton=new X.ButtonComponent(e).setButtonText("Views").setClass("filter-bar__templates-button").setTooltip("Saved filter views").onClick(()=>{this.toggleViewSelectorDropdown()}),this.viewSelectorButton.buttonEl.addClass("clickable-icon");let u=this.viewSelectorButton.buttonEl.createDiv("filter-bar__chevron-container");(0,X.setIcon)(u,"chevrons-up-down"),this.updateViewSelectorButtonState()},i=()=>{let u=new X.ButtonComponent(e).setTooltip("Toggle filter").setClass("filter-bar__filter-toggle").onClick(()=>{this.toggleMainFilterBox()});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let h=u.buttonEl.createSpan({cls:"button-icon"});(0,X.setIcon)(h,"list-filter");let p=u.buttonEl.createSpan({cls:"button-text",text:"Filters"});u.buttonEl.addEventListener("contextmenu",f=>{f.preventDefault(),f.stopPropagation(),this.hasActiveFilters()&&this.clearAllFilters()})},n=()=>{let u=new X.ButtonComponent(e).setTooltip("Configure visible properties").setClass("filter-bar__properties-button").onClick(f=>{let m=f instanceof MouseEvent?f:new MouseEvent("click",{bubbles:!0,cancelable:!0});this.showPropertiesDropdown(m)});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let h=u.buttonEl.createSpan({cls:"button-icon"});(0,X.setIcon)(h,"list");let p=u.buttonEl.createSpan({cls:"button-text",text:"Properties"})},a=()=>{this.searchInput=new X.TextComponent(e).setPlaceholder("Search tasks..."),this.searchInput.inputEl.addClass("filter-bar__search-input"),(0,X.setTooltip)(this.searchInput.inputEl,"Search task titles",{placement:"top"}),this.searchInput.onChange(()=>{this.isUserTyping=!0,this.debouncedHandleSearchInput()})},o=()=>{if(this.viewType==="advanced-calendar")return;let u=new X.ButtonComponent(e).setTooltip("Sort and group options").setClass("filter-bar__sort-group-button").onClick(f=>{this.showSortGroupContextMenu(f)});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let h=u.buttonEl.createSpan({cls:"button-icon"});(0,X.setIcon)(h,"arrow-up-down");let p=u.buttonEl.createSpan({cls:"button-text",text:"Sort"})},l=()=>{if(this.viewType==="subtask-widget")return;let u=new X.ButtonComponent(e).setTooltip("Create new task").setClass("filter-bar__new-task-button").onClick(()=>{this.createNewTask()});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let h=u.buttonEl.createSpan({cls:"button-icon"});(0,X.setIcon)(h,"plus");let p=u.buttonEl.createSpan({cls:"button-text",text:"New"})},c=()=>{let u=(this.currentQuery.groupKey||"none")!=="none";this.enableGroupExpandCollapse&&(u||this.forceShowExpandCollapse)&&(new X.ButtonComponent(e).setIcon("list-tree").setTooltip("Expand All Groups").setClass("filter-bar__expand-groups").onClick(()=>this.emit("expandAllGroups")).buttonEl.addClass("clickable-icon"),new X.ButtonComponent(e).setIcon("list-collapse").setTooltip("Collapse All Groups").setClass("filter-bar__collapse-groups").onClick(()=>this.emit("collapseAllGroups")).buttonEl.addClass("clickable-icon"))};this.viewsButtonAlignment==="left"?(r(),a(),o(),i(),n(),l()):(a(),o(),i(),n(),l(),r()),this.updateViewSelectorButtonState(),this.renderMainFilterBox(e);let d=this.viewsButtonAlignment==="left"?"filter-bar__view-selector-dropdown filter-bar__view-selector-dropdown--hidden filter-bar__view-selector-dropdown--left":"filter-bar__view-selector-dropdown filter-bar__view-selector-dropdown--hidden";this.viewSelectorDropdown=e.createDiv({cls:d}),this.renderViewSelectorDropdown()}renderMainFilterBox(e){this.mainFilterBox=e.createDiv("filter-bar__main-box"),this.sectionStates.filterBox||this.mainFilterBox.addClass("filter-bar__main-box--collapsed"),this.positionFilterBox(),this.renderFilterBuilder(this.mainFilterBox),this.renderViewOptions(this.mainFilterBox)}positionFilterBox(){if(!this.mainFilterBox)return;let e=this.container.querySelector(".filter-bar__filter-toggle");if(e){let r=this.container.getBoundingClientRect(),i=e.getBoundingClientRect(),n=this.mainFilterBox.getBoundingClientRect(),a=i.left-r.left,o=this.container.closest(".workspace-leaf");if(o){let l=o.getBoundingClientRect(),c=30,d=r.left+a+n.width,u=l.right-c;if(d>u){let h=d-u;a=a-h,a<0&&(a=0)}}this.mainFilterBox.style.left=`${a}px`}}setupClickOutsideHandlers(){this.abortController=new AbortController;let{signal:e}=this.abortController;document.addEventListener("click",r=>{this.handleDocumentClick(r)},{signal:e,passive:!0}),document.addEventListener("keydown",r=>{this.handleKeyDown(r)},{signal:e})}ignoreNextClickOutside(){this.ignoreNextClick=!0,this.ignoreClickTimeout&&window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=window.setTimeout(()=>{this.ignoreNextClick=!1,this.ignoreClickTimeout=void 0},100)}handleKeyDown(e){var r;if(e.key==="Escape"){if(this.sectionStates.filterBox){this.sectionStates.filterBox=!1,this.updateFilterBoxState(),e.preventDefault();return}this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(r=this.viewSelectorButton)!=null&&r.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"),e.preventDefault())}}handleDocumentClick(e){var i;if(this.ignoreNextClick){this.ignoreNextClick=!1;return}let r=e.target;if(r){if(this.sectionStates.filterBox&&this.mainFilterBox&&this.container){let n=this.container.querySelector(".filter-bar__filter-toggle"),a=this.container.contains(r),o=n&&n.contains(r);!a&&!o&&(this.sectionStates.filterBox=!1,this.updateFilterBoxState())}this.viewSelectorDropdown&&((i=this.viewSelectorButton)!=null&&i.buttonEl)&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&!this.viewSelectorButton.buttonEl.contains(r)&&!this.viewSelectorDropdown.contains(r)&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}}toggleMainFilterBox(){this.sectionStates.filterBox=!this.sectionStates.filterBox,this.positionFilterBox(),this.updateFilterBoxState()}updateFilterBoxState(){let e=this.container.querySelector(".filter-bar__main-box"),r=this.container.querySelector(".filter-bar__filter-toggle");e&&e.classList.toggle("filter-bar__main-box--collapsed",!this.sectionStates.filterBox),r&&r.classList.toggle("filter-bar__filter-toggle--active",this.sectionStates.filterBox)}async deleteView(e){await ui(this.app,{title:"Delete View",message:`Are you sure you want to delete the view "${e.name}"?`,isDestructive:!0})&&this.emit("deleteView",e.id)}renderViewSelectorDropdown(){if(this.viewSelectorDropdown)if(this.viewSelectorDropdown.empty(),this.savedViews.length===0)this.viewSelectorDropdown.createDiv({text:"No saved views",cls:"filter-bar__view-empty-message"});else{let e=this.viewSelectorDropdown.createDiv("filter-bar__view-section"),r=e.createDiv({text:"Saved views",cls:"filter-bar__view-section-header"});(0,X.setTooltip)(r,"Your saved filter configurations",{placement:"top"}),this.savedViews.forEach((i,n)=>{let a=e.createDiv({cls:"filter-bar__view-item-container"});a.draggable=!0,a.setAttribute("data-view-index",n.toString());let o=a.createDiv({cls:"filter-bar__view-drag-handle"});(0,X.setTooltip)(o,"Drag to reorder views",{placement:"top"});let l=new X.ButtonComponent(a).setButtonText(i.name).setClass("filter-bar__view-item").setTooltip(`Load saved view: ${i.name}`).onClick(()=>{this.activeSavedView&&this.activeSavedView.id===i.id?this.clearAllFilters():this.loadSavedView(i)});this.activeSavedView&&this.activeSavedView.id===i.id&&(l.buttonEl.classList.add("filter-bar__view-item--active"),a.classList.add("filter-bar__view-item-container--active")),new X.ButtonComponent(a).setIcon("trash-2").setClass("filter-bar__view-delete").setTooltip("Delete view").onClick(async()=>{await ui(this.app,{title:"Delete View",message:`Are you sure you want to delete the view "${i.name}"?`,isDestructive:!0})&&this.emit("deleteView",i.id)}),this.dragDropHandler.setupDragAndDrop(a,n)}),this.dragDropHandler.setupGlobalHandlers(e)}}renderFilterBuilder(e){let r=e.createDiv("filter-bar__section"),i=r.createDiv("filter-bar__section-header"),n=i.createDiv("filter-bar__section-header-main");n.createSpan({text:"Filter",cls:"filter-bar__section-title"}),(0,X.setTooltip)(n,"Click to expand/collapse filter conditions",{placement:"top"}),this.activeSavedView&&n.createSpan({text:`(${this.activeSavedView.name})`,cls:"filter-bar__active-view-name"});let a=i.createDiv("filter-bar__section-header-actions");new X.ButtonComponent(a).setIcon("eraser").setTooltip("Clear all filters and groups").setClass("filter-bar__clear-all-button").onClick(()=>{this.clearAllFiltersKeepModalOpen()}).buttonEl.addClass("clickable-icon"),new X.ButtonComponent(a).setIcon("save").setTooltip("Save current filter as view").setClass("filter-bar__save-button").onClick(()=>{this.showSaveViewDialog()}).buttonEl.addClass("clickable-icon"),new X.ButtonComponent(a).setIcon("x").setTooltip("Close filter modal").setClass("filter-bar__close-modal-button").onClick(()=>{this.closeFilterModal()}).buttonEl.addClass("clickable-icon");let d=r.createDiv("filter-bar__section-content");this.sectionStates.filters||d.addClass("filter-bar__section-content--collapsed"),this.filterBuilder=d.createDiv("filter-bar__filter-builder"),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),n.addEventListener("click",()=>{this.toggleSection("filters",i,d)})}renderFilterGroup(e,r,i,n,a){if(!r||typeof r!="object"){console.error("FilterBar: Invalid group object provided to renderFilterGroup");return}Array.isArray(r.children)||(r.children=[]);let o=e.createDiv("filter-bar__group"),l=o.createDiv("filter-bar__group-header"),c=l.createDiv("filter-bar__conjunction");(0,X.setTooltip)(c,"Choose whether ALL or ANY of the conditions must match",{placement:"top"}),new X.DropdownComponent(c).addOption("and","All").addOption("or","Any").setValue(r.conjunction||"and").onChange(h=>{r.conjunction=h,this.updateUI(),this.emitQueryChange()}),c.createSpan({text:"of the following are true:",cls:"filter-bar__conjunction-text"}),i>0&&n&&a!==void 0&&new X.ButtonComponent(l).setIcon("trash-2").setClass("filter-bar__delete-button").setTooltip("Delete filter group").onClick(()=>{this.removeFilterGroup(n,a)});let d=o.createDiv("filter-bar__children");r.children.forEach((h,p)=>{this.renderFilterNode(d,h,r,p,i+1)});let u=o.createDiv("filter-bar__group-actions");new X.ButtonComponent(u).setIcon("plus").setButtonText("Add filter").setClass("filter-bar__action-button").setClass("filter-bar__add-filter").setTooltip("Add a new filter condition").onClick(()=>{this.addFilterCondition(r)}),new X.ButtonComponent(u).setIcon("plus-circle").setButtonText("Add filter group").setClass("filter-bar__action-button").setClass("filter-bar__add-group").setTooltip("Add a nested filter group").onClick(()=>{this.addFilterGroup(r)})}renderFilterNode(e,r,i,n,a){r.type==="condition"?this.renderFilterCondition(e,r,i,n,a):r.type==="group"&&this.renderFilterGroup(e,r,a,i,n)}renderFilterCondition(e,r,i,n,a){var h;let o=e.createDiv("filter-bar__condition");o.createSpan({text:n===0?"where":i.conjunction,cls:"filter-bar__condition-prefix"});let l=Object.fromEntries([["","Select..."],...nl.map(p=>[p.id,p.label]),...((h=this.filterOptions.userProperties)==null?void 0:h.map(p=>[p.id,p.label]))||[]]),c=new X.DropdownComponent(o).addOptions(l).setValue(r.property);(0,X.setTooltip)(c.selectEl,"Choose which task property to filter by",{placement:"top"}),c.onChange(p=>{if(r.property=p,p!==""){let f=nl.find(m=>m.id===p);if(f&&f.supportedOperators.length>0){let m=f.supportedOperators[0];r.operator=m;let g=Od.find(y=>y.id===m);r.value=g!=null&&g.requiresValue?"":null}}this.updateUI(),this.emitQueryChange()});let d=new X.DropdownComponent(o);this.updateOperatorOptions(d,r.property),d.setValue(r.operator),(0,X.setTooltip)(d.selectEl,"Choose how to compare the property value",{placement:"top"}),d.onChange(p=>{r.operator=p,this.updateUI(),this.emitQueryChange()});let u=o.createDiv("filter-bar__value-container");this.renderValueInput(u,r),new X.ButtonComponent(o).setIcon("trash-2").setClass("filter-bar__delete-button").setTooltip("Delete condition").onClick(()=>{this.removeFilterCondition(i,n)})}updateOperatorOptions(e,r){var n;e.selectEl.empty();let i=nl.find(a=>a.id===r)||((n=this.filterOptions.userProperties)==null?void 0:n.find(a=>a.id===r));i&&i.supportedOperators.forEach(a=>{let o=Od.find(l=>l.id===a);o&&e.addOption(o.id,o.label)})}renderValueInput(e,r){var a;e.empty();let i=nl.find(o=>o.id===r.property)||((a=this.filterOptions.userProperties)==null?void 0:a.find(o=>o.id===r.property)),n=Od.find(o=>o.id===r.operator);if(!(!i||!n||!n.requiresValue))switch(i.valueInputType){case"text":this.renderTextInput(e,r);break;case"select":this.renderSelectInput(e,r,i);break;case"date":this.renderDateInput(e,r);break;case"number":this.renderNumberInput(e,r);break}}renderTextInput(e,r){let i=new X.TextComponent(e).setValue(String(r.value||"")).onChange(n=>{r.value=n||null,this.debouncedEmitQueryChange()});(0,X.setTooltip)(i.inputEl,"Enter the value to filter by",{placement:"top"})}renderSelectInput(e,r,i){let n=new X.DropdownComponent(e).addOption("","Select...");switch(i.id){case"status":this.filterOptions.statuses.forEach(a=>{n.addOption(a.value,a.label)});break;case"priority":this.filterOptions.priorities.forEach(a=>{n.addOption(a.value,a.label)});break;case"tags":this.filterOptions.tags.forEach(a=>{n.addOption(a,a)});break;case"contexts":this.filterOptions.contexts.forEach(a=>{n.addOption(a,a)});break;case"projects":this.filterOptions.projects.forEach(a=>{n.addOption(a,a)});break;case"path":this.filterOptions.folders.forEach(a=>{n.addOption(a,a)});break}if((0,X.setTooltip)(n.selectEl,`Select a ${i.label.toLowerCase()} to filter by`,{placement:"top"}),i.id==="projects"){let a=String(r.value||"");if(a.startsWith("[[")&&a.endsWith("]]")){let o=a.substring(2,a.length-2);n.setValue(o)}else n.setValue(a)}else if(i.id==="path"){let a=String(r.value||"");n.setValue(a===""?"(Root)":a)}else n.setValue(String(r.value||""));n.onChange(a=>{i.id==="projects"&&a?r.value=`[[${a}]]`:i.id==="path"&&a==="(Root)"?r.value="":r.value=a||null,this.emitQueryChange()})}renderDateInput(e,r){let i=e.createDiv("filter-date-input-container"),n=new X.TextComponent(i).setValue(String(r.value||"")).onChange(l=>{r.value=l||null,this.updateDateInputValidation(n,l);let c=(l||"").trim();(c===""||mf(c))&&this.debouncedEmitQueryChange()});n.setPlaceholder("today, 2024-12-25, next week..."),n.inputEl.addClass("filter-date-text-input"),(0,X.setTooltip)(n.inputEl,"Enter a date using natural language or ISO format",{placement:"top"}),this.updateDateInputValidation(n,String(r.value||""));let a=i.createEl("button",{cls:"filter-date-picker-button"});(0,X.setTooltip)(a,"Pick date & time",{placement:"top"}),(0,X.setIcon)(a,"calendar"),a.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),new yr({currentValue:String(r.value||void 0),onSelect:d=>{n.setValue(d||""),r.value=d||null,this.updateDateInputValidation(n,n.getValue()),this.debouncedEmitQueryChange()}}).showAtElement(a)});let o=i.createEl("button",{cls:"filter-date-help-button",text:"?"});(0,X.setTooltip)(o,"Show natural language date examples",{placement:"top"}),o.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),this.showNaturalLanguageDateHelp(o)})}updateDateInputValidation(e,r){let i=e.inputEl;i.removeClass("is-valid","is-invalid","is-empty");let n=r.trim();n===""?i.addClass("is-empty"):mf(n)?i.addClass("is-valid"):i.addClass("is-invalid")}showNaturalLanguageDateHelp(e){document.querySelectorAll(".filter-date-help-tooltip").forEach(l=>l.remove());let r=document.body.createDiv("filter-date-help-tooltip");r.createEl("h4",{text:"Natural Language Dates"});let i=r.createEl("ul");["today","tomorrow","yesterday","next week","last week","in 3 days","2 days ago","in 1 week","2 weeks ago","2024-12-25","2024-12-25T14:30:00"].forEach(l=>{i.createEl("li",{text:l})});let a=e.getBoundingClientRect();r.style.position="absolute",r.style.top=`${a.bottom+5}px`,r.style.left=`${a.left}px`,r.style.zIndex="1000";let o=()=>{r.remove(),document.removeEventListener("click",o)};setTimeout(()=>{document.addEventListener("click",o)},100)}renderNumberInput(e,r){let i=new X.TextComponent(e).setValue(String(r.value||"")).onChange(n=>{r.value=n?parseFloat(n):null,this.debouncedEmitQueryChange()});i.inputEl.type="number",(0,X.setTooltip)(i.inputEl,"Enter a numeric value to filter by",{placement:"top"})}renderDisplaySection(e){let r=e.createDiv("filter-bar__section"),i=r.createDiv("filter-bar__section-header"),n=i.createDiv("filter-bar__section-header-main");n.createSpan({text:"Display & Organization",cls:"filter-bar__section-title"}),(0,X.setTooltip)(n,"Click to expand/collapse sorting and grouping options",{placement:"top"});let a=r.createDiv("filter-bar__section-content");this.sectionStates.display||a.addClass("filter-bar__section-content--collapsed"),this.displaySection=a;let o=this.displaySection.createDiv("filter-bar__display-controls"),l=o.createDiv("filter-bar__sort-container");l.createSpan({text:"Sort by:",cls:"filter-bar__label"}),new X.ButtonComponent(l).setClass("filter-bar__sort-direction").setTooltip("Toggle sort direction").onClick(()=>{this.currentQuery.sortDirection=this.currentQuery.sortDirection==="asc"?"desc":"asc",this.emitImmediateQueryChange()});let d={...{due:"Due Date",scheduled:"Scheduled Date",priority:"Priority",title:"Title",dateCreated:"Created Date",tags:"Tags"}},u=this.filterOptions.userProperties||[];for(let w of u)!(w!=null&&w.id)||!(w!=null&&w.label)||typeof w.id=="string"&&w.id.startsWith("user:")&&(d[w.id]=`${w.label}`);let h=new X.DropdownComponent(l).addOptions(d).setValue(this.currentQuery.sortKey||"due").onChange(w=>{this.currentQuery.sortKey=w,this.emitImmediateQueryChange()});(0,X.setTooltip)(h.selectEl,"Choose how to sort tasks",{placement:"top"});let p=o.createDiv("filter-bar__group-container");p.createSpan({text:"Group by:",cls:"filter-bar__label"});let m={...{none:"None",status:"Status",priority:"Priority",context:"Context",project:"Project",due:"Due Date",scheduled:"Scheduled Date",tags:"Tags"}},g=this.filterOptions.userProperties||[];for(let w of g)!(w!=null&&w.id)||!(w!=null&&w.label)||typeof w.id=="string"&&w.id.startsWith("user:")&&(m[w.id]=w.label);let y=new X.DropdownComponent(p).addOptions(m).setValue(this.currentQuery.groupKey||"none").onChange(w=>{this.currentQuery.groupKey=w,this.updateExpandCollapseButtons(),this.updateDisplaySection(),this.updateFilterToggleBadge(),this.emitQueryChange()});(0,X.setTooltip)(y.selectEl,"Group tasks by a common property",{placement:"top"}),n.addEventListener("click",()=>{this.toggleSection("display",i,a)})}removeFilterGroup(e,r){e.children.splice(r,1),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete(),this.emitQueryChange()}renderViewOptions(e){let r=e.createDiv("filter-bar__section");this.viewOptionsContainer=r.createDiv("filter-bar__view-options-container"),this.populateViewOptions()}setViewOptions(e){this.viewOptionsConfig=e,this.populateViewOptions()}populateViewOptions(){if(!this.viewOptionsContainer)return;this.viewOptionsContainer.empty();let e=this.viewOptionsConfig;if(!e||e.length===0){this.viewOptionsContainer.addClass("filter-bar__section--hidden");return}this.viewOptionsContainer.removeClass("filter-bar__section--hidden");let r=this.viewOptionsContainer.createDiv("filter-bar__section-header"),i=r.createDiv("filter-bar__section-header-main");i.createSpan({text:"View Options",cls:"filter-bar__section-title"}),(0,X.setTooltip)(i,"Click to expand/collapse view-specific options",{placement:"top"});let n=this.viewOptionsContainer.createDiv("filter-bar__section-content");this.sectionStates.viewOptions||n.addClass("filter-bar__section-content--collapsed"),e.forEach(a=>{let l=n.createDiv("filter-bar__view-option").createEl("label",{cls:"filter-bar__view-option-label"}),c=l.createEl("input",{type:"checkbox",cls:"filter-bar__view-option-checkbox"});c.checked=a.value,(0,X.setTooltip)(c,`Toggle ${a.label.toLowerCase()}`,{placement:"top"}),l.createSpan({text:a.label,cls:"filter-bar__view-option-text"}),c.addEventListener("change",()=>{a.onChange(c.checked)})}),i.addEventListener("click",()=>{this.toggleSection("viewOptions",r,n)})}addFilterCondition(e){let r={type:"condition",id:we.generateId(),property:"",operator:"contains",value:""};e.children.push(r),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete()}addFilterGroup(e){let r={type:"group",id:we.generateId(),conjunction:"and",children:[]};e.children.push(r),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete()}removeFilterCondition(e,r){e.children.splice(r,1),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete(),this.emitQueryChange()}updateViewSelectorButtonState(){var e;(e=this.viewSelectorButton)!=null&&e.buttonEl&&(this.activeSavedView?this.viewSelectorButton.buttonEl.classList.add("filter-bar__templates-button--saved-view-active"):this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--saved-view-active"))}toggleViewSelectorDropdown(){if(!this.viewSelectorDropdown||!this.viewSelectorButton)return;let e=this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden");this.viewSelectorDropdown.classList.toggle("filter-bar__view-selector-dropdown--hidden",!e),e?this.viewSelectorButton.buttonEl.classList.add("filter-bar__templates-button--active"):this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active")}showSortGroupContextMenu(e){try{let r=new X.Menu,n={...{due:"Due Date",scheduled:"Scheduled Date",priority:"Priority",title:"Title",dateCreated:"Created Date",tags:"Tags"}},a=this.filterOptions.userProperties||[];for(let o of a)!(o!=null&&o.id)||!(o!=null&&o.label)||typeof o.id=="string"&&o.id.startsWith("user:")&&(n[o.id]=`${o.label}`);if(r.addItem(o=>{o.setTitle("SORT"),o.setDisabled(!0)}),Object.entries(n).forEach(([o,l])=>{r.addItem(c=>{c.setTitle(l),this.currentQuery.sortKey===o&&c.setIcon("check"),c.onClick(()=>{this.currentQuery.sortKey=o,this.emitImmediateQueryChange(),this.updateDisplaySection()})})}),r.addSeparator(),r.addItem(o=>{o.setTitle("ORDER"),o.setDisabled(!0)}),r.addItem(o=>{o.setTitle("Ascending"),this.currentQuery.sortDirection==="asc"&&o.setIcon("check"),o.onClick(()=>{this.currentQuery.sortDirection="asc",this.emitImmediateQueryChange(),this.updateDisplaySection()})}),r.addItem(o=>{o.setTitle("Descending"),this.currentQuery.sortDirection==="desc"&&o.setIcon("check"),o.onClick(()=>{this.currentQuery.sortDirection="desc",this.emitImmediateQueryChange(),this.updateDisplaySection()})}),this.viewType!=="agenda"){let l={...{none:"None",status:"Status",priority:"Priority",context:"Context",project:"Project",due:"Due Date",scheduled:"Scheduled Date",tags:"Tags"}},c=this.filterOptions.userProperties||[];for(let d of c)!(d!=null&&d.id)||!(d!=null&&d.label)||typeof d.id=="string"&&d.id.startsWith("user:")&&(l[d.id]=d.label);r.addSeparator(),r.addItem(d=>{d.setTitle("GROUP"),d.setDisabled(!0)}),Object.entries(l).forEach(([d,u])=>{r.addItem(h=>{h.setTitle(u),this.currentQuery.groupKey===d&&h.setIcon("check"),h.onClick(()=>{this.currentQuery.groupKey=d,this.updateExpandCollapseButtons(),this.updateDisplaySection(),this.updateFilterToggleBadge(),this.emitQueryChange()})})})}r.showAtMouseEvent(e)}catch(r){console.error("FilterBar: Error showing sort/group context menu:",r)}}createNewTask(){try{this.plugin&&typeof this.plugin.openTaskCreationModal=="function"?this.plugin.openTaskCreationModal():this.plugin&&typeof this.plugin.createTask=="function"?this.plugin.createTask():this.emit("createNewTask")}catch(e){console.error("FilterBar: Error creating new task:",e)}}showPropertiesDropdown(e){try{new Ph(this.getCurrentVisibleProperties(),this.plugin,this.handlePropertiesUpdate.bind(this)).show(e)}catch(r){console.error("FilterBar: Error showing properties dropdown:",r),this.plugin.app.workspace.trigger("notice","Failed to show properties menu")}}handlePropertiesUpdate(e){if(!Array.isArray(e)){console.warn("FilterBar: Invalid properties array received:",e);return}this.temporaryVisibleProperties=e,this.emit("propertiesChanged",e)}getCurrentVisibleProperties(){var e;return this.temporaryVisibleProperties||((e=this.activeSavedView)==null?void 0:e.visibleProperties)||this.plugin.settings.defaultVisibleProperties||this.getDefaultFallbackProperties()}getDefaultFallbackProperties(){return["status","priority","due","scheduled","projects","contexts","tags"]}getCurrentSavedView(){return this.activeSavedView}setActiveSavedView(e){if(this.isSettingSavedView=!0,this.activeSavedView=e,e&&this.temporaryVisibleProperties&&e.visibleProperties){let r=new Set(this.temporaryVisibleProperties),i=new Set(e.visibleProperties);r.size===i.size&&[...r].every(n=>i.has(n))&&(this.temporaryVisibleProperties=null)}this.updateViewSelectorButtonState(),this.emit("activeSavedViewChanged",e),this.isSettingSavedView=!1}toggleSection(e,r,i){this.sectionStates[e]=!this.sectionStates[e];let n=this.sectionStates[e];r.classList.toggle("filter-bar__section-header--collapsed",!n),i.classList.toggle("filter-bar__section-content--collapsed",!n)}showSaveViewDialog(){new _y(this.app,e=>{let r=this.getCurrentViewOptions(),i=this.getCurrentVisibleProperties();this.emit("saveView",{name:e,query:this.currentQuery,viewOptions:r,visibleProperties:i}),this.toggleViewSelectorDropdown()}).open()}getCurrentViewOptions(){if(!this.viewOptionsConfig||this.viewOptionsConfig.length===0)return;let e={};return this.viewOptionsConfig.forEach(r=>{e[r.id]=r.value}),e}clearAllFilters(){var e;this.currentQuery={type:"group",id:we.generateId(),conjunction:"and",children:[],sortKey:this.currentQuery.sortKey||"due",sortDirection:this.currentQuery.sortDirection||"asc",groupKey:"none"},this.activeSavedView=null,this.temporaryVisibleProperties=null,this.searchInput&&this.searchInput.setValue(""),this.updateFilterBuilder(),this.updateDisplaySection(),this.updateViewSelectorButtonState(),this.emitQueryChange(),this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(e=this.viewSelectorButton)!=null&&e.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}clearAllFiltersKeepModalOpen(){var e;this.currentQuery={type:"group",id:we.generateId(),conjunction:"and",children:[],sortKey:this.currentQuery.sortKey||"due",sortDirection:this.currentQuery.sortDirection||"asc",groupKey:"none"},this.activeSavedView=null,this.temporaryVisibleProperties=null,this.searchInput&&this.searchInput.setValue(""),this.updateFilterBuilder(),this.updateDisplaySection(),this.updateViewSelectorButtonState(),this.updateFilterToggleBadge(),setTimeout(()=>{this.emitQueryChangeIfComplete()},100),this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(e=this.viewSelectorButton)!=null&&e.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}closeFilterModal(){this.sectionStates.filterBox=!1,this.updateFilterBoxState()}loadSavedView(e){this.isLoadingSavedView=!0,this.currentQuery=we.deepCloneFilterQuery(e.query),this.activeSavedView=e,this.temporaryVisibleProperties=null,this.render(),this.emitQueryChange(),e.viewOptions&&this.emit("loadViewOptions",e.viewOptions),e.visibleProperties&&this.emit("propertiesChanged",e.visibleProperties),this.emit("activeSavedViewChanged",e),this.toggleViewSelectorDropdown(),this.updateViewSelectorButtonState(),this.isLoadingSavedView=!1}updateUI(){this.syncSearchInput(),this.render(),this.updateViewSelectorButtonState(),this.updateFilterToggleBadge()}updateDisplaySection(){try{this.updateExpandCollapseButtons()}catch(e){console.error("Error updating display section:",e)}}updateExpandCollapseButtons(){try{let e=(this.currentQuery.groupKey||"none")!=="none",r=this.enableGroupExpandCollapse&&(e||this.forceShowExpandCollapse),i=this.container.querySelector(".filter-bar__expand-groups"),n=this.container.querySelector(".filter-bar__collapse-groups");i&&(i.style.display=r?"":"none"),n&&(n.style.display=r?"":"none")}catch(e){console.error("Error updating expand/collapse buttons:",e)}}updateFilterBuilder(){var e,r;try{if(this.filterBuilder&&this.filterBuilder.isConnected){let i=(e=this.searchInput)==null?void 0:e.getValue(),n=((r=this.searchInput)==null?void 0:r.inputEl)===document.activeElement;this.filterBuilder.empty(),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),this.searchInput&&i!==void 0&&(this.searchInput.setValue(i),n&&this.searchInput.inputEl.focus()),this.updateFilterBoxState()}}catch(i){console.error("Error updating filter builder:",i)}}updateFilterBuilderComplete(){var e,r;try{if(this.filterBuilder&&this.filterBuilder.isConnected){let i=(e=this.searchInput)==null?void 0:e.getValue(),n=((r=this.searchInput)==null?void 0:r.inputEl)===document.activeElement;this.filterBuilder.empty(),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),this.searchInput&&i!==void 0&&(this.searchInput.setValue(i),n&&this.searchInput.inputEl.focus()),this.updateFilterBoxState()}}catch(i){console.error("Error updating filter builder completely:",i),this.render()}}syncSearchInput(){if(!this.searchInput||this.isUserTyping)return;if(!this.currentQuery||!Array.isArray(this.currentQuery.children)){this.searchInput.setValue("");return}let e=this.currentQuery.children.find(r=>r.type==="condition"&&r.property==="title"&&r.operator==="contains"&&r.id.startsWith("search_"));this.searchInput.setValue(String((e==null?void 0:e.value)||""))}emitQueryChange(){!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.updateFilterToggleBadge(),this.emitQueryChangeIfComplete()}emitImmediateQueryChange(){!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.updateFilterToggleBadge(),this.emit("queryChange",we.deepCloneFilterQuery(this.currentQuery))}emitQueryChangeIfComplete(){this.isQueryMeaningful(this.currentQuery)&&this.emit("queryChange",we.deepCloneFilterQuery(this.currentQuery))}isQueryMeaningful(e){return e.children.length===0?!0:this.hasCompleteConditions(e)}hasCompleteConditions(e){for(let r of e.children)if(r.type==="condition"){if(we.isFilterNodeComplete(r))return!0}else if(r.type==="group"&&this.hasCompleteConditions(r))return!0;return!1}updateFilterOptions(e){this.filterOptions=e,this.updateUI()}hasActiveFilters(){var e;try{if(this.activeSavedView)return!0;let r=this.isQueryMeaningful(this.currentQuery)&&this.currentQuery.children.length>0,i=((e=this.currentQuery.groupKey)!=null?e:"none")!=="none";return r||!!i}catch(r){return!1}}updateFilterToggleBadge(){let e=this.container.querySelector(".filter-bar__filter-toggle");if(!e)return;let r=this.hasActiveFilters();e.classList.toggle("has-active-filters",r),(0,X.setTooltip)(e,r?"Active filters \u2013 Click to modify, right-click to clear":"Toggle filter",{placement:"top"})}getCurrentFilterOptions(){return this.filterOptions}async forceRefreshOptions(e){let r=await e.getFilterOptions();this.updateFilterOptions(r)}destroy(){try{this.container&&this.container.isConnected&&this.container.empty(),this.removeAllListeners(),this.abortController&&(this.abortController.abort(),this.abortController=void 0),this.ignoreClickTimeout&&(window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=void 0)}catch(e){console.error("Error destroying FilterBar:",e);try{this.removeAllListeners(),this.abortController&&(this.abortController.abort(),this.abortController=void 0),this.ignoreClickTimeout&&(window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=void 0)}catch(r){console.error("Error during FilterBar cleanup fallback:",r)}}}};Se();ht();var Nh=class extends Me.ItemView{constructor(e,r){super(e);this.calendar=null;this.listeners=[];this.functionListeners=[];this.resizeObserver=null;this.resizeTimeout=null;this.filterBar=null;this.pendingRecurringUpdate=!1;this.headerCollapsed=!0;this.plugin=r,this.showScheduled=this.plugin.settings.calendarViewSettings.defaultShowScheduled,this.showDue=this.plugin.settings.calendarViewSettings.defaultShowDue,this.showTimeEntries=this.plugin.settings.calendarViewSettings.defaultShowTimeEntries,this.showRecurring=this.plugin.settings.calendarViewSettings.defaultShowRecurring,this.showICSEvents=this.plugin.settings.calendarViewSettings.defaultShowICSEvents,this.showTimeblocks=this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.showAllDaySlot=!0,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"}}getViewType(){return Xi}getDisplayText(){return"Advanced Calendar"}getIcon(){return"calendar-range"}async onOpen(){var n,a,o,l;await this.plugin.onReady(),await this.plugin.waitForMigration();let e=this.plugin.viewStateManager.getFilterState(Xi);e?this.currentQuery=e:this.plugin.filterService&&(this.currentQuery=this.plugin.filterService.createDefaultQuery());let r=this.plugin.viewStateManager.getViewPreferences(Xi);r&&(this.showScheduled=r.showScheduled,this.showDue=r.showDue,this.showTimeEntries=r.showTimeEntries,this.showRecurring=r.showRecurring,this.showICSEvents=(n=r.showICSEvents)!=null?n:this.plugin.settings.calendarViewSettings.defaultShowICSEvents,this.showTimeblocks=(a=r.showTimeblocks)!=null?a:this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.headerCollapsed=(o=r.headerCollapsed)!=null?o:!0,this.showAllDaySlot=(l=r.showAllDaySlot)!=null?l:!0);let i=async()=>{let c=this.contentEl;c.empty(),c.addClass("tasknotes-plugin"),c.addClass("advanced-calendar-view"),await this.renderView(),this.registerEvents(),await this.initializeCalendar()};await i(),this.contentEl.onWindowMigrated(i)}async renderView(){let{contentEl:e}=this;e.empty();let r=e.createDiv({cls:"advanced-calendar-view__container"});await this.createHeader(r),r.createDiv({cls:"advanced-calendar-view__calendar-container",attr:{id:"advanced-calendar"}})}async createHeader(e){let r=e.createDiv({cls:"advanced-calendar-view__header"}),n=r.createDiv({cls:"advanced-calendar-view__mobile-toggle"}).createEl("button",{text:this.headerCollapsed?"Show filters":"Hide filters",cls:"advanced-calendar-view__collapse-btn"});n.addEventListener("click",()=>{this.headerCollapsed=!this.headerCollapsed,n.textContent=this.headerCollapsed?"Show filters":"Hide filters",this.saveViewPreferences(),this.updateHeaderVisibility()});let o=r.createDiv({cls:`advanced-calendar-view__main-row ${this.headerCollapsed?"collapsed":"expanded"}`}).createDiv({cls:"filter-bar-container"});await this.waitForCacheReady();let l=await this.plugin.filterService.getFilterOptions();this.filterBar=new ri(this.app,this.plugin,o,this.currentQuery,l,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"advanced-calendar"});let c=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(c),this.filterBar.on("saveView",({name:d,query:u,viewOptions:h,visibleProperties:p})=>{let f=this.plugin.viewStateManager.saveView(d,u,h,p);this.filterBar.setActiveSavedView(f)}),this.filterBar.on("deleteView",d=>{this.plugin.viewStateManager.deleteView(d)}),this.filterBar.on("loadViewOptions",d=>{this.applyViewOptions(d)}),this.plugin.viewStateManager.on("saved-views-changed",d=>{var u;(u=this.filterBar)==null||u.updateSavedViews(d)}),this.filterBar.on("reorderViews",(d,u)=>{this.plugin.viewStateManager.reorderSavedViews(d,u)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async d=>{this.currentQuery=d,await this.plugin.viewStateManager.setFilterState(Xi,d),this.refreshEvents()}),this.setupViewOptions()}updateHeaderVisibility(){let e=this.contentEl.querySelector(".advanced-calendar-view__main-row");e&&(e.className=`advanced-calendar-view__main-row ${this.headerCollapsed?"collapsed":"expanded"}`),this.calendar&&this.calendar.setOption("headerToolbar",this.getHeaderToolbarConfig())}setupViewOptions(){if(!this.filterBar)return;let e=[{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents,onChange:r=>{this.showICSEvents=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"timeEntries",label:"Time entries",value:this.showTimeEntries,onChange:r=>{this.showTimeEntries=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"timeblocks",label:"Timeblocks",value:this.showTimeblocks,onChange:r=>{this.showTimeblocks=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"scheduled",label:"Scheduled dates",value:this.showScheduled,onChange:r=>{this.showScheduled=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"due",label:"Due dates",value:this.showDue,onChange:r=>{this.showDue=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"allDaySlot",label:"All-day slot",value:this.showAllDaySlot,onChange:r=>{this.showAllDaySlot=r,this.saveViewPreferences(),this.calendar&&this.calendar.setOption("allDaySlot",r)}}];if(!this.plugin.settings.calendarViewSettings.enableTimeblocking){let r=e.findIndex(i=>i.id==="timeblocks");r!==-1&&e.splice(r,1)}this.filterBar.setViewOptions(e)}getViewOptionsConfig(){let e=[{id:"scheduled",label:"Scheduled tasks",value:this.showScheduled},{id:"due",label:"Due dates",value:this.showDue},{id:"timeEntries",label:"Time entries",value:this.showTimeEntries},{id:"recurring",label:"Recurring tasks",value:this.showRecurring},{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents}];return this.plugin.settings.calendarViewSettings.enableTimeblocking&&e.push({id:"timeblocks",label:"Timeblocks",value:this.showTimeblocks}),e}onViewOptionChange(e,r){switch(e){case"scheduled":this.showScheduled=r;break;case"due":this.showDue=r;break;case"timeEntries":this.showTimeEntries=r;break;case"recurring":this.showRecurring=r;break;case"icsEvents":this.showICSEvents=r;break;case"timeblocks":this.showTimeblocks=r;break;case"allDaySlot":this.showAllDaySlot=r,this.calendar&&this.calendar.setOption("allDaySlot",r);break}this.saveViewPreferences(),this.refreshEvents(),this.setupViewOptions()}getHeaderToolbarConfig(){let e=this.contentEl.ownerDocument.defaultView||window;if(this.headerCollapsed&&e.innerWidth<=768)return!1;let r=this.contentEl.querySelector(".advanced-calendar-view__calendar-container"),a={left:"prev,next today",center:(r?r.getBoundingClientRect().width:e.innerWidth)<=600?"":"title",right:"refreshICS multiMonthYear,dayGridMonth,timeGridWeek,timeGridCustom,timeGridDay"};return console.log("Header toolbar config:",a),a}getCustomButtons(){let e={refreshICS:{text:"Refresh",hint:"Refresh Calendar Subscriptions",click:()=>{console.log("Refresh ICS button clicked!"),this.handleRefreshClick()}}};return console.log("Custom buttons:",e),e}async handleRefreshClick(){if(!this.plugin.icsSubscriptionService){new Me.Notice("ICS subscription service not available");return}try{await this.plugin.icsSubscriptionService.refreshAllSubscriptions(),new Me.Notice("All calendar subscriptions refreshed successfully"),this.refreshEvents()}catch(e){console.error("Error refreshing subscriptions:",e),new Me.Notice("Failed to refresh some calendar subscriptions")}}openScheduleTasksModal(){new Mh(this.app,this.plugin,(r,i)=>{r&&this.scheduleTask(r,i)}).open()}async scheduleTask(e,r){try{let i;if(r!=null&&r.date)r.allDay?i=C(r.date,"yyyy-MM-dd"):r.time?i=C(r.date,"yyyy-MM-dd")+"T"+r.time:i=C(r.date,"yyyy-MM-dd")+"T09:00";else{let n=Ue();i=C(n,"yyyy-MM-dd")+"T09:00"}await this.plugin.taskService.updateProperty(e,"scheduled",i)}catch(i){console.error("Error scheduling task:",i)}}async initializeCalendar(){let e=this.contentEl.querySelector("#advanced-calendar");if(!e){console.error("Calendar element not found");return}let r=this.plugin.settings.calendarViewSettings;this.updateTodayHighlight();let i=this.getCustomButtons(),n=this.getHeaderToolbarConfig();console.log("Initializing calendar with customButtons:",i),console.log("Initializing calendar with headerToolbar:",n),this.calendar=new Zu(e,{plugins:[ix,dx,ux,fx],initialView:r.defaultView,headerToolbar:n,customButtons:i,views:{timeGridCustom:{type:"timeGrid",duration:{days:r.customDayCount||3},buttonText:`${r.customDayCount||3} days`}},height:"100%",editable:!0,droppable:!0,selectable:!0,selectMirror:r.selectMirror,locale:this.getUserLocale(),firstDay:r.firstDay,weekNumbers:r.weekNumbers,weekends:r.showWeekends,nowIndicator:r.nowIndicator,navLinks:!0,navLinkDayClick:this.handleDateTitleClick.bind(this),slotMinTime:r.slotMinTime,slotMaxTime:r.slotMaxTime,scrollTime:r.scrollTime,slotDuration:r.slotDuration,slotLabelInterval:this.getSlotLabelInterval(r.slotDuration),allDaySlot:this.showAllDaySlot,eventTimeFormat:this.getTimeFormat(r.timeFormat),slotLabelFormat:this.getTimeFormat(r.timeFormat),select:this.handleDateSelect.bind(this),eventClick:this.handleEventClick.bind(this),eventDrop:this.handleEventDrop.bind(this),eventAllow:a=>!0,eventResize:this.handleEventResize.bind(this),drop:this.handleExternalDrop.bind(this),eventReceive:this.handleEventReceive.bind(this),eventDidMount:this.handleEventDidMount.bind(this),events:this.getCalendarEvents.bind(this)}),requestAnimationFrame(()=>{this.calendar&&(this.calendar.render(),this.setupResizeHandling(),this.refreshEvents())})}saveViewPreferences(){let e={showScheduled:this.showScheduled,showDue:this.showDue,showTimeEntries:this.showTimeEntries,showRecurring:this.showRecurring,showICSEvents:this.showICSEvents,showTimeblocks:this.showTimeblocks,headerCollapsed:this.headerCollapsed,showAllDaySlot:this.showAllDaySlot};this.plugin.viewStateManager.setViewPreferences(Xi,e)}applyViewOptions(e){e.hasOwnProperty("showScheduled")&&(this.showScheduled=e.showScheduled),e.hasOwnProperty("showDue")&&(this.showDue=e.showDue),e.hasOwnProperty("showTimeEntries")&&(this.showTimeEntries=e.showTimeEntries),e.hasOwnProperty("showRecurring")&&(this.showRecurring=e.showRecurring),e.hasOwnProperty("showICSEvents")&&(this.showICSEvents=e.showICSEvents),e.hasOwnProperty("showTimeblocks")&&(this.showTimeblocks=e.showTimeblocks),e.hasOwnProperty("showAllDaySlot")&&(this.showAllDaySlot=e.showAllDaySlot,this.calendar&&this.calendar.setOption("allDaySlot",this.showAllDaySlot)),this.setupViewOptions(),this.refreshEvents()}setupResizeHandling(){if(!this.calendar)return;this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.functionListeners.forEach(a=>a()),this.functionListeners=[];let e=this.contentEl.ownerDocument.defaultView||window,r=()=>{this.resizeTimeout&&e.clearTimeout(this.resizeTimeout),this.resizeTimeout=e.setTimeout(()=>{this.calendar&&(this.calendar.updateSize(),this.updateHeaderVisibility())},150)};if(e.ResizeObserver){this.resizeObserver=new e.ResizeObserver(r);let a=this.contentEl.querySelector(".advanced-calendar-view__calendar-container");a&&this.resizeObserver.observe(a)}let i=this.plugin.app.workspace.on("layout-change",r);this.listeners.push(i),e.addEventListener("resize",r),this.functionListeners.push(()=>e.removeEventListener("resize",r));let n=this.plugin.app.workspace.on("active-leaf-change",a=>{a===this.leaf&&setTimeout(r,100)});this.listeners.push(n)}getSlotLabelInterval(e){switch(e){case"00:15:00":return"01:00:00";case"00:30:00":return"01:00:00";case"01:00:00":return"01:00:00";default:return"01:00:00"}}getUserLocale(){let e=this.plugin.settings.calendarViewSettings.locale;if(e&&e.trim()!=="")return e.trim();if(navigator.language)return navigator.language;if(navigator.languages&&navigator.languages.length>0)return navigator.languages[0];let r=navigator.userLanguage||navigator.browserLanguage;return r||"en"}getTimeFormat(e){return e==="12"?{hour:"numeric",minute:"2-digit",omitZeroMinute:!0,hour12:!0}:{hour:"2-digit",minute:"2-digit",hour12:!1}}async getCalendarEvents(){var r;let e=[];try{let i=await this.plugin.filterService.getGroupedTasks(this.currentQuery),n=[];for(let h of i.values())n.push(...h);let a=(r=this.calendar)==null?void 0:r.view,o=Ue(),l=(a==null?void 0:a.activeStart)||Ot(o),c=(a==null?void 0:a.activeEnd)||cw(o),{utcStart:d,utcEnd:u}=OS(l,c);for(let h of n){if(h.recurrence){if(!h.scheduled)continue;if(this.showRecurring){let p=this.generateRecurringTaskInstances(h,d,u);e.push(...p)}}else{let p=!!h.scheduled,f=!!h.due;if(!p&&!f)continue;if(this.showScheduled&&p){let m=this.createScheduledEvent(h);m&&e.push(m)}if(this.showDue&&f){let m=this.createDueEvent(h);m&&e.push(m)}}if(this.showTimeEntries&&h.timeEntries){let p=this.createTimeEntryEvents(h);e.push(...p)}}if(this.showICSEvents&&this.plugin.icsSubscriptionService){let h=this.plugin.icsSubscriptionService.getAllEvents();for(let p of h){let f=this.createICSEvent(p);f&&e.push(f)}}}catch(i){console.error("Error getting calendar events:",i)}if(this.showTimeblocks&&this.plugin.settings.calendarViewSettings.enableTimeblocking)try{let i=await this.getTimeblockEvents();e.push(...i)}catch(i){console.error("Error getting timeblock events:",i)}return e}createScheduledEvent(e){if(!e.scheduled)return null;let r=ft(e.scheduled),i=e.scheduled,n;if(r&&e.timeEstimate){let c=_t(i),d=new Date(c.getTime()+e.timeEstimate*60*1e3);n=C(d,"yyyy-MM-dd'T'HH:mm")}let a=this.plugin.priorityManager.getPriorityConfig(e.priority),o=(a==null?void 0:a.color)||"var(--color-accent)",l=this.plugin.statusManager.isCompletedStatus(e.status);return{id:`scheduled-${e.path}`,title:e.title,start:i,end:n,allDay:!r,backgroundColor:"transparent",borderColor:o,textColor:o,editable:!0,extendedProps:{taskInfo:e,eventType:"scheduled",isCompleted:l}}}createDueEvent(e){if(!e.due)return null;let r=ft(e.due),i=e.due,n;if(r){let d=_t(i),u=new Date(d.getTime()+1800*1e3);n=C(u,"yyyy-MM-dd'T'HH:mm")}let a=this.plugin.priorityManager.getPriorityConfig(e.priority),o=(a==null?void 0:a.color)||"var(--color-orange)",l=this.hexToRgba(o,.15),c=this.plugin.statusManager.isCompletedStatus(e.status);return{id:`due-${e.path}`,title:`DUE: ${e.title}`,start:i,end:n,allDay:!r,backgroundColor:l,borderColor:o,textColor:o,editable:!1,extendedProps:{taskInfo:e,eventType:"due",isCompleted:c}}}hexToRgba(e,r){e=e.replace("#","");let i=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),a=parseInt(e.substring(4,6),16);return`rgba(${i}, ${n}, ${a}, ${r})`}createTimeEntryEvents(e){if(!e.timeEntries)return[];let r=this.plugin.statusManager.isCompletedStatus(e.status);return e.timeEntries.filter(i=>i.endTime).map((i,n)=>({id:`timeentry-${e.path}-${n}`,title:e.title,start:i.startTime,end:i.endTime,allDay:!1,backgroundColor:"var(--color-base-50)",borderColor:"var(--color-base-40)",textColor:"var(--text-on-accent)",editable:!1,extendedProps:{taskInfo:e,eventType:"timeEntry",isCompleted:r,timeEntryIndex:n}}))}createICSEvent(e){try{let r=this.plugin.icsSubscriptionService.getSubscriptions().find(a=>a.id===e.subscriptionId);if(!r||!r.enabled)return null;let i=this.hexToRgba(r.color,.2),n=r.color;return{id:e.id,title:e.title,start:e.start,end:e.end,allDay:e.allDay,backgroundColor:i,borderColor:n,textColor:n,editable:!1,extendedProps:{icsEvent:e,eventType:"ics",subscriptionName:r.name}}}catch(r){return console.error("Error creating ICS event:",r),null}}generateRecurringTaskInstances(e,r,i){if(!e.recurrence||!e.scheduled)return[];let n=[],a=ft(e.scheduled),o=this.getRecurringTime(e),l=ue(e.scheduled),c=a?jt(e.scheduled):null,d=c?`${l}T${c}`:l,u=this.createNextScheduledEvent(e,d,l,c||"09:00");u&&n.push(u);let h=wl(e,r,i);for(let p of h){let f=ae(p);if(f===l)continue;let m=a?`${f}T${o}`:f,g=this.createRecurringEvent(e,m,f,o);g&&n.push(g)}return n}getRecurringTime(e){if(e.recurrence&&typeof e.recurrence=="string"){let r=e.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(r&&r[1].includes("T")){let i=r[1].split("T")[1];if(i.length>=4){let n=i.slice(0,2),a=i.slice(2,4);return`${n}:${a}`}}}if(e.scheduled){let r=jt(e.scheduled);if(r)return r}return"09:00"}createNextScheduledEvent(e,r,i,n){var h;let a=ft(r),o;if(a&&e.timeEstimate){let p=_t(r),f=new Date(p.getTime()+e.timeEstimate*60*1e3);o=C(f,"yyyy-MM-dd'T'HH:mm")}let l=this.plugin.priorityManager.getPriorityConfig(e.priority),c=(l==null?void 0:l.color)||"var(--color-accent)",d=((h=e.complete_instances)==null?void 0:h.includes(i))||!1,u=d?"rgba(0,0,0,0.3)":"transparent";return{id:`next-scheduled-${e.path}-${i}`,title:e.title,start:r,end:o,allDay:!a,backgroundColor:u,borderColor:c,textColor:c,editable:!0,extendedProps:{taskInfo:e,eventType:"scheduled",isCompleted:d,isNextScheduledOccurrence:!0,instanceDate:i,recurringTemplateTime:n}}}createRecurringEvent(e,r,i,n){var h;let a=ft(r),o;if(a&&e.timeEstimate){let p=_t(r),f=new Date(p.getTime()+e.timeEstimate*60*1e3);o=C(f,"yyyy-MM-dd'T'HH:mm")}let l=this.plugin.priorityManager.getPriorityConfig(e.priority),c=(l==null?void 0:l.color)||"var(--color-accent)",d=((h=e.complete_instances)==null?void 0:h.includes(i))||!1,u=d?"rgba(0,0,0,0.3)":"transparent";return{id:`recurring-${e.path}-${i}`,title:e.title,start:r,end:o,allDay:!a,backgroundColor:u,borderColor:c,textColor:c,editable:!0,extendedProps:{taskInfo:e,eventType:"recurring",isCompleted:d,isRecurringInstance:!0,isPatternInstance:!0,instanceDate:i,recurringTemplateTime:n}}}handleDateSelect(e){var l;let{start:r,end:i,allDay:n,jsEvent:a}=e;this.plugin.settings.calendarViewSettings.enableTimeblocking&&this.showTimeblocks&&a&&a.shiftKey?this.handleTimeblockCreation(r,i,n):this.handleTaskCreation(r,i,n),(l=this.calendar)==null||l.unselect()}parseSlotDurationToMinutes(e){let r=e.split(":"),i=parseInt(r[0],10),n=parseInt(r[1],10);return i*60+n}handleTaskCreation(e,r,i){let n=i?C(e,"yyyy-MM-dd"):C(e,"yyyy-MM-dd'T'HH:mm"),a=Math.round((r.getTime()-e.getTime())/(1e3*60)),o=this.plugin.settings.calendarViewSettings.slotDuration,l=this.parseSlotDurationToMinutes(o),c=!i&&a>l,d={scheduled:n};i||c&&(d.timeEstimate=a),new ca(this.app,this.plugin,{prePopulatedValues:d}).open()}handleTimeblockCreation(e,r,i){if(i){new Me.Notice("Timeblocks must have specific times. Please select a time range in week or day view.");return}let n=C(e,"yyyy-MM-dd"),a=C(e,"HH:mm"),o=C(r,"HH:mm");new _h(this.app,this.plugin,{date:n,startTime:a,endTime:o}).open()}async handleDateTitleClick(e){try{if(!(0,ki.appHasDailyNotesPluginLoaded)()){new Me.Notice("Daily Notes core plugin is not enabled. Please enable it in Settings > Core plugins.");return}let r=window.moment(e),i=(0,ki.getAllDailyNotes)(),n=(0,ki.getDailyNote)(r,i);if(!n)try{n=await(0,ki.createDailyNote)(r)}catch(a){let o=a instanceof Error?a.message:String(a);console.error("Failed to create daily note:",a),new Me.Notice(`Failed to create daily note: ${o}`);return}n&&await this.app.workspace.getLeaf(!1).openFile(n)}catch(r){let i=r instanceof Error?r.message:String(r);console.error("Failed to navigate to daily note:",r),new Me.Notice(`Failed to navigate to daily note: ${i}`)}}async getTimeblockEvents(){var r;let e=[];try{if(!(0,ki.appHasDailyNotesPluginLoaded)())return e;let i=(r=this.calendar)==null?void 0:r.view;if(!i)return e;let n=i.activeStart,a=i.activeEnd,o=(0,ki.getAllDailyNotes)(),l=ae(n),c=ae(a),d=new Date(`${l}T00:00:00.000Z`),u=new Date(`${c}T00:00:00.000Z`);for(let h=new Date(d);h<=u;h.setUTCDate(h.getUTCDate()+1)){let p=ae(h),f=new Date(`${p}T12:00:00`),m=window.moment(f),g=(0,ki.getDailyNote)(m,o);if(g)try{let y=await this.app.vault.read(g),w=Of(y,g.path);for(let T of w){let S=LE(T,p);e.push(S)}}catch(y){console.error(`Error reading daily note ${g.path}:`,y)}}}catch(i){console.error("Error getting timeblock events:",i)}return e}handleEventClick(e){let{taskInfo:r,icsEvent:i,timeblock:n,eventType:a,subscriptionName:o}=e.event.extendedProps,l=e.jsEvent;if(a==="timeEntry"){r&&l.button===0&&!l.ctrlKey&&!l.metaKey&&new hn(this.app,this.plugin,{task:r}).open();return}if(a==="timeblock"){this.showTimeblockInfo(n,e.event.start);return}if(a==="ics"){this.showICSEventInfo(i,o);return}l.ctrlKey||l.metaKey?this.app.vault.getAbstractFileByPath(r.path)instanceof Me.TFile&&this.app.workspace.openLinkText(r.path,"",!0):l.button===0&&new hn(this.app,this.plugin,{task:r}).open()}async handleEventDrop(e){let{taskInfo:r,timeblock:i,eventType:n,isRecurringInstance:a,isNextScheduledOccurrence:o,isPatternInstance:l,originalDate:c}=e.event.extendedProps;if(n==="timeEntry"||n==="ics"){e.revert();return}if(n==="timeblock"){await this.handleTimeblockDrop(e,i,c);return}let d=a||o||l;try{let u=e.event.start,h=e.event.allDay;if(o){let p;h?p=C(u,"yyyy-MM-dd"):p=C(u,"yyyy-MM-dd'T'HH:mm"),await this.plugin.taskService.updateProperty(r,"scheduled",p),new Me.Notice("Rescheduled next occurrence. This does not change the recurrence pattern.")}else if(l)await this.handlePatternInstanceDrop(r,u,h);else if(a){let p=ue(r.scheduled),f;if(h)f=p,new Me.Notice("Updated recurring task to all-day. This affects all future instances.");else{let m=C(u,"HH:mm");f=`${p}T${m}`,new Me.Notice(`Updated recurring task time to ${m}. This affects all future instances.`)}await this.plugin.taskService.updateProperty(r,"scheduled",f)}else{let p;h?p=C(u,"yyyy-MM-dd"):p=C(u,"yyyy-MM-dd'T'HH:mm");let f=n==="scheduled"?"scheduled":"due";await this.plugin.taskService.updateProperty(r,f,p)}if(d){console.log("Recurring task drop completed",{taskPath:r.path,newStart:u==null?void 0:u.toISOString(),isPatternInstance:l,isNextScheduledOccurrence:o});let p=r.recurrence;setTimeout(async()=>{console.log("Checking if task data has been updated...");let f=await this.plugin.cacheManager.getTaskInfo(r.path);f&&f.recurrence!==p?(console.log("Task data confirmed updated, refreshing calendar"),this.calendar&&(this.calendar.getEvents().filter(y=>{var w;return((w=y.extendedProps.taskInfo)==null?void 0:w.path)===r.path}).forEach(y=>y.remove()),await this.refreshEvents())):(console.log("Task data not yet updated, waiting longer..."),setTimeout(async()=>{await this.refreshEvents()},1e3))},1500)}}catch(u){console.error("Error updating task date:",u),e.revert()}}async handlePatternInstanceDrop(e,r,i){try{if(!e.recurrence||typeof e.recurrence!="string")throw new Error("Task does not have a valid RRULE string");let n=e.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/),a;if(n){let o=n[1],l;if(i)l=o.slice(0,8);else{let c=o.slice(0,8),d=String(r.getHours()).padStart(2,"0"),u=String(r.getMinutes()).padStart(2,"0");l=`${c}T${d}${u}00Z`}a=e.recurrence.replace(/DTSTART:[^;]+/,`DTSTART:${l}`),new Me.Notice("Updated recurring pattern time. All future instances now appear at this time.")}else{let o=BE(e,r,i);if(!o)throw new Error("Failed to add DTSTART to recurrence rule");a=o,new Me.Notice("Added time information to recurring pattern. All future instances now appear at this time.")}await this.plugin.taskService.updateProperty(e,"recurrence",a)}catch(n){throw console.error("Error updating pattern instance time:",n),n}}async handleTimeblockDrop(e,r,i){try{let n=e.event.start,a=e.event.end,o=C(n,"yyyy-MM-dd"),l=C(n,"HH:mm"),c=C(a,"HH:mm");await Ff(this.app,r.id,i,o,l,c),this.refreshEvents(),i!==o?new Me.Notice(`Moved timeblock "${r.title}" to ${o}`):new Me.Notice(`Updated timeblock "${r.title}" time`)}catch(n){console.error("Error moving timeblock:",n),new Me.Notice(`Failed to move timeblock: ${n.message}`),e.revert()}}async handleEventResize(e){let{taskInfo:r,timeblock:i,eventType:n,originalDate:a}=e.event.extendedProps;if(n==="timeblock"){await this.handleTimeblockResize(e,i,a);return}if(n!=="scheduled"&&n!=="recurring"){e.revert();return}try{let o=e.event.start,l=e.event.end;if(o&&l){let c=Math.round((l.getTime()-o.getTime())/6e4);await this.plugin.taskService.updateProperty(r,"timeEstimate",c)}}catch(o){console.error("Error updating task duration:",o),e.revert()}}async handleTimeblockResize(e,r,i){try{let n=e.event.start,a=e.event.end;if(!n||!a){e.revert();return}let o=C(n,"HH:mm"),l=C(a,"HH:mm"),[c,d]=o.split(":").map(Number),[u,h]=l.split(":").map(Number),p=c*60+d;if(u*60+h<=p){new Me.Notice("End time must be after start time"),e.revert();return}await Ff(this.app,r.id,i,i,o,l),this.refreshEvents(),new Me.Notice(`Updated timeblock "${r.title}" duration`)}catch(n){console.error("Error resizing timeblock:",n),new Me.Notice(`Failed to resize timeblock: ${n.message}`),e.revert()}}async handleExternalDrop(e){try{let r;if(e.dataTransfer&&(r=e.dataTransfer.getData("text/plain")||e.dataTransfer.getData("application/x-task-path")),!r&&e.draggedEl&&(r=e.draggedEl.dataset.taskPath),!r){console.warn("No task path found in drop data",e);return}let i=await this.plugin.cacheManager.getTaskInfo(r);if(!i){console.warn("Task not found:",r);return}let n=e.date;if(!n){console.warn("No drop date provided");return}let a;e.allDay?a=C(n,"yyyy-MM-dd"):a=C(n,"yyyy-MM-dd'T'HH:mm"),await this.plugin.taskService.updateProperty(i,"scheduled",a),new Me.Notice(`Task "${i.title}" scheduled for ${C(n,e.allDay?"MMM d, yyyy":"MMM d, yyyy h:mm a")}`),e.draggedEl&&e.draggedEl.remove(),this.refreshEvents()}catch(r){console.error("Error handling external drop:",r),new Me.Notice("Failed to schedule task"),e.draggedEl&&e.draggedEl.remove()}}handleEventReceive(e){e.event.remove()}handleEventDidMount(e){var p;if(!e.event.extendedProps)return;let{taskInfo:r,icsEvent:i,timeblock:n,eventType:a,isCompleted:o,isRecurringInstance:l,instanceDate:c,subscriptionName:d}=e.event.extendedProps;if(e.el.setAttribute("data-event-type",a||"unknown"),a==="ics"){e.el.style.borderStyle="solid",e.el.style.borderWidth="2px",e.el.setAttribute("data-ics-event","true"),e.el.setAttribute("data-subscription",d||"Unknown"),e.el.classList.add("fc-ics-event"),(0,Me.setTooltip)(e.el,`${(i==null?void 0:i.title)||"Event"} (from ${d||"Calendar subscription"})`,{placement:"top"}),e.el.addEventListener("contextmenu",f=>{f.preventDefault(),f.stopPropagation(),this.showICSEventContextMenu(f,i,d)});return}if(a==="timeblock"){e.el.setAttribute("data-timeblock-id",(n==null?void 0:n.id)||""),e.el.style.borderStyle="solid",e.el.style.borderWidth="2px",e.el.classList.add("fc-timeblock-event"),e.event.setProp&&e.event.setProp("editable",!0);let f=((p=n==null?void 0:n.attachments)==null?void 0:p.length)||0,m=`${(n==null?void 0:n.title)||"Timeblock"}${n!=null&&n.description?` - ${n.description}`:""}${f>0?` (${f} attachment${f>1?"s":""})`:""}`;(0,Me.setTooltip)(e.el,m,{placement:"top"});return}if(!r||!r.path)return;if(e.el.setAttribute("data-task-path",r.path),e.el.classList.add("fc-task-event"),r.tags&&r.tags.length>0&&r.tags.forEach(f=>{let m=f.replace(/[^a-zA-Z0-9-_]/g,"");m&&e.el.classList.add(`fc-tag-${m}`)}),e.event.setProp)switch(a){case"scheduled":case"recurring":e.event.setProp("editable",!0);break;case"due":case"timeEntry":e.event.setProp("editable",!1);break;default:e.event.setProp("editable",!0)}let{isNextScheduledOccurrence:u,isPatternInstance:h}=e.event.extendedProps;if(u?(e.el.style.borderStyle="solid",e.el.style.borderWidth="2px",e.el.setAttribute("data-next-scheduled","true"),e.el.classList.add("fc-next-scheduled-event"),o&&(e.el.style.opacity="0.6")):h?(e.el.style.borderStyle="dashed",e.el.style.borderWidth="2px",e.el.style.opacity=o?"0.4":"0.7",e.el.setAttribute("data-pattern-instance","true"),e.el.classList.add("fc-pattern-instance-event")):l&&(e.el.style.borderStyle="dashed",e.el.style.borderWidth="2px",e.el.setAttribute("data-recurring","true"),e.el.classList.add("fc-recurring-event"),o&&(e.el.style.opacity="0.6")),o){let f=e.el.querySelector(".fc-event-title, .fc-event-title-container");f?f.style.textDecoration="line-through":e.el.style.textDecoration="line-through",e.el.classList.add("fc-completed-event")}r&&(a!=="ics"&&e.el.addEventListener("mouseover",f=>{this.plugin.app.vault.getAbstractFileByPath(r.path)&&this.plugin.app.workspace.trigger("hover-link",{event:f,source:"tasknotes-advanced-calendar",hoverParent:e.el,targetEl:e.el,linktext:r.path,sourcePath:r.path})}),e.el.addEventListener("contextmenu",f=>{if(f.preventDefault(),f.stopPropagation(),a==="timeEntry"){let{timeEntryIndex:m}=e.event.extendedProps;this.showTimeEntryContextMenu(f,r,m)}else{let{isNextScheduledOccurrence:m,isPatternInstance:g}=e.event.extendedProps,y;if((l||m||g)&&c)y=Ae(c);else{let w=e.event.start;if(w){let T=C(w,"yyyy-MM-dd");y=Ae(T)}else y=Ue()}this.showTaskContextMenuForEvent(f,r,y)}}))}registerEvents(){this.functionListeners.forEach(l=>l()),this.functionListeners=[];let e=this.plugin.emitter.on(Ft,async()=>{if(this.refreshEvents(),this.filterBar){let l=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(l)}});this.listeners.push(e);let r=this.plugin.emitter.on(mi,async()=>{this.refreshEvents()});this.listeners.push(r);let i=this.plugin.emitter.on(Fe,async l=>{if(this.refreshEvents(),this.filterBar){let c=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(c)}});this.listeners.push(i);let n=this.plugin.filterService.on("data-changed",()=>{this.refreshEvents()});if(this.functionListeners.push(n),this.plugin.icsSubscriptionService){let l=this.plugin.icsSubscriptionService.on("data-changed",()=>{this.refreshEvents()});this.functionListeners.push(l)}let a=this.plugin.emitter.on(IS,l=>{this.showTimeblocks=l&&this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.refreshEvents(),this.setupViewOptions()});this.listeners.push(a);let o=this.plugin.emitter.on("settings-changed",()=>{this.updateTodayHighlight(),this.updateCustomViewConfiguration()});this.listeners.push(o)}updateCustomViewConfiguration(){if(!this.calendar)return;let e=this.plugin.settings.calendarViewSettings;this.calendar.setOption("views",{timeGridCustom:{type:"timeGrid",duration:{days:e.customDayCount||3},buttonText:`${e.customDayCount||3} days`}}),this.calendar.setOption("headerToolbar",this.getHeaderToolbarConfig())}async refreshEvents(){this.calendar&&(this.calendar.removeAllEventSources(),this.calendar.addEventSource({events:this.getCalendarEvents.bind(this)}))}async onClose(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.functionListeners.forEach(e=>e()),this.functionListeners=[],this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.listeners=[],this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.calendar&&(this.calendar.destroy(),this.calendar=null),this.contentEl.empty()}showICSEventInfo(e,r){new Bn(this.app,this.plugin,e,r).open()}showTimeblockInfo(e,r){new nu(this.app,this.plugin,e,r).open()}showICSEventContextMenu(e,r,i){new Ka({icsEvent:r,plugin:this.plugin,subscriptionName:i,onUpdate:()=>{this.refreshEvents()}}).show(e)}async showTaskContextMenuForEvent(e,r,i){new Ja({task:r,plugin:this.plugin,targetDate:i,onUpdate:()=>{this.refreshEvents()}}).show(e)}showTimeEntryContextMenu(e,r,i){let n=new Me.Menu;n.addItem(a=>a.setTitle("Open task").setIcon("edit").onClick(()=>{new hn(this.app,this.plugin,{task:r}).open()})),n.addSeparator(),n.addItem(a=>a.setTitle("Delete time entry").setIcon("trash").onClick(async()=>{var o;try{let l=(o=r.timeEntries)==null?void 0:o[i];if(!l){new Me.Notice("Time entry not found");return}let c="";if(l.startTime&&l.endTime){let u=_t(l.startTime),p=_t(l.endTime).getTime()-u.getTime(),f=Math.round(p/(1e3*60)),m=Math.floor(f/60),g=f%60;m>0?c=` (${m}h ${g}m)`:c=` (${g}m)`}await new Promise(u=>{let h=new Me.Modal(this.app);h.setTitle("Delete Time Entry"),h.setContent(`Are you sure you want to delete this time entry${c}? This action cannot be undone.`);let p=h.contentEl.createDiv({cls:"modal-button-container"});p.style.display="flex",p.style.justifyContent="flex-end",p.style.gap="8px",p.style.marginTop="20px";let f=p.createEl("button",{text:"Cancel"}),m=p.createEl("button",{text:"Delete",cls:"mod-warning"});f.onclick=()=>{h.close(),u(!1)},m.onclick=()=>{h.close(),u(!0)},h.open()})&&(await this.plugin.taskService.deleteTimeEntry(r,i),new Me.Notice("Time entry deleted"),this.refreshEvents())}catch(l){console.error("Error deleting time entry:",l),new Me.Notice("Failed to delete time entry")}})),n.showAtMouseEvent(e)}updateTodayHighlight(){let e=this.contentEl.querySelector(".advanced-calendar-view__calendar-container");if(!e)return;this.plugin.settings.calendarViewSettings.showTodayHighlight?e.removeClass("hide-today-highlight"):e.addClass("hide-today-highlight")}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(e=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),e()})})}};var br=require("obsidian");Ss();var Vt=class s{static formatGroupName(t,e){let r=e.priorityManager.getPriorityConfig(t);if(r)return`${r.label} priority`;let i=e.statusManager.getStatusConfig(t);if(i)return i.label;switch(t){case"all":return"All tasks";case"no-status":return"No status assigned";case"No Status":return"No Status";case"No Priority":return"No Priority";case"No Context":return"No Context";case"No Project":return"No Project";case"No Due Date":return"No Due Date";case"No Scheduled Date":return"No Scheduled Date";default:return t}}static getGroupDisplayName(t,e,r){return`${s.formatGroupName(t,r)} (${e})`}static isGroupCollapsed(t,e,r,i){var n;try{let o=(i.viewStateManager.getViewPreferences(t)||{}).collapsedGroups||{};return!!((n=o==null?void 0:o[e])!=null&&n[r])}catch(a){return!1}}static setGroupCollapsed(t,e,r,i,n){let o={...n.viewStateManager.getViewPreferences(t)||{}};o.collapsedGroups||(o.collapsedGroups={}),o.collapsedGroups[e]||(o.collapsedGroups[e]={}),o.collapsedGroups[e][r]=i,n.viewStateManager.setViewPreferences(t,o)}static expandAllGroups(t,e,r){let i=r.viewStateManager.getViewPreferences(t)||{},n={...i.collapsedGroups||{}};n[e]={},r.viewStateManager.setViewPreferences(t,{...i,collapsedGroups:n})}static collapseAllGroups(t,e,r,i){let n=i.viewStateManager.getViewPreferences(t)||{},a={...n.collapsedGroups||{}},o={};r.forEach(l=>{o[l]=!0}),a[e]=o,i.viewStateManager.setViewPreferences(t,{...n,collapsedGroups:a})}};var it=class s{static formatGroupCount(t,e,r={}){let i=e>0?Math.round(t/e*100):0,n=["agenda-view__item-count"];r.additionalClasses&&n.push(...r.additionalClasses);let a;return r.showPercentage?a=`${i}%`:r.hideCompleted?a=`${e}`:a=`${t} / ${e}`,{text:a,classes:n,completed:t,total:e,percentage:i}}static calculateGroupStats(t,e){let r=t.length;return{completed:t.filter(n=>e.statusManager.isCompletedStatus(n.status)).length,total:r}}static createCountElement(t,e,r,i={}){let n=s.formatGroupCount(e,r,i),a=t.createEl("div",{text:n.text,cls:n.classes.join(" ")});return a.setAttribute("data-completed",e.toString()),a.setAttribute("data-total",r.toString()),a.setAttribute("data-percentage",n.percentage.toString()),a}static updateCountElement(t,e,r,i={}){let n=s.formatGroupCount(e,r,i);t.textContent=n.text,t.className=n.classes.join(" "),t.setAttribute("data-completed",e.toString()),t.setAttribute("data-total",r.toString()),t.setAttribute("data-percentage",n.percentage.toString())}};var mn=class{constructor(t){this.headingElement=null;this.countElement=null;this.dividerElement=null;this.container=t,this.instanceId="fh-"+Math.random().toString(36).substr(2,9),this.render()}render(){let t=this.container.createDiv("filter-heading"),e=t.createDiv("filter-heading__content");this.headingElement=e.createEl("h2",{cls:"filter-heading__title",text:"All"}),this.countElement=e.createDiv("filter-heading__count agenda-view__item-count"),this.dividerElement=t.createDiv("filter-heading__divider")}update(t,e,r){if(!this.headingElement||!this.countElement)return;let i=(t==null?void 0:t.name)||"All";this.headingElement.textContent=i;let n=it.formatGroupCount(e,r).text;this.countElement.textContent=n}destroy(){let t=this.container.querySelector(".filter-heading");t&&t.remove()}};var Kc=class extends br.ItemView{constructor(e,r){super(e);this.taskListContainer=null;this.loadingIndicator=null;this.isTasksLoading=!1;this.filterBar=null;this.filterHeading=null;this.taskElements=new Map;this.listeners=[];this.functionListeners=[];this.plugin=r,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"},this.registerEvents()}getViewType(){return Wr}getDisplayText(){return"Tasks"}getIcon(){return"check-square"}registerEvents(){this.listeners.forEach(a=>this.plugin.emitter.offref(a)),this.listeners=[],this.functionListeners.forEach(a=>a()),this.functionListeners=[];let e=this.plugin.emitter.on(Ft,async()=>{if(this.refresh(),this.filterBar){let a=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(a)}});this.listeners.push(e);let r=this.plugin.emitter.on(mi,async()=>{this.refresh()});this.listeners.push(r);let i=this.plugin.emitter.on(Fe,async({path:a,originalTask:o,updatedTask:l})=>{if(!a||!l){console.error("EVENT_TASK_UPDATED received invalid data:",{path:a,originalTask:o,updatedTask:l});return}await da(l,this.plugin,this.contentEl);let c=this.taskElements.get(a);if(c)try{let d=this.getCurrentVisibleProperties();ii(c,l,this.plugin,d,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1}),c.classList.add("task-updated"),setTimeout(()=>{c.classList.remove("task-updated")},1e3)}catch(d){console.error("Error updating task card:",d),this.refreshTasks()}else this.refreshTasks();if(this.filterBar){let d=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(d)}});this.listeners.push(i);let n=this.plugin.filterService.on("data-changed",()=>{this.refreshTasks()});this.functionListeners.push(n)}async onOpen(){try{await this.plugin.onReady(),await this.plugin.waitForMigration(),this.currentQuery=this.plugin.filterService.createDefaultQuery();let e=this.plugin.viewStateManager.getFilterState(Wr);e&&(this.currentQuery=e),await this.refresh()}catch(e){console.error("TaskListView: Error during onOpen:",e),this.fallbackToPolling()}}async fallbackToPolling(){this.contentEl.empty(),this.contentEl.createDiv({cls:"task-list-view__loading"}).createSpan({text:"Initializing..."});let r=0,i=50,n=async()=>{r++,this.plugin.cacheManager&&this.plugin.cacheManager.isInitialized()?await this.refresh():r<i?setTimeout(n,100):await this.refresh()};n()}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.functionListeners.forEach(e=>e()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.filterHeading&&(this.filterHeading.destroy(),this.filterHeading=null),this.contentEl.empty()}async refresh(e=!1){return as.measure("task-list-refresh",async()=>{e&&this.taskElements.clear(),this.contentEl.empty(),this.taskElements.clear(),await this.render()})}async render(){let e=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container task-list-view-container"});this.createHeader(e),await this.createTasksContent(e)}createHeader(e){e.createDiv({cls:"detail-view-header task-list-header"})}async createTasksContent(e){let r=e.createDiv({cls:"filter-bar-container"});await this.waitForCacheReady(),this.currentQuery=this.plugin.filterService.createDefaultQuery();let i=this.plugin.viewStateManager.getFilterState(Wr);i&&(this.currentQuery=i);let n=await this.plugin.filterService.getFilterOptions();this.filterBar=new ri(this.app,this.plugin,r,this.currentQuery,n,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"task-list"});let a=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(a),this.filterBar.on("saveView",({name:d,query:u,viewOptions:h,visibleProperties:p})=>{let f=this.plugin.viewStateManager.saveView(d,u,h,p);this.filterBar.setActiveSavedView(f)}),this.filterBar.on("deleteView",d=>{this.plugin.viewStateManager.deleteView(d)}),this.plugin.viewStateManager.on("saved-views-changed",d=>{var u;(u=this.filterBar)==null||u.updateSavedViews(d)}),this.filterBar.on("reorderViews",(d,u)=>{this.plugin.viewStateManager.reorderSavedViews(d,u)}),this.filterBar.on("queryChange",async d=>{this.currentQuery=d,this.plugin.viewStateManager.setFilterState(Wr,d);let u=this.contentEl.querySelector(".filter-heading__controls");u&&this.createExpandCollapseButtons(u),await this.refreshTasks()}),this.filterBar.on("propertiesChanged",d=>{this.refreshTaskDisplay()}),this.filterHeading=new mn(e);let o=e.querySelector(".filter-heading");if(o){let d=o.querySelector(".filter-heading__content");if(d){let u=d.createDiv({cls:"filter-heading__controls"});this.createExpandCollapseButtons(u)}}let l=e.createDiv({cls:"task-list"});this.loadingIndicator=l.createDiv({cls:"loading-indicator"}),this.loadingIndicator.createDiv({cls:"loading-spinner"}),this.loadingIndicator.createDiv({cls:"loading-text",text:"Loading tasks..."}),this.loadingIndicator.addClass("is-hidden"),this.taskListContainer=l,this.isTasksLoading=!0,this.updateLoadingState(),await this.refreshTasks(),this.isTasksLoading=!1,this.updateLoadingState();let c=this.contentEl.querySelector(".filter-heading__controls");c&&this.createExpandCollapseButtons(c)}createExpandCollapseButtons(e){if(!((this.currentQuery.groupKey||"none")!=="none")){e.style.display="none";return}e.style.display="flex",e.empty(),new br.ButtonComponent(e).setIcon("list-tree").setTooltip("Expand All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none";this.contentEl.querySelectorAll(".task-group").forEach(o=>{o.classList.remove("is-collapsed");let l=o.querySelector(".task-cards");l&&(l.style.display="")}),Vt.expandAllGroups(Wr,a,this.plugin)}).buttonEl.addClass("clickable-icon"),new br.ButtonComponent(e).setIcon("list-collapse").setTooltip("Collapse All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none",o=[];this.contentEl.querySelectorAll(".task-group").forEach(l=>{let c=l.dataset.group;if(c){o.push(c),l.classList.add("is-collapsed");let d=l.querySelector(".task-cards");d&&(d.style.display="none")}}),Vt.collapseAllGroups(Wr,a,o,this.plugin)}).buttonEl.addClass("clickable-icon")}async updateFilterHeading(){if(!(!this.filterHeading||!this.filterBar))try{let e=await this.plugin.filterService.getGroupedTasks(this.currentQuery),r=Array.from(e.values()).flat(),i=it.calculateGroupStats(r,this.plugin),n=this.filterBar.activeSavedView||null;this.filterHeading.update(n,i.completed,i.total)}catch(e){console.error("Error updating filter heading in TaskListView:",e)}}async refreshTasks(){var e;if(this.taskListContainer)try{this.isTasksLoading=!0,this.updateLoadingState();let r=await this.plugin.filterService.getGroupedTasks(this.currentQuery);this.renderTaskItems(this.taskListContainer,r)}catch(r){let i=r instanceof Error?r.message:String(r);console.error("TaskListView: Error refreshing tasks:",{error:i,stack:r instanceof Error?r.stack:void 0,query:this.currentQuery,cacheInitialized:((e=this.plugin.cacheManager)==null?void 0:e.isInitialized())||!1,visibleProperties:this.getCurrentVisibleProperties(),filterServiceQuery:JSON.stringify(this.currentQuery,null,2)}),this.taskListContainer.empty();let n=this.taskListContainer.createDiv({cls:"error-container"});n.createEl("p",{text:"Error loading tasks. Please try refreshing.",cls:"error-message"}),n.createEl("button",{text:"Retry",cls:"mod-cta"}).addEventListener("click",()=>{this.refreshTasks()})}finally{this.isTasksLoading=!1,this.updateLoadingState(),await this.updateFilterHeading()}}renderTaskItems(e,r){if(Array.from(r.values()).reduce((n,a)=>n+a.length,0)===0){e.empty(),this.taskElements.clear(),e.createEl("p",{text:"No tasks found for the selected filters."});return}if(this.currentQuery.groupKey==="none"&&r.has("all")){let n=r.get("all")||[];this.renderTaskListWithReconciler(e,n)}else this.renderGroupedTasksWithReconciler(e,r)}renderTaskListWithReconciler(e,r){Array.from(e.children).forEach(i=>{let n=i;n.dataset.key||n.remove()});try{this.plugin.domReconciler.updateList(e,r,i=>i.path,i=>this.createTaskCardForReconciler(i),(i,n)=>this.updateTaskCardForReconciler(i,n))}catch(i){throw console.error("TaskListView: Error in renderTaskListWithReconciler:",i),i}this.taskElements.clear(),Array.from(e.children).forEach(i=>{let n=i.dataset.key;n&&this.taskElements.set(n,i)})}renderGroupedTasksWithReconciler(e,r){let i=e.scrollTop,n=new Map;Array.from(e.children).forEach(a=>{let o=a.dataset.group;o&&n.set(o,a)}),e.empty(),this.taskElements.clear(),r.forEach((a,o)=>{if(a.length===0)return;let l=e.createDiv({cls:"task-section task-group"});l.setAttribute("data-group",o);let c=this.currentQuery.groupKey||"none",d=c==="none"&&o==="all",u=this.isGroupCollapsed(c,o);if(!d){let p=l.createEl("h3",{cls:"task-group-header task-list-view__group-header"}),f=p.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle group"}});try{(0,br.setIcon)(f,"chevron-right")}catch(y){}let m=f.querySelector("svg");m?(m.classList.add("chevron"),m.setAttr("width","16"),m.setAttr("height","16")):(f.textContent="\u25B8",f.addClass("chevron-text"));let g=it.calculateGroupStats(a,this.plugin);c==="project"&&this.isClickableProject(o)?this.createClickableProjectHeader(p,o,g):(p.createSpan({text:this.formatGroupName(o)}),p.createSpan({text:` ${it.formatGroupCount(g.completed,g.total).text}`,cls:"agenda-view__item-count"})),this.registerDomEvent(p,"click",y=>{if(y.target.closest("a"))return;let T=!l.hasClass("is-collapsed");this.setGroupCollapsed(c,o,T),l.toggleClass("is-collapsed",T);let S=l.querySelector(".task-cards");S&&(S.style.display=T?"none":""),f.setAttr("aria-expanded",String(!T))}),this.registerDomEvent(f,"click",y=>{y.preventDefault(),y.stopPropagation();let w=!l.hasClass("is-collapsed");this.setGroupCollapsed(c,o,w),l.toggleClass("is-collapsed",w);let T=l.querySelector(".task-cards");T&&(T.style.display=w?"none":""),f.setAttr("aria-expanded",String(!w))}),f.setAttr("aria-expanded",String(!u))}let h=l.createDiv({cls:"tasks-container task-cards"});u&&!d&&(l.addClass("is-collapsed"),h.style.display="none"),this.plugin.domReconciler.updateList(h,a,p=>p.path,p=>this.createTaskCardForReconciler(p),(p,f)=>this.updateTaskCardForReconciler(p,f)),Array.from(h.children).forEach(p=>{let f=p.dataset.key;f&&this.taskElements.set(f,p)})}),e.scrollTop=i}isGroupCollapsed(e,r){return Vt.isGroupCollapsed(Wr,e,r,this.plugin)}setGroupCollapsed(e,r,i){Vt.setGroupCollapsed(Wr,e,r,i,this.plugin)}getCurrentVisibleProperties(){var e;return(e=this.filterBar)==null?void 0:e.getCurrentVisibleProperties()}refreshTaskDisplay(){if(!this.taskListContainer)return;let e=this.taskListContainer.querySelectorAll(".task-card"),r=this.getCurrentVisibleProperties();e.forEach(i=>{let n=i.dataset.taskPath;n&&this.plugin.cacheManager.getTaskInfo(n).then(a=>{a&&ii(i,a,this.plugin,r)})})}createTaskCardForReconciler(e){try{let r=this.getCurrentVisibleProperties(),i=er(e,this.plugin,r,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1});return i.dataset.key=e.path,this.addDragHandlers(i,e),i}catch(r){throw console.error("TaskListView: Error creating task card for",e.path,":",r),r}}updateTaskCardForReconciler(e,r){let i=this.getCurrentVisibleProperties();ii(e,r,this.plugin,i,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1})}addDragHandlers(e,r){this.plugin.dragDropManager.makeTaskCardDraggable(e,r.path)}formatGroupName(e){return Vt.formatGroupName(e,this.plugin)}updateLoadingState(){this.loadingIndicator&&(this.isTasksLoading?this.loadingIndicator.removeClass("is-hidden"):this.loadingIndicator.addClass("is-hidden"))}openTask(e){let r=this.app.vault.getAbstractFileByPath(e);r instanceof br.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(e=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),e()})})}isClickableProject(e){var r;return!e||typeof e!="string"?!1:e.startsWith("[[")&&e.endsWith("]]")||e.includes("/")?!0:(r=this.plugin)!=null&&r.app?this.plugin.app.vault.getAbstractFileByPath(e+".md")instanceof br.TFile?!0:!!this.plugin.app.metadataCache.getFirstLinkpathDest(e,""):!1}createClickableProjectHeader(e,r,i){if(!r||typeof r!="string")return;let n=r,a=r;if(r.startsWith("[[")&&r.endsWith("]]")){let l=r.slice(2,-2);n=l,a=l}let o=e.createEl("a",{cls:"internal-link task-list-view__project-link",text:a});this.registerDomEvent(o,"click",async l=>{l.preventDefault(),l.stopPropagation();try{let c=this.plugin.app.vault.getAbstractFileByPath(n);if(c instanceof br.TFile){await this.plugin.app.workspace.getLeaf(!1).openFile(c);return}let d=this.plugin.app.metadataCache.getFirstLinkpathDest(n,"");d?await this.plugin.app.workspace.getLeaf(!1).openFile(d):new br.Notice(`Project file not found: ${a}`)}catch(c){console.error("Error opening project file:",c),new br.Notice(`Error opening project: ${a}`)}}),this.addHoverPreview(o,n),i&&e.createSpan({text:` ${it.formatGroupCount(i.completed,i.total).text}`,cls:"agenda-view__item-count"})}addHoverPreview(e,r){e.addEventListener("mouseover",i=>{this.app.vault.getAbstractFileByPath(r)&&this.app.workspace.trigger("hover-link",{event:i,source:"tasknotes-tasklistview",hoverParent:this,targetEl:e,linktext:r,sourcePath:r})})}};var ji=require("obsidian");Se();var fM=require("obsidian");Se();var Ry=bt(Vr()),mM={showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:3,showDailyNoteBadge:!0};function Lh(s,t,e={}){let r={...mM,...e},i=document.createElement("div"),n=!1;try{let l=(0,Ry.getAllDailyNotes)();n=Object.values(l).some(c=>c.path===s.path)}catch(l){n=!1}let a=["note-card"];n&&a.push("note-card--daily-note"),a.push("note-card--compact","note-card--shadow-light"),i.className=a.join(" "),i.dataset.notePath=s.path,r.showDailyNoteBadge&&n&&i.createSpan({cls:"note-card__badge",text:"Daily",attr:{title:"Daily note"}});let o=i.createDiv({cls:"note-card__content"});if(o.createDiv({cls:"note-card__title",text:s.title}),r.showTags&&s.tags&&s.tags.length>0){o.createEl("div",{cls:"note-card__divider"});let c=s.tags.slice(0,r.maxTags).map(d=>`#${d}`).join(" ");s.tags.length>r.maxTags&&(c+=` +${s.tags.length-r.maxTags}`),o.createEl("div",{cls:"note-card__tags-text",text:c})}if(r.showCreatedDate&&s.createdDate){let l=s.createdDate.indexOf("T")>0?_r(s.createdDate,"MMM d, yyyy h:mm a"):s.createdDate;o.createDiv({cls:"note-card__metadata",text:`Created: ${l}`,attr:{title:`Created: ${l}`}})}return r.showPath&&o.createDiv({cls:"note-card__metadata",text:s.path,attr:{title:`Path: ${s.path}`}}),i.addEventListener("click",()=>{let l=t.app.vault.getAbstractFileByPath(s.path);l instanceof fM.TFile&&t.app.workspace.getLeaf(!1).openFile(l)}),i.addEventListener("mouseover",l=>{t.app.vault.getAbstractFileByPath(s.path)&&t.app.workspace.trigger("hover-link",{event:l,source:"tasknotes-note-card",hoverParent:i,targetEl:i,linktext:s.path,sourcePath:s.path})}),i}function gM(s,t,e,r={}){let i={...mM,...r},n=!1;try{let u=(0,Ry.getAllDailyNotes)();n=Object.values(u).some(h=>h.path===t.path)}catch(u){n=!1}let a=["note-card"];n&&a.push("note-card--daily-note"),a.push("note-card--compact","note-card--shadow-light"),s.className=a.join(" ");let o=s.querySelector(".note-card__title");o&&(o.textContent=t.title);let l=s.querySelector(".note-card__metadata");if(l&&i.showCreatedDate&&t.createdDate){let u=t.createdDate.indexOf("T")>0?_r(t.createdDate,"MMM d, yyyy h:mm a"):t.createdDate;l.textContent=`Created: ${u}`}let c=s.querySelector(".note-card__metadata");c&&i.showPath&&(c.textContent=t.path);let d=s.querySelector(".note-card__tags-text");if(d&&i.showTags&&t.tags&&t.tags.length>0){let h=t.tags.slice(0,i.maxTags).map(p=>`#${p}`).join(" ");t.tags.length>i.maxTags&&(h+=` +${t.tags.length-i.maxTags}`),d.textContent=h}s.classList.add("note-card--updated"),window.setTimeout(()=>{s.classList.remove("note-card--updated")},1e3)}var Hh=class extends ji.ItemView{constructor(e,r){super(e);this.loadingIndicator=null;this.isNotesLoading=!1;this.listeners=[];this.plugin=r,this.registerEvents()}getViewType(){return tl}getDisplayText(){return"Notes"}getIcon(){return"file-text"}registerEvents(){this.listeners.forEach(i=>this.plugin.emitter.offref(i)),this.listeners=[];let e=this.plugin.emitter.on(Os,()=>{this.refresh(!0)});this.listeners.push(e);let r=this.plugin.emitter.on(Ft,()=>{this.refresh()});this.listeners.push(r)}async onOpen(){await this.plugin.onReady(),await this.refresh()}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.contentEl.empty()}async refresh(e=!1){let r=this.contentEl.querySelector(".notes-view"),i=0;if(r&&!e){let n=r.querySelector(".notes-view__list");n&&(i=n.scrollTop)}if(this.contentEl.empty(),await this.render(e),i>0){let n=this.contentEl.querySelector(".notes-view__list");n&&(n.scrollTop=i)}}async render(e=!1){let r=this.contentEl.createDiv({cls:"tasknotes-plugin notes-view"});this.createHeader(r),await this.createNotesContent(r,e)}createHeader(e){let r=e.createDiv({cls:"notes-view__header"}),i=_r(this.plugin.selectedDate.toISOString(),"EEEE, MMMM d, yyyy"),n=r.createDiv();new ji.Setting(n).setName("Notes").setHeading(),n.createEl("div",{text:i,cls:"notes-view__date"});let o=r.createDiv({cls:"notes-view__actions"}).createEl("button",{text:"Refresh",cls:"notes-view__refresh-button",attr:{"aria-label":"Refresh notes list",title:"Refresh notes list"}});o.addEventListener("click",async()=>{if(o.classList.contains("is-loading"))return;o.classList.add("is-loading"),o.disabled=!0;let l=o.textContent;o.textContent="Refreshing...";try{await this.refresh(!0)}finally{o.classList.remove("is-loading"),o.disabled=!1,o.textContent=l}})}async createNotesContent(e,r=!1){let i=e.createDiv({cls:"notes-view__list"});this.loadingIndicator=i.createDiv({cls:"notes-view__loading is-hidden"}),this.loadingIndicator.createSpan({text:"Loading notes..."}),this.isNotesLoading=!0,this.updateLoadingState();let n=await this.getNotesForView(r);if(this.isNotesLoading=!1,this.updateLoadingState(),n.length===0){let a=i.createDiv({cls:"notes-view__empty"}),o=a.createDiv({cls:"notes-view__empty-icon"});(0,ji.setIcon)(o,"file-text"),this.plugin.settings.disableNoteIndexing?(new ji.Setting(a).setName("Note indexing disabled").setHeading(),a.createEl("p",{text:"Note indexing has been disabled in settings for better performance. To view notes, enable note indexing in Settings > TaskNotes > General > Performance settings and restart the plugin.",cls:"notes-view__empty-description"})):(new ji.Setting(a).setName("No notes found").setHeading(),a.createEl("p",{text:"No notes found for the selected date. Try selecting a different date in the Mini Calendar view or create some notes.",cls:"notes-view__empty-description"}))}else{let a=i.createDiv({cls:"notes-view__container"});this.renderNotesWithReconciler(a,n)}}renderNotesWithReconciler(e,r){this.plugin.domReconciler.updateList(e,r,i=>i.path,i=>this.createNoteCardForReconciler(i),(i,n)=>this.updateNoteCardForReconciler(i,n))}createNoteCardForReconciler(e){let r=Lh(e,this.plugin,{showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:5,showDailyNoteBadge:!0});return r.dataset.key=e.path,r}updateNoteCardForReconciler(e,r){gM(e,r,this.plugin,{showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:5,showDailyNoteBadge:!0})}updateLoadingState(){var e,r;this.loadingIndicator&&(this.isNotesLoading?(e=this.loadingIndicator)==null||e.classList.remove("is-hidden"):(r=this.loadingIndicator)==null||r.classList.add("is-hidden"))}async getNotesForView(e=!1){try{return this.isNotesLoading=!0,this.updateLoadingState(),this.plugin.settings.disableNoteIndexing?[]:(await this.plugin.cacheManager.getNotesForDate(this.plugin.selectedDate)).sort((a,o)=>a.title.localeCompare(o.title))}finally{this.isNotesLoading=!1,this.updateLoadingState()}}openNote(e){let r=this.app.vault.getAbstractFileByPath(e);r instanceof ji.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}};var Wt=require("obsidian");ot();Se();var yM=require("obsidian");ot();function vM(s){try{if(!s.start)return"";let t=new Date(s.start);if(s.allDay)return"All day";let e=C(t,"h:mm a");if(s.end){let r=new Date(s.end),i=C(r,"h:mm a");return`${e} \u2013 ${i}`}return e}catch(t){return""}}function wM(s,t,e={}){var m;let r=document.createElement("div");r.className="task-card task-card--ics",r.dataset.key=s.id;let i=(m=t.icsSubscriptionService)==null?void 0:m.getSubscriptions().find(g=>g.id===s.subscriptionId),n=(i==null?void 0:i.color)||"var(--color-accent)",a=(i==null?void 0:i.name)||"Calendar",o=r.createEl("div",{cls:"task-card__main-row"}),l=o.createEl("span",{cls:"ics-card__icon"}),c=l.createDiv({attr:{"aria-label":"Calendar event"}});(0,yM.setIcon)(c,"calendar");let d=l;d.style.display="inline-flex",d.style.width="16px",d.style.height="16px",d.style.marginRight="8px",d.style.alignItems="center",d.style.justifyContent="center",d.style.flexShrink="0",c.style.width="100%",c.style.height="100%",c.style.color=n;let u=o.createEl("div",{cls:"task-card__content"});u.createEl("div",{cls:"task-card__title",text:s.title||"Untitled event"});let h=u.createEl("div",{cls:"task-card__metadata"}),p=[],f=vM(s);return f&&p.push(f),s.location&&p.push(s.location),p.push(a),h.textContent=p.join(" \u2022 "),r.addEventListener("click",()=>{let{ICSEventInfoModal:g}=(ru(),mv(UE));new g(t.app,t,s,a).open()}),r.addEventListener("contextmenu",g=>{g.preventDefault(),g.stopPropagation(),new Ka({icsEvent:s,plugin:t,subscriptionName:a,onUpdate:()=>{t.app.workspace.trigger("tasknotes:refresh-views")}}).show(g)}),r.style.setProperty("--current-status-color",n),r}function Bh(s,t,e,r={}){var d;let i=(d=e.icsSubscriptionService)==null?void 0:d.getSubscriptions().find(u=>u.id===t.subscriptionId),n=(i==null?void 0:i.color)||"var(--color-accent)",a=(i==null?void 0:i.name)||"Calendar";s.style.setProperty("--current-status-color",n);let o=s.querySelector(".ics-card__icon");o&&(o.style.color=n);let l=s.querySelector(".task-card__title");l&&(l.textContent=t.title||"Untitled event");let c=s.querySelector(".task-card__metadata");if(c){let u=[],h=vM(t);h&&u.push(h),t.location&&u.push(t.location),u.push(a),c.textContent=u.join(" \u2022 ")}}Ss();var TM=require("obsidian");ht();ot();Pa();Se();var gn=class extends Yi{constructor(e,r,i,n){super();this.plugin=n;this.indexQueryCache=new Map;this.cacheTimeout=3e4;this.cacheTimers=new Map;this.filterOptionsCache=null;this.filterOptionsCacheTimestamp=0;this.filterOptionsCacheTTL=3e5;this.filterOptionsComputeCount=0;this.filterOptionsCacheHits=0;this.cacheManager=e,this.statusManager=r,this.priorityManager=i}async getGroupedTasks(e,r){try{we.validateFilterNode(e,!1);let i=this.getIndexOptimizedTaskPaths(e),a=(await this.pathsToTaskInfos(Array.from(i))).filter(l=>this.evaluateFilterNode(e,l,r)),o=this.sortTasks(a,e.sortKey||"due",e.sortDirection||"asc");return this.currentSortKey=e.sortKey||"due",this.currentSortDirection=e.sortDirection||"asc",this.groupTasks(o,e.groupKey||"none",r)}catch(i){if(i instanceof Xt||i instanceof fn)return console.error("Filter error:",i.message,{nodeId:i.nodeId,field:i.field}),new Map;throw i}}getIndexOptimizedTaskPaths(e){let r=this.analyzeQueryOptimizationSafety(e);if(!r.canOptimize)return this.cacheManager.getAllTaskPaths();if(r.strategy==="intersect"){let i=this.getPathsForIndexableCondition(r.conditions[0]);for(let n=1;n<r.conditions.length;n++){let a=this.getPathsForIndexableCondition(r.conditions[n]);i=this.intersectPathSets(i,a)}return i}else if(r.strategy==="single")return this.getPathsForIndexableCondition(r.conditions[0]);return this.cacheManager.getAllTaskPaths()}analyzeQueryOptimizationSafety(e){let r=this.findIndexableConditions(e);return r.length===0?{canOptimize:!1,conditions:[],reason:"No indexable conditions found"}:this.isSimpleQuery(e,r)?{canOptimize:!0,strategy:r.length===1?"single":"intersect",conditions:r}:{canOptimize:!1,conditions:r,reason:"Complex query structure with OR conditions - optimization not safe"}}isSimpleQuery(e,r){return r.length===0||this.hasIndexableConditionInOrGroup(e,r)?!1:r.length===1||e.type==="group"&&e.conjunction==="and"&&e.children.filter(n=>n.type==="condition"&&this.isIndexableCondition(n)).length===r.length}hasIndexableConditionInOrGroup(e,r){return this.checkNodeForOrWithIndexable(e,r)}checkNodeForOrWithIndexable(e,r){if(e.type==="condition")return!1;if(e.type==="group"){if(e.conjunction==="or"&&e.children.some(n=>n.type==="condition"&&r.includes(n)))return!0;for(let i of e.children)if(this.checkNodeForOrWithIndexable(i,r))return!0}return!1}findIndexableConditions(e){let r=[];if(e.type==="condition")this.isIndexableCondition(e)&&r.push(e);else if(e.type==="group")for(let i of e.children)r.push(...this.findIndexableConditions(i));return r}isIndexableCondition(e){let{property:r,operator:i,value:n}=e;return!!(r==="status"&&i==="is"&&n||r==="due"&&(i==="is"||i==="is-before"||i==="is-after")&&n||r==="scheduled"&&(i==="is"||i==="is-before"||i==="is-after")&&n)}getCachedIndexResult(e,r){let i=this.indexQueryCache.get(e);if(i)return new Set(i);let n=r();this.indexQueryCache.set(e,new Set(n));let a=this.cacheTimers.get(e);a&&clearTimeout(a);let o=setTimeout(()=>{this.indexQueryCache.delete(e),this.cacheTimers.delete(e)},this.cacheTimeout);return this.cacheTimers.set(e,o),n}clearIndexQueryCache(){for(let e of this.cacheTimers.values())clearTimeout(e);this.indexQueryCache.clear(),this.cacheTimers.clear()}getCacheStats(){return{entryCount:this.indexQueryCache.size,cacheKeys:Array.from(this.indexQueryCache.keys()),timeoutMs:this.cacheTimeout}}getPathsForIndexableCondition(e){let{property:r,operator:i,value:n}=e,a=`${r}:${i}:${n}`;return this.getCachedIndexResult(a,()=>r==="status"&&i==="is"&&n&&typeof n=="string"?new Set(this.cacheManager.getTaskPathsByStatus(n)):(r==="due"||r==="scheduled")&&i==="is"&&n&&typeof n=="string"?new Set(this.cacheManager.getTasksForDate(n)):(r==="due"||r==="scheduled")&&(i==="is-before"||i==="is-after")&&n&&typeof n=="string"?this.getTaskPathsForDateRange(r,i,n):this.cacheManager.getAllTaskPaths())}getTaskPathsForDateRange(e,r,i){return this.cacheManager.getAllTaskPaths()}intersectPathSets(e,r){let i=new Set;for(let n of e)r.has(n)&&i.add(n);return i}async pathsToTaskInfos(e){let r=[];for(let n=0;n<e.length;n+=50){let a=e.slice(n,n+50),o=await Promise.all(a.map(l=>this.cacheManager.getCachedTaskInfo(l)));for(let l of o)l&&r.push(l)}return r}evaluateFilterNode(e,r,i){return e.type==="condition"?this.evaluateCondition(e,r,i):e.type==="group"?this.evaluateGroup(e,r,i):!0}evaluateGroup(e,r,i){if(e.children.length===0)return!0;let n=e.children.filter(a=>a.type==="condition"?we.isFilterNodeComplete(a):!0);return n.length===0?!0:e.conjunction==="and"?n.every(a=>this.evaluateFilterNode(a,r,i)):e.conjunction==="or"?n.some(a=>this.evaluateFilterNode(a,r,i)):!0}normalizeUserListValue(e){let r=[],i=o=>{if(!o)return;let l=String(o).trim();if(!l)return;let c=l.match(/^\[\[([^|\]]+)(?:\|([^\]]+))?\]\]$/);if(c){let d=c[1]||"",h=c[2]||d.split("#")[0].split("/").pop()||d;h&&r.push(h),r.push(l);return}r.push(l)};if(Array.isArray(e))for(let o of e)i(String(o));else if(typeof e=="string"){let o=hi(e);for(let l of o)i(l)}else e!=null&&i(String(e));let n=new Set,a=[];for(let o of r)n.has(o)||(n.add(o),a.push(o));return a}evaluateCondition(e,r,i){var c,d,u;let{property:n,operator:a,value:o}=e;if(typeof n=="string"&&n.startsWith("user:")){let h=n.slice(5),f=(((d=(c=this.plugin)==null?void 0:c.settings)==null?void 0:d.userFields)||[]).find(y=>(y.id||y.key)===h),m;if(f)try{let y=this.cacheManager.getApp(),w=y.vault.getAbstractFileByPath(r.path);if(w){let T=(u=y.metadataCache.getFileCache(w))==null?void 0:u.frontmatter,S=T?T[f.key]:void 0;switch(f.type){case"boolean":m=typeof S=="boolean"?S:String(S).toLowerCase()==="true";break;case"number":m=typeof S=="number"?S:S!=null?parseFloat(String(S)):void 0;break;case"list":m=this.normalizeUserListValue(S);break;default:m=S!=null?String(S):void 0}}}catch(y){}if((f==null?void 0:f.type)==="list"&&(a==="contains"||a==="does-not-contain")){let y=Array.isArray(m)?m:m!=null?[String(m)]:[],T=(Array.isArray(o)?o:[String(o!=null?o:"")]).some(S=>typeof S=="string"&&y.some(x=>typeof x=="string"&&x.toLowerCase().includes(S.toLowerCase())));return a==="contains"?T:!T}let g=(f==null?void 0:f.type)==="date"?"due":n;return we.applyOperator(m,a,o,e.id,g)}let l=we.getTaskPropertyValue(r,n);if(n==="status.isCompleted"){let h=Ii(r,i||new Date);l=this.statusManager.isCompletedStatus(h)}return n==="projects"&&(a==="contains"||a==="does-not-contain")?this.evaluateProjectsCondition(l,a,o):we.applyOperator(l,a,o,e.id,n)}evaluateProjectsCondition(e,r,i){if(!Array.isArray(e)||typeof i!="string")return!1;let n=this.extractProjectName(i);if(!n)return!1;let a=e.some(o=>{if(!o||typeof o!="string")return!1;let l=this.extractProjectName(o);return l?l===n?!0:this.compareProjectWikilinks(o,i):!1});return r==="contains"?a:!a}extractProjectName(e){if(!e||typeof e!="string")return null;if(e.startsWith("[[")&&e.endsWith("]]")){let i=e.slice(2,-2).split("/");return i[i.length-1]||null}return e.trim()||null}compareProjectWikilinks(e,r){var l;if(!((l=this.plugin)!=null&&l.app))return!1;let i=this.extractWikilinkPath(e),n=this.extractWikilinkPath(r);if(!i||!n)return!1;let a=this.plugin.app.metadataCache.getFirstLinkpathDest(i,""),o=this.plugin.app.metadataCache.getFirstLinkpathDest(n,"");return a&&o?a.path===o.path:!1}extractWikilinkPath(e){return!e||typeof e!="string"?null:e.startsWith("[[")&&e.endsWith("]]")?e.slice(2,-2):e}resolveProjectToAbsolutePath(e){var i;if(!e||typeof e!="string")return e||"";if(!((i=this.plugin)!=null&&i.app))return e;if(e.startsWith("[[")&&e.endsWith("]]")){let n=e.slice(2,-2),a=n,o=n.indexOf("|");o!==-1&&(a=n.substring(0,o).trim());let l=this.plugin.app.metadataCache.getFirstLinkpathDest(a,"");return l?l.path.replace(/\.md$/,""):a.replace(/\.md$/,"")}if(e.includes("|")){let a=e.split("|")[0].trim(),o=this.plugin.app.metadataCache.getFirstLinkpathDest(a,"");return o?o.path.replace(/\.md$/,""):a.replace(/\.md$/,"")}if(e.includes("/")){let n=this.plugin.app.metadataCache.getFirstLinkpathDest(e,"");return n?n.path.replace(/\.md$/,""):e.replace(/\.md$/,"")}let r=this.plugin.app.metadataCache.getFirstLinkpathDest(e,"");return r?r.path.replace(/\.md$/,""):e}getPreferredProjectFormat(e){return!e||e==="No Project"?e:e.includes("/")||e.endsWith(".md")?`[[${e}]]`:`[[${e}]]`}async getTaskPathsInDateRange(e,r){let i=new Set,n=Ae(e),a=Ae(r);for(let d=new Date(n);d<=a;d.setDate(d.getDate()+1)){let u=C(d,"yyyy-MM-dd");this.cacheManager.getTaskPathsByDate(u).forEach(p=>i.add(p))}let o=this.cacheManager.getAllTaskPaths(),l=50,c=Array.from(o);for(let d=0;d<c.length;d+=l){let u=c.slice(d,d+l),h=await Promise.all(u.map(p=>this.cacheManager.getCachedTaskInfo(p)));for(let p of h)if(p&&p.recurrence&&!p.due){for(let f=new Date(n);f<=a;f.setDate(f.getDate()+1))if(vl(p,f)){i.add(p.path);break}}}return i}getOverdueTaskPaths(){return this.cacheManager.getOverdueTaskPaths()}combineTaskPathSets(e){let r=new Set;return e.forEach(i=>{i.forEach(n=>r.add(n))}),r}isDateInRange(e,r,i){try{let n=ue(e),a=ue(r),o=ue(i),l=Fd(n),c=Fd(a),d=Fd(o);return l>=c&&l<=d}catch(n){return console.error("Error checking date range:",{dateString:e,startDateString:r,endDateString:i,error:n}),!1}}isSameDayAs(e,r){try{let i=C(e,"yyyy-MM-dd");return At(i,r)}catch(i){return console.error("Error comparing date object with date string:",{dateObj:e,dateString:r,error:i}),!1}}sortTasks(e,r,i){return e.sort((n,a)=>{let o=0;if(typeof r=="string"&&r.startsWith("user:"))o=this.compareByUserField(n,a,r);else switch(r){case"due":o=this.compareDates(n.due,a.due);break;case"scheduled":o=this.compareDates(n.scheduled,a.scheduled);break;case"priority":o=this.comparePriorities(n.priority,a.priority);break;case"title":o=n.title.localeCompare(a.title);break;case"dateCreated":o=this.compareDates(n.dateCreated,a.dateCreated);break;case"tags":o=this.compareTags(n.tags,a.tags);break}return o===0&&(o=this.applyFallbackSorting(n,a,r)),i==="desc"?-o:o})}compareDates(e,r){if(!e&&!r)return 0;if(!e)return 1;if(!r)return-1;try{return Ls(e,r)?-1:Ls(r,e)?1:0}catch(i){return console.error("Error comparing dates time-aware:",{dateA:e,dateB:r,error:i}),e.localeCompare(r)}}comparePriorities(e,r){let i=this.priorityManager.getPriorityWeight(e);return this.priorityManager.getPriorityWeight(r)-i}compareTags(e,r){let i=e&&e.length>0?e:[],n=r&&r.length>0?r:[];if(i.length===0&&n.length===0)return 0;if(i.length===0)return 1;if(n.length===0)return-1;let a=i[0].toLowerCase(),o=n[0].toLowerCase();return a.localeCompare(o)}applyFallbackSorting(e,r,i){let a=["scheduled","due","priority","title"].filter(o=>o!==i);for(let o of a){let l=0;switch(o){case"scheduled":l=this.compareDates(e.scheduled,r.scheduled);break;case"due":l=this.compareDates(e.due,r.due);break;case"priority":l=this.comparePriorities(e.priority,r.priority);break;case"title":l=e.title.localeCompare(r.title);break}if(l!==0)return l}return 0}compareByUserField(e,r,i){var u,h;let n=i.slice(5),o=(((h=(u=this.plugin)==null?void 0:u.settings)==null?void 0:h.userFields)||[]).find(p=>(p.id||p.key)===n);if(!o)return 0;let l=p=>{var f;try{let m=this.cacheManager.getApp(),g=m.vault.getAbstractFileByPath(p.path),y=g?(f=m.metadataCache.getFileCache(g))==null?void 0:f.frontmatter:void 0;return y?y[o.key]:void 0}catch(m){return}},c=l(e),d=l(r);switch(o.type){case"number":{let p=typeof c=="number"?c:c!=null?parseFloat(String(c)):NaN,f=typeof d=="number"?d:d!=null?parseFloat(String(d)):NaN,m=!isNaN(p),g=!isNaN(f);return m&&g?p-f:m&&!g?-1:!m&&g?1:0}case"boolean":{let p=g=>{if(typeof g=="boolean")return g;if(g==null)return;let y=String(g).trim().toLowerCase();if(y==="true")return!0;if(y==="false")return!1},f=p(c),m=p(d);return f===m?0:f===!0?-1:m===!0?1:f===!1?-1:m===!1?1:0}case"date":{let p=c?Date.parse(String(c)):NaN,f=d?Date.parse(String(d)):NaN,m=!isNaN(p),g=!isNaN(f);return m&&g?p-f:m&&!g?-1:!m&&g?1:0}case"list":{let p=g=>{if(Array.isArray(g))return this.normalizeUserListValue(g)[0];if(typeof g=="string")return g.trim().length===0?"":this.normalizeUserListValue(g)[0]},f=p(c),m=p(d);return(f==null||f==="")&&(m==null||m==="")?0:f==null||f===""?1:m==null||m===""?-1:f.localeCompare(m)}case"text":default:{let p=c!=null?String(c):"",f=d!=null?String(d):"";return p.localeCompare(f)}}}groupTasks(e,r,i){if(r==="none")return new Map([["all",e]]);let n=new Map;for(let a of e)if(r==="project"){let o=fr(a.projects||[]);if(o.length>0)for(let l of o){let c=this.resolveProjectToAbsolutePath(l);n.has(c)||n.set(c,[]),n.get(c).push(a)}else{let l="No Project";n.has(l)||n.set(l,[]),n.get(l).push(a)}}else if(r==="tags"){let o=a.tags||[];if(o.length>0)for(let l of o)n.has(l)||n.set(l,[]),n.get(l).push(a);else{let l="No Tags";n.has(l)||n.set(l,[]),n.get(l).push(a)}}else{let o;if(typeof r=="string"&&r.startsWith("user:"))o=this.getUserFieldGroupValue(a,r);else switch(r){case"status":o=a.status||"no-status";break;case"priority":o=a.priority||"unknown";break;case"context":o=a.contexts&&a.contexts.length>0?a.contexts[0]:"none";break;case"due":o=this.getDueDateGroup(a,i);break;case"scheduled":o=this.getScheduledDateGroup(a,i);break;default:o="unknown"}n.has(o)||n.set(o,[]),n.get(o).push(a)}return this.sortGroups(n,r)}getUserFieldGroupValue(e,r){var o,l,c;let i=r.slice(5),a=(((l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.userFields)||[]).find(d=>(d.id||d.key)===i);if(!a)return"unknown-field";try{let d=this.cacheManager.getApp(),u=d.vault.getAbstractFileByPath(e.path);if(!u)return"no-value";let h=(c=d.metadataCache.getFileCache(u))==null?void 0:c.frontmatter,p=h?h[a.key]:void 0;switch(a.type){case"boolean":{if(typeof p=="boolean")return p?"true":"false";if(p==null)return"no-value";let f=String(p).trim().toLowerCase();return f==="true"?"true":f==="false"?"false":"no-value"}case"number":{if(typeof p=="number")return String(p);if(typeof p=="string"){let f=p.match(/^(\d+(?:\.\d+)?)/);return f?f[1]:"non-numeric"}return"no-value"}case"date":return p?String(p):"no-date";case"list":{if(Array.isArray(p)){let f=this.normalizeUserListValue(p);return f.length>0?f[0]:"empty"}if(typeof p=="string"){if(p.trim().length===0)return"empty";let f=this.normalizeUserListValue(p);return f.length>0?f[0]:"empty"}return"no-value"}case"text":default:return p?String(p).trim()||"empty":"no-value"}}catch(d){return console.error("Error extracting user field value for grouping",d),"error"}}getDueDateGroup(e,r){var o,l,c;let i=r||new Date;i.setHours(0,0,0,0);let n=this.statusManager.isCompletedStatus(e.status),a=(c=(l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.hideCompletedFromOverdue)!=null?c:!0;if(e.recurrence)if(vl(e,i)){let d=C(i,"yyyy-MM-dd");return this.getDateGroupFromDateStringWithTask(d,n,a)}else return e.due?this.getDateGroupFromDateStringWithTask(e.due,n,a):"No due date";return e.due?this.getDateGroupFromDateStringWithTask(e.due,n,a):"No due date"}getDateGroupFromDateString(e){let r=St();if(Mi(e))return"Overdue";let i=ue(e);if(At(i,r))return"Today";try{let n=new Date;n.setDate(n.getDate()+1);let a=C(n,"yyyy-MM-dd");if(At(i,a))return"Tomorrow";let o=new Date;o.setDate(o.getDate()+7);let l=C(o,"yyyy-MM-dd");return xi(i,l)||At(i,l)?"Next seven days":"Later"}catch(n){return console.error(`Error categorizing date ${e}:`,n),"Invalid Date"}}getDueDateGroupFromDate(e){return this.getDateGroupFromDateString(e)}getDueDateGroupForTask(e){var n,a,o;if(!e.due)return"No due date";let r=this.statusManager.isCompletedStatus(e.status),i=(o=(a=(n=this.plugin)==null?void 0:n.settings)==null?void 0:a.hideCompletedFromOverdue)!=null?o:!0;return this.getDateGroupFromDateStringWithTask(e.due,r,i)}getDateGroupFromDateStringWithTask(e,r,i){let n=St();if(Mi(e,r,i))return"Overdue";let a=ue(e);if(At(a,n))return"Today";try{let o=new Date;o.setDate(o.getDate()+1);let l=C(o,"yyyy-MM-dd");if(At(a,l))return"Tomorrow";let c=new Date;c.setDate(c.getDate()+7);let d=C(c,"yyyy-MM-dd");return xi(a,d)||At(a,d)?"Next seven days":"Later"}catch(o){return console.error(`Error categorizing date ${e}:`,o),"Invalid Date"}}getScheduledDateGroup(e,r){var a,o,l;if(!e.scheduled)return"No scheduled date";let i=this.statusManager.isCompletedStatus(e.status),n=(l=(o=(a=this.plugin)==null?void 0:a.settings)==null?void 0:o.hideCompletedFromOverdue)!=null?l:!0;return this.getScheduledDateGroupForTask(e.scheduled,i,n)}getScheduledDateGroupForTask(e,r,i){let n=St();if(Mi(e,r,i))return"Past scheduled";let a=ue(e);if(At(a,n))return"Today";try{let o=new Date;o.setDate(o.getDate()+1);let l=C(o,"yyyy-MM-dd");if(At(a,l))return"Tomorrow";let c=new Date;c.setDate(c.getDate()+7);let d=C(c,"yyyy-MM-dd");return xi(a,d)||At(a,d)?"Next seven days":"Later"}catch(o){return console.error(`Error categorizing scheduled date ${e}:`,o),"Invalid Date"}}getScheduledDateGroupFromDate(e){let r=St();if(Mi(e))return"Past scheduled";let i=ue(e);if(At(i,r))return"Today";try{let n=new Date;n.setDate(n.getDate()+1);let a=C(n,"yyyy-MM-dd");if(At(i,a))return"Tomorrow";let o=new Date;o.setDate(o.getDate()+7);let l=C(o,"yyyy-MM-dd");return xi(i,l)||At(i,l)?"Next seven days":"Later"}catch(n){return console.error(`Error categorizing scheduled date ${e}:`,n),"Invalid Date"}}sortGroups(e,r){let i=new Map,n;if(typeof r=="string"&&r.startsWith("user:"))n=this.sortUserFieldGroups(Array.from(e.keys()),r),this.currentSortKey===r&&this.currentSortDirection==="desc"&&n.reverse();else switch(r){case"priority":n=Array.from(e.keys()).sort((a,o)=>{let l=this.priorityManager.getPriorityWeight(a);return this.priorityManager.getPriorityWeight(o)-l});break;case"status":n=Array.from(e.keys()).sort((a,o)=>{let l=this.statusManager.getStatusOrder(a),c=this.statusManager.getStatusOrder(o);return l-c});break;case"due":{let a=["Overdue","Today","Tomorrow","Next seven days","Later","No due date"];n=Array.from(e.keys()).sort((o,l)=>{let c=a.indexOf(o),d=a.indexOf(l);return c-d});break}case"scheduled":{let a=["Past scheduled","Today","Tomorrow","Next seven days","Later","No scheduled date"];n=Array.from(e.keys()).sort((o,l)=>{let c=a.indexOf(o),d=a.indexOf(l);return c-d});break}case"project":n=Array.from(e.keys()).sort((a,o)=>a==="No Project"?1:o==="No Project"?-1:a.localeCompare(o));break;case"tags":n=Array.from(e.keys()).sort((a,o)=>a==="No Tags"?1:o==="No Tags"?-1:a.localeCompare(o));break;default:n=Array.from(e.keys()).sort()}for(let a of n)i.set(a,e.get(a));return i}sortUserFieldGroups(e,r){var o,l;let i=r.slice(5),a=(((l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.userFields)||[]).find(c=>(c.id||c.key)===i);if(!a)return e.sort();switch(a.type){case"number":return e.sort((c,d)=>{let u=parseFloat(c),h=parseFloat(d),p=!isNaN(u),f=!isNaN(h);return p&&f?h-u:p&&!f?-1:!p&&f?1:c.localeCompare(d)});case"boolean":return e.sort((c,d)=>c==="true"&&d==="false"?-1:c==="false"&&d==="true"?1:c.localeCompare(d));case"date":return e.sort((c,d)=>{let u=Date.parse(c),h=Date.parse(d),p=!isNaN(u),f=!isNaN(h);return p&&f?u-h:p&&!f?-1:!p&&f?1:c.localeCompare(d)});case"text":case"list":default:return e.sort((c,d)=>c.localeCompare(d))}}async getFilterOptions(){let e=Date.now();if(this.filterOptionsCache&&e-this.filterOptionsCacheTimestamp<this.filterOptionsCacheTTL)return this.filterOptionsCacheHits++,this.filterOptionsCache;let r={statuses:this.statusManager.getAllStatuses(),priorities:this.priorityManager.getAllPriorities(),contexts:this.cacheManager.getAllContexts(),projects:this.cacheManager.getAllProjects(),tags:this.cacheManager.getAllTags(),folders:this.extractUniqueFolders(),userProperties:this.buildUserPropertyDefinitions()};return this.filterOptionsComputeCount++,this.filterOptionsCache=r,this.filterOptionsCacheTimestamp=e,r}buildUserPropertyDefinitions(){var i,n;let e=((n=(i=this.plugin)==null?void 0:i.settings)==null?void 0:n.userFields)||[],r=[];for(let a of e){if(!a||!a.key||!a.displayName)continue;let o=`user:${a.id||a.key}`,l,c;switch(a.type){case"number":l=["is","is-not","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal","is-empty","is-not-empty"],c="number";break;case"date":l=["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],c="date";break;case"boolean":l=["is-checked","is-not-checked"],c="none";break;case"list":l=["contains","does-not-contain","is-empty","is-not-empty"],c="text";break;case"text":default:l=["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],c="text";break}r.push({id:o,label:a.displayName,category:a.type==="boolean"?"boolean":a.type==="number"?"numeric":a.type==="date"?"date":"text",supportedOperators:l,valueInputType:c})}return r}checkAndInvalidateFilterOptionsCache(){if(!this.filterOptionsCache)return;Date.now()-this.filterOptionsCacheTimestamp>3e4&&this.invalidateFilterOptionsCache()}invalidateFilterOptionsCache(){this.filterOptionsCache&&(this.filterOptionsCache=null)}refreshFilterOptions(){this.invalidateFilterOptionsCache()}getFilterOptionsCacheStats(){let e=Date.now(),r=this.filterOptionsCache?e-this.filterOptionsCacheTimestamp:0,i=this.filterOptionsCache?Math.max(0,this.filterOptionsCacheTTL-r):0,n=this.filterOptionsCacheHits+this.filterOptionsComputeCount,a=n>0?(this.filterOptionsCacheHits/n*100).toFixed(1)+"%":"0%";return{cacheHits:this.filterOptionsCacheHits,computeCount:this.filterOptionsComputeCount,hitRate:a,isCurrentlyCached:!!this.filterOptionsCache,cacheAge:r,ttlRemaining:i}}createDefaultQuery(){return{type:"group",id:we.generateId(),conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"}}addQuickToggleCondition(e,r,i){let n=JSON.parse(JSON.stringify(e));if(this.removeQuickToggleCondition(n,r),!i){let a;switch(r){case"showCompleted":a={type:"condition",id:we.generateId(),property:"status.isCompleted",operator:"is-not-checked",value:null};break;case"showArchived":a={type:"condition",id:we.generateId(),property:"archived",operator:"is-not-checked",value:null};break;case"showRecurrent":a={type:"condition",id:we.generateId(),property:"recurrence",operator:"is-empty",value:null};break}n.children.push(a)}return n}removeQuickToggleCondition(e,r){let i;switch(r){case"showCompleted":i="status.isCompleted";break;case"showArchived":i="archived";break;case"showRecurrent":i="recurrence";break}e.children=e.children.filter(n=>n.type==="condition"?n.property!==i:!0)}normalizeQuery(e){let r=this.createDefaultQuery();return{...r,...e,type:"group",id:e.id||r.id,conjunction:e.conjunction||r.conjunction,children:e.children||r.children,sortKey:e.sortKey||r.sortKey,sortDirection:e.sortDirection||r.sortDirection,groupKey:e.groupKey||r.groupKey}}initialize(){this.cacheManager.on("file-updated",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-added",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-deleted",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-renamed",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("indexes-built",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")})}cleanup(){this.clearIndexQueryCache(),this.invalidateFilterOptionsCache(),this.removeAllListeners()}static createDateRangeFromDates(e){if(e.length===0)throw new Error("No dates provided");let r=e[0],i=e[e.length-1];return{start:C(r,"yyyy-MM-dd"),end:C(i,"yyyy-MM-dd")}}static shouldIncludeOverdueForRange(e,r){if(!r)return!1;let n=C(new Date,"yyyy-MM-dd");return e.some(a=>C(a,"yyyy-MM-dd")===n)}async getTasksForDate(e,r,i=!1){let n=ae(e),a=Fs(n),o=this.cacheManager.getAllTaskPaths(),d=(await this.pathsToTaskInfos(Array.from(o))).filter(u=>this.evaluateFilterNode(r,u)).filter(u=>{var h,p,f;if(u.recurrence){let m=Ae(n);return vl(u,m)}if(u.due&&ue(u.due)===n||u.scheduled&&ue(u.scheduled)===n)return!0;if(i&&a){let m=this.statusManager.isCompletedStatus(u.status),g=(f=(p=(h=this.plugin)==null?void 0:h.settings)==null?void 0:p.hideCompletedFromOverdue)!=null?f:!0;if(u.due&&ue(u.due)!==n&&Mi(u.due,m,g)||u.scheduled&&ue(u.scheduled)!==n&&Mi(u.scheduled,m,g))return!0}return!1});return this.sortTasks(d,r.sortKey||"due",r.sortDirection||"asc")}async getAgendaData(e,r,i=!1){let n=[];for(let a of e){let o=await this.getTasksForDate(a,r,i&&ol(a));n.push({date:new Date(a),tasks:o})}return n}async getFlatAgendaData(e,r,i=!1){let n=await this.getAgendaData(e,r,i),a=[];for(let o of n)for(let l of o.tasks)a.push({...l,agendaDate:o.date});return a}extractUniqueFolders(){let e=this.cacheManager.getAllTaskPaths(),r=new Set;for(let n of e){let a=n.lastIndexOf("/");if(a>0){let o=n.substring(0,a);r.add(o)}else a===-1&&r.add("")}return Array.from(r).sort().map(n=>n===""?"(Root)":n)}extractProjectNamesFromTaskValue(e,r){if(!e||e.trim()===""||e==='""')return[];let i=e.replace(/^"(.*)"$/,"$1");if(i.startsWith("[[")&&i.endsWith("]]")){let n=i.slice(2,-2),a=(0,TM.parseLinktext)(n),o=this.cacheManager.getApp().metadataCache.getFirstLinkpathDest(a.path,r);if(o)return[o.basename];{let l=a.subpath||(a.path.includes("/")?a.path.split("/").pop():a.path);return l?[l]:[]}}else return[i]}};var Zc=class extends Wt.ItemView{constructor(e,r){super(e);this.daysToShow=7;this.groupByDate=!0;this.showOverdueOnToday=!0;this.showNotes=!0;this.showICSEvents=!0;this.filterBar=null;this.filterHeading=null;this.listeners=[];this.functionListeners=[];this.plugin=r,this.startDate=new Date(r.selectedDate),this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"scheduled",sortDirection:"asc",groupKey:"none"},this.registerEvents()}registerEvents(){this.listeners.forEach(o=>this.plugin.emitter.offref(o)),this.listeners=[],this.functionListeners.forEach(o=>o()),this.functionListeners=[];let e=this.plugin.emitter.on(Ft,async()=>{if(this.refresh(),this.filterBar){let o=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(o)}});this.listeners.push(e);let r=this.plugin.emitter.on(mi,async()=>{this.refresh()});this.listeners.push(r);let i=this.plugin.emitter.on(Os,o=>{this.startDate=new Date(o),this.updatePeriodDisplay(),this.refresh()});this.listeners.push(i);let n=this.plugin.emitter.on(Fe,async({path:o,originalTask:l,updatedTask:c})=>{if(c&&await da(c,this.plugin,this.contentEl),this.refresh(),this.filterBar){let d=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(d)}});this.listeners.push(n);let a=this.plugin.filterService.on("data-changed",()=>{this.refresh()});if(this.functionListeners.push(a),this.plugin.icsSubscriptionService){let o=this.plugin.icsSubscriptionService.on("data-changed",()=>{this.refresh()});this.functionListeners.push(o)}}getViewType(){return kt}getDisplayText(){return"Agenda"}getIcon(){return"calendar-clock"}async onOpen(){await this.plugin.onReady(),await this.plugin.waitForMigration();let e=this.plugin.viewStateManager.getFilterState(kt);e&&(this.currentQuery=e);let r=this.contentEl;r.empty();let i=r.createDiv({cls:"tasknotes-plugin agenda-view"});this.showLoadingIndicator(),await this.renderView(i),this.hideLoadingIndicator()}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.functionListeners.forEach(e=>e()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.filterHeading&&(this.filterHeading.destroy(),this.filterHeading=null),this.contentEl.empty()}async renderView(e){e.empty(),await this.createAgendaControls(e),await this.renderAgendaContent(e)}async createAgendaControls(e){let r=e.createDiv({cls:"agenda-view__controls"}),n=r.createDiv({cls:"agenda-view__header"}).createDiv({cls:"agenda-view__header-content"}),a=n.createDiv({cls:"agenda-view__nav-section"}),o=a.createEl("button",{cls:"agenda-view__nav-button agenda-view__nav-button--prev",text:"\u2039",attr:{"aria-label":"Previous period",title:"Previous period"}});o.addClass("clickable-icon");let l=a.createEl("button",{cls:"agenda-view__nav-button agenda-view__nav-button--next",text:"\u203A",attr:{"aria-label":"Next period",title:"Next period"}});l.addClass("clickable-icon"),n.createDiv({cls:"agenda-view__title-section"}).createDiv({cls:"agenda-view__period-title",text:this.getCurrentPeriodText()});let d=n.createDiv({cls:"agenda-view__actions-section"});o.addEventListener("click",()=>{this.navigateToPreviousPeriod()}),l.addEventListener("click",()=>{this.navigateToNextPeriod()});let u=d.createEl("button",{text:"Today",cls:"agenda-view__today-button",attr:{"aria-label":"Go to today",title:"Go to today"}});u.addClass("clickable-icon"),u.addEventListener("click",()=>{let w=Ue();this.startDate=w,this.plugin.setSelectedDate(w),this.updatePeriodDisplay(),this.refresh()});let h=d.createEl("button",{text:"Refresh calendars",cls:"agenda-view__today-button",attr:{"aria-label":"Refresh calendar subscriptions",title:"Refresh calendar subscriptions"}});h.addClass("clickable-icon"),h.addEventListener("click",async()=>{if(!this.plugin.icsSubscriptionService){new Wt.Notice("Calendar service not ready yet");return}try{await this.plugin.icsSubscriptionService.refreshAllSubscriptions(),new Wt.Notice("Calendar subscriptions refreshed"),this.refresh()}catch(w){console.error("Failed to refresh ICS subscriptions",w),new Wt.Notice("Failed to refresh calendar subscriptions")}});let p=r.createDiv({cls:"agenda-view__filter-container"});await this.waitForCacheReady(),this.currentQuery=this.plugin.filterService.createDefaultQuery(),this.currentQuery.sortKey="scheduled",this.currentQuery.sortDirection="asc",this.currentQuery.groupKey="none";let f=this.plugin.viewStateManager.getFilterState(kt);f&&(this.currentQuery=f);let m=await this.plugin.filterService.getFilterOptions();this.filterBar=new ri(this.app,this.plugin,p,this.currentQuery,m,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"agenda"});let g=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(g),this.filterBar.on("saveView",({name:w,query:T,viewOptions:S,visibleProperties:x})=>{let I=this.plugin.viewStateManager.saveView(w,T,S,x);this.filterBar.setActiveSavedView(I)}),this.filterBar.on("deleteView",w=>{this.plugin.viewStateManager.deleteView(w)}),this.filterBar.on("loadViewOptions",w=>{this.applyViewOptions(w)}),this.plugin.viewStateManager.on("saved-views-changed",w=>{var T;(T=this.filterBar)==null||T.updateSavedViews(w)}),this.filterBar.on("reorderViews",(w,T)=>{this.plugin.viewStateManager.reorderSavedViews(w,T)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async w=>{this.currentQuery=w;let T=w;await this.plugin.viewStateManager.setFilterState(kt,T),this.refresh()}),this.filterBar.on("activeSavedViewChanged",()=>{this.updateFilterHeading()}),this.filterBar.on("propertiesChanged",w=>{this.refresh()}),this.filterBar.on("expandAllGroups",()=>{this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(x=>{let I=x;I.classList.remove("is-collapsed");let F=I.querySelector(".agenda-view__day-items");F&&(F.style.display="");let A=I.querySelector(".task-group-toggle");A&&A.setAttr("aria-expanded","true")});let S={...this.plugin.viewStateManager.getViewPreferences(kt)||{},collapsedDays:{}};this.plugin.viewStateManager.setViewPreferences(kt,S)}),this.filterBar.on("collapseAllGroups",()=>{let w={};this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(I=>{let F=I,A=F.dataset.day;A&&(w[A]=!0),F.classList.add("is-collapsed");let L=F.querySelector(".agenda-view__day-items");L&&(L.style.display="none");let G=F.querySelector(".task-group-toggle");G&&G.setAttr("aria-expanded","false")});let x={...this.plugin.viewStateManager.getViewPreferences(kt)||{},collapsedDays:w};this.plugin.viewStateManager.setViewPreferences(kt,x)}),this.filterHeading=new mn(e);let y=e.querySelector(".filter-heading");if(y){let w=y.querySelector(".filter-heading__content");if(w){let T=w.createDiv({cls:"filter-heading__controls"});this.createExpandCollapseButtons(T)}}this.updateFilterHeading(),this.setupViewOptions()}createExpandCollapseButtons(e){e.style.display="flex",e.empty(),new Wt.ButtonComponent(e).setIcon("list-tree").setTooltip("Expand All Days").setClass("agenda-view-control-button").onClick(()=>{this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(l=>{let c=l;c.classList.remove("is-collapsed");let d=c.querySelector(".agenda-view__day-items");d&&(d.style.display="");let u=c.querySelector(".task-group-toggle");u&&u.setAttr("aria-expanded","true")});let o={...this.plugin.viewStateManager.getViewPreferences(kt)||{},collapsedDays:{}};this.plugin.viewStateManager.setViewPreferences(kt,o)}).buttonEl.addClass("clickable-icon"),new Wt.ButtonComponent(e).setIcon("list-collapse").setTooltip("Collapse All Days").setClass("agenda-view-control-button").onClick(()=>{let n={};this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(c=>{let d=c,u=d.dataset.day;u&&(n[u]=!0),d.classList.add("is-collapsed");let h=d.querySelector(".agenda-view__day-items");h&&(h.style.display="none");let p=d.querySelector(".task-group-toggle");p&&p.setAttr("aria-expanded","false")});let l={...this.plugin.viewStateManager.getViewPreferences(kt)||{},collapsedDays:n};this.plugin.viewStateManager.setViewPreferences(kt,l)}).buttonEl.addClass("clickable-icon")}setupViewOptions(){if(!this.filterBar)return;let e=[{id:"showOverdueOnToday",label:"Show overdue on today",value:this.showOverdueOnToday,onChange:r=>{this.showOverdueOnToday=r,this.refresh()}},{id:"showNotes",label:"Show notes",value:this.showNotes,onChange:r=>{this.showNotes=r,this.refresh()}},{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents,onChange:r=>{this.showICSEvents=r,this.refresh()}}];this.filterBar.setViewOptions(e)}applyViewOptions(e){e.hasOwnProperty("showOverdueOnToday")&&(this.showOverdueOnToday=e.showOverdueOnToday),e.hasOwnProperty("showNotes")&&(this.showNotes=e.showNotes),e.hasOwnProperty("icsEvents")&&(this.showICSEvents=e.icsEvents),e.hasOwnProperty("showICSEvents")&&(this.showICSEvents=e.showICSEvents),this.setupViewOptions(),this.refresh()}renderPeriodSelector(e){let r=e.createEl("select",{cls:"agenda-view__period-select"});[{value:"7",text:"7 days"},{value:"14",text:"14 days"},{value:"30",text:"30 days"},{value:"week",text:"This week"}].forEach(n=>{let a=r.createEl("option",{value:n.value,text:n.text});(n.value==="7"&&this.daysToShow===7||n.value==="week"&&this.daysToShow===-1)&&(a.selected=!0)}),r.addEventListener("change",()=>{let n=r.value;n==="week"?this.daysToShow=-1:this.daysToShow=parseInt(n),this.refresh()})}getDateRange(){let e=this.getAgendaDates();return gn.createDateRangeFromDates(e)}async addNotesToAgendaData(e){if(this.plugin.settings.disableNoteIndexing||!this.showNotes)return e.map(i=>({...i,notes:[]}));let r=e.map(async i=>{let n=await this.plugin.cacheManager.getNotesForDate(i.date);return{...i,notes:n}});return Promise.all(r)}async renderAgendaContent(e){let r=e.querySelector(".agenda-view__content");r||(r=e.createDiv({cls:"agenda-view__content"}));try{let i=this.getAgendaDates(),n=[];for(let l of i){let c=await this.plugin.filterService.getTasksForDate(l,this.currentQuery,this.showOverdueOnToday),d=[];if(this.showICSEvents&&this.plugin.icsSubscriptionService){let u=this.plugin.icsSubscriptionService.getAllEvents();d=this.filterICSEventsForDate(u,l)}n.push({date:l,tasks:c,ics:d})}let o=(await this.addNotesToAgendaData(n.map(l=>({date:l.date,tasks:l.tasks})))).map((l,c)=>({...l,ics:n[c].ics}));this.groupByDate?this.renderGroupedAgendaWithReconciler(r,o):this.renderFlatAgendaWithReconciler(r,o)}catch(i){console.error("Error rendering agenda content:",i),r.empty(),r.createDiv({cls:"agenda-view__error"}).createSpan({text:"Error loading agenda. Please try refreshing."})}}filterICSEventsForDate(e,r){try{let i=Pn(r),n=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),a=new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59,999);return e.filter(o=>{let l=new Date(o.start),c=o.end?new Date(o.end):null;return c?l<=a&&c>=n:l>=n&&l<=a})}catch(i){return[]}}renderGroupedAgendaWithReconciler(e,r){e.empty();let i=!1;if(r.forEach(n=>{let a=ae(n.date);if(n.tasks.length>0||n.notes.length>0||this.showICSEvents&&n.ics.length>0){i=!0;let l=a,c=this.isDayCollapsed(l),d=e.createDiv({cls:"agenda-view__day-section task-group"});d.setAttribute("data-day",l);let u=this.createDayHeader(n,l);d.appendChild(u);let h=d.createDiv({cls:"agenda-view__day-items"});c&&(d.addClass("is-collapsed"),h.style.display="none"),this.addDayHeaderClickHandlers(u,d,h,l);let p=[];n.tasks.forEach(f=>{p.push({type:"task",item:f,date:n.date})}),n.notes.forEach(f=>{p.push({type:"note",item:f,date:n.date})}),this.showICSEvents&&[...n.ics].sort((m,g)=>{try{let y=new Date(m.start).getTime(),w=new Date(g.start).getTime();return y-w}catch(y){return 0}}).forEach(m=>{p.push({type:"ics",item:m,date:n.date})}),this.plugin.domReconciler.updateList(h,p,f=>`${f.type}-${f.item.path||f.item.id||"unknown"}`,f=>this.createDayItemElement(f),(f,m)=>this.updateDayItemElement(f,m))}}),!i){e.empty();let n=e.createDiv({cls:"agenda-view__empty"});new Wt.Setting(n).setName("No items scheduled").setHeading(),n.createEl("p",{text:"No items scheduled for this period.",cls:"agenda-view__empty-description"});let a=n.createEl("p",{cls:"agenda-view__empty-tip"});a.createEl("span",{text:"Tip: "}),a.appendChild(document.createTextNode("Create tasks with due or scheduled dates, or add notes to see them here."));return}}renderFlatAgendaWithReconciler(e,r){let i=[];if(r.forEach(n=>{n.tasks.forEach(a=>{i.push({type:"task",item:a,date:n.date})}),n.notes.forEach(a=>{i.push({type:"note",item:a,date:n.date})}),this.showICSEvents&&[...n.ics].sort((o,l)=>{try{let c=new Date(o.start).getTime(),d=new Date(l.start).getTime();return c-d}catch(c){return 0}}).forEach(o=>{i.push({type:"ics",item:o,date:n.date})})}),i.length===0){e.empty();let n=e.createDiv({cls:"agenda-view__empty"});new Wt.Setting(n).setName("No items found").setHeading(),n.createEl("p",{text:"No items found for the selected period.",cls:"agenda-view__empty-description"});return}i.sort((n,a)=>n.date.getTime()-a.date.getTime()),this.plugin.domReconciler.updateList(e,i,n=>`${n.type}-${n.item.path||n.item.id||"unknown"}`,n=>this.createFlatAgendaItemElement(n),(n,a)=>this.updateFlatAgendaItemElement(n,a))}createAgendaItemElement(e){var r,i;if(e.type==="day-header"){let n=document.createElement("div");n.className="agenda-view__day-header task-group-header",n.setAttribute("data-day",e.dayKey);let a=n.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle day"}});try{(0,Wt.setIcon)(a,"chevron-right")}catch(f){}let o=a.querySelector("svg");o?(o.classList.add("chevron"),o.setAttr("width","16"),o.setAttr("height","16")):(a.textContent="\u25B8",a.addClass("chevron-text"));let l=n.createDiv({cls:"agenda-view__day-header-text"}),c=Pn(e.date),d=C(c,"EEEE"),u=C(c,"MMMM d");ol(e.date)?(l.createSpan({cls:"agenda-view__day-name agenda-view__day-name--today",text:"Today"}),l.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${u}`})):(l.createSpan({cls:"agenda-view__day-name",text:d}),l.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${u}`}));let h=e.item.tasks||[],p;if(h.length>0){let f=it.calculateGroupStats(h,this.plugin);p=it.formatGroupCount(f.completed,f.total).text}else p=`${(((r=e.item.notes)==null?void 0:r.length)||0)+(((i=e.item.ics)==null?void 0:i.length)||0)}`;return n.createDiv({cls:"agenda-view__item-count",text:p}),n}else return e.type==="task"?this.createTaskItemElement(e.item,e.date):e.type==="note"?this.createNoteItemElement(e.item,e.date):this.createICSEventItemElement(e.item)}updateAgendaItemElement(e,r){var i,n;if(r.type==="day-header"){let a=e.querySelector(".agenda-view__item-count");if(a){let o=r.item.tasks||[],l;if(o.length>0){let c=it.calculateGroupStats(o,this.plugin);l=it.formatGroupCount(c.completed,c.total).text}else l=`${(((i=r.item.notes)==null?void 0:i.length)||0)+(((n=r.item.ics)==null?void 0:n.length)||0)}`;a.textContent=l}}else if(r.type==="task"){let a=this.getCurrentVisibleProperties();ii(e,r.item,this.plugin,a,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}else r.type==="ics"&&Bh(e,r.item,this.plugin)}createFlatAgendaItemElement(e){return e.type==="task"?this.createTaskItemElement(e.item,e.date):e.type==="note"?this.createNoteItemElement(e.item,e.date):this.createICSEventItemElement(e.item)}updateFlatAgendaItemElement(e,r){if(r.type==="task"){let i=this.getCurrentVisibleProperties();ii(e,r.item,this.plugin,i,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}else r.type==="ics"&&Bh(e,r.item,this.plugin)}getCurrentVisibleProperties(){var e;return(e=this.filterBar)==null?void 0:e.getCurrentVisibleProperties()}createTaskItemElement(e,r){let i=this.getCurrentVisibleProperties(),n=er(e,this.plugin,i,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r});return this.plugin.statusManager.isCompletedStatus(e.status)&&n.classList.add("done"),this.addDragHandlers(n,e),n}createNoteItemElement(e,r){let i=Lh(e,this.plugin,{showCreatedDate:!1,showTags:!0,showPath:!1,maxTags:3,showDailyNoteBadge:!1});if(!this.groupByDate&&r){let n=Pn(r);i.createSpan({cls:"agenda-view__note-date",text:C(n,"MMM d")})}return i}createICSEventItemElement(e){return wM(e,this.plugin,{})}addDragHandlers(e,r){this.plugin.dragDropManager.makeTaskCardDraggable(e,r.path)}addHoverPreview(e,r){e.addEventListener("mouseover",i=>{this.app.vault.getAbstractFileByPath(r)&&this.app.workspace.trigger("hover-link",{event:i,source:"tasknotes-agenda",hoverParent:this,targetEl:e,linktext:r,sourcePath:r})})}openFile(e){let r=this.app.vault.getAbstractFileByPath(e);r instanceof Wt.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}getAgendaDates(){let e=[];if(this.daysToShow===-1){let i={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},n=Yt(this.startDate,i),a=_n(this.startDate,i),o=n;for(;o<=a;){let l=dt(o);e.push(l),o=sr(o,1)}}else for(let r=0;r<this.daysToShow;r++){let i=sr(this.startDate,r),n=dt(i);e.push(n)}return e}navigateToPreviousPeriod(){this.daysToShow===-1?this.startDate=sr(this.startDate,-7):this.startDate=sr(this.startDate,-this.daysToShow),this.updatePeriodDisplay(),this.refresh()}navigateToNextPeriod(){this.daysToShow===-1?this.startDate=sr(this.startDate,7):this.startDate=sr(this.startDate,this.daysToShow),this.updatePeriodDisplay(),this.refresh()}updatePeriodDisplay(){let e=this.contentEl.querySelector(".agenda-view__period-title");e&&(e.textContent=this.getCurrentPeriodText())}getCurrentPeriodText(){let e=this.getAgendaDates();if(e.length===0)return"";let r=Pn(e[0]),i=Pn(e[e.length-1]);return jo(e[0],e[e.length-1])?C(r,"EEEE, MMMM d, yyyy"):`${C(r,"MMM d")} - ${C(i,"MMM d, yyyy")}`}showLoadingIndicator(){let e=this.contentEl.querySelector(".agenda-view");if(!e||e.querySelector(".agenda-view__loading"))return;let r=document.createElement("div");r.className="agenda-view__loading",r.textContent="Loading agenda...",e.prepend(r)}hideLoadingIndicator(){let e=this.contentEl.querySelector(".agenda-view__loading");e&&e.remove()}async updateFilterHeading(){if(!(!this.filterHeading||!this.filterBar))try{let e=this.getAgendaDates(),r=[];for(let a of e){let o=await this.plugin.filterService.getTasksForDate(a,this.currentQuery,this.showOverdueOnToday);r.push(...o)}let i=it.calculateGroupStats(r,this.plugin),n=this.filterBar.activeSavedView||null;this.filterHeading.update(n,i.completed,i.total)}catch(e){console.error("Error updating filter heading in AgendaView:",e)}}async refresh(){let e=this.contentEl.querySelector(".agenda-view");e&&(this.setupViewOptions(),await this.renderAgendaContent(e),this.updateFilterHeading())}createDayHeader(e,r){var f,m;let i=document.createElement("div");i.className="agenda-view__day-header task-group-header",i.setAttribute("data-day",r);let n=i.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle day"}});try{(0,Wt.setIcon)(n,"chevron-right")}catch(g){}let a=n.querySelector("svg");a?(a.classList.add("chevron"),a.setAttr("width","16"),a.setAttr("height","16")):(n.textContent="\u25B8",n.addClass("chevron-text"));let o=i.createDiv({cls:"agenda-view__day-header-text"}),l=Pn(e.date),c=C(l,"EEEE"),d=C(l,"MMMM d");ol(e.date)?(o.createSpan({cls:"agenda-view__day-name agenda-view__day-name--today",text:"Today"}),o.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${d}`})):(o.createSpan({cls:"agenda-view__day-name",text:c}),o.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${d}`}));let u=e.tasks||[],h;if(u.length>0){let g=it.calculateGroupStats(u,this.plugin);h=it.formatGroupCount(g.completed,g.total).text}else h=`${(((f=e.notes)==null?void 0:f.length)||0)+(((m=e.ics)==null?void 0:m.length)||0)}`;i.createDiv({cls:"agenda-view__item-count",text:h});let p=this.isDayCollapsed(r);return n.setAttr("aria-expanded",String(!p)),i}addDayHeaderClickHandlers(e,r,i,n){let a=e.querySelector(".task-group-toggle");this.registerDomEvent(e,"click",o=>{if(o.target.closest("a"))return;let c=!r.hasClass("is-collapsed");this.setDayCollapsed(n,c),r.toggleClass("is-collapsed",c),i.style.display=c?"none":"",a&&a.setAttr("aria-expanded",String(!c))}),a&&this.registerDomEvent(a,"click",o=>{o.preventDefault(),o.stopPropagation();let l=!r.hasClass("is-collapsed");this.setDayCollapsed(n,l),r.toggleClass("is-collapsed",l),i.style.display=l?"none":"",a.setAttr("aria-expanded",String(!l))})}createDayItemElement(e){return e.type==="task"?this.createTaskItemElement(e.item,e.date):e.type==="note"?this.createNoteItemElement(e.item,e.date):this.createICSEventItemElement(e.item)}updateDayItemElement(e,r){if(r.type==="task"){let i=this.getCurrentVisibleProperties();ii(e,r.item,this.plugin,i,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}else r.type==="ics"&&Bh(e,r.item,this.plugin)}isDayCollapsed(e){try{return!!((this.plugin.viewStateManager.getViewPreferences(kt)||{}).collapsedDays||{})[e]}catch(r){return!1}}setDayCollapsed(e,r){let n={...this.plugin.viewStateManager.getViewPreferences(kt)||{}};n.collapsedDays||(n.collapsedDays={}),n.collapsedDays[e]=r,this.plugin.viewStateManager.setViewPreferences(kt,n)}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(e=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),e()})})}};var yn=require("obsidian");var Ao=require("obsidian");Se();ht();var _o=class extends Ao.FuzzySuggestModal{constructor(t,e,r,i){super(t),this.plugin=e,this.tasks=r,this.onChooseTask=i,this.setPlaceholder("Type to search for a task..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText("Select Task"),this.titleEl.setAttribute("id","task-selector-title"),this.containerEl.setAttribute("aria-labelledby","task-selector-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true")}getItems(){return this.tasks.filter(t=>!t.archived).sort((t,e)=>{var l,c;let r=this.plugin.statusManager.isCompletedStatus(t.status),i=this.plugin.statusManager.isCompletedStatus(e.status);if(r!==i)return r?1:-1;if(t.due&&!e.due)return-1;if(!t.due&&e.due)return 1;if(t.due&&e.due){let d=t.due.localeCompare(e.due);if(d!==0)return d}let n={high:0,normal:1,low:2},a=(l=n[t.priority])!=null?l:1,o=(c=n[e.priority])!=null?c:1;return a!==o?a-o:t.title.localeCompare(e.title)})}getItemText(t){let e=t.title;t.due&&(e+=` ${t.due}`),t.priority!=="normal"&&(e+=` ${t.priority}`),t.contexts&&t.contexts.length>0&&(e+=` ${t.contexts.join(" ")}`);let r=fr(t.projects||[]);return r.length>0&&(e+=` ${r.join(" ")}`),e}renderSuggestion(t,e){let r=t.item,i=e.createDiv({cls:"task-selector-modal__suggestion"}),n=i.createDiv({cls:"task-selector-modal__title"}),a=r.priority!=="normal"?`task-selector-modal__task-title--${r.priority}-priority`:"";n.createSpan({cls:`task-selector-modal__task-title ${a}`,text:r.title});let o=i.createDiv({cls:"task-selector-modal__meta"});if(r.due){let c=Fa(r.due),d=Fs(r.due),u=r.due,h="task-selector-modal__due-date";c?(u=`Overdue (${r.due})`,h+=" task-selector-modal__due-date--overdue"):d&&(u="Due today",h+=" task-selector-modal__due-date--today"),o.createSpan({cls:h,text:u})}if(r.contexts&&r.contexts.length>0){let c=o.createSpan({cls:"task-selector-modal__contexts"});r.contexts.forEach((d,u)=>{u>0&&c.createSpan({text:", "}),c.createSpan({cls:"task-selector-modal__context-tag",text:`${d}`})})}let l=fr(r.projects||[]);if(l.length>0){let c=o.createSpan({cls:"task-selector-modal__projects"});l.forEach((d,u)=>{u>0&&c.createSpan({text:", "});let h=document.createTextNode("+");if(c.appendChild(h),c1(d)){let p=d.slice(2,-2);c.createEl("a",{cls:"task-selector-modal__project-link internal-link",text:p,attr:{"data-href":p}}).addEventListener("click",async m=>{m.preventDefault(),m.stopPropagation();let g=this.plugin.app.metadataCache.getFirstLinkpathDest(p,"");g instanceof Ao.TFile?(await this.plugin.app.workspace.getLeaf(!1).openFile(g),this.close()):new Ao.Notice(`Note "${p}" not found`)})}else c.createSpan({cls:"task-selector-modal__project-tag",text:d})})}if(r.status!=="open"){let c=this.plugin.statusManager.getStatusConfig(r.status);o.createSpan({cls:"task-selector-modal__status",text:c?c.label:r.status})}}onChooseItem(t,e){this.onChooseTask(t)}onClose(){super.onClose()}};function c1(s){return!!(s&&typeof s=="string"&&s.startsWith("[[")&&s.endsWith("]]"))}Ss();var Uh=class extends yn.ItemView{constructor(e,r){super(e);this.timerDisplay=null;this.statusDisplay=null;this.progressCircle=null;this.progressContainer=null;this.startButton=null;this.pauseButton=null;this.stopButton=null;this.taskDisplay=null;this.statsDisplay=null;this.taskSelectButton=null;this.taskClearButton=null;this.currentSelectedTask=null;this.taskCardContainer=null;this.addTimeButton=null;this.subtractTimeButton=null;this.skipBreakButton=null;this.statElements={pomodoros:null};this.resizeObserver=null;this.resizeTimeout=null;this.functionListeners=[];this.currentCircleSize=300;this.currentCircumference=0;this.listeners=[];this.plugin=r,this.registerEvents()}getViewType(){return rl}getDisplayText(){return"Pomodoro"}getIcon(){return"clock"}registerEvents(){this.listeners.forEach(o=>this.plugin.emitter.offref(o)),this.listeners=[];let e=this.plugin.emitter.on(Pd,({session:o,task:l})=>{this.updateDisplay(o,l)});this.listeners.push(e);let r=this.plugin.emitter.on(Nd,({session:o,nextType:l})=>{this.onPomodoroComplete(o,l)});this.listeners.push(r);let i=this.plugin.emitter.on(Rd,({session:o})=>{this.updateDisplay()});this.listeners.push(i);let n=this.plugin.emitter.on(fi,({timeRemaining:o,session:l})=>{this.updateTimer(o),this.updateDisplay(l)});this.listeners.push(n);let a=this.plugin.emitter.on(Fe,async({path:o,originalTask:l,updatedTask:c})=>{if(!o||!c)return;if(this.currentSelectedTask&&(this.currentSelectedTask.path===o||l&&this.currentSelectedTask.path===l.path)){this.currentSelectedTask=c,this.updateTaskCardDisplay(c);let u=this.plugin.pomodoroService.getState();u.currentSession&&l&&l.path!==c.path&&u.currentSession.taskPath===l.path&&await this.plugin.pomodoroService.assignTaskToCurrentSession(c)}});this.listeners.push(a)}async onOpen(){await this.plugin.onReady(),await this.render(),this.ensureResizeHandlingSetup(),this.plugin.app.workspace.layoutReady?setTimeout(()=>this.ensureResizeHandlingSetup(),50):this.plugin.app.workspace.onLayoutReady(()=>{this.ensureResizeHandlingSetup()})}async onClose(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.functionListeners.forEach(e=>e()),this.timerDisplay=null,this.statusDisplay=null,this.progressCircle=null,this.progressContainer=null,this.startButton=null,this.pauseButton=null,this.stopButton=null,this.taskDisplay=null,this.statsDisplay=null,this.taskSelectButton=null,this.taskClearButton=null,this.currentSelectedTask=null,this.taskCardContainer=null,this.statElements={pomodoros:null},this.contentEl.empty()}async render(){let e=this.contentEl.createDiv({cls:"tasknotes-plugin pomodoro-view"});this.statusDisplay=e.createDiv({cls:"pomodoro-view__status",text:"Focus"});let r=e.createDiv({cls:"pomodoro-view__timer-section"});this.progressContainer=r.createDiv({cls:"pomodoro-view__progress-container"});let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("class","pomodoro-view__progress-svg"),i.setAttribute("width","300"),i.setAttribute("height","300"),i.setAttribute("viewBox","0 0 300 300"),this.progressContainer.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttributeNS(null,"cx","150"),n.setAttributeNS(null,"cy","150"),n.setAttributeNS(null,"r","140"),n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"stroke","var(--tn-border-color)"),n.setAttributeNS(null,"stroke-width","2"),i.appendChild(n),this.progressCircle=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.progressCircle.setAttributeNS(null,"cx","150"),this.progressCircle.setAttributeNS(null,"cy","150"),this.progressCircle.setAttributeNS(null,"r","140"),this.progressCircle.setAttributeNS(null,"fill","none"),this.progressCircle.setAttributeNS(null,"stroke","var(--tn-interactive-accent)"),this.progressCircle.setAttributeNS(null,"stroke-width","4"),this.progressCircle.setAttributeNS(null,"stroke-linecap","round");let o=2*Math.PI*140;this.progressCircle.setAttributeNS(null,"stroke-dasharray",o.toString()),this.progressCircle.setAttributeNS(null,"stroke-dashoffset",o.toString()),this.progressCircle.addClass("pomodoro-view__progress-circle"),i.appendChild(this.progressCircle);let l=this.progressContainer.createDiv({cls:"pomodoro-view__timer-overlay"}),d=`${this.plugin.settings.pomodoroWorkDuration.toString().padStart(2,"0")}:00`;this.timerDisplay=l.createDiv({cls:"pomodoro-view__timer-display",text:d});let u=l.createDiv({cls:"pomodoro-view__time-controls"});this.subtractTimeButton=u.createEl("button",{cls:"pomodoro-view__time-adjust-button pomodoro-view__subtract-time",text:"-"}),this.addTimeButton=u.createEl("button",{cls:"pomodoro-view__time-adjust-button pomodoro-view__add-time",text:"+"}),this.taskDisplay=e.createDiv({cls:"pomodoro-view__task-display"});let h=e.createDiv({cls:"pomodoro-view__task-selector"}),p=h.createDiv({cls:"pomodoro-view__task-buttons"});this.taskSelectButton=p.createEl("button",{cls:"pomodoro-view__task-select-button",text:"Choose task..."}),this.taskClearButton=p.createEl("button",{cls:"pomodoro-view__task-clear-button pomodoro-view__task-clear-button--hidden",text:"Clear task"}),this.taskCardContainer=h.createDiv({cls:"pomodoro-view__task-card-container"});let f=e.createDiv({cls:"pomodoro-view__control-section"}),m=f.createDiv({cls:"pomodoro-view__primary-controls"});this.startButton=m.createEl("button",{text:"Start",cls:"pomodoro-view__start-button"}),this.pauseButton=m.createEl("button",{text:"Pause",cls:"pomodoro-view__pause-button"}),this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton=m.createEl("button",{text:"Stop",cls:"pomodoro-view__stop-button"}),this.stopButton.addClass("pomodoro-view__stop-button--hidden"),this.skipBreakButton=f.createEl("button",{cls:"pomodoro-view__skip-break-button",text:"Skip break"}),this.skipBreakButton.addClass("pomodoro-view__skip-break-button--hidden");let g=e.createDiv({cls:"pomodoro-view__stats-section"});this.statsDisplay=g.createDiv({cls:"pomodoro-view__stats"});let y=this.statsDisplay.createDiv({cls:"pomodoro-view__stat pomodoro-view__stat--clickable"});if(this.statElements.pomodoros=y.createSpan({cls:"pomodoro-view__stat-value",text:"0"}),y.createSpan({cls:"pomodoro-view__stat-label",text:"completed today"}),this.registerDomEvent(y,"click",()=>{this.plugin.activatePomodoroStatsView()}),this.registerDomEvent(this.startButton,"click",async()=>{var w,T,S;if(!((w=this.startButton)!=null&&w.hasClass("is-loading"))){(T=this.startButton)==null||T.addClass("pomodoro-view__start-button--loading");try{let x=this.plugin.pomodoroService.getState();x.currentSession&&!x.isRunning?await this.plugin.pomodoroService.resumePomodoro():x.nextSessionType==="short-break"?await this.plugin.pomodoroService.startBreak(!1):x.nextSessionType==="long-break"?await this.plugin.pomodoroService.startBreak(!0):await this.plugin.pomodoroService.startPomodoro(this.currentSelectedTask||void 0)}finally{(S=this.startButton)==null||S.removeClass("pomodoro-view__start-button--loading")}}}),this.registerDomEvent(this.pauseButton,"click",()=>{this.plugin.pomodoroService.pausePomodoro()}),this.registerDomEvent(this.stopButton,"click",()=>{this.plugin.pomodoroService.stopPomodoro()}),this.registerDomEvent(this.skipBreakButton,"click",()=>{let w=this.plugin.pomodoroService.getState();w.currentSession?this.plugin.pomodoroService.stopPomodoro():(w.nextSessionType==="short-break"||w.nextSessionType==="long-break")&&this.plugin.pomodoroService.startPomodoro(this.currentSelectedTask||void 0)}),this.registerDomEvent(this.addTimeButton,"click",()=>{this.adjustSessionTime(60)}),this.registerDomEvent(this.subtractTimeButton,"click",()=>{this.adjustSessionTime(-60)}),this.registerDomEvent(this.taskSelectButton,"click",async()=>{await this.openTaskSelector()}),this.registerDomEvent(this.taskClearButton,"click",async()=>{await this.selectTask(null)}),this.restoreLastSelectedTask(),this.updateDisplay(),this.updateStats().catch(w=>{console.error("Failed to update initial stats:",w)}),this.plugin.pomodoroService){let w=this.plugin.pomodoroService.getState();this.updateTimer(w.timeRemaining)}}setupResizeHandling(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.functionListeners.forEach(a=>a()),this.functionListeners=[];let e=this.contentEl.ownerDocument.defaultView||window,r=()=>{this.resizeTimeout&&e.clearTimeout(this.resizeTimeout),this.resizeTimeout=e.setTimeout(()=>{this.updateResponsiveLayout()},150)};if(e.ResizeObserver){this.resizeObserver=new e.ResizeObserver(r);let a=this.contentEl.querySelector(".pomodoro-view");a&&this.resizeObserver.observe(a)}let i=this.plugin.app.workspace.on("layout-change",r);this.listeners.push(i),e.addEventListener("resize",r),this.functionListeners.push(()=>e.removeEventListener("resize",r));let n=this.plugin.app.workspace.on("active-leaf-change",a=>{a===this.leaf&&e.setTimeout(()=>{this.updateResponsiveLayout()},100)});this.listeners.push(n),this.updateResponsiveLayout()}ensureResizeHandlingSetup(e=0){let i=Math.min(100*Math.pow(1.5,e),1e3);setTimeout(()=>{if(!this.resizeObserver){let n=this.contentEl.querySelector(".pomodoro-view");n?n.getBoundingClientRect().width>0?this.setupResizeHandling():e<10&&this.ensureResizeHandlingSetup(e+1):e<10&&this.ensureResizeHandlingSetup(e+1)}},i)}updateResponsiveLayout(){let e=this.contentEl.querySelector(".pomodoro-view");if(!e)return;let r=e.getBoundingClientRect(),i=r.width,n=r.height,a=Math.min(i/600,1),o=Math.min(n/800,1),l=Math.min(a*.7+o*.3,1);e.classList.remove("pomodoro-view--tiny","pomodoro-view--extra-narrow","pomodoro-view--very-narrow","pomodoro-view--narrow","pomodoro-view--small","pomodoro-view--medium-small","pomodoro-view--medium","pomodoro-view--wide"),i<=200?e.classList.add("pomodoro-view--tiny"):i<=250?e.classList.add("pomodoro-view--extra-narrow"):i<=300?e.classList.add("pomodoro-view--very-narrow"):i<=350?e.classList.add("pomodoro-view--narrow"):i<=400?e.classList.add("pomodoro-view--small"):i<=500?e.classList.add("pomodoro-view--medium-small"):i<=600?e.classList.add("pomodoro-view--medium"):e.classList.add("pomodoro-view--wide");let c=e.querySelector(".pomodoro-view__timer-display");if(c){let d,u;i<=200?(d=2,u="700"):i<=250?(d=2.2,u="650"):i<=300?(d=2.5,u="600"):i<=350?(d=3,u="600"):i<=400?(d=3.2,u="550"):i<=500?(d=3.6,u="500"):i<=600?(d=4,u="500"):(d=4.5,u="400");let p=`${Math.max(d*l,1.5).toFixed(1)}rem`;c.style.fontSize=p,c.style.fontWeight=u}this.updateProgressCircleSize(i,n)}updateProgressCircleSize(e,r){if(!this.progressContainer)return;let i=this.progressContainer.querySelector(".pomodoro-view__progress-svg");if(!i)return;let n=Math.min(e*.8,r*.4),a;if(e<=200?a=Math.max(120,Math.min(n,e-40)):e<=250?a=Math.max(150,Math.min(n,e-50)):e<=300?a=Math.max(180,Math.min(n,e-60)):e<=350?a=Math.max(200,Math.min(n,e-70)):e<=400?a=Math.max(230,Math.min(n,e-80)):e<=500?a=Math.max(250,Math.min(n,e-100)):e<=600?a=Math.max(280,Math.min(n,300)):a=Math.max(300,Math.min(n,e*.5,400)),a===this.currentCircleSize)return;this.currentCircleSize=a,i.setAttribute("width",a.toString()),i.setAttribute("height",a.toString()),i.setAttribute("viewBox",`0 0 ${a} ${a}`),this.progressContainer.style.width=`${a}px`,this.progressContainer.style.height=`${a}px`;let o=a/2,l=o-20;if(i.querySelectorAll("circle").forEach(d=>{d.setAttribute("cx",o.toString()),d.setAttribute("cy",o.toString()),d.setAttribute("r",l.toString())}),this.progressCircle){let d=2*Math.PI*l;if(this.currentCircumference=d,this.progressCircle.setAttribute("stroke-dasharray",d.toString()),this.progressCircle.setAttribute("stroke-dashoffset",d.toString()),this.plugin.pomodoroService){let u=this.plugin.pomodoroService.getState();this.updateProgress(u)}}}async openTaskSelector(){try{let r=(await this.plugin.cacheManager.getAllTasks()).filter(n=>!n.archived);if(r.length===0){new yn.Notice("No unarchived tasks found. Create some tasks first.");return}new _o(this.app,this.plugin,r,n=>{this.selectTask(n)}).open()}catch(e){console.error("Error opening task selector:",e),new yn.Notice("Failed to load tasks")}}async selectTask(e){this.currentSelectedTask=e,this.taskSelectButton&&(e?(this.taskSelectButton.textContent="Change task...",(0,yn.setTooltip)(this.taskSelectButton,"Select a different task",{placement:"top"}),this.taskSelectButton.removeClass("pomodoro-view__task-select-button--no-task")):(this.taskSelectButton.textContent="Choose task...",this.taskSelectButton.removeAttribute("title"),this.taskSelectButton.addClass("pomodoro-view__task-select-button--no-task"))),this.taskClearButton&&(e?this.taskClearButton.removeClass("pomodoro-view__task-clear-button--hidden"):this.taskClearButton.addClass("pomodoro-view__task-clear-button--hidden")),this.updateTaskCardDisplay(e),await this.plugin.pomodoroService.saveLastSelectedTask(e==null?void 0:e.path);let r=this.plugin.pomodoroService.getState();r.currentSession&&r.currentSession.type==="work"&&await this.plugin.pomodoroService.assignTaskToCurrentSession(e||void 0)}updateTaskCardDisplay(e){if(this.taskCardContainer)if(this.taskCardContainer.empty(),e){let r=er(e,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!0,showRecurringControls:!1,groupByDate:!1});this.taskCardContainer.appendChild(r),this.taskCardContainer.removeClass("pomodoro-view__task-card-container--empty")}else this.taskCardContainer.addClass("pomodoro-view__task-card-container--empty")}async restoreLastSelectedTask(){try{if(!this.plugin.pomodoroService){console.log("PomodoroView: pomodoroService not available, skipping restore");return}let e=await this.plugin.pomodoroService.getLastSelectedTaskPath();if(e){let r=await this.plugin.cacheManager.getTaskByPath(e);r&&!this.plugin.statusManager.isCompletedStatus(r.status)&&!r.archived&&await this.selectTask(r)}}catch(e){console.error("Error restoring last selected task:",e)}}async updateTaskButtonFromPath(e){try{let r=await this.plugin.cacheManager.getTaskInfo(e);if(r){this.currentSelectedTask=r,this.taskSelectButton&&(this.taskSelectButton.textContent="Change task...",(0,yn.setTooltip)(this.taskSelectButton,"Select a different task",{placement:"top"}),this.taskSelectButton.removeClass("pomodoro-no-task"),this.taskSelectButton.removeClass("pomodoro-view__task-select-button--no-task")),this.taskClearButton&&this.taskClearButton.removeClass("pomodoro-view__task-clear-button--hidden"),this.updateTaskCardDisplay(r);return}this.currentSelectedTask=null,this.taskSelectButton&&(this.taskSelectButton.textContent="Choose task...",this.taskSelectButton.removeAttribute("title"),this.taskSelectButton.addClass("pomodoro-view__task-select-button--no-task")),this.taskClearButton&&this.taskClearButton.addClass("pomodoro-view__task-clear-button--hidden"),this.updateTaskCardDisplay(null)}catch(r){console.error("Error updating task button from path:",r)}}updateDisplay(e,r){var n,a;if(!this.plugin.pomodoroService){this.statusDisplay&&(this.statusDisplay.textContent="Ready to start",this.statusDisplay.className="pomodoro-status pomodoro-view__status");return}let i=this.plugin.pomodoroService.getState();if(this.updateTimer(i.timeRemaining),this.updateProgress(i),this.statusDisplay)if(i.isRunning&&i.currentSession){let o=i.currentSession.type==="work"?"Working":i.currentSession.type==="short-break"?"Short break":"Long break";this.statusDisplay.textContent=o,this.statusDisplay.className=`pomodoro-status pomodoro-view__status pomodoro-status-${i.currentSession.type} pomodoro-view__status--${i.currentSession.type}`}else i.currentSession&&!i.isRunning?(this.statusDisplay.textContent="Paused",this.statusDisplay.className="pomodoro-status pomodoro-view__status pomodoro-status-paused pomodoro-view__status--paused"):(this.statusDisplay.textContent="Ready to start",this.statusDisplay.className="pomodoro-status pomodoro-view__status");if(this.taskDisplay){let o=(n=i.currentSession)==null?void 0:n.taskPath,l=this.taskDisplay.dataset.currentTaskPath;o!==l&&(this.taskDisplay.empty(),this.taskDisplay.dataset.currentTaskPath=o||"")}if(this.taskSelectButton&&(a=i.currentSession)!=null&&a.taskPath&&!this.currentSelectedTask&&this.updateTaskButtonFromPath(i.currentSession.taskPath),this.startButton&&this.pauseButton&&this.stopButton&&(i.isRunning?(this.startButton.addClass("pomodoro-view__start-button--hidden"),this.pauseButton.removeClass("pomodoro-view__pause-button--hidden"),this.stopButton.removeClass("pomodoro-view__stop-button--hidden")):i.currentSession?(this.startButton.removeClass("pomodoro-view__start-button--hidden"),this.startButton.textContent="Resume",this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton.removeClass("pomodoro-view__stop-button--hidden")):(this.startButton.removeClass("pomodoro-view__start-button--hidden"),i.nextSessionType==="short-break"?this.startButton.textContent="Start Short Break":i.nextSessionType==="long-break"?this.startButton.textContent="Start Long Break":this.startButton.textContent="Start",this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton.addClass("pomodoro-view__stop-button--hidden"))),this.skipBreakButton){let o=i.currentSession&&(i.currentSession.type==="short-break"||i.currentSession.type==="long-break"),l=!i.currentSession&&(i.nextSessionType==="short-break"||i.nextSessionType==="long-break");o||l?(this.skipBreakButton.removeClass("pomodoro-view__skip-break-button--hidden"),this.skipBreakButton.textContent="Skip break"):this.skipBreakButton.addClass("pomodoro-view__skip-break-button--hidden")}this.addTimeButton&&this.subtractTimeButton&&(this.addTimeButton.removeClass("pomodoro-view__time-adjust-button--hidden"),this.subtractTimeButton.removeClass("pomodoro-view__time-adjust-button--hidden")),this.updateStats().catch(o=>{console.error("Failed to update stats:",o)})}updateTimer(e){if(this.timerDisplay){let r=Math.max(0,Math.floor(e)),i=Math.floor(r/60),n=r%60;this.timerDisplay.textContent=`${i.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`,r<=60&&r>0?this.timerDisplay.addClass("pomodoro-view__timer-display--warning"):this.timerDisplay.removeClass("pomodoro-view__timer-display--warning")}}updateProgress(e){if(!this.progressCircle)return;let r=this.currentCircumference;if(r===0){let c=this.progressCircle.getAttribute("r"),d=c?parseInt(c):140;r=2*Math.PI*d,this.currentCircumference=r}if(!e.currentSession){this.progressCircle.setAttributeNS(null,"stroke-dashoffset",r.toString()),this.progressCircle.removeClass("pomodoro-view__progress-circle--work"),this.progressCircle.removeClass("pomodoro-view__progress-circle--short-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--long-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--warning");return}let i=e.currentSession.activePeriods||[],n=0;for(let c of i)if(c.endTime){let d=new Date(c.startTime).getTime(),u=new Date(c.endTime).getTime();n+=Math.floor((u-d)/1e3)}else if(e.isRunning){let d=new Date(c.startTime).getTime(),u=Date.now();n+=Math.floor((u-d)/1e3)}let a=e.currentSession.plannedDuration*60,o=a>0?Math.max(0,Math.min(1,n/a)):0,l=r-o*r;this.progressCircle.setAttributeNS(null,"stroke-dashoffset",l.toString()),this.progressCircle.removeClass("pomodoro-view__progress-circle--work"),this.progressCircle.removeClass("pomodoro-view__progress-circle--short-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--long-break"),this.progressCircle.addClass(`pomodoro-view__progress-circle--${e.currentSession.type}`),e.timeRemaining<=60&&e.timeRemaining>0?this.progressCircle.addClass("pomodoro-view__progress-circle--warning"):this.progressCircle.removeClass("pomodoro-view__progress-circle--warning")}async updateStats(){try{if(!this.plugin.pomodoroService){this.statElements.pomodoros&&(this.statElements.pomodoros.textContent="0");return}let e=await this.plugin.pomodoroService.getTodayStats();this.statElements.pomodoros&&this.statElements.pomodoros.textContent!==e.pomodorosCompleted.toString()&&(this.statElements.pomodoros.textContent=e.pomodorosCompleted.toString())}catch(e){console.error("Failed to update stats:",e),this.statElements.pomodoros&&(this.statElements.pomodoros.textContent="0")}}adjustSessionTime(e){if(!this.plugin.pomodoroService)return;let r=this.plugin.pomodoroService.getState();if(r.currentSession)this.plugin.pomodoroService.adjustSessionTime(e);else{let i=Math.max(60,r.timeRemaining+e);this.plugin.pomodoroService.adjustPreparedTimer(i)}if(this.plugin.pomodoroService){let i=this.plugin.pomodoroService.getState();this.updateTimer(i.timeRemaining),this.updateProgress(i)}}onPomodoroComplete(e,r){if(this.updateDisplay(),this.statusDisplay)if(e.type==="work"){let i=r==="long-break";this.statusDisplay.textContent=`Great work! Time for a ${i?"long":"short"} break`}else this.statusDisplay.textContent="Break complete! Ready for the next pomodoro?"}};var Es=require("obsidian");ot();Se();function Jc(s){if(s.activePeriods&&Array.isArray(s.activePeriods))return s.activePeriods.filter(t=>t.endTime).reduce((t,e)=>{let r=new Date(e.startTime),n=new Date(e.endTime).getTime()-r.getTime();return t+Math.round(n/(1e3*60))},0);if(s.duration!==void 0)return s.duration;if(s.startTime&&s.endTime){let t=new Date(s.startTime),r=new Date(s.endTime).getTime()-t.getTime();return Math.round(r/(1e3*60))}return 0}var bM=`
  let timerInterval;

  self.onmessage = function(e) {
    const { command, duration } = e.data;

    if (command === 'start') {
      if (timerInterval) {
        clearInterval(timerInterval);
      }

      let timeRemaining = duration;
      timerInterval = setInterval(() => {
        timeRemaining--;
        // Notificar al hilo principal cada segundo para actualizar la UI
        self.postMessage({ type: 'tick', timeRemaining: timeRemaining });

        if (timeRemaining <= 0) {
          self.postMessage({ type: 'done' });
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }, 1000);

    } else if (command === 'stop') {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }
  };
`;var $h=class extends Es.ItemView{constructor(e,r){super(e);this.overviewStatsEl=null;this.todayStatsEl=null;this.weekStatsEl=null;this.recentSessionsEl=null;this.overallStatsEl=null;this.plugin=r}getViewType(){return il}getDisplayText(){return"Pomodoro stats"}getIcon(){return"bar-chart"}calculateActualDuration(e){return e.filter(r=>r.endTime).reduce((r,i)=>{let n=new Date(i.startTime),o=(i.endTime?new Date(i.endTime):new Date).getTime()-n.getTime();return r+Math.round(o/(1e3*60))},0)}async onOpen(){await this.plugin.onReady(),await this.render()}async onClose(){this.contentEl.empty()}async render(){let e=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container pomodoro-stats-container pomodoro-stats-view"}),r=e.createDiv({cls:"pomodoro-stats-header pomodoro-stats-view__header"});new Es.Setting(r).setName("Pomodoro statistics").setHeading();let i=r.createEl("button",{cls:"pomodoro-stats-refresh-button pomodoro-stats-view__refresh-button",text:"Refresh"});this.registerDomEvent(i,"click",()=>{this.refreshStats()});let n=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Es.Setting(n).setName("Overview").setHeading(),this.overviewStatsEl=n.createDiv({cls:"pomodoro-overview-grid pomodoro-stats-view__overview-grid"});let a=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Es.Setting(a).setName("Today").setHeading(),this.todayStatsEl=a.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let o=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Es.Setting(o).setName("This week").setHeading(),this.weekStatsEl=o.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let l=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Es.Setting(l).setName("All time").setHeading(),this.overallStatsEl=l.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let c=e.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Es.Setting(c).setName("Recent sessions").setHeading(),this.recentSessionsEl=c.createDiv({cls:"pomodoro-recent-sessions pomodoro-stats-view__recent-sessions"}),await this.refreshStats()}async refreshStats(){try{await Promise.all([this.updateOverviewStats(),this.updateTodayStats(),this.updateWeekStats(),this.updateOverallStats(),this.updateRecentSessions()])}catch(e){console.error("Failed to refresh stats:",e)}}async updateOverviewStats(){if(!this.overviewStatsEl)return;let e=await this.plugin.pomodoroService.getTodayStats(),r=await this.calculateOverallStatsFromHistory(),i=Ue(),n=new Date(i);n.setDate(n.getDate()-1);let a=dt(n),o=await this.calculateStatsForRange(a,a);this.renderOverviewStats(this.overviewStatsEl,e,r,o)}async updateTodayStats(){if(!this.todayStatsEl)return;let e=await this.plugin.pomodoroService.getTodayStats();this.renderStatsGrid(this.todayStatsEl,e)}async updateWeekStats(){if(!this.weekStatsEl)return;let e=Ue(),r=dt(e),n={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},a=Yt(r,n),o=_n(r,n),l=await this.calculateStatsForRange(a,o);this.renderStatsGrid(this.weekStatsEl,l)}async updateOverallStats(){if(!this.overallStatsEl)return;let e=await this.plugin.pomodoroService.getSessionHistory(),r=this.calculateOverallStats(e);this.renderStatsGrid(this.overallStatsEl,r)}async calculateOverallStatsFromHistory(){let e=await this.plugin.pomodoroService.getSessionHistory();return this.calculateOverallStats(e)}async updateRecentSessions(){var i;if(!this.recentSessionsEl)return;let r=(await this.plugin.pomodoroService.getSessionHistory()).filter(n=>n.type==="work").slice(-10).reverse();if(this.recentSessionsEl.empty(),r.length===0){this.recentSessionsEl.createDiv({cls:"pomodoro-no-sessions pomodoro-stats-view__no-sessions",text:"No sessions recorded yet"});return}for(let n of r){let a=this.recentSessionsEl.createDiv({cls:"pomodoro-session-item pomodoro-stats-view__session-item"}),o=a.createSpan({cls:"session-date pomodoro-stats-view__session-date"});o.textContent=C(new Date(n.startTime),"MMM d, HH:mm");let l=a.createSpan({cls:"session-duration pomodoro-stats-view__session-duration"}),c=Jc(n);l.textContent=`${c}min`;let d=a.createSpan({cls:"session-status pomodoro-stats-view__session-status"});if(d.textContent=n.completed?"Completed":"Interrupted",d.addClass(n.completed?"status-completed":"status-interrupted"),d.addClass(n.completed?"pomodoro-stats-view__session-status--completed":"pomodoro-stats-view__session-status--interrupted"),n.taskPath){let u=a.createSpan({cls:"session-task pomodoro-stats-view__session-task"}),h=((i=n.taskPath.split("/").pop())==null?void 0:i.replace(".md",""))||"";u.textContent=h}}}renderOverviewStats(e,r,i,n){e.empty();let a=y=>{if(y<60)return`${y}m`;let w=Math.floor(y/60),T=y%60;return T>0?`${w}h${T}m`:`${w}h`},o=r.pomodorosCompleted-n.pomodorosCompleted,l=r.totalMinutes-n.totalMinutes,c=e.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),d=c.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});if(d.textContent=r.pomodorosCompleted.toString(),c.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Today's Pomos"}),o!==0){let y=c.createDiv({cls:"overview-change pomodoro-stats-view__overview-change"});y.textContent=`${o>0?"+":""}${o} from yesterday`,y.addClass(o>0?"positive":"negative")}let u=e.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),h=u.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});h.textContent=i.pomodorosCompleted.toString(),u.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Total Pomos"});let p=e.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),f=p.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});if(f.textContent=a(r.totalMinutes),p.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Today's Focus"}),l!==0){let y=p.createDiv({cls:"overview-change pomodoro-stats-view__overview-change"});y.textContent=`${a(Math.abs(l))} ${l>0?"more":"less"} than yesterday`,y.addClass(l>0?"positive":"negative")}let m=e.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),g=m.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});g.textContent=a(i.totalMinutes),m.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Total Focus Duration"})}renderStatsGrid(e,r){e.empty();let i=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});i.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.pomodorosCompleted.toString()}),i.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Pomodoros"});let n=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});n.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.currentStreak.toString()}),n.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Streak"});let a=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});a.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.totalMinutes.toString()}),a.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Minutes"});let o=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});o.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.averageSessionLength.toString()}),o.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Avg Length"});let l=e.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});l.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:`${r.completionRate}%`}),l.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Completion"})}async calculateStatsForRange(e,r){let i=await this.plugin.pomodoroService.getSessionHistory(),n=Ot(e),a=Ot(r),o=i.filter(l=>{try{let c=lf(l.startTime),d=Ot(c);return d>=n&&d<=a}catch(c){return console.error("Error parsing session timestamp for filtering:",{sessionStartTime:l.startTime,error:c}),!1}});return this.calculateStatsFromSessions(o)}calculateOverallStats(e){return this.calculateStatsFromSessions(e)}calculateStatsFromSessions(e){let r=e.filter(c=>c.type==="work"),i=r.filter(c=>c.completed),n=0;for(let c=r.length-1;c>=0&&r[c].completed;c--)n++;let a=i.reduce((c,d)=>c+Jc(d),0),o=i.length>0?a/i.length:0,l=r.length>0?i.length/r.length*100:0;return{pomodorosCompleted:i.length,currentStreak:n,totalMinutes:a,averageSessionLength:Math.round(o),completionRate:Math.round(l)}}};var zi=require("obsidian");ot();ht();Se();Ss();var Vh=class extends zi.ItemView{constructor(e,r){super(e);this.overviewStatsEl=null;this.todayStatsEl=null;this.weekStatsEl=null;this.monthStatsEl=null;this.projectsStatsEl=null;this.filtersEl=null;this.currentFilters={dateRange:"all",selectedProjects:[],minTimeSpent:0};this.drilldownModal=null;this.currentDrilldownData=null;this.listeners=[];this.statsCache=new Map;this.lastCacheTime=0;this.CACHE_DURATION=6e4;this.debounceTimeout=null;this.plugin=r}getViewType(){return sl}getDisplayText(){return"Statistics"}getIcon(){return"bar-chart-4"}async onOpen(){await this.plugin.onReady();let e=this.plugin.emitter.on(Fe,async({path:r,originalTask:i,updatedTask:n})=>{if(!r||!n||!this.drilldownModal||!this.currentDrilldownData)return;this.currentDrilldownData.tasks.some(o=>o.path===r||i&&o.path===i.path)&&await this.refreshDrilldownModal()});this.listeners.push(e),await this.render()}async onClose(){this.contentEl.empty(),this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.listeners=[]}async render(){let e=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container stats-container stats-view"}),r=e.createDiv({cls:"stats-header stats-view__header"});new zi.Setting(r).setName("Task & Project Statistics").setHeading();let i=r.createEl("button",{cls:"stats-refresh-button stats-view__refresh-button",text:"Refresh"});this.registerDomEvent(i,"click",()=>{this.refreshStats()});let n=e.createDiv({cls:"stats-section stats-view__section"});new zi.Setting(n).setName("Filters").setHeading(),this.filtersEl=n.createDiv({cls:"stats-filters stats-view__filters"}),this.renderFilters();let a=e.createDiv({cls:"stats-section stats-view__section"});new zi.Setting(a).setName("Overview").setHeading(),this.overviewStatsEl=a.createDiv({cls:"stats-overview-grid stats-view__overview-grid"});let o=e.createDiv({cls:"stats-section stats-view__section"});new zi.Setting(o).setName("Today").setHeading(),this.todayStatsEl=o.createDiv({cls:"stats-grid stats-view__stats-grid"});let l=e.createDiv({cls:"stats-section stats-view__section"});new zi.Setting(l).setName("This Week").setHeading(),this.weekStatsEl=l.createDiv({cls:"stats-grid stats-view__stats-grid"});let c=e.createDiv({cls:"stats-section stats-view__section"});new zi.Setting(c).setName("This Month").setHeading(),this.monthStatsEl=c.createDiv({cls:"stats-grid stats-view__stats-grid"});let d=e.createDiv({cls:"stats-section stats-view__section"});new zi.Setting(d).setName("Project Breakdown").setHeading(),this.projectsStatsEl=d.createDiv({cls:"stats-projects stats-view__projects"}),await this.refreshStats()}async refreshStats(){try{this.clearCache();let e=await Promise.allSettled([this.updateOverviewStats(),this.updateTodayStats(),this.updateWeekStats(),this.updateMonthStats(),this.updateProjectStats()])}catch(e){}}async getAllTasks(){let e=`all-tasks-${JSON.stringify(this.currentFilters)}`;if(this.isCacheValid()&&this.statsCache.has(e)){let n=this.statsCache.get(e);if(n)return n}let r=await this.plugin.cacheManager.getAllTaskPaths(),i=[];for(let n of r)try{let a=await this.plugin.cacheManager.getTaskInfo(n);a&&i.push(a)}catch(a){}return i=this.applyTaskFilters(i),this.statsCache.set(e,i),this.lastCacheTime=Date.now(),i}applyTaskFilters(e){let r=e,i=this.getFilterDateRange();return(i.start||i.end)&&(r=r.filter(n=>{if(n.timeEntries&&n.timeEntries.length>0)return n.timeEntries.some(a=>{if(!a.startTime)return!1;let o=new Date(a.startTime);return!(i.start&&o<i.start||i.end&&o>i.end)});if(n.completedDate){let a=new Date(n.completedDate);return!(i.start&&a<i.start||i.end&&a>i.end)}if(n.dateCreated){let a=new Date(n.dateCreated);return!(i.start&&a<i.start||i.end&&a>i.end)}return!(i.start||i.end)})),this.currentFilters.minTimeSpent>0&&(r=r.filter(n=>pr(n.timeEntries||[])>=this.currentFilters.minTimeSpent)),r}async updateOverviewStats(){if(!this.overviewStatsEl)return;let e=await this.getAllTasks(),r=this.calculateOverallStats(e);this.renderOverviewStats(this.overviewStatsEl,r)}async updateTodayStats(){if(!this.todayStatsEl)return;let e=Ue(),r=dt(e),i=Ot(r),n=await this.calculateStatsForRange(i,r);this.renderTimeRangeStats(this.todayStatsEl,n)}async updateWeekStats(){if(!this.weekStatsEl)return;let e=Ue(),r=dt(e),n={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},a=Yt(r,n),o=_n(r,n),l=await this.calculateStatsForRange(a,o);this.renderTimeRangeStats(this.weekStatsEl,l)}async updateMonthStats(){if(!this.monthStatsEl)return;let e=Ue(),r=dt(e),i=Hp(r),n=Lp(r),a=await this.calculateStatsForRange(i,n);this.renderTimeRangeStats(this.monthStatsEl,a)}async updateProjectStats(){if(!this.projectsStatsEl)return;let e=await this.getAllTasks(),r=this.calculateProjectStats(e);await this.renderProjectStats(this.projectsStatsEl,r)}consolidateProjectName(e){var r;if(!e||typeof e!="string")return e;if(e.startsWith("[[")&&e.endsWith("]]")){let i=this.extractWikilinkPath(e);if(i&&((r=this.plugin)!=null&&r.app)){let n=this.plugin.app.metadataCache.getFirstLinkpathDest(i,"");if(n)return n.basename;let a=this.extractProjectName(e);if(a)return a}}if(e.includes("|")){let i=e.split("|");return i[i.length-1]||e}if(e.includes("/")){let i=e.split("/");return i[i.length-1]||e}return e}extractWikilinkPath(e){if(!e||typeof e!="string"||!e.startsWith("[[")||!e.endsWith("]]"))return null;let r=e.slice(2,-2),i=r.indexOf("|");return i!==-1?r.substring(0,i).trim():r}extractProjectName(e){if(!e)return null;if(e.startsWith("[[")&&e.endsWith("]]")){let r=this.extractWikilinkPath(e);if(!r)return null;let i=r.split("/");return i[i.length-1]||r}if(e.includes("|")){let r=e.split("|");return r[r.length-1]||e}if(e.includes("/")){let r=e.split("/");return r[r.length-1]||e}return e}calculateOverallStats(e){let r=0,i=0,n=new Set;for(let a of e){r+=pr(a.timeEntries||[]),this.plugin.statusManager.isCompletedStatus(a.status)&&i++;let o=this.getTaskProjects(a);for(let l of o)n.add(l)}return{totalTimeSpent:r,totalTasks:e.length,completedTasks:i,activeProjects:n.size,completionRate:e.length>0?i/e.length*100:0,avgTimePerTask:e.length>0?r/e.length:0}}async calculateStatsForRange(e,r){let n=(await this.getAllTasks()).filter(l=>{if(l.timeEntries&&l.timeEntries.length>0)return l.timeEntries.some(c=>{if(!c.startTime)return!1;let d=new Date(c.startTime);return d>=e&&d<=r});if(l.completedDate){let c=new Date(l.completedDate);return c>=e&&c<=r}if(l.dateCreated){let c=new Date(l.dateCreated);return c>=e&&c<=r}return!1}),a=this.calculateOverallStats(n),o=this.calculateProjectStats(n);return{overall:a,projects:o}}calculateProjectStats(e){let r=new Map;for(let n of e){let a=pr(n.timeEntries||[]),o=this.plugin.statusManager.isCompletedStatus(n.status),l;n.timeEntries&&n.timeEntries.length>0?l=[...n.timeEntries].sort((u,h)=>new Date(h.startTime).getTime()-new Date(u.startTime).getTime())[0].startTime:n.completedDate?l=n.completedDate:n.dateModified&&(l=n.dateModified);let c=this.getTaskProjects(n);for(let d of c){r.has(d)||r.set(d,{tasks:[],totalTime:0,completedCount:0,lastActivity:void 0});let u=r.get(d);u&&(u.tasks.push(n),u.totalTime+=a,o&&u.completedCount++,l&&(!u.lastActivity||new Date(l)>new Date(u.lastActivity))&&(u.lastActivity=l))}}let i=[];for(let[n,a]of r.entries())i.push({projectName:n,totalTimeSpent:a.totalTime,taskCount:a.tasks.length,completedTaskCount:a.completedCount,avgTimePerTask:a.tasks.length>0?a.totalTime/a.tasks.length:0,lastActivity:a.lastActivity});return i.sort((n,a)=>n.projectName==="No Project"?1:a.projectName==="No Project"?-1:a.totalTimeSpent-n.totalTimeSpent),i}renderFilters(){if(!this.filtersEl)return;this.filtersEl.empty();let e=this.filtersEl.createDiv({cls:"stats-view__filter-grid"}),r=e.createDiv({cls:"stats-view__filter-item"}),i=r.createDiv({cls:"stats-view__filter-label"});i.textContent="Date Range";let n=r.createEl("select",{cls:"stats-view__filter-select"}),a=[{value:"all",text:"All Time"},{value:"7days",text:"Last 7 Days"},{value:"30days",text:"Last 30 Days"},{value:"90days",text:"Last 90 Days"},{value:"custom",text:"Custom Range"}];for(let p of a){let f=n.createEl("option",{value:p.value,text:p.text});p.value===this.currentFilters.dateRange&&(f.selected=!0)}this.registerDomEvent(n,"change",()=>{this.currentFilters.dateRange=n.value,this.renderCustomDateInputs(),this.applyFilters()});let o=e.createDiv({cls:"stats-view__custom-dates"});this.currentFilters.dateRange==="custom"&&this.renderCustomDateInputs(o);let l=e.createDiv({cls:"stats-view__filter-item"}),c=l.createDiv({cls:"stats-view__filter-label"});c.textContent="Min Time (minutes)";let d=l.createEl("input",{cls:"stats-view__filter-input",type:"number",value:this.currentFilters.minTimeSpent.toString(),placeholder:"0"});this.registerDomEvent(d,"input",()=>{this.currentFilters.minTimeSpent=parseInt(d.value)||0,this.applyFilters()});let h=e.createDiv({cls:"stats-view__filter-buttons"}).createEl("button",{cls:"stats-view__filter-button stats-view__filter-button--reset",text:"Reset Filters"});this.registerDomEvent(h,"click",()=>{this.currentFilters={dateRange:"all",selectedProjects:[],minTimeSpent:0},this.renderFilters(),this.applyFilters()})}renderCustomDateInputs(e){var i;let r=e||((i=this.filtersEl)==null?void 0:i.querySelector(".stats-view__custom-dates"));if(r&&(r.empty(),this.currentFilters.dateRange==="custom")){let n=r.createDiv({cls:"stats-view__date-input-container"});n.createDiv({cls:"stats-view__date-label",text:"From"});let a=n.createEl("input",{cls:"stats-view__date-input",type:"date",value:this.currentFilters.customStartDate||""}),o=r.createDiv({cls:"stats-view__date-input-container"});o.createDiv({cls:"stats-view__date-label",text:"To"});let l=o.createEl("input",{cls:"stats-view__date-input",type:"date",value:this.currentFilters.customEndDate||""});this.registerDomEvent(a,"change",()=>{this.currentFilters.customStartDate=a.value,this.applyFilters()}),this.registerDomEvent(l,"change",()=>{this.currentFilters.customEndDate=l.value,this.applyFilters()})}}async applyFilters(){this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(async()=>{await this.refreshStats(),this.debounceTimeout=null},300)}isCacheValid(){return Date.now()-this.lastCacheTime<this.CACHE_DURATION}clearCache(){this.statsCache.clear(),this.lastCacheTime=0}getTaskProjects(e){try{if(!e||!Array.isArray(e.projects))return["No Project"];let r=fr(e.projects);return r.length>0?r.map(i=>this.consolidateProjectName(i)).filter(i=>typeof i=="string"&&i.length>0):["No Project"]}catch(r){return["No Project"]}}getFilterDateRange(){let e=Ue(),r=dt(e);switch(this.currentFilters.dateRange){case"7days":return{start:xa(r,7),end:r};case"30days":return{start:xa(r,30),end:r};case"90days":return{start:xa(r,90),end:r};case"custom":return{start:this.currentFilters.customStartDate?new Date(this.currentFilters.customStartDate):void 0,end:this.currentFilters.customEndDate?new Date(this.currentFilters.customEndDate):void 0};case"all":default:return{}}}renderOverviewStats(e,r){e.empty();let i=m=>{if(m<60)return`${Math.round(m)}m`;let g=Math.floor(m/60),y=Math.round(m%60);return y>0?`${g}h ${y}m`:`${g}h`},n=e.createDiv({cls:"stats-overview-card stats-view__overview-card"}),a=n.createDiv({cls:"overview-value stats-view__overview-value"});a.textContent=i(r.totalTimeSpent),n.createDiv({cls:"overview-label stats-view__overview-label",text:"Total Time Tracked"});let o=e.createDiv({cls:"stats-overview-card stats-view__overview-card"}),l=o.createDiv({cls:"overview-value stats-view__overview-value"});l.textContent=r.totalTasks.toString(),o.createDiv({cls:"overview-label stats-view__overview-label",text:"Total Tasks"});let c=e.createDiv({cls:"stats-overview-card stats-view__overview-card"}),d=c.createDiv({cls:"overview-value stats-view__overview-value"});d.textContent=`${Math.round(r.completionRate)}%`,c.createDiv({cls:"overview-label stats-view__overview-label",text:"Completion Rate"});let u=e.createDiv({cls:"stats-overview-card stats-view__overview-card"}),h=u.createDiv({cls:"overview-value stats-view__overview-value"});h.textContent=r.activeProjects.toString(),u.createDiv({cls:"overview-label stats-view__overview-label",text:"Active Projects"});let p=e.createDiv({cls:"stats-overview-card stats-view__overview-card"}),f=p.createDiv({cls:"overview-value stats-view__overview-value"});f.textContent=i(r.avgTimePerTask),p.createDiv({cls:"overview-label stats-view__overview-label",text:"Avg Time per Task"})}renderTimeRangeStats(e,r){e.empty();let i=c=>{if(c<60)return`${Math.round(c)}m`;let d=Math.floor(c/60),u=Math.round(c%60);return u>0?`${d}h ${u}m`:`${d}h`},n=e.createDiv({cls:"stats-stat-card stats-view__stat-card"});n.createDiv({cls:"stat-value stats-view__stat-value",text:i(r.overall.totalTimeSpent)}),n.createDiv({cls:"stat-label stats-view__stat-label",text:"Time Tracked"});let a=e.createDiv({cls:"stats-stat-card stats-view__stat-card"});a.createDiv({cls:"stat-value stats-view__stat-value",text:r.overall.totalTasks.toString()}),a.createDiv({cls:"stat-label stats-view__stat-label",text:"Tasks"});let o=e.createDiv({cls:"stats-stat-card stats-view__stat-card"});o.createDiv({cls:"stat-value stats-view__stat-value",text:r.overall.completedTasks.toString()}),o.createDiv({cls:"stat-label stats-view__stat-label",text:"Completed"});let l=e.createDiv({cls:"stats-stat-card stats-view__stat-card"});l.createDiv({cls:"stat-value stats-view__stat-value",text:r.overall.activeProjects.toString()}),l.createDiv({cls:"stat-label stats-view__stat-label",text:"Projects"})}async renderProjectStats(e,r){if(e.empty(),r.length===0){e.createDiv({cls:"stats-no-data stats-view__no-data",text:"No project data available"});return}let i=o=>{if(o<60)return`${Math.round(o)}m`;let l=Math.floor(o/60),c=Math.round(o%60);return c>0?`${l}h ${c}m`:`${l}h`},n=o=>{if(!o)return"N/A";try{let l=new Date(o);return C(l,"MMM d, yyyy")}catch(l){return"N/A"}},a=Math.max(...r.map(o=>o.totalTimeSpent));for(let o of r){let l=["stats-project-item","stats-view__project-item","stats-view__project-item--clickable"];o.projectName==="No Project"&&l.push("stats-view__project-item--no-project");let c=e.createDiv({cls:l.join(" ")});this.registerDomEvent(c,"click",()=>{this.openProjectDrilldown(o.projectName)});let d=c.createDiv({cls:"stats-view__project-header"}),u=d.createDiv({cls:"project-name stats-view__project-name"});u.textContent=o.projectName,d.createDiv({cls:"stats-view__click-indicator",text:"\u2192"});let h=o.taskCount>0?o.completedTaskCount/o.taskCount*100:0,p=c.createDiv({cls:"stats-view__project-content-grid"}),f=p.createDiv({cls:"stats-view__progress-container"});this.renderProgressCircle(f,h,o.completedTaskCount,o.taskCount);let m=p.createDiv({cls:"stats-view__stats-container"});if(o.totalTimeSpent>0){let T=m.createDiv({cls:"stats-view__time-bar"}),x=T.createDiv({cls:"stats-view__time-bar-visual"}).createDiv({cls:"stats-view__time-bar-fill"}),I=a>0?o.totalTimeSpent/a*100:0;x.style.width=`${I}%`;let F=T.createDiv({cls:"stats-view__time-bar-label"});F.textContent=i(o.totalTimeSpent)}let g=m.createDiv({cls:"project-stats stats-view__project-stats"});if(o.lastActivity){let T=g.createDiv({cls:"project-stat stats-view__project-stat"});T.textContent=`Last activity: ${n(o.lastActivity)}`}if(o.avgTimePerTask>0){let T=g.createDiv({cls:"project-stat stats-view__project-stat"});T.textContent=`Avg: ${i(o.avgTimePerTask)}/task`}let y=m.createDiv({cls:"stats-view__trend-container"}),w=y.createDiv({cls:"stats-view__sparkline"});try{let T=await this.calculateProjectTrend(o.projectName);T.length>0&&T.some(S=>S.value>0)?this.renderSparkline(w,T):y.remove()}catch(T){y.remove()}}}renderProgressCircle(e,r,i,n){let c=2*Math.PI*27.5,d=c-r/100*c,u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("width","60"),u.setAttribute("height","60"),u.setAttribute("viewBox","0 0 60 60"),u.classList.add("stats-view__progress-circle-svg");let h=document.createElementNS("http://www.w3.org/2000/svg","circle");h.setAttribute("cx",(60/2).toString()),h.setAttribute("cy",(60/2).toString()),h.setAttribute("r",27.5.toString()),h.classList.add("stats-view__progress-circle-bg");let p=document.createElementNS("http://www.w3.org/2000/svg","circle");p.setAttribute("cx",(60/2).toString()),p.setAttribute("cy",(60/2).toString()),p.setAttribute("r",27.5.toString()),p.setAttribute("stroke-dasharray",`${c} ${c}`),p.setAttribute("stroke-dashoffset",d.toString()),p.classList.add("stats-view__progress-circle-fg");let f=document.createElementNS("http://www.w3.org/2000/svg","text");f.setAttribute("x","50%"),f.setAttribute("y","50%"),f.setAttribute("dy","0.3em"),f.setAttribute("text-anchor","middle"),f.classList.add("stats-view__progress-circle-text"),f.textContent=`${Math.round(r)}%`,u.appendChild(h),u.appendChild(p),u.appendChild(f),e.appendChild(u);let m=e.createDiv({cls:"stats-view__progress-label"});m.textContent=`${i}/${n} tasks`}async calculateProjectTrend(e){try{let r=await this.plugin.cacheManager.getAllTaskPaths(),i=[];for(let l of r)try{let c=await this.plugin.cacheManager.getTaskInfo(l);c&&this.getTaskProjects(c).includes(e)&&i.push(c)}catch(c){}let n=[],a=Ue(),o=dt(a);for(let l=29;l>=0;l--){let c=xa(o,l),d=C(c,"yyyy-MM-dd"),u=0;for(let h of i)if(h.timeEntries)for(let p of h.timeEntries)p.startTime&&C(new Date(p.startTime),"yyyy-MM-dd")===d&&(u+=pr([p]));n.push({date:d,value:u})}return n}catch(r){return[]}}renderSparkline(e,r){if(e.empty(),r.length===0)return;let i=100,n=20,a=Math.max(...r.map(d=>d.value));if(a===0)return;let o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width",i.toString()),o.setAttribute("height",n.toString()),o.setAttribute("viewBox",`0 0 ${i} ${n}`),o.classList.add("stats-view__sparkline-svg");let l=document.createElementNS("http://www.w3.org/2000/svg","path"),c="";r.forEach((d,u)=>{let h=u/(r.length-1)*i,p=n-d.value/a*n;u===0?c+=`M ${h} ${p}`:c+=` L ${h} ${p}`}),l.setAttribute("d",c),l.setAttribute("fill","none"),l.setAttribute("stroke","currentColor"),l.setAttribute("stroke-width","1.5"),l.setAttribute("opacity","0.7"),o.appendChild(l),e.appendChild(o)}async openProjectDrilldown(e){this.closeDrilldownModal();let r=document.body.createDiv({cls:"stats-view__modal-backdrop"});this.drilldownModal=r;let i=r.createDiv({cls:"stats-view__modal tasknotes-plugin"}),n=i.createDiv({cls:"stats-view__modal-header"}),a=n.createDiv({cls:"stats-view__modal-title"});a.textContent=`${e} - Detailed View`;let o=n.createEl("button",{cls:"stats-view__modal-close",text:"\xD7"}),l=i.createDiv({cls:"stats-view__modal-content"});l.textContent="Loading...",this.registerDomEvent(o,"click",()=>this.closeDrilldownModal()),this.registerDomEvent(r,"click",d=>{d.target===r&&this.closeDrilldownModal()});let c=d=>{d.key==="Escape"&&(this.closeDrilldownModal(),document.removeEventListener("keydown",c))};document.addEventListener("keydown",c);try{let d=await this.getProjectDrilldownData(e);this.currentDrilldownData=d,this.renderDrilldownContent(l,d)}catch(d){console.error("Error loading drill-down data:",d),l.textContent="Error loading project details."}}closeDrilldownModal(){this.drilldownModal&&(this.drilldownModal.remove(),this.drilldownModal=null,this.currentDrilldownData=null)}async refreshDrilldownModal(){if(!this.drilldownModal||!this.currentDrilldownData)return;let e=this.drilldownModal.querySelector(".stats-view__modal-content");if(e)try{let r=await this.getProjectDrilldownData(this.currentDrilldownData.projectName);this.currentDrilldownData=r,this.renderDrilldownContent(e,r)}catch(r){console.error("Error refreshing drill-down modal:",r)}}async getProjectDrilldownData(e){var h;let r=await this.plugin.cacheManager.getAllTaskPaths(),i=[];for(let p of r)try{let f=await this.plugin.cacheManager.getTaskInfo(p);f&&this.getTaskProjects(f).includes(e)&&i.push(f)}catch(f){console.error(`Failed to get task for drill-down: ${p}`,f)}let n=i.reduce((p,f)=>p+pr(f.timeEntries||[]),0),a=i.filter(p=>this.plugin.statusManager.isCompletedStatus(p.status)).length,o=i.length>0?a/i.length*100:0,l=i.filter(p=>{var f;return((f=p.timeEntries)==null?void 0:f.length)||p.completedDate}).sort((p,f)=>{var y,w;let m=(y=p.timeEntries)!=null&&y.length?Math.max(...p.timeEntries.map(T=>new Date(T.startTime).getTime())):p.completedDate?new Date(p.completedDate).getTime():0;return((w=f.timeEntries)!=null&&w.length?Math.max(...f.timeEntries.map(T=>new Date(T.startTime).getTime())):f.completedDate?new Date(f.completedDate).getTime():0)-m}).slice(0,10),c=[],d=Ue(),u=dt(d);for(let p=29;p>=0;p--){let f=xa(u,p),m=C(f,"yyyy-MM-dd"),g=0,y=0,w=0;for(let T of i){if(T.timeEntries){let S=T.timeEntries.filter(x=>C(new Date(x.startTime),"yyyy-MM-dd")===m);S.length>0&&(g+=pr(S),y++)}T.completedDate&&C(new Date(T.completedDate),"yyyy-MM-dd")===m&&(w++,(h=T.timeEntries)!=null&&h.some(S=>C(new Date(S.startTime),"yyyy-MM-dd")===m)||y++)}c.push({date:m,timeSpent:g,taskCount:y,completedTasks:w})}return{projectName:e,tasks:i,totalTimeSpent:n,completionRate:o,timeByDay:c,recentActivity:l}}renderDrilldownContent(e,r){e.empty();let i=S=>{if(S<60)return`${Math.round(S)}m`;let x=Math.floor(S/60),I=Math.round(S%60);return I>0?`${x}h ${I}m`:`${x}h`},a=e.createDiv({cls:"stats-view__drilldown-overview"}).createDiv({cls:"stats-view__drilldown-stats"}),o=a.createDiv({cls:"stats-view__drilldown-card"});o.createDiv({cls:"stats-view__drilldown-value",text:i(r.totalTimeSpent)}),o.createDiv({cls:"stats-view__drilldown-label",text:"Total Time"});let l=a.createDiv({cls:"stats-view__drilldown-card"});l.createDiv({cls:"stats-view__drilldown-value",text:r.tasks.length.toString()}),l.createDiv({cls:"stats-view__drilldown-label",text:"Total Tasks"});let c=a.createDiv({cls:"stats-view__drilldown-card"});c.createDiv({cls:"stats-view__drilldown-value",text:`${Math.round(r.completionRate)}%`}),c.createDiv({cls:"stats-view__drilldown-label",text:"Completed"});let d=a.createDiv({cls:"stats-view__drilldown-card"}),u=r.tasks.length>0?r.totalTimeSpent/r.tasks.length:0;d.createDiv({cls:"stats-view__drilldown-value",text:i(u)}),d.createDiv({cls:"stats-view__drilldown-label",text:"Avg per Task"});let h=e.createDiv({cls:"stats-view__drilldown-section"});h.createDiv({cls:"stats-view__drilldown-heading",text:"Activity Over Time (Last 30 Days)"});let p=h.createDiv({cls:"stats-view__activity-chart"});this.renderActivityChart(p,r.timeByDay);let f=e.createDiv({cls:"stats-view__drilldown-section"}),m=f.createDiv({cls:"stats-view__section-header"});m.createDiv({cls:"stats-view__drilldown-heading",text:"All Project Tasks"});let y=m.createDiv({cls:"stats-view__task-filters"}).createEl("select",{cls:"stats-view__filter-select"});y.createEl("option",{value:"all",text:"All Tasks"}),y.createEl("option",{value:"active",text:"Active Only"}),y.createEl("option",{value:"completed",text:"Completed Only"});let w=f.createDiv({cls:"stats-view__task-list"}),T=(S="all")=>{w.empty();let x=r.tasks;if(S==="active"?x=r.tasks.filter(F=>!this.plugin.statusManager.isCompletedStatus(F.status)):S==="completed"&&(x=r.tasks.filter(F=>this.plugin.statusManager.isCompletedStatus(F.status))),x.sort((F,A)=>{let L=this.plugin.statusManager.isCompletedStatus(F.status),G=this.plugin.statusManager.isCompletedStatus(A.status);if(L!==G)return L?1:-1;let V=k=>{var D;return(D=k.timeEntries)!=null&&D.length?Math.max(...k.timeEntries.map(_=>new Date(_.startTime).getTime())):k.dateModified?new Date(k.dateModified).getTime():0};return V(A)-V(F)}),x.length===0){w.createDiv({cls:"stats-view__no-data",text:"No tasks found"});return}let I=w.createDiv({cls:"stats-view__task-count"});I.textContent=`Showing ${x.length} task${x.length!==1?"s":""}`;for(let F of x){let A=er(F,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1});w.appendChild(A)}};T("all"),this.registerDomEvent(y,"change",()=>{T(y.value)})}renderActivityChart(e,r){if(e.empty(),r.length===0)return;let i=Math.max(...r.map(a=>a.timeSpent));if(i===0){e.createDiv({cls:"stats-view__no-data",text:"No time tracking data"});return}let n=e.createDiv({cls:"stats-view__bar-chart"});for(let a of r){let l=n.createDiv({cls:"stats-view__bar-container"}).createDiv({cls:"stats-view__bar"}),c=a.timeSpent/i*40;l.style.height=`${c}px`;let d=`${C(new Date(a.date),"MMM d")}: ${Math.round(a.timeSpent)}m`;l.setAttribute("title",d)}}};var Lr=require("obsidian");Ss();var Xc=class extends Lr.ItemView{constructor(e,r){super(e);this.boardContainer=null;this.filterBar=null;this.taskElements=new Map;this.previousGroupKey=null;this.listeners=[];this.functionListeners=[];this.columnOrder=[];this.debouncedRefresh=(0,Lr.debounce)(()=>{this.refresh()},150);this.plugin=r,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"priority",sortDirection:"desc",groupKey:"status"},this.previousGroupKey=this.currentQuery.groupKey||null,this.registerEvents()}getViewType(){return pi}getDisplayText(){return"Kanban"}getIcon(){return"layout-grid"}registerEvents(){this.listeners.forEach(n=>this.plugin.emitter.offref(n)),this.listeners=[],this.functionListeners.forEach(n=>n()),this.functionListeners=[];let e=this.plugin.emitter.on(Ft,async()=>{if(this.refresh(),this.filterBar){let n=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(n)}});this.listeners.push(e);let r=this.plugin.emitter.on(Fe,async({path:n,originalTask:a,updatedTask:o})=>{if(!n||!o)return;await da(o,this.plugin,this.contentEl);let l=this.taskElements.get(n);if(l)try{let c=this.getCurrentVisibleProperties();ii(l,o,this.plugin,c,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0}),l.classList.add("task-card--updated"),window.setTimeout(()=>{l.classList.remove("task-card--updated")},1e3)}catch(c){console.error("Error updating task card in kanban:",c),this.refresh()}else this.refresh();if(this.filterBar){let c=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(c)}});this.listeners.push(r);let i=this.plugin.filterService.on("data-changed",()=>{this.refresh()});this.functionListeners.push(i)}async onOpen(){await this.plugin.onReady(),await this.plugin.waitForMigration();let e=this.plugin.viewStateManager.getFilterState(pi);e&&(this.currentQuery=e,this.previousGroupKey=this.currentQuery.groupKey||null),this.loadColumnOrder(),this.contentEl.empty(),await this.render()}async onClose(){this.listeners.forEach(e=>this.plugin.emitter.offref(e)),this.functionListeners.forEach(e=>e()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.contentEl.empty()}async refresh(){this.boardContainer?await this.loadAndRenderBoard():await this.render()}async render(){let e=this.contentEl;e.empty(),e.addClass("tasknotes-plugin","kanban-view"),await this.renderHeader(e),this.boardContainer=e.createDiv({cls:"kanban-view__board-container"}),await this.loadAndRenderBoard()}async renderHeader(e){let r=e.createDiv({cls:"kanban-view__header"}),i=r.createDiv({cls:"kanban-view__filter-container"});this.currentQuery=this.plugin.filterService.createDefaultQuery(),this.currentQuery.sortKey="priority",this.currentQuery.sortDirection="desc",this.currentQuery.groupKey="status";let n=this.plugin.viewStateManager.getFilterState(pi);n&&(this.currentQuery=n);let a=await this.plugin.filterService.getFilterOptions();this.filterBar=new ri(this.app,this.plugin,i,this.currentQuery,a,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1});let o=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(o),this.filterBar.on("saveView",({name:p,query:f,viewOptions:m,visibleProperties:g})=>{let y=this.plugin.viewStateManager.saveView(p,f,m,g);this.filterBar.setActiveSavedView(y)}),this.filterBar.on("deleteView",p=>{this.plugin.viewStateManager.deleteView(p)}),this.plugin.viewStateManager.on("saved-views-changed",p=>{var f;(f=this.filterBar)==null||f.updateSavedViews(p)}),this.filterBar.on("reorderViews",(p,f)=>{this.plugin.viewStateManager.reorderSavedViews(p,f)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async p=>{this.currentQuery=p,await this.plugin.viewStateManager.setFilterState(pi,p),this.loadAndRenderBoard()}),this.filterBar.on("propertiesChanged",p=>{this.loadAndRenderBoard()});let l=r.createDiv({cls:"kanban-view__actions"});l.createDiv({cls:"kanban-view__actions-left"}).createEl("button",{cls:"kanban-view__new-task-button",text:"New task"}).addEventListener("click",()=>{this.plugin.openTaskCreationModal()});let h=l.createDiv({cls:"kanban-view__actions-right"}).createDiv({cls:"kanban-view__stats"});this.updateBoardStats(h)}updateBoardStats(e,r){if(e.empty(),!r||r.length===0)return;let i=r.length,n=r.filter(a=>this.plugin.statusManager.isCompletedStatus(a.status)).length;if(i>0){let a=Math.round(n/i*100);e.createSpan({text:`${i} tasks \u2022 ${a}% complete`,cls:"kanban-view__stats-simple"})}}async loadAndRenderBoard(){var i,n;if(!this.boardContainer)return;let e=this.currentQuery.groupKey||null;this.previousGroupKey!==null&&this.previousGroupKey!==e&&(this.boardContainer.empty(),this.columnOrder=[]),this.previousGroupKey=e;let r=null;this.boardContainer.children.length===0&&(r=this.boardContainer.createDiv({cls:"kanban-view__loading",text:"Loading board..."}));try{let a=await this.plugin.filterService.getGroupedTasks(this.currentQuery,this.plugin.selectedDate);r&&r.remove(),this.renderBoardFromGroupedTasksWithReconciler(a);let o=Array.from(a.values()).flat(),l=this.contentEl.querySelector(".kanban-view__stats");l&&this.updateBoardStats(l,o)}catch(a){let o=a instanceof Error?a.message:String(a);console.error("KanbanView: Error loading Kanban board:",{error:o,stack:a instanceof Error?a.stack:void 0,query:this.currentQuery,cacheInitialized:((i=this.plugin.cacheManager)==null?void 0:i.isInitialized())||!1,visibleProperties:this.getCurrentVisibleProperties(),filterServiceQuery:JSON.stringify(this.currentQuery,null,2)}),console.error("KanbanView: Detailed error context:",{pluginInitialized:!!this.plugin,filterServiceInitialized:!!((n=this.plugin)!=null&&n.filterService),containerExists:!!this.boardContainer}),new Lr.Notice("Failed to load Kanban board. See console for details."),r&&r.remove(),this.boardContainer.empty(),this.boardContainer.createDiv({cls:"kanban-view__error",text:"Error loading board."})}}renderBoardFromGroupedTasks(e){if(!this.boardContainer)return;this.boardContainer.empty(),this.taskElements.clear();let r=Array.from(e.keys()).sort();this.columnOrder.length===0&&(this.columnOrder=[...r],this.columnOrder.length>0&&this.saveColumnOrder()),this.renderBoardFromGroupedTasksWithOrder(e)}renderColumn(e,r,i){let n=e.createDiv({cls:"kanban-view__column"});n.dataset.columnId=r,r==="uncategorized"&&n.addClass("kanban-view__column--uncategorized");let a=n.createDiv({cls:"kanban-view__column-header"});a.draggable=!0,a.dataset.columnId=r,this.addColumnDragHandlers(a);let o=this.formatColumnTitle(r,this.currentQuery.groupKey||"none");a.createEl("div",{text:o,cls:"kanban-view__column-title"}),a.createEl("div",{text:`${i.length} tasks`,cls:"kanban-view__column-count"});let l=n.createDiv({cls:"kanban-view__column-body"});if(i.length===0){let d=l.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(d)}else i.forEach(d=>{let u=this.getCurrentVisibleProperties(),h=er(d,this.plugin,u,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});h.draggable=!0,this.addDragHandlers(h,d),l.appendChild(h),this.taskElements.set(d.path,h)});l.createEl("button",{cls:"kanban-view__add-card-button",text:"+ Add a card"}).addEventListener("click",()=>{this.openTaskCreationModalForColumn(r)}),this.addColumnDropHandlers(n)}addColumnDragHandlers(e){e.addEventListener("dragstart",r=>{if(r.dataTransfer){let i=e.dataset.columnId;i&&(r.dataTransfer.setData("text/plain",`column:${i}`),r.dataTransfer.effectAllowed="move")}e.classList.add("kanban-view__column-header--dragging")}),e.addEventListener("dragend",()=>{e.classList.remove("kanban-view__column-header--dragging")})}loadColumnOrder(){let e=this.plugin.viewStateManager.getViewPreferences(pi);e!=null&&e.columnOrder&&(this.columnOrder=[...e.columnOrder])}saveColumnOrder(){let e=this.plugin.viewStateManager.getViewPreferences(pi)||{};e.columnOrder=[...this.columnOrder],this.plugin.viewStateManager.setViewPreferences(pi,e)}async reorderColumns(e,r){var o;if(this.columnOrder.length===0){let l=(o=this.boardContainer)==null?void 0:o.querySelectorAll(".kanban-view__column");this.columnOrder=Array.from(l||[]).map(c=>c.dataset.columnId||"").filter(c=>c)}let i=this.columnOrder.indexOf(e),n=this.columnOrder.indexOf(r);if(i===-1||n===-1)return;let[a]=this.columnOrder.splice(i,1);this.columnOrder.splice(n,0,a),this.saveColumnOrder(),this.renderBoardWithOrder()}async renderBoardWithOrder(){if(this.boardContainer)try{let e=await this.plugin.filterService.getGroupedTasks(this.currentQuery,this.plugin.selectedDate);this.renderBoardFromGroupedTasksWithReconciler(e);let r=Array.from(e.values()).flat(),i=this.contentEl.querySelector(".kanban-view__stats");i&&this.updateBoardStats(i,r)}catch(e){console.error("Error reordering Kanban board:",e),this.refresh()}}renderBoardFromGroupedTasksWithOrder(e){if(!this.boardContainer)return;let r=this.boardContainer.querySelector(".kanban-view__board");r?r.empty():r=this.boardContainer.createDiv({cls:"kanban-view__board"}),this.taskElements.clear(),this.columnOrder.forEach(l=>{if(e.has(l)){let c=e.get(l)||[];this.renderColumn(r,l,c)}});let i=Array.from(e.keys()),n=i;if(this.currentQuery.groupKey==="status"){let l=this.plugin.statusManager.getAllStatuses().map(c=>c.value);n=[...new Set([...i,...l])]}let a=!1,o=this.columnOrder.length;this.columnOrder=this.columnOrder.filter(l=>n.includes(l)),this.columnOrder.length!==o&&(a=!0),n.forEach(l=>{if(!this.columnOrder.includes(l)){this.columnOrder.push(l),a=!0;let c=e.get(l)||[];this.renderColumn(r,l,c)}}),a&&this.saveColumnOrder()}addDragHandlers(e,r){e.addEventListener("dragstart",i=>{i.dataTransfer&&(i.dataTransfer.setData("text/plain",r.path),i.dataTransfer.effectAllowed="move"),window.setTimeout(()=>e.classList.add("task-card--dragging"),0)}),e.addEventListener("dragend",()=>{e.classList.remove("task-card--dragging")})}addColumnDropHandlers(e){e.addEventListener("dragover",r=>{var i;r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move",((i=this.boardContainer)==null?void 0:i.querySelector(".kanban-view__column-header--dragging"))?e.classList.add("kanban-view__column--column-drop-target"):e.classList.add("kanban-view__column--dragover"))}),e.addEventListener("dragleave",r=>{e.contains(r.relatedTarget)||(e.classList.remove("kanban-view__column--dragover"),e.classList.remove("kanban-view__column--column-drop-target"))}),e.addEventListener("drop",async r=>{var o,l;r.preventDefault(),r.stopPropagation(),(o=this.boardContainer)==null||o.querySelectorAll(".kanban-view__column--dragover, .kanban-view__column--column-drop-target").forEach(c=>{c.classList.remove("kanban-view__column--dragover","kanban-view__column--column-drop-target")});let i=(l=r.dataTransfer)==null?void 0:l.getData("text/plain");if(i!=null&&i.startsWith("column:")){let c=i.replace("column:",""),d=e.dataset.columnId;c&&d&&c!==d&&await this.reorderColumns(c,d);return}let n=i,a=e.dataset.columnId;if(!a){let c=r.target.closest(".kanban-view__column");a=(c==null?void 0:c.getAttribute("data-column-id"))||void 0}if(n&&a&&a!=="uncategorized"){let c=await this.plugin.cacheManager.getCachedTaskInfo(n);if(c)try{let d,u;switch(this.currentQuery.groupKey){case"status":d="status",u=a;break;case"priority":d="priority",u=a;break;case"context":d="contexts",u=[a];break;case"project":if(d="projects",a==="No Project")u=[];else{let h=this.findExistingProjectFormat(c,a);h?u=[h]:u=[`[[${a.includes("/")?`${a}.md`:a}]]`]}break;default:throw new Error(`Unsupported groupBy: ${this.currentQuery.groupKey}`)}await this.plugin.updateTaskProperty(c,d,u,{silent:!0}),new Lr.Notice(`Task moved to "${this.formatColumnTitle(a,this.currentQuery.groupKey)}"`)}catch(d){console.error("Failed to move task:",d),new Lr.Notice("Failed to move task"),this.refresh()}}})}renderBoardFromGroupedTasksWithReconciler(e){if(!this.boardContainer)return;let r=this.boardContainer.querySelector(".kanban-view__board");r||(r=this.boardContainer.createDiv({cls:"kanban-view__board"}));let i=Array.from(e.keys()),n=i;if(this.currentQuery.groupKey==="status"){let d=this.plugin.statusManager.getAllStatuses().map(u=>u.value);n=[...new Set([...i,...d])]}n=n.sort(),this.columnOrder.length===0&&(this.columnOrder=[...n],this.columnOrder.length>0&&this.saveColumnOrder());let a=!1,o=this.columnOrder.length;this.columnOrder=this.columnOrder.filter(d=>n.includes(d)),this.columnOrder.length!==o&&(a=!0),n.forEach(d=>{this.columnOrder.includes(d)||(this.columnOrder.push(d),a=!0)}),a&&this.saveColumnOrder();let l=this.columnOrder.map(d=>({id:d,tasks:e.get(d)||[]}));this.plugin.domReconciler.updateList(r,l,d=>d.id,d=>this.createColumnElement(d.id,d.tasks),(d,u)=>this.updateColumnElement(d,u.id,u.tasks)),this.taskElements.clear(),r.querySelectorAll(".task-card[data-task-path]").forEach(d=>{let u=d.dataset.taskPath;u&&this.taskElements.set(u,d)})}createColumnElement(e,r){let i=document.createElement("div");i.className="kanban-view__column",i.dataset.columnId=e,e==="uncategorized"&&i.classList.add("kanban-view__column--uncategorized");let n=i.createDiv({cls:"kanban-view__column-header"});n.draggable=!0,n.dataset.columnId=e,this.addColumnDragHandlers(n);let a=this.formatColumnTitle(e,this.currentQuery.groupKey||"none"),o=n.createEl("div",{cls:"kanban-view__column-title"});this.currentQuery.groupKey==="project"&&e!=="No Project"?this.createClickableProjectTitle(o,e,a):o.textContent=a,n.createEl("div",{text:`${r.length} tasks`,cls:"kanban-view__column-count"});let l=i.createDiv({cls:"kanban-view__column-body"}),c=l.createDiv({cls:"kanban-view__tasks-container"});if(r.length===0){let u=c.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(u)}else this.plugin.domReconciler.updateList(c,r,u=>u.path,u=>this.createTaskCardElement(u),(u,h)=>this.updateTaskCardElement(u,h));return l.createEl("button",{cls:"kanban-view__add-card-button",text:"+ Add a card"}).addEventListener("click",()=>{this.openTaskCreationModalForColumn(e)}),this.addColumnDropHandlers(i),i}updateColumnElement(e,r,i){let n=e.querySelector(".kanban-view__column-count");n&&(n.textContent=`${i.length} tasks`);let a=e.querySelector(".kanban-view__column-body");if(a){let o=a.querySelector(".kanban-view__add-card-button"),l=a.querySelector(".kanban-view__tasks-container");if(l||(l=a.createDiv({cls:"kanban-view__tasks-container"}),o?a.insertBefore(l,o):a.appendChild(l)),i.length===0){l.empty();let c=l.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(c)}else{let c=l.querySelector(".kanban-view__column-empty");c&&c.remove(),this.plugin.domReconciler.updateList(l,i,d=>d.path,d=>this.createTaskCardElement(d),(d,u)=>this.updateTaskCardElement(d,u))}}}createTaskCardElement(e){let r=this.getCurrentVisibleProperties(),i=er(e,this.plugin,r,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});return i.draggable=!0,this.addDragHandlers(i,e),this.taskElements.set(e.path,i),i}updateTaskCardElement(e,r){let i=this.getCurrentVisibleProperties();ii(e,r,this.plugin,i,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0}),this.taskElements.set(r.path,e)}getCurrentVisibleProperties(){var e;return(e=this.filterBar)==null?void 0:e.getCurrentVisibleProperties()}formatColumnTitle(e,r){var i,n;switch(r){case"status":return((i=this.plugin.statusManager.getStatusConfig(e))==null?void 0:i.label)||e;case"priority":return((n=this.plugin.priorityManager.getPriorityConfig(e))==null?void 0:n.label)||e;case"context":return e==="uncategorized"?"Uncategorized":`@${e}`;case"project":return e==="No Project"?"No Project":e;case"due":return e;case"none":default:return e}}isResolvedProjectPath(e){var r;return(r=this.plugin)!=null&&r.app?this.plugin.app.vault.getAbstractFileByPath(e+".md")instanceof Lr.TFile?!0:!!this.plugin.app.metadataCache.getFirstLinkpathDest(e,""):!1}findExistingProjectFormat(e,r){var n;let i=((n=e.projects)==null?void 0:n.filter(a=>a&&typeof a=="string"&&a.trim()!==""))||[];for(let a of i)if(this.plugin.filterService.resolveProjectToAbsolutePath(a)===r)return a;return null}createClickableProjectTitle(e,r,i){if(r.includes("/")||this.isResolvedProjectPath(r)){let a=e.createEl("a",{cls:"internal-link kanban-view__project-link",text:i});a.addEventListener("click",async o=>{o.preventDefault(),o.stopPropagation();try{let l=this.plugin.app.vault.getAbstractFileByPath(r);if(l instanceof Lr.TFile)await this.plugin.app.workspace.getLeaf(!1).openFile(l);else{let c=this.plugin.app.metadataCache.getFirstLinkpathDest(r,"");c?await this.plugin.app.workspace.getLeaf(!1).openFile(c):new Lr.Notice(`Project file not found: ${r}`)}}catch(l){console.error("Error opening project file:",l),new Lr.Notice(`Error opening project: ${r}`)}}),a.addEventListener("mouseover",o=>{this.plugin.app.workspace.trigger("hover-link",{event:o,source:"tasknotes-kanban",hoverParent:this,targetEl:a,linktext:r,sourcePath:r})})}else e.textContent=i}openTaskCreationModalForColumn(e){let r={};switch(this.currentQuery.groupKey){case"status":e!=="uncategorized"&&(r.status=e);break;case"priority":e!=="uncategorized"&&(r.priority=e);break;case"context":e!=="uncategorized"&&(r.contexts=[e]);break;case"project":e!=="No Project"&&(r.projects=[e]);break}this.plugin.openTaskCreationModal(r)}};var Si=require("obsidian"),kr=bt(Vr());Se();var Wh=class{constructor(t){this.timerWorker=null;this.activeAudioContexts=new Set;this.cleanupTimeouts=new Set;this.plugin=t,this.state={isRunning:!1,timeRemaining:t.settings.pomodoroWorkDuration*60}}async initialize(){await this.loadState(),this.setupWorker(),this.state.isRunning&&this.state.currentSession&&this.resumeTimer()}setWebhookNotifier(t){this.webhookNotifier=t}setupWorker(){let t=new Blob([bM],{type:"application/javascript"}),e=URL.createObjectURL(t);this.timerWorker=new Worker(e),this.timerWorker.onmessage=r=>{r.data.type==="done"&&this.completePomodoro(),r.data.type==="tick"&&(this.state.timeRemaining=r.data.timeRemaining,this.plugin.emitter.trigger(fi,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}}async loadState(){try{let t=await this.plugin.loadData();if(t!=null&&t.pomodoroState){this.state=t.pomodoroState,this.state.timeRemaining=Math.max(0,this.state.timeRemaining||0);let e=ae(Ue());if(t.lastPomodoroDate!==e&&this.state.currentSession&&(this.state.currentSession=void 0,this.state.isRunning=!1),this.state.currentSession){let i=new Date(this.state.currentSession.startTime).getTime();(Date.now()-i)/(1e3*60*60)>24&&(this.state.currentSession=void 0,this.state.isRunning=!1,this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60)}this.state.currentSession||(this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60)}}catch(t){console.error("Failed to load pomodoro state:",t),this.state={isRunning:!1,timeRemaining:this.plugin.settings.pomodoroWorkDuration*60}}}async saveState(){try{let t=await this.plugin.loadData()||{};t.pomodoroState=this.state,t.lastPomodoroDate=ae(Ue()),await this.plugin.saveData(t)}catch(t){console.error("Failed to save pomodoro state:",t)}}async saveLastSelectedTask(t){try{let e=await this.plugin.loadData()||{};e.lastSelectedTaskPath=t,await this.plugin.saveData(e)}catch(e){console.error("Failed to save last selected task:",e)}}async getLastSelectedTaskPath(){try{let t=await this.plugin.loadData();return t==null?void 0:t.lastSelectedTaskPath}catch(t){console.error("Failed to load last selected task:",t);return}}async startPomodoro(t,e){var l;if(this.state.isRunning){new Si.Notice("A pomodoro is already running");return}if(this.state.currentSession&&!this.state.isRunning){new Si.Notice("Resume the current session instead of starting a new one");return}let i=(e?Math.max(1,Math.min(120,e))*60:null)||Math.max(1,Math.min(7200,this.state.timeRemaining)),n=i/60;console.log("Starting pomodoro with planned duration:",n,"minutes");let a=ke(),o={id:Date.now().toString(),taskPath:t==null?void 0:t.path,startTime:a,plannedDuration:n,type:"work",completed:!1,activePeriods:[{startTime:a}]};if(this.state.currentSession=o,this.state.isRunning=!0,this.state.timeRemaining=i,this.state.nextSessionType=void 0,await this.saveState(),this.startTimer(),t)try{await this.plugin.taskService.startTimeTracking(t)}catch(c){(l=c.message)!=null&&l.includes("Time tracking is already active")||console.error("Failed to start time tracking for Pomodoro:",c)}if(this.plugin.emitter.trigger(Pd,{session:o,task:t}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("pomodoro.started",{session:o,task:t})}catch(c){console.warn("Failed to trigger webhook for pomodoro start:",c)}new Notification(`Pomodoro started${t?` for: ${t.title}`:""}`)}async startBreak(t=!1){if(this.state.isRunning){new Si.Notice("A timer is already running");return}if(this.state.currentSession&&!this.state.isRunning){new Si.Notice("Resume the current session instead of starting a new one");return}let e=t?Math.max(1,Math.min(60,this.plugin.settings.pomodoroLongBreakDuration)):Math.max(1,Math.min(30,this.plugin.settings.pomodoroShortBreakDuration)),r=ke(),i={id:Date.now().toString(),startTime:r,plannedDuration:e,type:t?"long-break":"short-break",completed:!1,activePeriods:[{startTime:r}]};this.state.currentSession=i,this.state.isRunning=!0,this.state.timeRemaining=i.plannedDuration*60,this.state.nextSessionType=void 0,await this.saveState(),this.startTimer(),new Si.Notice(`${t?"Long":"Short"} break started`)}async pausePomodoro(){if(this.state.isRunning){if(this.stopTimer(),this.state.isRunning=!1,this.state.currentSession&&this.state.currentSession.activePeriods.length>0){let t=this.state.currentSession.activePeriods[this.state.currentSession.activePeriods.length-1];t.endTime||(t.endTime=ke())}if(this.state.currentSession&&this.state.currentSession.taskPath)try{let t=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);t&&await this.plugin.taskService.stopTimeTracking(t)}catch(t){console.error("Failed to stop time tracking for Pomodoro pause:",t)}await this.saveState(),this.plugin.emitter.trigger(fi,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),new Si.Notice("Pomodoro paused")}}async resumePomodoro(){var t;if(!(this.state.isRunning||!this.state.currentSession)){if(this.state.isRunning=!0,this.state.currentSession&&this.state.currentSession.activePeriods.push({startTime:ke()}),await this.saveState(),this.startTimer(),this.state.currentSession&&this.state.currentSession.taskPath)try{let e=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);e&&await this.plugin.taskService.startTimeTracking(e)}catch(e){(t=e.message)!=null&&t.includes("Time tracking is already active")||console.error("Failed to start time tracking for Pomodoro resume:",e)}this.plugin.emitter.trigger(fi,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),new Si.Notice("Pomodoro resumed")}}async stopPomodoro(){if(!this.state.currentSession)return;let t=this.state.isRunning;if(this.stopTimer(),this.state.currentSession){if(this.state.currentSession.interrupted=!0,this.state.currentSession.endTime=ke(),this.state.currentSession.activePeriods.length>0){let e=this.state.currentSession.activePeriods[this.state.currentSession.activePeriods.length-1];e.endTime||(e.endTime=ke())}await this.addSessionToHistory(this.state.currentSession)}if(this.plugin.emitter.trigger(Rd,{session:this.state.currentSession}),this.webhookNotifier&&this.state.currentSession)try{let e=this.state.currentSession.taskPath?await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath):void 0;await this.webhookNotifier.triggerWebhook("pomodoro.interrupted",{session:this.state.currentSession,task:e})}catch(e){console.warn("Failed to trigger webhook for pomodoro interruption:",e)}if(this.state.currentSession&&this.state.currentSession.taskPath&&t)try{let e=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);e&&await this.plugin.taskService.stopTimeTracking(e)}catch(e){console.error("Failed to stop time tracking for Pomodoro interrupt:",e)}this.state.currentSession=void 0,this.state.isRunning=!1,this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60,await this.saveState(),this.plugin.emitter.trigger(fi,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),t&&new Si.Notice("Pomodoro stopped and reset")}startTimer(){this.timerWorker&&this.timerWorker.postMessage({command:"start",duration:this.state.timeRemaining})}stopTimer(){this.timerWorker&&this.timerWorker.postMessage({command:"stop"})}resumeTimer(){if(this.state.currentSession&&this.state.currentSession.startTime){let t=new Date(this.state.currentSession.startTime).getTime(),e=Date.now();if(t>e){this.stopPomodoro();return}let r=this.state.currentSession.plannedDuration*60;if(!this.state.isRunning&&this.state.timeRemaining>0)this.state.timeRemaining=Math.min(this.state.timeRemaining,r);else if(this.state.isRunning){let i=this.state.currentSession.activePeriods||[],n=0;for(let a of i){let o=new Date(a.startTime).getTime(),l=a.endTime?new Date(a.endTime).getTime():e;n+=Math.floor((l-o)/1e3)}this.state.timeRemaining=Math.max(0,r-n)}this.state.timeRemaining>0&&this.state.isRunning?this.startTimer():this.state.timeRemaining<=0&&this.completePomodoro()}}async completePomodoro(){if(this.stopTimer(),!this.state.currentSession)return;let t=this.state.currentSession;if(t.completed=!0,t.endTime=ke(),t.activePeriods.length>0){let r=t.activePeriods[t.activePeriods.length-1];r.endTime||(r.endTime=ke())}if(t.type==="work"&&this.state.isRunning&&t.taskPath)try{let r=await this.plugin.cacheManager.getTaskInfo(t.taskPath);r&&await this.plugin.taskService.stopTimeTracking(r)}catch(r){console.error("Failed to stop time tracking for Pomodoro completion:",r)}let e=!1;if(t.type==="work")try{e=((await this.getTodayStats()).pomodorosCompleted+1)%this.plugin.settings.pomodoroLongBreakInterval===0}catch(r){console.error("Failed to calculate break type:",r),e=!1}if(await this.addSessionToHistory(t),this.plugin.emitter.trigger(Nd,{session:t,nextType:t.type==="work"?e?"long-break":"short-break":"work"}),this.webhookNotifier)try{let r=t.taskPath?await this.plugin.cacheManager.getTaskInfo(t.taskPath):void 0;await this.webhookNotifier.triggerWebhook("pomodoro.completed",{session:t,task:r})}catch(r){console.warn("Failed to trigger webhook for pomodoro completion:",r)}if(this.plugin.settings.pomodoroNotifications){let r=t.type==="work"?"\u{1F345} Pomodoro completed!":"\u2615 Break completed!",i=t.type==="work"?`Time for a ${e?"long break \u{1F4A4}":"short break \u2615"}`:"Ready for the next pomodoro?";new Notification(r,{body:i})}if(this.plugin.settings.pomodoroSoundEnabled&&this.playCompletionSound(),this.state.currentSession=void 0,this.state.isRunning=!1,t.type==="work"){let r=e?this.plugin.settings.pomodoroLongBreakDuration:this.plugin.settings.pomodoroShortBreakDuration;if(this.state.timeRemaining=r*60,this.state.nextSessionType=e?"long-break":"short-break",this.plugin.settings.pomodoroAutoStartBreaks){let i=setTimeout(()=>this.startBreak(e),1e3);this.cleanupTimeouts.add(i)}}else if(this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60,this.state.nextSessionType="work",this.plugin.settings.pomodoroAutoStartWork){let r=setTimeout(()=>this.startPomodoro(),1e3);this.cleanupTimeouts.add(r)}await this.saveState(),this.plugin.emitter.trigger(fi,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession})}playCompletionSound(){try{let t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),r=t.createGain();e.connect(r),r.connect(t.destination);let i=Math.max(0,Math.min(1,this.plugin.settings.pomodoroSoundVolume/100));r.gain.value=i*.3,e.frequency.value=800,e.type="sine",e.start(),e.stop(t.currentTime+.1),this.activeAudioContexts.add(t);let n=setTimeout(()=>{try{let o=t.createOscillator();o.connect(r),o.frequency.value=1e3,o.type="sine",o.start(),o.stop(t.currentTime+.1)}catch(o){console.error("Failed to play second beep:",o)}},150);this.cleanupTimeouts.add(n);let a=setTimeout(()=>{this.activeAudioContexts.delete(t),t.close().catch(()=>{})},300);this.cleanupTimeouts.add(a)}catch(t){console.error("Failed to play completion sound:",t)}}getState(){return{...this.state}}adjustSessionTime(t){if(this.state.currentSession){this.stopTimer(),this.state.timeRemaining=Math.max(1,this.state.timeRemaining+t);let e=this.state.currentSession.activePeriods||[],r=0;for(let n of e)if(n.endTime){let a=new Date(n.startTime).getTime(),o=new Date(n.endTime).getTime();r+=Math.floor((o-a)/1e3)}else if(this.state.isRunning){let a=new Date(n.startTime).getTime(),o=Date.now();r+=Math.floor((o-a)/1e3)}let i=r+this.state.timeRemaining;this.state.currentSession.plannedDuration=Math.ceil(i/60),this.saveState(),this.startTimer(),this.plugin.emitter.trigger(fi,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession})}}adjustPreparedTimer(t){this.state.currentSession||(this.stopTimer(),this.state.timeRemaining=Math.max(1,t),this.saveState(),console.log("Adjusted prepared timer to:",this.state.timeRemaining,"seconds"),this.plugin.emitter.trigger(fi,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}isRunning(){return this.state.isRunning}getCurrentSession(){return this.state.currentSession}getTimeRemaining(){return this.state.timeRemaining}async getPomodorosCompleted(){return(await this.getTodayStats()).pomodorosCompleted}async getCurrentStreak(){return(await this.getTodayStats()).currentStreak}async getTotalMinutesToday(){return(await this.getTodayStats()).totalMinutes}async assignTaskToCurrentSession(t){this.state.currentSession&&(this.state.currentSession.taskPath=t==null?void 0:t.path,await this.saveState(),this.plugin.emitter.trigger(fi,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}async getSessionHistory(){try{let t=[],e=await this.plugin.loadData(),r=(e==null?void 0:e.pomodoroHistory)||[];if(this.plugin.settings.pomodoroStorageLocation==="daily-notes"){let i=await this.loadHistoryFromDailyNotes();t=i,r.length>0&&(t=this.mergeHistories(r,i))}else t=r;return t.sort((i,n)=>new Date(i.startTime).getTime()-new Date(n.startTime).getTime())}catch(t){return console.error("Failed to load session history:",t),[]}}async saveSessionHistory(t){try{if(this.plugin.settings.pomodoroStorageLocation==="daily-notes")await this.saveHistoryToDailyNotes(t);else{let e=await this.plugin.loadData()||{};e.pomodoroHistory=t,await this.plugin.saveData(e)}}catch(e){console.error("Failed to save session history:",e)}}async addSessionToHistory(t){if(!t.endTime){console.warn("Cannot add session to history without end time");return}let e={id:t.id,startTime:t.startTime,endTime:t.endTime,plannedDuration:t.plannedDuration,type:t.type,taskPath:t.taskPath,completed:t.completed&&!t.interrupted,activePeriods:t.activePeriods.slice()};try{if(this.plugin.settings.pomodoroStorageLocation==="daily-notes")await this.addSingleSessionToDailyNote(e);else{let r=await this.getSessionHistory();r.push(e),await this.saveSessionHistory(r)}}catch(r){console.error("Failed to add session to history:",r)}}async getStatsForDate(t){let e=ae(t),n=(await this.getSessionHistory()).filter(u=>ae(new Date(u.startTime))===e).filter(u=>u.type==="work"),a=n.filter(u=>u.completed),o=0;for(let u=n.length-1;u>=0&&n[u].completed;u--)o++;let l=a.reduce((u,h)=>u+Jc(h),0),c=a.length>0?l/a.length:0,d=n.length>0?a.length/n.length*100:0;return{pomodorosCompleted:a.length,currentStreak:o,totalMinutes:l,averageSessionLength:Math.round(c),completionRate:Math.round(d)}}async getTodayStats(){let t=Ue(),e=dt(t);return this.getStatsForDate(e)}cleanup(){this.stopTimer(),this.timerWorker&&(this.timerWorker.terminate(),this.timerWorker=null);for(let t of this.cleanupTimeouts)clearTimeout(t);this.cleanupTimeouts.clear();for(let t of this.activeAudioContexts)t.state!=="closed"&&t.close().catch(()=>{});this.activeAudioContexts.clear(),this.saveState()}async saveHistoryToDailyNotes(t){try{if(!(0,kr.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes core plugin is not enabled");let e=this.groupSessionsByDate(t);for(let[r,i]of e)await this.updateDailyNotePomodoros(r,i)}catch(e){throw console.error("Failed to save history to daily notes:",e),e}}async loadHistoryFromDailyNotes(){try{if(!(0,kr.appHasDailyNotesPluginLoaded)())return[];let t=[],e=(0,kr.getAllDailyNotes)(),r=this.plugin.fieldMapper.toUserField("pomodoros");for(let[,i]of Object.entries(e))try{let n=this.plugin.app.metadataCache.getFileCache(i),a=n==null?void 0:n.frontmatter;if(a&&a[r]){let o=a[r];Array.isArray(o)&&t.push(...o)}}catch(n){console.warn(`Failed to read pomodoro data from daily note ${i.path}:`,n)}return t}catch(t){return console.error("Failed to load history from daily notes:",t),[]}}groupSessionsByDate(t){let e=new Map;for(let r of t){let i=new Date(r.startTime),n=ae(i);e.has(n)||e.set(n,[]),e.get(n).push(r)}return e}async addSingleSessionToDailyNote(t){try{let e=new Date(t.startTime),r=window.moment(e),i=(0,kr.getAllDailyNotes)(),n=(0,kr.getDailyNote)(r,i);if(!n&&(n=await(0,kr.createDailyNote)(r),!n))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let a=this.plugin.fieldMapper.toUserField("pomodoros");await this.plugin.app.fileManager.processFrontMatter(n,o=>{let l=o[a]||[];new Set(l.map(d=>d.id)).has(t.id)||(o[a]=[...l,t])})}catch(e){console.error("Failed to add session to daily note:",e)}}async updateDailyNotePomodoros(t,e){try{let r=_t(t),i=window.moment(r),n=(0,kr.getAllDailyNotes)(),a=(0,kr.getDailyNote)(i,n);if(!a&&(a=await(0,kr.createDailyNote)(i),!a))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let o=this.plugin.fieldMapper.toUserField("pomodoros");await this.plugin.app.fileManager.processFrontMatter(a,l=>{let c=l[o]||[],d=new Set(c.map(h=>h.id)),u=e.filter(h=>!d.has(h.id));u.length>0&&(l[o]=[...c,...u])})}catch(r){console.error(`Failed to update daily note for ${t}:`,r)}}mergeHistories(t,e){let r=[...e],i=new Set(e.map(n=>n.id));for(let n of t)i.has(n.id)||r.push(n);return r}async migrateTodailyNotes(){try{if(!(0,kr.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes core plugin must be enabled for migration");let t=await this.plugin.loadData(),e=(t==null?void 0:t.pomodoroHistory)||[];if(e.length===0)return;await this.saveHistoryToDailyNotes(e),t.pomodoroHistory=[],await this.plugin.saveData(t),new Si.Notice(`Successfully migrated ${e.length} pomodoro sessions to daily notes.`)}catch(t){throw console.error("Failed to migrate pomodoro data to daily notes:",t),new Si.Notice("Failed to migrate pomodoro data. Please try again or check the console for details."),t}}};ht();var si=require("obsidian");Se();ht();var Yh=class extends si.Events{constructor(e,r,i){super();this.tasksByDate=new Map;this.tasksByStatus=new Map;this.overdueTasks=new Set;this.initialized=!1;this.indexesBuilt=!1;this.eventListeners=[];this.debouncedHandlers=new Map;this.DEBOUNCE_DELAY=300;this.lastKnownTaskInfo=new Map;this.lastKnownFrontmatter=new Map;this.app=e,this.settings=r,this.taskTag=r.taskTag,this.excludedFolders=r.excludedFolders?r.excludedFolders.split(",").map(n=>n.trim()):[],this.fieldMapper=i,this.disableNoteIndexing=r.disableNoteIndexing,this.storeTitleInFilename=r.storeTitleInFilename}initialize(){this.initialized||(this.setupNativeEventListeners(),this.initialized=!0,this.trigger("cache-initialized",{message:"Minimal native cache ready"}))}getApp(){return this.app}isTaskFile(e){if(!e)return!1;if(this.settings.taskIdentificationMethod==="property"){let r=this.settings.taskPropertyName,i=this.settings.taskPropertyValue;if(!r||!i)return!1;let n=e[r];return n===void 0?!1:Array.isArray(n)?n.some(a=>this.comparePropertyValues(a,i)):this.comparePropertyValues(n,i)}else return Array.isArray(e.tags)&&e.tags.includes(this.taskTag)}comparePropertyValues(e,r){if(typeof e=="boolean"&&typeof r=="string"){let i=r.toLowerCase();if(i==="true"||i==="false")return e===(i==="true")}return e===r}setupNativeEventListeners(){this.eventListeners.push(this.app.metadataCache.on("changed",(e,r,i)=>{e instanceof si.TFile&&e.extension==="md"&&this.isValidFile(e.path)&&this.handleFileChangedDebounced(e,i)})),this.eventListeners.push(this.app.metadataCache.on("deleted",(e,r)=>{e instanceof si.TFile&&e.extension==="md"&&this.handleFileDeleted(e.path)})),this.eventListeners.push(this.app.vault.on("rename",(e,r)=>{e instanceof si.TFile&&e.extension==="md"&&this.handleFileRenamed(e,r)}))}ensureIndexesBuilt(){this.indexesBuilt||(this.indexesBuilt=!0,window.setTimeout(()=>this.buildEssentialIndexes(),1))}async buildEssentialIndexes(){try{let e=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path)),r=50;for(let i=0;i<e.length;i+=r){let n=e.slice(i,i+r);for(let a of n)try{let o=this.app.metadataCache.getFileCache(a);o!=null&&o.frontmatter&&this.isTaskFile(o.frontmatter)&&await this.indexTaskFile(a,o.frontmatter)}catch(o){console.error(`Error indexing file ${a.path}:`,o)}await new Promise(a=>window.setTimeout(a,1))}this.trigger("indexes-built",{tasksByDate:this.tasksByDate.size,tasksByStatus:this.tasksByStatus.size,overdueTasks:this.overdueTasks.size})}catch(e){console.error("Error building essential indexes:",e)}}async indexTaskFile(e,r){if(this.fieldMapper)try{let i=this.extractTaskInfoFromNative(e.path,r);if(!i)return;this.updateDateIndex(e.path,i),this.updateStatusIndex(e.path,i.status),this.updateOverdueIndex(e.path,i)}catch(i){console.error(`Error indexing task ${e.path}:`,i)}}async getTaskInfo(e){let r=this.app.vault.getAbstractFileByPath(e);if(!(r instanceof si.TFile))return null;let i=this.app.metadataCache.getFileCache(r);return i!=null&&i.frontmatter?this.extractTaskInfoFromNative(e,i.frontmatter):null}async getAllTasks(){let e=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path)),r=[];for(let i of e){let n=this.app.metadataCache.getFileCache(i);if(n!=null&&n.frontmatter&&this.isTaskFile(n.frontmatter)){let a=this.extractTaskInfoFromNative(i.path,n.frontmatter);a&&r.push(a)}}return r}getTasksForDate(e){this.ensureIndexesBuilt();let r=this.tasksByDate.get(e)||new Set;return Array.from(r)}getTaskPathsByStatus(e){this.ensureIndexesBuilt();let r=this.tasksByStatus.get(e)||new Set;return Array.from(r)}getOverdueTaskPaths(){return this.ensureIndexesBuilt(),new Set(this.overdueTasks)}async getCalendarData(e,r){let i=new Map,n=new Map,a=new Set,o=this.app.vault.getMarkdownFiles().filter(c=>this.isValidFile(c.path));try{let{getAllDailyNotes:c}=Vr(),d=c();for(let[u]of Object.entries(d))a.add(u)}catch(c){}for(let c of o){let d=this.app.metadataCache.getFileCache(c);if(!(d!=null&&d.frontmatter))continue;let u=d.frontmatter;if(!this.isTaskFile(u)&&!this.disableNoteIndexing){let p=null;if(this.fieldMapper){let f=this.fieldMapper.toUserField("dateCreated");if(u[f]){let m=u[f];try{let g=new Date(m);isNaN(g.getTime())||(p=g.toISOString().split("T")[0])}catch(g){}}}if(!p){let m=c.basename.match(/(\d{4}-\d{2}-\d{2})/);m&&(p=m[1],a.add(p))}if(p){let f=n.get(p)||0;n.set(p,f+1)}}}let l=new Date(e,r+1,0).getDate();for(let c=1;c<=l;c++){let d=`${e}-${String(r+1).padStart(2,"0")}-${String(c).padStart(2,"0")}`,u=this.getTasksForDate(d);if(u.length>0){let p=(await Promise.all(u.map(f=>this.getTaskInfo(f)))).filter(f=>f!==null);if(p.length>0){let f={count:p.length,hasDue:p.some(m=>m.due&&!m.scheduled),hasScheduled:p.some(m=>m.scheduled),hasCompleted:p.some(m=>m.status==="completed"||m.status==="done"),hasArchived:p.some(m=>m.archived),tasks:p};i.set(d,f)}}}return{tasks:i,notes:n,dailyNotes:a}}getAllTaskPaths(){let e=new Set,r=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of r){let n=this.app.metadataCache.getFileCache(i);n!=null&&n.frontmatter&&this.isTaskFile(n.frontmatter)&&e.add(i.path)}return e}getAllStatuses(){if(this.ensureIndexesBuilt(),this.tasksByStatus.size===0&&this.indexesBuilt){console.debug("MinimalNativeCache: Indexes marked as built but tasksByStatus is empty, computing statuses synchronously");let e=new Set,r=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of r){let n=this.app.metadataCache.getFileCache(i);if(n!=null&&n.frontmatter&&this.isTaskFile(n.frontmatter)){let a=this.extractTaskInfoFromNative(i.path,n.frontmatter);a!=null&&a.status&&e.add(a.status)}}return Array.from(e).sort()}return Array.from(this.tasksByStatus.keys()).sort()}getAllPriorities(){let e=new Set,r=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of r){let n=this.app.metadataCache.getFileCache(i);if(n!=null&&n.frontmatter&&this.isTaskFile(n.frontmatter)){let a=this.extractTaskInfoFromNative(i.path,n.frontmatter);a!=null&&a.priority&&e.add(a.priority)}}return Array.from(e).sort()}getAllTags(){let e=new Set,r=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of r){let n=this.app.metadataCache.getFileCache(i);if(n!=null&&n.frontmatter&&this.isTaskFile(n.frontmatter)){let a=this.extractTaskInfoFromNative(i.path,n.frontmatter);a!=null&&a.tags&&Array.isArray(a.tags)&&a.tags.forEach(o=>e.add(o))}}return Array.from(e).sort()}getAllContexts(){let e=new Set,r=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of r){let n=this.app.metadataCache.getFileCache(i);if(n!=null&&n.frontmatter&&this.isTaskFile(n.frontmatter)){let a=this.extractTaskInfoFromNative(i.path,n.frontmatter);a!=null&&a.contexts&&Array.isArray(a.contexts)&&a.contexts.forEach(o=>e.add(o))}}return Array.from(e).sort()}getAllProjects(){let e=new Set,r=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of r){let n=this.app.metadataCache.getFileCache(i);if(n!=null&&n.frontmatter&&this.isTaskFile(n.frontmatter)){let a=this.extractTaskInfoFromNative(i.path,n.frontmatter);if(a&&a.projects){let o=fr(a.projects);o.length>0&&o.forEach(l=>{this.extractProjectNamesFromValue(l,i.path).forEach(d=>{let u=d.trim();u.length>0&&e.add(u)})})}}}return Array.from(e).sort()}getAllProjectsWithDetails(){let e=new Map,r=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of r){let n=this.app.metadataCache.getFileCache(i);if(n!=null&&n.frontmatter&&this.isTaskFile(n.frontmatter)){let a=this.extractTaskInfoFromNative(i.path,n.frontmatter),o=fr((a==null?void 0:a.projects)||[]);o.length>0&&o.forEach(l=>{this.extractProjectDetailsFromValue(l,i.path).forEach(d=>{let u=e.get(d.name);u?u.usageCount++:e.set(d.name,{...d,usageCount:1})})})}}return Array.from(e.values()).sort((i,n)=>i.name.localeCompare(n.name))}getAllProjectFiles(){return this.getAllProjectsWithDetails().filter(r=>r.isLinkedNote&&r.exists&&r.filePath).map(r=>({name:r.name,path:r.filePath,usageCount:r.usageCount}))}extractProjectNamesFromValue(e,r){var n;if(!e)return[];let i=[];if(e.startsWith("[[")&&e.endsWith("]]")){let a=e.slice(2,-2),l=(0,si.parseLinktext)(a).path,c;if(c=this.app.metadataCache.getFirstLinkpathDest(l,""),!c){let d=r.substring(0,r.lastIndexOf("/"));c=this.app.metadataCache.getFirstLinkpathDest(l,d)}if(c)i.push(c.basename);else{let d=((n=l.split("/").pop())==null?void 0:n.replace(/\.md$/,""))||l;i.push(d)}}else{let a=e.trim();a&&i.push(a)}return i}extractProjectDetailsFromValue(e,r){var n;if(!e)return[];let i=[];if(e.startsWith("[[")&&e.endsWith("]]")){let a=e.slice(2,-2),l=(0,si.parseLinktext)(a).path,c;if(c=this.app.metadataCache.getFirstLinkpathDest(l,""),!c){let d=r.substring(0,r.lastIndexOf("/"));c=this.app.metadataCache.getFirstLinkpathDest(l,d)}if(c)i.push({name:c.basename,isLinkedNote:!0,filePath:c.path,exists:!0});else{let d=((n=l.split("/").pop())==null?void 0:n.replace(/\.md$/,""))||l;i.push({name:d,isLinkedNote:!0,filePath:void 0,exists:!1})}}else{let a=e.trim();a&&i.push({name:a,isLinkedNote:!1,filePath:void 0,exists:!1})}return i}getCachedTaskInfoSync(e){let r=this.app.vault.getAbstractFileByPath(e);if(!(r instanceof si.TFile))return null;let i=this.app.metadataCache.getFileCache(r);return!(i!=null&&i.frontmatter)||!this.isTaskFile(i.frontmatter)?null:this.extractTaskInfoFromNative(e,i.frontmatter)}async getCachedTaskInfo(e){return this.getTaskInfo(e)}async getTaskByPath(e){return this.getTaskInfo(e)}async getNotesForDate(e){if(this.disableNoteIndexing)return[];let r=ue(e.toISOString()),i=[],n=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of n){let o=this.app.metadataCache.getFileCache(a);if(!(o!=null&&o.frontmatter))continue;let l=o.frontmatter;if(this.isTaskFile(l))continue;let d=null;if(this.fieldMapper){let u=this.fieldMapper.toUserField("dateCreated");if(l[u]){let h=l[u];if(typeof h=="string"&&h.trim()){let p=h.trim();if(p.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(p))console.debug("Skipping invalid time-only date in note frontmatter:",{path:a.path,dateValue:p});else try{let f=Ae(h);d=ae(f)}catch(f){console.debug("Failed to parse date from note frontmatter:",{path:a.path,dateValue:h,error:f instanceof Error?f.message:String(f)})}}}}if(!d){let h=a.basename.match(/(\d{4}-\d{2}-\d{2})/);if(h)try{let p=Ae(h[1]);d=ae(p)}catch(p){}}if(d===r){let u=[];if(l.tags&&(Array.isArray(l.tags)?u=l.tags.filter(p=>typeof p=="string"):typeof l.tags=="string"&&(u=[l.tags])),o.tags){let p=o.tags.map(f=>f.tag.replace("#",""));u=[...new Set([...u,...p])]}let h={title:a.basename,tags:u,path:a.path,createdDate:d,lastModified:a.stat.mtime};i.push(h)}}return i}async getTaskInfoForDate(e){let r=e.toISOString().split("T")[0],i=this.getTasksForDate(r);return(await Promise.all(i.map(a=>this.getTaskInfo(a)))).filter(a=>a!==null)}getTaskPathsByDate(e){return new Set(this.getTasksForDate(e))}getTaskPathsByPriority(e){let r=[],i=this.app.vault.getMarkdownFiles().filter(n=>this.isValidFile(n.path));for(let n of i){let a=this.app.metadataCache.getFileCache(n);if(a!=null&&a.frontmatter&&this.isTaskFile(a.frontmatter)){let o=this.extractTaskInfoFromNative(n.path,a.frontmatter);(o==null?void 0:o.priority)===e&&r.push(n.path)}}return r}async rebuildDailyNotesCache(e,r){}updateDateIndex(e,r){for(let i of this.tasksByDate.values())i.delete(e);if(r.due){let i=ue(r.due);this.tasksByDate.has(i)||this.tasksByDate.set(i,new Set),this.tasksByDate.get(i).add(e)}if(r.scheduled){let i=ue(r.scheduled);this.tasksByDate.has(i)||this.tasksByDate.set(i,new Set),this.tasksByDate.get(i).add(e)}}updateStatusIndex(e,r){for(let i of this.tasksByStatus.values())i.delete(e);this.tasksByStatus.has(r)||this.tasksByStatus.set(r,new Set),this.tasksByStatus.get(r).add(e)}updateOverdueIndex(e,r){if(this.overdueTasks.delete(e),!r.recurrence){let i=St();r.due&&xi(r.due,i)?this.overdueTasks.add(e):!r.due&&r.scheduled&&xi(r.scheduled,i)&&this.overdueTasks.add(e)}}handleFileChangedDebounced(e,r){let i=this.app.metadataCache.getFileCache(e);if(!(i!=null&&i.frontmatter)||!this.isTaskFile(i.frontmatter))return;let n=i.frontmatter,a=this.lastKnownFrontmatter.get(e.path);if(this.frontmatterEquals(n,a))return;this.lastKnownFrontmatter.set(e.path,this.deepClone(n));let o=this.extractTaskInfoFromNative(e.path,n),l=this.getLastKnownTaskInfo(e.path);if(this.taskInfoEquals(o,l)){this.setLastKnownTaskInfo(e.path,o);return}this.setLastKnownTaskInfo(e.path,o);let c=this.debouncedHandlers.get(e.path);c&&clearTimeout(c);let d=setTimeout(()=>{this.handleFileChanged(e,r),this.debouncedHandlers.delete(e.path)},this.DEBOUNCE_DELAY);this.debouncedHandlers.set(e.path,d)}async handleFileChanged(e,r){if(!this.initialized)return;this.clearFileFromIndexes(e.path),await this.waitForFreshData(e);let i=this.app.metadataCache.getFileCache(e);i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)&&await this.indexTaskFile(e,i.frontmatter),this.trigger("file-updated",{path:e.path,file:e})}handleFileDeleted(e){this.initialized&&(this.clearFileFromIndexes(e),this.lastKnownTaskInfo.delete(e),this.lastKnownFrontmatter.delete(e),this.trigger("file-deleted",{path:e}))}async handleFileRenamed(e,r){if(!this.initialized)return;this.clearFileFromIndexes(r),this.lastKnownTaskInfo.delete(r),this.lastKnownFrontmatter.delete(r),await this.waitForFreshData(e);let i=this.app.metadataCache.getFileCache(e);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){await this.indexTaskFile(e,i.frontmatter);let n=this.extractTaskInfoFromNative(e.path,i.frontmatter);this.setLastKnownTaskInfo(e.path,n),this.lastKnownFrontmatter.set(e.path,this.deepClone(i.frontmatter))}this.trigger("file-renamed",{oldPath:r,newPath:e.path,file:e})}async waitForFreshData(e,r=10){let i=Date.now();for(let a=0;a<r;a++)try{if(!await this.app.vault.adapter.stat(e.path))break;let l=this.app.metadataCache.getFileCache(e);if(l!=null&&l.frontmatter&&(this.extractTaskInfoFromNative(e.path,l.frontmatter)||!this.isTaskFile(l.frontmatter)))return;let c=Math.min(50*Math.pow(1.5,a),200);await new Promise(d=>setTimeout(d,c))}catch(o){await new Promise(l=>setTimeout(l,50))}let n=Date.now()-i;n>500&&console.debug(`MinimalNativeCache: Waited ${n}ms for fresh data on ${e.path}`)}async waitForFreshTaskData(e,r,i=10){let n=Date.now();for(let o=0;o<i;o++)try{let l=this.app.metadataCache.getFileCache(e);if(!(l!=null&&l.frontmatter)){let u=Math.min(50*Math.pow(1.5,o),200);await new Promise(h=>setTimeout(h,u));continue}let c=this.extractTaskInfoFromNative(e.path,l.frontmatter);if(c)if(r){let u=!0;for(let[h,p]of Object.entries(r))if(c[h]!==p){u=!1;break}if(u)return}else return;let d=Math.min(50*Math.pow(1.5,o),200);await new Promise(u=>setTimeout(u,d))}catch(l){await new Promise(c=>setTimeout(c,50))}let a=Date.now()-n;a>500&&console.debug(`MinimalNativeCache: Waited ${a}ms for fresh task data on ${e.path}`,r)}getLastKnownTaskInfo(e){return this.lastKnownTaskInfo.get(e)||null}setLastKnownTaskInfo(e,r){this.lastKnownTaskInfo.set(e,r)}taskInfoEquals(e,r){return e===null&&r===null?!0:e===null||r===null||!(e.title===r.title&&e.status===r.status&&e.priority===r.priority&&e.due===r.due&&e.scheduled===r.scheduled&&e.archived===r.archived&&e.completedDate===r.completedDate&&e.recurrence===r.recurrence&&e.timeEstimate===r.timeEstimate)?!1:this.arraysEqual(e.tags,r.tags)&&this.arraysEqual(e.contexts,r.contexts)&&this.arraysEqual(e.projects,r.projects)&&this.objectsEqual(e.timeEntries,r.timeEntries)&&this.objectsEqual(e.reminders,r.reminders)&&this.objectsEqual(e.complete_instances,r.complete_instances)}arraysEqual(e,r){if(e===r)return!0;if(!e||!r)return e===r;if(e.length!==r.length)return!1;if(e.length===0)return!0;if(typeof e[0]=="string"){let i=[...e].sort(),n=[...r].sort();return i.every((a,o)=>a===n[o])}return JSON.stringify(e)===JSON.stringify(r)}objectsEqual(e,r){return e===r?!0:!e||!r?e===r:JSON.stringify(e)===JSON.stringify(r)}frontmatterEquals(e,r){return e===r?!0:!e||!r?e===r:JSON.stringify(e)===JSON.stringify(r)}deepClone(e){return e===null||typeof e!="object"?e:JSON.parse(JSON.stringify(e))}extractTaskInfoFromNative(e,r){if(!this.fieldMapper)return null;try{let i=this.fieldMapper.mapFromFrontmatter(r,e,this.storeTitleInFilename),n=i.timeEntries?pr(i.timeEntries):0;return{id:e,title:i.title||"Untitled task",status:i.status||"open",priority:i.priority||"normal",due:i.due,scheduled:i.scheduled,path:e,archived:i.archived||!1,tags:Array.isArray(i.tags)?i.tags:[],contexts:Array.isArray(i.contexts)?i.contexts:[],projects:Array.isArray(i.projects)?i.projects:[],recurrence:i.recurrence,complete_instances:i.complete_instances,completedDate:i.completedDate,timeEstimate:i.timeEstimate,timeEntries:i.timeEntries,totalTrackedTime:n,dateCreated:i.dateCreated,dateModified:i.dateModified,reminders:i.reminders}}catch(i){return console.error(`Error extracting task info from native metadata for ${e}:`,i),null}}isValidFile(e){return!this.excludedFolders.some(r=>e.startsWith(r))}clearFileFromIndexes(e){for(let r of this.tasksByDate.values())r.delete(e);for(let r of this.tasksByStatus.values())r.delete(e);this.overdueTasks.delete(e)}clearAllIndexes(){this.tasksByDate.clear(),this.tasksByStatus.clear(),this.overdueTasks.clear()}updateConfig(e,r,i,n=!1,a=!1){this.taskTag=e,this.excludedFolders=r?r.split(",").map(o=>o.trim()):[],this.fieldMapper=i,this.disableNoteIndexing=n,this.storeTitleInFilename=a,this.initialized&&(this.clearAllIndexes(),this.indexesBuilt=!1)}clearCacheEntry(e){let r=this.app.vault.getAbstractFileByPath(e);if(r instanceof si.TFile){let i=this.app.metadataCache.getFileCache(r);i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)&&this.indexTaskFile(r,i.frontmatter)}}async clearAllCaches(){this.clearAllIndexes(),this.indexesBuilt=!1}updateTaskInfoInCache(e,r){this.indexesBuilt&&(this.clearFileFromIndexes(e),this.updateDateIndex(e,r),this.updateStatusIndex(e,r.status),this.updateOverdueIndex(e,r))}subscribe(e,r){return this.on(e,r),()=>this.off(e,r)}isInitialized(){return this.initialized}getStats(){return{indexSizes:{tasksByDate:this.tasksByDate.size,tasksByStatus:this.tasksByStatus.size,overdueTasks:this.overdueTasks.size},memoryFootprint:"Minimal - only essential indexes"}}destroy(){this.eventListeners.forEach(e=>{this.app.metadataCache.offref(e)}),this.eventListeners=[],this.debouncedHandlers.forEach(e=>clearTimeout(e)),this.debouncedHandlers.clear(),this.lastKnownTaskInfo.clear(),this.lastKnownFrontmatter.clear(),this.clearAllIndexes(),this.initialized=!1,this.indexesBuilt=!1}};var Io=class{constructor(){this.inFlightRequests=new Map;this.prefetchQueue=new Set;this.prefetchPromises=new Map;this.activeTimeouts=new Set}async execute(t,e,r=5e3){if(this.inFlightRequests.has(t))return this.inFlightRequests.get(t);let i=this.createRequest(t,e,r);return this.inFlightRequests.set(t,i),i}async createRequest(t,e,r){try{let i=await e(),n=setTimeout(()=>{this.inFlightRequests.delete(t),this.activeTimeouts.delete(n)},r);return this.activeTimeouts.add(n),i}catch(i){throw this.inFlightRequests.delete(t),i}}prefetch(t,e,r="low"){if(!(this.inFlightRequests.has(t)||this.prefetchPromises.has(t)))if(r==="high")this.executePrefetch(t,e);else if(this.prefetchQueue.add(t),"requestIdleCallback"in window)requestIdleCallback(()=>{this.processPrefetchQueue(t,e)});else{let i=setTimeout(()=>{this.processPrefetchQueue(t,e),this.activeTimeouts.delete(i)},50);this.activeTimeouts.add(i)}}async executePrefetch(t,e){try{let r=e();this.prefetchPromises.set(t,r),await r;let i=setTimeout(()=>{this.prefetchPromises.delete(t),this.activeTimeouts.delete(i)},3e4);this.activeTimeouts.add(i)}catch(r){this.prefetchPromises.delete(t)}}processPrefetchQueue(t,e){this.prefetchQueue.has(t)&&(this.prefetchQueue.delete(t),this.executePrefetch(t,e))}getPrefetchedData(t){return this.prefetchPromises.get(t)||null}cancel(t){this.inFlightRequests.delete(t),this.prefetchPromises.delete(t),this.prefetchQueue.delete(t)}cancelAll(){this.inFlightRequests.clear(),this.prefetchPromises.clear(),this.prefetchQueue.clear();for(let t of this.activeTimeouts)clearTimeout(t);this.activeTimeouts.clear()}getStats(){return{inFlightCount:this.inFlightRequests.size,prefetchCount:this.prefetchPromises.size,queuedCount:this.prefetchQueue.size}}},jh=class{constructor(t){this.lastAccessTime=new Map;this.deduplicator=t}recordAccess(t,e,r){let i=this.getDateKey(t);this.lastAccessTime.set(i,Date.now()),this.prefetchAdjacentDates(t,e,r)}prefetchAdjacentDates(t,e,r){this.getAdjacentDates(t).forEach(({date:n,priority:a})=>{let o=`${e}-${this.getDateKey(n)}`;this.deduplicator.prefetch(o,()=>r(n),a)})}getAdjacentDates(t){let e=[],r=new Date(t);r.setDate(t.getDate()-1),e.push({date:r,priority:"high"});let i=new Date(t);i.setDate(t.getDate()+1),e.push({date:i,priority:"high"});for(let n=2;n<=7;n++){let a=new Date(t);a.setDate(t.getDate()-n),e.push({date:a,priority:"low"});let o=new Date(t);o.setDate(t.getDate()+n),e.push({date:o,priority:"low"})}return e}getDateKey(t){return t.toISOString().split("T")[0]}cleanup(){let t=Date.now(),e=1440*60*1e3;for(let[r,i]of this.lastAccessTime)t-i>e&&this.lastAccessTime.delete(r)}};var Po=class{constructor(){this.updateQueue=[];this.isProcessing=!1;this.activeTimeouts=new Set}scheduleUpdate(t){this.updateQueue.push(t),this.isProcessing||(this.isProcessing=!0,requestAnimationFrame(()=>{this.processUpdates()}))}processUpdates(){let t=[...this.updateQueue];this.updateQueue=[];try{t.forEach(e=>{try{e()}catch(r){console.error("Error processing DOM update:",r)}})}finally{this.isProcessing=!1,this.updateQueue.length>0&&requestAnimationFrame(()=>{this.processUpdates()})}}updateAttributes(t,e){for(let[r,i]of Object.entries(e))i===null?t.removeAttribute(r):t.getAttribute(r)!==i&&t.setAttribute(r,i)}updateClasses(t,e){for(let[r,i]of Object.entries(e))i?t.classList.add(r):t.classList.remove(r)}updateTextContent(t,e){t.textContent!==e&&(t.textContent=e)}updateStyles(t,e){for(let[r,i]of Object.entries(e))i===null?t.style.removeProperty(r):t.style.setProperty(r,i)}preserveState(t){let e={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,focused:document.activeElement===t,selection:null};return(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)&&(e.selection={start:t.selectionStart||0,end:t.selectionEnd||0}),e}restoreState(t,e){t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft,e.focused&&t.focus(),e.selection&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)&&t.setSelectionRange(e.selection.start,e.selection.end)}animateUpdate(t,e,r=1500){t.classList.add(`task-${e}`);let i=setTimeout(()=>{t.classList.remove(`task-${e}`),this.activeTimeouts.delete(i)},r);this.activeTimeouts.add(i)}updateList(t,e,r,i,n){let a=new Map,o=new Set;Array.from(t.children).forEach(d=>{let u=d.dataset.key;u&&(a.set(u,d),o.add(u))});let l=new Set(e.map(r)),c=document.createDocumentFragment();e.forEach(d=>{let u=r(d),h=a.get(u);if(h)n&&n(h,d),c.appendChild(h);else{let p=i(d);p.dataset.key=u,c.appendChild(p)}}),o.forEach(d=>{if(!l.has(d)){let u=a.get(d);u&&u.parentNode&&u.remove()}}),t.replaceChildren(c)}createOptimisticUpdate(t,e,r){return e(t),{commit:()=>{},revert:()=>{r(t)}}}destroy(){this.updateQueue=[],this.isProcessing=!1;for(let t of this.activeTimeouts)clearTimeout(t);this.activeTimeouts.clear()}},zh=class{constructor(){this.stateMap=new Map}saveState(t,e){let r=new Po;this.stateMap.set(t,r.preserveState(e))}restoreState(t,e){let r=this.stateMap.get(t);r&&new Po().restoreState(e,r)}clearState(t){t?this.stateMap.delete(t):this.stateMap.clear()}destroy(){this.stateMap.clear()}};Nf();Cd();var gt=require("obsidian");ot();var kM=require("obsidian");function qh(s,t){let e=d1(s),r=e.frontmatter?u1(e.frontmatter,t):{},i=h1(e.body,t);return{frontmatter:r,body:i}}function d1(s){var e,r;let t=s.split(`
`);if(((e=t[0])==null?void 0:e.trim())==="---"){let i=-1;for(let n=1;n<t.length;n++)if(((r=t[n])==null?void 0:r.trim())==="---"){i=n;break}if(i>0){let a=t.slice(1,i).join(`
`),l=t.slice(i+1).join(`
`);return{frontmatter:a.trim()||null,body:l}}}return{frontmatter:null,body:s}}function u1(s,t){try{let e=p1(s,t),r=(0,kM.parseYaml)(e);return typeof r!="object"||r===null?(console.warn("Template frontmatter did not parse to a valid object"),{}):r}catch(e){return console.error("Error processing template frontmatter:",e),{}}}function h1(s,t){return f1(s,t)}function p1(s,t){var d;let e=s,r=new Date,i=t.title||"",n=ed(i)?`"${ua(i)}"`:i;e=e.replace(/\{\{title\}\}/g,n),e=e.replace(/\{\{priority\}\}/g,t.priority||""),e=e.replace(/\{\{status\}\}/g,t.status||"");let a=Array.isArray(t.contexts)?t.contexts.join(", "):"";e=e.replace(/\{\{contexts\}\}/g,a);let o=Array.isArray(t.tags)?t.tags.join(", "):"";e=e.replace(/\{\{tags\}\}/g,o),e=e.replace(/\{\{timeEstimate\}\}/g,((d=t.timeEstimate)==null?void 0:d.toString())||""),e=e.replace(/\{\{dueDate\}\}/g,t.dueDate||""),e=e.replace(/\{\{scheduledDate\}\}/g,t.scheduledDate||""),e=e.replace(/\{\{details\}\}/g,t.details||"");let l=t.parentNote||"",c=l?`"${ua(l)}"`:"";if(e=e.replace(/\{\{parentNote\}\}/g,c),e=e.replace(/\{\{date\}\}/g,C(r,"yyyy-MM-dd")),e=e.replace(/\{\{time\}\}/g,C(r,"HH:mm")),"icsEventTitle"in t){let u=t,h=u.icsEventTitle||"",p=ed(h)?`"${ua(h)}"`:h;e=e.replace(/\{\{icsEventTitle\}\}/g,p),e=e.replace(/\{\{icsEventStart\}\}/g,u.icsEventStart||""),e=e.replace(/\{\{icsEventEnd\}\}/g,u.icsEventEnd||"");let f=u.icsEventLocation||"",m=f&&ed(f)?`"${ua(f)}"`:f;e=e.replace(/\{\{icsEventLocation\}\}/g,m);let g=u.icsEventDescription||"",y=g&&ed(g)?`"${ua(g)}"`:g;e=e.replace(/\{\{icsEventDescription\}\}/g,y),e=e.replace(/\{\{icsEventUrl\}\}/g,u.icsEventUrl||"");let w=u.icsEventSubscription||"",T=w&&ed(w)?`"${ua(w)}"`:w;e=e.replace(/\{\{icsEventSubscription\}\}/g,T);let S=u.icsEventId||"",x=S?`"${ua(S)}"`:"";e=e.replace(/\{\{icsEventId\}\}/g,x)}return e}function ed(s){if(!s)return!1;let t=/[[\]{}:>|*&!%#`@,]/,e=/^[-?]/,r=/^\d+\.?\d*$/,i=/^(true|false|yes|no|on|off)$/i;return t.test(s)||e.test(s)||r.test(s)||i.test(s)}function ua(s){return s?s.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):""}function f1(s,t){var a;let e=s,r=new Date;e=e.replace(/\{\{title\}\}/g,t.title||""),e=e.replace(/\{\{priority\}\}/g,t.priority||""),e=e.replace(/\{\{status\}\}/g,t.status||"");let i=Array.isArray(t.contexts)?t.contexts.join(", "):"";e=e.replace(/\{\{contexts\}\}/g,i);let n=Array.isArray(t.tags)?t.tags.join(", "):"";if(e=e.replace(/\{\{tags\}\}/g,n),e=e.replace(/\{\{timeEstimate\}\}/g,((a=t.timeEstimate)==null?void 0:a.toString())||""),e=e.replace(/\{\{dueDate\}\}/g,t.dueDate||""),e=e.replace(/\{\{scheduledDate\}\}/g,t.scheduledDate||""),e=e.replace(/\{\{details\}\}/g,t.details||""),e=e.replace(/\{\{parentNote\}\}/g,t.parentNote||""),e=e.replace(/\{\{date\}\}/g,C(r,"yyyy-MM-dd")),e=e.replace(/\{\{time\}\}/g,C(r,"HH:mm")),"icsEventTitle"in t){let o=t;e=e.replace(/\{\{icsEventTitle\}\}/g,o.icsEventTitle||""),e=e.replace(/\{\{icsEventStart\}\}/g,o.icsEventStart||""),e=e.replace(/\{\{icsEventEnd\}\}/g,o.icsEventEnd||""),e=e.replace(/\{\{icsEventLocation\}\}/g,o.icsEventLocation||""),e=e.replace(/\{\{icsEventDescription\}\}/g,o.icsEventDescription||""),e=e.replace(/\{\{icsEventUrl\}\}/g,o.icsEventUrl||""),e=e.replace(/\{\{icsEventSubscription\}\}/g,o.icsEventSubscription||""),e=e.replace(/\{\{icsEventId\}\}/g,o.icsEventId||"")}return e}function SM(s,t){return{...t,...s}}ht();Se();ot();var Gh=class{constructor(t){this.plugin=t}setWebhookNotifier(t){this.webhookNotifier=t}processFolderTemplate(t,e,r=new Date){if(!t)return t;let i=t;if(e){let o=Array.isArray(e.contexts)&&e.contexts.length>0?e.contexts[0]:"";i=i.replace(/\{\{context\}\}/g,o);let l=Array.isArray(e.projects)&&e.projects.length>0?e.projects[0]:"";i=i.replace(/\{\{project\}\}/g,l);let c=e.priority||"";i=i.replace(/\{\{priority\}\}/g,c);let d=e.status||"";i=i.replace(/\{\{status\}\}/g,d);let u=e.title?e.title.replace(/[<>:"/\\|?*]/g,"_"):"";i=i.replace(/\{\{title\}\}/g,u);let h=e.due||"";i=i.replace(/\{\{dueDate\}\}/g,h);let p=e.scheduled||"";i=i.replace(/\{\{scheduledDate\}\}/g,p);let f=c?c.substring(0,1).toUpperCase():"";i=i.replace(/\{\{priorityShort\}\}/g,f);let m=d?d.substring(0,1).toUpperCase():"";i=i.replace(/\{\{statusShort\}\}/g,m);let g=u?u.toLowerCase():"";i=i.replace(/\{\{titleLower\}\}/g,g);let y=u?u.toUpperCase():"";i=i.replace(/\{\{titleUpper\}\}/g,y);let w=u?u.toLowerCase().replace(/\s+/g,"_"):"";i=i.replace(/\{\{titleSnake\}\}/g,w);let T=u?u.toLowerCase().replace(/\s+/g,"-"):"";i=i.replace(/\{\{titleKebab\}\}/g,T);let S=u?u.replace(/(?:^\w|[A-Z]|\b\w)/g,(I,F)=>F===0?I.toLowerCase():I.toUpperCase()).replace(/\s+/g,""):"";i=i.replace(/\{\{titleCamel\}\}/g,S);let x=u?u.replace(/(?:^\w|[A-Z]|\b\w)/g,I=>I.toUpperCase()).replace(/\s+/g,""):"";i=i.replace(/\{\{titlePascal\}\}/g,x)}i=i.replace(/\{\{year\}\}/g,C(r,"yyyy")),i=i.replace(/\{\{month\}\}/g,C(r,"MM")),i=i.replace(/\{\{day\}\}/g,C(r,"dd")),i=i.replace(/\{\{date\}\}/g,C(r,"yyyy-MM-dd")),i=i.replace(/\{\{time\}\}/g,C(r,"HHmmss")),i=i.replace(/\{\{timestamp\}\}/g,C(r,"yyyy-MM-dd-HHmmss")),i=i.replace(/\{\{dateTime\}\}/g,C(r,"yyyy-MM-dd-HHmm")),i=i.replace(/\{\{hour\}\}/g,C(r,"HH")),i=i.replace(/\{\{minute\}\}/g,C(r,"mm")),i=i.replace(/\{\{second\}\}/g,C(r,"ss")),i=i.replace(/\{\{shortDate\}\}/g,C(r,"yyMMdd")),i=i.replace(/\{\{monthName\}\}/g,C(r,"MMMM")),i=i.replace(/\{\{monthNameShort\}\}/g,C(r,"MMM")),i=i.replace(/\{\{dayName\}\}/g,C(r,"EEEE")),i=i.replace(/\{\{dayNameShort\}\}/g,C(r,"EEE")),i=i.replace(/\{\{week\}\}/g,C(r,"ww")),i=i.replace(/\{\{quarter\}\}/g,C(r,"q")),i=i.replace(/\{\{time12\}\}/g,C(r,"hh:mm a")),i=i.replace(/\{\{time24\}\}/g,C(r,"HH:mm")),i=i.replace(/\{\{hourPadded\}\}/g,C(r,"HH")),i=i.replace(/\{\{hour12\}\}/g,C(r,"hh")),i=i.replace(/\{\{ampm\}\}/g,C(r,"a")),i=i.replace(/\{\{unix\}\}/g,Math.floor(r.getTime()/1e3).toString()),i=i.replace(/\{\{unixMs\}\}/g,r.getTime().toString()),i=i.replace(/\{\{milliseconds\}\}/g,C(r,"SSS")),i=i.replace(/\{\{ms\}\}/g,C(r,"SSS")),i=i.replace(/\{\{timezone\}\}/g,C(r,"xxx")),i=i.replace(/\{\{timezoneShort\}\}/g,C(r,"xx")),i=i.replace(/\{\{utcOffset\}\}/g,C(r,"xxx")),i=i.replace(/\{\{utcOffsetShort\}\}/g,C(r,"xx")),i=i.replace(/\{\{utcZ\}\}/g,"Z");let n=(()=>{let o=C(r,"yyMMdd"),l=new Date(r);l.setHours(0,0,0,0);let d=Math.floor((r.getTime()-l.getTime())/1e3).toString(36);return`${o}${d}`})();i=i.replace(/\{\{zettel\}\}/g,n);let a=Date.now().toString()+Math.random().toString(36).substring(2,7);return i=i.replace(/\{\{nano\}\}/g,a),i}async createTask(t){var e;try{if(!t.title||!t.title.trim())throw new Error("Title is required");let r=t.title.trim(),i=t.priority||this.plugin.settings.defaultTaskPriority,n=t.status||this.plugin.settings.defaultTaskStatus,a=t.dateCreated||ke(),o=t.dateModified||ke(),l=t.contexts||[],c=t.projects||[],d=t.tags||[];this.plugin.settings.taskIdentificationMethod==="tag"&&(d.includes(this.plugin.settings.taskTag)||(d=[this.plugin.settings.taskTag,...d]));let u={title:r,priority:i,status:n,date:new Date,dueDate:t.due,scheduledDate:t.scheduled},h=gh(u,this.plugin.settings),p="";if(t.creationContext==="inline-conversion"){let A=this.plugin.settings.inlineTaskConvertFolder||"";if(A.trim()){if(A.includes("{{currentNotePath}}")){let L=this.plugin.app.workspace.getActiveFile(),G=((e=L==null?void 0:L.parent)==null?void 0:e.path)||"";p=A.replace(/\{\{currentNotePath\}\}/g,G)}else p=A;p=this.processFolderTemplate(p,t)}else{let L=this.plugin.settings.tasksFolder||"";p=this.processFolderTemplate(L,t)}}else{let A=this.plugin.settings.tasksFolder||"";p=this.processFolderTemplate(A,t)}p&&await Ya(this.plugin.app.vault,p);let f=await pc(h,p,this.plugin.app.vault),m=p?`${p}/${f}.md`:`${f}.md`,g={title:r,status:n,priority:i,due:t.due||void 0,scheduled:t.scheduled||void 0,contexts:l.length>0?l:void 0,projects:c.length>0?c:void 0,timeEstimate:t.timeEstimate&&t.timeEstimate>0?t.timeEstimate:void 0,dateCreated:a,dateModified:o,recurrence:t.recurrence||void 0,reminders:t.reminders&&t.reminders.length>0?t.reminders:void 0,icsEventId:t.icsEventId||void 0},y=this.plugin.fieldMapper.mapToFrontmatter(g,this.plugin.settings.taskTag,this.plugin.settings.storeTitleInFilename);if(this.plugin.settings.taskIdentificationMethod==="property"){let A=this.plugin.settings.taskPropertyName,L=this.plugin.settings.taskPropertyValue;if(A&&L){let V=L.toLowerCase(),k=V==="true"||V==="false"?V==="true":L;y[A]=k}let G=d.filter(V=>V!==this.plugin.settings.taskTag);G.length>0&&(y.tags=G)}else y.tags=d;let w=await this.applyTemplate(t),T=SM(y,w.frontmatter);t.customFrontmatter&&(T={...T,...t.customFrontmatter});let x=`---
${(0,gt.stringifyYaml)(T)}---

`;w.body&&w.body.trim()&&(x+=`${w.body.trim()}

`);let I=await this.plugin.app.vault.create(m,x),F={...g,...T,title:T.title||g.title||r,status:T.status||g.status||n,priority:T.priority||g.priority||i,path:I.path,tags:d,archived:!1};try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(I,{title:F.title}),this.plugin.cacheManager.updateTaskInfoInCache(I.path,F)}catch(A){console.error("Error updating cache for new task:",A)}if(this.plugin.emitter.trigger(Fe,{path:I.path,updatedTask:F}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("task.created",{task:F})}catch(A){console.warn("Failed to trigger webhook for task creation:",A)}return{file:I,taskInfo:F}}catch(r){let i=r instanceof Error?r.message:String(r);throw console.error("Error creating task:",{error:i,stack:r instanceof Error?r.stack:void 0,taskData:t}),new Error(`Failed to create task: ${i}`)}}async applyTemplate(t){var r,i,n,a;let e=this.plugin.settings.taskCreationDefaults;if(!e.useBodyTemplate||!((r=e.bodyTemplate)!=null&&r.trim()))return{frontmatter:{},body:((i=t.details)==null?void 0:i.trim())||""};try{let o=(0,gt.normalizePath)(e.bodyTemplate.trim());o.endsWith(".md")||(o+=".md");let l=this.plugin.app.vault.getAbstractFileByPath(o);if(l instanceof gt.TFile){let c=await this.plugin.app.vault.read(l),d={title:t.title||"",priority:t.priority||"",status:t.status||"",contexts:Array.isArray(t.contexts)?t.contexts:[],tags:Array.isArray(t.tags)?t.tags:[],timeEstimate:t.timeEstimate||0,dueDate:t.due||"",scheduledDate:t.scheduled||"",details:t.details||"",parentNote:t.parentNote||""};return qh(c,d)}else return console.warn(`Task body template not found: ${o}`),new gt.Notice(`Task body template not found: ${o}`),{frontmatter:{},body:((n=t.details)==null?void 0:n.trim())||""}}catch(o){return console.error("Error reading task body template:",o),new gt.Notice(`Error reading task body template: ${e.bodyTemplate}`),{frontmatter:{},body:((a=t.details)==null?void 0:a.trim())||""}}}async toggleStatus(t){try{let r=this.plugin.statusManager.isCompletedStatus(t.status)?this.plugin.settings.defaultTaskStatus:this.plugin.statusManager.getCompletedStatuses()[0]||"done";return await this.updateProperty(t,"status",r)}catch(e){let r=e instanceof Error?e.message:String(e);throw console.error("Error toggling task status:",{error:r,stack:e instanceof Error?e.stack:void 0,taskPath:t.path,currentStatus:t.status}),new Error(`Failed to toggle task status: ${r}`)}}async updateProperty(t,e,r,i={}){try{let n=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(n instanceof gt.TFile))throw new Error(`Cannot find task file: ${t.path}`);let a=await this.plugin.cacheManager.getTaskInfo(t.path)||t,o={...a};o[e]=r,o.dateModified=ke(),e==="status"&&!a.recurrence&&(this.plugin.statusManager.isCompletedStatus(r)?o.completedDate=Ld():o.completedDate=void 0),await this.plugin.app.fileManager.processFrontMatter(n,l=>{let c=this.plugin.fieldMapper.toUserField(e);if(e==="status"){let u=String(r).toLowerCase(),h=u==="true"||u==="false"?u==="true":r;if(l[c]=h,!a.recurrence){let p=this.plugin.fieldMapper.toUserField("completedDate");this.plugin.statusManager.isCompletedStatus(r)?l[p]=Ld():l[p]&&delete l[p]}}else(e==="due"||e==="scheduled")&&!r?delete l[c]:l[c]=r;let d=this.plugin.fieldMapper.toUserField("dateModified");l[d]=o.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(n,{[e]:r}),await this.plugin.cacheManager.updateTaskInfoInCache(t.path,o)}catch(l){console.error("Error updating task cache:",{error:l instanceof Error?l.message:String(l),taskPath:t.path})}try{this.plugin.emitter.trigger(Fe,{path:t.path,originalTask:t,updatedTask:o})}catch(l){console.error("Error emitting task update event:",{error:l instanceof Error?l.message:String(l),taskPath:t.path})}if(this.webhookNotifier)try{let l=this.plugin.statusManager.isCompletedStatus(t.status),c=e==="status"&&this.plugin.statusManager.isCompletedStatus(r);e==="status"&&!l&&c?await this.webhookNotifier.triggerWebhook("task.completed",{task:o}):await this.webhookNotifier.triggerWebhook("task.updated",{task:o,previous:t})}catch(l){console.warn("Failed to trigger webhook for property update:",l)}return o}catch(n){let a=n instanceof Error?n.message:String(n);throw console.error("Error updating task property:",{error:a,stack:n instanceof Error?n.stack:void 0,taskPath:t.path,property:String(e),value:r}),new Error(`Failed to update task property: ${a}`)}}async toggleArchive(t){var o,l;let e=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof gt.TFile))throw new Error(`Cannot find task file: ${t.path}`);let r=this.plugin.fieldMapper.getMapping().archiveTag,i=t.archived,n={...t};n.archived=!i,n.dateModified=ke(),n.tags||(n.tags=[]),i?n.tags=n.tags.filter(c=>c!==r):n.tags.includes(r)||(n.tags=[...n.tags,r]),await this.plugin.app.fileManager.processFrontMatter(e,c=>{let d=this.plugin.fieldMapper.toUserField("dateModified");i?c.tags&&Array.isArray(c.tags)&&(c.tags=c.tags.filter(u=>u!==r),c.tags.length===0&&delete c.tags):(c.tags?Array.isArray(c.tags)||(c.tags=[c.tags]):c.tags=[],c.tags.includes(r)||c.tags.push(r)),c[d]=n.dateModified});let a=e;if(this.plugin.settings.moveArchivedTasks)try{if(!i&&((o=this.plugin.settings.archiveFolder)!=null&&o.trim())){let c=this.plugin.settings.archiveFolder.trim();await Ya(this.plugin.app.vault,c);let d=`${c}/${e.name}`;if(this.plugin.app.vault.getAbstractFileByPath(d))throw new Error(`A file named "${e.name}" already exists in the archive folder "${c}". Cannot move task to avoid overwriting existing file.`);await this.plugin.app.fileManager.renameFile(e,d),a=this.plugin.app.vault.getAbstractFileByPath(d),n.path=d,this.plugin.cacheManager.clearCacheEntry(t.path)}else if(i&&((l=this.plugin.settings.tasksFolder)!=null&&l.trim())){let c=this.plugin.settings.tasksFolder.trim();await Ya(this.plugin.app.vault,c);let d=`${c}/${e.name}`;if(this.plugin.app.vault.getAbstractFileByPath(d))throw new Error(`A file named "${e.name}" already exists in the tasks folder "${c}". Cannot move task to avoid overwriting existing file.`);await this.plugin.app.fileManager.renameFile(e,d),a=this.plugin.app.vault.getAbstractFileByPath(d),n.path=d,this.plugin.cacheManager.clearCacheEntry(t.path)}}catch(c){let d=c instanceof Error?c.message:String(c),u=i?"unarchiving":"archiving";console.error(`Error moving ${u} task:`,d),new gt.Notice(`Failed to move ${u} task: ${d}`)}try{a instanceof gt.TFile&&this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(a,{archived:n.archived}),await this.plugin.cacheManager.updateTaskInfoInCache(n.path,n)}catch(c){console.error("Error updating cache for archived task:",c)}if(this.plugin.emitter.trigger(Fe,{path:n.path,originalTask:t,updatedTask:n}),this.webhookNotifier)try{n.archived?await this.webhookNotifier.triggerWebhook("task.archived",{task:n}):await this.webhookNotifier.triggerWebhook("task.unarchived",{task:n})}catch(c){console.warn("Failed to trigger webhook for task archive/unarchive:",c)}return n}async startTimeTracking(t){var a;let e=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof gt.TFile))throw new Error(`Cannot find task file: ${t.path}`);if(this.plugin.getActiveTimeSession(t))throw new Error("Time tracking is already active for this task");let i={...t};i.dateModified=ke(),i.timeEntries||(i.timeEntries=[]);let n={startTime:ke(),description:"Work session"};i.timeEntries=[...i.timeEntries,n],await this.plugin.app.fileManager.processFrontMatter(e,o=>{let l=this.plugin.fieldMapper.toUserField("timeEntries"),c=this.plugin.fieldMapper.toUserField("dateModified");o[l]||(o[l]=[]),o[l].push(n),o[c]=i.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(e,{timeEntries:i.timeEntries}),await this.plugin.cacheManager.updateTaskInfoInCache(t.path,i)}catch(o){console.error("Error updating cache for time tracking start:",o)}if(this.plugin.emitter.trigger(Fe,{path:t.path,originalTask:t,updatedTask:i}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("time.started",{task:i,session:(a=i.timeEntries)==null?void 0:a[i.timeEntries.length-1]})}catch(o){console.warn("Failed to trigger webhook for time tracking start:",o)}return i}async stopTimeTracking(t){var n;let e=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof gt.TFile))throw new Error(`Cannot find task file: ${t.path}`);let r=this.plugin.getActiveTimeSession(t);if(!r)throw new Error("No active time tracking session for this task");let i={...t};if(i.dateModified=ke(),i.timeEntries&&Array.isArray(i.timeEntries)){let a=i.timeEntries.findIndex(o=>o.startTime===r.startTime&&!o.endTime);a!==-1&&(i.timeEntries=[...i.timeEntries],i.timeEntries[a]={...i.timeEntries[a],endTime:ke()})}await this.plugin.app.fileManager.processFrontMatter(e,a=>{let o=this.plugin.fieldMapper.toUserField("timeEntries"),l=this.plugin.fieldMapper.toUserField("dateModified");if(a[o]&&Array.isArray(a[o])){let c=a[o].findIndex(d=>d.startTime===r.startTime&&!d.endTime);c!==-1&&(a[o][c].endTime=ke())}a[l]=i.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(e,{timeEntries:i.timeEntries}),await this.plugin.cacheManager.updateTaskInfoInCache(t.path,i)}catch(a){console.error("Error updating cache for time tracking stop:",a)}if(this.plugin.emitter.trigger(Fe,{path:t.path,originalTask:t,updatedTask:i}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("time.stopped",{task:i,session:(n=i.timeEntries)==null?void 0:n[i.timeEntries.length-1]})}catch(a){console.warn("Failed to trigger webhook for time tracking stop:",a)}return i}async updateTask(t,e){try{let r=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(r instanceof gt.TFile))throw new Error(`Cannot find task file: ${t.path}`);let i=this.plugin.settings.storeTitleInFilename&&e.title&&e.title!==t.title,n=t.path;if(i){let l=r.parent?r.parent.path:"",c=await pc(e.title,l,this.plugin.app.vault);n=l?`${l}/${c}.md`:`${c}.md`}let a={};if(e.recurrence!==void 0&&e.recurrence!==t.recurrence){let l={...t,...e},c=Tl(l,this.plugin.settings.maintainDueDateOffsetInRecurring);if(c.scheduled&&(a.scheduled=c.scheduled),c.due&&(a.due=c.due),typeof e.recurrence=="string"&&e.recurrence&&!e.recurrence.includes("DTSTART:")){let d={...t,...e,...a},u=bl(d);u&&(a.recurrence=u)}}else if(e.recurrence!==void 0&&!t.recurrence&&e.recurrence&&typeof e.recurrence=="string"&&!e.recurrence.includes("DTSTART:")){let l={...t,...e},c=bl(l);c&&(a.recurrence=c)}if(e.scheduled!==void 0&&e.scheduled!==t.scheduled&&t.recurrence&&typeof t.recurrence=="string"&&!t.recurrence.includes("DTSTART:")){let l={...t,...e},c=bl(l);c&&(a.recurrence=c)}await this.plugin.app.fileManager.processFrontMatter(r,l=>{let c={...t,...e,...a,dateModified:ke()},d=this.plugin.fieldMapper.mapToFrontmatter(c,this.plugin.settings.taskTag,this.plugin.settings.storeTitleInFilename);Object.keys(d).forEach(u=>{d[u]!==void 0&&(l[u]=d[u])}),e.customFrontmatter&&Object.keys(e.customFrontmatter).forEach(u=>{let h=e.customFrontmatter[u];h===null?delete l[u]:l[u]=h}),e.hasOwnProperty("due")&&e.due===void 0&&delete l[this.plugin.fieldMapper.toUserField("due")],e.hasOwnProperty("scheduled")&&e.scheduled===void 0&&delete l[this.plugin.fieldMapper.toUserField("scheduled")],e.hasOwnProperty("contexts")&&e.contexts===void 0&&delete l[this.plugin.fieldMapper.toUserField("contexts")],e.hasOwnProperty("timeEstimate")&&e.timeEstimate===void 0&&delete l[this.plugin.fieldMapper.toUserField("timeEstimate")],e.hasOwnProperty("completedDate")&&e.completedDate===void 0&&delete l[this.plugin.fieldMapper.toUserField("completedDate")],e.hasOwnProperty("recurrence")&&e.recurrence===void 0&&delete l[this.plugin.fieldMapper.toUserField("recurrence")],i&&delete l[this.plugin.fieldMapper.toUserField("title")],e.hasOwnProperty("tags")?l.tags=e.tags:t.tags&&(l.tags=t.tags)}),i&&await this.plugin.app.fileManager.renameFile(r,n);let o={...t,...e,...a,path:n,dateModified:ke()};e.status!==void 0&&!t.recurrence&&(this.plugin.statusManager.isCompletedStatus(e.status)?t.completedDate||(o.completedDate=Ld()):o.completedDate=void 0),i&&this.plugin.cacheManager.clearCacheEntry(t.path);try{let l=this.plugin.app.vault.getAbstractFileByPath(n);if(l instanceof gt.TFile&&this.plugin.cacheManager.waitForFreshTaskData){let c={};e.title!==void 0&&(c.title=e.title),e.status!==void 0&&(c.status=e.status),e.priority!==void 0&&(c.priority=e.priority),Object.keys(c).length>0&&await this.plugin.cacheManager.waitForFreshTaskData(l,c)}await this.plugin.cacheManager.updateTaskInfoInCache(n,o)}catch(l){console.error("Error updating task cache:",{error:l instanceof Error?l.message:String(l),taskPath:n})}try{this.plugin.emitter.trigger(Fe,{path:n,originalTask:t,updatedTask:o})}catch(l){console.error("Error emitting task update event:",{error:l instanceof Error?l.message:String(l),taskPath:n})}if(this.webhookNotifier)try{let l=this.plugin.statusManager.isCompletedStatus(t.status),c=this.plugin.statusManager.isCompletedStatus(o.status);!l&&c?await this.webhookNotifier.triggerWebhook("task.completed",{task:o}):await this.webhookNotifier.triggerWebhook("task.updated",{task:o,previous:t})}catch(l){console.warn("Failed to trigger webhook for task update:",l)}return o}catch(r){let i=r instanceof Error?r.message:String(r);throw console.error("Error updating task:",{error:i,stack:r instanceof Error?r.stack:void 0,taskPath:t.path,updates:e}),new Error(`Failed to update task: ${i}`)}}async deleteTask(t){try{let e=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof gt.TFile))throw new Error(`Cannot find task file: ${t.path}`);if(await this.plugin.app.vault.delete(e),this.plugin.cacheManager.clearCacheEntry(t.path),this.plugin.emitter.trigger(Id,{path:t.path,deletedTask:t}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("task.deleted",{task:t})}catch(r){console.warn("Failed to trigger webhook for task deletion:",r)}}catch(e){let r=e instanceof Error?e.message:String(e);throw console.error("Error deleting task:",{error:r,stack:e instanceof Error?e.stack:void 0,taskPath:t.path}),new Error(`Failed to delete task: ${r}`)}}async toggleRecurringTaskComplete(t,e){let r=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(r instanceof gt.TFile))throw new Error(`Cannot find task file: ${t.path}`);let i=await this.plugin.cacheManager.getTaskInfo(t.path)||t;if(!i.recurrence)throw new Error("Task is not recurring");let n=e||this.plugin.selectedDate,a=ae(n),o=Array.isArray(i.complete_instances)?i.complete_instances:[],c=!o.includes(a),d={...i};if(d.dateModified=ke(),c?o.includes(a)||(d.complete_instances=[...o,a]):d.complete_instances=o.filter(h=>h!==a),c&&typeof d.recurrence=="string"&&!d.recurrence.includes("DTSTART:")){let h=bl(d);h&&(d.recurrence=h)}let u=Tl(d,this.plugin.settings.maintainDueDateOffsetInRecurring);u.scheduled&&(d.scheduled=u.scheduled),u.due&&(d.due=u.due),await this.plugin.app.fileManager.processFrontMatter(r,h=>{let p=this.plugin.fieldMapper.toUserField("completeInstances"),f=this.plugin.fieldMapper.toUserField("dateModified"),m=this.plugin.fieldMapper.toUserField("scheduled"),g=this.plugin.fieldMapper.toUserField("due"),y=this.plugin.fieldMapper.toUserField("recurrence");h[p]||(h[p]=[]);let w=h[p];c?w.includes(a)||(h[p]=[...w,a]):h[p]=w.filter(T=>T!==a),d.recurrence!==i.recurrence&&(h[y]=d.recurrence),d.scheduled&&(h[m]=d.scheduled),d.due&&(h[g]=d.due),h[f]=d.dateModified});try{if(this.plugin.cacheManager.waitForFreshTaskData){let h={complete_instances:d.complete_instances};d.scheduled!==i.scheduled&&(h.scheduled=d.scheduled),d.due!==i.due&&(h.due=d.due),await this.plugin.cacheManager.waitForFreshTaskData(r,h)}await this.plugin.cacheManager.updateTaskInfoInCache(i.path,d)}catch(h){console.error("Error updating cache for recurring task:",h)}if(this.plugin.emitter.trigger(Fe,{path:i.path,originalTask:i,updatedTask:d}),c&&this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("recurring.instance.completed",{task:d,date:a,targetDate:n})}catch(h){console.error("Error triggering recurring task completion webhook:",h)}return d}async deleteTimeEntry(t,e){let r=this.plugin.app.vault.getAbstractFileByPath(t.path);if(!(r instanceof gt.TFile))throw new Error(`Cannot find task file: ${t.path}`);if(!t.timeEntries||!Array.isArray(t.timeEntries))throw new Error("Task has no time entries");if(e<0||e>=t.timeEntries.length)throw new Error("Invalid time entry index");let i={...t};i.dateModified=ke(),i.timeEntries=t.timeEntries.filter((n,a)=>a!==e),await this.plugin.app.fileManager.processFrontMatter(r,n=>{let a=this.plugin.fieldMapper.toUserField("timeEntries"),o=this.plugin.fieldMapper.toUserField("dateModified");n[a]&&Array.isArray(n[a])&&(n[a]=n[a].filter((l,c)=>c!==e)),n[o]=i.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(r,{timeEntries:i.timeEntries}),await this.plugin.cacheManager.updateTaskInfoInCache(t.path,i)}catch(n){console.error("Error updating cache for time entry deletion:",n)}return this.plugin.emitter.trigger(Fe,{path:t.path,originalTask:t,updatedTask:i}),i}};var Qh=class extends Yi{constructor(e,r){super();this.filterState={};this.viewPreferences={};this.savedViews=[];this.storageKey="tasknotes-view-filter-state";this.preferencesStorageKey="tasknotes-view-preferences";this.savedViewsStorageKey="tasknotes-saved-views";this.app=e,this.plugin=r,this.loadFromStorage(),this.loadPreferencesFromStorage(),this.savedViews=[...this.plugin.settings.savedViews]}async initializeSavedViews(){await this.migrateAndLoadSavedViews()}getFilterState(e){let r=this.filterState[e];if(r){if(typeof r!="object"||r.type!=="group"||!Array.isArray(r.children)||typeof r.conjunction!="string"){console.warn(`ViewStateManager: Ignoring old format filter state for ${e}, will use default`),delete this.filterState[e],this.saveToStorage();return}return we.deepCloneFilterQuery(r)}}setFilterState(e,r){this.filterState[e]=we.deepCloneFilterQuery(r),this.saveToStorage(),this.emit("filter-state-changed",{viewType:e,query:we.deepCloneFilterQuery(r)})}clearFilterState(e){delete this.filterState[e],this.saveToStorage(),this.emit("filter-state-cleared",{viewType:e})}clearAllFilterStates(){this.filterState={},this.saveToStorage(),this.emit("all-filter-states-cleared")}getViewPreferences(e){return this.viewPreferences[e]}setViewPreferences(e,r){this.viewPreferences[e]={...r},this.savePreferencesToStorage(),this.emit("view-preferences-changed",{viewType:e,preferences:r})}clearViewPreferences(e){delete this.viewPreferences[e],this.savePreferencesToStorage(),this.emit("view-preferences-cleared",{viewType:e})}clearAllViewPreferences(){this.viewPreferences={},this.savePreferencesToStorage(),this.emit("all-view-preferences-cleared")}loadFromStorage(){try{let e=this.app.loadLocalStorage(this.storageKey);e&&typeof e=="string"&&(this.filterState=JSON.parse(e))}catch(e){console.warn("Failed to load view filter state from storage:",e),this.filterState={}}}saveToStorage(){try{this.app.saveLocalStorage(this.storageKey,JSON.stringify(this.filterState))}catch(e){console.warn("Failed to save view filter state to storage:",e)}}loadPreferencesFromStorage(){try{let e=this.app.loadLocalStorage(this.preferencesStorageKey);e&&typeof e=="string"&&(this.viewPreferences=JSON.parse(e))}catch(e){console.warn("Failed to load view preferences from storage:",e),this.viewPreferences={}}}savePreferencesToStorage(){try{this.app.saveLocalStorage(this.preferencesStorageKey,JSON.stringify(this.viewPreferences))}catch(e){console.warn("Failed to save view preferences to storage:",e)}}getAllFilterStates(){return{...this.filterState}}getSavedViews(){return this.savedViews.map(e=>({...e,query:we.deepCloneFilterQuery(e.query),viewOptions:e.viewOptions?{...e.viewOptions}:void 0}))}saveView(e,r,i,n){let a={id:this.generateId(),name:e,query:we.deepCloneFilterQuery(r),viewOptions:i?{...i}:void 0,visibleProperties:n?[...n]:void 0};return this.savedViews.push(a),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews()),a}updateView(e,r){let i=this.savedViews.findIndex(a=>a.id===e);if(i===-1)throw new Error(`Saved view with ID ${e} not found`);let n={...r};n.query&&(n.query=we.deepCloneFilterQuery(n.query)),n.viewOptions&&(n.viewOptions={...n.viewOptions}),this.savedViews[i]={...this.savedViews[i],...n},this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}deleteView(e){let r=this.savedViews.findIndex(i=>i.id===e);if(r===-1)throw new Error(`Saved view with ID ${e} not found`);this.savedViews.splice(r,1),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}getSavedView(e){let r=this.savedViews.find(i=>i.id===e);if(r)return{...r,query:we.deepCloneFilterQuery(r.query),viewOptions:r.viewOptions?{...r.viewOptions}:void 0,visibleProperties:r.visibleProperties?[...r.visibleProperties]:void 0}}clearAllSavedViews(){this.savedViews=[],this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}updateSavedViewProperties(e,r){let i=this.savedViews.find(n=>n.id===e);i&&(i.visibleProperties=r,this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews()))}getSavedViewProperties(e){let r=this.savedViews.find(i=>i.id===e);return r==null?void 0:r.visibleProperties}reorderSavedViews(e,r){if(e<0||e>=this.savedViews.length||r<0||r>this.savedViews.length||e===r)return;r=Math.min(r,this.savedViews.length-1);let[i]=this.savedViews.splice(e,1);this.savedViews.splice(r,0,i),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2,9)}async migrateAndLoadSavedViews(){try{this.savedViews=[...this.plugin.settings.savedViews];let e=this.app.loadLocalStorage(this.savedViewsStorageKey);if(e&&typeof e=="string"&&this.savedViews.length===0){console.log("TaskNotes: Migrating saved views from localStorage to plugin data...");let r=JSON.parse(e);this.savedViews=[...r],await this.saveSavedViewsToPluginData(),this.app.saveLocalStorage(this.savedViewsStorageKey,null),console.log(`TaskNotes: Successfully migrated ${r.length} saved views to plugin data.`)}}catch(e){console.warn("Failed to load/migrate saved views:",e),this.savedViews=[]}}async saveSavedViewsToPluginData(){try{this.plugin.settings.savedViews=[...this.savedViews],await this.plugin.saveSettings()}catch(e){console.warn("Failed to save saved views to plugin data:",e)}}needsMigration(){let r=!!this.app.loadLocalStorage(this.savedViewsStorageKey),i=this.plugin.settings.savedViews&&this.plugin.settings.savedViews.length>0;return r&&!i}async performMigration(){try{this.clearAllFilterStates(),await this.migrateAndLoadSavedViews(),this.emit("migration-complete")}catch(e){console.error("Error during ViewStateManager migration:",e),this.savedViews=[],await this.saveSavedViewsToPluginData()}}cleanup(){this.removeAllListeners()}};Kh();Fy();var Hy=class{constructor(t){this.plugin=t}createPostProcessor(){return(t,e)=>{if(!this.plugin.settings.enableTaskLinkOverlay)return;let r=t.querySelectorAll("a");for(let i of Array.from(r)){let n=i,a=n.getAttribute("href");n.classList.contains("internal-link")?this.processLink(n,e.sourcePath,"internal"):a&&!a.startsWith("http://")&&!a.startsWith("https://")&&!a.includes("://")&&this.processLink(n,e.sourcePath,"external")}}}async processLink(t,e,r){try{let i=t.getAttribute("href");if(!i)return;let n=i;if(r==="internal"){if(i.startsWith("app://")){let l=new URL(i);n=decodeURIComponent(l.pathname),n.startsWith("/")&&(n=n.substring(1))}}else{if(i.startsWith("http://")||i.startsWith("https://")||i.includes("://"))return;n=i}let a=this.resolveLinkPath(n,e);if(!a)return;let o=this.getTaskInfo(a);if(!o)return;await this.replaceWithTaskWidget(t,o,n)}catch(i){console.debug("Error processing link in reading mode:",i)}}resolveLinkPath(t,e){try{let r=t.replace(/\.\./g,"").trim();if(!r)return null;let i=this.plugin.app.metadataCache.getFirstLinkpathDest(r,e);return(i==null?void 0:i.path)||null}catch(r){return console.debug("Error resolving link path:",t,r),null}}getTaskInfo(t){try{if(!t||typeof t!="string"||t.trim().length===0)return null;let e=this.plugin.cacheManager;if(!e||!e.getCachedTaskInfoSync)return null;let r=e.getCachedTaskInfoSync(t);return r&&typeof r=="object"&&r.title?r:null}catch(e){return console.debug("Error getting task info for:",t,e),null}}async replaceWithTaskWidget(t,e,r){var i;try{let n=t.textContent||`[[${r}]]`,a,o=t.textContent||"";o!==r&&o!==e.title&&(a=o);let l=new No(e,this.plugin,n,a),c=this.createReadingModeWidget(l,e,n,a);(i=t.parentNode)==null||i.replaceChild(c,t)}catch(n){console.error("Error replacing wikilink with task widget:",n)}}createReadingModeWidget(t,e,r,i){let n={},a=t.toDOM(n);return a.classList.add("task-inline-preview--reading-mode"),a}};function xM(s){return new Hy(s).createPostProcessor()}var Oo=require("@codemirror/view");var ni=require("obsidian"),Jh=require("@codemirror/state");var MM=require("obsidian"),Ro=class{constructor(t){this.plugin=t}async getTasksLinkedToProject(t){try{let e=await this.plugin.cacheManager.getAllTasks(),r=t.basename,i=t.path;return e.filter(n=>!n.projects||n.projects.length===0?!1:n.projects.some(a=>{if(!a||typeof a!="string"||a.trim()==="")return!1;if(a.startsWith("[[")&&a.endsWith("]]")){let l=a.slice(2,-2).trim();if(!l)return!1;let c=this.plugin.app.metadataCache.getFirstLinkpathDest(l,"");return c&&c.path===t.path?!0:l===r||l===i}let o=String(a).trim();return o===r||o===i}))}catch(e){return console.error("Error getting tasks linked to project:",e),[]}}async isTaskUsedAsProject(t){try{let e=this.plugin.app.vault.getAbstractFileByPath(t);return e instanceof MM.TFile?(await this.getTasksLinkedToProject(e)).length>0:!1}catch(e){return console.error("Error checking if task is used as project:",e),!1}}sortTasks(t){return t.sort((e,r)=>{let i=this.plugin.statusManager.isCompletedStatus(e.status),n=this.plugin.statusManager.isCompletedStatus(r.status);if(i!==n)return i?1:-1;let a=this.plugin.priorityManager.getPriorityWeight(e.priority),o=this.plugin.priorityManager.getPriorityWeight(r.priority);return a!==o?o-a:e.due&&r.due?new Date(e.due).getTime()-new Date(r.due).getTime():e.due?-1:r.due?1:e.title.localeCompare(r.title)})}};Ss();var By=Jh.StateEffect.define(),Uy=class extends Oo.WidgetType{constructor(e,r,i,n=0){super();this.plugin=e;this.tasks=r;this.notePath=i;this.version=n;this.groupedTasks=new Map;this.filterBar=null;this.filterHeading=null;this.savedViewsUnsubscribe=null;this.taskListContainer=null;this.editorView=null;this.viewType=`${AS}:${i}`,this.groupedTasks.set("all",[...r]),this.filterService=new gn(e.cacheManager,e.statusManager,e.priorityManager,e);let a=this.plugin.viewStateManager.getFilterState(this.viewType);this.currentQuery=a||{type:"group",id:"root",conjunction:"and",children:[],sortKey:"priority",sortDirection:"desc",groupKey:"none"}}eq(e){let r=this.tasks.length===e.tasks.length&&this.tasks.every((i,n)=>{let a=e.tasks[n];return i.title===a.title&&i.status===a.status&&i.priority===a.priority&&i.due===a.due&&i.scheduled===a.scheduled&&i.path===a.path&&JSON.stringify(i.contexts||[])===JSON.stringify(a.contexts||[])&&JSON.stringify(i.projects||[])===JSON.stringify(a.projects||[])&&JSON.stringify(i.tags||[])===JSON.stringify(a.tags||[])&&i.timeEstimate===a.timeEstimate&&i.recurrence===a.recurrence&&JSON.stringify(i.complete_instances||[])===JSON.stringify(a.complete_instances||[])});return r&&this!==e&&this.notePath===e.notePath&&(e.currentQuery=this.currentQuery),this.version===e.version&&r}destroy(){this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.filterHeading&&(this.filterHeading.destroy(),this.filterHeading=null),this.savedViewsUnsubscribe&&(this.savedViewsUnsubscribe(),this.savedViewsUnsubscribe=null)}toDOM(e){this.editorView=e;let r=document.createElement("div");r.className="tasknotes-plugin project-note-subtasks project-subtasks-widget",r.setAttribute("contenteditable","false"),r.setAttribute("spellcheck","false"),r.setAttribute("data-widget-type","project-subtasks");let i=r.createEl("div",{cls:"project-note-subtasks__header"}),n=i.createEl("h3",{cls:"project-note-subtasks__title"});n.createSpan({text:"Subtasks"}),i.createEl("button",{text:"New",cls:"project-note-subtasks__new-btn"}).addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.createNewSubtask()});let o=r.createEl("div",{cls:"project-note-subtasks__content"});this.getCollapsedState()&&(n.classList.add("collapsed"),o.classList.add("collapsed")),n.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),n.classList.contains("collapsed")?(n.classList.remove("collapsed"),o.classList.remove("collapsed"),this.setCollapsedState(!1)):(n.classList.add("collapsed"),o.classList.add("collapsed"),this.setCollapsedState(!0))});let c=o.createEl("div",{cls:"project-note-subtasks__filter"});return this.taskListContainer=o.createEl("div",{cls:"project-note-subtasks__list"}),this.initializeFilterBar(c).then(()=>{this.taskListContainer&&this.applyFiltersAndRender(this.taskListContainer)}),this.renderTaskGroups(this.taskListContainer),r}async initializeFilterBar(e){try{let r=await this.filterService.getFilterOptions();this.filterBar=new ri(this.plugin.app,this.plugin,e,this.currentQuery,r,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"subtask-widget"});let i=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(i),this.filterBar.on("queryChange",a=>{this.currentQuery=a,this.plugin.viewStateManager.setFilterState(this.viewType,a);let o=e.querySelector(".filter-heading__controls");o&&this.createExpandCollapseButtons(o),this.taskListContainer&&this.applyFiltersAndRender(this.taskListContainer)}),this.filterBar.on("activeSavedViewChanged",()=>{this.editorView&&rd(this.editorView)}),this.filterBar.on("saveView",a=>{let o=this.plugin.viewStateManager.saveView(a.name,a.query,a.viewOptions,a.visibleProperties);this.filterBar.setActiveSavedView(o)}),this.filterBar.on("deleteView",a=>{this.plugin.viewStateManager.deleteView(a)}),this.filterBar.on("reorderViews",(a,o)=>{this.plugin.viewStateManager.reorderSavedViews(a,o)}),this.savedViewsUnsubscribe=this.plugin.viewStateManager.on("saved-views-changed",a=>{this.filterBar&&this.filterBar.updateSavedViews(a)}),this.filterBar.on("expandAllGroups",()=>{let a=this.currentQuery.groupKey||"none";Vt.expandAllGroups(this.viewType,a,this.plugin),this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(o=>{o.classList.remove("is-collapsed");let l=o.querySelector(".task-cards");l&&(l.style.display="")})}),this.filterBar.on("collapseAllGroups",()=>{let a=this.currentQuery.groupKey||"none",o=[];this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(l=>{let c=l.dataset.group;if(c){o.push(c),l.classList.add("is-collapsed");let d=l.querySelector(".task-cards");d&&(d.style.display="none")}}),Vt.collapseAllGroups(this.viewType,a,o,this.plugin)}),this.filterHeading=new mn(e);let n=e.querySelector(".filter-heading");if(n){let a=n.querySelector(".filter-heading__content");if(a){let o=a.createDiv({cls:"filter-heading__controls"});this.createExpandCollapseButtons(o)}}this.updateFilterHeading()}catch(r){console.error("Error initializing filter bar for subtasks:",r)}}createExpandCollapseButtons(e){if(!((this.currentQuery.groupKey||"none")!=="none")){e.style.display="none";return}e.style.display="flex",e.empty(),new ni.ButtonComponent(e).setIcon("list-tree").setTooltip("Expand All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none";this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(o=>{o.classList.remove("is-collapsed");let l=o.querySelector(".task-cards");l&&(l.style.display="")}),Vt.expandAllGroups(this.viewType,a,this.plugin)}).buttonEl.addClass("clickable-icon"),new ni.ButtonComponent(e).setIcon("list-collapse").setTooltip("Collapse All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none",o=[];this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(l=>{let c=l.dataset.group;if(c){o.push(c),l.classList.add("is-collapsed");let d=l.querySelector(".task-cards");d&&(d.style.display="none")}}),Vt.collapseAllGroups(this.viewType,a,o,this.plugin)}).buttonEl.addClass("clickable-icon")}updateFilterHeading(){if(!(!this.filterHeading||!this.filterBar))try{let e=Array.from(this.groupedTasks.values()).flat(),r=it.calculateGroupStats(e,this.plugin),i=this.filterBar.activeSavedView||null;this.filterHeading.update(i,r.completed,r.total)}catch(e){console.error("Error updating filter heading in ProjectSubtasksWidget:",e)}}async applyFiltersAndRender(e){try{let r=await this.filterService.getGroupedTasks(this.currentQuery),i=new Set(this.tasks.map(n=>n.path));this.groupedTasks.clear();for(let[n,a]of r){let o=a.filter(l=>i.has(l.path));o.length>0&&this.groupedTasks.set(n,o)}e&&this.renderTaskGroups(e),this.updateFilterHeading()}catch(r){console.error("Error applying filters to subtasks:",r),this.groupedTasks.clear(),this.groupedTasks.set("all",[...this.tasks]),this.updateFilterHeading()}}renderTaskGroups(e){var i,n;if(e.empty(),this.currentQuery.groupKey==="none"||this.groupedTasks.size<=1)(this.groupedTasks.size===1?Array.from(this.groupedTasks.values())[0]:this.groupedTasks.get("all")||[]).forEach(o=>{let l=er(o,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});l.classList.add("project-note-subtasks__task"),e.appendChild(l)});else for(let[a,o]of this.groupedTasks.entries()){if(o.length===0)continue;let l=e.createEl("div",{cls:"project-note-subtasks__group-section task-group"});l.setAttribute("data-group",a);let c=this.currentQuery.groupKey||"none",d=Vt.isGroupCollapsed(this.viewType,c,a,this.plugin),u=l.createEl("div",{cls:"project-note-subtasks__group-header task-group-header"}),h=u.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle group"}});try{(0,ni.setIcon)(h,"chevron-right")}catch(y){}let p=h.querySelector("svg");p?(p.classList.add("chevron"),p.setAttr("width","16"),p.setAttr("height","16")):(h.textContent="\u25B8",h.addClass("chevron-text"));let f=u.createEl("h4",{cls:"project-note-subtasks__group-title"});f.createSpan({text:this.getGroupDisplayName(a)});let m=it.calculateGroupStats(o,this.plugin);f.createSpan({text:` ${it.formatGroupCount(m.completed,m.total).text}`,cls:"agenda-view__item-count"});let g=l.createEl("div",{cls:"project-note-subtasks__group task-cards"});d&&(l.classList.add("is-collapsed"),g.style.display="none"),u.addEventListener("click",y=>{if(y.target.closest("a"))return;let T=!l.classList.contains("is-collapsed");Vt.setGroupCollapsed(this.viewType,c,a,T,this.plugin),l.classList.toggle("is-collapsed",T),g.style.display=T?"none":"",h.setAttribute("aria-expanded",String(!T))}),h.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation();let w=!l.classList.contains("is-collapsed");Vt.setGroupCollapsed(this.viewType,c,a,w,this.plugin),l.classList.toggle("is-collapsed",w),g.style.display=w?"none":"",h.setAttribute("aria-expanded",String(!w))}),h.setAttribute("aria-expanded",String(!d)),o.forEach(y=>{let w=er(y,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});w.classList.add("project-note-subtasks__task"),g.appendChild(w)})}let r=(n=(i=e.parentElement)==null?void 0:i.parentElement)==null?void 0:n.querySelector(".project-note-subtasks__title");if(r){r.empty(),r.createSpan({text:"Subtasks "});let a=Array.from(this.groupedTasks.values()).flat(),o=it.calculateGroupStats(a,this.plugin);r.createSpan({text:it.formatGroupCount(o.completed,o.total).text,cls:"agenda-view__item-count"})}}getGroupDisplayName(e){return Vt.formatGroupName(e,this.plugin)}createNewSubtask(){let e=this.plugin.app.workspace.getActiveFile();if(!e)return;let r=`[[${e.basename}]]`;this.plugin.openTaskCreationModal({projects:[r]})}getCollapsedState(){try{return localStorage.getItem("tasknotes-project-subtasks-collapsed")==="true"}catch(e){return!1}}setCollapsedState(e){try{e?localStorage.setItem("tasknotes-project-subtasks-collapsed","true"):localStorage.removeItem("tasknotes-project-subtasks-collapsed")}catch(r){}}},$y=class{constructor(t,e){this.plugin=e;this.cachedTasks=[];this.currentFile=null;this.eventListeners=[];this.version=0;this.view=t,this.projectService=new Ro(e),this.decorations=this.buildDecorations(t),this.setupEventListeners(),this.loadTasksForCurrentFile(t)}update(t){this.view=t.view;let e=t.transactions.some(i=>i.effects.some(n=>n.is(By)));(t.docChanged||t.viewportChanged||e)&&(e&&this.version++,this.decorations=this.buildDecorations(t.view));let r=this.getFileFromView(t.view);r!==this.currentFile&&(this.currentFile=r,this.loadTasksForCurrentFile(t.view))}destroy(){this.eventListeners.forEach(t=>{this.plugin.emitter.offref(t)}),this.eventListeners=[]}setupEventListeners(){let t=this.plugin.emitter.on(Ft,()=>{this.loadTasksForCurrentFile(this.view)}),e=this.plugin.emitter.on(Fe,()=>{this.loadTasksForCurrentFile(this.view)}),r=this.plugin.emitter.on(Id,()=>{this.loadTasksForCurrentFile(this.view)}),i=this.plugin.emitter.on(mi,()=>{this.loadTasksForCurrentFile(this.view)}),n=this.plugin.emitter.on("settings-changed",()=>{this.loadTasksForCurrentFile(this.view)}),a=this.plugin.emitter.on("file-updated",c=>{this.loadTasksForCurrentFile(this.view)}),o=this.plugin.emitter.on("file-deleted",c=>{this.loadTasksForCurrentFile(this.view)}),l=this.plugin.emitter.on("file-renamed",c=>{this.loadTasksForCurrentFile(this.view)});this.eventListeners.push(t,e,r,i,n,a,o,l)}dispatchUpdate(){if(this.version++,this.view&&typeof this.view.dispatch=="function")try{this.view.dispatch({effects:[By.of({forceUpdate:!0})]})}catch(t){console.error("Error dispatching project subtasks update:",t)}}async loadTasksForCurrentFile(t){let e=this.getFileFromView(t);if(e instanceof ni.TFile)try{let r=await this.projectService.getTasksLinkedToProject(e);(r.length!==this.cachedTasks.length||r.some((n,a)=>{let o=this.cachedTasks[a];return!o||n.title!==o.title||n.status!==o.status||n.priority!==o.priority||n.due!==o.due||n.path!==o.path}))&&(this.cachedTasks=r,this.dispatchUpdate())}catch(r){console.error("Error loading tasks for project note:",r)}else this.cachedTasks.length>0&&(this.cachedTasks=[],this.dispatchUpdate())}getFileFromView(t){let e=t.state.field(ni.editorInfoField,!1);return(e==null?void 0:e.file)||null}isTableCellEditor(t){try{let e=t.dom;if(e.closest("td, th")||e.closest(".cm-table-widget"))return!0;let n=t.state.field(ni.editorInfoField,!1);if(!(n!=null&&n.file)){let a=e.parentElement;for(;a&&a!==document.body;){if(a.tagName==="TABLE"||a.tagName==="TD"||a.tagName==="TH"||a.classList.contains("markdown-rendered"))return!0;a=a.parentElement}}return!1}catch(e){return console.debug("Error detecting table cell editor:",e),!1}}buildDecorations(t){var r;let e=new Jh.RangeSetBuilder;try{if(this.isTableCellEditor(t)||!this.plugin.settings.showProjectSubtasks||!t.state.field(ni.editorLivePreviewField)||this.cachedTasks.length===0)return e.finish();let i=t.state.doc;if(i.length===0)return e.finish();let n=this.findInsertionPosition(t,i);(n<0||n>i.length)&&(n=0);let a=(r=this.currentFile)==null?void 0:r.path;if(!a){let l=this.getFileFromView(t);a=l==null?void 0:l.path}if(!a)return console.warn("ProjectNoteDecorations: Cannot create widget without file context"),e.finish();let o=Oo.Decoration.widget({widget:new Uy(this.plugin,this.cachedTasks,a,this.version),side:1});e.add(n,n,o)}catch(i){console.error("Error building project note decorations:",i)}return e.finish()}findInsertionPosition(t,e){if(e.lines===0)return 0;if((this.plugin.settings.projectSubtasksPosition||"bottom")==="top"){let i=e.toString(),a=/^---\n[\s\S]*?\n---\n/.exec(i);return a?a[0].length:0}else return e.length}},b1={decorations:s=>s.decorations};function _M(s){return Oo.ViewPlugin.fromClass(class extends $y{constructor(t){super(t,s)}destroy(){super.destroy()}},b1)}function rd(s){if(!s||typeof s.dispatch!="function"){console.warn("Invalid EditorView passed to dispatchProjectSubtasksUpdate:",s);return}try{s.dispatch({effects:[By.of({forceUpdate:!0})]})}catch(t){console.error("Error dispatching project subtasks update:",t)}}var Xh=class{constructor(t){this.draggableInstances=new Map;this.plugin=t}makeTaskCardDraggable(t,e){if(this.draggableInstances.has(t))return;t.dataset.taskPath=e;let r=new dh(t);this.draggableInstances.set(t,r),t.style.cursor="grab",t.addEventListener("dragstart",i=>{t.classList.add("task-card--dragging"),i.dataTransfer&&(i.dataTransfer.setData("text/plain",e),i.dataTransfer.setData("application/x-task-path",e),i.dataTransfer.effectAllowed="copy")}),t.addEventListener("dragend",()=>{t.classList.remove("task-card--dragging")})}removeDraggable(t){let e=this.draggableInstances.get(t);e&&(e.destroy(),this.draggableInstances.delete(t))}destroy(){this.draggableInstances.forEach(t=>{t.destroy()}),this.draggableInstances.clear()}};Se();var As=require("obsidian");var ap=class s{constructor(t){P(this,"icaltype","binary");this.value=t}static fromString(t){return new s(t)}decodeValue(){return this._b64_decode(this.value)}setEncodedValue(t){this.value=this._b64_encode(t)}_b64_encode(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,i,n,a,o,l,c,d,u=0,h=0,p="",f=[];if(!t)return t;do r=t.charCodeAt(u++),i=t.charCodeAt(u++),n=t.charCodeAt(u++),d=r<<16|i<<8|n,a=d>>18&63,o=d>>12&63,l=d>>6&63,c=d&63,f[h++]=e.charAt(a)+e.charAt(o)+e.charAt(l)+e.charAt(c);while(u<t.length);p=f.join("");let m=t.length%3;return(m?p.slice(0,m-3):p)+"===".slice(m||3)}_b64_decode(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,i,n,a,o,l,c,d,u=0,h=0,p="",f=[];if(!t)return t;t+="";do a=e.indexOf(t.charAt(u++)),o=e.indexOf(t.charAt(u++)),l=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),d=a<<18|o<<12|l<<6|c,r=d>>16&255,i=d>>8&255,n=d&255,l==64?f[h++]=String.fromCharCode(r):c==64?f[h++]=String.fromCharCode(r,i):f[h++]=String.fromCharCode(r,i,n);while(u<t.length);return p=f.join(""),p}toString(){return this.value}},k1=/([PDWHMTS]{1,1})/,S1=["weeks","days","hours","minutes","seconds","isNegative"],Br=class s{constructor(t){P(this,"weeks",0);P(this,"days",0);P(this,"hours",0);P(this,"minutes",0);P(this,"seconds",0);P(this,"isNegative",!1);P(this,"icalclass","icalduration");P(this,"icaltype","duration");this.wrappedJSObject=this,this.fromData(t)}static fromSeconds(t){return new s().fromSeconds(t)}static isValueString(t){return t[0]==="P"||t[1]==="P"}static fromString(t){let e=0,r=Object.create(null),i=0;for(;(e=t.search(k1))!==-1;){let n=t[e],a=t.slice(0,Math.max(0,e));t=t.slice(e+1),i+=E1(n,a,r)}if(i<2)throw new Error('invalid duration value: Not enough duration components in "'+t+'"');return new s(r)}static fromData(t){return new s(t)}clone(){return s.fromData(this)}toSeconds(){let t=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-t:t}fromSeconds(t){let e=Math.abs(t);return this.isNegative=t<0,this.days=Rt(e/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,e-=(this.days+7*this.weeks)*86400,this.hours=Rt(e/3600),e-=this.hours*3600,this.minutes=Rt(e/60),e-=this.minutes*60,this.seconds=e,this}fromData(t){for(let e of S1)t&&e in t?this[e]=t[e]:this[e]=0}reset(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0}compare(t){let e=this.toSeconds(),r=t.toSeconds();return(e>r)-(e<r)}normalize(){this.fromSeconds(this.toSeconds())}toString(){if(this.toSeconds()==0)return"PT0S";{let t="";this.isNegative&&(t+="-"),t+="P";let e=!1;return this.weeks?this.days||this.hours||this.minutes||this.seconds?t+=this.weeks*7+this.days+"D":(t+=this.weeks+"W",e=!0):this.days&&(t+=this.days+"D"),e||(this.hours||this.minutes||this.seconds)&&(t+="T",this.hours&&(t+=this.hours+"H"),this.minutes&&(t+=this.minutes+"M"),this.seconds&&(t+=this.seconds+"S")),t}}toICALString(){return this.toString()}};function E1(s,t,e){let r;switch(s){case"P":t&&t==="-"?e.isNegative=!0:e.isNegative=!1;break;case"D":r="days";break;case"W":r="weeks";break;case"H":r="hours";break;case"M":r="minutes";break;case"S":r="seconds";break;default:return 0}if(r){if(!t&&t!==0)throw new Error('invalid duration value: Missing number before "'+s+'"');let i=parseInt(t,10);if(nd(i))throw new Error('invalid duration value: Invalid number "'+t+'" before "'+s+'"');e[r]=i}return 1}var sd=class s{constructor(t){P(this,"start",null);P(this,"end",null);P(this,"duration",null);P(this,"icalclass","icalperiod");P(this,"icaltype","period");if(this.wrappedJSObject=this,t&&"start"in t){if(t.start&&!(t.start instanceof te))throw new TypeError(".start must be an instance of ICAL.Time");this.start=t.start}if(t&&t.end&&t.duration)throw new Error("cannot accept both end and duration");if(t&&"end"in t){if(t.end&&!(t.end instanceof te))throw new TypeError(".end must be an instance of ICAL.Time");this.end=t.end}if(t&&"duration"in t){if(t.duration&&!(t.duration instanceof Br))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=t.duration}}static fromString(t,e){let r=t.split("/");if(r.length!==2)throw new Error('Invalid string value: "'+t+'" must contain a "/" char.');let i={start:te.fromDateTimeString(r[0],e)},n=r[1];return Br.isValueString(n)?i.duration=Br.fromString(n):i.end=te.fromDateTimeString(n,e),new s(i)}static fromData(t){return new s(t)}static fromJSON(t,e,r){function i(n,a){return r?te.fromString(n,a):te.fromDateTimeString(n,a)}return Br.isValueString(t[1])?s.fromData({start:i(t[0],e),duration:Br.fromString(t[1])}):s.fromData({start:i(t[0],e),end:i(t[1],e)})}clone(){return s.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})}getDuration(){return this.duration?this.duration:this.end.subtractDate(this.start)}getEnd(){if(this.end)return this.end;{let t=this.start.clone();return t.addDuration(this.duration),t}}compare(t){return t.compare(this.start)<0?1:t.compare(this.getEnd())>0?-1:0}toString(){return this.start+"/"+(this.end||this.duration)}toJSON(){return[this.start.toString(),(this.end||this.duration).toString()]}toICALString(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}},Lo,K=class K{constructor(t,e){P(this,"icalclass","icaltime");P(this,"_cachedUnixTime",null);P(this,"zone",null);P(this,"_pendingNormalization",!1);this.wrappedJSObject=this,this._time=Object.create(null),this._time.year=0,this._time.month=1,this._time.day=1,this._time.hour=0,this._time.minute=0,this._time.second=0,this._time.isDate=!1,this.fromData(t,e)}static daysInMonth(t,e){let r=[0,31,28,31,30,31,30,31,31,30,31,30,31],i=30;return t<1||t>12||(i=r[t],t==2&&(i+=K.isLeapYear(e))),i}static isLeapYear(t){return t<=1752?t%4==0:t%4==0&&t%100!=0||t%400==0}static fromDayOfYear(t,e){let r=e,i=t,n=new K;n.auto_normalize=!1;let a=K.isLeapYear(r)?1:0;if(i<1)return r--,a=K.isLeapYear(r)?1:0,i+=K.daysInYearPassedMonth[a][12],K.fromDayOfYear(i,r);if(i>K.daysInYearPassedMonth[a][12])return a=K.isLeapYear(r)?1:0,i-=K.daysInYearPassedMonth[a][12],r++,K.fromDayOfYear(i,r);n.year=r,n.isDate=!0;for(let o=11;o>=0;o--)if(i>K.daysInYearPassedMonth[a][o]){n.month=o+1,n.day=i-K.daysInYearPassedMonth[a][o];break}return n.auto_normalize=!0,n}static fromStringv2(t){return new K({year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(5,7),10),day:parseInt(t.slice(8,10),10),isDate:!0})}static fromDateString(t){return new K({year:tr(t.slice(0,4)),month:tr(t.slice(5,7)),day:tr(t.slice(8,10)),isDate:!0})}static fromDateTimeString(t,e){if(t.length<19)throw new Error('invalid date-time value: "'+t+'"');let r,i;t.slice(-1)==="Z"?r=Ye.utcTimezone:e&&(i=e.getParameter("tzid"),e.parent&&(e.parent.name==="standard"||e.parent.name==="daylight"?r=Ye.localTimezone:i&&(r=e.parent.getTimeZoneByID(i))));let n={year:tr(t.slice(0,4)),month:tr(t.slice(5,7)),day:tr(t.slice(8,10)),hour:tr(t.slice(11,13)),minute:tr(t.slice(14,16)),second:tr(t.slice(17,19))};return i&&!r&&(n.timezone=i),new K(n,r)}static fromString(t,e){return t.length>10?K.fromDateTimeString(t,e):K.fromDateString(t)}static fromJSDate(t,e){return new K().fromJSDate(t,e)}static now(){return K.fromJSDate(new Date,!1)}static weekOneStarts(t,e){let r=K.fromData({year:t,month:1,day:1,isDate:!0}),i=r.dayOfWeek(),n=e||K.DEFAULT_WEEK_START;return i>K.THURSDAY&&(r.day+=7),n>K.THURSDAY&&(r.day-=7),r.day-=i-n,r}static getDominicalLetter(t){let e="GFEDCBA",r=(t+(t/4|0)+(t/400|0)-(t/100|0)-1)%7;return K.isLeapYear(t)?e[(r+6)%7]+e[r]:e[r]}static get epochTime(){return xn(this,Lo)||fd(this,Lo,K.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"})),xn(this,Lo)}static _cmp_attr(t,e,r){return t[r]>e[r]?1:t[r]<e[r]?-1:0}get icaltype(){return this.isDate?"date":"date-time"}get year(){return this._getTimeAttr("year")}set year(t){this._setTimeAttr("year",t)}get month(){return this._getTimeAttr("month")}set month(t){this._setTimeAttr("month",t)}get day(){return this._getTimeAttr("day")}set day(t){this._setTimeAttr("day",t)}get hour(){return this._getTimeAttr("hour")}set hour(t){this._setTimeAttr("hour",t)}get minute(){return this._getTimeAttr("minute")}set minute(t){this._setTimeAttr("minute",t)}get second(){return this._getTimeAttr("second")}set second(t){this._setTimeAttr("second",t)}get isDate(){return this._getTimeAttr("isDate")}set isDate(t){this._setTimeAttr("isDate",t)}_getTimeAttr(t){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[t]}_setTimeAttr(t,e){t==="isDate"&&e&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[t]=e}clone(){return new K(this._time,this.zone)}reset(){this.fromData(K.epochTime),this.zone=Ye.utcTimezone}resetTo(t,e,r,i,n,a,o){this.fromData({year:t,month:e,day:r,hour:i,minute:n,second:a,zone:o})}fromJSDate(t,e){return t?e?(this.zone=Ye.utcTimezone,this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds()):(this.zone=Ye.localTimezone,this.year=t.getFullYear(),this.month=t.getMonth()+1,this.day=t.getDate(),this.hour=t.getHours(),this.minute=t.getMinutes(),this.second=t.getSeconds()):this.reset(),this._cachedUnixTime=null,this}fromData(t,e){if(t)for(let[r,i]of Object.entries(t))r!=="icaltype"&&(this[r]=i);if(e&&(this.zone=e),t&&!("isDate"in t)?this.isDate=!("hour"in t):t&&"isDate"in t&&(this.isDate=t.isDate),t&&"timezone"in t){let r=lp.get(t.timezone);this.zone=r||Ye.localTimezone}return t&&"zone"in t&&(this.zone=t.zone),this.zone||(this.zone=Ye.localTimezone),this._cachedUnixTime=null,this}dayOfWeek(t){let e=t||K.SUNDAY,r=(this.year<<12)+(this.month<<8)+(this.day<<3)+e;if(r in K._dowCache)return K._dowCache[r];let i=this.day,n=this.month+(this.month<3?12:0),a=this.year-(this.month<3?1:0),o=i+a+Rt((n+1)*26/10)+Rt(a/4);return o+=Rt(a/100)*6+Rt(a/400),o=(o+7-e)%7+1,K._dowCache[r]=o,o}dayOfYear(){let t=K.isLeapYear(this.year)?1:0;return K.daysInYearPassedMonth[t][this.month-1]+this.day}startOfWeek(t){let e=t||K.SUNDAY,r=this.clone();return r.day-=(this.dayOfWeek()+7-e)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}endOfWeek(t){let e=t||K.SUNDAY,r=this.clone();return r.day+=(7-this.dayOfWeek()+e-K.SUNDAY)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}startOfMonth(){let t=this.clone();return t.day=1,t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t}endOfMonth(){let t=this.clone();return t.day=K.daysInMonth(t.month,t.year),t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t}startOfYear(){let t=this.clone();return t.day=1,t.month=1,t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t}endOfYear(){let t=this.clone();return t.day=31,t.month=12,t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t}startDoyWeek(t){let e=t||K.SUNDAY,r=this.dayOfWeek()-e;return r<0&&(r+=7),this.dayOfYear()-r}getDominicalLetter(){return K.getDominicalLetter(this.year)}nthWeekDay(t,e){let r=K.daysInMonth(this.month,this.year),i,n=e,a=0,o=this.clone();if(n>=0){o.day=1,n!=0&&n--,a=o.day;let l=o.dayOfWeek(),c=t-l;c<0&&(c+=7),a+=c,a-=t,i=t}else{o.day=r;let l=o.dayOfWeek();n++,i=l-t,i<0&&(i+=7),i=r-i}return i+=n*7,a+i}isNthWeekDay(t,e){let r=this.dayOfWeek();return e===0&&r===t||this.nthWeekDay(t,e)===this.day}weekNumber(t){let e=(this.year<<12)+(this.month<<8)+(this.day<<3)+t;if(e in K._wnCache)return K._wnCache[e];let r,i=this.clone();i.isDate=!0;let n=this.year;i.month==12&&i.day>25?(r=K.weekOneStarts(n+1,t),i.compare(r)<0?r=K.weekOneStarts(n,t):n++):(r=K.weekOneStarts(n,t),i.compare(r)<0&&(r=K.weekOneStarts(--n,t)));let a=i.subtractDate(r).toSeconds()/86400,o=Rt(a/7)+1;return K._wnCache[e]=o,o}addDuration(t){let e=t.isNegative?-1:1,r=this.second,i=this.minute,n=this.hour,a=this.day;r+=e*t.seconds,i+=e*t.minutes,n+=e*t.hours,a+=e*t.days,a+=e*7*t.weeks,this.second=r,this.minute=i,this.hour=n,this.day=a,this._cachedUnixTime=null}subtractDate(t){let e=this.toUnixTime()+this.utcOffset(),r=t.toUnixTime()+t.utcOffset();return Br.fromSeconds(e-r)}subtractDateTz(t){let e=this.toUnixTime(),r=t.toUnixTime();return Br.fromSeconds(e-r)}compare(t){if(t instanceof sd)return-1*t.compare(this);{let e=this.toUnixTime(),r=t.toUnixTime();return e>r?1:r>e?-1:0}}compareDateOnlyTz(t,e){let r=this.convertToZone(e),i=t.convertToZone(e),n=0;return(n=K._cmp_attr(r,i,"year"))!=0||(n=K._cmp_attr(r,i,"month"))!=0||(n=K._cmp_attr(r,i,"day"))!=0,n}convertToZone(t){let e=this.clone(),r=this.zone.tzid==t.tzid;return!this.isDate&&!r&&Ye.convert_time(e,this.zone,t),e.zone=t,e}utcOffset(){return this.zone==Ye.localTimezone||this.zone==Ye.utcTimezone?0:this.zone.utcOffset(this)}toICALString(){let t=this.toString();return t.length>10?je.icalendar.value["date-time"].toICAL(t):je.icalendar.value.date.toICAL(t)}toString(){let t=this.year+"-"+Dr(this.month)+"-"+Dr(this.day);return this.isDate||(t+="T"+Dr(this.hour)+":"+Dr(this.minute)+":"+Dr(this.second),this.zone===Ye.utcTimezone&&(t+="Z")),t}toJSDate(){return this.zone==Ye.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(this.toUnixTime()*1e3)}_normalize(){return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this}adjust(t,e,r,i,n){let a,o,l=0,c=0,d,u,h,p,f,m=n||this._time;if(m.isDate||(d=m.second+i,m.second=d%60,a=Rt(d/60),m.second<0&&(m.second+=60,a--),u=m.minute+r+a,m.minute=u%60,o=Rt(u/60),m.minute<0&&(m.minute+=60,o--),h=m.hour+e+o,m.hour=h%24,l=Rt(h/24),m.hour<0&&(m.hour+=24,l--)),m.month>12?c=Rt((m.month-1)/12):m.month<1&&(c=Rt(m.month/12)-1),m.year+=c,m.month-=12*c,p=m.day+t+l,p>0)for(;f=K.daysInMonth(m.month,m.year),!(p<=f);)m.month++,m.month>12&&(m.year++,m.month=1),p-=f;else for(;p<=0;)m.month==1?(m.year--,m.month=12):m.month--,p+=K.daysInMonth(m.month,m.year);return m.day=p,this._cachedUnixTime=null,this}fromUnixTime(t){this.zone=Ye.utcTimezone;let e=new Date(t*1e3);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this._time.isDate?(this.hour=0,this.minute=0,this.second=0):(this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()),this._cachedUnixTime=null}toUnixTime(){if(this._cachedUnixTime!==null)return this._cachedUnixTime;let t=this.utcOffset(),e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-t);return this._cachedUnixTime=e/1e3,this._cachedUnixTime}toJSON(){let t=["year","month","day","hour","minute","second","isDate"],e=Object.create(null),r=0,i=t.length,n;for(;r<i;r++)n=t[r],e[n]=this[n];return this.zone&&(e.timezone=this.zone.tzid),e}};Lo=new WeakMap,P(K,"_dowCache",{}),P(K,"_wnCache",{}),P(K,"fromData",function(e,r){return new K().fromData(e,r)}),pd(K,Lo,null),P(K,"daysInYearPassedMonth",[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]]),P(K,"SUNDAY",1),P(K,"MONDAY",2),P(K,"TUESDAY",3),P(K,"WEDNESDAY",4),P(K,"THURSDAY",5),P(K,"FRIDAY",6),P(K,"SATURDAY",7),P(K,"DEFAULT_WEEK_START",2);var te=K,D1=/[^ \t]/,op=":",Yy=";",C1="=",x1="unknown",M1="text",_1={"^'":'"',"^n":`
`,"^^":"^"};function He(s){let t={},e=t.component=[];if(t.stack=[e],He._eachLine(s,function(r,i){He._handleContentLine(i,t)}),t.stack.length>1)throw new _s("invalid ical body. component began but did not end");return t=null,e.length==1?e[0]:e}He.property=function(s,t){let e={component:[[],[]],designSet:t||je.defaultSet};return He._handleContentLine(s,e),e.component[1][0]};He.component=function(s){return He(s)};var _s=class extends Error{constructor(){super(...arguments);P(this,"name",this.constructor.name)}};He.ParserError=_s;He._handleContentLine=function(s,t){let e=s.indexOf(op),r=s.indexOf(Yy),i,n,a,o,l={};r!==-1&&e!==-1&&r>e&&(r=-1);let c;if(r!==-1){if(a=s.slice(0,Math.max(0,r)).toLowerCase(),c=He._parseParameters(s.slice(Math.max(0,r)),0,t.designSet),c[2]==-1)throw new _s("Invalid parameters in '"+s+"'");l=c[0];let y;if(typeof c[1]=="string"?y=c[1].length:y=c[1].reduce((w,T)=>w+T.length,0),i=y+c[2]+r,(n=s.slice(Math.max(0,i)).indexOf(op))!==-1)o=s.slice(Math.max(0,i+n+1));else throw new _s("Missing parameter value in '"+s+"'")}else if(e!==-1){if(a=s.slice(0,Math.max(0,e)).toLowerCase(),o=s.slice(Math.max(0,e+1)),a==="begin"){let y=[o.toLowerCase(),[],[]];t.stack.length===1?t.component.push(y):t.component[2].push(y),t.stack.push(t.component),t.component=y,t.designSet||(t.designSet=je.getDesignSet(t.component[0]));return}else if(a==="end"){t.component=t.stack.pop();return}}else throw new _s('invalid line (no token ";" or ":") "'+s+'"');let d,u=!1,h=!1,p,f,m;t.designSet.propertyGroups&&a.indexOf(".")!==-1?(f=a.split("."),l.group=f[0],m=f[1]):m=a,m in t.designSet.property&&(p=t.designSet.property[m],"multiValue"in p&&(u=p.multiValue),"structuredValue"in p&&(h=p.structuredValue),o&&"detectType"in p&&(d=p.detectType(o))),d||("value"in l?d=l.value.toLowerCase():p?d=p.defaultType:d=x1),delete l.value;let g;u&&h?(o=He._parseMultiValue(o,h,d,[],u,t.designSet,h),g=[m,l,d,o]):u?(g=[m,l,d],He._parseMultiValue(o,u,d,g,null,t.designSet,!1)):h?(o=He._parseMultiValue(o,h,d,[],null,t.designSet,h),g=[m,l,d,o]):(o=He._parseValue(o,d,t.designSet,!1),g=[m,l,d,o]),t.component[0]==="vcard"&&t.component[1].length===0&&!(a==="version"&&o==="4.0")&&(t.designSet=je.getDesignSet("vcard3")),t.component[1].push(g)};He._parseValue=function(s,t,e,r){return t in e.value&&"fromICAL"in e.value[t]?e.value[t].fromICAL(s,r):s};He._parseParameters=function(s,t,e){let r=t,i=0,n=C1,a={},o,l,c,d=-1,u,h,p;for(;i!==!1&&(i=s.indexOf(n,i+1))!==-1;){if(o=s.slice(r+1,i),o.length==0)throw new _s("Empty parameter name in '"+s+"'");if(l=o.toLowerCase(),p=!1,h=!1,l in e.param&&e.param[l].valueType?u=e.param[l].valueType:u=M1,l in e.param&&(h=e.param[l].multiValue,e.param[l].multiValueSeparateDQuote&&(p=He._rfc6868Escape('"'+h+'"'))),s[i+1]==='"'){if(d=i+2,i=s.indexOf('"',d),h&&i!=-1){let y=!0;for(;y;)s[i+1]==h&&s[i+2]=='"'?i=s.indexOf('"',i+3):y=!1}if(i===-1)throw new _s('invalid line (no matching double quote) "'+s+'"');c=s.slice(d,i),r=s.indexOf(Yy,i);let g=s.indexOf(op,i);(r===-1||g!==-1&&r>g)&&(i=!1)}else{d=i+1;let g=s.indexOf(Yy,d),y=s.indexOf(op,d);y!==-1&&g>y?(g=y,i=!1):g===-1?(y===-1?g=s.length:g=y,i=!1):(r=g,i=g),c=s.slice(d,g)}let m=c.length;if(c=He._rfc6868Escape(c),d+=m-c.length,h){let g=p||h;c=He._parseMultiValue(c,g,u,[],null,e)}else c=He._parseValue(c,u,e);h&&l in a?Array.isArray(a[l])?a[l].push(c):a[l]=[a[l],c]:a[l]=c}return[a,c,d]};He._rfc6868Escape=function(s){return s.replace(/\^['n^]/g,function(t){return _1[t]})};He._parseMultiValue=function(s,t,e,r,i,n,a){let o=0,l=0,c;if(t.length===0)return s;for(;(o=$M(s,t,l))!==-1;)c=s.slice(l,o),i?c=He._parseMultiValue(c,i,e,[],null,n,a):c=He._parseValue(c,e,n,a),r.push(c),l=o+t.length;return c=s.slice(l),i?c=He._parseMultiValue(c,i,e,[],null,n,a):c=He._parseValue(c,e,n,a),r.push(c),r.length==1?r[0]:r};He._eachLine=function(s,t){let e=s.length,r=s.search(D1),i=r,n,a,o;do i=s.indexOf(`
`,r)+1,i>1&&s[i-2]==="\r"?o=2:o=1,i===0&&(i=e,o=0),a=s[r],a===" "||a==="	"?n+=s.slice(r+1,i-o):(n&&t(null,n),n=s.slice(r,i-o)),r=i;while(i!==e);n=n.trim(),n.length&&t(null,n)};var A1=["tzid","location","tznames","latitude","longitude"],Ho,Bo,Ie=class Ie{constructor(t){P(this,"tzid","");P(this,"location","");P(this,"tznames","");P(this,"latitude",0);P(this,"longitude",0);P(this,"component",null);P(this,"expandedUntilYear",0);P(this,"icalclass","icaltimezone");this.wrappedJSObject=this,this.fromData(t)}static _compare_change_fn(t,e){return t.year<e.year?-1:t.year>e.year?1:t.month<e.month?-1:t.month>e.month?1:t.day<e.day?-1:t.day>e.day?1:t.hour<e.hour?-1:t.hour>e.hour?1:t.minute<e.minute?-1:t.minute>e.minute?1:t.second<e.second?-1:t.second>e.second?1:0}static convert_time(t,e,r){if(t.isDate||e.tzid==r.tzid||e==Ie.localTimezone||r==Ie.localTimezone)return t.zone=r,t;let i=e.utcOffset(t);return t.adjust(0,0,0,-i),i=r.utcOffset(t),t.adjust(0,0,0,i),null}static fromData(t){return new Ie().fromData(t)}static get utcTimezone(){return xn(this,Ho)||fd(this,Ho,Ie.fromData({tzid:"UTC"})),xn(this,Ho)}static get localTimezone(){return xn(this,Bo)||fd(this,Bo,Ie.fromData({tzid:"floating"})),xn(this,Bo)}static adjust_change(t,e,r,i,n){return te.prototype.adjust.call(t,e,r,i,n,t)}fromData(t){if(this.expandedUntilYear=0,this.changes=[],t instanceof ai)this.component=t;else{if(t&&"component"in t)if(typeof t.component=="string"){let e=He(t.component);this.component=new ai(e)}else t.component instanceof ai?this.component=t.component:this.component=null;for(let e of A1)t&&e in t&&(this[e]=t[e])}return this.component instanceof ai&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this}utcOffset(t){if(this==Ie.utcTimezone||this==Ie.localTimezone||(this._ensureCoverage(t.year),!this.changes.length))return 0;let e={year:t.year,month:t.month,day:t.day,hour:t.hour,minute:t.minute,second:t.second},r=this._findNearbyChange(e),i=-1,n=1;for(;;){let l=ga(this.changes[r],!0);if(l.utcOffset<l.prevUtcOffset?Ie.adjust_change(l,0,0,0,l.utcOffset):Ie.adjust_change(l,0,0,0,l.prevUtcOffset),Ie._compare_change_fn(e,l)>=0?i=r:n=-1,n==-1&&i!=-1)break;if(r+=n,r<0)return 0;if(r>=this.changes.length)break}let a=this.changes[i];if(a.utcOffset-a.prevUtcOffset<0&&i>0){let l=ga(a,!0);if(Ie.adjust_change(l,0,0,0,l.prevUtcOffset),Ie._compare_change_fn(e,l)<0){let c=this.changes[i-1],d=!1;a.is_daylight!=d&&c.is_daylight==d&&(a=c)}}return a.utcOffset}_findNearbyChange(t){let e=fa(this.changes,t,Ie._compare_change_fn);return e>=this.changes.length?this.changes.length-1:e}_ensureCoverage(t){if(Ie._minimumExpansionYear==-1){let r=te.now();Ie._minimumExpansionYear=r.year}let e=t;if(e<Ie._minimumExpansionYear&&(e=Ie._minimumExpansionYear),e+=Ie.EXTRA_COVERAGE,!this.changes.length||this.expandedUntilYear<t){let r=this.component.getAllSubcomponents(),i=r.length,n=0;for(;n<i;n++)this._expandComponent(r[n],e,this.changes);this.changes.sort(Ie._compare_change_fn),this.expandedUntilYear=e}}_expandComponent(t,e,r){if(!t.hasProperty("dtstart")||!t.hasProperty("tzoffsetto")||!t.hasProperty("tzoffsetfrom"))return null;let i=t.getFirstProperty("dtstart").getFirstValue(),n;function a(l){return l.factor*(l.hours*3600+l.minutes*60)}function o(){let l={};return l.is_daylight=t.name=="daylight",l.utcOffset=a(t.getFirstProperty("tzoffsetto").getFirstValue()),l.prevUtcOffset=a(t.getFirstProperty("tzoffsetfrom").getFirstValue()),l}if(!t.hasProperty("rrule")&&!t.hasProperty("rdate"))n=o(),n.year=i.year,n.month=i.month,n.day=i.day,n.hour=i.hour,n.minute=i.minute,n.second=i.second,Ie.adjust_change(n,0,0,0,-n.prevUtcOffset),r.push(n);else{let l=t.getAllProperties("rdate");for(let d of l){let u=d.getFirstValue();n=o(),n.year=u.year,n.month=u.month,n.day=u.day,u.isDate?(n.hour=i.hour,n.minute=i.minute,n.second=i.second,i.zone!=Ie.utcTimezone&&Ie.adjust_change(n,0,0,0,-n.prevUtcOffset)):(n.hour=u.hour,n.minute=u.minute,n.second=u.second,u.zone!=Ie.utcTimezone&&Ie.adjust_change(n,0,0,0,-n.prevUtcOffset)),r.push(n)}let c=t.getFirstProperty("rrule");if(c){c=c.getFirstValue(),n=o(),c.until&&c.until.zone==Ie.utcTimezone&&(c.until.adjust(0,0,0,n.prevUtcOffset),c.until.zone=Ie.localTimezone);let d=c.iterator(i),u;for(;(u=d.next())&&(n=o(),!(u.year>e||!u));)n.year=u.year,n.month=u.month,n.day=u.day,n.hour=u.hour,n.minute=u.minute,n.second=u.second,n.isDate=u.isDate,Ie.adjust_change(n,0,0,0,-n.prevUtcOffset),r.push(n)}}return r}toString(){return this.tznames?this.tznames:this.tzid}};Ho=new WeakMap,Bo=new WeakMap,pd(Ie,Ho,null),pd(Ie,Bo,null),P(Ie,"_minimumExpansionYear",-1),P(Ie,"EXTRA_COVERAGE",5);var Ye=Ie,dr=null,lp={get count(){return dr===null?0:Object.keys(dr).length},reset:function(){dr=Object.create(null);let s=Ye.utcTimezone;dr.Z=s,dr.UTC=s,dr.GMT=s},_hard_reset:function(){dr=null},has:function(s){return dr===null?!1:!!dr[s]},get:function(s){return dr===null&&this.reset(),dr[s]},register:function(s,t){if(dr===null&&this.reset(),typeof s=="string"&&t instanceof Ye&&([s,t]=[t,s]),t||(s instanceof Ye?t=s.tzid:s.name==="vtimezone"&&(s=new Ye(s),t=s.tzid)),!t)throw new TypeError("Neither a timezone nor a name was passed");if(s instanceof Ye)dr[t]=s;else throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")},remove:function(s){return dr===null?null:delete dr[s]}};function I1(s){let t,e,r,i,n;if(!s||s.name!=="vcalendar")return s;for(t=s.getAllSubcomponents(),e=[],r={},n=0;n<t.length;n++)if(t[n].name==="vtimezone"){let a=t[n].getFirstProperty("tzid").getFirstValue();r[a]=t[n]}else e=e.concat(t[n].getAllProperties());for(i={},n=0;n<e.length;n++){let a=e[n].getParameter("tzid");a&&(i[a]=!0)}for(let[a,o]of Object.entries(r))i[a]||s.removeSubcomponent(o);for(let a of Object.keys(i))!r[a]&&lp.has(a)&&s.addSubcomponent(lp.get(a).component);return s}function nd(s){return typeof s=="number"&&isNaN(s)}function tr(s){let t=parseInt(s,10);if(nd(t))throw new Error('Could not extract integer from "'+s+'"');return t}function xs(s,t){if(typeof s!="undefined")return s instanceof t?s:new t(s)}function $M(s,t,e){for(;(e=s.indexOf(t,e))!==-1;)if(e>0&&s[e-1]==="\\")e+=1;else return e;return-1}function fa(s,t,e){if(!s.length)return 0;let r=0,i=s.length-1,n,a;for(;r<=i;)if(n=r+Math.floor((i-r)/2),a=e(t,s[n]),a<0)i=n-1;else if(a>0)r=n+1;else break;return a<0?n:a>0?n+1:n}function ga(s,t){if(!s||typeof s!="object")return s;if(s instanceof Date)return new Date(s.getTime());if("clone"in s)return s.clone();if(Array.isArray(s)){let e=[];for(let r=0;r<s.length;r++)e.push(t?ga(s[r],!0):s[r]);return e}else{let e={};for(let[r,i]of Object.entries(s))t?e[r]=ga(i,!0):e[r]=i;return e}}function VM(s){let t="",e=s||"",r=0,i=0;for(;e.length;){let n=e.codePointAt(r);n<128?++i:n<2048?i+=2:n<65536?i+=3:i+=4,i<Qi.foldLength+1?r+=n>65535?2:1:(t+=Qi.newLineChar+" "+e.slice(0,Math.max(0,r)),e=e.slice(Math.max(0,r)),r=i=0)}return t.slice(Qi.newLineChar.length+1)}function Dr(s){switch(typeof s!="string"&&(typeof s=="number"&&(s=parseInt(s)),s=String(s)),s.length){case 0:return"00";case 1:return"0"+s;default:return s}}function Rt(s){return s<0?Math.ceil(s):Math.floor(s)}function ya(s,t){for(let e in s){let r=Object.getOwnPropertyDescriptor(s,e);r&&!Object.getOwnPropertyDescriptor(t,e)&&Object.defineProperty(t,e,r)}return t}var P1=Object.freeze({__proto__:null,binsearchInsert:fa,clone:ga,extend:ya,foldline:VM,formatClassType:xs,isStrictlyNaN:nd,pad2:Dr,strictParseInt:tr,trunc:Rt,unescapedIndexOf:$M,updateTimezones:I1}),Ms=class s{constructor(t){P(this,"hours",0);P(this,"minutes",0);P(this,"factor",1);P(this,"icaltype","utc-offset");this.fromData(t)}static fromString(t){let e={};return e.factor=t[0]==="+"?1:-1,e.hours=tr(t.slice(1,3)),e.minutes=tr(t.slice(4,6)),new s(e)}static fromSeconds(t){let e=new s;return e.fromSeconds(t),e}clone(){return s.fromSeconds(this.toSeconds())}fromData(t){if(t)for(let[e,r]of Object.entries(t))this[e]=r;this._normalize()}fromSeconds(t){let e=Math.abs(t);return this.factor=t<0?-1:1,this.hours=Rt(e/3600),e-=this.hours*3600,this.minutes=Rt(e/60),this}toSeconds(){return this.factor*(60*this.minutes+3600*this.hours)}compare(t){let e=this.toSeconds(),r=t.toSeconds();return(e>r)-(r>e)}_normalize(){let t=this.toSeconds(),e=this.factor;for(;t<-43200;)t+=97200;for(;t>50400;)t-=97200;this.fromSeconds(t),t==0&&(this.factor=e)}toICALString(){return je.icalendar.value["utc-offset"].toICAL(this.toString())}toString(){return(this.factor==1?"+":"-")+Dr(this.hours)+":"+Dr(this.minutes)}},pa=class s extends te{constructor(e,r,i){super(e,r);P(this,"icalclass","vcardtime");P(this,"icaltype","date-and-or-time");this.icaltype=i||"date-and-or-time"}static fromDateAndOrTimeString(e,r){function i(g,y,w){return g?tr(g.slice(y,y+w)):null}let n=e.split("T"),a=n[0],o=n[1],l=o?je.vcard.value.time._splitZone(o):[],c=l[0],d=l[1],u=a?a.length:0,h=d?d.length:0,p=a&&a[0]=="-"&&a[1]=="-",f=d&&d[0]=="-",m={year:p?null:i(a,0,4),month:p&&(u==4||u==7)?i(a,2,2):u==7||u==10?i(a,5,2):null,day:u==5?i(a,3,2):u==7&&p?i(a,5,2):u==10?i(a,8,2):null,hour:f?null:i(d,0,2),minute:f&&h==3?i(d,1,2):h>4?f?i(d,1,2):i(d,3,2):null,second:h==4?i(d,2,2):h==6?i(d,4,2):h==8?i(d,6,2):null};return c=="Z"?c=Ye.utcTimezone:c&&c[3]==":"?c=Ms.fromString(c):c=null,new s(m,c,r)}clone(){return new s(this._time,this.zone,this.icaltype)}_normalize(){return this}utcOffset(){return this.zone instanceof Ms?this.zone.toSeconds():te.prototype.utcOffset.apply(this,arguments)}toICALString(){return je.vcard.value[this.icaltype].toICAL(this.toString())}toString(){let e=this.year,r=this.month,i=this.day,n=this.hour,a=this.minute,o=this.second,l=e!==null,c=r!==null,d=i!==null,u=n!==null,h=a!==null,p=o!==null,f=(l?Dr(e)+(c||d?"-":""):c||d?"--":"")+(c?Dr(r):"")+(d?"-"+Dr(i):""),m=(u?Dr(n):"-")+(u&&h?":":"")+(h?Dr(a):"")+(!u&&!h?"-":"")+(h&&p?":":"")+(p?Dr(o):""),g;switch(this.zone===Ye.utcTimezone?g="Z":this.zone instanceof Ms?g=this.zone.toString():this.zone===Ye.localTimezone?g="":this.zone instanceof Ye?g=Ms.fromSeconds(this.zone.utcOffset(this)).toString():g="",this.icaltype){case"time":return m+g;case"date-and-or-time":case"date-time":return f+(m=="--"?"":"T"+m+g);case"date":return f}return null}},Er=class Er{constructor(t){P(this,"completed",!1);P(this,"rule",null);P(this,"dtstart",null);P(this,"last",null);P(this,"occurrence_number",0);P(this,"by_indices",null);P(this,"initialized",!1);P(this,"by_data",null);P(this,"days",null);P(this,"days_index",0);this.fromData(t)}fromData(t){if(this.rule=xs(t.rule,Ei),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=xs(t.dtstart,te),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");if(t.by_data?this.by_data=t.by_data:this.by_data=ga(this.rule.parts,!0),t.occurrence_number&&(this.occurrence_number=t.occurrence_number),this.days=t.days||[],t.last&&(this.last=xs(t.last,te)),this.by_indices=t.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=t.initialized||!1,!this.initialized)try{this.init()}catch(e){if(e instanceof Fo)this.completed=!0;else throw e}}init(){this.initialized=!0,this.last=this.dtstart.clone();let t=this.by_data;if("BYDAY"in t&&this.sort_byday_rules(t.BYDAY),"BYYEARDAY"in t&&("BYMONTH"in t||"BYWEEKNO"in t||"BYMONTHDAY"in t))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in t&&"BYMONTHDAY"in t)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if(this.rule.freq=="MONTHLY"&&("BYYEARDAY"in t||"BYWEEKNO"in t))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if(this.rule.freq=="WEEKLY"&&("BYYEARDAY"in t||"BYMONTHDAY"in t))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if(this.rule.freq!="YEARLY"&&"BYYEARDAY"in t)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),this.rule.freq=="WEEKLY")if("BYDAY"in t){let[,e]=this.ruleDayOfWeek(t.BYDAY[0],this.rule.wkst),r=e-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<e&&r>=0||r<0)&&(this.last.day+=r)}else{let e=Ei.numericDayToIcalDay(this.dtstart.dayOfWeek());t.BYDAY=[e]}if(this.rule.freq=="YEARLY"){let e=this.rule.until?this.rule.until.year:2e4;for(;this.last.year<=e&&(this.expand_year_days(this.last.year),!(this.days.length>0));)this.increment_year(this.rule.interval);if(this.days.length==0)throw new Fo;if(!this._nextByYearDay()&&!this.next_year()&&!this.next_year()&&!this.next_year())throw new Fo}if(this.rule.freq=="MONTHLY"){if(this.has_by_data("BYDAY")){let e=null,r=this.last.clone(),i=te.daysInMonth(this.last.month,this.last.year);for(let n of this.by_data.BYDAY){this.last=r.clone();let[a,o]=this.ruleDayOfWeek(n),l=this.last.nthWeekDay(o,a);if(a>=6||a<=-6)throw new Error("Malformed values in BYDAY part");if(l>i||l<=0){if(e&&e.month==r.month)continue;for(;l>i||l<=0;)this.increment_month(),i=te.daysInMonth(this.last.month,this.last.year),l=this.last.nthWeekDay(o,a)}this.last.day=l,(!e||this.last.compare(e)<0)&&(e=this.last.clone())}if(this.last=e.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>i||this.last.day==0)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")){this.last.day=1;let e=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY).filter(r=>r>=this.last.day);if(e.length)this.last.day=e[0],this.by_data.BYMONTHDAY=e;else if(!this.next_month()&&!this.next_month()&&!this.next_month())throw new Fo}}}next(t=!1){let e=this.last?this.last.clone():null;if((this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)&&(this.completed=!0),this.completed)return null;if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;let r,i=0;do switch(r=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":if(r=this.next_month(),r)i=0;else if(++i==336)return this.completed=!0,null;break;case"YEARLY":if(r=this.next_year(),r)i=0;else if(++i==28)return this.completed=!0,null;break;default:return null}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!r);if(this.last.compare(e)==0){if(t)throw new Error("Same occurrence found twice, protecting you from death by recursion");this.next(!0)}return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)}next_second(){return this.next_generic("BYSECOND","SECONDLY","second","minute")}increment_second(t){return this.increment_generic(t,"second",60,"minute")}next_minute(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")}increment_minute(t){return this.increment_generic(t,"minute",60,"hour")}next_hour(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")}increment_hour(t){this.increment_generic(t,"hour",24,"monthday")}next_day(){let t=this.rule.freq=="DAILY";return this.next_hour()==0||(t?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0}next_week(){let t=0;if(this.next_weekday_by_week()==0)return t;if(this.has_by_data("BYWEEKNO")){this.by_indices.BYWEEKNO++,this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,t=1),this.last.month=1,this.last.day=1;let e=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*e,t&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return t}normalizeByMonthDayRules(t,e,r){let i=te.daysInMonth(e,t),n=[],a=0,o=r.length,l;for(;a<o;a++){if(l=parseInt(r[a],10),isNaN(l))throw new Error("Invalid BYMONTHDAY value");if(!(Math.abs(l)>i)){if(l<0)l=i+(l+1);else if(l===0)continue;n.indexOf(l)===-1&&n.push(l)}}return n.sort(function(c,d){return c-d})}_byDayAndMonthDay(t){let e,r=this.by_data.BYDAY,i,n=0,a,o=r.length,l=0,c,d=this,u=this.last.day;function h(){for(c=te.daysInMonth(d.last.month,d.last.year),e=d.normalizeByMonthDayRules(d.last.year,d.last.month,d.by_data.BYMONTHDAY),a=e.length;e[n]<=u&&!(t&&e[n]==u)&&n<a-1;)n++}function p(){u=0,d.increment_month(),n=0,h()}h(),t&&(u-=1);let f=48;for(;!l&&f;){if(f--,i=u+1,i>c){p();continue}let m=e[n++];if(m>=i)u=m;else{p();continue}for(let g=0;g<o;g++){let y=this.ruleDayOfWeek(r[g]),w=y[0],T=y[1];if(this.last.day=u,this.last.isNthWeekDay(T,w)){l=1;break}}if(!l&&n===a){p();continue}}if(f<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return l}next_month(){let t=1;if(this.next_hour()==0)return t;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))t=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){let e=te.daysInMonth(this.last.month,this.last.year),r=0,i=0;if(this.has_by_data("BYSETPOS")){let a=this.last.day;for(let o=1;o<=e;o++)this.last.day=o,this.is_day_in_byday(this.last)&&(i++,o<=a&&r++);this.last.day=a}t=0;let n;for(n=this.last.day+1;n<=e;n++)if(this.last.day=n,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++r)||this.check_set_position(r-i-1))){t=1;break}n>e&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data("BYSETPOS")||this.check_set_position(1))&&(t=1):t=0)}else if(this.has_by_data("BYMONTHDAY")){if(this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month(),this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length))return 0;let e=te.daysInMonth(this.last.month,this.last.year),r=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];r<0&&(r=e+r+1),r>e?(this.last.day=1,t=this.is_day_in_byday(this.last)):this.last.day=r}else{this.increment_month();let e=te.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>e?t=0:this.last.day=this.by_data.BYMONTHDAY[0]}return t}next_weekday_by_week(){let t=0;if(this.next_hour()==0)return t;if(!this.has_by_data("BYDAY"))return 1;for(;;){let e=new te;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,t=1);let r=this.by_data.BYDAY[this.by_indices.BYDAY],n=this.ruleDayOfWeek(r)[1];n-=this.rule.wkst,n<0&&(n+=7),e.year=this.last.year,e.month=this.last.month,e.day=this.last.day;let a=e.startDoyWeek(this.rule.wkst);if(n+a<1&&!t)continue;let o=te.fromDayOfYear(a+n,this.last.year);return this.last.year=o.year,this.last.month=o.month,this.last.day=o.day,t}}next_year(){return this.next_hour()==0||(this.days.length==0||++this.days_index==this.days.length)&&(this.days_index=0,this.increment_year(this.rule.interval),this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY)),this.expand_year_days(this.last.year),this.days.length==0)?0:this._nextByYearDay()}_nextByYearDay(){let t=this.days[this.days_index],e=this.last.year;if(Math.abs(t)==366&&!te.isLeapYear(this.last.year))return 0;t<1&&(t+=1,e+=1);let r=te.fromDayOfYear(t,e);return this.last.day=r.day,this.last.month=r.month,1}ruleDayOfWeek(t,e){let r=t.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(r){let i=parseInt(r[1]||0,10);return t=Ei.icalDayToNumericDay(r[2],e),[i,t]}else return[0,0]}next_generic(t,e,r,i,n){let a=t in this.by_data,o=this.rule.freq==e,l=0;if(n&&this[n]()==0)return l;if(a){this.by_indices[t]++;let c=this.by_data[t];this.by_indices[t]==c.length&&(this.by_indices[t]=0,l=1),this.last[r]=c[this.by_indices[t]]}else o&&this["increment_"+r](this.rule.interval);return a&&l&&o&&this["increment_"+i](1),l}increment_monthday(t){for(let e=0;e<t;e++){let r=te.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>r&&(this.last.day-=r,this.increment_month())}}increment_month(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{this.rule.freq=="MONTHLY"?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;let t=Rt(this.last.month/12);this.last.month%=12,this.last.month++,t!=0&&this.increment_year(t)}this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY))}increment_year(t){this.last.day=1,this.last.year+=t}increment_generic(t,e,r,i){this.last[e]+=t;let n=Rt(this.last[e]/r);this.last[e]%=r,n!=0&&this["increment_"+i](n)}has_by_data(t){return t in this.rule.parts}expand_year_days(t){let e=new te;this.days=[];let r={},i=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(let o of i)o in this.rule.parts&&(r[o]=this.rule.parts[o]);if("BYMONTH"in r&&"BYWEEKNO"in r){let o=1,l={};e.year=t,e.isDate=!0;for(let c=0;c<this.by_data.BYMONTH.length;c++){let d=this.by_data.BYMONTH[c];e.month=d,e.day=1;let u=e.weekNumber(this.rule.wkst);e.day=te.daysInMonth(d,t);let h=e.weekNumber(this.rule.wkst);for(c=u;c<h;c++)l[c]=1}for(let c=0;c<this.by_data.BYWEEKNO.length&&o;c++)this.by_data.BYWEEKNO[c]<52?o&=l[c]:o=0;o?delete r.BYMONTH:delete r.BYWEEKNO}let n=Object.keys(r).length;if(n==0){let o=this.dtstart.clone();o.year=this.last.year,this.days.push(o.dayOfYear())}else if(n==1&&"BYMONTH"in r)for(let o of this.by_data.BYMONTH){let l=this.dtstart.clone();l.year=t,l.month=o,l.isDate=!0,this.days.push(l.dayOfYear())}else if(n==1&&"BYMONTHDAY"in r)for(let o of this.by_data.BYMONTHDAY){let l=this.dtstart.clone();if(o<0){let c=te.daysInMonth(l.month,t);o=o+c+1}l.day=o,l.year=t,l.isDate=!0,this.days.push(l.dayOfYear())}else if(n==2&&"BYMONTHDAY"in r&&"BYMONTH"in r)for(let o of this.by_data.BYMONTH){let l=te.daysInMonth(o,t);for(let c of this.by_data.BYMONTHDAY)c<0&&(c=c+l+1),e.day=c,e.month=o,e.year=t,e.isDate=!0,this.days.push(e.dayOfYear())}else if(!(n==1&&"BYWEEKNO"in r)){if(!(n==2&&"BYWEEKNO"in r&&"BYMONTHDAY"in r)){if(n==1&&"BYDAY"in r)this.days=this.days.concat(this.expand_by_day(t));else if(n==2&&"BYDAY"in r&&"BYMONTH"in r){for(let o of this.by_data.BYMONTH){let l=te.daysInMonth(o,t);e.year=t,e.month=o,e.day=1,e.isDate=!0;let c=e.dayOfWeek(),d=e.dayOfYear()-1;e.day=l;let u=e.dayOfWeek();if(this.has_by_data("BYSETPOS")){let h=[];for(let p=1;p<=l;p++)e.day=p,this.is_day_in_byday(e)&&h.push(p);for(let p=0;p<h.length;p++)(this.check_set_position(p+1)||this.check_set_position(p-h.length))&&this.days.push(d+h[p])}else for(let h of this.by_data.BYDAY){let p=this.ruleDayOfWeek(h),f=p[0],m=p[1],g,y=(m+7-c)%7+1,w=l-(u+7-m)%7;if(f==0)for(let T=y;T<=l;T+=7)this.days.push(d+T);else f>0?(g=y+(f-1)*7,g<=l&&this.days.push(d+g)):(g=w+(f+1)*7,g>0&&this.days.push(d+g))}}this.days.sort(function(o,l){return o-l})}else if(n==2&&"BYDAY"in r&&"BYMONTHDAY"in r){let o=this.expand_by_day(t);for(let l of o){let c=te.fromDayOfYear(l,t);this.by_data.BYMONTHDAY.indexOf(c.day)>=0&&this.days.push(l)}}else if(n==3&&"BYDAY"in r&&"BYMONTHDAY"in r&&"BYMONTH"in r){let o=this.expand_by_day(t);for(let l of o){let c=te.fromDayOfYear(l,t);this.by_data.BYMONTH.indexOf(c.month)>=0&&this.by_data.BYMONTHDAY.indexOf(c.day)>=0&&this.days.push(l)}}else if(n==2&&"BYDAY"in r&&"BYWEEKNO"in r){let o=this.expand_by_day(t);for(let l of o){let d=te.fromDayOfYear(l,t).weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(d)&&this.days.push(l)}}else if(!(n==3&&"BYDAY"in r&&"BYWEEKNO"in r&&"BYMONTHDAY"in r))if(n==1&&"BYYEARDAY"in r)this.days=this.days.concat(this.by_data.BYYEARDAY);else if(n==2&&"BYYEARDAY"in r&&"BYDAY"in r){let o=te.isLeapYear(t)?366:365,l=new Set(this.expand_by_day(t));for(let c of this.by_data.BYYEARDAY)c<0&&(c+=o+1),l.has(c)&&this.days.push(c)}else this.days=[]}}let a=te.isLeapYear(t)?366:365;return this.days.sort((o,l)=>(o<0&&(o+=a+1),l<0&&(l+=a+1),o-l)),0}expand_by_day(t){let e=[],r=this.last.clone();r.year=t,r.month=1,r.day=1,r.isDate=!0;let i=r.dayOfWeek();r.month=12,r.day=31,r.isDate=!0;let n=r.dayOfWeek(),a=r.dayOfYear();for(let o of this.by_data.BYDAY){let l=this.ruleDayOfWeek(o),c=l[0],d=l[1];if(c==0){let u=(d+7-i)%7+1;for(let h=u;h<=a;h+=7)e.push(h)}else if(c>0){let u;d>=i?u=d-i+1:u=d-i+8,e.push(u+(c-1)*7)}else{let u;c=-c,d<=n?u=a-n+d:u=a-n+d-7,e.push(u-(c-1)*7)}}return e}is_day_in_byday(t){if(this.by_data.BYDAY)for(let e of this.by_data.BYDAY){let r=this.ruleDayOfWeek(e),i=r[0],n=r[1],a=t.dayOfWeek();if(i==0&&n==a||t.nthWeekDay(n,i)==t.day)return 1}return 0}check_set_position(t){return this.has_by_data("BYSETPOS")?this.by_data.BYSETPOS.indexOf(t)!==-1:!1}sort_byday_rules(t){for(let e=0;e<t.length;e++)for(let r=0;r<e;r++){let i=this.ruleDayOfWeek(t[r],this.rule.wkst)[1],n=this.ruleDayOfWeek(t[e],this.rule.wkst)[1];if(i>n){let a=t[e];t[e]=t[r],t[r]=a}}}check_contract_restriction(t,e){let r=Er._indexMap[t],i=Er._expandMap[this.rule.freq][r],n=!1;if(t in this.by_data&&i==Er.CONTRACT){let a=this.by_data[t];for(let o of a)if(o==e){n=!0;break}}else n=!0;return n}check_contracting_rules(){let t=this.last.dayOfWeek(),e=this.last.weekNumber(this.rule.wkst),r=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",Ei.numericDayToIcalDay(t))&&this.check_contract_restriction("BYWEEKNO",e)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",r)}setup_defaults(t,e,r){let i=Er._indexMap[t];return Er._expandMap[this.rule.freq][i]!=Er.CONTRACT&&(t in this.by_data||(this.by_data[t]=[r]),this.rule.freq!=e)?this.by_data[t][0]:r}toJSON(){let t=Object.create(null);return t.initialized=this.initialized,t.rule=this.rule.toJSON(),t.dtstart=this.dtstart.toJSON(),t.by_data=this.by_data,t.days=this.days,t.last=this.last.toJSON(),t.by_indices=this.by_indices,t.occurrence_number=this.occurrence_number,t}};P(Er,"_indexMap",{BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8}),P(Er,"_expandMap",{SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]}),P(Er,"UNKNOWN",0),P(Er,"CONTRACT",1),P(Er,"EXPAND",2),P(Er,"ILLEGAL",3);var ad=Er,Fo=class extends Error{constructor(){super("Recurrence rule has no valid occurrences")}},N1=/^(SU|MO|TU|WE|TH|FR|SA)$/,R1=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,WM={SU:te.SUNDAY,MO:te.MONDAY,TU:te.TUESDAY,WE:te.WEDNESDAY,TH:te.THURSDAY,FR:te.FRIDAY,SA:te.SATURDAY},O1=Object.fromEntries(Object.entries(WM).map(s=>s.reverse())),AM=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],Ei=class s{constructor(t){P(this,"parts",null);P(this,"interval",1);P(this,"wkst",te.MONDAY);P(this,"until",null);P(this,"count",null);P(this,"freq",null);P(this,"icalclass","icalrecur");P(this,"icaltype","recur");this.wrappedJSObject=this,this.parts={},t&&typeof t=="object"&&this.fromData(t)}static fromString(t){let e=this._stringToData(t,!1);return new s(e)}static fromData(t){return new s(t)}static _stringToData(t,e){let r=Object.create(null),i=t.split(";"),n=i.length;for(let a=0;a<n;a++){let o=i[a].split("="),l=o[0].toUpperCase(),c=o[0].toLowerCase(),d=e?c:l,u=o[1];if(l in Wy){let h=u.split(","),p=new Set;for(let f of h)p.add(Wy[l](f));h=[...p],r[d]=h.length==1?h[0]:h}else l in Vy?Vy[l](u,r,e):r[c]=u}return r}static icalDayToNumericDay(t,e){let r=e||te.SUNDAY;return(WM[t]-r+7)%7+1}static numericDayToIcalDay(t,e){let r=e||te.SUNDAY,i=t+r-te.SUNDAY;return i>7&&(i-=7),O1[i]}iterator(t){return new ad({rule:this,dtstart:t})}clone(){return new s(this.toJSON())}isFinite(){return!!(this.count||this.until)}isByCount(){return!!(this.count&&!this.until)}addComponent(t,e){let r=t.toUpperCase();r in this.parts?this.parts[r].push(e):this.parts[r]=[e]}setComponent(t,e){this.parts[t.toUpperCase()]=e.slice()}getComponent(t){let e=t.toUpperCase();return e in this.parts?this.parts[e].slice():[]}getNextOccurrence(t,e){let r=this.iterator(t),i;do i=r.next();while(i&&i.compare(e)<=0);return i&&e.zone&&(i.zone=e.zone),i}fromData(t){for(let e in t){let r=e.toUpperCase();r in Wy?Array.isArray(t[e])?this.parts[r]=t[e]:this.parts[r]=[t[e]]:this[e]=t[e]}this.interval&&typeof this.interval!="number"&&Vy.INTERVAL(this.interval,this),this.wkst&&typeof this.wkst!="number"&&(this.wkst=s.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof te)&&(this.until=te.fromString(this.until))}toJSON(){let t=Object.create(null);t.freq=this.freq,this.count&&(t.count=this.count),this.interval>1&&(t.interval=this.interval);for(let[e,r]of Object.entries(this.parts))Array.isArray(r)&&r.length==1?t[e.toLowerCase()]=r[0]:t[e.toLowerCase()]=ga(r);return this.until&&(t.until=this.until.toString()),"wkst"in this&&this.wkst!==te.DEFAULT_WEEK_START&&(t.wkst=s.numericDayToIcalDay(this.wkst)),t}toString(){let t="FREQ="+this.freq;this.count&&(t+=";COUNT="+this.count),this.interval>1&&(t+=";INTERVAL="+this.interval);for(let[e,r]of Object.entries(this.parts))t+=";"+e+"="+r;return this.until&&(t+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==te.DEFAULT_WEEK_START&&(t+=";WKST="+s.numericDayToIcalDay(this.wkst)),t}};function wn(s,t,e,r){let i=r;if(r[0]==="+"&&(i=r.slice(1)),i=tr(i),t!==void 0&&r<t)throw new Error(s+': invalid value "'+r+'" must be > '+t);if(e!==void 0&&r>e)throw new Error(s+': invalid value "'+r+'" must be < '+t);return i}var Vy={FREQ:function(s,t,e){if(AM.indexOf(s)!==-1)t.freq=s;else throw new Error('invalid frequency "'+s+'" expected: "'+AM.join(", ")+'"')},COUNT:function(s,t,e){t.count=tr(s)},INTERVAL:function(s,t,e){t.interval=tr(s),t.interval<1&&(t.interval=1)},UNTIL:function(s,t,e){s.length>10?t.until=je.icalendar.value["date-time"].fromICAL(s):t.until=je.icalendar.value.date.fromICAL(s),e||(t.until=te.fromString(t.until))},WKST:function(s,t,e){if(N1.test(s))t.wkst=Ei.icalDayToNumericDay(s);else throw new Error('invalid WKST value "'+s+'"')}},Wy={BYSECOND:wn.bind(void 0,"BYSECOND",0,60),BYMINUTE:wn.bind(void 0,"BYMINUTE",0,59),BYHOUR:wn.bind(void 0,"BYHOUR",0,23),BYDAY:function(s){if(R1.test(s))return s;throw new Error('invalid BYDAY value "'+s+'"')},BYMONTHDAY:wn.bind(void 0,"BYMONTHDAY",-31,31),BYYEARDAY:wn.bind(void 0,"BYYEARDAY",-366,366),BYWEEKNO:wn.bind(void 0,"BYWEEKNO",-53,53),BYMONTH:wn.bind(void 0,"BYMONTH",1,12),BYSETPOS:wn.bind(void 0,"BYSETPOS",-366,366)},F1=/\\\\|\\;|\\,|\\[Nn]/g,L1=/\\|;|,|\n/g,IM=/\\\\|\\,|\\[Nn]/g,PM=/\\|,|\n/g;function jy(s,t){return{matches:/.*/,fromICAL:function(r,i){return B1(r,s,i)},toICAL:function(r,i){let n=t;return i&&(n=new RegExp(n.source+"|"+i,n.flags)),r.replace(n,function(a){switch(a){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case`
`:return"\\n";default:return a}})}}}var Pe={defaultType:"text"},od={defaultType:"text",multiValue:","},cp={defaultType:"text",structuredValue:";"},ep={defaultType:"integer"},tp={defaultType:"date-time",allowedTypes:["date-time","date"]},rp={defaultType:"date-time"},Sr={defaultType:"uri"},NM={defaultType:"utc-offset"},RM={defaultType:"recur"},OM={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function H1(s){switch(s){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return`
`;default:return s}}function B1(s,t,e){return s.indexOf("\\")===-1?s:(e&&(t=new RegExp(t.source+"|\\\\"+e,t.flags)),s.replace(t,H1))}var qy={categories:od,url:Sr,version:Pe,uid:Pe},Gy={boolean:{values:["TRUE","FALSE"],fromICAL:function(s){switch(s){case"TRUE":return!0;case"FALSE":return!1;default:return!1}},toICAL:function(s){return s?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(s){let t=parseFloat(s);return nd(t)?0:t},toICAL:function(s){return String(s)}},integer:{fromICAL:function(s){let t=parseInt(s);return nd(t)?0:t},toICAL:function(s){return String(s)}},"utc-offset":{toICAL:function(s){return s.length<7?s.slice(0,3)+s.slice(4,6):s.slice(0,3)+s.slice(4,6)+s.slice(7,9)},fromICAL:function(s){return s.length<6?s.slice(0,3)+":"+s.slice(3,5):s.slice(0,3)+":"+s.slice(3,5)+":"+s.slice(5,7)},decorate:function(s){return Ms.fromString(s)},undecorate:function(s){return s.toString()}}},U1={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},yt=ya(Gy,{text:jy(F1,L1),uri:{},binary:{decorate:function(s){return ap.fromString(s)},undecorate:function(s){return s.toString()}},"cal-address":{},date:{decorate:function(s,t){return je.strict?te.fromDateString(s,t):te.fromString(s,t)},undecorate:function(s){return s.toString()},fromICAL:function(s){return!je.strict&&s.length>=15?yt["date-time"].fromICAL(s):s.slice(0,4)+"-"+s.slice(4,6)+"-"+s.slice(6,8)},toICAL:function(s){let t=s.length;return t==10?s.slice(0,4)+s.slice(5,7)+s.slice(8,10):t>=19?yt["date-time"].toICAL(s):s}},"date-time":{fromICAL:function(s){if(!je.strict&&s.length==8)return yt.date.fromICAL(s);{let t=s.slice(0,4)+"-"+s.slice(4,6)+"-"+s.slice(6,8)+"T"+s.slice(9,11)+":"+s.slice(11,13)+":"+s.slice(13,15);return s[15]&&s[15]==="Z"&&(t+="Z"),t}},toICAL:function(s){let t=s.length;if(t==10&&!je.strict)return yt.date.toICAL(s);if(t>=19){let e=s.slice(0,4)+s.slice(5,7)+s.slice(8,13)+s.slice(14,16)+s.slice(17,19);return s[19]&&s[19]==="Z"&&(e+="Z"),e}else return s},decorate:function(s,t){return je.strict?te.fromDateTimeString(s,t):te.fromString(s,t)},undecorate:function(s){return s.toString()}},duration:{decorate:function(s){return Br.fromString(s)},undecorate:function(s){return s.toString()}},period:{fromICAL:function(s){let t=s.split("/");return t[0]=yt["date-time"].fromICAL(t[0]),Br.isValueString(t[1])||(t[1]=yt["date-time"].fromICAL(t[1])),t},toICAL:function(s){return s=s.slice(),!je.strict&&s[0].length==10?s[0]=yt.date.toICAL(s[0]):s[0]=yt["date-time"].toICAL(s[0]),Br.isValueString(s[1])||(!je.strict&&s[1].length==10?s[1]=yt.date.toICAL(s[1]):s[1]=yt["date-time"].toICAL(s[1])),s.join("/")},decorate:function(s,t){return sd.fromJSON(s,t,!je.strict)},undecorate:function(s){return s.toJSON()}},recur:{fromICAL:function(s){return Ei._stringToData(s,!0)},toICAL:function(s){let t="";for(let[e,r]of Object.entries(s))e=="until"?r.length>10?r=yt["date-time"].toICAL(r):r=yt.date.toICAL(r):e=="wkst"?typeof r=="number"&&(r=Ei.numericDayToIcalDay(r)):Array.isArray(r)&&(r=r.join(",")),t+=e.toUpperCase()+"="+r+";";return t.slice(0,Math.max(0,t.length-1))},decorate:function(t){return Ei.fromData(t)},undecorate:function(s){return s.toJSON()}},time:{fromICAL:function(s){if(s.length<6)return s;let t=s.slice(0,2)+":"+s.slice(2,4)+":"+s.slice(4,6);return s[6]==="Z"&&(t+="Z"),t},toICAL:function(s){if(s.length<8)return s;let t=s.slice(0,2)+s.slice(3,5)+s.slice(6,8);return s[8]==="Z"&&(t+="Z"),t}}}),$1=ya(qy,{action:Pe,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:Pe,class:Pe,comment:Pe,completed:rp,contact:Pe,created:rp,description:Pe,dtend:tp,dtstamp:rp,dtstart:tp,due:tp,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:RM,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":rp,location:Pe,method:Pe,organizer:{defaultType:"cal-address"},"percent-complete":ep,priority:ep,prodid:Pe,"related-to":Pe,repeat:ep,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(s){return s.indexOf("/")!==-1?"period":s.indexOf("T")===-1?"date":"date-time"}},"recurrence-id":tp,resources:od,"request-status":cp,rrule:RM,sequence:ep,status:Pe,summary:Pe,transp:Pe,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:NM,tzoffsetto:NM,tzurl:Sr,tzid:Pe,tzname:Pe}),Hr=ya(Gy,{text:jy(IM,PM),uri:jy(IM,PM),date:{decorate:function(s){return pa.fromDateAndOrTimeString(s,"date")},undecorate:function(s){return s.toString()},fromICAL:function(s){return s.length==8?yt.date.fromICAL(s):s[0]=="-"&&s.length==6?s.slice(0,4)+"-"+s.slice(4):s},toICAL:function(s){return s.length==10?yt.date.toICAL(s):s[0]=="-"&&s.length==7?s.slice(0,4)+s.slice(5):s}},time:{decorate:function(s){return pa.fromDateAndOrTimeString("T"+s,"time")},undecorate:function(s){return s.toString()},fromICAL:function(s){let t=Hr.time._splitZone(s,!0),e=t[0],r=t[1];return r.length==6?r=r.slice(0,2)+":"+r.slice(2,4)+":"+r.slice(4,6):r.length==4&&r[0]!="-"?r=r.slice(0,2)+":"+r.slice(2,4):r.length==5&&(r=r.slice(0,3)+":"+r.slice(3,5)),e.length==5&&(e[0]=="-"||e[0]=="+")&&(e=e.slice(0,3)+":"+e.slice(3)),r+e},toICAL:function(s){let t=Hr.time._splitZone(s),e=t[0],r=t[1];return r.length==8?r=r.slice(0,2)+r.slice(3,5)+r.slice(6,8):r.length==5&&r[0]!="-"?r=r.slice(0,2)+r.slice(3,5):r.length==6&&(r=r.slice(0,3)+r.slice(4,6)),e.length==6&&(e[0]=="-"||e[0]=="+")&&(e=e.slice(0,3)+e.slice(4)),r+e},_splitZone:function(s,t){let e=s.length-1,r=s.length-(t?5:6),i=s[r],n,a;return s[e]=="Z"?(n=s[e],a=s.slice(0,Math.max(0,e))):s.length>6&&(i=="-"||i=="+")?(n=s.slice(r),a=s.slice(0,Math.max(0,r))):(n="",a=s),[n,a]}},"date-time":{decorate:function(s){return pa.fromDateAndOrTimeString(s,"date-time")},undecorate:function(s){return s.toString()},fromICAL:function(s){return Hr["date-and-or-time"].fromICAL(s)},toICAL:function(s){return Hr["date-and-or-time"].toICAL(s)}},"date-and-or-time":{decorate:function(s){return pa.fromDateAndOrTimeString(s,"date-and-or-time")},undecorate:function(s){return s.toString()},fromICAL:function(s){let t=s.split("T");return(t[0]?Hr.date.fromICAL(t[0]):"")+(t[1]?"T"+Hr.time.fromICAL(t[1]):"")},toICAL:function(s){let t=s.split("T");return Hr.date.toICAL(t[0])+(t[1]?"T"+Hr.time.toICAL(t[1]):"")}},timestamp:yt["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/},"phone-number":{fromICAL:function(s){return Array.from(s).filter(function(t){return t==="\\"?void 0:t}).join("")},toICAL:function(s){return Array.from(s).map(function(t){return t===","||t===";"?"\\"+t:t}).join("")}}}),V1={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},W1=ya(qy,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:OM,bday:OM,caladruri:Sr,caluri:Sr,clientpidmap:cp,email:Pe,fburl:Sr,fn:Pe,gender:cp,geo:Sr,impp:Sr,key:Sr,kind:Pe,lang:{defaultType:"language-tag"},logo:Sr,member:Sr,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:od,note:Pe,org:{defaultType:"text",structuredValue:";"},photo:Sr,related:Sr,rev:{defaultType:"timestamp"},role:Pe,sound:Sr,source:Sr,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:Pe,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:Pe}),Y1=ya(Gy,{binary:yt.binary,date:Hr.date,"date-time":Hr["date-time"],"phone-number":Hr["phone-number"],uri:yt.uri,text:Hr.text,time:yt.time,vcard:yt.text,"utc-offset":{toICAL:function(s){return s.slice(0,7)},fromICAL:function(s){return s.slice(0,7)},decorate:function(s){return Ms.fromString(s)},undecorate:function(s){return s.toString()}}}),j1={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},z1=ya(qy,{fn:Pe,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:od,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(s){return s.indexOf("T")===-1?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:Pe,tel:{defaultType:"phone-number"},email:Pe,mailer:Pe,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:Pe,role:Pe,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:cp,note:od,prodid:Pe,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(s){return s.indexOf("T")===-1?"date":"date-time"}},"sort-string":Pe,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:Pe,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),Cs={name:"ical",value:yt,param:U1,property:$1,propertyGroups:!1},FM={name:"vcard4",value:Hr,param:V1,property:W1,propertyGroups:!0},LM={name:"vcard3",value:Y1,param:j1,property:z1,propertyGroups:!0},je={strict:!0,defaultSet:Cs,defaultType:"unknown",components:{vcard:FM,vcard3:LM,vevent:Cs,vtodo:Cs,vjournal:Cs,valarm:Cs,vtimezone:Cs,daylight:Cs,standard:Cs},icalendar:Cs,vcard:FM,vcard3:LM,getDesignSet:function(s){return s&&s in je.components?je.components[s]:je.defaultSet}},np=`\r
`,HM="unknown",q1={'"':"^'","\n":"^n","^":"^^"};function st(s){typeof s[0]=="string"&&(s=[s]);let t=0,e=s.length,r="";for(;t<e;t++)r+=st.component(s[t])+np;return r}st.component=function(s,t){let e=s[0].toUpperCase(),r="BEGIN:"+e+np,i=s[1],n=0,a=i.length,o=s[0];for(o==="vcard"&&s[1].length>0&&!(s[1][0][0]==="version"&&s[1][0][3]==="4.0")&&(o="vcard3"),t=t||je.getDesignSet(o);n<a;n++)r+=st.property(i[n],t)+np;let l=s[2]||[],c=0,d=l.length;for(;c<d;c++)r+=st.component(l[c],t)+np;return r+="END:"+e,r};st.property=function(s,t,e){let r=s[0].toUpperCase(),i=s[0],n=s[1];t||(t=je.defaultSet);let a=n.group,o;t.propertyGroups&&a?o=a.toUpperCase()+"."+r:o=r;for(let[p,f]of Object.entries(n)){if(t.propertyGroups&&p=="group")continue;let m=t.param[p],g=m&&m.multiValue;g&&Array.isArray(f)?(f=f.map(function(y){return y=st._rfc6868Unescape(y),y=st.paramPropertyValue(y,m.multiValueSeparateDQuote),y}),f=st.multiValue(f,g,"unknown",null,t)):(f=st._rfc6868Unescape(f),f=st.paramPropertyValue(f)),o+=";"+p.toUpperCase()+"="+f}if(s.length===3)return o+":";let l=s[2],c,d=!1,u=!1,h=!1;return i in t.property?(c=t.property[i],"multiValue"in c&&(d=c.multiValue),"structuredValue"in c&&Array.isArray(s[3])&&(u=c.structuredValue),"defaultType"in c?l===c.defaultType&&(h=!0):l===HM&&(h=!0)):l===HM&&(h=!0),h||(o+=";VALUE="+l.toUpperCase()),o+=":",d&&u?o+=st.multiValue(s[3],u,l,d,t,u):d?o+=st.multiValue(s.slice(3),d,l,null,t,!1):u?o+=st.multiValue(s[3],u,l,null,t,u):o+=st.value(s[3],l,t,!1),e?o:VM(o)};st.paramPropertyValue=function(s,t){return!t&&s.indexOf(",")===-1&&s.indexOf(":")===-1&&s.indexOf(";")===-1?s:'"'+s+'"'};st.multiValue=function(s,t,e,r,i,n){let a="",o=s.length,l=0;for(;l<o;l++)r&&Array.isArray(s[l])?a+=st.multiValue(s[l],r,e,null,i,n):a+=st.value(s[l],e,i,n),l!==o-1&&(a+=t);return a};st.value=function(s,t,e,r){return t in e.value&&"toICAL"in e.value[t]?e.value[t].toICAL(s,r):s};st._rfc6868Unescape=function(s){return s.replace(/[\n^"]/g,function(t){return q1[t]})};var BM=0,ip=1,sp=2,Tn=3,ma=class s{static fromString(t,e){return new s(He.property(t,e))}constructor(t,e){this._parent=e||null,typeof t=="string"?(this.jCal=[t,{},je.defaultType],this.jCal[sp]=this.getDefaultType()):this.jCal=t,this._updateType()}get type(){return this.jCal[sp]}get name(){return this.jCal[BM]}get parent(){return this._parent}set parent(t){let e=!this._parent||t&&t._designSet!=this._parent._designSet;this._parent=t,this.type==je.defaultType&&e&&(this.jCal[sp]=this.getDefaultType(),this._updateType())}get _designSet(){return this.parent?this.parent._designSet:je.defaultSet}_updateType(){let t=this._designSet;this.type in t.value&&("decorate"in t.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in t.property&&(this.isMultiValue="multiValue"in t.property[this.name],this.isStructuredValue="structuredValue"in t.property[this.name]))}_hydrateValue(t){return this._values&&this._values[t]?this._values[t]:this.jCal.length<=Tn+t?null:this.isDecorated?(this._values||(this._values=[]),this._values[t]=this._decorate(this.jCal[Tn+t])):this.jCal[Tn+t]}_decorate(t){return this._designSet.value[this.type].decorate(t,this)}_undecorate(t){return this._designSet.value[this.type].undecorate(t,this)}_setDecoratedValue(t,e){this._values||(this._values=[]),typeof t=="object"&&"icaltype"in t?(this.jCal[Tn+e]=this._undecorate(t),this._values[e]=t):(this.jCal[Tn+e]=t,this._values[e]=this._decorate(t))}getParameter(t){if(t in this.jCal[ip])return this.jCal[ip][t]}getFirstParameter(t){let e=this.getParameter(t);return Array.isArray(e)?e[0]:e}setParameter(t,e){let r=t.toLowerCase();typeof e=="string"&&r in this._designSet.param&&"multiValue"in this._designSet.param[r]&&(e=[e]),this.jCal[ip][t]=e}removeParameter(t){delete this.jCal[ip][t]}getDefaultType(){let t=this.jCal[BM],e=this._designSet;if(t in e.property){let r=e.property[t];if("defaultType"in r)return r.defaultType}return je.defaultType}resetType(t){this.removeAllValues(),this.jCal[sp]=t,this._updateType()}getFirstValue(){return this._hydrateValue(0)}getValues(){let t=this.jCal.length-Tn;if(t<1)return[];let e=0,r=[];for(;e<t;e++)r[e]=this._hydrateValue(e);return r}removeAllValues(){this._values&&(this._values.length=0),this.jCal.length=3}setValues(t){if(!this.isMultiValue)throw new Error(this.name+`: does not not support mulitValue.
override isMultiValue`);let e=t.length,r=0;if(this.removeAllValues(),e>0&&typeof t[0]=="object"&&"icaltype"in t[0]&&this.resetType(t[0].icaltype),this.isDecorated)for(;r<e;r++)this._setDecoratedValue(t[r],r);else for(;r<e;r++)this.jCal[Tn+r]=t[r]}setValue(t){this.removeAllValues(),typeof t=="object"&&"icaltype"in t&&this.resetType(t.icaltype),this.isDecorated?this._setDecoratedValue(t,0):this.jCal[Tn]=t}toJSON(){return this.jCal}toICALString(){return st.property(this.jCal,this._designSet,!0)}},bn=0,Gi=1,kn=2,G1=0,Q1=3,ai=class s{constructor(t,e){P(this,"_hydratedPropertyCount",0);P(this,"_hydratedComponentCount",0);P(this,"_timezoneCache",null);P(this,"_components",null);P(this,"_properties",null);typeof t=="string"&&(t=[t,[],[]]),this.jCal=t,this.parent=e||null,!this.parent&&this.name==="vcalendar"&&(this._timezoneCache=new Map)}static fromString(t){return new s(He.component(t))}get name(){return this.jCal[bn]}get _designSet(){var e;let t=this.parent&&this.parent._designSet;if(!t&&this.name=="vcard"){let r=(e=this.jCal[Gi])==null?void 0:e[0];if(r&&r[G1]=="version"&&r[Q1]=="3.0")return je.getDesignSet("vcard3")}return t||je.getDesignSet(this.name)}_hydrateComponent(t){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[t])return this._components[t];let e=new s(this.jCal[kn][t],this);return this._hydratedComponentCount++,this._components[t]=e}_hydrateProperty(t){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[t])return this._properties[t];let e=new ma(this.jCal[Gi][t],this);return this._hydratedPropertyCount++,this._properties[t]=e}getFirstSubcomponent(t){if(t){let e=0,r=this.jCal[kn],i=r.length;for(;e<i;e++)if(r[e][bn]===t)return this._hydrateComponent(e)}else if(this.jCal[kn].length)return this._hydrateComponent(0);return null}getAllSubcomponents(t){let e=this.jCal[kn].length,r=0;if(t){let i=this.jCal[kn],n=[];for(;r<e;r++)t===i[r][bn]&&n.push(this._hydrateComponent(r));return n}else{if(!this._components||this._hydratedComponentCount!==e)for(;r<e;r++)this._hydrateComponent(r);return this._components||[]}}hasProperty(t){let e=this.jCal[Gi],r=e.length,i=0;for(;i<r;i++)if(e[i][bn]===t)return!0;return!1}getFirstProperty(t){if(t){let e=0,r=this.jCal[Gi],i=r.length;for(;e<i;e++)if(r[e][bn]===t)return this._hydrateProperty(e)}else if(this.jCal[Gi].length)return this._hydrateProperty(0);return null}getFirstPropertyValue(t){let e=this.getFirstProperty(t);return e?e.getFirstValue():null}getAllProperties(t){let e=this.jCal[Gi].length,r=0;if(t){let i=this.jCal[Gi],n=[];for(;r<e;r++)t===i[r][bn]&&n.push(this._hydrateProperty(r));return n}else{if(!this._properties||this._hydratedPropertyCount!==e)for(;r<e;r++)this._hydrateProperty(r);return this._properties||[]}}_removeObjectByIndex(t,e,r){if(e=e||[],e[r]){let i=e[r];"parent"in i&&(i.parent=null)}e.splice(r,1),this.jCal[t].splice(r,1)}_removeObject(t,e,r){let i=0,n=this.jCal[t],a=n.length,o=this[e];if(typeof r=="string"){for(;i<a;i++)if(n[i][bn]===r)return this._removeObjectByIndex(t,o,i),!0}else if(o){for(;i<a;i++)if(o[i]&&o[i]===r)return this._removeObjectByIndex(t,o,i),!0}return!1}_removeAllObjects(t,e,r){let i=this[e],n=this.jCal[t],a=n.length-1;for(;a>=0;a--)(!r||n[a][bn]===r)&&this._removeObjectByIndex(t,i,a)}addSubcomponent(t){this._components||(this._components=[],this._hydratedComponentCount=0),t.parent&&t.parent.removeSubcomponent(t);let e=this.jCal[kn].push(t.jCal);return this._components[e-1]=t,this._hydratedComponentCount++,t.parent=this,t}removeSubcomponent(t){let e=this._removeObject(kn,"_components",t);return e&&this._hydratedComponentCount--,e}removeAllSubcomponents(t){let e=this._removeAllObjects(kn,"_components",t);return this._hydratedComponentCount=0,e}addProperty(t){if(!(t instanceof ma))throw new TypeError("must be instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),t.parent&&t.parent.removeProperty(t);let e=this.jCal[Gi].push(t.jCal);return this._properties[e-1]=t,this._hydratedPropertyCount++,t.parent=this,t}addPropertyWithValue(t,e){let r=new ma(t);return r.setValue(e),this.addProperty(r),r}updatePropertyWithValue(t,e){let r=this.getFirstProperty(t);return r?r.setValue(e):r=this.addPropertyWithValue(t,e),r}removeProperty(t){let e=this._removeObject(Gi,"_properties",t);return e&&this._hydratedPropertyCount--,e}removeAllProperties(t){let e=this._removeAllObjects(Gi,"_properties",t);return this._hydratedPropertyCount=0,e}toJSON(){return this.jCal}toString(){return st.component(this.jCal,this._designSet)}getTimeZoneByID(t){if(this.parent)return this.parent.getTimeZoneByID(t);if(!this._timezoneCache)return null;if(this._timezoneCache.has(t))return this._timezoneCache.get(t);let e=this.getAllSubcomponents("vtimezone");for(let r of e)if(r.getFirstProperty("tzid").getFirstValue()===t){let i=new Ye({component:r,tzid:t});return this._timezoneCache.set(t,i),i}return null}},dp=class{constructor(t){P(this,"complete",!1);P(this,"ruleIterators",null);P(this,"ruleDates",null);P(this,"exDates",null);P(this,"ruleDateInc",0);P(this,"exDateInc",0);P(this,"exDate",null);P(this,"ruleDate",null);P(this,"dtstart",null);P(this,"last",null);this.ruleDates=[],this.exDates=[],this.fromData(t)}fromData(t){let e=xs(t.dtstart,te);if(e)this.dtstart=e;else throw new Error(".dtstart (ICAL.Time) must be given");if(t.component)this._init(t.component);else{if(this.last=xs(t.last,te)||e.clone(),!t.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=t.ruleIterators.map(function(r){return xs(r,ad)}),this.ruleDateInc=t.ruleDateInc,this.exDateInc=t.exDateInc,t.ruleDates&&(this.ruleDates=t.ruleDates.map(r=>xs(r,te)),this.ruleDate=this.ruleDates[this.ruleDateInc]),t.exDates&&(this.exDates=t.exDates.map(r=>xs(r,te)),this.exDate=this.exDates[this.exDateInc]),typeof t.complete!="undefined"&&(this.complete=t.complete)}}_compare_special(t,e){return!t.isDate&&e.isDate?new te({year:t.year,month:t.month,day:t.day}).compare(e):t.compare(e)}next(){let t,e,r,i=500,n=0;for(;;){if(n++>i)throw new Error("max tries have occurred, rule may be impossible to fulfill.");if(e=this.ruleDate,t=this._nextRecurrenceIter(this.last),!e&&!t){this.complete=!0;break}if((!e||t&&e.compare(t.last)>0)&&(e=t.last.clone(),t.next()),this.ruleDate===e&&this._nextRuleDay(),this.last=e,this.exDate&&(r=this._compare_special(this.last,this.exDate),r>0&&this._nextExDay(),r===0)){this._nextExDay();continue}return this.last}}toJSON(){function t(r){return r.toJSON()}let e=Object.create(null);return e.ruleIterators=this.ruleIterators.map(t),this.ruleDates&&(e.ruleDates=this.ruleDates.map(t)),this.exDates&&(e.exDates=this.exDates.map(t)),e.ruleDateInc=this.ruleDateInc,e.exDateInc=this.exDateInc,e.last=this.last.toJSON(),e.dtstart=this.dtstart.toJSON(),e.complete=this.complete,e}_extractDates(t,e){let r=[],i=t.getAllProperties(e);for(let n=0,a=i.length;n<a;n++)for(let o of i[n].getValues()){let l=fa(r,o,(c,d)=>c.compare(d));r.splice(l,0,o)}return r}_init(t){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!t.hasProperty("rdate")&&!t.hasProperty("rrule")&&!t.hasProperty("recurrence-id")){this.ruleDate=this.last.clone(),this.complete=!0;return}if(t.hasProperty("rdate")&&(this.ruleDates=this._extractDates(t,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=fa(this.ruleDates,this.last,(e,r)=>e.compare(r)),this.ruleDate=this.ruleDates[this.ruleDateInc]),t.hasProperty("rrule")){let e=t.getAllProperties("rrule"),r=0,i=e.length,n,a;for(;r<i;r++)n=e[r].getFirstValue(),a=n.iterator(this.dtstart),this.ruleIterators.push(a),a.next()}t.hasProperty("exdate")&&(this.exDates=this._extractDates(t,"exdate"),this.exDateInc=fa(this.exDates,this.last,this._compare_special),this.exDate=this.exDates[this.exDateInc])}_nextExDay(){this.exDate=this.exDates[++this.exDateInc]}_nextRuleDay(){this.ruleDate=this.ruleDates[++this.ruleDateInc]}_nextRecurrenceIter(){let t=this.ruleIterators;if(t.length===0)return null;let e=t.length,r,i,n=0,a;for(;n<e;n++){if(r=t[n],i=r.last,r.completed){e--,n!==0&&n--,t.splice(n,1);continue}(!a||a.last.compare(i)>0)&&(a=r)}return a}},id=class id{constructor(t,e){P(this,"exceptions",null);P(this,"strictExceptions",!1);t instanceof ai||(e=t,t=null),t?this.component=t:this.component=new ai("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],e&&e.strictExceptions&&(this.strictExceptions=e.strictExceptions),e&&e.exceptions?e.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach(function(r){r.hasProperty("recurrence-id")&&this.relateException(r)},this)}relateException(t){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(t instanceof ai&&(t=new id(t)),this.strictExceptions&&t.uid!==this.uid)throw new Error("attempted to relate unrelated exception");let e=t.recurrenceId.toString();if(this.exceptions[e]=t,t.modifiesFuture()){let r=[t.recurrenceId.toUnixTime(),e],i=fa(this.rangeExceptions,r,UM);this.rangeExceptions.splice(i,0,r)}}modifiesFuture(){return this.component.hasProperty("recurrence-id")?this.component.getFirstProperty("recurrence-id").getParameter("range")===id.THISANDFUTURE:!1}findRangeException(t){if(!this.rangeExceptions.length)return null;let e=t.toUnixTime(),r=fa(this.rangeExceptions,[e],UM);if(r-=1,r<0)return null;let i=this.rangeExceptions[r];return e<i[0]?null:i[1]}getOccurrenceDetails(t){let e=t.toString(),r=t.convertToZone(Ye.utcTimezone).toString(),i,n={recurrenceId:t};if(e in this.exceptions)i=n.item=this.exceptions[e],n.startDate=i.startDate,n.endDate=i.endDate,n.item=i;else if(r in this.exceptions)i=this.exceptions[r],n.startDate=i.startDate,n.endDate=i.endDate,n.item=i;else{let a=this.findRangeException(t),o;if(a){let l=this.exceptions[a];n.item=l;let c=this._rangeExceptionCache[a];if(!c){let u=l.recurrenceId.clone(),h=l.startDate.clone();u.zone=h.zone,c=h.subtractDate(u),this._rangeExceptionCache[a]=c}let d=t.clone();d.zone=l.startDate.zone,d.addDuration(c),o=d.clone(),o.addDuration(l.duration),n.startDate=d,n.endDate=o}else o=t.clone(),o.addDuration(this.duration),n.endDate=o,n.startDate=t,n.item=this}return n}iterator(t){return new dp({component:this.component,dtstart:t||this.startDate})}isRecurring(){let t=this.component;return t.hasProperty("rrule")||t.hasProperty("rdate")}isRecurrenceException(){return this.component.hasProperty("recurrence-id")}getRecurrenceTypes(){let t=this.component.getAllProperties("rrule"),e=0,r=t.length,i=Object.create(null);for(;e<r;e++){let n=t[e].getFirstValue();i[n.freq]=!0}return i}get uid(){return this._firstProp("uid")}set uid(t){this._setProp("uid",t)}get startDate(){return this._firstProp("dtstart")}set startDate(t){this._setTime("dtstart",t)}get endDate(){let t=this._firstProp("dtend");if(!t){let e=this._firstProp("duration");t=this.startDate.clone(),e?t.addDuration(e):t.isDate&&(t.day+=1)}return t}set endDate(t){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",t)}get duration(){let t=this._firstProp("duration");return t||this.endDate.subtractDateTz(this.startDate)}set duration(t){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",t)}get location(){return this._firstProp("location")}set location(t){this._setProp("location",t)}get attendees(){return this.component.getAllProperties("attendee")}get summary(){return this._firstProp("summary")}set summary(t){this._setProp("summary",t)}get description(){return this._firstProp("description")}set description(t){this._setProp("description",t)}get color(){return this._firstProp("color")}set color(t){this._setProp("color",t)}get organizer(){return this._firstProp("organizer")}set organizer(t){this._setProp("organizer",t)}get sequence(){return this._firstProp("sequence")}set sequence(t){this._setProp("sequence",t)}get recurrenceId(){return this._firstProp("recurrence-id")}set recurrenceId(t){this._setTime("recurrence-id",t)}_setTime(t,e){let r=this.component.getFirstProperty(t);r||(r=new ma(t),this.component.addProperty(r)),e.zone===Ye.localTimezone||e.zone===Ye.utcTimezone?r.removeParameter("tzid"):r.setParameter("tzid",e.zone.tzid),r.setValue(e)}_setProp(t,e){this.component.updatePropertyWithValue(t,e)}_firstProp(t){return this.component.getFirstPropertyValue(t)}toString(){return this.component.toString()}};P(id,"THISANDFUTURE","THISANDFUTURE");var up=id;function UM(s,t){return s[0]>t[0]?1:t[0]>s[0]?-1:0}var zy=class{constructor(t){P(this,"parseEvent",!0);P(this,"parseTimezone",!0);P(this,"oncomplete",function(){});P(this,"onerror",function(t){});P(this,"ontimezone",function(t){});P(this,"onevent",function(t){});typeof t=="undefined"&&(t={});for(let[e,r]of Object.entries(t))this[e]=r}process(t){typeof t=="string"&&(t=He(t)),t instanceof ai||(t=new ai(t));let e=t.getAllSubcomponents(),r=0,i=e.length,n;for(;r<i;r++)switch(n=e[r],n.name){case"vtimezone":if(this.parseTimezone){let a=n.getFirstPropertyValue("tzid");a&&this.ontimezone(new Ye({tzid:a,component:n}))}break;case"vevent":this.parseEvent&&this.onevent(new up(n));break;default:continue}this.oncomplete()}},Qi={foldLength:75,debug:!1,newLineChar:`\r
`,Binary:ap,Component:ai,ComponentParser:zy,Duration:Br,Event:up,Period:sd,Property:ma,Recur:Ei,RecurExpansion:dp,RecurIterator:ad,Time:te,Timezone:Ye,TimezoneService:lp,UtcOffset:Ms,VCardTime:pa,parse:He,stringify:st,design:je,helpers:P1};var hp=class extends Yi{constructor(e){super();this.subscriptions=[];this.cache=new Map;this.refreshTimers=new Map;this.fileWatchers=new Map;this.plugin=e}async initialize(){await this.loadSubscriptions(),this.subscriptions.forEach(e=>{e.enabled&&(e.type==="remote"?this.startRefreshTimer(e):e.type==="local"&&this.startFileWatcher(e))}),this.emit("data-changed")}async loadSubscriptions(){try{let e=await this.plugin.loadData();this.subscriptions=(e==null?void 0:e.icsSubscriptions)||[]}catch(e){console.error("Failed to load ICS subscriptions:",e),this.subscriptions=[]}}async saveSubscriptions(){try{let e=await this.plugin.loadData()||{};e.icsSubscriptions=this.subscriptions,await this.plugin.saveData(e)}catch(e){throw console.error("Failed to save ICS subscriptions:",e),e}}getSubscriptions(){return[...this.subscriptions]}async addSubscription(e){let r={...e,id:this.generateId()};return this.subscriptions.push(r),await this.saveSubscriptions(),r.enabled&&(r.type==="remote"?(this.startRefreshTimer(r),await this.fetchSubscription(r.id)):r.type==="local"&&(this.startFileWatcher(r),await this.fetchSubscription(r.id))),this.emit("data-changed"),r}async updateSubscription(e,r){let i=this.subscriptions.findIndex(o=>o.id===e);if(i===-1)throw new Error("Subscription not found");let n=this.subscriptions[i],a={...n,...r};this.subscriptions[i]=a,await this.saveSubscriptions(),this.stopRefreshTimer(e),this.stopFileWatcher(e),a.enabled&&(a.type==="remote"?this.startRefreshTimer(a):a.type==="local"&&this.startFileWatcher(a)),(r.url&&r.url!==n.url||r.filePath&&r.filePath!==n.filePath)&&this.cache.delete(e),this.emit("data-changed")}async removeSubscription(e){let r=this.subscriptions.findIndex(i=>i.id===e);if(r===-1)throw new Error("Subscription not found");this.subscriptions.splice(r,1),await this.saveSubscriptions(),this.stopRefreshTimer(e),this.stopFileWatcher(e),this.cache.delete(e),this.emit("data-changed")}async fetchSubscription(e){let r=this.subscriptions.find(i=>i.id===e);if(!(!r||!r.enabled))try{let i;if(r.type==="remote"){if(!r.url)throw new Error("Remote subscription missing URL");i=(await(0,As.requestUrl)({url:r.url,method:"GET",headers:{Accept:"text/calendar,*/*;q=0.1","Accept-Language":"en-US,en;q=0.9","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}})).text}else if(r.type==="local"){if(!r.filePath)throw new Error("Local subscription missing file path");i=await this.readLocalICSFile(r.filePath)}else throw new Error("Unknown subscription type");let n=this.parseICS(i,r.id),a={subscriptionId:e,events:n,lastUpdated:new Date().toISOString(),expires:new Date(Date.now()+r.refreshInterval*60*1e3).toISOString()};this.cache.set(e,a),await this.updateSubscription(e,{lastFetched:new Date().toISOString(),lastError:void 0}),this.emit("data-changed")}catch(i){let n=i instanceof Error?i.message:String(i);await this.updateSubscription(e,{lastError:n}),r.type==="remote"?n.includes("404")?new As.Notice(`Calendar "${r.name}" not found (404). Please check the ICS URL is correct and the calendar is publicly accessible.`):n.includes("500")||n.includes("OwaBasicUnsupportedException")?new As.Notice(`Calendar "${r.name}" access denied (500). This may be due to Microsoft Outlook server restrictions. Try regenerating the ICS URL from your calendar settings.`):new As.Notice(`Failed to fetch remote calendar "${r.name}": ${n}`):new As.Notice(`Failed to read local calendar "${r.name}": ${n}`)}}parseICS(e,r){try{let i=Qi.parse(e),n=new Qi.Component(i);n.getAllSubcomponents("vtimezone").forEach(d=>{Qi.TimezoneService.register(d)});let o=n.getAllSubcomponents("vevent"),l=[],c=new Map;return o.forEach(d=>{let u=new Qi.Event(d),h=u.uid;if(!h)return;let p=d.getFirstPropertyValue("recurrence-id");if(p){c.has(h)||c.set(h,new Map);let f=p.toString();c.get(h).set(f,u)}}),o.forEach(d=>{try{let u=new Qi.Event(d);if(d.getFirstPropertyValue("recurrence-id"))return;let p=u.summary||"Untitled Event",f=u.description||void 0,m=u.location||void 0,g=u.startDate,y=u.endDate;if(!g)return;let w=g.isDate,T=g.toJSDate().toISOString(),S=y?y.toJSDate().toISOString():void 0,x=u.uid||`${r}-${l.length}`,I=`${r}-${x}`,F={id:I,subscriptionId:r,title:p,description:f,start:T,end:S,allDay:w,location:m,url:u.url||void 0};if(u.isRecurring()){let A=new Set;d.getAllProperties("exdate").forEach(U=>{let R=U.getFirstValue();R&&(Array.isArray(R)?R:[R]).forEach(j=>{j&&typeof j.toString=="function"&&A.add(j.toString())})});let G=c.get(x)||new Map,V=u.iterator(g),k=new Qi.Time;k.fromJSDate(new Date(Date.now()+365*24*60*60*1e3));let D,_=0,$=100;for(;(D=V.next())&&_<$&&!(D.compare(k)>0);){let U=D.toString();if(A.has(U)){_++;continue}let R=G.get(U);if(R){let H=R.startDate,j=R.endDate;H&&l.push({id:`${I}-${_}`,subscriptionId:r,title:R.summary||p,description:R.description||f,start:H.toJSDate().toISOString(),end:j?j.toJSDate().toISOString():void 0,allDay:H.isDate,location:R.location||m,url:R.url||F.url})}else{let H=D.toJSDate().toISOString(),j=S;if(y&&g){let re=y.toJSDate().getTime()-g.toJSDate().getTime();j=new Date(D.toJSDate().getTime()+re).toISOString()}l.push({...F,id:`${I}-${_}`,start:H,end:j})}_++}}else l.push(F)}catch(u){console.warn("Failed to parse individual event:",u)}}),l}catch(i){throw console.error("Failed to parse ICS data:",i),new Error("Invalid ICS format")}}getAllEvents(){let e=[];return this.cache.forEach(r=>{new Date(r.expires)>new Date&&e.push(...r.events)}),e}getEventsForSubscription(e){let r=this.cache.get(e);return!r||new Date(r.expires)<=new Date?[]:[...r.events]}async refreshAllSubscriptions(){let e=this.subscriptions.filter(r=>r.enabled);for(let r of e)await this.fetchSubscription(r.id)}async readLocalICSFile(e){try{let r=this.plugin.app.vault.getAbstractFileByPath(e);if(!r||!(r instanceof As.TFile))throw new Error(`File not found: ${e}`);if(r.extension!=="ics")throw new Error(`File is not an ICS file: ${e}`);return await this.plugin.app.vault.cachedRead(r)}catch(r){throw new Error(`Failed to read local ICS file "${e}": ${r instanceof Error?r.message:String(r)}`)}}startFileWatcher(e){if(!e.filePath)return;this.stopFileWatcher(e.id);let r=(c,d)=>{(c.path===e.filePath||d===e.filePath)&&setTimeout(()=>{this.fetchSubscription(e.id)},1e3)},i=this.plugin.app.vault.on("modify",r),n=this.plugin.app.vault.on("rename",r),a=this.plugin.app.vault.on("delete",c=>{c.path===e.filePath&&this.updateSubscription(e.id,{lastError:"Local ICS file was deleted"})});this.fileWatchers.set(e.id,()=>{this.plugin.app.vault.offref(i),this.plugin.app.vault.offref(n),this.plugin.app.vault.offref(a)});let o=e.refreshInterval*60*1e3,l=setInterval(()=>{this.fetchSubscription(e.id)},o);this.refreshTimers.set(e.id,l)}stopFileWatcher(e){let r=this.fileWatchers.get(e);r&&(r(),this.fileWatchers.delete(e))}async refreshSubscription(e){await this.fetchSubscription(e)}startRefreshTimer(e){this.stopRefreshTimer(e.id);let r=e.refreshInterval*60*1e3,i=setInterval(()=>{this.fetchSubscription(e.id)},r);this.refreshTimers.set(e.id,i)}stopRefreshTimer(e){let r=this.refreshTimers.get(e);r&&(clearInterval(r),this.refreshTimers.delete(e))}generateId(){return"ics_"+Math.random().toString(36).substring(2,11)+Date.now().toString(36)}destroy(){this.refreshTimers.forEach(e=>clearInterval(e)),this.refreshTimers.clear(),this.fileWatchers.forEach(e=>e()),this.fileWatchers.clear(),this.cache.clear(),this.removeAllListeners()}getLocalICSFiles(){return this.plugin.app.vault.getFiles().filter(e=>e.extension==="ics").sort((e,r)=>e.path.localeCompare(r.path))}};var Is=require("obsidian");ot();Se();ht();var pp=class{constructor(t){this.plugin=t}async createTaskFromICS(t,e){try{let r=this.plugin.icsSubscriptionService.getSubscriptions().find(o=>o.id===t.subscriptionId),i=(r==null?void 0:r.name)||"Unknown Calendar",n=(e==null?void 0:e.scheduled)!==void 0?e.scheduled:this.computeScheduledFromICSEvent(t),a={title:(e==null?void 0:e.title)||t.title,status:(e==null?void 0:e.status)||this.plugin.settings.defaultTaskStatus,priority:(e==null?void 0:e.priority)||this.plugin.settings.defaultTaskPriority,due:(e==null?void 0:e.due)||void 0,scheduled:n,contexts:(e==null?void 0:e.contexts)||(t.location?[t.location]:void 0),projects:e==null?void 0:e.projects,tags:(e==null?void 0:e.tags)||[this.plugin.fieldMapper.toUserField("icsEventTag")],timeEstimate:(e==null?void 0:e.timeEstimate)||this.calculateEventDuration(t),details:(e==null?void 0:e.details)||this.buildICSEventDetails(t,i),icsEventId:[t.id],creationContext:"ics-event",dateCreated:ke(),dateModified:ke(),...e};return await this.plugin.taskService.createTask(a)}catch(r){let i=r instanceof Error?r.message:String(r);throw console.error("Error creating task from ICS event:",{error:i,icsEventId:t.id,icsEventTitle:t.title}),new Error(`Failed to create task from ICS event: ${i}`)}}computeScheduledFromICSEvent(t){try{if(!t.start)return;let e=new Date(t.start);return t.allDay?ae(e):C(e,"yyyy-MM-dd'T'HH:mm")}catch(e){return console.warn("Failed to compute scheduled from ICS event start:",{start:t.start,error:e}),t.start}}async createNoteFromICS(t,e){var r;try{let i=this.plugin.icsSubscriptionService.getSubscriptions().find(T=>T.id===t.subscriptionId),n=(i==null?void 0:i.name)||"Unknown Calendar",a=(e==null?void 0:e.title)||`${t.title} - ${C(new Date(t.start),"PPP")}`,o=(e==null?void 0:e.folder)||((r=this.plugin.settings.icsIntegration)==null?void 0:r.defaultNoteFolder)||"",l={title:t.title,priority:"",status:"",date:new Date(t.start),dueDate:t.end,scheduledDate:t.start,icsEventTitle:t.title,icsEventLocation:t.location,icsEventDescription:t.description},c=wx(l,this.plugin.settings),d=await pc(c,o,this.plugin.app.vault),u=o?`${o}/${d}.md`:`${d}.md`;o&&await Ya(this.plugin.app.vault,o);let h={title:a,priority:"",status:"",contexts:t.location?[t.location]:[],tags:[this.plugin.fieldMapper.toUserField("icsEventTag")],timeEstimate:0,dueDate:t.end||"",scheduledDate:t.start||"",details:t.description||"",parentNote:"",icsEventTitle:t.title,icsEventStart:t.start,icsEventEnd:t.end||"",icsEventLocation:t.location||"",icsEventDescription:t.description||"",icsEventUrl:t.url||"",icsEventSubscription:n,icsEventId:t.id},p={title:a,dateCreated:ke(),dateModified:ke(),tags:[this.plugin.fieldMapper.toUserField("icsEventTag")],[this.plugin.fieldMapper.toUserField("icsEventId")]:[t.id]},f=this.buildICSEventDetails(t,n);if(e!=null&&e.template)try{let T=(0,Is.normalizePath)(e.template.trim()),S=this.plugin.app.vault.getAbstractFileByPath(T.endsWith(".md")?T:`${T}.md`);if(S instanceof Is.TFile){let x=await this.plugin.app.vault.read(S),I=qh(x,h);p={...p,...I.frontmatter},f=I.body||f}else console.warn(`ICS note template not found: ${T}`),new Is.Notice(`Template not found: ${T}`)}catch(T){console.error("Error processing ICS note template:",T),new Is.Notice(`Error processing template: ${e.template}`)}let g=`${Object.keys(p).length>0?`---
${Object.entries(p).map(([T,S])=>`${T}: ${this.formatYamlValue(S)}`).join(`
`)}
---

`:""}${f}`,y=await this.plugin.app.vault.create(u,g),w={title:a,path:y.path,tags:p.tags||[],createdDate:p.dateCreated,lastModified:Date.now()};return{file:y,noteInfo:w}}catch(i){let n=i instanceof Error?i.message:String(i);throw console.error("Error creating note from ICS event:",{error:n,icsEventId:t.id,icsEventTitle:t.title}),new Error(`Failed to create note from ICS event: ${n}`)}}async findRelatedNotes(t){try{let e=[],r=this.plugin.fieldMapper.toUserField("icsEventId"),i=await this.plugin.cacheManager.getAllTasks();for(let a of i)a.icsEventId&&a.icsEventId.includes(t.id)&&e.push(a);let n=this.plugin.app.vault.getMarkdownFiles();for(let a of n)try{let o=this.plugin.app.metadataCache.getFileCache(a),l=o==null?void 0:o.frontmatter,c=l==null?void 0:l[r],d=Array.isArray(c)?c.includes(t.id):c===t.id;if(l&&d){let u={title:l.title||a.basename,path:a.path,tags:l.tags||[],createdDate:l.dateCreated,lastModified:a.stat.mtime};e.push(u)}}catch(o){continue}return e}catch(e){return console.error("Error finding related notes for ICS event:",e),[]}}async linkNoteToICS(t,e){try{let r=this.plugin.app.vault.getAbstractFileByPath(t);if(!(r instanceof Is.TFile))throw new Error(`Cannot find note file: ${t}`);await this.plugin.app.fileManager.processFrontMatter(r,i=>{let n=this.plugin.fieldMapper.toUserField("icsEventId"),a=i[n];a?Array.isArray(a)||(a=[a]):a=[],a.includes(e.id)||a.push(e.id),i[n]=a,i.dateModified=ke()}),new Is.Notice(`Linked note to ICS event: ${e.title}`)}catch(r){let i=r instanceof Error?r.message:String(r);throw console.error("Error linking note to ICS event:",{error:i,notePath:t,icsEventId:e.id}),new Error(`Failed to link note to ICS event: ${i}`)}}buildICSEventDetails(t,e){let r=[];if(r.push(`# ${t.title}`),r.push(""),t.start){let i=new Date(t.start);r.push(`**Start:** ${C(i,"PPPp")}`)}if(t.end&&!t.allDay){let i=new Date(t.end);r.push(`**End:** ${C(i,"PPPp")}`)}return t.location&&r.push(`**Location:** ${t.location}`),r.push(`**Calendar:** ${e}`),t.description&&(r.push(""),r.push("## Description"),r.push(t.description)),t.url&&(r.push(""),r.push(`**Event URL:** ${t.url}`)),r.join(`
`)}formatYamlValue(t){return typeof t=="string"?t.includes(":")||t.includes("#")||t.includes("[")||t.includes("{")?`"${t.replace(/"/g,'\\"')}"`:t:Array.isArray(t)?`[${t.map(e=>typeof e=="string"?`"${e}"`:e).join(", ")}]`:String(t)}calculateEventDuration(t){if(!(!t.start||!t.end))try{let e=new Date(t.start).getTime(),r=new Date(t.end).getTime();if(isNaN(e)||isNaN(r))return;let i=r-e,n=Math.round(i/(1e3*60));return n>0&&n<1440?n:void 0}catch(e){console.warn("Error calculating event duration:",e);return}}};ht();var fp=class{constructor(t){this.migrationInProgress=!1;this.app=t}async needsMigration(){var e;let t=this.app.vault.getMarkdownFiles().filter(r=>{var i,n;return r.path.includes("task")||((n=(i=this.app.metadataCache.getFileCache(r))==null?void 0:i.frontmatter)==null?void 0:n.status)});for(let r of t){let i=(e=this.app.metadataCache.getFileCache(r))==null?void 0:e.frontmatter;if(i!=null&&i.recurrence&&typeof i.recurrence=="object")return!0}return!1}async getMigrationCount(){var r;let t=this.app.vault.getMarkdownFiles().filter(i=>{var n,a;return i.path.includes("task")||((a=(n=this.app.metadataCache.getFileCache(i))==null?void 0:n.frontmatter)==null?void 0:a.status)}),e=0;for(let i of t){let n=(r=this.app.metadataCache.getFileCache(i))==null?void 0:r.frontmatter;n!=null&&n.recurrence&&typeof n.recurrence=="object"&&e++}return e}async performMigration(t){if(this.migrationInProgress)throw new Error("Migration already in progress");this.migrationInProgress=!0;let e=[],r=0;try{let i=this.app.vault.getMarkdownFiles().filter(a=>{var l;let o=(l=this.app.metadataCache.getFileCache(a))==null?void 0:l.frontmatter;return(o==null?void 0:o.recurrence)&&typeof o.recurrence=="object"}),n=i.length;for(let a=0;a<i.length;a++){let o=i[a];t&&t(a+1,n,o.name),await this.migrateFile(o).then(()=>{r++}).catch(l=>{let c=`Failed to migrate ${o.path}: ${l instanceof Error?l.message:String(l)}`;e.push(c),console.error(c,l)}),a%10===0&&await new Promise(l=>setTimeout(l,50))}return{success:r,errors:e}}finally{this.migrationInProgress=!1}}async migrateFile(t){await this.app.fileManager.processFrontMatter(t,e=>{if(!(!e.recurrence||typeof e.recurrence!="object"))try{let r=Rf(e.recurrence);e.recurrence=r}catch(r){throw new Error(`Failed to convert recurrence to rrule: ${r instanceof Error?r.message:String(r)}`)}})}isMigrationInProgress(){return this.migrationInProgress}};var Cr=require("obsidian"),Qy=class extends Cr.Modal{constructor(e,r){super(e);this.migrationCount=0;this.migrationService=r}async onOpen(){let{contentEl:e}=this;if(e.empty(),this.migrationCount=await this.migrationService.getMigrationCount(),new Cr.Setting(e).setName("Recurrence system migration").setHeading(),e.createEl("p",{text:"TaskNotes has an updated, more powerful recurrence system based on the RFC 5545 standard. This migration will convert your existing recurring tasks to use the new format."}),e.createEl("p",{text:`Found ${this.migrationCount} task(s) that need migration.`}),this.migrationCount===0){e.createEl("p",{text:"No migration needed! All your tasks are already using the new recurrence format.",cls:"text-success"}),new Cr.Setting(e).addButton(p=>{p.setButtonText("Close").setCta().onClick(()=>this.close())});return}let r=e.createDiv("migration-warning");new Cr.Setting(r).setName("\u26A0\uFE0F Important notes").setHeading();let i=r.createEl("ul");i.createEl("li",{text:"We strongly recommend backing up your vault before proceeding."}),i.createEl("li",{text:"The migration will convert your recurrence objects to standardized rrule strings."}),i.createEl("li",{text:"You can continue using your tasks normally after migration."}),i.createEl("li",{text:"The migration is permanent - your legacy recurrence objects will be replaced."});let n=e.createDiv("migration-benefits");new Cr.Setting(n).setName("\u2728 What You Get").setHeading();let a=n.createEl("ul");a.createEl("li",{text:'More powerful recurrence patterns (e.g., "every other Tuesday", "last Friday of the month")'}),a.createEl("li",{text:"Better performance for calendar views"}),a.createEl("li",{text:"Improved compatibility with calendar standards"}),a.createEl("li",{text:"Enhanced natural language processing for task creation"});let o=e.createDiv("migration-progress");o.style.display="none",new Cr.Setting(o).setName("Migration progress").setHeading();let l=o.createEl("progress");l.max=this.migrationCount,l.value=0;let c=o.createEl("p",{text:"Preparing migration..."}),d=e.createDiv("migration-buttons");d.style.display="flex",d.style.gap="10px",d.style.marginTop="20px";let u=d.createEl("button",{text:"Cancel"});u.onclick=()=>this.close();let h=d.createEl("button",{text:`Migrate ${this.migrationCount} Task(s)`,cls:"mod-cta"});h.onclick=async()=>{h.disabled=!0,u.disabled=!0,o.style.display="block";try{let p=await this.migrationService.performMigration((f,m,g)=>{l.value=f,c.textContent=`Migrating ${f}/${m}: ${g}`});if(c.textContent=`Migration completed! ${p.success} files migrated successfully.`,p.errors.length>0){let f=o.createDiv("migration-errors");new Cr.Setting(f).setName("\u26A0\uFE0F Errors Encountered").setHeading();let m=f.createEl("ul");p.errors.forEach(g=>{m.createEl("li",{text:g})}),new Cr.Notice(`Migration completed with ${p.errors.length} errors. Check the migration modal for details.`,1e4)}else new Cr.Notice(`Migration completed successfully! ${p.success} tasks migrated.`,5e3);h.textContent="Migration Complete",u.textContent="Close",u.disabled=!1}catch(p){c.textContent=`Migration failed: ${p instanceof Error?p.message:String(p)}`,new Cr.Notice(`Migration failed: ${p instanceof Error?p.message:String(p)}`,1e4),h.disabled=!1,u.disabled=!1}}}onClose(){let{contentEl:e}=this;e.empty()}};function YM(s,t){let e=new Cr.Notice("",0),r=e.messageEl.createDiv();r.style.display="flex",r.style.flexDirection="column",r.style.gap="12px",r.style.padding="8px";let i=r.createSpan();i.textContent="TaskNotes has an updated recurrence system. Migrate your existing recurring tasks to continue using them.",i.style.lineHeight="1.4",i.style.marginBottom="4px";let n=r.createDiv();n.style.display="flex",n.style.gap="8px",n.style.justifyContent="flex-end",n.style.alignItems="center";let a=n.createEl("button",{text:"Migrate Now",cls:"mod-cta"}),o=n.createEl("button",{text:"Remind Later"});a.onclick=()=>{e.hide(),new Qy(s,t).open()},o.onclick=()=>{e.hide()}}var Ky=require("obsidian"),mp=class{constructor(t){this.statusBarElement=null;this.updateTimeout=null;this.plugin=t,this.requestDeduplicator=new Io}initialize(){this.plugin.settings.showTrackedTasksInStatusBar&&(this.statusBarElement=this.plugin.addStatusBarItem(),this.statusBarElement.addClass("tasknotes-status-bar"),this.statusBarElement.style.cursor="pointer",this.statusBarElement.addEventListener("click",()=>{this.handleStatusBarClick()}),this.updateStatusBar())}async updateStatusBar(){if(!(!this.statusBarElement||!this.plugin.settings.showTrackedTasksInStatusBar))try{let t=await this.requestDeduplicator.execute("update-status-bar",()=>this.getTrackedTasks());this.renderStatusBar(t)}catch(t){console.error("Error updating status bar:",t)}}async getTrackedTasks(){return(await this.plugin.cacheManager.getAllTasks()).filter(e=>e.archived?!1:this.plugin.getActiveTimeSession(e)!==null)}renderStatusBar(t){if(!this.statusBarElement)return;let e=t.length;if(e===0){this.statusBarElement.style.display="none";return}this.statusBarElement.style.display="",this.statusBarElement.empty(),this.statusBarElement.createEl("span",{cls:"tasknotes-status-icon",text:"\u23F1\uFE0F"});let r=this.statusBarElement.createEl("span",{cls:"tasknotes-status-text"});if(e===1){let i=t[0],n=i.title.length>30?i.title.substring(0,30)+"...":i.title;r.setText(`Tracking: ${n}`),(0,Ky.setTooltip)(this.statusBarElement,`Currently tracking: ${i.title}`,{placement:"top"})}else{r.setText(`Tracking ${e} tasks`);let i=t.slice(0,5).map(a=>a.title).join(`
`),n=e>5?`${i}
... and ${e-5} more`:i;(0,Ky.setTooltip)(this.statusBarElement,`Currently tracking:
${n}`,{placement:"top"})}}async handleStatusBarClick(){try{if((await this.getTrackedTasks()).length===0)return;await this.plugin.activateTasksView()}catch(t){console.error("Error handling status bar click:",t)}}requestUpdate(){this.updateTimeout&&window.clearTimeout(this.updateTimeout),this.updateTimeout=window.setTimeout(()=>{this.updateStatusBar()},100)}updateVisibility(){this.plugin.settings.showTrackedTasksInStatusBar?this.statusBarElement?this.updateStatusBar():this.initialize():this.hide()}hide(){this.statusBarElement&&(this.statusBarElement.style.display="none")}destroy(){this.updateTimeout&&(window.clearTimeout(this.updateTimeout),this.updateTimeout=null),this.requestDeduplicator&&this.requestDeduplicator.cancelAll(),this.statusBarElement=null}};var gp=class{constructor(t){this.expandedProjects=new Set;this.plugin=t}isExpanded(t){return this.expandedProjects.has(t)}toggle(t){return this.expandedProjects.has(t)?(this.expandedProjects.delete(t),!1):(this.expandedProjects.add(t),!0)}setExpanded(t,e){e?this.expandedProjects.add(t):this.expandedProjects.delete(t)}getExpandedProjects(){return Array.from(this.expandedProjects)}clearAll(){this.expandedProjects.clear()}collapseAll(){this.clearAll()}};var jM=require("obsidian");Se();var yp=class{constructor(t){this.notificationQueue=[];this.processedReminders=new Set;this.lastBroadScanTime=Date.now();this.lastQuickCheckTime=Date.now();this.BROAD_SCAN_INTERVAL=300*1e3;this.QUICK_CHECK_INTERVAL=30*1e3;this.QUEUE_WINDOW=300*1e3;this.plugin=t}async initialize(){this.plugin.settings.enableNotifications&&(this.plugin.settings.notificationType==="system"&&"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission(),this.setupTaskUpdateListener(),this.startBroadScan(),this.startQuickCheck(),await this.scanTasksAndBuildQueue())}destroy(){this.broadScanInterval&&clearInterval(this.broadScanInterval),this.quickCheckInterval&&clearInterval(this.quickCheckInterval),this.taskUpdateListener&&this.plugin.emitter.offref(this.taskUpdateListener),this.notificationQueue=[],this.processedReminders.clear()}startBroadScan(){this.broadScanInterval=setInterval(async()=>{let t=Date.now();t-this.lastBroadScanTime>this.BROAD_SCAN_INTERVAL+6e4&&(console.log("NotificationService: Detected potential system sleep, performing catch-up scan"),await this.handleSystemWakeUp()),await this.scanTasksAndBuildQueue(),this.lastBroadScanTime=t},this.BROAD_SCAN_INTERVAL)}startQuickCheck(){this.quickCheckInterval=setInterval(()=>{let t=Date.now();t-this.lastQuickCheckTime>this.QUICK_CHECK_INTERVAL+6e4&&console.log("NotificationService: Detected potential system sleep during quick check"),this.checkNotificationQueue(),this.lastQuickCheckTime=t},this.QUICK_CHECK_INTERVAL)}async scanTasksAndBuildQueue(){this.notificationQueue=[];let t=await this.plugin.cacheManager.getAllTasks(),e=Date.now(),r=e+this.QUEUE_WINDOW;for(let i of t)if(!(!i.reminders||i.reminders.length===0))for(let n of i.reminders){let a=`${i.path}-${n.id}`;if(this.processedReminders.has(a))continue;let o=this.calculateNotificationTime(i,n);o!==null&&o>e&&o<=r&&this.notificationQueue.push({taskPath:i.path,reminder:n,notifyAt:o})}this.notificationQueue.sort((i,n)=>i.notifyAt-n.notifyAt)}calculateNotificationTime(t,e){try{if(e.type==="absolute")return e.absoluteTime?_t(e.absoluteTime).getTime():null;if(e.type==="relative"){if(!e.relatedTo||!e.offset)return null;let r=e.relatedTo==="due"?t.due:t.scheduled;if(!r)return null;let i=_t(r),n=this.parseISO8601Duration(e.offset);return n===null?null:i.getTime()+n}}catch(r){return console.error("Error calculating notification time:",r),null}return null}parseISO8601Duration(t){let e=t.match(/^(-?)P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)W)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?)?$/);if(!e)return null;let[,r,i,n,a,o,l,c,d]=e,u=0;return i&&(u+=parseInt(i)*365*24*60*60*1e3),n&&(u+=parseInt(n)*30*24*60*60*1e3),a&&(u+=parseInt(a)*7*24*60*60*1e3),o&&(u+=parseInt(o)*24*60*60*1e3),l&&(u+=parseInt(l)*60*60*1e3),c&&(u+=parseInt(c)*60*1e3),d&&(u+=parseInt(d)*1e3),r==="-"?-u:u}checkNotificationQueue(){let t=Date.now(),e=[];for(let r=0;r<this.notificationQueue.length;r++){let i=this.notificationQueue[r];if(i.notifyAt<=t){this.triggerNotification(i),e.push(r);let n=`${i.taskPath}-${i.reminder.id}`;this.processedReminders.add(n)}else break}for(let r=e.length-1;r>=0;r--)this.notificationQueue.splice(e[r],1)}async triggerNotification(t){let e=this.plugin.app.vault.getAbstractFileByPath(t.taskPath);if(!e)return;let r=this.plugin.app.metadataCache.getFileCache(e);if(!r||!r.frontmatter)return;let i=this.plugin.fieldMapper.mapFromFrontmatter(r.frontmatter,t.taskPath,this.plugin.settings.storeTitleInFilename),n=t.reminder.description||this.generateDefaultMessage(i,t.reminder);if(this.plugin.settings.notificationType==="system")if("Notification"in window&&Notification.permission==="granted"){let a=new Notification("TaskNotes Reminder",{body:n,tag:`tasknotes-${t.taskPath}-${t.reminder.id}`});a.onclick=()=>{this.plugin.app.workspace.openLinkText(t.taskPath,"",!1),a.close()}}else this.showInAppNotice(n,t.taskPath);else this.showInAppNotice(n,t.taskPath);this.plugin.apiService&&await this.plugin.apiService.triggerWebhook("reminder.triggered",{task:i,reminder:t.reminder,notificationTime:new Date(t.notifyAt).toISOString(),message:n,notificationType:this.plugin.settings.notificationType})}showInAppNotice(t,e){let r=new jM.Notice(t,0);r.noticeEl.addEventListener("click",()=>{this.plugin.app.workspace.openLinkText(e,"",!1),r.hide()}),r.noticeEl.style.cursor="pointer"}generateDefaultMessage(t,e){if(e.type==="absolute")return`Reminder: ${t.title}`;{let r=e.relatedTo==="due"?"due":"scheduled",i=this.formatDurationForDisplay(e.offset||"");return i.startsWith("-")?`${t.title} is ${r} in ${i.substring(1)}`:i==="PT0S"||i==="PT0M"?`${t.title} is ${r} now`:`${t.title} was ${r} ${i} ago`}}formatDurationForDisplay(t){let e=this.parseISO8601Duration(t);if(e===null)return t;let r=Math.abs(e),i=Math.floor(r/(60*1e3)),n=Math.floor(r/(3600*1e3)),a=Math.floor(r/(1440*60*1e3)),o="";return a>0?o=`${a} day${a>1?"s":""}`:n>0?o=`${n} hour${n>1?"s":""}`:i>0?o=`${i} minute${i>1?"s":""}`:o="now",e<0?`-${o}`:o}async refreshReminders(){await this.scanTasksAndBuildQueue()}clearProcessedRemindersForTask(t){let e=[];for(let r of this.processedReminders)r.startsWith(`${t}-`)&&e.push(r);e.forEach(r=>this.processedReminders.delete(r))}setupTaskUpdateListener(){this.taskUpdateListener=this.plugin.emitter.on(Fe,async({path:t,originalTask:e,updatedTask:r})=>{if(!t||!r)return;this.removeNotificationsForTask(t),this.clearProcessedRemindersForTask(t);let i=Date.now(),n=i+this.QUEUE_WINDOW;if(r.reminders&&r.reminders.length>0){for(let a of r.reminders){let o=`${t}-${a.id}`;if(this.processedReminders.has(o))continue;let l=this.calculateNotificationTime(r,a);l!==null&&l>i&&l<=n&&this.notificationQueue.push({taskPath:t,reminder:a,notifyAt:l})}this.notificationQueue.sort((a,o)=>a.notifyAt-o.notifyAt)}})}removeNotificationsForTask(t){this.notificationQueue=this.notificationQueue.filter(e=>e.taskPath!==t)}async handleSystemWakeUp(){let t=Date.now(),e=[];for(let r of this.processedReminders){let[i,n]=r.split("-",2);if(!(!i||!n))try{let a=await this.plugin.cacheManager.getTaskInfo(i);if(a&&a.reminders){let o=a.reminders.find(l=>l.id===n);if(o){let l=this.calculateNotificationTime(a,o);l&&l<=t&&e.push(r)}}}catch(a){e.push(r)}}e.forEach(r=>this.processedReminders.delete(r)),await this.scanTasksAndBuildQueue()}};var ud=class extends de.Plugin{constructor(){super(...arguments);this.previousCacheSettings=null;this.previousTimeTrackingSettings=null;this.lastKnownDate=new Date().toDateString();this.selectedDate=dt(Ue());this.taskUpdateListenerForEditor=null;this.initializationComplete=!1;this.migrationComplete=!1;this.migrationPromise=null}async onload(){this.readyPromise=new Promise(e=>{this.resolveReady=e}),await this.loadSettings(),(0,de.addIcon)("tasknotes-simple",`<g>
			<defs>
				<mask id="tasknotes-mask">
					<rect width="100" height="100" fill="white"/>
					<path fill="black" d="m 5.9,52.4 -0.09,4.51 c 4.71,0.09 7.61,1.48 9.95,3.57 2.35,2.09 4.11,5.01 5.90,8.14 1.80,3.13 3.62,6.46 6.45,9.12 2.23,2.09 5.14,3.67 8.83,4.21 0.46,-1.51 1.05,-2.95 1.77,-4.33 -3.44,-0.21 -5.62,-1.39 -7.53,-3.17 -2.14,-2.01 -3.82,-4.92 -5.63,-8.08 -1.81,-3.16 -3.77,-6.56 -6.82,-9.27 -3.05,-2.71 -7.07,-4.59 -11.83,-4.70 z"/>
					<path fill="black" d="M 73.6,18.3 69.9,20.9 c 4.06,5.75 4.40,11.33 2.77,16.78 -1.63,5.45 -5.41,10.67 -9.65,14.78 -8.49,8.20 -16.59,14.11 -21.83,21.18 -5.24,7.07 -7.22,15.59 -3.13,27.21 l 4.25,-1.50 c -3.74,-10.62 -2.11,-16.80 2.50,-23.01 4.61,-6.21 12.63,-12.19 21.34,-20.64 4.65,-4.50 8.89,-10.23 10.84,-16.72 1.95,-6.49 1.42,-13.86 -3.40,-20.68 z"/>
				</mask>
			</defs>
			<path fill="currentColor" mask="url(#tasknotes-mask)" d="m 98.5,0.6 c -0.38,0 -0.83,0.09 -1.33,0.23 -2,0.59 -4.66,2.18 -5.78,3.22 -1.25,1.16 -4.16,4.93 -6.08,7.19 -2.67,3.12 -5.65,6.58 -9.32,11.13 2.58,5.61 2.61,11.38 1.05,16.60 -1.95,6.49 -6.19,12.22 -10.84,16.72 -8.71,8.43 -16.73,14.41 -21.34,20.64 -4.47,6.03 -6.13,12.03 -2.81,22.08 0.19,-0.23 0.37,-0.49 0.54,-0.80 10.57,-19.70 17.89,-27.30 41.9,-47.08 v 0 c 2.40,-1.97 3.71,-4.33 4.52,-7.14 0.81,-2.82 1.11,-6.10 1.52,-9.92 0.81,-7.64 2.02,-17.43 8.43,-29.95 0.37,-0.73 0.57,-1.30 0.62,-1.72 0.05,-0.43 -0.04,-0.71 -0.22,-0.90 -0.19,-0.18 -0.48,-0.27 -0.86,-0.26 z M 72.7,26.3 c -0.75,0.92 -1.51,1.84 -2.27,2.78 -9.09,11.05 -19.45,22.93 -28.54,29.97 -1.48,1.14 -2.98,1.54 -4.46,1.38 -1.49,-0.16 -2.97,-0.89 -4.43,-1.96 -2.91,-2.16 -5.74,-5.74 -8.35,-9.19 -2.62,-3.45 -5.04,-6.77 -7.12,-8.39 -1.04,-0.81 -1.99,-1.19 -2.83,-0.97 -0.84,0.22 -1.60,1.05 -2.26,2.70 -1.03,2.61 -1.60,6.22 -3.42,10.05 4.08,0.62 7.27,2.27 9.73,4.45 3.05,2.71 5.01,6.11 6.82,9.27 1.81,3.16 3.49,6.07 5.63,8.08 1.90,1.78 4.08,2.96 7.53,3.17 0.71,-1.37 1.55,-2.69 2.49,-3.95 5.24,-7.07 13.34,-12.98 21.83,-21.18 4.24,-4.11 8.02,-9.33 9.65,-14.78 1.12,-3.73 1.31,-7.53 0.01,-11.42 z M 10.3,49.1 c -0.09,0.29 -0.18,0.56 -0.28,0.85 0.10,-0.29 0.19,-0.56 0.28,-0.85 z m -4.02,7.84 c -0.01,0.01 -0.02,0.02 -0.03,0.03 0.01,-0.01 0.02,-0.02 0.03,-0.03 0,0 0,0 0,0 z m 0.12,0 c -1.08,1.40 -2.40,2.79 -4.05,4.12 -1.20,1.0 -1.85,1.86 -2.03,2.71 -0.18,0.85 0.10,1.67 0.76,2.53 1.32,1.71 4.16,3.54 7.81,5.91 7.28,4.73 17.75,11.63 25.63,24.16 0.64,1.02 1.74,2.04 2.95,2.65 -0.91,-5.36 -0.91,-8.78 -0.54,-11.88 -3.33,-0.55 -6.07,-2.12 -8.39,-4.72 -2.83,-3.17 -4.69,-6.59 -6.54,-9.85 -1.85,-3.26 -3.69,-6.37 -6.08,-8.47 -2.06,-1.81 -4.61,-3.0 -8.49,-3.17 z"/>
		</g>`),this.fieldMapper=new Wa(this.settings.fieldMapping),this.statusManager=new Rs(this.settings.customStatuses),this.priorityManager=new Aa(this.settings.customPriorities),this.requestDeduplicator=new Io,this.predictivePrefetcher=new jh(this.requestDeduplicator),this.domReconciler=new Po,this.uiStateManager=new zh,this.cacheManager=new Yh(this.app,this.settings,this.fieldMapper),this.emitter=this.cacheManager,this.taskService=new Gh(this),this.filterService=new gn(this.cacheManager,this.statusManager,this.priorityManager,this),this.viewStateManager=new Qh(this.app,this),this.projectSubtasksService=new Ro(this),this.expandedProjectsService=new gp(this),this.dragDropManager=new Xh(this),this.migrationService=new fp(this.app),this.statusBarService=new mp(this),this.notificationService=new yp(this),this.addRibbonIcon("calendar-days","Open mini calendar",async()=>{await this.activateCalendarView()}),this.addRibbonIcon("calendar","Open advanced calendar",async()=>{await this.activateAdvancedCalendarView()}),this.addRibbonIcon("check-square","Open task list",async()=>{await this.activateTasksView()}),this.addRibbonIcon("sticky-note","Open notes",async()=>{await this.activateNotesView()}),this.addRibbonIcon("list","Open agenda",async()=>{await this.activateAgendaView()}),this.addRibbonIcon("columns-3","Open kanban board",async()=>{await this.activateKanbanView()}),this.addRibbonIcon("timer","Open pomodoro",async()=>{await this.activatePomodoroView()}),this.addRibbonIcon("bar-chart-3","Open pomodoro stats",async()=>{await this.activatePomodoroStatsView()}),this.addRibbonIcon("tasknotes-simple","Create new task",()=>{this.openTaskCreationModal()}),this.addCommands(),this.addSettingTab(new Ad(this.app,this)),this.migrationPromise=this.performEarlyMigrationCheck(),this.app.workspace.onLayoutReady(()=>{this.initializeAfterLayoutReady()}),this.resolveReady()}async initializeHTTPAPI(){if(!(de.Platform.isMobile||!this.settings.enableAPI))try{let{HTTPAPIService:e}=await Promise.resolve().then(()=>(d_(),c_));this.apiService=new e(this,this.taskService,this.filterService,this.cacheManager),this.taskService.setWebhookNotifier(this.apiService),this.pomodoroService.setWebhookNotifier(this.apiService),await this.apiService.start(),new de.Notice(`TaskNotes API started on port ${this.apiService.getPort()}`)}catch(e){console.error("Failed to initialize HTTP API:",e),new de.Notice("Failed to start TaskNotes API server. Check console for details.")}}async initializeAfterLayoutReady(){if(!this.initializationComplete){this.initializationComplete=!0;try{this.injectCustomStyles(),this.registerView(Na,e=>new Jd(e,this)),this.registerView(Xi,e=>new Nh(e,this)),this.registerView(Wr,e=>new Kc(e,this)),this.registerView(tl,e=>new Hh(e,this)),this.registerView(kt,e=>new Zc(e,this)),this.registerView(rl,e=>new Uh(e,this)),this.registerView(il,e=>new $h(e,this)),this.registerView(sl,e=>new Vh(e,this)),this.registerView(pi,e=>new Xc(e,this)),this.registerEditorExtension(CM(this)),this.registerEditorExtension(_M(this)),this.registerMarkdownPostProcessor(xM(this)),this.cacheManager.initialize(),this.filterService.initialize(),this.statusBarService.initialize(),await this.notificationService.initialize(),this.setupDateChangeDetection(),this.initializeServicesLazily()}catch(e){console.error("Error during post-layout initialization:",e)}}}initializeServicesLazily(){setTimeout(async()=>{try{this.pomodoroService=new Wh(this),await this.pomodoroService.initialize(),this.icsSubscriptionService=new hp(this),await this.icsSubscriptionService.initialize(),this.icsNoteService=new pp(this),await this.initializeHTTPAPI();let{TaskLinkDetectionService:e}=await Promise.resolve().then(()=>(Oy(),EM));this.taskLinkDetectionService=new e(this);let{InstantTaskConvertService:r}=await Promise.resolve().then(()=>(h_(),u_));this.instantTaskConvertService=new r(this,this.statusManager,this.priorityManager);let{createInstantConvertButtons:i}=await Promise.resolve().then(()=>(m_(),f_));this.registerEditorExtension(i(this)),this.taskUpdateListenerForEditor=this.emitter.on(Fe,n=>{this.app.workspace.iterateRootLeaves(a=>{var o;if(a.view&&a.view.getViewType()==="markdown"){let l=a.view.editor;if(l&&l.cm){let c=(n==null?void 0:n.path)||((o=n==null?void 0:n.updatedTask)==null?void 0:o.path);vn(l.cm,c),rd(l.cm)}}})}),this.registerEvent(this.app.workspace.on("active-leaf-change",n=>{setTimeout(()=>{if(n&&n.view&&n.view.getViewType()==="markdown"){let a=n.view.editor;a&&a.cm&&(vn(a.cm),rd(a.cm))}},50)})),this.registerEvent(this.app.workspace.on("layout-change",()=>{setTimeout(()=>{let n=this.app.workspace.getActiveViewOfType(de.MarkdownView);if(n){let a=n.editor;a&&a.cm&&(vn(a.cm),rd(a.cm))}},100)})),this.setupStatusBarEventListeners(),this.setupTimeTrackingEventListeners(),await this.showMigrationPromptsIfNeeded()}catch(e){console.error("Error during lazy service initialization:",e)}},10)}async onReady(){if(!this.readyPromise)throw new Error("Plugin not yet initialized");await this.readyPromise}setupStatusBarEventListeners(){this.statusBarService&&(this.registerEvent(this.emitter.on(Fe,()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on(Ft,()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.pomodoroService&&(this.registerEvent(this.emitter.on("pomodoro-start",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on("pomodoro-stop",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on("pomodoro-state-changed",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)}))))}setupTimeTrackingEventListeners(){if(this.settings.autoStopTimeTrackingOnComplete){let e=this.emitter.on(Fe,async r=>{await this.handleAutoStopTimeTracking(r)});this.registerEvent(e)}this.updatePreviousTimeTrackingSettings()}async handleAutoStopTimeTracking(e){let{originalTask:r,updatedTask:i}=e;if(!r||!i)return;let n=this.statusManager.isCompletedStatus(r.status),a=this.statusManager.isCompletedStatus(i.status);if(!n&&a&&this.getActiveTimeSession(i))try{await this.stopTimeTracking(i),this.settings.autoStopTimeTrackingNotification&&new de.Notice(`Auto-stopped time tracking for: ${i.title}`),console.log(`Auto-stopped time tracking for completed task: ${i.title}`)}catch(l){console.error("Error auto-stopping time tracking:",l)}}haveTimeTrackingSettingsChanged(){return this.previousTimeTrackingSettings?this.settings.autoStopTimeTrackingOnComplete!==this.previousTimeTrackingSettings.autoStopTimeTrackingOnComplete:!0}updatePreviousTimeTrackingSettings(){this.previousTimeTrackingSettings={autoStopTimeTrackingOnComplete:this.settings.autoStopTimeTrackingOnComplete}}async performEarlyMigrationCheck(){try{if(console.log("TaskNotes: Starting early migration check..."),await this.viewStateManager.initializeSavedViews(),this.viewStateManager.needsMigration()&&(console.log("TaskNotes: Performing view state migration..."),await this.viewStateManager.performMigration()),this.settings.recurrenceMigrated===!0){this.migrationComplete=!0;return}if(!await this.migrationService.needsMigration()){this.settings.recurrenceMigrated=!0,await this.saveSettings(),this.migrationComplete=!0;return}this.migrationComplete=!0,console.log("TaskNotes: Early migration check complete. Will show prompts after UI initialization.")}catch(e){console.error("Error during early migration check:",e),this.migrationComplete=!0}}async showMigrationPromptsIfNeeded(){try{if(this.settings.recurrenceMigrated===!0)return;await this.migrationService.needsMigration()&&setTimeout(()=>{YM(this.app,this.migrationService)},1e3)}catch(e){console.error("Error showing migration prompts:",e)}}async waitForMigration(){for(this.migrationPromise&&await this.migrationPromise;!this.migrationComplete;)await new Promise(e=>setTimeout(e,50))}setSelectedDate(e){this.selectedDate=e,this.emitter.trigger(Os,e)}notifyDataChanged(e,r=!1,i=!0){e?(this.cacheManager.clearCacheEntry(e),this.taskLinkDetectionService&&this.taskLinkDetectionService.clearCacheForFile(e)):r&&(this.cacheManager.clearAllCaches(),this.taskLinkDetectionService&&this.taskLinkDetectionService.clearCache()),i&&requestAnimationFrame(()=>{this.emitter.trigger(Ft)})}setupDateChangeDetection(){let e=()=>{let r=new Date().toDateString();r!==this.lastKnownDate&&(this.lastKnownDate=r,this.emitter.trigger(mi))};this.dateCheckInterval=window.setInterval(e,6e4),this.registerInterval(this.dateCheckInterval),this.scheduleNextMidnightCheck()}scheduleNextMidnightCheck(){let e=new Date,r=new Date(e);r.setHours(24,0,0,0);let i=r.getTime()-e.getTime();this.midnightTimeout&&window.clearTimeout(this.midnightTimeout),this.midnightTimeout=window.setTimeout(()=>{let n=new Date().toDateString();n!==this.lastKnownDate&&(this.lastKnownDate=n,this.emitter.trigger(mi)),this.scheduleNextMidnightCheck()},i),this.registerInterval(this.midnightTimeout)}onunload(){let e=as.getStats("cache-initialization");e&&e.count>0&&as.logSummary(),this.pomodoroService&&this.pomodoroService.cleanup(),this.filterService&&this.filterService.cleanup(),this.icsSubscriptionService&&this.icsSubscriptionService.destroy(),this.taskLinkDetectionService&&this.taskLinkDetectionService.cleanup(),this.dragDropManager&&this.dragDropManager.destroy(),this.apiService&&this.apiService.stop(),this.viewStateManager&&this.viewStateManager.cleanup(),this.statusBarService&&this.statusBarService.destroy(),this.notificationService&&this.notificationService.destroy(),this.cacheManager&&this.cacheManager.destroy(),this.requestDeduplicator&&this.requestDeduplicator.cancelAll(),this.domReconciler&&this.domReconciler.destroy(),this.uiStateManager&&this.uiStateManager.destroy(),typeof as!="undefined"&&as.destroy(),this.taskUpdateListenerForEditor&&this.emitter.offref(this.taskUpdateListenerForEditor),this.emitter&&this.emitter.off,this.initializationComplete=!1}async loadSettings(){let e=await this.loadData();e&&"useNativeMetadataCache"in e&&delete e.useNativeMetadataCache,e&&typeof e.enableAPI=="undefined"&&(e.enableAPI=!1),e&&typeof e.apiPort=="undefined"&&(e.apiPort=8080),e&&typeof e.apiAuthToken=="undefined"&&(e.apiAuthToken=""),this.settings={...xr,...e,fieldMapping:{...xr.fieldMapping,...(e==null?void 0:e.fieldMapping)||{}},taskCreationDefaults:{...xr.taskCreationDefaults,...(e==null?void 0:e.taskCreationDefaults)||{}},calendarViewSettings:{...xr.calendarViewSettings,...(e==null?void 0:e.calendarViewSettings)||{}},icsIntegration:{...xr.icsIntegration,...(e==null?void 0:e.icsIntegration)||{}},customStatuses:(e==null?void 0:e.customStatuses)||xr.customStatuses,customPriorities:(e==null?void 0:e.customPriorities)||xr.customPriorities,savedViews:(e==null?void 0:e.savedViews)||xr.savedViews};let r=Object.keys(xr.fieldMapping).some(n=>{var a;return!((a=e==null?void 0:e.fieldMapping)!=null&&a[n])}),i=Object.keys(xr.calendarViewSettings).some(n=>{var a;return!((a=e==null?void 0:e.calendarViewSettings)!=null&&a[n])});(r||i)&&setTimeout(async()=>{try{let n=await this.loadData()||{},a=Object.keys(xr);for(let o of a)n[o]=this.settings[o];await this.saveData(n)}catch(n){console.error("Failed to save migrated settings:",n)}},100),this.updatePreviousCacheSettings()}async saveSettings(){var a;let e=await this.loadData()||{},r=Object.keys(xr);for(let o of r)e[o]=this.settings[o];await this.saveData(e);let i=this.haveCacheSettingsChanged(),n=this.haveTimeTrackingSettingsChanged();this.fieldMapper&&this.fieldMapper.updateMapping(this.settings.fieldMapping),this.statusManager&&this.statusManager.updateStatuses(this.settings.customStatuses),this.priorityManager&&this.priorityManager.updatePriorities(this.settings.customPriorities),i&&(console.debug("Cache-related settings changed, updating cache configuration"),this.cacheManager.updateConfig(this.settings.taskTag,this.settings.excludedFolders,this.fieldMapper,this.settings.disableNoteIndexing,this.settings.storeTitleInFilename),this.updatePreviousCacheSettings()),this.injectCustomStyles(),n&&this.setupTimeTrackingEventListeners(),this.statusBarService&&this.statusBarService.updateVisibility(),(a=this.filterService)==null||a.refreshFilterOptions(),this.notifyDataChanged(),this.emitter.trigger("settings-changed",this.settings)}addCommands(){this.addCommand({id:"open-calendar-view",name:"Open mini calendar view",callback:async()=>{await this.activateCalendarView()}}),this.addCommand({id:"open-advanced-calendar-view",name:"Open advanced calendar view",callback:async()=>{await this.activateAdvancedCalendarView()}}),this.addCommand({id:"open-tasks-view",name:"Open tasks view",callback:async()=>{await this.activateTasksView()}}),this.addCommand({id:"open-notes-view",name:"Open notes view",callback:async()=>{await this.activateNotesView()}}),this.addCommand({id:"open-agenda-view",name:"Open agenda view",callback:async()=>{await this.activateAgendaView()}}),this.addCommand({id:"open-pomodoro-view",name:"Open pomodoro timer",callback:async()=>{await this.activatePomodoroView()}}),this.addCommand({id:"open-kanban-view",name:"Open kanban board",callback:async()=>{await this.activateKanbanView()}}),this.addCommand({id:"open-pomodoro-stats",name:"Open pomodoro statistics",callback:async()=>{await this.activatePomodoroStatsView()}}),this.addCommand({id:"open-statistics",name:"Open task & project statistics",callback:async()=>{await this.activateStatsView()}}),this.addCommand({id:"create-new-task",name:"Create new task",callback:()=>{this.openTaskCreationModal()}}),this.addCommand({id:"convert-to-tasknote",name:"Convert task to TaskNote",editorCallback:async e=>{await this.convertTaskToTaskNote(e)}}),this.addCommand({id:"batch-convert-all-tasks",name:"Convert all tasks in note",editorCallback:async e=>{await this.batchConvertAllTasks(e)}}),this.addCommand({id:"insert-tasknote-link",name:"Insert tasknote link",editorCallback:e=>{this.insertTaskNoteLink(e)}}),this.addCommand({id:"create-inline-task",name:"Create new inline task",editorCallback:async e=>{await this.createInlineTask(e)}}),this.addCommand({id:"quick-actions-current-task",name:"Quick actions for current task",callback:async()=>{await this.openQuickActionsForCurrentTask()}}),this.addCommand({id:"go-to-today",name:"Go to today's note",callback:async()=>{await this.navigateToCurrentDailyNote()}}),this.addCommand({id:"start-pomodoro",name:"Start pomodoro timer",callback:async()=>{await this.pomodoroService.startPomodoro()}}),this.addCommand({id:"stop-pomodoro",name:"Stop pomodoro timer",callback:async()=>{await this.pomodoroService.stopPomodoro()}}),this.addCommand({id:"pause-pomodoro",name:"Pause/resume pomodoro timer",callback:async()=>{let e=this.pomodoroService.getState();e.isRunning?await this.pomodoroService.pausePomodoro():e.currentSession&&await this.pomodoroService.resumePomodoro()}}),this.addCommand({id:"refresh-cache",name:"Refresh cache",callback:async()=>{await this.refreshCache()}})}async activateView(e){let{workspace:r}=this.app,i=this.getLeafOfType(e);return i||(i=r.getLeaf("tab"),await i.setViewState({type:e,active:!0})),r.setActiveLeaf(i,{focus:!0}),r.revealLeaf(i),i}async activateCalendarView(){return this.activateView(Na)}async activateAdvancedCalendarView(){return this.activateView(Xi)}async activateTasksView(){return this.activateView(Wr)}async activateNotesView(){return this.activateView(tl)}async activateAgendaView(){return this.activateView(kt)}async activatePomodoroView(){return this.activateView(rl)}async activatePomodoroStatsView(){return this.activateView(il)}async activateStatsView(){return this.activateView(sl)}async activateKanbanView(){return this.activateView(pi)}getLeafOfType(e){let{workspace:r}=this.app,i=r.getLeavesOfType(e);for(let n of i)if(n.view&&n.view.getViewType()===e)return n;return i.length>0?i[0]:null}getCalendarLeaf(){return this.getLeafOfType(Na)}async navigateToCurrentDailyNote(){let e=new Date;await this.navigateToDailyNote(e)}async navigateToDailyNote(e){try{if(!(0,Dn.appHasDailyNotesPluginLoaded)()){new de.Notice("Daily Notes core plugin is not enabled. Please enable it in Settings > Core plugins.");return}let r=window.moment(e),i=(0,Dn.getAllDailyNotes)(),n=(0,Dn.getDailyNote)(r,i),a=!1;if(!n)try{n=await(0,Dn.createDailyNote)(r),a=!0}catch(o){let l=o instanceof Error?o.message:String(o);console.error("Failed to create daily note:",o),new de.Notice(`Failed to create daily note: ${l}`);return}n&&(await this.app.workspace.getLeaf(!1).openFile(n),a&&this.notifyDataChanged(n.path,!1,!0))}catch(r){let i=r instanceof Error?r.message:String(r);console.error("Failed to navigate to daily note:",r),new de.Notice(`Failed to navigate to daily note: ${i}`)}}injectCustomStyles(){let e=document.getElementById("tasknotes-custom-styles");e&&e.remove();let r=this.statusManager.getStatusStyles(),i=this.priorityManager.getPriorityStyles(),n=document.createElement("style");n.id="tasknotes-custom-styles",n.textContent=`
		${r}
		${i}
	`,document.head.appendChild(n)}async updateTaskProperty(e,r,i,n={}){try{let a=await this.taskService.updateProperty(e,r,i,n);if(!n.silent)if(r==="status"){let o=typeof i=="string"?i:String(i),l=this.statusManager.getStatusConfig(o);new de.Notice(`Task marked as '${(l==null?void 0:l.label)||o}'`)}else new de.Notice(`Task ${r} updated`);return a}catch(a){throw console.error(`Failed to update task ${r}:`,a),new de.Notice(`Failed to update task ${r}`),a}}async toggleRecurringTaskComplete(e,r){var i;try{let n=r||this.selectedDate,a=await this.taskService.toggleRecurringTaskComplete(e,r),o=ae(n),c=((i=a.complete_instances)==null?void 0:i.includes(o))?"completed":"marked incomplete";return new de.Notice(`Recurring task ${c} for ${C(n,"MMM d")}`),a}catch(n){throw console.error("Failed to toggle recurring task completion:",n),new de.Notice("Failed to update recurring task"),n}}async toggleTaskArchive(e){try{let r=await this.taskService.toggleArchive(e),i=r.archived?"archived":"unarchived";return new de.Notice(`Task ${i}`),r}catch(r){throw console.error("Failed to toggle task archive:",r),new de.Notice("Failed to update task archive status"),r}}async toggleTaskStatus(e){try{let r=await this.taskService.toggleStatus(e),i=this.statusManager.getStatusConfig(r.status);return new de.Notice(`Task marked as '${(i==null?void 0:i.label)||r.status}'`),r}catch(r){throw console.error("Failed to toggle task status:",r),new de.Notice("Failed to update task status"),r}}openTaskCreationModal(e){new ca(this.app,this,{prePopulatedValues:e}).open()}async applyProjectSubtaskFilter(e){try{let r=this.app.vault.getAbstractFileByPath(e.path);if(!r){new de.Notice("Project file not found");return}let i=this.app.workspace.getActiveViewOfType(Kc)||this.app.workspace.getActiveViewOfType(Xc)||this.app.workspace.getActiveViewOfType(Zc);if(!i||!("filterBar"in i)){new de.Notice("No compatible view active to apply filter");return}let n=i.filterBar;if(!n){new de.Notice("Filter bar not available");return}this.addProjectCondition(n,r.basename),new de.Notice(`Filtered to show subtasks of: ${e.title}`)}catch(r){console.error("Error applying project subtask filter:",r),new de.Notice("Failed to apply project filter")}}addProjectCondition(e,r){this.removeProjectConditions(e),Array.isArray(e.currentQuery.children)||(e.currentQuery.children=[]);let i={type:"condition",id:`project_${this.generateFilterId()}`,property:"projects",operator:"contains",value:`[[${r}]]`},n=e.currentQuery.children.filter(a=>!(a.type==="condition"&&a.property==="projects"&&a.operator==="contains"&&a.id.startsWith("project_")));if(n.length===0)e.currentQuery.children=[i];else{let a={type:"group",id:this.generateFilterId(),conjunction:e.currentQuery.conjunction,children:n};e.currentQuery.children=[i,a],e.currentQuery.conjunction="and"}e.updateFilterBuilder(),e.emit("queryChange",e.currentQuery)}removeProjectConditions(e){if(!Array.isArray(e.currentQuery.children)){e.currentQuery.children=[];return}e.currentQuery.children=e.currentQuery.children.filter(r=>r.type==="condition"?!(r.property==="projects"&&r.operator==="contains"&&r.id.startsWith("project_")):!0)}generateFilterId(){return`filter-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async startTimeTracking(e,r){try{let i=await this.taskService.startTimeTracking(e);return new de.Notice("Time tracking started"),this.statusBarService&&setTimeout(()=>{this.statusBarService.requestUpdate()},50),i}catch(i){throw console.error("Failed to start time tracking:",i),i.message==="Time tracking is already active for this task"?new de.Notice("Time tracking is already active for this task"):new de.Notice("Failed to start time tracking"),i}}async stopTimeTracking(e){try{let r=await this.taskService.stopTimeTracking(e);return new de.Notice("Time tracking stopped"),this.statusBarService&&setTimeout(()=>{this.statusBarService.requestUpdate()},50),r}catch(r){throw console.error("Failed to stop time tracking:",r),r.message==="No active time tracking session for this task"?new de.Notice("No active time tracking session for this task"):new de.Notice("Failed to stop time tracking"),r}}getActiveTimeSession(e){return OE(e.timeEntries||[])}isRecurringTaskCompleteForDate(e,r){if(!e.recurrence)return!1;let i=ae(r);return(Array.isArray(e.complete_instances)?e.complete_instances:[]).includes(i)}formatTime(e){return Zd(e)}async openTaskEditModal(e){new hn(this.app,this,{task:e}).open()}async openDueDateModal(e){try{let{DueDateModal:r}=await Promise.resolve().then(()=>(y_(),g_));new r(this.app,e,this).open()}catch(r){console.error("Error loading DueDateModal:",r)}}async openScheduledDateModal(e){try{let{ScheduledDateModal:r}=await Promise.resolve().then(()=>(w_(),v_));new r(this.app,e,this).open()}catch(r){console.error("Error loading ScheduledDateModal:",r)}}async refreshCache(){try{let e=new de.Notice("Refreshing TaskNotes cache...",0);await this.cacheManager.clearAllCaches(),this.notifyDataChanged(void 0,!0,!0),e.hide(),new de.Notice("TaskNotes cache refreshed successfully")}catch(e){console.error("Error refreshing cache:",e),new de.Notice("Failed to refresh cache. Please try again.")}}async convertTaskToTaskNote(e){try{let r=e.getCursor();if(!this.instantTaskConvertService){new de.Notice("Task conversion service not available. Please try again.");return}await this.instantTaskConvertService.instantConvertTask(e,r.line)}catch(r){console.error("Error converting task:",r),new de.Notice("Failed to convert task. Please try again.")}}async batchConvertAllTasks(e){try{if(!this.instantTaskConvertService){new de.Notice("Task conversion service not available. Please try again.");return}await this.instantTaskConvertService.batchConvertAllTasks(e)}catch(r){console.error("Error batch converting tasks:",r),new de.Notice("Failed to batch convert tasks. Please try again.")}}async insertTaskNoteLink(e){try{let i=(await this.cacheManager.getAllTasks()).filter(a=>!a.archived);new _o(this.app,this,i,a=>{if(a){let o=this.app.vault.getAbstractFileByPath(a.path);if(o){let l=this.app.workspace.getActiveFile(),c=(l==null?void 0:l.path)||"",d=this.app.fileManager.generateMarkdownLink(o,c,"",a.title),u=e.getCursor();e.replaceRange(d,u);let h={line:u.line,ch:u.ch+d.length};e.setCursor(h)}else new de.Notice("Failed to create link - file not found")}}).open()}catch(r){console.error("Error inserting tasknote link:",r),new de.Notice("Failed to insert tasknote link")}}extractSelectionInfoForCommand(e,r){let i=e.getSelection();if(i&&i.trim()){let n=e.listSelections()[0],a=Math.min(n.anchor.line,n.head.line),o=Math.max(n.anchor.line,n.head.line),l=[];for(let h=a;h<=o;h++)l.push(e.getLine(h));let c=l[0],u=l.slice(1).join(`
`).trimEnd();return{taskLine:c,details:u,startLine:a,endLine:o,originalContent:l}}else{let n=e.getLine(r);return{taskLine:n,details:"",startLine:r,endLine:r,originalContent:[n]}}}async openQuickActionsForCurrentTask(){try{let e=this.app.workspace.getActiveFile();if(!e){new de.Notice("No file is currently open");return}let r=await this.cacheManager.getTaskInfo(e.path);if(!r){new de.Notice("Current file is not a TaskNote");return}let{TaskActionPaletteModal:i}=await Promise.resolve().then(()=>(b_(),T_));new i(this.app,r,this,this.selectedDate).open()}catch(e){console.error("Error opening quick actions:",e),new de.Notice("Failed to open quick actions")}}async createInlineTask(e){try{let r=e.getCursor(),i=e.getLine(r.line),n=i.trim(),a;if(n==="")a={line:r.line,ch:r.ch};else{let c={line:r.line,ch:i.length};e.replaceRange(`
`,c),a={line:r.line+1,ch:0}}let o={editor:e,insertionPoint:a};new ca(this.app,this,{onTaskCreated:c=>{this.handleInlineTaskCreated(c,o)}}).open()}catch(r){console.error("Error creating inline task:",r),new de.Notice("Failed to create inline task")}}handleInlineTaskCreated(e,r){try{let{editor:i,insertionPoint:n}=r,a=this.app.vault.getAbstractFileByPath(e.path);if(!a){new de.Notice("Failed to create link - file not found");return}let o=this.app.workspace.getActiveFile(),l=(o==null?void 0:o.path)||"",c=this.app.fileManager.generateMarkdownLink(a,l,"",e.title);i.replaceRange(c,n);let d={line:n.line,ch:n.ch+c.length};i.setCursor(d),new de.Notice(`Inline task "${e.title}" created and linked successfully`)}catch(i){console.error("Error handling inline task creation:",i),new de.Notice("Failed to insert task link")}}haveCacheSettingsChanged(){if(!this.previousCacheSettings)return!0;let e={taskTag:this.settings.taskTag,excludedFolders:this.settings.excludedFolders,disableNoteIndexing:this.settings.disableNoteIndexing,storeTitleInFilename:this.settings.storeTitleInFilename,fieldMapping:this.settings.fieldMapping};return e.taskTag!==this.previousCacheSettings.taskTag||e.excludedFolders!==this.previousCacheSettings.excludedFolders||e.disableNoteIndexing!==this.previousCacheSettings.disableNoteIndexing||e.storeTitleInFilename!==this.previousCacheSettings.storeTitleInFilename||JSON.stringify(e.fieldMapping)!==JSON.stringify(this.previousCacheSettings.fieldMapping)}updatePreviousCacheSettings(){this.previousCacheSettings={taskTag:this.settings.taskTag,excludedFolders:this.settings.excludedFolders,disableNoteIndexing:this.settings.disableNoteIndexing,storeTitleInFilename:this.settings.storeTitleInFilename,fieldMapping:JSON.parse(JSON.stringify(this.settings.fieldMapping))}}};var eH=ud;
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/

/* nosourcemap */